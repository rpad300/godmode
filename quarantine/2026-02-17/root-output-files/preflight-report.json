{
  "runId": "preflight-1769558986473",
  "mode": "live",
  "startedAt": 1769558986473,
  "durationMs": 19184,
  "summary": {
    "total": 72,
    "passed": 70,
    "failed": 0,
    "skipped": 2
  },
  "tests": [
    {
      "id": "config-masking",
      "name": "API keys are masked in config output",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "skipped": true,
        "reason": "Live mode uses real keys for testing"
      },
      "category": "config"
    },
    {
      "id": "config-routing-schema",
      "name": "Routing config has correct schema",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "hasPerTask": false
      },
      "category": "config"
    },
    {
      "id": "config-token-policy-schema",
      "name": "Token policy config has correct schema",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "hasPerModel": false
      },
      "category": "config"
    },
    {
      "id": "adapter-openai-listModels",
      "name": "openai: listModels returns correct structure",
      "status": "PASS",
      "durationMs": 1462,
      "details": {
        "textModels": 93,
        "visionModels": 29,
        "embeddingModels": 3
      },
      "category": "providers"
    },
    {
      "id": "adapter-openai-generateText",
      "name": "openai: generateText returns text response",
      "status": "PASS",
      "durationMs": 409,
      "details": {
        "success": true,
        "hasText": true,
        "model": "gpt-4o-mini"
      },
      "category": "providers"
    },
    {
      "id": "adapter-openai-error-auth",
      "name": "openai: 401 error normalized as auth (non-retryable)",
      "status": "PASS",
      "durationMs": 218,
      "details": {
        "code": "auth",
        "retryable": false
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-openai-error-ratelimit",
      "name": "openai: 429 error normalized as rate_limit (retryable)",
      "status": "PASS",
      "durationMs": 1,
      "details": {
        "code": "rate_limit",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-openai-error-server",
      "name": "openai: 5xx error normalized as server_error (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "server_error",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-openai-error-timeout",
      "name": "openai: timeout error normalized correctly (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "timeout",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-grok-listModels",
      "name": "grok: listModels returns correct structure",
      "status": "PASS",
      "durationMs": 175,
      "details": {
        "textModels": 10,
        "visionModels": 2,
        "embeddingModels": 0
      },
      "category": "providers"
    },
    {
      "id": "adapter-grok-generateText",
      "name": "grok: generateText returns text response",
      "status": "PASS",
      "durationMs": 360,
      "details": {
        "success": true,
        "hasText": true,
        "model": "grok-4-1-fast-non-reasoning"
      },
      "category": "providers"
    },
    {
      "id": "adapter-grok-error-auth",
      "name": "grok: 401 error normalized as auth (non-retryable)",
      "status": "PASS",
      "durationMs": 113,
      "details": {
        "code": "auth",
        "retryable": false
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-grok-error-ratelimit",
      "name": "grok: 429 error normalized as rate_limit (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "rate_limit",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-grok-error-server",
      "name": "grok: 5xx error normalized as server_error (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "server_error",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-grok-error-timeout",
      "name": "grok: timeout error normalized correctly (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "timeout",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-deepseek-listModels",
      "name": "deepseek: listModels returns correct structure",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "textModels": 2,
        "visionModels": 0,
        "embeddingModels": 0
      },
      "category": "providers"
    },
    {
      "id": "adapter-deepseek-generateText",
      "name": "deepseek: generateText returns text response",
      "status": "PASS",
      "durationMs": 1465,
      "details": {
        "success": true,
        "hasText": true,
        "model": "deepseek-chat"
      },
      "category": "providers"
    },
    {
      "id": "adapter-deepseek-error-auth",
      "name": "deepseek: 401 error normalized as auth (non-retryable)",
      "status": "PASS",
      "durationMs": 261,
      "details": {
        "code": "auth",
        "retryable": false
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-deepseek-error-ratelimit",
      "name": "deepseek: 429 error normalized as rate_limit (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "rate_limit",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-deepseek-error-server",
      "name": "deepseek: 5xx error normalized as server_error (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "server_error",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-deepseek-error-timeout",
      "name": "deepseek: timeout error normalized correctly (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "timeout",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-genspark-listModels",
      "name": "genspark: listModels returns correct structure",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "skipReason": "Provider genspark not configured (no API key)"
      },
      "category": "providers"
    },
    {
      "id": "adapter-genspark-generateText",
      "name": "genspark: generateText returns text response",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "skipReason": "Provider genspark not configured (no API key)"
      },
      "category": "providers"
    },
    {
      "id": "adapter-genspark-error-auth",
      "name": "genspark: 401 error normalized as auth (non-retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "auth",
        "retryable": false
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-genspark-error-ratelimit",
      "name": "genspark: 429 error normalized as rate_limit (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "rate_limit",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-genspark-error-server",
      "name": "genspark: 5xx error normalized as server_error (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "server_error",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-genspark-error-timeout",
      "name": "genspark: timeout error normalized correctly (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "timeout",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-kimi-listModels",
      "name": "kimi: listModels returns correct structure",
      "status": "PASS",
      "durationMs": 533,
      "details": {
        "textModels": 3,
        "visionModels": 0,
        "embeddingModels": 0
      },
      "category": "providers"
    },
    {
      "id": "adapter-kimi-generateText",
      "name": "kimi: generateText returns text response",
      "status": "PASS",
      "durationMs": 3034,
      "details": {
        "success": true,
        "hasText": true,
        "model": "kimi-k2"
      },
      "category": "providers"
    },
    {
      "id": "adapter-kimi-error-auth",
      "name": "kimi: 401 error normalized as auth (non-retryable)",
      "status": "PASS",
      "durationMs": 3032,
      "details": {
        "code": "auth",
        "retryable": false
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-kimi-error-ratelimit",
      "name": "kimi: 429 error normalized as rate_limit (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "rate_limit",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-kimi-error-server",
      "name": "kimi: 5xx error normalized as server_error (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "server_error",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-kimi-error-timeout",
      "name": "kimi: timeout error normalized correctly (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "timeout",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-gemini-listModels",
      "name": "gemini: listModels returns correct structure",
      "status": "PASS",
      "durationMs": 201,
      "details": {
        "textModels": 32,
        "visionModels": 16,
        "embeddingModels": 6
      },
      "category": "providers"
    },
    {
      "id": "adapter-gemini-generateText",
      "name": "gemini: generateText returns text response",
      "status": "PASS",
      "durationMs": 576,
      "details": {
        "success": true,
        "hasText": true,
        "model": "gemini-2.0-flash"
      },
      "category": "providers"
    },
    {
      "id": "adapter-gemini-error-auth",
      "name": "gemini: 401 error normalized as auth (non-retryable)",
      "status": "PASS",
      "durationMs": 60,
      "details": {
        "code": "auth",
        "retryable": false
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-gemini-error-ratelimit",
      "name": "gemini: 429 error normalized as rate_limit (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "rate_limit",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-gemini-error-server",
      "name": "gemini: 5xx error normalized as server_error (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "server_error",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-gemini-error-timeout",
      "name": "gemini: timeout error normalized correctly (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "timeout",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-claude-listModels",
      "name": "claude: listModels returns correct structure",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "textModels": 6,
        "visionModels": 6,
        "embeddingModels": 0
      },
      "category": "providers"
    },
    {
      "id": "adapter-claude-generateText",
      "name": "claude: generateText returns text response",
      "status": "PASS",
      "durationMs": 263,
      "details": {
        "success": false,
        "hasText": false,
        "model": "claude-3-5-haiku-20241022"
      },
      "category": "providers"
    },
    {
      "id": "adapter-claude-error-auth",
      "name": "claude: 401 error normalized as auth (non-retryable)",
      "status": "PASS",
      "durationMs": 175,
      "details": {
        "code": "auth",
        "retryable": false
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-claude-error-ratelimit",
      "name": "claude: 429 error normalized as rate_limit (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "rate_limit",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-claude-error-server",
      "name": "claude: 5xx error normalized as server_error (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "server_error",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-claude-error-timeout",
      "name": "claude: timeout error normalized correctly (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "timeout",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-minimax-listModels",
      "name": "minimax: listModels returns correct structure",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "textModels": 2,
        "visionModels": 2,
        "embeddingModels": 1
      },
      "category": "providers"
    },
    {
      "id": "adapter-minimax-generateText",
      "name": "minimax: generateText returns text response",
      "status": "PASS",
      "durationMs": 1926,
      "details": {
        "success": false,
        "hasText": false,
        "model": "MiniMax-M2"
      },
      "category": "providers"
    },
    {
      "id": "adapter-minimax-error-auth",
      "name": "minimax: 401 error normalized as auth (non-retryable)",
      "status": "PASS",
      "durationMs": 1886,
      "details": {
        "code": "auth",
        "retryable": false
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-minimax-error-ratelimit",
      "name": "minimax: 429 error normalized as rate_limit (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "rate_limit",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-minimax-error-server",
      "name": "minimax: 5xx error normalized as server_error (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "server_error",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-minimax-error-timeout",
      "name": "minimax: timeout error normalized correctly (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "timeout",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-ollama-listModels",
      "name": "ollama: listModels returns correct structure",
      "status": "PASS",
      "durationMs": 9,
      "details": {
        "textModels": 2,
        "visionModels": 1,
        "embeddingModels": 1
      },
      "category": "providers"
    },
    {
      "id": "adapter-ollama-generateText",
      "name": "ollama: generateText returns text response",
      "status": "PASS",
      "durationMs": 3,
      "details": {
        "success": false,
        "hasText": false,
        "model": "llama3.2:1b"
      },
      "category": "providers"
    },
    {
      "id": "adapter-ollama-error-auth",
      "name": "ollama: 401 error normalized as auth (non-retryable)",
      "status": "PASS",
      "durationMs": 4,
      "details": {
        "code": "auth",
        "retryable": false
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-ollama-error-ratelimit",
      "name": "ollama: 429 error normalized as rate_limit (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "rate_limit",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-ollama-error-server",
      "name": "ollama: 5xx error normalized as server_error (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "server_error",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "adapter-ollama-error-timeout",
      "name": "ollama: timeout error normalized correctly (retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "code": "timeout",
        "retryable": true
      },
      "category": "error-handling"
    },
    {
      "id": "token-estimate-basic",
      "name": "Token estimation works for simple text",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "text": "Hello, world! This is a test.",
        "estimatedTokens": 8
      },
      "category": "tokenBudget"
    },
    {
      "id": "token-budget-enforce-rag-truncation",
      "name": "RAG context truncated first when enforce=true",
      "status": "PASS",
      "durationMs": 1,
      "details": {
        "truncateRag": true,
        "allowedRagTokens": 100
      },
      "category": "tokenBudget"
    },
    {
      "id": "token-budget-enforce-history-truncation",
      "name": "History truncated after RAG when still over",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "truncateHistory": true
      },
      "category": "tokenBudget"
    },
    {
      "id": "token-budget-enforce-blocked",
      "name": "Request blocked when exceeds even after truncation",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "blocked": true,
        "reason": "Request exceeds model context window. Reduce input size or raise caps."
      },
      "category": "tokenBudget"
    },
    {
      "id": "token-budget-no-enforce-warnings-only",
      "name": "No truncation when enforce=false, warnings only",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "blocked": false,
        "warningCount": 1
      },
      "category": "tokenBudget"
    },
    {
      "id": "router-failover-429",
      "name": "Router fails over on 429 rate limit",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "skipped": true,
        "reason": "Simulated failures require mock mode"
      },
      "category": "router"
    },
    {
      "id": "router-failover-401",
      "name": "Router fails over on 401 auth error (non-retryable)",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "skipped": true,
        "reason": "Simulated failures require mock mode"
      },
      "category": "router"
    },
    {
      "id": "router-failover-timeout",
      "name": "Router fails over on timeout",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "skipped": true,
        "reason": "Simulated failures require mock mode"
      },
      "category": "router"
    },
    {
      "id": "router-all-fail",
      "name": "Router returns error with attempts list when all fail",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "skipped": true,
        "reason": "Simulated failures require mock mode"
      },
      "category": "router"
    },
    {
      "id": "router-cooldown",
      "name": "Provider in cooldown is skipped",
      "status": "PASS",
      "durationMs": 1300,
      "details": {
        "usedProvider": "openai",
        "grokInCooldown": true
      },
      "category": "router"
    },
    {
      "id": "router-single-mode",
      "name": "Single mode uses only configured provider",
      "status": "PASS",
      "durationMs": 648,
      "details": {
        "mode": "single",
        "attemptCount": 1,
        "success": true
      },
      "category": "router"
    },
    {
      "id": "router-live-basic",
      "name": "Live failover routing works with configured providers",
      "status": "PASS",
      "durationMs": 456,
      "details": {
        "success": true,
        "usedProvider": "openai",
        "attemptCount": 1
      },
      "category": "router"
    },
    {
      "id": "e2e-chat-flow",
      "name": "Chat flow produces response with routing metadata",
      "status": "PASS",
      "durationMs": 173,
      "details": {
        "hasRouting": true,
        "usedProvider": "openai",
        "success": false
      },
      "category": "e2e"
    },
    {
      "id": "e2e-embeddings-flow",
      "name": "Embeddings flow returns correct array structure",
      "status": "PASS",
      "durationMs": 437,
      "details": {
        "success": true,
        "provider": "openai"
      },
      "category": "e2e"
    },
    {
      "id": "e2e-request-log",
      "name": "Request log captures sanitized requests",
      "status": "PASS",
      "durationMs": 0,
      "details": {
        "requestCount": 0,
        "sanitized": true
      },
      "category": "e2e"
    }
  ]
}