import{r as a,fE as Y,fF as Z,fG as B,fH as H,j as e,a5 as m,a4 as L,N as x,a as N,L as J,Z as X,T as V,U as W,ah as ee,a1 as te,K as P,C as se,J as ae}from"./main-BKbBKYvC.js";import{E as R}from"./ErrorState-BgEaU0QT.js";import{F as re}from"./funnel-IG8tO05b.js";import{D as M}from"./database-DxvMfDyL.js";import{C as ie}from"./circle-check-big-BfAZDzfZ.js";import{S as le}from"./star-_8XYD7us.js";import{C as ce}from"./chart-column-WCU8uNwR.js";const f={documents:{color:"#06b6d4",icon:P,label:"Document"},emails:{color:"#f97316",icon:te,label:"Email"},conversations:{color:"#8b5cf6",icon:ee,label:"Conversation"},contacts:{color:"#ec4899",icon:W,label:"Contact"},facts:{color:"#f59e0b",icon:le,label:"Fact"},decisions:{color:"#a855f7",icon:ie,label:"Decision"},risks:{color:"#ef4444",icon:V,label:"Risk"},actions:{color:"#22c55e",icon:X,label:"Action"},questions:{color:"#3b82f6",icon:J,label:"Question"}},ne=Object.keys(f);function he(){const[l,y]=a.useState(""),[b,Q]=a.useState(""),[i,v]=a.useState([]),[d,q]=a.useState(!1),[g,w]=a.useState(!1),[z,n]=a.useState(!1);a.useEffect(()=>{const t=setTimeout(()=>Q(l),300);return()=>clearTimeout(t)},[l]);const{data:S,isFetching:C}=Y(b),{data:k,isLoading:A,error:K,refetch:j}=Z(),r=B(),o=H(),p=a.useMemo(()=>r.data?.results??[],[r.data]),F=a.useMemo(()=>r.data?.total??p.length,[r.data,p.length]),u=a.useCallback(()=>{l.trim()&&(n(!1),r.mutate({query:l.trim(),types:i.length>0?i:void 0,limit:50}))},[l,i,r]),O=a.useCallback(t=>{t.key==="Enter"&&u(),t.key==="Escape"&&n(!1)},[u]),_=a.useCallback(t=>{v(s=>s.includes(t)?s.filter(c=>c!==t):[...s,t])},[]),$=a.useCallback(t=>{y(t),n(!1),r.mutate({query:t,types:i.length>0?i:void 0,limit:50})},[i,r]),E=a.useMemo(()=>S?.suggestions??[],[S]),T=a.useMemo(()=>k,[k]),G=a.useCallback(()=>{o.mutate(void 0,{onSuccess:()=>j()})},[o,j]);return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)]",children:[e.jsxs("div",{className:"shrink-0 border-b border-gm-border-primary bg-gm-surface-primary sticky top-0 z-20",children:[e.jsxs("div",{className:"px-5 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h1",{className:"text-base font-bold text-gm-text-primary",children:"Search"}),e.jsx("span",{className:"text-[10px] text-gm-text-tertiary bg-gm-surface-secondary px-2 py-0.5 rounded-full",children:"Full-text"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(m,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gm-text-tertiary"}),e.jsx("input",{value:l,onChange:t=>{y(t.target.value),n(!0)},onKeyDown:O,onFocus:()=>{b.length>=2&&n(!0)},placeholder:"Search across all project data...","aria-label":"Search across all project data",className:"w-full pl-10 pr-10 py-2.5 bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-sm text-gm-text-primary placeholder:text-gm-text-tertiary focus:outline-none focus:ring-2 focus:ring-gm-border-focus transition-colors"}),l&&e.jsx("button",{onClick:()=>{y(""),n(!1)},"aria-label":"Clear search",className:"absolute right-3 top-1/2 -translate-y-1/2 p-0.5 rounded hover:bg-gm-surface-hover",children:e.jsx(L,{className:"w-3.5 h-3.5 text-gm-text-tertiary"})}),z&&b.length>=2&&(E.length>0||C)&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gm-surface-primary border border-gm-border-primary rounded-lg shadow-lg z-30 overflow-hidden",children:C?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2.5",children:[e.jsx(x,{className:"w-3.5 h-3.5 animate-spin text-gm-text-tertiary"}),e.jsx("span",{className:"text-xs text-gm-text-tertiary",children:"Loading suggestions..."})]}):E.map((t,s)=>e.jsxs("button",{onClick:()=>$(t),className:"w-full text-left px-3 py-2 text-xs text-gm-text-primary hover:bg-gm-surface-secondary transition-colors flex items-center gap-2",children:[e.jsx(m,{className:"w-3 h-3 text-gm-text-tertiary shrink-0"}),e.jsx("span",{className:"truncate",children:t})]},s))})]}),e.jsxs("button",{onClick:u,disabled:!l.trim()||r.isPending,className:"px-4 py-2.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover flex items-center gap-1.5 disabled:opacity-50 transition-colors",children:[r.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(m,{className:"w-3.5 h-3.5"}),"Search"]}),e.jsxs("button",{onClick:()=>q(!d),"aria-expanded":d,className:N("px-3 py-2.5 rounded-lg text-xs font-medium border flex items-center gap-1.5 transition-colors",d?"bg-blue-600/10 border-blue-600/30 text-gm-interactive-primary":"bg-gm-surface-secondary border-gm-border-primary text-gm-text-tertiary hover:text-gm-text-primary"),children:[e.jsx(re,{className:"w-3.5 h-3.5"}),"Filters",i.length>0&&e.jsx("span",{className:"ml-0.5 px-1.5 py-0.5 rounded-full bg-gm-interactive-primary text-gm-text-on-brand text-[9px] leading-none",children:i.length})]}),e.jsxs("button",{onClick:()=>w(!g),"aria-expanded":g,className:N("px-3 py-2.5 rounded-lg text-xs font-medium border flex items-center gap-1.5 transition-colors",g?"bg-blue-600/10 border-blue-600/30 text-gm-interactive-primary":"bg-gm-surface-secondary border-gm-border-primary text-gm-text-tertiary hover:text-gm-text-primary"),children:[e.jsx(M,{className:"w-3.5 h-3.5"}),"Index"]})]})]}),d&&e.jsxs("div",{className:"flex items-center gap-1.5 px-5 py-2.5 border-t border-gm-border-primary bg-[var(--gm-surface-hover)] flex-wrap",children:[e.jsx("span",{className:"text-[10px] text-gm-text-tertiary font-medium mr-1",children:"Types:"}),ne.map(t=>{const s=f[t],c=i.length===0||i.includes(t);return e.jsxs("button",{onClick:()=>_(t),"aria-pressed":c,className:N("px-2.5 py-1 rounded-md text-[10px] font-medium transition-colors border flex items-center gap-1",c?"border-current/20 text-gm-text-primary":"border-gm-border-primary text-gray-500 line-through"),style:{backgroundColor:c?`${s.color}15`:void 0,color:c?s.color:void 0},children:[e.jsx(s.icon,{className:"w-3 h-3"}),s.label]},t)}),i.length>0&&e.jsx("button",{onClick:()=>v([]),className:"px-2 py-1 rounded-md text-[10px] font-medium text-gm-text-tertiary hover:text-gm-text-primary transition-colors",children:"Clear all"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[r.isPending&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(x,{className:"h-8 w-8 animate-spin text-gm-interactive-primary mx-auto mb-3"}),e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"Searching..."})]})}),r.isError&&e.jsx("div",{className:"px-5 py-8",children:e.jsx(R,{message:"Search failed. Please try again.",onRetry:u})}),r.isSuccess&&e.jsxs("div",{className:"px-5 py-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("p",{className:"text-xs text-gm-text-tertiary",children:[e.jsx("span",{className:"font-medium text-gm-text-primary",children:F})," result",F!==1?"s":""," for"," ",e.jsxs("span",{className:"font-medium text-gm-text-primary",children:['"',l,'"']})]})}),p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx(m,{className:"h-12 w-12 text-gray-600 mb-4"}),e.jsx("p",{className:"text-sm text-gm-text-tertiary mb-1",children:"No results found"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Try different keywords or remove some filters"})]}):e.jsx("div",{className:"space-y-2",children:p.map(t=>{const s=f[t.type]??f.documents,c=s?.icon??P,h=s?.color??"#64748b",U=s?.label??t.type,D=t.metadata?.source,I=t.metadata?.timestamp;return e.jsx("div",{className:"group p-4 rounded-lg border border-gm-border-primary bg-gm-surface-primary hover:bg-gm-surface-secondary transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"shrink-0 mt-0.5 w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:`${h}15`},children:e.jsx(c,{className:"w-4 h-4",style:{color:h}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] font-medium px-2 py-0.5 rounded-full",style:{backgroundColor:`${h}15`,color:h},children:U}),t.score!=null&&e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary flex items-center gap-0.5",children:[e.jsx(ce,{className:"w-3 h-3"}),(t.score*100).toFixed(0),"%"]}),I&&e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary flex items-center gap-0.5",children:[e.jsx(se,{className:"w-3 h-3"}),new Date(I).toLocaleDateString()]})]}),e.jsx("h3",{className:"text-sm font-medium text-gm-text-primary truncate group-hover:text-gm-interactive-primary transition-colors",children:t.title}),t.snippet&&e.jsx("p",{className:"text-xs text-gm-text-tertiary mt-1 line-clamp-2 leading-relaxed",children:t.snippet}),D&&e.jsxs("p",{className:"text-[10px] text-gray-400 mt-1.5 truncate",children:["Source: ",D]})]})]})},t.id)})})]}),r.isIdle&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-5",children:[e.jsx(m,{className:"h-16 w-16 text-gray-600 mb-5"}),e.jsx("p",{className:"text-sm font-medium text-gm-text-secondary mb-1",children:"Search your project"}),e.jsx("p",{className:"text-xs text-gray-400 max-w-sm",children:"Search across documents, emails, conversations, contacts, and all extracted insights"})]})]}),g&&e.jsx("div",{className:"hidden md:block w-72 shrink-0 border-l border-gm-border-primary bg-gm-surface-primary overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(M,{className:"w-4 h-4"})," Search Index"]}),e.jsx("button",{onClick:()=>w(!1),"aria-label":"Close index panel",className:"p-1 rounded hover:bg-gm-surface-secondary",children:e.jsx(L,{className:"w-3.5 h-3.5 text-gm-text-tertiary"})})]}),A?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(x,{className:"w-5 h-5 animate-spin text-gm-interactive-primary"})}):K?e.jsx(R,{message:"Failed to load index stats.",onRetry:()=>j()}):T?e.jsx("div",{className:"space-y-3",children:Object.entries(T).filter(([t])=>t!=="ok").map(([t,s])=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-gm-border-primary last:border-0",children:[e.jsx("span",{className:"text-[10px] text-gm-text-tertiary capitalize",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-xs font-medium text-gm-text-primary",children:typeof s=="number"?s.toLocaleString():String(s??"-")})]},t))}):e.jsx("p",{className:"text-xs text-gm-text-tertiary text-center py-4",children:"No stats available"}),e.jsx("button",{onClick:G,disabled:o.isPending,className:"w-full px-3 py-2 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover flex items-center justify-center gap-1.5 disabled:opacity-50 transition-colors",children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"})," Rebuilding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-3.5 h-3.5"})," Rebuild Index"]})}),o.isSuccess&&e.jsx("p",{className:"text-[10px] text-gm-status-success text-center",children:"Index rebuilt successfully"}),o.isError&&e.jsx("p",{className:"text-[10px] text-gm-status-danger text-center",children:"Rebuild failed. Try again."})]})})]})]})}export{he as default};
//# sourceMappingURL=SearchPage-B2JEM_HG.js.map
