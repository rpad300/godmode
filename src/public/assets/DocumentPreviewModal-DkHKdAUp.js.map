{"version":3,"file":"DocumentPreviewModal-DkHKdAUp.js","sources":["../../frontend/components/modals/DocumentPreviewModal.ts"],"sourcesContent":["/**\r\n * Document Preview Modal - SOTA\r\n * Full document preview with AI analysis, versions, activity, sharing\r\n */\r\n\r\nimport { Document, documentsService } from '../../services/documents';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatFileSize, formatDateTime } from '../../utils/format';\r\n\r\nexport interface DocumentPreviewProps {\r\n  document: Document;\r\n  onClose?: () => void;\r\n  onUpdate?: () => void;\r\n}\r\n\r\ninterface DocumentVersion {\r\n  id: string;\r\n  version_number: number;\r\n  is_current: boolean;\r\n  filename: string;\r\n  file_size: number;\r\n  change_notes?: string;\r\n  ai_change_summary?: string;\r\n  uploaded_by?: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface DocumentActivity {\r\n  id: string;\r\n  action: string;\r\n  user_id?: string;\r\n  user_name?: string;\r\n  user_avatar?: string;\r\n  details?: Record<string, unknown>;\r\n  created_at: string;\r\n}\r\n\r\ninterface AIAnalysis {\r\n  id: string;\r\n  document_id: string;\r\n  analysis_type: string;\r\n  provider: string;\r\n  model: string;\r\n  status: string;\r\n  entities_extracted?: number;\r\n  input_tokens?: number;\r\n  output_tokens?: number;\r\n  cost?: number;\r\n  latency_ms?: number;\r\n  result?: Record<string, unknown>;\r\n  created_at: string;\r\n}\r\n\r\n// State\r\nlet currentTab = 'preview';\r\nlet isFavorite = false;\r\nlet activeReprocessInterval: ReturnType<typeof setInterval> | null = null;\r\n\r\n/**\r\n * Show document preview modal\r\n */\r\nexport function showDocumentPreviewModal(props: DocumentPreviewProps): void {\r\n  const { document: doc } = props;\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'document-preview-modal';\r\n  content.innerHTML = `\r\n    <style>\r\n      .document-preview-modal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 80vh;\r\n        max-height: 800px;\r\n        width: 900px;\r\n        max-width: 95vw;\r\n      }\r\n      .preview-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n      }\r\n      .preview-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n      }\r\n      .preview-title-section {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .preview-title {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin: 0 0 4px 0;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n      .preview-meta {\r\n        display: flex;\r\n        gap: 12px;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .preview-meta span {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n      }\r\n      .preview-actions {\r\n        display: flex;\r\n        gap: 8px;\r\n      }\r\n      .preview-actions .btn {\r\n        padding: 8px 12px;\r\n        font-size: 13px;\r\n        border-radius: 8px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n      .btn-favorite {\r\n        background: transparent;\r\n        border: 1px solid var(--border-color);\r\n        color: var(--text-secondary);\r\n      }\r\n      .btn-favorite.active {\r\n        background: rgba(255, 193, 7, 0.1);\r\n        border-color: #ffc107;\r\n        color: #ffc107;\r\n      }\r\n      .preview-tabs {\r\n        display: flex;\r\n        gap: 0;\r\n        padding: 0 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      .preview-tab {\r\n        padding: 12px 20px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        color: var(--text-secondary);\r\n        background: transparent;\r\n        border: none;\r\n        cursor: pointer;\r\n        position: relative;\r\n        transition: all 0.2s;\r\n      }\r\n      .preview-tab:hover {\r\n        color: var(--text-primary);\r\n        background: rgba(var(--primary-rgb), 0.05);\r\n      }\r\n      .preview-tab.active {\r\n        color: var(--primary);\r\n      }\r\n      .preview-tab.active::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: -1px;\r\n        left: 0;\r\n        right: 0;\r\n        height: 2px;\r\n        background: var(--primary);\r\n        border-radius: 2px 2px 0 0;\r\n      }\r\n      .preview-tab-badge {\r\n        margin-left: 6px;\r\n        padding: 2px 6px;\r\n        font-size: 11px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 10px;\r\n        color: var(--primary);\r\n      }\r\n      .preview-content {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 24px;\r\n      }\r\n      .preview-section {\r\n        display: none;\r\n      }\r\n      .preview-section.active {\r\n        display: block;\r\n      }\r\n      \r\n      /* Content Preview */\r\n      .content-preview {\r\n        background: var(--bg-secondary);\r\n        border-radius: 12px;\r\n        padding: 20px;\r\n        font-family: var(--font-mono, monospace);\r\n        font-size: 13px;\r\n        line-height: 1.6;\r\n        white-space: pre-wrap;\r\n        max-height: 500px;\r\n        overflow-y: auto;\r\n      }\r\n      .content-empty, .content-loading {\r\n        text-align: center;\r\n        padding: 60px 20px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .content-loading::after {\r\n        content: '';\r\n        display: inline-block;\r\n        width: 16px;\r\n        height: 16px;\r\n        border: 2px solid var(--border-color);\r\n        border-top-color: var(--primary);\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n        margin-left: 8px;\r\n        vertical-align: middle;\r\n      }\r\n      .content-empty svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        opacity: 0.5;\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      /* Summary Section */\r\n      .summary-card {\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), rgba(var(--primary-rgb), 0.02));\r\n        border: 1px solid rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n        padding: 20px;\r\n        margin-bottom: 20px;\r\n      }\r\n      .summary-card h4 {\r\n        margin: 0 0 12px 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      .summary-card p {\r\n        margin: 0;\r\n        font-size: 14px;\r\n        line-height: 1.6;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      /* Entities Grid */\r\n      .entities-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\r\n        gap: 12px;\r\n        margin-top: 20px;\r\n      }\r\n      .entity-card {\r\n        background: var(--bg-secondary);\r\n        border-radius: 10px;\r\n        padding: 16px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        transition: background 0.3s ease, transform 0.2s ease;\r\n      }\r\n      .entity-card.updated {\r\n        animation: pulse-highlight 1.5s ease;\r\n      }\r\n      @keyframes pulse-highlight {\r\n        0% { background: rgba(var(--primary-rgb), 0.3); transform: scale(1.02); }\r\n        50% { background: rgba(var(--primary-rgb), 0.15); }\r\n        100% { background: var(--bg-secondary); transform: scale(1); }\r\n      }\r\n      .entity-icon {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 10px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 18px;\r\n      }\r\n      .entity-icon.facts { background: rgba(59, 130, 246, 0.1); }\r\n      .entity-icon.decisions { background: rgba(16, 185, 129, 0.1); }\r\n      .entity-icon.risks { background: rgba(239, 68, 68, 0.1); }\r\n      .entity-icon.actions { background: rgba(245, 158, 11, 0.1); }\r\n      .entity-icon.questions { background: rgba(139, 92, 246, 0.1); }\r\n      .entity-info h5 {\r\n        margin: 0 0 2px 0;\r\n        font-size: 20px;\r\n        font-weight: 600;\r\n      }\r\n      .entity-info span {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      /* Analysis List */\r\n      .analysis-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      .analysis-item {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 10px;\r\n        transition: all 0.2s;\r\n      }\r\n      .analysis-item:hover {\r\n        background: rgba(var(--primary-rgb), 0.05);\r\n      }\r\n      .analysis-version {\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 8px;\r\n        background: var(--primary);\r\n        color: white;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-weight: 600;\r\n        font-size: 14px;\r\n      }\r\n      .analysis-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .analysis-title {\r\n        font-weight: 500;\r\n        margin-bottom: 4px;\r\n      }\r\n      .analysis-meta {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n        display: flex;\r\n        gap: 12px;\r\n      }\r\n      .analysis-actions {\r\n        display: flex;\r\n        gap: 8px;\r\n      }\r\n      \r\n      /* Activity Timeline */\r\n      .activity-timeline {\r\n        position: relative;\r\n        padding-left: 24px;\r\n      }\r\n      .activity-timeline::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: 8px;\r\n        top: 0;\r\n        bottom: 0;\r\n        width: 2px;\r\n        background: var(--border-color);\r\n      }\r\n      .activity-item {\r\n        position: relative;\r\n        padding: 12px 0 12px 20px;\r\n      }\r\n      .activity-item::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: -20px;\r\n        top: 18px;\r\n        width: 10px;\r\n        height: 10px;\r\n        border-radius: 50%;\r\n        background: var(--primary);\r\n        border: 2px solid var(--bg-primary);\r\n      }\r\n      .activity-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n      .activity-avatar {\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 50%;\r\n        background: var(--bg-secondary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 12px;\r\n      }\r\n      .activity-text {\r\n        flex: 1;\r\n      }\r\n      .activity-text strong {\r\n        font-weight: 500;\r\n      }\r\n      .activity-time {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      /* Versions List */\r\n      .versions-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      .version-item {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 16px;\r\n        padding: 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 10px;\r\n        border: 1px solid transparent;\r\n      }\r\n      .version-item.current {\r\n        border-color: var(--primary);\r\n        background: rgba(var(--primary-rgb), 0.05);\r\n      }\r\n      .version-badge {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 8px;\r\n        background: var(--bg-tertiary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-weight: 600;\r\n        font-size: 14px;\r\n      }\r\n      .version-item.current .version-badge {\r\n        background: var(--primary);\r\n        color: white;\r\n      }\r\n      .version-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .version-title {\r\n        font-weight: 500;\r\n        margin-bottom: 4px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      .version-title .current-tag {\r\n        font-size: 10px;\r\n        padding: 2px 6px;\r\n        background: var(--primary);\r\n        color: white;\r\n        border-radius: 4px;\r\n        text-transform: uppercase;\r\n      }\r\n      .version-notes {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .version-meta {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      .version-ai-summary {\r\n        margin-top: 8px;\r\n        padding: 10px;\r\n        background: rgba(var(--primary-rgb), 0.05);\r\n        border-radius: 6px;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .version-ai-summary strong {\r\n        color: var(--primary);\r\n      }\r\n      \r\n      /* Tags Section */\r\n      .tags-section {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 8px;\r\n        margin-top: 16px;\r\n      }\r\n      .doc-tag {\r\n        padding: 4px 10px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n        font-size: 12px;\r\n        color: var(--primary);\r\n      }\r\n      \r\n      /* Share Panel */\r\n      .share-panel {\r\n        background: var(--bg-secondary);\r\n        border-radius: 12px;\r\n        padding: 20px;\r\n      }\r\n      .share-link-container {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-bottom: 16px;\r\n      }\r\n      .share-link-input {\r\n        flex: 1;\r\n        padding: 10px 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 8px;\r\n        font-size: 13px;\r\n        background: var(--bg-primary);\r\n      }\r\n      .share-options {\r\n        display: grid;\r\n        grid-template-columns: 1fr 1fr;\r\n        gap: 12px;\r\n      }\r\n      .share-option {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 4px;\r\n      }\r\n      .share-option label {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .share-option input, .share-option select {\r\n        padding: 8px 10px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 6px;\r\n        font-size: 13px;\r\n        background: var(--bg-primary);\r\n      }\r\n      \r\n      /* Empty State */\r\n      .empty-section {\r\n        text-align: center;\r\n        padding: 40px 20px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .empty-section svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        opacity: 0.4;\r\n        margin-bottom: 12px;\r\n      }\r\n      \r\n      /* Spinner for button loading state */\r\n      .spinner {\r\n        display: inline-block;\r\n        width: 14px;\r\n        height: 14px;\r\n        border: 2px solid rgba(255,255,255,0.3);\r\n        border-top-color: white;\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n        margin-right: 6px;\r\n        vertical-align: middle;\r\n      }\r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n      #reprocess-btn:disabled {\r\n        opacity: 0.7;\r\n        cursor: wait;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"preview-header\">\r\n      <div class=\"preview-icon\">${getDocIcon(doc.filename || '')}</div>\r\n      <div class=\"preview-title-section\">\r\n        <h3 class=\"preview-title\">${escapeHtml(doc.filename || doc.originalName || 'Untitled')}</h3>\r\n        <div class=\"preview-meta\">\r\n          <span>${formatFileSize(doc.size || 0)}</span>\r\n          <span>${formatRelativeTime(doc.created_at)}</span>\r\n          <span class=\"status-badge status-${doc.status}\">${doc.status}</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"preview-actions\">\r\n        <button class=\"btn btn-favorite ${isFavorite ? 'active' : ''}\" id=\"favorite-btn\" title=\"Favorite\">\r\n          ${isFavorite ? '‚òÖ' : '‚òÜ'}\r\n        </button>\r\n        <button class=\"btn btn-secondary\" id=\"share-btn\">\r\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8\"/>\r\n            <polyline points=\"16 6 12 2 8 6\"/>\r\n            <line x1=\"12\" y1=\"2\" x2=\"12\" y2=\"15\"/>\r\n          </svg>\r\n          Share\r\n        </button>\r\n        <button class=\"btn btn-secondary\" id=\"download-btn\">\r\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n            <polyline points=\"7 10 12 15 17 10\"/>\r\n            <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>\r\n          </svg>\r\n          Download\r\n        </button>\r\n        <button class=\"btn btn-primary\" id=\"reprocess-btn\">\r\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"23 4 23 10 17 10\"/>\r\n            <path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\r\n          </svg>\r\n          Reprocess\r\n        </button>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"preview-tabs\">\r\n      <button class=\"preview-tab active\" data-tab=\"preview\">Preview</button>\r\n      <button class=\"preview-tab\" data-tab=\"entities\" id=\"entities-tab\" style=\"display:none\">\r\n        Entities\r\n        <span class=\"preview-tab-badge\" id=\"entities-count\">0</span>\r\n      </button>\r\n      <button class=\"preview-tab\" data-tab=\"analysis\">\r\n        AI Analysis\r\n        <span class=\"preview-tab-badge\" id=\"analysis-count\">0</span>\r\n      </button>\r\n      <button class=\"preview-tab\" data-tab=\"notes\" id=\"notes-tab\" style=\"display:none\">\r\n        Meeting Notes\r\n      </button>\r\n      <button class=\"preview-tab\" data-tab=\"versions\">\r\n        Versions\r\n        <span class=\"preview-tab-badge\" id=\"versions-count\">1</span>\r\n      </button>\r\n      <button class=\"preview-tab\" data-tab=\"activity\">Activity</button>\r\n      <button class=\"preview-tab\" data-tab=\"share\">Share</button>\r\n    </div>\r\n    \r\n    <div class=\"preview-content\">\r\n      <!-- Preview Tab -->\r\n      <div class=\"preview-section active\" data-section=\"preview\">\r\n        <div class=\"summary-card\" id=\"summary-card\" style=\"${doc.summary ? '' : 'display:none'}\">\r\n            <h4>\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\"/>\r\n                <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\r\n              </svg>\r\n              AI Summary\r\n            </h4>\r\n            <p id=\"doc-summary\">${doc.summary ? escapeHtml(doc.summary) : ''}</p>\r\n          </div>\r\n        \r\n        <div class=\"entities-grid\" id=\"entities-grid\">\r\n          <div class=\"entity-card\" data-entity=\"facts\">\r\n            <div class=\"entity-icon facts\">üìã</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${doc.facts_count || 0}</h5>\r\n              <span>Facts</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"entity-card\" data-entity=\"decisions\">\r\n            <div class=\"entity-icon decisions\">‚úì</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${(doc as any).decisions_count || 0}</h5>\r\n              <span>Decisions</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"entity-card\" data-entity=\"risks\">\r\n            <div class=\"entity-icon risks\">‚ö†Ô∏è</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${(doc as any).risks_count || 0}</h5>\r\n              <span>Risks</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"entity-card\" data-entity=\"actions\">\r\n            <div class=\"entity-icon actions\">üìå</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${(doc as any).actions_count || 0}</h5>\r\n              <span>Actions</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"entity-card\" data-entity=\"questions\">\r\n            <div class=\"entity-icon questions\">‚ùì</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${doc.questions_count || 0}</h5>\r\n              <span>Questions</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        ${(doc as any).tags?.length ? `\r\n          <div class=\"tags-section\">\r\n            ${((doc as any).tags as string[]).map(tag => `<span class=\"doc-tag\">#${escapeHtml(tag)}</span>`).join('')}\r\n          </div>\r\n        ` : ''}\r\n        \r\n        <h4 style=\"margin: 24px 0 12px 0; font-size: 14px;\">Content Preview</h4>\r\n        <div class=\"content-preview\" id=\"content-preview\">\r\n          <div class=\"content-loading\">Loading content...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Entities Tab (full extraction results) -->\r\n      <div class=\"preview-section\" data-section=\"entities\">\r\n        <div class=\"entities-full-list\" id=\"entities-full-list\">\r\n          <div class=\"empty-section\">Loading entities...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- AI Analysis Tab -->\r\n      <div class=\"preview-section\" data-section=\"analysis\">\r\n        <div class=\"analysis-list\" id=\"analysis-list\">\r\n          <div class=\"empty-section\">Loading analysis history...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Versions Tab -->\r\n      <div class=\"preview-section\" data-section=\"versions\">\r\n        <div style=\"display: flex; justify-content: flex-end; margin-bottom: 16px;\">\r\n          <button class=\"btn btn-primary\" id=\"upload-version-btn\">\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n              <polyline points=\"17 8 12 3 7 8\"/>\r\n              <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\r\n            </svg>\r\n            Upload New Version\r\n          </button>\r\n        </div>\r\n        <div class=\"versions-list\" id=\"versions-list\">\r\n          <div class=\"empty-section\">Loading versions...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Meeting Notes Tab -->\r\n      <div class=\"preview-section\" data-section=\"notes\">\r\n        <div class=\"notes-container\" id=\"notes-container\">\r\n          <div class=\"empty-section\">No meeting notes available</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Activity Tab -->\r\n      <div class=\"preview-section\" data-section=\"activity\">\r\n        <div class=\"activity-timeline\" id=\"activity-timeline\">\r\n          <div class=\"empty-section\">Loading activity...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Share Tab -->\r\n      <div class=\"preview-section\" data-section=\"share\">\r\n        <div class=\"share-panel\">\r\n          <h4 style=\"margin: 0 0 16px 0;\">Create Share Link</h4>\r\n          <div class=\"share-link-container\">\r\n            <input type=\"text\" class=\"share-link-input\" id=\"share-link-input\" placeholder=\"Generate a link to share...\" readonly>\r\n            <button class=\"btn btn-primary\" id=\"generate-link-btn\">Generate</button>\r\n            <button class=\"btn btn-secondary\" id=\"copy-link-btn\" style=\"display: none;\">Copy</button>\r\n          </div>\r\n          <div class=\"share-options\">\r\n            <div class=\"share-option\">\r\n              <label>Expires</label>\r\n              <select id=\"share-expires\">\r\n                <option value=\"1d\">1 day</option>\r\n                <option value=\"7d\" selected>7 days</option>\r\n                <option value=\"30d\">30 days</option>\r\n                <option value=\"never\">Never</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"share-option\">\r\n              <label>Max Views</label>\r\n              <input type=\"number\" id=\"share-max-views\" placeholder=\"Unlimited\" min=\"1\">\r\n            </div>\r\n            <div class=\"share-option\">\r\n              <label>Password (optional)</label>\r\n              <input type=\"password\" id=\"share-password\" placeholder=\"No password\">\r\n            </div>\r\n            <div class=\"share-option\">\r\n              <label>Permissions</label>\r\n              <select id=\"share-permissions\">\r\n                <option value=\"view\">View only</option>\r\n                <option value=\"download\">View & Download</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div id=\"active-shares\" style=\"margin-top: 20px;\"></div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind tab events\r\n  content.querySelectorAll('.preview-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      const tabName = tab.getAttribute('data-tab')!;\r\n      switchTab(content, tabName);\r\n    });\r\n  });\r\n\r\n  // Bind action buttons\r\n  content.querySelector('#favorite-btn')?.addEventListener('click', () => toggleFavorite(content, doc));\r\n  content.querySelector('#share-btn')?.addEventListener('click', () => switchTab(content, 'share'));\r\n  content.querySelector('#download-btn')?.addEventListener('click', () => downloadDocument(doc));\r\n  content.querySelector('#reprocess-btn')?.addEventListener('click', () => reprocessDocument(doc, props.onUpdate));\r\n  content.querySelector('#upload-version-btn')?.addEventListener('click', () => uploadNewVersion(doc, content, props.onUpdate));\r\n  content.querySelector('#generate-link-btn')?.addEventListener('click', () => generateShareLink(content, doc));\r\n  content.querySelector('#copy-link-btn')?.addEventListener('click', () => copyShareLink(content));\r\n\r\n  // Load data\r\n  loadContentPreview(content, doc.id);\r\n  loadEntities(content, doc.id);\r\n  loadAnalysisHistory(content, doc.id);\r\n  loadVersions(content, doc.id);\r\n  loadActivity(content, doc.id);\r\n  loadMeetingNotes(content, doc.id);\r\n  checkFavoriteStatus(doc.id).then(fav => {\r\n    isFavorite = fav;\r\n    updateFavoriteButton(content);\r\n  });\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'modal-overlay document-preview-overlay';\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.6);\r\n    backdrop-filter: blur(4px);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 1000;\r\n    animation: fadeIn 0.2s ease-out;\r\n  `;\r\n\r\n  // Create modal container\r\n  const modalContainer = document.createElement('div');\r\n  modalContainer.className = 'modal-container';\r\n  modalContainer.style.cssText = `\r\n    background: var(--bg-primary);\r\n    border-radius: 16px;\r\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\r\n    max-height: 90vh;\r\n    overflow: hidden;\r\n    animation: slideUp 0.3s ease-out;\r\n  `;\r\n\r\n  // Add close button\r\n  const closeBtn = document.createElement('button');\r\n  closeBtn.innerHTML = '√ó';\r\n  closeBtn.style.cssText = `\r\n    position: absolute;\r\n    top: 16px;\r\n    right: 16px;\r\n    width: 32px;\r\n    height: 32px;\r\n    border: none;\r\n    background: rgba(0, 0, 0, 0.1);\r\n    border-radius: 50%;\r\n    font-size: 20px;\r\n    cursor: pointer;\r\n    z-index: 10;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  `;\r\n  closeBtn.onclick = () => closePreviewModal(overlay, props.onClose);\r\n  \r\n  content.style.position = 'relative';\r\n  content.appendChild(closeBtn);\r\n  modalContainer.appendChild(content);\r\n  overlay.appendChild(modalContainer);\r\n\r\n  // Close on backdrop click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      closePreviewModal(overlay, props.onClose);\r\n    }\r\n  });\r\n\r\n  // Close on Escape\r\n  const handleEscape = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      closePreviewModal(overlay, props.onClose);\r\n      document.removeEventListener('keydown', handleEscape);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', handleEscape);\r\n\r\n  document.body.appendChild(overlay);\r\n}\r\n\r\nfunction closePreviewModal(overlay: HTMLElement, onClose?: () => void): void {\r\n  // Clear any active reprocess polling interval\r\n  if (activeReprocessInterval) {\r\n    clearInterval(activeReprocessInterval);\r\n    activeReprocessInterval = null;\r\n  }\r\n  \r\n  overlay.style.animation = 'fadeOut 0.2s ease-out';\r\n  setTimeout(() => {\r\n    overlay.remove();\r\n    onClose?.();\r\n  }, 200);\r\n}\r\n\r\nfunction switchTab(container: HTMLElement, tabName: string): void {\r\n  currentTab = tabName;\r\n  \r\n  container.querySelectorAll('.preview-tab').forEach(t => {\r\n    t.classList.toggle('active', t.getAttribute('data-tab') === tabName);\r\n  });\r\n  \r\n  container.querySelectorAll('.preview-section').forEach(s => {\r\n    s.classList.toggle('active', s.getAttribute('data-section') === tabName);\r\n  });\r\n}\r\n\r\n/**\r\n * Load document content preview\r\n */\r\nasync function loadContentPreview(container: HTMLElement, docId: string): Promise<void> {\r\n  const contentEl = container.querySelector('#content-preview') as HTMLElement;\r\n  \r\n  try {\r\n    // Fetch full document with content\r\n    const response = await http.get<{ document?: { content?: string } } | { content?: string }>(`/api/documents/${docId}`);\r\n    const doc = (response.data as { document?: { content?: string } }).document || response.data;\r\n    const content = doc?.content;\r\n    \r\n    if (content) {\r\n      const truncated = content.length > 5000;\r\n      contentEl.innerHTML = `<pre style=\"white-space: pre-wrap; font-family: inherit; margin: 0;\">${escapeHtml(content.substring(0, 5000))}${truncated ? '\\n\\n... (truncated)' : ''}</pre>`;\r\n    } else {\r\n      contentEl.innerHTML = '<div class=\"content-empty\">No content extracted</div>';\r\n    }\r\n  } catch (err) {\r\n    console.error('[Preview] Failed to load content:', err);\r\n    contentEl.innerHTML = '<div class=\"content-empty\">Failed to load content</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Load full entities from extraction_result\r\n */\r\nasync function loadEntities(container: HTMLElement, docId: string): Promise<void> {\r\n  const listEl = container.querySelector('#entities-full-list') as HTMLElement;\r\n  const entitiesTab = container.querySelector('#entities-tab') as HTMLElement;\r\n  const entitiesCount = container.querySelector('#entities-count') as HTMLElement;\r\n  \r\n  try {\r\n    const response = await http.get<{ extraction?: { \r\n      entities?: Array<{ id: string; type: string; name: string; confidence?: number }>;\r\n      facts?: Array<{ id: string; content: string; category?: string; confidence?: number }>;\r\n      decisions?: Array<{ id: string; content: string }>;\r\n      action_items?: Array<{ id: string; task: string; owner?: string; status?: string }>;\r\n      questions?: Array<{ id: string; content: string }>;\r\n      risks?: Array<{ id: string; content: string; severity?: string }>;\r\n    } }>(`/api/documents/${docId}/extraction`);\r\n    \r\n    const extraction = response.data.extraction;\r\n    if (!extraction) {\r\n      listEl.innerHTML = '<div class=\"empty-section\">No extraction data available</div>';\r\n      return;\r\n    }\r\n    \r\n    const entities = extraction.entities || [];\r\n    const facts = extraction.facts || [];\r\n    const decisions = extraction.decisions || [];\r\n    const actions = extraction.action_items || [];\r\n    const questions = extraction.questions || [];\r\n    const risks = extraction.risks || [];\r\n    \r\n    const totalItems = entities.length + facts.length + decisions.length + actions.length + questions.length + risks.length;\r\n    \r\n    if (totalItems === 0) {\r\n      listEl.innerHTML = '<div class=\"empty-section\">No entities extracted</div>';\r\n      return;\r\n    }\r\n    \r\n    // Show tab\r\n    if (entitiesTab) entitiesTab.style.display = '';\r\n    if (entitiesCount) entitiesCount.textContent = String(totalItems);\r\n    \r\n    // Build HTML\r\n    let html = `<style>\r\n      .entity-section { margin-bottom: 24px; }\r\n      .entity-section-title { \r\n        font-size: 14px; \r\n        font-weight: 600; \r\n        color: var(--text-secondary); \r\n        margin-bottom: 12px; \r\n        text-transform: uppercase;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      .entity-section-count {\r\n        font-size: 11px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        color: var(--primary);\r\n      }\r\n      .entity-item {\r\n        padding: 12px 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .entity-item-type {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-tertiary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .entity-item-content {\r\n        color: var(--text-primary);\r\n      }\r\n      .entity-item-meta {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n        margin-top: 4px;\r\n      }\r\n    </style>`;\r\n    \r\n    // Graph entities\r\n    if (entities.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          üîó Graph Entities\r\n          <span class=\"entity-section-count\">${entities.length}</span>\r\n        </div>\r\n        ${entities.map(e => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-type\">${escapeHtml(e.type)}</div>\r\n            <div class=\"entity-item-content\">${escapeHtml(e.name)}</div>\r\n            ${e.confidence ? `<div class=\"entity-item-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Facts\r\n    if (facts.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          üìã Facts\r\n          <span class=\"entity-section-count\">${facts.length}</span>\r\n        </div>\r\n        ${facts.map(f => `\r\n          <div class=\"entity-item\">\r\n            ${f.category ? `<div class=\"entity-item-type\">${escapeHtml(f.category)}</div>` : ''}\r\n            <div class=\"entity-item-content\">${escapeHtml(f.content)}</div>\r\n            ${f.confidence ? `<div class=\"entity-item-meta\">Confidence: ${Math.round(f.confidence * 100)}%</div>` : ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Decisions\r\n    if (decisions.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          ‚úì Decisions\r\n          <span class=\"entity-section-count\">${decisions.length}</span>\r\n        </div>\r\n        ${decisions.map(d => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-content\">${escapeHtml(d.content)}</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Action Items\r\n    if (actions.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          üìå Action Items\r\n          <span class=\"entity-section-count\">${actions.length}</span>\r\n        </div>\r\n        ${actions.map(a => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-content\">‚òê ${escapeHtml(a.task)}</div>\r\n            ${a.owner ? `<div class=\"entity-item-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\r\n            ${a.status ? `<div class=\"entity-item-meta\">Status: ${escapeHtml(a.status)}</div>` : ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Questions\r\n    if (questions.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          ‚ùì Questions\r\n          <span class=\"entity-section-count\">${questions.length}</span>\r\n        </div>\r\n        ${questions.map(q => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-content\">${escapeHtml(q.content)}</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Risks\r\n    if (risks.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          ‚ö†Ô∏è Risks\r\n          <span class=\"entity-section-count\">${risks.length}</span>\r\n        </div>\r\n        ${risks.map(r => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-content\">${escapeHtml(r.content)}</div>\r\n            ${r.severity ? `<div class=\"entity-item-meta\">Severity: ${escapeHtml(r.severity)}</div>` : ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    listEl.innerHTML = html;\r\n  } catch (err) {\r\n    listEl.innerHTML = '<div class=\"empty-section\">Failed to load entities</div>';\r\n  }\r\n}\r\n\r\nasync function loadAnalysisHistory(container: HTMLElement, docId: string): Promise<void> {\r\n  const listEl = container.querySelector('#analysis-list') as HTMLElement;\r\n  \r\n  try {\r\n    const response = await http.get<{ analyses: AIAnalysis[] }>(`/api/documents/${docId}/analysis`);\r\n    const analyses = response.data.analyses || [];\r\n    \r\n    container.querySelector('#analysis-count')!.textContent = String(analyses.length);\r\n    \r\n    if (analyses.length === 0) {\r\n      listEl.innerHTML = `\r\n        <div class=\"empty-section\">\r\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n            <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\"/>\r\n            <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\r\n          </svg>\r\n          <p>No AI analyses yet</p>\r\n          <button class=\"btn btn-primary btn-sm\" id=\"run-analysis-btn\">Run Analysis</button>\r\n        </div>\r\n      `;\r\n      \r\n      // Add click handler for Run Analysis button\r\n      const runAnalysisBtn = listEl.querySelector('#run-analysis-btn');\r\n      if (runAnalysisBtn) {\r\n        runAnalysisBtn.addEventListener('click', async () => {\r\n          const btn = runAnalysisBtn as HTMLButtonElement;\r\n          const originalText = btn.textContent;\r\n          btn.disabled = true;\r\n          btn.textContent = 'Analyzing...';\r\n          \r\n          try {\r\n            // Trigger reprocess via API\r\n            const response = await http.post(`/api/documents/${docId}/reprocess`, {});\r\n            if (response.data.success) {\r\n              toast.success('Analysis started');\r\n              // Poll for completion and reload\r\n              setTimeout(() => loadAnalysisHistory(container, docId), 3000);\r\n            } else {\r\n              toast.error(response.data.error || 'Failed to start analysis');\r\n              btn.disabled = false;\r\n              btn.textContent = originalText;\r\n            }\r\n          } catch (err: any) {\r\n            toast.error(err.message || 'Failed to run analysis');\r\n            btn.disabled = false;\r\n            btn.textContent = originalText;\r\n          }\r\n        });\r\n      }\r\n      return;\r\n    }\r\n    \r\n    listEl.innerHTML = analyses.map((a, i) => `\r\n      <div class=\"analysis-item\" data-id=\"${a.id}\">\r\n        <div class=\"analysis-version\">v${analyses.length - i}</div>\r\n        <div class=\"analysis-info\">\r\n          <div class=\"analysis-title\">${capitalizeFirst(a.analysis_type)}</div>\r\n          <div class=\"analysis-meta\">\r\n            <span>${a.provider}/${a.model}</span>\r\n            <span>${a.entities_extracted || 0} entities</span>\r\n            <span>${(a.input_tokens || 0) + (a.output_tokens || 0)} tokens</span>\r\n            ${a.cost ? `<span>$${a.cost.toFixed(4)}</span>` : ''}\r\n          </div>\r\n          <div class=\"analysis-timestamp\" style=\"font-size: 12px; color: var(--text-tertiary, #666); margin-top: 4px;\">\r\n            ${formatDateTime(a.created_at)} (${formatRelativeTime(a.created_at)})\r\n          </div>\r\n        </div>\r\n        <div class=\"analysis-actions\">\r\n          <button class=\"btn btn-sm view-analysis-btn\">View</button>\r\n          <button class=\"btn btn-sm compare-analysis-btn\">Compare</button>\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n    \r\n    // Add click handlers for View buttons\r\n    listEl.querySelectorAll('.view-analysis-btn').forEach((btn, idx) => {\r\n      btn.addEventListener('click', () => {\r\n        const analysis = analyses[idx];\r\n        showAnalysisDetail(container, analysis);\r\n      });\r\n    });\r\n    \r\n    // Add click handlers for Compare buttons\r\n    listEl.querySelectorAll('.compare-analysis-btn').forEach((btn, idx) => {\r\n      btn.addEventListener('click', () => {\r\n        if (analyses.length < 2) {\r\n          toast.info('Need at least 2 analyses to compare');\r\n          return;\r\n        }\r\n        toast.info('Compare feature coming soon');\r\n      });\r\n    });\r\n  } catch {\r\n    listEl.innerHTML = '<div class=\"empty-section\">No analysis history available</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Show analysis detail in a modal overlay\r\n * Fetches extraction_result from the document if not available in analysis\r\n */\r\nasync function showAnalysisDetail(container: HTMLElement, analysis: AIAnalysis): Promise<void> {\r\n  // Try to get the full result from the document if not in analysis\r\n  let fullResult = analysis.result;\r\n  if (!fullResult && analysis.document_id) {\r\n    try {\r\n      // Get document from API - returns { document: {...} } or just the document\r\n      const docResponse = await http.get<{ document?: { extraction_result?: Record<string, unknown> }, extraction_result?: Record<string, unknown> }>(`/api/documents/${analysis.document_id}`);\r\n      // Handle both response formats\r\n      fullResult = docResponse.data.document?.extraction_result || docResponse.data.extraction_result;\r\n      console.log('[Analysis] Loaded extraction_result from document:', !!fullResult);\r\n    } catch (err) {\r\n      console.warn('[Analysis] Could not load extraction_result:', err);\r\n    }\r\n  }\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'analysis-detail-overlay';\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.7);\r\n    z-index: 10001;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding: 20px;\r\n  `;\r\n  \r\n  // Format the result JSON nicely\r\n  const resultJson = fullResult \r\n    ? JSON.stringify(fullResult, null, 2) \r\n    : 'No detailed result available';\r\n  \r\n  // Build summary from result if available\r\n  let summary = '';\r\n  if (fullResult) {\r\n    const r = fullResult as any;\r\n    if (r.summary) summary = r.summary;\r\n    else if (r.meeting?.title) summary = `Meeting: ${r.meeting.title}`;\r\n  }\r\n  \r\n  const content = document.createElement('div');\r\n  content.className = 'analysis-detail-content';\r\n  content.style.cssText = `\r\n    background: var(--bg-primary, #1a1a2e);\r\n    border-radius: 12px;\r\n    max-width: 900px;\r\n    width: 100%;\r\n    max-height: 80vh;\r\n    overflow: hidden;\r\n    display: flex;\r\n    flex-direction: column;\r\n  `;\r\n  \r\n  content.innerHTML = `\r\n    <div style=\"padding: 20px; border-bottom: 1px solid var(--border-color, #333); display: flex; justify-content: space-between; align-items: center;\">\r\n      <div>\r\n        <h3 style=\"margin: 0; color: var(--text-primary, #fff);\">${capitalizeFirst(analysis.analysis_type)} Analysis</h3>\r\n        <p style=\"margin: 4px 0 0; color: var(--text-secondary, #888); font-size: 13px;\">\r\n          ${analysis.provider}/${analysis.model} ‚Ä¢ ${analysis.entities_extracted || 0} entities ‚Ä¢ ${formatRelativeTime(analysis.created_at)}\r\n        </p>\r\n      </div>\r\n      <button class=\"close-analysis-btn\" style=\"background: none; border: none; color: var(--text-secondary, #888); cursor: pointer; font-size: 24px;\">&times;</button>\r\n    </div>\r\n    ${summary ? `\r\n      <div style=\"padding: 16px 20px; background: var(--bg-secondary, #252542); border-bottom: 1px solid var(--border-color, #333);\">\r\n        <strong style=\"color: var(--text-primary, #fff);\">Summary:</strong>\r\n        <p style=\"margin: 8px 0 0; color: var(--text-secondary, #ccc);\">${escapeHtml(summary)}</p>\r\n      </div>\r\n    ` : ''}\r\n    <div style=\"padding: 20px; overflow-y: auto; flex: 1;\">\r\n      <div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;\">\r\n        <div style=\"background: var(--bg-secondary, #252542); padding: 12px; border-radius: 8px; text-align: center;\">\r\n          <div style=\"font-size: 24px; font-weight: bold; color: var(--accent-color, #6366f1);\">${analysis.entities_extracted || 0}</div>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary, #888);\">Entities</div>\r\n        </div>\r\n        <div style=\"background: var(--bg-secondary, #252542); padding: 12px; border-radius: 8px; text-align: center;\">\r\n          <div style=\"font-size: 24px; font-weight: bold; color: var(--accent-color, #6366f1);\">${analysis.input_tokens || 0}</div>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary, #888);\">Input Tokens</div>\r\n        </div>\r\n        <div style=\"background: var(--bg-secondary, #252542); padding: 12px; border-radius: 8px; text-align: center;\">\r\n          <div style=\"font-size: 24px; font-weight: bold; color: var(--accent-color, #6366f1);\">${analysis.output_tokens || 0}</div>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary, #888);\">Output Tokens</div>\r\n        </div>\r\n        <div style=\"background: var(--bg-secondary, #252542); padding: 12px; border-radius: 8px; text-align: center;\">\r\n          <div style=\"font-size: 24px; font-weight: bold; color: var(--accent-color, #6366f1);\">${analysis.latency_ms ? `${(analysis.latency_ms / 1000).toFixed(1)}s` : '-'}</div>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary, #888);\">Latency</div>\r\n        </div>\r\n      </div>\r\n      <details style=\"margin-top: 16px;\">\r\n        <summary style=\"cursor: pointer; color: var(--text-primary, #fff); font-weight: 500; padding: 8px 0;\">Raw Result JSON</summary>\r\n        <pre style=\"background: var(--bg-tertiary, #1e1e3f); padding: 16px; border-radius: 8px; overflow-x: auto; font-size: 12px; color: var(--text-secondary, #ccc); max-height: 400px; overflow-y: auto;\">${escapeHtml(resultJson)}</pre>\r\n      </details>\r\n    </div>\r\n  `;\r\n  \r\n  overlay.appendChild(content);\r\n  document.body.appendChild(overlay);\r\n  \r\n  // Close handlers\r\n  const closeBtn = content.querySelector('.close-analysis-btn');\r\n  closeBtn?.addEventListener('click', () => overlay.remove());\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n}\r\n\r\nasync function loadVersions(container: HTMLElement, docId: string): Promise<void> {\r\n  const listEl = container.querySelector('#versions-list') as HTMLElement;\r\n  \r\n  try {\r\n    const response = await http.get<{ versions: DocumentVersion[] }>(`/api/documents/${docId}/versions`);\r\n    const versions = response.data.versions || [];\r\n    \r\n    container.querySelector('#versions-count')!.textContent = String(versions.length || 1);\r\n    \r\n    if (versions.length === 0) {\r\n      listEl.innerHTML = `\r\n        <div class=\"version-item current\">\r\n          <div class=\"version-badge\">v1</div>\r\n          <div class=\"version-info\">\r\n            <div class=\"version-title\">Current Version <span class=\"current-tag\">Current</span></div>\r\n            <div class=\"version-notes\">Initial upload</div>\r\n          </div>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n    \r\n    listEl.innerHTML = versions.map(v => `\r\n      <div class=\"version-item ${v.is_current ? 'current' : ''}\" data-id=\"${v.id}\">\r\n        <div class=\"version-badge\">v${v.version_number}</div>\r\n        <div class=\"version-info\">\r\n          <div class=\"version-title\">\r\n            ${escapeHtml(v.filename)}\r\n            ${v.is_current ? '<span class=\"current-tag\">Current</span>' : ''}\r\n          </div>\r\n          ${v.change_notes ? `<div class=\"version-notes\">\"${escapeHtml(v.change_notes)}\"</div>` : ''}\r\n          <div class=\"version-meta\">\r\n            ${formatFileSize(v.file_size)} ‚Ä¢ ${formatRelativeTime(v.created_at)}\r\n          </div>\r\n          ${v.ai_change_summary ? `\r\n            <div class=\"version-ai-summary\">\r\n              <strong>AI:</strong> ${escapeHtml(v.ai_change_summary)}\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n        <div class=\"version-actions\" style=\"display: flex; gap: 8px;\">\r\n          <button class=\"btn btn-sm view-version-btn\">View</button>\r\n          ${!v.is_current ? '<button class=\"btn btn-sm restore-version-btn\">Restore</button>' : ''}\r\n          ${v.version_number > 1 ? '<button class=\"btn btn-sm diff-version-btn\">Diff</button>' : ''}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } catch {\r\n    listEl.innerHTML = '<div class=\"empty-section\">Version history not available</div>';\r\n  }\r\n}\r\n\r\nasync function loadActivity(container: HTMLElement, docId: string): Promise<void> {\r\n  const timelineEl = container.querySelector('#activity-timeline') as HTMLElement;\r\n  \r\n  try {\r\n    const response = await http.get<{ activities: DocumentActivity[] }>(`/api/documents/${docId}/activity`);\r\n    const activities = response.data.activities || [];\r\n    \r\n    if (activities.length === 0) {\r\n      timelineEl.innerHTML = '<div class=\"empty-section\">No activity recorded</div>';\r\n      return;\r\n    }\r\n    \r\n    timelineEl.innerHTML = activities.map(a => `\r\n      <div class=\"activity-item\">\r\n        <div class=\"activity-content\">\r\n          <div class=\"activity-avatar\">\r\n            ${a.user_avatar ? `<img src=\"${a.user_avatar}\" alt=\"\">` : getInitials(a.user_name || 'System')}\r\n          </div>\r\n          <div class=\"activity-text\">\r\n            <strong>${escapeHtml(a.user_name || 'System')}</strong> ${getActionText(a.action)}\r\n          </div>\r\n          <div class=\"activity-time\">${formatRelativeTime(a.created_at)}</div>\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } catch {\r\n    timelineEl.innerHTML = '<div class=\"empty-section\">Activity not available</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Load meeting notes (v1.6 notes_rendered_text from extraction)\r\n */\r\nasync function loadMeetingNotes(container: HTMLElement, docId: string): Promise<void> {\r\n  const notesContainer = container.querySelector('#notes-container') as HTMLElement;\r\n  const notesTab = container.querySelector('#notes-tab') as HTMLElement;\r\n  \r\n  try {\r\n    // Fetch extraction data to get notes_rendered_text\r\n    const response = await http.get<{ extraction?: { notes_rendered_text?: string; notes?: { key_points?: unknown[]; outline?: unknown[] } } }>(`/api/documents/${docId}/extraction`);\r\n    const extraction = response.data.extraction;\r\n    \r\n    // Check if notes exist\r\n    const hasNotes = extraction?.notes_rendered_text || (extraction?.notes?.key_points?.length || 0) > 0;\r\n    \r\n    if (!hasNotes) {\r\n      // Hide notes tab if no notes\r\n      if (notesTab) notesTab.style.display = 'none';\r\n      return;\r\n    }\r\n    \r\n    // Show notes tab\r\n    if (notesTab) notesTab.style.display = '';\r\n    \r\n    // Render notes\r\n    const notesText = extraction?.notes_rendered_text || '';\r\n    const notes = extraction?.notes;\r\n    \r\n    if (notesText) {\r\n      // Render with rich formatting\r\n      notesContainer.innerHTML = `\r\n        <style>\r\n          .notes-rendered {\r\n            padding: 20px;\r\n            background: var(--bg-secondary);\r\n            border-radius: 12px;\r\n            line-height: 1.7;\r\n          }\r\n          .notes-header {\r\n            font-size: 18px;\r\n            font-weight: 600;\r\n            margin-bottom: 4px;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 8px;\r\n          }\r\n          .notes-meta {\r\n            font-size: 13px;\r\n            color: var(--text-secondary);\r\n            margin-bottom: 20px;\r\n            padding-bottom: 16px;\r\n            border-bottom: 1px solid var(--border-color);\r\n          }\r\n          .notes-topic {\r\n            margin-bottom: 20px;\r\n          }\r\n          .notes-topic-title {\r\n            font-size: 15px;\r\n            font-weight: 600;\r\n            color: var(--text-primary);\r\n            margin-bottom: 10px;\r\n            padding-left: 8px;\r\n            border-left: 3px solid var(--primary);\r\n          }\r\n          .notes-bullet {\r\n            padding: 10px 12px;\r\n            background: var(--bg-primary);\r\n            border-radius: 8px;\r\n            margin-bottom: 8px;\r\n            font-size: 14px;\r\n            color: var(--text-primary);\r\n            line-height: 1.6;\r\n          }\r\n          .notes-bullet:last-child {\r\n            margin-bottom: 0;\r\n          }\r\n          .notes-actions {\r\n            margin-top: 20px;\r\n            padding-top: 16px;\r\n            border-top: 1px solid var(--border-color);\r\n            display: flex;\r\n            gap: 8px;\r\n          }\r\n        </style>\r\n        <div class=\"notes-rendered\">\r\n          ${renderNotesAsHtml(notesText)}\r\n          <div class=\"notes-actions\">\r\n            <button class=\"btn btn-secondary btn-sm\" id=\"copy-notes-btn\">\r\n              üìã Copy Notes\r\n            </button>\r\n          </div>\r\n        </div>\r\n      `;\r\n      \r\n      // Add copy handler\r\n      container.querySelector('#copy-notes-btn')?.addEventListener('click', () => {\r\n        navigator.clipboard.writeText(notesText);\r\n        toast.success('Notes copied to clipboard');\r\n      });\r\n    } else if (notes) {\r\n      // Fallback: render from structured notes\r\n      const keyPoints = (notes.key_points as Array<{ text: string }>)?.map(kp => `‚Ä¢ ${kp.text}`).join('\\n') || '';\r\n      const outline = (notes.outline as Array<{ topic: string; bullets: Array<{ text: string }> }>)?.map(\r\n        o => `**${o.topic}**\\n${o.bullets?.map(b => `  ‚Ä¢ ${b.text}`).join('\\n') || ''}`\r\n      ).join('\\n\\n') || '';\r\n      \r\n      notesContainer.innerHTML = `\r\n        <div class=\"notes-structured\">\r\n          ${keyPoints ? `<div class=\"notes-section\"><h4>Key Points</h4><pre style=\"white-space: pre-wrap;\">${escapeHtml(keyPoints)}</pre></div>` : ''}\r\n          ${outline ? `<div class=\"notes-section\"><h4>Outline</h4><pre style=\"white-space: pre-wrap;\">${escapeHtml(outline)}</pre></div>` : ''}\r\n        </div>\r\n      `;\r\n    }\r\n  } catch {\r\n    notesContainer.innerHTML = '<div class=\"empty-section\">Meeting notes not available</div>';\r\n    if (notesTab) notesTab.style.display = 'none';\r\n  }\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Render notes_rendered_text as styled HTML\r\n * Parses the text format:\r\n * - üìù GodMode Notes (header)\r\n * - üïû Started at... (meta)\r\n * - Topic Name (topic titles - lines without leading -)\r\n * - - Bullet text (bullets - lines starting with -)\r\n */\r\nfunction renderNotesAsHtml(text: string): string {\r\n  const lines = text.split('\\n');\r\n  let html = '';\r\n  let currentTopic = '';\r\n  let bulletsHtml = '';\r\n  let headerDone = false;\r\n  let metaDone = false;\r\n  \r\n  const flushTopic = () => {\r\n    if (currentTopic && bulletsHtml) {\r\n      html += `\r\n        <div class=\"notes-topic\">\r\n          <div class=\"notes-topic-title\">${escapeHtml(currentTopic)}</div>\r\n          ${bulletsHtml}\r\n        </div>\r\n      `;\r\n    }\r\n    currentTopic = '';\r\n    bulletsHtml = '';\r\n  };\r\n  \r\n  for (const line of lines) {\r\n    const trimmed = line.trim();\r\n    if (!trimmed) continue;\r\n    \r\n    // Header line (üìù GodMode Notes)\r\n    if (!headerDone && trimmed.startsWith('üìù')) {\r\n      html += `<div class=\"notes-header\">${escapeHtml(trimmed)}</div>`;\r\n      headerDone = true;\r\n      continue;\r\n    }\r\n    \r\n    // Meta line (üïû Started at...)\r\n    if (!metaDone && trimmed.startsWith('üïû')) {\r\n      html += `<div class=\"notes-meta\">${escapeHtml(trimmed)}</div>`;\r\n      metaDone = true;\r\n      continue;\r\n    }\r\n    \r\n    // Bullet line (starts with -)\r\n    if (trimmed.startsWith('-')) {\r\n      const bulletText = trimmed.substring(1).trim();\r\n      bulletsHtml += `<div class=\"notes-bullet\">${escapeHtml(bulletText)}</div>`;\r\n      continue;\r\n    }\r\n    \r\n    // Topic title (any other non-empty line)\r\n    flushTopic();\r\n    currentTopic = trimmed;\r\n  }\r\n  \r\n  // Flush last topic\r\n  flushTopic();\r\n  \r\n  // If no structured content found, fallback to pre\r\n  if (!html.includes('notes-topic')) {\r\n    return `<pre style=\"white-space: pre-wrap; font-family: inherit; margin: 0; line-height: 1.6;\">${escapeHtml(text)}</pre>`;\r\n  }\r\n  \r\n  return html;\r\n}\r\n\r\nasync function checkFavoriteStatus(docId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.get<{ is_favorite: boolean }>(`/api/documents/${docId}/favorite`);\r\n    return response.data.is_favorite || false;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction updateFavoriteButton(container: HTMLElement): void {\r\n  const btn = container.querySelector('#favorite-btn') as HTMLButtonElement;\r\n  if (btn) {\r\n    btn.classList.toggle('active', isFavorite);\r\n    btn.innerHTML = isFavorite ? '‚òÖ' : '‚òÜ';\r\n  }\r\n}\r\n\r\nasync function toggleFavorite(container: HTMLElement, doc: Document): Promise<void> {\r\n  try {\r\n    await http.post(`/api/documents/${doc.id}/favorite`);\r\n    isFavorite = !isFavorite;\r\n    updateFavoriteButton(container);\r\n    toast.success(isFavorite ? 'Added to favorites' : 'Removed from favorites');\r\n  } catch {\r\n    toast.error('Failed to update favorite');\r\n  }\r\n}\r\n\r\nfunction downloadDocument(doc: Document): void {\r\n  window.open(`/api/documents/${doc.id}/download`, '_blank');\r\n}\r\n\r\n/**\r\n * Refresh modal content after reprocessing\r\n * Updates counters, summary, content preview and reloads AI Analysis tab\r\n */\r\nasync function refreshModalContent(container: HTMLElement, docId: string): Promise<void> {\r\n  try {\r\n    // 1. Fetch updated document data\r\n    const response = await http.get<Document>(`/api/documents/${docId}`);\r\n    const updatedDoc = response.data;\r\n    \r\n    // 2. Update entity counters\r\n    const entityTypes = ['facts', 'decisions', 'risks', 'actions', 'questions'];\r\n    for (const type of entityTypes) {\r\n      const card = container.querySelector(`[data-entity=\"${type}\"]`);\r\n      if (card) {\r\n        const countEl = card.querySelector('.entity-count');\r\n        if (countEl) {\r\n          const count = (updatedDoc as any)[`${type}_count`] || 0;\r\n          countEl.textContent = String(count);\r\n          \r\n          // Add highlight animation\r\n          card.classList.add('updated');\r\n          setTimeout(() => card.classList.remove('updated'), 1500);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // 3. Update summary\r\n    const summaryCard = container.querySelector('#summary-card') as HTMLElement;\r\n    const summaryEl = container.querySelector('#doc-summary');\r\n    if (summaryCard && summaryEl) {\r\n      if (updatedDoc.summary) {\r\n        summaryCard.style.display = '';\r\n        summaryEl.textContent = updatedDoc.summary;\r\n      } else {\r\n        summaryCard.style.display = 'none';\r\n      }\r\n    }\r\n    \r\n    // 4. Update content preview\r\n    const contentPreview = container.querySelector('#content-preview');\r\n    if (contentPreview && updatedDoc.content) {\r\n      const truncated = updatedDoc.content.length > 5000;\r\n      contentPreview.innerHTML = escapeHtml(updatedDoc.content.substring(0, 5000)) + \r\n        (truncated ? '\\n\\n... (truncated)' : '');\r\n    }\r\n    \r\n    // 5. Update status badge in header\r\n    const statusBadge = container.querySelector('.status-chip');\r\n    if (statusBadge) {\r\n      statusBadge.className = `status-chip ${updatedDoc.status}`;\r\n      statusBadge.textContent = capitalizeFirst(updatedDoc.status);\r\n    }\r\n    \r\n    // 6. Reload AI Analysis tab\r\n    loadAnalysisHistory(container, docId);\r\n    \r\n    // 7. Reload Activity tab\r\n    loadActivity(container, docId);\r\n    \r\n    console.log('[Modal] Refreshed content for document:', docId);\r\n  } catch (err) {\r\n    console.error('[Modal] Failed to refresh content:', err);\r\n  }\r\n}\r\n\r\nasync function reprocessDocument(doc: Document, onUpdate?: () => void): Promise<void> {\r\n  const reprocessBtn = document.querySelector('#reprocess-btn') as HTMLButtonElement;\r\n  const modalContainer = document.querySelector('.document-preview-modal') as HTMLElement;\r\n  const originalBtnContent = reprocessBtn?.innerHTML || '';\r\n  \r\n  try {\r\n    // Step 1: Check hash and existing entities\r\n    if (reprocessBtn) {\r\n      reprocessBtn.disabled = true;\r\n      reprocessBtn.innerHTML = `<span class=\"spinner\"></span> Checking...`;\r\n    }\r\n    \r\n    const checkResponse = await http.get<{\r\n      hash_match: boolean;\r\n      existing_entities: Record<string, number>;\r\n      total_entities: number;\r\n      current_hash: string;\r\n      has_content: boolean;\r\n    }>(`/api/documents/${doc.id}/reprocess/check`);\r\n    \r\n    const check = checkResponse.data;\r\n    \r\n    if (!check.has_content) {\r\n      toast.error('No content available for reprocessing');\r\n      return;\r\n    }\r\n    \r\n    // Step 2: Confirm if hash matches or has existing entities\r\n    let shouldProceed = true;\r\n    \r\n    if (check.hash_match || check.total_entities > 0) {\r\n      const hashMsg = check.hash_match ? 'Content has not changed since last processing.\\n' : '';\r\n      const entitiesMsg = check.total_entities > 0 \r\n        ? `There are ${check.total_entities} extracted entities that will be replaced.\\n` \r\n        : '';\r\n      \r\n      shouldProceed = confirm(\r\n        `${hashMsg}${entitiesMsg}\\nAre you sure you want to reprocess?\\n\\nThis will:\\n- Remove all existing entities from this document\\n- Create new entities with AI analysis\\n- Use AI tokens`\r\n      );\r\n    }\r\n    \r\n    if (!shouldProceed) {\r\n      toast.info('Reprocessing cancelled');\r\n      return;\r\n    }\r\n    \r\n    // Step 3: Start reprocessing with progress feedback\r\n    if (reprocessBtn) {\r\n      reprocessBtn.innerHTML = `<span class=\"spinner\"></span> Processing...`;\r\n    }\r\n    toast.info('Reprocessing started...');\r\n    \r\n    await http.post(`/api/documents/${doc.id}/reprocess`, { force: true });\r\n    \r\n    // Step 4: Poll for completion\r\n    let attempts = 0;\r\n    const maxAttempts = 60; // 2 minutes max\r\n    \r\n    const pollStatus = async () => {\r\n      attempts++;\r\n      \r\n      try {\r\n        const statusResponse = await http.get<{ status: string }>(`/api/documents/${doc.id}`);\r\n        const status = statusResponse.data.status;\r\n        \r\n        if (status === 'processed') {\r\n          toast.success('Document reprocessed successfully!');\r\n          // Refresh modal content with updated data\r\n          if (modalContainer) {\r\n            await refreshModalContent(modalContainer, doc.id);\r\n          }\r\n          onUpdate?.();\r\n          return true;\r\n        } else if (status === 'failed') {\r\n          toast.error('Reprocessing failed');\r\n          return true;\r\n        } else if (attempts >= maxAttempts) {\r\n          toast.warning('Reprocessing still in progress. Check back later.');\r\n          return true;\r\n        }\r\n        \r\n        // Update button with progress\r\n        if (reprocessBtn) {\r\n          reprocessBtn.innerHTML = `<span class=\"spinner\"></span> Processing... (${attempts}s)`;\r\n        }\r\n        \r\n        return false;\r\n      } catch {\r\n        return attempts >= maxAttempts;\r\n      }\r\n    };\r\n    \r\n    // Poll every 2 seconds (track interval for cleanup)\r\n    activeReprocessInterval = setInterval(async () => {\r\n      const done = await pollStatus();\r\n      if (done) {\r\n        if (activeReprocessInterval) {\r\n          clearInterval(activeReprocessInterval);\r\n          activeReprocessInterval = null;\r\n        }\r\n        if (reprocessBtn) {\r\n          reprocessBtn.disabled = false;\r\n          reprocessBtn.innerHTML = originalBtnContent;\r\n        }\r\n      }\r\n    }, 2000);\r\n    \r\n  } catch (err) {\r\n    console.error('[Reprocess] Error:', err);\r\n    toast.error('Failed to reprocess document');\r\n  } finally {\r\n    if (reprocessBtn) {\r\n      reprocessBtn.disabled = false;\r\n      reprocessBtn.innerHTML = originalBtnContent;\r\n    }\r\n  }\r\n}\r\n\r\nasync function uploadNewVersion(doc: Document, container: HTMLElement, onUpdate?: () => void): Promise<void> {\r\n  const input = document.createElement('input');\r\n  input.type = 'file';\r\n  input.accept = '.pdf,.doc,.docx,.txt,.md';\r\n  \r\n  input.onchange = async () => {\r\n    const file = input.files?.[0];\r\n    if (!file) return;\r\n    \r\n    const notes = prompt('Change notes (optional):');\r\n    \r\n    const formData = new FormData();\r\n    formData.append('file', file);\r\n    if (notes) formData.append('change_notes', notes);\r\n    \r\n    try {\r\n      toast.info('Uploading new version...');\r\n      await fetch(`/api/documents/${doc.id}/versions`, {\r\n        method: 'POST',\r\n        body: formData,\r\n        credentials: 'include'\r\n      });\r\n      toast.success('New version uploaded');\r\n      loadVersions(container, doc.id);\r\n      onUpdate?.();\r\n    } catch {\r\n      toast.error('Failed to upload new version');\r\n    }\r\n  };\r\n  \r\n  input.click();\r\n}\r\n\r\nasync function generateShareLink(container: HTMLElement, doc: Document): Promise<void> {\r\n  const expires = (container.querySelector('#share-expires') as HTMLSelectElement).value;\r\n  const maxViews = (container.querySelector('#share-max-views') as HTMLInputElement).value;\r\n  const password = (container.querySelector('#share-password') as HTMLInputElement).value;\r\n  const permissions = (container.querySelector('#share-permissions') as HTMLSelectElement).value;\r\n  \r\n  try {\r\n    const response = await http.post<{ url: string; token: string }>(`/api/documents/${doc.id}/share`, {\r\n      expires,\r\n      max_views: maxViews ? parseInt(maxViews) : null,\r\n      password: password || null,\r\n      permissions: [permissions === 'download' ? 'view' : permissions, ...(permissions === 'download' ? ['download'] : [])]\r\n    });\r\n    \r\n    const input = container.querySelector('#share-link-input') as HTMLInputElement;\r\n    input.value = response.data.url;\r\n    \r\n    (container.querySelector('#generate-link-btn') as HTMLElement).style.display = 'none';\r\n    (container.querySelector('#copy-link-btn') as HTMLElement).style.display = 'block';\r\n    \r\n    toast.success('Share link generated');\r\n  } catch {\r\n    toast.error('Failed to generate share link');\r\n  }\r\n}\r\n\r\nfunction copyShareLink(container: HTMLElement): void {\r\n  const input = container.querySelector('#share-link-input') as HTMLInputElement;\r\n  navigator.clipboard.writeText(input.value);\r\n  toast.success('Link copied to clipboard');\r\n}\r\n\r\nfunction getDocIcon(filename: string): string {\r\n  const ext = filename.split('.').pop()?.toLowerCase();\r\n  switch (ext) {\r\n    case 'pdf': return 'üìÑ';\r\n    case 'doc':\r\n    case 'docx': return 'üìù';\r\n    case 'xls':\r\n    case 'xlsx': return 'üìä';\r\n    case 'ppt':\r\n    case 'pptx': return 'üìΩÔ∏è';\r\n    case 'txt':\r\n    case 'md': return 'üìÉ';\r\n    case 'jpg':\r\n    case 'jpeg':\r\n    case 'png':\r\n    case 'gif': return 'üñºÔ∏è';\r\n    default: return 'üìÅ';\r\n  }\r\n}\r\n\r\nfunction getActionText(action: string): string {\r\n  const actions: Record<string, string> = {\r\n    created: 'uploaded this document',\r\n    viewed: 'viewed this document',\r\n    downloaded: 'downloaded this document',\r\n    updated: 'updated this document',\r\n    version_uploaded: 'uploaded a new version',\r\n    analyzed: 'ran AI analysis',\r\n    reprocessed: 'reprocessed this document',\r\n    shared: 'shared this document',\r\n    unshared: 'removed share link',\r\n    deleted: 'deleted this document',\r\n    restored: 'restored this document',\r\n    tagged: 'added tags',\r\n    favorited: 'added to favorites',\r\n    unfavorited: 'removed from favorites',\r\n    commented: 'commented on this document'\r\n  };\r\n  return actions[action] || action;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n}\r\n\r\nfunction capitalizeFirst(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n"],"names":["isFavorite","activeReprocessInterval","showDocumentPreviewModal","props","doc","content","getDocIcon","escapeHtml","formatFileSize","formatRelativeTime","tag","tab","tabName","switchTab","toggleFavorite","downloadDocument","reprocessDocument","uploadNewVersion","generateShareLink","copyShareLink","loadContentPreview","loadEntities","loadAnalysisHistory","loadVersions","loadActivity","loadMeetingNotes","checkFavoriteStatus","fav","updateFavoriteButton","overlay","modalContainer","closeBtn","closePreviewModal","e","handleEscape","onClose","container","t","s","docId","contentEl","response","http","truncated","err","listEl","entitiesTab","entitiesCount","extraction","entities","facts","decisions","actions","questions","risks","totalItems","html","f","d","a","q","r","analyses","runAnalysisBtn","btn","originalText","toast","i","capitalizeFirst","formatDateTime","idx","analysis","showAnalysisDetail","fullResult","docResponse","resultJson","summary","versions","v","timelineEl","activities","getInitials","getActionText","notesContainer","notesTab","notesText","notes","renderNotesAsHtml","keyPoints","kp","outline","o","b","text","div","lines","currentTopic","bulletsHtml","headerDone","metaDone","flushTopic","line","trimmed","bulletText","refreshModalContent","updatedDoc","entityTypes","type","card","countEl","count","summaryCard","summaryEl","contentPreview","statusBadge","onUpdate","reprocessBtn","originalBtnContent","check","shouldProceed","hashMsg","entitiesMsg","attempts","maxAttempts","pollStatus","status","input","file","formData","expires","maxViews","password","permissions","filename","action","name","n","str"],"mappings":"gHAwDA,IAAIA,EAAa,GACbC,EAAiE,KAK9D,SAASC,EAAyBC,EAAmC,CAC1E,KAAM,CAAE,SAAUC,CAAA,EAAQD,EAEpBE,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,yBACpBA,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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"}