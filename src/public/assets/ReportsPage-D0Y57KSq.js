import{r as h,j as e}from"./vendor-react-CZ-WyKWZ.js";import{m as w,t as c}from"./vendor-ui-BS9QKitv.js";import{eV as k,eW as R,a7 as p,ai as S,L as m,R as C,aX as L,T as E,G as O,H as P}from"./main-B3DZn5B_.js";import{E as G}from"./ErrorState-to3SSPKs.js";import{s as U}from"./sanitize-BByI7rMw.js";import{S as g}from"./sparkles-D3iJUPqd.js";import{T as u}from"./trending-up-CGQOSwHs.js";import"./vendor-supabase-Bpw_79gH.js";import"./vendor-query-DSf7I7Ei.js";import"./vendor-router-D_XeKoA_.js";import"./vendor-markdown-Cu8AM8lU.js";function W({label:o,value:d,icon:n}){return e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(n,{className:"w-4 h-4 text-[hsl(var(--primary))]"}),e.jsx("span",{className:"text-xs text-[hsl(var(--muted-foreground))]",children:o})]}),e.jsx("p",{className:"text-lg font-bold text-[hsl(var(--foreground))]",children:d})]})}const B=()=>{const[o,d]=h.useState(""),n=k(o||void 0),{data:v,isLoading:b,refetch:x}=n,a=R(),[f,j]=h.useState({}),s=v?.report,i=async(r=!1)=>{try{await a.mutateAsync({week:o||void 0,regenerate:r}),c.success(r?"Report regenerated":"Report generated"),x()}catch{c.error("Failed to generate report")}},N=r=>{j(t=>({...t,[r]:!t[r]}))},y=()=>{if(!s)return;const r=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=URL.createObjectURL(r),l=document.createElement("a");l.href=t,l.download=`weekly-report-${s.period||"current"}.json`,l.click(),URL.revokeObjectURL(t),c.success("Report exported")};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-[hsl(var(--foreground))] flex items-center gap-2",children:[e.jsx(p,{className:"w-6 h-6 text-[hsl(var(--primary))]"})," Weekly Reports"]}),e.jsx("p",{className:"text-sm text-[hsl(var(--muted-foreground))]",children:"AI-generated weekly status reports with highlights, risks, and KPIs"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 text-[hsl(var(--muted-foreground))]"}),e.jsx("input",{type:"week",value:o,onChange:r=>d(r.target.value),className:"bg-[hsl(var(--background))] border border-[hsl(var(--border))] rounded-lg px-3 py-1.5 text-sm text-[hsl(var(--foreground))]"})]}),e.jsxs("button",{onClick:()=>i(!1),disabled:a.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-[hsl(var(--primary))] text-[hsl(var(--primary-foreground))] text-sm font-medium hover:opacity-90 transition-opacity disabled:opacity-50",children:[a.isPending?e.jsx(m,{className:"w-4 h-4 animate-spin"}):e.jsx(g,{className:"w-4 h-4"}),"Generate"]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>i(!0),disabled:a.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-[hsl(var(--border))] text-sm text-[hsl(var(--muted-foreground))] hover:bg-[hsl(var(--secondary))] transition-colors disabled:opacity-50",children:[e.jsx(C,{className:"w-4 h-4"})," Regenerate"]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-[hsl(var(--border))] text-sm text-[hsl(var(--muted-foreground))] hover:bg-[hsl(var(--secondary))] transition-colors",children:[e.jsx(L,{className:"w-4 h-4"})," Export"]})]})]})]}),n.error?e.jsx(G,{message:"Failed to load report.",onRetry:()=>x()}):b?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(m,{className:"w-8 h-8 animate-spin text-[hsl(var(--primary))]"})}):s?e.jsxs(w.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-[hsl(var(--muted-foreground))]",children:[e.jsxs("span",{children:["Period: ",e.jsx("strong",{className:"text-[hsl(var(--foreground))]",children:s.period})]}),s.generated_at&&e.jsxs("span",{children:["Generated: ",new Date(s.generated_at).toLocaleString()]})]}),e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-[hsl(var(--foreground))] mb-3",children:"Summary"}),e.jsx("p",{className:"text-sm text-[hsl(var(--muted-foreground))] whitespace-pre-line leading-relaxed",children:s.summary||"No summary available."})]}),s.kpis&&Object.keys(s.kpis).length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-[hsl(var(--foreground))] mb-3 uppercase tracking-wider",children:"Key Metrics"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(s.kpis).map(([r,t])=>e.jsx(W,{label:r.replace(/_/g," "),value:String(t),icon:u},r))})]}),s.highlights&&s.highlights.length>0&&e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-[hsl(var(--foreground))] mb-3 flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-green-500"})," Highlights"]}),e.jsx("ul",{className:"space-y-2",children:s.highlights.map((r,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-[hsl(var(--muted-foreground))]",children:[e.jsx("span",{className:"text-green-500 mt-0.5",children:"•"})," ",r]},t))})]}),s.risks&&s.risks.length>0&&e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-[hsl(var(--foreground))] mb-3 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-amber-500"})," Risks & Concerns"]}),e.jsx("ul",{className:"space-y-2",children:s.risks.map((r,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-[hsl(var(--muted-foreground))]",children:[e.jsx("span",{className:"text-amber-500 mt-0.5",children:"•"})," ",r]},t))})]}),s.sections&&Object.keys(s.sections).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-[hsl(var(--foreground))] uppercase tracking-wider",children:"Detailed Sections"}),Object.entries(s.sections).map(([r,t])=>{const l=f[r]??!1;return e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>N(r),className:"w-full flex items-center justify-between px-5 py-3 hover:bg-[hsl(var(--secondary))] transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-[hsl(var(--foreground))]",children:r.replace(/_/g," ")}),l?e.jsx(O,{className:"w-4 h-4 text-[hsl(var(--muted-foreground))]"}):e.jsx(P,{className:"w-4 h-4 text-[hsl(var(--muted-foreground))]"})]}),l&&e.jsx("div",{className:"px-5 pb-4 text-sm text-[hsl(var(--muted-foreground))] whitespace-pre-line leading-relaxed border-t border-[hsl(var(--border))]",children:typeof t=="string"?t:JSON.stringify(t,null,2)})]},r)})]}),s.html&&e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-[hsl(var(--foreground))] mb-3",children:"Formatted Report"}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:U(s.html)}})]})]}):e.jsxs("div",{className:"text-center py-20 space-y-4",children:[e.jsx(p,{className:"w-12 h-12 mx-auto text-[hsl(var(--muted-foreground))] opacity-40"}),e.jsx("p",{className:"text-[hsl(var(--muted-foreground))]",children:"No report for this period yet."}),e.jsxs("button",{onClick:()=>i(!1),disabled:a.isPending,className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-lg bg-[hsl(var(--primary))] text-[hsl(var(--primary-foreground))] text-sm font-medium hover:opacity-90 disabled:opacity-50",children:[a.isPending?e.jsx(m,{className:"w-4 h-4 animate-spin"}):e.jsx(g,{className:"w-4 h-4"}),"Generate Weekly Report"]})]})]})};export{B as default};
//# sourceMappingURL=ReportsPage-D0Y57KSq.js.map
