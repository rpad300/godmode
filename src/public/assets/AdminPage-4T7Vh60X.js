import{c as me,j as e,N as $,T as oe,a as s,r as _,ab as De,U as Ee,P as Ie,bs as ke,cJ as Ve,K as Pe,ae as He,ds as Oe,dt as Qe,du as Je,dv as We,dw as Ye,O as n,a3 as fe,ad as ye,d8 as Ze,dx as Xe,dy as qe,dz as es,d9 as ss,dA as ts,dB as as,dC as rs,J as xe,dD as ns,dE as is,dF as ls,dG as cs,dH as os,cL as ds,cM as xs,ck as ms,cO as ps,cP as us,cN as hs,cR as gs,dI as vs,cT as js,cV as ys,cW as bs,cX as Ns,cU as fs,cY as ws,ci as Ss,dJ as Cs,Z as ue,co as ks,cp as Ps,cs as As,ct as Rs,cy as Es,cv as Ls,cu as _s,cw as Ts,cx as Ms,cG as Ds,cE as Is,cz as Os,cA as $s,cF as Fs,cD as Us,cH as zs,cI as Gs,cB as Bs,cC as Ks,dK as Vs,dL as Hs,dM as Qs,dN as Js,dO as Ws,bF as Ys,bE as Zs,bH as Xs,dP as qs,dQ as et,dR as st,bm as tt,bn as at,bo as rt,dS as nt,bq as it,bl as lt,br as ct,dT as ot,dU as dt,dV as xt,dW as mt,dX as pt,dY as ut,dZ as ht,d_ as gt,d$ as vt,e0 as jt,e1 as yt,e2 as bt,e3 as Nt,e4 as ft,a2 as Ce,e5 as wt,e6 as St,e7 as Ct,b8 as kt,b9 as Pt,e8 as At,e9 as Rt,ea as Et,eb as Lt,ec as _t}from"./main-DPJZnN-g.js";import{K as Tt}from"./key-DrUrK2UH.js";import{C as Mt}from"./cpu-BXdDwRd1.js";import{L as Dt}from"./list-DzBFMrVB.js";import{L as $e}from"./layers-mGPxOuwI.js";import{P as be}from"./plus-D_qMNj9L.js";import{E as Fe}from"./eye-Bsxv-RpG.js";import{R as ve}from"./rotate-cw-CScwxFr9.js";import{C as he}from"./circle-check-big-B1jdWUHQ.js";import{S as ie}from"./save-BmzQhvxt.js";import{P as It}from"./play-DFwYGH3G.js";import{H as Ot}from"./history-DfLE_9c9.js";import{P as $t}from"./pen-line-C8f7gizJ.js";import{L as Ft}from"./link-2-BbBFDDRu.js";import{F as Ut}from"./file-braces-AIP1E2es.js";import{U as zt}from"./upload-C1xl8nMH.js";import{E as Gt}from"./eye-off-ZKPPec-D.js";import{D as Bt}from"./database-WjgGBTAO.js";const Kt=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ae=me("ban",Kt);const Vt=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Ht=me("credit-card",Vt);const Qt=[["path",{d:"M9 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v.5",key:"1dkoa9"}],["path",{d:"M12 10v4h4",key:"1czhmt"}],["path",{d:"m12 14 1.535-1.605a5 5 0 0 1 8 1.5",key:"lvuxfi"}],["path",{d:"M22 22v-4h-4",key:"1ewp4q"}],["path",{d:"m22 18-1.535 1.605a5 5 0 0 1-8-1.5",key:"14ync0"}]],Ue=me("folder-sync",Qt);const Jt=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],Le=me("folder-tree",Jt);const Wt=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],ze=me("gauge",Wt);const Yt=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Zt=me("pause",Yt);const Xt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Ge=me("terminal",Xt),ne=t=>({width:t,height:t,viewBox:"0 0 24 24"});function qt({size:t=20,...m}){return e.jsx("svg",{...ne(t),fill:"none",xmlns:"http://www.w3.org/2000/svg",...m,children:e.jsx("path",{d:"M22.28 9.37a5.93 5.93 0 0 0-.51-4.89A6.01 6.01 0 0 0 15.3 1.5a5.97 5.97 0 0 0-4.52 2.07A5.93 5.93 0 0 0 6.82 2.2a6.01 6.01 0 0 0-4.01 2.92 5.97 5.97 0 0 0 .74 7.01 5.93 5.93 0 0 0 .51 4.89A6.01 6.01 0 0 0 10.53 20a5.98 5.98 0 0 0 .69 2.5 6.01 6.01 0 0 0 6.47 2.98 5.97 5.97 0 0 0 4.52-2.07 5.93 5.93 0 0 0 3.96 1.37 6.01 6.01 0 0 0 4.01-2.92 5.97 5.97 0 0 0-.74-7.01",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",transform:"scale(0.75) translate(4, 4)"})})}function _e({size:t=20,...m}){return e.jsx("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...m,children:e.jsx("path",{d:"M13.83 3h-3.16L5 21h3.16l1.41-4.51h5.36L16.34 21h3.16L13.83 3Zm-3.16 10.96L12.25 8.6l1.58 5.36h-3.16Z"})})}function Se({size:t=20,...m}){return e.jsx("svg",{...ne(t),fill:"none",xmlns:"http://www.w3.org/2000/svg",...m,children:e.jsx("path",{d:"M21.81 10.26H12.18v3.72h5.51a4.77 4.77 0 0 1-2.05 3.08 6.14 6.14 0 0 1-3.46.96 6.36 6.36 0 0 1-6-4.14 6.29 6.29 0 0 1 0-3.76 6.36 6.36 0 0 1 6-4.14c1.56 0 2.97.56 4.08 1.49l2.79-2.79A10.53 10.53 0 0 0 12.18 2a10.26 10.26 0 0 0-9.19 5.66 10.06 10.06 0 0 0 0 8.68A10.26 10.26 0 0 0 12.18 22c5.2 0 9.87-3.46 9.87-10.26 0-.65-.08-1.31-.24-1.48Z",fill:"currentColor"})})}function ea({size:t=20,...m}){return e.jsxs("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...m,children:[e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),e.jsx("text",{x:"12",y:"16",textAnchor:"middle",fontSize:"10",fontWeight:"bold",fill:"currentColor",children:"G"})]})}function sa({size:t=20,...m}){return e.jsx("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...m,children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 2c1.85 0 3.55.63 4.9 1.69L7.69 16.9A7.96 7.96 0 0 1 4 12c0-4.42 3.58-8 8-8zm0 16c-1.85 0-3.55-.63-4.9-1.69L16.31 7.1A7.96 7.96 0 0 1 20 12c0 4.42-3.58 8-8 8z"})})}function ta({size:t=20,...m}){return e.jsxs("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...m,children:[e.jsx("path",{d:"M12 3a7 7 0 0 0-7 7v3.5c0 1.93 1.57 3.5 3.5 3.5h1a1.5 1.5 0 0 0 0-3H8.5a.5.5 0 0 1-.5-.5V10a4 4 0 0 1 8 0v3.5a.5.5 0 0 1-.5.5H14.5a1.5 1.5 0 0 0 0 3h1c1.93 0 3.5-1.57 3.5-3.5V10a7 7 0 0 0-7-7z"}),e.jsx("circle",{cx:"9.5",cy:"10.5",r:"1"}),e.jsx("circle",{cx:"14.5",cy:"10.5",r:"1"})]})}function Te({size:t=20,...m}){return e.jsx("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...m,children:e.jsx("path",{d:"M3 3l7.07 10.61L3 21h1.59l6.19-6.47L15.61 21H21l-7.46-11.18L20.1 3h-1.59l-5.76 6.02L8.39 3H3zm2.29 1.25h2.54l10.88 15.5h-2.54L5.29 4.25z"})})}function aa({size:t=20,...m}){return e.jsxs("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...m,children:[e.jsx("rect",{x:"3",y:"8",width:"4",height:"8",rx:"1"}),e.jsx("rect",{x:"10",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"17",y:"8",width:"4",height:"8",rx:"1"})]})}function ra({size:t=20,...m}){return e.jsx("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...m,children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14.5v-9l7 4.5-7 4.5z"})})}function na({size:t=20,...m}){return e.jsxs("svg",{...ne(t),fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",xmlns:"http://www.w3.org/2000/svg",...m,children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"3"}),e.jsx("path",{d:"M9 9h6M9 12h6M9 15h4"})]})}const Be={openai:"#10a37f",anthropic:"#d97757",claude:"#d97757",google:"#4285f4",gemini:"#4285f4",google_gemini:"#4285f4",groq:"#f55036",deepseek:"#4d6bfe",ollama:"#ffffff",grok:"#1d9bf0",xai:"#1d9bf0",minimax:"#6c5ce7",kimi:"#615eff"},ia={openai:qt,anthropic:_e,claude:_e,google:Se,gemini:Se,google_gemini:Se,groq:ea,deepseek:sa,ollama:ta,grok:Te,xai:Te,minimax:aa,kimi:ra};function je({provider:t,size:m=20,className:g}){const D=(t||"").toLowerCase().replace(/[\s-]/g,"_"),j=ia[D]||na,w=Be[D]||"currentColor";return e.jsx(j,{size:m,className:g,style:{color:w}})}function la(t){const m=(t||"").toLowerCase().replace(/[\s-]/g,"_");return Be[m]||"var(--gm-accent-primary)"}const v="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",U="bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] transition-all duration-150",V="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",z="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",Me="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50",R="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",F="text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider";function se(){return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx($,{className:"h-6 w-6 animate-spin text-[var(--gm-accent-primary)]"})})}function Re({msg:t}){return e.jsxs("div",{className:s(v,"p-10 text-center flex flex-col items-center gap-3"),children:[e.jsx(oe,{className:"w-5 h-5 text-[var(--color-warning-500)]"}),e.jsx("span",{className:"text-sm text-[var(--gm-text-secondary)]",children:t})]})}function re({msg:t}){return e.jsx("div",{className:s(v,"p-10 text-center text-[var(--gm-text-tertiary)] text-sm"),children:t})}function te({title:t,subtitle:m}){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:t}),m&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5",children:m})]})}function Z({label:t,value:m,color:g}){return e.jsxs("div",{className:s(v,"p-4 text-center"),children:[e.jsx("div",{className:"text-2xl font-bold tabular-nums",style:g?{color:g}:void 0,children:m}),e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mt-1",children:t})]})}function Ne({checked:t,onChange:m,disabled:g}){return e.jsx("button",{onClick:()=>!g&&m(!t),disabled:g,className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer rounded-full border border-[var(--gm-border-primary)] transition-colors duration-200 disabled:opacity-50",style:{backgroundColor:t?"var(--color-brand-500)":"var(--gm-bg-tertiary)"},children:e.jsx("span",{className:s("pointer-events-none inline-block h-4 w-4 rounded-full bg-white shadow-sm transition-transform duration-200",t?"translate-x-4":"translate-x-0")})})}const L=t=>t??{},ca=[{key:"users",label:"Users",icon:Ee},{key:"system",label:"System",icon:Ie},{key:"llm-providers",label:"LLM Providers",icon:Tt},{key:"model-metadata",label:"Model Metadata",icon:Mt},{key:"llm-queue",label:"LLM Queue",icon:Dt},{key:"graph",label:"Graph",icon:ke},{key:"ontology",label:"Ontology",icon:$e},{key:"prompts",label:"Prompts",icon:Ge},{key:"processing",label:"Processing",icon:Ve},{key:"team-analysis",label:"Team Analysis",icon:Ee},{key:"google-drive",label:"Google Drive",icon:Ue},{key:"billing",label:"Billing",icon:Ht},{key:"audit-log",label:"Audit Log",icon:Pe}];function oa(){const{data:t}=Oe(),m=t,g=[];return m&&(typeof m.disk=="number"&&m.disk>75&&g.push({msg:`Disk usage at ${m.disk.toFixed(1)}% — consider cleanup of old embeddings`,severity:"warning"}),typeof m.cpu=="number"&&m.cpu>90&&g.push({msg:`CPU usage critical at ${m.cpu.toFixed(1)}%`,severity:"danger"}),typeof m.ram=="number"&&m.ram>85&&g.push({msg:`RAM usage high at ${m.ram.toFixed(1)}%`,severity:"warning"}),typeof m.latency=="number"&&m.latency>200&&g.push({msg:`High latency: ${m.latency.toFixed(0)}ms`,severity:"warning"})),g.length===0?null:e.jsx("div",{className:"space-y-1.5 mb-4",children:g.map((D,j)=>e.jsxs("div",{className:s("flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-medium",D.severity==="danger"?"bg-red-500/10 text-red-400":D.severity==="warning"?"bg-amber-500/10 text-amber-400":"bg-blue-500/10 text-blue-400"),children:[e.jsx(oe,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"flex-1",children:D.msg})]},j))})}function da(){const{data:t,isLoading:m,error:g}=Qe(),D=Je(),j=We(),w=Ye(),[b,P]=_.useState(!1),[T,y]=_.useState(""),[S,N]=_.useState("all"),[C,p]=_.useState({email:"",name:"",password:"",role:"user"}),[A,c]=_.useState(null),M=L(t),r=M.users??[],i=L(M.stats),u=_.useMemo(()=>r.filter(o=>{if(S!=="all"&&o.role!==S)return!1;if(T){const O=T.toLowerCase();if(!o.name?.toLowerCase().includes(O)&&!o.email?.toLowerCase().includes(O))return!1}return!0}),[r,S,T]),f=_.useCallback(()=>{if(!C.email){n.error("Email is required");return}D.mutate(C,{onSuccess:()=>{n.success("User created"),P(!1),p({email:"",name:"",password:"",role:"user"})},onError:o=>n.error(o.message)})},[C,D]);return m?e.jsx(se,{}):g?e.jsx(Re,{msg:"Unable to load users."}):e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"User Management"}),i.totalUsers!=null&&e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsx(Z,{label:"Total Users",value:i.totalUsers}),e.jsx(Z,{label:"Active",value:i.activeUsers,color:"var(--color-success-500)"}),e.jsx(Z,{label:"Pending",value:i.pendingInvitations,color:"var(--color-warning-500)"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[e.jsx(fe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{placeholder:"Search users...",value:T,onChange:o=>y(o.target.value),className:s(U,"flex-1")})]}),e.jsxs("select",{value:S,onChange:o=>N(o.target.value),className:s(U,"w-32"),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"Superadmin"})]}),e.jsxs("button",{onClick:()=>P(!b),className:V,children:[e.jsx(be,{className:"w-3 h-3"})," Add User"]})]}),b&&e.jsxs("div",{className:s(v,"p-4 space-y-3"),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{placeholder:"Email",value:C.email,onChange:o=>p(O=>({...O,email:o.target.value})),className:U}),e.jsx("input",{placeholder:"Display Name",value:C.name,onChange:o=>p(O=>({...O,name:o.target.value})),className:U}),e.jsx("input",{placeholder:"Password",type:"password",value:C.password,onChange:o=>p(O=>({...O,password:o.target.value})),className:U}),e.jsxs("select",{value:C.role,onChange:o=>p(O=>({...O,role:o.target.value})),className:U,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"Superadmin"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:f,disabled:D.isPending,className:V,children:[D.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(be,{className:"w-3 h-3"})," Create"]}),e.jsx("button",{onClick:()=>P(!1),className:z,children:"Cancel"})]})]}),e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["USER","EMAIL","ROLE","STATUS","LAST LOGIN","ACTIONS"].map(o=>e.jsx("th",{className:s(F,"px-4 py-3 text-left"),children:o},o))})}),e.jsx("tbody",{children:u.map(o=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[var(--gm-interactive-primary)]/15 text-[var(--gm-accent-primary)] font-bold flex items-center justify-center shrink-0 text-xs",children:(o.name||o.email||"?").substring(0,2).toUpperCase()}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:o.name||"—"})]})}),e.jsx("td",{className:"px-4 py-3 text-xs text-[var(--gm-text-tertiary)]",children:o.email}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:o.role,onChange:O=>j.mutate({id:o.id,role:O.target.value},{onSuccess:()=>n.success("Role updated"),onError:Y=>n.error(Y.message)}),className:s("text-[10px] px-2 py-0.5 rounded-full font-medium border-0",o.role==="superadmin"?"bg-red-500/20 text-red-400":o.role==="admin"?"bg-blue-500/20 text-blue-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]"),children:[e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"superadmin",children:"superadmin"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",o.status==="active"?"bg-green-500/15 text-green-400":o.status==="banned"?"bg-red-500/15 text-red-400":"bg-amber-500/15 text-amber-400"),children:o.status})}),e.jsx("td",{className:"px-4 py-3 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o.lastActive?new Date(o.lastActive).toLocaleString():"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>j.mutate({id:o.id,status:o.status==="banned"?"active":"banned"},{onSuccess:()=>n.success(o.status==="banned"?"User unbanned":"User banned"),onError:O=>n.error(O.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:o.status==="banned"?"Unban":"Ban",children:o.status==="banned"?e.jsx(Fe,{className:"w-3.5 h-3.5 text-green-400"}):e.jsx(Ae,{className:"w-3.5 h-3.5 text-amber-400"})}),A===o.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w.mutate(o.id,{onSuccess:()=>{n.success("User deleted"),c(null)},onError:O=>n.error(O.message)}),className:"px-2 py-0.5 rounded bg-red-500 text-white text-[10px]",children:"Confirm"}),e.jsx("button",{onClick:()=>c(null),className:"px-2 py-0.5 rounded text-[10px] text-[var(--gm-text-tertiary)]",children:"Cancel"})]}):e.jsx("button",{onClick:()=>c(o.id),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-3.5 h-3.5 text-red-400"})})]})})]},o.id))})]}),u.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No users found."})]}),e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] text-center",children:["Showing ",u.length," of ",r.length," users"]})]})}function xa(){const{data:t,isLoading:m,error:g,refetch:D}=Oe(),j=t;if(m)return e.jsx(se,{});if(g||!j)return e.jsx(Re,{msg:"Unable to load system stats."});const w=j.server||{},b=j.memory||{},P=j.process||{},T=j.database||"unknown",y=p=>{const A=Math.floor(p/86400),c=Math.floor(p%86400/3600),M=Math.floor(p%3600/60);return[A&&`${A}d`,c&&`${c}h`,`${M}m`].filter(Boolean).join(" ")},S=p=>p>=1024?`${(p/1024).toFixed(1)} GB`:`${p} MB`,N=(p,A,c)=>p>c?"#ef4444":p>A?"#f59e0b":"#22c55e",C=[{label:"CPU",val:j.cpu,unit:"%",color:N(j.cpu,60,80)},{label:"RAM",val:j.ram,unit:"%",color:N(j.ram,60,80)},{label:"Disk",val:j.disk,unit:"%",color:N(j.disk,70,90)},{label:"Event Loop",val:j.latency,unit:"ms",color:N(j.latency,50,200)}];return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{title:"System Health",subtitle:j.timestamp?`Last updated: ${new Date(j.timestamp).toLocaleString()}`:"Real-time system monitoring"}),e.jsxs("button",{onClick:()=>D(),className:z,children:[e.jsx(ve,{className:"w-3 h-3"})," Refresh"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:C.map(p=>e.jsxs("div",{className:s(v,"p-4 text-center"),children:[e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:p.label}),e.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-2",children:[e.jsxs("svg",{viewBox:"0 0 36 36",className:"w-full h-full -rotate-90",children:[e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:"var(--gm-bg-tertiary)",strokeWidth:"3"}),e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:p.color,strokeWidth:"3",strokeDasharray:`${Math.min((typeof p.val=="number"?p.val:0)/(p.unit==="ms"?500:100)*97.4,97.4)} 97.4`,strokeLinecap:"round",className:"transition-all duration-700"})]}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:typeof p.val=="number"?p.unit==="ms"?p.val:p.val.toFixed(0):p.val})]}),e.jsx("div",{className:"text-[9px] font-medium tabular-nums",style:{color:p.color},children:p.unit})]},p.label))}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(v,"p-4 space-y-2.5"),children:[e.jsx("h3",{className:R,children:"Server"}),[["Node",String(w.nodeVersion||"—")],["Platform",`${w.platform||"—"} / ${w.arch||"—"}`],["Hostname",String(j.hostname||"—")],["PID",String(w.pid||"—")],["Uptime",typeof w.uptime=="number"?y(w.uptime):"—"],["CPU Cores",String(j.cpuCores||"—")]].map(([p,A])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:p}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono tabular-nums",children:A})]},p))]}),e.jsxs("div",{className:s(v,"p-4 space-y-2.5"),children:[e.jsx("h3",{className:R,children:"Runtime"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Database"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",T==="connected"?"bg-green-500/10 text-green-400":T==="error"?"bg-red-500/10 text-red-400":"bg-amber-500/10 text-amber-400"),children:T})]}),[["Heap Used",`${P.heapUsedMB||0} MB`],["Heap Total",`${P.heapTotalMB||0} MB`],["Heap %",`${P.heapPercent||0}%`],["RSS",`${P.rssMB||0} MB`],["System RAM",b.totalMB?`${S(b.usedMB||0)} / ${S(b.totalMB)}`:"—"]].map(([p,A])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:p}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono tabular-nums",children:A})]},p)),P.heapPercent>0&&e.jsx("div",{className:"h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${P.heapPercent}%`,backgroundColor:N(P.heapPercent,60,85)}})})]})]}),j.storageBreakdown&&j.storageBreakdown.length>0&&e.jsxs("div",{className:s(v,"p-5"),children:[e.jsx("h3",{className:s(R,"mb-4"),children:"Storage"}),e.jsx("div",{className:"space-y-4",children:j.storageBreakdown.map((p,A)=>{const c=Number(p.size||0),M=Number(p.free||0),r=c-M,i=c>0?Math.round(r/c*100):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:String(p.category)}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums font-mono",children:[S(r)," / ",S(c)," (",i,"%)"]})]}),e.jsx("div",{className:"h-2.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${i}%`,backgroundColor:N(i,70,90)}})}),e.jsx("div",{className:"flex justify-between mt-1",children:e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:[S(M)," free"]})})]},A)})})]})]})}function ma(){const{data:t,isLoading:m}=Ze(),{data:g}=Xe(),{data:D,isLoading:j}=qe(),w=es(),b=ss(),[P,T]=_.useState({}),[y,S]=_.useState({}),[N,C]=_.useState({}),p=L(t),A=L(p.llm),c=L(A.providers),M=L(A.perTask);L(g).providers;const i=L(D),u=i.providers??[],f=_.useCallback(k=>u.find(E=>E.id===k||E.aliases&&E.aliases.includes(k)),[u]),o=_.useMemo(()=>{const k=new Set,E=Object.entries(c).map(([a,x])=>{const I=f(a),l=I?.id||a;return k.add(l),k.add(a),{id:l,name:I?.name||x.name||a,apiKeyMasked:I?.masked||x.apiKeyMasked||null,isConfigured:I?.configured||!!x.isConfigured,keySource:I?.source||null}});return u.forEach(a=>{k.has(a.id)||(k.add(a.id),E.push({id:a.id,name:a.name||(a.id||"unknown").charAt(0).toUpperCase()+(a.id||"unknown").slice(1),apiKeyMasked:a.masked,isConfigured:a.configured,keySource:a.source}))}),E},[c,u,f]),O=_.useCallback(()=>{const k=Object.entries(y).filter(([,x])=>x.trim().length>0);if(k.length===0){n.info("No changes to save");return}let E=0;const a=k.length;for(const[x,I]of k)w.mutate({provider:x,apiKey:I},{onSuccess:()=>{E++,E===a&&(n.success(`${a} API key${a>1?"s":""} saved to encrypted vault`),S({}))},onError:l=>n.error(`Failed to save ${x}: ${l.message}`)})},[y,w]),Y=_.useCallback(()=>{if(Object.keys(N).length===0){n.info("No changes to save");return}b.mutate({llm:{perTask:N}},{onSuccess:()=>{n.success("LLM configuration saved"),C({})},onError:k=>n.error(k.message)})},[N,b]);if(m||j)return e.jsx(se,{});const G=Object.values(y).some(k=>k.trim().length>0);return e.jsxs("div",{className:"space-y-8",children:[e.jsx(te,{title:"LLM Providers",subtitle:"System-level API keys stored encrypted in Supabase vault"}),e.jsxs("div",{className:s(v,"p-4 border-l-2 border-[var(--gm-accent-primary)]"),children:[e.jsx("h4",{className:"text-xs font-semibold text-[var(--gm-accent-primary)] mb-2",children:"Key Resolution & Billing"}),e.jsxs("div",{className:"text-[11px] text-[var(--gm-text-secondary)] space-y-1",children:[e.jsxs("p",{children:["The LLM service resolves API keys in this order: ",e.jsx("strong",{children:"Project key"})," (Supabase secrets, project scope) then ",e.jsx("strong",{children:"System key"})," (Supabase secrets, system scope) then ",e.jsx("strong",{children:"Config file"})," (fallback)."]}),e.jsxs("p",{children:["When a project uses its ",e.jsx("strong",{children:"own API key"})," (BYOK), billing is ",e.jsx("span",{className:"text-green-400 font-medium",children:"skipped"})," — the project pays the provider directly."]}),e.jsxs("p",{children:["When using ",e.jsx("strong",{children:"system keys"}),", the project balance is ",e.jsx("span",{className:"text-amber-400 font-medium",children:"debited"})," with the configured markup."]})]})]}),e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:R,children:"System LLM API Keys"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[o.filter(k=>k.isConfigured).length,"/",o.length," configured"]})]}),o.map(k=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:k.name||"(unnamed)"}),k.isConfigured?e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"})," Configured"]}):e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"}),k.keySource&&e.jsxs("span",{className:s("text-[10px] px-1.5 py-0.5 rounded",k.keySource==="system"?"bg-blue-500/20 text-blue-300":"bg-purple-500/20 text-purple-300"),children:[k.keySource," scope"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:P[k.id]?"text":"password",value:y[k.id]??"",onChange:E=>S(a=>({...a,[k.id]:E.target.value})),placeholder:k.apiKeyMasked||`Enter ${k.name} API key...`,className:s(U,"flex-1 font-mono text-xs")}),e.jsx("button",{onClick:()=>T(E=>({...E,[k.id]:!E[k.id]})),className:z,children:P[k.id]?"Hide":"Show"})]}),k.apiKeyMasked&&!y[k.id]&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono pl-1",children:["Current: ",k.apiKeyMasked]})]},k.id)),e.jsxs("button",{onClick:O,disabled:w.isPending||!G,className:V,children:[w.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"})," Save to Encrypted Vault"]})]}),e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsx("h3",{className:R,children:"Service API Keys"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Keys for email, notifications and other services (stored encrypted in Supabase)"}),(()=>{const k=i.services??[],E={resend:{link:"https://resend.com/api-keys"},brave:{link:"https://brave.com/search/api/"}};return k.length>0?k.map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:a.name||"(unnamed)"}),a.configured?e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"})," Configured"]}):e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:P[a.id]?"text":"password",value:y[a.id]??"",onChange:x=>S(I=>({...I,[a.id]:x.target.value})),placeholder:a.masked||`Enter ${a.name} key...`,className:s(U,"flex-1 font-mono text-xs")}),e.jsx("button",{onClick:()=>T(x=>({...x,[a.id]:!x[a.id]})),className:z,children:P[a.id]?"Hide":"Show"}),e.jsxs("button",{onClick:()=>{const x=y[a.id]?.trim();if(!x){n.info("Enter a key first");return}w.mutate({provider:a.id,apiKey:x},{onSuccess:()=>{n.success(`${a.name} key saved`),S(I=>{const l={...I};return delete l[a.id],l})},onError:I=>n.error(I.message)})},disabled:w.isPending||!y[a.id]?.trim(),className:V,children:[e.jsx(ie,{className:"w-3 h-3"})," Save"]})]}),a.masked&&!y[a.id]&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono pl-1",children:["Current: ",a.masked]}),E[a.id]?.link&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Get key at ",e.jsx("a",{href:E[a.id].link,target:"_blank",rel:"noreferrer",className:"text-[var(--gm-accent-primary)] underline",children:E[a.id].link})]})]},a.id)):["resend","brave"].map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:a==="resend"?"Resend (Email)":"Brave Search"}),e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:y[a]??"",onChange:x=>S(I=>({...I,[a]:x.target.value})),placeholder:`Enter ${a} API key...`,className:s(U,"flex-1 font-mono text-xs")}),e.jsxs("button",{onClick:()=>{const x=y[a]?.trim();x&&w.mutate({provider:a,apiKey:x},{onSuccess:()=>{n.success(`${a} key saved`),S(I=>{const l={...I};return delete l[a],l})},onError:I=>n.error(I.message)})},disabled:w.isPending||!y[a]?.trim(),className:V,children:[e.jsx(ie,{className:"w-3 h-3"})," Save"]})]})]},a))})()]}),e.jsxs("div",{className:s(v,"p-5 space-y-5"),children:[e.jsxs("div",{children:[e.jsx("h3",{className:R,children:"Task-Specific AI Configuration"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-1",children:"Configure which provider and model to use for each AI task. These settings apply globally to the platform."})]}),Object.entries(M).map(([k,E])=>{const a=k.replace(/_/g," ").replace(/([A-Z])/g," $1");return e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)] capitalize",children:a}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"PROVIDER"}),e.jsxs("select",{value:N[k]?.provider??E?.provider??"",onChange:x=>C(I=>({...I,[k]:{provider:x.target.value,model:I[k]?.model??E?.model??""}})),className:s(U,"w-full text-xs"),children:[e.jsx("option",{value:"",children:"Select..."}),o.filter(x=>x.isConfigured).map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-accent-primary)] mt-0.5 block",children:[o.filter(x=>x.isConfigured).length," provider(s) available"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"MODEL"}),e.jsx("input",{value:N[k]?.model??E?.model??"",onChange:x=>C(I=>({...I,[k]:{provider:I[k]?.provider??E?.provider??"",model:x.target.value}})),className:s(U,"w-full text-xs"),placeholder:"e.g. gpt-4o"})]})]})]},k)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Y,disabled:b.isPending||Object.keys(N).length===0,className:V,children:[b.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"})," Save LLM Configuration"]}),e.jsxs("span",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Changes apply immediately to all AI processing"]})]})]})]})}function pa(){const{data:t,isLoading:m,refetch:g}=ts(),{data:D,refetch:j}=as(),w=rs(),[b,P]=_.useState("all"),[T,y]=_.useState("all"),[S,N]=_.useState("");if(m)return e.jsx(se,{});const p=L(t).models??[],A=L(D).providers??[],c=L(w.data),M=p.map(a=>({...a,_type:a.model_type||"text",_provider:a.provider||"unknown"})),r=M.reduce((a,x)=>(a[x._provider]||(a[x._provider]=[]),a[x._provider].push(x),a),{}),i=Object.keys(r).sort(),u=i.length,f=a=>{const x=Number(a);return!x||isNaN(x)?"—":x>=1e6?`${(x/1e6).toFixed(1)}M`:x>=1e3?`${Math.round(x/1e3)}K`:String(x)},o=a=>{const x=Number(a);return!x||isNaN(x)?"—":`$${x.toFixed(2)}`},O=M.filter(a=>{if(b!=="all"&&a._provider!==b||T!=="all"&&a._type!==T)return!1;if(S){const x=S.toLowerCase(),I=String(a.display_name||a.model_id||"").toLowerCase(),l=String(a.model_id||"").toLowerCase();if(!I.includes(x)&&!l.includes(x))return!1}return!0}),Y=O.filter(a=>a._type==="text"),G=O.filter(a=>a._type==="embedding"),k=async()=>{try{const a=await w.mutateAsync();await g(),await j();const x=L(a);n.success(`Models synced — ${x.totalSynced??0} updated across all providers`)}catch(a){n.error(a.message||"Sync failed")}},E=M.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"Model Metadata",subtitle:E?`${M.length} models across ${u} provider(s)`:"No models synced yet — click Sync to populate"}),e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:R,children:"Provider Sync"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Fetches models from each provider API and persists to the database."})]}),e.jsxs("button",{onClick:k,disabled:w.isPending,className:V,children:[w.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(xe,{className:"w-3.5 h-3.5"}),w.isPending?"Syncing...":"Sync All Providers"]})]}),c.results&&e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(c.results).map(([a,x])=>e.jsxs("span",{className:s("inline-flex items-center gap-1.5 text-[10px] px-2.5 py-1 rounded-lg font-medium border",x.status==="success"?"bg-green-500/10 border-green-500/30 text-green-400":x.status==="skipped"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-red-500/10 border-red-500/30 text-red-400"),children:[e.jsx(je,{provider:a,size:12}),e.jsx("span",{className:"font-semibold",children:a}),x.status==="success"&&e.jsxs(e.Fragment,{children:[" — ",x.synced," synced"]}),x.status==="skipped"&&e.jsxs(e.Fragment,{children:[" — ",x.reason]}),x.status==="error"&&e.jsx(e.Fragment,{children:" — error"})]},a))}),(A.length>0||i.length>0)&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:(A.length>0?A:i.map(a=>({provider:a}))).map((a,x)=>{const I=a.provider||"",l=a.active_models??a.activeModels??r[I]?.length??0,B=a.last_synced,J=b===I;return e.jsxs("button",{onClick:()=>P(J?"all":I),className:s("flex items-center gap-2.5 px-3 py-2.5 rounded-lg border transition-all text-left","bg-[var(--gm-bg-secondary)] border-[var(--gm-border-primary)] hover:border-[var(--gm-border-secondary)]",J&&"ring-1 ring-[var(--gm-accent-primary)]/50 border-[var(--gm-accent-primary)]/40"),children:[e.jsx(je,{provider:I,size:18}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-[11px] font-semibold text-[var(--gm-text-primary)] truncate capitalize",children:I}),e.jsxs("div",{className:"text-[10px] tabular-nums",style:{color:la(I)},children:[l," models"]}),B&&e.jsx("div",{className:"text-[8px] text-[var(--gm-text-tertiary)] truncate",children:new Date(B).toLocaleDateString()})]})]},x)})})]}),e.jsxs("div",{className:s(v,"p-3 flex items-center gap-3 flex-wrap"),children:[e.jsxs("select",{value:b,onChange:a=>P(a.target.value),className:s(U,"w-auto max-w-[180px]"),children:[e.jsx("option",{value:"all",children:"All Providers"}),i.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{value:T,onChange:a=>y(a.target.value),className:s(U,"w-auto max-w-[140px]"),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"embedding",children:"Embedding"})]}),e.jsx("input",{value:S,onChange:a=>N(a.target.value),placeholder:"Search models...",className:s(U,"w-auto max-w-[220px]")}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] ml-auto tabular-nums",children:[O.length," of ",M.length]})]}),Y.length>0&&e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:R,children:"Text & Vision Models"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[Y.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Model","Provider","Type","Context","$/1M In","$/1M Out"].map(a=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:a},a))})}),e.jsx("tbody",{children:Y.map((a,x)=>{const I=a.display_name||"",l=a.model_id||"—",B=a._provider,J=!!a.supports_vision;return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[I&&e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:I}),e.jsx("div",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)]",children:l})]}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(je,{provider:B,size:14}),e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] capitalize",children:B})]})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)]",children:"text"}),J&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-purple-500/15 text-purple-400",children:"vision"})]})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-primary)] tabular-nums font-semibold",children:f(a.context_tokens)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_input)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_output)})]},x)})})]})})]}),G.length>0&&e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:R,children:"Embedding Models"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[G.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Model","Provider","Context","$/1M In"].map(a=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:a},a))})}),e.jsx("tbody",{children:G.map((a,x)=>{const I=a.display_name||"",l=a.model_id||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[I&&e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:I}),e.jsx("div",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)]",children:l})]}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(je,{provider:a.provider||"",size:14}),e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] capitalize",children:a.provider||""})]})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-primary)] tabular-nums font-semibold",children:f(a.context_tokens)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_input)})]},x)})})]})})]}),!E&&e.jsx(re,{msg:"No models in database yet. Click 'Sync All Providers' to fetch from APIs."}),E&&O.length===0&&e.jsx(re,{msg:"No models match the current filters."})]})}function ua(){const{data:t,isLoading:m,refetch:g}=ns(),{data:D}=is(),{data:j}=ls(),{data:w}=cs(),b=os(),[P,T]=_.useState(null);if(m)return e.jsx(se,{});const y=L(t),S=L(y.stats),N=L(y.database),C=L(D).items??y.pendingItems??[],p=L(j).items??[],A=L(w).items??L(w).history??[],c=N.totalCostTodayUsd??S.totalCost??S.costToday,M=()=>{confirm("Clear all pending items from the queue? This cannot be undone.")&&b.mutate({action:"clear"},{onSuccess:()=>{n.success("Queue cleared"),g()},onError:r=>n.error(r.message)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"LLM Processing Queue",subtitle:"Monitor and control AI request processing — All requests are persisted in database"}),e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Queue Status"}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[y.database!=null&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-semibold bg-green-500/15 text-green-400",children:"DB: Connected"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",y.isPaused?"bg-amber-500/15 text-amber-400":y.isProcessing?"bg-blue-500/15 text-blue-400":"bg-green-500/15 text-green-400"),children:y.isPaused?"PAUSED":y.isProcessing?"PROCESSING":"IDLE"}),e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] tabular-nums",children:["Queue: ",y.queueLength??0]}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:["Processing: ",y.isProcessing?1:0]}),e.jsxs("button",{onClick:()=>g(),className:z,children:[e.jsx(xe,{className:"w-3 h-3"})," Refresh"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>b.mutate({action:"pause"},{onSuccess:()=>{n.success("Queue paused"),g()},onError:r=>n.error(r.message)}),disabled:b.isPending,className:Me,children:[e.jsx(Zt,{className:"w-3 h-3"})," Pause"]}),e.jsxs("button",{onClick:()=>b.mutate({action:"resume"},{onSuccess:()=>{n.success("Queue resumed"),g()},onError:r=>n.error(r.message)}),disabled:b.isPending,className:V,children:[e.jsx(It,{className:"w-3 h-3"})," Resume"]}),e.jsx("button",{onClick:M,disabled:b.isPending,className:z,children:"Clear Queue"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-7 gap-3",children:[e.jsx(Z,{label:"Pending",value:N.pendingCount??y.queueLength??C.length??0}),e.jsx(Z,{label:"Processing",value:N.processingCount??(y.isProcessing?1:0)}),e.jsx(Z,{label:"Completed",value:N.completedToday??S.successful??S.completed??0,color:"var(--color-brand-500)"}),e.jsx(Z,{label:"Failed",value:N.failedToday??S.failed??0,color:"var(--color-danger-500)"}),e.jsx(Z,{label:"Retry Pending",value:N.retryPendingCount??p.length}),e.jsx(Z,{label:"Avg Time (ms)",value:N.avgProcessingTimeMs??S.avgProcessingTime?Number(N.avgProcessingTimeMs??S.avgProcessingTime).toLocaleString():"0"}),e.jsx(Z,{label:"Cost Today",value:c!=null?`$${Number(c).toFixed(4)}`:"$0",color:"var(--color-brand-500)"})]}),y.currentRequest&&e.jsxs("div",{className:s(v,"p-4"),children:[e.jsx("h3",{className:s(R,"mb-2"),children:"Currently Processing"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-4 h-4 animate-spin text-blue-400 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-[var(--gm-text-primary)]",children:y.currentRequest.context||y.currentRequest.id}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[y.currentRequest.priority&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Priority: ",y.currentRequest.priority]}),y.currentRequest.startedAt&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Started: ",new Date(y.currentRequest.startedAt).toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:s(v,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:R,children:"Pending Items"}),e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] tabular-nums",children:[C.length," items"]})]}),C.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No items in queue"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Priority"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Queued"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Action"})]})}),e.jsx("tbody",{children:C.slice(0,20).map((r,i)=>e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[300px]",children:r.context||r.type||r.task||r.id||"Unknown"}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:s("text-[10px] px-1.5 py-0.5 rounded font-medium",r.priority==="high"?"bg-amber-500/15 text-amber-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"),children:r.priority||"normal"})}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:r.queuedAt?new Date(r.queuedAt).toLocaleTimeString():"—"}),e.jsx("td",{className:"text-right py-1.5 px-2",children:e.jsx("button",{onClick:()=>b.mutate({action:"cancel",id:r.id},{onSuccess:()=>{n.success("Cancelled"),g()}}),className:"text-[10px] text-red-400 hover:underline",children:"Cancel"})})]},i))})]})]}),e.jsxs("div",{className:s(v,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:R,children:"Failed Items"}),p.length>0&&e.jsxs("button",{onClick:()=>b.mutate({action:"retry-all"},{onSuccess:()=>{n.success("Retrying all"),g()}}),disabled:b.isPending,className:Me,children:[e.jsx(ve,{className:"w-3 h-3"})," Retry All"]})]}),p.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No failed items"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Provider"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Attempts"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Error"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Actions"})]})}),e.jsx("tbody",{children:p.slice(0,20).map((r,i)=>e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[200px]",children:r.context||r.type||"Unknown"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:r.provider||"—"}),e.jsxs("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 tabular-nums",children:[r.attempts??r.attemptCount??"?","/",r.maxAttempts??r.maxRetries??"3"]}),e.jsx("td",{className:"text-[10px] text-red-400 py-1.5 px-2 truncate max-w-[200px]",children:r.error||r.errorMessage||"Error"}),e.jsxs("td",{className:"text-right py-1.5 px-2 whitespace-nowrap",children:[e.jsx("button",{onClick:()=>b.mutate({action:"retry",id:r.id},{onSuccess:()=>{n.success("Retrying"),g()}}),className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline mr-2",children:"Retry"}),e.jsx("button",{onClick:()=>b.mutate({action:"retry",id:r.id+"?reset=true"},{onSuccess:()=>{n.success("Reset & Retrying"),g()}}),className:"text-[10px] text-amber-400 hover:underline",children:"Reset & Retry"})]})]},i))})]})]}),e.jsxs("div",{className:s(v,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:R,children:"Recent Processing History"}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:[A.length," items"]})]}),A.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No processing history yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Provider / Model"}),e.jsx("th",{className:s(F,"text-center py-2 px-2"),children:"Status"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Tokens"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Time (ms)"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Completed"}),e.jsx("th",{className:s(F,"text-center py-2 px-2")})]})}),e.jsx("tbody",{children:A.slice(0,50).map((r,i)=>{const u=r.status==="completed"||r.status==="success",f=r.inputTokens||r.tokensIn||0,o=r.outputTokens||r.tokensOut||0;return e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors cursor-pointer",onClick:()=>T(r),children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[200px]",children:r.context||r.type||r.task||r.id||"—"}),e.jsxs("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:[r.provider||"—",r.model?` / ${r.model}`:""]}),e.jsx("td",{className:"text-center py-1.5 px-2",children:e.jsx("span",{className:s("inline-block w-2 h-2 rounded-full",u?"bg-green-400":"bg-red-400")})}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right tabular-nums",children:f>0?`${f}→${o}`:"—"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right tabular-nums",children:r.processingTime??r.durationMs??"—"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right",children:r.completedAt?new Date(r.completedAt).toLocaleTimeString():"—"}),e.jsx("td",{className:"text-center py-1.5 px-2",children:e.jsx("button",{className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline",children:"View"})})]},i)})})]})})]}),P&&e.jsx(ha,{request:P,onClose:()=>T(null)})]})}function ha({request:t,onClose:m}){const g=t.status==="completed"||t.status==="success",D=t.inputTokens||t.tokensIn||0,j=t.outputTokens||t.tokensOut||0,w=t.processingTime||t.durationMs||0,b=t.estimatedCost||t.cost||0,P=T=>{navigator.clipboard.writeText(T),n.success("Copied to clipboard")};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:m,children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm"}),e.jsxs("div",{className:s(v,"relative w-[900px] max-w-[90vw] max-h-[85vh] flex flex-col"),onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:s("w-10 h-10 rounded-lg flex items-center justify-center",g?"bg-green-500/15":"bg-red-500/15"),children:g?e.jsx(he,{className:"w-5 h-5 text-green-400"}):e.jsx(oe,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:"LLM Request Details"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono",children:t.id||"—"})]})]}),e.jsx("button",{onClick:m,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-5",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Context:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.context||t.type||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Provider:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.provider||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Model:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.model||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Status:"})," ",e.jsx("span",{className:s("font-semibold ml-1",g?"text-green-400":"text-red-400"),children:t.status||"—"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx(Z,{label:"Input Tokens",value:D.toLocaleString()}),e.jsx(Z,{label:"Output Tokens",value:j.toLocaleString()}),e.jsx(Z,{label:"Duration (ms)",value:Number(w).toLocaleString()}),e.jsx(Z,{label:"Est. Cost",value:b?`$${Number(b).toFixed(6)}`:"—"})]}),e.jsxs("div",{className:s(v,"p-4"),children:[e.jsx("h4",{className:s(R,"mb-2"),children:"Timeline"}),e.jsxs("div",{className:"flex flex-wrap gap-6 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Queued:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.queuedAt?new Date(t.queuedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Started:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.startedAt?new Date(t.startedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Completed:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.completedAt?new Date(t.completedAt).toLocaleString():"—"})]})]})]}),(t.error||t.errorMessage)&&e.jsxs("div",{className:"rounded-lg border border-red-500/30 bg-red-500/5 p-4",children:[e.jsxs("h4",{className:"text-xs font-bold text-red-400 mb-1 flex items-center gap-1.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Error"]}),e.jsx("p",{className:"text-[10px] text-red-300 font-mono whitespace-pre-wrap",children:t.error||t.errorMessage}),t.attempts&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-2",children:["Attempt ",t.attempts,"/",t.maxAttempts||t.maxRetries||3]})]}),(t.prompt||t.input)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:R,children:"Prompt / Input"}),e.jsx("button",{onClick:()=>P(String(t.prompt||t.input)),className:z,children:"Copy"})]}),e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:String(t.prompt||t.input)})]}),(t.response||t.output||t.result)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:R,children:"Response / Output"}),e.jsx("button",{onClick:()=>P(String(t.response||t.output||t.result)),className:z,children:"Copy"})]}),e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:String(t.response||t.output||t.result)})]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer text-[10px] text-[var(--gm-accent-primary)] hover:underline",children:"Show Raw JSON Data"}),e.jsx("pre",{className:"mt-2 text-[10px] text-[var(--gm-text-tertiary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:JSON.stringify(t,null,2)})]})]})]})]})}function ga(){const{data:t,isLoading:m}=ds(),{data:g,refetch:D}=xs(),{data:j}=ms(),{data:w}=ps(),{data:b}=us(),{data:P}=hs();gs();const T=vs(),y=js(),S=ys(),N=bs(),C=Ns(),p=fs(),A=ws(),c=Ss(),M=Cs(),[r,i]=_.useState("status"),[u,f]=_.useState(""),[o,O]=_.useState(null);if(m)return e.jsx(se,{});const Y=L(t),G=L(Y.config),k=L(g),E=L(j),a=L(w).graphs??[],x=L(b),I=L(P).providers??[],l=k.nodeCount??k.nodes??0,B=k.edgeCount??k.relationships??0,J=!!k.connected,q=L(E.metrics??E),ee=E.recommendations??[];return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Knowledge Graph",subtitle:`${G.provider||"—"} · ${J?`${l} nodes · ${B} edges`:"Not connected"}`}),e.jsx("div",{className:s(v,"p-1 flex gap-1"),children:["status","operations","graphs","query"].map(h=>e.jsx("button",{onClick:()=>i(h),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",r===h?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:h==="status"?"Status & Config":h==="operations"?"Sync & Maintenance":h==="graphs"?`Graphs (${a.length})`:"Query"},h))}),r==="status"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(v,"p-4 space-y-3"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:R,children:"Connection"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",J?"bg-green-500/15 text-green-400":"bg-red-500/15 text-red-400"),children:J?"Connected":"Disconnected"})]}),[["Provider",G.provider],["Graph Name",G.graphName],["Enabled",G.enabled?"Yes":"No"],["Auto Connect",G.autoConnect?"Yes":"No"],["Config Source",Y.source]].map(([h,K])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:h}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono",children:String(K??"—")})]},h)),k.message&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:k.message}),e.jsxs("button",{onClick:()=>D(),className:s(z,"w-full justify-center"),children:[e.jsx(ve,{className:"w-3 h-3"})," Refresh Status"]})]}),e.jsxs("div",{className:s(v,"p-4 space-y-3"),children:[e.jsx("h3",{className:R,children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(Z,{label:"Nodes",value:l,color:"var(--gm-accent-primary)"}),e.jsx(Z,{label:"Edges",value:B,color:"var(--gm-accent-primary)"})]}),(()=>{const h=L(k.stats);return Object.keys(h).length>0?e.jsx("div",{className:"space-y-1.5",children:Object.entries(h).map(([K,Q])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:K}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] tabular-nums",children:String(Q)})]},K))}):null})()]})]}),(Object.keys(q).length>0||ee.length>0)&&e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Graph Insights"}),Object.keys(q).length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(q).map(([h,K])=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase mb-1",children:h.replace(/([A-Z])/g," $1").replace(/_/g," ")}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:typeof K=="number"?K<1?K.toFixed(3):K.toFixed(1):String(K)})]},h))}),ee.length>0&&e.jsxs("div",{className:"space-y-1.5 mt-2",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Recommendations"}),ee.map((h,K)=>e.jsxs("div",{className:"flex items-start gap-2 text-[10px]",children:[e.jsx("span",{className:s("shrink-0 mt-0.5",h.priority==="high"?"text-red-400":h.priority==="medium"?"text-amber-400":"text-blue-400"),children:"●"}),e.jsx("span",{className:"text-[var(--gm-text-secondary)]",children:h.message||h.text||h.description})]},K))]})]}),Object.keys(x).length>0&&x.ok!==void 0&&e.jsxs("div",{className:s(v,"p-4 space-y-2"),children:[e.jsx("h3",{className:R,children:"Sync Status"}),[["Status",x.status??x.syncStatus??"—"],["Last Sync",x.lastSyncAt?new Date(x.lastSyncAt).toLocaleString():"—"],["Pending",x.pending??"—"]].map(([h,K])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:h}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:String(K)})]},h))]}),I.length>0&&e.jsxs("div",{className:s(v,"p-4"),children:[e.jsx("h3",{className:s(R,"mb-2"),children:"Available Providers"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map((h,K)=>e.jsx("span",{className:s("text-[10px] px-2.5 py-1 rounded-lg border font-medium",(h.id||h.name)===G.provider?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:h.name||h.id||"?"},K))})]})]}),r==="operations"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsx("h3",{className:R,children:"Sync"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>T.mutate(void 0,{onSuccess:()=>n.success("Sync complete"),onError:h=>n.error(h.message)}),disabled:T.isPending,className:V,children:[T.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(xe,{className:"w-3.5 h-3.5"})," Quick Sync"]}),e.jsxs("button",{onClick:()=>y.mutate(void 0,{onSuccess:()=>n.success("Full sync complete"),onError:h=>n.error(h.message)}),disabled:y.isPending,className:V,children:[y.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ve,{className:"w-3.5 h-3.5"})," Full Sync"]}),e.jsxs("button",{onClick:()=>M.mutate(void 0,{onSuccess:()=>n.success("All projects synced"),onError:h=>n.error(h.message)}),disabled:M.isPending,className:z,children:[M.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ue,{className:"w-3.5 h-3.5"})," Sync All Projects"]})]})]}),e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsx("h3",{className:R,children:"Indexes & Optimization"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsxs("button",{onClick:()=>S.mutate(void 0,{onSuccess:()=>n.success("Indexes created"),onError:h=>n.error(h.message)}),disabled:S.isPending,className:z,children:[S.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx($e,{className:"w-3.5 h-3.5"})," Create Indexes"]})})]}),e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsx("h3",{className:R,children:"Cleanup"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Remove orphaned graphs, duplicate nodes, and stale relationships"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>N.mutate(void 0,{onSuccess:h=>n.success(`Cleaned ${h?.deleted??"?"} orphans`),onError:h=>n.error(h.message)}),disabled:N.isPending,className:z,children:[N.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ye,{className:"w-3.5 h-3.5"})," Cleanup Orphan Graphs"]}),e.jsxs("button",{onClick:()=>C.mutate(void 0,{onSuccess:()=>n.success("Duplicates cleaned"),onError:h=>n.error(h.message)}),disabled:C.isPending,className:z,children:[C.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ae,{className:"w-3.5 h-3.5"})," Cleanup Duplicates"]}),e.jsxs("button",{onClick:()=>p.mutate(void 0,{onSuccess:()=>n.success("Sync cleanup done"),onError:h=>n.error(h.message)}),disabled:p.isPending,className:z,children:[p.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ye,{className:"w-3.5 h-3.5"})," Sync Cleanup"]})]})]})]}),r==="graphs"&&e.jsx("div",{className:"space-y-5",children:a.length>0?e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:R,children:"All Graphs"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Graph","Project","Nodes","Edges","Status",""].map(h=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:h},h))})}),e.jsx("tbody",{children:a.map((h,K)=>{const Q=h.name||h.graphName||"—",ae=Q===G.graphName;return e.jsxs("tr",{className:s("border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",ae&&"bg-[var(--gm-accent-primary)]/5"),children:[e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:Q}),ae&&e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded-full bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)] font-bold",children:"ACTIVE"})]})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)]",children:h.projectName||h.projectId||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-primary)] tabular-nums",children:h.nodeCount??h.nodes??"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-primary)] tabular-nums",children:h.edgeCount??h.edges??"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-1.5 py-0.5 rounded-full font-medium",h.orphan?"bg-amber-500/10 text-amber-400":"bg-green-500/10 text-green-400"),children:h.orphan?"Orphan":"Active"})}),e.jsx("td",{className:"px-4 py-2.5",children:!ae&&e.jsx("button",{onClick:()=>{confirm(`Delete graph "${Q}"?`)&&A.mutate(Q,{onSuccess:()=>n.success(`Deleted ${Q}`),onError:W=>n.error(W.message)})},disabled:A.isPending,className:"text-[9px] text-red-400 hover:underline font-medium",children:"Delete"})})]},K)})})]})})]}):e.jsx(re,{msg:"No graphs found. Connect to a graph provider first."})}),r==="query"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Cypher Query"}),e.jsx("textarea",{value:u,onChange:h=>f(h.target.value),placeholder:"MATCH (n) RETURN n LIMIT 10",rows:4,className:s(U,"w-full font-mono text-xs resize-y")}),e.jsxs("button",{onClick:()=>c.mutate({query:u},{onSuccess:h=>{O(h),n.success("Query executed")},onError:h=>n.error(h.message)}),disabled:c.isPending||!u.trim(),className:V,children:[c.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"})," Execute"]})]}),o&&e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Result"}),(()=>{const h=L(o),K=h.nodes??[],Q=h.edges??h.relationships??[],ae=h.rows??h.data??[];return e.jsxs("div",{className:"space-y-3",children:[K.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:["Nodes (",K.length,")"]}),e.jsx("div",{className:"mt-1 max-h-48 overflow-y-auto",children:K.slice(0,50).map((W,le)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-accent-primary)] font-medium",children:W.label||W.labels?.[0]||W.type||"?"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] truncate flex-1",children:W.name||W.title||W.id||JSON.stringify(W.properties||W).substring(0,80)})]},le))})]}),Q.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:["Relationships (",Q.length,")"]}),e.jsx("div",{className:"mt-1 max-h-48 overflow-y-auto",children:Q.slice(0,50).map((W,le)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:W.source||W.from||"?"}),e.jsxs("span",{className:"text-[var(--gm-accent-primary)] font-medium",children:["→ ",W.type||W.label||"?"," →"]}),e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:W.target||W.to||"?"})]},le))})]}),ae.length>0&&K.length===0&&Q.length===0&&e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] font-mono bg-[var(--gm-bg-tertiary)] p-3 rounded-lg overflow-auto max-h-64",children:JSON.stringify(ae,null,2)}),K.length===0&&Q.length===0&&ae.length===0&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No results returned."})]})})()]})]})]})}function va(){const{data:t,isLoading:m}=ks(),{data:g}=Ps(),{data:D}=As(),{data:j}=Rs(),{data:w}=Es(),{data:b}=Ls(),P=_s(),T=Ts(),y=Ms(),S=Ds(),N=Is(),C=Os(),p=$s(),A=Fs(),c=Us(),M=zs(),r=Gs(),i=Bs(),u=Ks(),[f,o]=_.useState("schema"),[O,Y]=_.useState(""),[G,k]=_.useState("");if(m)return e.jsx(se,{});const E=L(t),a=E.entityTypes??E.entities??[],x=E.relationTypes??E.relations??[],I=L(g),l=L(I.stats),B=Object.values(l).reduce((d,H)=>d+(typeof H=="number"?H:0),0),J=["#38bdf8","#34d399","#fbbf24","#818cf8","#f472b6","#94a3b8","#fb923c","#a78bfa"],q=L(D).suggestions??[],ee=L(j),h=L(w),K=L(b).changes??[],Q=L(P.data),ae=L(T.data),W=L(y.data),le=q.filter(d=>d.status==="pending"||!d.status);return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Ontology",subtitle:`${a.length} entity types · ${x.length} relation types · ${B} instances`}),e.jsx("div",{className:s(v,"p-1 flex gap-1"),children:["schema","analysis","maintenance"].map(d=>e.jsx("button",{onClick:()=>o(d),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",f===d?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:d==="schema"?`Schema (${a.length+x.length})`:d==="analysis"?`Analysis (${le.length} pending)`:"Maintenance"},d))}),f==="schema"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:R,children:"Entity Types"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:O,onChange:d=>Y(d.target.value),placeholder:"New entity type...",className:s(U,"w-40 py-1 text-xs")}),e.jsxs("button",{disabled:!O.trim()||i.isPending,onClick:()=>i.mutate({name:O.trim()},{onSuccess:()=>{n.success(`Entity type "${O}" added`),Y("")},onError:d=>n.error(d.message)}),className:V,children:[i.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(be,{className:"w-3 h-3"})," Add"]})]})]}),a.map((d,H)=>{const X=d.name||d.label||d.type||"Unknown",de=l[X]??d.count??0,ge=Array.isArray(d.properties)?d.properties:[],pe=Array.isArray(d.allowedRelations)?d.allowedRelations.length:d.relationCount??0;return e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0 mr-3",style:{backgroundColor:d.color||J[H%J.length]}}),e.jsx("span",{className:"text-xs font-semibold text-[var(--gm-text-primary)] flex-1",children:X}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums px-2 py-0.5 rounded bg-[var(--gm-bg-tertiary)] mx-1",children:[de," instances"]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums mx-1",children:[ge.length," props"]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums mx-1",children:[pe," rels"]})]}),ge.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1.5 ml-[22px]",children:ge.map((ce,we)=>e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:[ce.name||ce,ce.type?`: ${ce.type}`:""]},we))})]},H)}),a.length===0&&e.jsx(re,{msg:"No entity types defined."})]}),e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:R,children:"Relation Types"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:G,onChange:d=>k(d.target.value),placeholder:"New relation type...",className:s(U,"w-40 py-1 text-xs")}),e.jsxs("button",{disabled:!G.trim()||u.isPending,onClick:()=>u.mutate({name:G.trim()},{onSuccess:()=>{n.success(`Relation type "${G}" added`),k("")},onError:d=>n.error(d.message)}),className:V,children:[u.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(be,{className:"w-3 h-3"})," Add"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Relation","From","To","Instances"].map(d=>e.jsx("th",{className:s(F,"px-4 py-2 text-left"),children:d},d))})}),e.jsx("tbody",{children:x.map((d,H)=>{const X=d.name||d.type||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2 text-xs font-medium text-[var(--gm-text-primary)]",children:X}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)]",children:d.from||d.source||"*"}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)]",children:d.to||d.target||"*"}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:l[X]??d.count??0})]},H)})})]})}),x.length===0&&e.jsx(re,{msg:"No relation types defined."})]})]}),f==="analysis"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(v,"p-4 flex items-center gap-3 flex-wrap"),children:[e.jsxs("button",{onClick:()=>S.mutate(void 0,{onSuccess:()=>n.success("Graph analysis complete"),onError:d=>n.error(d.message)}),disabled:S.isPending,className:V,children:[S.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"}),"Analyze Graph"]}),e.jsxs("button",{onClick:()=>N.mutate(void 0,{onSuccess:()=>n.success("Sync complete"),onError:d=>n.error(d.message)}),disabled:N.isPending,className:z,children:[N.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(xe,{className:"w-3.5 h-3.5"}),"Force Sync"]}),e.jsxs("button",{onClick:()=>r.mutate(void 0,{onSuccess:()=>n.success("Relationship inference complete"),onError:d=>n.error(d.message)}),disabled:r.isPending,className:z,children:[r.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ke,{className:"w-3.5 h-3.5"}),"Infer Relationships"]}),le.length>0&&e.jsxs("button",{onClick:()=>A.mutate({minConfidence:.8},{onSuccess:d=>n.success(`Auto-approved ${d?.approved??"?"} suggestions`),onError:d=>n.error(d.message)}),disabled:A.isPending,className:z,children:[A.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(he,{className:"w-3.5 h-3.5"}),"Auto-Approve (",le.length,")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(v,"p-4 space-y-2"),children:[e.jsx("h3",{className:R,children:"Worker Status"}),[["Running",ee.isRunning?"Yes":"No"],["Last Run",ee.lastRun?new Date(ee.lastRun).toLocaleString():"—"],["Total Runs",String(ee.totalRuns??"—")],["Last Result",String(ee.lastResult??"—")]].map(([d,H])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:d}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:H})]},d)),e.jsx("div",{className:"flex gap-2 pt-1",children:["full_analysis","entity_extraction","relation_inference"].map(d=>e.jsx("button",{onClick:()=>c.mutate({type:d},{onSuccess:()=>n.success(`Worker triggered: ${d}`),onError:H=>n.error(H.message)}),disabled:c.isPending,className:"text-[9px] px-2 py-1 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)] border border-[var(--gm-border-primary)]",children:d.replace(/_/g," ")},d))})]}),e.jsxs("div",{className:s(v,"p-4 space-y-2"),children:[e.jsx("h3",{className:R,children:"Sync Status"}),[["Status",String(h.status??h.syncStatus??"—")],["Last Sync",h.lastSyncAt?new Date(h.lastSyncAt).toLocaleString():"—"],["Entity Count",String(h.entityCount??"—")],["Relation Count",String(h.relationCount??"—")]].map(([d,H])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:d}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:H})]},d))]})]}),q.length>0&&e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsxs("h3",{className:R,children:["AI Suggestions (",le.length," pending)"]})}),e.jsx("div",{className:"max-h-72 overflow-y-auto",children:q.slice(0,30).map((d,H)=>{const X=d.status==="pending"||!d.status;return e.jsxs("div",{className:"flex items-center px-5 py-3 border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:s("text-[9px] px-1.5 py-0.5 rounded-full font-medium border capitalize",d.type==="entity"?"bg-blue-500/10 border-blue-500/30 text-blue-400":"bg-purple-500/10 border-purple-500/30 text-purple-400"),children:d.type||"unknown"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)] truncate",children:d.name||d.label||d.suggestion||"—"}),e.jsx("span",{className:s("text-[9px] px-1.5 py-0.5 rounded-full capitalize",X?"bg-amber-500/10 text-amber-400":d.status==="approved"?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"),children:d.status||"pending"}),d.confidence&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[(Number(d.confidence)*100).toFixed(0),"%"]})]}),d.reason&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate",children:d.reason})]}),X&&e.jsxs("div",{className:"flex gap-1.5 ml-3 shrink-0",children:[e.jsx("button",{onClick:()=>C.mutate({id:d.id},{onSuccess:()=>n.success("Approved"),onError:de=>n.error(de.message)}),className:"text-[9px] px-2 py-1 rounded bg-green-500/10 text-green-400 hover:bg-green-500/20 border border-green-500/30",children:"Approve"}),e.jsx("button",{onClick:()=>p.mutate({id:d.id},{onSuccess:()=>n.success("Rejected"),onError:de=>n.error(de.message)}),className:"text-[9px] px-2 py-1 rounded bg-red-500/10 text-red-400 hover:bg-red-500/20 border border-red-500/30",children:"Reject"})]})]},H)})})]}),q.length===0&&e.jsx(re,{msg:"No suggestions. Run 'Analyze Graph' to generate AI suggestions."}),K.length>0&&e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:R,children:"Change History"})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:K.slice(0,20).map((d,H)=>e.jsxs("div",{className:"flex items-center px-5 py-2 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)] w-36 shrink-0 tabular-nums",children:d.timestamp?new Date(d.timestamp).toLocaleString():"—"}),e.jsx("span",{className:s("px-1.5 py-0.5 rounded-full mr-2 capitalize font-medium border",d.action==="add"?"bg-green-500/10 border-green-500/30 text-green-400":d.action==="remove"?"bg-red-500/10 border-red-500/30 text-red-400":"bg-blue-500/10 border-blue-500/30 text-blue-400"),children:d.action||"—"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] flex-1 truncate",children:d.description||d.detail||`${d.type}: ${d.name}`})]},H))})]})]}),f==="maintenance"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(v,"p-4 flex items-center gap-3 flex-wrap"),children:[e.jsxs("button",{onClick:()=>P.refetch(),disabled:P.isFetching,className:z,children:[P.isFetching?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(De,{className:"w-3.5 h-3.5"}),"Validate Compliance"]}),e.jsxs("button",{onClick:()=>T.refetch(),disabled:T.isFetching,className:z,children:[T.isFetching?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ze,{className:"w-3.5 h-3.5"}),"Diff Schema vs Graph"]}),e.jsxs("button",{onClick:()=>y.refetch(),disabled:y.isFetching,className:z,children:[y.isFetching?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(fe,{className:"w-3.5 h-3.5"}),"Find Unused Types"]})]}),Q.ok&&e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:R,children:"Compliance"}),e.jsxs("span",{className:s("text-xs font-bold tabular-nums",Number(Q.score)>=80?"text-green-400":Number(Q.score)>=50?"text-amber-400":"text-red-400"),children:[Q.score,"%"]}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full",Q.valid?"bg-green-500/10 text-green-400":"bg-amber-500/10 text-amber-400"),children:Q.valid?"Compliant":"Issues Found"})]}),Array.isArray(Q.issues)&&Q.issues.length>0&&e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Q.issues.map((d,H)=>e.jsxs("div",{className:"flex items-start gap-2 text-[10px]",children:[e.jsx("span",{className:s("shrink-0 mt-0.5",d.type==="error"?"text-red-400":"text-amber-400"),children:d.type==="error"?"●":"▲"}),e.jsx("span",{className:"text-[var(--gm-text-secondary)]",children:d.message})]},H))})]}),ae.ok&&e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Schema vs Graph Diff"}),ae.diff&&(()=>{const d=ae.diff;return[{key:"missingInSchema",label:"In graph but not in schema",color:"text-amber-400"},{key:"missingInGraph",label:"In schema but not in graph",color:"text-blue-400"},{key:"matching",label:"Matching",color:"text-green-400"}].map(({key:X,label:de,color:ge})=>{const pe=d[X];return!Array.isArray(pe)||pe.length===0?null:e.jsxs("div",{children:[e.jsxs("span",{className:s("text-[10px] font-medium",ge),children:[de," (",pe.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:pe.map((ce,we)=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:typeof ce=="string"?ce:ce.name||"?"},we))})]},X)})})()]}),W.ok&&e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Unused Types"}),(()=>{const d=W.entities??[],H=W.relations??[];return d.length===0&&H.length===0?e.jsx("p",{className:"text-[10px] text-green-400",children:"All types are in use."}):e.jsxs(e.Fragment,{children:[d.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-amber-400 font-medium",children:["Unused entity types (",d.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:d.map(X=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-400 border border-amber-500/30",children:X},X))})]}),H.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("span",{className:"text-[10px] text-amber-400 font-medium",children:["Unused relation types (",H.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:H.map(X=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-400 border border-amber-500/30",children:X},X))})]}),e.jsxs("button",{onClick:()=>M.mutate({entities:d,relations:H},{onSuccess:()=>n.success("Cleanup complete"),onError:X=>n.error(X.message)}),disabled:M.isPending,className:V,children:[M.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ye,{className:"w-3 h-3"})," Cleanup Unused"]})]})})()]}),!Q.ok&&!ae.ok&&!W.ok&&e.jsx(re,{msg:"Run a check above to see results."})]}),I.message&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:I.message})]})}const Ke={extraction:"bg-blue-500/15 text-blue-400 border-blue-500/30",analysis:"bg-purple-500/15 text-purple-400 border-purple-500/30",template:"bg-amber-500/15 text-amber-400 border-amber-500/30",sprint:"bg-green-500/15 text-green-400 border-green-500/30",report:"bg-rose-500/15 text-rose-400 border-rose-500/30"};function ja(){const{data:t,isLoading:m,error:g}=Vs(),D=Hs(),j=Qs(),[w,b]=_.useState("all"),[P,T]=_.useState(""),[y,S]=_.useState(null),[N,C]=_.useState(null),p=t?.templates??[];if(m)return e.jsx(se,{});if(g)return e.jsx(Re,{msg:"Unable to load prompts."});const A=["all",...Array.from(new Set(p.map(i=>i.category))).sort()],c=p.filter(i=>{if(w!=="all"&&i.category!==w)return!1;if(P){const u=P.toLowerCase();return i.name.toLowerCase().includes(u)||i.id.toLowerCase().includes(u)||(i.description||"").toLowerCase().includes(u)}return!0}),M=p.reduce((i,u)=>(i[u.category]=(i[u.category]||0)+1,i),{}),r=i=>{D.mutate({key:i.id,is_active:!i.isActive},{onSuccess:()=>n.success(`${i.name} ${i.isActive?"deactivated":"activated"}`),onError:u=>n.error(u.message)})};return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Prompt Templates",subtitle:`${p.length} templates with auto-versioning across ${Object.keys(M).length} categories`}),e.jsxs("div",{className:s(v,"p-3 flex items-center gap-2 flex-wrap"),children:[A.map(i=>e.jsx("button",{onClick:()=>b(i),className:s("px-3 py-1.5 text-[11px] font-medium rounded-lg border transition-all capitalize",w===i?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-transparent text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:i==="all"?`All (${p.length})`:`${i} (${M[i]||0})`},i)),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{value:P,onChange:i=>T(i.target.value),placeholder:"Search prompts...",className:s(U,"w-48 pl-7 py-1.5 text-xs")})]})})]}),e.jsx("div",{className:"space-y-3",children:c.map(i=>e.jsxs("div",{className:s(v,"overflow-hidden group",!i.isActive&&"opacity-60"),children:[e.jsxs("div",{className:"px-5 py-3 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:i.name||"(unnamed)"}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",Ke[i.category]||"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border-[var(--gm-border-primary)]"),children:i.category}),e.jsx("button",{onClick:()=>r(i),className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border cursor-pointer transition-colors",i.isActive?"bg-green-500/10 border-green-500/30 text-green-400 hover:bg-green-500/20":"bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20"),children:i.isActive?"Active":"Inactive"})]}),i.description&&e.jsx("p",{className:"text-[11px] text-[var(--gm-text-tertiary)] mt-1 line-clamp-1",children:i.description}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 flex-wrap",children:[e.jsx("span",{className:"text-[9px] font-mono text-[var(--gm-text-tertiary)]",children:i.id}),e.jsx("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:"·"}),e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:i.lastModified}),e.jsx("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:"·"}),i.variables?.slice(0,5).map(u=>e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] font-mono border border-[var(--gm-border-primary)]",children:`{{${u}}}`},u)),(i.variables?.length||0)>5&&e.jsxs("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:["+",i.variables.length-5," more"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[e.jsx("button",{onClick:()=>C(N===i.id?null:i.id),title:"Version History",className:"p-1.5 rounded-lg hover:bg-[var(--gm-surface-hover)] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:e.jsx(Ot,{className:"w-3.5 h-3.5"})}),e.jsxs("button",{onClick:()=>S(i),className:V,children:[e.jsx($t,{className:"w-3 h-3"})," Edit"]})]})]}),e.jsx("div",{className:"px-5 pb-3",children:e.jsxs("pre",{className:"text-[10px] text-[var(--gm-text-tertiary)]/70 max-h-12 overflow-hidden whitespace-pre-wrap font-mono leading-relaxed",children:[i.prompt.substring(0,300),i.prompt.length>300?"…":""]})}),N===i.id&&e.jsx(ba,{promptKey:i.id,currentPrompt:i.prompt,onRestore:u=>j.mutate({key:i.id,version:u},{onSuccess:()=>{n.success(`Restored v${u}`),C(null)},onError:f=>n.error(f.message)})})]},i.id))}),c.length===0&&e.jsx(re,{msg:P?"No prompts match your search.":"No prompt templates found."}),y&&e.jsx(ya,{prompt:y,onClose:()=>S(null),onSave:(i,u,f)=>{const o={key:y.id};i!==y.prompt&&(o.prompt=i,u&&(o.change_reason=u)),f!==void 0&&f!==y.description&&(o.description=f),D.mutate(o,{onSuccess:()=>{n.success("Prompt saved"),S(null)},onError:O=>n.error(O.message)})},isSaving:D.isPending})]})}function ya({prompt:t,onClose:m,onSave:g,isSaving:D}){const[j,w]=_.useState(t.prompt),[b,P]=_.useState(t.description||""),[T,y]=_.useState(""),[S,N]=_.useState("edit"),C=_.useRef(null),p=["document","transcript","conversation","vision","email"].includes(t.id)?t.id:null,{data:A}=Ct(S==="preview"&&p?p:null),c=L(A),M=u=>{const f=C.current;if(!f)return;const o=f.selectionStart,O=f.selectionEnd,Y=`{{${u}}}`,G=j.substring(0,o)+Y+j.substring(O);w(G),requestAnimationFrame(()=>{f.focus(),f.setSelectionRange(o+Y.length,o+Y.length)})},r=j!==t.prompt||b!==(t.description||""),i=j.split(`
`).length;return e.jsx(kt,{open:!0,onClose:m,children:e.jsxs(Pt,{className:"!max-w-5xl !max-h-[95vh] !p-0 flex flex-col bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-[var(--gm-border-primary)] flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}),e.jsx("h2",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:t.name||"(unnamed)"}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",Ke[t.category]||"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border-[var(--gm-border-primary)]"),children:t.category}),e.jsx("span",{className:"text-[9px] font-mono text-[var(--gm-text-tertiary)]",children:t.id})]}),e.jsx("input",{value:b,onChange:u=>P(u.target.value),placeholder:"Add a description...",className:"mt-1.5 w-full text-[11px] text-[var(--gm-text-secondary)] bg-transparent border-0 outline-none placeholder:text-[var(--gm-text-placeholder)]"})]}),e.jsx("button",{onClick:m,className:"p-1.5 rounded-lg hover:bg-[var(--gm-surface-hover)]",children:e.jsx(Ce,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsxs("div",{className:"px-6 pt-2 flex items-center gap-1 border-b border-[var(--gm-border-primary)] shrink-0",children:[["edit","preview"].map(u=>e.jsx("button",{onClick:()=>N(u),className:s("px-3 py-2 text-[11px] font-medium capitalize border-b-2 -mb-px transition-colors",S===u?"border-[var(--gm-accent-primary)] text-[var(--gm-accent-primary)]":"border-transparent text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:u==="edit"?"Editor":"Preview"},u)),e.jsxs("span",{className:"ml-auto text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[i," lines · ",j.length," chars"]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden flex",children:S==="edit"?e.jsxs("div",{className:"flex flex-1 min-h-0",children:[e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx("textarea",{ref:C,value:j,onChange:u=>w(u.target.value),className:"w-full h-full min-h-[400px] bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 font-mono text-xs text-[var(--gm-text-primary)] resize-none outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] leading-relaxed",spellCheck:!1})}),e.jsxs("div",{className:"w-56 border-l border-[var(--gm-border-primary)] overflow-y-auto p-3 shrink-0 bg-[var(--gm-bg-secondary)]",children:[e.jsx("div",{className:s(R,"mb-2"),children:"Variables"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mb-3",children:"Click to insert at cursor position"}),e.jsx("div",{className:"space-y-1",children:t.variables.map(u=>e.jsx("button",{onClick:()=>M(u),className:"w-full text-left px-2 py-1.5 rounded-lg text-[10px] font-mono bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] hover:bg-[var(--gm-accent-primary)]/10 border border-[var(--gm-border-primary)] transition-colors truncate",children:`{{${u}}}`},u))}),t.variables.length===0&&e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] italic",children:"No variables detected"}),e.jsx("div",{className:s(R,"mt-4 mb-2"),children:"Common Variables"}),e.jsx("div",{className:"space-y-1",children:["CONTENT","FILENAME","ONTOLOGY_CONTEXT","CONTACTS_INDEX","ORG_INDEX","PROJECT_INDEX"].filter(u=>!t.variables.includes(u)).map(u=>e.jsx("button",{onClick:()=>M(u),className:"w-full text-left px-2 py-1.5 rounded-lg text-[10px] font-mono bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-accent-primary)]/10 border border-[var(--gm-border-primary)] transition-colors truncate",children:`{{${u}}}`},u))})]})]}):e.jsx("div",{className:"flex-1 overflow-auto p-6",children:p?c.prompt?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:s(R),children:["Rendered Prompt (",p,")"]}),e.jsx("pre",{className:"text-[11px] font-mono text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 max-h-[60vh] overflow-auto",children:typeof c.prompt=="string"?c.prompt:typeof c.prompt=="object"&&c.prompt!==null?JSON.stringify(c.prompt,null,2):String(c.prompt)}),c.ontologyContext&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s(R,"mt-4"),children:"Ontology Context"}),e.jsx("pre",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)] whitespace-pre-wrap bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-3 max-h-40 overflow-auto",children:JSON.stringify(c.ontologyContext,null,2)})]})]}):e.jsx("div",{className:"text-xs text-[var(--gm-text-tertiary)] py-8 text-center",children:"Loading preview..."}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:s(R),children:"Current Template"}),e.jsx("pre",{className:"text-[11px] font-mono text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 max-h-[60vh] overflow-auto",children:j}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Live preview is available for: document, transcript, conversation, vision, email prompts."})]})})}),e.jsxs("div",{className:"px-6 py-3 border-t border-[var(--gm-border-primary)] flex items-center gap-3 shrink-0 bg-[var(--gm-bg-secondary)]",children:[e.jsx("input",{value:T,onChange:u=>y(u.target.value),placeholder:"Change reason (optional)...",className:s(U,"flex-1 py-1.5 text-xs")}),e.jsxs("button",{onClick:m,className:z,children:[e.jsx(Ce,{className:"w-3 h-3"})," Cancel"]}),e.jsxs("button",{onClick:()=>g(j,T,b),disabled:D||!r,className:V,children:[D?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"}),D?"Saving...":"Save Changes"]})]})]})})}function ba({promptKey:t,currentPrompt:m,onRestore:g}){const{data:D,isLoading:j}=wt(t),[w,b]=_.useState(null),{data:P}=St(t,w),T=L(D),y=T.versions??[],N=L(P).version??{};return j?e.jsxs("div",{className:"px-5 pb-3 text-xs text-[var(--gm-text-tertiary)]",children:[e.jsx($,{className:"w-3 h-3 animate-spin inline mr-1"}),"Loading versions..."]}):y.length===0?e.jsx("div",{className:"px-5 pb-3 text-xs text-[var(--gm-text-tertiary)] italic",children:"No previous versions."}):e.jsxs("div",{className:"border-t border-[var(--gm-border-primary)] bg-[var(--gm-bg-secondary)]",children:[e.jsxs("div",{className:"px-5 pt-3 pb-2 flex items-center justify-between",children:[e.jsx("span",{className:R,children:"Version History"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:["Current: v",T.current_version??"?"," · ",y.length," previous"]})]}),e.jsx("div",{className:"px-5 pb-3 space-y-1",children:y.map(C=>{const p=C.version,A=w===p;return e.jsxs("div",{children:[e.jsxs("div",{className:s("flex items-center gap-3 text-xs py-1.5 px-2.5 rounded-lg transition-colors",A?"bg-[var(--gm-accent-primary)]/10":"hover:bg-[var(--gm-surface-hover)]"),children:[e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] font-mono font-bold tabular-nums",children:["v",p]}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)] tabular-nums text-[10px]",children:C.created_at?new Date(C.created_at).toLocaleString():"—"}),C.change_reason&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-secondary)] italic truncate max-w-[200px]",children:C.change_reason}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b(A?null:p),className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline font-medium",children:A?"Hide":"View"}),e.jsx("button",{onClick:()=>g(p),className:"text-[10px] text-amber-400 hover:underline font-medium",children:"Restore"})]})]}),A&&N.prompt_template&&e.jsx("div",{className:"mt-1 mb-2 mx-2",children:e.jsx("pre",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)] whitespace-pre-wrap bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-3 max-h-48 overflow-auto leading-relaxed",children:N.prompt_template})})]},C.id)})})]})}function Na(){const{data:t}=At(),m=Rt(),g=Et(),D=Lt(),j=_t(),w=t??{};return e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:R,children:"Knowledge Pipeline"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Embeddings: ",typeof w.embeddingsCount=="number"?w.embeddingsCount:"—"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:()=>m.mutate(void 0,{onSuccess:()=>n.success("Knowledge synthesis complete"),onError:b=>n.error(b.message)}),disabled:m.isPending,className:V,children:[m.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"}),"Synthesize"]}),e.jsxs("button",{onClick:()=>g.mutate(void 0,{onSuccess:()=>n.success("Embeddings generated"),onError:b=>n.error(b.message)}),disabled:g.isPending,className:V,children:[g.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Bt,{className:"w-3.5 h-3.5"}),"Generate Embeddings"]}),e.jsxs("button",{onClick:()=>j.mutate(void 0,{onSuccess:()=>n.success("Resynthesis complete"),onError:b=>n.error(b.message)}),disabled:j.isPending,className:z,children:[j.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ve,{className:"w-3.5 h-3.5"}),"Resynthesis"]}),e.jsxs("button",{onClick:()=>D.mutate(void 0,{onSuccess:()=>n.success("SOT regenerated"),onError:b=>n.error(b.message)}),disabled:D.isPending,className:z,children:[D.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Pe,{className:"w-3.5 h-3.5"}),"Regenerate SOT"]})]})]})}function fa(){const{data:t,isLoading:m}=Js(),g=Ws(),{data:D}=Ys(),{data:j}=Zs(),w=Xs(),[b,P]=_.useState({}),T=_.useRef(!1),y=L(t),S=L(y.processing),N=D??{},C=j??[];_.useEffect(()=>{!T.current&&Object.keys(S).length>0&&(P({chunkSize:S.chunkSize??4e3,chunkOverlap:S.chunkOverlap??200,similarityThreshold:S.similarityThreshold??.9,pdfToImages:S.pdfToImages??!0,autoProcess:S.autoProcess??!0,temperature:S.temperature??.7}),T.current=!0)},[S]);const p=_.useCallback(()=>{g.mutate({key:"processing",value:b,category:"processing"},{onSuccess:()=>n.success("Processing settings saved"),onError:f=>n.error(f.message)})},[b,g]),A=()=>{w.mutate(void 0,{onSuccess:()=>n.success("Processing started"),onError:f=>n.error(f.message)})};if(m)return e.jsx(se,{});const c=N.status==="processing"||N.status==="running",M=Number(N.progress??0),r=N.currentFile||"",i=Number(N.totalFiles??0),u=Number(N.processedFiles??0);return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Document Processing",subtitle:"Pipeline status, controls, and configuration"}),e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:R,children:"Pipeline Status"}),e.jsxs("button",{onClick:A,disabled:w.isPending||c,className:V,children:[w.isPending||c?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"}),c?"Processing...":"Process All Pending"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:s(v,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("div",{className:s("w-2 h-2 rounded-full",c?"bg-green-400 animate-pulse":N.status==="error"?"bg-red-400":"bg-[var(--gm-text-tertiary)]")}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Status"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] capitalize",children:N.status||"idle"})]}),e.jsxs("div",{className:s(v,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(qs,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Pending"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-accent-primary)]",children:C.length})]}),e.jsxs("div",{className:s(v,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(ze,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Progress"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:i>0?`${u}/${i}`:"—"})]}),e.jsxs("div",{className:s(v,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(Ie,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Completion"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:M>0?`${Math.round(M)}%`:"—"})]})]}),c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full h-2 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)] transition-all duration-500 ease-out",style:{width:`${Math.max(M,2)}%`}})}),r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-3 h-3 animate-spin text-[var(--gm-accent-primary)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono truncate",children:r})]})]}),N.errors&&Array.isArray(N.errors)&&N.errors.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:s(R,"text-red-400"),children:"Errors"}),N.errors.slice(0,5).map((f,o)=>e.jsx("div",{className:"text-[10px] text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg px-3 py-1.5 font-mono",children:f.file||f.message||JSON.stringify(f)},o))]})]}),e.jsx(Na,{}),C.length>0&&e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:R,children:"Pending Files"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[C.length," files waiting"]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:C.map((f,o)=>e.jsxs("div",{className:"px-5 py-2 flex items-center gap-3 border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx(Pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)] shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-[var(--gm-text-primary)] truncate",children:f.name||f.filename||f.file||"—"}),f.type&&e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:f.type})]}),f.size&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums shrink-0",children:[(Number(f.size)/1024).toFixed(1)," KB"]})]},o))})]}),e.jsxs("div",{className:s(v,"p-5 space-y-5"),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:R,children:"Chunking & Extraction"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Chunk Size (tokens)"}),e.jsx("input",{type:"number",value:b.chunkSize??"",onChange:f=>P(o=>({...o,chunkSize:Number(f.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Size of each text chunk for LLM processing"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Chunk Overlap (tokens)"}),e.jsx("input",{type:"number",value:b.chunkOverlap??"",onChange:f=>P(o=>({...o,chunkOverlap:Number(f.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Overlap between chunks to preserve context"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Similarity Threshold"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"1",value:b.similarityThreshold??"",onChange:f=>P(o=>({...o,similarityThreshold:Number(f.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Cosine similarity for dedup (0.0 – 1.0)"})]})]})]}),e.jsxs("div",{className:s(v,"p-5 space-y-5"),children:[e.jsx("h3",{className:R,children:"LLM & Generation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Temperature"}),e.jsx("input",{type:"number",step:"0.1",min:"0",max:"2",value:b.temperature??"",onChange:f=>P(o=>({...o,temperature:Number(f.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"LLM creativity (0 = deterministic, 1+ = creative)"})]}),e.jsx("div",{className:"flex flex-col justify-center",children:e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-medium",children:"PDF to Images"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Convert PDFs to images for vision model processing"})]}),e.jsx(Ne,{checked:!!b.pdfToImages,onChange:f=>P(o=>({...o,pdfToImages:f}))})]})})]})]}),e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsx("h3",{className:R,children:"Automation"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-medium",children:"Auto-Process on Upload"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Automatically process documents when uploaded"})]}),e.jsx(Ne,{checked:!!b.autoProcess,onChange:f=>P(o=>({...o,autoProcess:f}))})]})]}),e.jsxs("button",{onClick:p,disabled:g.isPending,className:V,children:[g.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"})," Save Processing Settings"]})]})}function wa(){const{data:t,isLoading:m}=et(),g=st(),{data:D}=tt(),{data:j}=at(),{data:w}=rt(),{data:b}=nt(),P=it(),T=lt(),y=ct(),S=ot(),[N,C]=_.useState({}),p=_.useRef(!1),[A,c]=_.useState("overview"),M=L(t),r=L(M.config),i=L(D).profiles??[],u=L(L(j).analysis),f=L(w).relationships??[],o=L(b).projects??[];_.useEffect(()=>{!p.current&&Object.keys(r).length>0&&(C({...r}),p.current=!0)},[r]);const O=_.useCallback(()=>{g.mutate(N,{onSuccess:()=>n.success("Configuration saved"),onError:l=>n.error(l.message)})},[N,g]),Y=()=>{P.mutate({forceReanalysis:!1},{onSuccess:()=>n.success("Team analysis completed"),onError:l=>n.error(l.message)})};if(m)return e.jsx(se,{});const G=Number(u.cohesion_score??0),k=u.tension_level||"—",E=u.alliances??[],a=u.tensions??[],x=[{key:"includePersonality",label:"Personality Analysis",desc:"Behavioral profiling and communication identity"},{key:"includeSentiment",label:"Sentiment Tracking",desc:"Emotional tone and sentiment trends"},{key:"includeCommunication",label:"Communication Patterns",desc:"Speaking style, directness, verbosity"},{key:"includeCollaboration",label:"Collaboration Metrics",desc:"Teamwork, alignment, and cooperation signals"}],I=i.reduce((l,B)=>{const J=B.confidence_level||"low";return l[J]=(l[J]||0)+1,l},{});return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Team Behavioral Analysis",subtitle:`${i.length} profiles · ${f.length} relationships · Cohesion ${G||"—"}%`}),e.jsx("div",{className:s(v,"p-1 flex gap-1"),children:["overview","config","projects"].map(l=>e.jsx("button",{onClick:()=>c(l),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",A===l?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:l==="overview"?"Overview & Analysis":l==="config"?"Configuration":"Projects"},l))}),A==="overview"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(v,"p-4 flex items-center gap-3 flex-wrap"),children:[e.jsxs("button",{onClick:Y,disabled:P.isPending,className:V,children:[P.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"}),P.isPending?"Analyzing...":"Run Team Analysis"]}),e.jsxs("button",{onClick:()=>y.mutate(void 0,{onSuccess:()=>n.success("Graph synced"),onError:l=>n.error(l.message)}),disabled:y.isPending,className:z,children:[y.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ke,{className:"w-3.5 h-3.5"}),"Sync to Graph"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(Z,{label:"Profiles",value:i.length,color:"var(--gm-accent-primary)"}),e.jsx(Z,{label:"Relationships",value:f.length,color:"var(--gm-accent-primary)"}),e.jsx(Z,{label:"Cohesion",value:G>0?`${G}%`:"—",color:G>=70?"#22c55e":G>=40?"#f59e0b":"#ef4444"}),e.jsx(Z,{label:"Alliances",value:E.length,color:"#22c55e"}),e.jsx(Z,{label:"Tensions",value:a.length,color:"#ef4444"})]}),u.analysis_data&&e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Team Dynamics"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Tension Level"}),e.jsx("div",{className:s("text-sm font-bold capitalize",k==="high"?"text-red-400":k==="medium"?"text-amber-400":"text-green-400"),children:k})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Team Size"}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:u.team_size||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Communication"}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] truncate",children:u.dominant_communication_pattern||"—"})]})]})]}),i.length>0&&e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:R,children:"Behavioral Profiles"}),e.jsx("div",{className:"flex gap-1.5",children:Object.entries(I).map(([l,B])=>e.jsxs("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",l==="very_high"||l==="high"?"bg-green-500/10 border-green-500/30 text-green-400":l==="medium"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:[B," ",l.replace("_"," ")]},l))})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Person","Style","Motivation","Risk","Influence","Confidence","Transcripts",""].map(l=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:l},l))})}),e.jsx("tbody",{children:i.map((l,B)=>{const J=L(l.contact),q=J.full_name||J.name||l.contact_id||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:q}),J.role&&e.jsx("div",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:J.role})]}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-secondary)] capitalize",children:l.communication_style||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-secondary)] capitalize",children:l.dominant_motivation||"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize",l.risk_tolerance==="high"?"bg-red-500/10 text-red-400":l.risk_tolerance==="medium"?"bg-amber-500/10 text-amber-400":"bg-green-500/10 text-green-400"),children:l.risk_tolerance||"—"})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-12 h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)]",style:{width:`${Number(l.influence_score??0)}%`}})}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-primary)] tabular-nums font-semibold",children:l.influence_score??0})]})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize",l.confidence_level==="high"||l.confidence_level==="very_high"?"bg-green-500/10 text-green-400":l.confidence_level==="medium"?"bg-amber-500/10 text-amber-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"),children:(l.confidence_level||"—").replace("_"," ")})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:l.transcript_count??0}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("button",{onClick:()=>T.mutate({personId:l.contact_id||l.id,forceReanalysis:!0},{onSuccess:()=>n.success(`Re-analyzed ${q}`),onError:ee=>n.error(ee.message)}),disabled:T.isPending,className:"text-[9px] text-[var(--gm-accent-primary)] hover:underline font-medium",children:"Re-analyze"})})]},B)})})]})})]}),f.length>0&&e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:R,children:"Behavioral Relationships"})}),e.jsx("div",{className:"overflow-x-auto max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)] sticky top-0 bg-[var(--gm-surface-primary)]",children:["From","To","Type","Strength","Confidence"].map(l=>e.jsx("th",{className:s(F,"px-4 py-2 text-left"),children:l},l))})}),e.jsx("tbody",{children:f.map((l,B)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2 text-xs text-[var(--gm-text-primary)]",children:l.from_name||l.from_contact_id||"—"}),e.jsx("td",{className:"px-4 py-2 text-xs text-[var(--gm-text-primary)]",children:l.to_name||l.to_contact_id||"—"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize border",l.relationship_type==="tension_with"||l.relationship_type==="competes_with"?"bg-red-500/10 border-red-500/30 text-red-400":l.relationship_type==="aligned_with"||l.relationship_type==="supports"||l.relationship_type==="mentors"?"bg-green-500/10 border-green-500/30 text-green-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:(l.relationship_type||"—").replace(/_/g," ")})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-10 h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)]",style:{width:`${Math.round(Number(l.strength??0)*100)}%`}})}),e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[(Number(l.strength??0)*100).toFixed(0),"%"]})]})}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:l.confidence||"—"})]},B))})]})})]}),i.length===0&&e.jsx(re,{msg:"No behavioral profiles yet. Run Team Analysis to start profiling."})]}),A==="config"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(v,"p-5 space-y-5"),children:[e.jsx("h3",{className:R,children:"Analysis Parameters"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Frequency"}),e.jsxs("select",{value:N.analysisFrequency||"weekly",onChange:l=>C(B=>({...B,analysisFrequency:l.target.value})),className:s(U,"w-full"),children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"How often to auto-run analysis"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Min Meetings"}),e.jsx("input",{type:"number",min:"1",value:N.minMeetingsForAnalysis??3,onChange:l=>C(B=>({...B,minMeetingsForAnalysis:Number(l.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Minimum transcripts before profiling"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Sentiment Threshold"}),e.jsx("input",{type:"number",step:"0.1",min:"-1",max:"0",value:N.sentimentThreshold??-.3,onChange:l=>C(B=>({...B,sentimentThreshold:Number(l.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Alert below this score (-1 to 0)"})]})]})]}),e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Analysis Modules"}),x.map(({key:l,label:B,desc:J})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:B}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:J})]}),e.jsx(Ne,{checked:N[l]!==!1,onChange:q=>C(ee=>({...ee,[l]:q}))})]},l))]}),e.jsxs("button",{onClick:O,disabled:g.isPending,className:V,children:[g.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"})," Save Configuration"]})]}),A==="projects"&&e.jsx("div",{className:"space-y-5",children:o.length>0?e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:R,children:"All Projects — Analysis Status"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Project","Enabled","Last Analysis",""].map(l=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:l},l))})}),e.jsx("tbody",{children:o.map((l,B)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs font-medium text-[var(--gm-text-primary)]",children:l.name||l.id||"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium",l.isEnabled?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"),children:l.isEnabled?"Enabled":"Disabled"})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:l.lastAnalysisAt?new Date(l.lastAnalysisAt).toLocaleString():"Never"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("button",{onClick:()=>S.mutate({projectId:l.id},{onSuccess:()=>n.success(`Analysis triggered for ${l.name}`),onError:J=>n.error(J.message)}),disabled:S.isPending,className:V,children:[S.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ue,{className:"w-3 h-3"})," Analyze"]})})]},B))})]})})]}):e.jsx(re,{msg:"No projects found or admin endpoint not available."})})]})}function Sa(){const{data:t,isLoading:m}=dt(),g=xt(),D=mt(),j=pt(),[w,b]=_.useState(""),[P,T]=_.useState(""),[y,S]=_.useState(!1),[N,C]=_.useState(""),[p,A]=_.useState(!1),c=_.useRef(null),M=L(t),r=!!M.enabled,i=!!M.hasSystemCredentials,u=M.rootFolderId??"",f=M.bootstrappedAt,o=M.pendingProjects??[],O=M.configuredProjects??[];_.useEffect(()=>{!m&&t&&b(u)},[m,t,u]);const Y=_.useCallback(E=>{const a=E.target.files?.[0];if(!a)return;C(a.name);const x=new FileReader;x.onload=I=>{const l=I.target?.result;try{JSON.parse(l),T(l),A(!0),n.success("Service account JSON loaded")}catch{n.error("Invalid JSON file")}},x.readAsText(a),c.current&&(c.current.value="")},[]),G=_.useCallback(()=>{const E={enabled:r,rootFolderId:w.trim()};P&&(E.serviceAccountJson=P),g.mutate(E,{onSuccess:()=>{n.success("Configuration saved to Supabase vault"),T(""),C(""),A(!1)},onError:a=>n.error(a.message)})},[r,w,P,g]);if(m)return e.jsx(se,{});const k=p||w!==u;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"Google Drive Integration",subtitle:"Credentials stored encrypted in Supabase vault — never in .env"}),e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(Ft,{className:"w-4 h-4"})," Connection Status"]}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",i&&r?"bg-green-500/15 text-green-400":"bg-red-500/15 text-red-400"),children:i&&r?"Connected":i?"Disabled":"Not Configured"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Service Account"}),e.jsx("span",{className:s("font-medium",i?"text-green-400":"text-red-400"),children:i?"Uploaded (encrypted)":"Not uploaded"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Root Folder"}),e.jsx("span",{className:s("font-mono text-[11px]",u?"text-[var(--gm-text-primary)]":"text-red-400"),children:u||"Not set"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Integration"}),e.jsx("span",{className:s("font-medium",r?"text-green-400":"text-[var(--gm-text-tertiary)]"),children:r?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Last Bootstrap"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] tabular-nums",children:f?new Date(f).toLocaleString():"Never"})]})]})]}),e.jsxs("div",{className:s(v,"p-5 space-y-5"),children:[e.jsx("h3",{className:s(R),children:"Configuration"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[var(--gm-text-primary)] font-medium",children:"Enable Integration"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5",children:"Activate Google Drive sync for all projects"})]}),e.jsx(Ne,{checked:r,onChange:E=>g.mutate({enabled:E,rootFolderId:w||u},{onSuccess:()=>n.success(E?"Integration enabled":"Integration disabled"),onError:a=>n.error(a.message)}),disabled:g.isPending})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] flex items-center gap-1.5",children:[e.jsx(Le,{className:"w-3 h-3"})," Root Folder ID"]}),e.jsx("input",{type:"text",value:w,onChange:E=>{b(E.target.value),A(!0)},placeholder:"e.g. 1ABC2DEF3GHI4JKL5MNO6PQR...",className:s(U,"w-full font-mono text-[11px]")}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"The Google Drive folder ID where all project folders will be created. Find it in the Drive folder URL after /folders/."})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] flex items-center gap-1.5",children:[e.jsx(Ut,{className:"w-3 h-3"})," Service Account JSON"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>c.current?.click(),className:z,children:[e.jsx(zt,{className:"w-3 h-3"})," Upload JSON File"]}),e.jsx("input",{ref:c,type:"file",accept:".json,application/json",onChange:Y,className:"hidden"}),N&&e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"})," ",N]}),!N&&i&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Credentials already stored (encrypted in Supabase vault)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:P,onChange:E=>{T(E.target.value),A(!0)},placeholder:"Or paste the service account JSON here...",rows:4,className:s(U,"w-full font-mono text-[10px] leading-relaxed resize-none",!y&&P?"text-transparent":"")}),P&&e.jsx("button",{onClick:()=>S(!y),className:"absolute top-2 right-2 p-1 rounded hover:bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:y?e.jsx(Gt,{className:"w-3 h-3"}):e.jsx(Fe,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Download from Google Cloud Console > IAM > Service Accounts > Keys. The JSON is encrypted at rest via pgcrypto."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-[var(--gm-border-primary)]",children:[e.jsxs("button",{onClick:G,disabled:g.isPending||!k,className:V,children:[g.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"}),"Save Configuration"]}),k&&e.jsxs("span",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Unsaved changes"]})]})]}),e.jsxs("div",{className:s(v,"p-5 space-y-4"),children:[e.jsx("h3",{className:s(R),children:"Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>j.mutate(void 0,{onSuccess:E=>{const a=L(E);n.success(a.message||"Bootstrap complete")},onError:E=>n.error(E.message)}),disabled:j.isPending||!i||!r,className:V,children:[j.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(Le,{className:"w-3 h-3"}),"Bootstrap All Projects"]}),e.jsxs("button",{onClick:()=>D.mutate(void 0,{onSuccess:()=>n.success("Sync started"),onError:E=>n.error(E.message)}),disabled:D.isPending||!i||!r,className:z,children:[D.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(xe,{className:"w-3 h-3"}),"Sync Now"]})]}),!i&&e.jsxs("p",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Upload service account credentials to enable actions"]}),i&&!r&&e.jsxs("p",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Enable the integration to use these actions"]})]}),O.length>0&&e.jsxs("div",{className:s(v,"p-5"),children:[e.jsxs("h3",{className:s(R,"mb-3"),children:["Configured Projects (",O.length,")"]}),e.jsx("div",{className:"space-y-0",children:O.map((E,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 text-xs border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium",children:E.name}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)] font-mono text-[10px]",children:E.folderId})]},a))})]}),o.length>0&&e.jsxs("div",{className:s(v,"p-5"),children:[e.jsxs("h3",{className:s(R,"mb-3"),children:["Pending Projects (",o.length,")"]}),e.jsx("div",{className:"space-y-0",children:o.map((E,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 text-xs border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:E.name}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-amber-500/15 text-amber-400",children:"Pending"})]},a))})]})]})}function Ca(){const{data:t}=ut(),{data:m}=ht(),{data:g,isLoading:D,refetch:j}=gt(),w=vt(),b=jt(),P=yt(),T=bt(),[y,S]=_.useState({}),N=_.useRef(!1),C=L(t),p=L(L(m).config),A=L(g).projects??[];return _.useEffect(()=>{!N.current&&Object.keys(p).length>0&&(S({...p}),N.current=!0)},[p]),D?e.jsx(se,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"Billing & Cost Control",subtitle:"Manage project balances, pricing, and cost limits"}),e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Exchange Rate (USD to EUR)"}),C.auto!=null&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-3 h-3 text-[var(--gm-accent-primary)]"}),e.jsx("span",{className:"text-xs text-[var(--gm-accent-primary)]",children:C.auto?"Automatic rate from API":"Manual rate"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-[var(--gm-accent-primary)]",children:"Current Rate: "}),e.jsx("span",{className:"text-lg font-bold text-[var(--gm-text-primary)] tabular-nums",children:String(C.currentRate??C.rate??"—")})]}),e.jsxs("div",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Source: ",String(C.source??"api")," · Updated: ",C.lastUpdated||C.updatedAt?new Date(C.lastUpdated||C.updatedAt).toLocaleString():"—"]}),!C.auto&&e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"Manual Rate"}),e.jsx("input",{type:"number",step:"0.0001",min:"0",defaultValue:Number(C.manualRate??C.currentRate??.92),onBlur:c=>P.mutate({auto:!1,manualRate:Number(c.target.value)},{onSuccess:()=>n.success("Manual rate saved"),onError:M=>n.error(M.message)}),className:s(U,"w-40")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>w.mutate(void 0,{onSuccess:()=>n.success("Rate refreshed"),onError:c=>n.error(c.message)}),disabled:w.isPending,className:z,children:[w.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(xe,{className:"w-3 h-3"})," Refresh Rate"]}),e.jsxs("button",{onClick:()=>P.mutate({auto:!(C.auto??!0)},{onSuccess:()=>n.success("Exchange rate mode updated"),onError:c=>n.error(c.message)}),disabled:P.isPending,className:z,children:["Switch to ",C.auto?"Manual":"Automatic"]})]})]}),e.jsxs("div",{className:s(v,"p-5 space-y-3"),children:[e.jsx("h3",{className:R,children:"Global Pricing Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"Fixed Markup (%)"}),e.jsx("input",{type:"number",value:y.fixed_markup_percent??0,onChange:c=>S(M=>({...M,fixed_markup_percent:Number(c.target.value)})),className:s(U,"w-full")})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"Period Type"}),e.jsxs("select",{value:y.period_type??"monthly",onChange:c=>S(M=>({...M,period_type:c.target.value})),className:s(U,"w-full"),children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"weekly",children:"Weekly"})]})]})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Applied when no tier matches"}),e.jsxs("button",{onClick:()=>b.mutate(y,{onSuccess:()=>n.success("Global pricing saved"),onError:c=>n.error(c.message)}),disabled:b.isPending,className:V,children:[b.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"})," Save Global Pricing"]})]}),e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:"Projects Billing"}),e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[A.length," projects · ",A.filter(c=>c.blocked).length," blocked · ",A.filter(c=>c.unlimited).length," unlimited"]})]}),e.jsxs("button",{onClick:()=>j(),className:z,children:[e.jsx(xe,{className:"w-3 h-3"})," Refresh"]})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["PROJECT","BALANCE","STATUS","KEY SOURCE","TOKENS (PERIOD)","COST (PERIOD)","ACTIONS"].map(c=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:c},c))})}),e.jsx("tbody",{children:A.map((c,M)=>{const r=c.key_sources??{},i=!!c.uses_own_keys,u=!!c.all_own_keys,f=Object.entries(r);return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs font-semibold text-[var(--gm-text-primary)]",children:c.name||c.project_name||c.project_id}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-secondary)] tabular-nums",children:c.unlimited_balance?"∞ Unlimited":`${c.balance_eur??c.balance??0} €`}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",c.is_blocked?"bg-red-500/15 text-red-400":c.unlimited_balance?"bg-green-500/15 text-green-400":"bg-blue-500/15 text-blue-400"),children:c.is_blocked?"BLOCKED":c.unlimited_balance?"UNLIMITED":"ACTIVE"})}),e.jsxs("td",{className:"px-4 py-2.5",children:[f.length===0?e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No keys"}):u?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-purple-500/15 text-purple-400 font-semibold",title:"BYOK: billing skipped",children:"BYOK"}):i?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-amber-500/15 text-amber-400 font-semibold",title:"Mixed: some own keys, some system keys",children:"MIXED"}):e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-500/15 text-blue-400 font-semibold",title:"Using system keys: billing active",children:"SYSTEM"}),f.length>0&&e.jsx("div",{className:"mt-0.5 flex flex-wrap gap-1",children:f.map(([o,O])=>e.jsxs("span",{className:s("text-[9px] px-1 py-px rounded",O==="project"?"bg-purple-500/10 text-purple-300":"bg-blue-500/10 text-blue-300"),children:[o,":",O[0]?.toUpperCase()]},o))})]}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:c.tokens_this_period!=null?`${(Number(c.tokens_this_period)/1e3).toFixed(1)}K`:"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:c.billable_cost_this_period!=null?`${Number(c.billable_cost_this_period).toFixed(2)} €`:"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>T.mutate({projectId:c.project_id||c.id,action:"block",data:{blocked:!c.is_blocked}},{onSuccess:()=>{n.success(c.is_blocked?"Unblocked":"Blocked"),j()},onError:o=>n.error(o.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:c.is_blocked?"Unblock":"Block",children:e.jsx(Ae,{className:"w-3.5 h-3.5 text-amber-400"})}),e.jsx("button",{onClick:()=>T.mutate({projectId:c.project_id||c.id,action:"unlimited",data:{unlimited:!c.unlimited_balance}},{onSuccess:()=>{n.success(c.unlimited_balance?"Limited":"Set unlimited"),j()},onError:o=>n.error(o.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:c.unlimited_balance?"Remove unlimited":"Set unlimited",children:e.jsx("span",{className:"text-[10px]",children:c.unlimited_balance?"∞":"$"})})]})})]},M)})})]}),A.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No projects found."})]})]})}function ka(){const[t,m]=_.useState(""),[g,D]=_.useState(""),[j,w]=_.useState(1),b=50,{data:P,isLoading:T}=Nt({page:j,limit:b,search:t||void 0,filter:g||void 0}),{data:y}=ft(),S=L(P),N=S.logs??[],p=L(y).logs??[],A=_.useMemo(()=>{const r=[...N,...p];return r.sort((i,u)=>{const f=new Date(i.changed_at||i.timestamp||i.created_at||"1970-01-01").getTime()||0;return(new Date(u.changed_at||u.timestamp||u.created_at||"1970-01-01").getTime()||0)-f}),r},[N,p]),c=S.total??A.length;if(T)return e.jsx(se,{});const M=r=>r==="critical"||r==="error"?"bg-red-500/15 text-red-400":r==="warning"?"bg-amber-500/15 text-amber-400":"bg-blue-500/15 text-blue-400";return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Audit Log"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(fe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{placeholder:"Search...",value:t,onChange:r=>{m(r.target.value),w(1)},className:s(U,"flex-1")})]}),e.jsxs("select",{value:g,onChange:r=>{D(r.target.value),w(1)},className:s(U,"w-28"),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{className:s(v,"overflow-hidden"),children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["TIMESTAMP","USER","ACTION","DETAILS","SEVERITY","IP"].map(r=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:r},r))})}),e.jsx("tbody",{children:A.map((r,i)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums whitespace-nowrap",children:r.changed_at||r.timestamp||r.created_at?new Date(r.changed_at||r.timestamp||r.created_at).toLocaleString():"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs font-medium text-[var(--gm-text-primary)]",children:r.changed_by_email||r.user||r.actor||"System"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-secondary)]",children:r.action||r.operation||r.event_type||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] max-w-[200px] truncate",children:r.details||r.config_key||r.table_name||r.description||""}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",M(r.severity||r.level||"info")),children:r.severity||r.level||"info"})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] font-mono",children:r.ip||r.ip_address||""})]},i))})]}),A.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No audit log entries."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[c," entries"]}),c>b&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(r=>Math.max(1,r-1)),disabled:j<=1,className:z,children:"Previous"}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] self-center",children:["Page ",j]}),e.jsx("button",{onClick:()=>w(r=>r+1),disabled:A.length<b,className:z,children:"Next"})]})]})]})}function Va(){const[t,m]=_.useState("users");return e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-48 shrink-0 border-r border-[var(--gm-border-primary)] bg-[var(--gm-bg-primary)] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-4 border-b border-[var(--gm-border-primary)]",children:[e.jsx(De,{className:"w-4 h-4 text-[var(--gm-accent-primary)]",style:{filter:"drop-shadow(0 0 6px var(--gm-accent-primary))"}}),e.jsx("span",{className:"text-sm font-bold text-[var(--gm-accent-primary)]",children:"Admin"})]}),e.jsx("nav",{className:"py-2",children:ca.map(g=>{const D=g.icon,j=t===g.key;return e.jsxs("button",{onClick:()=>m(g.key),className:s("w-full flex items-center gap-2.5 px-4 py-2 text-xs transition-colors",j?"text-[var(--gm-accent-primary)] bg-[var(--gm-surface-hover)] font-semibold":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)]"),children:[e.jsx(D,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"flex-1 text-left",children:g.label}),j&&e.jsx(He,{className:"w-3 h-3 shrink-0"})]},g.key)})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx(oa,{}),t==="users"&&e.jsx(da,{}),t==="system"&&e.jsx(xa,{}),t==="llm-providers"&&e.jsx(ma,{}),t==="model-metadata"&&e.jsx(pa,{}),t==="llm-queue"&&e.jsx(ua,{}),t==="graph"&&e.jsx(ga,{}),t==="ontology"&&e.jsx(va,{}),t==="prompts"&&e.jsx(ja,{}),t==="processing"&&e.jsx(fa,{}),t==="team-analysis"&&e.jsx(wa,{}),t==="google-drive"&&e.jsx(Sa,{}),t==="billing"&&e.jsx(Ca,{}),t==="audit-log"&&e.jsx(ka,{})]})]})}export{Va as default};
//# sourceMappingURL=AdminPage-4T7Vh60X.js.map
