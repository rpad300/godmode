import{c as ge,r as i,c6 as Le,c7 as Pe,c8 as Be,c9 as ve,ca as $e,cb as we,cc as Te,cd as Ue,ce as Oe,K as ce,j as e,br as Se,bs as ke,bt as Ce,a as p,C as ae,O as d,ak as Ge,N as Q,T as qe,L as ue,b as We,ao as he,g as He,cf as Ke,cg as Qe,a4 as Je,X as Ve,Y as Xe,b6 as Ye,ch as Ze,ci as et,a1 as de,a5 as tt}from"./main-BKbBKYvC.js";import{E as st}from"./PageSkeleton-YVPIqcgR.js";import{R as rt,C as at}from"./CommentsPanel-Dn8gVtu4.js";import{B as me}from"./brain-t58eVqGu.js";import{C as be}from"./cpu-Cc2IQ2ui.js";import{C as nt,P as Y}from"./paperclip-BjQUPnzL.js";import{A as it}from"./arrow-left-ZBUT7vL6.js";import{A as Ee}from"./arrow-up-right-Cw18WmsN.js";import{S as ne}from"./star-_8XYD7us.js";import{E as lt}from"./eye-off-D520ZGvK.js";import{E as xe}from"./eye-DDSd_vfm.js";import{A as ot}from"./archive-CJZaF8jg.js";import{S as Z}from"./sparkles-BJxATUBg.js";import{C as fe}from"./circle-check-big-BfAZDzfZ.js";import{L as ye}from"./lightbulb-CVgMn_Uk.js";import{L as ct}from"./link-2-CWyrMbe7.js";import{S as dt}from"./send-BFJJPLhY.js";import{E as mt}from"./ErrorState-BgEaU0QT.js";import{P as xt}from"./plus-BG5YpVIb.js";import"./skeleton-WOBeWWkL.js";import"./pen-BADy_74g.js";import"./circle-DnYbs28l.js";const gt=[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]],_e=ge("arrow-down-left",gt);const pt=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],Ae=ge("arrow-left-right",pt);const ut=[["path",{d:"m15 17 5-5-5-5",key:"nf172w"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]],ht=ge("forward",ut),bt={inbound:_e,outbound:Ee,internal:Ae},je={positive:{color:"bg-green-500/20 text-green-400",emoji:"ðŸ˜Š"},neutral:{color:"bg-white/10 text-slate-300",emoji:"ðŸ˜"},negative:{color:"bg-red-500/20 text-red-400",emoji:"ðŸ˜Ÿ"},urgent:{color:"bg-red-500/20 text-red-400",emoji:"ðŸ”¥"}};function ft({email:r,open:x,onClose:m,onReply:n,onForward:o}){const[u,b]=i.useState("content"),[_,j]=i.useState(null),[f,N]=i.useState(!1),W=Le(),G=Pe(),F=Be(),A=ve(),k=$e(),v=we(),z=Te(),R=Ue();if(!r)return null;const H=r.thread_id?String(r.thread_id):null,s=Oe(f?H:null),c=s.data?.emails,g=String(r.subject||"No subject"),M=String(r.from||r.from_name||r.sender||"â€”"),D=String(r.from_email||""),C=String(r.to||""),w=String(r.cc||""),L=r.date?new Date(String(r.date)).toLocaleString():"",K=String(r.body||r.body_text||""),I=!!r.is_read,P=!!r.is_starred,B=String(r.direction||""),E=String(r.sentiment||""),ee=String(r.detected_intent||r.ai_category||""),te=String(r.ai_summary||""),se=!!r.requires_response,S=r.extracted_entities||{},$=S.facts||[],q=S.decisions||[],T=S.risks||[],a=S.action_items||[],h=S.questions||[],U=S.people||[],y=S.technologies||[],J=S.relationships||[],V=S.key_topics||[],X=r.attachments||[],Re=$.length>0||q.length>0||T.length>0||a.length>0||h.length>0,De=y.length>0||J.length>0||V.length>0,Ie=U.length>0,re=bt[B]||null,pe=je[E]||je.neutral,Fe=()=>{W.mutate(String(r.id),{onSuccess:()=>{d.success("Email deleted"),m()}})},ze=()=>{j(null),F.mutate(String(r.id),{onSuccess:t=>{j(t.response||t.draft||"No response generated."),d.success("AI response generated")},onError:()=>d.error("Failed to generate response")})},Me=[{key:"content",label:"Content",icon:ce},{key:"analysis",label:"Analysis",icon:me,count:$.length+a.length+q.length+T.length+h.length,hidden:!Re},{key:"entities",label:"Entities",icon:be,count:y.length+J.length+V.length,hidden:!De},{key:"contacts",label:"Contacts",icon:nt,count:U.length,hidden:!Ie}];return e.jsx(Se,{open:x,onOpenChange:t=>!t&&m(),children:e.jsxs(ke,{className:"max-w-4xl p-0 overflow-hidden max-h-[90vh] flex flex-col",children:[e.jsx(Ce,{className:"sr-only",children:g}),e.jsx("div",{className:"p-5 shrink-0",style:{background:"linear-gradient(to right, rgba(37,99,235,0.25), rgba(37,99,235,0.08))"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:m,className:"text-slate-400 hover:text-white transition-colors mt-1",children:e.jsx(it,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shrink-0",style:{backgroundColor:"rgba(37,99,235,0.15)"},children:re?e.jsx(re,{className:"w-6 h-6 text-blue-400"}):e.jsx(ce,{className:"w-6 h-6 text-blue-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-white leading-tight",children:g}),e.jsxs("div",{className:"mt-1.5 space-y-0.5 text-xs text-slate-300",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-slate-400 w-8",children:"From"}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-white",children:M}),D&&` <${D}>`]})]}),C&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-slate-400 w-8",children:"To"}),e.jsx("span",{children:C})]}),w&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-slate-400 w-8",children:"CC"}),e.jsx("span",{children:w})]}),L&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-slate-400 w-8",children:"Date"}),e.jsx("span",{children:L})]})]}),e.jsxs("div",{className:"flex gap-1.5 mt-2 flex-wrap",children:[ee&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-400 font-medium capitalize",children:ee.replace(/_/g," ")}),E&&e.jsxs("span",{className:p("text-[10px] px-2 py-0.5 rounded-full font-medium capitalize",pe.color),children:[pe.emoji," ",E]}),se&&e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-yellow-500/20 text-yellow-400 font-medium flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"})," Needs Response"]}),B&&re&&e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full text-slate-300 capitalize flex items-center gap-1",style:{backgroundColor:"rgba(255,255,255,0.1)"},children:[e.jsx(re,{className:"w-3 h-3"})," ",B]}),X.length>0&&e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full text-slate-300 flex items-center gap-1",style:{backgroundColor:"rgba(255,255,255,0.1)"},children:[e.jsx(Y,{className:"w-3 h-3"})," ",X.length]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),A.mutate({id:String(r.id),starred:!P})},className:"p-2 rounded-lg hover:bg-white/10 transition-colors",title:P?"Unstar":"Star",children:e.jsx(ne,{className:p("w-4 h-4",P?"fill-yellow-400 text-yellow-400":"text-slate-400 hover:text-yellow-400")})}),e.jsx("button",{onClick:()=>v.mutate({id:String(r.id),read:!I}),className:"p-2 rounded-lg text-slate-400 hover:bg-white/10 transition-colors",title:I?"Mark unread":"Mark read",children:I?e.jsx(lt,{className:"w-4 h-4"}):e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>k.mutate(String(r.id),{onSuccess:()=>{d.success("Archived"),m()}}),className:"p-2 rounded-lg text-slate-400 hover:bg-white/10 transition-colors",title:"Archive",children:e.jsx(ot,{className:"w-4 h-4"})}),e.jsx("button",{onClick:Fe,className:"p-2 rounded-lg text-slate-400 hover:bg-red-500/20 transition-colors",title:"Delete",children:e.jsx(Ge,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"flex gap-1 px-5 border-b border-[var(--gm-border-primary)] shrink-0",style:{borderColor:"var(--gm-border-primary)"},children:Me.filter(t=>!t.hidden).map(t=>{const l=t.icon;return e.jsxs("button",{onClick:()=>b(t.key),className:p("flex items-center gap-1.5 px-4 py-2.5 text-xs font-medium border-b-2 transition-colors",u===t.key?"border-blue-500 text-blue-400":"border-transparent text-slate-400 hover:text-slate-200"),children:[e.jsx(l,{className:"w-3.5 h-3.5"})," ",t.label,t.count!==void 0&&t.count>0&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-white/10 text-slate-300",children:t.count})]},t.key)})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-4 bg-[var(--gm-surface-primary)]",style:{backgroundColor:"var(--gm-surface-primary)"},children:[u==="content"&&e.jsxs(e.Fragment,{children:[te&&e.jsxs("div",{className:"bg-blue-600/5 border-l-[3px] border-gm-interactive-primary rounded-r-lg p-4",children:[e.jsxs("div",{className:"text-[10px] uppercase tracking-wider text-gm-interactive-primary font-semibold mb-1.5 flex items-center gap-1.5",children:[e.jsx(Z,{className:"w-3.5 h-3.5"})," AI Summary"]}),e.jsx("p",{className:"text-sm text-gm-text-primary leading-relaxed",children:te})]}),e.jsx("div",{className:"bg-gm-surface-secondary rounded-xl p-5",children:e.jsx("pre",{className:"text-sm text-gm-text-primary whitespace-pre-wrap font-sans leading-relaxed",children:K})}),X.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-tertiary uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(Y,{className:"w-3.5 h-3.5"})," Attachments (",X.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:X.map((t,l)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gm-surface-secondary rounded-lg px-3 py-2 border border-gm-border-primary",children:[e.jsx(Y,{className:"w-4 h-4 text-gm-interactive-primary"}),e.jsx("span",{className:"text-xs text-gm-text-primary",children:String(t.filename||t.name||`Attachment ${l+1}`)}),t.size&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary",children:yt(Number(t.size))})]},l))})]}),H&&e.jsxs("div",{className:"border-t border-gm-border-primary pt-4",children:[e.jsx("button",{onClick:()=>N(!f),className:"text-xs text-gm-interactive-primary hover:underline font-medium",children:f?"Hide thread":"Show thread"}),f&&s.isLoading&&e.jsx(Q,{className:"w-4 h-4 animate-spin text-gm-interactive-primary mt-2"}),f&&c&&c.length>0&&e.jsx("div",{className:"space-y-2 mt-3 ml-4 border-l-2 border-blue-600/20 pl-4",children:c.filter(t=>String(t.id)!==String(r.id)).map((t,l)=>e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-gm-text-primary",children:String(t.from||t.from_name||t.sender||"â€”")}),t.date&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary",children:new Date(String(t.date)).toLocaleString()})]}),e.jsx("p",{className:"text-xs text-gm-text-tertiary line-clamp-3",children:String(t.body||t.body_text||t.ai_summary||"")})]},l))})]}),e.jsxs("div",{className:"border-t border-gm-border-primary pt-4 flex flex-wrap gap-2",children:[n&&e.jsxs("button",{onClick:()=>n(r),className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover flex items-center gap-1.5 transition-colors",children:[e.jsx(rt,{className:"w-3.5 h-3.5"})," Reply"]}),o&&e.jsxs("button",{onClick:()=>o(r),className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover flex items-center gap-1.5 transition-colors border border-gm-border-primary",children:[e.jsx(ht,{className:"w-3.5 h-3.5"})," Forward"]}),se&&e.jsxs("button",{onClick:()=>G.mutate(String(r.id),{onSuccess:()=>d.success("Marked as responded")}),disabled:G.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-status-success-bg text-gm-status-success text-xs font-medium hover:bg-green-500/20 flex items-center gap-1.5",children:[e.jsx(fe,{className:"w-3.5 h-3.5"})," Mark Responded"]}),e.jsxs("button",{onClick:ze,disabled:F.isPending,className:"px-3 py-1.5 rounded-lg bg-blue-600/10 text-gm-interactive-primary text-xs font-medium hover:bg-blue-600/20 flex items-center gap-1.5 transition-colors",children:[F.isPending?e.jsx(Q,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Z,{className:"w-3.5 h-3.5"}),"Generate AI Response"]}),e.jsxs("button",{onClick:()=>z.mutate(String(r.id),{onSuccess:t=>d.success(`Categorized: ${t?.category??"done"}`)}),disabled:z.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover flex items-center gap-1.5 transition-colors border border-gm-border-primary",children:[z.isPending?e.jsx(Q,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(me,{className:"w-3.5 h-3.5"}),"AI Categorize"]}),e.jsxs("button",{onClick:()=>R.mutate(String(r.id),{onSuccess:()=>d.success("Summary generated")}),disabled:R.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover flex items-center gap-1.5 transition-colors border border-gm-border-primary",children:[R.isPending?e.jsx(Q,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(me,{className:"w-3.5 h-3.5"}),"AI Summarize"]})]}),_&&e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsx("h4",{className:"text-xs font-semibold text-gm-text-tertiary uppercase tracking-wider mb-2",children:"Draft Response"}),e.jsx("pre",{className:"text-sm text-gm-text-primary whitespace-pre-wrap font-sans leading-relaxed",children:_})]})]}),u==="analysis"&&e.jsxs("div",{className:"space-y-5",children:[$.length>0&&e.jsx(O,{title:"Facts",icon:ye,color:"text-gm-interactive-primary",count:$.length,children:$.map((t,l)=>e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gm-text-primary",children:String(t.content)}),e.jsxs("div",{className:"flex gap-2 mt-1.5",children:[t.category&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary capitalize",children:String(t.category)}),t.confidence&&e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary capitalize",children:[String(t.confidence)," confidence"]})]})]},l))}),a.length>0&&e.jsx(O,{title:"Action Items",icon:fe,color:"text-gm-status-success",count:a.length,children:a.map((t,l)=>e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("p",{className:"text-xs text-gm-text-primary flex items-start gap-1.5",children:[e.jsx("span",{className:"text-gm-status-success mt-0.5",children:"â˜"})," ",String(t.task)]}),e.jsxs("div",{className:"flex gap-2 mt-1.5 flex-wrap",children:[t.owner&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary",children:["Owner: ",String(t.owner)]}),t.deadline&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary",children:["Due: ",String(t.deadline)]}),t.priority&&e.jsx("span",{className:p("text-[10px] px-1.5 py-0.5 rounded capitalize",t.priority==="critical"||t.priority==="high"?"bg-gm-status-danger-bg text-gm-status-danger":t.priority==="medium"?"bg-gm-status-warning-bg text-gm-status-warning":"bg-gm-surface-secondary text-gm-text-tertiary"),children:String(t.priority)})]})]},l))}),q.length>0&&e.jsx(O,{title:"Decisions",icon:ye,color:"text-gm-interactive-primary",count:q.length,children:q.map((t,l)=>e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gm-text-primary",children:String(t.content)}),e.jsxs("div",{className:"flex gap-2 mt-1.5",children:[t.owner&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary",children:["By: ",String(t.owner)]}),t.status&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-blue-600/10 text-gm-interactive-primary capitalize",children:String(t.status)})]})]},l))}),T.length>0&&e.jsx(O,{title:"Risks",icon:qe,color:"text-gm-status-danger",count:T.length,children:T.map((t,l)=>e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gm-text-primary",children:String(t.content)}),e.jsxs("div",{className:"flex gap-2 mt-1.5",children:[t.impact&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-status-danger-bg text-gm-status-danger",children:["Impact: ",String(t.impact)]}),t.likelihood&&e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-status-warning-bg text-gm-status-warning",children:["Likelihood: ",String(t.likelihood)]})]}),t.mitigation&&e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary mt-1.5 italic",children:["Mitigation: ",String(t.mitigation)]})]},l))}),h.length>0&&e.jsx(O,{title:"Questions",icon:ue,color:"text-gm-status-warning",count:h.length,children:h.map((t,l)=>e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("p",{className:"text-xs text-gm-text-primary flex items-start gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5 text-gm-status-warning shrink-0 mt-0.5"})," ",String(t.content)]}),t.assignee&&e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary ml-5",children:["Assigned to: ",String(t.assignee)]})]},l))})]}),u==="entities"&&e.jsxs("div",{className:"space-y-5",children:[y.length>0&&e.jsx(O,{title:"Technologies",icon:be,color:"text-gm-interactive-primary",count:y.length,children:e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map((t,l)=>e.jsxs("span",{className:"text-xs px-3 py-1.5 rounded-lg bg-blue-600/10 text-gm-interactive-primary font-medium",children:[String(t.name),t.category&&e.jsxs("span",{className:"text-[10px] text-blue-500 ml-1.5 capitalize",children:["(",String(t.category),")"]})]},l))})}),V.length>0&&e.jsx(O,{title:"Key Topics",icon:ce,color:"text-gm-text-primary",count:V.length,children:e.jsx("div",{className:"flex flex-wrap gap-2",children:V.map((t,l)=>e.jsx("span",{className:"text-xs px-3 py-1.5 rounded-lg bg-gm-surface-secondary text-gm-text-primary border border-gm-border-primary",children:t},l))})}),J.length>0&&e.jsx(O,{title:"Relationships",icon:ct,color:"text-gm-interactive-primary",count:J.length,children:J.map((t,l)=>e.jsxs("div",{className:"flex items-center gap-2 bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsx("span",{className:"text-xs font-medium text-gm-text-primary",children:String(t.from)}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-blue-600/10 text-gm-interactive-primary",children:String(t.type||"").replace(/_/g," ")}),e.jsx("span",{className:"text-xs font-medium text-gm-text-primary",children:String(t.to)})]},l))})]}),u==="contacts"&&e.jsx("div",{className:"space-y-3",children:U.map((t,l)=>{const ie=String(t.name||"Unknown"),le=We(t);return e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-blue-600/20 flex items-center justify-center text-sm font-bold text-gm-interactive-primary shrink-0 overflow-hidden",children:[he(le)?e.jsx("img",{src:le,alt:ie,className:"w-full h-full object-cover",onError:oe=>{oe.target.style.display="none",oe.target.nextElementSibling&&oe.target.nextElementSibling.classList.remove("hidden")}}):null,e.jsx("span",{className:he(le)?"hidden":"",children:He(ie)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gm-text-primary",children:ie}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-0.5",children:[t.role&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary",children:String(t.role)}),t.organization&&e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary",children:["at ",String(t.organization)]})]}),t.email&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary mt-0.5",children:String(t.email)}),t.phone&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:String(t.phone)})]})]},l)})}),r?.id&&e.jsx("div",{className:"mt-4",children:e.jsx(at,{targetType:"email",targetId:r.id})})]})]})})}function O({title:r,icon:x,color:m,count:n,children:o}){return e.jsxs("div",{children:[e.jsxs("h3",{className:p("text-xs font-semibold uppercase tracking-wider mb-3 flex items-center gap-2",m),children:[e.jsx(x,{className:"w-4 h-4"})," ",r,e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-surface-secondary text-gm-text-tertiary ml-auto",children:n})]}),e.jsx("div",{className:"space-y-2",children:o})]})}function yt(r){if(r===0)return"0 B";const x=1024,m=["B","KB","MB"],n=Math.floor(Math.log(r)/Math.log(x));return parseFloat((r/Math.pow(x,n)).toFixed(1))+" "+m[n]}function jt({open:r,onClose:x,mode:m="compose",replyTo:n}){const o=m==="reply"&&!!n,u=m==="forward"&&!!n,[b,_]=i.useState("compose"),[j,f]=i.useState(o?String(n?.from_email||n?.from||""):""),[N,W]=i.useState(""),[G,F]=i.useState(o?`Re: ${String(n?.subject||"")}`:u?`Fwd: ${String(n?.subject||"")}`:""),[A,k]=i.useState(u?`

---------- Forwarded message ----------
From: ${String(n?.from||n?.from_name||"")}
Date: ${n?.date?new Date(String(n.date)).toLocaleString():""}
Subject: ${String(n?.subject||"")}

${String(n?.body||n?.body_text||"")}`:o?`

> On ${n?.date?new Date(String(n.date)).toLocaleString():""}, ${String(n?.from||n?.from_name||"")} wrote:
> ${String(n?.body||n?.body_text||"").split(`
`).join(`
> `)}`:""),[v,z]=i.useState(""),[R,H]=i.useState(!1),[s,c]=i.useState(!1),[g,M]=i.useState(""),D=i.useRef(null),C=i.useRef(null),[w,L]=i.useState(""),[K,I]=i.useState(!1),P=Ke(),B=Qe(),E=()=>{f(""),W(""),F(""),k(""),z(""),M(""),C.current=null,L(""),x()},ee=async()=>{if(b==="compose"){if(!j.trim()||!A.trim()){d.error("To and Body are required");return}const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,U=j.split(",").map(y=>y.trim()).filter(Boolean).filter(y=>!a.test(y));if(U.length>0){d.error(`Invalid email address: ${U[0]}`);return}c(!0);try{await P.mutateAsync({to:j.split(",").map(y=>y.trim()).filter(Boolean),cc:N?N.split(",").map(y=>y.trim()).filter(Boolean):void 0,subject:G,body:A,replyToId:o?String(n?.id||""):void 0}),d.success(o?"Reply sent":u?"Email forwarded":"Email sent"),E()}catch{d.error("Failed to send email")}finally{c(!1)}}else if(b==="paste"){if(v.trim().length<10){d.error("Please paste email content (min 10 chars)");return}c(!0);try{await B.mutateAsync({emailText:v}),d.success("Email imported and analyzed"),E()}catch{d.error("Failed to import email")}finally{c(!1)}}else if(b==="upload"){const a=C.current;if(!a){d.error("Please select a file");return}c(!0);try{const h=await Nt(a),U=a.name.toLowerCase().endsWith(".msg");await B.mutateAsync(U?{msgBase64:h,filename:a.name}:{emlBase64:h,filename:a.name}),d.success("Email file imported and analyzed"),E()}catch{d.error("Failed to import email file")}finally{c(!1)}}},te=i.useCallback(()=>{w&&(k(w),L(""))},[w]),se=async()=>{if(n?.id){I(!0);try{const a=await Ye.post(`/api/emails/${n.id}/response`,{});a.ok||a.draft?(L(a.draft||a.response||""),d.success("AI draft generated")):d.error("Failed to generate draft")}catch{d.error("Failed to generate draft")}finally{I(!1)}}},S=i.useCallback(a=>{a.preventDefault();const h=a.dataTransfer.files[0];h&&(h.name.endsWith(".eml")||h.name.endsWith(".msg"))&&(C.current=h,M(h.name))},[]),$=o?"Reply":u?"Forward":"Compose Email",q=b==="compose"?o?"Send Reply":u?"Forward":"Send":"Import & Analyze",T=o||u?[{key:"compose",label:"Compose"}]:[{key:"compose",label:"Compose"},{key:"paste",label:"Paste Text"},{key:"upload",label:"Upload .eml/.msg"}];return e.jsx(Se,{open:r,onOpenChange:a=>!a&&E(),children:e.jsxs(ke,{className:"max-w-2xl p-0 overflow-hidden max-h-[90vh] flex flex-col",children:[e.jsx(Ce,{className:"sr-only",children:$}),e.jsx("div",{className:"px-5 py-4 shrink-0",style:{background:"linear-gradient(to right, rgba(37,99,235,0.25), rgba(37,99,235,0.08))"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-semibold text-white",children:$}),e.jsx("button",{onClick:E,className:"w-8 h-8 rounded-lg flex items-center justify-center text-slate-400 hover:bg-white/10 transition-colors",children:e.jsx(Je,{className:"w-4 h-4"})})]})}),T.length>1&&e.jsx("div",{className:"flex px-5 border-b border-[var(--gm-border-primary)] shrink-0",style:{borderColor:"var(--gm-border-primary)"},children:T.map(a=>e.jsx("button",{onClick:()=>_(a.key),className:p("px-4 py-2.5 text-xs font-medium border-b-2 transition-colors",b===a.key?"border-blue-500 text-blue-400":"border-transparent text-slate-400 hover:text-slate-200"),children:a.label},a.key))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-4 bg-[var(--gm-surface-primary)]",style:{backgroundColor:"var(--gm-surface-primary)"},children:[b==="compose"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider",children:"To *"}),e.jsx("input",{value:j,onChange:a=>f(a.target.value),placeholder:"recipient@example.com (comma-separated)",className:"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:()=>H(!R),className:"text-[10px] text-gm-interactive-primary hover:underline flex items-center gap-1",children:[R?e.jsx(Ve,{className:"w-3 h-3"}):e.jsx(Xe,{className:"w-3 h-3"})," CC"]})}),R&&e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider",children:"CC"}),e.jsx("input",{value:N,onChange:a=>W(a.target.value),placeholder:"cc@example.com",className:"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider",children:"Subject"}),e.jsx("input",{value:G,onChange:a=>F(a.target.value),placeholder:"Email subject",className:"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider",children:"Body *"}),o&&n?.id&&e.jsxs("button",{onClick:se,disabled:K,className:"text-[10px] text-gm-interactive-primary hover:underline flex items-center gap-1 disabled:opacity-50",children:[K?e.jsx(Q,{className:"w-3 h-3 animate-spin"}):e.jsx(Z,{className:"w-3 h-3"})," Generate AI Draft"]})]}),e.jsx("textarea",{value:A,onChange:a=>k(a.target.value),placeholder:"Write your message...",rows:10,className:"w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus resize-y leading-relaxed"})]}),w&&e.jsxs("div",{className:"bg-blue-600/5 border border-blue-600/20 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-[10px] uppercase tracking-wider text-gm-interactive-primary font-semibold flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"})," AI Draft"]}),e.jsx("button",{onClick:te,className:"text-[10px] px-2 py-0.5 rounded bg-gm-interactive-primary text-gm-text-on-brand hover:bg-gm-interactive-primary-hover",children:"Use this draft"})]}),e.jsx("pre",{className:"text-xs text-gm-text-primary whitespace-pre-wrap font-sans",children:w})]})]})}),b==="paste"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gm-text-primary mb-2 block",children:"Paste email content:"}),e.jsx("textarea",{value:v,onChange:a=>z(a.target.value),placeholder:`Paste the full email content here...

Include headers if available:
From: sender@example.com
To: recipient@example.com
Subject: Meeting notes
Date: Jan 31, 2026

Email body text...`,rows:12,className:"w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-4 py-3 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus resize-y font-mono leading-relaxed"}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary mt-1.5",children:"Include headers (From, To, Subject, Date) for better parsing. AI will analyze and extract entities."})]}),b==="upload"&&e.jsxs("div",{children:[e.jsxs("div",{className:"border-2 border-dashed border-gm-border-primary rounded-xl p-12 text-center hover:border-blue-600/30 transition-colors cursor-pointer bg-[var(--gm-surface-hover)]",onClick:()=>D.current?.click(),onDragOver:a=>a.preventDefault(),onDrop:S,children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-3 text-gray-600"}),e.jsx("p",{className:"text-sm font-medium text-gm-interactive-primary",children:"Drop email file here"}),e.jsx("p",{className:"text-xs text-gm-text-tertiary mt-1",children:"or click to browse Â· .eml, .msg"}),e.jsx("input",{ref:D,type:"file",className:"hidden",accept:".eml,.msg",onChange:a=>{a.target.files?.[0]&&(C.current=a.target.files[0],M(a.target.files[0].name))}})]}),g&&e.jsxs("div",{className:"flex items-center gap-3 mt-4 p-3 bg-gm-surface-secondary rounded-lg border border-gm-border-primary",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-600/10 flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-gm-interactive-primary"})}),e.jsx("span",{className:"text-sm font-medium text-gm-text-primary flex-1 truncate",children:g}),e.jsx("button",{onClick:()=>{C.current=null,M("")},className:"text-gm-text-tertiary hover:text-gm-status-danger text-lg",children:"Ã—"})]}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary mt-3",children:"Email will be parsed, analyzed with AI, and entities extracted automatically."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 px-5 py-3 border-t border-[var(--gm-border-primary)] shrink-0",style:{borderColor:"var(--gm-border-primary)",backgroundColor:"var(--gm-surface-secondary)"},children:[e.jsx("button",{onClick:E,className:"px-4 py-2 rounded-lg text-slate-300 text-sm font-medium hover:bg-white/10 border border-white/20 transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:ee,disabled:s,className:"px-4 py-2 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-sm font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[s?e.jsx(Q,{className:"w-4 h-4 animate-spin"}):e.jsx(dt,{className:"w-4 h-4"}),q]})]})]})})}async function Nt(r){return new Promise((x,m)=>{const n=new FileReader;n.onload=()=>x(n.result.split(",")[1]),n.onerror=m,n.readAsDataURL(r)})}const Ne={positive:"bg-gm-status-success-bg text-gm-status-success",neutral:"bg-gm-surface-secondary text-gm-text-tertiary",negative:"bg-gm-status-danger-bg text-gm-status-danger",urgent:"bg-gm-status-danger-bg text-gm-status-danger"},vt={inbound:_e,outbound:Ee,internal:Ae};function Wt(){const[r,x]=i.useState(""),[m,n]=i.useState(""),[o,u]=i.useState(""),[b,_]=i.useState(null),[j,f]=i.useState({open:!1,mode:"compose",replyTo:null}),N=Ze({requires_response:r==="needs_response"?!0:void 0}),W=et(),G=ve(),F=we(),A=i.useMemo(()=>{const s=N.data??[];return Array.isArray(s)?s:s.emails??[]},[N.data]),k=i.useMemo(()=>A.filter(s=>!(o&&!JSON.stringify(s).toLowerCase().includes(o.toLowerCase())||m&&String(s.direction||"")!==m||r==="starred"&&!s.is_starred||r==="unread"&&s.is_read)),[A,o,m,r]),v=W.data,z=(s,c,g)=>{s.stopPropagation(),G.mutate({id:c,starred:!g})},R=s=>{_(s),s.is_read||F.mutate({id:String(s.id),read:!0})},H=[{label:"Total",value:v?.total??0,color:"text-gm-text-primary",icon:de},{label:"Unread",value:v?.unread??0,color:"text-gm-interactive-primary",icon:xe},{label:"Starred",value:v?.starred??0,color:"text-yellow-500",icon:ne},{label:"Needs Response",value:v?.needing_response??0,color:"text-gm-status-warning",icon:ae}];return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gm-text-primary",children:"Emails"}),e.jsxs("p",{className:"text-xs text-gm-text-tertiary mt-0.5",children:[k.length," email",k.length!==1?"s":""]})]}),e.jsxs("button",{onClick:()=>f({open:!0,mode:"compose",replyTo:null}),className:"px-4 py-2 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-sm font-medium hover:bg-gm-interactive-primary-hover flex items-center gap-2 transition-colors",children:[e.jsx(xt,{className:"w-4 h-4"})," Add Email"]})]}),v&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:H.map(s=>{const c=s.icon;return e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl px-4 py-3 flex items-center gap-3 hover:border-blue-600/20 transition-colors cursor-pointer",role:"button",tabIndex:0,onClick:()=>{s.label==="Unread"?x(r==="unread"?"":"unread"):s.label==="Starred"?x(r==="starred"?"":"starred"):s.label==="Needs Response"?x(r==="needs_response"?"":"needs_response"):x("")},children:[e.jsx("div",{className:p("w-9 h-9 rounded-lg flex items-center justify-center",s.label==="Total"?"bg-gm-surface-secondary":s.label==="Unread"?"bg-blue-600/10":(s.label==="Starred","bg-yellow-500/10")),children:e.jsx(c,{className:p("w-4.5 h-4.5",s.color)})}),e.jsxs("div",{children:[e.jsx("span",{className:p("text-xl font-bold",s.color),children:String(s.value)}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider",children:s.label})]})]},s.label)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(tt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gm-text-tertiary"}),e.jsx("input",{value:o,onChange:s=>u(s.target.value),placeholder:"Search emails...","aria-label":"Search emails",className:"w-full pl-9 pr-3 py-2 bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),[{key:"needs_response",label:"Needs Response",icon:ae,activeColor:"bg-gm-status-warning-bg border-yellow-500/30 text-gm-status-warning"},{key:"starred",label:"Starred",icon:ne,activeColor:"bg-yellow-500/10 border-yellow-500/30 text-yellow-500"},{key:"unread",label:"Unread",icon:xe,activeColor:"bg-blue-600/10 border-blue-600/30 text-gm-interactive-primary"}].map(s=>{const c=s.icon,g=r===s.key;return e.jsxs("button",{onClick:()=>x(g?"":s.key),"aria-pressed":g,className:p("px-2.5 py-2 rounded-lg text-xs font-medium transition-colors border flex items-center gap-1.5",g?s.activeColor:"bg-gm-surface-secondary border-gm-border-primary text-gm-text-tertiary hover:text-gm-text-primary"),children:[e.jsx(c,{className:"w-3.5 h-3.5"})," ",s.label]},s.key)}),e.jsxs("select",{value:m,onChange:s=>n(s.target.value),"aria-label":"Filter by direction",className:"bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus",children:[e.jsx("option",{value:"",children:"All directions"}),e.jsx("option",{value:"inbound",children:"Inbound"}),e.jsx("option",{value:"outbound",children:"Outbound"}),e.jsx("option",{value:"internal",children:"Internal"})]})]}),N.error?e.jsx(mt,{message:"Failed to load emails.",onRetry:()=>N.refetch()}):N.isLoading?e.jsx(st,{}):k.length===0?e.jsxs("div",{className:"rounded-xl border border-gm-border-primary bg-gm-surface-primary p-8 text-center text-gm-text-tertiary",children:[e.jsx(de,{className:"h-12 w-12 mx-auto mb-4 text-gray-500"}),A.length===0?"No emails imported yet. Click 'Add Email' to get started.":"No emails match your filters."]}):e.jsx("div",{className:"space-y-1.5",children:k.map(s=>{const c=!!s.is_starred,g=!!s.is_read,M=!!s.response_drafted||!!s.draft_response,D=!!s.response_sent,C=!!s.ai_summary,w=vt[String(s.direction||"")]||null,L=String(s.subject||"No subject"),K=String(s.from||s.from_name||s.sender||""),I=s.date?new Date(String(s.date)).toLocaleDateString():"",P=String(s.ai_summary||s.body_text||s.body||"").substring(0,120);return e.jsx("div",{className:p("bg-gm-surface-primary border border-gm-border-primary rounded-xl p-3.5 hover:border-blue-600/30 transition-all cursor-pointer group",!g&&"border-l-[3px] border-l-gm-interactive-primary"),onClick:()=>R(s),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:B=>z(B,String(s.id),c),className:"flex-shrink-0",children:e.jsx(ne,{className:p("w-4 h-4 transition-colors",c?"fill-yellow-400 text-yellow-400":"text-gray-600 hover:text-yellow-400")})}),w?e.jsx(w,{className:p("w-5 h-5 flex-shrink-0",g?"text-gm-text-tertiary":"text-gm-interactive-primary")}):e.jsx(de,{className:p("w-5 h-5 flex-shrink-0",g?"text-gm-text-tertiary":"text-gm-interactive-primary")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:p("text-sm truncate transition-colors group-hover:text-gm-interactive-primary",g?"text-gm-text-primary":"text-gm-text-primary font-semibold"),children:L})}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"text-[10px] text-gm-text-tertiary truncate max-w-[200px]",children:K}),I&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary",children:I})]}),P&&e.jsx("p",{className:"text-[10px] text-gray-400 mt-0.5 truncate",children:P})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0 flex-wrap justify-end",children:[s.requires_response&&!D&&e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-warning-bg text-gm-status-warning font-medium flex items-center gap-1",children:[e.jsx(ae,{className:"w-3 h-3"})," Needs Response"]}),D&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-success-bg text-gm-status-success font-medium",children:"Responded"}),M&&!D&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-600/10 text-gm-interactive-primary font-medium",children:"Draft"}),s.sentiment&&e.jsx("span",{className:p("text-[10px] px-2 py-0.5 rounded-full font-medium capitalize",Ne[String(s.sentiment)]||Ne.neutral),children:String(s.sentiment)}),s.ai_category&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-600/10 text-gm-interactive-primary font-medium capitalize",children:String(s.ai_category)}),C&&e.jsx(Z,{className:"w-3.5 h-3.5 text-blue-500"})]})]})},String(s.id))})}),e.jsx(ft,{email:b,open:!!b,onClose:()=>_(null),onReply:s=>{_(null),f({open:!0,mode:"reply",replyTo:s})},onForward:s=>{_(null),f({open:!0,mode:"forward",replyTo:s})}}),e.jsx(jt,{open:j.open,onClose:()=>f({open:!1,mode:"compose",replyTo:null}),mode:j.mode,replyTo:j.replyTo})]})}export{Wt as default};
//# sourceMappingURL=EmailsPage-DlkxDy9R.js.map
