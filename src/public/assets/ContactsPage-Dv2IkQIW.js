import{c as ue,r as o,j as e,d as Lt,a as pe,b as me,an as ie,ba as oe,bb as le,bc as ce,bd as de,be as W,a1 as Ce,a2 as _e,I as L,C as Ne,b6 as D,bf as qe,bg as re,bh as q,bi as He,bj as Gt,bk as Ot,bl as Je,bm as Ye,bn as Vt,bo as Qe,bp as Bt,bq as Kt,br as qt,bs as Ht,bt as Jt,N as Pe,O as u,H as Yt,a3 as Te,aD as Ie,a4 as we,K as Qt,T as De,ak as Wt,o as Xt,bu as Zt,bv as es,bw as ts,bx as ss,by as as,bz as rs,bA as ns,bB as is,bC as os,bD as ls,J as cs,b8 as ds,Y as ms,a5 as xs,U as us,g as We}from"./main-BKbBKYvC.js";import{I as Le}from"./input-DsK7IqD2.js";import{c as ps}from"./index-_rseqhOj.js";import{B as xe,I as hs,A as gs}from"./AvatarUpload-DVZbQ3jc.js";import{P as Me}from"./plus-BG5YpVIb.js";import{S as vs}from"./save-CuHcaXm4.js";import{P as fs}from"./index-CKDzCnkP.js";import{C as bs}from"./CommentsPanel-Dn8gVtu4.js";import{S as Xe}from"./sparkles-BJxATUBg.js";import{L as Ze}from"./link-2-CWyrMbe7.js";import{U as Re}from"./users-round-CN2BgtyY.js";import{G as js}from"./globe-2bdQFbui.js";import{A as ys}from"./arrow-right-Bzex713W.js";import{U as Ge}from"./user-plus-DXXcvBw_.js";import{S as Oe}from"./square-check-big-B5vwT1uX.js";import{F as Ns}from"./file-braces-BJW8PMcW.js";import{U as ws}from"./upload-BtADKM1s.js";import{F as Cs}from"./funnel-IG8tO05b.js";import{S as ye}from"./star-_8XYD7us.js";import{M as Ve}from"./merge-CIQSa7s7.js";import{S as Ss}from"./square-PNiTT1An.js";import"./send-BFJJPLhY.js";import"./pen-BADy_74g.js";import"./circle-DnYbs28l.js";const ks=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],As=ue("file-spreadsheet",ks);const Fs=[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]],et=ue("linkedin",Fs);const Ts=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],tt=ue("map-pin",Ts);const Is=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],ze=ue("phone",Is);const Rs=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],st=ue("sticky-note",Rs);var Es=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ps=Es.reduce((t,i)=>{const n=ps(`Primitive.${i}`),c=o.forwardRef((l,p)=>{const{asChild:x,...j}=l,S=x?n:i;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(S,{...j,ref:p})});return c.displayName=`Primitive.${i}`,{...t,[i]:c}},{}),Ds="Label",at=o.forwardRef((t,i)=>e.jsx(Ps.label,{...t,ref:i,onMouseDown:n=>{n.target.closest("button, input, select, textarea")||(t.onMouseDown?.(n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));at.displayName=Ds;var rt=at;const $s=Lt,_s=(t,i)=>n=>$s(t,n?.class,n?.className),Ms=_s("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ee=o.forwardRef(({className:t,...i},n)=>e.jsx(rt,{ref:n,className:pe(Ms(),t),...i}));ee.displayName=rt.displayName;const nt=o.forwardRef(({className:t,...i},n)=>e.jsx("textarea",{className:pe("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...i}));nt.displayName="Textarea";const zs=({contact:t,onSubmit:i,onCancel:n,mode:c})=>{const[l,p]=o.useState({name:"",role:"",organization:"",email:"",phone:"",linkedin:"",avatarUrl:"",department:"",location:"",timezone:"",notes:"",aliases:[]}),[x,j]=o.useState(""),[S,F]=o.useState([]),[m,N]=o.useState([]),[g,$]=o.useState([]);o.useEffect(()=>{(async()=>{try{const[v,I,_]=await Promise.all([D.get("/api/role-templates"),D.get("/api/timezones"),D.get("/api/contacts/metadata/companies")]),G=v.roles||[],k=I.timezones||[],O=_.companies||[];F(G),N(k),$(O)}catch(v){console.error("Failed to load metadata",v)}})(),t&&p({name:t.name,role:t.role,organization:t.organization,email:t.email||"",phone:t.phone||"",linkedin:t.linkedin||"",avatarUrl:me(t)||"",department:t.department||"",location:t.location||"",timezone:t.timezone||"",notes:t.notes||"",aliases:t.aliases||[]})},[t]);const P=()=>{!l.name.trim()||!l.role.trim()||i({name:l.name.trim(),role:l.role.trim(),organization:l.organization.trim()||"Unknown",email:l.email.trim()||void 0,phone:l.phone.trim()||void 0,linkedin:l.linkedin.trim()||void 0,avatarUrl:l.avatarUrl.trim()||void 0,department:l.department.trim()||void 0,location:l.location.trim()||void 0,timezone:l.timezone.trim()||void 0,notes:l.notes.trim()||void 0,aliases:l.aliases})},R=(r,v)=>p(I=>({...I,[r]:v})),h=()=>{x.trim()&&!l.aliases.includes(x.trim())&&(p(r=>({...r,aliases:[...r.aliases,x.trim()]})),j(""))},T=r=>{p(v=>({...v,aliases:v.aliases.filter(I=>I!==r)}))},C=({icon:r,label:v,id:I,placeholder:_,value:G,type:k="text",required:O=!1})=>e.jsxs("div",{children:[e.jsxs(ee,{htmlFor:I,className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(r,{className:"w-3.5 h-3.5"})," ",v," ",O&&"*"]}),e.jsx(Le,{id:I,type:k,placeholder:_,value:G,onChange:M=>R(I,M.target.value)})]});return e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:[e.jsx("div",{className:"col-span-2 sm:col-span-1",children:e.jsx(C,{icon:ie,label:"Name",id:"name",placeholder:"Full name",value:l.name,required:!0})}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs(ee,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(xe,{className:"w-3.5 h-3.5"})," Role *"]}),e.jsxs(oe,{value:l.role,onValueChange:r=>R("role",r),children:[e.jsx(le,{className:"w-full",children:e.jsx(ce,{placeholder:"Select role..."})}),e.jsx(de,{children:S.filter(r=>r&&(r.name||r.display_name)).map(r=>e.jsx(W,{value:r.display_name||r.name||"Unknown",children:r.display_name||r.name||"Unknown Role"},r.id||r.name))})]})]}),e.jsx(C,{icon:Ce,label:"Email",id:"email",placeholder:"email@example.com",value:l.email,type:"email"}),e.jsx(C,{icon:ze,label:"Phone",id:"phone",placeholder:"+351 900 000 000",value:l.phone,type:"tel"}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs(ee,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(_e,{className:"w-3.5 h-3.5"})," Organization"]}),e.jsxs(oe,{value:l.organization,onValueChange:r=>R("organization",r),children:[e.jsx(le,{className:"w-full",children:e.jsx(ce,{placeholder:"Select organization..."})}),e.jsx(de,{children:g.filter(r=>r&&r.name).map(r=>e.jsx(W,{value:r.name||"Unknown",children:r.name||"Unknown Company"},r.id||r.name))})]})]}),e.jsx(C,{icon:et,label:"LinkedIn",id:"linkedin",placeholder:"https://linkedin.com/in/...",value:l.linkedin}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs(ee,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(ie,{className:"w-3.5 h-3.5"})," Aliases"]}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(Le,{value:x,onChange:r=>j(r.target.value),placeholder:"Add alias (e.g. nickname, alternate name)",onKeyDown:r=>r.key==="Enter"&&(r.preventDefault(),h())}),e.jsx(L,{type:"button",size:"sm",onClick:h,variant:"secondary",children:"Add"})]}),l.aliases.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:l.aliases.map(r=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-secondary text-xs",children:[r,e.jsx("button",{onClick:()=>T(r),className:"hover:text-destructive",children:"×"})]},r))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(C,{icon:hs,label:"Avatar URL",id:"avatarUrl",placeholder:"https://...",value:l.avatarUrl}),!l.avatarUrl&&e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Enter a URL to set the contact's profile picture"})]}),e.jsx(C,{icon:xe,label:"Department",id:"department",placeholder:"Engineering, Sales, etc.",value:l.department}),e.jsx(C,{icon:tt,label:"Location",id:"location",placeholder:"e.g. Lisbon, Portugal",value:l.location}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs(ee,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"})," Timezone"]}),e.jsxs(oe,{value:l.timezone,onValueChange:r=>R("timezone",r),children:[e.jsx(le,{className:"w-full",children:e.jsx(ce,{placeholder:"Select timezone..."})}),e.jsx(de,{children:m.filter(r=>r&&r.name).map(r=>e.jsxs(W,{value:r.code||r.name,children:[r.name||"Unknown Timezone"," (",r.code,")"]},r.id||r.code||r.name))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs(ee,{htmlFor:"notes",className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(st,{className:"w-3.5 h-3.5"})," Notes"]}),e.jsx(nt,{id:"notes",placeholder:"Additional notes...",value:l.notes,onChange:r=>R("notes",r.target.value),rows:2})]})]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(L,{variant:"outline",onClick:n,className:"flex-1",children:"Cancel"}),e.jsx(L,{onClick:P,disabled:!l.name.trim()||!l.role.trim(),className:"flex-1 gap-1.5",children:c==="add"?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4"})," Add Contact"]}):e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"w-4 h-4"})," Save Changes"]})})]})]})};var Ee="rovingFocusGroup.onEntryFocus",Us={bubbles:!1,cancelable:!0},he="RovingFocusGroup",[$e,it,Ls]=Gt(he),[Gs,ot]=He(he,[Ls]),[Os,Vs]=Gs(he),lt=o.forwardRef((t,i)=>e.jsx($e.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx($e.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(Bs,{...t,ref:i})})}));lt.displayName=he;var Bs=o.forwardRef((t,i)=>{const{__scopeRovingFocusGroup:n,orientation:c,loop:l=!1,dir:p,currentTabStopId:x,defaultCurrentTabStopId:j,onCurrentTabStopIdChange:S,onEntryFocus:F,preventScrollOnEntryFocus:m=!1,...N}=t,g=o.useRef(null),$=Ot(i,g),P=Je(p),[R,h]=Ye({prop:x,defaultProp:j??null,onChange:S,caller:he}),[T,C]=o.useState(!1),r=Vt(F),v=it(n),I=o.useRef(!1),[_,G]=o.useState(0);return o.useEffect(()=>{const k=g.current;if(k)return k.addEventListener(Ee,r),()=>k.removeEventListener(Ee,r)},[r]),e.jsx(Os,{scope:n,orientation:c,dir:P,loop:l,currentTabStopId:R,onItemFocus:o.useCallback(k=>h(k),[h]),onItemShiftTab:o.useCallback(()=>C(!0),[]),onFocusableItemAdd:o.useCallback(()=>G(k=>k+1),[]),onFocusableItemRemove:o.useCallback(()=>G(k=>k-1),[]),children:e.jsx(re.div,{tabIndex:T||_===0?-1:0,"data-orientation":c,...N,ref:$,style:{outline:"none",...t.style},onMouseDown:q(t.onMouseDown,()=>{I.current=!0}),onFocus:q(t.onFocus,k=>{const O=!I.current;if(k.target===k.currentTarget&&O&&!T){const M=new CustomEvent(Ee,Us);if(k.currentTarget.dispatchEvent(M),!M.defaultPrevented){const H=v().filter(U=>U.focusable),J=H.find(U=>U.active),z=H.find(U=>U.id===R),B=[J,z,...H].filter(Boolean).map(U=>U.ref.current);mt(B,m)}}I.current=!1}),onBlur:q(t.onBlur,()=>C(!1))})})}),ct="RovingFocusGroupItem",dt=o.forwardRef((t,i)=>{const{__scopeRovingFocusGroup:n,focusable:c=!0,active:l=!1,tabStopId:p,children:x,...j}=t,S=qe(),F=p||S,m=Vs(ct,n),N=m.currentTabStopId===F,g=it(n),{onFocusableItemAdd:$,onFocusableItemRemove:P,currentTabStopId:R}=m;return o.useEffect(()=>{if(c)return $(),()=>P()},[c,$,P]),e.jsx($e.ItemSlot,{scope:n,id:F,focusable:c,active:l,children:e.jsx(re.span,{tabIndex:N?0:-1,"data-orientation":m.orientation,...j,ref:i,onMouseDown:q(t.onMouseDown,h=>{c?m.onItemFocus(F):h.preventDefault()}),onFocus:q(t.onFocus,()=>m.onItemFocus(F)),onKeyDown:q(t.onKeyDown,h=>{if(h.key==="Tab"&&h.shiftKey){m.onItemShiftTab();return}if(h.target!==h.currentTarget)return;const T=Hs(h,m.orientation,m.dir);if(T!==void 0){if(h.metaKey||h.ctrlKey||h.altKey||h.shiftKey)return;h.preventDefault();let r=g().filter(v=>v.focusable).map(v=>v.ref.current);if(T==="last")r.reverse();else if(T==="prev"||T==="next"){T==="prev"&&r.reverse();const v=r.indexOf(h.currentTarget);r=m.loop?Js(r,v+1):r.slice(v+1)}setTimeout(()=>mt(r))}}),children:typeof x=="function"?x({isCurrentTabStop:N,hasTabStop:R!=null}):x})})});dt.displayName=ct;var Ks={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function qs(t,i){return i!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function Hs(t,i,n){const c=qs(t.key,n);if(!(i==="vertical"&&["ArrowLeft","ArrowRight"].includes(c))&&!(i==="horizontal"&&["ArrowUp","ArrowDown"].includes(c)))return Ks[c]}function mt(t,i=!1){const n=document.activeElement;for(const c of t)if(c===n||(c.focus({preventScroll:i}),document.activeElement!==n))return}function Js(t,i){return t.map((n,c)=>t[(i+c)%t.length])}var Ys=lt,Qs=dt,Se="Tabs",[Ws]=He(Se,[ot]),xt=ot(),[Xs,Ue]=Ws(Se),ut=o.forwardRef((t,i)=>{const{__scopeTabs:n,value:c,onValueChange:l,defaultValue:p,orientation:x="horizontal",dir:j,activationMode:S="automatic",...F}=t,m=Je(j),[N,g]=Ye({prop:c,onChange:l,defaultProp:p??"",caller:Se});return e.jsx(Xs,{scope:n,baseId:qe(),value:N,onValueChange:g,orientation:x,dir:m,activationMode:S,children:e.jsx(re.div,{dir:m,"data-orientation":x,...F,ref:i})})});ut.displayName=Se;var pt="TabsList",ht=o.forwardRef((t,i)=>{const{__scopeTabs:n,loop:c=!0,...l}=t,p=Ue(pt,n),x=xt(n);return e.jsx(Ys,{asChild:!0,...x,orientation:p.orientation,dir:p.dir,loop:c,children:e.jsx(re.div,{role:"tablist","aria-orientation":p.orientation,...l,ref:i})})});ht.displayName=pt;var gt="TabsTrigger",vt=o.forwardRef((t,i)=>{const{__scopeTabs:n,value:c,disabled:l=!1,...p}=t,x=Ue(gt,n),j=xt(n),S=jt(x.baseId,c),F=yt(x.baseId,c),m=c===x.value;return e.jsx(Qs,{asChild:!0,...j,focusable:!l,active:m,children:e.jsx(re.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":F,"data-state":m?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:S,...p,ref:i,onMouseDown:q(t.onMouseDown,N=>{!l&&N.button===0&&N.ctrlKey===!1?x.onValueChange(c):N.preventDefault()}),onKeyDown:q(t.onKeyDown,N=>{[" ","Enter"].includes(N.key)&&x.onValueChange(c)}),onFocus:q(t.onFocus,()=>{const N=x.activationMode!=="manual";!m&&!l&&N&&x.onValueChange(c)})})})});vt.displayName=gt;var ft="TabsContent",bt=o.forwardRef((t,i)=>{const{__scopeTabs:n,value:c,forceMount:l,children:p,...x}=t,j=Ue(ft,n),S=jt(j.baseId,c),F=yt(j.baseId,c),m=c===j.value,N=o.useRef(m);return o.useEffect(()=>{const g=requestAnimationFrame(()=>N.current=!1);return()=>cancelAnimationFrame(g)},[]),e.jsx(fs,{present:l||m,children:({present:g})=>e.jsx(re.div,{"data-state":m?"active":"inactive","data-orientation":j.orientation,role:"tabpanel","aria-labelledby":S,hidden:!g,id:F,tabIndex:0,...x,ref:i,style:{...t.style,animationDuration:N.current?"0s":void 0},children:g&&p})})});bt.displayName=ft;function jt(t,i){return`${t}-trigger-${i}`}function yt(t,i){return`${t}-content-${i}`}var Zs=ut,Nt=ht,wt=vt,Ct=bt;const ea=Zs,St=o.forwardRef(({className:t,...i},n)=>e.jsx(Nt,{ref:n,className:pe("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...i}));St.displayName=Nt.displayName;const kt=o.forwardRef(({className:t,...i},n)=>e.jsx(wt,{ref:n,className:pe("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...i}));kt.displayName=wt.displayName;const ae=o.forwardRef(({className:t,...i},n)=>e.jsx(Ct,{ref:n,className:pe("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...i}));ae.displayName=Ct.displayName;const Be=["from-rose-400 to-pink-500","from-violet-400 to-purple-500","from-blue-400 to-cyan-500","from-emerald-400 to-teal-500","from-amber-400 to-orange-500","from-fuchsia-400 to-pink-500"],ta=t=>{let i=0;for(let n=0;n<t.length;n++)i=t.charCodeAt(n)+((i<<5)-i);return Be[Math.abs(i)%Be.length]},V=({icon:t,label:i,value:n})=>n?e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-2.5 border-b border-white/10 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(t,{className:"w-4 h-4 text-blue-400"})," ",i]}),e.jsx("p",{className:"text-sm text-white break-all",children:n})]}):null,sa=({contact:t,open:i,onClose:n,onEdit:c,onDelete:l,onUpdateProjects:p})=>{const[x,j]=o.useState("info"),[S,F]=o.useState(!1),[m,N]=o.useState([]),[g,$]=o.useState([]),[P,R]=o.useState(null),[h,T]=o.useState([]),[C,r]=o.useState([]),[v,I]=o.useState([]),[_,G]=o.useState([]),k=Qe(),O=Bt(),M=Kt(),[H,J]=o.useState(!1),[z,te]=o.useState(""),[B,U]=o.useState("works_with"),[K,ke]=o.useState(null),[ge,Y]=o.useState(null);o.useEffect(()=>{t&&i&&(X(),Y(me(t)))},[t,i]);const X=async()=>{if(t){F(!0);try{const a=await D.get("/api/projects");N(Array.isArray(a)?a:a.projects||[]);const w=(await D.get(`/api/contacts/${t.id}/projects`)).projects||[],A=w.map(E=>E.id);$(A);const se=w.find(E=>E.is_primary);R(se?se.id:A[0]||null);const be=await D.get(`/api/contacts/${t.id}/relationships`);T(be.relationships||[]);const Q=await D.get(`/api/contacts/${t.id}/activity`);r(Q.activities||[]);try{const E=await D.get(`/api/contacts/${t.id}/mentions`);I(E.mentions||[])}catch(E){console.error("Error loading mentions",E)}const Z=(await D.get("/api/contacts")).contacts||[];G(Z.filter(E=>E.id!==t.id))}catch(a){console.error("Error loading contact details:",a)}finally{F(!1)}}};if(!t)return null;const ve=async a=>{const y=g.includes(a);try{y?(await D.delete(`/api/contacts/${t.id}/projects/${a}`),$(w=>w.filter(A=>A!==a)),P===a&&R(null)):(await D.post(`/api/contacts/${t.id}/projects`,{projectId:a}),$(w=>[...w,a]),P||R(a)),p?.(t.id,g,P)}catch(w){console.error("Error toggling project:",w)}},fe=async a=>{try{g.includes(a)?await D.post(`/api/contacts/${t.id}/projects`,{projectId:a,isPrimary:!0}):(await D.post(`/api/contacts/${t.id}/projects`,{projectId:a,isPrimary:!0}),$(y=>[...y,a])),R(a)}catch(y){console.error("Error setting primary project",y)}},Ae=async()=>{if(z)try{const a=_.find(A=>A.id===z);if(!a)return;const w=(await D.post(`/api/contacts/${t.id}/relationships`,{toContactId:a.id,type:B})).relationship;T(A=>[...A,{id:w.id,type:B,direction:"forward",other_contact:{id:a.id,name:a.name,role:a.role,avatarUrl:a.avatarUrl}}]),te(""),J(!1)}catch(a){console.error("Error adding relationship:",a)}};return e.jsx(qt,{open:i,onOpenChange:a=>!a&&n(),children:e.jsxs(Ht,{className:"max-w-2xl p-0 overflow-hidden",children:[e.jsx(Jt,{className:"sr-only",children:"Contact Details"}),e.jsxs("div",{className:`bg-gradient-to-r ${ta(t.name)} p-6 pb-12 relative`,children:[e.jsx("button",{onClick:n,className:"absolute top-3 right-3 text-white/80 hover:text-white transition-colors",children:e.jsx("span",{className:"sr-only",children:"Close"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsxs(L,{variant:"secondary",size:"sm",className:"gap-1.5 bg-white/20 text-white border-0 hover:bg-white/30 backdrop-blur-sm",disabled:k.isPending,onClick:()=>{k.mutate(t.id,{onSuccess:a=>{if(u.success("AI enrichment complete"),a?.suggestions){const y=a.suggestions,w=[];y.role&&w.push(`Role: ${y.role}`),y.department&&w.push(`Dept: ${y.department}`),y.tags&&w.push(`Tags: ${y.tags.join(", ")}`),w.length&&u.info(w.join(" | "))}X()},onError:()=>u.error("Enrichment failed")})},children:[k.isPending?e.jsx(Pe,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Xe,{className:"w-3.5 h-3.5"})," Enrich AI"]}),e.jsxs(L,{variant:"secondary",size:"sm",className:"gap-1.5 bg-white/20 text-white border-0 hover:bg-white/30 backdrop-blur-sm",disabled:M.isPending,onClick:()=>{const a=t.display_name||t.name||"";if(!a){u.error("No participant name to unlink");return}M.mutate(a,{onSuccess:()=>u.success(`Unlinked participant "${a}"`),onError:()=>u.error("Unlink failed")})},children:[M.isPending?e.jsx(Pe,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ze,{className:"w-3.5 h-3.5"})," Unlink"]}),e.jsx(L,{variant:"secondary",size:"sm",className:"gap-1.5 bg-white/20 text-white border-0 hover:bg-white/30 backdrop-blur-sm",onClick:()=>c(t),children:"Edit"})]})]}),e.jsx("div",{className:"px-6 -mt-10 relative z-10",children:e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsx(gs,{currentUrl:ge,name:t.name,uploadEndpoint:`/api/contacts/${t.id}/avatar`,deleteEndpoint:`/api/contacts/${t.id}/avatar`,onUploaded:a=>{Y(a),X()},onRemoved:()=>{Y(null),X()},size:"md",showUrlInput:!1,className:"!gap-0"}),e.jsxs("div",{className:"pb-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:t.name||"(unnamed)"}),e.jsxs("p",{className:"text-sm text-slate-300",children:[t.role||t.cargo||"—",(t.organization||t.empresa)&&` · ${t.organization||t.empresa}`]})]})]})}),e.jsx("div",{className:"px-6 mt-4",children:e.jsxs(ea,{value:x,onValueChange:j,children:[e.jsx(St,{className:"w-full justify-start bg-transparent border-b border-white/10 rounded-none h-auto p-0 gap-0",children:[{id:"info",label:"Info",icon:ie,count:void 0},{id:"projects",label:"Projects",icon:Yt,count:g.length},{id:"relations",label:"Relations",icon:Re,count:h.length},{id:"mentions",label:"Mentions",icon:Te,count:v.length},{id:"activity",label:"Activity",icon:Ne,count:C.length>0?C.length:void 0}].map(a=>e.jsxs(kt,{value:a.id,className:"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-500 data-[state=active]:text-blue-400 data-[state=active]:shadow-none bg-transparent text-slate-400 hover:text-slate-200 px-4 py-2.5 text-sm gap-1.5",children:[e.jsx(a.icon,{className:"w-3.5 h-3.5"}),a.label,a.count!==void 0&&e.jsx("span",{className:"ml-1 text-[10px] px-1.5 py-0.5 rounded-full bg-blue-500/10 text-blue-400 font-semibold",children:a.count})]},a.id))}),e.jsx(ae,{value:"info",className:"mt-4 pb-0",children:e.jsxs("div",{className:"divide-y divide-white/10",children:[e.jsx(V,{icon:ie,label:"Name *",value:t.name}),e.jsx(V,{icon:xe,label:"Role",value:t.role}),e.jsx(V,{icon:Ce,label:"Email",value:t.email}),e.jsx(V,{icon:ze,label:"Phone",value:t.phone}),e.jsx(V,{icon:_e,label:"Organization",value:t.organization}),e.jsx(V,{icon:et,label:"LinkedIn",value:t.linkedin}),e.jsx(V,{icon:xe,label:"Department",value:t.department}),e.jsx(V,{icon:tt,label:"Location",value:t.location}),e.jsx(V,{icon:js,label:"Timezone",value:t.timezone}),t.aliases&&t.aliases.length>0&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-2.5 border-b border-white/10 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(ie,{className:"w-4 h-4 text-blue-400"})," Aliases"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.aliases.map(a=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-white/5 rounded text-slate-400",children:a},a))})]}),t.notes&&e.jsx(V,{icon:st,label:"Notes",value:t.notes})]})}),e.jsx(ae,{value:"projects",className:"mt-4 pb-0",children:e.jsx("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:m.map(a=>{const y=g.includes(a.id),w=P===a.id;return e.jsxs("div",{className:"flex items-center justify-between py-2.5 border-b border-white/10 last:border-0 hover:bg-white/5 px-2 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1",onClick:()=>ve(a.id),children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${y?"border-blue-500 bg-blue-600":"border-white/20 hover:border-slate-400"}`,children:y&&e.jsx(Ie,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm ${y?"text-white":"text-slate-400"}`,children:a.name}),a.description&&e.jsx("span",{className:"text-[10px] text-slate-400 truncate max-w-[200px]",children:a.description})]})]}),w?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-blue-600 text-white font-semibold",children:"Primary"}):y?e.jsx("button",{onClick:A=>{A.stopPropagation(),fe(a.id)},className:"text-[10px] px-2 py-0.5 rounded bg-white/5 text-slate-400 hover:text-white transition-colors",children:"Set Primary"}):null]},a.id)})})}),e.jsxs(ae,{value:"relations",className:"mt-4 pb-0",children:[h.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:h.map((a,y)=>{const w=(a.type||"").replace("_"," "),A=a.other_contact?.name||"Unknown";return e.jsxs("div",{className:"flex items-center gap-3 py-2.5 border-b border-white/10 last:border-0 group/rel",children:[e.jsx(Re,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"flex-1 flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-white",children:t.name}),e.jsx("span",{className:"text-slate-400 text-xs px-1 bg-white/5 rounded",children:w}),e.jsx("span",{className:"font-medium text-white",children:A})]}),e.jsx("button",{className:"opacity-0 group-hover/rel:opacity-100 transition-opacity text-red-400/60 hover:text-red-400",title:"Remove relationship",onClick:()=>{a.other_contact?.id&&O.mutate({contactId:t.id,toContactId:a.other_contact.id,type:a.type},{onSuccess:()=>{T(se=>se.filter((be,Q)=>Q!==y)),u.success("Relationship removed")},onError:()=>u.error("Failed to remove relationship")})},children:e.jsx(we,{className:"w-3.5 h-3.5"})})]},y)})}):e.jsxs("div",{className:"flex flex-col items-center py-8 text-slate-400",children:[e.jsx(Re,{className:"w-10 h-10 mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No relationships yet"})]}),H?e.jsxs("div",{className:"mt-3 p-3 rounded-lg border border-white/10 bg-white/5 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(oe,{value:z,onValueChange:te,children:[e.jsx(le,{className:"text-sm",children:e.jsx(ce,{placeholder:"Select contact"})}),e.jsx(de,{children:_.map(a=>e.jsx(W,{value:a.id,children:a.name},a.id))})]}),e.jsxs(oe,{value:B,onValueChange:U,children:[e.jsx(le,{className:"text-sm",children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(W,{value:"reports_to",children:"Reports to"}),e.jsx(W,{value:"manages",children:"Manages"}),e.jsx(W,{value:"leads",children:"Leads"}),e.jsx(W,{value:"works_with",children:"Works with"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{J(!1),te("")},children:"Cancel"}),e.jsx(L,{size:"sm",className:"flex-1",disabled:!z,onClick:Ae,children:"Add"})]})]}):e.jsxs("button",{onClick:()=>J(!0),className:"flex items-center gap-1.5 text-sm text-slate-400 hover:text-white mt-4 transition-colors",children:[e.jsx(Me,{className:"w-4 h-4"})," Add Relationship"]})]}),e.jsx(ae,{value:"mentions",className:"mt-4 pb-0",children:v.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 pb-2 overflow-x-auto",children:["all","document","email","conversation"].map(a=>e.jsxs("button",{onClick:()=>ke(a==="all"?null:a),className:`text-xs px-2.5 py-1 rounded-full border transition-colors ${K===a||K===null&&a==="all"?"bg-blue-500/10 text-blue-400 border-blue-500/20":"bg-white/5 text-slate-400 border-transparent hover:bg-white/10 hover:text-slate-200"}`,children:[a.charAt(0).toUpperCase()+a.slice(1),"s"]},a))}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:[v.filter(a=>!K||a.type===K).map(a=>e.jsxs("div",{className:"flex gap-3 py-3 border-b border-white/10 last:border-0 group",children:[e.jsx("div",{className:"mt-0.5",children:a.type==="email"?e.jsx(Ce,{className:"w-3.5 h-3.5 text-blue-400"}):a.type==="conversation"?e.jsx(Te,{className:"w-3.5 h-3.5 text-violet-400"}):e.jsx(Qt,{className:"w-3.5 h-3.5 text-amber-400"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase tracking-wider",children:a.source||"—"}),e.jsx("span",{className:"text-[10px] text-slate-400 whitespace-nowrap ml-2",children:a.date?new Date(a.date).toLocaleDateString():"—"})]}),e.jsxs("p",{className:"text-sm text-white line-clamp-2 bg-white/5 p-2 rounded border border-white/10 italic",children:['"',a.text,'"']}),a.link&&e.jsxs("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-400 hover:underline inline-flex items-center gap-1 mt-1 font-medium transition-colors",children:["View Context ",e.jsx(ys,{className:"w-3 h-3"})]})]})]},a.id)),v.filter(a=>!K||a.type===K).length===0&&e.jsx("p",{className:"text-center text-sm text-slate-400 py-8",children:"No mentions found for this filter"})]})]}):e.jsxs("div",{className:"flex flex-col items-center py-8 text-slate-400",children:[e.jsx(Te,{className:"w-10 h-10 mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No mentions found"})]})}),e.jsx(ae,{value:"activity",className:"mt-4 pb-0",children:C.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:C.map(a=>e.jsxs("div",{className:"flex items-center gap-3 py-2.5 border-b border-white/10 last:border-0",children:[a.status==="completed"||a.status==="approved"?e.jsx(Ie,{className:"w-4 h-4 text-emerald-500 shrink-0"}):a.status==="overdue"||a.status==="rejected"?e.jsx(De,{className:"w-4 h-4 text-red-400 shrink-0"}):e.jsx(Ne,{className:"w-4 h-4 text-slate-400 shrink-0"}),e.jsx("span",{className:"text-sm text-white flex-1 truncate",children:a.description}),e.jsx("span",{className:"text-[10px] text-slate-400 shrink-0",children:a.date?new Date(a.date).toLocaleDateString():"—"})]},`${a.type}-${a.id}`))}):e.jsxs("div",{className:"flex flex-col items-center py-8 text-slate-400",children:[e.jsx(Ne,{className:"w-10 h-10 mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No activity recorded yet"})]})})]})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-white/10 mt-4",children:[e.jsxs(L,{variant:"outline",size:"sm",className:"text-red-400 border-red-400/30 hover:bg-red-500/10 gap-1.5",onClick:()=>l(t.id),children:[e.jsx(Wt,{className:"w-3.5 h-3.5"})," Delete"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",className:"text-slate-300 border-white/20 hover:bg-white/10",onClick:n,children:"Cancel"}),e.jsxs(L,{size:"sm",className:"gap-1.5 bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>c(t),children:[e.jsx(Ie,{className:"w-3.5 h-3.5"})," Save Changes"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(bs,{targetType:"contact",targetId:t.id})})]})})},Ke=["from-rose-400 to-pink-500","from-violet-400 to-purple-500","from-blue-400 to-cyan-500","from-emerald-400 to-teal-500","from-amber-400 to-orange-500","from-fuchsia-400 to-pink-500"],At=t=>{let i=0;for(let n=0;n<t.length;n++)i=t.charCodeAt(n)+((i<<5)-i);return Ke[Math.abs(i)%Ke.length]};function aa({contact:t,size:i="md"}){const n=String(t.name||"?"),c=me(t),l=i==="sm"?"w-7 h-7":i==="lg"?"w-16 h-16":"w-10 h-10",p=i==="sm"?"text-[9px]":i==="lg"?"text-lg":"text-xs";return e.jsx("div",{className:`${l} rounded-full bg-gradient-to-br ${At(n)} flex items-center justify-center flex-shrink-0 overflow-hidden`,children:c?e.jsx("img",{src:c,alt:n,className:"w-full h-full rounded-full object-cover",onError:x=>{x.target.style.display="none"}}):e.jsx("span",{className:`${p} font-bold text-white`,children:We(n)})})}function Fa(){const[t,i]=o.useState(""),[n,c]=o.useState(!1),[l,p]=o.useState(null),[x,j]=o.useState(null),[S,F]=o.useState(""),[m,N]=o.useState(""),[g,$]=o.useState(!1),[P,R]=o.useState(!1),[h,T]=o.useState(new Set),[C,r]=o.useState(!1),[v,I]=o.useState(!1),[_,G]=o.useState({}),[k,O]=o.useState(!1),M=o.useRef(null),[H,J]=o.useState(!1),[z,te]=o.useState({}),B=Xt({search:t||void 0,organization:S||void 0}),U=Zt(),K=es(),ke=ts(),ge=ss(),Y=as(),X=Qe(),ve=rs(),fe=ns(),Ae=is(),a=os(),y=ls(),w=B.data,A=Array.isArray(w)?w:w?.contacts??[],se=o.useMemo(()=>{const s=new Set;return A.forEach(d=>{d.organization&&s.add(d.organization)}),Array.from(s).sort()},[A]),be=o.useMemo(()=>{const s=new Set;return A.forEach(d=>{const f=d.tags;Array.isArray(f)&&f.forEach(b=>s.add(b))}),Array.from(s).sort()},[A]),Q=o.useMemo(()=>{let s=A;return m&&(s=s.filter(d=>Array.isArray(d.tags)&&d.tags.includes(m))),g&&(s=s.filter(d=>d.is_favorite||d.isFavorite)),s},[A,m,g]),ne=o.useMemo(()=>A.filter(s=>s.is_favorite||s.isFavorite),[A]),Z=ge.data?.duplicates||[],E=Ae.data?.unmatched||[],Ft=s=>{U.mutate(s,{onSuccess:()=>{u.success("Contact created"),c(!1)},onError:()=>u.error("Failed to create contact")})},Tt=s=>{l&&K.mutate({id:l.id,...s},{onSuccess:()=>{u.success("Contact updated"),p(null),c(!1)},onError:()=>u.error("Failed to update contact")})},It=s=>{ke.mutate(s,{onSuccess:()=>{u.success("Contact deleted"),j(null)},onError:()=>u.error("Failed to delete contact")})},Rt=s=>{j(null),p(s),c(!0)},Et=s=>{const d=s.is_favorite||s.isFavorite;K.mutate({id:s.id,is_favorite:!d},{onSuccess:()=>u.success(d?"Removed from favorites":"Added to favorites"),onError:()=>u.error("Failed to update")})},Pt=s=>{T(d=>{const f=new Set(d);return f.has(s)?f.delete(s):f.add(s),f})},Dt=()=>{if(h.size<2){u.error("Select at least 2 contacts to merge");return}Y.mutate(Array.from(h),{onSuccess:()=>{u.success("Contacts merged"),T(new Set),r(!1)},onError:()=>u.error("Merge failed")})},$t=(s,d)=>{if(!_[s]){u.error("Select a primary contact");return}const b=d.map(je=>je.id);Y.mutate(b,{onSuccess:()=>{u.success("Duplicates merged"),ge.refetch()},onError:()=>u.error("Merge failed")})},_t=s=>{X.mutate(s,{onSuccess:d=>{if(u.success("AI enrichment complete"),d?.suggestions){const f=d.suggestions,b=[];f.role&&b.push(`Role: ${f.role}`),f.department&&b.push(`Dept: ${f.department}`),f.tags&&b.push(`Tags: ${f.tags.join(", ")}`),b.length&&u.info(b.join(" | "))}B.refetch()},onError:()=>u.error("Enrichment failed")})},Mt=s=>{const d=s.target.files?.[0];if(!d)return;const f=new FileReader;f.onload=()=>{const b=f.result;if(d.name.endsWith(".csv"))fe.mutate({format:"csv",data:b},{onSuccess:Fe=>{u.success(`Imported ${Fe?.added||0} contacts`),O(!1)},onError:()=>u.error("Import failed")});else try{const Fe=JSON.parse(b);fe.mutate({format:"json",data:Fe},{onSuccess:Ut=>{u.success(`Imported ${Ut?.added||0} contacts`),O(!1)},onError:()=>u.error("Import failed")})}catch{u.error("Invalid JSON file")}},f.readAsText(d),s.target.value=""},zt=(s,d)=>{a.mutate({participantName:s,contactId:d},{onSuccess:()=>u.success(`Linked "${s}"`),onError:()=>u.error("Link failed")})};return n?e.jsxs("div",{className:"p-6 max-w-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:()=>{c(!1),p(null)},className:"w-8 h-8 rounded-lg bg-[var(--gm-bg-tertiary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(we,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsx("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:l?"Edit Contact":"Add Contact"})]}),e.jsx("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-5",children:e.jsx(zs,{contact:l,mode:l?"edit":"add",onSubmit:l?Tt:Ft,onCancel:()=>{c(!1),p(null)}})})]}):e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:"Contacts"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>y.mutate(void 0,{onSuccess:s=>u.success(`Synced: ${s?.added||0} added`),onError:()=>u.error("Sync failed")}),className:"px-2.5 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",title:"Sync people from documents to contacts",children:[e.jsx(cs,{className:`w-3.5 h-3.5 ${y.isPending?"animate-spin":""}`})," Sync People"]}),E.length>0&&e.jsxs("button",{onClick:()=>J(!H),className:"px-2.5 py-1.5 rounded-lg bg-amber-500/10 text-amber-600 text-xs hover:bg-amber-500/20 flex items-center gap-1.5",children:[e.jsx(Ge,{className:"w-3.5 h-3.5"})," ",E.length," Unmatched"]}),Z.length>0&&e.jsxs("button",{onClick:()=>I(!v),className:"px-2.5 py-1.5 rounded-lg bg-orange-500/10 text-orange-600 text-xs hover:bg-orange-500/20 flex items-center gap-1.5",children:[e.jsx(De,{className:"w-3.5 h-3.5"})," ",Z.length," Duplicate groups"]}),e.jsxs("button",{onClick:()=>{r(!C),T(new Set)},className:`px-2.5 py-1.5 rounded-lg text-xs flex items-center gap-1.5 ${C?"bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)]":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsx(Oe,{className:"w-3.5 h-3.5"})," Select"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"px-2.5 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ds,{className:"w-3.5 h-3.5"})," Export ",e.jsx(ms,{className:"w-3 h-3"})]}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-20 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>ve.mutate("json"),className:"w-full px-3 py-2 text-xs text-left hover:bg-[var(--gm-surface-hover)] flex items-center gap-2 rounded-t-lg",children:[e.jsx(Ns,{className:"w-3.5 h-3.5"})," JSON"]}),e.jsxs("button",{onClick:()=>ve.mutate("csv"),className:"w-full px-3 py-2 text-xs text-left hover:bg-[var(--gm-surface-hover)] flex items-center gap-2 rounded-b-lg",children:[e.jsx(As,{className:"w-3.5 h-3.5"})," CSV"]})]})]}),e.jsxs("button",{onClick:()=>M.current?.click(),className:"px-2.5 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ws,{className:"w-3.5 h-3.5"})," Import"]}),e.jsx("input",{ref:M,type:"file",accept:".json,.csv",className:"hidden",onChange:Mt}),e.jsxs("button",{onClick:()=>{p(null),c(!0)},className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-xs font-medium hover:bg-[var(--gm-interactive-primary-hover)] flex items-center gap-1.5",children:[e.jsx(Me,{className:"w-3.5 h-3.5"})," Add Contact"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"relative max-w-sm flex-1 min-w-[200px]",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{value:t,onChange:s=>i(s.target.value),placeholder:"Search contacts...",className:"w-full pl-9 pr-3 py-1.5 bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg text-xs text-[var(--gm-text-primary)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)]"})]}),e.jsxs("button",{onClick:()=>R(!P),className:`px-2.5 py-1.5 rounded-lg text-xs flex items-center gap-1.5 ${S||m||g?"bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)] border border-[var(--gm-accent-primary)]/30":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsx(Cs,{className:"w-3.5 h-3.5"})," Filters",(S||m||g)&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-[10px]",children:[S,m,g].filter(Boolean).length})]}),e.jsxs("button",{onClick:()=>$(!g),className:`px-2.5 py-1.5 rounded-lg text-xs flex items-center gap-1.5 ${g?"bg-amber-500/10 text-amber-500 border border-amber-500/30":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsx(ye,{className:`w-3.5 h-3.5 ${g?"fill-amber-500":""}`})," Favorites ",ne.length>0&&`(${ne.length})`]})]}),P&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Organization:"}),e.jsxs("select",{value:S,onChange:s=>F(s.target.value),className:"px-2 py-1 bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)] rounded text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"",children:"All"}),se.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Tag:"}),e.jsxs("select",{value:m,onChange:s=>N(s.target.value),className:"px-2 py-1 bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)] rounded text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"",children:"All"}),be.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),(S||m)&&e.jsx("button",{onClick:()=>{F(""),N("")},className:"text-xs text-[var(--gm-accent-primary)] hover:underline",children:"Clear filters"})]}),C&&h.size>0&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-[var(--gm-interactive-primary)]/5 border border-[var(--gm-accent-primary)]/20",children:[e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] font-medium",children:[h.size," selected"]}),e.jsxs("button",{onClick:Dt,disabled:h.size<2||Y.isPending,className:"px-2.5 py-1 rounded bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-xs flex items-center gap-1.5 disabled:opacity-50",children:[e.jsx(Ve,{className:"w-3.5 h-3.5"})," Merge Selected"]}),e.jsx("button",{onClick:()=>{T(new Set),r(!1)},className:"text-xs text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:"Cancel"})]}),H&&E.length>0&&e.jsxs("div",{className:"p-4 rounded-xl border border-amber-500/30 bg-amber-500/5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-amber-500"})," Unmatched Participants (",E.length,")"]}),e.jsx("button",{onClick:()=>J(!1),className:"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-[11px] text-[var(--gm-text-tertiary)]",children:"These names were found in documents but don't match any contact. Link them to existing contacts."}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:E.map(s=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)]",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)] flex-1",children:s.name}),s.count&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[s.count," mentions"]}),e.jsxs("select",{value:z[s.name]||"",onChange:d=>te(f=>({...f,[s.name]:d.target.value})),className:"px-2 py-1 bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded text-xs max-w-[150px]",children:[e.jsx("option",{value:"",children:"Link to..."}),A.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]}),e.jsxs("button",{disabled:!z[s.name],onClick:()=>z[s.name]&&zt(s.name,z[s.name]),className:"px-2 py-1 rounded bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-[10px] disabled:opacity-40 flex items-center gap-1",children:[e.jsx(Ze,{className:"w-3 h-3"})," Link"]})]},s.name))})]}),v&&Z.length>0&&e.jsxs("div",{className:"p-4 rounded-xl border border-orange-500/30 bg-orange-500/5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-orange-500"})," Duplicate Groups (",Z.length,")"]}),e.jsx("button",{onClick:()=>I(!1),className:"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:Z.map((s,d)=>{const f=Array.isArray(s)?s:s.contacts||[s];return e.jsxs("div",{className:"p-3 rounded-lg bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)] space-y-2",children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:["Group ",d+1," — Select primary"]}),f.map(b=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1 rounded hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("input",{type:"radio",name:`merge-group-${d}`,checked:_[d]===b.id,onChange:()=>G(je=>({...je,[d]:b.id})),className:"accent-primary"}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:b.name}),b.email&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["(",b.email,")"]})]},b.id)),e.jsxs("button",{onClick:()=>$t(d,f),disabled:!_[d]||Y.isPending,className:"px-2.5 py-1 rounded bg-orange-500 text-white text-xs disabled:opacity-50 flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"})," Merge Group"]})]},d)})})]}),ne.length>0&&!g&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-2 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3 fill-amber-500 text-amber-500"})," Favorites"]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:ne.map(s=>e.jsxs("button",{onClick:()=>j(s),className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] hover:border-[var(--gm-accent-primary)]/30 flex-shrink-0",children:[e.jsx(aa,{contact:s,size:"sm"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:s.name}),s.role&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:s.role})]})]},s.id))})]}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:[Q.length," contact",Q.length!==1?"s":""]}),B.isLoading?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(Pe,{className:"h-8 w-8 animate-spin text-[var(--gm-accent-primary)]"})}):Q.length===0?e.jsxs("div",{className:"rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] p-8 text-center text-[var(--gm-text-tertiary)]",children:[e.jsx(us,{className:"h-12 w-12 mx-auto mb-4 text-[var(--gm-text-tertiary)]/40"}),t||S||m?"No contacts match your filters.":"No contacts found. Add one to get started."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:Q.map(s=>{const d=s.is_favorite||s.isFavorite,f=h.has(s.id);return e.jsxs("div",{className:`bg-[var(--gm-surface-primary)] border rounded-xl p-4 hover:border-[var(--gm-accent-primary)]/30 transition-colors cursor-pointer group relative ${f?"border-[var(--gm-accent-primary)] bg-[var(--gm-interactive-primary)]/5":"border-[var(--gm-border-primary)]"}`,onClick:()=>C?Pt(s.id):j(s),children:[C&&e.jsx("div",{className:"absolute top-3 left-3 z-10",children:f?e.jsx(Oe,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}):e.jsx(Ss,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsx("button",{className:"absolute top-3 right-3 z-10 opacity-0 group-hover:opacity-100 transition-opacity",onClick:b=>{b.stopPropagation(),Et(s)},title:d?"Remove from favorites":"Add to favorites",children:e.jsx(ye,{className:`w-4 h-4 ${d?"fill-amber-500 text-amber-500":"text-[var(--gm-text-tertiary)] hover:text-amber-500"}`})}),e.jsx("button",{className:"absolute top-3 right-9 z-10 opacity-0 group-hover:opacity-100 transition-opacity",onClick:b=>{b.stopPropagation(),_t(s.id)},title:"Enrich with AI",children:e.jsx(Xe,{className:`w-4 h-4 text-violet-400 hover:text-violet-300 ${X.isPending?"animate-pulse":""}`})}),e.jsxs("div",{className:`flex items-center gap-3 ${C?"ml-5":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${At(s.name)} flex items-center justify-center flex-shrink-0 overflow-hidden`,children:me(s)?e.jsx("img",{src:me(s),alt:s.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-xs font-bold text-white",children:We(s.name)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate group-hover:text-[var(--gm-accent-primary)] transition-colors",children:[s.name||"(unnamed)",d&&e.jsx(ye,{className:"w-3 h-3 inline ml-1 fill-amber-500 text-amber-500"})]}),s.role&&e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(xe,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] truncate",children:s.role})]})]})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[s.organization&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx(_e,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.organization})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx(Ce,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx(ze,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.phone})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.tags.slice(0,4).map(b=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:b},b)),s.tags.length>4&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:["+",s.tags.length-4]})]})]})]},s.id)})}),e.jsx(sa,{contact:x,open:!!x,onClose:()=>j(null),onEdit:Rt,onDelete:It})]})}export{Fa as default};
//# sourceMappingURL=ContactsPage-Dv2IkQIW.js.map
