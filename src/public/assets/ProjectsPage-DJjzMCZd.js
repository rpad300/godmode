import{r,j as e}from"./vendor-react-CZ-WyKWZ.js";import{A as me,m as J,t as m}from"./vendor-ui-BS9QKitv.js";import{cf as ze,fg as Be,fh as qe,fi as Ve,fj as Ge,L as $,aX as Je,a9 as ie,c as P,F as te,aV as I,U as ee,A as Ae,ac as ue,a_ as ne,a$ as le,b0 as ce,b1 as oe,b2 as W,aa as xe,T as He,a8 as ae,ad as Q,g as de,fk as we,fl as Ce,fm as Ye,fn as Qe,fo as Xe,fp as We,fq as Ze,M as et,C as tt,fr as at,f as st,fs as rt,ft as it,fu as nt,fv as lt,fw as ct,X as pe,ch as ot,P as De,r as he,N as dt,d1 as mt,fx as xt,d3 as gt,fy as pt,bD as ht,l as ut,bA as vt,fz as yt,fA as jt,fB as bt,bo as ve,bp as ye,fC as je,bq as be}from"./main-B3DZn5B_.js";import{I as q}from"./input-Dy89fHlR.js";import{A as Te,a as Ie,b as Me,c as Re,d as Ee,e as Le,f as Fe,g as $e}from"./alert-dialog-Gr4VVHbM.js";import{U as Se}from"./upload-C00nhlDV.js";import{S as ke}from"./star-YHn3OJCl.js";import{P as ft}from"./play-BMZi0w5i.js";import{P as fe}from"./pen-UIQK8jUR.js";import{A as Nt}from"./arrow-left-BUrpeDp8.js";import{c as Ne}from"./vendor-markdown-Cu8AM8lU.js";import{U as ge}from"./user-plus-C5QYTMT3.js";import{U as wt}from"./users-round--q5NsWjF.js";import{K as Oe}from"./key-DhTDYaIg.js";import{G as _e}from"./grip-vertical-S1vCb_T3.js";import{L as Ct}from"./link-2-CvGSt01y.js";import{S as St}from"./square-check-big-DQbkmKDU.js";import{T as kt}from"./test-tube-C-LuB11X.js";import{S as _t}from"./sparkles-D3iJUPqd.js";import"./vendor-supabase-Bpw_79gH.js";import"./vendor-query-DSf7I7Ei.js";import"./vendor-router-D_XeKoA_.js";const Pt=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],At=Ne("settings-2",Pt);const Dt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],re=Ne("shield-check",Dt);const Tt=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],Ue=Ne("sliders-horizontal",Tt),Pe=[{id:"1",name:"Project Manager",description:"Oversees project execution and delivery",active:!0},{id:"2",name:"Tech Lead",description:"Technical leadership and architecture decisions",active:!0},{id:"3",name:"Product Owner",description:"Defines product vision and priorities",active:!0},{id:"4",name:"Designer",description:"UI/UX design and prototyping",active:!1},{id:"5",name:"QA Lead",description:"Quality assurance and testing strategy",active:!1},{id:"6",name:"DevOps",description:"Infrastructure and deployment automation",active:!1}],O="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",G="w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] transition-all duration-150",F="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",B="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",It="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50",Z="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",L="text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-1 flex items-center gap-1.5",Mt=[{id:"general",label:"General",icon:At},{id:"members",label:"Members",icon:ee,count:0},{id:"invites",label:"Invites",icon:ge},{id:"teams",label:"Teams",icon:wt},{id:"roles",label:"Roles",icon:re},{id:"categories",label:"Categories",icon:Ue},{id:"providers",label:"AI Providers",icon:Oe},{id:"documents",label:"Documents",icon:te},{id:"activity",label:"Activity",icon:Ae}],ua=()=>{const{projects:a,refreshProjects:o,currentProjectId:w}=ze(),[h,u]=r.useState(null),x=Be(),f=qe(),j=Ve(),y=Ge(),[c,l]=r.useState(!1),[d,C]=r.useState(""),[n,p]=r.useState(""),M=a.find(v=>v.id===h)||null,[T,t]=r.useState(a.length===0),[k,R]=r.useState(""),[S,V]=r.useState(""),[U,K]=r.useState([]),[b,N]=r.useState(""),[s,_]=r.useState(""),[A,g]=r.useState(!1),i=v=>{x.mutate(v,{onSuccess:()=>{m.success("Project activated"),o()},onError:()=>m.error("Failed to activate project")})},E=v=>{f.mutate(v,{onSuccess:()=>{m.success("Default project set"),o()},onError:()=>m.error("Failed to set default")})},D=()=>{j.mutate(void 0,{onSuccess:v=>{const Y=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),X=URL.createObjectURL(Y),se=document.createElement("a");se.href=X,se.download=`project-export-${Date.now()}.json`,se.click(),URL.revokeObjectURL(X),m.success("Project exported")},onError:()=>m.error("Export failed")})},H=()=>{try{const v=JSON.parse(d);y.mutate({data:v,name:n||void 0},{onSuccess:()=>{m.success("Project imported"),l(!1),C(""),p(""),o()},onError:()=>m.error("Import failed")})}catch{m.error("Invalid JSON data")}},z=async()=>{try{const v=await I.get("/api/companies");v.companies&&(K(v.companies),v.companies.length>0&&!b?N(v.companies[0].id):v.companies.length===0&&N("__new__"))}catch(v){console.error("Failed to fetch companies:",v)}};r.useEffect(()=>{z()},[]),r.useEffect(()=>{a.length===0&&t(!0)},[a]);const Ke=async()=>{if(!k.trim()){m.error("Please enter a project name.");return}const v=b==="__new__"||U.length===0;if(v&&!s.trim()){m.error("Please enter a company name.");return}if(!v&&!b){m.error("Please select a company or create a new one.");return}try{g(!0);const Y={name:k,description:S};!v&&b?Y.company_id=b:Y.new_company_name=s.trim(),await I.post("/api/projects",Y),R(""),V(""),_(""),N(""),t(!1),o(),z(),m.success("Project created successfully")}catch(Y){console.error("Failed to create project:",Y),m.error(Y instanceof Error?Y.message:"Failed to create project")}finally{g(!1)}};return h&&M?e.jsx(Rt,{project:M,onBack:()=>u(null),onUpdate:o}):(h&&!M&&u(null),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("h1",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:"Projects"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:D,disabled:j.isPending,className:B,children:[j.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Je,{className:"w-3.5 h-3.5"})," Export"]}),e.jsxs("button",{onClick:()=>l(!c),className:B,children:[e.jsx(Se,{className:"w-3.5 h-3.5"})," Import"]}),e.jsxs("button",{onClick:()=>t(!T),className:F,children:[e.jsx(ie,{className:"w-3.5 h-3.5"})," New Project"]})]})]}),e.jsx(me,{children:c&&e.jsxs(J.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:P(O,"p-5"),children:[e.jsx("h3",{className:Z,children:"Import Project"}),e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Project Name (optional)"}),e.jsx("input",{value:n,onChange:v=>p(v.target.value),placeholder:"Project name...",className:G})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"JSON Data"}),e.jsx("textarea",{value:d,onChange:v=>C(v.target.value),placeholder:"Paste exported JSON data here...",rows:5,className:P(G,"resize-none font-mono")})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>l(!1),className:B,children:"Cancel"}),e.jsxs("button",{onClick:H,disabled:y.isPending||!d.trim(),className:F,children:[y.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Se,{className:"w-3.5 h-3.5"})," Import"]})]})]})]})}),e.jsx(me,{children:T&&e.jsxs(J.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:P(O,"p-5"),children:[e.jsx("h3",{className:Z,children:"Create New Project"}),e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Project Name *"}),e.jsx("input",{value:k,onChange:v=>R(v.target.value),placeholder:"Project name...",className:G})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Description"}),e.jsx("textarea",{value:S,onChange:v=>V(v.target.value),placeholder:"Description...",rows:2,className:P(G,"resize-none")})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Company"}),e.jsxs("select",{value:b,onChange:v=>{N(v.target.value),v.target.value!=="__new__"&&_("")},className:G,children:[U.length>0&&e.jsx("option",{value:"",children:"Select a company..."}),U.map(v=>e.jsx("option",{value:v.id,children:v.name},v.id)),e.jsx("option",{value:"__new__",children:"+ Create new company"})]}),(b==="__new__"||U.length===0)&&e.jsx("input",{value:s,onChange:v=>_(v.target.value),placeholder:"New company name...",className:P(G,"mt-2"),autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-2",children:[e.jsx("button",{onClick:()=>t(!1),className:B,children:"Cancel"}),e.jsxs("button",{onClick:Ke,disabled:A,className:F,children:[A?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"}),A?"Creating...":"Create"]})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[a.length===0&&!T&&e.jsxs("div",{className:P(O,"p-8 text-center"),children:[e.jsx(te,{className:"w-10 h-10 mx-auto text-[var(--gm-text-placeholder)] mb-3"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-secondary)]",children:"No projects yet"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-1",children:'Click "New Project" above to get started'})]}),a.map((v,Y)=>{const X=w===v.id,se=v.is_default===!0;return e.jsx(J.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{delay:Y*.06},className:P(O,"p-5",X&&"border-[var(--gm-accent-primary)]/40 ring-1 ring-[var(--gm-accent-primary)]/20"),children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:P("w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",X?"bg-[var(--gm-interactive-primary)]/10":"bg-[var(--gm-bg-tertiary)]"),children:e.jsx(te,{className:P("w-5 h-5",X?"text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)]")})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:v.name||"(unnamed project)"}),X&&e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)]",children:"Active"}),se&&e.jsxs("span",{className:"text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-500 flex items-center gap-0.5",children:[e.jsx(ke,{className:"w-2.5 h-2.5"})," Default"]})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono",children:v.id}),v.description&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate max-w-md",children:v.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[!X&&e.jsxs("button",{onClick:()=>i(v.id),disabled:x.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-lg bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)] text-[10px] font-medium hover:bg-[var(--gm-interactive-primary)]/20 transition-colors",children:[e.jsx(ft,{className:"w-3 h-3"})," Switch"]}),!se&&e.jsx("button",{onClick:()=>E(v.id),disabled:f.isPending,className:B,title:"Set as default project",children:e.jsx(ke,{className:"w-3 h-3"})}),e.jsxs("button",{onClick:()=>u(v.id),className:B,children:[e.jsx(fe,{className:"w-3 h-3"})," Edit"]})]})]})},v.id)})]})]}))};function Rt({project:a,onBack:o,onUpdate:w}){const[h,u]=r.useState("general"),[x,f]=r.useState([]),[j,y]=r.useState(!1),c=async()=>{try{y(!0);const d=await I.get(`/api/projects/${a.id}/members`);d.members&&f(d.members)}catch(d){console.error("Failed to fetch members:",d)}finally{y(!1)}},l=()=>{w(),h==="members"&&c()};return r.useEffect(()=>{c()},[a.id]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:o,className:"flex items-center gap-1.5 text-xs text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors mb-2",children:[e.jsx(Nt,{className:"w-3.5 h-3.5"})," Back to Projects"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[var(--gm-interactive-primary)]/10 flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-[var(--gm-accent-primary)]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:a.name||"(unnamed project)"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:a.description||"No description"})]})]}),e.jsx("div",{className:"flex border-b border-[var(--gm-border-primary)] overflow-x-auto",children:Mt.map(d=>e.jsxs("button",{onClick:()=>u(d.id),className:`flex items-center gap-1.5 px-3 py-2.5 text-xs font-medium transition-colors border-b-2 whitespace-nowrap ${h===d.id?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent hover:text-[var(--gm-text-primary)]"}`,children:[e.jsx(d.icon,{className:"w-4 h-4"}),d.label,(d.id==="members"?x.length:d.count)!==void 0&&e.jsx("span",{className:"text-[10px] bg-[var(--gm-bg-tertiary)] px-1.5 py-0.5 rounded-full",children:d.id==="members"?x.length:d.count})]},d.id))}),e.jsxs("div",{children:[h==="general"&&e.jsx(Lt,{project:a,onUpdate:w,onBack:o}),h==="members"&&e.jsx(Ft,{project:a,members:x,loading:j,onUpdate:c}),h==="roles"&&e.jsx(Ot,{project:a,onUpdate:l}),h==="categories"&&e.jsx(Kt,{project:a,members:x,onUpdate:w}),h==="invites"&&e.jsx(Bt,{projectId:a.id}),h==="teams"&&e.jsx(qt,{}),h==="providers"&&e.jsx(Vt,{projectId:a.id}),h==="documents"&&e.jsx(Gt,{}),h==="activity"&&e.jsx(Jt,{projectId:a.id})]})]})}function Et({projectId:a}){const{data:o,isLoading:w}=bt(a);if(w||!o)return null;const u=Object.entries(o).filter(([,x])=>typeof x=="number").slice(0,8);return u.length===0?null:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4",children:u.map(([x,f])=>e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg px-3 py-2 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:String(f)}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:x.replace(/[_-]/g," ")})]},x))})}function Lt({project:a,onUpdate:o,onBack:w}){const[h,u]=r.useState(a.name),[x,f]=r.useState(a.description),[j,y]=r.useState(a.role||""),[c,l]=r.useState(a.rolePrompt||""),[d,C]=r.useState(a.company_id||a.company?.id||""),[n,p]=r.useState(!1),[M,T]=r.useState(!1),[t,k]=r.useState(!1),[R,S]=r.useState([]),[V,U]=r.useState([]);r.useEffect(()=>{I.get("/api/role-templates").then(N=>S(N.roles||[])).catch(()=>{}),I.get("/api/companies").then(N=>{N.companies&&U(N.companies)}).catch(()=>{})},[]);const K=async()=>{if(!h.trim()){m.error("Project name is required");return}p(!0);try{await I.put(`/api/projects/${a.id}`,{name:h,description:x,role:j,rolePrompt:c,company_id:d}),m.success("Project updated"),o()}catch(N){m.error(N.message||"Failed to update project")}finally{p(!1)}},b=async()=>{T(!0);try{await I.delete(`/api/projects/${a.id}`),m.success("Project deleted"),o(),w()}catch(N){m.error(N.message||"Failed to delete project")}finally{T(!1),k(!1)}};return e.jsxs(J.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx(Et,{projectId:a.id}),e.jsxs("div",{className:P(O,"p-5 space-y-5"),children:[e.jsxs("div",{children:[e.jsxs("label",{className:L,children:[e.jsx(te,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})," Project Name *"]}),e.jsx(q,{value:h,onChange:N=>u(N.target.value),className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"â‰¡ Description"}),e.jsx("textarea",{value:x,onChange:N=>f(N.target.value),placeholder:"Brief description of the project",rows:4,className:P(G,"resize-y")})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:L,children:[e.jsx(ue,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})," Your Role"]}),e.jsxs(ne,{value:j,onValueChange:y,children:[e.jsx(le,{className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm",children:e.jsx(ce,{placeholder:"Select role..."})}),e.jsx(oe,{children:R.filter(N=>N.name||N.display_name).map(N=>e.jsx(W,{value:N.display_name||N.name,children:N.display_name||N.name},N.id||N.name))})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Your role in this project (used for AI context)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"ðŸ’¬ Role Prompt"}),e.jsx(q,{value:c,onChange:N=>l(N.target.value),className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Brief description of your responsibilities"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:L,children:[e.jsx(te,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})," Company"]}),e.jsxs(ne,{value:d,onValueChange:C,children:[e.jsx(le,{className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm",children:e.jsx(ce,{placeholder:"Select company..."})}),e.jsx(oe,{children:V.map(N=>e.jsx(W,{value:N.id,children:N.name},N.id))})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Templates and branding from this company will be used in reports"})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{onClick:K,disabled:n,className:F,children:[n?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(xe,{className:"w-4 h-4"}),n?"Saving...":"Save Changes"]})})]}),e.jsxs("div",{className:"border border-[var(--color-danger-500)]/30 bg-[var(--color-danger-500)]/5 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--color-danger-500)] mb-1 flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"})," Danger Zone"]}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-3",children:"Deleting a project will permanently remove all associated data including questions, decisions, risks, and contacts."}),t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:b,disabled:M,className:It,children:[M?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(ae,{className:"w-4 h-4"}),M?"Deleting...":"Confirm Delete"]}),e.jsx("button",{onClick:()=>k(!1),className:B,children:"Cancel"})]}):e.jsxs("button",{onClick:()=>k(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-[var(--color-danger-500)]/30 text-[var(--color-danger-500)] text-sm font-medium hover:bg-[var(--color-danger-500)]/10 transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"})," Delete Project"]})]})]})}function Ft({project:a,members:o,loading:w,onUpdate:h}){const[u,x]=r.useState(!1),[f,j]=r.useState(null),[y,c]=r.useState(null),[l,d]=r.useState("list"),[C,n]=r.useState([]),[p,M]=r.useState(!1);r.useEffect(()=>{T()},[a.id]);const T=async()=>{try{M(!0);const s=await I.get(`/api/projects/${a.id}/categories`);n(s)}catch(s){console.error("Failed to fetch categories:",s)}finally{M(!1)}},t=async()=>{if(y)try{j(y.user_id),await I.delete(`/api/projects/${a.id}/members/${y.user_id}`),h()}catch(s){console.error("Failed to remove member:",s),m.error("Failed to remove member")}finally{j(null),c(null)}},k=async(s,_)=>{try{await I.put(`/api/projects/${a.id}/members/${s}`,{user_role:_}),h()}catch(A){console.error("Failed to update member role:",A)}},R=s=>o.filter(_=>{const A=_.user_role||_.role;return a.settings?.roles?.find(E=>E.name===A)?.category===s.id}),S=(s,_)=>{s.dataTransfer.setData("text/plain",_),s.dataTransfer.effectAllowed="move"},V=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},U=async(s,_)=>{s.preventDefault();const A=s.dataTransfer.getData("text/plain");if(!A)return;const g=o.find(D=>D.user_id===A);if(!g)return;let i="";if(_){const D=a.settings?.roles?.filter(H=>H.category===_)||[];D.length>0?i=D[0].name:i=(D.find(z=>z.name==="Member")||D[0])?.name||"Member"}else i="";const E=g.user_role||g.role;i!==E&&await k(A,i)},K=()=>o.filter(s=>{const _=s.user_role||s.role,A=a.settings?.roles?.find(i=>i.name===_),g=!A||!A.category||!C.find(i=>i.id===A.category);return g&&s.display_name==="RPAD"&&console.log("Unassigned Debug (RPAD):",{memberRole:_,roleFound:!!A,roleCategory:A?.category,catExists:!!C.find(i=>i.id===A?.category)}),g}),b=async(s,_)=>{try{const A={...a.settings,category_leads:{...a.settings?.category_leads,[s]:_}};await I.put(`/api/projects/${a.id}`,{settings:A}),h()}catch(A){console.error("Failed to set lead:",A),m.error("Failed to set team lead")}},N=o.map(s=>s.linked_contact?.id).filter(s=>!!s);return e.jsxs(J.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:P(O,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"})," TEAM MEMBERS (",o.length,")"]}),e.jsxs("div",{className:"flex bg-[var(--gm-bg-tertiary)] rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>d("list"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${l==="list"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"}`,children:"List"}),e.jsx("button",{onClick:()=>d("teams"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${l==="teams"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"}`,children:"Teams"})]})]}),e.jsxs("button",{onClick:()=>x(!0),className:F,children:[e.jsx(ee,{className:"w-4 h-4"})," Invite"]})]}),w||p?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--gm-accent-primary)] border-t-transparent rounded-full animate-spin"})}):o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center mb-3",children:e.jsx(ee,{className:"w-8 h-8 text-[var(--gm-text-tertiary)]"})}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] mb-4",children:"No team members yet"}),e.jsx("button",{onClick:()=>x(!0),className:F,children:"Invite Member"})]}):l==="list"?e.jsx("div",{className:"grid gap-3",children:o.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)]/20 hover:bg-[var(--gm-bg-tertiary)]/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[Q(s.avatar_url)||Q(s.linked_contact?.avatar_url)?e.jsx("img",{src:Q(s.avatar_url)?s.avatar_url:s.linked_contact?.avatar_url,alt:s.display_name||s.linked_contact?.name||"Member",className:"w-10 h-10 rounded-full object-cover bg-[var(--gm-bg-tertiary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-interactive-primary)]/10 flex items-center justify-center text-[var(--gm-accent-primary)] font-bold",children:de(s.display_name||s.username||s.linked_contact?.name)}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:s.display_name||s.linked_contact?.name||s.username||"Unknown User"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[var(--gm-text-tertiary)]",children:[e.jsx("span",{children:s.user_role||s.role}),s.linked_contact?.organization&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:s.linked_contact.organization})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-right text-[var(--gm-text-tertiary)]",children:e.jsxs("p",{children:["Joined ",s.joined_at?new Date(s.joined_at).toLocaleDateString():"â€”"]})}),e.jsx("button",{onClick:()=>c(s),disabled:f===s.user_id,className:"p-2 text-[var(--gm-text-tertiary)] hover:text-[var(--color-danger-500)] transition-colors disabled:opacity-50",children:f===s.user_id?e.jsx("div",{className:"w-4 h-4 border-2 border-[var(--color-danger-500)] border-t-transparent rounded-full animate-spin"}):e.jsx(ae,{className:"w-4 h-4"})})]})]},s.user_id))}):e.jsxs("div",{className:"space-y-4",children:[C.map(s=>{const _=R(s),A=a.settings?.category_leads?.[s.id],g=o.find(i=>i.user_id===A);return e.jsxs(J.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},className:P(O,"p-5"),onDragOver:V,onDrop:i=>U(i,s.id),children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${s.color||"blue"}-500/10 text-${s.color||"blue"}-500`,children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[s.display_name,e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:_.length})]}),g&&e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)] flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3 text-amber-500"}),"Lead: ",e.jsx("span",{className:"font-medium text-[var(--gm-text-primary)]",children:g.display_name})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[_.map(i=>{const E=A===i.user_id;return e.jsxs("div",{className:`flex items-center gap-4 p-3 rounded-xl border transition-all cursor-grab active:cursor-grabbing group relative ${E?"bg-amber-500/5 border-amber-500/20":"bg-[var(--gm-bg-primary)] border-[var(--gm-border-primary)] hover:border-[var(--gm-accent-primary)]/30"}`,draggable:!0,onDragStart:D=>S(D,i.user_id),children:[e.jsxs("div",{className:"relative",children:[Q(i.avatar_url)||Q(i.linked_contact?.avatar_url)?e.jsx("img",{src:Q(i.avatar_url)?i.avatar_url:i.linked_contact?.avatar_url,alt:i.display_name,className:"w-10 h-10 rounded-full object-cover border border-[var(--gm-border-primary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center text-sm font-bold text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:de(i.display_name)}),E&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-amber-500 text-white rounded-full p-0.5 border-2 border-[var(--gm-bg-primary)]",children:e.jsx(re,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate",children:i.display_name}),i.linked_contact?.organization&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] truncate max-w-[100px]",children:i.linked_contact.organization})]}),e.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:e.jsxs(ne,{value:i.user_role||i.role||"",onValueChange:D=>k(i.user_id,D==="no-role"?"":D),children:[e.jsx(le,{className:"h-5 text-[11px] bg-transparent border-none p-0 text-[var(--gm-text-tertiary)] focus:ring-0 shadow-none w-auto gap-1 hover:text-[var(--gm-text-primary)]",children:e.jsx(ce,{placeholder:"No Role"})}),e.jsxs(oe,{children:[e.jsx(W,{value:"no-role",children:"No Role"}),C.map(D=>{const H=a.settings?.roles?.filter(z=>z.category===D.id)||[];return H.length===0?null:e.jsxs(we,{children:[e.jsx(Ce,{className:"text-[10px] font-bold text-[var(--gm-text-tertiary)] px-2 py-1.5",children:D.display_name}),H.map(z=>e.jsx(W,{value:z.name,className:"text-[10px]",children:z.name},z.id))]},D.id)})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:D=>{D.preventDefault(),D.stopPropagation(),b(s.id,i.user_id)},className:`p-2 rounded-lg transition-colors ${E?"text-amber-500 bg-amber-500/10 hover:bg-amber-500/20":"text-[var(--gm-text-tertiary)] hover:text-amber-500 hover:bg-amber-500/10"}`,title:E?"Current Team Lead":"Make Team Lead",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-4 bg-[var(--gm-border-primary)] mx-1"}),e.jsx("div",{className:"p-2 text-[var(--gm-text-tertiary)] cursor-grab active:cursor-grabbing",children:e.jsx(_e,{className:"w-4 h-4"})})]})]},i.user_id)}),_.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center border border-dashed border-[var(--gm-border-primary)]/50 rounded-xl bg-[var(--gm-bg-tertiary)]/5",children:[e.jsx(ee,{className:"w-8 h-8 text-[var(--gm-text-tertiary)]/30 mb-2"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["Drag members here to assign them to ",s.display_name]})]})]})]},s.id)}),K().length>0&&e.jsxs(J.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] border-dashed rounded-xl p-5",onDragOver:V,onDrop:s=>U(s,null),children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500 animate-pulse"}),"Unassigned Members",e.jsx("span",{className:"text-[10px] bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] px-2 py-0.5 rounded-full",children:K().length})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:K().map(s=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-bg-tertiary)]/10 border border-[var(--gm-border-primary)]/50 hover:border-amber-500/50 rounded-xl p-3 cursor-grab active:cursor-grabbing group relative transition-colors",draggable:!0,onDragStart:_=>S(_,s.user_id),children:[e.jsxs("div",{className:"relative",children:[Q(s.avatar_url)||Q(s.linked_contact?.avatar_url)?e.jsx("img",{src:Q(s.avatar_url)?s.avatar_url:s.linked_contact?.avatar_url,alt:s.display_name,className:"w-10 h-10 rounded-full object-cover border border-[var(--gm-border-primary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center text-sm font-bold text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:(s.display_name?.[0]||"?").toUpperCase()}),e.jsx("div",{className:"absolute -top-1 -right-1 bg-amber-500 text-white rounded-full p-0.5 w-4 h-4 flex items-center justify-center text-[10px]",children:"!"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate",children:s.display_name})}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsxs(ne,{value:s.user_role||s.role||"",onValueChange:_=>k(s.user_id,_),children:[e.jsx(le,{className:"h-6 text-[11px] bg-[var(--gm-bg-primary)] border-[var(--gm-border-primary)] w-full",children:e.jsx(ce,{placeholder:"Select Role..."})}),e.jsxs(oe,{children:[e.jsx(W,{value:"no-role",children:"No Role"}),C.map(_=>{const A=a.settings?.roles?.filter(g=>g.category===_.id)||[];return A.length===0?null:e.jsxs(we,{children:[e.jsx(Ce,{className:"text-[10px] font-bold text-[var(--gm-text-tertiary)] px-2 py-1.5",children:_.display_name}),A.map(g=>e.jsx(W,{value:g.name,className:"text-[10px]",children:g.name},g.id))]},_.id)})]})]})})]}),e.jsx("div",{className:"text-[var(--gm-text-tertiary)] opacity-50 group-hover:opacity-100",children:e.jsx(_e,{className:"w-4 h-4"})})]},s.user_id))})]})]})]}),e.jsx($t,{open:u,onClose:()=>x(!1),projectId:a.id,onMemberAdded:h,existingContactIds:N}),e.jsx(Te,{open:!!y,onOpenChange:s=>!s&&c(null),children:e.jsxs(Ie,{children:[e.jsxs(Me,{children:[e.jsx(Re,{children:"Remove Team Member"}),e.jsxs(Ee,{children:["Are you sure you want to remove ",e.jsx("strong",{children:y?.display_name||y?.linked_contact?.name||"this member"})," from the project? This action cannot be undone."]})]}),e.jsxs(Le,{children:[e.jsx(Fe,{children:"Cancel"}),e.jsx($e,{onClick:t,className:"bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)]",children:"Remove Member"})]})]})})]})}function $t({open:a,onClose:o,projectId:w,onMemberAdded:h,existingContactIds:u=[]}){const[x,f]=r.useState("contacts"),[j,y]=r.useState(""),[c,l]=r.useState(""),[d,C]=r.useState(null),[n,p]=r.useState([]),[M,T]=r.useState(!1),[t,k]=r.useState(!1),[R,S]=r.useState(!1);r.useEffect(()=>{a&&x==="contacts"&&V()},[a,x]);const V=async()=>{try{T(!0);const b=await I.get("/api/contacts");if(b.contacts){const N=b.contacts.filter(s=>!u.includes(s.id));p(N)}}catch(b){console.error("Failed to fetch contacts:",b)}finally{T(!1)}},U=async()=>{if(!j.trim()){m.error("Please enter an email address");return}S(!0);try{await I.post(`/api/projects/${w}/members/invite`,{email:j.trim(),message:c.trim()||void 0}),m.success("Invitation sent"),y(""),l(""),h(),o()}catch(b){m.error(b.message||"Failed to send invitation")}finally{S(!1)}},K=async()=>{if(d)try{k(!0),await I.post(`/api/projects/${w}/members/add-contact`,{contact_id:d}),h(),o()}catch(b){console.error("Failed to add contact:",b),m.error("Failed to add contact to team")}finally{k(!1)}};return e.jsx(ve,{open:a,onOpenChange:o,children:e.jsxs(ye,{className:"sm:max-w-[500px] bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsx(je,{children:e.jsx(be,{className:"text-[var(--gm-text-primary)]",children:"Invite Team Member"})}),e.jsxs("div",{className:"flex border-b border-[var(--gm-border-primary)] mb-4",children:[e.jsx("button",{onClick:()=>f("email"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${x==="email"?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent"}`,children:"New Email"}),e.jsx("button",{onClick:()=>f("contacts"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${x==="contacts"?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent"}`,children:"Existing Contacts"})]}),x==="email"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Email Address *"}),e.jsx(q,{value:j,onChange:b=>y(b.target.value),placeholder:"colleague@example.com",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"They will receive an email invitation to join this project"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Access Level"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:"Member - Can view and edit data"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"You can assign a project role after they join."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Personal Message (optional)"}),e.jsx("textarea",{value:c,onChange:b=>l(b.target.value),placeholder:"Add a personal note to the invitation...",rows:3,className:P(G,"resize-none")})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:o,className:B,children:"Cancel"}),e.jsx("button",{onClick:U,disabled:R||!j.trim(),className:F,children:R?"Sending...":"Send Invitation"})]})]}):e.jsxs("div",{className:"space-y-3",children:[M?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--gm-accent-primary)] border-t-transparent rounded-full animate-spin"})}):n.length===0?e.jsx("div",{className:"text-center py-8 text-[var(--gm-text-tertiary)] text-sm",children:"No contacts found."}):e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto scrollbar-thin pr-1",children:n.map(b=>e.jsxs("div",{onClick:()=>C(b.id),className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer border transition-all ${d===b.id?"bg-[var(--gm-interactive-primary)]/10 border-[var(--gm-accent-primary)] shadow-[var(--shadow-sm)]":"bg-[var(--gm-surface-primary)] hover:bg-[var(--gm-surface-hover)] border-[var(--gm-border-primary)] hover:border-[var(--gm-border-primary)]/80"}`,children:[e.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center transition-colors ${d===b.id?"border-[var(--gm-accent-primary)] bg-[var(--gm-interactive-primary)]":"border-[var(--gm-text-tertiary)]"}`,children:d===b.id&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[var(--gm-text-on-brand)]"})}),he(b)?e.jsx("img",{src:he(b),alt:b.name,className:"w-10 h-10 rounded-full object-cover bg-[var(--gm-bg-tertiary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-interactive-primary)]/10 flex items-center justify-center text-[var(--gm-accent-primary)] font-bold text-sm",children:de(b.name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${d===b.id?"text-[var(--gm-accent-primary)]":"text-[var(--gm-text-primary)]"}`,children:b.name||"(unnamed)"}),e.jsxs("div",{className:"flex flex-col gap-0.5",children:[b.organization&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-medium",children:b.organization}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] truncate",children:b.email||"No email"})]})]}),b.role&&e.jsx("div",{className:"text-[10px] px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]",children:b.role})]},b.id))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Access Level"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:"Member - Can view and edit data"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:K,disabled:!d||t,className:P(F,"disabled:cursor-not-allowed"),children:[t?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(ee,{className:"w-4 h-4"}),"Add to Team"]})}),e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] space-y-0.5",children:e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-[var(--gm-accent-primary)]",children:"Add to Team:"})," Adds contact as team member directly."]})})]})]})})}function Ot({project:a,onUpdate:o}){const[w,h]=r.useState(!1),[u,x]=r.useState(null),[f,j]=r.useState([]);r.useEffect(()=>{y()},[a.id]);const y=async()=>{try{const n=await I.get(`/api/projects/${a.id}/categories`);j(n)}catch(n){console.error("Failed to fetch categories:",n)}},c=a.settings?.roles||[];[...Pe].map(n=>(c.find(p=>p.name===n.name),n));const d=[...c];Pe.forEach(n=>{d.find(p=>p.name===n.name)||d.push({...n,active:!1,id:`template-${n.id}`})});const C=async n=>{try{if(x(n.id),n.id.toString().startsWith("template-")){const p={name:n.name,description:n.description,active:!0};await I.post(`/api/projects/${a.id}/roles`,p)}else await I.put(`/api/projects/${a.id}/roles/${n.id}`,{active:!n.active});o()}catch(p){console.error("Error toggling role:",p),m.error("Failed to update role")}finally{x(null)}};return e.jsxs(J.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:P(O,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"})," PROJECT ROLES"]}),e.jsxs("button",{onClick:()=>h(!0),className:F,children:[e.jsx(ie,{className:"w-4 h-4"})," Add Role"]})]}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-4",children:"Define roles and responsibilities for this project."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:d.map(n=>e.jsxs("div",{className:`p-4 rounded-xl border transition-colors ${n.active===!0?"border-[var(--gm-accent-primary)]/30 bg-[var(--gm-interactive-primary)]/5":"border-[var(--gm-border-primary)]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0 ${n.active===!0?"bg-[var(--gm-interactive-primary)]/10":"bg-[var(--gm-bg-tertiary)]"}`,children:e.jsx(ue,{className:`w-4 h-4 ${n.active===!0?"text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)]"}`})}),e.jsx("h4",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:n.name||"(unnamed role)"})]}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-3",children:n.description||"â€”"}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.active===!0,onChange:()=>C(n),disabled:!!u,className:"accent-[var(--gm-accent-primary)] w-4 h-4"}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:u===n.id?"Updating...":n.active===!0?"Active":"Inactive"})]}),n.active&&e.jsxs("select",{className:"max-w-[120px] text-[10px] bg-[var(--gm-bg-tertiary)]/50 border-none rounded px-2 py-1 text-[var(--gm-text-primary)] focus:ring-0",value:n.category||"",onChange:async p=>{const M=p.target.value;try{n.id.toString().startsWith("template-")||(await I.put(`/api/projects/${a.id}/roles/${n.id}`,{category:M}),o())}catch(T){console.error("Failed to update role category",T)}},children:[e.jsx("option",{value:"",children:"No Category"}),f.map(p=>e.jsx("option",{value:p.id,children:p.display_name},p.id))]})]})]},n.id))})]}),e.jsx(Ut,{open:w,onClose:()=>h(!1),projectId:a.id,onRoleAdded:o})]})}function Ut({open:a,onClose:o,projectId:w,onRoleAdded:h}){const[u,x]=r.useState(""),[f,j]=r.useState(""),[y,c]=r.useState([]),[l,d]=r.useState(!1),[C,n]=r.useState(""),[p,M]=r.useState(""),[T,t]=r.useState(!1);r.useEffect(()=>{a&&k()},[a]);const k=async()=>{try{d(!0);const S=await I.get(`/api/projects/${w}/categories`);c(S),S.length>0&&!f&&j(S[0].id)}catch(S){console.error("Failed to fetch categories:",S)}finally{d(!1)}},R=async()=>{if(u.trim())try{t(!0),await I.post(`/api/projects/${w}/roles`,{name:u,category:f,description:C,role_context:p,active:!0}),h(),o(),x(""),n(""),M(""),y.length>0&&j(y[0].id)}catch(S){console.error("Error creating role:",S),m.error("Failed to create role")}finally{t(!1)}};return e.jsx(ve,{open:a,onOpenChange:o,children:e.jsxs(ye,{className:"sm:max-w-[450px] bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsx(je,{children:e.jsx(be,{className:"text-[var(--gm-text-primary)]",children:"Add New Role"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Role Name *"}),e.jsx(q,{value:u,onChange:S=>x(S.target.value),placeholder:"e.g., Senior Developer, Tech Lead",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Category"}),e.jsx("select",{value:f,onChange:S=>j(S.target.value),disabled:l,className:G,children:l?e.jsx("option",{children:"Loading categories..."}):y.map(S=>e.jsx("option",{value:S.id,children:S.display_name},S.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Description"}),e.jsx(q,{value:C,onChange:S=>n(S.target.value),placeholder:"Brief description of this role",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Role Context (for AI)"}),e.jsx("textarea",{value:p,onChange:S=>M(S.target.value),placeholder:"Describe this role's responsibilities, priorities, and how the AI should adapt responses...",rows:4,className:P(G,"resize-y")})]}),e.jsxs("button",{onClick:()=>m.info("AI enhancement will use the project context to suggest role descriptions"),className:"flex items-center gap-2 text-sm text-[var(--gm-accent-primary)] font-medium hover:text-[var(--gm-accent-primary)]/80 transition-colors",children:[e.jsx(_t,{className:"w-4 h-4"})," Enhance with AI"]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:o,className:B,children:"Cancel"}),e.jsx("button",{onClick:R,disabled:T||!u.trim(),className:F,children:T?"Creating...":"Create Role"})]})]})})}function Kt({project:a,members:o,onUpdate:w}){const[h,u]=r.useState([]),[x,f]=r.useState(!1),[j,y]=r.useState(!1),[c,l]=r.useState(null),[d,C]=r.useState(null),n=async()=>{try{f(!0);const t=await I.get(`/api/projects/${a.id}/categories`);u(t)}catch(t){console.error("Failed to fetch categories:",t)}finally{f(!1)}};r.useEffect(()=>{n()},[a.id]);const p=t=>{C(t)},M=async()=>{if(d)try{await I.delete(`/api/projects/${a.id}/categories/${d.id}`),n()}catch(t){console.error("Failed to delete category:",t),m.error("Failed to delete category")}finally{C(null)}},T=async(t,k)=>{try{const R=a.settings?.category_leads||{},S={...a.settings,category_leads:{...R,[t]:k}};await I.put(`/api/projects/${a.id}`,{settings:S}),w()}catch(R){console.error("Failed to set lead:",R),m.error("Failed to set team lead")}};return e.jsxs(J.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:P(O,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"})," PROJECT CATEGORIES"]}),e.jsxs("button",{onClick:()=>{l(null),y(!0)},className:F,children:[e.jsx(ie,{className:"w-4 h-4"})," Add Category"]})]}),x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--gm-accent-primary)] border-t-transparent rounded-full animate-spin"})}):h.length===0?e.jsx("div",{className:"text-center py-8 text-[var(--gm-text-tertiary)] text-sm",children:"No categories found."}):e.jsx("div",{className:"grid gap-3",children:h.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)]/20 hover:bg-[var(--gm-bg-tertiary)]/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold bg-${t.color||"blue"}-500/10 text-${t.color||"blue"}-500`,children:de(t.display_name)}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:t.display_name}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:t.description||"No description"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] mb-0.5",children:"Team Lead"}),e.jsxs(ne,{value:a.settings?.category_leads?.[t.id]||"",onValueChange:k=>T(t.id,k),children:[e.jsx(le,{className:"h-6 text-[10px] bg-[var(--gm-bg-primary)] border-[var(--gm-border-primary)] w-[140px]",children:e.jsx(ce,{placeholder:"No Lead"})}),e.jsxs(oe,{children:[e.jsx(W,{value:"no-lead",children:"No Lead Assigned"}),o.map(k=>e.jsx(W,{value:k.user_id,className:"text-[10px]",children:k.display_name},k.user_id))]})]})]}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full ${t.project_id?"bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]"}`,children:t.project_id?"Project":"Global"}),t.project_id&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{l(t),y(!0)},className:"p-1.5 text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:e.jsx(fe,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>p(t),className:"p-1.5 text-[var(--gm-text-tertiary)] hover:text-[var(--color-danger-500)] transition-colors",children:e.jsx(ae,{className:"w-3.5 h-3.5"})})]})]})]},t.id))})]}),e.jsx(zt,{open:j,onClose:()=>y(!1),projectId:a.id,onSuccess:n,initialData:c}),e.jsx(Te,{open:!!d,onOpenChange:t=>!t&&C(null),children:e.jsxs(Ie,{children:[e.jsxs(Me,{children:[e.jsx(Re,{children:"Delete Category"}),e.jsxs(Ee,{children:["Are you sure you want to delete the category ",e.jsx("strong",{children:d?.display_name}),"? This action cannot be undone."]})]}),e.jsxs(Le,{children:[e.jsx(Fe,{children:"Cancel"}),e.jsx($e,{onClick:M,className:"bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)]",children:"Delete"})]})]})})]})}function zt({open:a,onClose:o,projectId:w,onSuccess:h,initialData:u}){const[x,f]=r.useState(""),[j,y]=r.useState(""),[c,l]=r.useState(""),[d,C]=r.useState(!1);r.useEffect(()=>{a&&(u?(f(u.name),y(u.display_name),l(u.description||"")):(f(""),y(""),l("")))},[a,u]);const n=async()=>{if(!(!x.trim()||!j.trim()))try{C(!0);const p={name:x.toLowerCase().replace(/\s+/g,"_"),display_name:j,description:c,color:"blue"};u?await I.put(`/api/projects/${w}/categories/${u.id}`,p):await I.post(`/api/projects/${w}/categories`,p),h(),o()}catch(p){console.error("Failed to save category:",p),m.error("Failed to save category")}finally{C(!1)}};return e.jsx(ve,{open:a,onOpenChange:o,children:e.jsxs(ye,{className:"sm:max-w-[450px] bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsx(je,{children:e.jsx(be,{className:"text-[var(--gm-text-primary)]",children:u?"Edit Category":"Add New Category"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Display Name *"}),e.jsx(q,{value:j,onChange:p=>{y(p.target.value),!u&&(!x||x===j.toLowerCase().replace(/\s+/g,"_").slice(0,-1))&&f(p.target.value.toLowerCase().replace(/\s+/g,"_"))},placeholder:"e.g. Frontend Team",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Internal Name (Slug) *"}),e.jsx(q,{value:x,onChange:p=>f(p.target.value),placeholder:"e.g. frontend_team",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm font-mono"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Unique identifier used in system."})]}),e.jsxs("div",{children:[e.jsx("label",{className:L,children:"Description"}),e.jsx(q,{value:c,onChange:p=>l(p.target.value),placeholder:"Description...",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:o,className:B,children:"Cancel"}),e.jsx("button",{onClick:n,disabled:d,className:F,children:d?"Saving...":u?"Update":"Create"})]})]})]})})}function Bt({projectId:a}){const[o,w]=r.useState(""),[h,u]=r.useState("member"),[x,f]=r.useState(""),{data:j,isLoading:y}=Ye(a),c=Qe(),l=Xe(),d=We(),C=Ze(),n=j?.invites??[],p=async()=>{if(!o.trim()){m.error("Email is required");return}try{const t=await c.mutateAsync({projectId:a,email:o.trim(),role:h});t.invite_url?(await navigator.clipboard.writeText(t.invite_url),m.success(`Invite sent! Link copied to clipboard.${t.email_sent?" Email sent.":""}`)):m.success("Invite created"),w("")}catch{m.error("Failed to create invite")}},M=async()=>{try{const t=await l.mutateAsync(a);t.link&&(await navigator.clipboard.writeText(t.link),m.success("Invite link copied to clipboard"))}catch{m.error("Failed to generate link")}},T=async()=>{if(!x.trim()){m.error("Token is required");return}try{await C.mutateAsync(x.trim()),m.success("Invite accepted! You have joined the project."),f("")}catch{m.error("Failed to accept invite â€” token may be invalid or expired")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:P(O,"p-5 space-y-4"),children:[e.jsx("h3",{className:Z,children:"Invite Members"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{value:o,onChange:t=>w(t.target.value),placeholder:"Email address...",className:"flex-1",onKeyDown:t=>t.key==="Enter"&&p()}),e.jsxs("select",{value:h,onChange:t=>u(t.target.value),className:G,children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"read",children:"Read Only"})]}),e.jsxs("button",{onClick:p,disabled:c.isPending,className:F,children:[c.isPending?e.jsx($,{className:"w-4 h-4 animate-spin"}):e.jsx(et,{className:"w-4 h-4"})," Invite"]})]}),e.jsxs("button",{onClick:M,disabled:l.isPending,className:P(B,"disabled:opacity-50"),children:[l.isPending?e.jsx($,{className:"w-4 h-4 animate-spin"}):e.jsx(Ct,{className:"w-4 h-4"})," Generate Shareable Link"]})]}),e.jsxs("div",{className:P(O,"p-5 space-y-3"),children:[e.jsx("h3",{className:Z,children:"Accept an Invite"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Paste an invite token to join a project you've been invited to."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{value:x,onChange:t=>f(t.target.value),placeholder:"Paste invite token...",className:"flex-1",onKeyDown:t=>t.key==="Enter"&&T()}),e.jsxs("button",{onClick:T,disabled:C.isPending||!x.trim(),className:F,children:[C.isPending?e.jsx($,{className:"w-4 h-4 animate-spin"}):e.jsx(St,{className:"w-4 h-4"})," Accept"]})]})]}),e.jsxs("div",{className:P(O,"p-5"),children:[e.jsx("h3",{className:P(Z,"mb-3"),children:"Pending Invites"}),y?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx($,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):n.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-6",children:"No pending invites"}):e.jsx("div",{className:"space-y-2",children:n.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--gm-border-primary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.email||"Link invite"}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx("span",{className:"capitalize",children:t.role}),t.expires_at&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(tt,{className:"w-3 h-3"})," Expires ",new Date(t.expires_at).toLocaleDateString()]})]})]})]}),e.jsx("button",{onClick:()=>d.mutate(t.id),disabled:d.isPending,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:text-red-400 hover:bg-red-500/10 transition-colors",children:e.jsx(ae,{className:"w-4 h-4"})})]},t.id))})]})]})}function qt(){const[a,o]=r.useState(!1),[w,h]=r.useState(""),[u,x]=r.useState("#3b82f6"),[f,j]=r.useState(null),[y,c]=r.useState(""),[l,d]=r.useState(null),[C,n]=r.useState(""),{data:p,isLoading:M}=at(),T=st(C?{search:C}:void 0),t=T.data?.contacts??[],k=rt(),R=it(),S=nt(),V=lt(),U=ct(),K=p?.teams??[],b=g=>{const i=K.find(D=>D.id===g),E=new Set((i?.memberDetails??[]).map(D=>D.contactId));return t.filter(D=>!E.has(D.id))},N=async()=>{if(!w.trim()){m.error("Team name is required");return}try{await k.mutateAsync({name:w.trim(),color:u}),m.success("Team created"),h(""),o(!1)}catch{m.error("Failed to create team")}},s=async g=>{if(!y.trim()){m.error("Team name is required");return}try{await S.mutateAsync({id:g,name:y.trim()}),m.success("Team renamed"),j(null)}catch{m.error("Failed to rename team")}},_=async(g,i)=>{try{await V.mutateAsync({teamId:g,contactId:i}),m.success("Member added"),n(""),d(null)}catch{m.error("Failed to add member")}},A=async(g,i)=>{try{await U.mutateAsync({teamId:g,contactId:i}),m.success("Member removed")}catch{m.error("Failed to remove member")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:Z,children:["Teams (",K.length,")"]}),e.jsxs("button",{onClick:()=>o(!a),className:F,children:[e.jsx(ie,{className:"w-3.5 h-3.5"})," New Team"]})]}),e.jsx(me,{children:a&&e.jsx(J.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:P(O,"p-4 space-y-3"),children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{value:w,onChange:g=>h(g.target.value),placeholder:"Team name...",className:"flex-1",onKeyDown:g=>g.key==="Enter"&&N()}),e.jsx("input",{type:"color",value:u,onChange:g=>x(g.target.value),className:"w-10 h-10 rounded-lg border border-[var(--gm-border-primary)] cursor-pointer"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:N,disabled:k.isPending,className:F,children:[k.isPending?e.jsx($,{className:"w-4 h-4 animate-spin"}):e.jsx(xe,{className:"w-4 h-4"})," Create"]}),e.jsx("button",{onClick:()=>o(!1),className:B,children:"Cancel"})]})]})})}),M?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx($,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):K.length===0?e.jsx("div",{className:"text-center py-8 text-sm text-[var(--gm-text-tertiary)]",children:"No teams yet. Create one to get started."}):e.jsx("div",{className:"space-y-2",children:K.map(g=>e.jsxs(J.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:P(O,"p-4 hover:border-[var(--gm-accent-primary)]/20"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:g.color||"#3b82f6"}}),f===g.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{value:y,onChange:i=>c(i.target.value),className:"h-7 text-sm w-48",onKeyDown:i=>{i.key==="Enter"&&s(g.id),i.key==="Escape"&&j(null)},autoFocus:!0}),e.jsx("button",{onClick:()=>s(g.id),disabled:S.isPending,className:"p-1 rounded text-[var(--gm-accent-primary)] hover:bg-[var(--gm-interactive-primary)]/10 transition-colors",children:S.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(xe,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>j(null),className:"p-1 rounded text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:e.jsx(pe,{className:"w-3.5 h-3.5"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:g.name}),g.description&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:g.description})]}),e.jsx("button",{onClick:()=>{j(g.id),c(g.name)},className:"p-1 rounded text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)] transition-colors",title:"Rename team",children:e.jsx(fe,{className:"w-3 h-3"})})]}),e.jsxs(ot,{variant:"secondary",className:"text-[10px]",children:[g.memberCount??0," members"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>d(l===g.id?null:g.id),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:text-[var(--gm-accent-primary)] hover:bg-[var(--gm-interactive-primary)]/10 transition-colors",title:"Add member",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>R.mutate(g.id),disabled:R.isPending,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:text-red-400 hover:bg-red-500/10 transition-colors",children:e.jsx(ae,{className:"w-4 h-4"})})]})]}),e.jsx(me,{children:l===g.id&&e.jsx(J.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"mt-3 pt-3 border-t border-[var(--gm-border-primary)] space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(De,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx(q,{value:C,onChange:i=>n(i.target.value),placeholder:"Search contacts by name, role, or organization...",className:"pl-8 h-8 text-sm",autoFocus:!0})]}),e.jsx("button",{onClick:()=>{d(null),n("")},className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]",children:e.jsx(pe,{className:"w-3.5 h-3.5"})})]}),e.jsx("div",{className:"max-h-56 overflow-y-auto rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)]",children:T.isLoading?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx($,{className:"w-4 h-4 animate-spin text-[var(--gm-accent-primary)]"})}):b(g.id).length===0?e.jsx("div",{className:"text-center py-6 text-xs text-[var(--gm-text-tertiary)]",children:C?"No matching contacts found":"No contacts available"}):b(g.id).map(i=>{const E=he(i),D=i.name||"Unknown",H=i.role||i.cargo||"",z=i.organization||i.empresa||"";return e.jsxs("button",{onClick:()=>_(g.id,i.id),disabled:V.isPending,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-[var(--gm-surface-hover)] transition-colors border-b border-[var(--gm-border-primary)] last:border-b-0 disabled:opacity-50",children:[E?e.jsx("img",{src:E,alt:D,className:"w-8 h-8 rounded-full object-cover shrink-0"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-[var(--gm-interactive-primary)]/20 flex items-center justify-center text-[10px] font-bold text-[var(--gm-accent-primary)] shrink-0",children:de(D)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate",children:D}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-[var(--gm-text-tertiary)]",children:[H&&e.jsx("span",{className:"truncate",children:H}),H&&z&&e.jsx("span",{children:"Â·"}),z&&e.jsxs("span",{className:"flex items-center gap-0.5 truncate",children:[e.jsx(dt,{className:"w-2.5 h-2.5"}),z]})]})]}),i.email&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] truncate max-w-[140px] shrink-0",children:i.email}),e.jsx(ge,{className:"w-3.5 h-3.5 text-[var(--gm-accent-primary)] shrink-0"})]},i.id)})})]})})}),g.memberDetails&&g.memberDetails.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1.5",children:g.memberDetails.map((i,E)=>e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[10px] text-[var(--gm-text-primary)] group/member",children:[e.jsx(ue,{className:"w-3 h-3"})," ",i.name||i.contactId,i.isLead&&e.jsx("span",{className:"text-amber-400",children:"â˜…"}),i.role&&e.jsxs("span",{className:"text-[var(--gm-text-tertiary)]",children:["(",i.role,")"]}),e.jsx("button",{onClick:()=>A(g.id,i.contactId),disabled:U.isPending,className:"ml-0.5 p-0.5 rounded-full text-[var(--gm-text-tertiary)] hover:text-red-400 hover:bg-red-500/10 opacity-0 group-hover/member:opacity-100 transition-all",title:"Remove member",children:e.jsx(pe,{className:"w-2.5 h-2.5"})})]},E))})]},g.id))})]})}function Vt({projectId:a}){const{data:o,isLoading:w,refetch:h}=mt(a),u=xt(),x=gt(),f=pt(),[j,y]=r.useState(null),[c,l]=r.useState(""),d=o?.providers??[],C=t=>{c.trim()&&u.mutate({projectId:a,provider:t,apiKey:c.trim()},{onSuccess:()=>{m.success(`${t} key saved`),y(null),l(""),h()},onError:()=>m.error("Failed to save key")})},n=t=>{x.mutate({projectId:a,provider:t},{onSuccess:()=>{m.success(`${t} key removed`),h()},onError:()=>m.error("Failed to remove key")})},p=t=>{f.mutate({projectId:a,provider:t},{onSuccess:()=>m.success(`${t} key is valid`),onError:()=>m.error(`${t} key validation failed`)})},T=["openai","anthropic","google","groq","deepseek","ollama"].map(t=>{const k=d.find(R=>R.provider===t||R.name===t);return{name:t,hasKey:!!k?.has_key,...k||{}}});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:Z,children:"AI Provider Keys (BYOK)"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Bring your own API keys for each provider"})]}),w?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx($,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):e.jsx("div",{className:"space-y-2",children:T.map(t=>e.jsxs("div",{className:P(O,"p-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:P("w-8 h-8 rounded-lg flex items-center justify-center",t.hasKey?"bg-green-500/10":"bg-[var(--gm-bg-tertiary)]"),children:e.jsx(Oe,{className:P("w-4 h-4",t.hasKey?"text-green-500":"text-[var(--gm-text-tertiary)]")})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)] capitalize",children:t.name}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:t.hasKey?"Key configured":"No key set â€” uses system default"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[t.hasKey&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>p(t.name),disabled:f.isPending,className:B,children:[e.jsx(kt,{className:"w-3 h-3"})," Test"]}),e.jsxs("button",{onClick:()=>n(t.name),disabled:x.isPending,className:"inline-flex items-center gap-1 px-2 py-1 rounded-md text-[10px] text-[var(--gm-text-tertiary)] hover:text-[var(--color-danger-500)] transition-colors",children:[e.jsx(ae,{className:"w-3 h-3"})," Remove"]})]}),e.jsx("button",{onClick:()=>{y(j===t.name?null:t.name),l("")},className:B,children:j===t.name?"Cancel":t.hasKey?"Update":"Set Key"})]})]}),j===t.name&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{value:c,onChange:k=>l(k.target.value),type:"password",placeholder:`Enter ${t.name} API key...`,className:G}),e.jsxs("button",{onClick:()=>C(t.name),disabled:u.isPending||!c.trim(),className:F,children:[u.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(xe,{className:"w-3 h-3"})," Save"]})]})]},t.name))})]})}function Gt(){const[a,o]=r.useState(""),[w,h]=r.useState(""),u=ht({limit:100,search:a||void 0,sprint_id:w||void 0}),{data:x}=ut(),f=vt(),j=x?.sprints??(Array.isArray(x)?x:[]),y=u.data?.documents??[],c="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-sm";return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{value:a,onChange:l=>o(l.target.value),placeholder:"Search documents...",className:"w-full pl-9 pr-3 py-1.5 bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]}),e.jsxs("select",{value:w,onChange:l=>h(l.target.value),className:"bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"",children:"All sprints"}),e.jsx("option",{value:"_none",children:"No sprint"}),j.map(l=>e.jsxs("option",{value:l.id,children:[l.name,l.status==="active"?" (active)":""]},l.id))]}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)]",children:[y.length," document(s)"]})]}),u.isLoading?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx($,{className:"w-6 h-6 animate-spin text-[var(--gm-accent-primary)]"})}):y.length===0?e.jsxs("div",{className:c+" p-8 text-center",children:[e.jsx(te,{className:"w-10 h-10 mx-auto mb-3 text-[var(--gm-text-tertiary)]"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"No documents found."})]}):e.jsx("div",{className:"space-y-1.5",children:y.map(l=>{const C=l.sprint_id,n=C?j.find(p=>p.id===C):null;return e.jsxs("div",{className:c+" p-3 flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate",children:l.original_filename||l.filename}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[l.type&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:l.type}),l.created_at&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:new Date(l.created_at).toLocaleDateString()})]})]}),n&&e.jsx("span",{className:"inline-flex items-center text-[10px] px-2 py-0.5 rounded-full font-medium bg-purple-500/10 text-purple-400 border border-purple-500/20 whitespace-nowrap",children:n.name}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${l.status==="processed"||l.status==="completed"?"bg-green-500/10 text-green-400":l.status==="processing"?"bg-blue-500/10 text-blue-400":"bg-yellow-500/10 text-yellow-400"}`,children:l.status||"â€”"}),e.jsxs("select",{value:C||"",onChange:p=>{f.mutate({id:l.id,sprint_id:p.target.value||null},{onSuccess:()=>m.success("Sprint updated")})},className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded px-2 py-1 text-[10px] text-[var(--gm-text-primary)] w-32",children:[e.jsx("option",{value:"",children:"No sprint"}),j.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]},l.id)})})]})}function Jt({projectId:a}){const[o,w]=r.useState("activity"),{data:h,isLoading:u}=yt(a,{limit:50}),{data:x,isLoading:f}=jt(a,{limit:50}),j=h?.activities??[],y=x?.entries??[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:Z,children:o==="activity"?`Recent Activity (${h?.total??0})`:`Audit Log (${x?.total??0})`}),e.jsxs("div",{className:"flex bg-[var(--gm-bg-tertiary)] rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>w("activity"),className:P("px-3 py-1.5 rounded-md text-xs font-medium transition-colors",o==="activity"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"),children:"Activity"}),e.jsx("button",{onClick:()=>w("audit"),className:P("px-3 py-1.5 rounded-md text-xs font-medium transition-colors",o==="audit"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"),children:"Audit Log"})]})]}),o==="activity"?e.jsx(e.Fragment,{children:u?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx($,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):j.length===0?e.jsx("div",{className:"text-center py-8 text-xs text-[var(--gm-text-tertiary)]",children:"No activity recorded yet."}):e.jsx("div",{className:"space-y-1",children:j.map((c,l)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx(Ae,{className:"w-3.5 h-3.5 text-[var(--gm-accent-primary)] flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"text-xs text-[var(--gm-text-primary)]",children:[c.actor_name&&e.jsxs("span",{className:"font-medium",children:[c.actor_name," "]}),c.action?.replace(/[._]/g," "),c.target_type&&e.jsxs("span",{className:"text-[var(--gm-text-tertiary)]",children:[" on ",c.target_type]})]})}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] flex-shrink-0",children:new Date(c.created_at).toLocaleString()})]},c.id||l))})}):e.jsx(e.Fragment,{children:f?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx($,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):y.length===0?e.jsx("div",{className:"text-center py-8 text-xs text-[var(--gm-text-tertiary)]",children:"No audit entries yet."}):e.jsx("div",{className:"space-y-1",children:y.map((c,l)=>e.jsxs("div",{className:P(O,"flex items-center gap-3 p-3"),children:[e.jsx(re,{className:"w-3.5 h-3.5 text-amber-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs text-[var(--gm-text-primary)]",children:[c.actor_name&&e.jsxs("span",{className:"font-medium",children:[c.actor_name," "]}),e.jsx("span",{children:(c.action||"").replace(/[._]/g," ")}),c.target_type&&e.jsxs("span",{className:"text-[var(--gm-text-tertiary)]",children:[" on ",c.target_type]})]}),c.details&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate max-w-md",children:typeof c.details=="string"?c.details:JSON.stringify(c.details)})]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] flex-shrink-0",children:c.created_at?new Date(c.created_at).toLocaleString():"â€”"})]},c.id||l))})})]})}export{ua as default};
//# sourceMappingURL=ProjectsPage-DJjzMCZd.js.map
