{"version":3,"file":"OntologyViewer-BwKx0FxD.js","sources":["../../frontend/components/graph/OntologyViewer.ts"],"sourcesContent":["/**\r\n * OntologyViewer - Visual schema explorer and editor\r\n * \r\n * SOTA v2.0 Features:\r\n * - Entity type visualization with colors and icons\r\n * - Relationship type explorer\r\n * - AI suggestions panel with auto-approve\r\n * - Schema statistics with usage counts\r\n * - Interactive hierarchy view\r\n * - Sync status indicator (Supabase Graph)\r\n * - LLM Analysis integration\r\n * - Audit trail / change history\r\n * \r\n * SOTA v2.1 Features:\r\n * - Background jobs monitoring and control\r\n * - Continuous optimization status\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { \r\n  graphService, \r\n  OntologySchema, \r\n  OntologyEntityType, \r\n  OntologyRelationType, \r\n  OntologySuggestion,\r\n  OntologyTypeStats,\r\n  OntologySyncStatus,\r\n  OntologyChange,\r\n  BackgroundWorkerStatus,\r\n  BackgroundWorkerStats,\r\n  OntologyJob,\r\n  BackgroundJobExecution\r\n} from '../../services/graph';\r\nimport { toast } from '../../services/toast';\r\n\r\nexport interface OntologyViewerProps {\r\n  onEntitySelect?: (entity: OntologyEntityType) => void;\r\n  onRelationSelect?: (relation: OntologyRelationType) => void;\r\n}\r\n\r\ninterface ViewerState {\r\n  schema: OntologySchema | null;\r\n  suggestions: OntologySuggestion[];\r\n  typeStats: OntologyTypeStats | null;\r\n  syncStatus: OntologySyncStatus | null;\r\n  changes: OntologyChange[];\r\n  workerStatus: BackgroundWorkerStatus | null;\r\n  workerStats: BackgroundWorkerStats | null;\r\n  jobs: OntologyJob[];\r\n  jobLog: BackgroundJobExecution[];\r\n  compliance: { valid: boolean; score: number; issues: Array<{ type: string; severity: string; message: string; count?: number }> } | null;\r\n  falkorBrowserInfo: { browserUrl: string; isCloud: boolean; note: string } | null;\r\n  unusedTypes: { entities: string[]; relations: string[] } | null;\r\n  activeTab: 'entities' | 'relations' | 'graph' | 'suggestions' | 'analytics' | 'history' | 'jobs' | 'tools';\r\n  searchQuery: string;\r\n  isLoading: boolean;\r\n  isAnalyzing: boolean;\r\n  isSyncing: boolean;\r\n}\r\n\r\n/**\r\n * Create the ontology viewer component\r\n */\r\nexport function createOntologyViewer(props: OntologyViewerProps = {}): HTMLElement {\r\n  const state: ViewerState = {\r\n    schema: null,\r\n    suggestions: [],\r\n    typeStats: null,\r\n    syncStatus: null,\r\n    changes: [],\r\n    workerStatus: null,\r\n    workerStats: null,\r\n    jobs: [],\r\n    jobLog: [],\r\n    compliance: null,\r\n    falkorBrowserInfo: null,\r\n    unusedTypes: null,\r\n    activeTab: 'entities',\r\n    searchQuery: '',\r\n    isLoading: true,\r\n    isAnalyzing: false,\r\n    isSyncing: false,\r\n  };\r\n\r\n  const container = createElement('div', { className: 'ontology-viewer' });\r\n  \r\n  container.innerHTML = `\r\n    <div class=\"ontology-header\">\r\n      <div class=\"ontology-tabs\">\r\n        <button class=\"ontology-tab active\" data-tab=\"entities\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/>\r\n            <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/>\r\n            <path d=\"M20.4 14.5L16 10l-5.5 5.5\"/>\r\n            <path d=\"M14 14.5L10.5 11 7 14.5\"/>\r\n          </svg>\r\n          Entities\r\n        </button>\r\n        <button class=\"ontology-tab\" data-tab=\"relations\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6\"/>\r\n            <polyline points=\"15 3 21 3 21 9\"/>\r\n            <line x1=\"10\" y1=\"14\" x2=\"21\" y2=\"3\"/>\r\n          </svg>\r\n          Relations\r\n        </button>\r\n        <button class=\"ontology-tab\" data-tab=\"graph\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <circle cx=\"6\" cy=\"6\" r=\"3\"/>\r\n            <circle cx=\"18\" cy=\"6\" r=\"3\"/>\r\n            <circle cx=\"6\" cy=\"18\" r=\"3\"/>\r\n            <circle cx=\"18\" cy=\"18\" r=\"3\"/>\r\n            <line x1=\"9\" y1=\"6\" x2=\"15\" y2=\"6\"/>\r\n            <line x1=\"6\" y1=\"9\" x2=\"6\" y2=\"15\"/>\r\n            <line x1=\"18\" y1=\"9\" x2=\"18\" y2=\"15\"/>\r\n            <line x1=\"9\" y1=\"18\" x2=\"15\" y2=\"18\"/>\r\n          </svg>\r\n          Graph\r\n        </button>\r\n        <button class=\"ontology-tab\" data-tab=\"analytics\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <line x1=\"18\" y1=\"20\" x2=\"18\" y2=\"10\"/>\r\n            <line x1=\"12\" y1=\"20\" x2=\"12\" y2=\"4\"/>\r\n            <line x1=\"6\" y1=\"20\" x2=\"6\" y2=\"14\"/>\r\n          </svg>\r\n          Analytics\r\n        </button>\r\n        <button class=\"ontology-tab\" data-tab=\"suggestions\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\r\n            <path d=\"M2 17l10 5 10-5\"/>\r\n            <path d=\"M2 12l10 5 10-5\"/>\r\n          </svg>\r\n          AI\r\n          <span class=\"badge\" id=\"suggestions-badge\" style=\"display: none\">0</span>\r\n        </button>\r\n        <button class=\"ontology-tab\" data-tab=\"history\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n            <polyline points=\"12 6 12 12 16 14\"/>\r\n          </svg>\r\n          History\r\n        </button>\r\n        <button class=\"ontology-tab\" data-tab=\"jobs\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <rect x=\"2\" y=\"7\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/>\r\n            <path d=\"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16\"/>\r\n          </svg>\r\n          Jobs\r\n          <span class=\"badge job-status-badge\" id=\"jobs-badge\" style=\"display: none\"></span>\r\n        </button>\r\n        <button class=\"ontology-tab\" data-tab=\"tools\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z\"/>\r\n          </svg>\r\n          Tools\r\n        </button>\r\n      </div>\r\n      <div class=\"ontology-actions\">\r\n        <button class=\"btn btn-sm btn-ghost\" id=\"btn-sync\" title=\"Sync to graph\">\r\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"23 4 23 10 17 10\"/>\r\n            <polyline points=\"1 20 1 14 7 14\"/>\r\n            <path d=\"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15\"/>\r\n          </svg>\r\n        </button>\r\n        <div class=\"sync-indicator\" id=\"sync-indicator\" title=\"Sync status\">\r\n          <span class=\"sync-dot\"></span>\r\n        </div>\r\n      </div>\r\n      <div class=\"ontology-search\">\r\n        <input type=\"text\" id=\"ontology-search\" placeholder=\"Search...\" class=\"search-input\">\r\n        <svg class=\"search-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n          <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\r\n        </svg>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"ontology-content\" id=\"ontology-content\">\r\n      <div class=\"loading-state\">\r\n        <div class=\"loading-spinner\"></div>\r\n        <p>Loading ontology schema...</p>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"ontology-footer\">\r\n      <div class=\"ontology-stats\" id=\"ontology-stats\">\r\n        <!-- Stats will be rendered here -->\r\n      </div>\r\n      <div class=\"ontology-source\" id=\"ontology-source\">\r\n        <!-- Source info -->\r\n      </div>\r\n      <div class=\"ontology-version\" id=\"ontology-version\">\r\n        <!-- Version info -->\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Initialize\r\n  initOntologyViewer(container, state, props);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Initialize the viewer\r\n */\r\nasync function initOntologyViewer(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  props: OntologyViewerProps\r\n): Promise<void> {\r\n  // Bind tabs\r\n  const tabs = container.querySelectorAll('.ontology-tab');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      const tabId = tab.getAttribute('data-tab') as ViewerState['activeTab'];\r\n      if (tabId) {\r\n        switchTab(container, state, tabId, props);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bind search\r\n  const searchInput = container.querySelector('#ontology-search') as HTMLInputElement;\r\n  if (searchInput) {\r\n    on(searchInput, 'input', () => {\r\n      state.searchQuery = searchInput.value.toLowerCase();\r\n      renderCurrentTab(container, state, props);\r\n    });\r\n  }\r\n\r\n  // Bind sync button\r\n  const syncBtn = container.querySelector('#btn-sync');\r\n  if (syncBtn) {\r\n    on(syncBtn as HTMLElement, 'click', async () => {\r\n      if (state.isSyncing) return;\r\n      state.isSyncing = true;\r\n      syncBtn.classList.add('syncing');\r\n      toast.info('Syncing ontology to graph...');\r\n      \r\n      const result = await graphService.forceOntologySync();\r\n      \r\n      state.isSyncing = false;\r\n      syncBtn.classList.remove('syncing');\r\n      \r\n      if (result.ok) {\r\n        toast.success('Ontology synced to graph');\r\n        await loadOntologyData(container, state, props);\r\n      } else {\r\n        toast.error(`Sync failed: ${result.error}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Load data\r\n  await loadOntologyData(container, state, props);\r\n}\r\n\r\n/**\r\n * Load ontology data\r\n */\r\nasync function loadOntologyData(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  props: OntologyViewerProps\r\n): Promise<void> {\r\n  try {\r\n    const [schema, suggestions, typeStats, syncStatus, changes, workerData, jobs, jobLog, falkorBrowserInfo] = await Promise.all([\r\n      graphService.getOntologySchema(),\r\n      graphService.getOntologySuggestions(),\r\n      graphService.getOntologyTypeStats(),\r\n      graphService.getOntologySyncStatus(),\r\n      graphService.getOntologyChanges({ limit: 20 }),\r\n      graphService.getBackgroundWorkerStatus(),\r\n      graphService.getOntologyJobs(),\r\n      graphService.getBackgroundWorkerLog({ limit: 10 }),\r\n      graphService.getFalkorDBBrowserInfo(),\r\n    ]);\r\n\r\n    state.schema = schema;\r\n    state.suggestions = suggestions.filter(s => s.status === 'pending');\r\n    state.typeStats = typeStats;\r\n    state.syncStatus = syncStatus;\r\n    state.changes = changes;\r\n    state.workerStatus = workerData?.status || null;\r\n    state.workerStats = workerData?.stats || null;\r\n    state.jobs = jobs;\r\n    state.jobLog = jobLog;\r\n    state.falkorBrowserInfo = falkorBrowserInfo;\r\n    state.isLoading = false;\r\n\r\n    // Update suggestions badge\r\n    const badge = container.querySelector('#suggestions-badge') as HTMLElement;\r\n    if (badge) {\r\n      if (state.suggestions.length > 0) {\r\n        badge.textContent = String(state.suggestions.length);\r\n        badge.style.display = '';\r\n      } else {\r\n        badge.style.display = 'none';\r\n      }\r\n    }\r\n\r\n    // Update jobs badge\r\n    updateJobsBadge(container, state);\r\n\r\n    // Update sync indicator\r\n    updateSyncIndicator(container, state);\r\n\r\n    // Update stats\r\n    updateStats(container, state);\r\n\r\n    // Render initial tab\r\n    renderCurrentTab(container, state, props);\r\n\r\n  } catch (error) {\r\n    console.error('[OntologyViewer] Failed to load:', error);\r\n    const content = container.querySelector('#ontology-content');\r\n    if (content) {\r\n      content.innerHTML = `\r\n        <div class=\"error-state\">\r\n          <p>Failed to load ontology schema</p>\r\n          <button class=\"btn btn-sm\" onclick=\"location.reload()\">Retry</button>\r\n        </div>\r\n      `;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Update sync status indicator\r\n */\r\nfunction updateSyncIndicator(container: HTMLElement, state: ViewerState): void {\r\n  const indicator = container.querySelector('#sync-indicator') as HTMLElement;\r\n  if (!indicator) return;\r\n\r\n  const dot = indicator.querySelector('.sync-dot') as HTMLElement;\r\n  if (!dot) return;\r\n\r\n  if (state.syncStatus) {\r\n    if (state.syncStatus.syncInProgress) {\r\n      dot.className = 'sync-dot syncing';\r\n      indicator.title = 'Syncing...';\r\n    } else if (state.syncStatus.isListening && state.syncStatus.graphConnected) {\r\n      dot.className = 'sync-dot connected';\r\n      indicator.title = `Connected - Last sync: ${state.syncStatus.lastSyncAt ? new Date(state.syncStatus.lastSyncAt).toLocaleTimeString() : 'never'}`;\r\n    } else if (state.syncStatus.graphConnected) {\r\n      dot.className = 'sync-dot partial';\r\n      indicator.title = 'Connected (realtime sync disabled)';\r\n    } else {\r\n      dot.className = 'sync-dot disconnected';\r\n      indicator.title = 'Graph not connected';\r\n    }\r\n  } else {\r\n    dot.className = 'sync-dot unknown';\r\n    indicator.title = 'Status unknown';\r\n  }\r\n\r\n  // Update source info\r\n  const sourceEl = container.querySelector('#ontology-source');\r\n  if (sourceEl && state.syncStatus?.ontologySource) {\r\n    sourceEl.textContent = `Source: ${state.syncStatus.ontologySource}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Switch tab\r\n */\r\nfunction switchTab(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  tabId: ViewerState['activeTab'],\r\n  props: OntologyViewerProps\r\n): void {\r\n  state.activeTab = tabId;\r\n\r\n  // Update tab buttons\r\n  const tabs = container.querySelectorAll('.ontology-tab');\r\n  tabs.forEach(tab => {\r\n    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);\r\n  });\r\n\r\n  // Render content\r\n  renderCurrentTab(container, state, props);\r\n}\r\n\r\n/**\r\n * Render current tab\r\n */\r\nfunction renderCurrentTab(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  props: OntologyViewerProps\r\n): void {\r\n  const content = container.querySelector('#ontology-content') as HTMLElement;\r\n  if (!content || !state.schema) return;\r\n\r\n  switch (state.activeTab) {\r\n    case 'entities':\r\n      renderEntitiesTab(content, state, props);\r\n      break;\r\n    case 'relations':\r\n      renderRelationsTab(content, state, props);\r\n      break;\r\n    case 'graph':\r\n      renderGraphTab(content, state, props);\r\n      break;\r\n    case 'analytics':\r\n      renderAnalyticsTab(content, state, container);\r\n      break;\r\n    case 'suggestions':\r\n      renderSuggestionsTab(content, state, container);\r\n      break;\r\n    case 'history':\r\n      renderHistoryTab(content, state);\r\n      break;\r\n    case 'jobs':\r\n      renderJobsTab(content, state, container);\r\n      break;\r\n    case 'tools':\r\n      renderToolsTab(content, state, container);\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Render entities tab\r\n */\r\nfunction renderEntitiesTab(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  props: OntologyViewerProps\r\n): void {\r\n  if (!state.schema || !state.schema.entityTypes) {\r\n    container.innerHTML = `<div class=\"empty-state\"><p>No entity types defined in schema</p></div>`;\r\n    return;\r\n  }\r\n\r\n  const entities = Object.entries(state.schema.entityTypes)\r\n    .filter(([name, entity]) => {\r\n      if (!state.searchQuery) return true;\r\n      return name.toLowerCase().includes(state.searchQuery) ||\r\n             (entity.label || '').toLowerCase().includes(state.searchQuery) ||\r\n             (entity.description || '').toLowerCase().includes(state.searchQuery);\r\n    })\r\n    .sort((a, b) => a[0].localeCompare(b[0]));\r\n\r\n  if (entities.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No entity types found${state.searchQuery ? ' matching \"' + escapeHtml(state.searchQuery) + '\"' : ''}</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"ontology-layout\">\r\n      <div class=\"entity-list\">\r\n        ${entities.map(([name, entity]) => {\r\n          const propEntries = Object.entries(entity.properties || {});\r\n          const hasMoreProps = propEntries.length > 5;\r\n          return `\r\n            <div class=\"entity-card\" data-entity=\"${name}\">\r\n              <div class=\"entity-header\">\r\n                <div class=\"entity-icon-wrapper\" style=\"background: ${entity.color || '#6366f1'}\">\r\n                  <span class=\"entity-icon-letter\">${(entity.label || name).charAt(0).toUpperCase()}</span>\r\n                </div>\r\n                <div class=\"entity-info\">\r\n                  <h4 class=\"entity-name\">${escapeHtml(entity.label || name)}</h4>\r\n                  <span class=\"entity-key\">${escapeHtml(name)}</span>\r\n                </div>\r\n                ${entity.sharedEntity ? '<span class=\"shared-badge\">Shared</span>' : ''}\r\n              </div>\r\n              ${entity.description ? `<p class=\"entity-description\">${escapeHtml(entity.description)}</p>` : ''}\r\n              <div class=\"entity-properties\">\r\n                <h5>PROPERTIES (${propEntries.length})</h5>\r\n                <div class=\"properties-list\" data-entity=\"${name}\" data-expanded=\"false\">\r\n                  ${propEntries.slice(0, 5).map(([propName, prop]) => `\r\n                    <div class=\"property-row\">\r\n                      <span class=\"property-name ${(prop as Record<string, unknown>).required ? 'required' : ''}\">${escapeHtml(propName)}</span>\r\n                      <span class=\"property-type\">${(prop as Record<string, unknown>).type || 'string'}</span>\r\n                    </div>\r\n                  `).join('')}\r\n                  ${hasMoreProps ? `\r\n                    <button class=\"btn-expand-props\" data-entity=\"${name}\">+${propEntries.length - 5} more</button>\r\n                    <div class=\"properties-hidden\" style=\"display: none;\">\r\n                      ${propEntries.slice(5).map(([propName, prop]) => `\r\n                        <div class=\"property-row\">\r\n                          <span class=\"property-name ${(prop as Record<string, unknown>).required ? 'required' : ''}\">${escapeHtml(propName)}</span>\r\n                          <span class=\"property-type\">${(prop as Record<string, unknown>).type || 'string'}</span>\r\n                        </div>\r\n                      `).join('')}\r\n                    </div>\r\n                  ` : ''}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `;\r\n        }).join('')}\r\n      </div>\r\n      <div class=\"entity-detail-panel\" id=\"entity-detail-panel\">\r\n        <div class=\"detail-placeholder\">\r\n          <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" opacity=\"0.3\">\r\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/>\r\n            <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/>\r\n            <path d=\"M20.4 14.5L16 10l-5.5 5.5\"/>\r\n          </svg>\r\n          <p>Select an entity type to view details</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind card click events\r\n  container.querySelectorAll('.entity-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      // Don't trigger if clicking expand button\r\n      if ((e.target as HTMLElement).classList.contains('btn-expand-props')) return;\r\n      \r\n      const name = card.getAttribute('data-entity');\r\n      if (name && state.schema?.entityTypes[name]) {\r\n        // Highlight selected card\r\n        container.querySelectorAll('.entity-card').forEach(c => c.classList.remove('selected'));\r\n        card.classList.add('selected');\r\n        \r\n        // Show details and position panel next to the clicked card\r\n        showEntityDetails(container, name, state.schema.entityTypes[name]);\r\n        \r\n        // Position the detail panel to align with the clicked card\r\n        const entityList = container.querySelector('.entity-list');\r\n        const detailPanel = container.querySelector('#entity-detail-panel') as HTMLElement;\r\n        if (entityList && detailPanel) {\r\n          const listRect = entityList.getBoundingClientRect();\r\n          const cardRect = (card as HTMLElement).getBoundingClientRect();\r\n          const offsetTop = cardRect.top - listRect.top;\r\n          detailPanel.style.marginTop = `${Math.max(0, offsetTop)}px`;\r\n        }\r\n        \r\n        props.onEntitySelect?.(state.schema.entityTypes[name]);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bind expand buttons\r\n  container.querySelectorAll('.btn-expand-props').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      const entityName = btn.getAttribute('data-entity');\r\n      const propsList = container.querySelector(`.properties-list[data-entity=\"${entityName}\"]`);\r\n      const hiddenProps = propsList?.querySelector('.properties-hidden') as HTMLElement;\r\n      \r\n      if (hiddenProps) {\r\n        const isExpanded = propsList?.getAttribute('data-expanded') === 'true';\r\n        if (isExpanded) {\r\n          hiddenProps.style.display = 'none';\r\n          btn.textContent = `+${hiddenProps.querySelectorAll('.property-row').length} more`;\r\n          propsList?.setAttribute('data-expanded', 'false');\r\n        } else {\r\n          hiddenProps.style.display = 'block';\r\n          btn.textContent = 'Show less';\r\n          propsList?.setAttribute('data-expanded', 'true');\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show entity details in the detail panel\r\n */\r\nfunction showEntityDetails(container: HTMLElement, name: string, entity: OntologyEntityType): void {\r\n  const panel = container.querySelector('#entity-detail-panel');\r\n  if (!panel) return;\r\n\r\n  const propEntries = Object.entries(entity.properties || {});\r\n  \r\n  panel.innerHTML = `\r\n    <div class=\"detail-header\" style=\"border-left: 4px solid ${entity.color || '#6366f1'};\">\r\n      <h3>${escapeHtml(entity.label || name)}</h3>\r\n      <span class=\"detail-key\">${escapeHtml(name)}</span>\r\n      ${entity.sharedEntity ? '<span class=\"shared-badge\">Shared across projects</span>' : ''}\r\n    </div>\r\n    ${entity.description ? `<p class=\"detail-description\">${escapeHtml(entity.description)}</p>` : ''}\r\n    \r\n    <div class=\"detail-section\">\r\n      <h4>Properties (${propEntries.length})</h4>\r\n      <table class=\"properties-table\">\r\n        <thead>\r\n          <tr>\r\n            <th>Name</th>\r\n            <th>Type</th>\r\n            <th>Required</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          ${propEntries.map(([propName, prop]) => {\r\n            const p = prop as Record<string, unknown>;\r\n            return `\r\n              <tr>\r\n                <td><code>${escapeHtml(propName)}</code></td>\r\n                <td><span class=\"type-badge\">${p.type || 'string'}</span></td>\r\n                <td>${p.required ? '<span class=\"required-badge\">Required</span>' : '<span class=\"optional-badge\">Optional</span>'}</td>\r\n              </tr>\r\n            `;\r\n          }).join('')}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n    \r\n    ${entity.examples && entity.examples.length > 0 ? `\r\n      <div class=\"detail-section\">\r\n        <h4>Examples</h4>\r\n        <ul class=\"examples-list\">\r\n          ${entity.examples.map(ex => `<li>${escapeHtml(String(ex))}</li>`).join('')}\r\n        </ul>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Render relations tab\r\n */\r\nfunction renderRelationsTab(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  props: OntologyViewerProps\r\n): void {\r\n  if (!state.schema || !state.schema.relationTypes) {\r\n    container.innerHTML = `<div class=\"empty-state\"><p>No relation types defined in schema</p></div>`;\r\n    return;\r\n  }\r\n\r\n  const relations = Object.entries(state.schema.relationTypes)\r\n    .filter(([name, relation]) => {\r\n      if (!state.searchQuery) return true;\r\n      return name.toLowerCase().includes(state.searchQuery) ||\r\n             (relation.label || '').toLowerCase().includes(state.searchQuery) ||\r\n             (relation.description || '').toLowerCase().includes(state.searchQuery);\r\n    })\r\n    .sort((a, b) => a[0].localeCompare(b[0]));\r\n\r\n  if (relations.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No relation types found${state.searchQuery ? ' matching \"' + escapeHtml(state.searchQuery) + '\"' : ''}</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"relation-list\">\r\n      ${relations.map(([name, relation]) => `\r\n        <div class=\"relation-card\" data-relation=\"${name}\">\r\n          <div class=\"relation-header\">\r\n            <div class=\"relation-icon\">\r\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6\"/>\r\n                <polyline points=\"15 3 21 3 21 9\"/>\r\n                <line x1=\"10\" y1=\"14\" x2=\"21\" y2=\"3\"/>\r\n              </svg>\r\n            </div>\r\n            <div class=\"relation-info\">\r\n              <h4 class=\"relation-name\">${escapeHtml(relation.label || name)}</h4>\r\n              <span class=\"relation-key\">${escapeHtml(name)}</span>\r\n            </div>\r\n          </div>\r\n          ${relation.description ? `<p class=\"relation-description\">${escapeHtml(relation.description)}</p>` : ''}\r\n          <div class=\"relation-types\">\r\n            <div class=\"from-types\">\r\n              <span class=\"types-label\">From:</span>\r\n              ${(relation.fromTypes || []).map(t => `<span class=\"type-chip\">${escapeHtml(t)}</span>`).join('')}\r\n            </div>\r\n            <div class=\"to-types\">\r\n              <span class=\"types-label\">To:</span>\r\n              ${(relation.toTypes || []).map(t => `<span class=\"type-chip\">${escapeHtml(t)}</span>`).join('')}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.relation-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const name = card.getAttribute('data-relation');\r\n      if (name && state.schema?.relationTypes[name]) {\r\n        props.onRelationSelect?.(state.schema.relationTypes[name]);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render graph visualization tab\r\n */\r\nfunction renderGraphTab(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  props: OntologyViewerProps\r\n): void {\r\n  if (!state.schema?.entityTypes || !state.schema?.relationTypes) {\r\n    container.innerHTML = `<div class=\"empty-state\"><p>No schema available for graph visualization</p></div>`;\r\n    return;\r\n  }\r\n\r\n  // Create graph container\r\n  container.innerHTML = `\r\n    <div class=\"ontology-graph-container\" style=\"height: 400px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary);\">\r\n      <div id=\"ontology-graph-canvas\" style=\"width: 100%; height: 100%;\"></div>\r\n    </div>\r\n    <div class=\"ontology-graph-legend\" style=\"margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;\">\r\n      <h5 style=\"margin: 0 0 8px 0; font-size: 12px; color: var(--text-muted);\">Legend</h5>\r\n      <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\r\n        ${Object.entries(state.schema.entityTypes).map(([name, entity]) => `\r\n          <span style=\"display: inline-flex; align-items: center; gap: 4px; font-size: 11px;\">\r\n            <span style=\"width: 12px; height: 12px; border-radius: 50%; background: ${(entity as Record<string, unknown>).color || '#6366f1'}\"></span>\r\n            ${escapeHtml(name)}\r\n          </span>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Initialize vis.js network after DOM is ready\r\n  setTimeout(() => {\r\n    const canvas = container.querySelector('#ontology-graph-canvas') as HTMLElement;\r\n    if (!canvas) return;\r\n\r\n    // Get vis.js library\r\n    const vis = (window as unknown as Record<string, unknown>).vis as {\r\n      Network: new (container: HTMLElement, data: unknown, options: unknown) => unknown;\r\n      DataSet: new <T = unknown>(data?: T[]) => { add: (items: T | T[]) => void };\r\n    };\r\n    \r\n    if (!vis) {\r\n      canvas.innerHTML = '<p style=\"padding: 20px; text-align: center; color: var(--text-muted);\">vis.js not loaded</p>';\r\n      return;\r\n    }\r\n\r\n    // Create nodes from entity types\r\n    const nodes: Array<{ id: string; label: string; color: string; shape: string; font: { color: string } }> = [];\r\n    const entityColors: Record<string, string> = {};\r\n    \r\n    Object.entries(state.schema!.entityTypes).forEach(([name, entity]) => {\r\n      const color = (entity as Record<string, unknown>).color as string || '#6366f1';\r\n      entityColors[name] = color;\r\n      nodes.push({\r\n        id: name,\r\n        label: name,\r\n        color: color,\r\n        shape: 'dot',\r\n        font: { color: getTextColor() }\r\n      });\r\n    });\r\n\r\n    // Create edges from relation types\r\n    const edges: Array<{ from: string; to: string; label: string; arrows: string; color: { color: string } }> = [];\r\n    \r\n    Object.entries(state.schema!.relationTypes).forEach(([name, relation]) => {\r\n      const rel = relation as Record<string, unknown>;\r\n      const fromTypes = (rel.fromTypes || []) as string[];\r\n      const toTypes = (rel.toTypes || []) as string[];\r\n      \r\n      // Create edges for each valid from->to combination\r\n      fromTypes.forEach(from => {\r\n        toTypes.forEach(to => {\r\n          if (state.schema!.entityTypes[from] && state.schema!.entityTypes[to]) {\r\n            edges.push({\r\n              from,\r\n              to,\r\n              label: name,\r\n              arrows: 'to',\r\n              color: { color: 'rgba(156, 163, 175, 0.6)' }\r\n            });\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n    // Create network\r\n    const data = {\r\n      nodes: new vis.DataSet(nodes),\r\n      edges: new vis.DataSet(edges)\r\n    };\r\n\r\n    const options = {\r\n      nodes: {\r\n        size: 30,\r\n        borderWidth: 3,\r\n        font: { \r\n          size: 14, \r\n          face: 'Inter, system-ui, sans-serif',\r\n          strokeWidth: 3,\r\n          strokeColor: 'rgba(255,255,255,0.8)'\r\n        },\r\n        shadow: {\r\n          enabled: true,\r\n          size: 10,\r\n          color: 'rgba(0,0,0,0.2)'\r\n        }\r\n      },\r\n      edges: {\r\n        font: { size: 9, align: 'top', color: 'rgba(100,100,100,0.7)' },\r\n        smooth: { \r\n          type: 'curvedCW',\r\n          roundness: 0.2\r\n        },\r\n        width: 1.5,\r\n        selectionWidth: 3,\r\n        hoverWidth: 2\r\n      },\r\n      physics: {\r\n        enabled: true,\r\n        solver: 'barnesHut',\r\n        barnesHut: {\r\n          gravitationalConstant: -3000,\r\n          centralGravity: 0.1,\r\n          springLength: 250,\r\n          springConstant: 0.02,\r\n          damping: 0.3,\r\n          avoidOverlap: 1\r\n        },\r\n        stabilization: { \r\n          enabled: true,\r\n          iterations: 200,\r\n          fit: true\r\n        }\r\n      },\r\n      interaction: {\r\n        hover: true,\r\n        tooltipDelay: 200,\r\n        zoomView: true,\r\n        dragView: true\r\n      },\r\n      layout: {\r\n        improvedLayout: true,\r\n        randomSeed: 42\r\n      }\r\n    };\r\n\r\n    const network = new vis.Network(canvas, data, options);\r\n    \r\n    // Fit to view after stabilization\r\n    (network as { once: (event: string, cb: () => void) => void }).once('stabilizationIterationsDone', () => {\r\n      (network as { fit: () => void }).fit();\r\n    });\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Get text color based on theme\r\n */\r\nfunction getTextColor(): string {\r\n  return document.documentElement.getAttribute('data-theme') === 'dark' ? '#e5e7eb' : '#1f2937';\r\n}\r\n\r\n/**\r\n * Render suggestions tab\r\n */\r\nfunction renderSuggestionsTab(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  parentContainer: HTMLElement\r\n): void {\r\n  if (state.suggestions.length === 0) {\r\n    const hasGaps = state.typeStats?.notInOntology?.entities?.length || \r\n                    state.typeStats?.notInOntology?.relations?.length;\r\n    const hasUnused = state.typeStats?.unused?.entities?.length ||\r\n                      state.typeStats?.unused?.relations?.length;\r\n    \r\n    container.innerHTML = `\r\n      <div class=\"ai-suggestions-empty\">\r\n        <div class=\"ai-status-card\">\r\n          <div class=\"ai-status-icon ${hasGaps ? 'warning' : 'success'}\">\r\n            <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              ${hasGaps ? \r\n                '<circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"/><line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"/>' : \r\n                '<path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/><polyline points=\"22 4 12 14.01 9 11.01\"/>'}\r\n            </svg>\r\n          </div>\r\n          <div class=\"ai-status-text\">\r\n            <h3>${hasGaps ? 'Schema gaps detected' : 'Ontology is in sync'}</h3>\r\n            <p>${hasGaps ? \r\n              'Some types in your graph are not defined in the ontology schema.' : \r\n              'All entity and relation types in your graph are defined in the ontology.'}</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"ai-insights-grid\">\r\n          <div class=\"ai-insight-card\">\r\n            <div class=\"insight-value\">${Object.keys(state.typeStats?.entities || {}).length}</div>\r\n            <div class=\"insight-label\">Entity Types in Graph</div>\r\n          </div>\r\n          <div class=\"ai-insight-card\">\r\n            <div class=\"insight-value\">${Object.keys(state.typeStats?.relations || {}).length}</div>\r\n            <div class=\"insight-label\">Relation Types in Graph</div>\r\n          </div>\r\n          <div class=\"ai-insight-card ${hasGaps ? 'warning' : ''}\">\r\n            <div class=\"insight-value\">${(state.typeStats?.notInOntology?.entities?.length || 0) + (state.typeStats?.notInOntology?.relations?.length || 0)}</div>\r\n            <div class=\"insight-label\">Not in Schema</div>\r\n          </div>\r\n          <div class=\"ai-insight-card ${hasUnused ? 'muted' : ''}\">\r\n            <div class=\"insight-value\">${(state.typeStats?.unused?.entities?.length || 0) + (state.typeStats?.unused?.relations?.length || 0)}</div>\r\n            <div class=\"insight-label\">Unused Types</div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"ai-actions\">\r\n          <button class=\"btn btn-primary\" id=\"btn-run-ai-analysis\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\r\n              <path d=\"M2 17l10 5 10-5\"/>\r\n              <path d=\"M2 12l10 5 10-5\"/>\r\n            </svg>\r\n            Run AI Analysis\r\n          </button>\r\n          <button class=\"btn btn-ghost\" id=\"btn-check-gaps\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n              <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\r\n            </svg>\r\n            Check for Gaps\r\n          </button>\r\n        </div>\r\n        \r\n        ${hasGaps ? `\r\n          <div class=\"ai-gaps-preview\">\r\n            <h4>Detected Gaps</h4>\r\n            <div class=\"gaps-list\">\r\n              ${state.typeStats?.notInOntology?.entities?.map(name => `\r\n                <span class=\"gap-chip entity\">${escapeHtml(name)}</span>\r\n              `).join('') || ''}\r\n              ${state.typeStats?.notInOntology?.relations?.map(name => `\r\n                <span class=\"gap-chip relation\">${escapeHtml(name)}</span>\r\n              `).join('') || ''}\r\n            </div>\r\n            <p class=\"text-muted\">Click \"Check for Gaps\" to generate suggestions for these types.</p>\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n    \r\n    // Bind AI analysis button\r\n    const analyzeBtn = container.querySelector('#btn-run-ai-analysis');\r\n    if (analyzeBtn) {\r\n      on(analyzeBtn as HTMLElement, 'click', async () => {\r\n        toast.info('Running AI analysis...');\r\n        analyzeBtn.classList.add('loading');\r\n        (analyzeBtn as HTMLButtonElement).disabled = true;\r\n        \r\n        const result = await graphService.runLLMAnalysis();\r\n        \r\n        analyzeBtn.classList.remove('loading');\r\n        (analyzeBtn as HTMLButtonElement).disabled = false;\r\n        \r\n        if (result) {\r\n          toast.success(`Analysis complete: ${result.suggestions?.length || 0} suggestions`);\r\n          const suggestions = await graphService.getOntologySuggestions();\r\n          state.suggestions = suggestions.filter(s => s.status === 'pending');\r\n          renderSuggestionsTab(container, state, parentContainer);\r\n          updateSuggestionsBadge(parentContainer, state);\r\n        } else {\r\n          toast.error('Analysis failed');\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Bind check gaps button\r\n    const checkGapsBtn = container.querySelector('#btn-check-gaps');\r\n    if (checkGapsBtn) {\r\n      on(checkGapsBtn as HTMLElement, 'click', async () => {\r\n        toast.info('Checking for gaps...');\r\n        checkGapsBtn.classList.add('loading');\r\n        (checkGapsBtn as HTMLButtonElement).disabled = true;\r\n        \r\n        const result = await graphService.triggerBackgroundAnalysis('gaps');\r\n        \r\n        checkGapsBtn.classList.remove('loading');\r\n        (checkGapsBtn as HTMLButtonElement).disabled = false;\r\n        \r\n        if (result) {\r\n          toast.success('Gap check complete');\r\n          const suggestions = await graphService.getOntologySuggestions();\r\n          state.suggestions = suggestions.filter(s => s.status === 'pending');\r\n          renderSuggestionsTab(container, state, parentContainer);\r\n          updateSuggestionsBadge(parentContainer, state);\r\n        } else {\r\n          toast.error('Gap check failed');\r\n        }\r\n      });\r\n    }\r\n    \r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"suggestions-list\">\r\n      ${state.suggestions.map(suggestion => `\r\n        <div class=\"suggestion-card\" data-id=\"${suggestion.id}\">\r\n          <div class=\"suggestion-header\">\r\n            <span class=\"suggestion-type\">${suggestion.type}</span>\r\n            <span class=\"suggestion-name\">${escapeHtml(suggestion.name)}</span>\r\n          </div>\r\n          ${suggestion.description ? `<p class=\"suggestion-description\">${escapeHtml(suggestion.description)}</p>` : ''}\r\n          ${suggestion.example ? `<div class=\"suggestion-example\"><strong>Example:</strong> ${escapeHtml(suggestion.example)}</div>` : ''}\r\n          ${suggestion.source ? `<div class=\"suggestion-source\">Source: ${escapeHtml(suggestion.source)}</div>` : ''}\r\n          <div class=\"suggestion-actions\">\r\n            <button class=\"btn btn-sm btn-primary btn-approve\" data-id=\"${suggestion.id}\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"20 6 9 17 4 12\"/>\r\n              </svg>\r\n              Approve\r\n            </button>\r\n            <button class=\"btn btn-sm btn-ghost btn-reject\" data-id=\"${suggestion.id}\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\r\n                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n              </svg>\r\n              Reject\r\n            </button>\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind approve/reject\r\n  container.querySelectorAll('.btn-approve').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      if (id) {\r\n        const success = await graphService.approveOntologySuggestion(id);\r\n        if (success) {\r\n          toast.success('Suggestion approved');\r\n          state.suggestions = state.suggestions.filter(s => s.id !== id);\r\n          renderSuggestionsTab(container, state, parentContainer);\r\n          updateSuggestionsBadge(parentContainer, state);\r\n        } else {\r\n          toast.error('Failed to approve suggestion');\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  container.querySelectorAll('.btn-reject').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      if (id) {\r\n        const success = await graphService.rejectOntologySuggestion(id);\r\n        if (success) {\r\n          toast.info('Suggestion rejected');\r\n          state.suggestions = state.suggestions.filter(s => s.id !== id);\r\n          renderSuggestionsTab(container, state, parentContainer);\r\n          updateSuggestionsBadge(parentContainer, state);\r\n        } else {\r\n          toast.error('Failed to reject suggestion');\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render analytics tab - SOTA v2.0\r\n */\r\nfunction renderAnalyticsTab(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  parentContainer: HTMLElement\r\n): void {\r\n  const stats = state.typeStats;\r\n  const compliance = (stats as unknown as { compliance?: { total: number; valid: number; invalid: number; unchecked: number; percentage: number } })?.compliance;\r\n  \r\n  container.innerHTML = `\r\n    <div class=\"analytics-container\">\r\n      ${compliance ? `\r\n        <div class=\"compliance-overview\">\r\n          <div class=\"compliance-score ${compliance.percentage >= 90 ? 'excellent' : compliance.percentage >= 70 ? 'good' : 'warning'}\">\r\n            <div class=\"compliance-value\">${compliance.percentage}%</div>\r\n            <div class=\"compliance-label\">Ontology Compliance</div>\r\n          </div>\r\n          <div class=\"compliance-details\">\r\n            <div class=\"compliance-stat\">\r\n              <span class=\"stat-value success\">${compliance.valid}</span>\r\n              <span class=\"stat-label\">Valid Nodes</span>\r\n            </div>\r\n            <div class=\"compliance-stat\">\r\n              <span class=\"stat-value ${compliance.invalid > 0 ? 'error' : ''}\">${compliance.invalid}</span>\r\n              <span class=\"stat-label\">Invalid Nodes</span>\r\n            </div>\r\n            <div class=\"compliance-stat\">\r\n              <span class=\"stat-value muted\">${compliance.unchecked}</span>\r\n              <span class=\"stat-label\">Unchecked</span>\r\n            </div>\r\n            <div class=\"compliance-stat\">\r\n              <span class=\"stat-value\">${compliance.total}</span>\r\n              <span class=\"stat-label\">Total Nodes</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ` : ''}\r\n      \r\n      <div class=\"analytics-header\">\r\n        <h3>Ontology Analytics</h3>\r\n        <div class=\"analytics-actions\">\r\n          <button class=\"btn btn-sm btn-primary\" id=\"btn-analyze\">\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\r\n              <path d=\"M2 17l10 5 10-5\"/>\r\n              <path d=\"M2 12l10 5 10-5\"/>\r\n            </svg>\r\n            Run LLM Analysis\r\n          </button>\r\n          <button class=\"btn btn-sm btn-ghost\" id=\"btn-auto-approve\" title=\"Auto-approve high confidence suggestions\">\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polyline points=\"20 6 9 17 4 12\"/>\r\n            </svg>\r\n            Auto-Approve\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      ${stats ? `\r\n        <div class=\"analytics-grid\">\r\n          <div class=\"analytics-card\">\r\n            <h4>Entity Type Usage</h4>\r\n            <div class=\"usage-list\">\r\n              ${Object.entries(stats.entities || {})\r\n                .sort((a, b) => (b[1].count || 0) - (a[1].count || 0))\r\n                .slice(0, 10)\r\n                .map(([name, data]) => `\r\n                  <div class=\"usage-row ${!data.inOntology ? 'not-in-ontology' : ''}\">\r\n                    <span class=\"usage-name\">${escapeHtml(name)}</span>\r\n                    <span class=\"usage-count\">${data.count}</span>\r\n                    ${!data.inOntology ? '<span class=\"warning-badge\">Not in schema</span>' : ''}\r\n                  </div>\r\n                `).join('')}\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"analytics-card\">\r\n            <h4>Relation Type Usage</h4>\r\n            <div class=\"usage-list\">\r\n              ${Object.entries(stats.relations || {})\r\n                .sort((a, b) => (b[1].count || 0) - (a[1].count || 0))\r\n                .slice(0, 10)\r\n                .map(([name, data]) => `\r\n                  <div class=\"usage-row ${!data.inOntology ? 'not-in-ontology' : ''}\">\r\n                    <span class=\"usage-name\">${escapeHtml(name)}</span>\r\n                    <span class=\"usage-count\">${data.count}</span>\r\n                    ${!data.inOntology ? '<span class=\"warning-badge\">Not in schema</span>' : ''}\r\n                  </div>\r\n                `).join('')}\r\n            </div>\r\n          </div>\r\n          \r\n          ${(stats.unused?.entities?.length || stats.unused?.relations?.length) ? `\r\n            <div class=\"analytics-card warning\">\r\n              <h4>Unused in Schema</h4>\r\n              <p class=\"text-muted\">These types are defined in the schema but have no instances in the graph.</p>\r\n              ${stats.unused.entities?.length ? `\r\n                <div class=\"unused-section\">\r\n                  <strong>Entities:</strong>\r\n                  <div class=\"unused-list\">\r\n                    ${stats.unused.entities.map(name => `<span class=\"unused-chip\">${escapeHtml(name)}</span>`).join('')}\r\n                  </div>\r\n                </div>\r\n              ` : ''}\r\n              ${stats.unused.relations?.length ? `\r\n                <div class=\"unused-section\">\r\n                  <strong>Relations:</strong>\r\n                  <div class=\"unused-list\">\r\n                    ${stats.unused.relations.map(name => `<span class=\"unused-chip\">${escapeHtml(name)}</span>`).join('')}\r\n                  </div>\r\n                </div>\r\n              ` : ''}\r\n            </div>\r\n          ` : ''}\r\n          \r\n          ${(stats.notInOntology?.entities?.length || stats.notInOntology?.relations?.length) ? `\r\n            <div class=\"analytics-card error\">\r\n              <h4>Not in Schema</h4>\r\n              <p class=\"text-muted\">These types exist in the graph but are not defined in the schema.</p>\r\n              ${stats.notInOntology.entities?.length ? `\r\n                <div class=\"not-in-ontology-section\">\r\n                  <strong>Entities:</strong>\r\n                  <div class=\"not-in-ontology-list\">\r\n                    ${stats.notInOntology.entities.map(name => `<span class=\"error-chip\">${escapeHtml(name)}</span>`).join('')}\r\n                  </div>\r\n                </div>\r\n              ` : ''}\r\n              ${stats.notInOntology.relations?.length ? `\r\n                <div class=\"not-in-ontology-section\">\r\n                  <strong>Relations:</strong>\r\n                  <div class=\"not-in-ontology-list\">\r\n                    ${stats.notInOntology.relations.map(name => `<span class=\"error-chip\">${escapeHtml(name)}</span>`).join('')}\r\n                  </div>\r\n                </div>\r\n              ` : ''}\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n      ` : `\r\n        <div class=\"empty-state\">\r\n          <p>No analytics data available. Make sure the graph is connected.</p>\r\n        </div>\r\n      `}\r\n      \r\n      <div id=\"analysis-results\" style=\"display: none;\">\r\n        <!-- LLM analysis results will be rendered here -->\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind LLM Analysis button\r\n  const analyzeBtn = container.querySelector('#btn-analyze');\r\n  if (analyzeBtn) {\r\n    on(analyzeBtn as HTMLElement, 'click', async () => {\r\n      if (state.isAnalyzing) return;\r\n      state.isAnalyzing = true;\r\n      analyzeBtn.classList.add('loading');\r\n      (analyzeBtn as HTMLButtonElement).disabled = true;\r\n      toast.info('Running LLM analysis... This may take a moment.');\r\n      \r\n      const result = await graphService.runLLMAnalysis();\r\n      \r\n      state.isAnalyzing = false;\r\n      analyzeBtn.classList.remove('loading');\r\n      (analyzeBtn as HTMLButtonElement).disabled = false;\r\n      \r\n      if (result) {\r\n        toast.success(`Analysis complete: ${result.suggestions?.length || 0} new suggestions`);\r\n        \r\n        // Show results\r\n        const resultsEl = container.querySelector('#analysis-results') as HTMLElement;\r\n        if (resultsEl) {\r\n          resultsEl.style.display = 'block';\r\n          resultsEl.innerHTML = `\r\n            <div class=\"analysis-results\">\r\n              <h4>LLM Analysis Results</h4>\r\n              <p class=\"analysis-summary\">${escapeHtml(result.summary || result.analysis?.summary || '')}</p>\r\n              ${result.suggestions?.length ? `\r\n                <p class=\"text-success\">${result.suggestions.length} suggestions were added. Check the AI tab to review them.</p>\r\n              ` : ''}\r\n            </div>\r\n          `;\r\n        }\r\n        \r\n        // Refresh suggestions\r\n        const suggestions = await graphService.getOntologySuggestions();\r\n        state.suggestions = suggestions.filter(s => s.status === 'pending');\r\n        updateSuggestionsBadge(parentContainer, state);\r\n      } else {\r\n        toast.error('Analysis failed. Check console for details.');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Bind auto-approve button\r\n  const autoApproveBtn = container.querySelector('#btn-auto-approve');\r\n  if (autoApproveBtn) {\r\n    on(autoApproveBtn as HTMLElement, 'click', async () => {\r\n      if (!state.suggestions.length) {\r\n        toast.info('No pending suggestions to approve');\r\n        return;\r\n      }\r\n      \r\n      const result = await graphService.autoApproveHighConfidence(0.85);\r\n      \r\n      if (result.approved > 0) {\r\n        toast.success(`Auto-approved ${result.approved} high-confidence suggestions`);\r\n        // Refresh suggestions\r\n        const suggestions = await graphService.getOntologySuggestions();\r\n        state.suggestions = suggestions.filter(s => s.status === 'pending');\r\n        updateSuggestionsBadge(parentContainer, state);\r\n      } else {\r\n        toast.info('No suggestions met the confidence threshold');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Render history tab - SOTA v2.0\r\n */\r\nfunction renderHistoryTab(\r\n  container: HTMLElement,\r\n  state: ViewerState\r\n): void {\r\n  if (!state.changes || state.changes.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" opacity=\"0.4\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n          <polyline points=\"12 6 12 12 16 14\"/>\r\n        </svg>\r\n        <h3>No change history</h3>\r\n        <p>Changes to the ontology schema will be logged here.</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"history-container\">\r\n      <h3>Ontology Change History</h3>\r\n      <div class=\"history-list\">\r\n        ${state.changes.map(change => {\r\n          const icon = getChangeIcon(change.change_type);\r\n          const color = getChangeColor(change.change_type);\r\n          return `\r\n            <div class=\"history-item\">\r\n              <div class=\"history-icon\" style=\"color: ${color}\">\r\n                ${icon}\r\n              </div>\r\n              <div class=\"history-content\">\r\n                <div class=\"history-header\">\r\n                  <span class=\"history-type\" style=\"color: ${color}\">${formatChangeType(change.change_type)}</span>\r\n                  <span class=\"history-target\">${escapeHtml(change.target_type || '')}/${escapeHtml(change.target_name || '')}</span>\r\n                </div>\r\n                ${change.reason ? `<p class=\"history-reason\">${escapeHtml(change.reason)}</p>` : ''}\r\n                <div class=\"history-meta\">\r\n                  <span class=\"history-source\">${escapeHtml(change.source || 'manual')}</span>\r\n                  <span class=\"history-date\">${new Date(change.changed_at).toLocaleString()}</span>\r\n                </div>\r\n                ${change.diff ? `\r\n                  <details class=\"history-diff\">\r\n                    <summary>View changes</summary>\r\n                    <pre>${escapeHtml(JSON.stringify(change.diff, null, 2))}</pre>\r\n                  </details>\r\n                ` : ''}\r\n              </div>\r\n            </div>\r\n          `;\r\n        }).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get icon for change type\r\n */\r\nfunction getChangeIcon(changeType: string): string {\r\n  if (changeType.includes('added')) {\r\n    return '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/></svg>';\r\n  }\r\n  if (changeType.includes('removed')) {\r\n    return '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/></svg>';\r\n  }\r\n  if (changeType.includes('modified')) {\r\n    return '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"/><path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"/></svg>';\r\n  }\r\n  return '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"/><line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"/></svg>';\r\n}\r\n\r\n/**\r\n * Get color for change type\r\n */\r\nfunction getChangeColor(changeType: string): string {\r\n  if (changeType.includes('added')) return 'var(--color-success, #10b981)';\r\n  if (changeType.includes('removed')) return 'var(--color-error, #ef4444)';\r\n  if (changeType.includes('modified')) return 'var(--color-warning, #f59e0b)';\r\n  return 'var(--color-info, #3b82f6)';\r\n}\r\n\r\n/**\r\n * Format change type for display\r\n */\r\nfunction formatChangeType(changeType: string): string {\r\n  return changeType\r\n    .replace(/_/g, ' ')\r\n    .replace(/\\b\\w/g, c => c.toUpperCase());\r\n}\r\n\r\n/**\r\n * Render jobs tab - SOTA v2.1 Background Worker\r\n */\r\nfunction renderJobsTab(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  parentContainer: HTMLElement\r\n): void {\r\n  const { workerStatus, workerStats, jobs, jobLog } = state;\r\n  \r\n  container.innerHTML = `\r\n    <div class=\"jobs-container\">\r\n      <div class=\"jobs-header\">\r\n        <h3>Background Optimization Jobs</h3>\r\n        <div class=\"worker-status ${workerStatus?.isRunning ? 'running' : ''}\">\r\n          <span class=\"status-dot ${workerStatus?.isRunning ? 'active' : 'idle'}\"></span>\r\n          <span>${workerStatus?.isRunning ? 'Running' : 'Idle'}</span>\r\n          ${workerStatus?.hasPendingAnalysis ? '<span class=\"pending-badge\">Analysis Pending</span>' : ''}\r\n        </div>\r\n      </div>\r\n      \r\n      ${workerStats ? `\r\n        <div class=\"worker-stats\">\r\n          <div class=\"stat-card\">\r\n            <span class=\"stat-value\">${workerStats.totalExecutions}</span>\r\n            <span class=\"stat-label\">Total Executions</span>\r\n          </div>\r\n          <div class=\"stat-card success\">\r\n            <span class=\"stat-value\">${workerStats.byStatus?.completed || 0}</span>\r\n            <span class=\"stat-label\">Completed</span>\r\n          </div>\r\n          <div class=\"stat-card error\">\r\n            <span class=\"stat-value\">${workerStats.byStatus?.failed || 0}</span>\r\n            <span class=\"stat-label\">Failed</span>\r\n          </div>\r\n          <div class=\"stat-card\">\r\n            <span class=\"stat-value\">${workerStats.avgDuration ? (workerStats.avgDuration / 1000).toFixed(1) + 's' : '-'}</span>\r\n            <span class=\"stat-label\">Avg Duration</span>\r\n          </div>\r\n        </div>\r\n      ` : ''}\r\n      \r\n      <div class=\"jobs-section\">\r\n        <h4>Scheduled Jobs</h4>\r\n        <div class=\"jobs-list\">\r\n          ${jobs.length > 0 ? jobs.map(job => `\r\n            <div class=\"job-card ${job.enabled ? 'enabled' : 'disabled'}\">\r\n              <div class=\"job-info\">\r\n                <div class=\"job-name\">${escapeHtml(job.name)}</div>\r\n                <div class=\"job-meta\">\r\n                  <span class=\"job-schedule\">${escapeHtml(job.schedule)}</span>\r\n                  <span class=\"job-run-count\">${job.runCount} runs</span>\r\n                </div>\r\n                ${job.lastRun ? `<div class=\"job-last-run\">Last: ${new Date(job.lastRun).toLocaleString()}</div>` : ''}\r\n                ${job.nextRun ? `<div class=\"job-next-run\">Next: ${new Date(job.nextRun).toLocaleString()}</div>` : ''}\r\n              </div>\r\n              <div class=\"job-actions\">\r\n                <button class=\"btn btn-sm ${job.enabled ? 'btn-warning' : 'btn-success'} btn-toggle-job\" data-job-id=\"${job.id}\" data-enabled=\"${job.enabled}\">\r\n                  ${job.enabled ? 'Disable' : 'Enable'}\r\n                </button>\r\n                <button class=\"btn btn-sm btn-primary btn-run-job\" data-job-type=\"${job.type.replace('ontology_', '')}\">\r\n                  Run Now\r\n                </button>\r\n              </div>\r\n            </div>\r\n          `).join('') : '<p class=\"text-muted\">No scheduled jobs found.</p>'}\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"jobs-section\">\r\n        <h4>Quick Actions</h4>\r\n        <div class=\"quick-actions\">\r\n          <button class=\"btn btn-sm btn-outline\" id=\"btn-run-full\">\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\r\n              <path d=\"M2 17l10 5 10-5\"/>\r\n            </svg>\r\n            Full Analysis\r\n          </button>\r\n          <button class=\"btn btn-sm btn-outline\" id=\"btn-run-inference\">\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n              <polyline points=\"12 6 12 12 16 14\"/>\r\n            </svg>\r\n            Run Inference\r\n          </button>\r\n          <button class=\"btn btn-sm btn-outline\" id=\"btn-run-dedup\">\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"/>\r\n              <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"/>\r\n            </svg>\r\n            Check Duplicates\r\n          </button>\r\n          <button class=\"btn btn-sm btn-outline\" id=\"btn-run-gaps\">\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n              <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\r\n            </svg>\r\n            Check Gaps\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"jobs-section\">\r\n        <h4>Recent Executions</h4>\r\n        <div class=\"execution-log\">\r\n          ${jobLog.length > 0 ? jobLog.map(exec => `\r\n            <div class=\"execution-item ${exec.status}\">\r\n              <div class=\"execution-type\">${formatJobType(exec.type)}</div>\r\n              <div class=\"execution-status\">${exec.status}</div>\r\n              <div class=\"execution-time\">${exec.startedAt ? new Date(exec.startedAt).toLocaleString() : ''}</div>\r\n              <div class=\"execution-duration\">${exec.duration ? (exec.duration / 1000).toFixed(1) + 's' : '-'}</div>\r\n              ${exec.error ? `<div class=\"execution-error\">${escapeHtml(exec.error)}</div>` : ''}\r\n            </div>\r\n          `).join('') : '<p class=\"text-muted\">No recent executions.</p>'}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind toggle job buttons\r\n  container.querySelectorAll('.btn-toggle-job').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const jobId = btn.getAttribute('data-job-id');\r\n      const currentlyEnabled = btn.getAttribute('data-enabled') === 'true';\r\n      if (jobId) {\r\n        const result = await graphService.toggleOntologyJob(jobId, !currentlyEnabled);\r\n        if (result) {\r\n          toast.success(`Job ${result.enabled ? 'enabled' : 'disabled'}`);\r\n          // Reload jobs\r\n          state.jobs = await graphService.getOntologyJobs();\r\n          renderJobsTab(container, state, parentContainer);\r\n        } else {\r\n          toast.error('Failed to toggle job');\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bind run job buttons\r\n  container.querySelectorAll('.btn-run-job').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const jobType = btn.getAttribute('data-job-type') as 'full' | 'inference' | 'dedup' | 'auto_approve' | 'gaps';\r\n      if (jobType) {\r\n        toast.info(`Running ${jobType}...`);\r\n        const result = await graphService.triggerBackgroundAnalysis(jobType);\r\n        if (result && result.status === 'completed') {\r\n          toast.success(`${jobType} completed`);\r\n        } else if (result?.error) {\r\n          toast.error(`Error: ${result.error}`);\r\n        }\r\n        // Reload log\r\n        state.jobLog = await graphService.getBackgroundWorkerLog({ limit: 10 });\r\n        renderJobsTab(container, state, parentContainer);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bind quick action buttons\r\n  const quickActions = [\r\n    { id: 'btn-run-full', type: 'full' as const },\r\n    { id: 'btn-run-inference', type: 'inference' as const },\r\n    { id: 'btn-run-dedup', type: 'dedup' as const },\r\n    { id: 'btn-run-gaps', type: 'gaps' as const }\r\n  ];\r\n\r\n  quickActions.forEach(({ id, type }) => {\r\n    const btn = container.querySelector(`#${id}`);\r\n    if (btn) {\r\n      on(btn as HTMLElement, 'click', async () => {\r\n        toast.info(`Running ${type} analysis...`);\r\n        btn.classList.add('loading');\r\n        (btn as HTMLButtonElement).disabled = true;\r\n        \r\n        const result = await graphService.triggerBackgroundAnalysis(type);\r\n        \r\n        btn.classList.remove('loading');\r\n        (btn as HTMLButtonElement).disabled = false;\r\n        \r\n        if (result && result.status === 'completed') {\r\n          toast.success(`${type} analysis completed`);\r\n        } else if (result?.error) {\r\n          toast.error(`Error: ${result.error}`);\r\n        }\r\n        \r\n        // Reload worker status and log\r\n        const workerData = await graphService.getBackgroundWorkerStatus();\r\n        state.workerStatus = workerData?.status || null;\r\n        state.workerStats = workerData?.stats || null;\r\n        state.jobLog = await graphService.getBackgroundWorkerLog({ limit: 10 });\r\n        renderJobsTab(container, state, parentContainer);\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render tools tab - SOTA v2.1 Advanced Ontology Tools\r\n */\r\nfunction renderToolsTab(\r\n  container: HTMLElement,\r\n  state: ViewerState,\r\n  parentContainer: HTMLElement\r\n): void {\r\n  const { compliance } = state;\r\n  \r\n  container.innerHTML = `\r\n    <div class=\"tools-container\">\r\n      <div class=\"tools-section graph-status\">\r\n        <h4>Graph Database</h4>\r\n        <p class=\"text-muted\">Supabase PostgreSQL graph storage - fully managed, zero configuration.</p>\r\n        <div class=\"graph-status-card\">\r\n          <div class=\"status-indicator active\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\r\n              <polyline points=\"22 4 12 14.01 9 11.01\"/>\r\n            </svg>\r\n            <span>Connected to Supabase Graph</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"tools-section\">\r\n        <h4>Ontology Compliance</h4>\r\n        <p class=\"text-muted\">Validate that your graph data conforms to the ontology schema.</p>\r\n        \r\n        ${compliance ? `\r\n          <div class=\"compliance-card ${compliance.valid ? 'valid' : 'invalid'}\">\r\n            <div class=\"compliance-header\">\r\n              <div class=\"compliance-score-large ${compliance.score >= 90 ? 'excellent' : compliance.score >= 70 ? 'good' : 'warning'}\">\r\n                <span class=\"score-value\">${compliance.score}%</span>\r\n                <span class=\"score-label\">Compliance</span>\r\n              </div>\r\n              <div class=\"compliance-status\">\r\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  ${compliance.valid ? \r\n                    '<path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/><polyline points=\"22 4 12 14.01 9 11.01\"/>' : \r\n                    '<circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"/><line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"/>'}\r\n                </svg>\r\n                <span>${compliance.valid ? 'Compliant' : 'Issues Found'}</span>\r\n              </div>\r\n            </div>\r\n            \r\n            ${compliance.issues.length > 0 ? `\r\n              <div class=\"compliance-issues\">\r\n                <h5>Issues (${compliance.issues.length})</h5>\r\n                <div class=\"issues-list\">\r\n                  ${compliance.issues.slice(0, 10).map(issue => `\r\n                    <div class=\"issue-item ${issue.severity}\">\r\n                      <span class=\"issue-type\">${issue.type.replace(/_/g, ' ')}</span>\r\n                      <span class=\"issue-message\">${escapeHtml(issue.message)}</span>\r\n                      ${issue.count ? `<span class=\"issue-count\">${issue.count}</span>` : ''}\r\n                    </div>\r\n                  `).join('')}\r\n                  ${compliance.issues.length > 10 ? `<p class=\"text-muted\">...and ${compliance.issues.length - 10} more</p>` : ''}\r\n                </div>\r\n              </div>\r\n            ` : ''}\r\n            \r\n            <div class=\"compliance-actions\">\r\n              <button class=\"btn btn-outline btn-sm\" id=\"btn-recheck-compliance\">\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <polyline points=\"23 4 23 10 17 10\"/>\r\n                  <path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\r\n                </svg>\r\n                Re-check Compliance\r\n              </button>\r\n              <button class=\"btn btn-ghost btn-sm\" id=\"btn-clear-compliance\">Clear</button>\r\n            </div>\r\n          </div>\r\n        ` : `\r\n          <button class=\"btn btn-outline\" id=\"btn-validate-compliance\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M9 11l3 3L22 4\"/>\r\n              <path d=\"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11\"/>\r\n            </svg>\r\n            Run Compliance Check\r\n          </button>\r\n        `}\r\n      </div>\r\n      \r\n      <div class=\"tools-section\">\r\n        <h4>Ontology Extraction</h4>\r\n        <p class=\"text-muted\">Extract ontology schema directly from your graph data.</p>\r\n        <div class=\"tools-grid\">\r\n          <button class=\"btn btn-outline tool-btn\" id=\"btn-extract-ontology\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n              <polyline points=\"7 10 12 15 17 10\"/>\r\n              <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>\r\n            </svg>\r\n            <span>Extract from Graph</span>\r\n            <small>Auto-detect entity & relation types</small>\r\n          </button>\r\n          \r\n          <button class=\"btn btn-outline tool-btn\" id=\"btn-diff-ontology\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"23\"/>\r\n              <path d=\"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\"/>\r\n            </svg>\r\n            <span>Compare with Graph</span>\r\n            <small>See what's different</small>\r\n          </button>\r\n          \r\n          <button class=\"btn btn-outline tool-btn\" id=\"btn-merge-ontology\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <circle cx=\"18\" cy=\"5\" r=\"3\"/>\r\n              <circle cx=\"6\" cy=\"12\" r=\"3\"/>\r\n              <circle cx=\"18\" cy=\"19\" r=\"3\"/>\r\n              <line x1=\"8.59\" y1=\"13.51\" x2=\"15.42\" y2=\"17.49\"/>\r\n              <line x1=\"15.41\" y1=\"6.51\" x2=\"8.59\" y2=\"10.49\"/>\r\n            </svg>\r\n            <span>Merge & Update</span>\r\n            <small>Add discovered types to schema</small>\r\n          </button>\r\n          \r\n          <button class=\"btn btn-outline tool-btn\" id=\"btn-find-unused\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n              <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\r\n              <line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\"/>\r\n            </svg>\r\n            <span>Find Unused Types</span>\r\n            <small>Types in schema but not in graph</small>\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      ${state.unusedTypes ? `\r\n        <div class=\"tools-section unused-types-section\">\r\n          <h4>Unused Types Found</h4>\r\n          <p class=\"text-muted\">These types are defined in the schema but have no instances in the graph.</p>\r\n          \r\n          ${state.unusedTypes.entities.length > 0 ? `\r\n            <div class=\"unused-group\">\r\n              <h5>Unused Entities (${state.unusedTypes.entities.length})</h5>\r\n              <div class=\"unused-chips\">\r\n                ${state.unusedTypes.entities.map(e => `<span class=\"unused-chip entity\">${escapeHtml(e)}</span>`).join('')}\r\n              </div>\r\n            </div>\r\n          ` : ''}\r\n          \r\n          ${state.unusedTypes.relations.length > 0 ? `\r\n            <div class=\"unused-group\">\r\n              <h5>Unused Relations (${state.unusedTypes.relations.length})</h5>\r\n              <div class=\"unused-chips\">\r\n                ${state.unusedTypes.relations.map(r => `<span class=\"unused-chip relation\">${escapeHtml(r)}</span>`).join('')}\r\n              </div>\r\n            </div>\r\n          ` : ''}\r\n          \r\n          <div class=\"unused-actions\">\r\n            <button class=\"btn btn-warning btn-sm\" id=\"btn-remove-unused\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polyline points=\"3 6 5 6 21 6\"/>\r\n                <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/>\r\n              </svg>\r\n              Remove All Unused Types\r\n            </button>\r\n            <button class=\"btn btn-ghost btn-sm\" id=\"btn-clear-unused\">Clear</button>\r\n          </div>\r\n        </div>\r\n      ` : ''}\r\n      \r\n      <div class=\"tools-section\">\r\n        <h4>Cleanup</h4>\r\n        <p class=\"text-muted\">Remove orphan types from the ontology schema.</p>\r\n        <div class=\"cleanup-buttons\">\r\n          <button class=\"btn btn-ghost btn-sm\" id=\"btn-cleanup-entities\">\r\n            Remove Entities Without Relations\r\n          </button>\r\n          <button class=\"btn btn-ghost btn-sm\" id=\"btn-cleanup-relations\">\r\n            Remove Relations Without Entities\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n    </div>\r\n  `;\r\n\r\n  // Bind event handlers\r\n  \r\n  // Validate compliance (initial and re-check)\r\n  const validateBtn = container.querySelector('#btn-validate-compliance') || container.querySelector('#btn-recheck-compliance');\r\n  if (validateBtn) {\r\n    on(validateBtn as HTMLElement, 'click', async () => {\r\n      toast.info('Validating compliance...');\r\n      validateBtn.classList.add('loading');\r\n      (validateBtn as HTMLButtonElement).disabled = true;\r\n      \r\n      const result = await graphService.validateOntologyCompliance();\r\n      \r\n      validateBtn.classList.remove('loading');\r\n      (validateBtn as HTMLButtonElement).disabled = false;\r\n      \r\n      if (result) {\r\n        state.compliance = result;\r\n        toast.success(`Compliance: ${result.score}% - ${result.issues.length} issues found`);\r\n        renderToolsTab(container, state, parentContainer);\r\n      } else {\r\n        toast.error('Failed to validate compliance');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Clear compliance results\r\n  const clearComplianceBtn = container.querySelector('#btn-clear-compliance');\r\n  if (clearComplianceBtn) {\r\n    on(clearComplianceBtn as HTMLElement, 'click', () => {\r\n      state.compliance = null;\r\n      renderToolsTab(container, state, parentContainer);\r\n    });\r\n  }\r\n  \r\n  // Extract from graph\r\n  const extractBtn = container.querySelector('#btn-extract-ontology');\r\n  if (extractBtn) {\r\n    on(extractBtn as HTMLElement, 'click', async () => {\r\n      toast.info('Extracting ontology from graph...');\r\n      extractBtn.classList.add('loading');\r\n      \r\n      const result = await graphService.extractOntologyFromGraph();\r\n      \r\n      extractBtn.classList.remove('loading');\r\n      \r\n      if (result.ok && result.ontology) {\r\n        const entityCount = Object.keys(result.ontology.entityTypes).length;\r\n        const relCount = Object.keys(result.ontology.relationTypes).length;\r\n        toast.success(`Extracted: ${entityCount} entities, ${relCount} relations`);\r\n      } else {\r\n        toast.error(result.error || 'Failed to extract ontology');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Diff ontology\r\n  const diffBtn = container.querySelector('#btn-diff-ontology');\r\n  if (diffBtn) {\r\n    on(diffBtn as HTMLElement, 'click', async () => {\r\n      toast.info('Comparing ontology with graph...');\r\n      diffBtn.classList.add('loading');\r\n      \r\n      const result = await graphService.getOntologyDiff();\r\n      \r\n      diffBtn.classList.remove('loading');\r\n      \r\n      if (result) {\r\n        const { diff } = result;\r\n        const inSchemaOnly = diff.entitiesOnlyInA.length + diff.relationsOnlyInA.length;\r\n        const inGraphOnly = diff.entitiesOnlyInB.length + diff.relationsOnlyInB.length;\r\n        \r\n        if (inSchemaOnly === 0 && inGraphOnly === 0) {\r\n          toast.success('Schema and graph are in sync!');\r\n        } else {\r\n          toast.info(`Diff: ${inSchemaOnly} only in schema, ${inGraphOnly} only in graph`);\r\n        }\r\n      } else {\r\n        toast.error('Failed to compare ontology');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Merge ontology\r\n  const mergeBtn = container.querySelector('#btn-merge-ontology');\r\n  if (mergeBtn) {\r\n    on(mergeBtn as HTMLElement, 'click', async () => {\r\n      toast.info('Merging ontology...');\r\n      mergeBtn.classList.add('loading');\r\n      \r\n      const result = await graphService.mergeOntology({ \r\n        mergeProperties: true, \r\n        mergeEndpoints: true, \r\n        save: true \r\n      });\r\n      \r\n      mergeBtn.classList.remove('loading');\r\n      \r\n      if (result.ok) {\r\n        const changeCount = result.changes?.length || 0;\r\n        if (changeCount > 0) {\r\n          toast.success(`Merged: ${changeCount} changes applied`);\r\n        } else {\r\n          toast.info('No new types to merge');\r\n        }\r\n      } else {\r\n        toast.error('Failed to merge ontology');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Find unused\r\n  const unusedBtn = container.querySelector('#btn-find-unused');\r\n  if (unusedBtn) {\r\n    on(unusedBtn as HTMLElement, 'click', async () => {\r\n      toast.info('Finding unused types...');\r\n      unusedBtn.classList.add('loading');\r\n      \r\n      const unused = await graphService.findUnusedOntologyTypes();\r\n      \r\n      unusedBtn.classList.remove('loading');\r\n      \r\n      state.unusedTypes = unused;\r\n      const total = unused.entities.length + unused.relations.length;\r\n      if (total === 0) {\r\n        toast.success('All types are in use!');\r\n      } else {\r\n        toast.info(`Found ${unused.entities.length} unused entities, ${unused.relations.length} unused relations`);\r\n      }\r\n      renderToolsTab(container, state, parentContainer);\r\n    });\r\n  }\r\n  \r\n  // Remove unused types\r\n  const removeUnusedBtn = container.querySelector('#btn-remove-unused');\r\n  if (removeUnusedBtn) {\r\n    on(removeUnusedBtn as HTMLElement, 'click', async () => {\r\n      if (!state.unusedTypes) return;\r\n      \r\n      toast.info('Removing unused types...');\r\n      removeUnusedBtn.classList.add('loading');\r\n      (removeUnusedBtn as HTMLButtonElement).disabled = true;\r\n      \r\n      // Remove entities and relations\r\n      const result = await graphService.cleanupOntology({\r\n        discardEntitiesWithoutRelations: true,\r\n        discardRelationsWithoutEntities: true,\r\n        save: true\r\n      });\r\n      \r\n      removeUnusedBtn.classList.remove('loading');\r\n      (removeUnusedBtn as HTMLButtonElement).disabled = false;\r\n      \r\n      if (result.ok) {\r\n        const removedCount = (result.discardedEntities?.length || 0) + (result.discardedRelations?.length || 0);\r\n        toast.success(`Removed ${removedCount} unused types`);\r\n        state.unusedTypes = null;\r\n        renderToolsTab(container, state, parentContainer);\r\n      } else {\r\n        toast.error('Failed to remove unused types');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Clear unused types display\r\n  const clearUnusedBtn = container.querySelector('#btn-clear-unused');\r\n  if (clearUnusedBtn) {\r\n    on(clearUnusedBtn as HTMLElement, 'click', () => {\r\n      state.unusedTypes = null;\r\n      renderToolsTab(container, state, parentContainer);\r\n    });\r\n  }\r\n  \r\n  // Cleanup entities\r\n  const cleanupEntitiesBtn = container.querySelector('#btn-cleanup-entities');\r\n  if (cleanupEntitiesBtn) {\r\n    on(cleanupEntitiesBtn as HTMLElement, 'click', async () => {\r\n      const result = await graphService.cleanupOntology({ \r\n        discardEntitiesWithoutRelations: true, \r\n        save: true \r\n      });\r\n      if (result.ok) {\r\n        toast.success(`Removed ${result.discardedEntities?.length || 0} orphan entities`);\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Cleanup relations\r\n  const cleanupRelationsBtn = container.querySelector('#btn-cleanup-relations');\r\n  if (cleanupRelationsBtn) {\r\n    on(cleanupRelationsBtn as HTMLElement, 'click', async () => {\r\n      const result = await graphService.cleanupOntology({ \r\n        discardRelationsWithoutEntities: true, \r\n        save: true \r\n      });\r\n      if (result.ok) {\r\n        toast.success(`Removed ${result.discardedRelations?.length || 0} orphan relations`);\r\n      }\r\n    });\r\n  }\r\n  \r\n}\r\n\r\n/**\r\n * Format job type for display\r\n */\r\nfunction formatJobType(type: string): string {\r\n  return type\r\n    .replace('ontology_', '')\r\n    .replace(/_/g, ' ')\r\n    .replace(/\\b\\w/g, c => c.toUpperCase());\r\n}\r\n\r\n/**\r\n * Update jobs badge\r\n */\r\nfunction updateJobsBadge(container: HTMLElement, state: ViewerState): void {\r\n  const badge = container.querySelector('#jobs-badge') as HTMLElement;\r\n  if (!badge) return;\r\n\r\n  if (state.workerStatus?.isRunning) {\r\n    badge.textContent = '';\r\n    badge.className = 'badge job-status-badge running';\r\n    badge.style.display = '';\r\n    badge.title = 'Job running';\r\n  } else if (state.workerStatus?.hasPendingAnalysis) {\r\n    badge.textContent = '';\r\n    badge.className = 'badge job-status-badge pending';\r\n    badge.style.display = '';\r\n    badge.title = 'Analysis pending';\r\n  } else {\r\n    badge.style.display = 'none';\r\n  }\r\n}\r\n\r\n/**\r\n * Update stats\r\n */\r\nfunction updateStats(container: HTMLElement, state: ViewerState): void {\r\n  const statsEl = container.querySelector('#ontology-stats');\r\n  const versionEl = container.querySelector('#ontology-version');\r\n\r\n  if (statsEl && state.schema) {\r\n    const entityCount = Object.keys(state.schema.entityTypes || {}).length;\r\n    const relationCount = Object.keys(state.schema.relationTypes || {}).length;\r\n    const queryCount = Object.keys(state.schema.queryPatterns || {}).length;\r\n\r\n    statsEl.innerHTML = `\r\n      <span class=\"stat\">${entityCount} entities</span>\r\n      <span class=\"stat\">${relationCount} relations</span>\r\n      <span class=\"stat\">${queryCount} patterns</span>\r\n    `;\r\n  }\r\n\r\n  if (versionEl && state.schema) {\r\n    versionEl.innerHTML = `Schema v${state.schema.version}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Update suggestions badge\r\n */\r\nfunction updateSuggestionsBadge(container: HTMLElement, state: ViewerState): void {\r\n  const badge = container.querySelector('#suggestions-badge') as HTMLElement;\r\n  if (badge) {\r\n    if (state.suggestions.length > 0) {\r\n      badge.textContent = String(state.suggestions.length);\r\n      badge.style.display = '';\r\n    } else {\r\n      badge.style.display = 'none';\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createOntologyViewer;\r\n"],"names":["createOntologyViewer","props","state","container","createElement","initOntologyViewer","tab","on","tabId","switchTab","searchInput","renderCurrentTab","syncBtn","toast","result","graphService","loadOntologyData","schema","suggestions","typeStats","syncStatus","changes","workerData","jobs","jobLog","falkorBrowserInfo","s","badge","updateJobsBadge","updateSyncIndicator","updateStats","error","content","indicator","dot","sourceEl","renderEntitiesTab","renderRelationsTab","renderGraphTab","renderAnalyticsTab","renderSuggestionsTab","renderHistoryTab","renderJobsTab","renderToolsTab","entities","name","entity","a","b","escapeHtml","propEntries","hasMoreProps","propName","prop","card","e","c","showEntityDetails","entityList","detailPanel","listRect","offsetTop","btn","entityName","propsList","hiddenProps","panel","p","ex","relations","relation","t","canvas","vis","nodes","color","getTextColor","edges","rel","fromTypes","toTypes","from","to","data","options","network","parentContainer","hasGaps","hasUnused","analyzeBtn","updateSuggestionsBadge","checkGapsBtn","suggestion","id","stats","compliance","resultsEl","autoApproveBtn","change","icon","getChangeIcon","getChangeColor","formatChangeType","changeType","workerStatus","workerStats","job","exec","formatJobType","jobId","currentlyEnabled","jobType","type","issue","r","validateBtn","clearComplianceBtn","extractBtn","entityCount","relCount","diffBtn","diff","inSchemaOnly","inGraphOnly","mergeBtn","changeCount","unusedBtn","unused","removeUnusedBtn","removedCount","clearUnusedBtn","cleanupEntitiesBtn","cleanupRelationsBtn","statsEl","versionEl","relationCount","queryCount","text","div"],"mappings":"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"}