import{r as o,j as e}from"./vendor-react-CZ-WyKWZ.js";import{t as I}from"./vendor-ui-BS9QKitv.js";import{c as x,X as J,H as xe,P as me,r as ue,g as pe,Q as ge,V as he,W as fe,D as ye,Y as be,_ as ve,$ as je,a0 as Ne,f as we,a1 as ke,a2 as Ce,a3 as Se,a4 as Re,L as F,a5 as De,a6 as Me,a7 as Ie,a8 as Z,a9 as Te,aa as Ee,ab as Be}from"./main-B3DZn5B_.js";import{R as Ae}from"./rotate-cw-wbVSlX31.js";import{M as Fe,r as Pe}from"./vendor-markdown-Cu8AM8lU.js";import{C as $e}from"./copy-DJTzHNZE.js";import{T as Qe,a as Le}from"./thumbs-up-CvVh3ELI.js";import{B as qe}from"./brain-BD_Z4K1O.js";import{S as Oe}from"./send-CaMoZtNQ.js";import{P as ze}from"./pencil-BJDfGHvR.js";import"./vendor-supabase-Bpw_79gH.js";import"./vendor-query-DSf7I7Ei.js";import"./vendor-router-D_XeKoA_.js";function K({contact:r,compact:s}){const a=ue(r);return e.jsxs("div",{className:x("flex items-center gap-2 min-w-0",s?"py-0":"py-0.5"),children:[a?e.jsx("img",{src:a,alt:"",className:x("rounded-full object-cover shrink-0 bg-secondary",s?"w-5 h-5":"w-7 h-7")}):e.jsx("div",{className:x("rounded-full bg-primary/10 text-primary font-bold flex items-center justify-center shrink-0",s?"w-5 h-5 text-[8px]":"w-7 h-7 text-[10px]"),children:pe(r.name||"?")}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:x("font-medium text-foreground block truncate",s?"text-[11px]":"text-xs"),children:r.name}),!s&&(r.role||r.organization)&&e.jsx("span",{className:"text-[10px] text-muted-foreground block truncate",children:[r.role,r.organization].filter(Boolean).join(" · ")})]}),r.role&&s&&e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-secondary text-muted-foreground shrink-0",children:r.role})]})}function V({contacts:r,value:s,onChange:a,placeholder:n="No context",className:m,compact:l}){const[u,R]=o.useState(!1),[D,M]=o.useState(""),h=o.useRef(null),j=o.useRef(null),N=r.find(d=>d.id===s)??null,S=D.trim()?r.filter(d=>{const f=D.toLowerCase();return d.name?.toLowerCase().includes(f)||d.role?.toLowerCase().includes(f)||d.organization?.toLowerCase().includes(f)||d.email?.toLowerCase().includes(f)}):r;o.useEffect(()=>{if(!u)return;const d=f=>{h.current&&!h.current.contains(f.target)&&(R(!1),M(""))};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[u]),o.useEffect(()=>{u&&j.current&&j.current.focus()},[u]);const w=o.useCallback(d=>{a(d),R(!1),M("")},[a]);return e.jsxs("div",{ref:h,className:x("relative",m),children:[e.jsxs("button",{type:"button",onClick:()=>R(!u),className:x("w-full flex items-center gap-2 rounded-lg border border-border bg-card px-2.5 text-left transition-colors hover:bg-secondary/50 focus:outline-none focus:ring-2 focus:ring-ring",l?"py-1":"py-1.5"),children:[N?e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(K,{contact:N,compact:l})}):e.jsx("span",{className:x("flex-1 text-muted-foreground",l?"text-[11px]":"text-xs"),children:n}),N&&e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),w(null)},className:"p-0.5 rounded hover:bg-secondary text-muted-foreground hover:text-foreground shrink-0",children:e.jsx(J,{className:"w-3 h-3"})}),e.jsx(xe,{className:x("w-3 h-3 text-muted-foreground shrink-0 transition-transform",u&&"rotate-180")})]}),u&&e.jsxs("div",{className:"absolute z-50 top-full left-0 right-0 mt-1 rounded-lg border border-border bg-popover shadow-lg overflow-hidden animate-in fade-in-0 zoom-in-95 duration-100",children:[r.length>5&&e.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-2 border-b border-border",children:[e.jsx(me,{className:"w-3 h-3 text-muted-foreground shrink-0"}),e.jsx("input",{ref:j,type:"text",value:D,onChange:d=>M(d.target.value),placeholder:"Search contacts...",className:"flex-1 bg-transparent text-xs text-foreground placeholder:text-muted-foreground focus:outline-none"})]}),e.jsx("button",{type:"button",onClick:()=>w(null),className:x("w-full text-left px-3 py-2 text-xs text-muted-foreground hover:bg-secondary/50 transition-colors border-b border-border/50",!s&&"bg-primary/5 text-primary font-medium"),children:n}),e.jsx("div",{className:"max-h-[240px] overflow-y-auto scrollbar-thin",children:S.length===0?e.jsx("p",{className:"text-xs text-muted-foreground text-center py-4",children:"No contacts found"}):S.map(d=>e.jsx("button",{type:"button",onClick:()=>w(d.id),className:x("w-full text-left px-3 py-2 hover:bg-secondary/50 transition-colors",d.id===s&&"bg-primary/5"),children:e.jsx(K,{contact:d})},d.id))})]})]})}const W="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",_e="w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] transition-all duration-150",O="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",Ue="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",Y=["Summarize key risks","List open questions","What actions are overdue?","Who are the key contacts?"];function Ge(r){if(!r)return"—";const s=new Date(r).getTime();if(isNaN(s))return"—";const a=Date.now()-s,n=Math.floor(a/6e4);if(n<1)return"just now";if(n<60)return`${n}m ago`;const m=Math.floor(n/60);return m<24?`${m}h ago`:`${Math.floor(m/24)}d ago`}function He({msg:r}){if(r.role!=="assistant")return null;const s=[];if(r.confidence){const a=r.confidence==="high"?"bg-emerald-500/15 text-emerald-400":r.confidence==="medium"?"bg-amber-500/15 text-amber-400":"bg-red-500/15 text-red-400";s.push({label:r.confidence,cls:a,title:"Confidence"})}if(r.queryType&&s.push({label:r.queryType,cls:"bg-indigo-500/15 text-indigo-400",title:"Query type"}),r.rag){const a=r.rag.usedHyDE?"HyDE+RRF":r.rag.graphResults>0?"Graph+Vector":"Hybrid";s.push({label:a,cls:"bg-purple-500/15 text-purple-400",title:`RAG: ${r.rag.method??a}`});const n=r.rag.fusedResults||r.rag.vectorResults+r.rag.graphResults;if(n>0&&s.push({label:`${n} sources`,cls:"bg-sky-500/15 text-sky-400",title:"Sources found"}),r.rag.tokenBudget?.estimated){const m=r.rag.tokenBudget.limit?Math.round(r.rag.tokenBudget.estimated/r.rag.tokenBudget.limit*100):null,l=m?`${m}% ctx`:`~${Math.round(r.rag.tokenBudget.estimated/1e3)}k tok`,u=r.rag.tokenBudget.truncated?"bg-orange-500/15 text-orange-400":"bg-zinc-500/15 text-zinc-400";s.push({label:l,cls:u,title:`Tokens: ~${r.rag.tokenBudget.estimated}${r.rag.tokenBudget.limit?` / ${r.rag.tokenBudget.limit}`:""}${r.rag.tokenBudget.truncated?" (truncated)":""}`})}}return s.length===0?null:e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2 pt-2 border-t border-white/10",children:s.map((a,n)=>e.jsx("span",{title:a.title,className:x("text-[10px] font-semibold uppercase tracking-wide px-2 py-0.5 rounded-full",a.cls),children:a.label},n))})}function Ke({sources:r}){const s=r.filter(a=>a.contactName);return s.length===0?null:e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.map((a,n)=>e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-purple-500/10 border border-purple-500/20 text-xs",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-500/30 text-purple-400 flex items-center justify-center text-[10px] font-bold shrink-0",children:(a.contactName||"?")[0]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"font-semibold text-purple-300 block truncate",children:a.contactName}),a.contactRole&&e.jsx("span",{className:"text-[10px] text-purple-400/70",children:a.contactRole})]})]},n))})}function Ve({sources:r}){const[s,a]=o.useState(!1),n=r.filter(l=>!l.contactName);if(n.length===0)return null;const m=n.slice(0,5);return e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsxs("button",{onClick:()=>a(!s),className:"flex items-center gap-1 text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:[e.jsx(Be,{className:x("w-3 h-3 transition-transform",s&&"rotate-90")}),r.length," sources used"]}),s&&e.jsxs("div",{className:"mt-1.5 p-2 rounded-lg bg-[var(--gm-bg-tertiary)] space-y-1",children:[m.map((l,u)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] capitalize text-[10px] font-medium",children:l.type||"unknown"}),e.jsxs("span",{className:"text-[var(--gm-accent-primary)] font-semibold text-[10px] min-w-[30px]",children:[Math.round((l.rrfScore??l.score??0)*100),"%"]}),l.sourceCount&&l.sourceCount>1&&e.jsxs("span",{className:"text-[9px] px-1 rounded bg-purple-500/20 text-purple-400 font-semibold",children:["x",l.sourceCount]}),l.source&&e.jsx("span",{className:"ml-auto text-[var(--gm-text-tertiary)] text-[9px] truncate max-w-[120px]",children:l.source})]},u)),n.length>5&&e.jsxs("div",{className:"text-[var(--gm-text-tertiary)] text-[10px] text-center pt-1 border-t border-[var(--gm-border-primary)]",children:["+",n.length-5," more"]})]})]})}function We({sessions:r,currentId:s,onSelect:a,onCreate:n,onDelete:m,onRename:l,contacts:u,onContextChange:R}){const[D,M]=o.useState(""),[h,j]=o.useState(null),[N,S]=o.useState(""),w=r.find(c=>c.id===s),d=c=>{j(c.id),S(c.title||"")},f=()=>{h&&N.trim()&&l(h,N.trim()),j(null)};return e.jsxs("div",{className:"w-60 min-w-[200px] border-r border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)] flex flex-col overflow-hidden shrink-0",children:[e.jsxs("button",{onClick:()=>n(D||null),className:x(O,"m-2 px-3 py-2 text-sm"),children:[e.jsx(Te,{className:"w-4 h-4"})," New Conversation"]}),u.length>0&&e.jsxs("div",{className:"px-3 pb-2 space-y-1",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"As who?"}),e.jsx(V,{contacts:u,value:D||null,onChange:c=>M(c??""),placeholder:"No context",compact:!0})]}),w&&u.length>0&&e.jsxs("div",{className:"px-3 pb-2 pt-1 border-t border-[var(--gm-border-primary)] space-y-1",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Session context"}),e.jsx(V,{contacts:u,value:w.context_contact_id??null,onChange:R,placeholder:"No context",compact:!0})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-0.5",children:[r.map(c=>e.jsxs("div",{className:x("group w-full text-left flex flex-col gap-0.5 px-3 py-2 rounded-lg text-xs transition-colors cursor-pointer",c.id===s?"bg-[var(--gm-interactive-primary)]/15 text-[var(--gm-accent-primary)] font-medium":"text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] hover:text-[var(--gm-text-primary)]"),onClick:()=>{h!==c.id&&a(c.id)},children:[h===c.id?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{autoFocus:!0,value:N,onChange:g=>S(g.target.value),onKeyDown:g=>{g.key==="Enter"&&f(),g.key==="Escape"&&j(null)},className:"flex-1 bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-focus)] rounded px-1 py-0.5 text-xs text-[var(--gm-text-primary)] outline-none",onClick:g=>g.stopPropagation()}),e.jsx("button",{onClick:g=>{g.stopPropagation(),f()},className:"text-emerald-400 hover:text-emerald-300",children:e.jsx(Ee,{className:"w-3 h-3"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),j(null)},className:"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(J,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"truncate flex-1",children:(c.title||"Untitled").length>30?(c.title||"Untitled").substring(0,27)+"...":c.title||"Untitled"}),e.jsxs("div",{className:"hidden group-hover:flex items-center gap-0.5 shrink-0",children:[e.jsx("button",{onClick:g=>{g.stopPropagation(),d(c)},className:"p-0.5 rounded hover:bg-[var(--gm-surface-hover)] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",title:"Rename",children:e.jsx(ze,{className:"w-2.5 h-2.5"})}),e.jsx("button",{onClick:g=>{g.stopPropagation(),m(c.id)},className:"p-0.5 rounded hover:bg-red-500/10 text-[var(--gm-text-tertiary)] hover:text-red-400",title:"Delete",children:e.jsx(Z,{className:"w-2.5 h-2.5"})})]})]}),e.jsx("span",{className:"text-[10px] opacity-60",children:Ge(c.updated_at)})]},c.id)),r.length===0&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] text-center py-4",children:"No conversations yet"})]})]})}function ct(){const[r,s]=o.useState("rag"),[a,n]=o.useState(null),[m,l]=o.useState([]),[u,R]=o.useState(""),[D,M]=o.useState(!1),[h,j]=o.useState(!1),N=o.useRef(null),S=o.useRef(null),w=ge(),d=he(),f=fe(),c=ye(D),{data:g,refetch:k}=be(),z=ve(),B=je(),_=Ne(),{data:A}=we(),{data:P}=ke(a),$=Ce(),Q=Se(),L=Re(),ee=g?.sessions??[],te=o.useMemo(()=>{if(!A)return[];const t=A?.contacts??A;return Array.isArray(t)?t:[]},[A]),T=w.isPending||d.isPending,U=o.useCallback(()=>{const t={},i=Array.isArray($.data)?$.data:[],v=Array.isArray(Q.data)?Q.data:[],C=Array.isArray(L.data)?L.data:[];return i.length>0&&(t.facts=i.slice(0,30).map(y=>({content:y.content,category:y.category}))),v.length>0&&(t.questions=v.slice(0,20).map(y=>({content:y.content,priority:y.priority,assignee:y.assignee}))),C.length>0&&(t.decisions=C.slice(0,20).map(y=>({content:y.content,date:y.date,owner:y.owner}))),Object.keys(t).length>0?t:void 0},[$.data,Q.data,L.data]),re=o.useCallback(t=>{navigator.clipboard.writeText(t).then(()=>I.success("Copied to clipboard"),()=>I.error("Failed to copy"))},[]),G=o.useCallback((t,i)=>{l(v=>v.map(C=>C.id===t?{...C,feedback:C.feedback===i?null:i}:C)),a&&f.mutate({sessionId:a,messageId:t,feedback:i})},[a,f]);o.useEffect(()=>{if(!P)return;const t=P?.messages??[];l(t.map(i=>({id:i.id,role:i.role,content:i.content,timestamp:i.created_at,sources:i.sources,confidence:i.metadata?.confidence,queryType:i.metadata?.queryType,rag:i.metadata?.rag,contextQuality:i.metadata?.contextQuality})))},[P]),o.useEffect(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[m]);const ae=o.useCallback(t=>{R(t.target.value);const i=t.target;i.style.height="auto",i.style.height=Math.min(i.scrollHeight,120)+"px"},[]),se=o.useCallback(t=>{n(t)},[]),ne=o.useCallback(t=>{z.mutate({title:"New conversation",contextContactId:t??null},{onSuccess:i=>{const v=i?.session;v&&(n(v.id),l([]),k())}})},[z,k]),oe=o.useCallback(t=>{_.mutate(t,{onSuccess:()=>{a===t&&(n(null),l([])),k(),I.success("Conversation deleted")},onError:()=>I.error("Failed to delete conversation")})},[_,a,k]),ie=o.useCallback((t,i)=>{B.mutate({sessionId:t,title:i},{onSuccess:()=>{k(),I.success("Renamed")},onError:()=>I.error("Failed to rename")})},[B,k]),le=o.useCallback(t=>{a&&B.mutate({sessionId:a,contextContactId:t},{onSuccess:()=>{I.success("Context updated"),k()},onError:()=>I.error("Failed to update context")})},[a,B,k]),E=o.useCallback(t=>{const i=(t??u).trim();if(!i||T)return;const v={id:`msg-${Date.now()}-user`,role:"user",content:i,timestamp:new Date().toISOString()};l(b=>[...b,v]),R(""),S.current&&(S.current.style.height="auto");const C=m.slice(-10).map(b=>({role:b.role,content:b.content}));if(r==="sot"){d.mutate({message:i,history:C},{onSuccess:b=>{const p=b;l(q=>[...q,{id:`msg-${Date.now()}-assistant`,role:"assistant",content:p.response,timestamp:new Date().toISOString(),sources:p.sources,contextQuality:p.contextQuality,confidence:p.confidence,queryType:p.queryType,rag:p.rag}])},onError:b=>{l(p=>[...p,{id:`msg-${Date.now()}-error`,role:"system",content:`Error: ${b.message}`,timestamp:new Date().toISOString()}])}});return}const y=U();w.mutate({message:i,history:C,sessionId:a??void 0,deepReasoning:h||void 0,context:y},{onSuccess:b=>{const p=b,q={id:`msg-${Date.now()}-assistant`,role:"assistant",content:p.response,timestamp:new Date().toISOString(),sources:p.sources,contextQuality:p.contextQuality,confidence:p.confidence,queryType:p.queryType,rag:p.rag,suggestedFollowups:p.suggestedFollowups};l(de=>[...de,q]),p.sessionId&&!a&&(n(p.sessionId),k())},onError:b=>{l(p=>[...p,{id:`msg-${Date.now()}-error`,role:"system",content:`Error: ${b.message}`,timestamp:new Date().toISOString()}])}})},[u,m,T,r,w,d,a,k,h,U]),ce=o.useCallback(()=>{l([]),n(null)},[]),H=[{key:"rag",label:"RAG Chat",icon:De,desc:"Query all project knowledge"},{key:"sot",label:"SOT Chat",icon:Me,desc:"Source of Truth focused"},{key:"briefing",label:"Briefing",icon:Ie,desc:"Daily project briefing"}];return r==="briefing"?e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:"Daily Briefing"}),e.jsxs("button",{onClick:()=>{M(!0),c.refetch().then(()=>M(!1))},disabled:c.isFetching,className:x(O,"flex items-center gap-1.5"),children:[c.isFetching?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ae,{className:"w-3.5 h-3.5"}),"Refresh"]})]}),e.jsx(X,{modes:H,current:r,onChange:s}),c.isLoading?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-[var(--gm-accent-primary)]"})}):c.error?e.jsx("div",{className:x(W,"p-6 text-center text-[var(--gm-text-tertiary)]"),children:"Failed to load briefing."}):e.jsxs("div",{className:x(W,"p-6"),children:[c.data?.generated_at&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mb-4",children:["Generated: ",new Date(c.data.generated_at).toLocaleString()]}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-[var(--gm-text-primary)] whitespace-pre-wrap",children:c.data?.briefing||c.data?.content||"No briefing available."}),c.data?.analysis&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] mb-2",children:"Analysis"}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-[var(--gm-text-tertiary)] whitespace-pre-wrap",children:c.data.analysis})]})]})]}):e.jsxs("div",{className:"flex h-[calc(100vh-4rem)]",children:[r==="rag"&&e.jsx(We,{sessions:ee,currentId:a,onSelect:se,onCreate:ne,onDelete:oe,onRename:ie,contacts:te,onContextChange:le}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-3 border-b border-[var(--gm-border-primary)] shrink-0",children:[e.jsx("h1",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:"Chat"}),e.jsx("div",{className:"flex gap-2",children:m.length>0&&e.jsxs("button",{onClick:ce,className:x(Ue,"flex items-center gap-1.5"),children:[e.jsx(Z,{className:"w-3.5 h-3.5"})," Clear"]})})]}),e.jsx("div",{className:"px-6 pt-3",children:e.jsx(X,{modes:H,current:r,onChange:s})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[m.length===0&&e.jsxs("div",{className:"text-center text-[var(--gm-text-tertiary)] py-12 space-y-4",children:[e.jsx("p",{children:r==="sot"?"Ask about facts, decisions, risks, and actions.":"Ask a question about your project knowledge base."}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:Y.map(t=>e.jsx("button",{onClick:()=>E(t),className:"px-3 py-1.5 text-xs rounded-full border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] text-[var(--gm-text-tertiary)] hover:border-[var(--gm-accent-primary)] hover:text-[var(--gm-accent-primary)] transition-colors",children:t},t))})]}),m.map(t=>e.jsxs("div",{children:[e.jsxs("div",{className:x("group/msg max-w-[80%] rounded-xl p-3 text-sm relative",t.role==="user"?"ml-auto bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)]":t.role==="system"?"mx-auto bg-[var(--color-danger-500)]/10 text-[var(--color-danger-500)]":"bg-[var(--gm-bg-tertiary)]"),children:[t.role==="assistant"?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none prose-p:my-1 prose-ul:my-1 prose-ol:my-1 prose-li:my-0.5 prose-headings:my-2 prose-pre:my-2 prose-code:text-[var(--gm-accent-primary)] prose-code:bg-[var(--gm-bg-tertiary)] prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-xs",children:e.jsx(Fe,{remarkPlugins:[Pe],children:t.content})}):e.jsx("div",{className:"whitespace-pre-wrap",children:t.content}),e.jsxs("div",{className:"flex items-center justify-between mt-1.5",children:[e.jsx("span",{className:"text-[10px] opacity-50",children:t.timestamp?new Date(t.timestamp).toLocaleTimeString():"—"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[t.contextQuality&&t.role==="assistant"&&e.jsxs("span",{className:x("text-[9px] px-2 py-0.5 rounded-full font-medium",t.contextQuality==="high"?"bg-emerald-500/10 text-emerald-400":t.contextQuality==="medium"?"bg-amber-500/10 text-amber-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"),children:[t.contextQuality," ctx"]}),t.role==="assistant"&&e.jsxs("div",{className:"hidden group-hover/msg:flex items-center gap-0.5 ml-1",children:[e.jsx("button",{onClick:()=>re(t.content),className:"p-1 rounded hover:bg-white/10 text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",title:"Copy",children:e.jsx($e,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>G(t.id,"up"),className:x("p-1 rounded hover:bg-white/10 transition-colors",t.feedback==="up"?"text-emerald-400":"text-[var(--gm-text-tertiary)] hover:text-emerald-400"),title:"Good answer",children:e.jsx(Qe,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>G(t.id,"down"),className:x("p-1 rounded hover:bg-white/10 transition-colors",t.feedback==="down"?"text-red-400":"text-[var(--gm-text-tertiary)] hover:text-red-400"),title:"Bad answer",children:e.jsx(Le,{className:"w-3 h-3"})})]})]})]}),e.jsx(He,{msg:t})]}),t.sources&&t.sources.length>0&&e.jsxs("div",{className:"max-w-[80%]",children:[e.jsx(Ke,{sources:t.sources}),e.jsx(Ve,{sources:t.sources})]}),t.suggestedFollowups&&t.suggestedFollowups.length>0&&e.jsx("div",{className:"max-w-[80%] flex flex-wrap gap-1.5 mt-2",children:t.suggestedFollowups.map((i,v)=>e.jsx("button",{onClick:()=>E(i),className:"px-2.5 py-1 text-[10px] rounded-full border border-[var(--gm-accent-primary)]/30 bg-[var(--gm-accent-primary)]/5 text-[var(--gm-accent-primary)] hover:bg-[var(--gm-accent-primary)]/15 hover:border-[var(--gm-accent-primary)]/50 transition-colors",children:i},v))})]},t.id)),T&&e.jsxs("div",{className:"max-w-[80%] rounded-xl p-3 text-sm bg-[var(--gm-bg-tertiary)] flex items-center gap-2",children:[e.jsx(F,{className:"h-3.5 w-3.5 animate-spin text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Thinking..."})]}),e.jsx("div",{ref:N})]}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 px-6 pb-2",children:Y.map(t=>e.jsx("button",{onClick:()=>E(t),className:"px-2.5 py-1 text-[10px] rounded-full border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] text-[var(--gm-text-tertiary)] hover:border-[var(--gm-accent-primary)] hover:text-[var(--gm-accent-primary)] transition-colors",children:t},t))}),e.jsxs("div",{className:"px-6 py-3 border-t border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)] shrink-0 space-y-2",children:[r==="rag"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>j(t=>!t),className:x("inline-flex items-center gap-1.5 px-2.5 py-1 text-[10px] font-medium rounded-full border transition-all",h?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-transparent border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:border-[var(--gm-border-focus)]"),title:"Deep reasoning uses a structured 4-step analysis framework for more thorough answers",children:[e.jsx(qe,{className:"w-3 h-3"}),"Deep Reasoning ",h?"ON":"OFF"]}),h&&e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Structured analysis with confidence indicators"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{ref:S,value:u,onChange:ae,onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),E())},placeholder:r==="sot"?"Ask about facts, decisions, risks...":h?"Ask a complex question for deep analysis...":"Ask a question...",rows:1,className:x(_e,"flex-1 min-h-[44px] max-h-[120px] resize-none py-2.5")}),e.jsx("button",{onClick:()=>E(),disabled:!u.trim()||T,className:x(O,"h-11 px-4 text-sm self-end"),children:T?e.jsx(F,{className:"h-4 w-4 animate-spin"}):e.jsx(Oe,{className:"h-4 w-4"})})]})]})]})]})}function X({modes:r,current:s,onChange:a}){return e.jsx("div",{className:"flex gap-1 bg-[var(--gm-bg-tertiary)] rounded-xl p-1 max-w-md mb-3",children:r.map(n=>{const m=n.icon;return e.jsxs("button",{onClick:()=>a(n.key),className:x("flex-1 flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors",s===n.key?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-sm":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"),children:[e.jsx(m,{className:"w-3.5 h-3.5"})," ",n.label]},n.key)})})}export{ct as default};
//# sourceMappingURL=ChatPage-DfuzWGQG.js.map
