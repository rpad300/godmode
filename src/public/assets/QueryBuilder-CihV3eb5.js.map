{"version":3,"file":"QueryBuilder-CihV3eb5.js","sources":["../../frontend/components/graph/QueryBuilder.ts"],"sourcesContent":["/**\r\n * QueryBuilder - Visual and Cypher query builder\r\n * \r\n * Features:\r\n * - Raw Cypher editor with syntax highlighting\r\n * - Query templates from ontology\r\n * - Query history with favorites\r\n * - Results as table and graph\r\n * - AI-powered query generation\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { graphService, CypherQueryResult, GraphQueryHistory } from '../../services/graph';\r\nimport { toast } from '../../services/toast';\r\n\r\nexport interface QueryBuilderProps {\r\n  onExecute?: (cypher: string, results: CypherQueryResult) => void;\r\n  initialQuery?: string;\r\n}\r\n\r\ninterface BuilderState {\r\n  query: string;\r\n  results: CypherQueryResult | null;\r\n  history: GraphQueryHistory[];\r\n  templates: Array<{ id: string; name: string; description: string; cypher: string; category: string }>;\r\n  isLoading: boolean;\r\n  activeTab: 'editor' | 'templates' | 'history';\r\n  resultsView: 'table' | 'json';\r\n}\r\n\r\n/**\r\n * Create the query builder component\r\n */\r\nexport function createQueryBuilder(props: QueryBuilderProps = {}): HTMLElement {\r\n  const state: BuilderState = {\r\n    query: props.initialQuery || '// Enter your Cypher query here\\nMATCH (n) RETURN n LIMIT 10',\r\n    results: null,\r\n    history: [],\r\n    templates: [],\r\n    isLoading: false,\r\n    activeTab: 'editor',\r\n    resultsView: 'table',\r\n  };\r\n\r\n  const container = createElement('div', { className: 'query-builder' });\r\n  \r\n  container.innerHTML = `\r\n    <div class=\"query-builder-layout\">\r\n      <div class=\"query-sidebar\">\r\n        <div class=\"sidebar-tabs\">\r\n          <button class=\"sidebar-tab active\" data-tab=\"templates\">Templates</button>\r\n          <button class=\"sidebar-tab\" data-tab=\"history\">History</button>\r\n        </div>\r\n        <div class=\"sidebar-content\" id=\"query-sidebar-content\">\r\n          <div class=\"loading-state\">\r\n            <div class=\"loading-spinner\"></div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"query-main\">\r\n        <div class=\"query-editor-area\">\r\n          <div class=\"editor-toolbar\">\r\n            <div class=\"editor-toolbar-left\">\r\n              <span class=\"editor-label\">Cypher Query</span>\r\n            </div>\r\n            <div class=\"editor-toolbar-right\">\r\n              <button class=\"editor-btn\" id=\"btn-format\" title=\"Format Query\">\r\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <line x1=\"21\" y1=\"10\" x2=\"3\" y2=\"10\"/>\r\n                  <line x1=\"21\" y1=\"6\" x2=\"3\" y2=\"6\"/>\r\n                  <line x1=\"21\" y1=\"14\" x2=\"3\" y2=\"14\"/>\r\n                  <line x1=\"21\" y1=\"18\" x2=\"3\" y2=\"18\"/>\r\n                </svg>\r\n              </button>\r\n              <button class=\"editor-btn\" id=\"btn-clear\" title=\"Clear\">\r\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <polyline points=\"3 6 5 6 21 6\"/>\r\n                  <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/>\r\n                </svg>\r\n              </button>\r\n              <button class=\"editor-btn\" id=\"btn-ai-generate\" title=\"Generate with AI\">\r\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M12 2a10 10 0 0 1 10 10c0 5.5-4.5 10-10 10S2 17.5 2 12 6.5 2 12 2\"/>\r\n                  <circle cx=\"12\" cy=\"12\" r=\"3\"/>\r\n                </svg>\r\n                AI Generate\r\n              </button>\r\n            </div>\r\n          </div>\r\n          <div class=\"editor-container\">\r\n            <textarea\r\n              id=\"cypher-editor\"\r\n              class=\"cypher-editor\"\r\n              spellcheck=\"false\"\r\n              placeholder=\"MATCH (n) RETURN n LIMIT 10\"\r\n            >${escapeHtml(state.query)}</textarea>\r\n            <div class=\"editor-line-numbers\" id=\"line-numbers\"></div>\r\n          </div>\r\n          <div class=\"editor-actions\">\r\n            <button class=\"btn btn-primary\" id=\"btn-execute\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <polygon points=\"5 3 19 12 5 21 5 3\"/>\r\n              </svg>\r\n              Execute\r\n            </button>\r\n            <button class=\"btn btn-secondary\" id=\"btn-explain\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\"/>\r\n                <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\r\n              </svg>\r\n              Explain\r\n            </button>\r\n            <button class=\"btn btn-secondary\" id=\"btn-save\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z\"/>\r\n                <polyline points=\"17 21 17 13 7 13 7 21\"/>\r\n                <polyline points=\"7 3 7 8 15 8\"/>\r\n              </svg>\r\n              Save\r\n            </button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"query-results-area\">\r\n          <div class=\"results-header\">\r\n            <div class=\"results-tabs\">\r\n              <button class=\"results-tab active\" data-view=\"table\">Table</button>\r\n              <button class=\"results-tab\" data-view=\"json\">JSON</button>\r\n            </div>\r\n            <div class=\"results-info\" id=\"results-info\">\r\n              <!-- Results count and timing -->\r\n            </div>\r\n          </div>\r\n          <div class=\"results-content\" id=\"results-content\">\r\n            <div class=\"results-empty\">\r\n              <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\" opacity=\"0.3\">\r\n                <polyline points=\"16 18 22 12 16 6\"/>\r\n                <polyline points=\"8 6 2 12 8 18\"/>\r\n              </svg>\r\n              <p>Execute a query to see results</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- AI Generate Modal -->\r\n    <div class=\"modal-overlay hidden\" id=\"ai-modal\">\r\n      <div class=\"modal ai-generate-modal\">\r\n        <div class=\"modal-header\">\r\n          <h3>Generate Query with AI</h3>\r\n          <button class=\"modal-close\" id=\"ai-modal-close\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\r\n              <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <div class=\"modal-body\">\r\n          <label class=\"form-label\">Describe what you want to query in natural language:</label>\r\n          <textarea\r\n            id=\"ai-prompt\"\r\n            class=\"form-textarea\"\r\n            placeholder=\"e.g., Find all people who work in the Engineering department and are connected to at least 3 projects\"\r\n            rows=\"3\"\r\n          ></textarea>\r\n          <div class=\"ai-examples\">\r\n            <p class=\"examples-label\">Examples:</p>\r\n            <button class=\"example-chip\" data-prompt=\"Show all people and their roles\">People and roles</button>\r\n            <button class=\"example-chip\" data-prompt=\"Find the top 10 most connected nodes\">Most connected</button>\r\n            <button class=\"example-chip\" data-prompt=\"Show decisions made in the last month\">Recent decisions</button>\r\n            <button class=\"example-chip\" data-prompt=\"Find all risks with high severity\">High-risk items</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button class=\"btn btn-secondary\" id=\"ai-modal-cancel\">Cancel</button>\r\n          <button class=\"btn btn-primary\" id=\"ai-modal-generate\">Generate Query</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Initialize\r\n  initQueryBuilder(container, state, props);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Initialize the query builder\r\n */\r\nasync function initQueryBuilder(\r\n  container: HTMLElement,\r\n  state: BuilderState,\r\n  props: QueryBuilderProps\r\n): Promise<void> {\r\n  const editor = container.querySelector('#cypher-editor') as HTMLTextAreaElement;\r\n  const sidebarContent = container.querySelector('#query-sidebar-content') as HTMLElement;\r\n\r\n  // Update line numbers\r\n  updateLineNumbers(container, editor);\r\n  on(editor, 'input', () => {\r\n    state.query = editor.value;\r\n    updateLineNumbers(container, editor);\r\n  });\r\n  on(editor, 'scroll', () => {\r\n    const lineNumbers = container.querySelector('#line-numbers') as HTMLElement;\r\n    if (lineNumbers) {\r\n      lineNumbers.scrollTop = editor.scrollTop;\r\n    }\r\n  });\r\n\r\n  // Bind sidebar tabs\r\n  const sidebarTabs = container.querySelectorAll('.sidebar-tab');\r\n  sidebarTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      const tabId = tab.getAttribute('data-tab') as 'templates' | 'history';\r\n      sidebarTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      state.activeTab = tabId === 'templates' ? 'templates' : 'history';\r\n      renderSidebar(sidebarContent, state, editor);\r\n    });\r\n  });\r\n\r\n  // Bind results tabs\r\n  const resultsTabs = container.querySelectorAll('.results-tab');\r\n  resultsTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      const view = tab.getAttribute('data-view') as 'table' | 'json';\r\n      resultsTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      state.resultsView = view;\r\n      if (state.results) {\r\n        renderResults(container, state);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bind editor toolbar\r\n  const btnFormat = container.querySelector('#btn-format');\r\n  if (btnFormat) {\r\n    on(btnFormat as HTMLElement, 'click', () => {\r\n      editor.value = formatCypher(editor.value);\r\n      state.query = editor.value;\r\n      updateLineNumbers(container, editor);\r\n    });\r\n  }\r\n\r\n  const btnClear = container.querySelector('#btn-clear');\r\n  if (btnClear) {\r\n    on(btnClear as HTMLElement, 'click', () => {\r\n      editor.value = '';\r\n      state.query = '';\r\n      updateLineNumbers(container, editor);\r\n    });\r\n  }\r\n\r\n  const btnAiGenerate = container.querySelector('#btn-ai-generate');\r\n  if (btnAiGenerate) {\r\n    on(btnAiGenerate as HTMLElement, 'click', () => showAIModal(container));\r\n  }\r\n\r\n  // Bind action buttons\r\n  const btnExecute = container.querySelector('#btn-execute');\r\n  if (btnExecute) {\r\n    on(btnExecute as HTMLElement, 'click', () => executeQuery(container, state, props));\r\n  }\r\n\r\n  const btnExplain = container.querySelector('#btn-explain');\r\n  if (btnExplain) {\r\n    on(btnExplain as HTMLElement, 'click', () => explainQuery(container, state));\r\n  }\r\n\r\n  const btnSave = container.querySelector('#btn-save');\r\n  if (btnSave) {\r\n    on(btnSave as HTMLElement, 'click', () => saveQuery(container, state));\r\n  }\r\n\r\n  // Bind AI modal\r\n  const aiModal = container.querySelector('#ai-modal') as HTMLElement;\r\n  const aiModalClose = container.querySelector('#ai-modal-close');\r\n  const aiModalCancel = container.querySelector('#ai-modal-cancel');\r\n  const aiModalGenerate = container.querySelector('#ai-modal-generate');\r\n  const aiPrompt = container.querySelector('#ai-prompt') as HTMLTextAreaElement;\r\n\r\n  if (aiModalClose) {\r\n    on(aiModalClose as HTMLElement, 'click', () => aiModal?.classList.add('hidden'));\r\n  }\r\n  if (aiModalCancel) {\r\n    on(aiModalCancel as HTMLElement, 'click', () => aiModal?.classList.add('hidden'));\r\n  }\r\n  if (aiModalGenerate) {\r\n    on(aiModalGenerate as HTMLElement, 'click', async () => {\r\n      const prompt = aiPrompt?.value.trim();\r\n      if (prompt) {\r\n        await generateWithAI(container, state, editor, prompt);\r\n        aiModal?.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Bind example chips\r\n  const exampleChips = container.querySelectorAll('.example-chip');\r\n  exampleChips.forEach(chip => {\r\n    on(chip as HTMLElement, 'click', () => {\r\n      const prompt = chip.getAttribute('data-prompt');\r\n      if (prompt && aiPrompt) {\r\n        aiPrompt.value = prompt;\r\n      }\r\n    });\r\n  });\r\n\r\n  // Load templates and history\r\n  await loadSidebarData(state);\r\n  renderSidebar(sidebarContent, state, editor);\r\n\r\n  // Keyboard shortcuts\r\n  on(editor, 'keydown', (e: Event) => {\r\n    const event = e as KeyboardEvent;\r\n    if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {\r\n      event.preventDefault();\r\n      executeQuery(container, state, props);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Load sidebar data\r\n */\r\nasync function loadSidebarData(state: BuilderState): Promise<void> {\r\n  try {\r\n    const [templates, history] = await Promise.all([\r\n      graphService.getQueryTemplates(),\r\n      graphService.getQueryHistory({ limit: 20 }),\r\n    ]);\r\n    state.templates = templates;\r\n    state.history = history;\r\n  } catch (error) {\r\n    console.error('[QueryBuilder] Failed to load sidebar data:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Render sidebar\r\n */\r\nfunction renderSidebar(\r\n  container: HTMLElement,\r\n  state: BuilderState,\r\n  editor: HTMLTextAreaElement\r\n): void {\r\n  if (state.activeTab === 'templates') {\r\n    renderTemplates(container, state, editor);\r\n  } else {\r\n    renderHistory(container, state, editor);\r\n  }\r\n}\r\n\r\n/**\r\n * Render templates\r\n */\r\nfunction renderTemplates(\r\n  container: HTMLElement,\r\n  state: BuilderState,\r\n  editor: HTMLTextAreaElement\r\n): void {\r\n  if (state.templates.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state-small\">\r\n        <p>No query templates available</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  // Group by category\r\n  const byCategory: Record<string, typeof state.templates> = {};\r\n  state.templates.forEach(t => {\r\n    const cat = t.category || 'General';\r\n    if (!byCategory[cat]) byCategory[cat] = [];\r\n    byCategory[cat].push(t);\r\n  });\r\n\r\n  container.innerHTML = Object.entries(byCategory).map(([category, templates]) => `\r\n    <div class=\"template-category\">\r\n      <h4 class=\"category-title\">${escapeHtml(category)}</h4>\r\n      ${templates.map(t => `\r\n        <div class=\"template-item\" data-cypher=\"${escapeHtml(t.cypher)}\" title=\"${escapeHtml(t.description)}\">\r\n          <div class=\"template-name\">${escapeHtml(t.name)}</div>\r\n          <div class=\"template-description\">${escapeHtml(t.description)}</div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.template-item').forEach(item => {\r\n    on(item as HTMLElement, 'click', () => {\r\n      const cypher = item.getAttribute('data-cypher');\r\n      if (cypher) {\r\n        editor.value = cypher;\r\n        state.query = cypher;\r\n        updateLineNumbers(container.closest('.query-builder') as HTMLElement, editor);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render history\r\n */\r\nfunction renderHistory(\r\n  container: HTMLElement,\r\n  state: BuilderState,\r\n  editor: HTMLTextAreaElement\r\n): void {\r\n  if (state.history.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state-small\">\r\n        <p>No query history yet</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"history-list\">\r\n      ${state.history.map(h => `\r\n        <div class=\"history-item\" data-query=\"${escapeHtml(h.query_text)}\">\r\n          <div class=\"history-header\">\r\n            <span class=\"history-type\">${h.query_type}</span>\r\n            ${h.is_favorite ? '<span class=\"history-favorite\">â˜…</span>' : ''}\r\n            <span class=\"history-time\">${formatTime(h.created_at)}</span>\r\n          </div>\r\n          <div class=\"history-query\">${escapeHtml(h.query_text.substring(0, 100))}${h.query_text.length > 100 ? '...' : ''}</div>\r\n          ${h.result_count !== undefined ? `<div class=\"history-results\">${h.result_count} results</div>` : ''}\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.history-item').forEach(item => {\r\n    on(item as HTMLElement, 'click', () => {\r\n      const query = item.getAttribute('data-query');\r\n      if (query) {\r\n        editor.value = query;\r\n        state.query = query;\r\n        updateLineNumbers(container.closest('.query-builder') as HTMLElement, editor);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Execute query\r\n */\r\nasync function executeQuery(\r\n  container: HTMLElement,\r\n  state: BuilderState,\r\n  props: QueryBuilderProps\r\n): Promise<void> {\r\n  const query = state.query.trim();\r\n  if (!query || state.isLoading) return;\r\n\r\n  state.isLoading = true;\r\n  const btnExecute = container.querySelector('#btn-execute') as HTMLElement;\r\n  const resultsInfo = container.querySelector('#results-info') as HTMLElement;\r\n  \r\n  if (btnExecute) btnExecute.classList.add('loading');\r\n  if (resultsInfo) resultsInfo.innerHTML = '<span class=\"loading-text\">Executing...</span>';\r\n\r\n  const startTime = Date.now();\r\n\r\n  try {\r\n    const results = await graphService.executeCypher(query);\r\n    const elapsed = Date.now() - startTime;\r\n\r\n    state.results = results;\r\n    state.results.executionTimeMs = elapsed;\r\n\r\n    // Update results info\r\n    if (resultsInfo) {\r\n      if (results.ok) {\r\n        resultsInfo.innerHTML = `\r\n          <span class=\"results-count\">${results.results.length} row${results.results.length !== 1 ? 's' : ''}</span>\r\n          <span class=\"results-time\">${elapsed}ms</span>\r\n        `;\r\n      } else {\r\n        resultsInfo.innerHTML = `<span class=\"results-error\">Error</span>`;\r\n      }\r\n    }\r\n\r\n    // Render results\r\n    renderResults(container, state);\r\n\r\n    // Save to history\r\n    await graphService.saveQueryHistory({\r\n      query_type: 'cypher',\r\n      query_text: query,\r\n      result_count: results.results.length,\r\n      execution_time_ms: elapsed,\r\n      is_favorite: false,\r\n    });\r\n\r\n    // Callback\r\n    props.onExecute?.(query, results);\r\n\r\n  } catch (error) {\r\n    state.results = {\r\n      ok: false,\r\n      results: [],\r\n      error: error instanceof Error ? error.message : 'Query failed',\r\n    };\r\n    renderResults(container, state);\r\n    toast.error('Query failed');\r\n  }\r\n\r\n  state.isLoading = false;\r\n  if (btnExecute) btnExecute.classList.remove('loading');\r\n}\r\n\r\n/**\r\n * Render results\r\n */\r\nfunction renderResults(container: HTMLElement, state: BuilderState): void {\r\n  const resultsContent = container.querySelector('#results-content') as HTMLElement;\r\n  if (!resultsContent || !state.results) return;\r\n\r\n  if (!state.results.ok) {\r\n    resultsContent.innerHTML = `\r\n      <div class=\"results-error-state\">\r\n        <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n          <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"/>\r\n          <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"/>\r\n        </svg>\r\n        <p>${escapeHtml(state.results.error || 'Query failed')}</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  if (state.results.results.length === 0) {\r\n    resultsContent.innerHTML = `\r\n      <div class=\"results-empty\">\r\n        <p>Query returned no results</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  if (state.resultsView === 'table') {\r\n    renderTableView(resultsContent, state.results);\r\n  } else {\r\n    renderJsonView(resultsContent, state.results);\r\n  }\r\n}\r\n\r\n/**\r\n * Render table view\r\n */\r\nfunction renderTableView(container: HTMLElement, results: CypherQueryResult): void {\r\n  const columns = results.columns || Object.keys(results.results[0] || {});\r\n\r\n  container.innerHTML = `\r\n    <div class=\"results-table-wrapper\">\r\n      <table class=\"results-table\">\r\n        <thead>\r\n          <tr>\r\n            <th class=\"row-num\">#</th>\r\n            ${columns.map(col => `<th>${escapeHtml(col)}</th>`).join('')}\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          ${results.results.map((row, i) => `\r\n            <tr>\r\n              <td class=\"row-num\">${i + 1}</td>\r\n              ${columns.map(col => `<td>${formatValue(row[col])}</td>`).join('')}\r\n            </tr>\r\n          `).join('')}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render JSON view\r\n */\r\nfunction renderJsonView(container: HTMLElement, results: CypherQueryResult): void {\r\n  container.innerHTML = `\r\n    <div class=\"results-json-wrapper\">\r\n      <pre class=\"results-json\">${escapeHtml(JSON.stringify(results.results, null, 2))}</pre>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Explain query\r\n */\r\nasync function explainQuery(container: HTMLElement, state: BuilderState): Promise<void> {\r\n  const query = state.query.trim();\r\n  if (!query) return;\r\n\r\n  toast.info('Generating explanation...');\r\n  \r\n  try {\r\n    const response = await graphService.query(`Explain this Cypher query: ${query}`);\r\n    toast.success(response.answer.substring(0, 200));\r\n  } catch {\r\n    toast.error('Failed to explain query');\r\n  }\r\n}\r\n\r\n/**\r\n * Save query\r\n */\r\nasync function saveQuery(container: HTMLElement, state: BuilderState): Promise<void> {\r\n  const query = state.query.trim();\r\n  if (!query) return;\r\n\r\n  const name = prompt('Enter a name for this query:');\r\n  if (!name) return;\r\n\r\n  try {\r\n    await graphService.saveQueryHistory({\r\n      query_type: 'cypher',\r\n      query_text: query,\r\n      query_name: name,\r\n      is_favorite: true,\r\n    });\r\n    toast.success('Query saved');\r\n    \r\n    // Refresh history\r\n    const history = await graphService.getQueryHistory({ limit: 20 });\r\n    state.history = history;\r\n  } catch {\r\n    toast.error('Failed to save query');\r\n  }\r\n}\r\n\r\n/**\r\n * Show AI modal\r\n */\r\nfunction showAIModal(container: HTMLElement): void {\r\n  const modal = container.querySelector('#ai-modal');\r\n  if (modal) {\r\n    modal.classList.remove('hidden');\r\n    const input = modal.querySelector('textarea');\r\n    if (input) input.focus();\r\n  }\r\n}\r\n\r\n/**\r\n * Generate with AI\r\n */\r\nasync function generateWithAI(\r\n  container: HTMLElement,\r\n  state: BuilderState,\r\n  editor: HTMLTextAreaElement,\r\n  prompt: string\r\n): Promise<void> {\r\n  toast.info('Generating query...');\r\n\r\n  try {\r\n    const response = await graphService.query(`Generate a Cypher query for: ${prompt}. Return only the Cypher code, no explanation.`);\r\n    \r\n    // Extract Cypher from response\r\n    let cypher = response.answer;\r\n    \r\n    // Try to extract code block if present\r\n    const codeMatch = cypher.match(/```(?:cypher)?\\s*([\\s\\S]*?)```/);\r\n    if (codeMatch) {\r\n      cypher = codeMatch[1].trim();\r\n    }\r\n\r\n    editor.value = cypher;\r\n    state.query = cypher;\r\n    updateLineNumbers(container, editor);\r\n    toast.success('Query generated');\r\n  } catch {\r\n    toast.error('Failed to generate query');\r\n  }\r\n}\r\n\r\n/**\r\n * Update line numbers\r\n */\r\nfunction updateLineNumbers(container: HTMLElement, editor: HTMLTextAreaElement): void {\r\n  const lineNumbers = container.querySelector('#line-numbers') as HTMLElement;\r\n  if (!lineNumbers) return;\r\n\r\n  const lines = editor.value.split('\\n').length;\r\n  lineNumbers.innerHTML = Array.from({ length: lines }, (_, i) => `<div>${i + 1}</div>`).join('');\r\n}\r\n\r\n/**\r\n * Format Cypher query\r\n */\r\nfunction formatCypher(query: string): string {\r\n  // Basic formatting - uppercase keywords\r\n  const keywords = ['MATCH', 'WHERE', 'RETURN', 'WITH', 'ORDER BY', 'LIMIT', 'SKIP', 'CREATE', 'DELETE', 'SET', 'REMOVE', 'MERGE', 'CALL', 'YIELD', 'UNWIND', 'UNION', 'OPTIONAL MATCH', 'DETACH DELETE', 'AS', 'AND', 'OR', 'NOT', 'IN', 'CONTAINS', 'STARTS WITH', 'ENDS WITH', 'IS NULL', 'IS NOT NULL', 'DESC', 'ASC'];\r\n  \r\n  let formatted = query;\r\n  keywords.forEach(kw => {\r\n    const regex = new RegExp(`\\\\b${kw}\\\\b`, 'gi');\r\n    formatted = formatted.replace(regex, kw);\r\n  });\r\n\r\n  // Add newlines before main clauses\r\n  const mainClauses = ['MATCH', 'OPTIONAL MATCH', 'WHERE', 'WITH', 'RETURN', 'ORDER BY', 'LIMIT', 'CREATE', 'DELETE', 'SET', 'MERGE', 'CALL', 'UNION'];\r\n  mainClauses.forEach(clause => {\r\n    const regex = new RegExp(`\\\\b(${clause})\\\\b`, 'g');\r\n    formatted = formatted.replace(regex, '\\n$1');\r\n  });\r\n\r\n  return formatted.trim();\r\n}\r\n\r\n/**\r\n * Format value for display\r\n */\r\nfunction formatValue(value: unknown): string {\r\n  if (value === null || value === undefined) {\r\n    return '<span class=\"null-value\">null</span>';\r\n  }\r\n  if (typeof value === 'object') {\r\n    if (Array.isArray(value)) {\r\n      return `<span class=\"array-value\">[${value.length} items]</span>`;\r\n    }\r\n    const obj = value as Record<string, unknown>;\r\n    if (obj.name || obj.label) {\r\n      return escapeHtml(String(obj.name || obj.label));\r\n    }\r\n    return `<span class=\"object-value\">{...}</span>`;\r\n  }\r\n  if (typeof value === 'boolean') {\r\n    return `<span class=\"boolean-value\">${value}</span>`;\r\n  }\r\n  if (typeof value === 'number') {\r\n    return `<span class=\"number-value\">${value}</span>`;\r\n  }\r\n  return escapeHtml(String(value));\r\n}\r\n\r\n/**\r\n * Format time\r\n */\r\nfunction formatTime(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  const now = new Date();\r\n  const diff = now.getTime() - date.getTime();\r\n  \r\n  if (diff < 60000) return 'just now';\r\n  if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;\r\n  if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;\r\n  return date.toLocaleDateString();\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createQueryBuilder;\r\n"],"names":["createQueryBuilder","props","state","container","createElement","escapeHtml","initQueryBuilder","editor","sidebarContent","updateLineNumbers","on","lineNumbers","sidebarTabs","tab","tabId","t","renderSidebar","resultsTabs","view","renderResults","btnFormat","formatCypher","btnClear","btnAiGenerate","showAIModal","btnExecute","executeQuery","btnExplain","explainQuery","btnSave","saveQuery","aiModal","aiModalClose","aiModalCancel","aiModalGenerate","aiPrompt","prompt","generateWithAI","chip","loadSidebarData","e","event","templates","history","graphService","error","renderTemplates","renderHistory","byCategory","cat","category","item","cypher","h","formatTime","query","resultsInfo","startTime","results","elapsed","toast","resultsContent","renderTableView","renderJsonView","columns","col","row","i","formatValue","response","name","modal","input","codeMatch","lines","_","keywords","formatted","kw","regex","clause","value","obj","dateStr","date","diff","text","div"],"mappings":"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"}