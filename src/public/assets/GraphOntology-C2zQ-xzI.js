import{c as be,r as v,ef as Ct,eg as Et,eh as Ot,ei as _t,ej as Rt,ek as Tt,el as Pt,em as At,en as Lt,eo as It,ep as Mt,eq as Dt,er as Ft,es as Bt,et as $t,eu as Gt,ev as Wt,ew as Jt,ex as zt,ey as Qt,ez as Vt,eA as Ht,eB as Ut,eC as qt,eD as Kt,eE as Yt,eF as Xt,eG as Zt,eH as es,eI as ts,eJ as ss,eK as as,eL as rs,eM as ns,eN as is,eO as cs,eP as os,eQ as ls,bL as gt,eR as ds,Z as oe,c_ as ms,P as xe,j as e,N as x,J as ge,O as m,a as N,a5 as Te,ai as pe,T as nt,b8 as it,ak as ct,C as xs,eS as gs,K as ps}from"./main-BKbBKYvC.js";import{C as us}from"./cpu-Cc2IQ2ui.js";import{S as ue}from"./sparkles-BJxATUBg.js";import{C as Pe}from"./chart-column-WCU8uNwR.js";import{B as le}from"./brain-t58eVqGu.js";import{L as he}from"./layers-B7MeRGrx.js";import{H as te}from"./history-fSYOK_lq.js";import{P as Le}from"./plus-BG5YpVIb.js";import{E as Ae}from"./eye-DDSd_vfm.js";import{W as hs}from"./wand-sparkles-BjYP3KTS.js";import{C as ot}from"./circle-check-big-BfAZDzfZ.js";import{C as Ie}from"./circle-x-DCC498lp.js";import{M as lt}from"./merge-CIQSa7s7.js";import{P as dt}from"./play-BOQB2G_-.js";const ys=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],bs=be("flask-conical",ys);const fs=[["path",{d:"M15 6a9 9 0 0 0-9 9V3",key:"1cii5b"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}]],ye=be("git-branch",fs);const Ns=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],js=be("power-off",Ns);const vs=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],ws=be("power",vs),Ss={Project:0,Company:0,Person:1,Team:1,Sprint:1,Document:1,Email:1,CalendarEvent:1,Contact:1,Risk:2,Action:2,Fact:2,Decision:2,Question:2,UserStory:2,Task:2},mt={Project:{w:280,h:120},Company:{w:260,h:100},Document:{w:220,h:90},Person:{w:200,h:80},Contact:{w:200,h:85},Team:{w:220,h:85},Sprint:{w:200,h:65},Email:{w:220,h:80},CalendarEvent:{w:210,h:80},Fact:{w:200,h:80},Decision:{w:200,h:80},Risk:{w:210,h:95},Action:{w:220,h:90},Question:{w:200,h:75},UserStory:{w:210,h:80},Task:{w:220,h:90},default:{w:200,h:80}},xt={BELONGS_TO_PROJECT:{stroke:"#cbd5e1",width:1,opacity:0,dash:"5 5"},BELONGS_TO_COMPANY:{stroke:"#0d9488",width:1.5,opacity:.6,dash:"4 4"},EXTRACTED_FROM:{stroke:"#f59e0b",width:2,opacity:.8},IMPLEMENTS:{stroke:"#3b82f6",width:2,opacity:.9},DEPENDS_ON:{stroke:"#3b82f6",width:2,opacity:.9},ASSIGNED_TO:{stroke:"#10b981",width:1.5,opacity:.7},OWNED_BY:{stroke:"#10b981",width:1.5,opacity:.7},AUTHORED_BY:{stroke:"#10b981",width:1.5,opacity:.7},MEMBER_OF_TEAM:{stroke:"#a855f7",width:1.5,opacity:.7},WORKS_WITH:{stroke:"#4ade80",width:1,opacity:.4},IS_CONTACT_OF:{stroke:"#22d3ee",width:1.5,opacity:.6,dash:"4 4"},WORKS_AT:{stroke:"#0d9488",width:1.5,opacity:.7},SIMILAR_TO:{stroke:"#facc15",width:1,opacity:.5,dash:"4 4"},REPORTS_TO:{stroke:"#22c55e",width:1.5,opacity:.7},MANAGES:{stroke:"#22c55e",width:1.5,opacity:.7},LEADS_TEAM:{stroke:"#a855f7",width:2,opacity:.8},PARENT_OF:{stroke:"#3b82f6",width:1.5,opacity:.7},PLANNED_IN:{stroke:"#6366f1",width:1.5,opacity:.7},SENT_BY:{stroke:"#94a3b8",width:1.5,opacity:.7},SENT_TO:{stroke:"#94a3b8",width:1.5,opacity:.7},MENTIONS:{stroke:"#f59e0b",width:1.5,opacity:.8},INVOLVES:{stroke:"#06b6d4",width:1.5,opacity:.8},LINKED_TO:{stroke:"#a855f7",width:1.5,opacity:.7},DERIVED_FROM:{stroke:"#94a3b8",width:1.5,opacity:.7},REPLY_TO:{stroke:"#94a3b8",width:1,opacity:.5,dash:"3 3"},HAS_ATTACHMENT:{stroke:"#f59e0b",width:1,opacity:.6,dash:"3 3"},default:{stroke:"#64748b",width:1,opacity:.5}},ks={Project:"#6366f1",Company:"#0d9488",Person:"#22c55e",Contact:"#14b8a6",Team:"#a855f7",Sprint:"#6366f1",Document:"#f59e0b",Email:"#64748b",CalendarEvent:"#06b6d4",Risk:"#ef4444",Action:"#22c55e",Task:"#10b981",Fact:"#0ea5e9",Decision:"#f97316",Question:"#8b5cf6",UserStory:"#ec4899",Meeting:"#06b6d4",Technology:"#3b82f6",Answer:"#10b981",Briefing:"#6366f1",Client:"#1abc9c",Conversation:"#9c27b0",Organization:"#8e44ad",Regulation:"#e74c3c"},Cs=new Set(["WORKS_WITH","BELONGS_TO_PROJECT"]);function Hs(r,w){const h=["person_","contact_","document_","fact_","decision_","risk_","question_","team_","action_","sprint_","email_","calendarevent_","userstory_","task_","company_"],_=new Set(r.map(a=>a.id)),n=new Map,l=new Set;for(const a of r){const g=a.id;for(const C of h)if(g.startsWith(C)){const E=g.slice(C.length);_.has(E)&&(n.set(g,E),l.add(g));break}}const c=r.filter(a=>!l.has(a.id)),u=new Map,S=new Set,k=new Map,p=a=>a?.trim().toLowerCase()||"";c.forEach(a=>{if(a.label==="Contact"){const g=a.id;a.data.linked_person_id&&(S.add(a.data.linked_person_id),u.set(a.data.linked_person_id,g)),a.data.name&&k.set(p(a.data.name),g),a.data.label&&k.set(p(a.data.label),g),Array.isArray(a.data.aliases)&&a.data.aliases.forEach(C=>{C&&k.set(p(C),g)})}});const f=new Map,j=[],L=new Set;c.forEach(a=>{if(a.label==="Person"){let $=!1,W="";if(S.has(a.id))$=!0,W=u.get(a.id);else{const J=p(a.data.label||a.data.name);k.has(J)?($=!0,W=k.get(J),u.set(a.id,W)):J&&f.has(J)&&($=!0,W=f.get(J),u.set(a.id,W))}if($){L.add(a.id);return}const K=p(a.data.label||a.data.name);K&&f.set(K,a.id)}const g=a.label||"default",C=Ss[g]??2,E=mt[g]??mt.default;j.push({...a,width:E.w,height:E.h,data:{...a.data,tier:C,label:a.data.label||a.label,_display:{width:E.w,height:E.h,colorToken:Es(g)}}})});const y=new Set(j.map(a=>a.id)),Q=a=>(n.has(a)&&(a=n.get(a)),u.has(a)&&(a=u.get(a)),a),B=[];w.forEach(a=>{if(Cs.has(a.label||""))return;let g=Q(a.source),C=Q(a.target);if(g===C||!y.has(g)||!y.has(C))return;const E=xt[a.label||""]||xt.default;B.push({...a,id:a.id||`${g}-${C}-${a.label}`,source:g,target:C,type:"default",style:{stroke:E.stroke,strokeWidth:E.width,opacity:E.opacity,strokeDasharray:E.dash},animated:a.label==="SIMILAR_TO"||a.label==="DEPENDS_ON"||a.label==="INVOLVES",data:{...a.data,originalLabel:a.label},label:void 0})});const V=new Map,G=new Map;for(const a of B){const g=[a.source,a.target].sort().join("__");V.set(g,(V.get(g)||0)+1)}for(const a of B){const g=[a.source,a.target].sort().join("__"),C=V.get(g)||1;if(C>1){const E=G.get(g)||0;G.set(g,E+1);const $=(E-(C-1)/2)*.3;a.data={...a.data,curvature:$}}}return{nodes:j,edges:B}}function Es(r){switch(r){case"Project":return"blue";case"Company":return"teal";case"Person":return"green";case"Contact":return"teal";case"Team":return"purple";case"Sprint":return"indigo";case"Document":return"amber";case"Risk":return"red";case"Action":return"emerald";case"Fact":return"sky";case"Decision":return"orange";case"Question":return"violet";case"UserStory":return"pink";case"Email":return"slate";case"CalendarEvent":return"cyan";case"Task":return"emerald";default:return"slate"}}function D(r,w){return ks[r]||w||"#64748b"}function Os({status:r}){const w=!!r.graphConnected,h=!!r.isListening,_=!!r.syncInProgress,n=w||h,l=r.ontologySource?String(r.ontologySource):"",c=_?"Syncing":n?l==="supabase"?"Synced":"Connected":"Disconnected";return e.jsxs("div",{className:N("flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-medium",n?"bg-gm-status-success-bg text-gm-status-success":_?"bg-gm-status-warning-bg text-gm-status-warning":"bg-gm-surface-secondary text-gm-text-tertiary"),children:[e.jsx("div",{className:N("w-1.5 h-1.5 rounded-full",n?"bg-gm-status-success":_?"bg-gm-status-warning animate-pulse":"bg-gm-text-tertiary")}),c]})}function _s({schema:r}){const w=r.version||r.schema_version||"",h=Object.keys(r.entityTypes||r.entities||{}).length,_=Object.keys(r.relationTypes||r.relations||{}).length;return e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-gm-text-tertiary",children:[w&&e.jsxs("span",{children:["v",String(w)]}),e.jsxs("span",{children:[h,"E"]}),e.jsxs("span",{children:[_,"R"]})]})}function Rs({entity:r,onClose:w}){const h=String(r.name||r.type||r.label||""),_=String(r.description||""),n=D(h,r.color?String(r.color):void 0),l=r.properties||[],c=!!(r.sharedEntity||r.shared),u=String(r.embeddingTemplate||""),S=Number(r.count||r.instances||0),k=Array.isArray(l)?l:Object.entries(l).map(([p,f])=>({name:p,...typeof f=="object"&&f!==null?f:{type:String(f)}}));return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:w,children:e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-2xl shadow-xl w-full max-w-lg max-h-[80vh] overflow-y-auto",onClick:p=>p.stopPropagation(),children:[e.jsx("div",{className:"p-5 border-b border-gm-border-primary",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl flex items-center justify-center text-white font-bold text-sm",style:{backgroundColor:n},children:h.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-bold text-gm-text-primary",children:h}),c&&e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-blue-600/10 text-gm-interactive-primary font-medium",children:"Shared"}),S>0&&e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary",children:[S," instances"]})]}),_&&e.jsx("p",{className:"text-[11px] text-gm-text-tertiary mt-0.5",children:_})]}),e.jsx("button",{onClick:w,className:"p-1.5 rounded-lg hover:bg-gm-surface-hover transition-colors",children:e.jsx(Ie,{className:"w-4 h-4 text-gm-text-tertiary"})})]})}),k.length>0&&e.jsxs("div",{className:"p-5 border-b border-gm-border-primary",children:[e.jsxs("h4",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider mb-3",children:["Properties (",k.length,")"]}),e.jsx("div",{className:"space-y-1.5",children:k.map((p,f)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"font-mono text-gm-text-primary w-32 shrink-0",children:String(p.name||p.key||"")}),e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary",children:String(p.type||"string")}),p.required&&e.jsx("span",{className:"text-[9px] text-gm-status-danger",children:"required"}),p.searchable&&e.jsx("span",{className:"text-[9px] text-gm-interactive-primary",children:"searchable"}),p.description&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary ml-auto truncate max-w-[150px]",children:String(p.description)})]},f))})]}),u&&e.jsxs("div",{className:"p-5",children:[e.jsx("h4",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider mb-2",children:"Embedding Template"}),e.jsx("pre",{className:"text-[10px] text-gm-text-primary bg-gm-surface-secondary rounded-lg p-3 overflow-x-auto whitespace-pre-wrap",children:u})]})]})})}function Ts({entities:r,relations:w}){const h=v.useMemo(()=>{const n={},l=r.length;if(l===0)return{nodes:n,width:600,height:400};const c=Math.ceil(Math.sqrt(l)),u=180,S=120;r.forEach((f,j)=>{const L=String(f.name||f.type||f.label||""),y=Math.floor(j/c),Q=j%c;n[L]={x:60+Q*u,y:50+y*S,color:D(L,f.color?String(f.color):void 0)}});const k=Math.min(l,c),p=Math.ceil(l/c);return{nodes:n,width:Math.max(600,60+k*u+60),height:Math.max(400,50+p*S+60)}},[r]),_=v.useMemo(()=>w.map(n=>{const l=String(n.from||n.source||n.from_type||""),c=String(n.to||n.target||n.to_type||""),u=String(n.name||n.type||n.label||"");return!h.nodes[l]||!h.nodes[c]||l==="*"||c==="*"?null:{from:l,to:c,name:u}}).filter(Boolean),[w,h]);return r.length===0?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx(gt,{className:"w-10 h-10 mx-auto mb-3 text-gray-600"}),e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No entities to visualize"})]})}):e.jsx("div",{className:"w-full overflow-auto bg-gm-surface-secondary rounded-xl border border-gm-border-primary",children:e.jsxs("svg",{viewBox:`0 0 ${h.width} ${h.height}`,className:"w-full",style:{minHeight:400},children:[e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"6",refX:"8",refY:"3",orient:"auto",children:e.jsx("polygon",{points:"0 0, 8 3, 0 6",fill:"#94a3b8"})})}),_.map((n,l)=>{const c=h.nodes[n.from],u=h.nodes[n.to];if(!c||!u)return null;const S=u.x-c.x,k=u.y-c.y,p=c.x+S/2,f=c.y+k/2,j=n.from===n.to?40:0;return e.jsxs("g",{children:[n.from===n.to?e.jsx("path",{d:`M ${c.x+30} ${c.y-15} C ${c.x+80} ${c.y-60}, ${c.x-20} ${c.y-60}, ${c.x-30} ${c.y-15}`,fill:"none",stroke:"#94a3b8",strokeWidth:"1.2",markerEnd:"url(#arrowhead)",strokeDasharray:"4 2"}):e.jsx("line",{x1:c.x,y1:c.y,x2:u.x,y2:u.y,stroke:"#94a3b8",strokeWidth:"1.2",markerEnd:"url(#arrowhead)",strokeDasharray:"4 2"}),e.jsx("rect",{x:p-30+j,y:f-8-(j?40:0),width:"60",height:"14",rx:"4",fill:"var(--gm-surface-primary)",fillOpacity:"0.85"}),e.jsx("text",{x:p+j,y:f-(j?40:0),textAnchor:"middle",fontSize:"7",fill:"#94a3b8",fontWeight:"600",children:n.name.length>12?n.name.slice(0,12)+"…":n.name})]},l)}),Object.entries(h.nodes).map(([n,l])=>e.jsxs("g",{children:[e.jsx("rect",{x:l.x-45,y:l.y-18,width:"90",height:"36",rx:"10",fill:l.color+"18",stroke:l.color+"40",strokeWidth:"1.5"}),e.jsx("circle",{cx:l.x-30,cy:l.y,r:"5",fill:l.color}),e.jsx("text",{x:l.x+2,y:l.y+4,textAnchor:"middle",fontSize:"9",fill:"currentColor",fontWeight:"600",children:n.length>10?n.slice(0,10)+"…":n})]},n))]})})}function Ps({entityNames:r,onSave:w,onCancel:h,isPending:_}){const[n,l]=v.useState(""),[c,u]=v.useState(""),[S,k]=v.useState(""),[p,f]=v.useState(""),j=S.toUpperCase().replace(/\s+/g,"_"),L=()=>{if(!n||!c||!S.trim()){m.error("Source, target, and name are required");return}w({name:j,from:n,to:c,description:p})};return e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border-2 border-gm-interactive-primary/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 py-2",children:[e.jsx("div",{className:N("px-3 py-1.5 rounded-lg text-xs font-bold transition-colors",n?"text-white":"bg-gm-surface-secondary text-gm-text-tertiary"),style:n?{backgroundColor:D(n)}:{},children:n||"?"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-[9px] font-mono text-gm-text-tertiary",children:j||"RELATION"}),e.jsx("span",{className:"text-gm-text-tertiary",children:"→"})]}),e.jsx("div",{className:N("px-3 py-1.5 rounded-lg text-xs font-bold transition-colors",c?"text-white":"bg-gm-surface-secondary text-gm-text-tertiary"),style:c?{backgroundColor:D(c)}:{},children:c||"?"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{value:n,onChange:y=>l(y.target.value),className:"bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-2 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus",children:[e.jsx("option",{value:"",children:"Source entity..."}),r.map(y=>e.jsx("option",{value:y,children:y},y))]}),e.jsxs("select",{value:c,onChange:y=>u(y.target.value),className:"bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-2 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus",children:[e.jsx("option",{value:"",children:"Target entity..."}),r.map(y=>e.jsx("option",{value:y,children:y},y))]})]}),e.jsx("input",{value:S,onChange:y=>k(y.target.value),placeholder:"Relation name (e.g. WORKS_ON, BELONGS_TO)",className:"w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus",onKeyDown:y=>y.key==="Enter"&&L()}),e.jsx("input",{value:p,onChange:y=>f(y.target.value),placeholder:"Description (optional)",className:"w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:h,className:"px-3 py-1.5 rounded-lg text-xs text-gm-text-tertiary hover:bg-gm-surface-secondary transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:L,disabled:_||!n||!c||!S.trim(),className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1 transition-colors",children:[_?e.jsx(x,{className:"w-3 h-3 animate-spin"}):e.jsx(Le,{className:"w-3 h-3"})," Create"]})]})]})}function Us(){const[r,w]=v.useState("entities"),[h,_]=v.useState(""),[n,l]=v.useState(""),[c,u]=v.useState(!1),[S,k]=v.useState(null),p=Ct(),f=Et(),j=Ot(),L=_t(),y=Rt(),Q=Tt(),B=Pt(),V=At(),G=Lt(),a=It(),g=Mt(),C=Dt(),E=Ft(),$=Bt(),W=$t(),K=Gt(),J=Wt(),Me=Jt(),De=zt(),Fe=Qt(),Be=Vt(),$e=Ht(),Ge=Ut(),F=qt(),se=Kt(),fe=Yt(),Ne=Xt(),Y=Zt(),je=es(),We=ts(),X=ss(),ve=as(),ae=rs(),we=ns(),Je=is(),I=cs(),M=os(),Z=ls(),[Se,pt]=v.useState(""),[ze,ut]=v.useState(`{
  "name": "example"
}`),[ke,ht]=v.useState(""),[Ce,yt]=v.useState(""),[Qe,bt]=v.useState(`{
  "name": "example"
}`),R=j.data?.entityTypes||j.data?.entities||j.data?.types||[],z=L.data?.relationTypes||L.data?.relations||L.data?.types||[],Ee=y.data?.suggestions||[],ft=f.data||{},T=Q.data||{},de=B.data?.compliance||B.data||{},re=de.issues||de.violations||[],H=Number(de.score||de.compliance_score||0),Ve=V.data?.changes||V.data||[],He=G.data||{},Ue=a.data?.unused||a.data||{},ne=Ue.entities||[],ie=Ue.relations||[],me=g.data?.status||g.data||{},qe=C.data?.jobs||[],Ke=E.data?.log||[],Nt=p.data||{},Ye=$.data?.rules||[],Xe=$.data?.cyphers||[],ce=W.data?.stats||{},Ze=W.data?.availableRules||[],A=K.data?.summary||{},et=K.data?.coverageByType||{},Oe=J.data?.sharedEntities||[],tt=J.data?.crossGraphRelations||[],_e=Me.data||{},st=_e?.history||[],U=h.toLowerCase(),jt=v.useMemo(()=>h?R.filter(t=>{const s=String(t.name||t.type||t.label||"").toLowerCase(),i=String(t.description||"").toLowerCase();return s.includes(U)||i.includes(U)}):R,[R,U]),vt=v.useMemo(()=>h?z.filter(t=>{const s=String(t.name||t.type||t.label||"").toLowerCase(),i=String(t.from||t.source||"").toLowerCase(),o=String(t.to||t.target||"").toLowerCase();return s.includes(U)||i.includes(U)||o.includes(U)}):z,[z,U]),wt=v.useMemo(()=>R.map(t=>String(t.name||t.type||t.label||"")),[R]),at=Ee.filter(t=>String(t.status)!=="approved"&&String(t.status)!=="rejected"),rt=()=>{n.trim()&&$e.mutate({name:n.trim()},{onSuccess:()=>{m.success("Entity type added"),l("")},onError:()=>m.error("Failed to add entity type")})},St=t=>{Ge.mutate(t,{onSuccess:()=>{m.success("Relation type added"),u(!1)},onError:()=>m.error("Failed to add relation type")})},kt=[{key:"entities",label:"Entities",icon:us,count:R.length},{key:"relations",label:"Relations",icon:ye,count:z.length},{key:"graph",label:"Graph",icon:gt},{key:"suggestions",label:"AI",icon:ue,count:at.length},{key:"stats",label:"Stats",icon:Pe},{key:"tools",label:"Tools",icon:ds},{key:"inference",label:"Rules",icon:oe},{key:"embeddings",label:"Embed",icon:le},{key:"shared",label:"Shared",icon:he},{key:"jobs",label:"Jobs",icon:ms},{key:"versions",label:"Versions",icon:te},{key:"changes",label:"Log",icon:xe},{key:"test",label:"Test",icon:bs}];return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-gm-border-primary bg-gm-surface-secondary shrink-0",children:[e.jsx(he,{className:"w-4 h-4 text-gm-interactive-primary"}),e.jsx("span",{className:"text-xs font-semibold text-gm-text-primary",children:"Ontology"}),e.jsx(_s,{schema:Nt}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[Object.keys(me).length>0&&e.jsx(Os,{status:me}),e.jsx("button",{onClick:()=>se.mutate(void 0,{onSuccess:()=>m.success("Sync triggered")}),disabled:se.isPending,className:"p-1 rounded-md hover:bg-gm-surface-hover transition-colors",title:"Force sync",children:se.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin text-gm-text-tertiary"}):e.jsx(ge,{className:"w-3.5 h-3.5 text-gm-text-tertiary"})})]})]}),e.jsx("div",{className:"flex gap-0.5 px-4 border-b border-gm-border-primary bg-gm-surface-secondary shrink-0",children:kt.map(t=>{const s=t.icon;return e.jsxs("button",{onClick:()=>w(t.key),className:N("flex items-center gap-1 px-2.5 py-2 text-[10px] font-medium border-b-2 transition-colors",r===t.key?"border-gm-interactive-primary text-gm-interactive-primary":"border-transparent text-gm-text-tertiary hover:text-gm-text-primary"),children:[e.jsx(s,{className:"w-3 h-3"})," ",t.label,t.count!==void 0&&t.count>0&&e.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded-full bg-gm-surface-secondary text-gm-text-tertiary",children:t.count})]},t.key)})}),(r==="entities"||r==="relations")&&e.jsx("div",{className:"px-4 pt-3 shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gm-text-tertiary"}),e.jsx("input",{value:h,onChange:t=>_(t.target.value),placeholder:`Search ${r}...`,className:"w-full pl-8 pr-3 py-1.5 bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r==="entities"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{value:n,onChange:t=>l(t.target.value),placeholder:"New entity type...",className:"flex-1 bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus",onKeyDown:t=>t.key==="Enter"&&rt()}),e.jsxs("button",{onClick:rt,disabled:$e.isPending||!n.trim(),className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1 transition-colors",children:[e.jsx(Le,{className:"w-3 h-3"})," Add"]})]}),j.isLoading?e.jsx(x,{className:"w-5 h-5 animate-spin text-gm-interactive-primary mx-auto"}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:jt.map((t,s)=>{const i=String(t.name||t.type||t.label||""),o=Number(t.count||t.instances||0),d=t.properties||[],b=Array.isArray(d)?d:Object.entries(d).map(([ee])=>({name:ee})),O=D(i,t.color?String(t.color):void 0),P=String(t.description||""),q=!!(t.sharedEntity||t.shared);return e.jsxs("div",{onClick:()=>k(t),className:"bg-[var(--gm-surface-hover)] rounded-xl p-3 border border-gm-border-primary hover:border-blue-600/30 transition-colors cursor-pointer group",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("div",{className:"w-6 h-6 rounded-lg flex items-center justify-center text-white text-[9px] font-bold shrink-0",style:{backgroundColor:O},children:i.charAt(0)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs font-semibold text-gm-text-primary truncate",children:i}),q&&e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-blue-600/10 text-gm-interactive-primary",children:"S"})]})}),o>0&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary shrink-0",children:o})]}),P&&e.jsx("p",{className:"text-[9px] text-gm-text-tertiary mb-1.5 line-clamp-1",children:P}),b.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[b.slice(0,4).map((ee,Re)=>e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary",children:String(ee.name||ee)},Re)),b.length>4&&e.jsxs("span",{className:"text-[8px] text-gm-text-tertiary",children:["+",b.length-4]})]}),e.jsx(Ae,{className:"w-3 h-3 text-gm-text-tertiary opacity-0 group-hover:opacity-100 transition-opacity absolute top-2 right-2"})]},s)})})]}),r==="relations"&&e.jsxs(e.Fragment,{children:[c?e.jsx(Ps,{entityNames:wt,onSave:St,onCancel:()=>u(!1),isPending:Ge.isPending}):e.jsxs("button",{onClick:()=>u(!0),className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover flex items-center gap-1 transition-colors",children:[e.jsx(Le,{className:"w-3 h-3"})," New Relation"]}),L.isLoading?e.jsx(x,{className:"w-5 h-5 animate-spin text-gm-interactive-primary mx-auto"}):e.jsx("div",{className:"space-y-1.5",children:vt.map((t,s)=>{const i=String(t.name||t.type||t.label||""),o=Number(t.count||t.instances||0),d=String(t.from||t.source||t.from_type||""),b=String(t.to||t.target||t.to_type||""),O=String(t.description||"");return e.jsxs("div",{className:"flex items-center gap-2 bg-[var(--gm-surface-hover)] rounded-lg p-2.5 group",children:[d&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded font-medium",style:{backgroundColor:`${D(d)}20`,color:D(d)},children:d}),e.jsxs("span",{className:"text-xs font-medium text-gm-interactive-primary",children:["→ ",i.replace(/_/g," ")," →"]}),b&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded font-medium",style:{backgroundColor:`${D(b)}20`,color:D(b)},children:b}),O&&e.jsx("span",{className:"text-[9px] text-gm-text-tertiary truncate max-w-[150px] hidden group-hover:block",children:O}),o>0&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary ml-auto",children:o})]},s)})})]}),r==="graph"&&e.jsx(Ts,{entities:R,relations:z}),r==="suggestions"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs("button",{onClick:()=>Ne.mutate(void 0,{onSuccess:()=>m.success("Graph analysis started")}),disabled:Ne.isPending,className:"px-3 py-1.5 rounded-lg bg-blue-600/10 text-gm-interactive-primary text-xs font-medium hover:bg-blue-600/20 disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[Ne.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(le,{className:"w-3.5 h-3.5"})," Analyze Graph"]}),e.jsxs("button",{onClick:()=>fe.mutate({minConfidence:.8},{onSuccess:()=>m.success("High-confidence suggestions auto-approved")}),disabled:fe.isPending||at.length===0,className:"px-3 py-1.5 rounded-lg bg-gm-status-success-bg text-gm-status-success text-xs font-medium hover:bg-green-500/20 disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[fe.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(hs,{className:"w-3.5 h-3.5"})," Auto-Approve (≥80%)"]}),e.jsxs("button",{onClick:()=>je.mutate(void 0,{onSuccess:()=>m.success("Relationship inference started")}),disabled:je.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[je.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ye,{className:"w-3.5 h-3.5"})," Infer Relations"]})]}),y.isLoading?e.jsx(x,{className:"w-5 h-5 animate-spin text-gm-interactive-primary mx-auto"}):Ee.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ue,{className:"w-10 h-10 mx-auto mb-3 text-gray-600"}),e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No AI suggestions pending"}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary mt-1",children:'Run "Analyze Graph" to generate suggestions'})]}):e.jsx("div",{className:"space-y-2",children:Ee.map((t,s)=>{const i=String(t.type||t.suggestion_type||""),o=String(t.name||t.suggested_name||t.content||""),d=String(t.reason||t.explanation||t.description||""),b=Number(t.confidence||0),O=String(t.status||"pending"),P=t.enrichment,q=O==="pending";return e.jsx("div",{className:N("bg-[var(--gm-surface-hover)] rounded-xl p-3 border transition-colors",q?"border-gm-border-primary":O==="approved"?"border-green-500/20 opacity-60":"border-red-500/20 opacity-60"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-gm-interactive-primary shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs font-semibold text-gm-text-primary",children:o}),e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-blue-600/10 text-gm-interactive-primary capitalize",children:i.replace(/_/g," ")}),b>0&&e.jsxs("span",{className:N("text-[10px] font-medium",b>=.8?"text-gm-status-success":b>=.5?"text-gm-status-warning":"text-gm-text-tertiary"),children:[Math.round(b*100),"%"]}),!q&&e.jsx("span",{className:N("text-[9px] px-1 py-0.5 rounded",O==="approved"?"bg-gm-status-success-bg text-gm-status-success":"bg-gm-status-danger-bg text-gm-status-danger"),children:O})]}),d&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary mt-1",children:d}),P&&e.jsxs("div",{className:"mt-2 p-2 bg-gm-surface-secondary rounded-lg space-y-1",children:[P.description&&e.jsx("p",{className:"text-[10px] text-gm-text-primary",children:String(P.description)}),Array.isArray(P.useCases)&&P.useCases.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:P.useCases.map((ee,Re)=>e.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-gm-surface-hover text-gm-text-tertiary",children:ee},Re))})]})]}),q&&e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx("button",{onClick:()=>Be.mutate(String(t.id),{onSuccess:()=>m.success("Enriched")}),disabled:Be.isPending,className:"p-1.5 rounded-lg bg-blue-600/10 text-gm-interactive-primary hover:bg-blue-600/20 transition-colors",title:"AI Enrich",children:e.jsx(le,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>De.mutate({id:String(t.id)},{onSuccess:()=>m.success("Approved")}),disabled:De.isPending,className:"p-1.5 rounded-lg bg-gm-status-success-bg text-gm-status-success hover:bg-green-500/20 transition-colors",children:e.jsx(ot,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>Fe.mutate({id:String(t.id)},{onSuccess:()=>m.success("Rejected")}),disabled:Fe.isPending,className:"p-1.5 rounded-lg bg-gm-status-danger-bg text-gm-status-danger hover:bg-red-500/20 transition-colors",children:e.jsx(Ie,{className:"w-3.5 h-3.5"})})]})]})},s)})})]}),r==="stats"&&e.jsx("div",{className:"space-y-4",children:f.isLoading?e.jsx(x,{className:"w-5 h-5 animate-spin text-gm-interactive-primary mx-auto"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(ft).filter(([,t])=>typeof t=="number").slice(0,9).map(([t,s])=>e.jsxs("div",{className:"bg-gm-surface-secondary rounded-xl p-3 border border-gm-border-primary",children:[e.jsx("p",{className:"text-lg font-bold text-gm-text-primary",children:String(s)}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary capitalize",children:t.replace(/_/g," ")})]},t))}),R.length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"})," Entity Types by Instance Count"]}),e.jsx("div",{className:"space-y-1.5",children:R.slice(0,10).map(t=>{const s=String(t.name||t.type||t.label||"?"),i=Number(t.count||t.instances||t.nodeCount||0),o=Math.max(...R.slice(0,10).map(d=>Number(d.count||d.instances||d.nodeCount||0)),1);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-gm-text-tertiary w-24 truncate text-right",children:s}),e.jsx("div",{className:"flex-1 h-4 bg-gm-surface-secondary rounded overflow-hidden",children:e.jsx("div",{className:"h-full rounded transition-all",style:{width:`${Math.max(i/o*100,2)}%`,backgroundColor:D(s,"#6366f1")}})}),e.jsx("span",{className:"text-[10px] font-mono text-gm-text-tertiary w-8 text-right",children:i})]},s)})})]}),z.length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(ye,{className:"w-3.5 h-3.5"})," Relation Types by Instance Count"]}),e.jsx("div",{className:"space-y-1.5",children:z.slice(0,10).map(t=>{const s=String(t.name||t.type||t.label||"?"),i=Number(t.count||t.instances||t.edgeCount||0),o=Math.max(...z.slice(0,10).map(d=>Number(d.count||d.instances||d.edgeCount||0)),1);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-gm-text-tertiary w-24 truncate text-right",children:s}),e.jsx("div",{className:"flex-1 h-4 bg-gm-surface-secondary rounded overflow-hidden",children:e.jsx("div",{className:"h-full rounded bg-gm-interactive-primary/70 transition-all",style:{width:`${Math.max(i/o*100,2)}%`}})}),e.jsx("span",{className:"text-[10px] font-mono text-gm-text-tertiary w-8 text-right",children:i})]},s)})})]}),H>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(pe,{className:"w-4 h-4 text-gm-interactive-primary"}),e.jsx("h4",{className:"text-xs font-semibold text-gm-text-primary",children:"Compliance Score"}),e.jsxs("span",{className:N("text-sm font-bold ml-auto",H>=80?"text-gm-status-success":H>=50?"text-gm-status-warning":"text-gm-status-danger"),children:[H,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-gm-surface-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:N("h-full rounded-full transition-all",H>=80?"bg-gm-status-success":H>=50?"bg-gm-status-warning":"bg-gm-status-danger"),style:{width:`${H}%`}})})]}),re.length>0&&e.jsxs("div",{className:"bg-[var(--gm-status-warning-bg)] border border-yellow-500/20 rounded-xl p-4",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-status-warning mb-2 flex items-center gap-1.5",children:[e.jsx(nt,{className:"w-3.5 h-3.5"})," Compliance Issues (",re.length,")"]}),e.jsxs("div",{className:"space-y-1.5",children:[re.slice(0,8).map((t,s)=>e.jsx("p",{className:"text-xs text-gm-text-primary",children:String(t.message||t.description||JSON.stringify(t))},s)),re.length>8&&e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:["+",re.length-8," more"]})]})]}),e.jsxs("button",{onClick:()=>B.refetch(),disabled:B.isFetching,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[B.isFetching?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(pe,{className:"w-3.5 h-3.5"})," Check Compliance"]})]})}),r==="tools"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(it,{className:"w-3.5 h-3.5"})," Extract Ontology from Graph"]}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Reverse-engineer the ontology schema from existing graph data to discover entity types and relationships that exist in practice."}),e.jsxs("button",{onClick:()=>X.mutate(void 0,{onSuccess:t=>{const s=t,i=s.notInSchema||s.extracted?.notInSchema||[];m.success(`Extraction complete${i.length?` — ${i.length} types not in schema`:""}`)},onError:()=>m.error("Extraction failed")}),disabled:X.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[X.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(it,{className:"w-3.5 h-3.5"})," Extract"]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(xe,{className:"w-3.5 h-3.5"})," Schema vs Graph Diff"]}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Compare the defined ontology schema with what actually exists in the graph database."}),e.jsxs("button",{onClick:()=>G.refetch(),disabled:G.isFetching,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[G.isFetching?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(xe,{className:"w-3.5 h-3.5"})," Run Diff"]}),!G.isLoading&&Object.keys(He).length>0&&e.jsx("div",{className:"space-y-2 text-xs mt-2",children:Object.entries(He).map(([t,s])=>e.jsxs("div",{children:[e.jsx("span",{className:"text-gm-text-tertiary capitalize font-medium",children:t.replace(/_/g," ")}),e.jsx("pre",{className:"text-[10px] text-gm-text-primary mt-1 bg-gm-surface-secondary rounded-lg p-2 overflow-x-auto max-h-40",children:typeof s=="string"?s:JSON.stringify(s,null,2)})]},t))})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(lt,{className:"w-3.5 h-3.5"})," Merge & Update"]}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Merge extracted ontology back into the schema, adding missing entity and relation types."}),e.jsxs("button",{onClick:()=>{X.mutate(void 0,{onSuccess:t=>{const s=t;ve.mutate({source:s.extracted||s},{onSuccess:()=>m.success("Ontology merged successfully"),onError:()=>m.error("Merge failed")})},onError:()=>m.error("Extract failed before merge")})},disabled:X.isPending||ve.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-status-warning-bg text-gm-status-warning text-xs font-medium hover:bg-yellow-500/20 disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[X.isPending||ve.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(lt,{className:"w-3.5 h-3.5"})," Extract & Merge"]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(nt,{className:"w-3.5 h-3.5 text-gm-status-warning"})," Unused Types"]}),e.jsxs("button",{onClick:()=>a.refetch(),disabled:a.isFetching,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors mb-2",children:[a.isFetching?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Te,{className:"w-3.5 h-3.5"})," Find Unused"]}),ne.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider mb-1.5",children:["Entities (",ne.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mb-2",children:ne.map(t=>e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-warning-bg text-gm-status-warning font-medium",children:t},t))}),e.jsxs("button",{onClick:()=>Y.mutate({entities:ne},{onSuccess:()=>m.success("Unused entities removed")}),disabled:Y.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-status-danger-bg text-gm-status-danger text-xs font-medium hover:bg-red-500/20 disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[Y.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ct,{className:"w-3.5 h-3.5"})," Remove Entities"]})]}),ie.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider mb-1.5",children:["Relations (",ie.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mb-2",children:ie.map(t=>e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-warning-bg text-gm-status-warning font-medium",children:t},t))}),e.jsxs("button",{onClick:()=>Y.mutate({relations:ie},{onSuccess:()=>m.success("Unused relations removed")}),disabled:Y.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-status-danger-bg text-gm-status-danger text-xs font-medium hover:bg-red-500/20 disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[Y.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ct,{className:"w-3.5 h-3.5"})," Remove Relations"]})]}),ne.length===0&&ie.length===0&&!a.isFetching&&e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:'All types are in use (or click "Find Unused" to check).'})]})]}),r==="jobs"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(xe,{className:"w-4 h-4 text-gm-interactive-primary"}),e.jsx("h4",{className:"text-xs font-semibold text-gm-text-primary",children:"Background Worker"}),e.jsx("div",{className:N("ml-auto px-2 py-0.5 rounded-full text-[9px] font-medium",T.status==="running"||T.running?"bg-gm-status-success-bg text-gm-status-success":"bg-gm-surface-secondary text-gm-text-tertiary"),children:String(T.status||(T.running?"Running":"Idle"))})]}),Q.isLoading?e.jsx(x,{className:"w-4 h-4 animate-spin"}):e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-xs",children:[T.lastRun&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Last Run"}),e.jsx("p",{className:"text-gm-text-primary font-medium",children:new Date(String(T.lastRun||T.last_run)).toLocaleString()})]}),T.nextRun&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Next Run"}),e.jsx("p",{className:"text-gm-text-primary font-medium",children:new Date(String(T.nextRun||T.next_run)).toLocaleString()})]}),(T.totalRuns||T.total_runs)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Total Runs"}),e.jsx("p",{className:"text-gm-text-primary font-medium",children:String(T.totalRuns||T.total_runs)})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>F.mutate({type:"full_analysis"},{onSuccess:()=>m.success("Full analysis triggered")}),disabled:F.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[F.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(le,{className:"w-3.5 h-3.5"})," Full Analysis"]}),e.jsxs("button",{onClick:()=>F.mutate({type:"inference"},{onSuccess:()=>m.success("Inference triggered")}),disabled:F.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Inference Rules"]}),e.jsxs("button",{onClick:()=>F.mutate({type:"dedup"},{onSuccess:()=>m.success("Dedup triggered")}),disabled:F.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[e.jsx(he,{className:"w-3.5 h-3.5"})," Deduplication"]}),e.jsxs("button",{onClick:()=>F.mutate({type:"gap_detection"},{onSuccess:()=>m.success("Gap detection triggered")}),disabled:F.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[e.jsx(Te,{className:"w-3.5 h-3.5"})," Gap Detection"]}),e.jsxs("button",{onClick:()=>se.mutate(void 0,{onSuccess:()=>m.success("Sync triggered")}),disabled:se.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Force Sync"]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(xs,{className:"w-3.5 h-3.5"})," Scheduled Jobs"]}),C.isLoading?e.jsx(x,{className:"w-4 h-4 animate-spin"}):qe.length===0?e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No scheduled jobs configured"}):e.jsx("div",{className:"space-y-2",children:qe.map((t,s)=>{const i=String(t.name||t.type||t.id||""),o=!!(t.enabled??t.active??!0),d=String(t.interval||t.cron||t.schedule||""),b=t.lastRun||t.last_run,O=String(t.status||(o?"active":"paused")),P=Number(t.stats&&t.stats.totalRuns)||Number(t.total_runs||0);return e.jsxs("div",{className:"flex items-center gap-3 bg-gm-surface-secondary rounded-lg p-2.5",children:[e.jsx("button",{onClick:()=>We.mutate(String(t.id),{onSuccess:()=>m.success(`Job ${o?"disabled":"enabled"}`)}),disabled:We.isPending,className:N("p-1 rounded-md transition-colors",o?"text-gm-status-success hover:bg-green-500/10":"text-gm-text-tertiary hover:bg-gm-surface-hover"),children:o?e.jsx(ws,{className:"w-3.5 h-3.5"}):e.jsx(js,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gm-text-primary",children:i}),e.jsx("span",{className:N("text-[9px] px-1 py-0.5 rounded",o?"bg-gm-status-success-bg text-gm-status-success":"bg-gm-surface-hover text-gm-text-tertiary"),children:O})]}),e.jsxs("div",{className:"flex gap-3 text-[10px] text-gm-text-tertiary mt-0.5",children:[d&&e.jsx("span",{children:d}),b&&e.jsxs("span",{children:["Last: ",new Date(String(b)).toLocaleString()]}),P>0&&e.jsxs("span",{children:[P," runs"]})]})]}),e.jsx("button",{onClick:()=>F.mutate({type:String(t.type||t.id)},{onSuccess:()=>m.success("Job triggered")}),disabled:F.isPending,className:"p-1.5 rounded-lg bg-gm-interactive-primary/10 text-gm-interactive-primary hover:bg-gm-interactive-primary/20 transition-colors",title:"Run now",children:e.jsx(dt,{className:"w-3 h-3"})})]},s)})})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(te,{className:"w-3.5 h-3.5"})," Execution Log"]}),E.isLoading?e.jsx(x,{className:"w-4 h-4 animate-spin"}):Ke.length===0?e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No execution history"}):e.jsx("div",{className:"space-y-1.5 max-h-60 overflow-y-auto",children:Ke.slice(0,20).map((t,s)=>{const i=String(t.jobType||t.job_type||t.type||""),o=String(t.status||""),d=t.startedAt||t.started_at||t.created_at,b=Number(t.duration||t.elapsed_ms||0),O=String(t.error||"");return e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:N("w-1.5 h-1.5 rounded-full shrink-0",o==="completed"?"bg-gm-status-success":o==="failed"?"bg-gm-status-danger":o==="started"?"bg-gm-status-warning animate-pulse":"bg-gm-text-tertiary")}),e.jsx("span",{className:"text-gm-text-primary font-medium w-24 shrink-0 truncate",children:i}),e.jsx("span",{className:N("text-[10px] w-16 shrink-0",o==="completed"?"text-gm-status-success":o==="failed"?"text-gm-status-danger":"text-gm-text-tertiary"),children:o}),b>0&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary w-16 shrink-0",children:b>1e3?`${(b/1e3).toFixed(1)}s`:`${b}ms`}),d&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary",children:new Date(String(d)).toLocaleString()}),O&&o==="failed"&&e.jsx("span",{className:"text-[10px] text-gm-status-danger truncate max-w-[150px]",title:O,children:O})]},s)})})]})]}),r==="changes"&&e.jsxs("div",{className:"space-y-4",children:[!g.isLoading&&Object.keys(me).length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary mb-2 flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Sync Status"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Object.entries(me).map(([t,s])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gm-text-tertiary capitalize shrink-0",children:t.replace(/_/g," ")}),e.jsx("span",{className:"text-gm-text-primary text-[10px] truncate",children:s==null?"—":String(s)})]},t))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary mb-3 flex items-center gap-1.5",children:[e.jsx(te,{className:"w-3.5 h-3.5"})," Change Log"]}),V.isLoading?e.jsx(x,{className:"w-5 h-5 animate-spin text-gm-interactive-primary mx-auto"}):Ve.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(te,{className:"w-10 h-10 mx-auto mb-3 text-gray-600"}),e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No changes recorded"})]}):e.jsx("div",{className:"space-y-1.5",children:Ve.slice(0,50).map((t,s)=>{const i=String(t.change_type||t.action||t.type||""),o=String(t.target_name||t.target||t.entity||""),d=String(t.reason||t.description||t.message||""),b=String(t.source||""),O=t.changed_at||t.created_at,P=i.includes("added")||i==="add",q=i.includes("removed")||i==="remove";return e.jsxs("div",{className:"flex items-start gap-2 bg-[var(--gm-surface-hover)] rounded-lg p-2.5 border border-gm-border-primary",children:[e.jsx("div",{className:N("w-2 h-2 rounded-full mt-1.5 shrink-0",P?"bg-gm-status-success":q?"bg-gm-status-danger":"bg-gm-status-warning")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary font-medium",children:i.replace(/_/g," ")}),o&&e.jsx("span",{className:"text-xs font-medium text-gm-text-primary",children:o})]}),d&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary mt-0.5",children:d}),e.jsxs("div",{className:"flex gap-2 mt-0.5 text-[9px] text-gm-text-tertiary",children:[b&&e.jsx("span",{children:b}),O&&e.jsx("span",{children:new Date(String(O)).toLocaleString()})]})]})]},s)})})]})]}),r==="inference"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[{label:"Runs",value:ce.runsCompleted||0},{label:"Inferred",value:ce.totalRelationshipsInferred||0},{label:"Errors",value:ce.totalErrors||0},{label:"Last Run",value:ce.lastRun?new Date(String(ce.lastRun)).toLocaleDateString():"—"}].map((t,s)=>e.jsxs("div",{className:"bg-gm-surface-secondary rounded-xl p-3 border border-gm-border-primary",children:[e.jsx("p",{className:"text-lg font-bold text-gm-text-primary",children:String(t.value)}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:t.label})]},s))}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>ae.mutate(void 0,{onSuccess:()=>m.success("All inference rules executed")}),disabled:ae.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[ae.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(oe,{className:"w-3.5 h-3.5"})," Run All Rules"]})}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Defined Rules"]}),$.isLoading?e.jsx(x,{className:"w-4 h-4 animate-spin"}):Ye.length===0&&Xe.length===0?e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No inference rules defined"}):e.jsxs("div",{className:"space-y-2",children:[Ye.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 bg-gm-surface-secondary rounded-lg p-2.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5 text-gm-status-warning shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-xs font-medium text-gm-text-primary",children:String(t.name||t.id||"")}),t.description&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:String(t.description)}),t.type&&e.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-gm-surface-hover text-gm-text-tertiary ml-1",children:String(t.type)})]}),e.jsx("button",{onClick:()=>ae.mutate(String(t.name||t.id),{onSuccess:()=>m.success(`Rule "${t.name}" executed`)}),disabled:ae.isPending,className:"p-1.5 rounded-lg bg-gm-interactive-primary/10 text-gm-interactive-primary hover:bg-gm-interactive-primary/20 transition-colors",title:"Run rule",children:e.jsx(dt,{className:"w-3 h-3"})})]},s)),Xe.map((t,s)=>e.jsxs("div",{className:"bg-gm-surface-secondary rounded-lg p-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded bg-blue-600/10 text-gm-interactive-primary font-medium",children:"Cypher"}),e.jsx("span",{className:"text-xs font-medium text-gm-text-primary",children:String(t.name||"")})]}),t.description&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:String(t.description)}),t.cypher&&e.jsx("pre",{className:"text-[9px] text-gm-text-tertiary mt-1 bg-gm-surface-hover rounded p-1.5 overflow-x-auto",children:String(t.cypher)})]},`c-${s}`))]})]}),Ze.length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(gs,{className:"w-3.5 h-3.5"})," Available Runtime Rules"]}),e.jsx("div",{className:"space-y-1.5",children:Ze.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-gm-text-primary font-medium",children:String(t.name||"")}),t.description&&e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary",children:["— ",String(t.description)]})]},s))})]})]}),r==="embeddings"&&e.jsx("div",{className:"space-y-4",children:K.isLoading?e.jsx(x,{className:"w-5 h-5 animate-spin text-gm-interactive-primary mx-auto"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[{label:"Total Entities",value:A.totalEntities||0},{label:"With Embeddings",value:A.totalWithEmbeddings||0},{label:"Coverage",value:`${A.overallCoverage||0}%`},{label:"Model",value:String(A.model||"N/A")}].map((t,s)=>e.jsxs("div",{className:"bg-gm-surface-secondary rounded-xl p-3 border border-gm-border-primary",children:[e.jsx("p",{className:"text-lg font-bold text-gm-text-primary",children:String(t.value)}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:t.label})]},s))}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-gm-text-primary",children:"Overall Coverage"}),e.jsxs("span",{className:N("text-sm font-bold",Number(A.overallCoverage||0)>=80?"text-gm-status-success":Number(A.overallCoverage||0)>=50?"text-gm-status-warning":"text-gm-status-danger"),children:[A.overallCoverage||0,"%"]})]}),e.jsx("div",{className:"w-full h-3 bg-gm-surface-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:N("h-full rounded-full transition-all",Number(A.overallCoverage||0)>=80?"bg-gm-status-success":Number(A.overallCoverage||0)>=50?"bg-gm-status-warning":"bg-gm-status-danger"),style:{width:`${A.overallCoverage||0}%`}})}),e.jsxs("div",{className:"flex gap-3 mt-2 text-[10px] text-gm-text-tertiary",children:[e.jsxs("span",{children:["Dimensions: ",String(A.dimensions||1024)]}),Number(A.staleCount||0)>0&&e.jsxs("span",{className:"text-gm-status-warning",children:[A.staleCount," stale"]})]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"})," Coverage by Type"]}),Object.keys(et).length===0?e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No coverage data available"}):e.jsx("div",{className:"space-y-2",children:Object.entries(et).map(([t,s])=>{const i=Number(s.coverage||0),o=Number(s.total||0),d=Number(s.withEmbedding||0);return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gm-text-primary capitalize",children:t}),e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary",children:[d,"/",o]})]}),e.jsxs("span",{className:N("text-[10px] font-medium",i>=80?"text-gm-status-success":i>=50?"text-gm-status-warning":"text-gm-status-danger"),children:[i,"%"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gm-surface-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:N("h-full rounded-full transition-all",i>=80?"bg-gm-status-success":i>=50?"bg-gm-status-warning":"bg-gm-status-danger"),style:{width:`${i}%`}})})]},t)})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>we.mutate(void 0,{onSuccess:()=>m.success("Embedding regeneration queued for all types")}),disabled:we.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[we.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ge,{className:"w-3.5 h-3.5"})," Regenerate All"]})})]})}),r==="shared"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[e.jsx("h4",{className:"text-xs font-semibold text-gm-text-primary mb-1",children:"Cross-Project Entities"}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary mb-3",children:"Shared entity types are visible across all projects. Toggle sharing per entity type."})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(he,{className:"w-3.5 h-3.5"})," Entity Types"]}),j.isLoading?e.jsx(x,{className:"w-4 h-4 animate-spin"}):e.jsx("div",{className:"space-y-1.5",children:R.map((t,s)=>{const i=String(t.name||t.type||t.label||""),o=!!(t.sharedEntity||t.shared),d=D(i,t.color?String(t.color):void 0);return e.jsxs("div",{className:"flex items-center gap-3 bg-gm-surface-secondary rounded-lg p-2",children:[e.jsx("div",{className:"w-5 h-5 rounded flex items-center justify-center text-white text-[8px] font-bold",style:{backgroundColor:d},children:i.charAt(0)}),e.jsx("span",{className:"text-xs font-medium text-gm-text-primary flex-1",children:i}),e.jsx("button",{onClick:()=>Je.mutate({name:i,shared:!o},{onSuccess:()=>m.success(`${i} is now ${o?"project-only":"shared"}`)}),disabled:Je.isPending,className:N("px-2 py-0.5 rounded-full text-[9px] font-medium transition-colors",o?"bg-gm-interactive-primary/10 text-gm-interactive-primary":"bg-gm-surface-hover text-gm-text-tertiary hover:bg-gm-surface-secondary"),children:o?"Shared":"Project Only"})]},s)})})]}),tt.length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(ye,{className:"w-3.5 h-3.5"})," Cross-Graph Relations"]}),e.jsx("div",{className:"space-y-1.5",children:tt.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-gm-text-primary font-medium",children:String(t.name||t.type||"")}),t.from&&e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary",children:["(",String(t.from)," → ",String(t.to),")"]})]},s))})]}),Oe.length>0&&e.jsxs("div",{className:"bg-blue-600/5 rounded-xl p-4 border border-blue-600/10",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-interactive-primary mb-2",children:[Oe.length," Shared Entity Types"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:Oe.map((t,s)=>e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-interactive-primary/10 text-gm-interactive-primary font-medium",children:String(t.name||"")},s))})]})]}),r==="versions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gm-interactive-primary/10 flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-gm-interactive-primary"})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gm-text-primary",children:["Current Version: ",String(_e.currentVersion||"—")]}),e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[String(_e.totalChanges||0)," total changes recorded"]})]})]})}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(te,{className:"w-3.5 h-3.5"})," Version History"]}),Me.isLoading?e.jsx(x,{className:"w-4 h-4 animate-spin"}):st.length===0?e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No version snapshots recorded"}):e.jsx("div",{className:"space-y-2",children:st.map((t,s)=>e.jsxs("div",{className:"bg-gm-surface-secondary rounded-lg p-3 border border-gm-border-primary",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-bold text-gm-text-primary",children:["v",String(t.version||"?")]}),e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-surface-hover text-gm-text-tertiary",children:String(t.changeType||t.change_type||"").replace(/_/g," ")}),t.source&&e.jsx("span",{className:"text-[9px] text-gm-text-tertiary",children:String(t.source)})]}),t.reason&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:String(t.reason)}),e.jsxs("div",{className:"flex gap-2 mt-1 text-[9px] text-gm-text-tertiary",children:[t.changedBy&&e.jsxs("span",{children:["by ",String(t.changedBy)]}),t.changedAt&&e.jsx("span",{children:new Date(String(t.changedAt)).toLocaleString()})]}),t.diff&&Object.keys(t.diff).length>0&&e.jsx("pre",{className:"text-[9px] text-gm-text-tertiary mt-2 bg-gm-surface-hover rounded p-2 overflow-x-auto max-h-20",children:JSON.stringify(t.diff,null,2)})]},s))})]})]}),r==="test"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(pe,{className:"w-3.5 h-3.5"})," Validate Entity Against Schema"]}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Test whether an entity object conforms to its type definition in the ontology schema."}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:Se,onChange:t=>pt(t.target.value),className:"flex-shrink-0 w-40 px-2 py-1.5 text-xs bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-gm-text-primary",children:[e.jsx("option",{value:"",children:"Select type..."}),R.map(t=>{const s=String(t.name||t.type||t.label||"");return e.jsx("option",{value:s,children:s},s)})]})}),e.jsx("textarea",{value:ze,onChange:t=>ut(t.target.value),rows:5,className:"w-full px-3 py-2 text-xs font-mono bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-gm-text-primary resize-y",placeholder:'{"name": "example", "description": "..."}'}),e.jsxs("button",{disabled:!Se||I.isPending,onClick:()=>{try{const t=JSON.parse(ze);I.mutate({type:Se,entity:t})}catch{m.error("Invalid JSON")}},className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-white text-xs font-medium hover:opacity-90 disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[I.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(pe,{className:"w-3.5 h-3.5"})," Validate"]}),I.data&&e.jsxs("div",{className:N("rounded-lg p-3 border text-xs",I.data.valid?"bg-gm-status-success/10 border-gm-status-success/30 text-gm-status-success":"bg-gm-status-danger/10 border-gm-status-danger/30 text-gm-status-danger"),children:[e.jsx("div",{className:"flex items-center gap-1.5 font-semibold mb-1",children:I.data.valid?e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-3.5 h-3.5"})," Valid"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-3.5 h-3.5"})," Invalid"]})}),(I.data.errors||[]).length>0&&e.jsx("ul",{className:"mt-1 space-y-0.5 text-gm-text-primary",children:I.data.errors.map((t,s)=>e.jsxs("li",{className:"text-[10px]",children:["- ",t]},s))}),(I.data.missingRequired||[]).length>0&&e.jsxs("p",{className:"text-[10px] text-gm-text-primary mt-1",children:["Missing required: ",I.data.missingRequired.join(", ")]}),(I.data.unknownProperties||[]).length>0&&e.jsxs("p",{className:"text-[10px] text-gm-text-primary mt-1",children:["Unknown properties: ",I.data.unknownProperties.join(", ")]})]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(ps,{className:"w-3.5 h-3.5"})," Extract Entities from Text (AI)"]}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Paste any text and let the AI identify entities and relationships using the current ontology schema."}),e.jsx("textarea",{value:ke,onChange:t=>ht(t.target.value),rows:6,className:"w-full px-3 py-2 text-xs bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-gm-text-primary resize-y",placeholder:"Paste meeting notes, a document, or any text here..."}),e.jsxs("button",{disabled:!ke.trim()||M.isPending,onClick:()=>M.mutate({text:ke,existingEntities:R.map(t=>String(t.name||t.type||"")).filter(Boolean)}),className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-white text-xs font-medium hover:opacity-90 disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[M.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"})," Extract"]}),M.data&&e.jsxs("div",{className:"space-y-3",children:[(M.data.entities||[]).length>0&&e.jsxs("div",{className:"bg-gm-surface-secondary rounded-lg p-3 border border-gm-border-primary space-y-2",children:[e.jsxs("h5",{className:"text-[10px] font-semibold text-gm-text-primary",children:["Extracted Entities (",M.data.entities.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:M.data.entities.map((t,s)=>e.jsxs("span",{className:"px-2 py-1 rounded-lg text-[10px] font-medium border border-gm-border-primary bg-gm-surface-hover text-gm-text-primary",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full mr-1",style:{backgroundColor:D(String(t.type||t.entityType||""),"#6366f1")}}),String(t.name||t.value||"?"),e.jsx("span",{className:"ml-1 text-gm-text-tertiary",children:String(t.type||t.entityType||"")})]},s))})]}),(M.data.relationships||[]).length>0&&e.jsxs("div",{className:"bg-gm-surface-secondary rounded-lg p-3 border border-gm-border-primary space-y-2",children:[e.jsxs("h5",{className:"text-[10px] font-semibold text-gm-text-primary",children:["Extracted Relationships (",M.data.relationships.length,")"]}),e.jsx("div",{className:"space-y-1",children:M.data.relationships.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-gm-text-primary",children:[e.jsx("span",{className:"font-medium",children:String(t.from||t.source||"?")}),e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-gm-interactive-primary/10 text-gm-interactive-primary font-mono text-[9px]",children:String(t.type||t.relationship||"?")}),e.jsx("span",{className:"font-medium",children:String(t.to||t.target||"?")}),t.confidence&&e.jsxs("span",{className:"text-gm-text-tertiary",children:["(",Math.round(Number(t.confidence)*100),"%)"]})]},s))})]}),(M.data.entities||[]).length===0&&(M.data.relationships||[]).length===0&&e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No entities or relationships found in the provided text."})]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary space-y-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(Ae,{className:"w-3.5 h-3.5"})," Embedding Preview"]}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Preview the enriched text that would be generated for an entity before converting it to a vector embedding."}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:Ce,onChange:t=>yt(t.target.value),className:"flex-shrink-0 w-40 px-2 py-1.5 text-xs bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-gm-text-primary",children:[e.jsx("option",{value:"",children:"Select type..."}),R.map(t=>{const s=String(t.name||t.type||t.label||"");return e.jsx("option",{value:s,children:s},s)})]})}),e.jsx("textarea",{value:Qe,onChange:t=>bt(t.target.value),rows:4,className:"w-full px-3 py-2 text-xs font-mono bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-gm-text-primary resize-y",placeholder:'{"name": "...", "description": "..."}'}),e.jsxs("button",{disabled:!Ce||Z.isPending,onClick:()=>{try{const t=JSON.parse(Qe);Z.mutate({type:Ce,entity:t})}catch{m.error("Invalid JSON")}},className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[Z.isPending?e.jsx(x,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ae,{className:"w-3.5 h-3.5"})," Preview Embedding Text"]}),Z.data&&Z.data.enrichedText&&e.jsxs("div",{className:"bg-gm-surface-secondary rounded-lg p-3 border border-gm-border-primary",children:[e.jsxs("h5",{className:"text-[10px] font-semibold text-gm-text-primary mb-2 flex items-center gap-1.5",children:[e.jsx(le,{className:"w-3 h-3"})," Generated Embedding Text"]}),e.jsx("pre",{className:"text-[10px] text-gm-text-primary whitespace-pre-wrap font-mono leading-relaxed max-h-40 overflow-y-auto",children:String(Z.data.enrichedText)})]})]})]})]}),S&&e.jsx(Rs,{entity:S,onClose:()=>k(null)})]})}export{ye as G,ks as N,Us as a,Hs as t};
//# sourceMappingURL=GraphOntology-C2zQ-xzI.js.map
