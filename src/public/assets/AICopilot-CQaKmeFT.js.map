{"version":3,"file":"AICopilot-CQaKmeFT.js","sources":["../../frontend/components/graph/AICopilot.ts"],"sourcesContent":["/**\n * AICopilot - AI-powered chat for the Knowledge Graph\n * \n * Features:\n * - Natural language queries using GraphRAG\n * - Voice input (Web Speech API)\n * - Reasoning chain visualization\n * - Node highlighting\n * - Query suggestions\n * - Persistent chat history\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { graphService, GraphRAGResponse, GraphChatMessage } from '../../services/graph';\nimport { toast } from '../../services/toast';\n\nexport interface AICopilotProps {\n  onClose?: () => void;\n  onHighlightNodes?: (nodeIds: string[]) => void;\n  onExecuteQuery?: (cypher: string) => void;\n}\n\ninterface CopilotState {\n  messages: Array<{\n    role: 'user' | 'assistant' | 'system';\n    content: string;\n    metadata?: GraphRAGResponse;\n    timestamp: Date;\n  }>;\n  isLoading: boolean;\n  sessionId: string;\n  isRecording: boolean;\n}\n\n/**\n * Create the AI Copilot component\n */\nexport function createAICopilot(props: AICopilotProps = {}): HTMLElement {\n  const state: CopilotState = {\n    messages: [],\n    isLoading: false,\n    sessionId: crypto.randomUUID(),\n    isRecording: false,\n  };\n\n  const container = createElement('div', { className: 'ai-copilot' });\n  \n  container.innerHTML = `\n    <div class=\"copilot-header\">\n      <div class=\"copilot-title\">\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M12 2a10 10 0 0 1 10 10c0 5.5-4.5 10-10 10S2 17.5 2 12 6.5 2 12 2\"/>\n          <circle cx=\"12\" cy=\"12\" r=\"3\"/>\n          <path d=\"M12 6v1M12 17v1M6 12h1M17 12h1\"/>\n        </svg>\n        <span>AI Copilot</span>\n      </div>\n      <div class=\"copilot-actions\">\n        <button class=\"copilot-btn\" id=\"copilot-history\" title=\"Chat History\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n            <polyline points=\"12 6 12 12 16 14\"/>\n          </svg>\n        </button>\n        <button class=\"copilot-btn\" id=\"copilot-clear\" title=\"Clear Chat\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <polyline points=\"3 6 5 6 21 6\"/>\n            <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/>\n          </svg>\n        </button>\n        <button class=\"copilot-btn\" id=\"copilot-close\" title=\"Close\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\n            <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\n          </svg>\n        </button>\n      </div>\n    </div>\n    \n    <div class=\"copilot-messages\" id=\"copilot-messages\">\n      <div class=\"copilot-welcome\">\n        <div class=\"welcome-icon\">\n          <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n            <path d=\"M12 2a10 10 0 0 1 10 10c0 5.5-4.5 10-10 10S2 17.5 2 12 6.5 2 12 2\"/>\n            <circle cx=\"12\" cy=\"12\" r=\"3\"/>\n          </svg>\n        </div>\n        <h3>Hello! I'm your AI assistant.</h3>\n        <p>Ask me anything about your knowledge graph. I can help you:</p>\n        <ul class=\"welcome-list\">\n          <li>Find connections between people and projects</li>\n          <li>Explain relationships and patterns</li>\n          <li>Summarize information about entities</li>\n          <li>Generate Cypher queries</li>\n        </ul>\n      </div>\n    </div>\n    \n    <div class=\"copilot-suggestions\" id=\"copilot-suggestions\">\n      <button class=\"suggestion-chip\" data-query=\"Who are the key people in this project?\">\n        Key people\n      </button>\n      <button class=\"suggestion-chip\" data-query=\"What are the main risks?\">\n        Main risks\n      </button>\n      <button class=\"suggestion-chip\" data-query=\"Show recent decisions\">\n        Recent decisions\n      </button>\n      <button class=\"suggestion-chip\" data-query=\"Find connections between teams\">\n        Team connections\n      </button>\n    </div>\n    \n    <div class=\"copilot-input-area\">\n      <div class=\"copilot-input-wrapper\">\n        <textarea\n          id=\"copilot-input\"\n          class=\"copilot-input\"\n          placeholder=\"Ask about your knowledge graph...\"\n          rows=\"1\"\n        ></textarea>\n        <button class=\"copilot-voice-btn ${isVoiceSupported() ? '' : 'hidden'}\" id=\"copilot-voice\" title=\"Voice Input\">\n          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\"/>\n            <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\"/>\n            <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"23\"/>\n            <line x1=\"8\" y1=\"23\" x2=\"16\" y2=\"23\"/>\n          </svg>\n        </button>\n      </div>\n      <button class=\"copilot-send-btn\" id=\"copilot-send\" title=\"Send\">\n        <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"/>\n          <polygon points=\"22 2 15 22 11 13 2 9 22 2\"/>\n        </svg>\n      </button>\n    </div>\n  `;\n\n  // Initialize\n  initCopilot(container, state, props);\n\n  return container;\n}\n\n/**\n * Initialize the copilot\n */\nfunction initCopilot(container: HTMLElement, state: CopilotState, props: AICopilotProps): void {\n  const messagesEl = container.querySelector('#copilot-messages') as HTMLElement;\n  const inputEl = container.querySelector('#copilot-input') as HTMLTextAreaElement;\n  const sendBtn = container.querySelector('#copilot-send') as HTMLElement;\n  const voiceBtn = container.querySelector('#copilot-voice') as HTMLElement;\n  const clearBtn = container.querySelector('#copilot-clear') as HTMLElement;\n  const closeBtn = container.querySelector('#copilot-close') as HTMLElement;\n  const historyBtn = container.querySelector('#copilot-history') as HTMLElement;\n\n  // Send message\n  const sendMessage = async () => {\n    const query = inputEl.value.trim();\n    if (!query || state.isLoading) return;\n\n    inputEl.value = '';\n    inputEl.style.height = 'auto';\n    await processQuery(container, state, query, props);\n  };\n\n  // Bind send button\n  on(sendBtn, 'click', sendMessage);\n\n  // Bind enter key\n  on(inputEl, 'keydown', (e: Event) => {\n    const event = e as KeyboardEvent;\n    if (event.key === 'Enter' && !event.shiftKey) {\n      event.preventDefault();\n      sendMessage();\n    }\n  });\n\n  // Auto-resize textarea\n  on(inputEl, 'input', () => {\n    inputEl.style.height = 'auto';\n    inputEl.style.height = Math.min(inputEl.scrollHeight, 120) + 'px';\n  });\n\n  // Voice input\n  if (voiceBtn && isVoiceSupported()) {\n    on(voiceBtn, 'click', () => toggleVoiceInput(container, state, inputEl));\n  }\n\n  // Clear chat\n  on(clearBtn, 'click', () => {\n    state.messages = [];\n    state.sessionId = crypto.randomUUID();\n    messagesEl.innerHTML = getWelcomeHTML();\n  });\n\n  // Close\n  on(closeBtn, 'click', () => props.onClose?.());\n\n  // History\n  on(historyBtn, 'click', () => showChatHistory(container));\n\n  // Suggestion chips\n  const chips = container.querySelectorAll('.suggestion-chip');\n  chips.forEach(chip => {\n    on(chip as HTMLElement, 'click', () => {\n      const query = chip.getAttribute('data-query');\n      if (query) {\n        inputEl.value = query;\n        sendMessage();\n      }\n    });\n  });\n\n  // Load previous session if exists\n  loadSession(state);\n}\n\n/**\n * Process query\n */\nasync function processQuery(\n  container: HTMLElement,\n  state: CopilotState,\n  query: string,\n  props: AICopilotProps\n): Promise<void> {\n  state.isLoading = true;\n  const messagesEl = container.querySelector('#copilot-messages') as HTMLElement;\n  const suggestionsEl = container.querySelector('#copilot-suggestions') as HTMLElement;\n\n  // Hide welcome and suggestions\n  const welcome = messagesEl.querySelector('.copilot-welcome');\n  if (welcome) welcome.remove();\n  suggestionsEl.classList.add('hidden');\n\n  // Add user message\n  const userMessage = { role: 'user' as const, content: query, timestamp: new Date() };\n  state.messages.push(userMessage);\n  appendMessage(messagesEl, userMessage);\n\n  // Add loading indicator\n  const loadingEl = createElement('div', { className: 'copilot-message assistant loading' });\n  loadingEl.innerHTML = `\n    <div class=\"message-avatar\">\n      <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <circle cx=\"12\" cy=\"12\" r=\"3\"/>\n      </svg>\n    </div>\n    <div class=\"message-content\">\n      <div class=\"typing-indicator\">\n        <span></span><span></span><span></span>\n      </div>\n    </div>\n  `;\n  messagesEl.appendChild(loadingEl);\n  scrollToBottom(messagesEl);\n\n  try {\n    // Call GraphRAG\n    const response = await graphService.query(query);\n\n    // Remove loading\n    loadingEl.remove();\n\n    // Add assistant message\n    const assistantMessage = {\n      role: 'assistant' as const,\n      content: response.answer,\n      metadata: response,\n      timestamp: new Date(),\n    };\n    state.messages.push(assistantMessage);\n    appendMessage(messagesEl, assistantMessage, props);\n\n    // Save to history\n    saveMessage(state, userMessage);\n    saveMessage(state, assistantMessage);\n\n    // Highlight nodes if available\n    if (response.highlightedNodes?.length && props.onHighlightNodes) {\n      props.onHighlightNodes(response.highlightedNodes);\n    }\n\n  } catch (error) {\n    loadingEl.remove();\n    const errorMessage = {\n      role: 'assistant' as const,\n      content: 'Sorry, I encountered an error processing your question. Please try again.',\n      timestamp: new Date(),\n    };\n    state.messages.push(errorMessage);\n    appendMessage(messagesEl, errorMessage);\n  }\n\n  state.isLoading = false;\n  scrollToBottom(messagesEl);\n}\n\n/**\n * Append message to chat\n */\nfunction appendMessage(\n  container: HTMLElement,\n  message: { role: 'user' | 'assistant' | 'system'; content: string; metadata?: GraphRAGResponse; timestamp: Date },\n  props?: AICopilotProps\n): void {\n  const el = createElement('div', { className: `copilot-message ${message.role}` });\n  \n  if (message.role === 'user') {\n    el.innerHTML = `\n      <div class=\"message-content\">${escapeHtml(message.content)}</div>\n      <div class=\"message-avatar user-avatar\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"/>\n          <circle cx=\"12\" cy=\"7\" r=\"4\"/>\n        </svg>\n      </div>\n    `;\n  } else {\n    const meta = message.metadata;\n    \n    el.innerHTML = `\n      <div class=\"message-avatar\">\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n          <circle cx=\"12\" cy=\"12\" r=\"3\"/>\n        </svg>\n      </div>\n      <div class=\"message-content\">\n        <div class=\"message-text\">${formatMarkdown(message.content)}</div>\n        \n        ${meta?.reasoningChain?.length ? `\n          <div class=\"reasoning-chain\">\n            <button class=\"reasoning-toggle\" data-expanded=\"false\">\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <polyline points=\"9 18 15 12 9 6\"/>\n              </svg>\n              Reasoning Chain (${meta.reasoningChain.length} steps)\n            </button>\n            <div class=\"reasoning-steps hidden\">\n              ${meta.reasoningChain.map((step, i) => `\n                <div class=\"reasoning-step\">\n                  <div class=\"step-number\">${i + 1}</div>\n                  <div class=\"step-content\">\n                    <div class=\"step-name\">${escapeHtml(step.step)}</div>\n                    ${step.reasoning ? `<div class=\"step-reasoning\">${escapeHtml(step.reasoning)}</div>` : ''}\n                  </div>\n                </div>\n              `).join('')}\n            </div>\n          </div>\n        ` : ''}\n        \n        ${meta?.cypherGenerated ? `\n          <div class=\"cypher-preview\">\n            <button class=\"cypher-toggle\" data-expanded=\"false\">\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <polyline points=\"16 18 22 12 16 6\"/>\n                <polyline points=\"8 6 2 12 8 18\"/>\n              </svg>\n              Generated Cypher\n            </button>\n            <div class=\"cypher-code hidden\">\n              <pre><code>${escapeHtml(meta.cypherGenerated)}</code></pre>\n              <button class=\"cypher-run-btn\" title=\"Execute Query\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                  <polygon points=\"5 3 19 12 5 21 5 3\"/>\n                </svg>\n                Run\n              </button>\n            </div>\n          </div>\n        ` : ''}\n        \n        ${meta?.sources?.length ? `\n          <div class=\"message-sources\">\n            <span class=\"sources-label\">Sources:</span>\n            ${meta.sources.slice(0, 3).map(s => `\n              <span class=\"source-chip\">${s.type}</span>\n            `).join('')}\n            ${meta.sources.length > 3 ? `<span class=\"source-more\">+${meta.sources.length - 3} more</span>` : ''}\n          </div>\n        ` : ''}\n        \n        <div class=\"message-meta\">\n          <span class=\"meta-type\">${meta?.queryType || 'hybrid'}</span>\n          ${meta?.latencyMs ? `<span class=\"meta-latency\">${meta.latencyMs}ms</span>` : ''}\n          ${meta?.confidence ? `<span class=\"meta-confidence\">${Math.round(meta.confidence * 100)}% confident</span>` : ''}\n        </div>\n      </div>\n    `;\n\n    // Bind reasoning toggle\n    setTimeout(() => {\n      const reasoningToggle = el.querySelector('.reasoning-toggle');\n      if (reasoningToggle) {\n        on(reasoningToggle as HTMLElement, 'click', () => {\n          const steps = el.querySelector('.reasoning-steps');\n          const expanded = reasoningToggle.getAttribute('data-expanded') === 'true';\n          reasoningToggle.setAttribute('data-expanded', String(!expanded));\n          steps?.classList.toggle('hidden');\n          const icon = reasoningToggle.querySelector('svg');\n          if (icon) icon.style.transform = expanded ? '' : 'rotate(90deg)';\n        });\n      }\n\n      const cypherToggle = el.querySelector('.cypher-toggle');\n      if (cypherToggle) {\n        on(cypherToggle as HTMLElement, 'click', () => {\n          const code = el.querySelector('.cypher-code');\n          const expanded = cypherToggle.getAttribute('data-expanded') === 'true';\n          cypherToggle.setAttribute('data-expanded', String(!expanded));\n          code?.classList.toggle('hidden');\n        });\n      }\n\n      const cypherRunBtn = el.querySelector('.cypher-run-btn');\n      if (cypherRunBtn && meta?.cypherGenerated && props?.onExecuteQuery) {\n        on(cypherRunBtn as HTMLElement, 'click', () => {\n          props.onExecuteQuery!(meta.cypherGenerated!);\n          toast.info('Executing query...');\n        });\n      }\n    }, 0);\n  }\n\n  container.appendChild(el);\n}\n\n/**\n * Toggle voice input\n */\nfunction toggleVoiceInput(container: HTMLElement, state: CopilotState, inputEl: HTMLTextAreaElement): void {\n  if (!isVoiceSupported()) {\n    toast.error('Voice input not supported in this browser');\n    return;\n  }\n\n  const voiceBtn = container.querySelector('#copilot-voice') as HTMLElement;\n  \n  if (state.isRecording) {\n    // Stop recording\n    state.isRecording = false;\n    voiceBtn.classList.remove('recording');\n    // Recognition will be stopped by the recognition object\n  } else {\n    // Start recording\n    state.isRecording = true;\n    voiceBtn.classList.add('recording');\n\n    const SpeechRecognition = (window as unknown as { SpeechRecognition?: new () => SpeechRecognition; webkitSpeechRecognition?: new () => SpeechRecognition }).SpeechRecognition || \n                              (window as unknown as { webkitSpeechRecognition?: new () => SpeechRecognition }).webkitSpeechRecognition;\n    \n    if (!SpeechRecognition) {\n      toast.error('Speech recognition not available');\n      state.isRecording = false;\n      voiceBtn.classList.remove('recording');\n      return;\n    }\n\n    const recognition = new SpeechRecognition();\n    recognition.continuous = false;\n    recognition.interimResults = true;\n    recognition.lang = 'pt-PT'; // Portuguese, change as needed\n\n    recognition.onresult = (event: SpeechRecognitionEvent) => {\n      const transcript = Array.from(event.results)\n        .map(result => result[0].transcript)\n        .join('');\n      inputEl.value = transcript;\n      inputEl.style.height = 'auto';\n      inputEl.style.height = Math.min(inputEl.scrollHeight, 120) + 'px';\n    };\n\n    recognition.onend = () => {\n      state.isRecording = false;\n      voiceBtn.classList.remove('recording');\n    };\n\n    recognition.onerror = (event: SpeechRecognitionErrorEvent) => {\n      console.error('Speech recognition error:', event.error);\n      state.isRecording = false;\n      voiceBtn.classList.remove('recording');\n      if (event.error !== 'aborted') {\n        toast.error('Voice recognition failed');\n      }\n    };\n\n    recognition.start();\n  }\n}\n\n/**\n * Check if voice is supported\n */\nfunction isVoiceSupported(): boolean {\n  return !!(\n    (window as unknown as { SpeechRecognition?: unknown }).SpeechRecognition || \n    (window as unknown as { webkitSpeechRecognition?: unknown }).webkitSpeechRecognition\n  );\n}\n\n/**\n * Show chat history\n */\nasync function showChatHistory(container: HTMLElement): Promise<void> {\n  try {\n    const sessions = await graphService.getChatSessions();\n    \n    if (sessions.length === 0) {\n      toast.info('No chat history found');\n      return;\n    }\n\n    // TODO: Show history modal\n    toast.info(`${sessions.length} previous sessions found`);\n  } catch {\n    toast.error('Failed to load chat history');\n  }\n}\n\n/**\n * Load session\n */\nfunction loadSession(state: CopilotState): void {\n  // Could load from localStorage for quick resume\n  const saved = localStorage.getItem('copilot_session');\n  if (saved) {\n    try {\n      const data = JSON.parse(saved);\n      if (data.sessionId && data.messages) {\n        state.sessionId = data.sessionId;\n        // Don't restore messages for now, start fresh\n      }\n    } catch {\n      // Ignore\n    }\n  }\n}\n\n/**\n * Save message to Supabase\n */\nasync function saveMessage(\n  state: CopilotState,\n  message: { role: 'user' | 'assistant' | 'system'; content: string; metadata?: GraphRAGResponse }\n): Promise<void> {\n  try {\n    await graphService.saveChatMessage({\n      session_id: state.sessionId,\n      role: message.role,\n      content: message.content,\n      metadata: message.metadata ? {\n        queryType: message.metadata.queryType,\n        cypherGenerated: message.metadata.cypherGenerated,\n        sources: message.metadata.sources,\n        reasoningChain: message.metadata.reasoningChain,\n        highlightedNodes: message.metadata.highlightedNodes,\n        executionTimeMs: message.metadata.latencyMs,\n        confidence: message.metadata.confidence,\n      } : undefined,\n      is_pinned: false,\n    });\n  } catch {\n    // Silent fail - don't interrupt UX\n  }\n}\n\n/**\n * Get welcome HTML\n */\nfunction getWelcomeHTML(): string {\n  return `\n    <div class=\"copilot-welcome\">\n      <div class=\"welcome-icon\">\n        <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n          <path d=\"M12 2a10 10 0 0 1 10 10c0 5.5-4.5 10-10 10S2 17.5 2 12 6.5 2 12 2\"/>\n          <circle cx=\"12\" cy=\"12\" r=\"3\"/>\n        </svg>\n      </div>\n      <h3>Hello! I'm your AI assistant.</h3>\n      <p>Ask me anything about your knowledge graph.</p>\n    </div>\n  `;\n}\n\n/**\n * Scroll to bottom\n */\nfunction scrollToBottom(container: HTMLElement): void {\n  container.scrollTop = container.scrollHeight;\n}\n\n/**\n * Format markdown (basic)\n */\nfunction formatMarkdown(text: string): string {\n  return escapeHtml(text)\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n    .replace(/`(.*?)`/g, '<code>$1</code>')\n    .replace(/\\n/g, '<br>');\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n// TypeScript interfaces for Web Speech API\ninterface SpeechRecognition extends EventTarget {\n  continuous: boolean;\n  interimResults: boolean;\n  lang: string;\n  start(): void;\n  stop(): void;\n  onresult: (event: SpeechRecognitionEvent) => void;\n  onend: () => void;\n  onerror: (event: SpeechRecognitionErrorEvent) => void;\n}\n\ninterface SpeechRecognitionEvent {\n  results: SpeechRecognitionResultList;\n}\n\ninterface SpeechRecognitionResultList {\n  length: number;\n  [index: number]: SpeechRecognitionResult;\n}\n\ninterface SpeechRecognitionResult {\n  [index: number]: SpeechRecognitionAlternative;\n  isFinal: boolean;\n}\n\ninterface SpeechRecognitionAlternative {\n  transcript: string;\n  confidence: number;\n}\n\ninterface SpeechRecognitionErrorEvent {\n  error: string;\n}\n\nexport default createAICopilot;\n"],"names":["createAICopilot","props","state","container","createElement","isVoiceSupported","initCopilot","messagesEl","inputEl","sendBtn","voiceBtn","clearBtn","closeBtn","historyBtn","sendMessage","query","processQuery","on","e","event","toggleVoiceInput","getWelcomeHTML","showChatHistory","chip","loadSession","suggestionsEl","welcome","userMessage","appendMessage","loadingEl","scrollToBottom","response","graphService","assistantMessage","saveMessage","errorMessage","message","el","escapeHtml","meta","formatMarkdown","step","i","reasoningToggle","steps","expanded","icon","cypherToggle","code","cypherRunBtn","toast","SpeechRecognition","recognition","transcript","result","sessions","saved","data","text","div"],"mappings":"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"}