{"version":3,"mappings":"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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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AAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,YAilBZmqC,EACE,aAAa9sB,CAAQ,YACrB,SAASjb,CAAQ,SACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,IAiyBlBvE,GAAWuE,EAAOxd,CAAK,EAGvBsW,GAAakH,EAAOxd,CAAK,EACzBg7C,GAAgBx9B,CAAK,EAEdA,CACT,CAKA,SAASvE,GAAWuE,EAAoBxd,EAAiC,CAEvE,MAAM0c,EAAcc,EAAM,cAAc,kBAAkB,EAC1D,IAAIwM,EACJ5rB,EAAGse,EAAa,QAAS,IAAM,CAC7B,aAAasN,CAAa,EAC1BA,EAAgB,OAAO,WAAW,IAAM,CACtCJ,GAAgBlN,EAAY,MAC5BpG,GAAakH,EAAOxd,CAAK,CAC3B,EAAG,GAAG,CACR,CAAC,EAGD,MAAMi7C,EAAYz9B,EAAM,cAAc,aAAa,EACnDpf,EAAG68C,EAAW,SAAU,IAAM,CAC5B96B,GAAc,aAAe86B,EAAU,OAAS,OAChD3kC,GAAakH,EAAOxd,CAAK,CAC3B,CAAC,EAGD,MAAMk7C,EAAY19B,EAAM,cAAc,aAAa,EACnDpf,EAAG88C,EAAW,SAAU,IAAM,CAC5B/6B,GAAc,IAAM+6B,EAAU,OAAS,OACvC5kC,GAAakH,EAAOxd,CAAK,CAC3B,CAAC,EAGD,MAAMm7C,EAAgB39B,EAAM,cAAc,mBAAmB,EACzD29B,GACF/8C,EAAG+8C,EAA8B,QAAS,IAAM,CAC9CA,EAAc,UAAU,OAAO,QAAQ,EACvCh7B,GAAc,UAAYg7B,EAAc,UAAU,SAAS,QAAQ,EACnE7kC,GAAakH,EAAOxd,CAAK,CAC3B,CAAC,EAIH,MAAMygB,EAASjD,EAAM,cAAc,kBAAkB,EACjDiD,GACFriB,EAAGqiB,EAAuB,QAAS,IAAM,CACvC+nB,GAAiB,CACf,KAAM,SACN,OAAQ,IAAMlyB,GAAakH,EAAOxd,CAAK,EACxC,CACH,CAAC,EAIH,MAAM27B,EAAYne,EAAM,cAAc,sBAAsB,EACxDme,GACFv9B,EAAGu9B,EAA0B,QAAS,IAAMxwC,GAAA,CAAgB,EAI9D,MAAMiwD,EAAY59B,EAAM,cAAc,sBAAsB,EACxD49B,GACFh9C,EAAGg9C,EAA0B,QAAS,IAAM,CAC1C9gE,EAAM,KAAK,kCAAkC,CAC/C,CAAC,CAEL,CAKA,eAAeg8B,GAAakH,EAAoBxd,EAA2C,CACzF,MAAMnX,EAAU20B,EAAM,cAAc,mBAAmB,EACvD30B,EAAQ,UAAY,uDAEpB,GAAI,CACF,KAAM,CAAE,SAAA5G,EAAU,MAAAmuB,CAAA,EAAU,MAAM/jB,GAAgB,OAAO,CACvD,OAAQu9B,IAAiB,OACzB,aAAczJ,GAAc,aAC5B,IAAKA,GAAc,IACpB,EAGD,IAAIk7B,EAAmBp5D,EACnBk+B,GAAc,YAChBk7B,EAAmBp5D,EAAS,OAAOsI,GAAKA,EAAE,UAAU,GAGtDswD,GAAc54D,EAEdq5D,GAAezyD,EAASwyD,EAAkBr7C,CAAK,EAC/Cu7C,GAAgB/9B,EAAOv7B,EAAS,UAAYsI,EAAE,UAAU,EAAGyV,CAAK,EAChE4gB,GAAYpD,EAAOpN,CAAK,EACxBorC,GAAch+B,EAAOv7B,CAAQ,CAC/B,MAAQ,CACN4G,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAStB,CACF,CAKA,SAASyyD,GAAe58C,EAAwBzc,EAAqB+d,EAAkC,CACrG,GAAI/d,EAAS,SAAW,EAAG,CACzByc,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,cAKZkrB,GAAgB,gCAAkC,iBAAiB;AAAA,aACpEA,GAAgB,8BAAgC,uCAAuC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAUhG,MAAMnJ,EAAS/hB,EAAU,cAAc,gBAAgB,EACnD+hB,GACFriB,EAAGqiB,EAAuB,QAAS,IAAM,CACvC+nB,GAAiB,CAAE,KAAM,SAAU,CACrC,CAAC,EAEH,MACF,CAEA9pC,EAAU,UAAY;AAAA;AAAA,QAEhBzc,EAAS,IAAI0oB,GAAW8wC,GAAkB9wC,CAAO,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,IAIlE+wC,GAAsBh9C,EAAWzc,EAAU+d,CAAK,CAClD,CAKA,SAASy7C,GAAkB9wC,EAA0B,CACnD,MAAM7J,EAAW2E,GAAYkF,EAAQ,IAAI,EACnCk+B,EAAW,CAAC,EAAEl+B,EAAQ,UAAYA,EAAQ,WAC1CoR,EAAWpR,EAAQ,UAAYA,EAAQ,UACvC84B,EAAaqX,GAAmB,IAAInwC,EAAQ,EAAE,EAEpD,MAAO;AAAA,oCAC2B84B,EAAa,WAAa,EAAE,cAAc94B,EAAQ,EAAE;AAAA,4CAC5C84B,EAAa,UAAY,EAAE,mCAAmC94B,EAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDAMjEA,EAAQ,WAAa,SAAW,EAAE,qCAAqCA,EAAQ,EAAE;AAAA,uBAC7GA,EAAQ,WAAa,eAAiB,MAAM;AAAA;AAAA;AAAA;AAAA,uEAIIA,EAAQ,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,YASrEk+B,EACE,aAAa9sB,CAAQ,UAAUrW,GAAWiF,EAAQ,IAAI,CAAC,KACvD7J,CACJ;AAAA;AAAA;AAAA,0CAGgC4E,GAAWiF,EAAQ,IAAI,CAAC;AAAA,YACtDA,EAAQ,KAAO,oCAAoCjF,GAAWiF,EAAQ,IAAI,CAAC,UAAY,EAAE;AAAA,YACzFA,EAAQ,aAAe;AAAA;AAAA;AAAA;AAAA;AAAA,gBAKnBjF,GAAWiF,EAAQ,YAAY,CAAC;AAAA;AAAA,YAElC,EAAE;AAAA;AAAA;;AAAA;AAAA,UAKNA,EAAQ,MAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,oBAKNjF,GAAWiF,EAAQ,KAAK,CAAC;AAAA;AAAA,UAEjC,EAAE;AAAA,UACJA,EAAQ,MAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,oBAKNjF,GAAWiF,EAAQ,KAAK,CAAC;AAAA;AAAA,UAEjC,EAAE;AAAA;;AAAA,QAGNA,EAAQ,MAAQA,EAAQ,KAAK,OAAS,EAAI;AAAA;AAAA,YAEtCA,EAAQ,KAAK,MAAM,EAAG,CAAC,EAAE,IAAI3M,GAAO,6BAA6B0H,GAAW1H,CAAG,CAAC,SAAS,EAAE,KAAK,EAAE,CAAC;AAAA,YACnG2M,EAAQ,KAAK,OAAS,EAAI,8BAA8BA,EAAQ,KAAK,OAAS,CAAC,UAAY,EAAE;AAAA;AAAA,QAE/F,EAAE;AAAA;AAAA,GAGZ,CAKA,SAAS+wC,GAAsBh9C,EAAwBzc,EAAqB+d,EAAkC,CAC5G,MAAMwd,EAAQ9e,EAAU,QAAQ,sBAAsB,EAGtDA,EAAU,iBAAiB,0BAA0B,EAAE,QAAQqH,GAAY,CACzE3H,EAAG2H,EAAyB,QAAUnZ,GAAM,CAC1CA,EAAE,kBACF,MAAM/J,EAAKkjB,EAAS,aAAa,SAAS,EAC1C,GAAI,CAACljB,EAAI,OAET,MAAMqkB,EAAOnB,EAAS,QAAQ,oBAAoB,EAE9C+0C,GAAmB,IAAIj4D,CAAE,GAC3Bi4D,GAAmB,OAAOj4D,CAAE,EAC5BkjB,EAAS,UAAU,OAAO,SAAS,EACnCmB,EAAK,UAAU,OAAO,UAAU,IAEhC4zC,GAAmB,IAAIj4D,CAAE,EACzBkjB,EAAS,UAAU,IAAI,SAAS,EAChCmB,EAAK,UAAU,IAAI,UAAU,GAG3BlH,GAAO27C,GAAmBn+B,EAAOv7B,EAAU+d,CAAK,CACtD,CAAC,CACH,CAAC,EAGDtB,EAAU,iBAAiB,oBAAoB,EAAE,QAAQwI,GAAQ,CAC/D9I,EAAG8I,EAAqB,QAAUta,GAAM,CAGtC,GADKA,EAAE,OAAuB,QAAQ,mBAAmB,GACpDA,EAAE,OAAuB,QAAQ,0BAA0B,EAAG,OAEnE,MAAM/J,EAAKqkB,EAAK,aAAa,SAAS,EAChCyD,EAAU1oB,EAAS,KAAK,GAAK,OAAO,EAAE,EAAE,IAAMY,CAAE,EAClD8nB,IACE3K,GAAO,eACTA,EAAM,eAAe2K,CAAO,EAE5B69B,GAAiB,CACf,KAAM,OACN,QAAA79B,EACA,OAAQ,IAAM2L,GAAakH,EAAOxd,CAAK,EACxC,EAGP,CAAC,CACH,CAAC,EAGDtB,EAAU,iBAAiB,mBAAmB,EAAE,QAAQuD,GAAO,CAC7D7D,EAAG6D,EAAoB,QAAS,MAAOrV,GAAM,CAC3CA,EAAE,kBACF,MAAMxO,EAAS6jB,EAAI,aAAa,aAAa,EACvCpf,EAAKof,EAAI,aAAa,SAAS,EAC/B0I,EAAU1oB,EAAS,KAAKsI,GAAK,OAAOA,EAAE,EAAE,IAAM1H,CAAE,EAEjD8nB,IAEDvsB,IAAW,WACT4hB,GAAO,MAAM47C,GAAejxC,EAAS1I,EAAoBub,EAAOxd,CAAK,EAChE5hB,IAAW,QACpBoqD,GAAiB,CACf,KAAM,OACN,QAAA79B,EACA,OAAQ,IAAM2L,GAAakH,EAAOxd,CAAK,EACxC,EAEL,CAAC,CACH,CAAC,CACH,CAKA,SAAS27C,GAAmBn+B,EAAoBv7B,EAAqB+d,EAAiC,CAEpG,MAAM67C,EAAc,SAAS,cAAc,gBAAgB,EAG3D,GAFIA,KAAyB,SAEzBf,GAAmB,KAAO,EAAG,OAGjC,MAAMjY,EAAM9kC,EAAc,MAAO,CAAE,UAAW,gBAAiB,EAC/D8kC,EAAI,UAAY;AAAA,8CAC4BiY,GAAmB,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAenE,SAAS,KAAK,YAAYjY,CAAG,EAG7B,MAAMiZ,EAAWjZ,EAAI,cAAc,qBAAqB,EAClDt+B,EAAYs+B,EAAI,cAAc,uBAAuB,EAE3DzkC,EAAGmG,EAA0B,QAAS,IAAM,CAC1Cw+B,GAAevlB,CAAK,CACtB,CAAC,EAEDpf,EAAG09C,EAAyB,QAAS,SAAY,CAC/C,MAAM3tD,EAAM,MAAM,KAAK2sD,EAAkB,EAGnCiB,EAAmB95D,EAAS,OAAOsI,GAAKuwD,GAAmB,IAAIvwD,EAAE,EAAE,CAAC,EAG1E,GADkB,MAAMyxD,GAAsBD,CAAgB,EAK7D,CAAAD,EAA+B,SAAW,GAC1CA,EAA+B,YAAc,aAE9C,GAAI,CACF,MAAMzvD,GAAgB,cAAc8B,CAAG,EACvC7T,EAAM,QAAQ,UAAU6T,EAAI,MAAM,wBAAwB,EAC1D40C,GAAevlB,CAAK,EACpB,MAAMlH,GAAakH,EAAOxd,CAAK,CACjC,OAASxlB,EAAO,CACd,MAAMN,EAAUM,aAAiB,MAAQA,EAAM,QAAU,2BACzDF,EAAM,MAAMJ,CAAO,EAClB4hE,EAA+B,SAAW,GAC1CA,EAA+B,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,OAM9C,EACF,CAAC,CACH,CAKA,SAASE,GAAsB/5D,EAAuC,CACpE,OAAO,IAAI,QAAS7F,GAAY,CAC9B,MAAM6tB,EAAUlM,EAAc,MAAO,CAAE,UAAW,wBAAyB,EAEpD9b,EAAS,CAAC,EACXA,EAAS,MAAM,CAAC,EAEtCgoB,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAgOVhoB,EAAS,IAAI,CAACsI,EAAG6iB,IAAM,CACvB,MAAMi+B,EAAS9gD,EAAE,UAAYA,EAAE,WAAaA,EAAE,WAAaA,EAAE,WACvDuW,GAAYvW,EAAE,MAAQ,KAAK,MAAM,GAAG,EAAE,IAAIwW,GAAKA,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,UAAU,EAAG,CAAC,EAAE,cAC9Ek7C,EAAS1xD,EAAE,OAASA,EAAE,cAAgBA,EAAE,SAAW,GAEzD,MAAO;AAAA,iDAC4B6iB,IAAM,EAAI,UAAY,EAAE;AAAA;AAAA,sBAEnDi+B,EAAS,aAAaA,CAAM,UAAU9gD,EAAE,IAAI,KAAOuW,CAAQ;AAAA;AAAA;AAAA,sDAG3BvW,EAAE,MAAQ,SAAS;AAAA,yDAChB0xD,CAAM;AAAA;AAAA,oBAE3C7uC,IAAM,EAAI,mDAAqD,EAAE;AAAA;AAAA,eAGzE,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MA4BnB,SAAS,KAAK,YAAYnD,CAAO,EAEjC,MAAM1F,EAAY0F,EAAQ,cAAc,mBAAmB,EACrDzF,EAAayF,EAAQ,cAAc,oBAAoB,EAEvDiyC,EAASlgE,GAAoB,CACjCiuB,EAAQ,SACR7tB,EAAQJ,CAAM,CAChB,EAEAoiB,EAAGmG,EAA0B,QAAS,IAAM23C,EAAM,EAAK,CAAC,EACxD99C,EAAGoG,EAA2B,QAAS,IAAM03C,EAAM,EAAI,CAAC,EACxD99C,EAAG6L,EAAS,QAAUrd,GAAM,CACtBA,EAAE,SAAWqd,GAASiyC,EAAM,EAAK,CACvC,CAAC,EAGD,MAAMtE,EAAahrD,GAAqB,CAClCA,EAAE,MAAQ,WACZ,SAAS,oBAAoB,UAAWgrD,CAAS,EACjDsE,EAAM,EAAK,EAEf,EACA,SAAS,iBAAiB,UAAWtE,CAAS,CAChD,CAAC,CACH,CAKA,SAAS7U,GAAevlB,EAA0B,CAChDs9B,GAAmB,QAGnBt9B,EAAM,iBAAiB,6BAA6B,EAAE,QAAQtW,GAAQ,CACpEA,EAAK,UAAU,OAAO,UAAU,CAClC,CAAC,EACDsW,EAAM,iBAAiB,kCAAkC,EAAE,QAAQzX,GAAY,CAC7EA,EAAS,UAAU,OAAO,SAAS,CACrC,CAAC,EAGD,MAAM88B,EAAM,SAAS,cAAc,gBAAgB,EAC/CA,KAAS,QACf,CAKA,eAAe+Y,GAAejxC,EAAkB1I,EAAkBub,EAAoBxd,EAA0C,CAC9H,MAAMm8C,EAAW,CAACxxC,EAAQ,WAE1B,GAAI,CACF,MAAMpuB,EAAK,IAAI,iBAAiBouB,EAAQ,EAAE,GAAI,CAAE,YAAawxC,EAAU,EACvExxC,EAAQ,WAAawxC,EAGrBl6C,EAAI,UAAU,OAAO,SAAUk6C,CAAQ,EACvC,MAAMC,EAAMn6C,EAAI,cAAc,KAAK,EAC/Bm6C,GACFA,EAAI,aAAa,OAAQD,EAAW,eAAiB,MAAM,EAI7DZ,GAAgB/9B,EAAOq9B,GAAY,OAAOtwD,GAAKA,EAAE,YAAeA,EAAE,KAAOogB,EAAQ,IAAMwxC,CAAS,EAAGn8C,CAAK,EAExG1lB,EAAM,QAAQ6hE,EAAW,qBAAuB,wBAAwB,CAC1E,MAAQ,CACN7hE,EAAM,MAAM,2BAA2B,CACzC,CACF,CAKA,SAASihE,GAAgB/9B,EAAoB6+B,EAAsBr8C,EAAkC,CACnG,MAAMuI,EAAUiV,EAAM,cAAc,oBAAoB,EAClDkY,EAAOlY,EAAM,cAAc,iBAAiB,EAElD,GAAI6+B,EAAU,SAAW,EAAG,CAC1B9zC,EAAQ,MAAM,QAAU,OACxB,MACF,CAEAA,EAAQ,MAAM,QAAU,QACxBmtB,EAAK,UAAY2mB,EAAU,IAAI1xC,GAAW,CACxC,MAAM7J,EAAW2E,GAAYkF,EAAQ,IAAI,EACnCk+B,EAAW,CAAC,EAAEl+B,EAAQ,UAAYA,EAAQ,WAC1CoR,EAAWpR,EAAQ,UAAYA,EAAQ,UAE7C,MAAO;AAAA,4CACiCA,EAAQ,EAAE;AAAA;AAAA,YAE1Ck+B,EACE,aAAa9sB,CAAQ,UAAUrW,GAAWiF,EAAQ,IAAI,CAAC,KACvD7J,CACJ;AAAA;AAAA;AAAA,gBAGM4E,GAAWiF,EAAQ,IAAI,CAAC;AAAA,YAC5BA,EAAQ,aAAe,MAAMjF,GAAWiF,EAAQ,YAAY,CAAC,OAAS,EAAE;AAAA;AAAA;AAAA,KAIlF,CAAC,EAAE,KAAK,EAAE,EAGV+qB,EAAK,iBAAiB,gBAAgB,EAAE,QAAQxuB,GAAQ,CACtD9I,EAAG8I,EAAqB,QAAS,IAAM,CACrC,MAAMrkB,EAAKqkB,EAAK,aAAa,SAAS,EAChCyD,EAAU0xC,EAAU,KAAK,GAAK,OAAO,EAAE,EAAE,IAAMx5D,CAAE,EACnD8nB,GACF69B,GAAiB,CACf,KAAM,OACN,QAAA79B,EACA,OAAQ,IAAM2L,GAAakH,EAAOxd,CAAK,EACxC,CAEL,CAAC,CACH,CAAC,CACH,CAKA,eAAeg7C,GAAgBx9B,EAAmC,CAChE,MAAM8+B,EAAkB9+B,EAAM,cAAc,kBAAkB,EAE9D,GAAI,CACF,KAAM,CAAE,WAAA++B,CAAA,EAAe,MAAMlwD,GAAgB,gBAE7C,GAAIkwD,EAAW,OAAS,EAAG,CACzBD,EAAgB,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,0BAKRC,EAAW,MAAM;AAAA;AAAA;AAAA,QAKrC,MAAMC,EAAYF,EAAgB,cAAc,wBAAwB,EACpEE,GACFp+C,EAAGo+C,EAA0B,QAAS,IAAM,CAC1CC,GAA0BF,EAAY/+B,CAAK,CAC7C,CAAC,CAEL,CACF,MAAQ,CAER,CACF,CAKA,SAASi/B,GAA0BC,EAA8Bl/B,EAA0B,CAEzF,MAAMvT,EAAUlM,EAAc,MAAO,CAAE,UAAW,4BAA6B,EAE/EkM,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UA2QZyyC,EAAgB,SAAW,EAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAO7BA,EAAgB,IAAI,CAACvO,EAAOwO,IAAe;AAAA,2DACIA,CAAU;AAAA;AAAA,0CAE3BxO,EAAM,MAAM;AAAA,kEACYwO,CAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAQ5DxO,EAAM,IAAI,CAACxjC,EAASgM,IAAQ;AAAA;AAAA,sDAEUgmC,CAAU,YAAYhyC,EAAQ,EAAE,KAAKgM,IAAQ,EAAI,UAAY,EAAE;AAAA,kDACnElR,GAAYkF,EAAQ,IAAI,CAAC;AAAA;AAAA,0BAEjDjF,GAAWiF,EAAQ,IAAI,CAAC,GAAGgM,IAAQ,EAAI,aAAe,EAAE;AAAA,yBACzDjR,GAAWiF,EAAQ,OAAS,EAAE,CAAC,GAAGA,EAAQ,aAAe,MAAMjF,GAAWiF,EAAQ,YAAY,CAAC,GAAK,EAAE;AAAA,sBACxGA,EAAQ,SAAWA,EAAQ,QAAQ,OAAS,EAAK;AAAA;AAAA,0BAE9CA,EAAQ,QAAQ,IAAIiyC,GAAS,2BAA2Bl3C,GAAWk3C,CAAK,CAAC,SAAS,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,sBAE9F,EAAE;AAAA;AAAA;AAAA,eAGX,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,SAGhB,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IASjB,SAAS,KAAK,YAAY3yC,CAAO,EAGjC,MAAM4yC,EAAe,IAAM5yC,EAAQ,SAE7BjI,EAAWiI,EAAQ,cAAc,uBAAuB,EACxD6yC,EAAiB7yC,EAAQ,cAAc,mBAAmB,EAE5DjI,GAAU5D,EAAG4D,EAAyB,QAAS66C,CAAY,EAC3DC,GAAgB1+C,EAAG0+C,EAA+B,QAASD,CAAY,EAC3Ez+C,EAAG6L,EAAS,QAAUrd,GAAa,CAC7BA,EAAE,SAAWqd,GAAS4yC,EAAA,CAC5B,CAAC,EAGD5yC,EAAQ,iBAAiB,kBAAkB,EAAE,QAAQhI,GAAO,CAC1D7D,EAAG6D,EAAoB,QAAS,SAAY,CAC1C,MAAM06C,EAAa,SAAS16C,EAAI,aAAa,kBAAkB,GAAK,GAAG,EACjEksC,EAAQuO,EAAgBC,CAAU,EAExC,GAAI,CAACxO,GAASA,EAAM,OAAS,EAAG,OAIhC,MAAM4O,EADgB9yC,EAAQ,cAAc,uBAAuB0yC,CAAU,YAAY,GACxD,OAASxO,EAAM,CAAC,EAAE,GAG7C6O,EAAa,CAACD,EAAW,GAAG5O,EAAM,OAAO5jD,GAAKA,EAAE,KAAOwyD,CAAS,EAAE,IAAIxyD,GAAKA,EAAE,EAAE,CAAC,EAErF0X,EAA0B,SAAW,GACrCA,EAA0B,YAAc,aAEzC,GAAI,CACF,MAAM5V,GAAgB,cAAc2wD,CAAU,EAC9C1iE,EAAM,QAAQ,UAAU6zD,EAAM,MAAM,wBAAwB,EAG5D,MAAM8O,EAAUhzC,EAAQ,cAAc,sCAAsC0yC,CAAU,IAAI,EAK1F,GAJIM,KAAiB,SAGGhzC,EAAQ,iBAAiB,kBAAkB,EAC/C,SAAW,EAAG,CAChC,MAAMphB,EAAUohB,EAAQ,cAAc,qBAAqB,EACvDphB,IACFA,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cASxB,CAGA,MAAMytB,GAAakH,CAAK,CAE1B,OAAShjC,EAAO,CACd,MAAMN,EAAUM,aAAiB,MAAQA,EAAM,QAAU,2BACzDF,EAAM,MAAMJ,CAAO,EAClB+nB,EAA0B,SAAW,GACrCA,EAA0B,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,SAMzC,CACF,CAAC,CACH,CAAC,CACH,CAKA,SAASu5C,GAAch+B,EAAoBv7B,EAA2B,CAEpE,MAAMg5D,EAAYz9B,EAAM,cAAc,aAAa,EAC7C0/B,EAAO,CAAC,GAAG,IAAI,IAAIj7D,EAAS,IAAIsI,GAAKA,EAAE,YAAY,EAAE,OAAO,OAAO,CAAC,CAAC,EAAE,OAEvE4yD,EAAalC,EAAU,MAC7BA,EAAU,UAAY;AAAA;AAAA,MAElBiC,EAAK,IAAIE,GAAO,kBAAkB13C,GAAW03C,CAAI,CAAC,KAAKD,IAAeC,EAAM,WAAa,EAAE,IAAI13C,GAAW03C,CAAI,CAAC,WAAW,EAAE,KAAK,EAAE,CAAC;AAAA,IAIxI,MAAMlC,EAAY19B,EAAM,cAAc,aAAa,EAC7C6/B,EAAUp7D,EAAS,WAAasI,EAAE,MAAQ,EAAE,EAC5C+yD,EAAa,CAAC,GAAG,IAAI,IAAID,CAAO,CAAC,EAAE,OAEnCE,EAAarC,EAAU,MAC7BA,EAAU,UAAY;AAAA;AAAA,MAElBoC,EAAW,IAAIt/C,GAAO,kBAAkB0H,GAAW1H,CAAG,CAAC,KAAKu/C,IAAev/C,EAAM,WAAa,EAAE,IAAI0H,GAAW1H,CAAG,CAAC,WAAW,EAAE,KAAK,EAAE,CAAC;AAAA,GAE9I,CAKA,eAAe7S,IAAgC,CAC7C,GAAI,CACF,MAAMkB,GAAgB,OAAO,MAAM,EACnC/R,EAAM,QAAQ,mBAAmB,CACnC,MAAQ,CACNA,EAAM,MAAM,2BAA2B,CACzC,CACF,CAKA,SAASsmC,GAAYpD,EAAoBnb,EAAqB,CAC5D,MAAMshB,EAAUnG,EAAM,cAAc,iBAAiB,EACjDmG,IAASA,EAAQ,YAAc,OAAOthB,CAAK,EACjD,CAKA,SAASoD,GAAY3a,EAAsB,CACzC,OAAOA,EACJ,MAAM,GAAG,EACT,OAASiW,EAAE,CAAC,CAAC,EACb,KAAK,EAAE,EACP,cACA,MAAM,EAAG,CAAC,CACf,CAKA,SAAS2E,GAAW5X,EAAsB,CACxC,MAAMyY,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAczY,EACXyY,EAAI,SACb,4HC9hEO,SAASi3C,GAAiBx9C,EAAyB,GAAiB,CACzE,MAAMwd,EAAQzf,EAAc,MAAO,CAAE,UAAW,cAAe,EAE/Dyf,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAgBlB,MAAMiD,EAASjD,EAAM,cAAc,eAAe,EAClD,OAAIiD,GACFriB,EAAGqiB,EAAuB,QAAS,IAAM,CACvCyrB,GAAc,CACZ,KAAM,SACN,OAAQ,IAAMuR,GAAUjgC,EAAOxd,CAAK,EACrC,CACH,CAAC,EAIHy9C,GAAUjgC,EAAOxd,CAAK,EAEfwd,CACT,CAKA,eAAeigC,GAAUjgC,EAAoBxd,EAAuC,CAClF,MAAMnX,EAAU20B,EAAM,cAAc,gBAAgB,EACpD30B,EAAQ,UAAY,wCAEpB,GAAI,CACF,MAAM60D,EAAQ,MAAMpxD,GAAa,SACjCqxD,GAAY90D,EAAS60D,EAAO19C,CAAK,EACjC4gB,GAAYpD,EAAOkgC,EAAM,MAAM,CACjC,MAAQ,CACN70D,EAAQ,UAAY,+CACtB,CACF,CAKA,SAAS80D,GAAYj/C,EAAwBg/C,EAAe19C,EAA8B,CACxF,GAAI09C,EAAM,SAAW,EAAG,CACtBh/C,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA,MAMtB,MAAM+hB,EAAS/hB,EAAU,cAAc,gBAAgB,EACnD+hB,GACFriB,EAAGqiB,EAAuB,QAAS,IAAM,CACvCyrB,GAAc,CAAE,KAAM,SAAU,CAClC,CAAC,EAEH,MACF,CAEAxtC,EAAU,UAAY;AAAA;AAAA,QAEhBg/C,EAAM,IAAIE,GAAQC,GAAeD,CAAI,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,IAKtDl/C,EAAU,iBAAiB,YAAY,EAAE,QAAQwI,GAAQ,CACvD9I,EAAG8I,EAAqB,QAAS,IAAM,CACrC,MAAMrkB,EAAKqkB,EAAK,aAAa,SAAS,EAChC02C,EAAOF,EAAM,KAAKp1C,GAAK,OAAOA,EAAE,EAAE,IAAMzlB,CAAE,EAC5C+6D,IACE59C,EAAM,YACRA,EAAM,YAAY49C,CAAI,EAEtB1R,GAAc,CACZ,KAAM,OACN,KAAA0R,EACA,OAAQ,IAAMH,GAAUv2C,EAAK,QAAQ,cAAc,EAAkBlH,CAAK,EAC3E,EAGP,CAAC,CACH,CAAC,CACH,CAKA,SAAS69C,GAAeD,EAAoB,CAC1C,MAAME,EAAcF,EAAK,aAAe,EAClCG,EAAaH,EAAK,eAAe,KAAKn0D,GAAKA,EAAE,MAAM,EAEzD,MAAO;AAAA,sCAC6Bm0D,EAAK,EAAE;AAAA;AAAA,qDAEQA,EAAK,OAAS,SAAS;AAAA,iCAC3Cl4C,GAAWk4C,EAAK,IAAI,CAAC;AAAA,UAC5CA,EAAK,UAAY,2BAA2BA,EAAK,SAAS,UAAY,EAAE;AAAA;AAAA,QAE1EA,EAAK,YAAc,iCAAiCl4C,GAAWk4C,EAAK,WAAW,CAAC,SAAW,EAAE;AAAA;AAAA,qCAEhEE,CAAW,UAAUA,IAAgB,EAAI,IAAM,EAAE;AAAA,UAC5EC,EAAa,iCAAiCr4C,GAAWq4C,EAAW,IAAI,CAAC,UAAY,EAAE;AAAA;AAAA,QAEzFH,EAAK,eAAiBA,EAAK,cAAc,OAAS,EAAI;AAAA;AAAA,YAElDA,EAAK,cAAc,MAAM,EAAG,CAAC,EAAE,IAAI71C,GAAU;AAAA,gDACTrC,GAAWqC,EAAO,IAAI,CAAC;AAAA,gBACvDtC,GAAYsC,EAAO,IAAI,CAAC;AAAA;AAAA,WAE7B,EAAE,KAAK,EAAE,CAAC;AAAA,YACT61C,EAAK,cAAc,OAAS,EAAI,8BAA8BA,EAAK,cAAc,OAAS,CAAC,SAAW,EAAE;AAAA;AAAA,QAE1G,EAAE;AAAA;AAAA,GAGZ,CAKA,SAASh9B,GAAYpD,EAAoBnb,EAAqB,CAC5D,MAAMshB,EAAUnG,EAAM,cAAc,cAAc,EAC9CmG,IAASA,EAAQ,YAAc,OAAOthB,CAAK,EACjD,CAKA,SAASoD,GAAY3a,EAAsB,CACzC,OAAOA,EACJ,MAAM,GAAG,EACT,OAASiW,EAAE,CAAC,CAAC,EACb,KAAK,EAAE,EACP,cACA,MAAM,EAAG,CAAC,CACf,CAKA,SAAS2E,GAAW5X,EAAsB,CACxC,MAAMyY,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAczY,EACXyY,EAAI,SACb,yHC1IA,SAASy3C,IAA0K,CAEjL,OAAQ,OAAe,GACzB,CAKO,SAASC,GAAej+C,EAAuB,GAAiB,CACrE,MAAMtB,EAAYX,EAAc,MAAO,CAAE,UAAW,YAAa,EAEjEW,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAWtB,MAAMw7B,EAASx7B,EAAU,cAAc,gBAAgB,EACnDw7B,GACF97B,EAAG87B,EAAuB,QAAS,IAAM,CACtBx7B,EAA4D,UACpE,KACX,CAAC,EAGH,MAAMu7B,EAAav7B,EAAU,cAAc,oBAAoB,EAC/D,OAAIu7B,GACF77B,EAAG67B,EAA2B,QAAS,IAAMikB,GAAax/C,EAAWsB,CAAK,CAAC,EAI7Ek+C,GAAax/C,EAAWsB,CAAK,EAEtBtB,CACT,CAKA,eAAew/C,GAAax/C,EAAwBsB,EAAqC,CACvF,MAAMm+C,EAAiBz/C,EAAU,cAAc,sBAAsB,EACrEy/C,EAAe,UAAY,wCAE3B,GAAI,CAEF,KAAM,CAAE,SAAAl8D,CAAA,EAAa,MAAMoK,GAAgB,OAAO,EAAE,EAEpD,GAAIpK,EAAS,SAAW,EAAG,CACzBk8D,EAAe,UAAY;AAAA;AAAA;AAAA;AAAA,QAK3B,MACF,CAGA,KAAM,CAAE,MAAAvtD,EAAO,MAAAC,GAAUutD,GAAan8D,CAAQ,EAG9C,GAAI,CAAC+7D,KAAkB,CACrBznB,GAAoB4nB,EAAgBl8D,EAAU+d,CAAK,EACnD,MACF,CAGAq+C,GAAiBF,EAAgBvtD,EAAOC,EAAO5O,EAAU+d,CAAK,CAChE,MAAQ,CACNm+C,EAAe,UAAY,mDAC7B,CACF,CAKA,SAASC,GAAan8D,EAA6D,CACjF,MAAM2O,EAAmB,GACnBC,EAAmB,GACnBytD,MAAkC,IAGxC,OAAAr8D,EAAS,QAAQ0oB,GAAW,CAC1B,MAAM4zC,EAAY5zC,EAAQ,eAAe,KAAK1jB,GAAKA,EAAE,OAAS,YAAY,EAC1E,GAAIs3D,EAAW,CAEb,MAAMC,EAAeF,EAAO,IAAIC,EAAU,SAAS,GAAK,EACxDD,EAAO,IAAI,OAAO3zC,EAAQ,EAAE,EAAG6zC,EAAe,CAAC,CACjD,MAEEF,EAAO,IAAI,OAAO3zC,EAAQ,EAAE,EAAG,CAAC,CAEpC,CAAC,EAGD1oB,EAAS,QAAQ0oB,GAAW,CAC1B/Z,EAAM,KAAK,CACT,GAAI,OAAO+Z,EAAQ,EAAE,EACrB,MAAOA,EAAQ,KACf,MAAO,GAAGA,EAAQ,IAAI,GAAGA,EAAQ,KAAO;AAAA,EAAKA,EAAQ,IAAI,GAAK,EAAE,GAAGA,EAAQ,aAAe;AAAA,EAAKA,EAAQ,YAAY,GAAK,EAAE,GAC1H,MAAO2zC,EAAO,IAAI,OAAO3zC,EAAQ,EAAE,CAAC,GAAK,EACzC,MAAOA,EAAQ,QAAQ,CAAC,GAAG,MAC5B,CACH,CAAC,EAGD1oB,EAAS,QAAQ0oB,GAAW,CAC1BA,EAAQ,eAAe,QAAQ8zC,GAAO,CAChCA,EAAI,OAAS,cACf5tD,EAAM,KAAK,CACT,KAAM4tD,EAAI,UACV,GAAI,OAAO9zC,EAAQ,EAAE,EACrB,OAAQ,KACT,CAEL,CAAC,CACH,CAAC,EAEM,CAAE,MAAA/Z,EAAO,MAAAC,CAAA,CAClB,CAKA,SAASwtD,GACP3/C,EACA9N,EACAC,EACA5O,EACA+d,EACM,CACNtB,EAAU,UAAY,GAEtB,MAAMg7B,EAAW9oC,EAAM,IAAImQ,IAAM,CAC/B,GAAIA,EAAE,GACN,MAAOA,EAAE,MACT,MAAOA,EAAE,MACT,MAAOA,EAAE,MACT,MAAO,CACL,WAAYA,EAAE,OAAS,UACvB,OAAQA,EAAE,OAAS,UACnB,UAAW,CAAE,WAAY,UAAW,OAAQ,UAAU,EAExD,KAAM,CAAE,MAAO,WACf,MAAO,MACP,OAAQ,IACR,EAEI3mB,EAAU,CACd,OAAQ,CACN,aAAc,CACZ,UAAW,KACX,WAAY,WACZ,gBAAiB,IACjB,YAAa,IACf,EAEF,MAAO,CACL,YAAa,EACb,OAAQ,IAEV,MAAO,CACL,MAAO,CAAE,MAAO,UAAW,UAAW,WACtC,MAAO,EACP,OAAQ,CAAE,KAAM,cAAc,EAEhC,QAAS,GACT,YAAa,CACX,MAAO,GACP,aAAc,IAChB,EAGIu5D,EAAMqK,GAAA,EACNzkB,EAAU,IAAIoa,EAAI,QAAQj1C,EAAW,CACzC,MAAO,IAAIi1C,EAAI,QAAQja,CAAQ,EAC/B,MAAO,IAAIia,EAAI,QAAQ9iD,CAAK,GAC3BzW,CAAO,EAGTskB,EAAU,QAAQ,YAAY,EAA8C,SAAW66B,EAGxFA,EAAQ,GAAG,QAAU90C,GAAW,CAC9B,GAAIA,EAAO,MAAM,OAAS,EAAG,CAC3B,MAAMmQ,EAASnQ,EAAO,MAAM,CAAC,EACvBkmB,EAAU1oB,EAAS,KAAKsI,GAAK,OAAOA,EAAE,EAAE,IAAMqK,CAAM,EACtD+V,IACE3K,EAAM,YACRA,EAAM,YAAY2K,CAAO,EAEzB69B,GAAiB,CAAE,KAAM,OAAQ,QAAA79B,CAAA,CAAS,EAGhD,CACF,CAAC,EAED4uB,EAAQ,KACV,CAKA,SAAShD,GAAoB73B,EAAwBzc,EAAqB+d,EAA4B,CAEpG,MAAM0+C,EAAmC,GACzCz8D,EAAS,QAAQsI,GAAK,CACpB,MAAM6yD,EAAM7yD,EAAE,cAAgB,QACzBm0D,EAAMtB,CAAG,IAAGsB,EAAMtB,CAAG,EAAI,IAC9BsB,EAAMtB,CAAG,EAAE,KAAK7yD,CAAC,CACnB,CAAC,EAEDmU,EAAU,UAAY;AAAA;AAAA,QAEhB,OAAO,QAAQggD,CAAK,EAAE,IAAI,CAAC,CAACtB,EAAK1qC,CAAO,IAAM;AAAA;AAAA,iCAErBhN,GAAW03C,CAAG,CAAC;AAAA;AAAA,cAElC1qC,EAAQ,IAAI/H,GAAW;AAAA,iDACYA,EAAQ,EAAE;AAAA,6CACdlF,GAAYkF,EAAQ,IAAI,CAAC;AAAA;AAAA,6CAEzBjF,GAAWiF,EAAQ,IAAI,CAAC;AAAA,oBACjDA,EAAQ,KAAO,4BAA4BjF,GAAWiF,EAAQ,IAAI,CAAC,SAAW,EAAE;AAAA;AAAA;AAAA,aAGvF,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,OAGhB,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA,IAKfjM,EAAU,iBAAiB,aAAa,EAAE,QAAQP,GAAM,CACtDC,EAAGD,EAAmB,QAAS,IAAM,CACnC,MAAMtb,EAAKsb,EAAG,aAAa,SAAS,EAC9BwM,EAAU1oB,EAAS,KAAKsI,GAAK,OAAOA,EAAE,EAAE,IAAM1H,CAAE,EAClD8nB,IACE3K,EAAM,YACRA,EAAM,YAAY2K,CAAO,EAEzB69B,GAAiB,CAAE,KAAM,OAAQ,QAAA79B,CAAA,CAAS,EAGhD,CAAC,CACH,CAAC,CACH,CAKA,SAASlF,GAAY3a,EAAsB,CACzC,OAAOA,EACJ,MAAM,GAAG,EACT,OAASiW,EAAE,CAAC,CAAC,EACb,KAAK,EAAE,EACP,cACA,MAAM,EAAG,CAAC,CACf,CAKA,SAAS2E,GAAW5X,EAAsB,CACxC,MAAMyY,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAczY,EACXyY,EAAI,SACb,uHChSA,IAAIo4C,GAA8B,YAC9B3E,GAA0B,MAC1B4E,GAA0B,OAC1BC,GAA4B,OAC5Bj1B,GAAgB,GAChBk1B,OAAqC,IACrCC,GAA2B,GAKxB,SAASC,GAAqBh/C,EAA6B,GAAiB,CACjF,MAAMwd,EAAQzf,EAAc,MAAO,CAAE,UAAW,0BAA2B,EAE3E,OAAAyf,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAsThB2iD,IAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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","names":["ThemeService","saved","effective","fn","mode","modes","nextIndex","newTheme","callback","theme","defaultOptions","typeColors","showToast","message","type","options","opts","toast","success","error","warning","info","config","requestInterceptors","responseInterceptors","addRequestInterceptor","interceptor","index","api","path","attempt","url","finalOptions","timeoutMs","controller","timeoutId","response","data","retryAfter","sleep","errorMessage","extractErrorMessage","ApiError","result","fallback","obj","ms","resolve","status","details","http","body","configureApi","newConfig","getItem","key","defaultValue","item","setItem","value","removeItem","clear","hasItem","getKeys","storage","ShortcutService","shortcutStr","handler","description","parts","syntheticEvent","shortcut","event","target","shortcutOrKey","enabled","shortcuts","s","UndoService","action","undoManager","initialState","state","listeners","notify","getState","subscribe","setCurrentProjectId","projectId","setCurrentProject","project","setCurrentUser","user","setAuthConfigured","configured","setConfig","setLoading","isLoading","setError","setOnline","online","reset","initAppStore","appStore","isInitialized","authCheckPromise","checkAuthStatus","checkSession","authUser","mapAuthUserToUser","initAuth","login","credentials","register","logout","forgotPassword","email","resetPassword","password","accessToken","refreshSession","profile","metadata","isAuthenticated","isAuthInitialized","getCurrentUser","onAuthRequired","triggerAuthRequired","auth","setQuestions","questions","setRisks","risks","setActions","actions","setDecisions","decisions","setFacts","facts","setContacts","contacts","setChatHistory","chatHistory","addChatMessage","setProjects","projects","clearChatHistory","dataStore","getProjects","getCurrentProject","createProject","updateProject","id","currentProject","deleteProject","activateProject","setDefaultProject","getProjectStats","exportProject","importProject","file","formData","initProjects","defaultProject","p","getDashboard","getStats","getTrends","days","getHealth","getInsights","getAlerts","loadDashboardData","dashboard","health","insights","alerts","dashboardService","getQuestions","filters","params","query","createQuestion","updateQuestion","deleteQuestion","reason","answerQuestion","getQuestionsByPerson","getQuestionsByTeam","suggestAssignee","reopenQuestion","dismissQuestion","deferQuestion","until","submitAnswerFeedback","wasUseful","feedback","getQuestionStats","now","sevenDaysAgo","q","questionsService","getRisks","getRisk","getDeletedRisks","restoreRisk","getRiskEvents","getRisksByCategory","createRisk","updateRisk","deleteRisk","calculateRiskScore","impact","likelihood","impactScores","likelihoodScores","suggestRisk","owners","getRiskMatrixData","matrix","r","risk","risksService","normalizeAction","row","getActions","createAction","payload","raw","updateAction","deleteAction","suggestAssignees","getActionEvents","isOverdue","getActionStats","a","actionsService","getDecisions","getDecision","getDeletedDecisions","restoreDecision","getDecisionEvents","decisionId","getSimilarDecisions","limit","runDecisionCheck","detectConflicts","suggest","content","rationale","suggestOwner","createDecision","updateDecision","deleteDecision","approveDecision","approvedBy","rejectDecision","decisionsService","sendMessage","request","m","userMessage","assistantMessage","ask","sotChat","getBriefing","refresh","getBriefingHistory","getWeeklyReport","generateExecutiveSummary","getChatHistory","addToHistory","chatService","getContacts","c","getContact","createContact","updateContact","deleteContact","getContactStats","findContactByName","name","getDuplicates","mergeContacts","contactIds","enrichContact","exportContacts","format","blob","getContactWithAssociations","addContactToProject","contactId","removeContactFromProject","getContactProjects","getTeams","getTeam","createTeam","updateTeam","deleteTeam","addTeamMember","teamId","role","isLead","removeTeamMember","contactsService","teamsService","uploadFiles","files","onProgress","xhr","reject","e","uploadWithExtraction","getProcessingStatus","getDocuments","statusOrOptions","queryString","getDocument","deleteDocument","restoreDocument","reprocessDocument","getDocumentSummary","getKnowledgeBase","category","addKnowledgeItem","searchKnowledge","getConversations","getConversation","parseConversationPreview","text","importConversation","deleteConversation","reembedConversation","bulkDeleteDocuments","ids","bulkReprocessDocuments","bulkExportDocuments","downloadBulkExport","documentsService","getKnowledgeStatus","exportKnowledgeMarkdown","exportKnowledgeJson","regenerateKnowledge","synthesizeKnowledge","topic","knowledgeService","conversationsService","getEmails","getEmail","getEmailThread","threadId","markAsRead","markAsUnread","starEmail","unstarEmail","archiveEmail","deleteEmail","sendEmail","draft","saveDraft","generateAIResponse","emailId","tone","generateSummary","categorizeEmail","getEmailStats","syncEmails","getById","getNeedingResponse","markResponded","generateResponse","emailsService","getVisualizationData","nodesResponse","edgesResponse","nodes","edges","getGraph","getEntityGraph","entityId","depth","getRelatedEntities","getOntologySchema","getOntologyEntities","getOntologyRelations","getOntologySuggestions","approveOntologySuggestion","suggestionId","rejectOntologySuggestion","getOntologyTypeStats","getOntologySyncStatus","forceOntologySync","runLLMAnalysis","autoApproveHighConfidence","threshold","getOntologyChanges","migrateOntologyToSupabase","getBackgroundWorkerStatus","triggerBackgroundAnalysis","getBackgroundWorkerLog","getOntologyJobs","toggleOntologyJob","jobId","extractOntologyFromGraph","validateOntologyCompliance","getOntologyDiff","findUnusedOntologyTypes","mergeOntology","cleanupOntology","getFalkorDBBrowserInfo","listAllFalkorDBGraphs","syncFalkorDBGraphs","dryRun","deleteFalkorDBGraph","graphName","getCommunities","getCentrality","getBridges","graphRAGQuery","streamGraphRAGQuery","onChunk","onComplete","onError","reader","decoder","fullResponse","done","lines","line","parsed","multiHopQuery","explainConnection","nodeId1","nodeId2","summarizeSelection","nodeIds","naturalLanguageFilter","filterText","suggestRelated","nodeId","executeCypher","cypher","getQueryTemplates","schema","pattern","getProjectGraphs","getCrossProjectEntities","entityType","saveQueryHistory","getQueryHistory","toggleQueryFavorite","queryId","deleteQueryHistory","saveView","view","getSavedViews","updateView","viewId","updates","deleteView","addBookmark","bookmark","getBookmarks","updateBookmark","bookmarkId","removeBookmark","createAnnotation","annotation","getAnnotations","updateAnnotation","annotationId","deleteAnnotation","saveChatMessage","getChatSessions","sessionId","toggleChatPin","messageId","createSnapshot","snapshot","getSnapshots","getSnapshot","snapshotId","compareSnapshots","snapshotId1","snapshotId2","deleteSnapshot","getTimeline","events","getEntityTimeline","getCosts","getCostSummary","period","normalized","d","getRecentCostRequests","getCostsPricing","getCostsBudget","limitUsd","alertThresholdPercent","setCostsBudget","getLLMConfig","graphService","timelineService","costsService","getNotifications","getUnreadCount","markAllAsRead","deleteNotification","getComments","addComment","parentId","updateComment","commentId","deleteComment","addReaction","emoji","removeReaction","createComment","resolveComment","getProjectMembers","inviteMember","updateMemberRole","memberId","removeMember","notificationsService","commentsService","getInvites","membersService","getUserSettings","updateUserSettings","settings","getProjectSettings","updateProjectSettings","getAPIKeys","createAPIKey","permissions","revokeAPIKey","getWebhooks","createWebhook","webhook","updateWebhook","deleteWebhook","testWebhook","getAuditLogs","exportAuditLogs","userSettingsService","projectSettingsService","apiKeysService","webhooksService","auditService","getProfile","updateProfile","currentUser","uploadAvatar","removeAvatar","changePassword","deleteAccount","getActivity","getSessions","revokeSession","revokeAllSessions","profileService","getFacts","getFact","createFact","updateFact","deleteFact","getDeletedFacts","restoreFact","verifyFact","runFactCheck","getFactsByCategory","grouped","fact","getFactsBySource","source","getFactsByDocument","documentId","getFactEvents","factId","getSimilarFacts","searchFacts","getFactStats","stats","f","factsService","createElement","tag","attributes","children","el","on","element","addClass","classes","removeClass","createThemeToggle","container","button","updateButton","getThemeIcon","mountThemeToggle","selector","setTab","tab","setDevTab","setSotView","setSelectedPerson","person","toggleSidebar","setSidebarOpen","open","openModal","modalId","closeModal","setSearchQuery","toggleFilter","uiStore","createHeader","props","header","logoSection","actionsSection","projectSelector","createProjectSelector","themeToggle","userMenu","createUserMenu","mobileMenuBtn","onProjectChange","dropdown","projectName","isOpen","initials","n","updateDropdown","settingsBtn","shortcutsBtn","logoutBtn","closeDropdown","mountHeader","defaultTabs","adminTab","getTabsForUser","createTabButton","rebuildNavigation","nav","tabs","currentTab","createSidebar","sidebar","closeBtn","btn","initialActiveBtn","updateTabBadge","tabId","count","badge","mountSidebar","containerInstance","getToastContainer","position","positionStyles","createToastElement","duration","icons","colors","dismissToast","showToastInContainer","activeModals","createModal","title","size","closable","onClose","onOpen","footer","modal","modalContent","footerEl","closeAllModals","_","isModalOpen","updateModalContent","updateModalTitle","titleEl","confirm","confirmText","cancelText","confirmClass","cancelBtn","confirmBtn","alert","okBtn","prompt","placeholder","MODAL_ID","PERMISSION_CATEGORIES","ROLE_DEFAULTS","showMemberPermissionsModal","userId","userName","userEmail","avatarUrl","currentRole","onSave","selectedPermissions","existing","getInitials","escapeHtml","cat","roleSelect","defaults","updateCheckboxes","checkbox","updateItemStyles","checkboxes","allChecked","cb","input","saveBtn","selected","div","currentProps","projectMembers","projectRoles","projectConfig","projectContacts","showProjectModal","createModalContent","modalHeader","loadProjectData","renderCreateForm","card","projectRes","membersRes","rolesRes","configRes","contactsRes","contactsData","renderEditForm","bindCreateEvents","renderMembersList","renderRolesList","getConfigValue","bindEditEvents","member","isOwner","part","form","projectData","submitBtn","loadProjects","t","section","projectForm","descEl","deleteBtn","inviteBtn","inviteFirstBtn","showInviteModal","addRoleBtn","showAddRoleDialog","select","newRole","membersList","bindMemberEvents","configForm","showEditUserRoleDialog","existingDialog","dialog","closeDialog","enhanceBtn","nameInput","contextInput","descInput","roleName","roleContext","loadProjectRoles","rolesGrid","overlay","customInput","promptTextarea","selectedOption","isCustom","roleSelectValue","userRole","userRolePrompt","linkedContactId","memberIndex","contact","handleEscape","showInvite","__vitePreload","InviteModal","initProjectSelector","newBtn","editBtn","loadProjectsIntoSelector","selectProject","updateSelectorOptions","projectList","currentProjectId","currentValue","option","onChange","wrapper","defaultOption","formatNumber","locale","formatDate","date","formatDateTime","formatRelativeTime","diffMs","diffSec","diffMin","diffHour","diffDay","futureDays","yesterday","isSameDay","startOfWeek","getStartOfWeek","startOfLastWeek","d1","d2","day","formatFileSize","bytes","units","i","formatCurrency","currency","createDashboard","loadFullDashboard","healthSection","briefingSection","statsGrid","overdueSection","alertsSection","insightsSection","riskSummaryContainer","goldenHoursSection","createBtn","ProjectModal","createBriefingPanel","BriefingPanel","briefingPanel","err","renderHealthIndicator","renderStatsGrid","renderOverdueActionsAlert","renderAlerts","renderInsights","renderQuestionsPriorityChart","renderFactsChart","renderWeeklyTrendsChart","renderRiskSummary","loadGoldenHours","statusClass","score","color","factors","onClick","qPriority","rImpact","factsVerified","stat","statId","getAlertIcon","onAction","insight","getSeverity","impactLevel","likelihoodLevel","activeRisks","counts","severity","total","mitigated","getPercent","conicStops","currentDeg","level","degrees","byCat","categories","sum","pct","critical","high","medium","resolved","trendsData","history","trends","entry","maxValue","overdueCount","viewBtn","getLocalTimeInfo","timezone","localTime","localHour","isOnline","findBestMeetingTimes","entries","suggestions","hour","available","totalScore","formatter","utcHour","offset","theirHour","b","members","linkedContactIds","memberEntries","linkedContact","tz","timeInfo","contactEntries","memberGolden","calculateGoldenHours","contactGolden","deduplicatedContactEntries","allEntries","allGolden","meetingSuggestions","onlineMembers","onlineContacts","onlineDeduplicatedContacts","onlineAll","escapeHtmlSimple","renderTimezoneChart","renderGoldenSummary","teamSuggestions","contactSuggestions","uniqueTimezones","offsets","overlapStart","overlapEnd","workStartUtc","workEndUtc","firstOffset","golden","tzCounts","uniqueTzs","h","workStart","workEnd","workLeft","workWidth","displayTz","formatHour","maxAvatars","showEntries","moreCount","str","mountDashboard","createChat","showSessions","chat","currentSessionId","sessions","newChatBtn","newChatContextWrap","newChatContextLabel","newChatContextSelect","sessionsList","mainArea","chatContainer","chatHeader","contextLabel","contextSelect","loadContacts","renderContextSelect","currentContextId","renderNewChatContextSelect","onContextChange","idx","messagesContainer","inputContainer","sendBtn","handleSend","loadSessions","renderSessionsList","selectSession","loadMessages","msgs","msg","renderMessage","createNewSession","contextContactId","session","loadingEl","scrollToBottom","quickPrompts","showSources","msgEl","metaEl","confidenceClass","metaHtml","methodLabel","totalSources","sourcesEl","sources","contactSources","topSources","pillsEl","mountChat","currentQuestion","createQuestionDetailView","question","onUpdate","onNavigateToQuestion","renderEntities","renderExistingAnswer","bindEvents","loadChain","loadSimilar","loadTimeline","entities","topics","getScoreColor","renderProvenance","provenance","backLink","aiSuggestBtn","loadAISuggestions","checkAnswersBtn","checkPotentialAnswers","saveAnswerBtn","saveAnswer","reopenBtn","dismissBtn","dismissMenu","reasonLinks","link","dismissQuestionWithReason","deferBtn","showDeferDialog","undeferBtn","feedbackYes","feedbackNo","submitFeedback","toggleEditMode","assigneeSelect","answeredBySelect","contactList","contactSearch","otherOption","renderContactGrid","filtered","updateAssignedDisplay","bindPickerButtons","setupAnswererPicker","setupSourceOptions","showBtn","answererList","answererSearch","answererOtherInput","renderAnswererList","filter","photoUrl","contactName","selectAnswerer","clearBtn","display","opt","contactsToRender","isCurrentAssignee","picker","showPickerBtn","changeBtn","searchInput","questionId","onNavigate","chainContent","parent","html","child","similarContent","similar","timelineContent","icon","getEventIcon","getEventDescription","eventType","panel","showAllBtn","roleDisplay","scoreColor","selectBtn","suggestion","hideBtn","timeoutMessage","retryBtn","answersDiv","potentialAnswers","answerInput","sourceSelect","followupInput","answer","answeredByContactId","followupQuestions","answeredByName","updated","untilInput","reasonInput","feedbackBtns","currentSuggestions","showQuestionModal","onDismiss","renderQuestionView","createFooterButtons","getModalTitle","onDelete","handleCreate","handleEdit","handleDismiss","handleAnswer","answerBtn","handleReopen","suggestBtn","loadAssigneeSuggestions","showAnswerField","suggestionsContainer","assigneeInput","getValue","newQuestion","Modal","currentFilter","currentView","createQuestionsPanel","filterSelect","loadQuestions","viewTabs","addBtn","generateBtn","showGenerateForTeamDialog","updateCount","renderByStatus","renderGrouped","slaHours","created","deadline","createQuestionCard","bindCardEvents","groups","groupName","allQuestions","qs","priorityClass","slaBreached","autoDetected","hasAnswer","hasRequesterRole","getPhotoUrl","renderAvatar","cssClass","requesterName","requesterRole","requesterContactId","requesterPhotoUrl","assigneePhotoUrl","showQuestionDetailView","containerEl","panelContent","detailView","updatedQuestion","targetQuestion","currentSource","selectedRole","allRoles","questionCount","configSection","selectedBadge","genOverlay","genContent","getRoleIcon","loadRoles","roles","roleMap","showConfig","generateQuestions","res","countVal","countEl","createSourceOfTruth","panels","questionsPanel","createFullQuestionsPanel","risksPanel","createRisksPanel","actionsPanel","createActionsPanel","decisionsPanel","createDecisionsPanel","questionsBadge","risksBadge","actionsBadge","decisionsBadge","renderQuestions","renderRisks","renderActions","renderDecisions","initialView","initialTab","initialPanel","list","showQuestionDetail","originalContent","propsOrCallback","decision","mountSourceOfTruth","sot","showRiskModal","isEdit","isView","riskDesc","riskProb","riskCreated","riskOwner","impactEl","probEl","contentText","ownerEl","mitigationEl","desc","owner","riskData","iso","getRiskEventIcon","getRiskEventDescription","ev","actor","changes","toStr","fromStr","createRiskDetailView","viewContent","editForm","cancelEditBtn","contentEl","likelihoodEl","statusEl","deleteInEditBtn","ownerPickerTrigger","ownerPickerDropdown","ownerPickerValue","ownerHiddenInput","ownerPickerList","ownerPickerSearch","editFormContacts","renderOwnerPickerList","editAiSuggestBtn","editSuggestionsPanel","mitigation","roleOrReason","assignBtn","applyMitigationBtn","lastMitigation","suggestionsPanel","docLink","timelineEl","viewContacts","riskContactPicker","riskContactList","riskContactSearch","renderRiskContactGrid","getContactPhotoUrl","showRiskPicker","changeOwnerBtn","findContactByOwner","byExact","byPartial","byAlias","aLower","u","roleEl","avatarEl","img","riskDetailProps","updatedRisk","currentSearch","showMatrix","lastLoadedRisks","loadRisks","searchTimeout","matrixBtn","matrixContainer","risksToShow","renderRiskMatrix","refreshRemovedSection","deleted","truncate","restoreBtn","len","filterRisksBySearch","lower","renderRisksBySource","byStatus","statuses","createRiskCard","bindRiskCards","bySource","src","IMPACT_BAR_COLOR","barColor","ownerChipHtml","sourceChip","taskText","dueDateText","createdText","showActionModal","due","completeBtn","getActionEventIcon","getActionEventDescription","createActionDetailView","task","assignee","assigneePickerTrigger","assigneePickerDropdown","assigneePickerValue","assigneeHiddenInput","assigneePickerList","assigneePickerSearch","renderAssigneePickerList","editAssigneeHiddenInput","editAssigneePickerValue","suggested_assignees","findContactByAssignee","taskEl","priorityEl","assigneeEl","dueEl","doDelete","docId","actionContactPicker","actionContactList","actionContactSearch","renderActionContactGrid","showActionPicker","actionDetailProps","updatedAction","loadActions","priorityBarColor","priority","assigneeChipHtml","dueChip","viewLink","showDecisionModal","viewImpact","viewSummary","modalContacts","renderMadeByDisplay","madeBy","madeByDisplay","madeByInput","chooseBtn","showModalPicker","modalPicker","renderModalContactGrid","modalContactSearch","modalContactList","currentMadeBy","decisionContent","decisionImpact","decisionSummary","hintEl","getVal","approveBtn","rejectBtn","updateStatus","decisionData","apiPayload","createDecisionDetailView","onDecisionClick","renderEditFormOwnerDisplay","currentOwnerName","rationaleEl","summaryEl","madeByEl","viewContentText","viewRationale","statusBadge","badges","impactPill","oldPill","currentOwnerEl","chBtn","showOwnerPicker","ownerPicker","ownerList","ownerSearch","renderOwnerContactGrid","currentEl","showOwnerPickerBtn","editOwnerDisplay","editMadeByInput","editContactPicker","editContactList","editContactSearch","showEditOwnerPicker","renderEditFormContactGrid","ownerAiSuggestBtn","ownerSuggestionsPanel","suggested_owners","rationaleAiSuggestBtn","applyBtn","labels","actorLabel","similarEl","decisionDetailProps","clickedDecision","loadDecisions","checkConflictsBtn","checkConflicts","conflicts","createConflictCard","bindConflictCards","keepId","discardId","filterDecisionsBySearch","renderDecisionsBySource","createDecisionCard","bindDecisionCards","STATUS_BAR_COLOR","createFactDetailView","onFactClick","verifyFactBtn","verifyBtn","showFactModal","FactModal","CATEGORIES","factDetailProps","createFactsPanel","clickedFact","loadFacts","conflictsBtn","showAddFactModal","categoryFilter","rawFacts","renderFactsBySource","renderFacts","refreshRemovedFactsSection","conflictsContainer","emptyAddBtn","factsByCategory","catFacts","createFactCard","newPanel","CATEGORY_BAR_COLOR","categoryClass","confidencePct","renderConflicts","conflict","keepLeftBtn","keepRightBtn","resolveConflict","keep","toDelete","toKeep","max","createStatsCard","trendHtml","getTrendArrow","direction","updateStatsCard","subValue","valueEl","subEl","createStatsGrid","grid","createHealthIndicator","showFactors","indicator","createHealthBadge","getHealthColor","getHealthStatus","METRIC_COLORS","createTrendChart","metrics","height","canvas","initChart","renderFallbackChart","Chart","datasets","metric","capitalize","dateStr","IMPACTS","LIKELIHOODS","CELL_COLORS","createRiskMatrix","onCellClick","groupRisksByCell","l","cellRisks","cell","createRiskSummary","summary","bySeverity","fileQueue","createFileUploader","allowedTypes","maxFileSize","multiple","uploader","dropzone","fileInput","queueContainer","actionsContainer","statusContainer","addFilesToQueue","updateQueueUI","uploadBtn","checkProcessingStatus","maxSize","qf","getFileIcon","pendingFiles","progress","pollProcessingStatus","renderProcessingStatus","pollingInterval","mimeType","NODE_COLORS","createKnowledgeGraph","initGraph","graphContainer","statsContainer","loadStats","network","createVisNetwork","bindToolbarEvents","visNodes","getNodeSize","visEdges","node","showNodeDetails","connections","matchingNode","refreshBtn","fitBtn","detailsContainer","renderStats","createTimeline","daysSelect","filterBtns","filterEvents","renderTimeline","groupByDate","dayEvents","formatTime","visibleEvents","EVENT_TYPES","DAY_PERIODS","currentDays","currentDensity","currentTypeFilters","allEvents","focusedEventIndex","createTimelinePanel","renderSkeletons","periodSelect","densityBtns","updateDensity","renderFilteredEvents","exportBtn","showExportMenu","navigateEvents","selectFocusedEvent","clearEventFocus","endDate","startDate","updateTypeCounts","renderError","renderEmptyState","today","formatDateLabel","renderEventCard","bindEventCardClicks","time","relativeTime","fullDateTime","typesWithEvents","chips","chip","allChip","cards","targetCard","menu","exportTimeline","closeHandler","filename","headers","rows","thisWeekStart","todayStr","yesterdayStr","maxLength","BUDGET_MODAL_ID","createCostsDashboard","loadCosts","handleExport","pricingBtn","pricingPanel","togglePricingPanel","budgetBtn","showBudgetModal","recentRequests","renderCosts","periodRangeEl","formatPeriod","dailyBreakdown","byProvider","byModel","totalCalls","avgPerCall","byProviderArray","provider","cost","byModelArray","model","byOperationMap","op","byOperationArray","operation","byContextArray","ctx","totalInput","totalOutput","hasNoData","periodChangeHtml","budgetHtml","emptyStateHtml","renderDailyChart","o","renderRecentRequests","requests","formatRequestTime","ext","pricing","renderPricingTable","budgetPeriod","currentLimit","currentThreshold","budget","limitEl","thresholdEl","thresholdRaw","skeletonDailyForPeriod","daily","chartDaily","maxCost","isPlaceholder","formatDateShort","start","end","currentQuery","selectedIndex","results","TYPE_ICONS","initGlobalSearch","createSearchModal","toggleSearch","backdrop","resultsContainer","closeSearch","debounceSearch","handleKeydown","openSearch","updateSelection","selectResult","performSearch","renderResults","performLocalSearch","groupByType","items","navigateToResult","selectedIds","createBulkActionsBar","bar","getActionsForType","clearSelection","updateBar","bindActionButtons","common","performBulkAction","endpoint","toggleSelection","selectItem","deselectItem","getSelectedIds","isSelected","createBulkCheckbox","createSyncStatus","isVisible","loadSyncDetails","checkSyncStatus","updateIndicator","infoContainer","deadLettersContainer","deadLetters","dl","createSyncIndicator","checkMiniStatus","dot","showSettingsModal","currentTheme","modalOverlay","bindSettingsEvents","targetSection","themeSelect","currentSteps","cancelCallback","showProcessingModal","steps","onCancel","allowCancel","renderContent","createFooter","step","renderStep","calculateOverallProgress","statusIcon","completed","running","runningProgress","closeProcessingModal","updateProcessingStep","stepId","stepIndex","addProcessingStep","setProcessingSteps","isProcessingModalOpen","currentMode","showAuthModal","renderAuthContent","getTitle","firstInput","renderLoginForm","renderRegisterForm","renderForgotForm","renderResetForm","handleLogin","bindModeLinks","passwordInput","updatePasswordStrength","handleRegister","handleForgot","handleReset","errorEl","setFormLoading","hideError","showError","username","displayName","loading","inputs","btnText","btnLoading","elementId","strengthEl","strength","calculatePasswordStrength","closeAuthModal","currentContact","contactProjects","contactRelations","contactActivity","allProjects","roleTemplates","showContactModal","loadContactData","loadRoleTemplates","loadAllProjects","loadTimezones","hasPhoto","projectsRes","relationsRes","activityRes","allProjectsRes","timezonesRes","timezones","renderTimezoneDropdown","renderRoleDropdown","renderProjectsList","renderRelationsList","renderActivityTimeline","updateTabCounts","tzSelect","currentTz","region","sortedRegions","isCustomRole","listContainer","associatedIds","relation","formatRelationType","timeline","activity","projectsCount","relationsCount","customRoleInput","tagsInput","tags","aliasesInput","aliases","contactData","selectedProjects","savedContactId","enrichBtn","addRelationBtn","showAddRelationDialog","orgInput","headerName","headerOrg","avatar","span","avatarUrlInput","avatarContainer","currentName","parentContainer","availableContacts","contactSelect","typeSelect","toContactId","relationType","diffDays","currentMembers","showTeamModal","onInvite","onRemove","onRoleChange","renderMembers","renderMemberCard","removeBtn","isSuperadmin","cachedMembers","onInviteSent","activeTab","selectedContact","generateInviteLink","tabBtns","copyBtn","linkInput","loadProjectMembers","onSelect","listEl","allHaveEmail","defaultPermissions","showRoleModal","availablePermissions","formatPermission","rolePermissions","selectAll","selectNone","roleData","permission","word","showExportModal","defaultFormat","defaultScope","group","radio","scope","performExport","getContentType","createBlob","getExtension","uploadQueue","isUploading","showFileUploadModal","accept","onUpload","render","renderFileItem","bindDropZone","bindFileItems","dropZone","addFiles","dt","fileId","rerender","showDeveloperModal","renderTabContent","bindActions","renderInfoTab","renderLogsTab","renderCacheTab","renderApiTab","appState","dataState","uiState","getMemoryUsage","keys","totalSize","acc","formatBytes","testApi","method","bodyText","responseEl","elapsed","perf","k","sizes","shortcutGroups","showShortcutsModal","registeredShortcuts","notifications","showNotificationsModal","markAllBtn","unreadCount","renderNotification","notification","getNotificationIcon","showEmailModal","onSend","isReply","replyTo","replySubject","zone","preview","replyBtn","forwardBtn","to","cc","subject","emailData","registerChart","chart","getChart","destroyChart","instance","updateChartData","registerNetwork","getNetwork","destroyNetwork","setActiveChart","getChartIds","getNetworkIds","destroyAll","chartsStore","showGraphModal","onNodeClick","onEdgeClick","getUniqueTypes","getTypeColor","initializeGraph","bindControls","vis","edge","types","page","hasMore","showHistoryModal","onRestore","loadHistory","renderEntry","loadMoreBtn","entryId","changesEl","actionIcons","actionColors","hasChanges","field","change","formatValue","comments","showCommentModal","entityName","onCommentAdded","renderComment","bindCommentActions","comment","isAuthor","findComment","replyContainer","replyInput","textarea","originalText","newText","removeComment","found","currentProfile","cachedTimezones","showProfileModal","loadProfile","apiProfile","renderProfile","generateFallbackAvatar","generateTimezoneOptions","avatarInput","avatarDisplay","profileForm","passwordForm","currentPassword","newPassword","confirmPassword","deleteAccountBtn","revokeAllBtn","regionOrder","aIdx","bIdx","label","diff","closeProfileModal","isViewMode","savedFact","verifiedFact","closeFactModal","showConversationPreviewModal","conversation","tabName","loadExtractionData","handleEsc","meta","extraction","entitiesContainer","entitiesCount","extractionContainer","extractionCount","totalItems","notesContainer","notesTab","notesText","renderNotesAsHtml","outline","currentTopic","bulletsHtml","headerDone","metaDone","flushTopic","trimmed","bulletText","showEmailPreviewModal","hasExtraction","getSentimentEmoji","sentiment","currentBriefing","showHistory","loadBriefing","historyBtn","historyContainer","briefing","renderBriefing","renderMarkdown","historyItem","showHistoryDetail","backBtn","currentReport","currentType","createReportsPanel","loadReport","exportMdBtn","exportReport","exportPdfBtn","report","renderReport","markdown","downloadFile","exportToPdf","html2pdf","tempDiv","allContacts","selectedContactIds","createContactsPanel","checkDuplicates","orgFilter","tagFilter","favoritesChip","importBtn","filteredContacts","renderContacts","renderFavorites","updateFilters","createContactCard","bindContactCardEvents","updateSelectionBar","toggleFavorite","existingBar","mergeBtn","selectedContacts","showMergeConfirmModal","detail","close","newValue","svg","favorites","alertsContainer","duplicates","reviewBtn","showDuplicatesReviewModal","duplicateGroups","groupIndex","alias","closeOverlay","closeReviewBtn","primaryId","orderedIds","groupEl","orgs","currentOrg","org","allTags","uniqueTags","currentTag","createTeamsPanel","loadTeams","teams","renderTeams","team","createTeamCard","memberCount","leadMember","getVisOrgChart","createOrgChart","loadOrgChart","chartContainer","buildOrgData","renderVisNetwork","levels","reportsTo","managerLevel","rel","byOrg","currentStatus","currentSort","currentViewMode","selectedDocuments","allDocuments","createDocumentsPanel","bindPanelEvents","loadDocuments","FileUploadModal","newSearch","renderFilteredDocuments","bulkDelete","bulkExport","bulkReprocess","renderDocumentsGrid","documents","doc","createDocumentCard","currentIndex","iconClass","getIconClass","getDocumentIcon","factsCount","decisionsCount","risksCount","entitiesLabel","showLoadingOverlay","spinner","hideLoadingOverlay","setBulkButtonsDisabled","disabled","createKnowledgePanel","exportKnowledge","exportJsonBtn","regenerateBtn","synthesizeBtn","synthesizeFacts","loadStatus","renderStatus","showConversationComposer","createConversationComposer","closeConversationComposer","renderPasteMode","renderMode","handlePreview","handleImport","bindPasteMode","renderUploadMode","previewBtn","hasContent","bindUploadMode","selectedFile","selectFile","getContent","previewArea","formatSelect","createConversationsPanel","showImportDialog","loadConversations","conversations","renderConversations","conv","createConversationCard","fullConv","reembedBtn","currentDirection","showNeedsResponse","createEmailsPanel","directionFilter","loadEmails","needsResponseFilter","createEmailComposer","showEmailComposer","EmailComposer","emails","renderEmails","createEmailCard","fullEmail","respondedBtn","directionIcon","needsResponse","getPreview","cleaned","closeEmailComposer","saveEmail","renderManualMode","bindManualMode","handleFileSelect","checkValidity","from","fileToBase64","base64","createNotificationsDropdown","trigger","toggleDropdown","loadNotifications","updateBadge","loadUnreadCount","renderNotifications","getIcon","initNotificationsDropdown","createCommentsThread","submitComment","loadComments","renderComments","thread","topLevel","replies","repliesByParent","bindCommentEvents","isOwn","replyForm","createMembersPanel","loadMembers","loadPendingInvites","invites","invite","createApiKeysPanel","showCreateKeyModal","loadApiKeys","renderApiKeys","expirySelect","scopeCheckboxes","scopes","showNewKeyModal","AVAILABLE_EVENTS","createWebhooksPanel","showWebhookModal","loadWebhooks","renderWebhooks","webhooks","w","urlInput","secretInput","activeCheckbox","eventCheckboxes","currentFilters","currentPage","PAGE_SIZE","createAuditPanel","filterBtn","loadAuditLogs","showExportWizard","renderAuditLogs","renderPagination","logs","log","getActionClass","showDetailsModal","totalPages","prevBtn","nextBtn","fromDate","toDate","includeCheckboxes","include","ROLE_CATEGORIES","currentRoles","editingRole","renderRolesPanel","showRoleEditor","categoryMap","roleId","editorEl","isNew","bindEditorEvents","aiBtn","isTemplate","ontologyEntities","ontologyRelations","ontologyLoaded","ontologyLoading","graphList","graphStatus","graphOverviewLoaded","graphOverviewLoading","graphPasswordSet","currentSection","systemConfig","providers","auditLogs","systemPrompts","teamAnalysisSettings","teamAnalysisLoaded","teamAnalysisLoading","loadSystemConfig","perTask","loadSecrets","loadProviders","defaultProviders","apiProviders","loadSystemPrompts","loadOntologyData","entitiesRes","loadGraphOverview","listRes","statusRes","saveConfig","testProvider","providerId","models","configs","graphConfigEntry","renderNav","renderLLMSection","taskTypes","taskConfig","descs","providerOpts","providerNames","renderGraphSection","graphConfig","g","renderOntologySection","renderPromptsSection","extractionPrompts","analysisPrompts","templatePrompts","renderPromptCard","renderProcessingSection","processing","loadTeamAnalysisSettings","saveTeamAnalysisSettings","access","renderTeamAnalysisSection","renderQueueSection","renderAuditSection","renderModelsSection","renderSectionContent","bindSectionEvents","newSection","renderAdminPanel","inputId","modelsCache","loadModelsForProvider","taskType","modelSelect","loadingSpan","statusDiv","saveLLMBtn","taskConfigs","loadApiKeysStatus","secret","formGroup","statusSpan","saveKeysBtn","savedCount","saveServiceKeysBtn","resendKey","loadQueueStatus","statusContent","itemsContent","pendingCount","dbStatusBadge","statusColor","statusText","pendingLen","db","statPending","statProcessing","statSuccess","statFailed","statRetry","statAvgTime","statCost","loadQueueHistory","historyContent","showRequestDetails","requestId","req","formatJsonHtml","json","formatPromptText","statusInfo","inputData","messages","promptText","existingModal","loadFailedItems","failedContent","refreshStatusBtn","refreshHistoryBtn","refreshFailedBtn","retryAllBtn","successCount","pauseBtn","resumeBtn","cancelId","retryId","retryResetBtn","retryResetId","loadMetadataSyncStatus","countsDiv","syncAllBtn","resultDiv","browseModelsBtn","providerSelect","contentDiv","textModels","visionModels","embeddingModels","saveGraphBtn","graphConfigValue","testGraphBtn","testConfig","loadGraphOverviewBtn","refreshGraphOverviewBtn","openGraphTabBtn","loadOntologyBtn","reloadOntologyBtn","savePromptsBtn","promptElements","reloadPromptsBtn","historyDiv","listDiv","versions","currentVersion","v","promptKey","versionStr","version","template","previewModal","saveProcBtn","saveTeamAnalysisBtn","refreshAuditBtn","initAdminPanel","createHistoryPanel","bindFilters","actionFilter","entityFilter","dateFromInput","dateToInput","applyFilters","renderHistory","getActionVerb","formatFieldName","itemDate","dateLabel","exportHistory","questionsRes","risksRes","actionsRes","decisionsRes","undo","redo","initLegacyBridge","registerShortcuts","configureApiClient","initializeUI","updateThemeButton","userAvatar","userDropdown","loginBtn","components.showAuthModal","updateAuthUI","refreshData","updateDashboard","showAuthRequiredMessage","components.showSettingsModal","components.showShortcutsModal","devToolsBtn","components.showDeveloperModal","profileBtn","notificationsContainer","switchTab","sotTabs","loadSotContent","menuToggle","newContactBtn","components.showContactModal","components.showFileUploadModal","initializeSidebarActions","newProjectBtn","editProjectBtn","showNoProjectState","components.showProjectModal","contactsSubtabs","subtab","refreshDashboardBtn","initializePanels","initializeDropZones","dashboardContainer","refreshDashboardPanel","Dashboard","Chat","emailsContainer","EmailsPanel","contactsContainer","ContactsPanel","teamsContainer","TeamsPanel","rolesContainer","RolesPanel","filesContainer","DocumentsPanel","showDocumentPreviewModal","orgChartContainer","OrgChart","costsContainer","CostsDashboard","HistoryPanel","dropzones","ConversationComposer","showTranscriptComposer","handleDroppedFiles","dataTransfer","addPendingFiles","fileNames","adminContainer","AdminPanel","createGraphExplorer","explorer","timelineContainer","TimelinePanel","createQuestionDetailView2","QuestionDetailView","DecisionDetailView","FactDetailView","RiskDetailView","ActionDetailView","teamAnalysisContainer","createTeamAnalysis","setupTeamAnalysisSubtabs","teamAnalysisStore","firstOrDefault","dashboardContent","activeQuestions","factsPanel","updatePendingFilesUI","processBtn","exportKnowledgeBtn","knowledge","exportKnowledgeClipboard","exportQuestionsBtn","exportQuestionsClipboard","copyOverdueBtn","overdueActions","dueDate","overdueQuestions","createdAt","overdue","cleanOrphanBtn","components.confirm","resetDataBtn","init","authBlocker","loginForm","registerForm","forgotForm","adminNavBtn","fallbackAvatar","components"],"ignoreList":[],"sources":["../../frontend/services/theme.ts","../../frontend/services/toast.ts","../../frontend/services/api.ts","../../frontend/services/storage.ts","../../frontend/services/shortcuts.ts","../../frontend/services/undo.ts","../../frontend/stores/app.ts","../../frontend/services/auth.ts","../../frontend/stores/data.ts","../../frontend/services/projects.ts","../../frontend/services/dashboard.ts","../../frontend/services/questions.ts","../../frontend/services/risks.ts","../../frontend/services/actions.ts","../../frontend/services/decisions.ts","../../frontend/services/chat.ts","../../frontend/services/contacts.ts","../../frontend/services/documents.ts","../../frontend/services/emails.ts","../../frontend/services/graph.ts","../../frontend/services/notifications.ts","../../frontend/services/settings.ts","../../frontend/services/profile.ts","../../frontend/services/facts.ts","../../frontend/utils/dom.ts","../../frontend/components/ThemeToggle.ts","../../frontend/stores/ui.ts","../../frontend/components/Header.ts","../../frontend/components/Sidebar.ts","../../frontend/components/Toast.ts","../../frontend/components/Modal.ts","../../frontend/components/modals/MemberPermissionsModal.ts","../../frontend/components/modals/ProjectModal.ts","../../frontend/components/ProjectSelector.ts","../../frontend/utils/format.ts","../../frontend/components/Dashboard.ts","../../frontend/components/Chat.ts","../../frontend/components/questions/QuestionDetailView.ts","../../frontend/components/modals/QuestionModal.ts","../../frontend/components/sot/QuestionsPanel.ts","../../frontend/components/SourceOfTruth.ts","../../frontend/components/modals/RiskModal.ts","../../frontend/components/risks/RiskDetailView.ts","../../frontend/components/sot/RisksPanel.ts","../../frontend/components/modals/ActionModal.ts","../../frontend/components/actions/ActionDetailView.ts","../../frontend/components/sot/ActionsPanel.ts","../../frontend/components/modals/DecisionModal.ts","../../frontend/components/decisions/DecisionDetailView.ts","../../frontend/components/sot/DecisionsPanel.ts","../../frontend/components/facts/FactDetailView.ts","../../frontend/components/sot/FactsPanel.ts","../../frontend/components/widgets/StatsCard.ts","../../frontend/components/widgets/HealthIndicator.ts","../../frontend/components/widgets/TrendChart.ts","../../frontend/components/widgets/RiskMatrix.ts","../../frontend/components/FileUploader.ts","../../frontend/components/KnowledgeGraph.ts","../../frontend/components/Timeline.ts","../../frontend/components/TimelinePanel.ts","../../frontend/components/CostsDashboard.ts","../../frontend/components/GlobalSearch.ts","../../frontend/components/BulkActions.ts","../../frontend/components/SyncStatus.ts","../../frontend/components/modals/SettingsModal.ts","../../frontend/components/modals/ProcessingModal.ts","../../frontend/components/modals/AuthModal.ts","../../frontend/components/modals/ContactModal.ts","../../frontend/components/modals/TeamModal.ts","../../frontend/components/modals/InviteModal.ts","../../frontend/components/modals/RoleModal.ts","../../frontend/components/modals/ExportModal.ts","../../frontend/components/modals/FileUploadModal.ts","../../frontend/components/modals/DeveloperModal.ts","../../frontend/components/modals/ShortcutsModal.ts","../../frontend/components/modals/NotificationsModal.ts","../../frontend/components/modals/EmailModal.ts","../../frontend/stores/charts.ts","../../frontend/components/modals/GraphModal.ts","../../frontend/components/modals/HistoryModal.ts","../../frontend/components/modals/CommentModal.ts","../../frontend/components/modals/ProfileModal.ts","../../frontend/components/modals/FactModal.ts","../../frontend/components/modals/ConversationPreviewModal.ts","../../frontend/components/modals/EmailPreviewModal.ts","../../frontend/components/BriefingPanel.ts","../../frontend/components/ReportsPanel.ts","../../frontend/components/ContactsPanel.ts","../../frontend/components/TeamsPanel.ts","../../frontend/components/OrgChart.ts","../../frontend/components/DocumentsPanel.ts","../../frontend/components/KnowledgePanel.ts","../../frontend/components/ConversationComposer.ts","../../frontend/components/ConversationsPanel.ts","../../frontend/components/EmailsPanel.ts","../../frontend/components/EmailComposer.ts","../../frontend/components/NotificationsDropdown.ts","../../frontend/components/CommentsThread.ts","../../frontend/components/MembersPanel.ts","../../frontend/components/ApiKeysPanel.ts","../../frontend/components/WebhooksPanel.ts","../../frontend/components/AuditPanel.ts","../../frontend/components/RolesPanel.ts","../../frontend/components/AdminPanel.ts","../../frontend/components/HistoryPanel.ts","../../frontend/utils/legacy-bridge.ts","../../frontend/main.ts"],"sourcesContent":["/**\r\n * Theme Service\r\n * Manages dark/light/system theme with auto-detection\r\n */\r\n\r\nexport type ThemeMode = 'light' | 'dark' | 'system';\r\nexport type EffectiveTheme = 'light' | 'dark';\r\n\r\nclass ThemeService {\r\n  private mode: ThemeMode;\r\n  private listeners: Set<(theme: EffectiveTheme) => void> = new Set();\r\n  private mediaQuery: MediaQueryList;\r\n\r\n  constructor() {\r\n    this.mode = this.getSavedTheme();\r\n    this.mediaQuery = window.matchMedia('(prefers-color-scheme: light)');\r\n    this.apply();\r\n    this.watchSystemChanges();\r\n  }\r\n\r\n  /**\r\n   * Get saved theme from localStorage or default to 'system'\r\n   */\r\n  private getSavedTheme(): ThemeMode {\r\n    const saved = localStorage.getItem('theme');\r\n    if (saved === 'light' || saved === 'dark' || saved === 'system') {\r\n      return saved;\r\n    }\r\n    return 'system';\r\n  }\r\n\r\n  /**\r\n   * Get the system's preferred color scheme\r\n   */\r\n  private getSystemTheme(): EffectiveTheme {\r\n    return this.mediaQuery.matches ? 'light' : 'dark';\r\n  }\r\n\r\n  /**\r\n   * Watch for system theme changes\r\n   */\r\n  private watchSystemChanges(): void {\r\n    this.mediaQuery.addEventListener('change', () => {\r\n      if (this.mode === 'system') {\r\n        this.apply();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the effective theme (resolving 'system' to actual theme)\r\n   */\r\n  getEffective(): EffectiveTheme {\r\n    if (this.mode === 'system') {\r\n      return this.getSystemTheme();\r\n    }\r\n    return this.mode;\r\n  }\r\n\r\n  /**\r\n   * Get the current mode setting\r\n   */\r\n  getMode(): ThemeMode {\r\n    return this.mode;\r\n  }\r\n\r\n  /**\r\n   * Apply the current theme to the document\r\n   */\r\n  apply(): void {\r\n    const effective = this.getEffective();\r\n    document.documentElement.setAttribute('data-theme', effective);\r\n    \r\n    // Notify listeners\r\n    this.listeners.forEach(fn => fn(effective));\r\n  }\r\n\r\n  /**\r\n   * Set theme mode directly\r\n   */\r\n  set(mode: ThemeMode): void {\r\n    this.mode = mode;\r\n    localStorage.setItem('theme', mode);\r\n    this.apply();\r\n  }\r\n\r\n  /**\r\n   * Cycle through themes: light -> dark -> system -> light\r\n   */\r\n  cycle(): ThemeMode {\r\n    const modes: ThemeMode[] = ['light', 'dark', 'system'];\r\n    const currentIndex = modes.indexOf(this.mode);\r\n    const nextIndex = (currentIndex + 1) % modes.length;\r\n    this.set(modes[nextIndex]);\r\n    return this.mode;\r\n  }\r\n\r\n  /**\r\n   * Toggle between light and dark (ignores system)\r\n   */\r\n  toggle(): EffectiveTheme {\r\n    const effective = this.getEffective();\r\n    const newTheme: EffectiveTheme = effective === 'dark' ? 'light' : 'dark';\r\n    this.set(newTheme);\r\n    return newTheme;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to theme changes\r\n   */\r\n  onChange(callback: (theme: EffectiveTheme) => void): () => void {\r\n    this.listeners.add(callback);\r\n    return () => this.listeners.delete(callback);\r\n  }\r\n\r\n  /**\r\n   * Get icon for current theme mode\r\n   */\r\n  getIcon(): string {\r\n    switch (this.mode) {\r\n      case 'light': return '';\r\n      case 'dark': return '';\r\n      case 'system': return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get label for current theme mode\r\n   */\r\n  getLabel(): string {\r\n    switch (this.mode) {\r\n      case 'light': return 'Light';\r\n      case 'dark': return 'Dark';\r\n      case 'system': return 'System';\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const theme = new ThemeService();\r\n\r\n// Export class for testing\r\nexport { ThemeService };\r\n","/**\r\n * Toast Notification Service\r\n * Displays temporary notification messages\r\n */\r\n\r\nexport type ToastType = 'success' | 'error' | 'warning' | 'info';\r\n\r\ninterface ToastOptions {\r\n  duration?: number;\r\n  position?: 'top-right' | 'top-left' | 'bottom-right' | 'bottom-left';\r\n}\r\n\r\nconst defaultOptions: ToastOptions = {\r\n  duration: 3000,\r\n  position: 'bottom-right',\r\n};\r\n\r\nconst typeColors: Record<ToastType, string> = {\r\n  success: 'var(--success)',\r\n  error: 'var(--error)',\r\n  warning: 'var(--warning)',\r\n  info: 'var(--accent)',\r\n};\r\n\r\n/**\r\n * Show a toast notification\r\n */\r\nexport function showToast(\r\n  message: string,\r\n  type: ToastType = 'success',\r\n  options: ToastOptions = {}\r\n): void {\r\n  const opts = { ...defaultOptions, ...options };\r\n  \r\n  // Create toast element\r\n  const toast = document.createElement('div');\r\n  toast.className = 'toast fade-in';\r\n  toast.style.cssText = `\r\n    position: fixed;\r\n    ${opts.position?.includes('bottom') ? 'bottom' : 'top'}: 20px;\r\n    ${opts.position?.includes('right') ? 'right' : 'left'}: 20px;\r\n    background: ${typeColors[type]};\r\n    color: white;\r\n    padding: 12px 20px;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    z-index: 10000;\r\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\r\n    max-width: 400px;\r\n    word-wrap: break-word;\r\n  `;\r\n  toast.textContent = message;\r\n  \r\n  // Add to DOM\r\n  document.body.appendChild(toast);\r\n  \r\n  // Remove after duration\r\n  setTimeout(() => {\r\n    toast.style.opacity = '0';\r\n    toast.style.transition = 'opacity 0.3s';\r\n    setTimeout(() => toast.remove(), 300);\r\n  }, opts.duration);\r\n}\r\n\r\n/**\r\n * Show success toast\r\n */\r\nexport function success(message: string, options?: ToastOptions): void {\r\n  showToast(message, 'success', options);\r\n}\r\n\r\n/**\r\n * Show error toast\r\n */\r\nexport function error(message: string, options?: ToastOptions): void {\r\n  showToast(message, 'error', options);\r\n}\r\n\r\n/**\r\n * Show warning toast\r\n */\r\nexport function warning(message: string, options?: ToastOptions): void {\r\n  showToast(message, 'warning', options);\r\n}\r\n\r\n/**\r\n * Show info toast\r\n */\r\nexport function info(message: string, options?: ToastOptions): void {\r\n  showToast(message, 'info', options);\r\n}\r\n\r\n// Export as namespace for convenience\r\nexport const toast = {\r\n  show: showToast,\r\n  success,\r\n  error,\r\n  warning,\r\n  info,\r\n};\r\n","/**\r\n * API Service\r\n * Centralized HTTP client with error handling\r\n */\r\n\r\nimport { toast } from './toast';\r\n\r\nexport interface ApiResponse<T = unknown> {\r\n  data: T;\r\n  ok: boolean;\r\n  status: number;\r\n  statusText: string;\r\n}\r\n\r\n/**\r\n * API client configuration\r\n */\r\ninterface ApiConfig {\r\n  baseUrl: string;\r\n  defaultHeaders: Record<string, string>;\r\n  showErrorToasts: boolean;\r\n  timeout: number;\r\n  retryCount: number;\r\n  retryDelay: number;\r\n  onUnauthorized?: () => void;\r\n  onForbidden?: () => void;\r\n}\r\n\r\nconst config: ApiConfig = {\r\n  baseUrl: '',\r\n  defaultHeaders: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n  showErrorToasts: true,\r\n  timeout: 30000, // 30 seconds\r\n  retryCount: 2, // Retry failed requests up to 2 times\r\n  retryDelay: 1000, // Start with 1 second delay\r\n};\r\n\r\n// Request interceptors\r\ntype RequestInterceptor = (options: RequestInit) => RequestInit | Promise<RequestInit>;\r\ntype ResponseInterceptor = (response: ApiResponse<unknown>) => ApiResponse<unknown> | Promise<ApiResponse<unknown>>;\r\n\r\nconst requestInterceptors: RequestInterceptor[] = [];\r\nconst responseInterceptors: ResponseInterceptor[] = [];\r\n\r\n/**\r\n * Add request interceptor\r\n */\r\nexport function addRequestInterceptor(interceptor: RequestInterceptor): () => void {\r\n  requestInterceptors.push(interceptor);\r\n  return () => {\r\n    const index = requestInterceptors.indexOf(interceptor);\r\n    if (index > -1) requestInterceptors.splice(index, 1);\r\n  };\r\n}\r\n\r\n/**\r\n * Add response interceptor\r\n */\r\nexport function addResponseInterceptor(interceptor: ResponseInterceptor): () => void {\r\n  responseInterceptors.push(interceptor);\r\n  return () => {\r\n    const index = responseInterceptors.indexOf(interceptor);\r\n    if (index > -1) responseInterceptors.splice(index, 1);\r\n  };\r\n}\r\n\r\n/**\r\n * Make an API request with proper error handling\r\n */\r\nexport async function api<T = unknown>(\r\n  path: string,\r\n  options: RequestInit = {},\r\n  attempt = 0\r\n): Promise<ApiResponse<T>> {\r\n  const url = `${config.baseUrl}${path}`;\r\n  \r\n  // Apply request interceptors\r\n  let finalOptions: RequestInit = {\r\n    ...options,\r\n    headers: {\r\n      ...config.defaultHeaders,\r\n      ...options.headers,\r\n    },\r\n  };\r\n\r\n  for (const interceptor of requestInterceptors) {\r\n    finalOptions = await interceptor(finalOptions);\r\n  }\r\n\r\n  // Per-request timeout (optional); do not pass timeout to fetch\r\n  const optsWithTimeout = finalOptions as RequestInit & { timeout?: number };\r\n  const timeoutMs = optsWithTimeout.timeout ?? config.timeout;\r\n  delete (finalOptions as RequestInit & { timeout?: number }).timeout;\r\n\r\n  // Create abort controller for timeout\r\n  const controller = new AbortController();\r\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\r\n\r\n  try {\r\n    const response = await fetch(url, {\r\n      ...finalOptions,\r\n      signal: controller.signal,\r\n      credentials: 'include', // Include cookies for authentication\r\n    });\r\n\r\n    clearTimeout(timeoutId);\r\n\r\n    let data: T;\r\n    const contentType = response.headers.get('content-type');\r\n    \r\n    if (contentType?.includes('application/json')) {\r\n      data = await response.json();\r\n    } else {\r\n      data = await response.text() as unknown as T;\r\n    }\r\n\r\n    if (!response.ok) {\r\n      // Handle specific HTTP errors\r\n      switch (response.status) {\r\n        case 401:\r\n          if (config.onUnauthorized) {\r\n            config.onUnauthorized();\r\n          }\r\n          break;\r\n        case 403:\r\n          if (config.onForbidden) {\r\n            config.onForbidden();\r\n          }\r\n          break;\r\n        case 429:\r\n          // Rate limited - auto retry with exponential backoff\r\n          if (attempt < 3) {\r\n            const retryAfter = parseInt(response.headers.get('Retry-After') || '5', 10);\r\n            await sleep(retryAfter * 1000);\r\n            return api<T>(path, options, attempt + 1);\r\n          }\r\n          break;\r\n        case 503:\r\n        case 504:\r\n          // Service unavailable - retry\r\n          if (attempt < config.retryCount) {\r\n            await sleep(config.retryDelay * Math.pow(2, attempt));\r\n            return api<T>(path, options, attempt + 1);\r\n          }\r\n          break;\r\n      }\r\n\r\n      const errorMessage = extractErrorMessage(data, response.statusText);\r\n      \r\n      if (config.showErrorToasts) {\r\n        toast.error(errorMessage);\r\n      }\r\n      \r\n      throw new ApiError(errorMessage, response.status, data);\r\n    }\r\n\r\n    let result: ApiResponse<T> = {\r\n      data,\r\n      ok: true,\r\n      status: response.status,\r\n      statusText: response.statusText,\r\n    };\r\n\r\n    // Apply response interceptors\r\n    for (const interceptor of responseInterceptors) {\r\n      result = await interceptor(result) as ApiResponse<T>;\r\n    }\r\n\r\n    return result;\r\n  } catch (error) {\r\n    clearTimeout(timeoutId);\r\n\r\n    if (error instanceof ApiError) {\r\n      throw error;\r\n    }\r\n\r\n    // Abort error (timeout)\r\n    if (error instanceof DOMException && error.name === 'AbortError') {\r\n      const message = 'Request timed out';\r\n      if (config.showErrorToasts) {\r\n        toast.error(message);\r\n      }\r\n      throw new ApiError(message, 0);\r\n    }\r\n    \r\n    // Network or other error - retry if configured\r\n    if (attempt < config.retryCount) {\r\n      await sleep(config.retryDelay * Math.pow(2, attempt));\r\n      return api<T>(path, options, attempt + 1);\r\n    }\r\n\r\n    const message = error instanceof Error ? error.message : 'Network error';\r\n    if (config.showErrorToasts) {\r\n      toast.error(`Connection error: ${message}`);\r\n    }\r\n    throw new ApiError(message, 0);\r\n  }\r\n}\r\n\r\n/**\r\n * Extract error message from response data\r\n */\r\nfunction extractErrorMessage(data: unknown, fallback: string): string {\r\n  if (typeof data === 'object' && data !== null) {\r\n    const obj = data as Record<string, unknown>;\r\n    return String(obj.error || obj.message || obj.detail || fallback);\r\n  }\r\n  return fallback || 'Request failed';\r\n}\r\n\r\n/**\r\n * Sleep helper\r\n */\r\nfunction sleep(ms: number): Promise<void> {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * Custom API Error class\r\n */\r\nclass ApiError extends Error {\r\n  status: number;\r\n  details?: unknown;\r\n\r\n  constructor(message: string, status: number, details?: unknown) {\r\n    super(message);\r\n    this.name = 'ApiError';\r\n    this.status = status;\r\n    this.details = details;\r\n  }\r\n}\r\n\r\n/**\r\n * Convenience methods\r\n */\r\nexport const http = {\r\n  get: <T = unknown>(path: string, options?: RequestInit) =>\r\n    api<T>(path, { ...options, method: 'GET' }),\r\n\r\n  post: <T = unknown>(path: string, body?: unknown, options?: RequestInit) =>\r\n    api<T>(path, {\r\n      ...options,\r\n      method: 'POST',\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    }),\r\n\r\n  put: <T = unknown>(path: string, body?: unknown, options?: RequestInit) =>\r\n    api<T>(path, {\r\n      ...options,\r\n      method: 'PUT',\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    }),\r\n\r\n  patch: <T = unknown>(path: string, body?: unknown, options?: RequestInit) =>\r\n    api<T>(path, {\r\n      ...options,\r\n      method: 'PATCH',\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    }),\r\n\r\n  delete: <T = unknown>(path: string, options?: RequestInit) =>\r\n    api<T>(path, { ...options, method: 'DELETE' }),\r\n};\r\n\r\n/**\r\n * Configure API client\r\n */\r\nexport function configureApi(newConfig: Partial<ApiConfig>): void {\r\n  Object.assign(config, newConfig);\r\n}\r\n\r\nexport { ApiError };\r\n","/**\r\n * Storage Service\r\n * Wrapper for localStorage with type safety and JSON handling\r\n */\r\n\r\n/**\r\n * Get item from localStorage with JSON parsing.\r\n * Never throws: returns defaultValue if storage is blocked (e.g. Tracking Prevention) or parse fails.\r\n */\r\nexport function getItem<T>(key: string, defaultValue: T): T {\r\n  try {\r\n    const item = localStorage.getItem(key);\r\n    if (item === null) {\r\n      return defaultValue;\r\n    }\r\n    return JSON.parse(item) as T;\r\n  } catch {\r\n    return defaultValue;\r\n  }\r\n}\r\n\r\n/**\r\n * Set item in localStorage with JSON serialization.\r\n * Never throws: no-op if storage is blocked (e.g. Tracking Prevention).\r\n */\r\nexport function setItem<T>(key: string, value: T): void {\r\n  try {\r\n    localStorage.setItem(key, JSON.stringify(value));\r\n  } catch {\r\n    // Storage blocked or quota exceeded - ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Remove item from localStorage. Never throws; no-op if storage is blocked.\r\n */\r\nexport function removeItem(key: string): void {\r\n  try {\r\n    localStorage.removeItem(key);\r\n  } catch {\r\n    // ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all localStorage. Never throws; no-op if storage is blocked.\r\n */\r\nexport function clear(): void {\r\n  try {\r\n    localStorage.clear();\r\n  } catch {\r\n    // ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Check if key exists in localStorage. Returns false if storage is blocked.\r\n */\r\nexport function hasItem(key: string): boolean {\r\n  try {\r\n    return localStorage.getItem(key) !== null;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all keys in localStorage. Returns [] if storage is blocked.\r\n */\r\nexport function getKeys(): string[] {\r\n  try {\r\n    return Object.keys(localStorage);\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Storage namespace export\r\n */\r\nexport const storage = {\r\n  get: getItem,\r\n  set: setItem,\r\n  remove: removeItem,\r\n  clear,\r\n  has: hasItem,\r\n  keys: getKeys,\r\n};\r\n","/**\r\n * Keyboard Shortcuts Service\r\n * Manages global keyboard shortcuts\r\n */\r\n\r\nexport interface Shortcut {\r\n  key: string;\r\n  ctrl?: boolean;\r\n  shift?: boolean;\r\n  alt?: boolean;\r\n  meta?: boolean;\r\n  description: string;\r\n  handler: () => void;\r\n}\r\n\r\n// Type for string-based shortcut registration (e.g., 'mod+k', 'ctrl+shift+s')\r\nexport type ShortcutHandler = (event: KeyboardEvent) => void;\r\n\r\nclass ShortcutService {\r\n  private shortcuts: Map<string, Shortcut> = new Map();\r\n  private enabled = true;\r\n  private isMac = typeof navigator !== 'undefined' && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\r\n\r\n  constructor() {\r\n    this.handleKeydown = this.handleKeydown.bind(this);\r\n    document.addEventListener('keydown', this.handleKeydown);\r\n  }\r\n\r\n  /**\r\n   * Parse string shortcut to Shortcut object\r\n   * Supports: 'mod+k' (cmd on Mac, ctrl on others), 'ctrl+shift+s', '/', 'Escape'\r\n   */\r\n  private parseShortcut(shortcutStr: string, handler: ShortcutHandler, description = ''): Shortcut {\r\n    const parts = shortcutStr.toLowerCase().split('+');\r\n    const key = parts.pop() || shortcutStr;\r\n    \r\n    const shortcut: Shortcut = {\r\n      key,\r\n      ctrl: parts.includes('ctrl') || (parts.includes('mod') && !this.isMac),\r\n      shift: parts.includes('shift'),\r\n      alt: parts.includes('alt'),\r\n      meta: parts.includes('meta') || (parts.includes('mod') && this.isMac),\r\n      description,\r\n      handler: () => {\r\n        // Create a synthetic event for backwards compatibility\r\n        const syntheticEvent = new KeyboardEvent('keydown', { key });\r\n        handler(syntheticEvent);\r\n      },\r\n    };\r\n\r\n    return shortcut;\r\n  }\r\n\r\n  /**\r\n   * Generate unique key for shortcut\r\n   */\r\n  private getShortcutKey(shortcut: Omit<Shortcut, 'description' | 'handler'>): string {\r\n    const parts: string[] = [];\r\n    if (shortcut.ctrl) parts.push('ctrl');\r\n    if (shortcut.shift) parts.push('shift');\r\n    if (shortcut.alt) parts.push('alt');\r\n    if (shortcut.meta) parts.push('meta');\r\n    if (shortcut.key) {\r\n      parts.push(shortcut.key.toLowerCase());\r\n    }\r\n    return parts.join('+');\r\n  }\r\n\r\n  /**\r\n   * Handle keydown events\r\n   */\r\n  private handleKeydown(event: KeyboardEvent): void {\r\n    if (!this.enabled) return;\r\n\r\n    // Don't trigger shortcuts when typing in input fields\r\n    const target = event.target as HTMLElement;\r\n    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\r\n      // Allow Escape in input fields\r\n      if (event.key !== 'Escape') {\r\n        return;\r\n      }\r\n    }\r\n\r\n    const key = this.getShortcutKey({\r\n      key: event.key,\r\n      ctrl: event.ctrlKey,\r\n      shift: event.shiftKey,\r\n      alt: event.altKey,\r\n      meta: event.metaKey,\r\n    });\r\n\r\n    const shortcut = this.shortcuts.get(key);\r\n    if (shortcut) {\r\n      event.preventDefault();\r\n      shortcut.handler();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Register a keyboard shortcut\r\n   * Supports both object format and string format:\r\n   * - Object: { key: 'k', ctrl: true, handler: () => {}, description: 'Search' }\r\n   * - String: register('mod+k', (e) => {}, 'Search')\r\n   */\r\n  register(shortcutOrKey: Shortcut | string, handler?: ShortcutHandler, description?: string): () => void {\r\n    let shortcut: Shortcut;\r\n    \r\n    if (typeof shortcutOrKey === 'string') {\r\n      if (!handler) {\r\n        throw new Error('Handler is required when using string shortcut format');\r\n      }\r\n      shortcut = this.parseShortcut(shortcutOrKey, handler, description || '');\r\n    } else {\r\n      shortcut = shortcutOrKey;\r\n    }\r\n    \r\n    const key = this.getShortcutKey(shortcut);\r\n    this.shortcuts.set(key, shortcut);\r\n    \r\n    // Return unregister function\r\n    return () => this.shortcuts.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Unregister a shortcut by key combination\r\n   */\r\n  unregister(shortcut: Omit<Shortcut, 'description' | 'handler'>): void {\r\n    const key = this.getShortcutKey(shortcut);\r\n    this.shortcuts.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Enable/disable all shortcuts\r\n   */\r\n  setEnabled(enabled: boolean): void {\r\n    this.enabled = enabled;\r\n  }\r\n\r\n  /**\r\n   * Get all registered shortcuts\r\n   */\r\n  getAll(): Shortcut[] {\r\n    return Array.from(this.shortcuts.values());\r\n  }\r\n\r\n  /**\r\n   * Show shortcuts help modal\r\n   */\r\n  showHelp(): void {\r\n    const shortcuts = this.getAll();\r\n    console.log('Keyboard Shortcuts:');\r\n    shortcuts.forEach(s => {\r\n      const parts: string[] = [];\r\n      if (s.ctrl) parts.push('Ctrl');\r\n      if (s.shift) parts.push('Shift');\r\n      if (s.alt) parts.push('Alt');\r\n      if (s.meta) parts.push('Cmd');\r\n      parts.push(s.key.toUpperCase());\r\n      console.log(`  ${parts.join('+')} - ${s.description}`);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Destroy service and remove event listener\r\n   */\r\n  destroy(): void {\r\n    document.removeEventListener('keydown', this.handleKeydown);\r\n    this.shortcuts.clear();\r\n  }\r\n}\r\n\r\n// Export singleton\r\nexport const shortcuts = new ShortcutService();\r\n\r\n// Export class for testing\r\nexport { ShortcutService };\r\n","/**\r\n * Undo Service\r\n * Manages undo/redo stack for operations\r\n */\r\n\r\nexport interface UndoAction {\r\n  id?: string;\r\n  type?: string;\r\n  description: string;\r\n  undo: () => Promise<void> | void;\r\n  redo?: () => Promise<void> | void;\r\n  timestamp: number;\r\n}\r\n\r\nclass UndoService {\r\n  private undoStack: UndoAction[] = [];\r\n  private redoStack: UndoAction[] = [];\r\n  private maxSize = 50;\r\n  private listeners: Set<() => void> = new Set();\r\n\r\n  /**\r\n   * Push a new action to the undo stack\r\n   */\r\n  push(action: Omit<UndoAction, 'timestamp'>): void {\r\n    this.undoStack.push({\r\n      ...action,\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    // Clear redo stack on new action\r\n    this.redoStack = [];\r\n\r\n    // Limit stack size\r\n    if (this.undoStack.length > this.maxSize) {\r\n      this.undoStack.shift();\r\n    }\r\n\r\n    this.notify();\r\n  }\r\n\r\n  /**\r\n   * Undo the last action\r\n   */\r\n  async undo(): Promise<boolean> {\r\n    const action = this.undoStack.pop();\r\n    if (!action) return false;\r\n\r\n    try {\r\n      await action.undo();\r\n      this.redoStack.push(action);\r\n      this.notify();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Undo failed:', error);\r\n      // Put action back on stack\r\n      this.undoStack.push(action);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redo the last undone action\r\n   */\r\n  async redo(): Promise<boolean> {\r\n    const action = this.redoStack.pop();\r\n    if (!action || !action.redo) return false;\r\n\r\n    try {\r\n      await action.redo();\r\n      this.undoStack.push(action);\r\n      this.notify();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Redo failed:', error);\r\n      // Put action back on stack\r\n      this.redoStack.push(action);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if undo is available\r\n   */\r\n  canUndo(): boolean {\r\n    return this.undoStack.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Check if redo is available\r\n   */\r\n  canRedo(): boolean {\r\n    return this.redoStack.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Get last undoable action description\r\n   */\r\n  getUndoDescription(): string | null {\r\n    const action = this.undoStack[this.undoStack.length - 1];\r\n    return action?.description ?? null;\r\n  }\r\n\r\n  /**\r\n   * Get last redoable action description\r\n   */\r\n  getRedoDescription(): string | null {\r\n    const action = this.redoStack[this.redoStack.length - 1];\r\n    return action?.description ?? null;\r\n  }\r\n\r\n  /**\r\n   * Clear all undo/redo history\r\n   */\r\n  clear(): void {\r\n    this.undoStack = [];\r\n    this.redoStack = [];\r\n    this.notify();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to changes\r\n   */\r\n  onChange(callback: () => void): () => void {\r\n    this.listeners.add(callback);\r\n    return () => this.listeners.delete(callback);\r\n  }\r\n\r\n  /**\r\n   * Notify listeners of changes\r\n   */\r\n  private notify(): void {\r\n    this.listeners.forEach(fn => fn());\r\n  }\r\n\r\n  /**\r\n   * Get stack sizes for debugging\r\n   */\r\n  getState(): { undoCount: number; redoCount: number } {\r\n    return {\r\n      undoCount: this.undoStack.length,\r\n      redoCount: this.redoStack.length,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton\r\nexport const undoManager = new UndoService();\r\n\r\n// Export class for testing\r\nexport { UndoService };\r\n","/**\r\n * App Store\r\n * Core application state\r\n */\r\n\r\nimport { storage } from '../services/storage';\r\n\r\n// Types\r\nexport interface User {\r\n  id: string;\r\n  email: string;\r\n  role: 'superadmin' | 'admin' | 'member';\r\n  name?: string;\r\n  avatar?: string;\r\n}\r\n\r\nexport interface Project {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  status?: 'active' | 'archived' | 'completed';\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n  ownerId?: string;\r\n  settings?: Record<string, unknown>;\r\n}\r\n\r\nexport interface ProjectConfig {\r\n  aiProvider?: string;\r\n  aiModel?: string;\r\n  language?: string;\r\n  timezone?: string;\r\n  analyticsEnabled?: boolean;\r\n  errorReportingEnabled?: boolean;\r\n  aiImprovementEnabled?: boolean;\r\n}\r\n\r\nexport interface AppState {\r\n  currentProjectId: string | null;\r\n  currentProject: Project | null;\r\n  currentUser: User | null;\r\n  authConfigured: boolean;\r\n  config: ProjectConfig;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  isOnline: boolean;\r\n  version: string;\r\n}\r\n\r\n// Initial state\r\nconst initialState: AppState = {\r\n  currentProjectId: storage.get('currentProjectId', null),\r\n  currentProject: storage.get('currentProject', null),\r\n  currentUser: null,\r\n  authConfigured: false,\r\n  config: {},\r\n  isLoading: false,\r\n  error: null,\r\n  isOnline: navigator.onLine,\r\n  version: '1.0.0',\r\n};\r\n\r\n// State\r\nlet state: AppState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: AppState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners of state change\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): AppState {\r\n  return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: AppState) => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set current project by ID only\r\n */\r\nexport function setCurrentProjectId(projectId: string | null): void {\r\n  state = { ...state, currentProjectId: projectId };\r\n  if (projectId) {\r\n    storage.set('currentProjectId', projectId);\r\n  } else {\r\n    storage.remove('currentProjectId');\r\n    storage.remove('currentProject');\r\n    state = { ...state, currentProject: null };\r\n  }\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set current project (full object)\r\n */\r\nexport function setCurrentProject(project: Project | null): void {\r\n  state = { \r\n    ...state, \r\n    currentProject: project,\r\n    currentProjectId: project?.id || null,\r\n  };\r\n  if (project) {\r\n    storage.set('currentProject', project);\r\n    storage.set('currentProjectId', project.id);\r\n  } else {\r\n    storage.remove('currentProject');\r\n    storage.remove('currentProjectId');\r\n  }\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set current user\r\n */\r\nexport function setCurrentUser(user: User | null): void {\r\n  state = { ...state, currentUser: user };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set auth configured status\r\n */\r\nexport function setAuthConfigured(configured: boolean): void {\r\n  state = { ...state, authConfigured: configured };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set project config\r\n */\r\nexport function setConfig(config: Partial<ProjectConfig>): void {\r\n  state = { ...state, config: { ...state.config, ...config } };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set loading state\r\n */\r\nexport function setLoading(isLoading: boolean): void {\r\n  state = { ...state, isLoading };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set error\r\n */\r\nexport function setError(error: string | null): void {\r\n  state = { ...state, error };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set online status\r\n */\r\nexport function setOnline(online: boolean): void {\r\n  state = { ...state, isOnline: online };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n  state = { ...initialState };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Initialize app store\r\n * Sets up online/offline listeners\r\n */\r\nexport function initAppStore(): void {\r\n  window.addEventListener('online', () => setOnline(true));\r\n  window.addEventListener('offline', () => setOnline(false));\r\n}\r\n\r\n// Export as namespace\r\nexport const appStore = {\r\n  getState,\r\n  subscribe,\r\n  setCurrentProject,\r\n  setCurrentProjectId,\r\n  setCurrentUser,\r\n  setAuthConfigured,\r\n  setConfig,\r\n  setLoading,\r\n  setError,\r\n  setOnline,\r\n  reset,\r\n  init: initAppStore,\r\n};\r\n","/**\r\n * Auth Service\r\n * Handles authentication state and API calls\r\n */\r\n\r\nimport { http } from './api';\r\nimport { appStore, User } from '../stores/app';\r\nimport { toast } from './toast';\r\n\r\n// Types\r\nexport interface AuthStatus {\r\n  configured: boolean;\r\n  url?: string;\r\n}\r\n\r\nexport interface LoginRequest {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nexport interface RegisterRequest {\r\n  email: string;\r\n  password: string;\r\n  username?: string;\r\n  display_name?: string;\r\n}\r\n\r\nexport interface AuthUser {\r\n  id: string;\r\n  email: string;\r\n  email_confirmed_at?: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  user_metadata?: {\r\n    username?: string;\r\n    display_name?: string;\r\n  };\r\n  profile?: UserProfile | null;\r\n}\r\n\r\nexport interface UserProfile {\r\n  id: string;\r\n  username?: string;\r\n  display_name?: string;\r\n  avatar_url?: string;\r\n  timezone?: string;\r\n  preferences?: Record<string, unknown>;\r\n  role?: 'user' | 'admin' | 'superadmin'; // Application role from user_profiles table\r\n}\r\n\r\nexport interface LoginResponse {\r\n  success: boolean;\r\n  user: AuthUser;\r\n}\r\n\r\nexport interface RegisterResponse {\r\n  success: boolean;\r\n  user: AuthUser;\r\n  session?: {\r\n    access_token: string;\r\n    refresh_token: string;\r\n    expires_at: number;\r\n  };\r\n  needsEmailVerification: boolean;\r\n}\r\n\r\nexport interface MeResponse {\r\n  authenticated: boolean;\r\n  user: AuthUser | null;\r\n}\r\n\r\n// Auth state\r\nlet isInitialized = false;\r\nlet authCheckPromise: Promise<boolean> | null = null;\r\n\r\n/**\r\n * Check if authentication is configured (Supabase)\r\n */\r\nexport async function checkAuthStatus(): Promise<AuthStatus> {\r\n  try {\r\n    const response = await http.get<AuthStatus>('/api/auth/status');\r\n    const configured = response.data.configured;\r\n    appStore.setAuthConfigured(configured);\r\n    return response.data;\r\n  } catch {\r\n    appStore.setAuthConfigured(false);\r\n    return { configured: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Check current session and get user\r\n */\r\nexport async function checkSession(): Promise<User | null> {\r\n  try {\r\n    const response = await http.get<MeResponse>('/api/auth/me');\r\n    \r\n    if (response.data.authenticated && response.data.user) {\r\n      const authUser = response.data.user;\r\n      const user = mapAuthUserToUser(authUser);\r\n      appStore.setCurrentUser(user);\r\n      return user;\r\n    }\r\n    \r\n    appStore.setCurrentUser(null);\r\n    return null;\r\n  } catch {\r\n    appStore.setCurrentUser(null);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize auth - check status and session\r\n * When Supabase is configured, always requires valid authentication\r\n */\r\nexport async function initAuth(): Promise<boolean> {\r\n  // Prevent multiple simultaneous checks\r\n  if (authCheckPromise) {\r\n    return authCheckPromise;\r\n  }\r\n\r\n  authCheckPromise = (async () => {\r\n    try {\r\n      // Check if auth is configured\r\n      const status = await checkAuthStatus();\r\n      \r\n      if (!status.configured) {\r\n        // Auth not configured - allow guest mode\r\n        isInitialized = true;\r\n        return false;\r\n      }\r\n\r\n      // Auth is configured - check current session\r\n      // If session is invalid, user MUST login\r\n      const user = await checkSession();\r\n      isInitialized = true;\r\n      \r\n      if (!user) {\r\n        // No valid session - clear any stale user data\r\n        appStore.setCurrentUser(null);\r\n        console.log(' Supabase configured but no valid session - login required');\r\n        return false;\r\n      }\r\n      \r\n      return true;\r\n    } catch {\r\n      // Auth check failed - clear user and require login\r\n      appStore.setCurrentUser(null);\r\n      isInitialized = true;\r\n      return false;\r\n    } finally {\r\n      authCheckPromise = null;\r\n    }\r\n  })();\r\n\r\n  return authCheckPromise;\r\n}\r\n\r\n/**\r\n * Login with email and password\r\n */\r\nexport async function login(credentials: LoginRequest): Promise<User> {\r\n  const response = await http.post<LoginResponse>('/api/auth/login', credentials);\r\n  \r\n  if (!response.data.success) {\r\n    throw new Error('Login failed');\r\n  }\r\n\r\n  const user = mapAuthUserToUser(response.data.user);\r\n  appStore.setCurrentUser(user);\r\n  return user;\r\n}\r\n\r\n/**\r\n * Register new account\r\n */\r\nexport async function register(data: RegisterRequest): Promise<{ user: User; needsEmailVerification: boolean }> {\r\n  // Validate password length (min 12 chars as per server)\r\n  if (data.password.length < 12) {\r\n    throw new Error('Password must be at least 12 characters');\r\n  }\r\n\r\n  // Validate username if provided\r\n  if (data.username && data.username.length < 3) {\r\n    throw new Error('Username must be at least 3 characters');\r\n  }\r\n\r\n  if (data.username && !/^[a-zA-Z0-9_]+$/.test(data.username)) {\r\n    throw new Error('Username can only contain letters, numbers, and underscores');\r\n  }\r\n\r\n  const response = await http.post<RegisterResponse>('/api/auth/register', data);\r\n  \r\n  if (!response.data.success) {\r\n    throw new Error('Registration failed');\r\n  }\r\n\r\n  const user = mapAuthUserToUser(response.data.user);\r\n  \r\n  // Only set user if no email verification required\r\n  if (!response.data.needsEmailVerification) {\r\n    appStore.setCurrentUser(user);\r\n  }\r\n\r\n  return { \r\n    user, \r\n    needsEmailVerification: response.data.needsEmailVerification \r\n  };\r\n}\r\n\r\n/**\r\n * Logout current user\r\n */\r\nexport async function logout(): Promise<void> {\r\n  try {\r\n    await http.post('/api/auth/logout');\r\n  } catch {\r\n    // Ignore logout errors - clear local state anyway\r\n  }\r\n  \r\n  appStore.setCurrentUser(null);\r\n  appStore.setCurrentProject(null);\r\n}\r\n\r\n/**\r\n * Request password reset\r\n */\r\nexport async function forgotPassword(email: string): Promise<void> {\r\n  await http.post('/api/auth/forgot-password', { email });\r\n  // Always succeeds - doesn't reveal if email exists\r\n}\r\n\r\n/**\r\n * Reset password with token\r\n */\r\nexport async function resetPassword(password: string, accessToken: string): Promise<void> {\r\n  if (password.length < 12) {\r\n    throw new Error('Password must be at least 12 characters');\r\n  }\r\n\r\n  const response = await http.post<{ success: boolean }>('/api/auth/reset-password', {\r\n    password,\r\n    access_token: accessToken,\r\n  });\r\n\r\n  if (!response.data.success) {\r\n    throw new Error('Password reset failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Refresh session token\r\n */\r\nexport async function refreshSession(): Promise<boolean> {\r\n  try {\r\n    const response = await http.post<{ success: boolean }>('/api/auth/refresh');\r\n    return response.data.success;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Map AuthUser to app User type\r\n * Note: role here is the APPLICATION role (superadmin/user) from user_profiles,\r\n * NOT the project role (owner/admin/write/read) from project_members\r\n */\r\nfunction mapAuthUserToUser(authUser: AuthUser): User {\r\n  const profile = authUser.profile;\r\n  const metadata = authUser.user_metadata || {};\r\n\r\n  return {\r\n    id: authUser.id,\r\n    email: authUser.email,\r\n    name: profile?.display_name || metadata.display_name || metadata.username || authUser.email.split('@')[0],\r\n    avatar: profile?.avatar_url,\r\n    role: profile?.role === 'superadmin' ? 'superadmin' : (profile?.role === 'admin' ? 'admin' : 'member'), // Map to app roles\r\n  };\r\n}\r\n\r\n/**\r\n * Check if user is authenticated\r\n */\r\nexport function isAuthenticated(): boolean {\r\n  return appStore.getState().currentUser !== null;\r\n}\r\n\r\n/**\r\n * Check if auth is initialized\r\n */\r\nexport function isAuthInitialized(): boolean {\r\n  return isInitialized;\r\n}\r\n\r\n/**\r\n * Get current user\r\n */\r\nexport function getCurrentUser(): User | null {\r\n  return appStore.getState().currentUser;\r\n}\r\n\r\n/**\r\n * Listen for auth required events\r\n */\r\nexport function onAuthRequired(callback: () => void): () => void {\r\n  const handler = () => callback();\r\n  window.addEventListener('godmode:auth-required', handler);\r\n  return () => window.removeEventListener('godmode:auth-required', handler);\r\n}\r\n\r\n/**\r\n * Trigger auth required event\r\n */\r\nexport function triggerAuthRequired(): void {\r\n  window.dispatchEvent(new CustomEvent('godmode:auth-required'));\r\n}\r\n\r\n// Export as namespace\r\nexport const auth = {\r\n  checkStatus: checkAuthStatus,\r\n  checkSession,\r\n  init: initAuth,\r\n  login,\r\n  register,\r\n  logout,\r\n  forgotPassword,\r\n  resetPassword,\r\n  refreshSession,\r\n  isAuthenticated,\r\n  isInitialized: isAuthInitialized,\r\n  getCurrentUser,\r\n  onAuthRequired,\r\n  triggerAuthRequired,\r\n};\r\n","/**\r\n * Data Store\r\n * Application data cache\r\n */\r\n\r\nimport type { Fact } from '../services/facts';\r\n\r\n// Types\r\nexport interface Question {\r\n  id: string;\r\n  content: string;  // Primary field (API uses this)\r\n  question?: string;  // Legacy field for backwards compatibility\r\n  context?: string;\r\n  answer?: string;\r\n  answer_source?: string;\r\n  status: 'open' | 'answered' | 'dismissed' | 'pending' | 'assigned' | 'resolved' | 'reopened' | 'closed' | 'deferred';\r\n  priority: 'critical' | 'high' | 'medium' | 'low';\r\n  category?: string;\r\n  source?: string;\r\n  source_file?: string;\r\n  created_at?: string;  // API format\r\n  createdAt?: string;   // Legacy format\r\n  updated_at?: string;  // API format\r\n  updatedAt?: string;   // Legacy format\r\n  assigned_to?: string;\r\n  answered_by_contact_id?: string;\r\n  answered_by_name?: string;\r\n  follow_up_to?: string;\r\n  // SOTA fields\r\n  sla_hours?: number;\r\n  sla_breached?: boolean;\r\n  extracted_entities?: Array<{ type: string; name: string; entity_id?: string; confidence?: number }>;\r\n  extracted_topics?: Array<{ name: string; type?: string; confidence?: number }>;\r\n}\r\n\r\nexport interface Risk {\r\n  id: string | number;\r\n  content?: string;\r\n  description?: string;\r\n  impact: 'high' | 'medium' | 'low' | 'critical';\r\n  probability?: 'high' | 'medium' | 'low';\r\n  likelihood?: 'high' | 'medium' | 'low';\r\n  mitigation?: string;\r\n  owner?: string;\r\n  status: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\r\n  createdAt?: string;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface Action {\r\n  id: string;\r\n  task: string;\r\n  assignee?: string;\r\n  dueDate?: string;\r\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\r\n  priority: 'high' | 'medium' | 'low';\r\n  createdAt: string;\r\n}\r\n\r\nexport interface Decision {\r\n  id: string | number;\r\n  decision: string;\r\n  content?: string;\r\n  rationale?: string;\r\n  madeBy?: string;\r\n  made_by?: string;\r\n  madeAt: string;\r\n  decided_at?: string;\r\n  status: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\r\n  source?: string;\r\n  source_file?: string;\r\n  owner?: string;\r\n  [key: string]: unknown; // Allow additional properties\r\n}\r\n\r\nexport interface Contact {\r\n  id: string;\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  company?: string;\r\n  organization?: string;\r\n  role?: string;\r\n  rolePrompt?: string;\r\n  department?: string;\r\n  linkedin?: string;\r\n  timezone?: string;\r\n  location?: string;\r\n  photoUrl?: string;\r\n  avatarUrl?: string;\r\n  photo_url?: string;\r\n  avatar_url?: string;\r\n  notes?: string;\r\n  tags?: string[];\r\n  aliases?: string[];\r\n  isFavorite?: boolean;\r\n  is_favorite?: boolean;\r\n}\r\n\r\nexport interface ChatSource {\r\n  id: string;\r\n  type: string;\r\n  score: number;\r\n  rrfScore?: number;\r\n  semanticScore?: number;\r\n  keywordScore?: number;\r\n  sourceCount?: number;\r\n  source?: string;\r\n  contactName?: string;\r\n  contactRole?: string;\r\n  avatarUrl?: string;\r\n}\r\n\r\nexport interface ChatRAGInfo {\r\n  method: string;\r\n  vectorResults: number;\r\n  graphResults: number;\r\n  fusedResults: number;\r\n  usedHyDE: boolean;\r\n  entityFilter?: string[];\r\n}\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  timestamp: string;\r\n  sources?: ChatSource[] | string[];\r\n  queryType?: string;\r\n  confidence?: 'high' | 'medium' | 'low';\r\n  contextQuality?: string;\r\n  rag?: ChatRAGInfo;\r\n}\r\n\r\nexport interface DataState {\r\n  questions: Question[];\r\n  risks: Risk[];\r\n  actions: Action[];\r\n  decisions: Decision[];\r\n  facts: Fact[];\r\n  contacts: Contact[];\r\n  chatHistory: ChatMessage[];\r\n  projects: Array<{ id: string; name: string }>;\r\n  lastUpdated: Record<string, number>;\r\n}\r\n\r\n// Initial state\r\nconst initialState: DataState = {\r\n  questions: [],\r\n  risks: [],\r\n  actions: [],\r\n  decisions: [],\r\n  facts: [],\r\n  contacts: [],\r\n  chatHistory: [],\r\n  projects: [],\r\n  lastUpdated: {},\r\n};\r\n\r\n// State\r\nlet state: DataState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: DataState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): DataState {\r\n  return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: DataState) => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set questions\r\n */\r\nexport function setQuestions(questions: Question[]): void {\r\n  state = { \r\n    ...state, \r\n    questions,\r\n    lastUpdated: { ...state.lastUpdated, questions: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set risks\r\n */\r\nexport function setRisks(risks: Risk[]): void {\r\n  state = { \r\n    ...state, \r\n    risks,\r\n    lastUpdated: { ...state.lastUpdated, risks: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set actions\r\n */\r\nexport function setActions(actions: Action[]): void {\r\n  state = { \r\n    ...state, \r\n    actions,\r\n    lastUpdated: { ...state.lastUpdated, actions: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set decisions\r\n */\r\nexport function setDecisions(decisions: Decision[]): void {\r\n  state = { \r\n    ...state, \r\n    decisions,\r\n    lastUpdated: { ...state.lastUpdated, decisions: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set facts\r\n */\r\nexport function setFacts(facts: Fact[]): void {\r\n  state = { \r\n    ...state, \r\n    facts,\r\n    lastUpdated: { ...state.lastUpdated, facts: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set contacts\r\n */\r\nexport function setContacts(contacts: Contact[]): void {\r\n  state = { \r\n    ...state, \r\n    contacts,\r\n    lastUpdated: { ...state.lastUpdated, contacts: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set chat history\r\n */\r\nexport function setChatHistory(chatHistory: ChatMessage[]): void {\r\n  state = { ...state, chatHistory };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Add chat message\r\n */\r\nexport function addChatMessage(message: ChatMessage): void {\r\n  state = { ...state, chatHistory: [...state.chatHistory, message] };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set projects\r\n */\r\nexport function setProjects(projects: Array<{ id: string; name: string }>): void {\r\n  state = { \r\n    ...state, \r\n    projects,\r\n    lastUpdated: { ...state.lastUpdated, projects: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Clear chat history\r\n */\r\nexport function clearChatHistory(): void {\r\n  state = { ...state, chatHistory: [] };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n  state = { ...initialState };\r\n  notify();\r\n}\r\n\r\n// Export as namespace\r\nexport const dataStore = {\r\n  getState,\r\n  subscribe,\r\n  setQuestions,\r\n  setRisks,\r\n  setActions,\r\n  setDecisions,\r\n  setFacts,\r\n  setContacts,\r\n  setChatHistory,\r\n  addChatMessage,\r\n  setProjects,\r\n  clearChatHistory,\r\n  reset,\r\n};\r\n","/**\r\n * Projects Service\r\n * Handles project CRUD operations and state\r\n */\r\n\r\nimport { http } from './api';\r\nimport { appStore, Project } from '../stores/app';\r\nimport { dataStore } from '../stores/data';\r\nimport { toast } from './toast';\r\n\r\n// Types\r\nexport interface ProjectListItem {\r\n  id: string;\r\n  name: string;\r\n  isDefault?: boolean;\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n}\r\n\r\nexport interface CreateProjectRequest {\r\n  name: string;\r\n  description?: string;\r\n  userRole?: string;\r\n  userRolePrompt?: string;\r\n}\r\n\r\nexport interface UpdateProjectRequest {\r\n  name?: string;\r\n  description?: string;\r\n  userRole?: string;\r\n  userRolePrompt?: string;\r\n  isDefault?: boolean;\r\n}\r\n\r\nexport interface ProjectStats {\r\n  members?: number;\r\n  comments?: number;\r\n  recentActivity?: number;\r\n  facts?: number;\r\n  questions?: number;\r\n  documents?: number;\r\n  decisions?: number;\r\n  risks?: number;\r\n  actions?: number;\r\n  people?: number;\r\n}\r\n\r\n/**\r\n * Get all projects\r\n */\r\nexport async function getProjects(): Promise<ProjectListItem[]> {\r\n  try {\r\n    const response = await http.get<{ projects: ProjectListItem[] }>('/api/projects');\r\n    const projects = response.data.projects || [];\r\n    dataStore.setProjects(projects);\r\n    return projects;\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get current/active project\r\n */\r\nexport async function getCurrentProject(): Promise<Project | null> {\r\n  try {\r\n    const response = await http.get<{ project: Project }>('/api/projects/current');\r\n    const project = response.data.project;\r\n    if (project) {\r\n      appStore.setCurrentProject(project);\r\n      return project;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new project\r\n */\r\nexport async function createProject(data: CreateProjectRequest): Promise<Project> {\r\n  const response = await http.post<{ id: string; name?: string }>('/api/projects', data);\r\n  \r\n  const project: Project = {\r\n    id: response.data.id,\r\n    name: data.name,\r\n    description: data.description,\r\n  };\r\n\r\n  // Refresh projects list\r\n  await getProjects();\r\n  \r\n  return project;\r\n}\r\n\r\n/**\r\n * Update a project\r\n */\r\nexport async function updateProject(id: string, data: UpdateProjectRequest): Promise<void> {\r\n  await http.put(`/api/projects/${id}`, data);\r\n\r\n  // Update local state if it's the current project\r\n  const currentProject = appStore.getState().currentProject;\r\n  if (currentProject?.id === id) {\r\n    appStore.setCurrentProject({\r\n      ...currentProject,\r\n      ...data,\r\n    });\r\n  }\r\n\r\n  // Refresh projects list\r\n  await getProjects();\r\n}\r\n\r\n/**\r\n * Delete a project\r\n */\r\nexport async function deleteProject(id: string): Promise<void> {\r\n  await http.delete(`/api/projects/${id}`);\r\n\r\n  // Clear current project if it was deleted\r\n  if (appStore.getState().currentProjectId === id) {\r\n    appStore.setCurrentProject(null);\r\n  }\r\n\r\n  // Refresh projects list\r\n  await getProjects();\r\n}\r\n\r\n/**\r\n * Activate/switch to a project\r\n */\r\nexport async function activateProject(id: string): Promise<Project | null> {\r\n  try {\r\n    await http.put(`/api/projects/${id}/activate`);\r\n    \r\n    // Get the full project info\r\n    const project = await getCurrentProject();\r\n    return project;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Set a project as default\r\n */\r\nexport async function setDefaultProject(id: string): Promise<void> {\r\n  await http.post(`/api/projects/${id}/set-default`);\r\n  await getProjects();\r\n}\r\n\r\n/**\r\n * Get project statistics\r\n */\r\nexport async function getProjectStats(id: string): Promise<ProjectStats> {\r\n  try {\r\n    const response = await http.get<{ stats: ProjectStats }>(`/api/projects/${id}/stats`);\r\n    return response.data.stats || {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Export project data\r\n */\r\nexport async function exportProject(id: string): Promise<Blob> {\r\n  const response = await fetch(`/api/projects/${id}/export`);\r\n  if (!response.ok) {\r\n    throw new Error('Failed to export project');\r\n  }\r\n  return response.blob();\r\n}\r\n\r\n/**\r\n * Import project data\r\n */\r\nexport async function importProject(file: File): Promise<Project> {\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n\r\n  const response = await fetch('/api/projects/import', {\r\n    method: 'POST',\r\n    body: formData,\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({ error: 'Import failed' }));\r\n    throw new Error(error.error || 'Import failed');\r\n  }\r\n\r\n  const data = await response.json();\r\n  await getProjects();\r\n  \r\n  return data.project;\r\n}\r\n\r\n/**\r\n * Initialize projects - load list and set current\r\n */\r\nexport async function initProjects(): Promise<void> {\r\n  // Load all projects\r\n  await getProjects();\r\n\r\n  // Try to get current project from server\r\n  const current = await getCurrentProject();\r\n  \r\n  // If no current project, try to find default or first project\r\n  if (!current) {\r\n    const projects = dataStore.getState().projects;\r\n    if (projects.length > 0) {\r\n      const defaultProject = projects.find(p => (p as { isDefault?: boolean }).isDefault) || projects[0];\r\n      await activateProject(defaultProject.id);\r\n    }\r\n  }\r\n}\r\n\r\n// Export as namespace\r\nexport const projects = {\r\n  getAll: getProjects,\r\n  getCurrent: getCurrentProject,\r\n  create: createProject,\r\n  update: updateProject,\r\n  delete: deleteProject,\r\n  activate: activateProject,\r\n  setDefault: setDefaultProject,\r\n  getStats: getProjectStats,\r\n  export: exportProject,\r\n  import: importProject,\r\n  init: initProjects,\r\n};\r\n","/**\r\n * Dashboard Service\r\n * Fetches dashboard data, stats, trends, and health metrics\r\n */\r\n\r\nimport { http } from './api';\r\n\r\n// Types\r\nexport interface DashboardData {\r\n  documents: {\r\n    total: number;\r\n    processed: number;\r\n    pending: number;\r\n  };\r\n  totalFacts: number;\r\n  factsByCategory?: Record<string, number>;\r\n  factsVerifiedCount?: number;\r\n  totalQuestions: number;\r\n  totalDecisions: number;\r\n  totalRisks: number;\r\n  totalActions: number;\r\n  totalPeople: number;\r\n  questionsByPriority: {\r\n    critical: number;\r\n    high: number;\r\n    medium: number;\r\n    resolved: number;\r\n  };\r\n  risksByImpact: {\r\n    high: number;\r\n    medium: number;\r\n    low: number;\r\n  };\r\n  overdueActions: number;\r\n  overdueItems: Array<{\r\n    id: string;\r\n    content: string;\r\n    assignee?: string;\r\n    due_date?: string;\r\n  }>;\r\n  questionAging: {\r\n    fresh: number;    // 0-3 days\r\n    aging: number;    // 4-7 days\r\n    stale: number;    // 8-14 days\r\n    critical: number; // 14+ days\r\n  };\r\n  oldestQuestions: Array<{\r\n    id: string;\r\n    content: string;\r\n    created_at: string;\r\n    priority?: string;\r\n  }>;\r\n  trends?: TrendData;\r\n  trendInsights?: Record<string, unknown>;\r\n}\r\n\r\nexport interface TrendData {\r\n  hasTrends: boolean;\r\n  periodDays: number;\r\n  compareDate: string;\r\n  facts: TrendMetric;\r\n  questions: TrendMetric;\r\n  risks: TrendMetric;\r\n  actions: TrendMetric;\r\n  decisions: TrendMetric;\r\n}\r\n\r\nexport interface TrendMetric {\r\n  current: number;\r\n  previous: number;\r\n  delta: number;\r\n  direction: 'up' | 'down' | 'stable';\r\n  sentiment: 'positive' | 'negative' | 'neutral';\r\n}\r\n\r\nexport interface TrendHistory {\r\n  date: string;\r\n  facts: number;\r\n  questions: number;\r\n  risks: number;\r\n  actions: number;\r\n  decisions: number;\r\n  // Index signature for dynamic access\r\n  [key: string]: string | number;\r\n}\r\n\r\nexport interface HealthData {\r\n  score: number; // 0-100\r\n  status: 'Healthy' | 'Good' | 'Needs Attention' | 'At Risk' | 'Critical';\r\n  color: string;\r\n  factors: Array<{\r\n    type: 'positive' | 'negative';\r\n    factor: string;\r\n    impact: number;\r\n    detail: string;\r\n  }>;\r\n  calculatedAt: string;\r\n}\r\n\r\nexport interface Insight {\r\n  type: 'warning' | 'alert' | 'info' | 'positive';\r\n  icon: string;\r\n  title: string;\r\n  message: string;\r\n  suggestion: string;\r\n  category: 'workload' | 'risk' | 'timeline' | 'knowledge' | 'progress';\r\n}\r\n\r\nexport interface Alert {\r\n  severity: 'critical' | 'high' | 'warning';\r\n  type: 'action' | 'risk' | 'question';\r\n  title: string;\r\n  message: string;\r\n  owner?: string;\r\n  assignee?: string;\r\n  id: string | number;\r\n}\r\n\r\n/**\r\n * Get full dashboard data\r\n */\r\nexport async function getDashboard(): Promise<DashboardData | null> {\r\n  try {\r\n    const response = await http.get<DashboardData>('/api/dashboard');\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get basic stats\r\n */\r\nexport async function getStats(): Promise<{\r\n  documents: { total: number; processed: number; pending: number };\r\n  facts: number;\r\n  questions: { total: number; pending: number; resolved: number; critical: number };\r\n  decisions: number;\r\n  risks: number;\r\n  people: number;\r\n} | null> {\r\n  try {\r\n    const response = await http.get('/api/stats');\r\n    return response.data as {\r\n      documents: { total: number; processed: number; pending: number };\r\n      facts: number;\r\n      questions: { total: number; pending: number; resolved: number; critical: number };\r\n      decisions: number;\r\n      risks: number;\r\n      people: number;\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get trends data\r\n */\r\nexport async function getTrends(days = 7): Promise<{\r\n  trends: TrendData;\r\n  history: TrendHistory[];\r\n} | null> {\r\n  try {\r\n    const response = await http.get<{ trends: TrendData; history: TrendHistory[] }>(`/api/trends?days=${days}`);\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get health score\r\n */\r\nexport async function getHealth(): Promise<HealthData | null> {\r\n  try {\r\n    const response = await http.get<HealthData>('/api/sot/health');\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get insights\r\n */\r\nexport async function getInsights(): Promise<Insight[]> {\r\n  try {\r\n    const response = await http.get<{ insights: Insight[] }>('/api/sot/insights');\r\n    return response.data.insights || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get alerts\r\n */\r\nexport async function getAlerts(): Promise<Alert[]> {\r\n  try {\r\n    const response = await http.get<{ alerts: Alert[] }>('/api/sot/alerts');\r\n    return response.data.alerts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Load all dashboard data in parallel\r\n */\r\nexport async function loadDashboardData(): Promise<{\r\n  dashboard: DashboardData | null;\r\n  health: HealthData | null;\r\n  insights: Insight[];\r\n  alerts: Alert[];\r\n}> {\r\n  const [dashboard, health, insights, alerts] = await Promise.all([\r\n    getDashboard(),\r\n    getHealth(),\r\n    getInsights(),\r\n    getAlerts(),\r\n  ]);\r\n\r\n  return { dashboard, health, insights, alerts };\r\n}\r\n\r\n// Export as namespace\r\nexport const dashboardService = {\r\n  getDashboard,\r\n  getStats,\r\n  getTrends,\r\n  getHealth,\r\n  getInsights,\r\n  getAlerts,\r\n  loadAll: loadDashboardData,\r\n};\r\n","/**\r\n * Questions Service\r\n * Handles question CRUD, answering, and AI suggestions\r\n */\r\n\r\nimport { http } from './api';\r\n\r\n// Types\r\nexport interface Question {\r\n  id: string | number;\r\n  content: string;\r\n  context?: string;\r\n  priority: 'low' | 'medium' | 'high' | 'critical';\r\n  status: 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed' | 'open' | 'answered' | 'closed' | 'deferred';\r\n  assigned_to?: string;\r\n  assigned_at?: string;\r\n  answer?: string;\r\n  answer_source?: 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai';\r\n  answered_at?: string;\r\n  answered_by_contact_id?: string;\r\n  answered_by_name?: string;\r\n  answer_provenance?: {\r\n    sources: Array<{ type: string; id?: string; content: string; confidence: number }>;\r\n    synthesis_method?: string;\r\n  };\r\n  category?: string;\r\n  source_file?: string;\r\n  created_at: string;\r\n  updated_at?: string;\r\n  resolved_at?: string;\r\n  previous_answer?: string;\r\n  edit_history?: Array<{\r\n    answer: string;\r\n    edited_at: string;\r\n  }>;\r\n  cached_suggestions?: AssigneeSuggestion[];\r\n  suggestions_generated_at?: string;\r\n  why?: string;\r\n  confidence?: number;\r\n  // SOTA fields\r\n  extracted_entities?: Array<{ type: string; name: string; entity_id?: string; confidence?: number }>;\r\n  extracted_topics?: Array<{ name: string; type?: string; confidence?: number }>;\r\n  sla_hours?: number;\r\n  sla_breached?: boolean;\r\n  sla_breached_at?: string;\r\n  follow_up_to?: string;\r\n  generation_source?: 'manual' | 'extracted' | 'template' | 'ai_generated';\r\n  cluster_id?: number;\r\n  cluster_label?: string;\r\n  // Dismissed tracking\r\n  dismissed_at?: string;\r\n  dismissed_by?: string;\r\n  dismissed_reason?: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other';\r\n  // Deferred tracking\r\n  deferred_at?: string;\r\n  deferred_by?: string;\r\n  deferred_until?: string;\r\n  deferred_reason?: string;\r\n  // Reopened tracking\r\n  reopened_at?: string;\r\n  reopened_by?: string;\r\n  reopened_reason?: string;\r\n  reopen_count?: number;\r\n  // Resolution type\r\n  resolution_type?: 'answered_manual' | 'answered_auto' | 'answered_ai' | 'dismissed' | 'merged' | 'superseded';\r\n  // Merged/Superseded\r\n  merged_into_id?: string;\r\n  superseded_by_id?: string;\r\n  // Usefulness feedback\r\n  was_useful?: boolean;\r\n  usefulness_feedback?: string;\r\n  // Requester role - who the question is FROM (their perspective)\r\n  requester_role?: string;\r\n  requester_role_prompt?: string;\r\n  requester_contact_id?: string;\r\n  requester_name?: string;\r\n}\r\n\r\nexport interface CreateQuestionRequest {\r\n  content: string;\r\n  priority?: 'low' | 'medium' | 'high' | 'critical';\r\n  assigned_to?: string;\r\n  context?: string;\r\n  skipDedup?: boolean;\r\n}\r\n\r\nexport interface UpdateQuestionRequest {\r\n  content?: string;\r\n  context?: string;\r\n  priority?: 'low' | 'medium' | 'high' | 'critical';\r\n  status?: 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed';\r\n  assigned_to?: string;\r\n  category?: string;\r\n  reopen_reason?: string;\r\n  dismissed_reason?: string;\r\n}\r\n\r\nexport interface AnswerQuestionRequest {\r\n  answer: string;\r\n  source?: 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai';\r\n  followupQuestions?: string;\r\n  answeredByContactId?: string;\r\n  answeredByName?: string;\r\n  answerProvenance?: {\r\n    sources: Array<{ type: string; id?: string; content: string; confidence: number }>;\r\n    synthesis_method?: string;\r\n  };\r\n}\r\n\r\nexport interface AssigneeSuggestion {\r\n  person: string;\r\n  score: number;\r\n  reason: string;\r\n  contactId?: string;\r\n  role?: string;\r\n  organization?: string;\r\n  method: string;\r\n}\r\n\r\nexport interface CreateQuestionResponse {\r\n  success: boolean;\r\n  id?: number;\r\n  action?: string;\r\n  duplicate?: boolean;\r\n  existingId?: number;\r\n  similarity?: number;\r\n  message?: string;\r\n}\r\n\r\nexport interface AnswerQuestionResponse {\r\n  success: boolean;\r\n  question: Question;\r\n  followupsCreated: number;\r\n  message: string;\r\n}\r\n\r\nexport interface SuggestAssigneeResponse {\r\n  suggestions: AssigneeSuggestion[];\r\n  category: string;\r\n  method: string;\r\n  cached: boolean;\r\n  cachedAt?: string;\r\n}\r\n\r\n/**\r\n * Get all questions\r\n */\r\nexport async function getQuestions(filters?: {\r\n  status?: string;\r\n  priority?: string;\r\n}): Promise<Question[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (filters?.status) params.set('status', filters.status);\r\n    if (filters?.priority) params.set('priority', filters.priority);\r\n    \r\n    const query = params.toString();\r\n    const url = query ? `/api/questions?${query}` : '/api/questions';\r\n    \r\n    const response = await http.get<{ questions: Question[] }>(url);\r\n    return response.data.questions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new question\r\n */\r\nexport async function createQuestion(data: CreateQuestionRequest): Promise<CreateQuestionResponse> {\r\n  const response = await http.post<CreateQuestionResponse>('/api/questions', data);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Update a question\r\n */\r\nexport async function updateQuestion(id: string | number, data: UpdateQuestionRequest): Promise<Question> {\r\n  const response = await http.put<{ question: Question }>(`/api/questions/${id}`, data);\r\n  return response.data.question;\r\n}\r\n\r\n/**\r\n * Delete/dismiss a question\r\n */\r\nexport async function deleteQuestion(id: string | number, reason?: string): Promise<void> {\r\n  await http.delete(`/api/questions/${id}`, {\r\n    body: JSON.stringify({ reason }),\r\n  });\r\n}\r\n\r\n/**\r\n * Answer a question\r\n */\r\nexport async function answerQuestion(\r\n  id: string | number, \r\n  data: AnswerQuestionRequest\r\n): Promise<AnswerQuestionResponse> {\r\n  const response = await http.post<AnswerQuestionResponse>(`/api/questions/${id}/answer`, data);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get questions grouped by person\r\n */\r\nexport async function getQuestionsByPerson(): Promise<Record<string, Question[]>> {\r\n  try {\r\n    const response = await http.get<{ questionsByPerson: Record<string, Question[]> }>('/api/questions/by-person');\r\n    return response.data.questionsByPerson || {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Get questions grouped by team/category\r\n */\r\nexport async function getQuestionsByTeam(): Promise<Record<string, Question[]>> {\r\n  try {\r\n    const response = await http.get<{ questionsByTeam: Record<string, Question[]> }>('/api/questions/by-team');\r\n    return response.data.questionsByTeam || {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Get AI-powered assignee suggestions\r\n */\r\nexport async function suggestAssignee(options: {\r\n  content?: string;\r\n  id?: string | number;\r\n  useAI?: boolean;\r\n  refresh?: boolean;\r\n}): Promise<SuggestAssigneeResponse> {\r\n  const params = new URLSearchParams();\r\n  if (options.content) params.set('content', options.content);\r\n  if (options.id) params.set('id', String(options.id));\r\n  if (options.useAI === false) params.set('ai', 'false');\r\n  if (options.refresh) params.set('refresh', 'true');\r\n\r\n  const response = await http.get<SuggestAssigneeResponse>(\r\n    `/api/questions/suggest-assignee?${params.toString()}`,\r\n    { timeout: 90000 }\r\n  );\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Reopen a resolved question\r\n */\r\nexport async function reopenQuestion(id: string | number, reason: string): Promise<Question> {\r\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/reopen`, { reason });\r\n  return response.data.question;\r\n}\r\n\r\n/**\r\n * Dismiss a question (permanently close without answer)\r\n */\r\nexport async function dismissQuestion(\r\n  id: string | number, \r\n  reason: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other',\r\n  details?: string\r\n): Promise<Question> {\r\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/dismiss`, { \r\n    reason,\r\n    details \r\n  });\r\n  return response.data.question;\r\n}\r\n\r\n/**\r\n * Defer a question (postpone for later)\r\n */\r\nexport async function deferQuestion(\r\n  id: string | number, \r\n  until: string | Date,\r\n  reason?: string\r\n): Promise<Question> {\r\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/defer`, { \r\n    until: typeof until === 'string' ? until : until.toISOString(),\r\n    reason \r\n  });\r\n  return response.data.question;\r\n}\r\n\r\n/**\r\n * Merge a question into another\r\n */\r\nexport async function mergeQuestion(\r\n  sourceId: string | number,\r\n  targetId: string | number\r\n): Promise<{ source: Question; target: Question }> {\r\n  const response = await http.post<{ source: Question; target: Question }>(\r\n    `/api/questions/${sourceId}/merge`, \r\n    { targetId }\r\n  );\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Submit feedback on an answer\r\n */\r\nexport async function submitAnswerFeedback(\r\n  id: string | number,\r\n  wasUseful: boolean,\r\n  feedback?: string\r\n): Promise<Question> {\r\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/feedback`, { \r\n    wasUseful,\r\n    feedback \r\n  });\r\n  return response.data.question;\r\n}\r\n\r\n/**\r\n * Get deferred questions that are due\r\n */\r\nexport async function getDueDeferredQuestions(): Promise<Question[]> {\r\n  try {\r\n    const response = await http.get<{ questions: Question[] }>('/api/questions/deferred/due');\r\n    return response.data.questions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get question lifecycle stats\r\n */\r\nexport async function getLifecycleStats(): Promise<Record<string, number>> {\r\n  try {\r\n    const response = await http.get<{ stats: Record<string, number> }>('/api/questions/stats/lifecycle');\r\n    return response.data.stats || {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Get question statistics\r\n */\r\nexport function getQuestionStats(questions: Question[]): {\r\n  total: number;\r\n  pending: number;\r\n  assigned: number;\r\n  resolved: number;\r\n  critical: number;\r\n  overdue: number;\r\n} {\r\n  const now = new Date();\r\n  const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n\r\n  return {\r\n    total: questions.length,\r\n    pending: questions.filter(q => q.status === 'pending').length,\r\n    assigned: questions.filter(q => q.status === 'assigned').length,\r\n    resolved: questions.filter(q => q.status === 'resolved').length,\r\n    critical: questions.filter(q => q.priority === 'critical' && q.status !== 'resolved').length,\r\n    overdue: questions.filter(q => {\r\n      if (q.status === 'resolved') return false;\r\n      const created = new Date(q.created_at);\r\n      return created < sevenDaysAgo;\r\n    }).length,\r\n  };\r\n}\r\n\r\n// Export as namespace\r\nexport const questionsService = {\r\n  getAll: getQuestions,\r\n  create: createQuestion,\r\n  update: updateQuestion,\r\n  delete: deleteQuestion,\r\n  answer: answerQuestion,\r\n  getByPerson: getQuestionsByPerson,\r\n  getByTeam: getQuestionsByTeam,\r\n  suggestAssignee,\r\n  reopen: reopenQuestion,\r\n  getStats: getQuestionStats,\r\n  dismissQuestion,\r\n  deferQuestion,\r\n  submitAnswerFeedback,\r\n};\r\n","/**\r\n * Risks Service\r\n * Handles risk CRUD operations\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Risk {\r\n  id: string | number;\r\n  content: string;\r\n  title?: string;\r\n  description?: string;\r\n  impact: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood: 'low' | 'medium' | 'high';\r\n  mitigation?: string;\r\n  contingency?: string;\r\n  status: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\r\n  owner?: string;\r\n  category?: 'technical' | 'schedule' | 'budget' | 'resource' | 'scope' | 'external' | 'other';\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\r\n  created_at: string;\r\n  updated_at?: string;\r\n  deleted_at?: string | null;\r\n}\r\n\r\nexport interface RiskEvent {\r\n  id: string;\r\n  risk_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface CreateRiskRequest {\r\n  content: string;\r\n  title?: string;\r\n  impact?: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood?: 'low' | 'medium' | 'high';\r\n  mitigation?: string;\r\n  owner?: string;\r\n  category?: string;\r\n}\r\n\r\nexport interface UpdateRiskRequest {\r\n  content?: string;\r\n  title?: string;\r\n  impact?: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood?: 'low' | 'medium' | 'high';\r\n  mitigation?: string;\r\n  contingency?: string;\r\n  status?: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\r\n  owner?: string;\r\n  category?: string;\r\n}\r\n\r\n/**\r\n * Get all risks\r\n */\r\nexport async function getRisks(status?: string): Promise<Risk[]> {\r\n  try {\r\n    const url = status ? `/api/risks?status=${status}` : '/api/risks';\r\n    const response = await http.get<{ risks: Risk[] }>(url);\r\n    return response.data.risks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single risk by id\r\n */\r\nexport async function getRisk(id: string | number): Promise<Risk | null> {\r\n  try {\r\n    const response = await http.get<{ risk: Risk }>(`/api/risks/${id}`);\r\n    return response.data.risk ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get soft-deleted risks (for restore)\r\n */\r\nexport async function getDeletedRisks(): Promise<Risk[]> {\r\n  try {\r\n    const response = await http.get<{ risks: Risk[] }>('/api/risks/deleted');\r\n    return response.data.risks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted risk\r\n */\r\nexport async function restoreRisk(id: string | number): Promise<Risk> {\r\n  const response = await http.post<{ risk: Risk }>(`/api/risks/${id}/restore`, {});\r\n  return response.data.risk;\r\n}\r\n\r\n/**\r\n * Get risk timeline events\r\n */\r\nexport async function getRiskEvents(id: string | number): Promise<RiskEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: RiskEvent[] }>(`/api/risks/${id}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get risks grouped by category\r\n */\r\nexport async function getRisksByCategory(): Promise<Record<string, Risk[]>> {\r\n  try {\r\n    const response = await http.get<{ risksByCategory: Record<string, Risk[]> }>('/api/risks/by-category');\r\n    return response.data.risksByCategory || {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new risk\r\n */\r\nexport async function createRisk(data: CreateRiskRequest): Promise<Risk> {\r\n  const response = await http.post<{ risk: Risk; id: string | number }>('/api/risks', data);\r\n  return response.data.risk || { ...data, id: response.data.id, status: 'open', created_at: new Date().toISOString() } as Risk;\r\n}\r\n\r\n/**\r\n * Update a risk\r\n */\r\nexport async function updateRisk(id: string | number, data: UpdateRiskRequest): Promise<Risk> {\r\n  const response = await http.put<{ risk: Risk }>(`/api/risks/${id}`, data);\r\n  return response.data.risk;\r\n}\r\n\r\n/**\r\n * Delete a risk\r\n */\r\nexport async function deleteRisk(id: string | number): Promise<void> {\r\n  await http.delete(`/api/risks/${id}`);\r\n}\r\n\r\n/**\r\n * Calculate risk score (impact x likelihood)\r\n */\r\nexport function calculateRiskScore(impact: string, likelihood: string): number {\r\n  const impactScores: Record<string, number> = { low: 1, medium: 2, high: 3, critical: 4 };\r\n  const likelihoodScores: Record<string, number> = { low: 1, medium: 2, high: 3 };\r\n  return (impactScores[impact] || 2) * (likelihoodScores[likelihood] || 2);\r\n}\r\n\r\n/**\r\n * AI suggest owner and mitigation from risk content\r\n */\r\nexport interface RiskOwnerSuggestion {\r\n  name: string;\r\n  reason: string;\r\n  score?: number;\r\n}\r\n\r\nexport async function suggestRisk(options: { content: string; impact?: string; likelihood?: string; probability?: string }): Promise<{\r\n  suggested_owner: string;\r\n  suggested_mitigation: string;\r\n  suggested_owners: RiskOwnerSuggestion[];\r\n}> {\r\n  const response = await http.post<{\r\n    suggested_owner?: string;\r\n    suggested_mitigation?: string;\r\n    suggested_owners?: RiskOwnerSuggestion[];\r\n    error?: string;\r\n  }>('/api/risks/suggest', {\r\n    content: options.content?.trim() || '',\r\n    impact: options.impact || 'medium',\r\n    likelihood: options.likelihood ?? options.probability ?? 'medium',\r\n  });\r\n  if (response.data.error) throw new Error(response.data.error);\r\n  const owners = Array.isArray(response.data.suggested_owners) ? response.data.suggested_owners : [];\r\n  return {\r\n    suggested_owner: response.data.suggested_owner ?? (owners[0]?.name ?? ''),\r\n    suggested_mitigation: response.data.suggested_mitigation ?? '',\r\n    suggested_owners: owners,\r\n  };\r\n}\r\n\r\n/**\r\n * Get risk matrix data\r\n */\r\nexport function getRiskMatrixData(risks: Risk[]): Record<string, Risk[]> {\r\n  const matrix: Record<string, Risk[]> = {};\r\n  \r\n  risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed').forEach(risk => {\r\n    const impact = (risk.impact || '').toString().toLowerCase();\r\n    const likelihood = (risk.likelihood || '').toString().toLowerCase();\r\n    const key = `${impact}-${likelihood}`;\r\n    if (!matrix[key]) matrix[key] = [];\r\n    matrix[key].push(risk);\r\n  });\r\n  \r\n  return matrix;\r\n}\r\n\r\nexport const risksService = {\r\n  getAll: getRisks,\r\n  get: getRisk,\r\n  getByCategory: getRisksByCategory,\r\n  getDeleted: getDeletedRisks,\r\n  restore: restoreRisk,\r\n  getEvents: getRiskEvents,\r\n  suggest: suggestRisk,\r\n  create: createRisk,\r\n  update: updateRisk,\r\n  delete: deleteRisk,\r\n  calculateScore: calculateRiskScore,\r\n  getMatrixData: getRiskMatrixData,\r\n};\r\n","/**\r\n * Actions Service\r\n * Handles action item CRUD operations\r\n */\r\n\r\nimport { http } from './api';\r\n\r\n/** API returns task, owner, deadline (action_items table). We expose content, assignee, due_date for UI. */\r\nexport interface Action {\r\n  id: string | number;\r\n  /** UI: use content; API may return task */\r\n  content?: string;\r\n  task?: string;\r\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\r\n  /** UI: use assignee; API may return owner */\r\n  assignee?: string;\r\n  owner?: string;\r\n  /** UI: use due_date; API may return deadline */\r\n  due_date?: string;\r\n  deadline?: string;\r\n  priority?: 'low' | 'medium' | 'high' | 'critical';\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  depends_on?: string[];\r\n  blocked_by?: string[];\r\n  created_at: string;\r\n  updated_at?: string;\r\n  completed_at?: string;\r\n}\r\n\r\nexport interface CreateActionRequest {\r\n  content: string;\r\n  status?: 'pending' | 'in_progress' | 'completed' | 'cancelled';\r\n  assignee?: string;\r\n  due_date?: string;\r\n  priority?: 'low' | 'medium' | 'high' | 'critical';\r\n}\r\n\r\nexport interface UpdateActionRequest {\r\n  content?: string;\r\n  task?: string;\r\n  status?: 'pending' | 'in_progress' | 'completed' | 'cancelled';\r\n  assignee?: string;\r\n  owner?: string;\r\n  due_date?: string;\r\n  deadline?: string;\r\n  priority?: 'low' | 'medium' | 'high' | 'critical';\r\n  depends_on?: string[];\r\n  blocked_by?: string[];\r\n}\r\n\r\n/** Normalize API row (task, owner, deadline) to UI shape (content, assignee, due_date) */\r\nfunction normalizeAction(row: Record<string, unknown>): Action {\r\n  return {\r\n    ...row,\r\n    content: (row.content ?? row.task) as string,\r\n    assignee: (row.assignee ?? row.owner) as string | undefined,\r\n    due_date: (row.due_date ?? row.deadline) as string | undefined,\r\n  } as Action;\r\n}\r\n\r\n/**\r\n * Get all actions\r\n */\r\nexport async function getActions(status?: string): Promise<Action[]> {\r\n  try {\r\n    const url = status ? `/api/actions?status=${status}` : '/api/actions';\r\n    const response = await http.get<{ actions: Record<string, unknown>[] }>(url);\r\n    const raw = response.data.actions || [];\r\n    return raw.map(normalizeAction);\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new action\r\n */\r\nexport async function createAction(data: CreateActionRequest): Promise<Action> {\r\n  const payload = {\r\n    content: data.content,\r\n    task: data.content,\r\n    assignee: data.assignee,\r\n    owner: data.assignee,\r\n    due_date: data.due_date,\r\n    deadline: data.due_date,\r\n    status: data.status,\r\n    priority: data.priority,\r\n  };\r\n  const response = await http.post<{ action: Record<string, unknown>; id: string | number }>('/api/actions', payload);\r\n  const raw = response.data.action || { ...payload, id: response.data.id, created_at: new Date().toISOString() };\r\n  return normalizeAction(raw);\r\n}\r\n\r\n/**\r\n * Update an action\r\n */\r\nexport async function updateAction(id: string | number, data: UpdateActionRequest): Promise<Action> {\r\n  const payload = {\r\n    ...data,\r\n    task: data.content ?? data.task,\r\n    owner: data.assignee ?? data.owner,\r\n    deadline: data.due_date ?? data.deadline,\r\n  };\r\n  const response = await http.put<{ action: Record<string, unknown> }>(`/api/actions/${id}`, payload);\r\n  const raw = response.data.action;\r\n  return raw ? normalizeAction(raw) : {} as Action;\r\n}\r\n\r\n/**\r\n * Delete an action\r\n */\r\nexport async function deleteAction(id: string | number): Promise<void> {\r\n  await http.delete(`/api/actions/${id}`);\r\n}\r\n\r\nexport interface ActionEvent {\r\n  id: string;\r\n  action_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface ActionAssigneeSuggestion {\r\n  name: string;\r\n  reason?: string;\r\n  score?: number;\r\n}\r\n\r\n/**\r\n * Suggest assignees for an action from task content (AI + project contacts).\r\n */\r\nexport async function suggestAssignees(options: { content: string }): Promise<{ suggested_assignees: ActionAssigneeSuggestion[] }> {\r\n  try {\r\n    const response = await http.post<{ suggested_assignees: ActionAssigneeSuggestion[] }>('/api/actions/suggest', {\r\n      content: (options.content || '').trim(),\r\n    });\r\n    return {\r\n      suggested_assignees: Array.isArray(response.data.suggested_assignees) ? response.data.suggested_assignees : [],\r\n    };\r\n  } catch {\r\n    return { suggested_assignees: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get action timeline events\r\n */\r\nexport async function getActionEvents(id: string | number): Promise<ActionEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: ActionEvent[] }>(`/api/actions/${id}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Check if action is overdue\r\n */\r\nexport function isOverdue(action: Action): boolean {\r\n  if (!action.due_date || action.status === 'completed' || action.status === 'cancelled') {\r\n    return false;\r\n  }\r\n  return new Date(action.due_date) < new Date();\r\n}\r\n\r\n/**\r\n * Get action statistics\r\n */\r\nexport function getActionStats(actions: Action[]): {\r\n  total: number;\r\n  pending: number;\r\n  inProgress: number;\r\n  completed: number;\r\n  overdue: number;\r\n} {\r\n  return {\r\n    total: actions.length,\r\n    pending: actions.filter(a => a.status === 'pending').length,\r\n    inProgress: actions.filter(a => a.status === 'in_progress').length,\r\n    completed: actions.filter(a => a.status === 'completed').length,\r\n    overdue: actions.filter(a => isOverdue(a)).length,\r\n  };\r\n}\r\n\r\nexport const actionsService = {\r\n  getAll: getActions,\r\n  create: createAction,\r\n  update: updateAction,\r\n  delete: deleteAction,\r\n  getEvents: getActionEvents,\r\n  suggest: suggestAssignees,\r\n  isOverdue,\r\n  getStats: getActionStats,\r\n};\r\n","/**\r\n * Decisions Service\r\n * Handles decision CRUD operations\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Decision {\r\n  id: string | number;\r\n  content: string;\r\n  status: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\r\n  rationale?: string;\r\n  made_by?: string;\r\n  approved_by?: string;\r\n  decided_at?: string;\r\n  impact?: 'low' | 'medium' | 'high';\r\n  reversible?: boolean;\r\n  source?: string;\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  owner?: string;\r\n  context?: string;\r\n  decision_date?: string;\r\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\r\n  created_at: string;\r\n  updated_at?: string;\r\n  summary?: string;\r\n}\r\n\r\nexport interface DecisionSuggestResponse {\r\n  rationale: string;\r\n  impact: 'high' | 'medium' | 'low';\r\n  impact_summary: string;\r\n  summary: string;\r\n}\r\n\r\nexport interface DecisionOwnerSuggestion {\r\n  name: string;\r\n  reason?: string;\r\n  score?: number;\r\n}\r\n\r\nexport interface DecisionEvent {\r\n  id: string;\r\n  decision_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_user_id?: string;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface DecisionConflict {\r\n  decisionId1: string | number;\r\n  decisionId2: string | number;\r\n  decision1: Decision;\r\n  decision2: Decision;\r\n  conflictType: string;\r\n  description?: string;\r\n  reason?: string;\r\n  confidence?: number;\r\n}\r\n\r\nexport interface SimilarDecisionItem {\r\n  decision: Decision;\r\n  similarityScore: number;\r\n}\r\n\r\nexport interface CreateDecisionRequest {\r\n  content: string;\r\n  status?: 'proposed' | 'approved' | 'rejected' | 'deferred';\r\n  rationale?: string;\r\n  made_by?: string;\r\n  impact?: 'low' | 'medium' | 'high';\r\n  summary?: string;\r\n}\r\n\r\nexport interface UpdateDecisionRequest {\r\n  content?: string;\r\n  status?: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\r\n  rationale?: string;\r\n  made_by?: string;\r\n  approved_by?: string;\r\n  decided_at?: string;\r\n  impact?: 'low' | 'medium' | 'high';\r\n  reversible?: boolean;\r\n  summary?: string;\r\n}\r\n\r\n/**\r\n * Get all decisions\r\n */\r\nexport async function getDecisions(status?: string): Promise<Decision[]> {\r\n  try {\r\n    const url = status ? `/api/decisions?status=${status}` : '/api/decisions';\r\n    const response = await http.get<{ decisions: Decision[] }>(url);\r\n    return response.data.decisions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single decision\r\n */\r\nexport async function getDecision(id: string | number): Promise<Decision | null> {\r\n  try {\r\n    const response = await http.get<{ decision: Decision }>(`/api/decisions/${id}`);\r\n    return response.data.decision;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * List soft-deleted decisions (for restore / undo)\r\n */\r\nexport async function getDeletedDecisions(): Promise<Decision[]> {\r\n  try {\r\n    const response = await http.get<{ decisions: Decision[] }>('/api/decisions/deleted');\r\n    return response.data.decisions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted decision\r\n */\r\nexport async function restoreDecision(id: string | number): Promise<Decision> {\r\n  const response = await http.post<{ decision: Decision }>(`/api/decisions/${id}/restore`, {});\r\n  return response.data.decision;\r\n}\r\n\r\n/**\r\n * Get decision events (timeline)\r\n */\r\nexport async function getDecisionEvents(decisionId: string | number): Promise<DecisionEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: DecisionEvent[] }>(`/api/decisions/${decisionId}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get similar decisions\r\n */\r\nexport async function getSimilarDecisions(decisionId: string | number, limit = 10): Promise<SimilarDecisionItem[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (limit !== 10) params.set('limit', String(limit));\r\n    const query = params.toString();\r\n    const url = query ? `/api/decisions/${decisionId}/similar?${query}` : `/api/decisions/${decisionId}/similar`;\r\n    const response = await http.get<{ similar: SimilarDecisionItem[] }>(url);\r\n    return response.data.similar || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Run decision-check (AI conflict detection, records events)\r\n */\r\nexport async function runDecisionCheck(): Promise<{ ok: boolean; conflicts: DecisionConflict[]; analyzed_decisions: number; events_recorded: number }> {\r\n  const response = await http.post<{ ok: boolean; conflicts: DecisionConflict[]; analyzed_decisions: number; events_recorded: number }>('/api/decision-check/run', {});\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Detect conflicts between decisions (no events recorded)\r\n */\r\nexport async function detectConflicts(): Promise<DecisionConflict[]> {\r\n  try {\r\n    const response = await http.get<{ conflicts: DecisionConflict[] }>('/api/conflicts/decisions');\r\n    return response.data.conflicts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * AI suggest: rationale, impact, impact_summary, one-line summary from decision content\r\n */\r\nexport async function suggest(content: string, rationale?: string): Promise<DecisionSuggestResponse> {\r\n  const response = await http.post<DecisionSuggestResponse>('/api/decisions/suggest', {\r\n    content: content.trim(),\r\n    rationale: rationale?.trim() || '',\r\n  });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * AI suggest owner (made_by) from decision content; backend uses project contacts only.\r\n */\r\nexport async function suggestOwner(content: string, rationale?: string): Promise<{ suggested_owners: DecisionOwnerSuggestion[] }> {\r\n  const response = await http.post<{ suggested_owners: DecisionOwnerSuggestion[] }>('/api/decisions/suggest-owner', {\r\n    content: content.trim(),\r\n    rationale: rationale?.trim() || '',\r\n  });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Create a new decision\r\n */\r\nexport async function createDecision(data: CreateDecisionRequest): Promise<Decision> {\r\n  const response = await http.post<{ decision: Decision; id: string | number }>('/api/decisions', data);\r\n  return response.data.decision || { ...data, id: response.data.id, status: data.status || 'proposed', created_at: new Date().toISOString() } as Decision;\r\n}\r\n\r\n/**\r\n * Update a decision\r\n */\r\nexport async function updateDecision(id: string | number, data: UpdateDecisionRequest): Promise<Decision> {\r\n  const response = await http.put<{ decision: Decision }>(`/api/decisions/${id}`, data);\r\n  return response.data.decision;\r\n}\r\n\r\n/**\r\n * Delete a decision\r\n */\r\nexport async function deleteDecision(id: string | number): Promise<void> {\r\n  await http.delete(`/api/decisions/${id}`);\r\n}\r\n\r\n/**\r\n * Approve a decision\r\n */\r\nexport async function approveDecision(id: string | number, approvedBy: string): Promise<Decision> {\r\n  return updateDecision(id, {\r\n    status: 'approved',\r\n    approved_by: approvedBy,\r\n    decided_at: new Date().toISOString(),\r\n  });\r\n}\r\n\r\n/**\r\n * Reject a decision\r\n */\r\nexport async function rejectDecision(id: string | number, rationale?: string): Promise<Decision> {\r\n  return updateDecision(id, {\r\n    status: 'rejected',\r\n    rationale,\r\n    decided_at: new Date().toISOString(),\r\n  });\r\n}\r\n\r\nexport const decisionsService = {\r\n  getAll: getDecisions,\r\n  get: getDecision,\r\n  create: createDecision,\r\n  update: updateDecision,\r\n  delete: deleteDecision,\r\n  approve: approveDecision,\r\n  reject: rejectDecision,\r\n  getDeletedDecisions,\r\n  restore: restoreDecision,\r\n  getEvents: getDecisionEvents,\r\n  getSimilarDecisions,\r\n  runDecisionCheck,\r\n  detectConflicts,\r\n  suggest,\r\n  suggestOwner,\r\n};\r\n","/**\r\n * Chat Service\r\n * Handles chat and AI interactions\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  timestamp: string;\r\n  sources?: ChatSource[];\r\n  contextQuality?: 'high' | 'medium' | 'low' | 'none';\r\n}\r\n\r\nexport interface ChatSource {\r\n  type: 'fact' | 'document' | 'question' | 'decision';\r\n  id: string | number;\r\n  title?: string;\r\n  excerpt?: string;\r\n}\r\n\r\nexport interface ChatRequest {\r\n  message: string;\r\n  context?: string;\r\n  history?: Array<{ role: string; content: string }>;\r\n  semantic?: boolean;\r\n  deepReasoning?: boolean;\r\n}\r\n\r\nexport interface ChatResponse {\r\n  message: string;\r\n  response: string;\r\n  sources: ChatSource[];\r\n  contextQuality: 'high' | 'medium' | 'low' | 'none';\r\n}\r\n\r\nexport interface AskRequest {\r\n  question: string;\r\n  model?: string;\r\n}\r\n\r\nexport interface AskResponse {\r\n  question: string;\r\n  answer: string;\r\n  sources: {\r\n    facts: number;\r\n    questions: number;\r\n    decisions: number;\r\n    knowledgeItems: number;\r\n  };\r\n}\r\n\r\nexport interface SotChatRequest {\r\n  message: string;\r\n  model?: string;\r\n}\r\n\r\nexport interface SotChatResponse {\r\n  response: string;\r\n  model: string;\r\n  healthScore: number;\r\n}\r\n\r\nexport interface BriefingResponse {\r\n  briefing: string;\r\n  analysis: string;\r\n  generated_at: string;\r\n  stats: Record<string, number>;\r\n  cached: boolean;\r\n  cacheSource?: 'supabase' | 'memory';\r\n}\r\n\r\nexport interface BriefingHistoryItem {\r\n  id: string;\r\n  briefing: string;\r\n  generated_at: string;\r\n}\r\n\r\n// Type alias for backwards compatibility\r\nexport type Briefing = BriefingResponse;\r\n\r\n// Chat history for context\r\nlet chatHistory: ChatMessage[] = [];\r\n\r\n/**\r\n * Send a chat message\r\n */\r\nexport async function sendMessage(request: ChatRequest): Promise<ChatResponse> {\r\n  const response = await http.post<ChatResponse>('/api/chat', {\r\n    message: request.message,\r\n    context: request.context,\r\n    history: request.history || chatHistory.slice(-10).map(m => ({\r\n      role: m.role,\r\n      content: m.content,\r\n    })),\r\n    semantic: request.semantic ?? true,\r\n    deepReasoning: request.deepReasoning ?? false,\r\n  });\r\n\r\n  // Add to history\r\n  const userMessage: ChatMessage = {\r\n    id: `msg-${Date.now()}-user`,\r\n    role: 'user',\r\n    content: request.message,\r\n    timestamp: new Date().toISOString(),\r\n  };\r\n\r\n  const assistantMessage: ChatMessage = {\r\n    id: `msg-${Date.now()}-assistant`,\r\n    role: 'assistant',\r\n    content: response.data.response,\r\n    timestamp: new Date().toISOString(),\r\n    sources: response.data.sources,\r\n    contextQuality: response.data.contextQuality,\r\n  };\r\n\r\n  chatHistory.push(userMessage, assistantMessage);\r\n\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Ask a question about the knowledge base\r\n */\r\nexport async function ask(request: AskRequest): Promise<AskResponse> {\r\n  const response = await http.post<AskResponse>('/api/ask', request);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Chat with SOT context\r\n */\r\nexport async function sotChat(request: SotChatRequest): Promise<SotChatResponse> {\r\n  const response = await http.post<SotChatResponse>('/api/sot/chat', request);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get daily briefing\r\n */\r\nexport async function getBriefing(refresh = false): Promise<BriefingResponse> {\r\n  const url = refresh ? '/api/briefing?refresh=true' : '/api/briefing';\r\n  const response = await http.get<BriefingResponse>(url);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get briefing history\r\n */\r\nexport async function getBriefingHistory(limit = 30): Promise<BriefingHistoryItem[]> {\r\n  const response = await http.get<{ history: BriefingHistoryItem[]; total: number }>(`/api/briefing/history?limit=${limit}`);\r\n  return response.data.history || [];\r\n}\r\n\r\n/**\r\n * Get weekly report\r\n */\r\nexport async function getWeeklyReport(): Promise<string> {\r\n  const response = await http.get<string>('/api/reports/weekly');\r\n  return typeof response.data === 'string' ? response.data : '';\r\n}\r\n\r\n/**\r\n * Generate executive summary\r\n */\r\nexport async function generateExecutiveSummary(): Promise<string> {\r\n  const response = await http.post<{ summary: string }>('/api/sot/executive-summary');\r\n  return response.data.summary || '';\r\n}\r\n\r\n/**\r\n * Get chat history\r\n */\r\nexport function getChatHistory(): ChatMessage[] {\r\n  return [...chatHistory];\r\n}\r\n\r\n/**\r\n * Clear chat history\r\n */\r\nexport function clearChatHistory(): void {\r\n  chatHistory = [];\r\n}\r\n\r\n/**\r\n * Add message to history\r\n */\r\nexport function addToHistory(message: ChatMessage): void {\r\n  chatHistory.push(message);\r\n}\r\n\r\nexport const chatService = {\r\n  send: sendMessage,\r\n  ask,\r\n  sotChat,\r\n  getBriefing,\r\n  getBriefingHistory,\r\n  getWeeklyReport,\r\n  generateExecutiveSummary,\r\n  getHistory: getChatHistory,\r\n  clearHistory: clearChatHistory,\r\n  addToHistory,\r\n};\r\n","/**\r\n * Contacts Service\r\n * Handles contact and team CRUD operations\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Contact {\r\n  id: string;\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  organization?: string;\r\n  company?: string;\r\n  role?: string;\r\n  rolePrompt?: string;\r\n  department?: string;\r\n  linkedin?: string;\r\n  timezone?: string;\r\n  location?: string;\r\n  photoUrl?: string;\r\n  avatarUrl?: string;\r\n  photo_url?: string;\r\n  avatar_url?: string;\r\n  tags?: string[];\r\n  notes?: string;\r\n  aliases?: string[];\r\n  isFavorite?: boolean;\r\n  is_favorite?: boolean;\r\n  relationships?: Array<{\r\n    contactId: string;\r\n    type: 'reports_to' | 'works_with' | 'manages' | 'collaborates';\r\n  }>;\r\n  activity?: Array<{\r\n    type: 'conversation' | 'document' | 'transcript';\r\n    id: string;\r\n    title: string;\r\n    date: string;\r\n  }>;\r\n  teams?: Array<{\r\n    id: string;\r\n    name: string;\r\n    color: string;\r\n  }>;\r\n  created_at: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface Team {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  color?: string;\r\n  team_type?: 'team' | 'department' | 'organization' | 'group';\r\n  memberCount?: number;\r\n  memberDetails?: Array<{\r\n    contactId: string;\r\n    name: string;\r\n    role: string;\r\n    isLead: boolean;\r\n  }>;\r\n  created_at: string;\r\n}\r\n\r\nexport interface CreateContactRequest {\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  organization?: string;\r\n  role?: string;\r\n  department?: string;\r\n  tags?: string[];\r\n  notes?: string;\r\n}\r\n\r\nexport interface UpdateContactRequest {\r\n  name?: string;\r\n  email?: string;\r\n  phone?: string;\r\n  organization?: string;\r\n  role?: string;\r\n  rolePrompt?: string;\r\n  department?: string;\r\n  linkedin?: string;\r\n  timezone?: string;\r\n  photoUrl?: string;\r\n  tags?: string[];\r\n  notes?: string;\r\n  aliases?: string[];\r\n}\r\n\r\nexport interface CreateTeamRequest {\r\n  name: string;\r\n  description?: string;\r\n  color?: string;\r\n  team_type?: 'team' | 'department' | 'organization' | 'group';\r\n}\r\n\r\n/**\r\n * Get all contacts\r\n */\r\nexport async function getContacts(filters?: {\r\n  organization?: string;\r\n  tag?: string;\r\n  search?: string;\r\n}): Promise<{ contacts: Contact[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (filters?.organization) params.set('organization', filters.organization);\r\n    if (filters?.tag) params.set('tag', filters.tag);\r\n    if (filters?.search) params.set('search', filters.search);\r\n    \r\n    const query = params.toString();\r\n    const url = query ? `/api/contacts?${query}` : '/api/contacts';\r\n    \r\n    const response = await http.get<{ contacts: Contact[]; total: number }>(url);\r\n    const rawContacts = response.data.contacts || [];\r\n    \r\n    // Normalize field names (API uses snake_case, frontend uses camelCase)\r\n    const contacts = rawContacts.map(c => ({\r\n      ...c,\r\n      photoUrl: c.photo_url || c.avatar_url || c.photoUrl || c.avatarUrl,\r\n      avatarUrl: c.avatar_url || c.photo_url || c.avatarUrl || c.photoUrl,\r\n      isFavorite: c.is_favorite ?? c.isFavorite ?? false,\r\n      company: c.organization || c.company,\r\n    }));\r\n    \r\n    return { contacts, total: response.data.total || contacts.length };\r\n  } catch (error) {\r\n    console.error('[ContactsService] Failed to get contacts:', error);\r\n    return { contacts: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single contact\r\n */\r\nexport async function getContact(id: string): Promise<Contact | null> {\r\n  try {\r\n    const response = await http.get<{ contact: Contact }>(`/api/contacts/${id}`);\r\n    return response.data.contact;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new contact\r\n */\r\nexport async function createContact(data: CreateContactRequest): Promise<Contact> {\r\n  const response = await http.post<{ id: string; ok: boolean }>('/api/contacts', data);\r\n  return { ...data, id: response.data.id, created_at: new Date().toISOString() } as Contact;\r\n}\r\n\r\n/**\r\n * Update a contact\r\n */\r\nexport async function updateContact(id: string, data: UpdateContactRequest): Promise<void> {\r\n  await http.put(`/api/contacts/${id}`, data);\r\n}\r\n\r\n/**\r\n * Delete a contact\r\n */\r\nexport async function deleteContact(id: string): Promise<void> {\r\n  await http.delete(`/api/contacts/${id}`);\r\n}\r\n\r\n/**\r\n * Get contact stats\r\n */\r\nexport async function getContactStats(): Promise<Record<string, number>> {\r\n  const response = await http.get<{ ok: boolean } & Record<string, number>>('/api/contacts/stats');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Find contact by name\r\n */\r\nexport async function findContactByName(name: string): Promise<Contact | null> {\r\n  try {\r\n    const response = await http.get<{ found: boolean; contact: Contact | null }>(`/api/contacts/find-by-name?name=${encodeURIComponent(name)}`);\r\n    return response.data.found ? response.data.contact : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get duplicate contacts\r\n */\r\nexport async function getDuplicates(): Promise<{ duplicates: Contact[][]; groups: number }> {\r\n  const response = await http.get<{ duplicates: Contact[][]; groups: number }>('/api/contacts/duplicates');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Merge contacts\r\n */\r\nexport async function mergeContacts(contactIds: string[]): Promise<string> {\r\n  const response = await http.post<{ mergedId: string }>('/api/contacts/merge', { contactIds });\r\n  return response.data.mergedId;\r\n}\r\n\r\n/**\r\n * Enrich contact with AI\r\n */\r\nexport async function enrichContact(id: string): Promise<{\r\n  role?: string;\r\n  department?: string;\r\n  tags?: string[];\r\n  additionalNotes?: string;\r\n}> {\r\n  const response = await http.post<{ suggestions: Record<string, unknown> }>(`/api/contacts/${id}/enrich`);\r\n  return response.data.suggestions as {\r\n    role?: string;\r\n    department?: string;\r\n    tags?: string[];\r\n    additionalNotes?: string;\r\n  };\r\n}\r\n\r\n/**\r\n * Export contacts in specified format\r\n */\r\nexport async function exportContacts(format: 'json' | 'csv' = 'json'): Promise<void> {\r\n  try {\r\n    const response = await fetch(`/api/contacts/export?format=${format}`);\r\n    if (!response.ok) throw new Error('Export failed');\r\n    \r\n    const blob = await response.blob();\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `contacts-export.${format}`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  } catch (error) {\r\n    console.error('Export failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get contact with all associations (teams, projects)\r\n */\r\nexport async function getContactWithAssociations(id: string): Promise<Contact & {\r\n  projects?: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }>;\r\n} | null> {\r\n  try {\r\n    const response = await http.get<{ \r\n      contact: Contact & { \r\n        projects?: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }> \r\n      } \r\n    }>(`/api/contacts/${id}/associations`);\r\n    return response.data.contact;\r\n  } catch {\r\n    // Fallback to regular get if associations endpoint not available\r\n    return getContact(id);\r\n  }\r\n}\r\n\r\n/**\r\n * Add contact to a project\r\n */\r\nexport async function addContactToProject(contactId: string, projectId: string, options?: {\r\n  role?: string;\r\n  isPrimary?: boolean;\r\n}): Promise<void> {\r\n  await http.post(`/api/contacts/${contactId}/projects`, { projectId, ...options });\r\n}\r\n\r\n/**\r\n * Remove contact from a project\r\n */\r\nexport async function removeContactFromProject(contactId: string, projectId: string): Promise<void> {\r\n  await http.delete(`/api/contacts/${contactId}/projects/${projectId}`);\r\n}\r\n\r\n/**\r\n * Get projects a contact belongs to\r\n */\r\nexport async function getContactProjects(contactId: string): Promise<Array<{\r\n  id: string;\r\n  name: string;\r\n  role?: string;\r\n  isPrimary?: boolean;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{ projects: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }> }>(\r\n      `/api/contacts/${contactId}/projects`\r\n    );\r\n    return response.data.projects || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get all teams\r\n */\r\nexport async function getTeams(): Promise<Team[]> {\r\n  try {\r\n    const response = await http.get<{ teams: Team[] }>('/api/teams');\r\n    return response.data.teams || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single team with members\r\n */\r\nexport async function getTeam(id: string): Promise<{ team: Team; members: Contact[] } | null> {\r\n  try {\r\n    const response = await http.get<{ team: Team; members: Contact[] }>(`/api/teams/${id}`);\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new team\r\n */\r\nexport async function createTeam(data: CreateTeamRequest): Promise<Team> {\r\n  const response = await http.post<{ id: string; ok: boolean }>('/api/teams', data);\r\n  return { ...data, id: response.data.id, created_at: new Date().toISOString() } as Team;\r\n}\r\n\r\n/**\r\n * Update a team\r\n */\r\nexport async function updateTeam(id: string, data: Partial<CreateTeamRequest>): Promise<void> {\r\n  await http.put(`/api/teams/${id}`, data);\r\n}\r\n\r\n/**\r\n * Delete a team\r\n */\r\nexport async function deleteTeam(id: string): Promise<void> {\r\n  await http.delete(`/api/teams/${id}`);\r\n}\r\n\r\n/**\r\n * Add member to team\r\n */\r\nexport async function addTeamMember(teamId: string, contactId: string, role?: string, isLead = false): Promise<void> {\r\n  await http.post(`/api/teams/${teamId}/members`, { contactId, role, isLead });\r\n}\r\n\r\n/**\r\n * Remove member from team\r\n */\r\nexport async function removeTeamMember(teamId: string, contactId: string): Promise<void> {\r\n  await http.delete(`/api/teams/${teamId}/members/${contactId}`);\r\n}\r\n\r\nexport const contactsService = {\r\n  getAll: getContacts,\r\n  get: getContact,\r\n  create: createContact,\r\n  update: updateContact,\r\n  delete: deleteContact,\r\n  getStats: getContactStats,\r\n  findByName: findContactByName,\r\n  getDuplicates,\r\n  merge: mergeContacts,\r\n  mergeContacts,\r\n  enrich: enrichContact,\r\n  export: exportContacts,\r\n  getWithAssociations: getContactWithAssociations,\r\n  addToProject: addContactToProject,\r\n  removeFromProject: removeContactFromProject,\r\n  getProjects: getContactProjects,\r\n};\r\n\r\nexport const teamsService = {\r\n  getAll: getTeams,\r\n  get: getTeam,\r\n  create: createTeam,\r\n  update: updateTeam,\r\n  delete: deleteTeam,\r\n  addMember: addTeamMember,\r\n  removeMember: removeTeamMember,\r\n};\r\n","/**\r\n * Documents Service\r\n * Handles file upload, processing, and document management\r\n */\r\n\r\nimport { http } from './api';\r\nimport { toast } from './toast';\r\n\r\nexport interface Document {\r\n  id: string;\r\n  filename: string;\r\n  originalName: string;\r\n  mimeType: string;\r\n  size: number;\r\n  path?: string;\r\n  content?: string;\r\n  summary?: string;\r\n  metadata?: Record<string, unknown>;\r\n  status: 'pending' | 'processing' | 'processed' | 'failed';\r\n  processingError?: string;\r\n  facts_count?: number;\r\n  questions_count?: number;\r\n  created_at: string;\r\n  processed_at?: string;\r\n}\r\n\r\nexport interface UploadResult {\r\n  success: boolean;\r\n  files: Array<{\r\n    filename: string;\r\n    id: string;\r\n    size: number;\r\n    status: string;\r\n  }>;\r\n  totalSize: number;\r\n  processingStarted: boolean;\r\n}\r\n\r\nexport interface ProcessingStatus {\r\n  isProcessing: boolean;\r\n  queueLength: number;\r\n  completedCount: number;\r\n  errorCount: number;\r\n  pendingFiles: string[];\r\n  processingFile?: string;\r\n  completedFiles: string[];\r\n  errors: Array<{ file: string; error: string }>;\r\n}\r\n\r\nexport interface EmbeddingStatus {\r\n  total: number;\r\n  totalChunks?: number;\r\n  embedded: number;\r\n  pending: number;\r\n  failed?: number;\r\n  model?: string;\r\n  models: string[];\r\n  available_embedding_models?: string[];\r\n  lastUpdated?: string;\r\n}\r\n\r\nexport interface KnowledgeItem {\r\n  id: string;\r\n  content: string;\r\n  category?: string;\r\n  source?: string;\r\n  embedding?: number[];\r\n  created_at: string;\r\n}\r\n\r\nexport interface Conversation {\r\n  id: string;\r\n  participants: string[];\r\n  subject?: string;\r\n  summary?: string;\r\n  messages: Array<{\r\n    from: string;\r\n    content: string;\r\n    timestamp: string;\r\n  }>;\r\n  source_file?: string;\r\n  created_at: string;\r\n}\r\n\r\n/**\r\n * Upload files\r\n */\r\nexport async function uploadFiles(files: File[], onProgress?: (progress: number) => void): Promise<UploadResult> {\r\n  const formData = new FormData();\r\n  files.forEach(file => {\r\n    formData.append('files', file);\r\n  });\r\n\r\n  const xhr = new XMLHttpRequest();\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    xhr.upload.addEventListener('progress', (e) => {\r\n      if (e.lengthComputable && onProgress) {\r\n        onProgress(Math.round((e.loaded / e.total) * 100));\r\n      }\r\n    });\r\n\r\n    xhr.addEventListener('load', () => {\r\n      if (xhr.status >= 200 && xhr.status < 300) {\r\n        try {\r\n          resolve(JSON.parse(xhr.responseText));\r\n        } catch {\r\n          reject(new Error('Invalid response'));\r\n        }\r\n      } else {\r\n        reject(new Error(`Upload failed: ${xhr.statusText}`));\r\n      }\r\n    });\r\n\r\n    xhr.addEventListener('error', () => {\r\n      reject(new Error('Upload failed'));\r\n    });\r\n\r\n    xhr.open('POST', '/api/upload');\r\n    xhr.send(formData);\r\n  });\r\n}\r\n\r\n/**\r\n * Upload single file with text extraction\r\n */\r\nexport async function uploadWithExtraction(file: File): Promise<{\r\n  id: string;\r\n  text: string;\r\n  pageCount?: number;\r\n}> {\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n\r\n  const response = await fetch('/api/upload-extract', {\r\n    method: 'POST',\r\n    body: formData,\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Upload failed');\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n/**\r\n * Get processing status\r\n */\r\nexport async function getProcessingStatus(): Promise<ProcessingStatus> {\r\n  const response = await http.get<ProcessingStatus>('/api/processing-status');\r\n  return response.data;\r\n}\r\n\r\nexport interface DocumentsResponse {\r\n  documents: Document[];\r\n  total: number;\r\n  limit?: number;\r\n  offset?: number;\r\n  hasMore?: boolean;\r\n  statuses: {\r\n    processed: number;\r\n    pending: number;\r\n    processing?: number;\r\n    failed: number;\r\n    deleted?: number;\r\n  };\r\n}\r\n\r\n/**\r\n * Get all documents with optional status filter\r\n */\r\nexport interface GetDocumentsOptions {\r\n  status?: string;\r\n  type?: string; // documents, transcripts, emails, images\r\n  search?: string;\r\n  sort?: 'created_at' | 'updated_at' | 'filename';\r\n  order?: 'asc' | 'desc';\r\n  limit?: number;\r\n  offset?: number;\r\n}\r\n\r\nexport async function getDocuments(statusOrOptions?: string | GetDocumentsOptions): Promise<DocumentsResponse> {\r\n  try {\r\n    // Handle both legacy (status string) and new options object\r\n    const options: GetDocumentsOptions = typeof statusOrOptions === 'string' \r\n      ? { status: statusOrOptions }\r\n      : statusOrOptions || {};\r\n    \r\n    const params = new URLSearchParams();\r\n    if (options.status && options.status !== 'all') params.set('status', options.status);\r\n    if (options.type && options.type !== 'all') params.set('type', options.type);\r\n    if (options.search) params.set('search', options.search);\r\n    if (options.sort) params.set('sort', options.sort);\r\n    if (options.order) params.set('order', options.order);\r\n    if (options.limit) params.set('limit', String(options.limit));\r\n    if (options.offset) params.set('offset', String(options.offset));\r\n    \r\n    const queryString = params.toString();\r\n    const url = queryString ? `/api/documents?${queryString}` : '/api/documents';\r\n    \r\n    const response = await http.get<DocumentsResponse>(url);\r\n    return {\r\n      documents: response.data.documents || [],\r\n      total: response.data.total || 0,\r\n      limit: response.data.limit,\r\n      offset: response.data.offset,\r\n      hasMore: response.data.hasMore,\r\n      statuses: response.data.statuses || { processed: 0, pending: 0, failed: 0, deleted: 0 }\r\n    };\r\n  } catch {\r\n    return { documents: [], total: 0, statuses: { processed: 0, pending: 0, failed: 0, deleted: 0 } };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single document\r\n */\r\nexport async function getDocument(id: string): Promise<Document | null> {\r\n  try {\r\n    const response = await http.get<{ document: Document }>(`/api/documents/${id}`);\r\n    return response.data.document;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a document\r\n */\r\nexport async function deleteDocument(id: string, options?: { softDelete?: boolean }): Promise<void> {\r\n  const params = options?.softDelete ? '?soft=true' : '';\r\n  await http.delete(`/api/documents/${id}${params}`);\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted document\r\n */\r\nexport async function restoreDocument(id: string): Promise<void> {\r\n  await http.post(`/api/documents/${id}/restore`);\r\n  toast.success('Document restored');\r\n}\r\n\r\n/**\r\n * Reprocess a document\r\n */\r\nexport async function reprocessDocument(id: string): Promise<void> {\r\n  await http.post(`/api/documents/${id}/reprocess`);\r\n  toast.info('Document queued for reprocessing');\r\n}\r\n\r\n/**\r\n * Get document summary\r\n */\r\nexport async function getDocumentSummary(id: string): Promise<string> {\r\n  const response = await http.get<{ summary: string }>(`/api/documents/${id}/summary`);\r\n  return response.data.summary || '';\r\n}\r\n\r\n/**\r\n * Get knowledge base items\r\n */\r\nexport async function getKnowledgeBase(category?: string): Promise<KnowledgeItem[]> {\r\n  try {\r\n    const url = category ? `/api/knowledge?category=${category}` : '/api/knowledge';\r\n    const response = await http.get<{ items: KnowledgeItem[] }>(url);\r\n    return response.data.items || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Add knowledge item\r\n */\r\nexport async function addKnowledgeItem(content: string, category?: string): Promise<KnowledgeItem> {\r\n  const response = await http.post<{ item: KnowledgeItem; id: string }>('/api/knowledge', {\r\n    content,\r\n    category,\r\n  });\r\n  return response.data.item || { id: response.data.id, content, category, created_at: new Date().toISOString() };\r\n}\r\n\r\n/**\r\n * Search knowledge base\r\n */\r\nexport async function searchKnowledge(query: string, limit = 10): Promise<KnowledgeItem[]> {\r\n  const response = await http.get<{ results: KnowledgeItem[] }>(`/api/knowledge/search?q=${encodeURIComponent(query)}&limit=${limit}`);\r\n  return response.data.results || [];\r\n}\r\n\r\n/**\r\n * Get conversations\r\n */\r\nexport async function getConversations(): Promise<Conversation[]> {\r\n  try {\r\n    const response = await http.get<{ conversations: Conversation[] }>('/api/conversations');\r\n    return response.data.conversations || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single conversation\r\n */\r\nexport async function getConversation(id: string): Promise<Conversation | null> {\r\n  try {\r\n    const response = await http.get<{ conversation: Conversation }>(`/api/conversations/${id}`);\r\n    return response.data.conversation;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse conversation preview (without saving)\r\n */\r\nexport async function parseConversationPreview(text: string): Promise<{\r\n  message_count: number;\r\n  participants: string[];\r\n  format: string;\r\n  preview: unknown[];\r\n}> {\r\n  const response = await http.post<{\r\n    message_count: number;\r\n    participants: string[];\r\n    format: string;\r\n    preview: unknown[];\r\n  }>('/api/conversations/parse', { text });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Import a conversation\r\n */\r\nexport async function importConversation(text: string, options?: { \r\n  skipAI?: boolean; \r\n  formatHint?: string;\r\n  meta?: Record<string, unknown>;\r\n}): Promise<Conversation> {\r\n  const response = await http.post<{ conversation: Conversation }>('/api/conversations', { \r\n    text, \r\n    ...options \r\n  });\r\n  return response.data.conversation;\r\n}\r\n\r\n/**\r\n * Delete a conversation\r\n */\r\nexport async function deleteConversation(id: string): Promise<void> {\r\n  await http.delete(`/api/conversations/${id}`);\r\n}\r\n\r\n/**\r\n * Re-embed a conversation (regenerate embeddings)\r\n */\r\nexport async function reembedConversation(id: string): Promise<void> {\r\n  await http.post(`/api/conversations/${id}/reembed`);\r\n}\r\n\r\n// ==================== Bulk Operations ====================\r\n\r\n/**\r\n * Bulk delete documents\r\n */\r\nexport async function bulkDeleteDocuments(ids: string[]): Promise<{ deleted: number; errors: Array<{ id: string; error: string }> }> {\r\n  const response = await http.post<{ deleted: number; errors: Array<{ id: string; error: string }> }>('/api/documents/bulk/delete', { ids });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Bulk reprocess documents\r\n */\r\nexport async function bulkReprocessDocuments(ids: string[]): Promise<{ success: boolean; message: string; ids: string[] }> {\r\n  const response = await http.post<{ success: boolean; message: string; ids: string[] }>('/api/documents/bulk/reprocess', { ids });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Bulk export documents as ZIP\r\n */\r\nexport async function bulkExportDocuments(ids: string[], format: 'original' | 'markdown' = 'original'): Promise<Blob> {\r\n  const response = await fetch('/api/documents/bulk/export', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ ids, format }),\r\n    credentials: 'include'\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error('Failed to export documents');\r\n  }\r\n  \r\n  return response.blob();\r\n}\r\n\r\n/**\r\n * Download bulk export\r\n */\r\nexport async function downloadBulkExport(ids: string[], format: 'original' | 'markdown' = 'original'): Promise<void> {\r\n  const blob = await bulkExportDocuments(ids, format);\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = `documents_export_${Date.now()}.zip`;\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  document.body.removeChild(a);\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\nexport const documentsService = {\r\n  upload: uploadFiles,\r\n  uploadWithExtraction,\r\n  getProcessingStatus,\r\n  getAll: getDocuments,\r\n  get: getDocument,\r\n  delete: deleteDocument,\r\n  restore: restoreDocument,\r\n  reprocess: reprocessDocument,\r\n  getSummary: getDocumentSummary,\r\n  // Bulk operations\r\n  bulkDelete: bulkDeleteDocuments,\r\n  bulkReprocess: bulkReprocessDocuments,\r\n  bulkExport: bulkExportDocuments,\r\n  downloadBulkExport,\r\n};\r\n\r\n// Additional knowledge functions\r\nasync function getKnowledgeStatus(): Promise<{\r\n  total: number;\r\n  embedded: number;\r\n  pending: number;\r\n  models: string[];\r\n}> {\r\n  try {\r\n    const response = await http.get<{ status: { total: number; embedded: number; pending: number; models: string[] } }>('/api/knowledge/status');\r\n    return response.data.status;\r\n  } catch {\r\n    return { total: 0, embedded: 0, pending: 0, models: [] };\r\n  }\r\n}\r\n\r\nasync function exportKnowledgeMarkdown(): Promise<string> {\r\n  const response = await http.get<{ markdown: string }>('/api/knowledge/export?format=markdown');\r\n  return response.data.markdown || '';\r\n}\r\n\r\nasync function exportKnowledgeJson(): Promise<KnowledgeItem[]> {\r\n  const response = await http.get<{ items: KnowledgeItem[] }>('/api/knowledge/export?format=json');\r\n  return response.data.items || [];\r\n}\r\n\r\nasync function regenerateKnowledge(): Promise<{ success: boolean; processed: number }> {\r\n  const response = await http.post<{ success: boolean; processed: number }>('/api/knowledge/regenerate');\r\n  return response.data;\r\n}\r\n\r\nasync function synthesizeKnowledge(topic?: string): Promise<{ summary: string; sources: string[] }> {\r\n  const response = await http.post<{ summary: string; sources: string[] }>('/api/knowledge/synthesize', { topic });\r\n  return response.data;\r\n}\r\n\r\nexport const knowledgeService = {\r\n  getAll: getKnowledgeBase,\r\n  add: addKnowledgeItem,\r\n  search: searchKnowledge,\r\n  getStatus: getKnowledgeStatus,\r\n  exportMarkdown: exportKnowledgeMarkdown,\r\n  exportJson: exportKnowledgeJson,\r\n  regenerate: regenerateKnowledge,\r\n  synthesize: synthesizeKnowledge,\r\n};\r\n\r\nexport const conversationsService = {\r\n  getAll: getConversations,\r\n  get: getConversation,\r\n  getById: getConversation, // Alias\r\n  parsePreview: parseConversationPreview,\r\n  import: importConversation,\r\n  delete: deleteConversation,\r\n  reembed: reembedConversation,\r\n};\r\n","/**\r\n * Emails Service\r\n * Handles email management and AI responses\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Email {\r\n  id: string;\r\n  message_id?: string;\r\n  from: string;\r\n  from_name?: string;\r\n  from_email?: string;\r\n  to: string[];\r\n  cc?: string[];\r\n  bcc?: string[];\r\n  subject: string;\r\n  body: string;\r\n  body_text?: string;\r\n  body_html?: string;\r\n  date: string;\r\n  thread_id?: string;\r\n  labels?: string[];\r\n  is_read: boolean;\r\n  read?: boolean; // Alias for is_read\r\n  is_starred: boolean;\r\n  has_attachments: boolean;\r\n  attachments?: Array<{\r\n    filename: string;\r\n    mimeType: string;\r\n    size: number;\r\n  }>;\r\n  // Direction and response tracking\r\n  direction?: 'inbound' | 'outbound' | 'internal';\r\n  requires_response?: boolean;\r\n  response_sent?: boolean;\r\n  response_drafted?: boolean;\r\n  draft_response?: string;\r\n  // AI fields\r\n  ai_summary?: string;\r\n  ai_category?: string;\r\n  ai_sentiment?: 'positive' | 'neutral' | 'negative';\r\n  ai_priority?: 'low' | 'medium' | 'high' | 'urgent';\r\n  created_at: string;\r\n}\r\n\r\nexport interface EmailThread {\r\n  id: string;\r\n  subject: string;\r\n  participants: string[];\r\n  message_count: number;\r\n  last_message_date: string;\r\n  messages: Email[];\r\n  summary?: string;\r\n}\r\n\r\nexport interface DraftEmail {\r\n  to: string[];\r\n  cc?: string[];\r\n  bcc?: string[];\r\n  subject: string;\r\n  body: string;\r\n  replyTo?: string;\r\n  threadId?: string;\r\n}\r\n\r\nexport interface AIResponseSuggestion {\r\n  tone: 'professional' | 'friendly' | 'formal' | 'brief';\r\n  response: string;\r\n  confidence: number;\r\n}\r\n\r\n/**\r\n * Get all emails\r\n */\r\nexport async function getEmails(filters?: {\r\n  folder?: string;\r\n  label?: string;\r\n  unread?: boolean;\r\n  starred?: boolean;\r\n  search?: string;\r\n  limit?: number;\r\n  offset?: number;\r\n  direction?: 'inbound' | 'outbound' | 'internal';\r\n}): Promise<{ emails: Email[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (filters?.folder) params.set('folder', filters.folder);\r\n    if (filters?.label) params.set('label', filters.label);\r\n    if (filters?.unread) params.set('unread', 'true');\r\n    if (filters?.starred) params.set('starred', 'true');\r\n    if (filters?.search) params.set('search', filters.search);\r\n    if (filters?.limit) params.set('limit', String(filters.limit));\r\n    if (filters?.offset) params.set('offset', String(filters.offset));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/emails?${query}` : '/api/emails';\r\n    \r\n    const response = await http.get<{ emails: Email[]; total: number }>(url);\r\n    return response.data;\r\n  } catch {\r\n    return { emails: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single email\r\n */\r\nexport async function getEmail(id: string): Promise<Email | null> {\r\n  try {\r\n    const response = await http.get<{ email: Email }>(`/api/emails/${id}`);\r\n    return response.data.email;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get email thread\r\n */\r\nexport async function getEmailThread(threadId: string): Promise<EmailThread | null> {\r\n  try {\r\n    const response = await http.get<{ thread: EmailThread }>(`/api/emails/thread/${threadId}`);\r\n    return response.data.thread;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Mark email as read\r\n */\r\nexport async function markAsRead(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/read`);\r\n}\r\n\r\n/**\r\n * Mark email as unread\r\n */\r\nexport async function markAsUnread(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/unread`);\r\n}\r\n\r\n/**\r\n * Star an email\r\n */\r\nexport async function starEmail(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/star`);\r\n}\r\n\r\n/**\r\n * Unstar an email\r\n */\r\nexport async function unstarEmail(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/unstar`);\r\n}\r\n\r\n/**\r\n * Archive an email\r\n */\r\nexport async function archiveEmail(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/archive`);\r\n}\r\n\r\n/**\r\n * Delete an email\r\n */\r\nexport async function deleteEmail(id: string): Promise<void> {\r\n  await http.delete(`/api/emails/${id}`);\r\n}\r\n\r\n/**\r\n * Send an email\r\n */\r\nexport async function sendEmail(draft: DraftEmail): Promise<{ success: boolean; messageId: string }> {\r\n  const response = await http.post<{ success: boolean; messageId: string }>('/api/emails/send', draft);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Save as draft\r\n */\r\nexport async function saveDraft(draft: DraftEmail): Promise<{ id: string }> {\r\n  const response = await http.post<{ id: string }>('/api/emails/draft', draft);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Generate AI response\r\n */\r\nexport async function generateAIResponse(emailId: string, tone?: string): Promise<AIResponseSuggestion[]> {\r\n  const response = await http.post<{ suggestions: AIResponseSuggestion[] }>(`/api/emails/${emailId}/ai-response`, {\r\n    tone,\r\n  });\r\n  return response.data.suggestions || [];\r\n}\r\n\r\n/**\r\n * Generate AI summary of email\r\n */\r\nexport async function generateSummary(emailId: string): Promise<string> {\r\n  const response = await http.post<{ summary: string }>(`/api/emails/${emailId}/summarize`);\r\n  return response.data.summary || '';\r\n}\r\n\r\n/**\r\n * Categorize email with AI\r\n */\r\nexport async function categorizeEmail(emailId: string): Promise<{\r\n  category: string;\r\n  priority: string;\r\n  sentiment: string;\r\n}> {\r\n  const response = await http.post<{\r\n    category: string;\r\n    priority: string;\r\n    sentiment: string;\r\n  }>(`/api/emails/${emailId}/categorize`);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get email stats\r\n */\r\nexport async function getEmailStats(): Promise<{\r\n  total: number;\r\n  unread: number;\r\n  starred: number;\r\n  today: number;\r\n  byCategory: Record<string, number>;\r\n}> {\r\n  const response = await http.get<{\r\n    total: number;\r\n    unread: number;\r\n    starred: number;\r\n    today: number;\r\n    byCategory: Record<string, number>;\r\n  }>('/api/emails/stats');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Sync emails from provider\r\n */\r\nexport async function syncEmails(): Promise<{ synced: number; errors: number }> {\r\n  const response = await http.post<{ synced: number; errors: number }>('/api/emails/sync');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get email by ID (alias for get)\r\n */\r\nexport async function getById(id: string): Promise<Email | null> {\r\n  return getEmail(id);\r\n}\r\n\r\n/**\r\n * Get emails needing response\r\n */\r\nexport async function getNeedingResponse(): Promise<Email[]> {\r\n  try {\r\n    const response = await http.get<{ emails: Email[] }>('/api/emails?requires_response=true&response_sent=false');\r\n    return response.data.emails || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Mark email as responded\r\n */\r\nexport async function markResponded(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/responded`);\r\n}\r\n\r\n/**\r\n * Generate response (alias for generateAIResponse)\r\n */\r\nexport async function generateResponse(emailId: string, tone?: string): Promise<AIResponseSuggestion[]> {\r\n  return generateAIResponse(emailId, tone);\r\n}\r\n\r\nexport const emailsService = {\r\n  getAll: getEmails,\r\n  get: getEmail,\r\n  getById,\r\n  getThread: getEmailThread,\r\n  markAsRead,\r\n  markAsUnread,\r\n  star: starEmail,\r\n  unstar: unstarEmail,\r\n  archive: archiveEmail,\r\n  delete: deleteEmail,\r\n  send: sendEmail,\r\n  saveDraft,\r\n  generateAIResponse,\r\n  generateResponse,\r\n  generateSummary,\r\n  categorize: categorizeEmail,\r\n  getStats: getEmailStats,\r\n  sync: syncEmails,\r\n  getNeedingResponse,\r\n  markResponded,\r\n};\r\n","/**\r\n * Graph Service - SOTA Knowledge Graph UI\r\n * Handles knowledge graph, visualization, GraphRAG, analytics, and Supabase persistence\r\n */\r\n\r\nimport { http } from './api';\r\n\r\n// ============================================\r\n// TYPES - Graph Data\r\n// ============================================\r\n\r\nexport interface GraphNode {\r\n  id: string;\r\n  label: string;\r\n  name?: string;\r\n  type: string;\r\n  properties?: Record<string, unknown>;\r\n  // Avatar/visual properties\r\n  avatarUrl?: string;\r\n  photoUrl?: string;\r\n  role?: string;\r\n  organization?: string;\r\n  department?: string;\r\n  email?: string;\r\n  // Graph metrics\r\n  connections?: number;\r\n  centrality?: number;\r\n  communityId?: number;\r\n  // Position (for saved layouts)\r\n  x?: number;\r\n  y?: number;\r\n}\r\n\r\nexport interface GraphEdge {\r\n  id: string;\r\n  source: string;\r\n  target: string;\r\n  label: string;\r\n  type: string;\r\n  weight?: number;\r\n  properties?: Record<string, unknown>;\r\n}\r\n\r\nexport interface GraphData {\r\n  nodes: GraphNode[];\r\n  edges: GraphEdge[];\r\n  stats?: GraphStats;\r\n}\r\n\r\nexport interface GraphStats {\r\n  nodeCount: number;\r\n  edgeCount: number;\r\n  density?: number;\r\n  nodeTypes?: Record<string, number>;\r\n  edgeTypes?: Record<string, number>;\r\n  avgConnections?: number;\r\n  communities?: number;\r\n  graphName?: string;\r\n  connected?: boolean;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Ontology\r\n// ============================================\r\n\r\nexport interface OntologyEntityType {\r\n  name: string;\r\n  label: string;\r\n  description?: string;\r\n  icon?: string;\r\n  color?: string;\r\n  sharedEntity?: boolean;\r\n  properties?: Array<{\r\n    name: string;\r\n    type: string;\r\n    required?: boolean;\r\n    searchable?: boolean;\r\n  }>;\r\n}\r\n\r\nexport interface OntologyRelationType {\r\n  name: string;\r\n  label?: string;\r\n  description?: string;\r\n  fromTypes: string[];\r\n  toTypes: string[];\r\n  properties?: Array<{\r\n    name: string;\r\n    type: string;\r\n  }>;\r\n}\r\n\r\nexport interface OntologySchema {\r\n  version: string;\r\n  entityTypes: Record<string, OntologyEntityType>;\r\n  relationTypes: Record<string, OntologyRelationType>;\r\n  queryPatterns?: Record<string, { cypher: string; description: string }>;\r\n}\r\n\r\nexport interface OntologySuggestion {\r\n  id: string;\r\n  type: 'entity' | 'relation';\r\n  name: string;\r\n  description?: string;\r\n  fromTypes?: string[];\r\n  toTypes?: string[];\r\n  properties?: string[];\r\n  source?: string;\r\n  example?: string;\r\n  status: 'pending' | 'approved' | 'rejected';\r\n  createdAt: string;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Analytics\r\n// ============================================\r\n\r\nexport interface Community {\r\n  id: number;\r\n  size: number;\r\n  members: Array<{ id: string; name: string; type: string }>;\r\n  types?: Record<string, number>;\r\n  hub?: { id: string; name: string };\r\n}\r\n\r\nexport interface CentralityMetrics {\r\n  topNodes: Array<{\r\n    id: string;\r\n    name: string;\r\n    type: string;\r\n    connections: number;\r\n    centrality: number;\r\n    avatarUrl?: string;\r\n  }>;\r\n}\r\n\r\nexport interface BridgeNode {\r\n  id: string;\r\n  name: string;\r\n  org1?: string;\r\n  org2?: string;\r\n  connects: number;\r\n}\r\n\r\nexport interface GraphInsight {\r\n  type: string;\r\n  title: string;\r\n  description: string;\r\n  importance: 'low' | 'medium' | 'high';\r\n  relatedNodes?: string[];\r\n}\r\n\r\n// ============================================\r\n// TYPES - GraphRAG\r\n// ============================================\r\n\r\nexport interface GraphRAGResponse {\r\n  ok: boolean;\r\n  answer: string;\r\n  sources: Array<{\r\n    type: string;\r\n    content: string;\r\n    id?: string;\r\n  }>;\r\n  queryType: 'structural' | 'semantic' | 'hybrid';\r\n  cypherGenerated?: string;\r\n  reasoningChain?: Array<{\r\n    step: string;\r\n    input: string;\r\n    output: unknown;\r\n    reasoning?: string;\r\n  }>;\r\n  highlightedNodes?: string[];\r\n  latencyMs: number;\r\n  confidence?: number;\r\n  cached?: boolean;\r\n}\r\n\r\nexport interface MultiHopResult {\r\n  answer: string;\r\n  reasoningChain: Array<{\r\n    step: string;\r\n    input: string;\r\n    output: unknown;\r\n    reasoning?: string;\r\n  }>;\r\n  subQueries?: Array<{ query: string; result: unknown }>;\r\n  confidence: number;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Query\r\n// ============================================\r\n\r\nexport interface CypherQueryResult {\r\n  ok: boolean;\r\n  results: Array<Record<string, unknown>>;\r\n  columns?: string[];\r\n  executionTimeMs?: number;\r\n  error?: string;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Supabase Persistence\r\n// ============================================\r\n\r\nexport interface GraphQueryHistory {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  query_type: 'cypher' | 'natural_language' | 'visual' | 'template';\r\n  query_text: string;\r\n  query_name?: string;\r\n  generated_cypher?: string;\r\n  result_count?: number;\r\n  execution_time_ms?: number;\r\n  is_favorite: boolean;\r\n  tags?: string[];\r\n  metadata?: Record<string, unknown>;\r\n  created_at: string;\r\n}\r\n\r\nexport interface GraphSavedView {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  name: string;\r\n  description?: string;\r\n  view_config: {\r\n    filters?: {\r\n      entityTypes?: string[];\r\n      communityIds?: number[];\r\n      dateRange?: { start?: string; end?: string };\r\n    };\r\n    layout?: {\r\n      type: 'physics' | 'hierarchical' | 'manual';\r\n      positions?: Record<string, { x: number; y: number }>;\r\n    };\r\n    zoom?: { scale: number; position: { x: number; y: number } };\r\n    selectedNodes?: string[];\r\n    highlightedPaths?: string[][];\r\n    communityColors?: Record<number, string>;\r\n    showLabels?: boolean;\r\n    showEdgeLabels?: boolean;\r\n  };\r\n  thumbnail_url?: string;\r\n  is_default: boolean;\r\n  is_shared: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface GraphBookmark {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  node_id: string;\r\n  node_type: string;\r\n  node_label: string;\r\n  node_avatar_url?: string;\r\n  note?: string;\r\n  color?: string;\r\n  sort_order: number;\r\n  created_at: string;\r\n}\r\n\r\nexport interface GraphAnnotation {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  target_type: 'node' | 'edge' | 'path' | 'region';\r\n  target_id: string;\r\n  target_label?: string;\r\n  content: string;\r\n  annotation_type: 'note' | 'warning' | 'highlight' | 'question' | 'todo';\r\n  color?: string;\r\n  icon?: string;\r\n  is_shared: boolean;\r\n  is_resolved: boolean;\r\n  resolved_at?: string;\r\n  resolved_by?: string;\r\n  metadata?: Record<string, unknown>;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface GraphChatMessage {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  session_id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  metadata?: {\r\n    queryType?: string;\r\n    cypherGenerated?: string;\r\n    sources?: unknown[];\r\n    reasoningChain?: unknown[];\r\n    highlightedNodes?: string[];\r\n    executionTimeMs?: number;\r\n    confidence?: number;\r\n    isVoiceInput?: boolean;\r\n  };\r\n  is_pinned: boolean;\r\n  created_at: string;\r\n}\r\n\r\nexport interface GraphSnapshot {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  name: string;\r\n  description?: string;\r\n  snapshot_type: 'manual' | 'auto' | 'milestone' | 'before_change';\r\n  snapshot_data: {\r\n    nodes: GraphNode[];\r\n    edges: GraphEdge[];\r\n    stats: GraphStats;\r\n    communities?: Community[];\r\n    capturedAt: string;\r\n  };\r\n  node_count: number;\r\n  edge_count: number;\r\n  file_size_bytes?: number;\r\n  is_baseline: boolean;\r\n  tags?: string[];\r\n  created_at: string;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Timeline & Costs (existing)\r\n// ============================================\r\n\r\nexport interface TimelineEvent {\r\n  id: string;\r\n  date: string;\r\n  title: string;\r\n  description?: string;\r\n  content?: string;\r\n  type: 'fact' | 'question' | 'question_answered' | 'decision' | 'risk' | 'action' | 'action_completed' | 'deadline' | 'document' | 'transcript' | 'email' | 'conversation' | 'chat_session';\r\n  entity_id?: string;\r\n  entity_type?: string;\r\n  metadata?: Record<string, unknown>;\r\n  importance?: 'low' | 'medium' | 'high';\r\n  user?: string;\r\n  actor?: string;\r\n  owner?: string;\r\n  icon?: string;\r\n  color?: string;\r\n  status?: string;\r\n}\r\n\r\nexport interface TimelineData {\r\n  events: TimelineEvent[];\r\n  startDate: string;\r\n  endDate: string;\r\n  totalEvents: number;\r\n}\r\n\r\nexport interface LLMCost {\r\n  id: string;\r\n  provider: string;\r\n  model: string;\r\n  operation: string;\r\n  tokens_input: number;\r\n  tokens_output: number;\r\n  cost: number;\r\n  timestamp: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface CostSummary {\r\n  total: number;\r\n  byProvider: Record<string, number>;\r\n  byModel: Record<string, number>;\r\n  byOperation: Record<string, number>;\r\n  byContext?: Record<string, number>;\r\n  period: { start: string; end: string };\r\n  dailyBreakdown: Array<{ date: string; cost: number; calls: number }>;\r\n  totalInputTokens?: number;\r\n  totalOutputTokens?: number;\r\n  previousPeriodCost?: number | null;\r\n  percentChange?: number | null;\r\n  budgetLimit?: number | null;\r\n  budgetUsedPercent?: number | null;\r\n  budgetAlertTriggered?: boolean;\r\n}\r\n\r\n// ============================================\r\n// GRAPH DATA FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get visualization data for vis-network\r\n */\r\nexport async function getVisualizationData(options?: {\r\n  types?: string[];\r\n  limit?: number;\r\n  communityId?: number;\r\n}): Promise<{ nodes: GraphNode[]; edges: GraphEdge[] }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.types?.length) params.set('types', options.types.join(','));\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.communityId !== undefined) params.set('communityId', String(options.communityId));\r\n\r\n    // First try to get nodes\r\n    const nodesResponse = await http.get<{ ok: boolean; nodes?: GraphNode[]; results?: unknown[] }>(\r\n      `/api/graph/nodes?${params.toString()}`\r\n    );\r\n    \r\n    // Then get relationships\r\n    const edgesResponse = await http.get<{ ok: boolean; relationships?: GraphEdge[]; results?: unknown[] }>(\r\n      `/api/graph/relationships?${params.toString()}`\r\n    );\r\n\r\n    const nodes = nodesResponse.data.nodes || nodesResponse.data.results?.map((item) => {\r\n      const r = item as Record<string, unknown>;\r\n      return {\r\n        id: String(r.id || r.nodeId || ''),\r\n        label: String(r.name || r.label || r.title || (r.content as string)?.substring(0, 50) || ''),\r\n        name: String(r.name || ''),\r\n        type: String(r.type || r.label || 'Unknown'),\r\n        avatarUrl: (r.avatarUrl || r.avatar_url || r.photoUrl || r.photo_url) as string | undefined,\r\n        role: r.role as string | undefined,\r\n        organization: r.organization as string | undefined,\r\n        properties: r,\r\n      };\r\n    }) || [];\r\n\r\n    // Map relationships to expected format (from/to -> source/target)\r\n    const rawEdges = edgesResponse.data.relationships || edgesResponse.data.results || [];\r\n    const edges = rawEdges.map((item) => {\r\n      const r = item as Record<string, unknown>;\r\n      return {\r\n        id: String(r.id || `${r.from || r.source}-${r.to || r.target}-${r.type}`),\r\n        source: String(r.from || r.source || ''),\r\n        target: String(r.to || r.target || ''),\r\n        label: String(r.type || r.label || ''),\r\n        type: String(r.type || ''),\r\n      };\r\n    });\r\n\r\n    return { nodes: nodes as GraphNode[], edges: edges as GraphEdge[] };\r\n  } catch (error) {\r\n    console.error('[GraphService] getVisualizationData error:', error);\r\n    return { nodes: [], edges: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get graph statistics\r\n */\r\nexport async function getStats(): Promise<GraphStats> {\r\n  try {\r\n    const response = await http.get<{ \r\n      ok: boolean; \r\n      stats?: GraphStats;\r\n      nodes?: number;\r\n      relationships?: number;\r\n      enabled?: boolean;\r\n      connected?: boolean;\r\n      graphName?: string;\r\n    }>('/api/graph/status');\r\n    \r\n    if (response.data.stats) {\r\n      return {\r\n        ...response.data.stats,\r\n        graphName: response.data.graphName,\r\n        connected: response.data.connected,\r\n      };\r\n    }\r\n    \r\n    return {\r\n      nodeCount: response.data.nodes || 0,\r\n      edgeCount: response.data.relationships || 0,\r\n      graphName: response.data.graphName,\r\n      connected: response.data.connected,\r\n    };\r\n  } catch {\r\n    return { nodeCount: 0, edgeCount: 0, connected: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get knowledge graph data (legacy)\r\n */\r\nexport async function getGraph(options?: {\r\n  type?: string;\r\n  depth?: number;\r\n  limit?: number;\r\n}): Promise<GraphData> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.type) params.set('type', options.type);\r\n    if (options?.depth) params.set('depth', String(options.depth));\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/graph?${query}` : '/api/graph';\r\n\r\n    const response = await http.get<GraphData>(url);\r\n    return response.data;\r\n  } catch {\r\n    return { nodes: [], edges: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get entity graph (centered on a specific entity)\r\n */\r\nexport async function getEntityGraph(entityId: string, depth = 2): Promise<GraphData> {\r\n  try {\r\n    const response = await http.get<GraphData>(`/api/graph/entity/${entityId}?depth=${depth}`);\r\n    return response.data;\r\n  } catch {\r\n    return { nodes: [], edges: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get related entities\r\n */\r\nexport async function getRelatedEntities(entityId: string): Promise<GraphNode[]> {\r\n  try {\r\n    const response = await http.get<{ related: GraphNode[] }>(`/api/graph/related/${entityId}`);\r\n    return response.data.related || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// ONTOLOGY FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get full ontology schema\r\n */\r\nexport async function getOntologySchema(): Promise<OntologySchema | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; schema: OntologySchema }>('/api/ontology/schema');\r\n    return response.data.schema || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get entity types\r\n */\r\nexport async function getOntologyEntities(): Promise<OntologyEntityType[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; entityTypes: OntologyEntityType[] }>('/api/ontology/entities');\r\n    return response.data.entityTypes || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get relation types\r\n */\r\nexport async function getOntologyRelations(): Promise<OntologyRelationType[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; relationTypes: OntologyRelationType[] }>('/api/ontology/relations');\r\n    return response.data.relationTypes || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology suggestions\r\n */\r\nexport async function getOntologySuggestions(): Promise<OntologySuggestion[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; suggestions: OntologySuggestion[] }>('/api/ontology/suggestions');\r\n    return response.data.suggestions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Approve ontology suggestion\r\n */\r\nexport async function approveOntologySuggestion(suggestionId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean }>(`/api/ontology/suggestions/${suggestionId}/approve`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Reject ontology suggestion\r\n */\r\nexport async function rejectOntologySuggestion(suggestionId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean }>(`/api/ontology/suggestions/${suggestionId}/reject`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SOTA v2.0 - ONTOLOGY MANAGEMENT\r\n// ============================================\r\n\r\nexport interface OntologyTypeStats {\r\n  entities: Record<string, { count: number; inOntology: boolean }>;\r\n  relations: Record<string, { count: number; inOntology: boolean }>;\r\n  unused: { entities: string[]; relations: string[] };\r\n  notInOntology: { entities: string[]; relations: string[] };\r\n}\r\n\r\nexport interface OntologySyncStatus {\r\n  isListening: boolean;\r\n  syncInProgress: boolean;\r\n  lastSyncAt: string | null;\r\n  pendingChanges: number;\r\n  ontologySource: 'supabase' | 'file' | null;\r\n  graphConnected: boolean;\r\n}\r\n\r\nexport interface OntologyChange {\r\n  id: string;\r\n  change_type: string;\r\n  target_type: string;\r\n  target_name: string;\r\n  old_definition: unknown;\r\n  new_definition: unknown;\r\n  diff: { added: unknown; removed: unknown; modified: unknown } | null;\r\n  reason: string | null;\r\n  source: string;\r\n  changed_at: string;\r\n  changed_by: string | null;\r\n}\r\n\r\nexport interface LLMAnalysisResult {\r\n  analysis: {\r\n    missingInOntology: Array<{ name: string; type: string; count: number; description: string; confidence: number }>;\r\n    unusedInOntology: Array<{ name: string; type: string }>;\r\n    suggestedRelations: Array<{ from: string; to: string; name: string; description: string }>;\r\n    suggestedInferenceRules: Array<{ name: string; description: string; pattern: string }>;\r\n    summary: string;\r\n  };\r\n  suggestions: OntologySuggestion[];\r\n  summary: string;\r\n}\r\n\r\n/**\r\n * Get type usage statistics from the graph\r\n */\r\nexport async function getOntologyTypeStats(): Promise<OntologyTypeStats | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; stats: OntologyTypeStats }>('/api/ontology/stats');\r\n    return response.data.stats || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology sync status (Supabase Graph)\r\n */\r\nexport async function getOntologySyncStatus(): Promise<OntologySyncStatus | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; status: OntologySyncStatus }>('/api/ontology/sync/status');\r\n    return response.data.status || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Force sync ontology to graph\r\n */\r\nexport async function forceOntologySync(): Promise<{ ok: boolean; results?: unknown; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; results?: unknown; error?: string }>('/api/ontology/sync/force', {});\r\n    return response.data;\r\n  } catch (e) {\r\n    return { ok: false, error: String(e) };\r\n  }\r\n}\r\n\r\n/**\r\n * Trigger LLM analysis of graph vs ontology\r\n */\r\nexport async function runLLMAnalysis(): Promise<LLMAnalysisResult | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean } & LLMAnalysisResult>('/api/ontology/analyze', {});\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Auto-approve high confidence suggestions\r\n */\r\nexport async function autoApproveHighConfidence(threshold = 0.85): Promise<{ approved: number; skipped: number }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; approved: number; skipped: number }>(\r\n      '/api/ontology/suggestions/auto-approve',\r\n      { threshold }\r\n    );\r\n    return { approved: response.data.approved || 0, skipped: response.data.skipped || 0 };\r\n  } catch {\r\n    return { approved: 0, skipped: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology change history (audit trail)\r\n */\r\nexport async function getOntologyChanges(options: {\r\n  targetType?: string;\r\n  targetName?: string;\r\n  limit?: number;\r\n} = {}): Promise<OntologyChange[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options.targetType) params.append('targetType', options.targetType);\r\n    if (options.targetName) params.append('targetName', options.targetName);\r\n    if (options.limit) params.append('limit', String(options.limit));\r\n    \r\n    const response = await http.get<{ ok: boolean; changes: OntologyChange[] }>(\r\n      `/api/ontology/changes?${params.toString()}`\r\n    );\r\n    return response.data.changes || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Migrate schema.json to Supabase\r\n */\r\nexport async function migrateOntologyToSupabase(): Promise<{ success: boolean; counts?: unknown; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; counts?: unknown; error?: string }>(\r\n      '/api/ontology/migrate',\r\n      {}\r\n    );\r\n    return response.data;\r\n  } catch (e) {\r\n    return { success: false, error: String(e) };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SOTA v2.1 - BACKGROUND WORKER\r\n// ============================================\r\n\r\nexport interface BackgroundWorkerStatus {\r\n  isRunning: boolean;\r\n  hasPendingAnalysis: boolean;\r\n  lastRun: Record<string, string>;\r\n  graphConnected: boolean;\r\n  llmConfigured: boolean;\r\n  thresholds: {\r\n    autoApprove: number;\r\n    minNodesForAnalysis: number;\r\n    analysisDebounceMs: number;\r\n  };\r\n}\r\n\r\nexport interface BackgroundWorkerStats {\r\n  totalExecutions: number;\r\n  byType: Record<string, number>;\r\n  byStatus: { completed: number; failed: number };\r\n  avgDuration: number;\r\n}\r\n\r\nexport interface BackgroundJobExecution {\r\n  type: string;\r\n  startedAt: string;\r\n  completedAt?: string;\r\n  status: string;\r\n  duration?: number;\r\n  results?: unknown;\r\n  error?: string;\r\n}\r\n\r\nexport interface OntologyJob {\r\n  id: string;\r\n  name: string;\r\n  type: string;\r\n  schedule: string;\r\n  enabled: boolean;\r\n  lastRun: string | null;\r\n  nextRun: string | null;\r\n  runCount: number;\r\n}\r\n\r\n/**\r\n * Get background worker status\r\n */\r\nexport async function getBackgroundWorkerStatus(): Promise<{ status: BackgroundWorkerStatus; stats: BackgroundWorkerStats } | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; status: BackgroundWorkerStatus; stats: BackgroundWorkerStats }>(\r\n      '/api/ontology/worker/status'\r\n    );\r\n    if (response.data.ok) {\r\n      return { status: response.data.status, stats: response.data.stats };\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Trigger background analysis manually\r\n */\r\nexport async function triggerBackgroundAnalysis(\r\n  type: 'full' | 'inference' | 'dedup' | 'auto_approve' | 'gaps',\r\n  config: Record<string, unknown> = {}\r\n): Promise<BackgroundJobExecution | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean } & BackgroundJobExecution>(\r\n      '/api/ontology/worker/trigger',\r\n      { type, config }\r\n    );\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get background worker execution log\r\n */\r\nexport async function getBackgroundWorkerLog(options: {\r\n  type?: string;\r\n  status?: string;\r\n  limit?: number;\r\n} = {}): Promise<BackgroundJobExecution[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options.type) params.append('type', options.type);\r\n    if (options.status) params.append('status', options.status);\r\n    if (options.limit) params.append('limit', String(options.limit));\r\n    \r\n    const response = await http.get<{ ok: boolean; log: BackgroundJobExecution[] }>(\r\n      `/api/ontology/worker/log?${params.toString()}`\r\n    );\r\n    return response.data.log || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology-related scheduled jobs\r\n */\r\nexport async function getOntologyJobs(): Promise<OntologyJob[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; jobs: OntologyJob[] }>('/api/ontology/jobs');\r\n    return response.data.jobs || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle an ontology job (enable/disable)\r\n */\r\nexport async function toggleOntologyJob(jobId: string, enabled?: boolean): Promise<OntologyJob | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; job: OntologyJob }>(\r\n      `/api/ontology/jobs/${jobId}/toggle`,\r\n      { enabled }\r\n    );\r\n    if (response.data.ok) {\r\n      return response.data.job;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// ONTOLOGY EXTRACTOR (SOTA v2.1)\r\n// ============================================\r\n\r\nexport interface ExtractedOntology {\r\n  version: string;\r\n  extractedAt: string;\r\n  entityTypes: Record<string, {\r\n    label: string;\r\n    description: string;\r\n    properties: Record<string, { type: string; required: boolean; searchable: boolean }>;\r\n    nodeCount: number;\r\n    extractedFrom: string;\r\n  }>;\r\n  relationTypes: Record<string, {\r\n    label: string;\r\n    description: string;\r\n    fromTypes: string[];\r\n    toTypes: string[];\r\n    edgeCount: number;\r\n    extractedFrom: string;\r\n  }>;\r\n}\r\n\r\nexport interface ComplianceResult {\r\n  valid: boolean;\r\n  score: number;\r\n  issues: Array<{\r\n    type: string;\r\n    severity: 'error' | 'warning' | 'info';\r\n    message: string;\r\n    label?: string;\r\n    count?: number;\r\n    suggestion?: string;\r\n  }>;\r\n  stats: {\r\n    totalNodes: number;\r\n    validNodes: number;\r\n    invalidNodes: number;\r\n    unknownTypeNodes: number;\r\n    totalRelationships: number;\r\n    validRelationships: number;\r\n    invalidRelationships: number;\r\n    unknownTypeRelationships: number;\r\n    missingRequiredProperties: number;\r\n    invalidPropertyTypes: number;\r\n  };\r\n}\r\n\r\nexport interface OntologyDiff {\r\n  entitiesOnlyInA: string[];\r\n  entitiesOnlyInB: string[];\r\n  entitiesInBoth: string[];\r\n  relationsOnlyInA: string[];\r\n  relationsOnlyInB: string[];\r\n  relationsInBoth: string[];\r\n}\r\n\r\nexport interface GraphBrowserInfo {\r\n  browserUrl: string;\r\n  isCloud: boolean;\r\n  host: string;\r\n  note: string;\r\n}\r\n\r\n// Alias for backward compatibility\r\nexport type FalkorDBBrowserInfo = GraphBrowserInfo;\r\n\r\n/**\r\n * Extract ontology from graph\r\n */\r\nexport async function extractOntologyFromGraph(): Promise<{ ok: boolean; ontology?: ExtractedOntology; stats?: Record<string, number>; error?: string }> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; ontology?: ExtractedOntology; stats?: Record<string, number>; error?: string }>('/api/ontology/extract-from-graph');\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, error: 'Failed to extract ontology' };\r\n  }\r\n}\r\n\r\n/**\r\n * Validate graph compliance against ontology\r\n */\r\nexport async function validateOntologyCompliance(): Promise<ComplianceResult | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean } & ComplianceResult>('/api/ontology/validate-compliance');\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get diff between current ontology and graph\r\n */\r\nexport async function getOntologyDiff(): Promise<{ diff: OntologyDiff; extractedOntology: ExtractedOntology } | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; diff: OntologyDiff; extractedOntology: ExtractedOntology }>('/api/ontology/diff');\r\n    if (response.data.ok) {\r\n      return { diff: response.data.diff, extractedOntology: response.data.extractedOntology };\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Find unused types in ontology\r\n */\r\nexport async function findUnusedOntologyTypes(): Promise<{ entities: string[]; relations: string[] }> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; unused: { entities: string[]; relations: string[] } }>('/api/ontology/unused-types');\r\n    return response.data.unused || { entities: [], relations: [] };\r\n  } catch {\r\n    return { entities: [], relations: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Merge extracted ontology with current\r\n */\r\nexport async function mergeOntology(options: { \r\n  ontology?: ExtractedOntology; \r\n  mergeProperties?: boolean; \r\n  mergeEndpoints?: boolean; \r\n  save?: boolean \r\n}): Promise<{ ok: boolean; changes?: Array<{ type: string; name: string }>; saved?: boolean }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; changes: Array<{ type: string; name: string }>; saved: boolean }>('/api/ontology/merge', options);\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Cleanup orphan ontology types\r\n */\r\nexport async function cleanupOntology(options: {\r\n  discardEntitiesWithoutRelations?: boolean;\r\n  discardRelationsWithoutEntities?: boolean;\r\n  save?: boolean;\r\n}): Promise<{ ok: boolean; discardedEntities?: Array<{ name: string }>; discardedRelations?: Array<{ name: string }> }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; discardedEntities: Array<{ name: string }>; discardedRelations: Array<{ name: string }> }>('/api/ontology/cleanup', options);\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Graph Browser URL info (legacy - kept for compatibility)\r\n */\r\nexport async function getFalkorDBBrowserInfo(): Promise<FalkorDBBrowserInfo | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean } & FalkorDBBrowserInfo>('/api/graph/falkordb-browser');\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport interface FalkorDBGraphSyncResult {\r\n  ok: boolean;\r\n  error?: string;\r\n  graphs: string[];\r\n  validGraphs: string[];\r\n  orphanGraphs: string[];\r\n  deleted: string[];\r\n  dryRun: boolean;\r\n}\r\n\r\n/**\r\n * List all graphs in FalkorDB\r\n */\r\nexport async function listAllFalkorDBGraphs(): Promise<{ ok: boolean; graphs: string[] }> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; graphs: string[] }>('/api/graph/list-all');\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, graphs: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Sync graphs with Supabase projects (cleanup orphans)\r\n * @param dryRun - If true, only report what would be deleted without actually deleting\r\n */\r\nexport async function syncFalkorDBGraphs(dryRun = false): Promise<FalkorDBGraphSyncResult> {\r\n  try {\r\n    const response = await http.post<FalkorDBGraphSyncResult>('/api/graph/sync-projects', { dryRun });\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, error: 'Request failed', graphs: [], validGraphs: [], orphanGraphs: [], deleted: [], dryRun };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a specific graph\r\n */\r\nexport async function deleteFalkorDBGraph(graphName: string): Promise<{ ok: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean; error?: string }>(`/api/graph/delete/${encodeURIComponent(graphName)}`);\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, error: 'Request failed' };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// ANALYTICS FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get detected communities\r\n */\r\nexport async function getCommunities(): Promise<Community[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; communities: Community[] }>('/api/graphrag/communities');\r\n    return response.data.communities || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get centrality metrics\r\n */\r\nexport async function getCentrality(): Promise<CentralityMetrics> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; centrality: CentralityMetrics }>('/api/graphrag/centrality');\r\n    return response.data.centrality || { topNodes: [] };\r\n  } catch {\r\n    return { topNodes: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get bridge nodes\r\n */\r\nexport async function getBridges(): Promise<BridgeNode[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; bridges: BridgeNode[] }>('/api/graphrag/bridges');\r\n    return response.data.bridges || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get AI-generated insights\r\n */\r\nexport async function getInsights(): Promise<GraphInsight[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; insights: GraphInsight[] }>('/api/graph/insights');\r\n    return response.data.insights || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// GRAPHRAG / AI FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Query using GraphRAG\r\n */\r\nexport async function graphRAGQuery(query: string, options?: {\r\n  noCache?: boolean;\r\n}): Promise<GraphRAGResponse> {\r\n  try {\r\n    const response = await http.post<GraphRAGResponse>('/api/graphrag/query', {\r\n      query,\r\n      noCache: options?.noCache,\r\n    });\r\n    return response.data;\r\n  } catch (error) {\r\n    return {\r\n      ok: false,\r\n      answer: 'Failed to process query',\r\n      sources: [],\r\n      queryType: 'hybrid',\r\n      latencyMs: 0,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Stream GraphRAG response (for AI Copilot)\r\n */\r\nexport function streamGraphRAGQuery(\r\n  query: string,\r\n  onChunk: (chunk: string) => void,\r\n  onComplete: (response: GraphRAGResponse) => void,\r\n  onError: (error: Error) => void\r\n): () => void {\r\n  const controller = new AbortController();\r\n  \r\n  fetch('/api/graphrag/stream', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ query }),\r\n    signal: controller.signal,\r\n  })\r\n    .then(async (response) => {\r\n      if (!response.ok) throw new Error('Stream request failed');\r\n      \r\n      const reader = response.body?.getReader();\r\n      if (!reader) throw new Error('No reader available');\r\n      \r\n      const decoder = new TextDecoder();\r\n      let fullResponse = '';\r\n      \r\n      while (true) {\r\n        const { done, value } = await reader.read();\r\n        if (done) break;\r\n        \r\n        const chunk = decoder.decode(value, { stream: true });\r\n        const lines = chunk.split('\\n');\r\n        \r\n        for (const line of lines) {\r\n          if (line.startsWith('data: ')) {\r\n            const data = line.slice(6);\r\n            if (data === '[DONE]') {\r\n              onComplete({\r\n                ok: true,\r\n                answer: fullResponse,\r\n                sources: [],\r\n                queryType: 'hybrid',\r\n                latencyMs: 0,\r\n              });\r\n              return;\r\n            }\r\n            try {\r\n              const parsed = JSON.parse(data);\r\n              if (parsed.content) {\r\n                fullResponse += parsed.content;\r\n                onChunk(parsed.content);\r\n              }\r\n            } catch {\r\n              // Not JSON, treat as raw text\r\n              fullResponse += data;\r\n              onChunk(data);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      if (error.name !== 'AbortError') {\r\n        onError(error);\r\n      }\r\n    });\r\n  \r\n  return () => controller.abort();\r\n}\r\n\r\n/**\r\n * Multi-hop reasoning query\r\n */\r\nexport async function multiHopQuery(query: string): Promise<MultiHopResult> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean } & MultiHopResult>('/api/graphrag/multihop', { query });\r\n    return response.data;\r\n  } catch {\r\n    return {\r\n      answer: 'Failed to process multi-hop query',\r\n      reasoningChain: [],\r\n      confidence: 0,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Explain connection between two nodes (LLM-powered)\r\n */\r\nexport async function explainConnection(nodeId1: string, nodeId2: string): Promise<{\r\n  explanation: string;\r\n  paths: Array<{ nodes: string[]; relationships: string[] }>;\r\n  facts: string[];\r\n}> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      explanation: string;\r\n      paths: Array<{ nodes: string[]; relationships: string[] }>;\r\n      facts: string[];\r\n    }>('/api/graphrag/explain', { nodeId1, nodeId2 });\r\n    return response.data;\r\n  } catch {\r\n    return { explanation: 'Unable to explain connection', paths: [], facts: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Summarize selected nodes (LLM-powered)\r\n */\r\nexport async function summarizeSelection(nodeIds: string[]): Promise<{\r\n  summary: string;\r\n  insights: string[];\r\n  suggestedActions: string[];\r\n}> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      summary: string;\r\n      insights: string[];\r\n      suggestedActions: string[];\r\n    }>('/api/graphrag/summarize', { nodeIds });\r\n    return response.data;\r\n  } catch {\r\n    return { summary: 'Unable to generate summary', insights: [], suggestedActions: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Natural language filter (LLM-powered)\r\n */\r\nexport async function naturalLanguageFilter(filterText: string): Promise<{\r\n  filters: {\r\n    entityTypes?: string[];\r\n    properties?: Record<string, unknown>;\r\n    cypher?: string;\r\n  };\r\n  explanation: string;\r\n}> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      filters: {\r\n        entityTypes?: string[];\r\n        properties?: Record<string, unknown>;\r\n        cypher?: string;\r\n      };\r\n      explanation: string;\r\n    }>('/api/graphrag/filter', { filterText });\r\n    return response.data;\r\n  } catch {\r\n    return { filters: {}, explanation: 'Unable to parse filter' };\r\n  }\r\n}\r\n\r\n/**\r\n * Suggest related nodes to explore\r\n */\r\nexport async function suggestRelated(nodeId: string): Promise<Array<{\r\n  node: GraphNode;\r\n  reason: string;\r\n  relevance: number;\r\n}>> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      suggestions: Array<{ node: GraphNode; reason: string; relevance: number }>;\r\n    }>('/api/graphrag/suggest-related', { nodeId });\r\n    return response.data.suggestions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// CYPHER QUERY FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Execute raw Cypher query\r\n */\r\nexport async function executeCypher(cypher: string): Promise<CypherQueryResult> {\r\n  try {\r\n    const response = await http.post<CypherQueryResult>('/api/graph/query', { cypher });\r\n    return response.data;\r\n  } catch (error) {\r\n    return {\r\n      ok: false,\r\n      results: [],\r\n      error: error instanceof Error ? error.message : 'Query failed',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get query templates\r\n */\r\nexport async function getQueryTemplates(): Promise<Array<{\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  cypher: string;\r\n  category: string;\r\n}>> {\r\n  try {\r\n    const schema = await getOntologySchema();\r\n    if (!schema?.queryPatterns) return [];\r\n    \r\n    return Object.entries(schema.queryPatterns).map(([id, pattern]) => ({\r\n      id,\r\n      name: id.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase()),\r\n      description: pattern.description,\r\n      cypher: pattern.cypher,\r\n      category: 'ontology',\r\n    }));\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// CROSS-PROJECT FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get list of project graphs\r\n */\r\nexport async function getProjectGraphs(): Promise<Array<{\r\n  graphName: string;\r\n  projectId: string;\r\n  projectName: string;\r\n  nodeCount?: number;\r\n  edgeCount?: number;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; graphs: Array<{\r\n      graphName: string;\r\n      projectId: string;\r\n      projectName: string;\r\n      nodeCount?: number;\r\n      edgeCount?: number;\r\n    }> }>('/api/graph/projects');\r\n    return response.data.graphs || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get cross-project entity (shared entities)\r\n */\r\nexport async function getCrossProjectEntities(entityType: string): Promise<Array<{\r\n  entity: GraphNode;\r\n  projects: Array<{ id: string; name: string }>;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      entities: Array<{ entity: GraphNode; projects: Array<{ id: string; name: string }> }>;\r\n    }>(`/api/graph/cross-project/${entityType}`);\r\n    return response.data.entities || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Query History\r\n// ============================================\r\n\r\n/**\r\n * Save query to history\r\n */\r\nexport async function saveQueryHistory(query: Omit<GraphQueryHistory, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphQueryHistory | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; query: GraphQueryHistory }>('/api/graph/queries', query);\r\n    return response.data.query || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get query history\r\n */\r\nexport async function getQueryHistory(options?: {\r\n  limit?: number;\r\n  favoritesOnly?: boolean;\r\n}): Promise<GraphQueryHistory[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.favoritesOnly) params.set('favorites', 'true');\r\n    \r\n    const response = await http.get<{ ok: boolean; queries: GraphQueryHistory[] }>(\r\n      `/api/graph/queries?${params.toString()}`\r\n    );\r\n    return response.data.queries || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle query favorite\r\n */\r\nexport async function toggleQueryFavorite(queryId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/queries/${queryId}/favorite`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete query from history\r\n */\r\nexport async function deleteQueryHistory(queryId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/queries/${queryId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Saved Views\r\n// ============================================\r\n\r\n/**\r\n * Save current view\r\n */\r\nexport async function saveView(view: Omit<GraphSavedView, 'id' | 'project_id' | 'user_id' | 'created_at' | 'updated_at'>): Promise<GraphSavedView | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; view: GraphSavedView }>('/api/graph/views', view);\r\n    return response.data.view || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get saved views\r\n */\r\nexport async function getSavedViews(): Promise<GraphSavedView[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; views: GraphSavedView[] }>('/api/graph/views');\r\n    return response.data.views || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update saved view\r\n */\r\nexport async function updateView(viewId: string, updates: Partial<GraphSavedView>): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/views/${viewId}`, updates);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete saved view\r\n */\r\nexport async function deleteView(viewId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/views/${viewId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Bookmarks\r\n// ============================================\r\n\r\n/**\r\n * Add bookmark\r\n */\r\nexport async function addBookmark(bookmark: Omit<GraphBookmark, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphBookmark | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; bookmark: GraphBookmark }>('/api/graph/bookmarks', bookmark);\r\n    return response.data.bookmark || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get bookmarks\r\n */\r\nexport async function getBookmarks(): Promise<GraphBookmark[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; bookmarks: GraphBookmark[] }>('/api/graph/bookmarks');\r\n    return response.data.bookmarks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update bookmark\r\n */\r\nexport async function updateBookmark(bookmarkId: string, updates: Partial<GraphBookmark>): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/bookmarks/${bookmarkId}`, updates);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Remove bookmark\r\n */\r\nexport async function removeBookmark(bookmarkId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/bookmarks/${bookmarkId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Annotations\r\n// ============================================\r\n\r\n/**\r\n * Create annotation\r\n */\r\nexport async function createAnnotation(annotation: Omit<GraphAnnotation, 'id' | 'project_id' | 'user_id' | 'created_at' | 'updated_at'>): Promise<GraphAnnotation | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; annotation: GraphAnnotation }>('/api/graph/annotations', annotation);\r\n    return response.data.annotation || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get annotations\r\n */\r\nexport async function getAnnotations(options?: {\r\n  targetType?: string;\r\n  targetId?: string;\r\n  includeShared?: boolean;\r\n}): Promise<GraphAnnotation[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.targetType) params.set('targetType', options.targetType);\r\n    if (options?.targetId) params.set('targetId', options.targetId);\r\n    if (options?.includeShared) params.set('includeShared', 'true');\r\n    \r\n    const response = await http.get<{ ok: boolean; annotations: GraphAnnotation[] }>(\r\n      `/api/graph/annotations?${params.toString()}`\r\n    );\r\n    return response.data.annotations || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update annotation\r\n */\r\nexport async function updateAnnotation(annotationId: string, updates: Partial<GraphAnnotation>): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/annotations/${annotationId}`, updates);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete annotation\r\n */\r\nexport async function deleteAnnotation(annotationId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/annotations/${annotationId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Chat History\r\n// ============================================\r\n\r\n/**\r\n * Save chat message\r\n */\r\nexport async function saveChatMessage(message: Omit<GraphChatMessage, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphChatMessage | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; message: GraphChatMessage }>('/api/graph/chat', message);\r\n    return response.data.message || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get chat sessions\r\n */\r\nexport async function getChatSessions(): Promise<Array<{\r\n  sessionId: string;\r\n  firstMessage: string;\r\n  messageCount: number;\r\n  lastActivity: string;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      sessions: Array<{\r\n        sessionId: string;\r\n        firstMessage: string;\r\n        messageCount: number;\r\n        lastActivity: string;\r\n      }>;\r\n    }>('/api/graph/chat/sessions');\r\n    return response.data.sessions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get chat history for session\r\n */\r\nexport async function getChatHistory(sessionId: string): Promise<GraphChatMessage[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; messages: GraphChatMessage[] }>(\r\n      `/api/graph/chat/session/${sessionId}`\r\n    );\r\n    return response.data.messages || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle message pin\r\n */\r\nexport async function toggleChatPin(messageId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/chat/${messageId}/pin`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Snapshots\r\n// ============================================\r\n\r\n/**\r\n * Create snapshot\r\n */\r\nexport async function createSnapshot(snapshot: Omit<GraphSnapshot, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphSnapshot | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; snapshot: GraphSnapshot }>('/api/graph/snapshots', snapshot);\r\n    return response.data.snapshot || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get snapshots\r\n */\r\nexport async function getSnapshots(): Promise<GraphSnapshot[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; snapshots: GraphSnapshot[] }>('/api/graph/snapshots');\r\n    return response.data.snapshots || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get snapshot by ID\r\n */\r\nexport async function getSnapshot(snapshotId: string): Promise<GraphSnapshot | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; snapshot: GraphSnapshot }>(`/api/graph/snapshots/${snapshotId}`);\r\n    return response.data.snapshot || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Compare snapshots\r\n */\r\nexport async function compareSnapshots(snapshotId1: string, snapshotId2: string): Promise<{\r\n  diff: {\r\n    nodesAdded: GraphNode[];\r\n    nodesRemoved: GraphNode[];\r\n    edgesAdded: GraphEdge[];\r\n    edgesRemoved: GraphEdge[];\r\n    statsComparison: {\r\n      nodeCountDiff: number;\r\n      edgeCountDiff: number;\r\n    };\r\n  };\r\n}> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      diff: {\r\n        nodesAdded: GraphNode[];\r\n        nodesRemoved: GraphNode[];\r\n        edgesAdded: GraphEdge[];\r\n        edgesRemoved: GraphEdge[];\r\n        statsComparison: { nodeCountDiff: number; edgeCountDiff: number };\r\n      };\r\n    }>(`/api/graph/snapshots/compare?id1=${snapshotId1}&id2=${snapshotId2}`);\r\n    return response.data;\r\n  } catch {\r\n    return {\r\n      diff: {\r\n        nodesAdded: [],\r\n        nodesRemoved: [],\r\n        edgesAdded: [],\r\n        edgesRemoved: [],\r\n        statsComparison: { nodeCountDiff: 0, edgeCountDiff: 0 },\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete snapshot\r\n */\r\nexport async function deleteSnapshot(snapshotId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/snapshots/${snapshotId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// TIMELINE FUNCTIONS (existing)\r\n// ============================================\r\n\r\nexport async function getTimeline(options?: {\r\n  startDate?: string;\r\n  endDate?: string;\r\n  types?: string[];\r\n  limit?: number;\r\n}): Promise<TimelineData> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.startDate) params.set('startDate', options.startDate);\r\n    if (options?.endDate) params.set('endDate', options.endDate);\r\n    if (options?.types?.length) params.set('types', options.types.join(','));\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/timeline?${query}` : '/api/timeline';\r\n\r\n    const response = await http.get<{\r\n      events?: Array<Record<string, unknown>>;\r\n      totalEvents?: number;\r\n      startDate?: string;\r\n      endDate?: string;\r\n    }>(url);\r\n\r\n    const raw = response.data.events || [];\r\n    const events: TimelineEvent[] = raw.map((e: Record<string, unknown>) => ({\r\n      id: String(e.id ?? ''),\r\n      date: String(e.date ?? ''),\r\n      title: String(e.title ?? ''),\r\n      description: e.content != null ? String(e.content) : undefined,\r\n      content: e.content != null ? String(e.content) : undefined,\r\n      type: (e.type as TimelineEvent['type']) ?? 'document',\r\n      entity_id: e.entity_id != null ? String(e.entity_id) : undefined,\r\n      entity_type: e.entity_type != null ? String(e.entity_type) : undefined,\r\n      metadata: (e.metadata as Record<string, unknown>) ?? undefined,\r\n      user: e.owner != null ? String(e.owner) : e.user as string | undefined,\r\n      actor: e.owner != null ? String(e.owner) : e.actor as string | undefined,\r\n      owner: e.owner != null ? String(e.owner) : undefined,\r\n      icon: e.icon as string | undefined,\r\n      color: e.color as string | undefined,\r\n      status: e.status as string | undefined,\r\n    }));\r\n\r\n    return {\r\n      events,\r\n      totalEvents: response.data.totalEvents ?? events.length,\r\n      startDate: response.data.startDate ?? '',\r\n      endDate: response.data.endDate ?? '',\r\n    };\r\n  } catch {\r\n    return { events: [], startDate: '', endDate: '', totalEvents: 0 };\r\n  }\r\n}\r\n\r\nexport async function getEntityTimeline(entityType: string, entityId: string): Promise<TimelineEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: TimelineEvent[] }>(`/api/timeline/${entityType}/${entityId}`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// COST FUNCTIONS (existing)\r\n// ============================================\r\n\r\nexport async function getCosts(options?: {\r\n  startDate?: string;\r\n  endDate?: string;\r\n  provider?: string;\r\n  model?: string;\r\n}): Promise<LLMCost[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.startDate) params.set('startDate', options.startDate);\r\n    if (options?.endDate) params.set('endDate', options.endDate);\r\n    if (options?.provider) params.set('provider', options.provider);\r\n    if (options?.model) params.set('model', options.model);\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/costs?${query}` : '/api/costs';\r\n\r\n    const response = await http.get<{ costs: LLMCost[] }>(url);\r\n    return response.data.costs || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getCostSummary(period?: 'day' | 'week' | 'month' | 'all'): Promise<CostSummary> {\r\n  try {\r\n    const url = period ? `/api/costs/summary?period=${period}` : '/api/costs/summary';\r\n    const response = await http.get<Record<string, unknown>>(url);\r\n    const raw = response.data;\r\n    if (!raw) {\r\n      return {\r\n        total: 0,\r\n        byProvider: {},\r\n        byModel: {},\r\n        byOperation: {},\r\n        period: { start: '', end: '' },\r\n        dailyBreakdown: [],\r\n      };\r\n    }\r\n    // Normalize snake_case from API to camelCase for frontend\r\n    const dailyBreakdown = (raw.dailyBreakdown ?? raw.daily_breakdown) as Array<{ date: string; cost: number; calls?: number; requests?: number }> | undefined;\r\n    const normalized = (dailyBreakdown ?? []).map((d) => ({\r\n      date: d.date,\r\n      cost: typeof d.cost === 'number' ? d.cost : parseFloat(String(d.cost)) || 0,\r\n      calls: d.calls ?? d.requests ?? 0,\r\n    }));\r\n    return {\r\n      total: typeof raw.total === 'number' ? raw.total : parseFloat(String(raw.total)) || 0,\r\n      byProvider: (raw.byProvider ?? raw.by_provider ?? {}) as Record<string, number>,\r\n      byModel: (raw.byModel ?? raw.by_model ?? {}) as Record<string, number>,\r\n      byOperation: (raw.byOperation ?? raw.by_operation ?? {}) as Record<string, number>,\r\n      byContext: (raw.byContext ?? raw.by_context) as Record<string, number> | undefined,\r\n      period: (raw.period ?? { start: '', end: '' }) as { start: string; end: string },\r\n      dailyBreakdown: normalized,\r\n      totalInputTokens: (raw.totalInputTokens ?? raw.total_input_tokens) as number | undefined,\r\n      totalOutputTokens: (raw.totalOutputTokens ?? raw.total_output_tokens) as number | undefined,\r\n      previousPeriodCost: (raw.previousPeriodCost ?? raw.previous_period_cost) as number | null | undefined,\r\n      percentChange: (raw.percentChange ?? raw.percent_change) as number | null | undefined,\r\n      budgetLimit: (raw.budgetLimit ?? raw.budget_limit) as number | null | undefined,\r\n      budgetUsedPercent: (raw.budgetUsedPercent ?? raw.budget_used_percent) as number | null | undefined,\r\n      budgetAlertTriggered: (raw.budgetAlertTriggered ?? raw.budget_alert_triggered) as boolean | undefined,\r\n    };\r\n  } catch {\r\n    return {\r\n      total: 0,\r\n      byProvider: {},\r\n      byModel: {},\r\n      byOperation: {},\r\n      period: { start: '', end: '' },\r\n      dailyBreakdown: [],\r\n    };\r\n  }\r\n}\r\n\r\nexport interface RecentCostRequest {\r\n  id: string;\r\n  timestamp: string;\r\n  provider: string;\r\n  model: string;\r\n  operation?: string;\r\n  request_type?: string | null;\r\n  input_tokens?: number;\r\n  output_tokens?: number;\r\n  cost?: number;\r\n  latency_ms?: number | null;\r\n  success?: boolean;\r\n}\r\n\r\nexport async function getRecentCostRequests(limit = 20): Promise<RecentCostRequest[]> {\r\n  try {\r\n    const response = await http.get<{ requests: RecentCostRequest[] }>(\r\n      `/api/costs/recent?limit=${limit}`\r\n    );\r\n    return response.data?.requests ?? [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface PricingRow {\r\n  model: string;\r\n  inputPer1M: number;\r\n  outputPer1M: number;\r\n}\r\n\r\nexport async function getCostsPricing(): Promise<PricingRow[]> {\r\n  try {\r\n    const response = await http.get<{ pricing: PricingRow[] }>('/api/costs/pricing');\r\n    return response.data?.pricing ?? [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface CostBudget {\r\n  period: 'week' | 'month';\r\n  limitUsd: number;\r\n  alertThresholdPercent: number;\r\n  notifiedAt?: string | null;\r\n}\r\n\r\nexport async function getCostsBudget(period: 'week' | 'month'): Promise<CostBudget | null> {\r\n  try {\r\n    const response = await http.get<{ budget: Record<string, unknown> | null }>(\r\n      `/api/costs/budget?period=${period}`\r\n    );\r\n    const raw = response.data?.budget;\r\n    if (!raw) return null;\r\n    const limitUsd = (raw.limitUsd ?? raw.limit_usd) as number | undefined;\r\n    const alertThresholdPercent = (raw.alertThresholdPercent ?? raw.alert_threshold_percent) as number | undefined;\r\n    if (limitUsd == null || !Number.isFinite(Number(limitUsd))) return null;\r\n    return {\r\n      period: (raw.period as 'week' | 'month') ?? period,\r\n      limitUsd: Number(limitUsd),\r\n      alertThresholdPercent: alertThresholdPercent != null ? Math.min(100, Math.max(0, Number(alertThresholdPercent))) : 80,\r\n      notifiedAt: (raw.notifiedAt ?? raw.notified_at) as string | null | undefined,\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function setCostsBudget(\r\n  period: 'week' | 'month',\r\n  limitUsd: number,\r\n  alertThresholdPercent: number\r\n): Promise<void> {\r\n  await http.post('/api/costs/budget', {\r\n    period,\r\n    limitUsd,\r\n    alertThresholdPercent,\r\n  });\r\n}\r\n\r\nexport async function getLLMConfig(): Promise<{\r\n  provider: string;\r\n  model: string;\r\n  available: string[];\r\n  limits?: Record<string, number>;\r\n}> {\r\n  try {\r\n    const response = await http.get<{\r\n      provider: string;\r\n      model: string;\r\n      available: string[];\r\n      limits?: Record<string, number>;\r\n    }>('/api/llm/config');\r\n    return response.data;\r\n  } catch {\r\n    return { provider: 'unknown', model: 'unknown', available: [] };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SERVICE EXPORTS\r\n// ============================================\r\n\r\nexport const graphService = {\r\n  // Data\r\n  getVisualizationData,\r\n  getStats,\r\n  getGraph,\r\n  getEntityGraph,\r\n  getRelated: getRelatedEntities,\r\n  \r\n  // Ontology\r\n  getOntologySchema,\r\n  getOntologyEntities,\r\n  getOntologyRelations,\r\n  getOntologySuggestions,\r\n  approveOntologySuggestion,\r\n  rejectOntologySuggestion,\r\n  \r\n  // Ontology SOTA v2.0\r\n  getOntologyTypeStats,\r\n  getOntologySyncStatus,\r\n  forceOntologySync,\r\n  runLLMAnalysis,\r\n  autoApproveHighConfidence,\r\n  getOntologyChanges,\r\n  migrateOntologyToSupabase,\r\n  \r\n  // Background Worker (SOTA v2.1)\r\n  getBackgroundWorkerStatus,\r\n  triggerBackgroundAnalysis,\r\n  getBackgroundWorkerLog,\r\n  getOntologyJobs,\r\n  toggleOntologyJob,\r\n  \r\n  // Ontology Extractor (SOTA v2.1)\r\n  extractOntologyFromGraph,\r\n  validateOntologyCompliance,\r\n  getOntologyDiff,\r\n  findUnusedOntologyTypes,\r\n  mergeOntology,\r\n  cleanupOntology,\r\n  getFalkorDBBrowserInfo,\r\n  \r\n  // Graph Management (legacy names kept for compatibility)\r\n  listAllFalkorDBGraphs,\r\n  syncFalkorDBGraphs,\r\n  deleteFalkorDBGraph,\r\n  \r\n  // Analytics\r\n  getCommunities,\r\n  getCentrality,\r\n  getBridges,\r\n  getInsights,\r\n  \r\n  // GraphRAG / AI\r\n  query: graphRAGQuery,\r\n  stream: streamGraphRAGQuery,\r\n  multiHop: multiHopQuery,\r\n  explainConnection,\r\n  summarizeSelection,\r\n  naturalLanguageFilter,\r\n  suggestRelated,\r\n  \r\n  // Cypher\r\n  executeCypher,\r\n  getQueryTemplates,\r\n  \r\n  // Cross-project\r\n  getProjectGraphs,\r\n  getCrossProjectEntities,\r\n  \r\n  // Persistence - Queries\r\n  saveQueryHistory,\r\n  getQueryHistory,\r\n  toggleQueryFavorite,\r\n  deleteQueryHistory,\r\n  \r\n  // Persistence - Views\r\n  saveView,\r\n  getSavedViews,\r\n  updateView,\r\n  deleteView,\r\n  \r\n  // Persistence - Bookmarks\r\n  addBookmark,\r\n  getBookmarks,\r\n  updateBookmark,\r\n  removeBookmark,\r\n  \r\n  // Persistence - Annotations\r\n  createAnnotation,\r\n  getAnnotations,\r\n  updateAnnotation,\r\n  deleteAnnotation,\r\n  \r\n  // Persistence - Chat\r\n  saveChatMessage,\r\n  getChatSessions,\r\n  getChatHistory,\r\n  toggleChatPin,\r\n  \r\n  // Persistence - Snapshots\r\n  createSnapshot,\r\n  getSnapshots,\r\n  getSnapshot,\r\n  compareSnapshots,\r\n  deleteSnapshot,\r\n};\r\n\r\nexport const timelineService = {\r\n  getAll: getTimeline,\r\n  getTimeline, // Direct export for backwards compatibility\r\n  getForEntity: getEntityTimeline,\r\n};\r\n\r\nexport const costsService = {\r\n  getAll: getCosts,\r\n  getSummary: getCostSummary,\r\n  getRecentRequests: getRecentCostRequests,\r\n  getPricing: getCostsPricing,\r\n  getBudget: getCostsBudget,\r\n  setBudget: setCostsBudget,\r\n  getLLMConfig,\r\n};\r\n","/**\r\n * Notifications Service\r\n * Handles notifications and collaboration features\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  type: 'info' | 'warning' | 'success' | 'error' | 'mention' | 'assignment' | 'update' | 'reminder';\r\n  title: string;\r\n  message: string;\r\n  entity_type?: 'question' | 'risk' | 'action' | 'decision' | 'document' | 'contact' | 'project';\r\n  entity_id?: string;\r\n  is_read: boolean;\r\n  read?: boolean; // Alias for is_read\r\n  created_at: string;\r\n  read_at?: string;\r\n  action_url?: string;\r\n}\r\n\r\nexport interface Comment {\r\n  id: string;\r\n  entity_type: 'question' | 'risk' | 'action' | 'decision' | 'document' | 'contact';\r\n  entity_id: string;\r\n  content: string;\r\n  author: string;\r\n  author_id?: string;\r\n  user_id?: string;\r\n  user_name?: string;\r\n  mentions?: string[];\r\n  reactions?: Array<{\r\n    emoji: string;\r\n    users: string[];\r\n  }>;\r\n  parent_id?: string;\r\n  replies?: Comment[];\r\n  resolved?: boolean;\r\n  resolved_at?: string;\r\n  resolved_by?: string;\r\n  created_at: string;\r\n  updated_at?: string;\r\n  is_edited: boolean;\r\n}\r\n\r\nexport interface ProjectMember {\r\n  id: string;\r\n  user_id: string;\r\n  project_id: string;\r\n  role: 'owner' | 'admin' | 'editor' | 'viewer';\r\n  email: string;\r\n  name?: string;\r\n  avatar_url?: string;\r\n  joined_at: string;\r\n  invited_by?: string;\r\n  last_active?: string;\r\n}\r\n\r\n/**\r\n * Get all notifications\r\n */\r\nexport async function getNotifications(options?: {\r\n  unread?: boolean;\r\n  type?: string;\r\n  limit?: number;\r\n}): Promise<Notification[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.unread) params.set('unread', 'true');\r\n    if (options?.type) params.set('type', options.type);\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/notifications?${query}` : '/api/notifications';\r\n\r\n    const response = await http.get<{ notifications: Notification[] }>(url);\r\n    return response.data.notifications || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get unread count\r\n */\r\nexport async function getUnreadCount(): Promise<number> {\r\n  try {\r\n    const response = await http.get<{ count: number }>('/api/notifications/count');\r\n    return response.data.count || 0;\r\n  } catch {\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Mark notification as read\r\n */\r\nexport async function markAsRead(id: string): Promise<void> {\r\n  await http.post(`/api/notifications/${id}/read`);\r\n}\r\n\r\n/**\r\n * Mark all as read\r\n */\r\nexport async function markAllAsRead(): Promise<void> {\r\n  await http.post('/api/notifications/read-all');\r\n}\r\n\r\n/**\r\n * Delete a notification\r\n */\r\nexport async function deleteNotification(id: string): Promise<void> {\r\n  await http.delete(`/api/notifications/${id}`);\r\n}\r\n\r\n/**\r\n * Get comments for an entity\r\n */\r\nexport async function getComments(entityType: string, entityId: string): Promise<Comment[]> {\r\n  try {\r\n    const response = await http.get<{ comments: Comment[] }>(`/api/comments/${entityType}/${entityId}`);\r\n    return response.data.comments || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Add a comment\r\n */\r\nexport async function addComment(entityType: string, entityId: string, content: string, parentId?: string): Promise<Comment> {\r\n  const response = await http.post<{ comment: Comment; id: string }>(`/api/comments/${entityType}/${entityId}`, {\r\n    content,\r\n    parentId,\r\n  });\r\n  return response.data.comment || {\r\n    id: response.data.id,\r\n    entity_type: entityType as Comment['entity_type'],\r\n    entity_id: entityId,\r\n    content,\r\n    author: 'You',\r\n    created_at: new Date().toISOString(),\r\n    is_edited: false,\r\n  };\r\n}\r\n\r\n/**\r\n * Update a comment\r\n */\r\nexport async function updateComment(commentId: string, content: string): Promise<void> {\r\n  await http.put(`/api/comments/${commentId}`, { content });\r\n}\r\n\r\n/**\r\n * Delete a comment\r\n */\r\nexport async function deleteComment(commentId: string): Promise<void> {\r\n  await http.delete(`/api/comments/${commentId}`);\r\n}\r\n\r\n/**\r\n * Add reaction to comment\r\n */\r\nexport async function addReaction(commentId: string, emoji: string): Promise<void> {\r\n  await http.post(`/api/comments/${commentId}/react`, { emoji });\r\n}\r\n\r\n/**\r\n * Remove reaction from comment\r\n */\r\nexport async function removeReaction(commentId: string, emoji: string): Promise<void> {\r\n  await http.delete(`/api/comments/${commentId}/react/${emoji}`);\r\n}\r\n\r\n/**\r\n * Create comment (alias for addComment)\r\n */\r\nexport async function createComment(entityType: string, entityId: string, content: string, parentId?: string): Promise<Comment> {\r\n  return addComment(entityType, entityId, content, parentId);\r\n}\r\n\r\n/**\r\n * Resolve a comment thread\r\n */\r\nexport async function resolveComment(commentId: string): Promise<void> {\r\n  await http.put(`/api/comments/${commentId}/resolve`);\r\n}\r\n\r\n/**\r\n * Get project members\r\n */\r\nexport async function getProjectMembers(projectId?: string): Promise<ProjectMember[]> {\r\n  try {\r\n    const url = projectId ? `/api/projects/${projectId}/members` : '/api/project/members';\r\n    const response = await http.get<{ members: ProjectMember[] }>(url);\r\n    return response.data.members || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Invite member to project\r\n */\r\nexport async function inviteMember(email: string, role: 'admin' | 'editor' | 'viewer', projectId?: string): Promise<{ success: boolean; inviteId: string }> {\r\n  const url = projectId ? `/api/projects/${projectId}/members` : '/api/project/members';\r\n  const response = await http.post<{ success: boolean; inviteId: string }>(url, { email, role });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Update member role\r\n */\r\nexport async function updateMemberRole(memberId: string, role: 'admin' | 'editor' | 'viewer', projectId?: string): Promise<void> {\r\n  const url = projectId ? `/api/projects/${projectId}/members/${memberId}` : `/api/project/members/${memberId}`;\r\n  await http.put(url, { role });\r\n}\r\n\r\n/**\r\n * Remove member from project\r\n */\r\nexport async function removeMember(memberId: string, projectId?: string): Promise<void> {\r\n  const url = projectId ? `/api/projects/${projectId}/members/${memberId}` : `/api/project/members/${memberId}`;\r\n  await http.delete(url);\r\n}\r\n\r\nexport const notificationsService = {\r\n  getAll: getNotifications,\r\n  getUnreadCount,\r\n  markAsRead,\r\n  markRead: markAsRead, // Alias\r\n  markAllAsRead,\r\n  markAllRead: markAllAsRead, // Alias\r\n  delete: deleteNotification,\r\n};\r\n\r\nexport const commentsService = {\r\n  getAll: getComments,\r\n  add: addComment,\r\n  create: createComment,\r\n  update: updateComment,\r\n  delete: deleteComment,\r\n  addReaction,\r\n  removeReaction,\r\n  resolve: resolveComment,\r\n};\r\n\r\nexport interface PendingInvite {\r\n  id: string;\r\n  email: string;\r\n  role: 'admin' | 'editor' | 'viewer';\r\n  invited_at: string;\r\n  created_at?: string;\r\n  invited_by?: string;\r\n  status: 'pending' | 'accepted' | 'expired';\r\n}\r\n\r\n/**\r\n * Get pending invites for a project\r\n */\r\nexport async function getInvites(projectId?: string): Promise<PendingInvite[]> {\r\n  try {\r\n    const url = projectId ? `/api/projects/${projectId}/invites` : '/api/project/invites';\r\n    const response = await http.get<{ invites: PendingInvite[] }>(url);\r\n    return response.data.invites || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport const membersService = {\r\n  getAll: getProjectMembers,\r\n  invite: inviteMember,\r\n  updateRole: updateMemberRole,\r\n  remove: removeMember,\r\n  getInvites,\r\n};\r\n","/**\r\n * Settings Service\r\n * Handles user settings, API keys, webhooks, and audit logs\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface UserSettings {\r\n  theme?: 'light' | 'dark' | 'system';\r\n  language?: string;\r\n  timezone?: string;\r\n  notifications?: {\r\n    email: boolean;\r\n    browser: boolean;\r\n    mentions: boolean;\r\n    updates: boolean;\r\n  };\r\n  display?: {\r\n    density: 'compact' | 'comfortable' | 'spacious';\r\n    sidebarCollapsed: boolean;\r\n  };\r\n  ai?: {\r\n    model?: string;\r\n    temperature?: number;\r\n    autoSuggest: boolean;\r\n  };\r\n}\r\n\r\nexport interface ProjectSettings {\r\n  name: string;\r\n  description?: string;\r\n  userRole?: string;\r\n  userRolePrompt?: string;\r\n  llm?: {\r\n    provider: string;\r\n    model: string;\r\n  };\r\n  processing?: {\r\n    autoExtractFacts: boolean;\r\n    autoCreateQuestions: boolean;\r\n    deduplication: boolean;\r\n  };\r\n  notifications?: {\r\n    dailyBriefing: boolean;\r\n    overdueAlerts: boolean;\r\n  };\r\n}\r\n\r\nexport interface APIKey {\r\n  id: string;\r\n  name: string;\r\n  key_prefix: string;\r\n  permissions: string[];\r\n  last_used?: string;\r\n  expires_at?: string;\r\n  created_at: string;\r\n  is_active: boolean;\r\n}\r\n\r\nexport interface Webhook {\r\n  id: string;\r\n  name: string;\r\n  url: string;\r\n  events: string[];\r\n  secret?: string;\r\n  is_active: boolean;\r\n  last_triggered?: string;\r\n  failure_count: number;\r\n  created_at: string;\r\n}\r\n\r\nexport interface AuditLogEntry {\r\n  id: string;\r\n  action: string;\r\n  entity_type: string;\r\n  entity_id: string;\r\n  user_id?: string;\r\n  user_email?: string;\r\n  changes?: Record<string, { old: unknown; new: unknown }>;\r\n  metadata?: Record<string, unknown>;\r\n  ip_address?: string;\r\n  user_agent?: string;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Get user settings\r\n */\r\nexport async function getUserSettings(): Promise<UserSettings> {\r\n  try {\r\n    const response = await http.get<UserSettings>('/api/settings');\r\n    return response.data;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Update user settings\r\n */\r\nexport async function updateUserSettings(settings: Partial<UserSettings>): Promise<void> {\r\n  await http.put('/api/settings', settings);\r\n}\r\n\r\n/**\r\n * Get project settings\r\n */\r\nexport async function getProjectSettings(projectId?: string): Promise<ProjectSettings | null> {\r\n  try {\r\n    const url = projectId ? `/api/projects/${projectId}/settings` : '/api/project/settings';\r\n    const response = await http.get<{ settings: ProjectSettings }>(url);\r\n    return response.data.settings;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Update project settings\r\n */\r\nexport async function updateProjectSettings(settings: Partial<ProjectSettings>, projectId?: string): Promise<void> {\r\n  const url = projectId ? `/api/projects/${projectId}/settings` : '/api/project/settings';\r\n  await http.put(url, settings);\r\n}\r\n\r\n/**\r\n * Get API keys\r\n */\r\nexport async function getAPIKeys(): Promise<APIKey[]> {\r\n  try {\r\n    const response = await http.get<{ keys: APIKey[] }>('/api/api-keys');\r\n    return response.data.keys || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Create API key\r\n */\r\nexport async function createAPIKey(name: string, permissions: string[]): Promise<{ key: string; id: string }> {\r\n  const response = await http.post<{ key: string; id: string }>('/api/api-keys', { name, permissions });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Revoke API key\r\n */\r\nexport async function revokeAPIKey(id: string): Promise<void> {\r\n  await http.delete(`/api/api-keys/${id}`);\r\n}\r\n\r\n/**\r\n * Get webhooks\r\n */\r\nexport async function getWebhooks(): Promise<Webhook[]> {\r\n  try {\r\n    const response = await http.get<{ webhooks: Webhook[] }>('/api/webhooks');\r\n    return response.data.webhooks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Create webhook\r\n */\r\nexport async function createWebhook(webhook: {\r\n  name: string;\r\n  url: string;\r\n  events: string[];\r\n  secret?: string;\r\n}): Promise<Webhook> {\r\n  const response = await http.post<{ webhook: Webhook; id: string }>('/api/webhooks', webhook);\r\n  return response.data.webhook || { ...webhook, id: response.data.id, is_active: true, failure_count: 0, created_at: new Date().toISOString() };\r\n}\r\n\r\n/**\r\n * Update webhook\r\n */\r\nexport async function updateWebhook(id: string, updates: Partial<Webhook>): Promise<void> {\r\n  await http.put(`/api/webhooks/${id}`, updates);\r\n}\r\n\r\n/**\r\n * Delete webhook\r\n */\r\nexport async function deleteWebhook(id: string): Promise<void> {\r\n  await http.delete(`/api/webhooks/${id}`);\r\n}\r\n\r\n/**\r\n * Test webhook\r\n */\r\nexport async function testWebhook(id: string): Promise<{ success: boolean; status: number; response?: string }> {\r\n  const response = await http.post<{ success: boolean; status: number; response?: string }>(`/api/webhooks/${id}/test`);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get audit logs\r\n */\r\nexport async function getAuditLogs(options?: {\r\n  action?: string;\r\n  entity_type?: string;\r\n  user_id?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  limit?: number;\r\n  offset?: number;\r\n}): Promise<{ logs: AuditLogEntry[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.action) params.set('action', options.action);\r\n    if (options?.entity_type) params.set('entity_type', options.entity_type);\r\n    if (options?.user_id) params.set('user_id', options.user_id);\r\n    if (options?.startDate) params.set('startDate', options.startDate);\r\n    if (options?.endDate) params.set('endDate', options.endDate);\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.offset) params.set('offset', String(options.offset));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/audit?${query}` : '/api/audit';\r\n\r\n    const response = await http.get<{ logs: AuditLogEntry[]; total: number }>(url);\r\n    return response.data;\r\n  } catch {\r\n    return { logs: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Export audit logs\r\n */\r\nexport async function exportAuditLogs(format: 'json' | 'csv', options?: {\r\n  startDate?: string;\r\n  endDate?: string;\r\n}): Promise<Blob> {\r\n  const params = new URLSearchParams();\r\n  params.set('format', format);\r\n  if (options?.startDate) params.set('startDate', options.startDate);\r\n  if (options?.endDate) params.set('endDate', options.endDate);\r\n\r\n  const response = await fetch(`/api/audit/export?${params.toString()}`);\r\n  if (!response.ok) throw new Error('Export failed');\r\n  return response.blob();\r\n}\r\n\r\nexport const userSettingsService = {\r\n  get: getUserSettings,\r\n  update: updateUserSettings,\r\n};\r\n\r\nexport const projectSettingsService = {\r\n  get: getProjectSettings,\r\n  update: updateProjectSettings,\r\n};\r\n\r\nexport const apiKeysService = {\r\n  getAll: getAPIKeys,\r\n  create: createAPIKey,\r\n  revoke: revokeAPIKey,\r\n};\r\n\r\nexport const webhooksService = {\r\n  getAll: getWebhooks,\r\n  create: createWebhook,\r\n  update: updateWebhook,\r\n  delete: deleteWebhook,\r\n  test: testWebhook,\r\n};\r\n\r\nexport const auditService = {\r\n  getAll: getAuditLogs,\r\n  export: exportAuditLogs,\r\n};\r\n","/**\r\n * Profile Service\r\n * Handles user profile management\r\n */\r\n\r\nimport { http } from './api';\r\nimport { appStore, User } from '../stores/app';\r\n\r\nexport interface UserProfile {\r\n  id: string;\r\n  email: string;\r\n  username?: string;\r\n  display_name?: string;\r\n  avatar_url?: string;\r\n  timezone?: string;\r\n  locale?: string;\r\n  bio?: string;\r\n  role?: 'user' | 'admin' | 'superadmin';\r\n  preferences?: Record<string, unknown>;\r\n  created_at: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface UpdateProfileRequest {\r\n  username?: string;\r\n  display_name?: string;\r\n  avatar_url?: string;\r\n  timezone?: string;\r\n  locale?: string;\r\n  bio?: string;\r\n  preferences?: Record<string, unknown>;\r\n}\r\n\r\nexport interface ChangePasswordRequest {\r\n  current_password: string;\r\n  new_password: string;\r\n}\r\n\r\n/**\r\n * Get current user profile\r\n */\r\nexport async function getProfile(): Promise<UserProfile | null> {\r\n  try {\r\n    const response = await http.get<{ profile: UserProfile }>('/api/profile');\r\n    return response.data.profile;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Update user profile\r\n */\r\nexport async function updateProfile(data: UpdateProfileRequest): Promise<UserProfile> {\r\n  const response = await http.put<{ profile: UserProfile }>('/api/profile', data);\r\n  \r\n  // Update app store with new user info\r\n  const currentUser = appStore.getState().currentUser;\r\n  if (currentUser) {\r\n    appStore.setCurrentUser({\r\n      ...currentUser,\r\n      name: data.display_name || currentUser.name,\r\n      avatar: data.avatar_url || currentUser.avatar,\r\n    });\r\n  }\r\n  \r\n  return response.data.profile;\r\n}\r\n\r\n/**\r\n * Upload avatar\r\n */\r\nexport async function uploadAvatar(file: File): Promise<string> {\r\n  const formData = new FormData();\r\n  formData.append('avatar', file);\r\n\r\n  const response = await fetch('/api/profile/avatar', {\r\n    method: 'POST',\r\n    body: formData,\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Avatar upload failed');\r\n  }\r\n\r\n  const data = await response.json();\r\n  \r\n  // Update app store\r\n  const currentUser = appStore.getState().currentUser;\r\n  if (currentUser) {\r\n    appStore.setCurrentUser({\r\n      ...currentUser,\r\n      avatar: data.avatar_url,\r\n    });\r\n  }\r\n  \r\n  return data.avatar_url;\r\n}\r\n\r\n/**\r\n * Remove avatar\r\n */\r\nexport async function removeAvatar(): Promise<void> {\r\n  await http.delete('/api/profile/avatar');\r\n  \r\n  // Update app store\r\n  const currentUser = appStore.getState().currentUser;\r\n  if (currentUser) {\r\n    appStore.setCurrentUser({\r\n      ...currentUser,\r\n      avatar: undefined,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Change password\r\n */\r\nexport async function changePassword(data: ChangePasswordRequest): Promise<void> {\r\n  if (data.new_password.length < 12) {\r\n    throw new Error('New password must be at least 12 characters');\r\n  }\r\n\r\n  await http.post('/api/profile/change-password', data);\r\n}\r\n\r\n/**\r\n * Delete account\r\n */\r\nexport async function deleteAccount(password: string): Promise<void> {\r\n  await http.post('/api/profile/delete', { password });\r\n  appStore.setCurrentUser(null);\r\n  appStore.setCurrentProject(null);\r\n}\r\n\r\n/**\r\n * Get user activity\r\n */\r\nexport async function getActivity(limit = 50): Promise<Array<{\r\n  type: string;\r\n  action: string;\r\n  entity_type: string;\r\n  entity_id: string;\r\n  timestamp: string;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{ activities: Array<{\r\n      type: string;\r\n      action: string;\r\n      entity_type: string;\r\n      entity_id: string;\r\n      timestamp: string;\r\n    }> }>(`/api/profile/activity?limit=${limit}`);\r\n    return response.data.activities || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get user sessions\r\n */\r\nexport async function getSessions(): Promise<Array<{\r\n  id: string;\r\n  device: string;\r\n  location?: string;\r\n  ip_address: string;\r\n  last_active: string;\r\n  is_current: boolean;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{ sessions: Array<{\r\n      id: string;\r\n      device: string;\r\n      location?: string;\r\n      ip_address: string;\r\n      last_active: string;\r\n      is_current: boolean;\r\n    }> }>('/api/profile/sessions');\r\n    return response.data.sessions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Revoke a session\r\n */\r\nexport async function revokeSession(sessionId: string): Promise<void> {\r\n  await http.delete(`/api/profile/sessions/${sessionId}`);\r\n}\r\n\r\n/**\r\n * Revoke all other sessions\r\n */\r\nexport async function revokeAllSessions(): Promise<void> {\r\n  await http.post('/api/profile/sessions/revoke-all');\r\n}\r\n\r\nexport const profileService = {\r\n  get: getProfile,\r\n  update: updateProfile,\r\n  uploadAvatar,\r\n  removeAvatar,\r\n  changePassword,\r\n  deleteAccount,\r\n  getActivity,\r\n  getSessions,\r\n  revokeSession,\r\n  revokeAllSessions,\r\n};\r\n","/**\r\n * Facts Service\r\n * Handles facts CRUD and conflict detection\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Fact {\r\n  id: string | number;\r\n  content: string;\r\n  source?: string;\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  category?: string;\r\n  confidence?: number;\r\n  verified?: boolean;\r\n  verified_by?: string;\r\n  verified_at?: string;\r\n  created_at: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface CreateFactRequest {\r\n  content: string;\r\n  source?: string;\r\n  category?: string;\r\n  verified?: boolean;\r\n}\r\n\r\nexport interface UpdateFactRequest {\r\n  content?: string;\r\n  source?: string;\r\n  category?: string;\r\n  verified?: boolean;\r\n}\r\n\r\nexport interface FactConflict {\r\n  factId1: string | number;\r\n  factId2: string | number;\r\n  fact1: Fact;\r\n  fact2: Fact;\r\n  conflictType: 'contradiction' | 'inconsistency' | 'outdated' | 'process';\r\n  description?: string;\r\n  reason?: string;\r\n  confidence?: number;\r\n}\r\n\r\n/**\r\n * Get all facts\r\n */\r\nexport async function getFacts(options?: {\r\n  limit?: number;\r\n  offset?: number;\r\n  search?: string;\r\n  category?: string;\r\n  verified?: boolean;\r\n}): Promise<{ facts: Fact[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.offset) params.set('offset', String(options.offset));\r\n    if (options?.search) params.set('search', options.search);\r\n    if (options?.category) params.set('category', options.category);\r\n    if (options?.verified !== undefined) params.set('verified', String(options.verified));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/facts?${query}` : '/api/facts';\r\n\r\n    const response = await http.get<{ facts: Fact[]; total?: number }>(url);\r\n    return {\r\n      facts: response.data.facts || [],\r\n      total: response.data.total || response.data.facts?.length || 0,\r\n    };\r\n  } catch {\r\n    return { facts: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single fact\r\n */\r\nexport async function getFact(id: string | number): Promise<Fact | null> {\r\n  try {\r\n    const response = await http.get<{ fact: Fact }>(`/api/facts/${id}`);\r\n    return response.data.fact;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new fact\r\n */\r\nexport async function createFact(data: CreateFactRequest): Promise<Fact> {\r\n  const response = await http.post<{ fact: Fact; id: string | number }>('/api/facts', data);\r\n  return response.data.fact || {\r\n    ...data,\r\n    id: response.data.id,\r\n    created_at: new Date().toISOString(),\r\n  } as Fact;\r\n}\r\n\r\n/**\r\n * Update a fact\r\n */\r\nexport async function updateFact(id: string | number, data: UpdateFactRequest): Promise<Fact> {\r\n  const response = await http.put<{ fact: Fact }>(`/api/facts/${id}`, data);\r\n  return response.data.fact;\r\n}\r\n\r\n/**\r\n * Delete a fact (soft delete; syncs removal to graph/FalkorDB)\r\n */\r\nexport async function deleteFact(id: string | number): Promise<void> {\r\n  await http.delete(`/api/facts/${id}`);\r\n}\r\n\r\n/**\r\n * List soft-deleted facts (for restore / undo)\r\n */\r\nexport async function getDeletedFacts(): Promise<Fact[]> {\r\n  try {\r\n    const response = await http.get<{ facts: Fact[] }>('/api/facts/deleted');\r\n    return response.data.facts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted fact (undo); syncs back to graph/FalkorDB\r\n */\r\nexport async function restoreFact(id: string | number): Promise<Fact> {\r\n  const response = await http.post<{ fact: Fact }>(`/api/facts/${id}/restore`, {});\r\n  return response.data.fact;\r\n}\r\n\r\n/**\r\n * Verify a fact\r\n */\r\nexport async function verifyFact(id: string | number): Promise<Fact> {\r\n  return updateFact(id, { verified: true });\r\n}\r\n\r\n/**\r\n * Run full fact-check (AI analysis, records conflict_detected events)\r\n */\r\nexport async function runFactCheck(): Promise<{ ok: boolean; conflicts: FactConflict[]; analyzed_facts: number; events_recorded: number }> {\r\n  const response = await http.post<{ ok: boolean; conflicts: FactConflict[]; analyzed_facts: number; events_recorded: number }>('/api/fact-check/run', {});\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Detect conflicts between facts\r\n */\r\nexport async function detectConflicts(): Promise<FactConflict[]> {\r\n  try {\r\n    const response = await http.get<{ conflicts: FactConflict[] }>('/api/conflicts');\r\n    return response.data.conflicts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get facts by category\r\n */\r\nexport async function getFactsByCategory(): Promise<Record<string, Fact[]>> {\r\n  try {\r\n    const { facts } = await getFacts({ limit: 1000 });\r\n    const grouped: Record<string, Fact[]> = {};\r\n    \r\n    facts.forEach(fact => {\r\n      const category = fact.category || 'Uncategorized';\r\n      if (!grouped[category]) grouped[category] = [];\r\n      grouped[category].push(fact);\r\n    });\r\n    \r\n    return grouped;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Get facts grouped by source (source_file or source)\r\n */\r\nexport async function getFactsBySource(): Promise<Record<string, Fact[]>> {\r\n  try {\r\n    const { facts } = await getFacts({ limit: 1000 });\r\n    const grouped: Record<string, Fact[]> = {};\r\n    \r\n    facts.forEach(fact => {\r\n      const source = fact.source_file || fact.source || 'Unknown source';\r\n      if (!grouped[source]) grouped[source] = [];\r\n      grouped[source].push(fact);\r\n    });\r\n    \r\n    return grouped;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Get facts by source document id\r\n */\r\nexport async function getFactsByDocument(documentId: string): Promise<Fact[]> {\r\n  try {\r\n    const params = new URLSearchParams({ document_id: documentId });\r\n    const response = await http.get<{ facts: Fact[] }>(`/api/facts?${params}`);\r\n    return response.data.facts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface FactEvent {\r\n  id: string;\r\n  fact_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_user_id?: string;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\n/**\r\n * Get fact events (timeline) for a fact\r\n */\r\nexport async function getFactEvents(factId: string | number): Promise<FactEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: FactEvent[] }>(`/api/facts/${factId}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface SimilarFactItem {\r\n  fact: Fact;\r\n  similarityScore: number;\r\n}\r\n\r\n/**\r\n * Get similar facts (from fact_similarities cache or computed)\r\n */\r\nexport async function getSimilarFacts(factId: string | number, limit = 10): Promise<SimilarFactItem[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (limit !== 10) params.set('limit', String(limit));\r\n    const query = params.toString();\r\n    const url = query ? `/api/facts/${factId}/similar?${query}` : `/api/facts/${factId}/similar`;\r\n    const response = await http.get<{ similar: SimilarFactItem[] }>(url);\r\n    return response.data.similar || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Search facts\r\n */\r\nexport async function searchFacts(query: string, limit = 20): Promise<Fact[]> {\r\n  const { facts } = await getFacts({ search: query, limit });\r\n  return facts;\r\n}\r\n\r\n/**\r\n * Get fact statistics\r\n */\r\nexport function getFactStats(facts: Fact[]): {\r\n  total: number;\r\n  verified: number;\r\n  unverified: number;\r\n  byCategory: Record<string, number>;\r\n} {\r\n  const stats = {\r\n    total: facts.length,\r\n    verified: facts.filter(f => f.verified).length,\r\n    unverified: facts.filter(f => !f.verified).length,\r\n    byCategory: {} as Record<string, number>,\r\n  };\r\n\r\n  facts.forEach(fact => {\r\n    const category = fact.category || 'Uncategorized';\r\n    stats.byCategory[category] = (stats.byCategory[category] || 0) + 1;\r\n  });\r\n\r\n  return stats;\r\n}\r\n\r\nexport const factsService = {\r\n  getAll: getFacts,\r\n  get: getFact,\r\n  create: createFact,\r\n  update: updateFact,\r\n  delete: deleteFact,\r\n  deleteFact, // Alias for backwards compatibility\r\n  verify: verifyFact,\r\n  verifyFact, // Alias for backwards compatibility\r\n  detectConflicts,\r\n  getByCategory: getFactsByCategory,\r\n  getBySource: getFactsBySource,\r\n  getByDocument: getFactsByDocument,\r\n  getEvents: getFactEvents,\r\n  getSimilarFacts,\r\n  search: searchFacts,\r\n  getStats: getFactStats,\r\n  getDeletedFacts,\r\n  restoreFact,\r\n  runFactCheck,\r\n};\r\n","/**\r\n * DOM Utilities\r\n * Helper functions for DOM manipulation\r\n */\r\n\r\n/**\r\n * Query selector with type safety\r\n */\r\nexport function $(selector: string, parent: ParentNode = document): HTMLElement | null {\r\n  return parent.querySelector(selector);\r\n}\r\n\r\n/**\r\n * Query selector all with type safety\r\n */\r\nexport function $$(selector: string, parent: ParentNode = document): HTMLElement[] {\r\n  return Array.from(parent.querySelectorAll(selector));\r\n}\r\n\r\n/**\r\n * Get element by ID with type safety\r\n */\r\nexport function $id<T extends HTMLElement = HTMLElement>(id: string): T | null {\r\n  return document.getElementById(id) as T | null;\r\n}\r\n\r\n/**\r\n * Create element with attributes\r\n */\r\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\r\n  tag: K,\r\n  attributes?: Partial<HTMLElementTagNameMap[K]>,\r\n  children?: (Node | string)[]\r\n): HTMLElementTagNameMap[K] {\r\n  const el = document.createElement(tag);\r\n  \r\n  if (attributes) {\r\n    Object.entries(attributes).forEach(([key, value]) => {\r\n      if (key === 'className') {\r\n        el.className = value as string;\r\n      } else if (key === 'style' && typeof value === 'object') {\r\n        Object.assign(el.style, value);\r\n      } else if (key.startsWith('data')) {\r\n        el.setAttribute(key.replace(/([A-Z])/g, '-$1').toLowerCase(), String(value));\r\n      } else {\r\n        (el as Record<string, unknown>)[key] = value;\r\n      }\r\n    });\r\n  }\r\n  \r\n  if (children) {\r\n    children.forEach(child => {\r\n      if (typeof child === 'string') {\r\n        el.appendChild(document.createTextNode(child));\r\n      } else {\r\n        el.appendChild(child);\r\n      }\r\n    });\r\n  }\r\n  \r\n  return el;\r\n}\r\n\r\n/**\r\n * Add event listener with cleanup\r\n */\r\nexport function on<K extends keyof HTMLElementEventMap>(\r\n  element: HTMLElement | Window | Document,\r\n  event: K,\r\n  handler: (e: HTMLElementEventMap[K]) => void,\r\n  options?: AddEventListenerOptions\r\n): () => void {\r\n  element.addEventListener(event, handler as EventListener, options);\r\n  return () => element.removeEventListener(event, handler as EventListener, options);\r\n}\r\n\r\n/**\r\n * Toggle class on element\r\n */\r\nexport function toggleClass(element: HTMLElement, className: string, force?: boolean): boolean {\r\n  return element.classList.toggle(className, force);\r\n}\r\n\r\n/**\r\n * Add multiple classes\r\n */\r\nexport function addClass(element: HTMLElement, ...classes: string[]): void {\r\n  element.classList.add(...classes);\r\n}\r\n\r\n/**\r\n * Remove multiple classes\r\n */\r\nexport function removeClass(element: HTMLElement, ...classes: string[]): void {\r\n  element.classList.remove(...classes);\r\n}\r\n\r\n/**\r\n * Check if element has class\r\n */\r\nexport function hasClass(element: HTMLElement, className: string): boolean {\r\n  return element.classList.contains(className);\r\n}\r\n\r\n/**\r\n * Set multiple attributes\r\n */\r\nexport function setAttributes(element: HTMLElement, attrs: Record<string, string>): void {\r\n  Object.entries(attrs).forEach(([key, value]) => {\r\n    element.setAttribute(key, value);\r\n  });\r\n}\r\n\r\n/**\r\n * Remove element from DOM\r\n */\r\nexport function remove(element: HTMLElement): void {\r\n  element.remove();\r\n}\r\n\r\n/**\r\n * Empty element contents\r\n */\r\nexport function empty(element: HTMLElement): void {\r\n  element.innerHTML = '';\r\n}\r\n\r\n/**\r\n * Set inner HTML safely\r\n */\r\nexport function setHTML(element: HTMLElement, html: string): void {\r\n  element.innerHTML = html;\r\n}\r\n\r\n/**\r\n * Show element\r\n */\r\nexport function show(element: HTMLElement, display = 'block'): void {\r\n  element.style.display = display;\r\n}\r\n\r\n/**\r\n * Hide element\r\n */\r\nexport function hide(element: HTMLElement): void {\r\n  element.style.display = 'none';\r\n}\r\n\r\n/**\r\n * Toggle element visibility\r\n */\r\nexport function toggle(element: HTMLElement, visible?: boolean, display = 'block'): void {\r\n  if (visible === undefined) {\r\n    visible = element.style.display === 'none';\r\n  }\r\n  element.style.display = visible ? display : 'none';\r\n}\r\n\r\n/**\r\n * Scroll element into view\r\n */\r\nexport function scrollIntoView(element: HTMLElement, options?: ScrollIntoViewOptions): void {\r\n  element.scrollIntoView({\r\n    behavior: 'smooth',\r\n    block: 'center',\r\n    ...options,\r\n  });\r\n}\r\n\r\n/**\r\n * Focus element with optional scroll\r\n */\r\nexport function focus(element: HTMLElement, preventScroll = false): void {\r\n  element.focus({ preventScroll });\r\n}\r\n\r\n/**\r\n * Wait for element to appear in DOM\r\n */\r\nexport function waitForElement(selector: string, timeout = 5000): Promise<HTMLElement> {\r\n  return new Promise((resolve, reject) => {\r\n    const element = $(selector);\r\n    if (element) {\r\n      resolve(element);\r\n      return;\r\n    }\r\n\r\n    const observer = new MutationObserver(() => {\r\n      const element = $(selector);\r\n      if (element) {\r\n        observer.disconnect();\r\n        resolve(element);\r\n      }\r\n    });\r\n\r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n\r\n    setTimeout(() => {\r\n      observer.disconnect();\r\n      reject(new Error(`Element ${selector} not found within ${timeout}ms`));\r\n    }, timeout);\r\n  });\r\n}\r\n","/**\r\n * Theme Toggle Component\r\n * Button to cycle through theme modes (light/dark/system)\r\n */\r\n\r\nimport { theme } from '../services/theme';\r\nimport { toast } from '../services/toast';\r\nimport { createElement, on } from '../utils/dom';\r\n\r\n/**\r\n * Create theme toggle button element\r\n */\r\nexport function createThemeToggle(container?: HTMLElement): HTMLButtonElement {\r\n  const button = createElement('button', {\r\n    className: 'btn btn-ghost theme-toggle',\r\n    title: `Theme: ${theme.getLabel()} (Ctrl+Shift+T)`,\r\n  });\r\n\r\n  // Update button content\r\n  function updateButton(): void {\r\n    button.innerHTML = getThemeIcon();\r\n    button.title = `Theme: ${theme.getLabel()} (Ctrl+Shift+T)`;\r\n    button.setAttribute('data-theme-mode', theme.getMode());\r\n  }\r\n\r\n  // Get icon for current theme\r\n  function getThemeIcon(): string {\r\n    const mode = theme.getMode();\r\n    switch (mode) {\r\n      case 'light':\r\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"5\"/>\r\n          <path d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"/>\r\n        </svg>`;\r\n      case 'dark':\r\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"/>\r\n        </svg>`;\r\n      case 'system':\r\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/>\r\n          <line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\"/>\r\n          <line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\"/>\r\n        </svg>`;\r\n    }\r\n  }\r\n\r\n  // Handle click\r\n  on(button, 'click', () => {\r\n    theme.cycle();\r\n    updateButton();\r\n    toast.info(`Theme: ${theme.getLabel()}`);\r\n  });\r\n\r\n  // Subscribe to theme changes\r\n  theme.onChange(() => {\r\n    updateButton();\r\n  });\r\n\r\n  // Initial update\r\n  updateButton();\r\n\r\n  // Append to container if provided\r\n  if (container) {\r\n    container.appendChild(button);\r\n  }\r\n\r\n  return button;\r\n}\r\n\r\n/**\r\n * Mount theme toggle to existing element by selector\r\n */\r\nexport function mountThemeToggle(selector: string): HTMLButtonElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`ThemeToggle: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n  return createThemeToggle(container as HTMLElement);\r\n}\r\n\r\nexport default createThemeToggle;\r\n","/**\r\n * UI Store\r\n * User interface state\r\n */\r\n\r\n// Types\r\nexport type MainTab = 'dashboard' | 'chat' | 'sot' | 'timeline' | 'org' | 'files' | 'emails' | 'contacts' | 'team-analysis' | 'roles' | 'graph' | 'costs' | 'history' | 'admin';\r\nexport type SotView = 'questions' | 'facts' | 'risks' | 'actions' | 'decisions';\r\nexport type DevTab = 'info' | 'logs' | 'settings';\r\n\r\nexport interface SelectedPerson {\r\n  id: string;\r\n  name: string;\r\n  type: 'contact' | 'member';\r\n}\r\n\r\nexport interface UIState {\r\n  currentTab: MainTab;\r\n  currentDevTab: DevTab;\r\n  sotCurrentView: SotView;\r\n  selectedPerson: SelectedPerson | null;\r\n  sidebarOpen: boolean;\r\n  modalOpen: string | null;\r\n  searchQuery: string;\r\n  filterActive: boolean;\r\n}\r\n\r\n// Initial state\r\nconst initialState: UIState = {\r\n  currentTab: 'dashboard',\r\n  currentDevTab: 'info',\r\n  sotCurrentView: 'questions',\r\n  selectedPerson: null,\r\n  sidebarOpen: true,\r\n  modalOpen: null,\r\n  searchQuery: '',\r\n  filterActive: false,\r\n};\r\n\r\n// State\r\nlet state: UIState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: UIState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): UIState {\r\n  return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: UIState) => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set main tab\r\n */\r\nexport function setTab(tab: MainTab): void {\r\n  state = { ...state, currentTab: tab };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set developer tab\r\n */\r\nexport function setDevTab(tab: DevTab): void {\r\n  state = { ...state, currentDevTab: tab };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set Source of Truth view\r\n */\r\nexport function setSotView(view: SotView): void {\r\n  state = { ...state, sotCurrentView: view };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set selected person\r\n */\r\nexport function setSelectedPerson(person: SelectedPerson | null): void {\r\n  state = { ...state, selectedPerson: person };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Toggle sidebar\r\n */\r\nexport function toggleSidebar(): void {\r\n  state = { ...state, sidebarOpen: !state.sidebarOpen };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set sidebar open state\r\n */\r\nexport function setSidebarOpen(open: boolean): void {\r\n  state = { ...state, sidebarOpen: open };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Open modal\r\n */\r\nexport function openModal(modalId: string): void {\r\n  state = { ...state, modalOpen: modalId };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Close modal\r\n */\r\nexport function closeModal(): void {\r\n  state = { ...state, modalOpen: null };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set search query\r\n */\r\nexport function setSearchQuery(query: string): void {\r\n  state = { ...state, searchQuery: query };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Toggle filter\r\n */\r\nexport function toggleFilter(): void {\r\n  state = { ...state, filterActive: !state.filterActive };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n  state = { ...initialState };\r\n  notify();\r\n}\r\n\r\n// Export as namespace\r\nexport const uiStore = {\r\n  getState,\r\n  subscribe,\r\n  setTab,\r\n  setDevTab,\r\n  setSotView,\r\n  setSelectedPerson,\r\n  toggleSidebar,\r\n  setSidebarOpen,\r\n  openModal,\r\n  closeModal,\r\n  setSearchQuery,\r\n  toggleFilter,\r\n  reset,\r\n};\r\n","/**\r\n * Header Component\r\n * Main application header with project selector and user menu\r\n */\r\n\r\nimport { createElement, on, $, show, hide } from '../utils/dom';\r\nimport { appStore } from '../stores/app';\r\nimport { uiStore } from '../stores/ui';\r\nimport { theme } from '../services/theme';\r\nimport { createThemeToggle } from './ThemeToggle';\r\n\r\nexport interface HeaderProps {\r\n  onProjectChange?: (projectId: string) => void;\r\n  onLogout?: () => void;\r\n  onSettings?: () => void;\r\n}\r\n\r\n/**\r\n * Create header element\r\n */\r\nexport function createHeader(props: HeaderProps = {}): HTMLElement {\r\n  const header = createElement('header', { className: 'app-header' });\r\n\r\n  // Logo and title\r\n  const logoSection = createElement('div', { className: 'header-logo' });\r\n  logoSection.innerHTML = `\r\n    <span class=\"logo-icon\"></span>\r\n    <h1>GodMode</h1>\r\n  `;\r\n\r\n  // Actions section\r\n  const actionsSection = createElement('div', { className: 'header-actions' });\r\n\r\n  // Project selector\r\n  const projectSelector = createProjectSelector(props.onProjectChange);\r\n  actionsSection.appendChild(projectSelector);\r\n\r\n  // Theme toggle\r\n  const themeToggle = createThemeToggle();\r\n  actionsSection.appendChild(themeToggle);\r\n\r\n  // User menu\r\n  const userMenu = createUserMenu(props);\r\n  actionsSection.appendChild(userMenu);\r\n\r\n  // Mobile menu button\r\n  const mobileMenuBtn = createElement('button', {\r\n    className: 'mobile-menu-btn',\r\n    innerHTML: '',\r\n  });\r\n  on(mobileMenuBtn, 'click', () => {\r\n    uiStore.toggleSidebar();\r\n  });\r\n\r\n  header.appendChild(mobileMenuBtn);\r\n  header.appendChild(logoSection);\r\n  header.appendChild(actionsSection);\r\n\r\n  return header;\r\n}\r\n\r\n/**\r\n * Create project selector dropdown\r\n */\r\nfunction createProjectSelector(onProjectChange?: (projectId: string) => void): HTMLElement {\r\n  const container = createElement('div', { className: 'project-selector' });\r\n\r\n  const button = createElement('button', {\r\n    className: 'project-btn',\r\n  });\r\n\r\n  const dropdown = createElement('div', { className: 'project-dropdown' });\r\n\r\n  // Update button text\r\n  function updateButton(): void {\r\n    const state = appStore.getState();\r\n    const projectName = state.currentProjectId || 'Select Project';\r\n    button.innerHTML = `\r\n      <span class=\"project-name\">${projectName}</span>\r\n      <span class=\"dropdown-arrow\"></span>\r\n    `;\r\n  }\r\n\r\n  // Toggle dropdown\r\n  let isOpen = false;\r\n  on(button, 'click', (e) => {\r\n    e.stopPropagation();\r\n    isOpen = !isOpen;\r\n    dropdown.classList.toggle('show', isOpen);\r\n  });\r\n\r\n  // Close on outside click\r\n  on(document, 'click', () => {\r\n    isOpen = false;\r\n    dropdown.classList.remove('show');\r\n  });\r\n\r\n  // Subscribe to state changes\r\n  appStore.subscribe(() => {\r\n    updateButton();\r\n  });\r\n\r\n  // Initial update\r\n  updateButton();\r\n\r\n  container.appendChild(button);\r\n  container.appendChild(dropdown);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Create user menu dropdown\r\n */\r\nfunction createUserMenu(props: HeaderProps): HTMLElement {\r\n  const container = createElement('div', { className: 'user-menu' });\r\n\r\n  const button = createElement('button', { className: 'user-menu-btn' });\r\n\r\n  const dropdown = createElement('div', { className: 'user-dropdown' });\r\n\r\n  // Update button\r\n  function updateButton(): void {\r\n    const state = appStore.getState();\r\n    const user = state.currentUser;\r\n    const initials = user?.name\r\n      ? user.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)\r\n      : user?.email?.[0]?.toUpperCase() || '?';\r\n\r\n    button.innerHTML = `\r\n      <div class=\"user-avatar\">${initials}</div>\r\n      <span class=\"user-name\">${user?.name || user?.email || 'Guest'}</span>\r\n    `;\r\n  }\r\n\r\n  // Update dropdown content\r\n  function updateDropdown(): void {\r\n    const state = appStore.getState();\r\n    const user = state.currentUser;\r\n\r\n    dropdown.innerHTML = `\r\n      <div class=\"user-dropdown-header\">\r\n        <strong>${user?.name || 'Guest'}</strong>\r\n        <span class=\"text-muted\">${user?.email || ''}</span>\r\n        ${user?.role ? `<span class=\"role-badge ${user.role}\">${user.role}</span>` : ''}\r\n      </div>\r\n      <div class=\"user-dropdown-items\">\r\n        <button data-action=\"settings\">\r\n          <span></span> Settings\r\n        </button>\r\n        <button data-action=\"shortcuts\">\r\n          <span></span> Shortcuts\r\n        </button>\r\n        <button data-action=\"logout\" class=\"text-error\">\r\n          <span></span> Logout\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n    // Bind action handlers\r\n    const settingsBtn = dropdown.querySelector('[data-action=\"settings\"]');\r\n    const shortcutsBtn = dropdown.querySelector('[data-action=\"shortcuts\"]');\r\n    const logoutBtn = dropdown.querySelector('[data-action=\"logout\"]');\r\n\r\n    if (settingsBtn) {\r\n      on(settingsBtn as HTMLElement, 'click', () => {\r\n        props.onSettings?.();\r\n        closeDropdown();\r\n      });\r\n    }\r\n\r\n    if (shortcutsBtn) {\r\n      on(shortcutsBtn as HTMLElement, 'click', () => {\r\n        // Show shortcuts modal\r\n        uiStore.openModal('shortcuts');\r\n        closeDropdown();\r\n      });\r\n    }\r\n\r\n    if (logoutBtn) {\r\n      on(logoutBtn as HTMLElement, 'click', () => {\r\n        props.onLogout?.();\r\n        closeDropdown();\r\n      });\r\n    }\r\n  }\r\n\r\n  // Toggle dropdown\r\n  let isOpen = false;\r\n  function closeDropdown(): void {\r\n    isOpen = false;\r\n    dropdown.classList.remove('show');\r\n  }\r\n\r\n  on(button, 'click', (e) => {\r\n    e.stopPropagation();\r\n    isOpen = !isOpen;\r\n    dropdown.classList.toggle('show', isOpen);\r\n    if (isOpen) {\r\n      updateDropdown();\r\n    }\r\n  });\r\n\r\n  // Close on outside click\r\n  on(document, 'click', closeDropdown);\r\n\r\n  // Subscribe to state changes\r\n  appStore.subscribe(updateButton);\r\n\r\n  // Initial update\r\n  updateButton();\r\n\r\n  container.appendChild(button);\r\n  container.appendChild(dropdown);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Mount header to existing element\r\n */\r\nexport function mountHeader(selector: string, props: HeaderProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`Header: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const header = createHeader(props);\r\n  container.appendChild(header);\r\n  return header;\r\n}\r\n\r\nexport default createHeader;\r\n","/**\r\n * Sidebar Component\r\n * Navigation sidebar with tabs\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../utils/dom';\r\nimport { uiStore, MainTab } from '../stores/ui';\r\nimport { appStore } from '../stores/app';\r\n\r\nexport interface SidebarTab {\r\n  id: MainTab;\r\n  label: string;\r\n  icon: string;\r\n  badge?: number;\r\n}\r\n\r\nexport interface SidebarProps {\r\n  tabs?: SidebarTab[];\r\n  onTabChange?: (tabId: MainTab) => void;\r\n}\r\n\r\nconst defaultTabs: SidebarTab[] = [\r\n  { id: 'dashboard', label: 'Dashboard', icon: '' },\r\n  { id: 'chat', label: 'Chat', icon: '' },\r\n  { id: 'sot', label: 'Source of Truth', icon: '' },\r\n  { id: 'timeline', label: 'Timeline', icon: '' },\r\n  { id: 'org', label: 'Org Chart', icon: '' },\r\n  { id: 'files', label: 'Files', icon: '' },\r\n  { id: 'emails', label: 'Emails', icon: '' },\r\n  { id: 'contacts', label: 'Contacts', icon: '' },\r\n  { id: 'roles', label: 'Roles', icon: '' },\r\n  { id: 'graph', label: 'Graph DB', icon: '' },\r\n  { id: 'costs', label: 'Costs', icon: '' },\r\n  { id: 'history', label: 'History', icon: '' },\r\n];\r\n\r\n// Admin tab - only shown for superadmin users\r\nconst adminTab: SidebarTab = { id: 'admin', label: 'Admin', icon: '' };\r\n\r\n/**\r\n * Get tabs based on user role\r\n */\r\nfunction getTabsForUser(): SidebarTab[] {\r\n  const state = appStore.getState();\r\n  const isSuperAdmin = state.currentUser?.role === 'superadmin';\r\n  \r\n  if (isSuperAdmin) {\r\n    return [...defaultTabs, adminTab];\r\n  }\r\n  return defaultTabs;\r\n}\r\n\r\n/**\r\n * Create a tab button element\r\n */\r\nfunction createTabButton(tab: SidebarTab, props: SidebarProps): HTMLButtonElement {\r\n  const button = createElement('button', {\r\n    className: 'sidebar-tab',\r\n  }) as HTMLButtonElement;\r\n  button.setAttribute('data-tab', tab.id);\r\n\r\n  button.innerHTML = `\r\n    <span class=\"tab-icon\">${tab.icon}</span>\r\n    <span class=\"tab-label\">${tab.label}</span>\r\n    ${tab.badge ? `<span class=\"tab-badge\">${tab.badge}</span>` : ''}\r\n  `;\r\n\r\n  on(button, 'click', () => {\r\n    uiStore.setTab(tab.id);\r\n    props.onTabChange?.(tab.id);\r\n\r\n    // Close sidebar on mobile after selection\r\n    if (window.innerWidth < 768) {\r\n      uiStore.setSidebarOpen(false);\r\n    }\r\n  });\r\n\r\n  return button;\r\n}\r\n\r\n/**\r\n * Rebuild navigation tabs based on current user\r\n */\r\nfunction rebuildNavigation(nav: HTMLElement, props: SidebarProps): void {\r\n  const tabs = props.tabs || getTabsForUser();\r\n  const currentTab = uiStore.getState().currentTab;\r\n  \r\n  // Clear existing tabs\r\n  nav.innerHTML = '';\r\n  \r\n  // Add tabs\r\n  tabs.forEach(tab => {\r\n    const button = createTabButton(tab, props);\r\n    if (tab.id === currentTab) {\r\n      addClass(button, 'active');\r\n    }\r\n    nav.appendChild(button);\r\n  });\r\n}\r\n\r\n/**\r\n * Create sidebar element\r\n */\r\nexport function createSidebar(props: SidebarProps = {}): HTMLElement {\r\n  const sidebar = createElement('aside', { className: 'sidebar' });\r\n\r\n  // Close button for mobile\r\n  const closeBtn = createElement('button', {\r\n    className: 'sidebar-close-btn',\r\n    innerHTML: '',\r\n  });\r\n  on(closeBtn, 'click', () => {\r\n    uiStore.setSidebarOpen(false);\r\n  });\r\n  sidebar.appendChild(closeBtn);\r\n\r\n  // Navigation\r\n  const nav = createElement('nav', { className: 'sidebar-nav' });\r\n  \r\n  // Initial build\r\n  rebuildNavigation(nav, props);\r\n\r\n  sidebar.appendChild(nav);\r\n  \r\n  // Subscribe to app store to rebuild when user changes (for admin tab visibility)\r\n  appStore.subscribe(() => {\r\n    rebuildNavigation(nav, props);\r\n  });\r\n\r\n  // Subscribe to UI state changes\r\n  uiStore.subscribe((state) => {\r\n    // Update active tab\r\n    const buttons = nav.querySelectorAll('.sidebar-tab');\r\n    buttons.forEach(btn => {\r\n      const tabId = btn.getAttribute('data-tab');\r\n      if (tabId === state.currentTab) {\r\n        addClass(btn as HTMLElement, 'active');\r\n      } else {\r\n        removeClass(btn as HTMLElement, 'active');\r\n      }\r\n    });\r\n\r\n    // Update sidebar visibility (mobile)\r\n    if (state.sidebarOpen) {\r\n      addClass(sidebar, 'mobile-open');\r\n    } else {\r\n      removeClass(sidebar, 'mobile-open');\r\n    }\r\n  });\r\n\r\n  // Set initial active state\r\n  const initialState = uiStore.getState();\r\n  const initialActiveBtn = nav.querySelector(`[data-tab=\"${initialState.currentTab}\"]`);\r\n  if (initialActiveBtn) {\r\n    addClass(initialActiveBtn as HTMLElement, 'active');\r\n  }\r\n\r\n  return sidebar;\r\n}\r\n\r\n/**\r\n * Update tab badge\r\n */\r\nexport function updateTabBadge(tabId: MainTab, count: number | null): void {\r\n  const tab = document.querySelector(`.sidebar-tab[data-tab=\"${tabId}\"]`);\r\n  if (!tab) return;\r\n\r\n  let badge = tab.querySelector('.tab-badge');\r\n\r\n  if (count === null || count === 0) {\r\n    badge?.remove();\r\n    return;\r\n  }\r\n\r\n  if (!badge) {\r\n    badge = createElement('span', { className: 'tab-badge' });\r\n    tab.appendChild(badge);\r\n  }\r\n\r\n  badge.textContent = count > 99 ? '99+' : String(count);\r\n}\r\n\r\n/**\r\n * Mount sidebar to existing element\r\n */\r\nexport function mountSidebar(selector: string, props: SidebarProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`Sidebar: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const sidebar = createSidebar(props);\r\n  container.appendChild(sidebar);\r\n  return sidebar;\r\n}\r\n\r\nexport default createSidebar;\r\n","/**\r\n * Toast Container Component\r\n * Visual container for toast notifications\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\n\r\nexport type ToastPosition = 'top-right' | 'top-left' | 'bottom-right' | 'bottom-left' | 'top-center' | 'bottom-center';\r\n\r\nexport interface ToastContainerProps {\r\n  position?: ToastPosition;\r\n  maxToasts?: number;\r\n}\r\n\r\nlet containerInstance: HTMLElement | null = null;\r\n\r\n/**\r\n * Get or create toast container\r\n */\r\nexport function getToastContainer(props: ToastContainerProps = {}): HTMLElement {\r\n  if (containerInstance) {\r\n    return containerInstance;\r\n  }\r\n\r\n  const position = props.position || 'bottom-right';\r\n  const container = createElement('div', {\r\n    className: `toast-container toast-${position}`,\r\n  });\r\n\r\n  // Position styles\r\n  const positionStyles: Record<string, string> = {\r\n    'top-right': 'top: 20px; right: 20px;',\r\n    'top-left': 'top: 20px; left: 20px;',\r\n    'bottom-right': 'bottom: 20px; right: 20px;',\r\n    'bottom-left': 'bottom: 20px; left: 20px;',\r\n    'top-center': 'top: 20px; left: 50%; transform: translateX(-50%);',\r\n    'bottom-center': 'bottom: 20px; left: 50%; transform: translateX(-50%);',\r\n  };\r\n\r\n  container.style.cssText = `\r\n    position: fixed;\r\n    ${positionStyles[position]}\r\n    z-index: 10000;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 8px;\r\n    max-width: 400px;\r\n    pointer-events: none;\r\n  `;\r\n\r\n  document.body.appendChild(container);\r\n  containerInstance = container;\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Create a toast element\r\n */\r\nexport function createToastElement(\r\n  message: string,\r\n  type: 'success' | 'error' | 'warning' | 'info' = 'info',\r\n  duration = 3000\r\n): HTMLElement {\r\n  const toast = createElement('div', {\r\n    className: `toast toast-${type} fade-in`,\r\n  });\r\n\r\n  const icons: Record<string, string> = {\r\n    success: '',\r\n    error: '',\r\n    warning: '',\r\n    info: '',\r\n  };\r\n\r\n  const colors: Record<string, string> = {\r\n    success: 'var(--success)',\r\n    error: 'var(--error)',\r\n    warning: 'var(--warning)',\r\n    info: 'var(--accent)',\r\n  };\r\n\r\n  toast.style.cssText = `\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 10px;\r\n    padding: 12px 16px;\r\n    background: ${colors[type]};\r\n    color: white;\r\n    border-radius: 8px;\r\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\r\n    font-size: 14px;\r\n    pointer-events: auto;\r\n    cursor: pointer;\r\n    animation: slideInRight 0.3s ease;\r\n  `;\r\n\r\n  toast.innerHTML = `\r\n    <span class=\"toast-icon\">${icons[type]}</span>\r\n    <span class=\"toast-message\">${message}</span>\r\n  `;\r\n\r\n  // Click to dismiss\r\n  on(toast, 'click', () => {\r\n    dismissToast(toast);\r\n  });\r\n\r\n  // Auto dismiss\r\n  if (duration > 0) {\r\n    setTimeout(() => {\r\n      dismissToast(toast);\r\n    }, duration);\r\n  }\r\n\r\n  return toast;\r\n}\r\n\r\n/**\r\n * Dismiss a toast with animation\r\n */\r\nfunction dismissToast(toast: HTMLElement): void {\r\n  toast.style.opacity = '0';\r\n  toast.style.transform = 'translateX(100%)';\r\n  toast.style.transition = 'all 0.3s ease';\r\n\r\n  setTimeout(() => {\r\n    toast.remove();\r\n  }, 300);\r\n}\r\n\r\n/**\r\n * Show a toast notification\r\n */\r\nexport function showToastInContainer(\r\n  message: string,\r\n  type: 'success' | 'error' | 'warning' | 'info' = 'info',\r\n  duration = 3000\r\n): HTMLElement {\r\n  const container = getToastContainer();\r\n  const toast = createToastElement(message, type, duration);\r\n  container.appendChild(toast);\r\n  return toast;\r\n}\r\n\r\nexport default getToastContainer;\r\n","/**\r\n * Modal Component\r\n * Reusable modal dialog\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass, show, hide } from '../utils/dom';\r\nimport { uiStore } from '../stores/ui';\r\nimport { shortcuts } from '../services/shortcuts';\r\n\r\nexport interface ModalProps {\r\n  id: string;\r\n  title: string;\r\n  content?: string | HTMLElement;\r\n  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';\r\n  closable?: boolean;\r\n  onClose?: () => void;\r\n  onOpen?: () => void;\r\n  footer?: HTMLElement | null;\r\n}\r\n\r\n// Store active modals\r\nconst activeModals: Map<string, HTMLElement> = new Map();\r\n\r\n/**\r\n * Create modal element\r\n */\r\nexport function createModal(props: ModalProps): HTMLElement {\r\n  const {\r\n    id,\r\n    title,\r\n    content,\r\n    size = 'md',\r\n    closable = true,\r\n    onClose,\r\n    onOpen,\r\n    footer,\r\n  } = props;\r\n\r\n  // Backdrop\r\n  const modal = createElement('div', {\r\n    className: `modal modal-${size}`,\r\n  });\r\n  modal.setAttribute('data-modal-id', id);\r\n\r\n  // Content wrapper\r\n  const modalContent = createElement('div', { className: 'modal-content' });\r\n\r\n  // Header\r\n  const header = createElement('div', { className: 'modal-header' });\r\n  header.innerHTML = `<h3>${title}</h3>`;\r\n\r\n  if (closable) {\r\n    const closeBtn = createElement('button', {\r\n      className: 'modal-close',\r\n      innerHTML: '',\r\n    });\r\n    on(closeBtn, 'click', () => closeModal(id));\r\n    header.appendChild(closeBtn);\r\n  }\r\n\r\n  // Body\r\n  const body = createElement('div', { className: 'modal-body' });\r\n  if (typeof content === 'string') {\r\n    body.innerHTML = content;\r\n  } else if (content) {\r\n    body.appendChild(content);\r\n  }\r\n\r\n  // Footer\r\n  const footerEl = footer || createElement('div', { className: 'modal-footer' });\r\n\r\n  // Assemble\r\n  modalContent.appendChild(header);\r\n  modalContent.appendChild(body);\r\n  if (footer !== null) {\r\n    modalContent.appendChild(footerEl);\r\n  }\r\n  modal.appendChild(modalContent);\r\n\r\n  // Click backdrop to close\r\n  if (closable) {\r\n    on(modal, 'click', (e) => {\r\n      if (e.target === modal) {\r\n        closeModal(id);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Store reference\r\n  activeModals.set(id, modal);\r\n\r\n  return modal;\r\n}\r\n\r\n/**\r\n * Open a modal by ID\r\n */\r\nexport function openModal(id: string): void {\r\n  const modal = activeModals.get(id) || document.querySelector(`[data-modal-id=\"${id}\"]`) as HTMLElement;\r\n  if (!modal) {\r\n    console.warn(`Modal not found: ${id}`);\r\n    return;\r\n  }\r\n\r\n  modal.style.display = 'flex';\r\n  addClass(modal, 'open');\r\n  document.body.style.overflow = 'hidden';\r\n\r\n  // Update UI store\r\n  uiStore.openModal(id);\r\n\r\n  // Focus first input\r\n  setTimeout(() => {\r\n    const firstInput = modal.querySelector('input, textarea, select, button') as HTMLElement;\r\n    firstInput?.focus();\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Close a modal by ID\r\n */\r\nexport function closeModal(id: string): void {\r\n  const modal = activeModals.get(id) || document.querySelector(`[data-modal-id=\"${id}\"]`) as HTMLElement;\r\n  if (!modal) return;\r\n\r\n  removeClass(modal, 'open');\r\n  modal.style.display = 'none';\r\n  document.body.style.overflow = '';\r\n\r\n  // Update UI store\r\n  uiStore.closeModal();\r\n}\r\n\r\n/**\r\n * Close all open modals\r\n */\r\nexport function closeAllModals(): void {\r\n  activeModals.forEach((_, id) => closeModal(id));\r\n}\r\n\r\n/**\r\n * Check if modal is open\r\n */\r\nexport function isModalOpen(id: string): boolean {\r\n  const modal = activeModals.get(id);\r\n  return modal?.classList.contains('open') || false;\r\n}\r\n\r\n/**\r\n * Update modal content\r\n */\r\nexport function updateModalContent(id: string, content: string | HTMLElement): void {\r\n  const modal = activeModals.get(id);\r\n  if (!modal) return;\r\n\r\n  const body = modal.querySelector('.modal-body');\r\n  if (!body) return;\r\n\r\n  if (typeof content === 'string') {\r\n    body.innerHTML = content;\r\n  } else {\r\n    body.innerHTML = '';\r\n    body.appendChild(content);\r\n  }\r\n}\r\n\r\n/**\r\n * Update modal title\r\n */\r\nexport function updateModalTitle(id: string, title: string): void {\r\n  const modal = activeModals.get(id);\r\n  if (!modal) return;\r\n\r\n  const titleEl = modal.querySelector('.modal-header h3');\r\n  if (titleEl) {\r\n    titleEl.textContent = title;\r\n  }\r\n}\r\n\r\n/**\r\n * Create and show a confirm dialog\r\n */\r\nexport function confirm(\r\n  message: string,\r\n  options: {\r\n    title?: string;\r\n    confirmText?: string;\r\n    cancelText?: string;\r\n    confirmClass?: string;\r\n  } = {}\r\n): Promise<boolean> {\r\n  return new Promise((resolve) => {\r\n    const {\r\n      title = 'Confirm',\r\n      confirmText = 'Confirm',\r\n      cancelText = 'Cancel',\r\n      confirmClass = 'btn-primary',\r\n    } = options;\r\n\r\n    const id = `confirm-${Date.now()}`;\r\n\r\n    const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: cancelText,\r\n    });\r\n\r\n    const confirmBtn = createElement('button', {\r\n      className: `btn ${confirmClass}`,\r\n      textContent: confirmText,\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => {\r\n      closeModal(id);\r\n      modal.remove();\r\n      activeModals.delete(id);\r\n      resolve(false);\r\n    });\r\n\r\n    on(confirmBtn, 'click', () => {\r\n      closeModal(id);\r\n      modal.remove();\r\n      activeModals.delete(id);\r\n      resolve(true);\r\n    });\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(confirmBtn);\r\n\r\n    const modal = createModal({\r\n      id,\r\n      title,\r\n      content: `<p>${message}</p>`,\r\n      size: 'sm',\r\n      closable: true,\r\n      onClose: () => resolve(false),\r\n      footer,\r\n    });\r\n\r\n    document.body.appendChild(modal);\r\n    openModal(id);\r\n  });\r\n}\r\n\r\n/**\r\n * Create and show an alert dialog\r\n */\r\nexport function alert(message: string, title = 'Alert'): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    const id = `alert-${Date.now()}`;\r\n\r\n    const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n    const okBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'OK',\r\n    });\r\n\r\n    on(okBtn, 'click', () => {\r\n      closeModal(id);\r\n      modal.remove();\r\n      activeModals.delete(id);\r\n      resolve();\r\n    });\r\n\r\n    footer.appendChild(okBtn);\r\n\r\n    const modal = createModal({\r\n      id,\r\n      title,\r\n      content: `<p>${message}</p>`,\r\n      size: 'sm',\r\n      closable: true,\r\n      onClose: () => resolve(),\r\n      footer,\r\n    });\r\n\r\n    document.body.appendChild(modal);\r\n    openModal(id);\r\n  });\r\n}\r\n\r\n/**\r\n * Create and show a prompt dialog\r\n */\r\nexport function prompt(\r\n  message: string,\r\n  options: {\r\n    title?: string;\r\n    placeholder?: string;\r\n    defaultValue?: string;\r\n  } = {}\r\n): Promise<string | null> {\r\n  return new Promise((resolve) => {\r\n    const id = `prompt-${Date.now()}`;\r\n    const { title = 'Input', placeholder = '', defaultValue = '' } = options;\r\n\r\n    const content = createElement('div', { className: 'prompt-content' });\r\n    content.innerHTML = `\r\n      <p>${message}</p>\r\n      <input type=\"text\" class=\"prompt-input\" placeholder=\"${placeholder}\" value=\"${defaultValue}\" style=\"width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; margin-top: 8px;\">\r\n    `;\r\n\r\n    const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const okBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'OK',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => {\r\n      closeModal(id);\r\n      modal.remove();\r\n      activeModals.delete(id);\r\n      resolve(null);\r\n    });\r\n\r\n    on(okBtn, 'click', () => {\r\n      const input = modal.querySelector('.prompt-input') as HTMLInputElement;\r\n      const value = input?.value || '';\r\n      closeModal(id);\r\n      modal.remove();\r\n      activeModals.delete(id);\r\n      resolve(value);\r\n    });\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(okBtn);\r\n\r\n    const modal = createModal({\r\n      id,\r\n      title,\r\n      content,\r\n      size: 'sm',\r\n      closable: true,\r\n      onClose: () => resolve(null),\r\n      footer,\r\n    });\r\n\r\n    document.body.appendChild(modal);\r\n    openModal(id);\r\n\r\n    // Focus input after modal opens\r\n    setTimeout(() => {\r\n      const input = modal.querySelector('.prompt-input') as HTMLInputElement;\r\n      input?.focus();\r\n    }, 100);\r\n  });\r\n}\r\n\r\n// Register Escape key to close modals\r\nshortcuts.register({\r\n  key: 'Escape',\r\n  description: 'Close modal',\r\n  handler: () => {\r\n    const state = uiStore.getState();\r\n    if (state.modalOpen) {\r\n      closeModal(state.modalOpen);\r\n    }\r\n  },\r\n});\r\n\r\nexport default createModal;\r\n","/**\r\n * Member Permissions Modal - SOTA Design\r\n * Edit granular permissions for a project member\r\n */\r\n\r\nimport { on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'member-permissions-modal';\r\n\r\ninterface MemberPermissionsProps {\r\n  projectId: string;\r\n  userId: string;\r\n  userName: string;\r\n  userEmail: string;\r\n  avatarUrl?: string;\r\n  currentRole: string;\r\n  currentPermissions?: string[];\r\n  onSave?: () => void;\r\n}\r\n\r\n// Permission definitions organized by category\r\nconst PERMISSION_CATEGORIES = [\r\n  {\r\n    id: 'view',\r\n    name: 'View',\r\n    icon: '',\r\n    color: '#3b82f6',\r\n    permissions: [\r\n      { id: 'view:dashboard', name: 'Dashboard', desc: 'View project dashboard and stats' },\r\n      { id: 'view:chat', name: 'AI Chat', desc: 'Use the AI assistant' },\r\n      { id: 'view:sot', name: 'Source of Truth', desc: 'View decisions, risks, actions, questions' },\r\n      { id: 'view:contacts', name: 'Contacts', desc: 'View project contacts' },\r\n      { id: 'view:documents', name: 'Documents', desc: 'View uploaded documents' },\r\n      { id: 'view:emails', name: 'Emails', desc: 'View email history' },\r\n      { id: 'view:team', name: 'Team', desc: 'View team members' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'comment',\r\n    name: 'Comment',\r\n    icon: '',\r\n    color: '#8b5cf6',\r\n    permissions: [\r\n      { id: 'comment:sot', name: 'Comment on Items', desc: 'Add comments to decisions, risks, etc.' },\r\n      { id: 'comment:documents', name: 'Comment on Docs', desc: 'Add comments to documents' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'edit',\r\n    name: 'Edit',\r\n    icon: '',\r\n    color: '#10b981',\r\n    permissions: [\r\n      { id: 'edit:questions', name: 'Questions', desc: 'Create and edit questions' },\r\n      { id: 'edit:risks', name: 'Risks', desc: 'Create and edit risks' },\r\n      { id: 'edit:actions', name: 'Actions', desc: 'Create and edit actions' },\r\n      { id: 'edit:decisions', name: 'Decisions', desc: 'Create and edit decisions' },\r\n      { id: 'edit:contacts', name: 'Contacts', desc: 'Create and edit contacts' },\r\n      { id: 'edit:documents', name: 'Documents', desc: 'Upload and edit documents' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'manage',\r\n    name: 'Manage',\r\n    icon: '',\r\n    color: '#f59e0b',\r\n    permissions: [\r\n      { id: 'manage:team', name: 'Team', desc: 'Invite and remove team members' },\r\n      { id: 'manage:roles', name: 'Roles', desc: 'Create and assign roles' },\r\n      { id: 'manage:settings', name: 'Settings', desc: 'Change project settings' },\r\n      { id: 'manage:integrations', name: 'Integrations', desc: 'Configure integrations' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'delete',\r\n    name: 'Delete',\r\n    icon: '',\r\n    color: '#ef4444',\r\n    permissions: [\r\n      { id: 'delete:data', name: 'Delete Data', desc: 'Permanently delete items' },\r\n      { id: 'export:data', name: 'Export Data', desc: 'Export project data' },\r\n    ],\r\n  },\r\n];\r\n\r\n// Default permission sets for each role\r\nconst ROLE_DEFAULTS: Record<string, string[]> = {\r\n  viewer: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n  ],\r\n  editor: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n    'comment:sot', 'comment:documents',\r\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\r\n  ],\r\n  admin: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n    'comment:sot', 'comment:documents',\r\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\r\n    'manage:team', 'manage:roles', 'manage:settings', 'manage:integrations',\r\n    'delete:data', 'export:data',\r\n  ],\r\n  owner: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n    'comment:sot', 'comment:documents',\r\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\r\n    'manage:team', 'manage:roles', 'manage:settings', 'manage:integrations',\r\n    'delete:data', 'export:data',\r\n  ],\r\n};\r\n\r\n/**\r\n * Show member permissions modal\r\n */\r\nexport function showMemberPermissionsModal(props: MemberPermissionsProps): void {\r\n  const { projectId, userId, userName, userEmail, avatarUrl, currentRole, onSave } = props;\r\n  \r\n  // Use current permissions or defaults for role\r\n  let selectedPermissions = new Set(props.currentPermissions || ROLE_DEFAULTS[currentRole] || []);\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'member-permissions-content';\r\n  \r\n  content.innerHTML = `\r\n    <style>\r\n      .member-permissions-content {\r\n        padding: 0;\r\n      }\r\n      \r\n      .member-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.03) 100%);\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .member-avatar {\r\n        width: 56px;\r\n        height: 56px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        font-weight: 700;\r\n        font-size: 20px;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .member-avatar img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n      \r\n      .member-info h4 {\r\n        margin: 0 0 4px;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .member-info p {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      .role-selector {\r\n        margin-left: auto;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: flex-end;\r\n        gap: 4px;\r\n      }\r\n      \r\n      .role-selector label {\r\n        font-size: 11px;\r\n        color: var(--text-muted);\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n      }\r\n      \r\n      .role-selector select {\r\n        padding: 8px 32px 8px 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        cursor: pointer;\r\n      }\r\n      \r\n      .permissions-body {\r\n        padding: 24px;\r\n        max-height: 400px;\r\n        overflow-y: auto;\r\n      }\r\n      \r\n      .permission-category {\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .permission-category:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .category-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        margin-bottom: 12px;\r\n        padding-bottom: 8px;\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .category-icon {\r\n        font-size: 16px;\r\n      }\r\n      \r\n      .category-name {\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        flex: 1;\r\n      }\r\n      \r\n      .category-toggle {\r\n        font-size: 11px;\r\n        padding: 4px 10px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 6px;\r\n        background: transparent;\r\n        cursor: pointer;\r\n        color: var(--text-secondary);\r\n        transition: all 0.15s;\r\n      }\r\n      \r\n      .category-toggle:hover {\r\n        background: var(--bg-secondary);\r\n        border-color: #e11d48;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .permission-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\r\n        gap: 8px;\r\n      }\r\n      \r\n      .permission-item {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 10px;\r\n        padding: 10px 12px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 10px;\r\n        cursor: pointer;\r\n        transition: all 0.15s;\r\n        border: 1px solid transparent;\r\n      }\r\n      \r\n      .permission-item:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .permission-item.selected {\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\r\n        border-color: rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .permission-item input {\r\n        margin-top: 2px;\r\n        accent-color: #e11d48;\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n      \r\n      .permission-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      \r\n      .permission-name {\r\n        font-size: 13px;\r\n        font-weight: 500;\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .permission-desc {\r\n        font-size: 11px;\r\n        color: var(--text-muted);\r\n        margin-top: 2px;\r\n      }\r\n      \r\n      .modal-actions {\r\n        display: flex;\r\n        gap: 12px;\r\n        justify-content: flex-end;\r\n        padding: 16px 24px;\r\n        border-top: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      \r\n      .btn {\r\n        padding: 10px 20px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n      \r\n      .btn-secondary {\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .btn-secondary:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .btn-primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-primary:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"member-header\">\r\n      <div class=\"member-avatar\">\r\n        ${avatarUrl \r\n          ? `<img src=\"${avatarUrl}\" alt=\"\">` \r\n          : getInitials(userName || userEmail)}\r\n      </div>\r\n      <div class=\"member-info\">\r\n        <h4>${escapeHtml(userName || userEmail)}</h4>\r\n        <p>${escapeHtml(userEmail)}</p>\r\n      </div>\r\n      <div class=\"role-selector\">\r\n        <label>Base Role</label>\r\n        <select id=\"base-role\">\r\n          <option value=\"viewer\" ${currentRole === 'viewer' ? 'selected' : ''}>Viewer</option>\r\n          <option value=\"editor\" ${currentRole === 'editor' ? 'selected' : ''}>Editor</option>\r\n          <option value=\"admin\" ${currentRole === 'admin' ? 'selected' : ''}>Admin</option>\r\n          <option value=\"owner\" ${currentRole === 'owner' ? 'selected' : ''}>Owner</option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"permissions-body\">\r\n      ${PERMISSION_CATEGORIES.map(cat => `\r\n        <div class=\"permission-category\" data-category=\"${cat.id}\">\r\n          <div class=\"category-header\">\r\n            <span class=\"category-icon\">${cat.icon}</span>\r\n            <span class=\"category-name\">${cat.name}</span>\r\n            <button type=\"button\" class=\"category-toggle\" data-action=\"toggle\">Toggle All</button>\r\n          </div>\r\n          <div class=\"permission-grid\">\r\n            ${cat.permissions.map(p => `\r\n              <label class=\"permission-item${selectedPermissions.has(p.id) ? ' selected' : ''}\">\r\n                <input type=\"checkbox\" name=\"permission\" value=\"${p.id}\" ${selectedPermissions.has(p.id) ? 'checked' : ''}>\r\n                <div class=\"permission-info\">\r\n                  <div class=\"permission-name\">${p.name}</div>\r\n                  <div class=\"permission-desc\">${p.desc}</div>\r\n                </div>\r\n              </label>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    \r\n    <div class=\"modal-actions\">\r\n      <button type=\"button\" class=\"btn btn-secondary\" id=\"btn-cancel\">Cancel</button>\r\n      <button type=\"button\" class=\"btn btn-primary\" id=\"btn-save\">Save Permissions</button>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  setTimeout(() => {\r\n    // Base role change - apply defaults\r\n    const roleSelect = content.querySelector('#base-role') as HTMLSelectElement;\r\n    if (roleSelect) {\r\n      on(roleSelect, 'change', () => {\r\n        const role = roleSelect.value;\r\n        const defaults = ROLE_DEFAULTS[role] || [];\r\n        selectedPermissions = new Set(defaults);\r\n        updateCheckboxes(content, selectedPermissions);\r\n      });\r\n    }\r\n\r\n    // Permission checkbox changes\r\n    content.querySelectorAll('input[name=\"permission\"]').forEach(checkbox => {\r\n      on(checkbox as HTMLElement, 'change', () => {\r\n        const value = (checkbox as HTMLInputElement).value;\r\n        const checked = (checkbox as HTMLInputElement).checked;\r\n        \r\n        if (checked) {\r\n          selectedPermissions.add(value);\r\n        } else {\r\n          selectedPermissions.delete(value);\r\n        }\r\n        \r\n        updateItemStyles(content);\r\n      });\r\n    });\r\n\r\n    // Category toggle buttons\r\n    content.querySelectorAll('.category-toggle').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => {\r\n        const category = btn.closest('.permission-category');\r\n        if (!category) return;\r\n        \r\n        const checkboxes = category.querySelectorAll('input[name=\"permission\"]');\r\n        const allChecked = Array.from(checkboxes).every(cb => (cb as HTMLInputElement).checked);\r\n        \r\n        checkboxes.forEach(cb => {\r\n          const input = cb as HTMLInputElement;\r\n          input.checked = !allChecked;\r\n          if (!allChecked) {\r\n            selectedPermissions.add(input.value);\r\n          } else {\r\n            selectedPermissions.delete(input.value);\r\n          }\r\n        });\r\n        \r\n        updateItemStyles(content);\r\n      });\r\n    });\r\n\r\n    // Cancel button\r\n    const cancelBtn = content.querySelector('#btn-cancel');\r\n    if (cancelBtn) {\r\n      on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n    }\r\n\r\n    // Save button\r\n    const saveBtn = content.querySelector('#btn-save');\r\n    if (saveBtn) {\r\n      on(saveBtn as HTMLElement, 'click', async () => {\r\n        const role = roleSelect?.value || currentRole;\r\n        const permissions = Array.from(selectedPermissions);\r\n        \r\n        (saveBtn as HTMLButtonElement).disabled = true;\r\n        saveBtn.textContent = 'Saving...';\r\n        \r\n        try {\r\n          await http.put(`/api/projects/${projectId}/members/${userId}/permissions`, {\r\n            role,\r\n            permissions,\r\n          });\r\n          \r\n          toast.success('Permissions updated');\r\n          closeModal(MODAL_ID);\r\n          onSave?.();\r\n        } catch (error) {\r\n          toast.error('Failed to update permissions');\r\n          (saveBtn as HTMLButtonElement).disabled = false;\r\n          saveBtn.textContent = 'Save Permissions';\r\n        }\r\n      });\r\n    }\r\n  }, 0);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Member Permissions',\r\n    content,\r\n    size: 'lg',\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Update checkboxes from selected set\r\n */\r\nfunction updateCheckboxes(container: HTMLElement, selected: Set<string>): void {\r\n  container.querySelectorAll('input[name=\"permission\"]').forEach(cb => {\r\n    const input = cb as HTMLInputElement;\r\n    input.checked = selected.has(input.value);\r\n  });\r\n  updateItemStyles(container);\r\n}\r\n\r\n/**\r\n * Update item styles based on selection\r\n */\r\nfunction updateItemStyles(container: HTMLElement): void {\r\n  container.querySelectorAll('.permission-item').forEach(item => {\r\n    const checkbox = item.querySelector('input[name=\"permission\"]') as HTMLInputElement;\r\n    item.classList.toggle('selected', checkbox?.checked || false);\r\n  });\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showMemberPermissionsModal;\r\n","/**\r\n * Project Modal - SOTA Design\r\n * Create and edit projects with modern glassmorphism design\r\n * Includes: General settings, Members, Roles, and Configuration tabs\r\n */\r\n\r\nimport { createModal, openModal, closeModal, confirm } from '../Modal';\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { appStore } from '../../stores/app';\r\nimport { dataStore } from '../../stores/data';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { showMemberPermissionsModal } from './MemberPermissionsModal';\r\n\r\nconst MODAL_ID = 'project-modal';\r\n\r\n// ==================== Types ====================\r\n\r\nexport interface ProjectData {\r\n  id?: string;\r\n  name: string;\r\n  description?: string;\r\n  owner_id?: string;\r\n  settings?: ProjectSettings;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\ninterface ProjectSettings {\r\n  userRole?: string;\r\n  userRolePrompt?: string;\r\n}\r\n\r\ninterface ProjectMember {\r\n  user_id: string;\r\n  email?: string;\r\n  display_name?: string;\r\n  avatar_url?: string;\r\n  role: 'owner' | 'admin' | 'write' | 'read';\r\n  user_role?: string;\r\n  user_role_prompt?: string;\r\n  linked_contact_id?: string;\r\n  linked_contact?: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n    organization?: string;\r\n    role?: string;\r\n  };\r\n  joined_at: string;\r\n}\r\n\r\ninterface Contact {\r\n  id: string;\r\n  name: string;\r\n  email?: string;\r\n  organization?: string;\r\n  role?: string;\r\n}\r\n\r\ninterface RoleTemplate {\r\n  id: string;\r\n  name: string;\r\n  display_name: string;\r\n  description?: string;\r\n  icon?: string;\r\n  prompt_template?: string;\r\n  focus_areas?: string[];\r\n  category?: string;\r\n  is_builtin: boolean;\r\n  is_active: boolean;\r\n}\r\n\r\ninterface ProjectConfig {\r\n  id?: string;\r\n  project_id: string;\r\n  llm_config?: Record<string, unknown>;\r\n  ollama_config?: Record<string, unknown>;\r\n  prompts?: Record<string, string>;\r\n  processing_settings?: Record<string, unknown>;\r\n  ui_preferences?: Record<string, unknown>;\r\n}\r\n\r\nexport interface ProjectModalProps {\r\n  mode: 'create' | 'edit';\r\n  project?: ProjectData;\r\n  onSave?: (project: ProjectData) => void;\r\n  onDelete?: (projectId: string) => void;\r\n}\r\n\r\n// ==================== State ====================\r\n\r\nlet currentProps: ProjectModalProps = { mode: 'create' };\r\nlet currentProject: ProjectData | null = null;\r\nlet projectMembers: ProjectMember[] = [];\r\nlet projectRoles: RoleTemplate[] = [];\r\nlet projectConfig: ProjectConfig | null = null;\r\nlet projectContacts: Contact[] = [];\r\n\r\n// ==================== Main Functions ====================\r\n\r\n/**\r\n * Show project modal\r\n */\r\nexport function showProjectModal(props: ProjectModalProps): void {\r\n  currentProps = props;\r\n  currentProject = props.project || null;\r\n\r\n  const content = createModalContent(props.mode);\r\n  \r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: '',\r\n    size: 'lg',\r\n    content: content,\r\n  });\r\n\r\n  // Remove default modal styling for custom design\r\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\r\n  if (modalContent) {\r\n    modalContent.style.cssText = 'background: transparent; box-shadow: none; padding: 0; max-width: 800px;';\r\n  }\r\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\r\n  if (modalHeader) {\r\n    modalHeader.style.display = 'none';\r\n  }\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n  \r\n  if (props.mode === 'edit' && props.project?.id) {\r\n    loadProjectData(content, props.project.id);\r\n  } else {\r\n    renderCreateForm(content);\r\n  }\r\n}\r\n\r\n/**\r\n * Create modal content with SOTA styling\r\n */\r\nfunction createModalContent(mode: 'create' | 'edit'): HTMLElement {\r\n  const container = createElement('div', { className: 'project-modal-sota' });\r\n\r\n  container.innerHTML = `\r\n    <style>\r\n      .project-modal-sota {\r\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n      }\r\n      \r\n      .project-card {\r\n        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\r\n        backdrop-filter: blur(20px);\r\n        border-radius: 24px;\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\r\n          0 0 0 1px rgba(255, 255, 255, 0.8),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.9);\r\n        overflow: hidden;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .project-card {\r\n        background: linear-gradient(135deg, rgba(30,41,59,0.95) 0%, rgba(15,23,42,0.95) 100%);\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.05);\r\n      }\r\n      \r\n      .project-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        padding: 32px;\r\n        position: relative;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .project-header::before {\r\n        content: '';\r\n        position: absolute;\r\n        top: -50%;\r\n        right: -50%;\r\n        width: 100%;\r\n        height: 200%;\r\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\r\n        pointer-events: none;\r\n      }\r\n      \r\n      .project-header-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 20px;\r\n        position: relative;\r\n        z-index: 1;\r\n      }\r\n      \r\n      .project-icon-large {\r\n        width: 72px;\r\n        height: 72px;\r\n        border-radius: 18px;\r\n        background: rgba(255,255,255,0.2);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        border: 3px solid rgba(255,255,255,0.3);\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .project-icon-large svg {\r\n        width: 36px;\r\n        height: 36px;\r\n        color: white;\r\n      }\r\n      \r\n      .project-title-info h2 {\r\n        margin: 0 0 4px 0;\r\n        font-size: 24px;\r\n        font-weight: 700;\r\n        color: white;\r\n      }\r\n      \r\n      .project-title-info p {\r\n        margin: 0;\r\n        color: rgba(255,255,255,0.8);\r\n        font-size: 14px;\r\n      }\r\n      \r\n      .project-close-btn {\r\n        position: absolute;\r\n        top: 16px;\r\n        right: 16px;\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        transition: all 0.2s;\r\n        z-index: 10;\r\n      }\r\n      \r\n      .project-close-btn:hover {\r\n        background: rgba(255,255,255,0.3);\r\n        transform: rotate(90deg);\r\n      }\r\n      \r\n      .project-close-btn svg {\r\n        width: 20px;\r\n        height: 20px;\r\n        color: white;\r\n      }\r\n      \r\n      .project-tabs-nav {\r\n        display: flex;\r\n        gap: 0;\r\n        padding: 0 24px;\r\n        background: rgba(0,0,0,0.02);\r\n        border-bottom: 1px solid rgba(0,0,0,0.06);\r\n        overflow-x: auto;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .project-tabs-nav {\r\n        background: rgba(255,255,255,0.02);\r\n        border-bottom-color: rgba(255,255,255,0.06);\r\n      }\r\n      \r\n      .project-tab-btn {\r\n        padding: 16px 20px;\r\n        background: transparent;\r\n        border: none;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        color: #64748b;\r\n        cursor: pointer;\r\n        position: relative;\r\n        transition: all 0.2s;\r\n        white-space: nowrap;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      .project-tab-btn:hover {\r\n        color: #1e293b;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .project-tab-btn:hover {\r\n        color: #e2e8f0;\r\n      }\r\n      \r\n      .project-tab-btn.active {\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .project-tab-btn.active::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: 0;\r\n        left: 20px;\r\n        right: 20px;\r\n        height: 2px;\r\n        background: #e11d48;\r\n        border-radius: 2px 2px 0 0;\r\n      }\r\n      \r\n      .project-tab-icon {\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n      \r\n      .project-body {\r\n        padding: 32px;\r\n        max-height: 60vh;\r\n        overflow-y: auto;\r\n      }\r\n      \r\n      .project-section {\r\n        display: none;\r\n      }\r\n      \r\n      .project-section.active {\r\n        display: block;\r\n      }\r\n      \r\n      .form-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(2, 1fr);\r\n        gap: 20px;\r\n      }\r\n      \r\n      .form-grid .full-width {\r\n        grid-column: 1 / -1;\r\n      }\r\n      \r\n      .form-field {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 6px;\r\n      }\r\n      \r\n      .form-field label {\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: #475569;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-field label {\r\n        color: #94a3b8;\r\n      }\r\n      \r\n      .form-field input,\r\n      .form-field select,\r\n      .form-field textarea {\r\n        padding: 12px 16px;\r\n        border: 1px solid #e2e8f0;\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        background: #f8fafc;\r\n        color: #1e293b;\r\n        transition: all 0.2s;\r\n        outline: none;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-field input,\r\n      [data-theme=\"dark\"] .form-field select,\r\n      [data-theme=\"dark\"] .form-field textarea {\r\n        background: rgba(255,255,255,0.05);\r\n        border-color: rgba(255,255,255,0.1);\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .form-field input:focus,\r\n      .form-field select:focus,\r\n      .form-field textarea:focus {\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\r\n      }\r\n      \r\n      .form-field input:disabled {\r\n        background: #f1f5f9;\r\n        color: #94a3b8;\r\n        cursor: not-allowed;\r\n      }\r\n      \r\n      .form-field textarea {\r\n        resize: vertical;\r\n        min-height: 80px;\r\n      }\r\n      \r\n      .form-hint {\r\n        font-size: 12px;\r\n        color: #94a3b8;\r\n      }\r\n      \r\n      .form-actions {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 12px;\r\n        margin-top: 24px;\r\n        padding-top: 24px;\r\n        border-top: 1px solid rgba(0,0,0,0.06);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-actions {\r\n        border-top-color: rgba(255,255,255,0.06);\r\n      }\r\n      \r\n      .btn-sota {\r\n        padding: 12px 24px;\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      .btn-sota.primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-sota.primary:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n      \r\n      .btn-sota.primary:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n        transform: none;\r\n      }\r\n      \r\n      .btn-sota.secondary {\r\n        background: #f1f5f9;\r\n        color: #475569;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .btn-sota.secondary {\r\n        background: rgba(255,255,255,0.1);\r\n        color: #e2e8f0;\r\n      }\r\n      \r\n      .btn-sota.secondary:hover {\r\n        background: #e2e8f0;\r\n      }\r\n      \r\n      .btn-sota.danger {\r\n        background: transparent;\r\n        color: #dc2626;\r\n        border: 1px solid #fecaca;\r\n      }\r\n      \r\n      .btn-sota.danger:hover {\r\n        background: #fef2f2;\r\n        border-color: #dc2626;\r\n      }\r\n      \r\n      .btn-sota.small {\r\n        padding: 8px 16px;\r\n        font-size: 13px;\r\n      }\r\n      \r\n      /* Section Headers */\r\n      .section-header {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .section-header h3 {\r\n        font-size: 16px;\r\n        font-weight: 600;\r\n        color: #1e293b;\r\n        margin: 0;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .section-header h3 {\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .section-header h3 svg {\r\n        width: 20px;\r\n        height: 20px;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      /* Members List */\r\n      .members-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .member-card {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding: 16px 20px;\r\n        background: #f8fafc;\r\n        border-radius: 12px;\r\n        border: 1px solid transparent;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .member-card {\r\n        background: rgba(255,255,255,0.03);\r\n      }\r\n      \r\n      .member-card:hover {\r\n        border-color: #e2e8f0;\r\n      }\r\n      \r\n      .member-card.owner {\r\n        border-color: #e11d48;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\r\n      }\r\n      \r\n      .member-info {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 14px;\r\n      }\r\n      \r\n      .member-avatar {\r\n        width: 44px;\r\n        height: 44px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 16px;\r\n        font-weight: 600;\r\n        color: white;\r\n        flex-shrink: 0;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .member-avatar img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n      \r\n      .member-details h4 {\r\n        margin: 0 0 4px 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: #1e293b;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .member-details h4 {\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .member-details p {\r\n        margin: 0;\r\n        font-size: 12px;\r\n        color: #64748b;\r\n      }\r\n      \r\n      .member-actions {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .role-badge {\r\n        font-size: 11px;\r\n        font-weight: 600;\r\n        padding: 4px 10px;\r\n        border-radius: 20px;\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n      }\r\n      \r\n      .role-badge.owner {\r\n        background: #e11d48;\r\n        color: white;\r\n      }\r\n      \r\n      .role-badge.admin {\r\n        background: #8b5cf6;\r\n        color: white;\r\n      }\r\n      \r\n      .role-badge.write {\r\n        background: #0ea5e9;\r\n        color: white;\r\n      }\r\n      \r\n      .role-badge.read {\r\n        background: #64748b;\r\n        color: white;\r\n      }\r\n      \r\n      .role-select {\r\n        padding: 6px 12px;\r\n        border: 1px solid #e2e8f0;\r\n        border-radius: 8px;\r\n        font-size: 13px;\r\n        background: white;\r\n        cursor: pointer;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .role-select {\r\n        background: rgba(255,255,255,0.05);\r\n        border-color: rgba(255,255,255,0.1);\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      /* Role Templates List */\r\n      .roles-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(2, 1fr);\r\n        gap: 16px;\r\n      }\r\n      \r\n      .role-card {\r\n        padding: 20px;\r\n        background: #f8fafc;\r\n        border-radius: 16px;\r\n        border: 2px solid transparent;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .role-card {\r\n        background: rgba(255,255,255,0.03);\r\n      }\r\n      \r\n      .role-card:hover {\r\n        border-color: #e2e8f0;\r\n        transform: translateY(-2px);\r\n      }\r\n      \r\n      .role-card.active {\r\n        border-color: #e11d48;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\r\n      }\r\n      \r\n      .role-card-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        margin-bottom: 12px;\r\n      }\r\n      \r\n      .role-icon {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 10px;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n      }\r\n      \r\n      .role-icon svg {\r\n        width: 20px;\r\n        height: 20px;\r\n        color: white;\r\n      }\r\n      \r\n      .role-card h4 {\r\n        margin: 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: #1e293b;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .role-card h4 {\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .role-card p {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: #64748b;\r\n        line-height: 1.5;\r\n      }\r\n      \r\n      .role-card .toggle-active {\r\n        margin-top: 12px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        font-size: 12px;\r\n        color: #64748b;\r\n      }\r\n      \r\n      /* Config Section */\r\n      .config-group {\r\n        margin-bottom: 32px;\r\n      }\r\n      \r\n      .config-group h4 {\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: #1e293b;\r\n        margin: 0 0 16px 0;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .config-group h4 {\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .config-group h4 svg {\r\n        width: 16px;\r\n        height: 16px;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .api-key-field {\r\n        display: flex;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .api-key-field input {\r\n        flex: 1;\r\n      }\r\n      \r\n      .api-key-field .btn-sota {\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      /* Danger Zone */\r\n      .danger-zone {\r\n        background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);\r\n        border: 1px solid #fecaca;\r\n        border-radius: 16px;\r\n        padding: 24px;\r\n        margin-top: 32px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .danger-zone {\r\n        background: linear-gradient(135deg, rgba(220,38,38,0.1) 0%, rgba(220,38,38,0.05) 100%);\r\n        border-color: rgba(220,38,38,0.3);\r\n      }\r\n      \r\n      .danger-zone h3 {\r\n        color: #dc2626 !important;\r\n        margin: 0 0 8px 0;\r\n        font-size: 16px;\r\n        font-weight: 600;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      .danger-zone h3 svg {\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n      \r\n      .danger-zone p {\r\n        color: #991b1b;\r\n        font-size: 14px;\r\n        margin: 0 0 16px 0;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .danger-zone p {\r\n        color: #fca5a5;\r\n      }\r\n      \r\n      /* Empty State */\r\n      .empty-state {\r\n        text-align: center;\r\n        padding: 48px 24px;\r\n        color: #94a3b8;\r\n      }\r\n      \r\n      .empty-state svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        margin-bottom: 16px;\r\n        opacity: 0.5;\r\n      }\r\n      \r\n      .empty-state p {\r\n        margin: 0 0 16px 0;\r\n      }\r\n      \r\n      /* Loading */\r\n      .loading-spinner {\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        padding: 48px;\r\n      }\r\n      \r\n      .loading-spinner::after {\r\n        content: '';\r\n        width: 32px;\r\n        height: 32px;\r\n        border: 3px solid #e2e8f0;\r\n        border-top-color: #e11d48;\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n      }\r\n      \r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n      \r\n      /* Responsive */\r\n      @media (max-width: 640px) {\r\n        .form-grid {\r\n          grid-template-columns: 1fr;\r\n        }\r\n        \r\n        .roles-grid {\r\n          grid-template-columns: 1fr;\r\n        }\r\n        \r\n        .project-tabs-nav {\r\n          padding: 0 16px;\r\n        }\r\n        \r\n        .project-tab-btn {\r\n          padding: 14px 16px;\r\n        }\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"project-card\">\r\n      <div class=\"loading-spinner\"></div>\r\n    </div>\r\n  `;\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load project data for editing\r\n */\r\nasync function loadProjectData(container: HTMLElement, projectId: string): Promise<void> {\r\n  const card = container.querySelector('.project-card') as HTMLElement;\r\n  if (!card) return;\r\n\r\n  try {\r\n    // Load project details, members, roles, config, and contacts in parallel\r\n    const [projectRes, membersRes, rolesRes, configRes, contactsRes] = await Promise.all([\r\n      http.get<{ project: ProjectData }>(`/api/projects/${projectId}`).catch(() => null),\r\n      http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`).catch(() => ({ data: { members: [] } })),\r\n      http.get<{ roles: RoleTemplate[] }>('/api/role-templates').catch(() => ({ data: { roles: [] } })),\r\n      http.get<{ config: ProjectConfig }>(`/api/projects/${projectId}/config`).catch(() => ({ data: { config: null } })),\r\n      http.get<{ contacts: Contact[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\r\n    ]);\r\n\r\n    if (projectRes?.data?.project) {\r\n      currentProject = projectRes.data.project;\r\n    }\r\n    projectMembers = membersRes?.data?.members || [];\r\n    projectRoles = rolesRes?.data?.roles || [];\r\n    projectConfig = configRes?.data?.config || null;\r\n    // Handle different response formats for contacts\r\n    const contactsData = contactsRes?.data;\r\n    projectContacts = Array.isArray(contactsData) ? contactsData : (contactsData?.contacts || []);\r\n\r\n    renderEditForm(card);\r\n  } catch {\r\n    // Use props project as fallback\r\n    renderEditForm(card);\r\n  }\r\n}\r\n\r\n/**\r\n * Render create form\r\n */\r\nfunction renderCreateForm(container: HTMLElement): void {\r\n  const card = container.querySelector('.project-card') as HTMLElement;\r\n  if (!card) return;\r\n\r\n  card.innerHTML = `\r\n    <!-- Header -->\r\n    <div class=\"project-header\">\r\n      <button class=\"project-close-btn\" id=\"close-project-btn\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n        </svg>\r\n      </button>\r\n      \r\n      <div class=\"project-header-content\">\r\n        <div class=\"project-icon-large\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\r\n          </svg>\r\n        </div>\r\n        <div class=\"project-title-info\">\r\n          <h2>New Project</h2>\r\n          <p>Create a new project to organize your work</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- Form -->\r\n    <div class=\"project-body\">\r\n      <form id=\"project-form\">\r\n        <div class=\"form-grid\">\r\n          <div class=\"form-field full-width\">\r\n            <label>\r\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\r\n              </svg>\r\n              Project Name *\r\n            </label>\r\n            <input type=\"text\" name=\"name\" required placeholder=\"Enter project name\">\r\n          </div>\r\n          \r\n          <div class=\"form-field full-width\">\r\n            <label>\r\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\r\n              </svg>\r\n              Description\r\n            </label>\r\n            <textarea name=\"description\" placeholder=\"Brief description of the project\"></textarea>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-actions\">\r\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"cancel-btn\">Cancel</button>\r\n          <button type=\"submit\" class=\"btn-sota primary\">\r\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n            </svg>\r\n            Create Project\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  `;\r\n\r\n  bindCreateEvents(card);\r\n}\r\n\r\n/**\r\n * Render edit form with tabs\r\n */\r\nfunction renderEditForm(container: HTMLElement): void {\r\n  const project = currentProject || currentProps.project;\r\n  if (!project) return;\r\n\r\n  const settings = project.settings || {};\r\n\r\n  container.innerHTML = `\r\n    <!-- Header -->\r\n    <div class=\"project-header\">\r\n      <button class=\"project-close-btn\" id=\"close-project-btn\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n        </svg>\r\n      </button>\r\n      \r\n      <div class=\"project-header-content\">\r\n        <div class=\"project-icon-large\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\r\n          </svg>\r\n        </div>\r\n        <div class=\"project-title-info\">\r\n          <h2>${escapeHtml(project.name)}</h2>\r\n          <p>${project.description ? escapeHtml(project.description) : 'No description'}</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- Tabs Navigation -->\r\n    <nav class=\"project-tabs-nav\">\r\n      <button class=\"project-tab-btn active\" data-tab=\"general\">\r\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/>\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n        </svg>\r\n        General\r\n      </button>\r\n      <button class=\"project-tab-btn\" data-tab=\"members\">\r\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\r\n        </svg>\r\n        Members\r\n        <span class=\"badge\">${projectMembers.length}</span>\r\n      </button>\r\n      <button class=\"project-tab-btn\" data-tab=\"roles\">\r\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\r\n        </svg>\r\n        Roles\r\n      </button>\r\n      <button class=\"project-tab-btn\" data-tab=\"config\">\r\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4\"/>\r\n        </svg>\r\n        Config\r\n      </button>\r\n    </nav>\r\n    \r\n    <!-- Tab Content -->\r\n    <div class=\"project-body\">\r\n      <!-- General Tab -->\r\n      <div class=\"project-section active\" id=\"section-general\">\r\n        <form id=\"project-form\">\r\n          <div class=\"form-grid\">\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\r\n                </svg>\r\n                Project Name *\r\n              </label>\r\n              <input type=\"text\" name=\"name\" required value=\"${escapeHtml(project.name)}\" placeholder=\"Enter project name\">\r\n            </div>\r\n            \r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\r\n                </svg>\r\n                Description\r\n              </label>\r\n              <textarea name=\"description\" placeholder=\"Brief description of the project\">${escapeHtml(project.description || '')}</textarea>\r\n            </div>\r\n            \r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Your Role\r\n              </label>\r\n              <input type=\"text\" name=\"userRole\" value=\"${escapeHtml(settings.userRole || '')}\" placeholder=\"e.g., Project Manager, Tech Lead\">\r\n              <span class=\"form-hint\">Your role in this project (used for AI context)</span>\r\n            </div>\r\n            \r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\"/>\r\n                </svg>\r\n                Role Prompt\r\n              </label>\r\n              <input type=\"text\" name=\"userRolePrompt\" value=\"${escapeHtml(settings.userRolePrompt || '')}\" placeholder=\"e.g., I manage the project timeline\">\r\n              <span class=\"form-hint\">Brief description of your responsibilities</span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"form-actions\">\r\n            <button type=\"submit\" class=\"btn-sota primary\">\r\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n              </svg>\r\n              Save Changes\r\n            </button>\r\n          </div>\r\n        </form>\r\n        \r\n        <!-- Danger Zone -->\r\n        <div class=\"danger-zone\">\r\n          <h3>\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\r\n            </svg>\r\n            Danger Zone\r\n          </h3>\r\n          <p>Deleting a project will permanently remove all associated data including questions, decisions, risks, and contacts.</p>\r\n          <button type=\"button\" class=\"btn-sota danger\" id=\"delete-project-btn\">\r\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\r\n            </svg>\r\n            Delete Project\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Members Tab -->\r\n      <div class=\"project-section\" id=\"section-members\">\r\n        <div class=\"section-header\">\r\n          <h3>\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\r\n            </svg>\r\n            Team Members\r\n          </h3>\r\n          <button class=\"btn-sota primary small\" id=\"invite-member-btn\">\r\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\r\n            </svg>\r\n            Invite\r\n          </button>\r\n        </div>\r\n        \r\n        <div class=\"members-list\" id=\"members-list\">\r\n          ${renderMembersList()}\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Roles Tab -->\r\n      <div class=\"project-section\" id=\"section-roles\">\r\n        <div class=\"section-header\" style=\"display: flex; justify-content: space-between; align-items: center;\">\r\n          <h3>\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\r\n            </svg>\r\n            Available Roles\r\n          </h3>\r\n          <button class=\"btn-sota primary small\" id=\"add-role-btn\">\r\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n            </svg>\r\n            Add Role\r\n          </button>\r\n        </div>\r\n        <p style=\"color: #64748b; font-size: 14px; margin-bottom: 20px;\">\r\n          Select which roles are available for team members in this project.\r\n        </p>\r\n        \r\n        <div class=\"roles-grid\" id=\"roles-grid\">\r\n          ${renderRolesList()}\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Config Tab -->\r\n      <div class=\"project-section\" id=\"section-config\">\r\n        <div class=\"section-header\">\r\n          <h3>\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4\"/>\r\n            </svg>\r\n            Project Configuration\r\n          </h3>\r\n        </div>\r\n        <p style=\"color: #64748b; font-size: 14px; margin-bottom: 24px;\">\r\n          Override system defaults with project-specific API keys. Leave empty to use system defaults.\r\n        </p>\r\n        \r\n        <form id=\"config-form\">\r\n          <!-- LLM Per-Task Configuration -->\r\n          <div class=\"config-group\">\r\n            <h4>\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z\"/>\r\n              </svg>\r\n              LLM Model Selection\r\n            </h4>\r\n            <p style=\"color: #64748b; font-size: 13px; margin-bottom: 16px;\">\r\n              Override system defaults for each task type. Uncheck to use platform defaults.\r\n            </p>\r\n            \r\n            <!-- Text -->\r\n            <div class=\"llm-task-override\">\r\n              <div class=\"task-header-inline\">\r\n                <label class=\"checkbox-inline\">\r\n                  <input type=\"checkbox\" name=\"use_system_text\" ${getConfigValue('llm_pertask.useSystemDefaults.text') !== 'false' ? 'checked' : ''}>\r\n                  <span class=\"task-icon\"></span> Text / Chat\r\n                </label>\r\n                <span class=\"system-hint\">(Use system default)</span>\r\n              </div>\r\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.text') !== 'false' ? 'disabled' : ''}\">\r\n                <select name=\"text_provider\" class=\"form-control\" disabled>\r\n                  <option value=\"\">Loading...</option>\r\n                </select>\r\n                <select name=\"text_model\" class=\"form-control\" disabled>\r\n                  <option value=\"\">Select provider first</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- Vision -->\r\n            <div class=\"llm-task-override\">\r\n              <div class=\"task-header-inline\">\r\n                <label class=\"checkbox-inline\">\r\n                  <input type=\"checkbox\" name=\"use_system_vision\" ${getConfigValue('llm_pertask.useSystemDefaults.vision') !== 'false' ? 'checked' : ''}>\r\n                  <span class=\"task-icon\"></span> Vision\r\n                </label>\r\n                <span class=\"system-hint\">(Use system default)</span>\r\n              </div>\r\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.vision') !== 'false' ? 'disabled' : ''}\">\r\n                <select name=\"vision_provider\" class=\"form-control\" disabled>\r\n                  <option value=\"\">Loading...</option>\r\n                </select>\r\n                <select name=\"vision_model\" class=\"form-control\" disabled>\r\n                  <option value=\"\">Select provider first</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- Embeddings -->\r\n            <div class=\"llm-task-override\">\r\n              <div class=\"task-header-inline\">\r\n                <label class=\"checkbox-inline\">\r\n                  <input type=\"checkbox\" name=\"use_system_embeddings\" ${getConfigValue('llm_pertask.useSystemDefaults.embeddings') !== 'false' ? 'checked' : ''}>\r\n                  <span class=\"task-icon\"></span> Embeddings\r\n                </label>\r\n                <span class=\"system-hint\">(Use system default)</span>\r\n              </div>\r\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.embeddings') !== 'false' ? 'disabled' : ''}\">\r\n                <select name=\"embeddings_provider\" class=\"form-control\" disabled>\r\n                  <option value=\"\">Loading...</option>\r\n                </select>\r\n                <select name=\"embeddings_model\" class=\"form-control\" disabled>\r\n                  <option value=\"\">Select provider first</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"config-group\">\r\n            <h4>\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\"/>\r\n              </svg>\r\n              LLM API Keys\r\n            </h4>\r\n            <p style=\"color: #64748b; font-size: 13px; margin-bottom: 16px;\">\r\n              Override system API keys for this project. Leave empty to use system defaults.\r\n            </p>\r\n            \r\n            <div class=\"form-grid\">\r\n              <div class=\"form-field\">\r\n                <label>OpenAI API Key</label>\r\n                <input type=\"password\" name=\"openai_key\" placeholder=\"sk-...\" value=\"${escapeHtml(getConfigValue('llm_config.openai_key'))}\">\r\n              </div>\r\n              \r\n              <div class=\"form-field\">\r\n                <label>Anthropic API Key</label>\r\n                <input type=\"password\" name=\"anthropic_key\" placeholder=\"sk-ant-...\" value=\"${escapeHtml(getConfigValue('llm_config.anthropic_key'))}\">\r\n              </div>\r\n              \r\n              <div class=\"form-field\">\r\n                <label>Google AI API Key</label>\r\n                <input type=\"password\" name=\"google_key\" placeholder=\"AI...\" value=\"${escapeHtml(getConfigValue('llm_config.google_key'))}\">\r\n              </div>\r\n              \r\n              <div class=\"form-field\">\r\n                <label>xAI (Grok) API Key</label>\r\n                <input type=\"password\" name=\"grok_key\" placeholder=\"xai-...\" value=\"${escapeHtml(getConfigValue('llm_config.grok_key'))}\">\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"config-group\">\r\n            <h4>\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01\"/>\r\n              </svg>\r\n              Ollama Configuration\r\n            </h4>\r\n            \r\n            <div class=\"form-grid\">\r\n              <div class=\"form-field\">\r\n                <label>Ollama URL</label>\r\n                <input type=\"url\" name=\"ollama_url\" placeholder=\"http://localhost:11434\" value=\"${escapeHtml(getConfigValue('ollama_config.url'))}\">\r\n              </div>\r\n              \r\n              <div class=\"form-field\">\r\n                <label>Default Model</label>\r\n                <input type=\"text\" name=\"ollama_model\" placeholder=\"llama2, mistral, etc.\" value=\"${escapeHtml(getConfigValue('ollama_config.model'))}\">\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"form-actions\">\r\n            <button type=\"submit\" class=\"btn-sota primary\">\r\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n              </svg>\r\n              Save Configuration\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  bindEditEvents(container);\r\n}\r\n\r\n// ==================== Render Helpers ====================\r\n\r\nfunction renderMembersList(): string {\r\n  if (projectMembers.length === 0) {\r\n    return `\r\n      <div class=\"empty-state\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\r\n        </svg>\r\n        <p>No team members yet</p>\r\n        <button class=\"btn-sota primary small\" id=\"invite-first-btn\">Invite Member</button>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  return projectMembers.map(member => {\r\n    const initials = getInitials(member.display_name || member.email || 'U');\r\n    const isOwner = member.role === 'owner';\r\n    \r\n    return `\r\n      <div class=\"member-card ${isOwner ? 'owner' : ''}\" data-user-id=\"${member.user_id}\">\r\n        <div class=\"member-info\">\r\n          <div class=\"member-avatar\">\r\n            ${member.avatar_url \r\n              ? `<img src=\"${member.avatar_url}\" alt=\"${escapeHtml(member.display_name || '')}\">`\r\n              : initials\r\n            }\r\n          </div>\r\n          <div class=\"member-details\">\r\n            <h4>${escapeHtml(member.display_name || member.email || 'Unknown')}</h4>\r\n            <p>\r\n              ${escapeHtml(member.email || '')}\r\n              ${member.user_role ? `  <strong>${escapeHtml(member.user_role)}</strong>` : '  <em style=\"opacity: 0.6\">No role defined</em>'}\r\n              ${member.linked_contact ? `  <span style=\"color: #e11d48;\" title=\"Linked to contact: ${escapeHtml(member.linked_contact.name)}\"> ${escapeHtml(member.linked_contact.name)}</span>` : ''}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <div class=\"member-actions\">\r\n          <button class=\"btn-sota secondary small edit-user-role-btn\" data-user-id=\"${member.user_id}\" title=\"Edit project role\">\r\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\r\n            </svg>\r\n          </button>\r\n          <button class=\"btn-sota secondary small permissions-btn\" data-user-id=\"${member.user_id}\" title=\"Edit permissions\" style=\"font-size: 14px;\">\r\n            \r\n          </button>\r\n          ${isOwner \r\n            ? `<span class=\"role-badge owner\">Owner</span>`\r\n            : `\r\n              <select class=\"role-select member-role-select\" data-user-id=\"${member.user_id}\" title=\"Access level\">\r\n                <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\r\n                <option value=\"write\" ${member.role === 'write' ? 'selected' : ''}>Write</option>\r\n                <option value=\"read\" ${member.role === 'read' ? 'selected' : ''}>Read</option>\r\n              </select>\r\n              <button class=\"btn-sota danger small remove-member-btn\" data-user-id=\"${member.user_id}\" title=\"Remove member\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n                </svg>\r\n              </button>\r\n            `\r\n          }\r\n        </div>\r\n      </div>\r\n    `;\r\n  }).join('');\r\n}\r\n\r\nfunction renderRolesList(): string {\r\n  if (projectRoles.length === 0) {\r\n    return `\r\n      <div class=\"empty-state\" style=\"grid-column: 1 / -1;\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\r\n        </svg>\r\n        <p>No role templates available</p>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  return projectRoles.map(role => `\r\n    <div class=\"role-card ${role.is_active ? 'active' : ''}\" data-role-id=\"${role.id}\">\r\n      <div class=\"role-card-header\">\r\n        <div class=\"role-icon\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n          </svg>\r\n        </div>\r\n        <h4>${escapeHtml(role.display_name)}</h4>\r\n      </div>\r\n      <p>${escapeHtml(role.description || 'No description')}</p>\r\n      <div class=\"toggle-active\">\r\n        <input type=\"checkbox\" id=\"role-${role.id}\" ${role.is_active ? 'checked' : ''}>\r\n        <label for=\"role-${role.id}\">Active in this project</label>\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n}\r\n\r\nfunction getConfigValue(path: string): string {\r\n  if (!projectConfig) return '';\r\n  \r\n  const parts = path.split('.');\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  let value: any = projectConfig;\r\n  \r\n  for (const part of parts) {\r\n    if (value && typeof value === 'object' && part in value) {\r\n      value = value[part];\r\n    } else {\r\n      return '';\r\n    }\r\n  }\r\n  \r\n  return typeof value === 'string' ? value : '';\r\n}\r\n\r\n// ==================== Event Binding ====================\r\n\r\nfunction bindCreateEvents(container: HTMLElement): void {\r\n  // Close button\r\n  const closeBtn = container.querySelector('#close-project-btn');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n  }\r\n\r\n  // Cancel button\r\n  const cancelBtn = container.querySelector('#cancel-btn');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n  }\r\n\r\n  // Form submit\r\n  const form = container.querySelector('#project-form') as HTMLFormElement;\r\n  if (form) {\r\n    on(form, 'submit', async (e) => {\r\n      e.preventDefault();\r\n      \r\n      const formData = new FormData(form);\r\n      const projectData: ProjectData = {\r\n        name: (formData.get('name') as string).trim(),\r\n        description: (formData.get('description') as string).trim() || undefined,\r\n      };\r\n\r\n      const submitBtn = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\r\n      submitBtn.disabled = true;\r\n      submitBtn.innerHTML = '<span class=\"loading-spinner\" style=\"width: 16px; height: 16px;\"></span> Creating...';\r\n\r\n      try {\r\n        const response = await http.post<{ id: string; project?: ProjectData }>('/api/projects', projectData);\r\n        projectData.id = response.data.id;\r\n        \r\n        toast.success('Project created');\r\n        \r\n        // Set as current project\r\n        appStore.setCurrentProject({\r\n          id: projectData.id,\r\n          name: projectData.name,\r\n          description: projectData.description,\r\n        });\r\n        \r\n        currentProps.onSave?.(projectData);\r\n        closeModal(MODAL_ID);\r\n        loadProjects();\r\n      } catch {\r\n        toast.error('Failed to create project');\r\n      } finally {\r\n        submitBtn.disabled = false;\r\n        submitBtn.innerHTML = `\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Create Project\r\n        `;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction bindEditEvents(container: HTMLElement): void {\r\n  // Close button\r\n  const closeBtn = container.querySelector('#close-project-btn');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n  }\r\n\r\n  // Tab switching\r\n  const tabs = container.querySelectorAll('.project-tab-btn');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n\r\n      const tabId = tab.getAttribute('data-tab');\r\n      container.querySelectorAll('.project-section').forEach(section => {\r\n        section.classList.toggle('active', section.id === `section-${tabId}`);\r\n      });\r\n    });\r\n  });\r\n\r\n  // General form submit\r\n  const projectForm = container.querySelector('#project-form') as HTMLFormElement;\r\n  if (projectForm) {\r\n    on(projectForm, 'submit', async (e) => {\r\n      e.preventDefault();\r\n      \r\n      const formData = new FormData(projectForm);\r\n      const projectData = {\r\n        name: (formData.get('name') as string).trim(),\r\n        description: (formData.get('description') as string).trim() || undefined,\r\n        settings: {\r\n          userRole: (formData.get('userRole') as string).trim() || undefined,\r\n          userRolePrompt: (formData.get('userRolePrompt') as string).trim() || undefined,\r\n        },\r\n      };\r\n\r\n      try {\r\n        await http.put(`/api/projects/${currentProject?.id || currentProps.project?.id}`, projectData);\r\n        toast.success('Project updated');\r\n        currentProps.onSave?.({ ...currentProject, ...projectData } as ProjectData);\r\n        \r\n        // Update header\r\n        const titleEl = container.querySelector('.project-title-info h2');\r\n        const descEl = container.querySelector('.project-title-info p');\r\n        if (titleEl) titleEl.textContent = projectData.name;\r\n        if (descEl) descEl.textContent = projectData.description || 'No description';\r\n      } catch {\r\n        toast.error('Failed to update project');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete project\r\n  const deleteBtn = container.querySelector('#delete-project-btn');\r\n  if (deleteBtn) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      const project = currentProject || currentProps.project;\r\n      if (!project?.id) return;\r\n\r\n      const confirmed = await confirm(\r\n        `Are you sure you want to delete \"${project.name}\"? This action cannot be undone.`,\r\n        {\r\n          title: 'Delete Project',\r\n          confirmText: 'Delete',\r\n          confirmClass: 'btn-danger',\r\n        }\r\n      );\r\n\r\n      if (confirmed) {\r\n        try {\r\n          await http.delete(`/api/projects/${project.id}`);\r\n          toast.success('Project deleted');\r\n          currentProps.onDelete?.(project.id);\r\n          closeModal(MODAL_ID);\r\n          \r\n          if (appStore.getState().currentProjectId === project.id) {\r\n            appStore.setCurrentProject(null);\r\n          }\r\n          \r\n          loadProjects();\r\n        } catch {\r\n          toast.error('Failed to delete project');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // Invite member buttons\r\n  const inviteBtn = container.querySelector('#invite-member-btn');\r\n  const inviteFirstBtn = container.querySelector('#invite-first-btn');\r\n  [inviteBtn, inviteFirstBtn].forEach(btn => {\r\n    if (btn) {\r\n      on(btn as HTMLElement, 'click', () => {\r\n        showInviteModal();\r\n      });\r\n    }\r\n  });\r\n\r\n  // Add role button\r\n  const addRoleBtn = container.querySelector('#add-role-btn');\r\n  if (addRoleBtn) {\r\n    on(addRoleBtn as HTMLElement, 'click', () => {\r\n      showAddRoleDialog(container);\r\n    });\r\n  }\r\n\r\n  // Member role changes\r\n  container.querySelectorAll('.member-role-select').forEach(select => {\r\n    on(select as HTMLElement, 'change', async () => {\r\n      const userId = select.getAttribute('data-user-id');\r\n      const newRole = (select as HTMLSelectElement).value;\r\n      const projectId = currentProject?.id || currentProps.project?.id;\r\n      \r\n      if (!userId || !projectId) return;\r\n\r\n      try {\r\n        await http.put(`/api/projects/${projectId}/members/${userId}`, { role: newRole });\r\n        toast.success('Member role updated');\r\n      } catch {\r\n        toast.error('Failed to update role');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Remove member\r\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const userId = btn.getAttribute('data-user-id');\r\n      const projectId = currentProject?.id || currentProps.project?.id;\r\n      \r\n      if (!userId || !projectId) return;\r\n\r\n      const confirmed = await confirm('Remove this member from the project?', {\r\n        title: 'Remove Member',\r\n        confirmText: 'Remove',\r\n        confirmClass: 'btn-danger',\r\n      });\r\n\r\n      if (confirmed) {\r\n        try {\r\n          await http.delete(`/api/projects/${projectId}/members/${userId}`);\r\n          toast.success('Member removed');\r\n          \r\n          // Remove from list\r\n          projectMembers = projectMembers.filter(m => m.user_id !== userId);\r\n          const membersList = container.querySelector('#members-list');\r\n          if (membersList) {\r\n            membersList.innerHTML = renderMembersList();\r\n            bindMemberEvents(container);\r\n          }\r\n        } catch {\r\n          toast.error('Failed to remove member');\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  // Config form submit\r\n  const configForm = container.querySelector('#config-form') as HTMLFormElement;\r\n  if (configForm) {\r\n    on(configForm, 'submit', async (e) => {\r\n      e.preventDefault();\r\n      \r\n      const formData = new FormData(configForm);\r\n      const config = {\r\n        llm_config: {\r\n          openai_key: formData.get('openai_key') || undefined,\r\n          anthropic_key: formData.get('anthropic_key') || undefined,\r\n          google_key: formData.get('google_key') || undefined,\r\n          grok_key: formData.get('grok_key') || undefined,\r\n        },\r\n        ollama_config: {\r\n          url: formData.get('ollama_url') || undefined,\r\n          model: formData.get('ollama_model') || undefined,\r\n        },\r\n      };\r\n\r\n      const projectId = currentProject?.id || currentProps.project?.id;\r\n      if (!projectId) return;\r\n\r\n      try {\r\n        await http.put(`/api/projects/${projectId}/config`, config);\r\n        toast.success('Configuration saved');\r\n      } catch {\r\n        toast.error('Failed to save configuration');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Bind member-specific events (edit role buttons)\r\n  bindMemberEvents(container);\r\n}\r\n\r\nfunction bindMemberEvents(container: HTMLElement): void {\r\n  // Edit user role buttons\r\n  container.querySelectorAll('.edit-user-role-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const userId = btn.getAttribute('data-user-id');\r\n      if (!userId) return;\r\n      \r\n      const member = projectMembers.find(m => m.user_id === userId);\r\n      if (member) {\r\n        showEditUserRoleDialog(container, member);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Permissions buttons\r\n  container.querySelectorAll('.permissions-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const userId = btn.getAttribute('data-user-id');\r\n      if (!userId) return;\r\n      \r\n      const member = projectMembers.find(m => m.user_id === userId);\r\n      const projectId = currentProject?.id || currentProps.project?.id;\r\n      if (!member || !projectId) return;\r\n\r\n      showMemberPermissionsModal({\r\n        projectId,\r\n        userId: member.user_id,\r\n        userName: member.display_name || '',\r\n        userEmail: member.email || '',\r\n        avatarUrl: member.avatar_url,\r\n        currentRole: member.role,\r\n        currentPermissions: (member as { permissions?: string[] }).permissions,\r\n        onSave: async () => {\r\n          // Reload members after permissions update\r\n          try {\r\n            const response = await http.get<{ members: typeof projectMembers }>(`/api/projects/${projectId}/members`);\r\n            projectMembers = response.data.members || [];\r\n            const membersList = container.querySelector('#members-list');\r\n            if (membersList) {\r\n              membersList.innerHTML = renderMembersList();\r\n              bindMemberEvents(container);\r\n            }\r\n          } catch {\r\n            // Ignore\r\n          }\r\n        },\r\n      });\r\n    });\r\n  });\r\n\r\n  // Re-bind member role changes and remove buttons after list update\r\n  container.querySelectorAll('.member-role-select').forEach(select => {\r\n    on(select as HTMLElement, 'change', async () => {\r\n      const userId = select.getAttribute('data-user-id');\r\n      const newRole = (select as HTMLSelectElement).value;\r\n      const projectId = currentProject?.id || currentProps.project?.id;\r\n      \r\n      if (!userId || !projectId) return;\r\n\r\n      try {\r\n        await http.put(`/api/projects/${projectId}/members/${userId}`, { role: newRole });\r\n        toast.success('Access level updated');\r\n      } catch {\r\n        toast.error('Failed to update access level');\r\n      }\r\n    });\r\n  });\r\n\r\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const userId = btn.getAttribute('data-user-id');\r\n      const projectId = currentProject?.id || currentProps.project?.id;\r\n      \r\n      if (!userId || !projectId) return;\r\n\r\n      const confirmed = await confirm('Remove this member from the project?', {\r\n        title: 'Remove Member',\r\n        confirmText: 'Remove',\r\n        confirmClass: 'btn-danger',\r\n      });\r\n\r\n      if (confirmed) {\r\n        try {\r\n          await http.delete(`/api/projects/${projectId}/members/${userId}`);\r\n          toast.success('Member removed');\r\n          \r\n          projectMembers = projectMembers.filter(m => m.user_id !== userId);\r\n          const membersList = container.querySelector('#members-list');\r\n          if (membersList) {\r\n            membersList.innerHTML = renderMembersList();\r\n            bindMemberEvents(container);\r\n          }\r\n        } catch {\r\n          toast.error('Failed to remove member');\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show dialog to add a new role\r\n */\r\nfunction showAddRoleDialog(container: HTMLElement): void {\r\n  // Check if dialog already exists\r\n  const existingDialog = container.querySelector('.add-role-dialog');\r\n  if (existingDialog) existingDialog.remove();\r\n\r\n  const projectId = currentProject?.id || currentProps.project?.id;\r\n  if (!projectId) return;\r\n\r\n  // Create dialog\r\n  const dialog = createElement('div', { className: 'add-role-dialog' });\r\n  dialog.innerHTML = `\r\n    <style>\r\n      .add-role-dialog {\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        background: rgba(0,0,0,0.5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 10001;\r\n        backdrop-filter: blur(4px);\r\n      }\r\n      \r\n      .add-role-card {\r\n        background: white;\r\n        border-radius: 20px;\r\n        width: 100%;\r\n        max-width: 500px;\r\n        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);\r\n        overflow: hidden;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .add-role-card {\r\n        background: #1e293b;\r\n      }\r\n      \r\n      .add-role-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        padding: 20px 24px;\r\n        color: white;\r\n      }\r\n      \r\n      .add-role-header h4 {\r\n        margin: 0;\r\n        font-size: 18px;\r\n        font-weight: 700;\r\n      }\r\n      \r\n      .add-role-body {\r\n        padding: 24px;\r\n      }\r\n      \r\n      .add-role-field {\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .add-role-field label {\r\n        display: block;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: #64748b;\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .add-role-field input,\r\n      .add-role-field textarea,\r\n      .add-role-field select {\r\n        width: 100%;\r\n        padding: 12px 16px;\r\n        border: 1px solid #e2e8f0;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        box-sizing: border-box;\r\n        background: #f8fafc;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .add-role-field input,\r\n      [data-theme=\"dark\"] .add-role-field textarea,\r\n      [data-theme=\"dark\"] .add-role-field select {\r\n        background: rgba(255,255,255,0.05);\r\n        border-color: rgba(255,255,255,0.1);\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .add-role-field input:focus,\r\n      .add-role-field textarea:focus,\r\n      .add-role-field select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\r\n      }\r\n      \r\n      .add-role-field textarea {\r\n        resize: vertical;\r\n        min-height: 80px;\r\n      }\r\n      \r\n      .add-role-ai-btn {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        padding: 8px 14px;\r\n        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\r\n        color: white;\r\n        border: none;\r\n        border-radius: 8px;\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        margin-top: 8px;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .add-role-ai-btn:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(139,92,246,0.3);\r\n      }\r\n      \r\n      .add-role-ai-btn:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n      }\r\n      \r\n      .add-role-actions {\r\n        display: flex;\r\n        gap: 12px;\r\n        justify-content: flex-end;\r\n        padding-top: 16px;\r\n        border-top: 1px solid #e2e8f0;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .add-role-actions {\r\n        border-color: rgba(255,255,255,0.1);\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"add-role-card\">\r\n      <div class=\"add-role-header\">\r\n        <h4>Add New Role</h4>\r\n      </div>\r\n      <div class=\"add-role-body\">\r\n        <form id=\"add-role-form\">\r\n          <div class=\"add-role-field\">\r\n            <label>Role Name *</label>\r\n            <input type=\"text\" id=\"new-role-name\" required placeholder=\"e.g., Senior Developer, Tech Lead\">\r\n          </div>\r\n          \r\n          <div class=\"add-role-field\">\r\n            <label>Category</label>\r\n            <select id=\"new-role-category\">\r\n              <option value=\"project\"> Project</option>\r\n              <option value=\"technical\"> Technical</option>\r\n              <option value=\"management\"> Management</option>\r\n              <option value=\"stakeholder\"> Stakeholder</option>\r\n              <option value=\"custom\"> Custom</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <div class=\"add-role-field\">\r\n            <label>Description</label>\r\n            <input type=\"text\" id=\"new-role-description\" placeholder=\"Brief description of this role\">\r\n          </div>\r\n          \r\n          <div class=\"add-role-field\">\r\n            <label>Role Context (for AI)</label>\r\n            <textarea id=\"new-role-context\" placeholder=\"Describe this role's responsibilities, priorities, and how the AI should adapt responses...\"></textarea>\r\n            <button type=\"button\" class=\"add-role-ai-btn\" id=\"enhance-role-btn\">\r\n               Enhance with AI\r\n            </button>\r\n          </div>\r\n          \r\n          <div class=\"add-role-actions\">\r\n            <button type=\"button\" class=\"btn-sota secondary\" id=\"cancel-add-role\">Cancel</button>\r\n            <button type=\"submit\" class=\"btn-sota primary\">Create Role</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  container.appendChild(dialog);\r\n\r\n  // Bind events\r\n  const closeDialog = () => dialog.remove();\r\n\r\n  // Cancel button\r\n  const cancelBtn = dialog.querySelector('#cancel-add-role');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', closeDialog);\r\n  }\r\n\r\n  // Click outside to close\r\n  on(dialog, 'click', (e) => {\r\n    if (e.target === dialog) closeDialog();\r\n  });\r\n\r\n  // AI enhance button\r\n  const enhanceBtn = dialog.querySelector('#enhance-role-btn');\r\n  if (enhanceBtn) {\r\n    on(enhanceBtn as HTMLElement, 'click', async () => {\r\n      const nameInput = dialog.querySelector('#new-role-name') as HTMLInputElement;\r\n      const contextInput = dialog.querySelector('#new-role-context') as HTMLTextAreaElement;\r\n      const descInput = dialog.querySelector('#new-role-description') as HTMLInputElement;\r\n\r\n      const roleName = nameInput.value.trim();\r\n      if (!roleName) {\r\n        toast.error('Please enter a role name first');\r\n        return;\r\n      }\r\n\r\n      (enhanceBtn as HTMLButtonElement).disabled = true;\r\n      enhanceBtn.textContent = ' Enhancing...';\r\n\r\n      try {\r\n        const response = await http.post<{ prompt: string; description?: string }>('/api/roles/generate', {\r\n          title: roleName,\r\n          currentContext: contextInput.value,\r\n        });\r\n\r\n        if (response.data.prompt) {\r\n          contextInput.value = response.data.prompt;\r\n        }\r\n        if (response.data.description && !descInput.value) {\r\n          descInput.value = response.data.description;\r\n        }\r\n        toast.success('Role context enhanced');\r\n      } catch {\r\n        toast.error('Failed to enhance with AI');\r\n      } finally {\r\n        (enhanceBtn as HTMLButtonElement).disabled = false;\r\n        enhanceBtn.textContent = ' Enhance with AI';\r\n      }\r\n    });\r\n  }\r\n\r\n  // Form submit\r\n  const form = dialog.querySelector('#add-role-form') as HTMLFormElement;\r\n  if (form) {\r\n    on(form, 'submit', async (e) => {\r\n      e.preventDefault();\r\n\r\n      const name = (dialog.querySelector('#new-role-name') as HTMLInputElement).value.trim();\r\n      const category = (dialog.querySelector('#new-role-category') as HTMLSelectElement).value;\r\n      const description = (dialog.querySelector('#new-role-description') as HTMLInputElement).value.trim();\r\n      const roleContext = (dialog.querySelector('#new-role-context') as HTMLTextAreaElement).value.trim();\r\n\r\n      if (!name) {\r\n        toast.error('Role name is required');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        await http.post('/api/role-templates', {\r\n          name: name.toLowerCase().replace(/\\s+/g, '_'),\r\n          display_name: name,\r\n          description,\r\n          role_context: roleContext,\r\n          category,\r\n          color: '#e11d48',\r\n          is_template: true,\r\n        });\r\n\r\n        toast.success('Role created');\r\n        closeDialog();\r\n\r\n        // Reload roles\r\n        await loadProjectRoles(projectId);\r\n        const rolesGrid = container.querySelector('#roles-grid');\r\n        if (rolesGrid) {\r\n          rolesGrid.innerHTML = renderRolesList();\r\n        }\r\n      } catch {\r\n        toast.error('Failed to create role');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Focus on name input\r\n  setTimeout(() => {\r\n    const nameInput = dialog.querySelector('#new-role-name') as HTMLInputElement;\r\n    if (nameInput) nameInput.focus();\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Show inline edit dialog for user role\r\n */\r\nfunction showEditUserRoleDialog(container: HTMLElement, member: ProjectMember): void {\r\n  // Check if dialog already exists\r\n  const existingDialog = container.querySelector('.user-role-edit-dialog');\r\n  if (existingDialog) existingDialog.remove();\r\n\r\n  const projectId = currentProject?.id || currentProps.project?.id;\r\n  if (!projectId) return;\r\n\r\n  // Create inline edit dialog\r\n  const dialog = createElement('div', { className: 'user-role-edit-dialog' });\r\n  dialog.innerHTML = `\r\n    <style>\r\n      .user-role-edit-dialog {\r\n        position: fixed;\r\n        top: 50%;\r\n        left: 50%;\r\n        transform: translate(-50%, -50%);\r\n        background: white;\r\n        border-radius: 16px;\r\n        box-shadow: 0 25px 50px rgba(0,0,0,0.25);\r\n        padding: 24px;\r\n        z-index: 10001;\r\n        width: 400px;\r\n        max-width: 90vw;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .user-role-edit-dialog {\r\n        background: #1e293b;\r\n      }\r\n      \r\n      .user-role-edit-dialog h3 {\r\n        margin: 0 0 20px 0;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: #1e293b;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .user-role-edit-dialog h3 {\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .user-role-edit-dialog h3 svg {\r\n        width: 20px;\r\n        height: 20px;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .user-role-edit-dialog .form-field {\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      .user-role-edit-dialog .form-field label {\r\n        display: block;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: #475569;\r\n        margin-bottom: 6px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field label {\r\n        color: #94a3b8;\r\n      }\r\n      \r\n      .user-role-edit-dialog .form-field input,\r\n      .user-role-edit-dialog .form-field textarea,\r\n      .user-role-edit-dialog .form-field select {\r\n        width: 100%;\r\n        padding: 10px 14px;\r\n        border: 1px solid #e2e8f0;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        background: #f8fafc;\r\n        color: #1e293b;\r\n        box-sizing: border-box;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field input,\r\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field textarea,\r\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field select {\r\n        background: rgba(255,255,255,0.05);\r\n        border-color: rgba(255,255,255,0.1);\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .user-role-edit-dialog .form-field input:focus,\r\n      .user-role-edit-dialog .form-field textarea:focus,\r\n      .user-role-edit-dialog .form-field select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\r\n      }\r\n      \r\n      .user-role-edit-dialog .form-field textarea {\r\n        resize: vertical;\r\n        min-height: 80px;\r\n      }\r\n      \r\n      .user-role-edit-dialog .form-hint {\r\n        font-size: 12px;\r\n        color: #94a3b8;\r\n        margin-top: 4px;\r\n      }\r\n      \r\n      .user-role-edit-dialog .linked-contact-info {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n        padding: 10px 14px;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\r\n        border: 1px solid rgba(225,29,72,0.2);\r\n        border-radius: 10px;\r\n        margin-top: 8px;\r\n      }\r\n      \r\n      .user-role-edit-dialog .linked-contact-info svg {\r\n        width: 16px;\r\n        height: 16px;\r\n        color: #e11d48;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .user-role-edit-dialog .linked-contact-info span {\r\n        font-size: 13px;\r\n        color: #1e293b;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .user-role-edit-dialog .linked-contact-info span {\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .user-role-edit-dialog .dialog-actions {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 10px;\r\n        margin-top: 20px;\r\n      }\r\n      \r\n      .user-role-edit-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0,0,0,0.4);\r\n        z-index: 10000;\r\n      }\r\n    </style>\r\n    \r\n    <h3>\r\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n      </svg>\r\n      Edit Project Role\r\n    </h3>\r\n    <p style=\"color: #64748b; font-size: 14px; margin: 0 0 20px 0;\">\r\n      Define <strong>${escapeHtml(member.display_name || member.email || 'this member')}</strong>'s role in the project\r\n    </p>\r\n    \r\n    <div class=\"form-field\">\r\n      <label>Role Title</label>\r\n      <select id=\"edit-user-role\">\r\n        <option value=\"\">-- Select a role --</option>\r\n        ${projectRoles.filter(r => r.is_active).map(r => `\r\n          <option value=\"${escapeHtml(r.display_name || r.name)}\" \r\n                  data-prompt=\"${escapeHtml(r.prompt_template || '')}\"\r\n                  ${member.user_role === r.display_name || member.user_role === r.name ? 'selected' : ''}>\r\n            ${escapeHtml(r.display_name || r.name)}\r\n          </option>\r\n        `).join('')}\r\n        <option value=\"__custom__\" ${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? 'selected' : ''}>Custom role...</option>\r\n      </select>\r\n      <div class=\"form-hint\">Select a predefined role or choose \"Custom role\" for a custom title</div>\r\n      <input type=\"text\" id=\"edit-user-role-custom\" \r\n             value=\"${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? escapeHtml(member.user_role) : ''}\" \r\n             placeholder=\"Enter custom role title\"\r\n             style=\"margin-top: 8px; display: ${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? 'block' : 'none'};\">\r\n    </div>\r\n    \r\n    <div class=\"form-field\">\r\n      <label>Role Description</label>\r\n      <textarea id=\"edit-user-role-prompt\" placeholder=\"e.g., I manage the technical architecture and lead the development team\">${escapeHtml(member.user_role_prompt || '')}</textarea>\r\n      <div class=\"form-hint\">Brief description of responsibilities (used for AI context)</div>\r\n    </div>\r\n    \r\n    <div class=\"form-field\">\r\n      <label>\r\n        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" style=\"display: inline; vertical-align: middle; margin-right: 4px;\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n        </svg>\r\n        Link to Contact\r\n      </label>\r\n      <select id=\"edit-linked-contact\">\r\n        <option value=\"\">-- No linked contact --</option>\r\n        ${projectContacts.map(c => `\r\n          <option value=\"${c.id}\" ${member.linked_contact_id === c.id ? 'selected' : ''}>\r\n            ${escapeHtml(c.name)}${c.organization ? ` (${escapeHtml(c.organization)})` : ''}${c.email ? ` - ${escapeHtml(c.email)}` : ''}\r\n          </option>\r\n        `).join('')}\r\n      </select>\r\n      <div class=\"form-hint\">Associate this team member with a project contact</div>\r\n      ${member.linked_contact ? `\r\n        <div class=\"linked-contact-info\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\r\n          </svg>\r\n          <span>Currently linked to: <strong>${escapeHtml(member.linked_contact.name)}</strong></span>\r\n        </div>\r\n      ` : ''}\r\n    </div>\r\n    \r\n    <div class=\"dialog-actions\">\r\n      <button class=\"btn-sota secondary\" id=\"cancel-role-edit\">Cancel</button>\r\n      <button class=\"btn-sota primary\" id=\"save-role-edit\">\r\n        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n        </svg>\r\n        Save Role\r\n      </button>\r\n    </div>\r\n  `;\r\n\r\n  // Create overlay\r\n  const overlay = createElement('div', { className: 'user-role-edit-overlay' });\r\n  \r\n  document.body.appendChild(overlay);\r\n  document.body.appendChild(dialog);\r\n\r\n  // Focus first input\r\n  const roleSelect = dialog.querySelector('#edit-user-role') as HTMLSelectElement;\r\n  const customInput = dialog.querySelector('#edit-user-role-custom') as HTMLInputElement;\r\n  const promptTextarea = dialog.querySelector('#edit-user-role-prompt') as HTMLTextAreaElement;\r\n  setTimeout(() => roleSelect?.focus(), 100);\r\n\r\n  // Handle role selection change\r\n  on(roleSelect, 'change', () => {\r\n    const selectedOption = roleSelect.options[roleSelect.selectedIndex];\r\n    const isCustom = roleSelect.value === '__custom__';\r\n    \r\n    // Show/hide custom input\r\n    customInput.style.display = isCustom ? 'block' : 'none';\r\n    if (isCustom) {\r\n      customInput.focus();\r\n    }\r\n    \r\n    // Auto-fill prompt from role template (always when selecting a predefined role)\r\n    if (!isCustom && selectedOption.dataset.prompt) {\r\n      promptTextarea.value = selectedOption.dataset.prompt;\r\n    }\r\n  });\r\n\r\n  // Cancel button\r\n  const cancelBtn = dialog.querySelector('#cancel-role-edit');\r\n  const closeDialog = () => {\r\n    overlay.remove();\r\n    dialog.remove();\r\n  };\r\n\r\n  on(cancelBtn as HTMLElement, 'click', closeDialog);\r\n  on(overlay, 'click', closeDialog);\r\n\r\n  // Save button\r\n  const saveBtn = dialog.querySelector('#save-role-edit');\r\n  on(saveBtn as HTMLElement, 'click', async () => {\r\n    const roleSelectValue = roleSelect.value;\r\n    const userRole = roleSelectValue === '__custom__' ? customInput.value.trim() : roleSelectValue;\r\n    const userRolePrompt = (dialog.querySelector('#edit-user-role-prompt') as HTMLTextAreaElement).value.trim();\r\n    const linkedContactId = (dialog.querySelector('#edit-linked-contact') as HTMLSelectElement).value || null;\r\n\r\n    try {\r\n      await http.put(`/api/projects/${projectId}/members/${member.user_id}`, {\r\n        user_role: userRole,\r\n        user_role_prompt: userRolePrompt,\r\n        linked_contact_id: linkedContactId,\r\n      });\r\n\r\n      // Update local state\r\n      const memberIndex = projectMembers.findIndex(m => m.user_id === member.user_id);\r\n      if (memberIndex !== -1) {\r\n        projectMembers[memberIndex].user_role = userRole;\r\n        projectMembers[memberIndex].user_role_prompt = userRolePrompt;\r\n        projectMembers[memberIndex].linked_contact_id = linkedContactId || undefined;\r\n        // Find linked contact info\r\n        if (linkedContactId) {\r\n          const contact = projectContacts.find(c => c.id === linkedContactId);\r\n          if (contact) {\r\n            projectMembers[memberIndex].linked_contact = {\r\n              id: contact.id,\r\n              name: contact.name,\r\n              email: contact.email,\r\n              organization: contact.organization,\r\n              role: contact.role,\r\n            };\r\n          }\r\n        } else {\r\n          projectMembers[memberIndex].linked_contact = undefined;\r\n        }\r\n      }\r\n\r\n      // Refresh list\r\n      const membersList = container.querySelector('#members-list');\r\n      if (membersList) {\r\n        membersList.innerHTML = renderMembersList();\r\n        bindMemberEvents(container);\r\n      }\r\n\r\n      toast.success('Project role updated');\r\n      closeDialog();\r\n    } catch {\r\n      toast.error('Failed to update role');\r\n    }\r\n  });\r\n\r\n  // Close on Escape\r\n  const handleEscape = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      closeDialog();\r\n      document.removeEventListener('keydown', handleEscape);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', handleEscape);\r\n}\r\n\r\n// ==================== Helper Functions ====================\r\n\r\nasync function showInviteModal(): Promise<void> {\r\n  const { showInviteModal: showInvite } = await import('./InviteModal');\r\n  const projectId = currentProject?.id || currentProps.project?.id;\r\n  if (projectId) {\r\n    showInvite({\r\n      projectId,\r\n      onInvite: async () => {\r\n        // Refresh members list\r\n        try {\r\n          const res = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\r\n          projectMembers = res.data.members || [];\r\n          const membersList = document.querySelector('#members-list');\r\n          if (membersList) {\r\n            membersList.innerHTML = renderMembersList();\r\n            bindMemberEvents(membersList.closest('.project-card') as HTMLElement);\r\n          }\r\n        } catch {\r\n          // Ignore\r\n        }\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nasync function loadProjects(): Promise<void> {\r\n  try {\r\n    const response = await http.get<Array<{ id: string; name: string }>>('/api/projects');\r\n    dataStore.setProjects(response.data);\r\n  } catch {\r\n    // Silent fail\r\n  }\r\n}\r\n\r\nasync function loadProjectRoles(projectId: string): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ roles: RoleTemplate[] }>('/api/role-templates');\r\n    projectRoles = response.data.roles || [];\r\n  } catch {\r\n    projectRoles = [];\r\n  }\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport function closeProjectModal(): void {\r\n  closeModal(MODAL_ID);\r\n}\r\n\r\nexport default showProjectModal;\r\n","/**\r\n * Project Selector Component\r\n * Dropdown for selecting and managing projects\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { appStore } from '../stores/app';\r\nimport { dataStore } from '../stores/data';\r\nimport { projects } from '../services/projects';\r\nimport { toast } from '../services/toast';\r\nimport { showProjectModal } from './modals/ProjectModal';\r\n\r\nexport interface ProjectSelectorOptions {\r\n  containerId?: string;\r\n  onProjectChange?: (projectId: string) => void;\r\n}\r\n\r\n/**\r\n * Initialize project selector\r\n */\r\nexport function initProjectSelector(options: ProjectSelectorOptions = {}): void {\r\n  const container = options.containerId \r\n    ? document.getElementById(options.containerId)\r\n    : document.getElementById('project-selector-container');\r\n\r\n  if (!container) return;\r\n\r\n  // Create selector HTML\r\n  container.innerHTML = `\r\n    <div class=\"project-selector-wrapper\">\r\n      <select id=\"project-selector\" class=\"project-selector\">\r\n        <option value=\"\">Select Project...</option>\r\n      </select>\r\n      <button id=\"new-project-btn\" class=\"btn-icon\" title=\"Create new project\">+</button>\r\n      <button id=\"edit-project-btn\" class=\"btn-icon\" title=\"Edit project\" style=\"display: none;\"></button>\r\n    </div>\r\n  `;\r\n\r\n  const selector = container.querySelector('#project-selector') as HTMLSelectElement;\r\n  const newBtn = container.querySelector('#new-project-btn') as HTMLButtonElement;\r\n  const editBtn = container.querySelector('#edit-project-btn') as HTMLButtonElement;\r\n\r\n  // Load and populate projects\r\n  loadProjectsIntoSelector(selector);\r\n\r\n  // Handle selection change\r\n  on(selector, 'change', async () => {\r\n    const projectId = selector.value;\r\n    if (projectId) {\r\n      await selectProject(projectId, options.onProjectChange);\r\n      editBtn.style.display = '';\r\n    } else {\r\n      editBtn.style.display = 'none';\r\n    }\r\n  });\r\n\r\n  // New project button\r\n  on(newBtn, 'click', () => {\r\n    showProjectModal({\r\n      mode: 'create',\r\n      onSave: async (project) => {\r\n        await loadProjectsIntoSelector(selector);\r\n        if (project.id) {\r\n          selector.value = project.id;\r\n          editBtn.style.display = '';\r\n          options.onProjectChange?.(project.id);\r\n        }\r\n      },\r\n    });\r\n  });\r\n\r\n  // Edit project button\r\n  on(editBtn, 'click', () => {\r\n    const currentProject = appStore.getState().currentProject;\r\n    if (currentProject) {\r\n      showProjectModal({\r\n        mode: 'edit',\r\n        project: currentProject,\r\n        onSave: async () => {\r\n          await loadProjectsIntoSelector(selector);\r\n        },\r\n        onDelete: async () => {\r\n          await loadProjectsIntoSelector(selector);\r\n          editBtn.style.display = 'none';\r\n        },\r\n      });\r\n    }\r\n  });\r\n\r\n  // Subscribe to store changes\r\n  dataStore.subscribe((state) => {\r\n    updateSelectorOptions(selector, state.projects);\r\n  });\r\n\r\n  appStore.subscribe((state) => {\r\n    if (state.currentProjectId && selector.value !== state.currentProjectId) {\r\n      selector.value = state.currentProjectId;\r\n      editBtn.style.display = '';\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Load projects into selector\r\n */\r\nasync function loadProjectsIntoSelector(selector: HTMLSelectElement): Promise<void> {\r\n  const projectList = await projects.getAll();\r\n  updateSelectorOptions(selector, projectList);\r\n\r\n  // Set current project if any\r\n  const currentProjectId = appStore.getState().currentProjectId;\r\n  if (currentProjectId) {\r\n    selector.value = currentProjectId;\r\n  }\r\n}\r\n\r\n/**\r\n * Update selector options\r\n */\r\nfunction updateSelectorOptions(\r\n  selector: HTMLSelectElement, \r\n  projectList: Array<{ id: string; name: string; isDefault?: boolean }>\r\n): void {\r\n  const currentValue = selector.value;\r\n  \r\n  selector.innerHTML = '<option value=\"\">Select Project...</option>';\r\n  \r\n  projectList.forEach(project => {\r\n    const option = document.createElement('option');\r\n    option.value = project.id;\r\n    option.textContent = project.name + (project.isDefault ? ' (default)' : '');\r\n    selector.appendChild(option);\r\n  });\r\n\r\n  // Restore selection if possible\r\n  if (currentValue && projectList.some(p => p.id === currentValue)) {\r\n    selector.value = currentValue;\r\n  }\r\n}\r\n\r\n/**\r\n * Select a project\r\n */\r\nasync function selectProject(\r\n  projectId: string, \r\n  onChange?: (projectId: string) => void\r\n): Promise<void> {\r\n  try {\r\n    const project = await projects.activate(projectId);\r\n    if (project) {\r\n      toast.success(`Switched to: ${project.name}`);\r\n      onChange?.(projectId);\r\n    }\r\n  } catch {\r\n    toast.error('Failed to switch project');\r\n  }\r\n}\r\n\r\n/**\r\n * Create standalone project selector element\r\n */\r\nexport function createProjectSelector(options: ProjectSelectorOptions = {}): HTMLElement {\r\n  const wrapper = createElement('div', { className: 'project-selector-wrapper' });\r\n  \r\n  const selector = createElement('select', { \r\n    className: 'project-selector',\r\n    id: 'project-selector',\r\n  }) as HTMLSelectElement;\r\n  \r\n  const defaultOption = createElement('option', { \r\n    textContent: 'Select Project...',\r\n  }) as HTMLOptionElement;\r\n  defaultOption.value = '';\r\n  selector.appendChild(defaultOption);\r\n\r\n  const newBtn = createElement('button', {\r\n    className: 'btn-icon',\r\n    textContent: '+',\r\n    title: 'Create new project',\r\n  });\r\n\r\n  wrapper.appendChild(selector);\r\n  wrapper.appendChild(newBtn);\r\n\r\n  // Load projects\r\n  projects.getAll().then(projectList => {\r\n    updateSelectorOptions(selector, projectList);\r\n    const currentProjectId = appStore.getState().currentProjectId;\r\n    if (currentProjectId) {\r\n      selector.value = currentProjectId;\r\n    }\r\n  });\r\n\r\n  // Bind events\r\n  on(selector, 'change', async () => {\r\n    const projectId = selector.value;\r\n    if (projectId) {\r\n      await selectProject(projectId, options.onProjectChange);\r\n    }\r\n  });\r\n\r\n  on(newBtn, 'click', () => {\r\n    showProjectModal({\r\n      mode: 'create',\r\n      onSave: async (project) => {\r\n        const projectList = await projects.getAll();\r\n        updateSelectorOptions(selector, projectList);\r\n        if (project.id) {\r\n          selector.value = project.id;\r\n          options.onProjectChange?.(project.id);\r\n        }\r\n      },\r\n    });\r\n  });\r\n\r\n  return wrapper;\r\n}\r\n\r\nexport default initProjectSelector;\r\n","/**\r\n * Format Utilities\r\n * Helper functions for formatting values\r\n */\r\n\r\n/**\r\n * Format number with thousand separators\r\n */\r\nexport function formatNumber(value: number, locale = 'en-US'): string {\r\n  return new Intl.NumberFormat(locale).format(value);\r\n}\r\n\r\n/**\r\n * Format date to locale string\r\n */\r\nexport function formatDate(date: string | Date, options?: Intl.DateTimeFormatOptions): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  return d.toLocaleDateString(undefined, options);\r\n}\r\n\r\n/**\r\n * Format date and time\r\n */\r\nexport function formatDateTime(date: string | Date): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  return d.toLocaleString();\r\n}\r\n\r\n/**\r\n * Format relative time (e.g., \"2 hours ago\", \"yesterday\", \"this week\")\r\n * \r\n * Returns human-friendly labels:\r\n * - \"just now\" for < 1 minute\r\n * - \"X minutes ago\" for < 1 hour\r\n * - \"X hours ago\" for same day\r\n * - \"yesterday\" for previous day\r\n * - \"X days ago\" for < 7 days\r\n * - \"this week\" for same week\r\n * - \"last week\" for previous week\r\n * - Full date for older\r\n */\r\nexport function formatRelativeTime(date: string | Date): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - d.getTime();\r\n  const diffSec = Math.floor(diffMs / 1000);\r\n  const diffMin = Math.floor(diffSec / 60);\r\n  const diffHour = Math.floor(diffMin / 60);\r\n  const diffDay = Math.floor(diffHour / 24);\r\n\r\n  // Future dates\r\n  if (diffMs < 0) {\r\n    const futureDays = Math.ceil(Math.abs(diffMs) / (1000 * 60 * 60 * 24));\r\n    if (futureDays === 0) return 'today';\r\n    if (futureDays === 1) return 'tomorrow';\r\n    if (futureDays < 7) return `in ${futureDays} days`;\r\n    return formatDate(d, { month: 'short', day: 'numeric' });\r\n  }\r\n\r\n  // Past dates\r\n  if (diffSec < 60) return 'just now';\r\n  if (diffMin < 60) return `${diffMin} min${diffMin === 1 ? '' : 's'} ago`;\r\n  if (diffHour < 24) return `${diffHour} hour${diffHour === 1 ? '' : 's'} ago`;\r\n\r\n  // Check if yesterday\r\n  const yesterday = new Date(now);\r\n  yesterday.setDate(yesterday.getDate() - 1);\r\n  if (isSameDay(d, yesterday)) return 'yesterday';\r\n\r\n  // Check if this week (same calendar week)\r\n  const startOfWeek = getStartOfWeek(now);\r\n  if (d >= startOfWeek) return 'this week';\r\n\r\n  // Check if last week\r\n  const startOfLastWeek = new Date(startOfWeek);\r\n  startOfLastWeek.setDate(startOfLastWeek.getDate() - 7);\r\n  if (d >= startOfLastWeek) return 'last week';\r\n\r\n  // Within 30 days\r\n  if (diffDay < 30) return `${diffDay} days ago`;\r\n\r\n  // Within this year\r\n  if (d.getFullYear() === now.getFullYear()) {\r\n    return formatDate(d, { month: 'short', day: 'numeric' });\r\n  }\r\n  \r\n  // Older\r\n  return formatDate(d, { year: 'numeric', month: 'short', day: 'numeric' });\r\n}\r\n\r\n/**\r\n * Check if two dates are the same calendar day\r\n */\r\nfunction isSameDay(d1: Date, d2: Date): boolean {\r\n  return d1.getFullYear() === d2.getFullYear() &&\r\n         d1.getMonth() === d2.getMonth() &&\r\n         d1.getDate() === d2.getDate();\r\n}\r\n\r\n/**\r\n * Get start of week (Sunday)\r\n */\r\nfunction getStartOfWeek(date: Date): Date {\r\n  const d = new Date(date);\r\n  const day = d.getDay();\r\n  d.setDate(d.getDate() - day);\r\n  d.setHours(0, 0, 0, 0);\r\n  return d;\r\n}\r\n\r\n/**\r\n * Format file size\r\n */\r\nexport function formatFileSize(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  \r\n  const units = ['B', 'KB', 'MB', 'GB', 'TB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\r\n  const size = bytes / Math.pow(1024, i);\r\n  \r\n  return `${size.toFixed(i > 0 ? 1 : 0)} ${units[i]}`;\r\n}\r\n\r\n/**\r\n * Format percentage\r\n */\r\nexport function formatPercent(value: number, decimals = 0): string {\r\n  return `${(value * 100).toFixed(decimals)}%`;\r\n}\r\n\r\n/**\r\n * Format currency\r\n */\r\nexport function formatCurrency(value: number, currency = 'USD', locale = 'en-US'): string {\r\n  return new Intl.NumberFormat(locale, {\r\n    style: 'currency',\r\n    currency,\r\n  }).format(value);\r\n}\r\n\r\n/**\r\n * Truncate text with ellipsis\r\n */\r\nexport function truncate(text: string, maxLength: number, suffix = '...'): string {\r\n  if (text.length <= maxLength) return text;\r\n  return text.slice(0, maxLength - suffix.length) + suffix;\r\n}\r\n\r\n/**\r\n * Capitalize first letter\r\n */\r\nexport function capitalize(text: string): string {\r\n  return text.charAt(0).toUpperCase() + text.slice(1);\r\n}\r\n\r\n/**\r\n * Convert to title case\r\n */\r\nexport function titleCase(text: string): string {\r\n  return text\r\n    .toLowerCase()\r\n    .split(' ')\r\n    .map(word => capitalize(word))\r\n    .join(' ');\r\n}\r\n\r\n/**\r\n * Convert to kebab-case\r\n */\r\nexport function kebabCase(text: string): string {\r\n  return text\r\n    .replace(/([a-z])([A-Z])/g, '$1-$2')\r\n    .replace(/[\\s_]+/g, '-')\r\n    .toLowerCase();\r\n}\r\n\r\n/**\r\n * Convert to camelCase\r\n */\r\nexport function camelCase(text: string): string {\r\n  return text\r\n    .replace(/[-_\\s]+(.)?/g, (_, c) => c ? c.toUpperCase() : '')\r\n    .replace(/^[A-Z]/, c => c.toLowerCase());\r\n}\r\n\r\n/**\r\n * Pluralize word based on count\r\n */\r\nexport function pluralize(count: number, singular: string, plural?: string): string {\r\n  return count === 1 ? singular : (plural || singular + 's');\r\n}\r\n\r\n/**\r\n * Format duration in seconds to human readable\r\n */\r\nexport function formatDuration(seconds: number): string {\r\n  if (seconds < 60) return `${seconds}s`;\r\n  if (seconds < 3600) {\r\n    const min = Math.floor(seconds / 60);\r\n    const sec = seconds % 60;\r\n    return sec > 0 ? `${min}m ${sec}s` : `${min}m`;\r\n  }\r\n  \r\n  const hours = Math.floor(seconds / 3600);\r\n  const min = Math.floor((seconds % 3600) / 60);\r\n  return min > 0 ? `${hours}h ${min}m` : `${hours}h`;\r\n}\r\n","/**\r\n * Dashboard Component\r\n * Main dashboard view with stats, health, trends, insights, and alerts\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { dataStore } from '../stores/data';\r\nimport { appStore } from '../stores/app';\r\nimport { formatNumber, formatPercent, formatRelativeTime } from '../utils/format';\r\nimport { dashboardService, DashboardData, HealthData, Insight, Alert, TrendMetric } from '../services/dashboard';\r\nimport { http } from '../services/api';\r\nimport { risksService } from '../services/risks';\r\n\r\nexport interface DashboardStats {\r\n  totalQuestions: number;\r\n  answeredQuestions: number;\r\n  totalRisks: number;\r\n  highPriorityRisks: number;\r\n  totalActions: number;\r\n  completedActions: number;\r\n  totalDecisions: number;\r\n  totalContacts: number;\r\n  healthScore: number;\r\n}\r\n\r\nexport interface DashboardProps {\r\n  onStatClick?: (statId: string) => void;\r\n  onAlertClick?: (alert: Alert) => void;\r\n  onInsightAction?: (insight: Insight) => void;\r\n}\r\n\r\n/**\r\n * Create dashboard element\r\n */\r\nexport function createDashboard(props: DashboardProps = {}): HTMLElement {\r\n  const dashboard = createElement('div', { className: 'dashboard' });\r\n\r\n  // Layout: Stats  Insights  Briefing  Bottom Row (Health + Charts)\r\n  dashboard.innerHTML = `\r\n    <!-- Row 1: Stats Cards -->\r\n    <div class=\"dashboard-row\">\r\n      <div id=\"dashboard-stats-grid\" class=\"stats-grid\"></div>\r\n    </div>\r\n\r\n    <!-- Row 2: Insights (horizontal) -->\r\n    <div id=\"dashboard-insights\" class=\"dashboard-insights-row\"></div>\r\n\r\n    <!-- Row 3: Alerts if any -->\r\n    <div id=\"dashboard-overdue\" class=\"dashboard-overdue-section\"></div>\r\n    <div id=\"dashboard-alerts\" class=\"dashboard-alerts-section\"></div>\r\n\r\n    <!-- Row 4: Daily Briefing (full width) -->\r\n    <div class=\"dashboard-briefing-section\" id=\"dashboard-briefing\"></div>\r\n\r\n    <!-- Row 5: Golden Hours (includes Team info) -->\r\n    <div id=\"dashboard-golden-hours\" class=\"dashboard-golden-hours-section\"></div>\r\n\r\n    <!-- Row 6: Charts (Questions priority, Facts by category, Trends) -->\r\n    <div class=\"dashboard-charts-row\">\r\n      <div id=\"questions-chart\" class=\"chart-container\"></div>\r\n      <div id=\"facts-chart\" class=\"chart-container\"></div>\r\n      <div id=\"trends-chart\" class=\"chart-container\"></div>\r\n    </div>\r\n\r\n    <!-- Row 7: Bottom - Health + Risk Summary -->\r\n    <div class=\"dashboard-bottom-row\">\r\n      <div id=\"dashboard-health\" class=\"dashboard-health-card\"></div>\r\n      <div id=\"risk-summary-container\" class=\"dashboard-risk-summary-card\"></div>\r\n    </div>\r\n  `;\r\n\r\n  // Load dashboard data\r\n  loadFullDashboard(dashboard, props);\r\n\r\n  return dashboard;\r\n}\r\n\r\n/**\r\n * Load full dashboard data from API\r\n */\r\nasync function loadFullDashboard(dashboard: HTMLElement, props: DashboardProps): Promise<void> {\r\n  const healthSection = dashboard.querySelector('#dashboard-health');\r\n  const briefingSection = dashboard.querySelector('#dashboard-briefing');\r\n  const statsGrid = dashboard.querySelector('#dashboard-stats-grid');\r\n  const overdueSection = dashboard.querySelector('#dashboard-overdue');\r\n  const alertsSection = dashboard.querySelector('#dashboard-alerts');\r\n  const insightsSection = dashboard.querySelector('#dashboard-insights');\r\n  const riskSummaryContainer = dashboard.querySelector('#risk-summary-container');\r\n  const goldenHoursSection = dashboard.querySelector('#dashboard-golden-hours');\r\n\r\n  // Check if project is selected\r\n  const currentProject = appStore.getState().currentProject;\r\n  const currentProjectId = appStore.getState().currentProjectId;\r\n  \r\n  if (!currentProject && !currentProjectId) {\r\n    // No project selected - show empty state\r\n    if (statsGrid) {\r\n      statsGrid.innerHTML = `\r\n        <div class=\"no-project-state\" style=\"\r\n          grid-column: 1 / -1;\r\n          display: flex;\r\n          flex-direction: column;\r\n          align-items: center;\r\n          justify-content: center;\r\n          padding: 64px 24px;\r\n          text-align: center;\r\n          background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\r\n          border-radius: 16px;\r\n          border: 2px dashed rgba(225,29,72,0.2);\r\n          min-height: 300px;\r\n        \">\r\n          <svg width=\"80\" height=\"80\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" style=\"color: #e11d48; margin-bottom: 20px; opacity: 0.6;\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\r\n          </svg>\r\n          <h2 style=\"margin: 0 0 12px 0; font-size: 24px; font-weight: 700; color: var(--text-primary);\">No Project Selected</h2>\r\n          <p style=\"margin: 0 0 24px 0; font-size: 15px; color: var(--text-secondary); max-width: 450px; line-height: 1.6;\">\r\n            Select a project from the dropdown in the header to view your dashboard, or create a new project to get started.\r\n          </p>\r\n          <div style=\"display: flex; gap: 12px;\">\r\n            <button class=\"btn btn-primary create-project-btn\" style=\"\r\n              padding: 12px 28px;\r\n              font-size: 14px;\r\n              font-weight: 600;\r\n              display: inline-flex;\r\n              align-items: center;\r\n              gap: 8px;\r\n            \">\r\n              <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n              </svg>\r\n              Create New Project\r\n            </button>\r\n          </div>\r\n        </div>\r\n      `;\r\n      \r\n      // Bind create project button\r\n      const createBtn = statsGrid.querySelector('.create-project-btn');\r\n      if (createBtn) {\r\n        createBtn.addEventListener('click', async () => {\r\n          const { showProjectModal } = await import('./modals/ProjectModal');\r\n          showProjectModal({\r\n            mode: 'create',\r\n            onSave: () => {\r\n              // Trigger refresh\r\n              window.dispatchEvent(new CustomEvent('godmode:project-created'));\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n    \r\n    // Hide other sections\r\n    if (healthSection) (healthSection as HTMLElement).innerHTML = '';\r\n    if (briefingSection) (briefingSection as HTMLElement).innerHTML = '';\r\n    if (overdueSection) (overdueSection as HTMLElement).innerHTML = '';\r\n    if (alertsSection) (alertsSection as HTMLElement).innerHTML = '';\r\n    if (insightsSection) (insightsSection as HTMLElement).innerHTML = '';\r\n    if (riskSummaryContainer) (riskSummaryContainer as HTMLElement).innerHTML = '';\r\n    if (goldenHoursSection) (goldenHoursSection as HTMLElement).innerHTML = '';\r\n    \r\n    return;\r\n  }\r\n\r\n  // Show loading state\r\n  if (statsGrid) {\r\n    statsGrid.innerHTML = '<div class=\"loading-placeholder\">Loading dashboard...</div>';\r\n  }\r\n\r\n  // Load Briefing Panel (async)\r\n  if (briefingSection && !briefingSection.hasChildNodes()) {\r\n    import('./BriefingPanel').then(({ createBriefingPanel }) => {\r\n      const briefingPanel = createBriefingPanel();\r\n      briefingSection.appendChild(briefingPanel);\r\n    }).catch(err => console.error('Failed to load BriefingPanel:', err));\r\n  }\r\n\r\n  try {\r\n    const { dashboard: data, health, insights, alerts } = await dashboardService.loadAll();\r\n\r\n    // Render health indicator\r\n    if (healthSection && health) {\r\n      renderHealthIndicator(healthSection as HTMLElement, health);\r\n    }\r\n\r\n    // Render stats\r\n    if (statsGrid && data) {\r\n      renderStatsGrid(statsGrid as HTMLElement, data, props.onStatClick);\r\n    }\r\n\r\n    // Render overdue actions alert\r\n    if (overdueSection && data && data.overdueActions > 0) {\r\n      renderOverdueActionsAlert(overdueSection as HTMLElement, data.overdueActions);\r\n    }\r\n\r\n    // Render alerts\r\n    if (alertsSection && alerts.length > 0) {\r\n      renderAlerts(alertsSection as HTMLElement, alerts, props.onAlertClick);\r\n    }\r\n\r\n    // Render insights\r\n    if (insightsSection && insights.length > 0) {\r\n      renderInsights(insightsSection as HTMLElement, insights, props.onInsightAction);\r\n    }\r\n\r\n    // Render charts\r\n    if (data) {\r\n      renderQuestionsPriorityChart(data);\r\n      renderFactsChart(data);\r\n      // Load trends asynchronously (don't block)\r\n      renderWeeklyTrendsChart(data).catch(err => \r\n        console.error('Failed to render trends chart:', err)\r\n      );\r\n    }\r\n\r\n    // Load Risk Summary with risks data (donut, bars, and 2D matrix)\r\n    if (riskSummaryContainer && !riskSummaryContainer.hasChildNodes()) {\r\n      risksService.getAll().then(risks => {\r\n        renderRiskSummary(riskSummaryContainer as HTMLElement, risks);\r\n      }).catch(err => console.error('Failed to load Risk Summary:', err));\r\n    }\r\n\r\n    // Load Golden Hours section (includes Team info)\r\n    if (goldenHoursSection && !goldenHoursSection.hasChildNodes()) {\r\n      const projectId = currentProjectId || currentProject?.id;\r\n      if (projectId) {\r\n        loadGoldenHours(goldenHoursSection as HTMLElement, projectId);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Failed to load dashboard:', error);\r\n    if (statsGrid) {\r\n      statsGrid.innerHTML = '<div class=\"error-message\">Failed to load dashboard data</div>';\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Render health indicator\r\n */\r\nfunction renderHealthIndicator(container: HTMLElement, health: HealthData): void {\r\n  // Handle missing or incomplete health data\r\n  if (!health || typeof health.status !== 'string') {\r\n    container.innerHTML = `\r\n      <div class=\"health-indicator unknown\">\r\n        <div class=\"health-gauge\">\r\n          <span class=\"score-value\">--</span>\r\n          <span class=\"score-label\">Health</span>\r\n        </div>\r\n        <p class=\"health-status\">Health data unavailable</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  const statusClass = health.status.toLowerCase().replace(/\\s+/g, '-');\r\n  const score = health.score ?? 0;\r\n  const color = health.color || '#888';\r\n  const factors = health.factors || [];\r\n  \r\n  container.innerHTML = `\r\n    <div class=\"health-indicator ${statusClass}\">\r\n      <div class=\"health-gauge\">\r\n        <div class=\"health-score\" style=\"--score: ${score}%\">\r\n          <span class=\"score-value\">${score}</span>\r\n          <span class=\"score-label\">Health</span>\r\n        </div>\r\n        <div class=\"health-bar\">\r\n          <div class=\"health-fill\" style=\"width: ${score}%; background: ${color}\"></div>\r\n        </div>\r\n      </div>\r\n      <div class=\"health-status\">\r\n        <span class=\"status-text\" style=\"color: ${color}\">${health.status}</span>\r\n      </div>\r\n      <div class=\"health-factors\">\r\n        ${factors.slice(0, 3).map(f => `\r\n          <div class=\"factor ${f.type}\">\r\n            <span class=\"factor-icon\">${f.type === 'positive' ? '' : '!'}</span>\r\n            <span class=\"factor-text\">${f.factor}</span>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render stats grid\r\n */\r\nfunction renderStatsGrid(container: HTMLElement, data: DashboardData, onClick?: (statId: string) => void): void {\r\n  // Safe access to nested properties with defaults\r\n  const docs = data.documents || { total: 0, processed: 0, pending: 0 };\r\n  const qPriority = data.questionsByPriority || { critical: 0, high: 0, medium: 0, resolved: 0 };\r\n  const rImpact = data.risksByImpact || { high: 0, medium: 0, low: 0 };\r\n\r\n  const factsVerified = data.factsVerifiedCount ?? 0;\r\n  const stats = [\r\n    { id: 'facts', label: 'Facts', value: data.totalFacts ?? 0, sub: factsVerified > 0 ? `${factsVerified} verified` : undefined, icon: '' },\r\n    { id: 'questions', label: 'Questions', value: data.totalQuestions ?? 0, sub: `${qPriority.resolved} resolved`, icon: '' },\r\n    { id: 'decisions', label: 'Decisions', value: data.totalDecisions ?? 0, icon: '' },\r\n    { id: 'risks', label: 'Risks', value: data.totalRisks ?? 0, sub: `${rImpact.high} high`, icon: '' },\r\n    { id: 'actions', label: 'Actions', value: data.totalActions ?? 0, sub: `${data.overdueActions ?? 0} overdue`, icon: '' },\r\n  ];\r\n\r\n  container.innerHTML = stats.map(stat => `\r\n    <div class=\"stat-card\" data-stat-id=\"${stat.id}\">\r\n      <div class=\"stat-value\">${stat.value}</div>\r\n      <div class=\"stat-label\">${stat.label}</div>\r\n      ${stat.sub ? `<div class=\"stat-sub\">${stat.sub}</div>` : ''}\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind click events\r\n  if (onClick) {\r\n    container.querySelectorAll('.stat-card[data-stat-id]').forEach(card => {\r\n      card.addEventListener('click', () => {\r\n        const statId = card.getAttribute('data-stat-id');\r\n        if (statId) onClick(statId);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Render alerts\r\n */\r\nfunction renderAlerts(container: HTMLElement, alerts: Alert[], onClick?: (alert: Alert) => void): void {\r\n  container.innerHTML = `\r\n    <div class=\"alerts-header\">\r\n      <h3>Alerts</h3>\r\n      <span class=\"alerts-count\">${alerts.length}</span>\r\n    </div>\r\n    <div class=\"alerts-list\">\r\n      ${alerts.slice(0, 5).map((alert, i) => `\r\n        <div class=\"alert-item ${alert.severity}\" data-alert-index=\"${i}\">\r\n          <span class=\"alert-icon\">${getAlertIcon(alert.severity)}</span>\r\n          <div class=\"alert-content\">\r\n            <div class=\"alert-title\">${alert.title}</div>\r\n            <div class=\"alert-message\">${alert.message}</div>\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind click events\r\n  if (onClick) {\r\n    container.querySelectorAll('.alert-item').forEach(item => {\r\n      item.addEventListener('click', () => {\r\n        const index = parseInt(item.getAttribute('data-alert-index') || '0', 10);\r\n        onClick(alerts[index]);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Render insights\r\n */\r\nfunction renderInsights(container: HTMLElement, insights: Insight[], onAction?: (insight: Insight) => void): void {\r\n  // Render insights directly as horizontal cards\r\n  container.innerHTML = insights.slice(0, 4).map((insight, i) => `\r\n    <div class=\"insight-item ${insight.type}\" data-insight-index=\"${i}\">\r\n      <span class=\"insight-icon\">${insight.icon}</span>\r\n      <div class=\"insight-content\">\r\n        <div class=\"insight-title\">${insight.title}</div>\r\n        <div class=\"insight-message\">${insight.message}</div>\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n}\r\n\r\n/**\r\n * Render Risk Summary Chart (compact donut + bars)\r\n */\r\nfunction renderRiskSummary(container: HTMLElement, risks: Array<{ impact?: string; likelihood?: string; status?: string }>): void {\r\n  // Count risks by severity\r\n  const getSeverity = (impact?: string, likelihood?: string): string => {\r\n    const impactLevel = ['low', 'medium', 'high', 'critical'].indexOf(impact?.toLowerCase() || 'low');\r\n    const likelihoodLevel = ['low', 'medium', 'high'].indexOf(likelihood?.toLowerCase() || 'low');\r\n    const score = impactLevel + likelihoodLevel;\r\n    if (score >= 4) return 'critical';\r\n    if (score >= 3) return 'high';\r\n    if (score >= 2) return 'medium';\r\n    return 'low';\r\n  };\r\n\r\n  const activeRisks = risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed');\r\n  const counts = { critical: 0, high: 0, medium: 0, low: 0 };\r\n  \r\n  activeRisks.forEach(risk => {\r\n    const severity = getSeverity(risk.impact, risk.likelihood);\r\n    counts[severity as keyof typeof counts]++;\r\n  });\r\n\r\n  const total = activeRisks.length;\r\n  const mitigated = risks.length - activeRisks.length;\r\n\r\n  // Calculate percentages for donut\r\n  const getPercent = (count: number) => total > 0 ? Math.round((count / total) * 100) : 0;\r\n  \r\n  // Create conic gradient for donut\r\n  let conicStops = '';\r\n  let currentDeg = 0;\r\n  \r\n  const colors = {\r\n    critical: '#ef4444',\r\n    high: '#f97316', \r\n    medium: '#eab308',\r\n    low: '#22c55e'\r\n  };\r\n\r\n  (['critical', 'high', 'medium', 'low'] as const).forEach(level => {\r\n    const percent = getPercent(counts[level]);\r\n    const degrees = (percent / 100) * 360;\r\n    if (degrees > 0) {\r\n      conicStops += `${colors[level]} ${currentDeg}deg ${currentDeg + degrees}deg, `;\r\n      currentDeg += degrees;\r\n    }\r\n  });\r\n\r\n  // Default to gray if no risks\r\n  if (!conicStops) {\r\n    conicStops = 'var(--color-border) 0deg 360deg';\r\n  } else {\r\n    conicStops = conicStops.slice(0, -2); // Remove trailing comma\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"risk-summary\">\r\n      <div class=\"risk-summary-header\">\r\n        <h4>Risk Overview</h4>\r\n        <span class=\"risk-total\">${total} active</span>\r\n      </div>\r\n      \r\n      <div class=\"risk-summary-content\">\r\n        <div class=\"risk-donut-container\">\r\n          <div class=\"risk-donut\" style=\"background: conic-gradient(${conicStops})\">\r\n            <div class=\"risk-donut-center\">\r\n              <span class=\"donut-value\">${total}</span>\r\n              <span class=\"donut-label\">Risks</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"risk-bars\">\r\n          <div class=\"risk-bar-item critical\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Critical</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.critical)}%\"></div></div>\r\n            <span class=\"bar-count\">${counts.critical}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item high\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">High</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.high)}%\"></div></div>\r\n            <span class=\"bar-count\">${counts.high}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item medium\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Medium</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.medium)}%\"></div></div>\r\n            <span class=\"bar-count\">${counts.medium}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item low\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Low</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.low)}%\"></div></div>\r\n            <span class=\"bar-count\">${counts.low}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      ${mitigated > 0 ? `\r\n        <div class=\"risk-mitigated\">\r\n          <span class=\"mitigated-icon\"></span>\r\n          <span>${mitigated} risk${mitigated > 1 ? 's' : ''} mitigated</span>\r\n        </div>\r\n      ` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render facts by category chart\r\n */\r\nfunction renderFactsChart(data: DashboardData): void {\r\n  const container = document.getElementById('facts-chart');\r\n  if (!container) return;\r\n\r\n  const byCat = data.factsByCategory || {};\r\n  const categories = ['technical', 'process', 'policy', 'people', 'timeline', 'general'] as const;\r\n  const total = categories.reduce((sum, c) => sum + (byCat[c] ?? 0), 0);\r\n\r\n  if (total === 0) {\r\n    container.innerHTML = '<div class=\"empty-chart\">No facts yet</div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"facts-chart-title\">Facts by category</div>\r\n    <div class=\"priority-bars\">\r\n      ${categories.map(cat => {\r\n        const count = byCat[cat] ?? 0;\r\n        const pct = total > 0 ? (count / total) * 100 : 0;\r\n        return `\r\n        <div class=\"priority-bar\">\r\n          <div class=\"bar-label\">${cat}</div>\r\n          <div class=\"bar-track\">\r\n            <div class=\"bar-fill\" style=\"width: ${pct}%\"></div>\r\n          </div>\r\n          <div class=\"bar-value\">${count}</div>\r\n        </div>`;\r\n      }).join('')}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render questions by priority chart\r\n */\r\nfunction renderQuestionsPriorityChart(data: DashboardData): void {\r\n  const container = document.getElementById('questions-chart');\r\n  if (!container) return;\r\n\r\n  const { critical, high, medium, resolved } = data.questionsByPriority;\r\n  const total = critical + high + medium + resolved;\r\n  \r\n  if (total === 0) {\r\n    container.innerHTML = '<div class=\"empty-chart\">No questions yet</div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"priority-bars\">\r\n      <div class=\"priority-bar\">\r\n        <div class=\"bar-label\">Critical</div>\r\n        <div class=\"bar-track\">\r\n          <div class=\"bar-fill critical\" style=\"width: ${(critical / total) * 100}%\"></div>\r\n        </div>\r\n        <div class=\"bar-value\">${critical}</div>\r\n      </div>\r\n      <div class=\"priority-bar\">\r\n        <div class=\"bar-label\">High</div>\r\n        <div class=\"bar-track\">\r\n          <div class=\"bar-fill high\" style=\"width: ${(high / total) * 100}%\"></div>\r\n        </div>\r\n        <div class=\"bar-value\">${high}</div>\r\n      </div>\r\n      <div class=\"priority-bar\">\r\n        <div class=\"bar-label\">Medium</div>\r\n        <div class=\"bar-track\">\r\n          <div class=\"bar-fill medium\" style=\"width: ${(medium / total) * 100}%\"></div>\r\n        </div>\r\n        <div class=\"bar-value\">${medium}</div>\r\n      </div>\r\n      <div class=\"priority-bar\">\r\n        <div class=\"bar-label\">Resolved</div>\r\n        <div class=\"bar-track\">\r\n          <div class=\"bar-fill resolved\" style=\"width: ${(resolved / total) * 100}%\"></div>\r\n        </div>\r\n        <div class=\"bar-value\">${resolved}</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render weekly trends chart with real API data\r\n */\r\nasync function renderWeeklyTrendsChart(data: DashboardData): Promise<void> {\r\n  const container = document.getElementById('trends-chart');\r\n  if (!container) return;\r\n\r\n  // Show loading state\r\n  container.innerHTML = '<div class=\"loading\">Loading trends...</div>';\r\n\r\n  try {\r\n    // Fetch real trends data from API\r\n    const trendsData = await dashboardService.getTrends(7);\r\n    \r\n    if (!trendsData || !trendsData.history || trendsData.history.length === 0) {\r\n      container.innerHTML = '<div class=\"empty-chart\">No trend data available yet</div>';\r\n      return;\r\n    }\r\n\r\n    // Use real history data\r\n    const history = trendsData.history;\r\n    \r\n    // Build arrays from history\r\n    const days: string[] = [];\r\n    const trends = {\r\n      facts: [] as number[],\r\n      questions: [] as number[],\r\n      risks: [] as number[],\r\n      actions: [] as number[],\r\n    };\r\n\r\n    history.forEach(entry => {\r\n      const d = new Date(entry.date);\r\n      days.push(d.toLocaleDateString(undefined, { weekday: 'short' }));\r\n      trends.facts.push(entry.facts || 0);\r\n      trends.questions.push(entry.questions || 0);\r\n      trends.risks.push(entry.risks || 0);\r\n      trends.actions.push(entry.actions || 0);\r\n    });\r\n\r\n    const maxValue = Math.max(\r\n      ...trends.facts, \r\n      ...trends.questions, \r\n      ...trends.risks, \r\n      ...trends.actions, \r\n      1\r\n    );\r\n\r\n    container.innerHTML = `\r\n      <div class=\"trends-chart\">\r\n        <div class=\"trends-legend\">\r\n          <span class=\"legend-item\"><span class=\"legend-dot facts\"></span>Facts</span>\r\n          <span class=\"legend-item\"><span class=\"legend-dot questions\"></span>Questions</span>\r\n          <span class=\"legend-item\"><span class=\"legend-dot risks\"></span>Risks</span>\r\n          <span class=\"legend-item\"><span class=\"legend-dot actions\"></span>Actions</span>\r\n        </div>\r\n        <div class=\"trends-bars\">\r\n          ${days.map((day, i) => `\r\n            <div class=\"trend-column\">\r\n              <div class=\"trend-bars-group\">\r\n                <div class=\"trend-bar facts\" style=\"height: ${(trends.facts[i] / maxValue) * 100}%\" title=\"Facts: ${trends.facts[i]}\"></div>\r\n                <div class=\"trend-bar questions\" style=\"height: ${(trends.questions[i] / maxValue) * 100}%\" title=\"Questions: ${trends.questions[i]}\"></div>\r\n                <div class=\"trend-bar risks\" style=\"height: ${(trends.risks[i] / maxValue) * 100}%\" title=\"Risks: ${trends.risks[i]}\"></div>\r\n                <div class=\"trend-bar actions\" style=\"height: ${(trends.actions[i] / maxValue) * 100}%\" title=\"Actions: ${trends.actions[i]}\"></div>\r\n              </div>\r\n              <div class=\"trend-label\">${day}</div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  } catch (error) {\r\n    console.error('Failed to load trends:', error);\r\n    container.innerHTML = '<div class=\"error\">Failed to load trend data</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render overdue actions alert\r\n */\r\nfunction renderOverdueActionsAlert(container: HTMLElement, overdueCount: number): void {\r\n  if (overdueCount === 0) {\r\n    container.innerHTML = '';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"overdue-alert\">\r\n      <div class=\"overdue-icon\"></div>\r\n      <div class=\"overdue-content\">\r\n        <strong>${overdueCount} Overdue Action${overdueCount !== 1 ? 's' : ''}</strong>\r\n        <span>Action items past their due date require immediate attention</span>\r\n      </div>\r\n      <button class=\"btn btn-sm btn-warning\" id=\"view-overdue-btn\">View Actions</button>\r\n    </div>\r\n  `;\r\n\r\n  // Bind view button\r\n  const viewBtn = container.querySelector('#view-overdue-btn');\r\n  if (viewBtn) {\r\n    viewBtn.addEventListener('click', () => {\r\n      // Navigate to actions tab with overdue filter\r\n      window.dispatchEvent(new CustomEvent('godmode:navigate', { \r\n        detail: { tab: 'sot', view: 'actions', filter: 'overdue' }\r\n      }));\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Get alert icon based on severity\r\n */\r\nfunction getAlertIcon(severity: string): string {\r\n  switch (severity) {\r\n    case 'critical': return '';\r\n    case 'high': return '';\r\n    case 'warning': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Create a stat card element\r\n */\r\nfunction createStatCard(\r\n  config: {\r\n    id: string;\r\n    label: string;\r\n    icon: string;\r\n    getValue: (s: DashboardStats) => string | number;\r\n    subValue?: (s: DashboardStats) => string;\r\n    isScore?: boolean;\r\n  },\r\n  onClick?: (statId: string) => void\r\n): HTMLElement {\r\n  const card = createElement('div', {\r\n    className: `stat-item ${onClick ? 'clickable' : ''}`,\r\n  });\r\n  card.setAttribute('data-stat-id', config.id);\r\n\r\n  if (onClick) {\r\n    on(card, 'click', () => onClick(config.id));\r\n  }\r\n\r\n  card.innerHTML = `\r\n    <div class=\"stat-icon\">${config.icon}</div>\r\n    <div class=\"value\" data-value>-</div>\r\n    <div class=\"label\">${config.label}</div>\r\n    ${config.subValue ? '<div class=\"sub-value\" data-sub-value></div>' : ''}\r\n  `;\r\n\r\n  return card;\r\n}\r\n\r\n/**\r\n * Update dashboard with current data\r\n */\r\nfunction updateDashboard(\r\n  statsGrid: HTMLElement,\r\n  statConfigs: Array<{\r\n    id: string;\r\n    getValue: (s: DashboardStats) => string | number;\r\n    subValue?: (s: DashboardStats) => string;\r\n    isScore?: boolean;\r\n  }>\r\n): void {\r\n  const data = dataStore.getState();\r\n\r\n  // Only count active questions (not dismissed/resolved/closed)\r\n  const activeQuestions = data.questions.filter(q => \r\n    q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'closed' && q.status !== 'answered'\r\n  );\r\n  \r\n  const stats: DashboardStats = {\r\n    totalQuestions: activeQuestions.length,\r\n    answeredQuestions: data.questions.filter(q => q.status === 'answered' || q.status === 'resolved').length,\r\n    totalRisks: data.risks.length,\r\n    highPriorityRisks: data.risks.filter(r => r.impact === 'high').length,\r\n    totalActions: data.actions.length,\r\n    completedActions: data.actions.filter(a => a.status === 'completed').length,\r\n    totalDecisions: data.decisions.length,\r\n    totalContacts: data.contacts.length,\r\n    healthScore: calculateHealthScore(data),\r\n  };\r\n\r\n  statConfigs.forEach(config => {\r\n    const card = statsGrid.querySelector(`[data-stat-id=\"${config.id}\"]`);\r\n    if (!card) return;\r\n\r\n    const valueEl = card.querySelector('[data-value]');\r\n    const subValueEl = card.querySelector('[data-sub-value]');\r\n\r\n    if (valueEl) {\r\n      const value = config.getValue(stats);\r\n      valueEl.textContent = typeof value === 'number' ? formatNumber(value) : value;\r\n\r\n      // Add color for health score\r\n      if (config.isScore && typeof value === 'number') {\r\n        valueEl.className = 'value ' + getHealthClass(value);\r\n      }\r\n    }\r\n\r\n    if (subValueEl && config.subValue) {\r\n      subValueEl.textContent = config.subValue(stats);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Calculate health score from data\r\n */\r\nfunction calculateHealthScore(data: ReturnType<typeof dataStore.getState>): number {\r\n  const weights = {\r\n    questionsAnswered: 25,\r\n    risksManaged: 25,\r\n    actionsCompleted: 25,\r\n    decisionsProgress: 25,\r\n  };\r\n\r\n  let score = 0;\r\n\r\n  // Questions answered\r\n  if (data.questions.length > 0) {\r\n    const answered = data.questions.filter(q => q.status === 'answered').length;\r\n    score += (answered / data.questions.length) * weights.questionsAnswered;\r\n  } else {\r\n    score += weights.questionsAnswered;\r\n  }\r\n\r\n  // Risks managed\r\n  if (data.risks.length > 0) {\r\n    const managed = data.risks.filter(r => r.status !== 'open').length;\r\n    score += (managed / data.risks.length) * weights.risksManaged;\r\n  } else {\r\n    score += weights.risksManaged;\r\n  }\r\n\r\n  // Actions completed\r\n  if (data.actions.length > 0) {\r\n    const completed = data.actions.filter(a => a.status === 'completed').length;\r\n    score += (completed / data.actions.length) * weights.actionsCompleted;\r\n  } else {\r\n    score += weights.actionsCompleted;\r\n  }\r\n\r\n  // Decisions made\r\n  if (data.decisions.length > 0) {\r\n    const approved = data.decisions.filter(d => d.status === 'approved').length;\r\n    score += (approved / data.decisions.length) * weights.decisionsProgress;\r\n  } else {\r\n    score += weights.decisionsProgress;\r\n  }\r\n\r\n  return Math.round(score);\r\n}\r\n\r\n/**\r\n * Get CSS class for health score\r\n */\r\nfunction getHealthClass(score: number): string {\r\n  if (score >= 80) return 'excellent';\r\n  if (score >= 60) return 'good';\r\n  if (score >= 40) return 'warning';\r\n  return 'critical';\r\n}\r\n\r\n/**\r\n * Load and render project team section\r\n */\r\nasync function loadProjectTeam(container: HTMLElement, projectId: string): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\r\n    const members = response.data?.members || [];\r\n    \r\n    if (members.length === 0) {\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n\r\n    container.innerHTML = `\r\n      <style>\r\n        .team-section {\r\n          background: var(--bg-primary);\r\n          border-radius: 16px;\r\n          padding: 24px;\r\n          border: 1px solid var(--border-color);\r\n        }\r\n        \r\n        .team-section-header {\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: space-between;\r\n          margin-bottom: 20px;\r\n        }\r\n        \r\n        .team-section-header h3 {\r\n          margin: 0;\r\n          font-size: 18px;\r\n          font-weight: 600;\r\n          color: var(--text-primary);\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 10px;\r\n        }\r\n        \r\n        .team-section-header h3 svg {\r\n          color: #e11d48;\r\n        }\r\n        \r\n        .team-section-header .member-count {\r\n          background: linear-gradient(135deg, #e11d48, #be123c);\r\n          color: white;\r\n          padding: 4px 10px;\r\n          border-radius: 20px;\r\n          font-size: 12px;\r\n          font-weight: 600;\r\n        }\r\n        \r\n        .team-grid {\r\n          display: grid;\r\n          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\r\n          gap: 16px;\r\n        }\r\n        \r\n        .team-member-card {\r\n          background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.4) 100%);\r\n          border: 1px solid var(--border-color);\r\n          border-radius: 12px;\r\n          padding: 16px;\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 14px;\r\n          transition: all 0.2s ease;\r\n        }\r\n        \r\n        [data-theme=\"dark\"] .team-member-card {\r\n          background: linear-gradient(135deg, rgba(30,41,59,0.8) 0%, rgba(30,41,59,0.4) 100%);\r\n        }\r\n        \r\n        .team-member-card:hover {\r\n          transform: translateY(-2px);\r\n          box-shadow: 0 8px 24px rgba(0,0,0,0.08);\r\n          border-color: rgba(225,29,72,0.3);\r\n        }\r\n        \r\n        .team-member-avatar {\r\n          width: 52px;\r\n          height: 52px;\r\n          border-radius: 50%;\r\n          background: linear-gradient(135deg, #e11d48, #be123c);\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          font-weight: 600;\r\n          font-size: 18px;\r\n          color: white;\r\n          flex-shrink: 0;\r\n          overflow: hidden;\r\n        }\r\n        \r\n        .team-member-avatar img {\r\n          width: 100%;\r\n          height: 100%;\r\n          object-fit: cover;\r\n        }\r\n        \r\n        .team-member-avatar.owner {\r\n          background: linear-gradient(135deg, #f59e0b, #d97706);\r\n        }\r\n        \r\n        .team-member-info {\r\n          flex: 1;\r\n          min-width: 0;\r\n        }\r\n        \r\n        .team-member-info h4 {\r\n          margin: 0 0 4px 0;\r\n          font-size: 15px;\r\n          font-weight: 600;\r\n          color: var(--text-primary);\r\n          white-space: nowrap;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis;\r\n        }\r\n        \r\n        .team-member-info .role-badge {\r\n          display: inline-flex;\r\n          align-items: center;\r\n          gap: 4px;\r\n          padding: 3px 8px;\r\n          border-radius: 6px;\r\n          font-size: 11px;\r\n          font-weight: 600;\r\n          background: rgba(225,29,72,0.1);\r\n          color: #e11d48;\r\n          margin-bottom: 4px;\r\n        }\r\n        \r\n        .team-member-info .role-badge.owner {\r\n          background: rgba(245,158,11,0.15);\r\n          color: #d97706;\r\n        }\r\n        \r\n        .team-member-info .role-badge.admin {\r\n          background: rgba(59,130,246,0.1);\r\n          color: #3b82f6;\r\n        }\r\n        \r\n        .team-member-info .user-role {\r\n          font-size: 13px;\r\n          color: var(--text-secondary);\r\n          white-space: nowrap;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis;\r\n        }\r\n        \r\n        .team-member-info .linked-contact {\r\n          font-size: 11px;\r\n          color: #e11d48;\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 4px;\r\n          margin-top: 4px;\r\n        }\r\n        \r\n        .team-member-info .linked-contact svg {\r\n          width: 12px;\r\n          height: 12px;\r\n        }\r\n      </style>\r\n      \r\n      <div class=\"team-section\">\r\n        <div class=\"team-section-header\">\r\n          <h3>\r\n            <svg width=\"22\" height=\"22\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n            </svg>\r\n            Project Team\r\n          </h3>\r\n          <span class=\"member-count\">${members.length} member${members.length !== 1 ? 's' : ''}</span>\r\n        </div>\r\n        \r\n        <div class=\"team-grid\">\r\n          ${members.map(member => {\r\n            const isOwner = member.role === 'owner';\r\n            const isAdmin = member.role === 'admin';\r\n            const initials = getInitials(member.display_name || member.username || member.email || '?');\r\n            // Use linked contact avatar if member doesn't have one\r\n            const avatarUrl = member.avatar_url || member.linked_contact?.avatar_url || member.linked_contact?.photo_url;\r\n            \r\n            return `\r\n              <div class=\"team-member-card\">\r\n                <div class=\"team-member-avatar ${isOwner ? 'owner' : ''}\">\r\n                  ${avatarUrl \r\n                    ? `<img src=\"${escapeHtml(avatarUrl)}\" alt=\"${escapeHtml(member.display_name || '')}\">`\r\n                    : initials\r\n                  }\r\n                </div>\r\n                <div class=\"team-member-info\">\r\n                  <h4>${escapeHtml(member.display_name || member.username || member.email || 'Unknown')}</h4>\r\n                  <span class=\"role-badge ${isOwner ? 'owner' : isAdmin ? 'admin' : ''}\">\r\n                    ${isOwner ? ' Owner' : isAdmin ? 'Admin' : member.role === 'write' ? 'Write' : 'Read'}\r\n                  </span>\r\n                  ${member.user_role ? `<div class=\"user-role\">${escapeHtml(member.user_role)}</div>` : ''}\r\n                  ${member.linked_contact ? `\r\n                    <div class=\"linked-contact\">\r\n                      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\r\n                      </svg>\r\n                      ${escapeHtml(member.linked_contact.name)}\r\n                    </div>\r\n                  ` : ''}\r\n                </div>\r\n              </div>\r\n            `;\r\n          }).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n  } catch (error) {\r\n    console.error('Failed to load project team:', error);\r\n  }\r\n}\r\n\r\n// Types for team section\r\ninterface ProjectMember {\r\n  user_id: string;\r\n  role: string;\r\n  user_role?: string;\r\n  user_role_prompt?: string;\r\n  linked_contact_id?: string;\r\n  linked_contact?: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n    organization?: string;\r\n    avatar_url?: string;\r\n    photo_url?: string;\r\n    timezone?: string;\r\n  };\r\n  username?: string;\r\n  display_name?: string;\r\n  avatar_url?: string;\r\n  email?: string;\r\n  timezone?: string;\r\n}\r\n\r\ninterface TimezoneEntry {\r\n  name: string;\r\n  timezone: string;\r\n  type: 'member' | 'contact';\r\n  avatarUrl?: string;\r\n  localTime?: string;\r\n  localHour?: number;\r\n  isOnline?: boolean;\r\n  role?: string;\r\n  linkedContactId?: string; // For deduplication\r\n  contactId?: string; // For contacts\r\n}\r\n\r\n/**\r\n * Get local time info for a timezone\r\n */\r\nfunction getLocalTimeInfo(timezone: string): { localTime: string; localHour: number; isOnline: boolean } {\r\n  try {\r\n    const now = new Date();\r\n    const formatter = new Intl.DateTimeFormat('en-GB', {\r\n      timeZone: timezone,\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: false,\r\n    });\r\n    const localTime = formatter.format(now);\r\n    const localHour = parseInt(localTime.split(':')[0], 10);\r\n    // Consider online if between 8:00 and 18:00\r\n    const isOnline = localHour >= 8 && localHour < 18;\r\n    return { localTime, localHour, isOnline };\r\n  } catch {\r\n    return { localTime: '--:--', localHour: 12, isOnline: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Find best meeting times for all participants\r\n */\r\nfunction findBestMeetingTimes(entries: TimezoneEntry[]): { time: string; score: number; available: number }[] {\r\n  if (entries.length === 0) return [];\r\n\r\n  const suggestions: { time: string; score: number; available: number }[] = [];\r\n  const now = new Date();\r\n\r\n  // Check each hour of the day\r\n  for (let hour = 0; hour < 24; hour++) {\r\n    let available = 0;\r\n    let totalScore = 0;\r\n\r\n    for (const entry of entries) {\r\n      try {\r\n        const formatter = new Intl.DateTimeFormat('en-US', {\r\n          timeZone: entry.timezone,\r\n          hour: 'numeric',\r\n          hour12: false,\r\n        });\r\n        const localHour = parseInt(formatter.format(now), 10);\r\n        const utcHour = now.getUTCHours();\r\n        let offset = localHour - utcHour;\r\n        if (offset > 12) offset -= 24;\r\n        if (offset < -12) offset += 24;\r\n\r\n        // What hour would it be for this person?\r\n        const theirHour = (hour + offset + 24) % 24;\r\n\r\n        // Score based on how \"comfortable\" the hour is\r\n        if (theirHour >= 9 && theirHour <= 17) {\r\n          available++;\r\n          // Peak hours (10-12, 14-16) get higher score\r\n          if (theirHour >= 10 && theirHour <= 12) totalScore += 10;\r\n          else if (theirHour >= 14 && theirHour <= 16) totalScore += 10;\r\n          else totalScore += 7;\r\n        } else if (theirHour >= 8 && theirHour <= 18) {\r\n          available++;\r\n          totalScore += 4;\r\n        }\r\n      } catch { /* ignore */ }\r\n    }\r\n\r\n    if (available > 0) {\r\n      suggestions.push({\r\n        time: `${hour.toString().padStart(2, '0')}:00 UTC`,\r\n        score: totalScore,\r\n        available,\r\n      });\r\n    }\r\n  }\r\n\r\n  // Sort by number available (desc), then by score (desc)\r\n  suggestions.sort((a, b) => {\r\n    if (b.available !== a.available) return b.available - a.available;\r\n    return b.score - a.score;\r\n  });\r\n\r\n  return suggestions.slice(0, 3); // Top 3 suggestions\r\n}\r\n\r\n/**\r\n * Load Golden Hours section\r\n * Shows working hours overlap for team members and contacts\r\n */\r\nasync function loadGoldenHours(container: HTMLElement, projectId: string): Promise<void> {\r\n  try {\r\n    // Fetch team members and contacts in parallel\r\n    const [membersRes, contactsRes] = await Promise.all([\r\n      http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`).catch(() => ({ data: { members: [] } })),\r\n      http.get<{ contacts: { name: string; timezone?: string; avatarUrl?: string; photoUrl?: string; photo_url?: string; avatar_url?: string }[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\r\n    ]);\r\n\r\n    const members = membersRes.data?.members || [];\r\n    const contacts = contactsRes.data?.contacts || [];\r\n\r\n    // Extract timezone entries - use linked contact data if member doesn't have one\r\n    // Also track linked_contact_id for deduplication\r\n    const linkedContactIds = new Set<string>();\r\n    \r\n    const memberEntries = members\r\n      .map(m => {\r\n        // Check if member has linked contact with timezone and role\r\n        const linkedContact = m.linked_contact as { id?: string; timezone?: string; avatar_url?: string; photo_url?: string; role?: string } | undefined;\r\n        const tz = m.timezone || linkedContact?.timezone;\r\n        if (!tz) return null;\r\n        \r\n        const timeInfo = getLocalTimeInfo(tz);\r\n        // Use linked contact avatar if member doesn't have one\r\n        const avatarUrl = m.avatar_url || linkedContact?.avatar_url || linkedContact?.photo_url;\r\n        // Use user_role or linked contact role\r\n        const role = m.user_role || linkedContact?.role || (m.role === 'owner' ? 'Owner' : m.role === 'admin' ? 'Admin' : undefined);\r\n        \r\n        // Track linked contact id for deduplication\r\n        const linkedContactId = m.linked_contact_id || linkedContact?.id;\r\n        if (linkedContactId) {\r\n          linkedContactIds.add(linkedContactId);\r\n        }\r\n        \r\n        return {\r\n          name: m.display_name || m.username || m.email || 'Unknown',\r\n          timezone: tz,\r\n          type: 'member' as const,\r\n          avatarUrl,\r\n          role,\r\n          linkedContactId,\r\n          ...timeInfo,\r\n        } as TimezoneEntry;\r\n      })\r\n      .filter((m): m is TimezoneEntry => m !== null);\r\n\r\n    const contactEntries: TimezoneEntry[] = contacts\r\n      .filter(c => c.timezone)\r\n      .map(c => {\r\n        const timeInfo = getLocalTimeInfo(c.timezone || 'UTC');\r\n        const contactId = (c as { id?: string }).id;\r\n        return {\r\n          name: c.name,\r\n          timezone: c.timezone || 'UTC',\r\n          type: 'contact' as const,\r\n          avatarUrl: c.avatarUrl || c.photoUrl || c.photo_url || c.avatar_url,\r\n          role: (c as { role?: string }).role,\r\n          contactId,\r\n          ...timeInfo,\r\n        };\r\n      });\r\n\r\n    // If no timezone data, don't show the section\r\n    if (memberEntries.length === 0 && contactEntries.length === 0) {\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n\r\n    // Calculate golden hours for each group\r\n    const memberGolden = calculateGoldenHours(memberEntries);\r\n    const contactGolden = calculateGoldenHours(contactEntries);\r\n    \r\n    // For combined view, deduplicate: remove contacts that are already represented by team members\r\n    const deduplicatedContactEntries = contactEntries.filter(c => !c.contactId || !linkedContactIds.has(c.contactId));\r\n    const allEntries = [...memberEntries, ...deduplicatedContactEntries];\r\n    const allGolden = calculateGoldenHours(allEntries);\r\n    \r\n    // Find best meeting times\r\n    const meetingSuggestions = findBestMeetingTimes(allEntries);\r\n    \r\n    // Count online people\r\n    const onlineMembers = memberEntries.filter(m => m.isOnline).length;\r\n    const onlineContacts = contactEntries.filter(c => c.isOnline).length;\r\n    const onlineDeduplicatedContacts = deduplicatedContactEntries.filter(c => c.isOnline).length;\r\n    const onlineAll = onlineMembers + onlineDeduplicatedContacts;\r\n\r\n    container.innerHTML = `\r\n      <style>\r\n        .golden-hours-section {\r\n          background: var(--bg-primary);\r\n          border-radius: 16px;\r\n          padding: 24px;\r\n          border: 1px solid var(--border-color);\r\n          margin-bottom: 24px;\r\n        }\r\n        \r\n        .golden-hours-header {\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: space-between;\r\n          margin-bottom: 24px;\r\n        }\r\n        \r\n        .golden-hours-header h3 {\r\n          margin: 0;\r\n          font-size: 18px;\r\n          font-weight: 600;\r\n          color: var(--text-primary);\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 10px;\r\n        }\r\n        \r\n        .golden-hours-header h3 svg {\r\n          color: #f59e0b;\r\n        }\r\n        \r\n        .golden-hours-grid {\r\n          display: grid;\r\n          grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));\r\n          gap: 20px;\r\n        }\r\n        \r\n        .golden-card {\r\n          background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,250,252,0.9) 100%);\r\n          border: 1px solid var(--border-color);\r\n          border-radius: 12px;\r\n          padding: 20px;\r\n        }\r\n        \r\n        [data-theme=\"dark\"] .golden-card {\r\n          background: linear-gradient(135deg, rgba(30,41,59,0.9) 0%, rgba(30,41,59,0.6) 100%);\r\n        }\r\n        \r\n        .golden-card h4 {\r\n          margin: 0 0 16px 0;\r\n          font-size: 14px;\r\n          font-weight: 600;\r\n          color: var(--text-secondary);\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 8px;\r\n        }\r\n        \r\n        .golden-card h4 .count {\r\n          background: var(--bg-secondary);\r\n          padding: 2px 8px;\r\n          border-radius: 10px;\r\n          font-size: 12px;\r\n        }\r\n        \r\n        .timezone-bars {\r\n          display: flex;\r\n          flex-direction: column;\r\n          gap: 8px;\r\n          margin-bottom: 16px;\r\n        }\r\n        \r\n        .timezone-row {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 10px;\r\n        }\r\n        \r\n        .tz-name {\r\n          width: 100px;\r\n          font-size: 12px;\r\n          color: var(--text-secondary);\r\n          white-space: nowrap;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis;\r\n        }\r\n        \r\n        .tz-bar-container {\r\n          flex: 1;\r\n          height: 24px;\r\n          background: var(--bg-secondary);\r\n          border-radius: 4px;\r\n          position: relative;\r\n          overflow: hidden;\r\n        }\r\n        \r\n        .tz-bar {\r\n          position: absolute;\r\n          height: 100%;\r\n          border-radius: 2px;\r\n        }\r\n        \r\n        .tz-bar.work-hours {\r\n          background: linear-gradient(90deg, #10b981, #34d399);\r\n          opacity: 0.6;\r\n        }\r\n        \r\n        .tz-bar.golden {\r\n          background: linear-gradient(90deg, #f59e0b, #fbbf24);\r\n          opacity: 0.9;\r\n        }\r\n        \r\n        .hour-labels {\r\n          display: flex;\r\n          justify-content: space-between;\r\n          padding: 0 110px 0 0;\r\n          margin-bottom: 4px;\r\n        }\r\n        \r\n        .hour-label {\r\n          font-size: 10px;\r\n          color: var(--text-muted);\r\n          width: 20px;\r\n          text-align: center;\r\n        }\r\n        \r\n        .golden-summary {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 12px;\r\n          padding: 12px;\r\n          background: linear-gradient(135deg, rgba(245,158,11,0.1) 0%, rgba(251,191,36,0.05) 100%);\r\n          border-radius: 8px;\r\n          border: 1px solid rgba(245,158,11,0.2);\r\n        }\r\n        \r\n        .golden-icon {\r\n          width: 40px;\r\n          height: 40px;\r\n          background: linear-gradient(135deg, #f59e0b, #d97706);\r\n          border-radius: 50%;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          color: white;\r\n          font-size: 18px;\r\n        }\r\n        \r\n        .golden-text {\r\n          flex: 1;\r\n        }\r\n        \r\n        .golden-text .label {\r\n          font-size: 12px;\r\n          color: var(--text-secondary);\r\n        }\r\n        \r\n        .golden-text .hours {\r\n          font-size: 16px;\r\n          font-weight: 700;\r\n          color: #d97706;\r\n        }\r\n        \r\n        .no-overlap {\r\n          color: var(--text-muted);\r\n          font-size: 13px;\r\n          font-style: italic;\r\n        }\r\n        \r\n        .participants-row {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 4px;\r\n          margin-top: 12px;\r\n        }\r\n        \r\n        .participant-avatar {\r\n          width: 24px;\r\n          height: 24px;\r\n          border-radius: 50%;\r\n          background: linear-gradient(135deg, #667eea, #764ba2);\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          color: white;\r\n          font-size: 10px;\r\n          font-weight: 600;\r\n          border: 2px solid var(--bg-primary);\r\n          margin-left: -8px;\r\n        }\r\n        \r\n        .participant-avatar:first-child {\r\n          margin-left: 0;\r\n        }\r\n        \r\n        .participant-avatar img {\r\n          width: 100%;\r\n          height: 100%;\r\n          border-radius: 50%;\r\n          object-fit: cover;\r\n        }\r\n        \r\n        .participant-avatar.more {\r\n          background: var(--bg-secondary);\r\n          color: var(--text-secondary);\r\n        }\r\n        \r\n        .online-status-bar {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 16px;\r\n          padding: 16px;\r\n          background: linear-gradient(135deg, rgba(16,185,129,0.1) 0%, rgba(52,211,153,0.05) 100%);\r\n          border-radius: 12px;\r\n          border: 1px solid rgba(16,185,129,0.2);\r\n          margin-bottom: 20px;\r\n        }\r\n        \r\n        .online-indicator {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 8px;\r\n        }\r\n        \r\n        .online-dot {\r\n          width: 10px;\r\n          height: 10px;\r\n          border-radius: 50%;\r\n          background: #10b981;\r\n          box-shadow: 0 0 8px rgba(16,185,129,0.6);\r\n          animation: pulse 2s infinite;\r\n        }\r\n        \r\n        @keyframes pulse {\r\n          0%, 100% { transform: scale(1); opacity: 1; }\r\n          50% { transform: scale(1.2); opacity: 0.7; }\r\n        }\r\n        \r\n        .online-count {\r\n          font-size: 14px;\r\n          font-weight: 600;\r\n          color: #059669;\r\n        }\r\n        \r\n        .people-list {\r\n          display: flex;\r\n          flex-wrap: wrap;\r\n          gap: 12px;\r\n          margin-top: 16px;\r\n        }\r\n        \r\n        .person-chip {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 8px;\r\n          padding: 8px 12px;\r\n          background: var(--bg-secondary);\r\n          border-radius: 20px;\r\n          border: 1px solid var(--border-color);\r\n          transition: all 0.2s ease;\r\n        }\r\n        \r\n        .person-chip.online {\r\n          background: linear-gradient(135deg, rgba(16,185,129,0.1) 0%, rgba(16,185,129,0.05) 100%);\r\n          border-color: rgba(16,185,129,0.3);\r\n        }\r\n        \r\n        .person-chip.offline {\r\n          opacity: 0.6;\r\n        }\r\n        \r\n        .person-avatar-small {\r\n          width: 28px;\r\n          height: 28px;\r\n          border-radius: 50%;\r\n          background: linear-gradient(135deg, #667eea, #764ba2);\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          color: white;\r\n          font-size: 11px;\r\n          font-weight: 600;\r\n          position: relative;\r\n        }\r\n        \r\n        .person-avatar-small img {\r\n          width: 100%;\r\n          height: 100%;\r\n          border-radius: 50%;\r\n          object-fit: cover;\r\n        }\r\n        \r\n        .person-avatar-small .status-dot {\r\n          position: absolute;\r\n          bottom: -2px;\r\n          right: -2px;\r\n          width: 10px;\r\n          height: 10px;\r\n          border-radius: 50%;\r\n          border: 2px solid var(--bg-primary);\r\n        }\r\n        \r\n        .person-avatar-small .status-dot.online {\r\n          background: #10b981;\r\n        }\r\n        \r\n        .person-avatar-small .status-dot.offline {\r\n          background: #9ca3af;\r\n        }\r\n        \r\n        .person-info {\r\n          display: flex;\r\n          flex-direction: column;\r\n        }\r\n        \r\n        .person-name {\r\n          font-size: 13px;\r\n          font-weight: 500;\r\n          color: var(--text-primary);\r\n        }\r\n        \r\n        .person-time {\r\n          font-size: 11px;\r\n          color: var(--text-secondary);\r\n        }\r\n        \r\n        .person-role {\r\n          font-size: 10px;\r\n          color: #e11d48;\r\n          font-weight: 500;\r\n          margin-top: 2px;\r\n          white-space: nowrap;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis;\r\n          max-width: 120px;\r\n        }\r\n        \r\n        .meeting-suggestions {\r\n          margin-top: 20px;\r\n          padding: 16px;\r\n          background: linear-gradient(135deg, rgba(99,102,241,0.1) 0%, rgba(139,92,246,0.05) 100%);\r\n          border-radius: 12px;\r\n          border: 1px solid rgba(99,102,241,0.2);\r\n        }\r\n        \r\n        .meeting-suggestions h5 {\r\n          margin: 0 0 12px 0;\r\n          font-size: 14px;\r\n          font-weight: 600;\r\n          color: var(--text-primary);\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 8px;\r\n        }\r\n        \r\n        .meeting-suggestions h5 svg {\r\n          color: #6366f1;\r\n        }\r\n        \r\n        .suggestion-list {\r\n          display: flex;\r\n          flex-wrap: wrap;\r\n          gap: 10px;\r\n        }\r\n        \r\n        .suggestion-pill {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 8px;\r\n          padding: 8px 14px;\r\n          background: white;\r\n          border-radius: 20px;\r\n          border: 1px solid rgba(99,102,241,0.3);\r\n          font-size: 13px;\r\n          cursor: pointer;\r\n          transition: all 0.2s ease;\r\n        }\r\n        \r\n        [data-theme=\"dark\"] .suggestion-pill {\r\n          background: rgba(30,41,59,0.8);\r\n        }\r\n        \r\n        .suggestion-pill:hover {\r\n          transform: translateY(-2px);\r\n          box-shadow: 0 4px 12px rgba(99,102,241,0.2);\r\n        }\r\n        \r\n        .suggestion-pill .time {\r\n          font-weight: 600;\r\n          color: #6366f1;\r\n        }\r\n        \r\n        .suggestion-pill .availability {\r\n          font-size: 11px;\r\n          color: var(--text-secondary);\r\n          padding: 2px 6px;\r\n          background: rgba(16,185,129,0.1);\r\n          border-radius: 8px;\r\n          color: #059669;\r\n        }\r\n      </style>\r\n      \r\n      <div class=\"golden-hours-section\">\r\n        <div class=\"golden-hours-header\">\r\n          <h3>\r\n            <svg width=\"24\" height=\"24\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\"/>\r\n            </svg>\r\n            Golden Hours\r\n          </h3>\r\n          <span style=\"font-size: 13px; color: var(--text-secondary);\">\r\n            ${new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })} your time\r\n          </span>\r\n        </div>\r\n        \r\n        <div class=\"golden-hours-grid\">\r\n          <!-- Team Members Section -->\r\n          ${memberEntries.length > 0 ? `\r\n            <div class=\"golden-card\">\r\n              <h4>\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n                </svg>\r\n                Team Members\r\n                <span class=\"count\">${memberEntries.length}</span>\r\n                ${onlineMembers > 0 ? `<span style=\"margin-left: auto; font-size: 11px; color: #10b981;\"> ${onlineMembers} online</span>` : ''}\r\n              </h4>\r\n              \r\n              <!-- Team People List -->\r\n              <div class=\"people-list\" style=\"margin-bottom: 16px;\">\r\n                ${memberEntries.map(e => {\r\n                  const initials = e.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n                  return `\r\n                    <div class=\"person-chip ${e.isOnline ? 'online' : 'offline'}\">\r\n                      <div class=\"person-avatar-small\">\r\n                        ${e.avatarUrl ? `<img src=\"${escapeHtmlSimple(e.avatarUrl)}\" alt=\"${escapeHtmlSimple(e.name)}\">` : initials}\r\n                        <span class=\"status-dot ${e.isOnline ? 'online' : 'offline'}\"></span>\r\n                      </div>\r\n                      <div class=\"person-info\">\r\n                        <span class=\"person-name\">${escapeHtmlSimple(e.name)}</span>\r\n                        ${e.role ? `<span class=\"person-role\">${escapeHtmlSimple(e.role)}</span>` : ''}\r\n                        <span class=\"person-time\">${e.localTime || '--:--'} ${e.timezone.split('/').pop()?.replace(/_/g, ' ') || ''}</span>\r\n                      </div>\r\n                    </div>\r\n                  `;\r\n                }).join('')}\r\n              </div>\r\n              \r\n              ${renderTimezoneChart(memberEntries, memberGolden)}\r\n              ${renderGoldenSummary(memberGolden, memberEntries)}\r\n              \r\n              <!-- Team Meeting Suggestions -->\r\n              ${(() => {\r\n                const teamSuggestions = findBestMeetingTimes(memberEntries);\r\n                return teamSuggestions.length > 0 ? `\r\n                  <div class=\"meeting-suggestions\" style=\"margin-top: 16px;\">\r\n                    <h5>\r\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\r\n                      </svg>\r\n                      Best Times for Team\r\n                    </h5>\r\n                    <div class=\"suggestion-list\">\r\n                      ${teamSuggestions.map((s, i) => `\r\n                        <div class=\"suggestion-pill\">\r\n                          <span style=\"color: ${i === 0 ? '#f59e0b' : 'var(--text-muted)'};\">${i === 0 ? '' : ''}</span>\r\n                          <span class=\"time\">${s.time}</span>\r\n                          <span class=\"availability\">${s.available}/${memberEntries.length}</span>\r\n                        </div>\r\n                      `).join('')}\r\n                    </div>\r\n                  </div>\r\n                ` : '';\r\n              })()}\r\n            </div>\r\n          ` : ''}\r\n          \r\n          <!-- Contacts Section -->\r\n          ${contactEntries.length > 0 ? `\r\n            <div class=\"golden-card\">\r\n              <h4>\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\"/>\r\n                </svg>\r\n                Contacts\r\n                <span class=\"count\">${contactEntries.length}</span>\r\n                ${onlineContacts > 0 ? `<span style=\"margin-left: auto; font-size: 11px; color: #10b981;\"> ${onlineContacts} online</span>` : ''}\r\n              </h4>\r\n              \r\n              <!-- Contacts People List -->\r\n              <div class=\"people-list\" style=\"margin-bottom: 16px;\">\r\n                ${contactEntries.map(e => {\r\n                  const initials = e.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n                  return `\r\n                    <div class=\"person-chip ${e.isOnline ? 'online' : 'offline'}\">\r\n                      <div class=\"person-avatar-small\">\r\n                        ${e.avatarUrl ? `<img src=\"${escapeHtmlSimple(e.avatarUrl)}\" alt=\"${escapeHtmlSimple(e.name)}\">` : initials}\r\n                        <span class=\"status-dot ${e.isOnline ? 'online' : 'offline'}\"></span>\r\n                      </div>\r\n                      <div class=\"person-info\">\r\n                        <span class=\"person-name\">${escapeHtmlSimple(e.name)}</span>\r\n                        ${e.role ? `<span class=\"person-role\">${escapeHtmlSimple(e.role)}</span>` : ''}\r\n                        <span class=\"person-time\">${e.localTime || '--:--'} ${e.timezone.split('/').pop()?.replace(/_/g, ' ') || ''}</span>\r\n                      </div>\r\n                    </div>\r\n                  `;\r\n                }).join('')}\r\n              </div>\r\n              \r\n              ${renderTimezoneChart(contactEntries, contactGolden)}\r\n              ${renderGoldenSummary(contactGolden, contactEntries)}\r\n              \r\n              <!-- Contacts Meeting Suggestions -->\r\n              ${(() => {\r\n                const contactSuggestions = findBestMeetingTimes(contactEntries);\r\n                return contactSuggestions.length > 0 ? `\r\n                  <div class=\"meeting-suggestions\" style=\"margin-top: 16px;\">\r\n                    <h5>\r\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\r\n                      </svg>\r\n                      Best Times for Contacts\r\n                    </h5>\r\n                    <div class=\"suggestion-list\">\r\n                      ${contactSuggestions.map((s, i) => `\r\n                        <div class=\"suggestion-pill\">\r\n                          <span style=\"color: ${i === 0 ? '#f59e0b' : 'var(--text-muted)'};\">${i === 0 ? '' : ''}</span>\r\n                          <span class=\"time\">${s.time}</span>\r\n                          <span class=\"availability\">${s.available}/${contactEntries.length}</span>\r\n                        </div>\r\n                      `).join('')}\r\n                    </div>\r\n                  </div>\r\n                ` : '';\r\n              })()}\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n        \r\n        <!-- Combined Section (only if both exist) -->\r\n        ${memberEntries.length > 0 && contactEntries.length > 0 ? `\r\n          <div class=\"golden-card\" style=\"margin-top: 20px;\">\r\n            <h4>\r\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n              </svg>\r\n              Combined: Team + Contacts\r\n              <span class=\"count\">${allEntries.length}</span>\r\n              <span style=\"margin-left: auto; font-size: 11px; color: #10b981;\"> ${onlineAll} online</span>\r\n            </h4>\r\n            ${renderGoldenSummary(allGolden, allEntries)}\r\n            \r\n            <!-- Combined Meeting Suggestions -->\r\n            ${meetingSuggestions.length > 0 ? `\r\n              <div class=\"meeting-suggestions\" style=\"margin-top: 16px;\">\r\n                <h5>\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\r\n                  </svg>\r\n                  Best Times for Everyone\r\n                </h5>\r\n                <div class=\"suggestion-list\">\r\n                  ${meetingSuggestions.map((s, i) => `\r\n                    <div class=\"suggestion-pill\">\r\n                      <span style=\"color: ${i === 0 ? '#f59e0b' : 'var(--text-muted)'};\">${i === 0 ? '' : ''}</span>\r\n                      <span class=\"time\">${s.time}</span>\r\n                      <span class=\"availability\">${s.available}/${allEntries.length}</span>\r\n                    </div>\r\n                  `).join('')}\r\n                </div>\r\n              </div>\r\n            ` : ''}\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n  } catch (error) {\r\n    console.error('Failed to load golden hours:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Calculate golden hours (9-18 work hours overlap) for a set of timezone entries\r\n */\r\nfunction calculateGoldenHours(entries: TimezoneEntry[]): { start: number; end: number } | null {\r\n  if (entries.length === 0) return null;\r\n\r\n  // Get unique timezones\r\n  const uniqueTimezones = [...new Set(entries.map(e => e.timezone))];\r\n  \r\n  if (uniqueTimezones.length === 1) {\r\n    // All same timezone - work hours are 8-18\r\n    return { start: 8, end: 18 };\r\n  }\r\n\r\n  // Calculate UTC offsets for each timezone\r\n  const now = new Date();\r\n  const offsets: number[] = [];\r\n\r\n  for (const tz of uniqueTimezones) {\r\n    try {\r\n      const formatter = new Intl.DateTimeFormat('en-US', {\r\n        timeZone: tz,\r\n        hour: 'numeric',\r\n        hour12: false,\r\n      });\r\n      const localHour = parseInt(formatter.format(now), 10);\r\n      const utcHour = now.getUTCHours();\r\n      let offset = localHour - utcHour;\r\n      if (offset > 12) offset -= 24;\r\n      if (offset < -12) offset += 24;\r\n      offsets.push(offset);\r\n    } catch {\r\n      offsets.push(0); // Default to UTC if timezone is invalid\r\n    }\r\n  }\r\n\r\n  // Find overlap of 8-18 work hours across all timezones\r\n  // Convert each timezone's work hours to UTC, then find intersection\r\n  let overlapStart = 0;\r\n  let overlapEnd = 24;\r\n\r\n  for (const offset of offsets) {\r\n    // Work hours in UTC for this timezone\r\n    const workStartUtc = (8 - offset + 24) % 24;\r\n    const workEndUtc = (18 - offset + 24) % 24;\r\n\r\n    // Handle wraparound\r\n    if (workStartUtc < workEndUtc) {\r\n      overlapStart = Math.max(overlapStart, workStartUtc);\r\n      overlapEnd = Math.min(overlapEnd, workEndUtc);\r\n    }\r\n  }\r\n\r\n  if (overlapStart >= overlapEnd) {\r\n    return null; // No overlap\r\n  }\r\n\r\n  // Convert back to first timezone for display\r\n  const firstOffset = offsets[0];\r\n  return {\r\n    start: (overlapStart + firstOffset + 24) % 24,\r\n    end: (overlapEnd + firstOffset + 24) % 24,\r\n  };\r\n}\r\n\r\n/**\r\n * Render timezone chart showing work hours for each participant\r\n */\r\nfunction renderTimezoneChart(entries: TimezoneEntry[], golden: { start: number; end: number } | null): string {\r\n  // Get unique timezones with count\r\n  const tzCounts = new Map<string, number>();\r\n  for (const e of entries) {\r\n    tzCounts.set(e.timezone, (tzCounts.get(e.timezone) || 0) + 1);\r\n  }\r\n\r\n  const uniqueTzs = [...tzCounts.keys()].slice(0, 5); // Max 5 timezones\r\n\r\n  if (uniqueTzs.length === 0) {\r\n    return '<div class=\"no-overlap\">No timezone data available</div>';\r\n  }\r\n\r\n  const now = new Date();\r\n\r\n  return `\r\n    <div class=\"hour-labels\">\r\n      ${[0, 6, 12, 18, 24].map(h => `<span class=\"hour-label\">${h}</span>`).join('')}\r\n    </div>\r\n    <div class=\"timezone-bars\">\r\n      ${uniqueTzs.map(tz => {\r\n        // Calculate work hours position (9-18)\r\n        let offset = 0;\r\n        try {\r\n          const formatter = new Intl.DateTimeFormat('en-US', {\r\n            timeZone: tz,\r\n            hour: 'numeric',\r\n            hour12: false,\r\n          });\r\n          const localHour = parseInt(formatter.format(now), 10);\r\n          const utcHour = now.getUTCHours();\r\n          offset = localHour - utcHour;\r\n          if (offset > 12) offset -= 24;\r\n          if (offset < -12) offset += 24;\r\n        } catch { /* ignore */ }\r\n\r\n        // Work hours 9-18 in this timezone\r\n        const workStart = 9;\r\n        const workEnd = 18;\r\n        const workLeft = ((workStart) / 24) * 100;\r\n        const workWidth = ((workEnd - workStart) / 24) * 100;\r\n\r\n        // Display name\r\n        const displayTz = tz.split('/').pop()?.replace(/_/g, ' ') || tz;\r\n        const count = tzCounts.get(tz) || 1;\r\n\r\n        return `\r\n          <div class=\"timezone-row\">\r\n            <span class=\"tz-name\" title=\"${tz}\">${displayTz} ${count > 1 ? `(${count})` : ''}</span>\r\n            <div class=\"tz-bar-container\">\r\n              <div class=\"tz-bar work-hours\" style=\"left: ${workLeft}%; width: ${workWidth}%;\"></div>\r\n              ${golden ? `<div class=\"tz-bar golden\" style=\"left: ${(golden.start / 24) * 100}%; width: ${((golden.end - golden.start) / 24) * 100}%;\"></div>` : ''}\r\n            </div>\r\n          </div>\r\n        `;\r\n      }).join('')}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render golden hours summary\r\n */\r\nfunction renderGoldenSummary(golden: { start: number; end: number } | null, entries: TimezoneEntry[]): string {\r\n  if (!golden) {\r\n    return `\r\n      <div class=\"golden-summary\" style=\"background: linear-gradient(135deg, rgba(239,68,68,0.1) 0%, rgba(239,68,68,0.05) 100%); border-color: rgba(239,68,68,0.2);\">\r\n        <div class=\"golden-icon\" style=\"background: linear-gradient(135deg, #ef4444, #dc2626);\"></div>\r\n        <div class=\"golden-text\">\r\n          <div class=\"label\">No overlap found</div>\r\n          <div class=\"hours\" style=\"color: #dc2626;\">Timezones too far apart</div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  const formatHour = (h: number) => `${h.toString().padStart(2, '0')}:00`;\r\n  const duration = golden.end - golden.start;\r\n\r\n  // Show participant avatars\r\n  const maxAvatars = 5;\r\n  const showEntries = entries.slice(0, maxAvatars);\r\n  const moreCount = entries.length - maxAvatars;\r\n\r\n  return `\r\n    <div class=\"golden-summary\">\r\n      <div class=\"golden-icon\"></div>\r\n      <div class=\"golden-text\">\r\n        <div class=\"label\">Golden Hours</div>\r\n        <div class=\"hours\">${formatHour(golden.start)} - ${formatHour(golden.end)} (${duration}h overlap)</div>\r\n      </div>\r\n    </div>\r\n    <div class=\"participants-row\">\r\n      ${showEntries.map(e => {\r\n        const initials = e.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n        return `\r\n          <div class=\"participant-avatar\" title=\"${escapeHtmlSimple(e.name)}\">\r\n            ${e.avatarUrl ? `<img src=\"${escapeHtmlSimple(e.avatarUrl)}\" alt=\"${escapeHtmlSimple(e.name)}\">` : initials}\r\n          </div>\r\n        `;\r\n      }).join('')}\r\n      ${moreCount > 0 ? `<div class=\"participant-avatar more\">+${moreCount}</div>` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction escapeHtmlSimple(str: string): string {\r\n  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\r\n}\r\n\r\n// Helper functions\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(/\\s+/)\r\n    .map(part => part[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2) || '?';\r\n}\r\n\r\nfunction escapeHtml(str: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = str;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Mount dashboard to container\r\n */\r\nexport function mountDashboard(selector: string, props: DashboardProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`Dashboard: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const dashboard = createDashboard(props);\r\n  container.appendChild(dashboard);\r\n  return dashboard;\r\n}\r\n\r\nexport default createDashboard;\r\n","/**\r\n * Chat Component\r\n * AI chat interface with multiple sessions, persistence, and contact pills\r\n */\r\n\r\nimport { createElement, on, scrollIntoView } from '../utils/dom';\r\nimport { dataStore, ChatMessage, ChatSource, ChatRAGInfo } from '../stores/data';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\ninterface ChatSession {\r\n  id: string;\r\n  title: string;\r\n  context_contact_id?: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\ninterface ContactOption {\r\n  id: string;\r\n  name: string;\r\n  role?: string;\r\n  organization?: string;\r\n}\r\n\r\ninterface ChatAPIResponse {\r\n  success: boolean;\r\n  response: string;\r\n  sessionId?: string;\r\n  model?: string;\r\n  provider?: string;\r\n  confidence?: 'high' | 'medium' | 'low';\r\n  contextQuality?: string;\r\n  queryType?: string;\r\n  sources?: ChatSource[];\r\n  rag?: ChatRAGInfo;\r\n}\r\n\r\nexport interface ChatProps {\r\n  onSend?: (message: string) => Promise<void>;\r\n  placeholder?: string;\r\n  showSources?: boolean;\r\n  showSessions?: boolean; // Show sidebar with multiple conversations\r\n}\r\n\r\n/**\r\n * Create chat component\r\n */\r\nexport function createChat(props: ChatProps = {}): HTMLElement {\r\n  const showSessions = props.showSessions !== false;\r\n  \r\n  const chat = createElement('div', { className: 'chat-layout' });\r\n\r\n  // State for multiple sessions\r\n  let currentSessionId: string | null = null;\r\n  let sessions: ChatSession[] = [];\r\n  let contacts: ContactOption[] = [];\r\n\r\n  // Sidebar (sessions list)\r\n  const sidebar = createElement('div', { className: 'chat-sidebar' });\r\n  const newChatBtn = createElement('button', { \r\n    className: 'chat-new-conversation',\r\n    innerHTML: `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/></svg> Nova conversa`\r\n  });\r\n  const newChatContextWrap = createElement('div', { className: 'chat-new-context-wrap' });\r\n  const newChatContextLabel = createElement('span', { className: 'chat-new-context-label', textContent: 'Como quem?' });\r\n  const newChatContextSelect = createElement('select', { className: 'chat-new-context-select' }) as HTMLSelectElement;\r\n  newChatContextWrap.appendChild(newChatContextLabel);\r\n  newChatContextWrap.appendChild(newChatContextSelect);\r\n  const sessionsList = createElement('div', { className: 'chat-sessions-list' });\r\n  sidebar.appendChild(newChatBtn);\r\n  sidebar.appendChild(newChatContextWrap);\r\n  sidebar.appendChild(sessionsList);\r\n\r\n  // Main area\r\n  const mainArea = createElement('div', { className: 'chat-main' });\r\n  const chatContainer = createElement('div', { className: 'chat-container' });\r\n\r\n  // Chat header: \"Como quem?\" context selector\r\n  const chatHeader = createElement('div', { className: 'chat-header' });\r\n  const contextLabel = createElement('label', { className: 'chat-context-label', textContent: 'Como quem?' });\r\n  const contextSelect = createElement('select', { className: 'chat-context-select' }) as HTMLSelectElement;\r\n  chatHeader.appendChild(contextLabel);\r\n  chatHeader.appendChild(contextSelect);\r\n\r\n  async function loadContacts(): Promise<void> {\r\n    try {\r\n      const res = await http.get<{ contacts?: Array<{ id: string; name: string; role?: string; organization?: string }> }>('/api/contacts');\r\n      contacts = res.data?.contacts || [];\r\n      renderContextSelect();\r\n    } catch {\r\n      contacts = [];\r\n    }\r\n  }\r\n\r\n  function renderContextSelect(): void {\r\n    const currentSession = sessions.find(s => s.id === currentSessionId);\r\n    const currentContextId = currentSession?.context_contact_id || null;\r\n    contextSelect.innerHTML = `<option value=\"\">Sem contexto</option>${contacts.map(c => `<option value=\"${c.id}\" ${c.id === currentContextId ? 'selected' : ''}>${escapeHtml(c.name)}${c.role ? ` - ${c.role}` : ''}${c.organization ? ` (${c.organization})` : ''}</option>`).join('')}`;\r\n    contextSelect.disabled = !currentSessionId;\r\n  }\r\n\r\n  function renderNewChatContextSelect(): void {\r\n    newChatContextSelect.innerHTML = `<option value=\"\">Sem contexto</option>${contacts.map(c => `<option value=\"${c.id}\">${escapeHtml(c.name)}${c.role ? ` - ${c.role}` : ''}${c.organization ? ` (${c.organization})` : ''}</option>`).join('')}`;\r\n  }\r\n\r\n  async function onContextChange(): Promise<void> {\r\n    if (!currentSessionId) return;\r\n    const contactId = contextSelect.value || null;\r\n    try {\r\n      await http.put(`/api/chat/sessions/${currentSessionId}`, { contextContactId: contactId });\r\n      const idx = sessions.findIndex(s => s.id === currentSessionId);\r\n      if (idx !== -1) sessions[idx] = { ...sessions[idx], context_contact_id: contactId };\r\n      toast.success('Contexto actualizado');\r\n    } catch (e) {\r\n      toast.error('Falha ao actualizar contexto');\r\n      console.error('[Chat] Update context error:', e);\r\n      renderContextSelect();\r\n    }\r\n  }\r\n\r\n  // Messages container\r\n  const messagesContainer = createElement('div', { className: 'chat-messages' });\r\n\r\n  // Input container\r\n  const inputContainer = createElement('div', { className: 'chat-input-container' });\r\n\r\n  const input = createElement('textarea', {\r\n    className: 'chat-input',\r\n    placeholder: props.placeholder || 'Ask a question about your project...',\r\n  }) as HTMLTextAreaElement;\r\n\r\n  const sendBtn = createElement('button', {\r\n    className: 'chat-send-btn',\r\n    innerHTML: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z\"/>\r\n    </svg>`,\r\n  });\r\n\r\n  // Auto-resize textarea\r\n  on(input, 'input', () => {\r\n    input.style.height = 'auto';\r\n    input.style.height = Math.min(input.scrollHeight, 120) + 'px';\r\n  });\r\n\r\n  // Send on Enter (Shift+Enter for new line)\r\n  on(input, 'keydown', (e) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSend();\r\n    }\r\n  });\r\n\r\n  // Send button click\r\n  on(sendBtn, 'click', handleSend);\r\n\r\n  let isLoading = false;\r\n\r\n  async function loadSessions(): Promise<void> {\r\n    try {\r\n      const res = await http.get<{ ok: boolean; sessions?: ChatSession[] }>('/api/chat/sessions');\r\n      sessions = res.data?.sessions || [];\r\n      renderSessionsList();\r\n    } catch {\r\n      sessions = [];\r\n    }\r\n  }\r\n\r\n  function renderSessionsList(): void {\r\n    sessionsList.innerHTML = sessions.map(s => `\r\n      <button class=\"chat-session-item ${s.id === currentSessionId ? 'active' : ''}\" data-session-id=\"${s.id}\">\r\n        <span class=\"session-title\">${escapeHtml(s.title.length > 40 ? s.title.substring(0, 37) + '...' : s.title)}</span>\r\n        <span class=\"session-date\">${formatRelativeTime(s.updated_at)}</span>\r\n      </button>\r\n    `).join('');\r\n    sessionsList.querySelectorAll('.chat-session-item').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => selectSession((btn as HTMLElement).getAttribute('data-session-id')!));\r\n    });\r\n  }\r\n\r\n  async function loadMessages(sessionId: string): Promise<void> {\r\n    try {\r\n      const res = await http.get<{ ok: boolean; messages?: Array<{ id: string; role: string; content: string; sources?: ChatSource[]; metadata?: Record<string, unknown>; created_at: string }> }>(`/api/chat/sessions/${sessionId}/messages`);\r\n      const msgs = res.data?.messages || [];\r\n      dataStore.setChatHistory(msgs.map(m => ({\r\n        id: m.id,\r\n        role: m.role as 'user' | 'assistant' | 'system',\r\n        content: m.content,\r\n        timestamp: m.created_at,\r\n        sources: m.sources,\r\n        ...(m.metadata?.queryType && { queryType: m.metadata.queryType as string }),\r\n        ...(m.metadata?.confidence && { confidence: m.metadata.confidence as 'high' | 'medium' | 'low' })\r\n      })));\r\n    } catch {\r\n      dataStore.setChatHistory([]);\r\n    }\r\n  }\r\n\r\n  async function selectSession(sessionId: string): Promise<void> {\r\n    currentSessionId = sessionId;\r\n    renderSessionsList();\r\n    dataStore.clearChatHistory();\r\n    await loadMessages(sessionId);\r\n    messagesContainer.innerHTML = '';\r\n    dataStore.getState().chatHistory.forEach(msg => renderMessage(msg, messagesContainer, props.showSources));\r\n  }\r\n\r\n  async function createNewSession(contextContactId?: string | null): Promise<void> {\r\n    try {\r\n      const res = await http.post<{ ok: boolean; session?: { id: string; title?: string; context_contact_id?: string | null; created_at?: string; updated_at?: string } }>('/api/chat/sessions', { title: 'Nova conversa', contextContactId: contextContactId || null });\r\n      const session = res.data?.session;\r\n      if (session) {\r\n        sessions.unshift({\r\n          id: session.id,\r\n          title: session.title || 'Nova conversa',\r\n          context_contact_id: session.context_contact_id ?? null,\r\n          created_at: session.created_at || new Date().toISOString(),\r\n          updated_at: session.updated_at || new Date().toISOString()\r\n        });\r\n        await selectSession(session.id);\r\n        renderSessionsList();\r\n      }\r\n    } catch (e) {\r\n      toast.error('Failed to create new conversation');\r\n      console.error('[Chat] Create session error:', e);\r\n    }\r\n  }\r\n\r\n  async function handleSend(): Promise<void> {\r\n    const message = input.value.trim();\r\n    if (!message || isLoading) return;\r\n\r\n    input.value = '';\r\n    input.style.height = 'auto';\r\n    isLoading = true;\r\n    sendBtn.setAttribute('disabled', 'true');\r\n\r\n    // Add user message\r\n    const userMessage: ChatMessage = {\r\n      id: `msg-${Date.now()}`,\r\n      role: 'user',\r\n      content: message,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n    dataStore.addChatMessage(userMessage);\r\n    renderMessage(userMessage, messagesContainer);\r\n\r\n    // Show loading\r\n    const loadingEl = createElement('div', { className: 'chat-loading' });\r\n    loadingEl.innerHTML = `\r\n      <div class=\"chat-loading-dots\">\r\n        <span></span><span></span><span></span>\r\n      </div>\r\n      <span>Thinking...</span>\r\n    `;\r\n    messagesContainer.appendChild(loadingEl);\r\n    scrollToBottom(messagesContainer);\r\n\r\n    try {\r\n      if (props.onSend) {\r\n        await props.onSend(message);\r\n      } else {\r\n        const response = await http.post<ChatAPIResponse>('/api/chat', {\r\n          message,\r\n          history: dataStore.getState().chatHistory.slice(-10),\r\n          sessionId: currentSessionId,\r\n        });\r\n\r\n        const assistantMessage: ChatMessage = {\r\n          id: `msg-${Date.now()}`,\r\n          role: 'assistant',\r\n          content: response.data.response,\r\n          timestamp: new Date().toISOString(),\r\n          sources: response.data.sources,\r\n          queryType: response.data.queryType,\r\n          confidence: response.data.confidence,\r\n          contextQuality: response.data.contextQuality,\r\n          rag: response.data.rag,\r\n        };\r\n        dataStore.addChatMessage(assistantMessage);\r\n        renderMessage(assistantMessage, messagesContainer, props.showSources);\r\n\r\n        // Update current session if backend created one\r\n        if (response.data.sessionId && !currentSessionId) {\r\n          currentSessionId = response.data.sessionId;\r\n          await loadSessions();\r\n          renderSessionsList();\r\n          renderContextSelect();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      const errorMessage: ChatMessage = {\r\n        id: `msg-${Date.now()}`,\r\n        role: 'system',\r\n        content: 'Failed to get response. Please try again.',\r\n        timestamp: new Date().toISOString(),\r\n      };\r\n      renderMessage(errorMessage, messagesContainer);\r\n    } finally {\r\n      loadingEl.remove();\r\n      isLoading = false;\r\n      sendBtn.removeAttribute('disabled');\r\n      input.focus();\r\n    }\r\n  }\r\n\r\n  inputContainer.appendChild(input);\r\n  inputContainer.appendChild(sendBtn);\r\n\r\n  // Quick prompts\r\n  const quickPrompts = createElement('div', { className: 'quick-prompts' });\r\n  const prompts = [\r\n    'Summarize key risks',\r\n    'List open questions',\r\n    'What actions are overdue?',\r\n    'Who are the key contacts?',\r\n  ];\r\n\r\n  prompts.forEach(prompt => {\r\n    const btn = createElement('button', {\r\n      className: 'quick-prompt',\r\n      textContent: prompt,\r\n    });\r\n    on(btn, 'click', () => {\r\n      input.value = prompt;\r\n      handleSend();\r\n    });\r\n    quickPrompts.appendChild(btn);\r\n  });\r\n\r\n  // Layout assembly\r\n  on(contextSelect, 'change', onContextChange);\r\n  chatContainer.appendChild(chatHeader);\r\n  chatContainer.appendChild(messagesContainer);\r\n  chatContainer.appendChild(quickPrompts);\r\n  chatContainer.appendChild(inputContainer);\r\n  mainArea.appendChild(chatContainer);\r\n\r\n  if (showSessions) {\r\n    chat.appendChild(sidebar);\r\n    on(newChatBtn as HTMLElement, 'click', createNewSession);\r\n    loadContacts().then(() => renderNewChatContextSelect());\r\n    loadSessions();\r\n  } else {\r\n    chatHeader.style.display = 'none';\r\n  }\r\n  chat.appendChild(mainArea);\r\n\r\n  // Render existing messages (from dataStore - may be empty initially)\r\n  const existingMessages = dataStore.getState().chatHistory;\r\n  existingMessages.forEach(msg => renderMessage(msg, messagesContainer, props.showSources));\r\n\r\n  return chat;\r\n}\r\n\r\n/**\r\n * Render a chat message with SOTA RAG info\r\n */\r\nfunction renderMessage(\r\n  message: ChatMessage,\r\n  container: HTMLElement,\r\n  showSources = true\r\n): HTMLElement {\r\n  const msgEl = createElement('div', {\r\n    className: `chat-message ${message.role}`,\r\n  });\r\n\r\n  let content = escapeHtml(message.content);\r\n\r\n  // Parse markdown-like formatting\r\n  content = content\r\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\r\n    .replace(/`(.*?)`/g, '<code>$1</code>')\r\n    .replace(/\\n/g, '<br>');\r\n\r\n  msgEl.innerHTML = `<div class=\"chat-message-content\">${content}</div>`;\r\n\r\n  // Add RAG metadata badge for assistant messages\r\n  if (message.role === 'assistant' && (message.confidence || message.rag)) {\r\n    const metaEl = createElement('div', { className: 'chat-meta' });\r\n    const confidenceClass = message.confidence === 'high' ? 'confidence-high' : \r\n                            message.confidence === 'medium' ? 'confidence-medium' : 'confidence-low';\r\n    \r\n    let metaHtml = '';\r\n    \r\n    // Confidence badge\r\n    if (message.confidence) {\r\n      metaHtml += `<span class=\"chat-badge ${confidenceClass}\" title=\"Confidence level\">${message.confidence}</span>`;\r\n    }\r\n    \r\n    // Query type badge\r\n    if (message.queryType) {\r\n      metaHtml += `<span class=\"chat-badge query-type\" title=\"Query classification\">${message.queryType}</span>`;\r\n    }\r\n    \r\n    // RAG method badge\r\n    if (message.rag) {\r\n      const methodLabel = message.rag.usedHyDE ? 'HyDE+RRF' : \r\n                          message.rag.graphResults > 0 ? 'Graph+Vector' : 'Hybrid';\r\n      metaHtml += `<span class=\"chat-badge rag-method\" title=\"RAG method: ${message.rag.method}\">${methodLabel}</span>`;\r\n      \r\n      // Sources count\r\n      const totalSources = message.rag.fusedResults || (message.rag.vectorResults + message.rag.graphResults);\r\n      if (totalSources > 0) {\r\n        metaHtml += `<span class=\"chat-badge sources-count\" title=\"Sources found\">${totalSources} sources</span>`;\r\n      }\r\n    }\r\n    \r\n    metaEl.innerHTML = metaHtml;\r\n    msgEl.appendChild(metaEl);\r\n  }\r\n\r\n  // Add detailed sources if present\r\n  if (showSources && message.sources && message.sources.length > 0) {\r\n    const sourcesEl = createElement('div', { className: 'chat-sources' });\r\n    \r\n    // Handle both string[] (legacy) and ChatSource[] (SOTA) formats\r\n    if (typeof message.sources[0] === 'string') {\r\n      // Legacy format\r\n      sourcesEl.innerHTML = `\r\n        <span class=\"sources-label\">Sources:</span>\r\n        ${(message.sources as string[]).map(s => `<span class=\"source-link\">${escapeHtml(s)}</span>`).join('')}\r\n      `;\r\n    } else {\r\n      // SOTA format with detailed sources and contact pills\r\n      const sources = message.sources as ChatSource[];\r\n      const contactSources = sources.filter(s => s.contactName);\r\n      const otherSources = sources.filter(s => !s.contactName);\r\n      const topSources = otherSources.slice(0, 5);\r\n\r\n      // Contact pills (avatar + name + role)\r\n      if (contactSources.length > 0) {\r\n        const pillsEl = createElement('div', { className: 'chat-contact-pills' });\r\n        pillsEl.innerHTML = contactSources.map(s => `\r\n          <div class=\"contact-pill\">\r\n            ${s.avatarUrl ? `<img class=\"contact-pill-avatar\" src=\"${escapeHtml(s.avatarUrl)}\" alt=\"\" onerror=\"this.style.display='none'\"/>` : `<div class=\"contact-pill-avatar-placeholder\">${escapeHtml((s.contactName || s.type || '?')[0])}</div>`}\r\n            <div class=\"contact-pill-info\">\r\n              <span class=\"contact-pill-name\">${escapeHtml(s.contactName || s.type || 'Contact')}</span>\r\n              ${s.contactRole ? `<span class=\"contact-pill-role\">${escapeHtml(s.contactRole)}</span>` : ''}\r\n            </div>\r\n          </div>\r\n        `).join('');\r\n        msgEl.appendChild(pillsEl);\r\n      }\r\n      \r\n      sourcesEl.innerHTML = `\r\n        <details class=\"sources-details\">\r\n          <summary class=\"sources-label\">\r\n            <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polyline points=\"9 18 15 12 9 6\"></polyline>\r\n            </svg>\r\n            ${sources.length} sources used\r\n          </summary>\r\n          <div class=\"sources-list\">\r\n            ${topSources.map(s => `\r\n              <div class=\"source-item\">\r\n                <span class=\"source-type\">${escapeHtml(s.type || 'unknown')}</span>\r\n                <span class=\"source-score\" title=\"Relevance score\">${Math.round((s.rrfScore || s.score || 0) * 100)}%</span>\r\n                ${s.sourceCount && s.sourceCount > 1 ? `<span class=\"source-multi\" title=\"Found in multiple searches\">x${s.sourceCount}</span>` : ''}\r\n                ${s.source ? `<span class=\"source-from\">${escapeHtml(s.source)}</span>` : ''}\r\n              </div>\r\n            `).join('')}\r\n            ${sources.length > 5 ? `<div class=\"sources-more\">+${sources.length - 5} more</div>` : ''}\r\n          </div>\r\n        </details>\r\n      `;\r\n    }\r\n    msgEl.appendChild(sourcesEl);\r\n  }\r\n\r\n  container.appendChild(msgEl);\r\n  scrollToBottom(container);\r\n\r\n  return msgEl;\r\n}\r\n\r\n/**\r\n * Scroll container to bottom\r\n */\r\nfunction scrollToBottom(container: HTMLElement): void {\r\n  container.scrollTop = container.scrollHeight;\r\n}\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Mount chat to container\r\n */\r\nexport function mountChat(selector: string, props: ChatProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`Chat: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const chat = createChat(props);\r\n  container.appendChild(chat);\r\n  return chat;\r\n}\r\n\r\nexport default createChat;\r\n","/**\r\n * Question Detail View\r\n * Full-page view for question details, replacing the panel when a card is clicked\r\n * Features: timeline, contact picker, answer suggestions, follow-up chain, entity display\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Question, questionsService } from '../../services/questions';\r\nimport { contactsService, Contact } from '../../services/contacts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\r\nimport { http } from '../../services/api';\r\n\r\nexport interface QuestionDetailViewProps {\r\n  question: Question;\r\n  onClose: () => void;\r\n  onUpdate?: (question: Question) => void;\r\n  onNavigateToQuestion?: (questionId: string) => void;\r\n}\r\n\r\ninterface QuestionChain {\r\n  parent: Question | null;\r\n  children: Question[];\r\n}\r\n\r\ninterface TimelineEvent {\r\n  id: string;\r\n  event_type: string;\r\n  event_data: Record<string, unknown>;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface PotentialAnswer {\r\n  type: 'fact' | 'decision';\r\n  id: string;\r\n  content: string;\r\n  confidence: number;\r\n  source?: string;\r\n}\r\n\r\ninterface SimilarQuestion {\r\n  id: string;\r\n  content: string;\r\n  status: string;\r\n  priority: string;\r\n  similarityScore: number;\r\n}\r\n\r\nlet currentQuestion: Question | null = null;\r\nlet contacts: Contact[] = [];\r\n\r\n/**\r\n * Create and show the question detail view\r\n */\r\nexport function createQuestionDetailView(props: QuestionDetailViewProps): HTMLElement {\r\n  const { question, onClose, onUpdate, onNavigateToQuestion } = props;\r\n  currentQuestion = question;\r\n\r\n  const container = createElement('div', { className: 'question-detail-view' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Questions</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Question #${String(question.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        ${question.sla_breached ? '<span class=\"sla-badge breached\">SLA Breached</span>' : ''}\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content\">\r\n      <!-- Main Question Card -->\r\n      <section class=\"detail-section question-main\">\r\n        <div class=\"question-badges\">\r\n          <span class=\"priority-badge priority-${question.priority}\">${question.priority}</span>\r\n          <span class=\"status-badge status-${question.status}\">${question.status}</span>\r\n          ${question.requester_role ? `\r\n            <div class=\"requester-badge-full\" title=\"Question from the perspective of this role\">\r\n              <div class=\"requester-avatar-sm\">${getInitials((question as any).requester_name || question.requester_role)}</div>\r\n              <div class=\"requester-text\">\r\n                ${(question as any).requester_name ? `<span class=\"requester-name-sm\">${escapeHtml((question as any).requester_name)}</span>` : ''}\r\n                <span class=\"requester-role-sm\">${escapeHtml(question.requester_role)}</span>\r\n              </div>\r\n            </div>\r\n          ` : ''}\r\n          <span class=\"question-date\">Created ${formatRelativeTime(question.created_at)}</span>\r\n        </div>\r\n        <h2 class=\"question-text\">${escapeHtml(question.content)}</h2>\r\n        ${question.context ? `<p class=\"question-context\">${escapeHtml(question.context)}</p>` : ''}\r\n        ${renderEntities(question)}\r\n      </section>\r\n\r\n      <!-- Two-column layout -->\r\n      <div class=\"detail-columns\">\r\n        <div class=\"detail-column-left\">\r\n          <!-- Assignment Section - SOTA Design -->\r\n          <section class=\"detail-section\" id=\"assignment-section\">\r\n            <div class=\"section-header-sota\">\r\n              <h3>\r\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Assignment\r\n                <span class=\"section-subtitle\">Who should answer this question?</span>\r\n              </h3>\r\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"ai-suggest-btn\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n                </svg>\r\n                AI Suggest\r\n              </button>\r\n            </div>\r\n            \r\n            <!-- Current Assignment Display -->\r\n            <div id=\"current-assignment\" class=\"current-assignment-card\">\r\n              ${question.assigned_to ? `\r\n                <div class=\"assigned-contact-display\">\r\n                  <div class=\"contact-avatar-lg\" id=\"assigned-avatar\">\r\n                    ${getInitials(question.assigned_to)}\r\n                  </div>\r\n                  <div class=\"contact-details\">\r\n                    <div class=\"contact-name-lg\">${escapeHtml(question.assigned_to)}</div>\r\n                    <div class=\"contact-role-sm\" id=\"assigned-role\">Loading...</div>\r\n                  </div>\r\n                  <button class=\"btn-change-assignment\" id=\"change-assignee-btn\">\r\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/>\r\n                    </svg>\r\n                    Change\r\n                  </button>\r\n                </div>\r\n              ` : `\r\n                <div class=\"no-assignment\">\r\n                  <div class=\"no-assignment-icon\">\r\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\r\n                    </svg>\r\n                  </div>\r\n                  <span>No one assigned to answer</span>\r\n                  <p class=\"no-assignment-hint\">Use AI Suggest to find the best person</p>\r\n                  <button class=\"btn-assign-now\" id=\"show-picker-btn\">Choose Manually</button>\r\n                </div>\r\n              `}\r\n            </div>\r\n            \r\n            <!-- Contact Picker (hidden by default) -->\r\n            <div id=\"contact-picker\" class=\"contact-picker-sota\" style=\"display: none;\">\r\n              <div class=\"picker-search\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/>\r\n                </svg>\r\n                <input type=\"text\" id=\"contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"contact-list\" class=\"contact-list-grid\">\r\n                <div class=\"loading\">Loading contacts...</div>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- Hidden select for form submission -->\r\n            <select id=\"assignee-select\" class=\"form-select\" style=\"display: none;\">\r\n              <option value=\"\">Select contact...</option>\r\n            </select>\r\n            \r\n            <!-- AI Suggestions Panel -->\r\n            <div id=\"suggestions-panel\" class=\"suggestions-panel-sota\" style=\"display: none;\"></div>\r\n          </section>\r\n\r\n          <!-- Potential Answers Section -->\r\n          <section class=\"detail-section\" id=\"answers-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Potential Answers</h3>\r\n              <button class=\"btn btn-secondary btn-sm\" id=\"check-answers-btn\">\r\n                Check Knowledge Base\r\n              </button>\r\n            </div>\r\n            <div id=\"potential-answers\" class=\"potential-answers\">\r\n              <p class=\"empty-state\">Click \"Check Knowledge Base\" to find potential answers</p>\r\n            </div>\r\n          </section>\r\n\r\n          <!-- Answer Form Section -->\r\n          <section class=\"detail-section\" id=\"answer-section\">\r\n            <h3>${question.answer ? 'Current Answer' : 'Your Answer'}</h3>\r\n            ${question.answer ? renderExistingAnswer(question) : ''}\r\n            <div class=\"answer-form\" ${question.status === 'resolved' ? 'style=\"display:none;\"' : ''}>\r\n              <div class=\"form-group\">\r\n                <textarea id=\"answer-input\" rows=\"4\" \r\n                  placeholder=\"Type your answer here...\">${question.answer || ''}</textarea>\r\n              </div>\r\n              <div class=\"form-row answer-form-row\">\r\n                <div class=\"form-group source-group\">\r\n                  <label>Source</label>\r\n                  <div class=\"source-options\">\r\n                    <label class=\"source-option ${question.answer_source === 'manual' || !question.answer_source ? 'active' : ''}\">\r\n                      <input type=\"radio\" name=\"answer-source\" value=\"manual\" ${question.answer_source === 'manual' || !question.answer_source ? 'checked' : ''}>\r\n                      <span class=\"source-icon\"></span>\r\n                      <span class=\"source-label\">Manual</span>\r\n                    </label>\r\n                    <label class=\"source-option ${question.answer_source === 'document' ? 'active' : ''}\">\r\n                      <input type=\"radio\" name=\"answer-source\" value=\"document\" ${question.answer_source === 'document' ? 'checked' : ''}>\r\n                      <span class=\"source-icon\"></span>\r\n                      <span class=\"source-label\">Document</span>\r\n                    </label>\r\n                    <label class=\"source-option ${question.answer_source === 'ai' ? 'active' : ''}\">\r\n                      <input type=\"radio\" name=\"answer-source\" value=\"ai\" ${question.answer_source === 'ai' ? 'checked' : ''}>\r\n                      <span class=\"source-icon\"></span>\r\n                      <span class=\"source-label\">AI</span>\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n                <div class=\"form-group answered-by-group\">\r\n                  <label>Answered By</label>\r\n                  <div class=\"answered-by-picker\">\r\n                    <div id=\"answered-by-display\" class=\"answered-by-display\">\r\n                      ${question.answered_by_contact_id || question.answered_by_name ? `\r\n                        <div class=\"answered-by-card\" id=\"current-answerer\">\r\n                          <div class=\"answerer-avatar\" id=\"answerer-avatar\">${getInitials(question.answered_by_name || '')}</div>\r\n                          <span class=\"answerer-name\">${escapeHtml(question.answered_by_name || 'Contact')}</span>\r\n                          <button type=\"button\" class=\"btn-clear-answerer\" id=\"clear-answerer\"></button>\r\n                        </div>\r\n                      ` : `\r\n                        <button type=\"button\" class=\"btn-select-answerer\" id=\"show-answerer-picker\">\r\n                          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                          </svg>\r\n                          Select who answered...\r\n                        </button>\r\n                      `}\r\n                    </div>\r\n                    <!-- Hidden select for form -->\r\n                    <select id=\"answered-by-contact\" class=\"form-select\" style=\"display: none;\">\r\n                      <option value=\"\">Select who answered...</option>\r\n                    </select>\r\n                    <!-- Contact picker dropdown -->\r\n                    <div id=\"answerer-picker-dropdown\" class=\"answerer-picker-dropdown\" style=\"display: none;\">\r\n                      <div class=\"picker-search-sm\">\r\n                        <input type=\"text\" id=\"answerer-search\" placeholder=\"Search contacts...\">\r\n                      </div>\r\n                      <div id=\"answerer-list\" class=\"answerer-list\"></div>\r\n                      <div class=\"answerer-other\">\r\n                        <input type=\"text\" id=\"answerer-other-name\" placeholder=\"Or type a name...\">\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <label>Follow-up Questions (one per line)</label>\r\n                <textarea id=\"followup-input\" rows=\"2\" \r\n                  placeholder=\"Add any follow-up questions...\"></textarea>\r\n              </div>\r\n              <div class=\"form-actions\">\r\n                <button class=\"btn btn-primary\" id=\"save-answer-btn\">\r\n                  ${question.answer ? 'Update Answer' : 'Save Answer'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </section>\r\n        </div>\r\n\r\n        <div class=\"detail-column-right\">\r\n          <!-- Follow-up Chain Section -->\r\n          <section class=\"detail-section\" id=\"chain-section\">\r\n            <h3>Follow-up Chain</h3>\r\n            <div id=\"chain-content\" class=\"chain-content\">\r\n              <div class=\"loading\">Loading...</div>\r\n            </div>\r\n          </section>\r\n\r\n          <!-- Similar Questions Section -->\r\n          <section class=\"detail-section\" id=\"similar-section\">\r\n            <h3>Similar Questions</h3>\r\n            <div id=\"similar-content\" class=\"similar-content\">\r\n              <div class=\"loading\">Loading...</div>\r\n            </div>\r\n          </section>\r\n\r\n          <!-- Timeline Section -->\r\n          <section class=\"detail-section\" id=\"timeline-section\">\r\n            <h3>Timeline</h3>\r\n            <div id=\"timeline-content\" class=\"timeline-content\">\r\n              <div class=\"loading\">Loading...</div>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n\r\n    <!-- Actions Bar - Outside scrollable content for proper click handling -->\r\n    <div class=\"detail-actions\">\r\n      ${question.status === 'resolved' || question.status === 'dismissed' ? `\r\n        <button class=\"btn btn-warning\" id=\"reopen-btn\">Reopen</button>\r\n      ` : ''}\r\n      ${question.status === 'deferred' ? `\r\n        <button class=\"btn btn-info\" id=\"undefer-btn\">Resume Now</button>\r\n      ` : `\r\n        <button class=\"btn btn-secondary\" id=\"defer-btn\">Defer</button>\r\n      `}\r\n      ${question.was_useful === undefined && question.answer ? `\r\n        <div class=\"feedback-buttons\">\r\n          <span class=\"feedback-label\">Was this helpful?</span>\r\n          <button class=\"btn btn-sm btn-success\" id=\"feedback-yes\">Yes</button>\r\n          <button class=\"btn btn-sm btn-secondary\" id=\"feedback-no\">No</button>\r\n        </div>\r\n      ` : ''}\r\n      <button class=\"btn btn-secondary\" id=\"edit-btn\">Edit</button>\r\n      <div class=\"dropdown dismiss-dropdown\">\r\n        <button class=\"btn btn-danger\" id=\"dismiss-btn\">Dismiss </button>\r\n        <div class=\"dropdown-menu\" id=\"dismiss-menu\">\r\n          <a href=\"#\" data-reason=\"duplicate\">Duplicate</a>\r\n          <a href=\"#\" data-reason=\"not_relevant\">Not Relevant</a>\r\n          <a href=\"#\" data-reason=\"out_of_scope\">Out of Scope</a>\r\n          <a href=\"#\" data-reason=\"answered_elsewhere\">Answered Elsewhere</a>\r\n          <a href=\"#\" data-reason=\"no_longer_needed\">No Longer Needed</a>\r\n          <a href=\"#\" data-reason=\"other\">Other...</a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  bindEvents(container, props);\r\n\r\n  // Load async data\r\n  loadContacts(container);\r\n  loadChain(container, question.id, onNavigateToQuestion);\r\n  loadSimilar(container, question.id, onNavigateToQuestion);\r\n  loadTimeline(container, question.id);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Render extracted entities as tags\r\n */\r\nfunction renderEntities(question: Question): string {\r\n  const entities = question.extracted_entities || [];\r\n  const topics = question.extracted_topics || [];\r\n  \r\n  if (entities.length === 0 && topics.length === 0) {\r\n    return '';\r\n  }\r\n\r\n  const tags = [\r\n    ...entities.map(e => `<span class=\"entity-tag entity-${e.type}\">@${e.name}</span>`),\r\n    ...topics.map(t => `<span class=\"entity-tag entity-topic\">#${t.name}</span>`)\r\n  ];\r\n\r\n  return `<div class=\"question-entities\">${tags.join('')}</div>`;\r\n}\r\n\r\n/**\r\n * Get initials from name\r\n */\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  if (parts.length === 1) {\r\n    return parts[0].substring(0, 2).toUpperCase();\r\n  }\r\n  return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\n/**\r\n * Get avatar HTML for a contact\r\n */\r\nfunction getContactAvatar(contact: { name: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string }): string {\r\n  const photoUrl = contact.photoUrl || contact.avatarUrl || contact.photo_url || contact.avatar_url;\r\n  if (photoUrl) {\r\n    return `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\" onerror=\"this.style.display='none'; this.nextElementSibling.style.display='flex';\">\r\n            <span class=\"avatar-fallback\" style=\"display:none;\">${getInitials(contact.name)}</span>`;\r\n  }\r\n  return getInitials(contact.name);\r\n}\r\n\r\n/**\r\n * Get score color based on value\r\n */\r\nfunction getScoreColor(score: number): string {\r\n  if (score >= 75) return '#10b981'; // green\r\n  if (score >= 50) return '#f59e0b'; // amber\r\n  return '#6b7280'; // gray\r\n}\r\n\r\n/**\r\n * Render existing answer display\r\n */\r\nfunction renderExistingAnswer(question: Question): string {\r\n  if (!question.answer) return '';\r\n\r\n  return `\r\n    <div class=\"existing-answer\">\r\n      <div class=\"answer-text\">${escapeHtml(question.answer)}</div>\r\n      <div class=\"answer-meta\">\r\n        <span class=\"answer-source-badge\">${question.answer_source || 'manual'}</span>\r\n        ${question.answered_by_name ? `<span class=\"answered-by\">by ${escapeHtml(question.answered_by_name)}</span>` : ''}\r\n        ${question.answered_at ? `<span class=\"answered-date\">${formatRelativeTime(question.answered_at)}</span>` : ''}\r\n      </div>\r\n      ${question.answer_provenance ? renderProvenance(question.answer_provenance) : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render answer provenance chain\r\n */\r\nfunction renderProvenance(provenance: { sources?: Array<{ type: string; content: string; confidence: number }> }): string {\r\n  if (!provenance.sources || provenance.sources.length === 0) return '';\r\n\r\n  const sources = provenance.sources.map(s => `\r\n    <div class=\"provenance-source\">\r\n      <span class=\"source-type\">${s.type}</span>\r\n      <span class=\"source-content\">${escapeHtml(s.content.substring(0, 100))}...</span>\r\n      <span class=\"source-confidence\">${Math.round(s.confidence * 100)}%</span>\r\n    </div>\r\n  `).join('');\r\n\r\n  return `\r\n    <div class=\"answer-provenance\">\r\n      <div class=\"provenance-label\">Sources:</div>\r\n      ${sources}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind all event handlers\r\n */\r\nfunction bindEvents(container: HTMLElement, props: QuestionDetailViewProps): void {\r\n  const { onClose, onUpdate } = props;\r\n\r\n  // Close button\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  // Back to list link\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n\r\n  // AI Suggest button\r\n  const aiSuggestBtn = container.querySelector('#ai-suggest-btn');\r\n  if (aiSuggestBtn) {\r\n    on(aiSuggestBtn as HTMLElement, 'click', () => loadAISuggestions(container));\r\n  }\r\n\r\n  // Check answers button\r\n  const checkAnswersBtn = container.querySelector('#check-answers-btn');\r\n  if (checkAnswersBtn) {\r\n    on(checkAnswersBtn as HTMLElement, 'click', () => checkPotentialAnswers(container));\r\n  }\r\n\r\n  // Save answer button\r\n  const saveAnswerBtn = container.querySelector('#save-answer-btn');\r\n  if (saveAnswerBtn) {\r\n    on(saveAnswerBtn as HTMLElement, 'click', () => saveAnswer(container, onUpdate));\r\n  }\r\n\r\n  // Reopen button\r\n  const reopenBtn = container.querySelector('#reopen-btn');\r\n  if (reopenBtn) {\r\n    on(reopenBtn as HTMLElement, 'click', () => reopenQuestion(container, onUpdate));\r\n  }\r\n\r\n  // Dismiss button and dropdown\r\n  const dismissBtn = container.querySelector('#dismiss-btn');\r\n  const dismissMenu = container.querySelector('#dismiss-menu');\r\n  console.log('[QuestionDetail] Dismiss btn found:', !!dismissBtn, 'Menu found:', !!dismissMenu);\r\n  \r\n  if (dismissBtn && dismissMenu) {\r\n    on(dismissBtn as HTMLElement, 'click', (e) => {\r\n      console.log('[QuestionDetail] Dismiss button clicked');\r\n      e.stopPropagation();\r\n      dismissMenu.classList.toggle('show');\r\n    });\r\n    \r\n    // Dismiss reasons\r\n    const reasonLinks = dismissMenu.querySelectorAll('a[data-reason]');\r\n    console.log('[QuestionDetail] Dismiss reason links:', reasonLinks.length);\r\n    \r\n    reasonLinks.forEach(link => {\r\n      on(link as HTMLElement, 'click', async (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const reason = link.getAttribute('data-reason') as 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other';\r\n        console.log('[QuestionDetail] Dismiss reason clicked:', reason);\r\n        dismissMenu.classList.remove('show');\r\n        \r\n        let details: string | undefined;\r\n        if (reason === 'other') {\r\n          details = prompt('Please provide a reason for dismissing this question:') || undefined;\r\n          if (!details) return;\r\n        }\r\n        \r\n        try {\r\n          console.log('[QuestionDetail] Calling dismissQuestionWithReason...');\r\n          await dismissQuestionWithReason(container, props, reason, details);\r\n          console.log('[QuestionDetail] Dismiss completed');\r\n        } catch (err) {\r\n          console.error('[QuestionDetail] Dismiss error:', err);\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Close dropdown on outside click\r\n    document.addEventListener('click', (e) => {\r\n      if (!(e.target as HTMLElement).closest('.dismiss-dropdown')) {\r\n        dismissMenu.classList.remove('show');\r\n      }\r\n    });\r\n  } else {\r\n    console.warn('[QuestionDetail] Dismiss button or menu not found!');\r\n  }\r\n\r\n  // Defer button\r\n  const deferBtn = container.querySelector('#defer-btn');\r\n  if (deferBtn) {\r\n    on(deferBtn as HTMLElement, 'click', () => showDeferDialog(container, onUpdate));\r\n  }\r\n\r\n  // Undefer button\r\n  const undeferBtn = container.querySelector('#undefer-btn');\r\n  if (undeferBtn) {\r\n    on(undeferBtn as HTMLElement, 'click', () => reopenQuestion(container, onUpdate));\r\n  }\r\n\r\n  // Feedback buttons\r\n  const feedbackYes = container.querySelector('#feedback-yes');\r\n  const feedbackNo = container.querySelector('#feedback-no');\r\n  if (feedbackYes) {\r\n    on(feedbackYes as HTMLElement, 'click', () => submitFeedback(container, true, onUpdate));\r\n  }\r\n  if (feedbackNo) {\r\n    on(feedbackNo as HTMLElement, 'click', () => submitFeedback(container, false, onUpdate));\r\n  }\r\n\r\n  // Edit button\r\n  const editBtn = container.querySelector('#edit-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => toggleEditMode(container));\r\n  }\r\n}\r\n\r\n/**\r\n * Load contacts for dropdowns\r\n */\r\nasync function loadContacts(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await contactsService.getAll();\r\n    contacts = response?.contacts || [];\r\n    \r\n    const assigneeSelect = container.querySelector('#assignee-select') as HTMLSelectElement;\r\n    const answeredBySelect = container.querySelector('#answered-by-contact') as HTMLSelectElement;\r\n    const contactList = container.querySelector('#contact-list') as HTMLElement;\r\n    const contactSearch = container.querySelector('#contact-search') as HTMLInputElement;\r\n\r\n    // Populate hidden select for form\r\n    if (assigneeSelect) {\r\n      for (const contact of contacts) {\r\n        const option = document.createElement('option');\r\n        option.value = contact.id;\r\n        option.textContent = `${contact.name}${contact.role ? ` (${contact.role})` : ''}`;\r\n        if (currentQuestion?.assigned_to === contact.name) {\r\n          option.selected = true;\r\n        }\r\n        assigneeSelect.appendChild(option);\r\n      }\r\n    }\r\n\r\n    // Populate answered by select\r\n    if (answeredBySelect) {\r\n      for (const contact of contacts) {\r\n        const option = document.createElement('option');\r\n        option.value = contact.id;\r\n        option.textContent = `${contact.name}${contact.role ? ` (${contact.role})` : ''}`;\r\n        if (currentQuestion?.answered_by_contact_id === contact.id) {\r\n          option.selected = true;\r\n        }\r\n        answeredBySelect.appendChild(option);\r\n      }\r\n      \r\n      // Add \"Other\" option for external\r\n      const otherOption = document.createElement('option');\r\n      otherOption.value = '__other__';\r\n      otherOption.textContent = '+ Other (type name)';\r\n      answeredBySelect.appendChild(otherOption);\r\n    }\r\n\r\n    // Render SOTA contact picker grid\r\n    if (contactList) {\r\n      renderContactGrid(container, contacts);\r\n      \r\n      // Bind search\r\n      if (contactSearch) {\r\n        contactSearch.addEventListener('input', () => {\r\n          const query = contactSearch.value.toLowerCase();\r\n          const filtered = contacts.filter(c => \r\n            c.name.toLowerCase().includes(query) ||\r\n            (c.role && c.role.toLowerCase().includes(query)) ||\r\n            (c.organization && c.organization.toLowerCase().includes(query))\r\n          );\r\n          renderContactGrid(container, filtered);\r\n        });\r\n      }\r\n    }\r\n    \r\n    // Update assigned contact avatar display\r\n    updateAssignedDisplay(container);\r\n    \r\n    // Bind picker toggle buttons\r\n    bindPickerButtons(container);\r\n    \r\n    // Setup answerer picker\r\n    setupAnswererPicker(container);\r\n    \r\n    // Setup source options\r\n    setupSourceOptions(container);\r\n    \r\n  } catch (e) {\r\n    console.error('Error loading contacts:', e);\r\n  }\r\n}\r\n\r\n/**\r\n * Setup the answerer picker functionality\r\n */\r\nfunction setupAnswererPicker(container: HTMLElement): void {\r\n  const showBtn = container.querySelector('#show-answerer-picker');\r\n  const dropdown = container.querySelector('#answerer-picker-dropdown') as HTMLElement;\r\n  const answererList = container.querySelector('#answerer-list') as HTMLElement;\r\n  const answererSearch = container.querySelector('#answerer-search') as HTMLInputElement;\r\n  const answererOtherInput = container.querySelector('#answerer-other-name') as HTMLInputElement;\r\n  \r\n  if (!dropdown || !answererList) return;\r\n  \r\n  // Render contacts in answerer list\r\n  const renderAnswererList = (filter = '') => {\r\n    const filtered = filter \r\n      ? contacts.filter(c => \r\n          c.name.toLowerCase().includes(filter.toLowerCase()) ||\r\n          (c.role && c.role.toLowerCase().includes(filter.toLowerCase()))\r\n        )\r\n      : contacts;\r\n    \r\n    answererList.innerHTML = filtered.map(contact => {\r\n      const photoUrl = contact.photoUrl || contact.avatarUrl || contact.photo_url || contact.avatar_url;\r\n      return `\r\n        <div class=\"answerer-item\" data-contact-id=\"${contact.id}\" data-contact-name=\"${escapeHtml(contact.name)}\">\r\n          <div class=\"answerer-avatar-sm\">\r\n            ${photoUrl \r\n              ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(contact.name)}'\">`\r\n              : getInitials(contact.name)\r\n            }\r\n          </div>\r\n          <div class=\"answerer-info\">\r\n            <span class=\"answerer-name\">${escapeHtml(contact.name)}</span>\r\n            ${contact.role ? `<span class=\"answerer-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n    \r\n    // Bind click handlers\r\n    answererList.querySelectorAll('.answerer-item').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        const contactId = item.getAttribute('data-contact-id');\r\n        const contactName = item.getAttribute('data-contact-name');\r\n        selectAnswerer(container, contactId || '', contactName || '');\r\n        dropdown.style.display = 'none';\r\n      });\r\n    });\r\n  };\r\n  \r\n  // Show picker\r\n  if (showBtn) {\r\n    on(showBtn as HTMLElement, 'click', () => {\r\n      dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';\r\n      renderAnswererList();\r\n      if (answererSearch) answererSearch.focus();\r\n    });\r\n  }\r\n  \r\n  // Search filter\r\n  if (answererSearch) {\r\n    answererSearch.addEventListener('input', () => {\r\n      renderAnswererList(answererSearch.value);\r\n    });\r\n  }\r\n  \r\n  // Other name input\r\n  if (answererOtherInput) {\r\n    answererOtherInput.addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter') {\r\n        const name = answererOtherInput.value.trim();\r\n        if (name) {\r\n          selectAnswerer(container, '', name);\r\n          dropdown.style.display = 'none';\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Clear button\r\n  const clearBtn = container.querySelector('#clear-answerer');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      selectAnswerer(container, '', '');\r\n    });\r\n  }\r\n  \r\n  // Close on outside click\r\n  document.addEventListener('click', (e) => {\r\n    const target = e.target as HTMLElement;\r\n    if (!target.closest('.answered-by-picker') && dropdown.style.display === 'block') {\r\n      dropdown.style.display = 'none';\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Select an answerer\r\n */\r\nfunction selectAnswerer(container: HTMLElement, contactId: string, contactName: string): void {\r\n  const display = container.querySelector('#answered-by-display') as HTMLElement;\r\n  const select = container.querySelector('#answered-by-contact') as HTMLSelectElement;\r\n  \r\n  if (select) {\r\n    select.value = contactId;\r\n  }\r\n  \r\n  if (display) {\r\n    if (contactName) {\r\n      const contact = contacts.find(c => c.id === contactId);\r\n      const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\r\n      \r\n      display.innerHTML = `\r\n        <div class=\"answered-by-card\" id=\"current-answerer\">\r\n          <div class=\"answerer-avatar\">\r\n            ${photoUrl \r\n              ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contactName)}\" onerror=\"this.parentElement.innerHTML='${getInitials(contactName)}'\">`\r\n              : getInitials(contactName)\r\n            }\r\n          </div>\r\n          <span class=\"answerer-name\">${escapeHtml(contactName)}</span>\r\n          <button type=\"button\" class=\"btn-clear-answerer\" id=\"clear-answerer\"></button>\r\n        </div>\r\n      `;\r\n      \r\n      // Re-bind clear button\r\n      const clearBtn = display.querySelector('#clear-answerer');\r\n      if (clearBtn) {\r\n        on(clearBtn as HTMLElement, 'click', (e) => {\r\n          e.stopPropagation();\r\n          selectAnswerer(container, '', '');\r\n        });\r\n      }\r\n    } else {\r\n      display.innerHTML = `\r\n        <button type=\"button\" class=\"btn-select-answerer\" id=\"show-answerer-picker\">\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n          </svg>\r\n          Select who answered...\r\n        </button>\r\n      `;\r\n      \r\n      // Re-setup picker\r\n      setupAnswererPicker(container);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Setup source option radio buttons\r\n */\r\nfunction setupSourceOptions(container: HTMLElement): void {\r\n  const sourceOptions = container.querySelectorAll('.source-option input[type=\"radio\"]');\r\n  \r\n  sourceOptions.forEach(input => {\r\n    input.addEventListener('change', () => {\r\n      // Update active state\r\n      container.querySelectorAll('.source-option').forEach(opt => opt.classList.remove('active'));\r\n      (input as HTMLElement).closest('.source-option')?.classList.add('active');\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render contact grid with cards\r\n */\r\nfunction renderContactGrid(container: HTMLElement, contactsToRender: typeof contacts): void {\r\n  const contactList = container.querySelector('#contact-list') as HTMLElement;\r\n  if (!contactList) return;\r\n  \r\n  if (contactsToRender.length === 0) {\r\n    contactList.innerHTML = '<div class=\"empty-state\">No contacts found</div>';\r\n    return;\r\n  }\r\n  \r\n  contactList.innerHTML = contactsToRender.map(contact => {\r\n    const photoUrl = contact.photoUrl || contact.avatarUrl || contact.photo_url || contact.avatar_url;\r\n    const isCurrentAssignee = currentQuestion?.assigned_to === contact.name;\r\n    \r\n    return `\r\n      <div class=\"contact-card-picker ${isCurrentAssignee ? 'selected' : ''}\" data-contact-id=\"${contact.id}\" data-contact-name=\"${escapeHtml(contact.name)}\">\r\n        <div class=\"contact-avatar-picker\">\r\n          ${photoUrl \r\n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(contact.name)}'\">`\r\n            : getInitials(contact.name)\r\n          }\r\n        </div>\r\n        <div class=\"contact-info-picker\">\r\n          <div class=\"contact-name-picker\">${escapeHtml(contact.name)}</div>\r\n          ${contact.role ? `<div class=\"contact-role-picker\">${escapeHtml(contact.role)}</div>` : ''}\r\n          ${contact.organization ? `<div class=\"contact-org-picker\">${escapeHtml(contact.organization)}</div>` : ''}\r\n        </div>\r\n        ${isCurrentAssignee ? '<div class=\"current-badge\">Current</div>' : ''}\r\n      </div>\r\n    `;\r\n  }).join('');\r\n  \r\n  // Bind click handlers\r\n  contactList.querySelectorAll('.contact-card-picker').forEach(card => {\r\n    on(card as HTMLElement, 'click', async () => {\r\n      const contactId = card.getAttribute('data-contact-id');\r\n      const contactName = card.getAttribute('data-contact-name');\r\n      const assigneeSelect = container.querySelector('#assignee-select') as HTMLSelectElement;\r\n      const picker = container.querySelector('#contact-picker') as HTMLElement;\r\n      \r\n      if (contactId && assigneeSelect && currentQuestion) {\r\n        assigneeSelect.value = contactId;\r\n        \r\n        // Save to server FIRST\r\n        try {\r\n          await questionsService.update(currentQuestion.id, {\r\n            assigned_to: contactName || undefined,\r\n            status: 'assigned'\r\n          });\r\n          \r\n          // Update current question state\r\n          currentQuestion.assigned_to = contactName || undefined;\r\n          currentQuestion.status = 'assigned';\r\n          \r\n          // Update display\r\n          updateAssignedDisplay(container);\r\n          \r\n          // Hide picker\r\n          if (picker) {\r\n            picker.style.display = 'none';\r\n          }\r\n          \r\n          toast.success(`Assigned to ${contactName}`);\r\n        } catch (e) {\r\n          console.error('[QuestionDetail] Failed to save assignment:', e);\r\n          toast.error('Failed to save assignment');\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Update assigned contact display\r\n */\r\nfunction updateAssignedDisplay(container: HTMLElement): void {\r\n  const display = container.querySelector('#current-assignment') as HTMLElement;\r\n  if (!display || !currentQuestion) return;\r\n  \r\n  if (currentQuestion.assigned_to) {\r\n    const contact = contacts.find(c => c.name === currentQuestion?.assigned_to);\r\n    const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\r\n    \r\n    display.innerHTML = `\r\n      <div class=\"assigned-contact-display\">\r\n        <div class=\"contact-avatar-lg\">\r\n          ${photoUrl \r\n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(currentQuestion.assigned_to)}\" onerror=\"this.parentElement.innerHTML='${getInitials(currentQuestion.assigned_to)}'\">`\r\n            : getInitials(currentQuestion.assigned_to)\r\n          }\r\n        </div>\r\n        <div class=\"contact-details\">\r\n          <div class=\"contact-name-lg\">${escapeHtml(currentQuestion.assigned_to)}</div>\r\n          <div class=\"contact-role-sm\">${contact?.role || 'Team Member'}</div>\r\n          ${contact?.organization ? `<div class=\"contact-org-sm\">${escapeHtml(contact.organization)}</div>` : ''}\r\n        </div>\r\n        <button class=\"btn-change-assignment\" id=\"change-assignee-btn\">\r\n          <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/>\r\n          </svg>\r\n          Change\r\n        </button>\r\n      </div>\r\n    `;\r\n  } else {\r\n    display.innerHTML = `\r\n      <div class=\"no-assignment\">\r\n        <div class=\"no-assignment-icon\">\r\n          <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\r\n          </svg>\r\n        </div>\r\n        <span>No one assigned yet</span>\r\n        <button class=\"btn-assign-now\" id=\"show-picker-btn\">Assign Someone</button>\r\n      </div>\r\n    `;\r\n  }\r\n  \r\n  // Re-bind picker buttons\r\n  bindPickerButtons(container);\r\n}\r\n\r\n/**\r\n * Bind picker toggle buttons\r\n */\r\nfunction bindPickerButtons(container: HTMLElement): void {\r\n  const showPickerBtn = container.querySelector('#show-picker-btn');\r\n  const changeBtn = container.querySelector('#change-assignee-btn');\r\n  const picker = container.querySelector('#contact-picker') as HTMLElement;\r\n  \r\n  if (showPickerBtn && picker) {\r\n    on(showPickerBtn as HTMLElement, 'click', () => {\r\n      picker.style.display = picker.style.display === 'none' ? 'block' : 'none';\r\n      const searchInput = picker.querySelector('#contact-search') as HTMLInputElement;\r\n      if (searchInput) {\r\n        searchInput.focus();\r\n      }\r\n    });\r\n  }\r\n  \r\n  if (changeBtn && picker) {\r\n    on(changeBtn as HTMLElement, 'click', () => {\r\n      picker.style.display = picker.style.display === 'none' ? 'block' : 'none';\r\n      const searchInput = picker.querySelector('#contact-search') as HTMLInputElement;\r\n      if (searchInput) {\r\n        searchInput.focus();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Load question chain (parent + children)\r\n */\r\nasync function loadChain(\r\n  container: HTMLElement, \r\n  questionId: string | number,\r\n  onNavigate?: (id: string) => void\r\n): Promise<void> {\r\n  const chainContent = container.querySelector('#chain-content');\r\n  if (!chainContent) return;\r\n\r\n  try {\r\n    const response = await http.get<{ parent: Question | null; children: Question[] }>(\r\n      `/api/questions/${questionId}/chain`\r\n    );\r\n    const { parent, children } = response.data;\r\n\r\n    if (!parent && children.length === 0) {\r\n      chainContent.innerHTML = '<p class=\"empty-state\">No follow-up chain</p>';\r\n      return;\r\n    }\r\n\r\n    let html = '';\r\n\r\n    if (parent) {\r\n      html += `\r\n        <div class=\"chain-item chain-parent\" data-id=\"${parent.id}\">\r\n          <span class=\"chain-arrow\"></span>\r\n          <span class=\"chain-label\">Parent:</span>\r\n          <span class=\"chain-content\">${escapeHtml(parent.content.substring(0, 50))}...</span>\r\n          <span class=\"status-badge status-${parent.status}\">${parent.status}</span>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    html += `<div class=\"chain-item chain-current\">This question</div>`;\r\n\r\n    for (const child of children) {\r\n      html += `\r\n        <div class=\"chain-item chain-child\" data-id=\"${child.id}\">\r\n          <span class=\"chain-arrow\"></span>\r\n          <span class=\"chain-content\">${escapeHtml(child.content.substring(0, 50))}...</span>\r\n          <span class=\"status-badge status-${child.status}\">${child.status}</span>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    chainContent.innerHTML = html;\r\n\r\n    // Bind click handlers for navigation\r\n    chainContent.querySelectorAll('.chain-item[data-id]').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        const id = item.getAttribute('data-id');\r\n        if (id && onNavigate) {\r\n          onNavigate(id);\r\n        }\r\n      });\r\n    });\r\n  } catch (e) {\r\n    chainContent.innerHTML = '<p class=\"error\">Failed to load chain</p>';\r\n  }\r\n}\r\n\r\n/**\r\n * Load similar questions\r\n */\r\nasync function loadSimilar(\r\n  container: HTMLElement, \r\n  questionId: string | number,\r\n  onNavigate?: (id: string) => void\r\n): Promise<void> {\r\n  const similarContent = container.querySelector('#similar-content');\r\n  if (!similarContent) return;\r\n\r\n  try {\r\n    const response = await http.get<{ similar: SimilarQuestion[] }>(\r\n      `/api/questions/${questionId}/similar?limit=5`\r\n    );\r\n    const { similar } = response.data;\r\n\r\n    if (!similar || similar.length === 0) {\r\n      similarContent.innerHTML = '<p class=\"empty-state\">No similar questions found</p>';\r\n      return;\r\n    }\r\n\r\n    const html = similar.map(q => `\r\n      <div class=\"similar-item\" data-id=\"${q.id}\">\r\n        <div class=\"similar-content\">${escapeHtml(q.content.substring(0, 60))}...</div>\r\n        <div class=\"similar-meta\">\r\n          <span class=\"status-badge status-${q.status}\">${q.status}</span>\r\n          <span class=\"similarity-score\">${Math.round(q.similarityScore * 100)}%</span>\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n\r\n    similarContent.innerHTML = html;\r\n\r\n    // Bind click handlers\r\n    similarContent.querySelectorAll('.similar-item').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        const id = item.getAttribute('data-id');\r\n        if (id && onNavigate) {\r\n          onNavigate(id);\r\n        }\r\n      });\r\n    });\r\n  } catch (e) {\r\n    similarContent.innerHTML = '<p class=\"error\">Failed to load similar questions</p>';\r\n  }\r\n}\r\n\r\n/**\r\n * Load timeline events\r\n */\r\nasync function loadTimeline(container: HTMLElement, questionId: string | number): Promise<void> {\r\n  const timelineContent = container.querySelector('#timeline-content');\r\n  if (!timelineContent) return;\r\n\r\n  try {\r\n    const response = await http.get<{ events: TimelineEvent[] }>(\r\n      `/api/questions/${questionId}/timeline`\r\n    );\r\n    const { events } = response.data;\r\n\r\n    if (!events || events.length === 0) {\r\n      timelineContent.innerHTML = '<p class=\"empty-state\">No events recorded</p>';\r\n      return;\r\n    }\r\n\r\n    const html = events.map(e => {\r\n      const icon = getEventIcon(e.event_type);\r\n      const description = getEventDescription(e);\r\n      \r\n      return `\r\n        <div class=\"timeline-item\">\r\n          <div class=\"timeline-icon\">${icon}</div>\r\n          <div class=\"timeline-content\">\r\n            <div class=\"timeline-title\">${description}</div>\r\n            <div class=\"timeline-date\">${formatDateTime(e.created_at)}</div>\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    timelineContent.innerHTML = `<div class=\"timeline-list\">${html}</div>`;\r\n  } catch (e) {\r\n    timelineContent.innerHTML = '<p class=\"error\">Failed to load timeline</p>';\r\n  }\r\n}\r\n\r\n/**\r\n * Get icon for event type\r\n */\r\nfunction getEventIcon(eventType: string): string {\r\n  const icons: Record<string, string> = {\r\n    created: '',\r\n    assigned: '',\r\n    answered: '',\r\n    priority_changed: '',\r\n    status_changed: '',\r\n    reopened: '',\r\n    dismissed: '',\r\n    sla_breached: '',\r\n    entity_extracted: '',\r\n    similar_linked: ''\r\n  };\r\n  return icons[eventType] || '';\r\n}\r\n\r\n/**\r\n * Get description for event\r\n */\r\nfunction getEventDescription(event: TimelineEvent): string {\r\n  const data = event.event_data || {};\r\n  \r\n  switch (event.event_type) {\r\n    case 'created':\r\n      return `Created${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n    case 'assigned':\r\n      return `Assigned to ${data.to || 'someone'}${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n    case 'answered':\r\n      return `Answered${event.actor_name ? ` by ${event.actor_name}` : ''} (${data.source || 'manual'})`;\r\n    case 'priority_changed':\r\n      return `Priority changed: ${data.from}  ${data.to}`;\r\n    case 'status_changed':\r\n      return `Status changed: ${data.from}  ${data.to}`;\r\n    case 'reopened':\r\n      return `Reopened${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n    case 'dismissed':\r\n      return `Dismissed${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n    case 'sla_breached':\r\n      return 'SLA breached';\r\n    case 'entity_extracted':\r\n      return `Entities extracted: ${(data.entities as Array<{name: string}>)?.length || 0}`;\r\n    default:\r\n      return event.event_type;\r\n  }\r\n}\r\n\r\n/**\r\n * Load AI suggestions for assignee\r\n */\r\nasync function loadAISuggestions(container: HTMLElement): Promise<void> {\r\n  const panel = container.querySelector('#suggestions-panel') as HTMLElement;\r\n  const btn = container.querySelector('#ai-suggest-btn') as HTMLButtonElement;\r\n  \r\n  if (!panel || !currentQuestion) return;\r\n\r\n  btn.disabled = true;\r\n  btn.innerHTML = `\r\n    <svg class=\"spin\" width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\r\n    </svg>\r\n    Analyzing...\r\n  `;\r\n  panel.style.display = 'block';\r\n  panel.innerHTML = `\r\n    <div class=\"suggestions-loading\">\r\n      <div class=\"ai-thinking-animation\">\r\n        <span></span><span></span><span></span>\r\n      </div>\r\n      <div class=\"loading-text\">AI is analyzing question context and team expertise...</div>\r\n    </div>\r\n  `;\r\n\r\n  try {\r\n    const result = await questionsService.suggestAssignee({\r\n      id: currentQuestion.id,\r\n      useAI: true\r\n    });\r\n\r\n    if (result.suggestions.length === 0) {\r\n      panel.innerHTML = `\r\n        <div class=\"no-suggestions\">\r\n          <svg width=\"40\" height=\"40\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n          </svg>\r\n          <div class=\"no-suggestions-text\">No matching experts found</div>\r\n          <button class=\"btn-show-all-contacts\" id=\"show-all-btn\">Browse all contacts</button>\r\n        </div>\r\n      `;\r\n      \r\n      // Bind show all button\r\n      const showAllBtn = panel.querySelector('#show-all-btn');\r\n      if (showAllBtn) {\r\n        on(showAllBtn as HTMLElement, 'click', () => {\r\n          panel.style.display = 'none';\r\n          const picker = container.querySelector('#contact-picker') as HTMLElement;\r\n          if (picker) {\r\n            picker.style.display = 'block';\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      panel.innerHTML = `\r\n        <div class=\"suggestions-header-sota\">\r\n          <div class=\"ai-badge\">\r\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n            </svg>\r\n            AI Recommended\r\n          </div>\r\n          ${result.cached ? '<span class=\"cached-tag\">Cached</span>' : '<span class=\"fresh-tag\">Fresh</span>'}\r\n        </div>\r\n        <div class=\"suggestions-list-sota\">\r\n          ${result.suggestions.map((s, i) => {\r\n            const contact = contacts.find(c => (c.name || '').trim().toLowerCase() === (s.person || '').trim().toLowerCase())\r\n              || contacts.find(c => (c.aliases || []).some(a => String(a).trim().toLowerCase() === (s.person || '').trim().toLowerCase()));\r\n            const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\r\n            const roleDisplay = contact?.role ?? s.role ?? '';\r\n            const scoreColor = getScoreColor(s.score);\r\n            \r\n            return `\r\n              <div class=\"suggestion-card-sota\" data-index=\"${i}\">\r\n                <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                <div class=\"suggestion-avatar-sota\">\r\n                  ${photoUrl \r\n                    ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(s.person)}\" onerror=\"this.parentElement.innerHTML='${getInitials(s.person)}'\">`\r\n                    : getInitials(s.person)\r\n                  }\r\n                </div>\r\n                <div class=\"suggestion-info-sota\">\r\n                  <div class=\"suggestion-name-sota\">${escapeHtml(s.person)}</div>\r\n                  ${roleDisplay ? `<div class=\"suggestion-role-sota\">${escapeHtml(roleDisplay)}</div>` : ''}\r\n                  <div class=\"suggestion-reason-sota\">${escapeHtml(s.reason)}</div>\r\n                </div>\r\n                <div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\">\r\n                  <div class=\"score-ring\">\r\n                    <svg viewBox=\"0 0 36 36\">\r\n                      <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                      <path class=\"score-fill\" stroke-dasharray=\"${s.score}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                    </svg>\r\n                    <div class=\"score-value\">${s.score}%</div>\r\n                  </div>\r\n                  <div class=\"score-label\">Match</div>\r\n                </div>\r\n                <button class=\"btn-select-suggestion\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n                  </svg>\r\n                  Assign\r\n                </button>\r\n              </div>\r\n            `;\r\n          }).join('')}\r\n        </div>\r\n        <div class=\"suggestions-footer\">\r\n          <button class=\"btn-link\" id=\"hide-suggestions-btn\">Close suggestions</button>\r\n        </div>\r\n      `;\r\n\r\n      // Bind click to select\r\n      panel.querySelectorAll('.suggestion-card-sota').forEach(item => {\r\n        const selectBtn = item.querySelector('.btn-select-suggestion');\r\n        if (selectBtn) {\r\n          on(selectBtn as HTMLElement, 'click', async (e) => {\r\n            e.stopPropagation();\r\n            const idx = parseInt(item.getAttribute('data-index') || '0');\r\n            const suggestion = result.suggestions[idx];\r\n            if (suggestion && currentQuestion) {\r\n              const select = container.querySelector('#assignee-select') as HTMLSelectElement;\r\n              const contact = contacts.find(c => c.name === suggestion.person);\r\n              \r\n              // Save to server FIRST\r\n              try {\r\n                await questionsService.update(currentQuestion.id, {\r\n                  assigned_to: suggestion.person,\r\n                  status: 'assigned'\r\n                });\r\n                \r\n                if (contact && select) {\r\n                  select.value = contact.id;\r\n                }\r\n                // Update current question state\r\n                currentQuestion.assigned_to = suggestion.person;\r\n                currentQuestion.status = 'assigned';\r\n                \r\n                // Update display\r\n                updateAssignedDisplay(container);\r\n                panel.style.display = 'none';\r\n                toast.success(`Assigned to ${suggestion.person}`);\r\n              } catch (err) {\r\n                console.error('[QuestionDetail] Failed to save AI suggestion assignment:', err);\r\n                toast.error('Failed to save assignment');\r\n              }\r\n            }\r\n          });\r\n        }\r\n      });\r\n      \r\n      // Bind hide button\r\n      const hideBtn = panel.querySelector('#hide-suggestions-btn');\r\n      if (hideBtn) {\r\n        on(hideBtn as HTMLElement, 'click', () => {\r\n          panel.style.display = 'none';\r\n        });\r\n      }\r\n    }\r\n  } catch (e) {\r\n    const isTimeout = (err: unknown) =>\r\n      (err as { message?: string; status?: number }).message === 'Request timed out' ||\r\n      (err as { status?: number }).status === 0;\r\n    const timeoutMessage = isTimeout(e);\r\n    panel.innerHTML = `\r\n      <div class=\"suggestions-error\">\r\n        <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\r\n        </svg>\r\n        <div>${timeoutMessage ? 'This took longer than expected.' : 'Failed to get AI suggestions.'}</div>\r\n        ${timeoutMessage ? '<p class=\"suggestions-error-hint\">You can try again (suggestions may be ready) or choose someone manually.</p>' : ''}\r\n        <button class=\"btn-retry\" id=\"retry-suggestions-btn\">Try Again</button>\r\n      </div>\r\n    `;\r\n    \r\n    const retryBtn = panel.querySelector('#retry-suggestions-btn');\r\n    if (retryBtn) {\r\n      on(retryBtn as HTMLElement, 'click', () => loadAISuggestions(container));\r\n    }\r\n  } finally {\r\n    btn.disabled = false;\r\n    btn.innerHTML = `\r\n      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n      </svg>\r\n      AI Suggest\r\n    `;\r\n  }\r\n}\r\n\r\n/**\r\n * Check for potential answers in knowledge base\r\n */\r\nasync function checkPotentialAnswers(container: HTMLElement): Promise<void> {\r\n  const answersDiv = container.querySelector('#potential-answers') as HTMLElement;\r\n  const btn = container.querySelector('#check-answers-btn') as HTMLButtonElement;\r\n  \r\n  if (!answersDiv || !currentQuestion) return;\r\n\r\n  btn.disabled = true;\r\n  btn.textContent = 'Checking...';\r\n  answersDiv.innerHTML = '<div class=\"loading\">Searching knowledge base...</div>';\r\n\r\n  try {\r\n    const response = await http.post<{ potentialAnswers: PotentialAnswer[] }>(\r\n      `/api/questions/${currentQuestion.id}/check-answer`,\r\n      {}\r\n    );\r\n    const { potentialAnswers } = response.data;\r\n\r\n    if (!potentialAnswers || potentialAnswers.length === 0) {\r\n      answersDiv.innerHTML = '<p class=\"empty-state\">No potential answers found in knowledge base</p>';\r\n    } else {\r\n      answersDiv.innerHTML = potentialAnswers.map(a => `\r\n        <div class=\"potential-answer\" data-content=\"${escapeHtml(a.content)}\">\r\n          <div class=\"answer-header\">\r\n            <span class=\"answer-type\">${a.type.toUpperCase()}</span>\r\n            <span class=\"answer-confidence\">${Math.round(a.confidence * 100)}%</span>\r\n          </div>\r\n          <div class=\"answer-content\">${escapeHtml(a.content.substring(0, 200))}...</div>\r\n          ${a.source ? `<div class=\"answer-source\">Source: ${escapeHtml(a.source)}</div>` : ''}\r\n          <button class=\"btn btn-sm btn-secondary use-answer-btn\">Use This</button>\r\n        </div>\r\n      `).join('');\r\n\r\n      // Bind \"Use This\" buttons\r\n      answersDiv.querySelectorAll('.use-answer-btn').forEach(btn => {\r\n        on(btn as HTMLElement, 'click', (e) => {\r\n          e.stopPropagation();\r\n          const parent = (btn as HTMLElement).closest('.potential-answer');\r\n          const content = parent?.getAttribute('data-content');\r\n          if (content) {\r\n            const answerInput = container.querySelector('#answer-input') as HTMLTextAreaElement;\r\n            if (answerInput) {\r\n              answerInput.value = content;\r\n              toast.success('Answer filled from knowledge base');\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n  } catch (e) {\r\n    answersDiv.innerHTML = '<p class=\"error\">Failed to check knowledge base</p>';\r\n  } finally {\r\n    btn.disabled = false;\r\n    btn.textContent = 'Check Knowledge Base';\r\n  }\r\n}\r\n\r\n/**\r\n * Save answer\r\n */\r\nasync function saveAnswer(\r\n  container: HTMLElement, \r\n  onUpdate?: (question: Question) => void\r\n): Promise<void> {\r\n  if (!currentQuestion) return;\r\n\r\n  const answerInput = container.querySelector('#answer-input') as HTMLTextAreaElement;\r\n  const sourceSelect = container.querySelector('#answer-source') as HTMLSelectElement;\r\n  const answeredBySelect = container.querySelector('#answered-by-contact') as HTMLSelectElement;\r\n  const followupInput = container.querySelector('#followup-input') as HTMLTextAreaElement;\r\n  const saveBtn = container.querySelector('#save-answer-btn') as HTMLButtonElement;\r\n\r\n  const answer = answerInput?.value.trim();\r\n  const source = sourceSelect?.value || 'manual';\r\n  const answeredByContactId = answeredBySelect?.value !== '__other__' ? answeredBySelect?.value : undefined;\r\n  const followupQuestions = followupInput?.value.trim();\r\n\r\n  if (!answer || answer.length < 3) {\r\n    toast.warning('Please provide an answer (at least 3 characters)');\r\n    return;\r\n  }\r\n\r\n  // Get contact name if selected\r\n  let answeredByName: string | undefined;\r\n  if (answeredByContactId) {\r\n    const contact = contacts.find(c => c.id === answeredByContactId);\r\n    answeredByName = contact?.name;\r\n  }\r\n\r\n  saveBtn.disabled = true;\r\n  saveBtn.textContent = 'Saving...';\r\n\r\n  try {\r\n    const result = await questionsService.answer(currentQuestion.id, {\r\n      answer,\r\n      source: source as 'manual' | 'document' | 'ai',\r\n      followupQuestions,\r\n      answeredByContactId,\r\n      answeredByName\r\n    });\r\n\r\n    toast.success(result.message);\r\n    \r\n    if (onUpdate && result.question) {\r\n      currentQuestion = result.question;\r\n      onUpdate(result.question);\r\n    }\r\n  } catch (e) {\r\n    toast.error('Failed to save answer');\r\n  } finally {\r\n    saveBtn.disabled = false;\r\n    saveBtn.textContent = 'Save Answer';\r\n  }\r\n}\r\n\r\n/**\r\n * Reopen question\r\n */\r\nasync function reopenQuestion(\r\n  container: HTMLElement,\r\n  onUpdate?: (question: Question) => void\r\n): Promise<void> {\r\n  if (!currentQuestion) return;\r\n\r\n  const reason = prompt('Why are you reopening this question?');\r\n  if (!reason) return;\r\n\r\n  try {\r\n    const updated = await questionsService.reopen(currentQuestion.id, reason);\r\n    toast.success('Question reopened');\r\n    currentQuestion = updated;\r\n    if (onUpdate) onUpdate(updated);\r\n  } catch (e) {\r\n    toast.error('Failed to reopen question');\r\n  }\r\n}\r\n\r\n/**\r\n * Dismiss question with reason\r\n */\r\nasync function dismissQuestionWithReason(\r\n  container: HTMLElement,\r\n  props: QuestionDetailViewProps,\r\n  reason: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other',\r\n  details?: string\r\n): Promise<void> {\r\n  console.log('[QuestionDetail] dismissQuestionWithReason called, reason:', reason);\r\n  \r\n  if (!currentQuestion) {\r\n    console.error('[QuestionDetail] No current question!');\r\n    toast.error('No question selected');\r\n    return;\r\n  }\r\n\r\n  console.log('[QuestionDetail] Dismissing question:', currentQuestion.id);\r\n\r\n  try {\r\n    const updated = await questionsService.dismissQuestion(currentQuestion.id, reason, details);\r\n    console.log('[QuestionDetail] Dismiss API response:', updated);\r\n    toast.success(`Question dismissed: ${reason.replace(/_/g, ' ')}`);\r\n    currentQuestion = updated;\r\n    if (props.onUpdate) props.onUpdate(updated);\r\n    props.onClose();\r\n  } catch (e) {\r\n    console.error('[QuestionDetail] Dismiss API error:', e);\r\n    toast.error('Failed to dismiss question');\r\n  }\r\n}\r\n\r\n/**\r\n * Show defer dialog\r\n */\r\nasync function showDeferDialog(\r\n  container: HTMLElement,\r\n  onUpdate?: (question: Question) => void\r\n): Promise<void> {\r\n  if (!currentQuestion) return;\r\n\r\n  // Create modal for defer options\r\n  const modal = document.createElement('div');\r\n  modal.className = 'modal open';\r\n  modal.id = 'defer-modal';\r\n  modal.innerHTML = `\r\n    <div class=\"modal-backdrop\"></div>\r\n    <div class=\"modal-container\" style=\"max-width: 400px;\">\r\n      <div class=\"modal-header\">\r\n        <h3>Defer Question</h3>\r\n        <button class=\"btn btn-icon modal-close\"></button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label>Defer until</label>\r\n          <input type=\"datetime-local\" id=\"defer-until\" class=\"form-input\" \r\n            min=\"${new Date().toISOString().slice(0, 16)}\" required>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Quick options</label>\r\n          <div class=\"defer-quick-options\">\r\n            <button class=\"btn btn-sm btn-secondary\" data-days=\"1\">Tomorrow</button>\r\n            <button class=\"btn btn-sm btn-secondary\" data-days=\"7\">Next Week</button>\r\n            <button class=\"btn btn-sm btn-secondary\" data-days=\"30\">Next Month</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Reason (optional)</label>\r\n          <input type=\"text\" id=\"defer-reason\" class=\"form-input\" placeholder=\"Why are you deferring this?\">\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary\" id=\"cancel-defer\">Cancel</button>\r\n        <button class=\"btn btn-primary\" id=\"confirm-defer\">Defer</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(modal);\r\n\r\n  // Bind events\r\n  modal.querySelector('.modal-close')?.addEventListener('click', () => modal.remove());\r\n  modal.querySelector('.modal-backdrop')?.addEventListener('click', () => modal.remove());\r\n  modal.querySelector('#cancel-defer')?.addEventListener('click', () => modal.remove());\r\n\r\n  // Quick options\r\n  modal.querySelectorAll('.defer-quick-options button').forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      const days = parseInt(btn.getAttribute('data-days') || '1');\r\n      const date = new Date();\r\n      date.setDate(date.getDate() + days);\r\n      const input = modal.querySelector('#defer-until') as HTMLInputElement;\r\n      input.value = date.toISOString().slice(0, 16);\r\n    });\r\n  });\r\n\r\n  // Confirm\r\n  modal.querySelector('#confirm-defer')?.addEventListener('click', async () => {\r\n    const untilInput = modal.querySelector('#defer-until') as HTMLInputElement;\r\n    const reasonInput = modal.querySelector('#defer-reason') as HTMLInputElement;\r\n\r\n    if (!untilInput.value) {\r\n      toast.warning('Please select a date');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const updated = await questionsService.deferQuestion(\r\n        currentQuestion!.id,\r\n        new Date(untilInput.value),\r\n        reasonInput.value || undefined\r\n      );\r\n      toast.success('Question deferred');\r\n      modal.remove();\r\n      currentQuestion = updated;\r\n      if (onUpdate) onUpdate(updated);\r\n    } catch (e) {\r\n      toast.error('Failed to defer question');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Submit feedback on answer\r\n */\r\nasync function submitFeedback(\r\n  container: HTMLElement,\r\n  wasUseful: boolean,\r\n  onUpdate?: (question: Question) => void\r\n): Promise<void> {\r\n  if (!currentQuestion) return;\r\n\r\n  let feedback: string | undefined;\r\n  if (!wasUseful) {\r\n    feedback = prompt('What could be improved about this answer?') || undefined;\r\n  }\r\n\r\n  try {\r\n    const updated = await questionsService.submitAnswerFeedback(\r\n      currentQuestion.id,\r\n      wasUseful,\r\n      feedback\r\n    );\r\n    toast.success('Thank you for your feedback!');\r\n    currentQuestion = updated;\r\n    if (onUpdate) onUpdate(updated);\r\n    \r\n    // Update UI to hide feedback buttons\r\n    const feedbackBtns = container.querySelector('.feedback-buttons');\r\n    if (feedbackBtns) {\r\n      feedbackBtns.innerHTML = `<span class=\"feedback-result\">${wasUseful ? ' Helpful' : ' Not helpful'}</span>`;\r\n    }\r\n  } catch (e) {\r\n    toast.error('Failed to submit feedback');\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle edit mode\r\n */\r\nfunction toggleEditMode(container: HTMLElement): void {\r\n  // TODO: Implement edit mode for question content, priority, etc.\r\n  toast.info('Edit mode coming soon');\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createQuestionDetailView;\r\n","/**\r\n * Question Modal Component\r\n * View, create, edit, and answer questions with AI suggestions\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { \r\n  questionsService, \r\n  Question, \r\n  CreateQuestionRequest, \r\n  AssigneeSuggestion \r\n} from '../../services/questions';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'question-modal';\r\n\r\nexport interface QuestionModalProps {\r\n  mode: 'view' | 'answer' | 'create' | 'edit';\r\n  question?: Question;\r\n  onSave?: (question: Question) => void;\r\n  onDismiss?: (questionId: string | number) => void;\r\n  onDelete?: (questionId: string | number) => void;\r\n}\r\n\r\nlet currentSuggestions: AssigneeSuggestion[] = [];\r\n\r\n/**\r\n * Show question modal\r\n */\r\nexport function showQuestionModal(props: QuestionModalProps): void {\r\n  const { mode, question, onSave, onDismiss } = props;\r\n  currentSuggestions = [];\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'question-modal-content' });\r\n\r\n  if (mode === 'create') {\r\n    renderCreateForm(content);\r\n  } else if (mode === 'edit' && question) {\r\n    renderEditForm(content, question);\r\n  } else if (question) {\r\n    renderQuestionView(content, question, mode === 'answer');\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n  createFooterButtons(footer, mode, question, content, props);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: getModalTitle(mode),\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Get modal title based on mode\r\n */\r\nfunction getModalTitle(mode: string): string {\r\n  switch (mode) {\r\n    case 'create': return 'New Question';\r\n    case 'edit': return 'Edit Question';\r\n    case 'answer': return 'Answer Question';\r\n    default: return 'Question Details';\r\n  }\r\n}\r\n\r\n/**\r\n * Create footer buttons based on mode\r\n */\r\nfunction createFooterButtons(\r\n  footer: HTMLElement,\r\n  mode: string,\r\n  question: Question | undefined,\r\n  content: HTMLElement,\r\n  props: QuestionModalProps\r\n): void {\r\n  const { onSave, onDismiss, onDelete } = props;\r\n\r\n  if (mode === 'create') {\r\n    const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\r\n    const createBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Create Question' });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n    on(createBtn, 'click', () => handleCreate(content, onSave));\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(createBtn);\r\n  } else if (mode === 'edit' && question) {\r\n    const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\r\n    const saveBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save Changes' });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n    on(saveBtn, 'click', () => handleEdit(content, question, onSave));\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(saveBtn);\r\n  } else if (question) {\r\n    const status = question.status;\r\n\r\n    if (status !== 'resolved' && status !== 'dismissed') {\r\n      const dismissBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Dismiss' });\r\n      on(dismissBtn, 'click', () => handleDismiss(question.id, onDismiss));\r\n      footer.appendChild(dismissBtn);\r\n\r\n      if (mode === 'answer') {\r\n        const saveAnswerBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save Answer' });\r\n        on(saveAnswerBtn, 'click', () => handleAnswer(content, question, onSave));\r\n        footer.appendChild(saveAnswerBtn);\r\n      } else {\r\n        const answerBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Answer' });\r\n        on(answerBtn, 'click', () => {\r\n          closeModal(MODAL_ID);\r\n          showQuestionModal({ ...props, mode: 'answer' });\r\n        });\r\n        footer.appendChild(answerBtn);\r\n      }\r\n    } else if (status === 'resolved') {\r\n      const reopenBtn = createElement('button', { className: 'btn btn-warning', textContent: 'Reopen' });\r\n      on(reopenBtn, 'click', () => handleReopen(question, onSave));\r\n      footer.appendChild(reopenBtn);\r\n    }\r\n\r\n    const closeBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Close' });\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n    footer.appendChild(closeBtn);\r\n  }\r\n}\r\n\r\n/**\r\n * Render create form\r\n */\r\nfunction renderCreateForm(container: HTMLElement): void {\r\n  container.innerHTML = `\r\n    <form id=\"question-form\" class=\"question-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"question-content\">Question <span class=\"required\">*</span></label>\r\n        <textarea id=\"question-content\" rows=\"3\" required minlength=\"5\"\r\n                  placeholder=\"What needs to be clarified? (min 5 characters)\"></textarea>\r\n        <div id=\"duplicate-warning\" class=\"form-warning\" style=\"display: none;\"></div>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label for=\"question-context\">Context</label>\r\n        <textarea id=\"question-context\" rows=\"2\"\r\n                  placeholder=\"Why is this question important?\"></textarea>\r\n      </div>\r\n      \r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"question-priority\">Priority</label>\r\n          <select id=\"question-priority\">\r\n            <option value=\"low\">Low</option>\r\n            <option value=\"medium\" selected>Medium</option>\r\n            <option value=\"high\">High</option>\r\n            <option value=\"critical\">Critical</option>\r\n          </select>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"question-assignee\">Assign To</label>\r\n          <input type=\"text\" id=\"question-assignee\" placeholder=\"Person name\">\r\n          <button type=\"button\" id=\"suggest-assignee-btn\" class=\"btn btn-sm btn-secondary\">\r\n            AI Suggest\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      <div id=\"suggestions-container\" class=\"suggestions-container\" style=\"display: none;\"></div>\r\n    </form>\r\n  `;\r\n\r\n  // Bind AI suggest button\r\n  const suggestBtn = container.querySelector('#suggest-assignee-btn');\r\n  if (suggestBtn) {\r\n    on(suggestBtn as HTMLElement, 'click', () => loadAssigneeSuggestions(container));\r\n  }\r\n}\r\n\r\n/**\r\n * Render edit form\r\n */\r\nfunction renderEditForm(container: HTMLElement, question: Question): void {\r\n  container.innerHTML = `\r\n    <form id=\"question-form\" class=\"question-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"question-content\">Question <span class=\"required\">*</span></label>\r\n        <textarea id=\"question-content\" rows=\"3\" required minlength=\"5\">${escapeHtml(question.content)}</textarea>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label for=\"question-context\">Context</label>\r\n        <textarea id=\"question-context\" rows=\"2\">${escapeHtml(question.context || '')}</textarea>\r\n      </div>\r\n      \r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"question-priority\">Priority</label>\r\n          <select id=\"question-priority\">\r\n            <option value=\"low\" ${question.priority === 'low' ? 'selected' : ''}>Low</option>\r\n            <option value=\"medium\" ${question.priority === 'medium' ? 'selected' : ''}>Medium</option>\r\n            <option value=\"high\" ${question.priority === 'high' ? 'selected' : ''}>High</option>\r\n            <option value=\"critical\" ${question.priority === 'critical' ? 'selected' : ''}>Critical</option>\r\n          </select>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"question-status\">Status</label>\r\n          <select id=\"question-status\">\r\n            <option value=\"pending\" ${question.status === 'pending' ? 'selected' : ''}>Pending</option>\r\n            <option value=\"assigned\" ${question.status === 'assigned' ? 'selected' : ''}>Assigned</option>\r\n            <option value=\"resolved\" ${question.status === 'resolved' ? 'selected' : ''}>Resolved</option>\r\n            <option value=\"dismissed\" ${question.status === 'dismissed' ? 'selected' : ''}>Dismissed</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label for=\"question-assignee\">Assigned To</label>\r\n        <input type=\"text\" id=\"question-assignee\" value=\"${escapeHtml(question.assigned_to || '')}\">\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label for=\"question-category\">Category</label>\r\n        <input type=\"text\" id=\"question-category\" value=\"${escapeHtml(question.category || '')}\">\r\n      </div>\r\n    </form>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render question view\r\n */\r\nfunction renderQuestionView(container: HTMLElement, question: Question, showAnswerField: boolean): void {\r\n  container.innerHTML = `\r\n    <div class=\"question-view\">\r\n      <div class=\"question-meta\">\r\n        <span class=\"priority-badge priority-${question.priority}\">${question.priority}</span>\r\n        <span class=\"status-badge status-${question.status}\">${question.status}</span>\r\n        <span class=\"question-date\">${formatRelativeTime(question.created_at)}</span>\r\n        ${question.assigned_to ? `<span class=\"question-assignee\"> ${escapeHtml(question.assigned_to)}</span>` : ''}\r\n      </div>\r\n      \r\n      <div class=\"question-content-large\">\r\n        ${escapeHtml(question.content)}\r\n      </div>\r\n      \r\n      ${question.context ? `<div class=\"question-context\"><strong>Context:</strong> ${escapeHtml(question.context)}</div>` : ''}\r\n      ${question.category ? `<div class=\"question-category\"><strong>Category:</strong> ${escapeHtml(question.category)}</div>` : ''}\r\n      ${question.source_file ? `<div class=\"question-source\"><strong>Source:</strong> ${escapeHtml(question.source_file)}</div>` : ''}\r\n      \r\n      ${question.answer ? `\r\n        <div class=\"question-answer-section\">\r\n          <h4>Answer ${question.answer_source ? `<span class=\"answer-source\">(${question.answer_source})</span>` : ''}</h4>\r\n          <div class=\"answer-text\">${escapeHtml(question.answer)}</div>\r\n          ${question.resolved_at ? `<div class=\"answer-date\">Resolved ${formatRelativeTime(question.resolved_at)}</div>` : ''}\r\n        </div>\r\n      ` : ''}\r\n      \r\n      ${showAnswerField && question.status !== 'resolved' ? `\r\n        <div class=\"answer-form\">\r\n          <div class=\"form-group\">\r\n            <label for=\"question-answer\">Your Answer <span class=\"required\">*</span></label>\r\n            <textarea id=\"question-answer\" rows=\"4\" required minlength=\"3\"\r\n                      placeholder=\"Provide an answer (min 3 characters)...\"></textarea>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"answer-source\">Source</label>\r\n            <select id=\"answer-source\">\r\n              <option value=\"manual\" selected>Manual</option>\r\n              <option value=\"document\">From Document</option>\r\n              <option value=\"ai\">AI Assisted</option>\r\n            </select>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"followup-questions\">Follow-up Questions (one per line)</label>\r\n            <textarea id=\"followup-questions\" rows=\"2\"\r\n                      placeholder=\"Add any follow-up questions...\"></textarea>\r\n          </div>\r\n        </div>\r\n      ` : ''}\r\n      \r\n      ${question.reopened_reason ? `\r\n        <div class=\"reopen-reason\">\r\n          <strong>Reopen Reason:</strong> ${escapeHtml(question.reopened_reason)}\r\n        </div>\r\n      ` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Load AI assignee suggestions\r\n */\r\nasync function loadAssigneeSuggestions(container: HTMLElement): Promise<void> {\r\n  const contentInput = container.querySelector('#question-content') as HTMLTextAreaElement;\r\n  const content = contentInput?.value.trim();\r\n\r\n  if (!content || content.length < 5) {\r\n    toast.warning('Please enter at least 5 characters for the question');\r\n    return;\r\n  }\r\n\r\n  const suggestionsContainer = container.querySelector('#suggestions-container') as HTMLElement;\r\n  const suggestBtn = container.querySelector('#suggest-assignee-btn') as HTMLButtonElement;\r\n\r\n  suggestBtn.disabled = true;\r\n  suggestBtn.textContent = 'Loading...';\r\n  suggestionsContainer.style.display = 'block';\r\n  suggestionsContainer.innerHTML = '<div class=\"loading\">Getting AI suggestions...</div>';\r\n\r\n  try {\r\n    const result = await questionsService.suggestAssignee({ content, useAI: true });\r\n    currentSuggestions = result.suggestions;\r\n\r\n    if (currentSuggestions.length === 0) {\r\n      suggestionsContainer.innerHTML = '<div class=\"no-suggestions\">No suggestions available</div>';\r\n    } else {\r\n      suggestionsContainer.innerHTML = `\r\n        <h4>AI Suggestions ${result.cached ? '<span class=\"cached\">(cached)</span>' : ''}</h4>\r\n        <div class=\"suggestions-list\">\r\n          ${currentSuggestions.map((s, i) => `\r\n            <div class=\"suggestion-item\" data-index=\"${i}\">\r\n              <div class=\"suggestion-person\">${escapeHtml(s.person)}</div>\r\n              <div class=\"suggestion-score\">${s.score}%</div>\r\n              <div class=\"suggestion-reason\">${escapeHtml(s.reason)}</div>\r\n              ${s.role ? `<div class=\"suggestion-role\">${escapeHtml(s.role)}</div>` : ''}\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      `;\r\n\r\n      // Bind click to select suggestion\r\n      suggestionsContainer.querySelectorAll('.suggestion-item').forEach(item => {\r\n        on(item as HTMLElement, 'click', () => {\r\n          const index = parseInt(item.getAttribute('data-index') || '0', 10);\r\n          const suggestion = currentSuggestions[index];\r\n          if (suggestion) {\r\n            const assigneeInput = container.querySelector('#question-assignee') as HTMLInputElement;\r\n            if (assigneeInput) {\r\n              assigneeInput.value = suggestion.person;\r\n            }\r\n            suggestionsContainer.style.display = 'none';\r\n            toast.success(`Selected: ${suggestion.person}`);\r\n          }\r\n        });\r\n      });\r\n    }\r\n  } catch {\r\n    suggestionsContainer.innerHTML = '<div class=\"error\">Failed to get suggestions</div>';\r\n  } finally {\r\n    suggestBtn.disabled = false;\r\n    suggestBtn.textContent = 'AI Suggest';\r\n  }\r\n}\r\n\r\n/**\r\n * Handle create\r\n */\r\nasync function handleCreate(\r\n  container: HTMLElement,\r\n  onSave?: (question: Question) => void\r\n): Promise<void> {\r\n  const form = container.querySelector('#question-form') as HTMLFormElement;\r\n  if (!form.checkValidity()) {\r\n    form.reportValidity();\r\n    return;\r\n  }\r\n\r\n  const getValue = (id: string) => {\r\n    const el = container.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\r\n    return el?.value.trim() || '';\r\n  };\r\n\r\n  const data: CreateQuestionRequest = {\r\n    content: getValue('question-content'),\r\n    priority: getValue('question-priority') as 'low' | 'medium' | 'high' | 'critical',\r\n    assigned_to: getValue('question-assignee') || undefined,\r\n    context: getValue('question-context') || undefined,\r\n  };\r\n\r\n  try {\r\n    const result = await questionsService.create(data);\r\n\r\n    if (result.duplicate) {\r\n      const warning = container.querySelector('#duplicate-warning') as HTMLElement;\r\n      if (warning) {\r\n        warning.style.display = 'block';\r\n        warning.innerHTML = ` Similar question exists (${result.similarity}% match). <a href=\"#\" id=\"view-duplicate\">View existing</a>`;\r\n      }\r\n      return;\r\n    }\r\n\r\n    toast.success('Question created');\r\n    \r\n    const newQuestion: Question = {\r\n      id: result.id || Date.now(),\r\n      content: data.content,\r\n      priority: data.priority || 'medium',\r\n      status: data.assigned_to ? 'assigned' : 'pending',\r\n      assigned_to: data.assigned_to,\r\n      context: data.context,\r\n      created_at: new Date().toISOString(),\r\n    };\r\n\r\n    onSave?.(newQuestion);\r\n    closeModal(MODAL_ID);\r\n  } catch {\r\n    // Error shown by API service\r\n  }\r\n}\r\n\r\n/**\r\n * Handle edit\r\n */\r\nasync function handleEdit(\r\n  container: HTMLElement,\r\n  question: Question,\r\n  onSave?: (question: Question) => void\r\n): Promise<void> {\r\n  const getValue = (id: string) => {\r\n    const el = container.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\r\n    return el?.value.trim() || '';\r\n  };\r\n\r\n  try {\r\n    const updated = await questionsService.update(question.id, {\r\n      content: getValue('question-content'),\r\n      context: getValue('question-context') || undefined,\r\n      priority: getValue('question-priority') as 'low' | 'medium' | 'high' | 'critical',\r\n      status: getValue('question-status') as 'pending' | 'assigned' | 'resolved' | 'dismissed',\r\n      assigned_to: getValue('question-assignee') || undefined,\r\n      category: getValue('question-category') || undefined,\r\n    });\r\n\r\n    toast.success('Question updated');\r\n    onSave?.(updated);\r\n    closeModal(MODAL_ID);\r\n  } catch {\r\n    // Error shown by API service\r\n  }\r\n}\r\n\r\n/**\r\n * Handle answer\r\n */\r\nasync function handleAnswer(\r\n  container: HTMLElement,\r\n  question: Question,\r\n  onSave?: (question: Question) => void\r\n): Promise<void> {\r\n  const answerInput = container.querySelector('#question-answer') as HTMLTextAreaElement;\r\n  const sourceSelect = container.querySelector('#answer-source') as HTMLSelectElement;\r\n  const followupInput = container.querySelector('#followup-questions') as HTMLTextAreaElement;\r\n\r\n  const answer = answerInput?.value.trim();\r\n  const source = sourceSelect?.value || 'manual';\r\n  const followupQuestions = followupInput?.value.trim();\r\n\r\n  if (!answer || answer.length < 3) {\r\n    toast.warning('Please provide an answer (at least 3 characters)');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const result = await questionsService.answer(question.id, {\r\n      answer,\r\n      source: source as 'manual' | 'document' | 'ai',\r\n      followupQuestions,\r\n    });\r\n\r\n    toast.success(result.message);\r\n    onSave?.(result.question);\r\n    closeModal(MODAL_ID);\r\n  } catch {\r\n    // Error shown by API service\r\n  }\r\n}\r\n\r\n/**\r\n * Handle dismiss\r\n */\r\nasync function handleDismiss(\r\n  questionId: string | number,\r\n  onDismiss?: (questionId: string | number) => void\r\n): Promise<void> {\r\n  const { confirm } = await import('../Modal');\r\n  const confirmed = await confirm(\r\n    'Are you sure you want to dismiss this question?',\r\n    {\r\n      title: 'Dismiss Question',\r\n      confirmText: 'Dismiss',\r\n    }\r\n  );\r\n\r\n  if (confirmed) {\r\n    try {\r\n      await questionsService.delete(questionId, 'dismissed');\r\n      toast.success('Question dismissed');\r\n      onDismiss?.(questionId);\r\n      closeModal(MODAL_ID);\r\n    } catch {\r\n      // Error shown by API service\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Handle reopen\r\n */\r\nasync function handleReopen(\r\n  question: Question,\r\n  onSave?: (question: Question) => void\r\n): Promise<void> {\r\n  const { prompt } = await import('../Modal');\r\n  const reason = await prompt('Why are you reopening this question?', {\r\n    title: 'Reopen Question',\r\n    placeholder: 'Enter reason...',\r\n  });\r\n\r\n  if (reason) {\r\n    try {\r\n      const updated = await questionsService.reopen(question.id, reason);\r\n      toast.success('Question reopened');\r\n      onSave?.(updated);\r\n      closeModal(MODAL_ID);\r\n    } catch {\r\n      // Error shown by API service\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showQuestionModal;\r\n","/**\r\n * Questions Panel Component\r\n * Displays and manages questions in the Source of Truth\r\n * Updated to support detail view instead of modal\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { questionsService, Question } from '../../services/questions';\r\nimport { dataStore } from '../../stores/data';\r\nimport { showQuestionModal } from '../modals/QuestionModal';\r\nimport { createQuestionDetailView } from '../questions/QuestionDetailView';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\nimport { http } from '../../services/api';\r\n\r\nexport interface QuestionsPanelProps {\r\n  onQuestionClick?: (question: Question) => void;\r\n  useDetailView?: boolean; // If true, replace panel with detail view instead of modal\r\n  containerElement?: HTMLElement; // Parent container for detail view replacement\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentView: 'status' | 'person' | 'team' = 'status';\r\n\r\n/**\r\n * Create questions panel\r\n */\r\nexport function createQuestionsPanel(props: QuestionsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel questions-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Questions</h2>\r\n        <span class=\"panel-count\" id=\"questions-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"questions-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All Active</option>\r\n          <option value=\"pending\">Pending</option>\r\n          <option value=\"assigned\">Assigned</option>\r\n          <option value=\"critical\">Critical Priority</option>\r\n          <option value=\"overdue\">Overdue (SLA)</option>\r\n          <option value=\"resolved\"> Resolved</option>\r\n          <option value=\"dismissed\"> Dismissed</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\r\n          <button class=\"view-tab\" data-view=\"person\">By Person</button>\r\n          <button class=\"view-tab\" data-view=\"team\">By Team</button>\r\n        </div>\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"generate-team-btn\" title=\"Generate questions for team based on roles\"> Generate</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-question-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"questions-content\">\r\n      <div class=\"loading\">Loading questions...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const filterSelect = panel.querySelector('#questions-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadQuestions(panel, props);\r\n  });\r\n\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'status' | 'person' | 'team';\r\n      loadQuestions(panel, props);\r\n    });\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-question-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showQuestionModal({\r\n        mode: 'create',\r\n        onSave: () => loadQuestions(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Generate for team button\r\n  const generateBtn = panel.querySelector('#generate-team-btn');\r\n  if (generateBtn) {\r\n    on(generateBtn as HTMLElement, 'click', () => showGenerateForTeamDialog(panel, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadQuestions(panel, props);\r\n\r\n  // Subscribe to data changes\r\n  dataStore.subscribe(() => {\r\n    updateCount(panel);\r\n  });\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load questions\r\n */\r\nasync function loadQuestions(panel: HTMLElement, props: QuestionsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#questions-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    let questions: Question[] = [];\r\n\r\n    if (currentView === 'status') {\r\n      // Handle special filters\r\n      if (currentFilter === 'overdue') {\r\n        // Get all pending/assigned questions and filter by SLA breach\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => \r\n          q.sla_breached === true || \r\n          (q.status !== 'resolved' && q.status !== 'dismissed' && isOverdue(q))\r\n        );\r\n      } else if (currentFilter === 'critical') {\r\n        // Filter by critical priority\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.priority === 'critical' && q.status !== 'resolved' && q.status !== 'dismissed');\r\n      } else if (currentFilter === 'all') {\r\n        // \"All\" means all ACTIVE questions - exclude dismissed/resolved\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'closed');\r\n      } else if (currentFilter === 'dismissed') {\r\n        // Specifically show dismissed questions\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status === 'dismissed');\r\n      } else if (currentFilter === 'resolved') {\r\n        // Specifically show resolved/answered questions\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status === 'resolved' || q.status === 'answered');\r\n      } else {\r\n        // Filter by specific status (pending, assigned, etc.)\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status === currentFilter);\r\n      }\r\n      renderByStatus(content, questions, props);\r\n    } else if (currentView === 'person') {\r\n      const grouped = await questionsService.getByPerson();\r\n      renderGrouped(content, grouped, props);\r\n    } else if (currentView === 'team') {\r\n      const grouped = await questionsService.getByTeam();\r\n      renderGrouped(content, grouped, props);\r\n    }\r\n\r\n    // Update store\r\n    if (currentView === 'status') {\r\n      dataStore.setQuestions(questions as unknown as []);\r\n    }\r\n\r\n    updateCount(panel);\r\n  } catch (error) {\r\n    content.innerHTML = '<div class=\"error\">Failed to load questions</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a question is overdue based on SLA\r\n */\r\nfunction isOverdue(question: Question): boolean {\r\n  if (!question.created_at) return false;\r\n  const slaHours = question.sla_hours || 168; // 7 days default\r\n  const created = new Date(question.created_at);\r\n  const deadline = new Date(created.getTime() + slaHours * 60 * 60 * 1000);\r\n  return new Date() > deadline;\r\n}\r\n\r\n/**\r\n * Render questions by status\r\n */\r\nfunction renderByStatus(container: HTMLElement, questions: Question[], props: QuestionsPanelProps): void {\r\n  if (questions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No questions found</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Question</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showQuestionModal({ mode: 'create' });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = questions.map(q => createQuestionCard(q)).join('');\r\n  bindCardEvents(container, questions, props);\r\n}\r\n\r\n/**\r\n * Render grouped questions\r\n */\r\nfunction renderGrouped(\r\n  container: HTMLElement,\r\n  grouped: Record<string, Question[]>,\r\n  props: QuestionsPanelProps\r\n): void {\r\n  const groups = Object.entries(grouped);\r\n  \r\n  if (groups.length === 0) {\r\n    container.innerHTML = '<div class=\"empty-state\"><p>No questions found</p></div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = groups.map(([groupName, questions]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(groupName)}</h3>\r\n        <span class=\"group-count\">${questions.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${questions.map(q => createQuestionCard(q)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Flatten for event binding\r\n  const allQuestions = groups.flatMap(([, qs]) => qs);\r\n  bindCardEvents(container, allQuestions, props);\r\n}\r\n\r\n/**\r\n * Create question card HTML - SOTA Design\r\n */\r\nfunction createQuestionCard(question: Question): string {\r\n  const priorityClass = `priority-${question.priority}`;\r\n  const statusClass = `status-${question.status}`;\r\n  const slaBreached = question.sla_breached;\r\n  const autoDetected = question.answer_source === 'auto-detected';\r\n  const hasAnswer = !!question.answer;\r\n  const hasRequesterRole = !!question.requester_role;\r\n\r\n  // Get initials for avatar\r\n  const getInitials = (name: string): string => {\r\n    if (!name) return '?';\r\n    const parts = name.trim().split(/\\s+/);\r\n    return parts.length === 1 \r\n      ? parts[0].substring(0, 2).toUpperCase() \r\n      : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n  };\r\n\r\n  // Build the card HTML\r\n  let html = `<div class=\"question-card-sota${slaBreached ? ' sla-breached' : ''}${hasAnswer ? ' has-answer' : ''}\" data-id=\"${question.id}\">`;\r\n  \r\n  // Priority Bar\r\n  html += `<div class=\"card-priority-bar ${priorityClass}\"></div>`;\r\n  \r\n  // Card Body\r\n  html += `<div class=\"card-body\">`;\r\n  \r\n  // Top Row\r\n  html += `<div class=\"card-top-row\">`;\r\n  html += `<div class=\"card-badges\">`;\r\n  html += `<span class=\"priority-pill ${priorityClass}\">${question.priority}</span>`;\r\n  html += `<span class=\"status-pill ${statusClass}\">${question.status}</span>`;\r\n  if (slaBreached) html += `<span class=\"sla-pill\">SLA</span>`;\r\n  if (autoDetected) html += `<span class=\"auto-pill\">Answer Found</span>`;\r\n  if (question.follow_up_to) html += `<span class=\"followup-pill\">Follow-up</span>`;\r\n  html += `</div>`; // .card-badges\r\n  html += `<span class=\"card-timestamp\">${formatRelativeTime(question.created_at)}</span>`;\r\n  html += `</div>`; // .card-top-row\r\n  \r\n  // Question Text\r\n  html += `<div class=\"card-question-text\">${escapeHtml(question.content)}</div>`;\r\n  \r\n  // Bottom Row\r\n  html += `<div class=\"card-bottom-row\">`;\r\n  \r\n  // Get contacts for photo lookup\r\n  const contacts = dataStore.getState().contacts || [];\r\n  \r\n  // Helper to get photo URL\r\n  const getPhotoUrl = (name: string, contactId?: string): string | null => {\r\n    const contact = contactId \r\n      ? contacts.find((c: any) => c.id === contactId)\r\n      : contacts.find((c: any) => c.name === name);\r\n    return contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url || null;\r\n  };\r\n  \r\n  // Helper to render avatar (photo or initials)\r\n  const renderAvatar = (name: string, photoUrl: string | null, cssClass: string): string => {\r\n    if (photoUrl) {\r\n      return `<div class=\"${cssClass}\"><img src=\"${photoUrl}\" alt=\"${escapeHtml(name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\"></div>`;\r\n    }\r\n    return `<div class=\"${cssClass}\">${getInitials(name)}</div>`;\r\n  };\r\n  \r\n  // Left: Requester (who is asking) - shows avatar + name + role\r\n  html += `<div class=\"card-requester\">`;\r\n  if (hasRequesterRole) {\r\n    const requesterName = (question as any).requester_name || '';\r\n    const requesterRole = question.requester_role || '';\r\n    const requesterContactId = (question as any).requester_contact_id;\r\n    const requesterPhotoUrl = getPhotoUrl(requesterName, requesterContactId);\r\n    \r\n    html += `<div class=\"requester-chip\">`;\r\n    html += renderAvatar(requesterName || requesterRole, requesterPhotoUrl, 'requester-avatar');\r\n    html += `<div class=\"requester-info\">`;\r\n    if (requesterName) {\r\n      html += `<span class=\"requester-name\">${escapeHtml(requesterName)}</span>`;\r\n    }\r\n    html += `<span class=\"requester-role\">${escapeHtml(requesterRole)}</span>`;\r\n    html += `</div>`;\r\n    html += `</div>`;\r\n  }\r\n  html += `</div>`; // .card-requester\r\n  \r\n  // Right: Assignment (who should answer) - shows avatar + name\r\n  html += `<div class=\"card-assignment\">`;\r\n  if (question.assigned_to) {\r\n    const assigneePhotoUrl = getPhotoUrl(question.assigned_to);\r\n    \r\n    html += `<div class=\"assignee-chip\">`;\r\n    html += renderAvatar(question.assigned_to, assigneePhotoUrl, 'assignee-avatar');\r\n    html += `<div class=\"assignee-info\">`;\r\n    html += `<span class=\"assignee-name\">${escapeHtml(question.assigned_to)}</span>`;\r\n    if (hasAnswer) html += `<span class=\"answered-badge\">Answered</span>`;\r\n    html += `</div>`;\r\n    html += `</div>`;\r\n  } else {\r\n    html += `<div class=\"unassigned-chip\">`;\r\n    html += `<span>Unassigned</span>`;\r\n    html += `</div>`;\r\n  }\r\n  html += `</div>`; // .card-assignment\r\n  \r\n  html += `</div>`; // .card-bottom-row\r\n  html += `</div>`; // .card-body\r\n  html += `</div>`; // .question-card-sota\r\n  \r\n  return html;\r\n}\r\n\r\n/**\r\n * Bind card click events\r\n */\r\nfunction bindCardEvents(container: HTMLElement, questions: Question[], props: QuestionsPanelProps): void {\r\n  container.querySelectorAll('.question-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const question = questions.find(q => String(q.id) === id);\r\n      if (question) {\r\n        if (props.onQuestionClick) {\r\n          props.onQuestionClick(question);\r\n        } else if (props.useDetailView && props.containerElement) {\r\n          // Replace panel with detail view\r\n          showQuestionDetailView(question, props);\r\n        } else {\r\n          // Fallback to modal\r\n          showQuestionModal({\r\n            mode: 'view',\r\n            question,\r\n            onSave: () => loadQuestions(container.closest('.questions-panel') as HTMLElement, props),\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show question detail view (replaces panel content)\r\n */\r\nfunction showQuestionDetailView(question: Question, props: QuestionsPanelProps): void {\r\n  const containerEl = props.containerElement;\r\n  if (!containerEl) return;\r\n\r\n  // Store current panel content for restoration\r\n  const panelContent = containerEl.innerHTML;\r\n\r\n  // Create detail view\r\n  const detailView = createQuestionDetailView({\r\n    question,\r\n    onClose: () => {\r\n      // Restore panel content\r\n      containerEl.innerHTML = panelContent;\r\n      // Re-initialize the panel\r\n      const panel = containerEl.querySelector('.questions-panel');\r\n      if (panel) {\r\n        loadQuestions(panel as HTMLElement, props);\r\n      }\r\n    },\r\n    onUpdate: (updatedQuestion) => {\r\n      // If question was dismissed/resolved, close detail view and refresh list\r\n      if (updatedQuestion.status === 'dismissed' || updatedQuestion.status === 'resolved' || updatedQuestion.status === 'closed') {\r\n        // Restore panel content and reload\r\n        containerEl.innerHTML = panelContent;\r\n        const panel = containerEl.querySelector('.questions-panel');\r\n        if (panel) {\r\n          loadQuestions(panel as HTMLElement, props);\r\n        }\r\n        toast.info('Question updated - returning to list');\r\n      }\r\n    },\r\n    onNavigateToQuestion: async (questionId) => {\r\n      // Navigate to another question\r\n      try {\r\n        const questions = await questionsService.getAll();\r\n        const targetQuestion = questions.find(q => String(q.id) === questionId);\r\n        if (targetQuestion) {\r\n          showQuestionDetailView(targetQuestion, props);\r\n        }\r\n      } catch (e) {\r\n        toast.error('Failed to load question');\r\n      }\r\n    }\r\n  });\r\n\r\n  // Replace content with detail view\r\n  containerEl.innerHTML = '';\r\n  containerEl.appendChild(detailView);\r\n}\r\n\r\n/**\r\n * Show AI-powered generate questions dialog (SOTA version)\r\n * Uses the universal modal-sota.css system\r\n */\r\nasync function showGenerateForTeamDialog(panel: HTMLElement, props: QuestionsPanelProps): Promise<void> {\r\n  const modal = document.createElement('div');\r\n  modal.className = 'modal open';\r\n  modal.id = 'generate-ai-modal';\r\n  modal.innerHTML = `\r\n    <div class=\"modal-backdrop\"></div>\r\n    <div class=\"modal-container modal-sota\" style=\"position: relative;\">\r\n      <!-- Header -->\r\n      <div class=\"sota-header header-primary\">\r\n        <div class=\"header-row\">\r\n          <div class=\"header-icon\">\r\n            <svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z\"/>\r\n              <circle cx=\"7.5\" cy=\"14.5\" r=\"1.5\"/><circle cx=\"16.5\" cy=\"14.5\" r=\"1.5\"/>\r\n            </svg>\r\n          </div>\r\n          <div class=\"header-text\">\r\n            <h2>AI Question Generator</h2>\r\n            <p>Generate contextual questions for your project team</p>\r\n          </div>\r\n        </div>\r\n        <button class=\"header-close\" id=\"close-modal\">\r\n          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Tabs -->\r\n      <div class=\"sota-tabs\">\r\n        <button class=\"sota-tab active\" data-source=\"team\">\r\n          <span class=\"tab-icon\"></span>\r\n          <span>Team Members</span>\r\n        </button>\r\n        <button class=\"sota-tab\" data-source=\"contacts\">\r\n          <span class=\"tab-icon\"></span>\r\n          <span>Project Contacts</span>\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Body -->\r\n      <div class=\"sota-body\">\r\n        <!-- Section: Roles -->\r\n        <div class=\"sota-section\">\r\n          <div class=\"section-title\">\r\n            <span class=\"title-icon\"></span>\r\n            <span>Select a Role</span>\r\n          </div>\r\n          <div id=\"roles-grid\" class=\"sota-grid\">\r\n            <div class=\"sota-loading\">\r\n              <div class=\"spinner-ring\"></div>\r\n              <p>Loading roles...</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Section: Configuration (hidden until role selected) -->\r\n        <div class=\"sota-section\" id=\"config-section\" style=\"display: none;\">\r\n          <div id=\"selected-badge\"></div>\r\n          \r\n          <div class=\"config-row\">\r\n            <label>Questions to generate</label>\r\n            <div class=\"config-buttons\">\r\n              <button class=\"config-btn active\" data-count=\"auto\" title=\"AI determines optimal count\"> Auto</button>\r\n              <button class=\"config-btn\" data-count=\"3\">3</button>\r\n              <button class=\"config-btn\" data-count=\"5\">5</button>\r\n              <button class=\"config-btn\" data-count=\"8\">8</button>\r\n            </div>\r\n          </div>\r\n\r\n          <label class=\"toggle-row\">\r\n            <input type=\"checkbox\" id=\"use-context\" checked>\r\n            <span class=\"toggle-track\"><span class=\"toggle-thumb\"></span></span>\r\n            <span>Use project context (facts, documents)</span>\r\n          </label>\r\n          \r\n          <label class=\"toggle-row\">\r\n            <input type=\"checkbox\" id=\"skip-dupes\" checked>\r\n            <span class=\"toggle-track\"><span class=\"toggle-thumb\"></span></span>\r\n            <span>Skip duplicate questions</span>\r\n          </label>\r\n\r\n          <button class=\"sota-btn-primary\" id=\"btn-generate\" style=\"margin-top: 20px;\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polygon points=\"13 2 3 14 12 14 11 22 21 10 12 10 13 2\"/>\r\n            </svg>\r\n            Generate Questions\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Overlay for generation -->\r\n      <div class=\"sota-overlay\" id=\"gen-overlay\" style=\"display: none;\">\r\n        <div id=\"gen-content\">\r\n          <div class=\"overlay-spinner\"></div>\r\n          <h4 class=\"overlay-title\">Generating questions...</h4>\r\n          <p class=\"overlay-subtitle\">AI is analyzing your project context</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(modal);\r\n\r\n  // State\r\n  type RoleData = { role: string; rolePrompt?: string; members: Array<{ id: string; name: string; photoUrl?: string; email?: string }> };\r\n  let currentSource: 'team' | 'contacts' = 'team';\r\n  let selectedRole: RoleData | null = null;\r\n  let allRoles: RoleData[] = [];\r\n  let questionCount: number | 'auto' = 'auto';\r\n\r\n  // Elements\r\n  const rolesGrid = modal.querySelector('#roles-grid') as HTMLElement;\r\n  const configSection = modal.querySelector('#config-section') as HTMLElement;\r\n  const selectedBadge = modal.querySelector('#selected-badge') as HTMLElement;\r\n  const genOverlay = modal.querySelector('#gen-overlay') as HTMLElement;\r\n  const genContent = modal.querySelector('#gen-content') as HTMLElement;\r\n\r\n  // Helpers\r\n  const getInitials = (name: string) => {\r\n    if (!name) return '?';\r\n    return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n  };\r\n  \r\n  const getRoleIcon = (role: string): string => {\r\n    const r = role.toLowerCase();\r\n    if (r.includes('analyst') || r.includes('data')) return '';\r\n    if (r.includes('manager') || r.includes('lead')) return '';\r\n    if (r.includes('developer') || r.includes('engineer')) return '';\r\n    if (r.includes('design') || r.includes('ux')) return '';\r\n    if (r.includes('product') || r.includes('owner')) return '';\r\n    if (r.includes('qa') || r.includes('test')) return '';\r\n    if (r.includes('support') || r.includes('success')) return '';\r\n    if (r.includes('sales') || r.includes('commercial')) return '';\r\n    if (r.includes('marketing')) return '';\r\n    if (r.includes('security')) return '';\r\n    if (r.includes('devops') || r.includes('infra')) return '';\r\n    if (r.includes('legal')) return '';\r\n    return '';\r\n  };\r\n\r\n  // Load roles based on source\r\n  const loadRoles = async (source: 'team' | 'contacts') => {\r\n    rolesGrid.innerHTML = '<div class=\"sota-loading\"><div class=\"spinner-ring\"></div><p>Loading roles...</p></div>';\r\n    configSection.style.display = 'none';\r\n    selectedRole = null;\r\n\r\n    try {\r\n      let roles: RoleData[] = [];\r\n\r\n      if (source === 'team') {\r\n        const res = await http.get<{ roles: RoleData[] }>('/api/questions/team-roles');\r\n        roles = res.data.roles || [];\r\n      } else {\r\n        // Load from contacts\r\n        const res = await http.get<{ contacts: Array<{ id: string; name: string; role?: string; photo_url?: string; email?: string }> }>('/api/contacts');\r\n        const contacts = res.data.contacts || [];\r\n        \r\n        // Group by role\r\n        const roleMap: Record<string, RoleData> = {};\r\n        for (const c of contacts) {\r\n          if (!c.role) continue;\r\n          if (!roleMap[c.role]) {\r\n            roleMap[c.role] = { role: c.role, members: [] };\r\n          }\r\n          roleMap[c.role].members.push({\r\n            id: c.id,\r\n            name: c.name,\r\n            photoUrl: c.photo_url,\r\n            email: c.email\r\n          });\r\n        }\r\n        roles = Object.values(roleMap);\r\n      }\r\n\r\n      allRoles = roles;\r\n\r\n      if (roles.length === 0) {\r\n        rolesGrid.innerHTML = `\r\n          <div class=\"sota-empty\" style=\"grid-column: 1 / -1;\">\r\n            <div class=\"empty-icon\">${source === 'team' ? '' : ''}</div>\r\n            <h4>No ${source === 'team' ? 'Team Members' : 'Contacts'} with Roles</h4>\r\n            <p>${source === 'team' \r\n              ? 'Add team members with roles in Project Settings' \r\n              : 'Add contacts with roles to this project'}</p>\r\n          </div>\r\n        `;\r\n        return;\r\n      }\r\n\r\n      rolesGrid.innerHTML = roles.map((r, idx) => `\r\n        <div class=\"sota-card\" data-idx=\"${idx}\">\r\n          <div class=\"card-icon\">${getRoleIcon(r.role)}</div>\r\n          <div class=\"card-title\">${escapeHtml(r.role)}</div>\r\n          <div class=\"card-avatars\">\r\n            ${r.members.slice(0, 3).map(m => `\r\n              <div class=\"mini-avatar\" title=\"${escapeHtml(m.name)}\">\r\n                ${m.photoUrl \r\n                  ? `<img src=\"${m.photoUrl}\" alt=\"\" onerror=\"this.style.display='none';this.nextSibling.style.display='flex'\">`\r\n                  : ''}\r\n                <span style=\"${m.photoUrl ? 'display:none' : ''}\">${getInitials(m.name)}</span>\r\n              </div>\r\n            `).join('')}\r\n            ${r.members.length > 3 ? `<div class=\"mini-avatar more\">+${r.members.length - 3}</div>` : ''}\r\n          </div>\r\n          <div class=\"card-subtitle\">${r.members.map(m => m.name).slice(0, 2).join(', ')}${r.members.length > 2 ? '...' : ''}</div>\r\n          <div class=\"card-badge\">${r.members.length}</div>\r\n        </div>\r\n      `).join('');\r\n\r\n      // Bind clicks\r\n      rolesGrid.querySelectorAll('.sota-card').forEach(card => {\r\n        card.addEventListener('click', () => {\r\n          rolesGrid.querySelectorAll('.sota-card').forEach(c => c.classList.remove('selected'));\r\n          card.classList.add('selected');\r\n          \r\n          const idx = parseInt(card.getAttribute('data-idx') || '0', 10);\r\n          selectedRole = allRoles[idx];\r\n          showConfig();\r\n        });\r\n      });\r\n\r\n    } catch (err) {\r\n      rolesGrid.innerHTML = `\r\n        <div class=\"sota-empty\" style=\"grid-column: 1 / -1;\">\r\n          <div class=\"empty-icon\"></div>\r\n          <h4>Failed to Load</h4>\r\n          <p>Could not fetch roles. Please try again.</p>\r\n          <button class=\"sota-btn-primary\" style=\"max-width: 200px; margin: 16px auto 0;\" id=\"retry-load\">Retry</button>\r\n        </div>\r\n      `;\r\n      modal.querySelector('#retry-load')?.addEventListener('click', () => loadRoles(source));\r\n    }\r\n  };\r\n\r\n  // Show config panel\r\n  const showConfig = () => {\r\n    if (!selectedRole) return;\r\n    \r\n    configSection.style.display = 'block';\r\n    selectedBadge.innerHTML = `\r\n      <div class=\"selected-badge\">\r\n        <span class=\"badge-icon\">${getRoleIcon(selectedRole.role)}</span>\r\n        <div class=\"badge-info\">\r\n          <strong>${escapeHtml(selectedRole.role)}</strong>\r\n          <span>${selectedRole.members.map(m => m.name).join(', ')}</span>\r\n        </div>\r\n        <button class=\"badge-clear\" id=\"clear-selection\"></button>\r\n      </div>\r\n    `;\r\n\r\n    modal.querySelector('#clear-selection')?.addEventListener('click', () => {\r\n      selectedRole = null;\r\n      configSection.style.display = 'none';\r\n      rolesGrid.querySelectorAll('.sota-card').forEach(c => c.classList.remove('selected'));\r\n    });\r\n  };\r\n\r\n  // Generate questions\r\n  const generateQuestions = async () => {\r\n    if (!selectedRole) return;\r\n\r\n    genOverlay.style.display = 'flex';\r\n\r\n    try {\r\n      const res = await http.post<{\r\n        generated: number;\r\n        skipped: number;\r\n        questions: Array<{ content: string; priority: string; requester_role: string }>;\r\n      }>('/api/questions/generate-ai', {\r\n        role: selectedRole.role,\r\n        memberIds: selectedRole.members.map(m => m.id),\r\n        count: questionCount,\r\n        includeContext: (modal.querySelector('#use-context') as HTMLInputElement)?.checked ?? true,\r\n        skipDuplicates: (modal.querySelector('#skip-dupes') as HTMLInputElement)?.checked ?? true\r\n      });\r\n\r\n      const q = res.data.questions || [];\r\n\r\n      genContent.innerHTML = `\r\n        <div class=\"sota-success\">\r\n          <div class=\"success-icon\"></div>\r\n          <h4>${res.data.generated} Questions Generated</h4>\r\n          <p>${res.data.skipped > 0 ? `${res.data.skipped} duplicates skipped` : 'All questions created successfully'}</p>\r\n        </div>\r\n        <div class=\"results-list\">\r\n          ${q.slice(0, 5).map(item => `\r\n            <div class=\"result-row\">\r\n              <span class=\"result-badge ${item.priority}\">${item.priority}</span>\r\n              <span class=\"result-text\">${escapeHtml(item.content.length > 70 ? item.content.substring(0, 70) + '...' : item.content)}</span>\r\n            </div>\r\n          `).join('')}\r\n          ${q.length > 5 ? `<p style=\"text-align: center; color: var(--text-muted); margin-top: 8px; font-size: 12px;\">+ ${q.length - 5} more questions</p>` : ''}\r\n        </div>\r\n        <p style=\"text-align: center; color: var(--text-secondary); font-size: 12px; margin-top: 12px;\">\r\n           Questions from <strong>${selectedRole?.role}</strong> perspective<br>\r\n          <span style=\"color: var(--text-muted);\">Use AI Suggest on each question to find who should answer</span>\r\n        </p>\r\n        <button class=\"sota-btn-primary\" id=\"btn-done\">Done</button>\r\n      `;\r\n\r\n      modal.querySelector('#btn-done')?.addEventListener('click', () => {\r\n        modal.remove();\r\n        loadQuestions(panel, props);\r\n      });\r\n\r\n    } catch (err) {\r\n      genContent.innerHTML = `\r\n        <div class=\"sota-error\">\r\n          <div class=\"error-icon\"></div>\r\n          <h4>Generation Failed</h4>\r\n          <p>Something went wrong. Please try again.</p>\r\n          <button class=\"sota-btn-primary\" id=\"retry-gen\" style=\"max-width: 200px; margin: 20px auto 0;\">Retry</button>\r\n        </div>\r\n      `;\r\n      modal.querySelector('#retry-gen')?.addEventListener('click', generateQuestions);\r\n    }\r\n  };\r\n\r\n  // Bind events\r\n  modal.querySelector('#close-modal')?.addEventListener('click', () => modal.remove());\r\n  modal.querySelector('.modal-backdrop')?.addEventListener('click', () => modal.remove());\r\n\r\n  // Source tabs\r\n  modal.querySelectorAll('.sota-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      modal.querySelectorAll('.sota-tab').forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentSource = (tab.getAttribute('data-source') as 'team' | 'contacts') || 'team';\r\n      loadRoles(currentSource);\r\n    });\r\n  });\r\n\r\n  // Count buttons\r\n  modal.querySelectorAll('.config-btn').forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      modal.querySelectorAll('.config-btn').forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n      const countVal = btn.getAttribute('data-count') || 'auto';\r\n      questionCount = countVal === 'auto' ? 'auto' : parseInt(countVal, 10);\r\n    });\r\n  });\r\n\r\n  // Generate button\r\n  modal.querySelector('#btn-generate')?.addEventListener('click', generateQuestions);\r\n\r\n  // Initial load\r\n  loadRoles('team');\r\n}\r\n\r\n/**\r\n * Update count badge\r\n */\r\nfunction updateCount(panel: HTMLElement): void {\r\n  const countEl = panel.querySelector('#questions-count');\r\n  if (countEl) {\r\n    const questions = dataStore.getState().questions;\r\n    countEl.textContent = String(questions.length);\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createQuestionsPanel;\r\n","/**\r\n * Source of Truth Component\r\n * Displays questions, risks, actions, and decisions\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../utils/dom';\r\nimport { uiStore, SotView } from '../stores/ui';\r\nimport { dataStore, Question, Risk, Action, Decision } from '../stores/data';\r\nimport { formatRelativeTime } from '../utils/format';\r\nimport { createQuestionDetailView } from './questions/QuestionDetailView';\r\nimport { Question as QuestionAPI } from '../services/questions';\r\nimport { createQuestionsPanel as createFullQuestionsPanel } from './sot/QuestionsPanel';\r\n\r\nexport interface SourceOfTruthProps {\r\n  onQuestionClick?: (question: Question) => void;\r\n  onRiskClick?: (risk: Risk) => void;\r\n  onActionClick?: (action: Action) => void;\r\n  onDecisionClick?: (decision: Decision) => void;\r\n}\r\n\r\n/**\r\n * Create Source of Truth component\r\n */\r\nexport function createSourceOfTruth(props: SourceOfTruthProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'source-of-truth' });\r\n\r\n  // Tabs\r\n  const tabs = createElement('div', { className: 'tabs' });\r\n  const tabConfigs: Array<{ id: SotView; label: string; icon: string }> = [\r\n    { id: 'questions', label: 'Questions', icon: '' },\r\n    { id: 'risks', label: 'Risks', icon: '' },\r\n    { id: 'actions', label: 'Actions', icon: '' },\r\n    { id: 'decisions', label: 'Decisions', icon: '' },\r\n  ];\r\n\r\n  tabConfigs.forEach(config => {\r\n    const tab = createElement('button', {\r\n      className: 'tab',\r\n    });\r\n    tab.setAttribute('data-tab', config.id);\r\n    tab.innerHTML = `${config.icon} ${config.label} <span class=\"badge\" data-count=\"0\">0</span>`;\r\n\r\n    on(tab, 'click', () => {\r\n      uiStore.setSotView(config.id);\r\n    });\r\n\r\n    tabs.appendChild(tab);\r\n  });\r\n\r\n  container.appendChild(tabs);\r\n\r\n  // Content panels\r\n  const panels = createElement('div', { className: 'tab-panels' });\r\n\r\n  // Use the full QuestionsPanel with Generate button and filters\r\n  const questionsPanel = createFullQuestionsPanel({\r\n    onQuestionClick: props.onQuestionClick as unknown as (q: QuestionAPI) => void,\r\n    useDetailView: true,\r\n    containerElement: container\r\n  });\r\n  questionsPanel.classList.add('tab-panel');\r\n  \r\n  const risksPanel = createRisksPanel(props.onRiskClick);\r\n  const actionsPanel = createActionsPanel(props.onActionClick);\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const decisionsPanel = createDecisionsPanel({\r\n    onDecisionClick: props.onDecisionClick as any,\r\n    useDetailView: true,\r\n    containerElement: container\r\n  });\r\n\r\n  questionsPanel.setAttribute('data-panel', 'questions');\r\n  risksPanel.setAttribute('data-panel', 'risks');\r\n  actionsPanel.setAttribute('data-panel', 'actions');\r\n  decisionsPanel.setAttribute('data-panel', 'decisions');\r\n\r\n  panels.appendChild(questionsPanel);\r\n  panels.appendChild(risksPanel);\r\n  panels.appendChild(actionsPanel);\r\n  panels.appendChild(decisionsPanel);\r\n\r\n  container.appendChild(panels);\r\n\r\n  // Subscribe to UI state changes\r\n  uiStore.subscribe((state) => {\r\n    // Update active tab\r\n    tabs.querySelectorAll('.tab').forEach(tab => {\r\n      const tabId = tab.getAttribute('data-tab');\r\n      if (tabId === state.sotCurrentView) {\r\n        addClass(tab as HTMLElement, 'active');\r\n      } else {\r\n        removeClass(tab as HTMLElement, 'active');\r\n      }\r\n    });\r\n\r\n    // Update active panel\r\n    panels.querySelectorAll('[data-panel]').forEach(panel => {\r\n      const panelId = panel.getAttribute('data-panel');\r\n      if (panelId === state.sotCurrentView) {\r\n        addClass(panel as HTMLElement, 'active');\r\n      } else {\r\n        removeClass(panel as HTMLElement, 'active');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Subscribe to data changes\r\n  dataStore.subscribe((data) => {\r\n    // Update badges\r\n    const questionsBadge = tabs.querySelector('[data-tab=\"questions\"] .badge');\r\n    const risksBadge = tabs.querySelector('[data-tab=\"risks\"] .badge');\r\n    const actionsBadge = tabs.querySelector('[data-tab=\"actions\"] .badge');\r\n    const decisionsBadge = tabs.querySelector('[data-tab=\"decisions\"] .badge');\r\n\r\n    if (questionsBadge) questionsBadge.textContent = String(data.questions.length);\r\n    if (risksBadge) risksBadge.textContent = String(data.risks.length);\r\n    if (actionsBadge) actionsBadge.textContent = String(data.actions.length);\r\n    if (decisionsBadge) decisionsBadge.textContent = String(data.decisions.length);\r\n\r\n    // Re-render panels\r\n    renderQuestions(questionsPanel, data.questions, props.onQuestionClick);\r\n    renderRisks(risksPanel, data.risks, props.onRiskClick);\r\n    renderActions(actionsPanel, data.actions, props.onActionClick);\r\n    renderDecisions(decisionsPanel, data.decisions, props.onDecisionClick);\r\n  });\r\n\r\n  // Set initial active state\r\n  const initialView = uiStore.getState().sotCurrentView;\r\n  const initialTab = tabs.querySelector(`[data-tab=\"${initialView}\"]`);\r\n  const initialPanel = panels.querySelector(`[data-panel=\"${initialView}\"]`);\r\n  if (initialTab) addClass(initialTab as HTMLElement, 'active');\r\n  if (initialPanel) addClass(initialPanel as HTMLElement, 'active');\r\n\r\n  return container;\r\n}\r\n\r\n// NOTE: createQuestionsPanel is now imported from './sot/QuestionsPanel' as createFullQuestionsPanel\r\n// The legacy inline version has been removed in favor of the full-featured panel\r\n\r\n/**\r\n * Render questions list\r\n */\r\nfunction renderQuestions(panel: HTMLElement, questions: Question[], onClick?: (q: Question) => void): void {\r\n  const list = panel.querySelector('.questions-list');\r\n  if (!list) return;\r\n\r\n  if (questions.length === 0) {\r\n    list.innerHTML = '<div class=\"empty-state\">No questions yet</div>';\r\n    return;\r\n  }\r\n\r\n  list.innerHTML = questions.map(q => `\r\n    <div class=\"question-card ${q.status}\" data-id=\"${q.id}\">\r\n      <div class=\"question-header\">\r\n        <span class=\"priority-badge priority-${q.priority}\">${q.priority}</span>\r\n        <span class=\"status-badge ${q.status}\">${q.status}</span>\r\n      </div>\r\n      <div class=\"question-text\">${escapeHtml(q.content || q.question || '')}</div>\r\n      ${q.answer ? `<div class=\"question-answer\">${escapeHtml(q.answer)}</div>` : ''}\r\n      <div class=\"question-meta\">${formatRelativeTime(q.created_at || q.createdAt || new Date().toISOString())}</div>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Always bind click to open detail view\r\n  list.querySelectorAll('.question-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const question = questions.find(q => q.id === id || String(q.id) === id);\r\n      if (question) {\r\n        // Call onClick if provided (for modal fallback)\r\n        if (onClick) {\r\n          onClick(question);\r\n        }\r\n        \r\n        // Show the detail view\r\n        showQuestionDetail(panel, question as unknown as QuestionAPI, questions as unknown as QuestionAPI[]);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show question detail view (replaces the panel content)\r\n */\r\nfunction showQuestionDetail(panel: HTMLElement, question: QuestionAPI, allQuestions: QuestionAPI[]): void {\r\n  // Store original content\r\n  const originalContent = panel.innerHTML;\r\n  \r\n  // Create detail view\r\n  const detailView = createQuestionDetailView({\r\n    question,\r\n    onClose: () => {\r\n      // Restore original content\r\n      panel.innerHTML = originalContent;\r\n      // Re-render questions\r\n      const questions = dataStore.getState().questions;\r\n      renderQuestions(panel, questions);\r\n    },\r\n    onUpdate: (updatedQuestion) => {\r\n      // Update the question in data store\r\n      const questions = dataStore.getState().questions;\r\n      const index = questions.findIndex(q => q.id === updatedQuestion.id || String(q.id) === String(updatedQuestion.id));\r\n      if (index >= 0) {\r\n        questions[index] = updatedQuestion as unknown as Question;\r\n        dataStore.setQuestions(questions);\r\n      }\r\n    },\r\n    onNavigateToQuestion: (questionId) => {\r\n      // Navigate to another question\r\n      const targetQuestion = allQuestions.find(q => String(q.id) === questionId);\r\n      if (targetQuestion) {\r\n        showQuestionDetail(panel, targetQuestion, allQuestions);\r\n      }\r\n    }\r\n  });\r\n  \r\n  // Replace panel content with detail view\r\n  panel.innerHTML = '';\r\n  panel.appendChild(detailView);\r\n}\r\n\r\n/**\r\n * Create risks panel\r\n */\r\nfunction createRisksPanel(onClick?: (r: Risk) => void): HTMLElement {\r\n  const panel = createElement('div', { className: 'tab-panel risks-panel' });\r\n  panel.innerHTML = '<div class=\"risks-list\"></div>';\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Render risks list\r\n */\r\nfunction renderRisks(panel: HTMLElement, risks: Risk[], onClick?: (r: Risk) => void): void {\r\n  const list = panel.querySelector('.risks-list');\r\n  if (!list) return;\r\n\r\n  if (risks.length === 0) {\r\n    list.innerHTML = '<div class=\"empty-state\">No risks identified</div>';\r\n    return;\r\n  }\r\n\r\n  list.innerHTML = risks.map(r => `\r\n    <div class=\"risk-card ${r.impact}-impact\" data-id=\"${r.id}\">\r\n      <div class=\"risk-header\">\r\n        <span class=\"impact-badge impact-${r.impact}\">${r.impact} impact</span>\r\n        <span class=\"probability-badge\">${r.probability} probability</span>\r\n      </div>\r\n      <div class=\"risk-description\">${escapeHtml(r.description || r.content || '')}</div>\r\n      ${r.mitigation ? `<div class=\"risk-mitigation\">Mitigation: ${escapeHtml(r.mitigation)}</div>` : ''}\r\n    </div>\r\n  `).join('');\r\n\r\n  if (onClick) {\r\n    list.querySelectorAll('.risk-card').forEach(card => {\r\n      on(card as HTMLElement, 'click', () => {\r\n        const id = card.getAttribute('data-id');\r\n        const risk = risks.find(r => r.id === id);\r\n        if (risk) onClick(risk);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Create actions panel\r\n */\r\nfunction createActionsPanel(onClick?: (a: Action) => void): HTMLElement {\r\n  const panel = createElement('div', { className: 'tab-panel actions-panel' });\r\n  panel.innerHTML = '<div class=\"actions-list\"></div>';\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Render actions list\r\n */\r\nfunction renderActions(panel: HTMLElement, actions: Action[], onClick?: (a: Action) => void): void {\r\n  const list = panel.querySelector('.actions-list');\r\n  if (!list) return;\r\n\r\n  if (actions.length === 0) {\r\n    list.innerHTML = '<div class=\"empty-state\">No actions defined</div>';\r\n    return;\r\n  }\r\n\r\n  list.innerHTML = actions.map(a => `\r\n    <div class=\"action-card ${a.status}\" data-id=\"${a.id}\">\r\n      <div class=\"action-header\">\r\n        <span class=\"priority-badge priority-${a.priority}\">${a.priority}</span>\r\n        <span class=\"status-badge ${a.status}\">${a.status.replace('_', ' ')}</span>\r\n      </div>\r\n      <div class=\"action-task\">${escapeHtml(a.task)}</div>\r\n      <div class=\"action-meta\">\r\n        ${a.assignee ? `<span>Assigned to: ${escapeHtml(a.assignee)}</span>` : ''}\r\n        ${a.dueDate ? `<span>Due: ${a.dueDate}</span>` : ''}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  if (onClick) {\r\n    list.querySelectorAll('.action-card').forEach(card => {\r\n      on(card as HTMLElement, 'click', () => {\r\n        const id = card.getAttribute('data-id');\r\n        const action = actions.find(a => a.id === id);\r\n        if (action) onClick(action);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Create decisions panel\r\n */\r\nfunction createDecisionsPanel(propsOrCallback?: { onDecisionClick?: (d: Decision) => void; useDetailView?: boolean; containerElement?: HTMLElement } | ((d: Decision) => void)): HTMLElement {\r\n  const panel = createElement('div', { className: 'tab-panel decisions-panel' });\r\n  panel.innerHTML = '<div class=\"decisions-list\"></div>';\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Render decisions list\r\n */\r\nfunction renderDecisions(panel: HTMLElement, decisions: Decision[], onClick?: (d: Decision) => void): void {\r\n  const list = panel.querySelector('.decisions-list');\r\n  if (!list) return;\r\n\r\n  if (decisions.length === 0) {\r\n    list.innerHTML = '<div class=\"empty-state\">No decisions recorded</div>';\r\n    return;\r\n  }\r\n\r\n  list.innerHTML = decisions.map(d => `\r\n    <div class=\"decision-card\" data-id=\"${d.id}\">\r\n      <div class=\"decision-header\">\r\n        <span class=\"status-badge ${d.status}\">${d.status}</span>\r\n      </div>\r\n      <div class=\"decision-text\">${escapeHtml((d as any).content ?? d.decision ?? '')}</div>\r\n      ${d.rationale ? `<div class=\"decision-rationale\">Rationale: ${escapeHtml(d.rationale)}</div>` : ''}\r\n      <div class=\"decision-meta\">\r\n        ${((d as any).made_by ?? d.madeBy) ? `<span>By: ${escapeHtml((d as any).made_by ?? d.madeBy ?? '')}</span>` : ''}\r\n        <span>${formatRelativeTime((d as any).decided_at ?? (d as any).created_at ?? d.madeAt ?? '')}</span>\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  if (onClick) {\r\n    list.querySelectorAll('.decision-card').forEach(card => {\r\n      on(card as HTMLElement, 'click', () => {\r\n        const id = card.getAttribute('data-id');\r\n        const decision = decisions.find(d => d.id === id);\r\n        if (decision) onClick(decision);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Mount to container\r\n */\r\nexport function mountSourceOfTruth(selector: string, props: SourceOfTruthProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`SourceOfTruth: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const sot = createSourceOfTruth(props);\r\n  container.appendChild(sot);\r\n  return sot;\r\n}\r\n\r\nexport default createSourceOfTruth;\r\n","/**\r\n * Risk Modal Component\r\n * Create, view and edit risks\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { Risk } from '../../stores/data';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\nimport { risksService } from '../../services/risks';\r\n\r\nconst MODAL_ID = 'risk-modal';\r\n\r\nexport interface RiskModalProps {\r\n  mode: 'view' | 'edit' | 'create';\r\n  risk?: Risk;\r\n  onSave?: (risk: Risk) => void;\r\n  onDelete?: (riskId: string) => void;\r\n}\r\n\r\n/**\r\n * Show risk modal\r\n */\r\nexport function showRiskModal(props: RiskModalProps): void {\r\n  const { mode, risk, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit' && risk?.id;\r\n  const isView = mode === 'view';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'risk-modal-content' });\r\n\r\n  const riskDesc = risk?.description ?? (risk as { content?: string })?.content ?? '';\r\n  const riskProb = risk?.probability ?? (risk as { likelihood?: string })?.likelihood ?? 'medium';\r\n  const riskCreated = risk?.createdAt ?? (risk as { created_at?: string })?.created_at ?? '';\r\n\r\n  if (isView && risk) {\r\n    content.innerHTML = `\r\n      <div class=\"risk-view\">\r\n        <div class=\"risk-meta\">\r\n          <span class=\"impact-badge impact-${risk.impact}\">${risk.impact} impact</span>\r\n          <span class=\"probability-badge\">${riskProb} probability</span>\r\n          <span class=\"status-badge ${risk.status}\">${risk.status}</span>\r\n        </div>\r\n        \r\n        <div class=\"risk-description-large\">\r\n          ${escapeHtml(riskDesc)}\r\n        </div>\r\n        \r\n        ${risk.mitigation ? `\r\n          <div class=\"risk-mitigation-section\">\r\n            <h4>Mitigation Strategy</h4>\r\n            <p>${escapeHtml(risk.mitigation)}</p>\r\n          </div>\r\n        ` : ''}\r\n        \r\n        <div class=\"risk-date\">Created ${formatRelativeTime(riskCreated)}</div>\r\n      </div>\r\n    `;\r\n  } else {\r\n    const riskOwner = risk?.owner ?? '';\r\n    content.innerHTML = `\r\n      <form id=\"risk-form\" class=\"risk-form\">\r\n        <div class=\"form-group\" style=\"display: flex; align-items: center; gap: 12px; flex-wrap: wrap;\">\r\n          <label for=\"risk-description\" style=\"margin-bottom: 0;\">Risk Description *</label>\r\n          <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-ai-suggest-btn\" title=\"Suggest owner and mitigation from description\"> AI suggest</button>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <textarea id=\"risk-description\" rows=\"3\" required \r\n                    placeholder=\"Describe the risk...\">${riskDesc}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"risk-impact\">Impact</label>\r\n            <select id=\"risk-impact\">\r\n              <option value=\"low\" ${risk?.impact === 'low' ? 'selected' : ''}>Low</option>\r\n              <option value=\"medium\" ${risk?.impact === 'medium' || !risk ? 'selected' : ''}>Medium</option>\r\n              <option value=\"high\" ${risk?.impact === 'high' ? 'selected' : ''}>High</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label for=\"risk-probability\">Probability</label>\r\n            <select id=\"risk-probability\">\r\n              <option value=\"low\" ${riskProb === 'low' ? 'selected' : ''}>Low</option>\r\n              <option value=\"medium\" ${riskProb === 'medium' ? 'selected' : ''}>Medium</option>\r\n              <option value=\"high\" ${riskProb === 'high' ? 'selected' : ''}>High</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"risk-status\">Status</label>\r\n          <select id=\"risk-status\">\r\n            <option value=\"open\" ${risk?.status === 'open' || !risk ? 'selected' : ''}>Open</option>\r\n            <option value=\"mitigating\" ${risk?.status === 'mitigating' ? 'selected' : ''}>Mitigating</option>\r\n            <option value=\"mitigated\" ${risk?.status === 'mitigated' ? 'selected' : ''}>Mitigated</option>\r\n            <option value=\"accepted\" ${risk?.status === 'accepted' ? 'selected' : ''}>Accepted</option>\r\n            <option value=\"closed\" ${risk?.status === 'closed' ? 'selected' : ''}>Closed</option>\r\n          </select>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"risk-owner\">Owner</label>\r\n          <input type=\"text\" id=\"risk-owner\" class=\"form-input\" placeholder=\"Who owns this risk?\" value=\"${escapeHtml(riskOwner)}\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"risk-mitigation\">Mitigation Strategy</label>\r\n          <textarea id=\"risk-mitigation\" rows=\"3\" \r\n                    placeholder=\"How will this risk be mitigated?\">${risk?.mitigation || ''}</textarea>\r\n        </div>\r\n      </form>\r\n    `;\r\n\r\n    const suggestBtn = content.querySelector('#risk-ai-suggest-btn');\r\n    if (suggestBtn) {\r\n      on(suggestBtn as HTMLElement, 'click', async () => {\r\n        const descEl = content.querySelector('#risk-description') as HTMLTextAreaElement;\r\n        const impactEl = content.querySelector('#risk-impact') as HTMLSelectElement;\r\n        const probEl = content.querySelector('#risk-probability') as HTMLSelectElement;\r\n        const contentText = descEl?.value?.trim() || '';\r\n        if (!contentText) {\r\n          toast.error('Enter a risk description first');\r\n          return;\r\n        }\r\n        (suggestBtn as HTMLButtonElement).disabled = true;\r\n        (suggestBtn as HTMLButtonElement).textContent = '';\r\n        try {\r\n          const result = await risksService.suggest({\r\n            content: contentText,\r\n            impact: impactEl?.value || 'medium',\r\n            likelihood: probEl?.value || 'medium',\r\n          });\r\n          const ownerEl = content.querySelector('#risk-owner') as HTMLInputElement;\r\n          const mitigationEl = content.querySelector('#risk-mitigation') as HTMLTextAreaElement;\r\n          if (ownerEl && result.suggested_owner) ownerEl.value = result.suggested_owner;\r\n          if (mitigationEl && result.suggested_mitigation) mitigationEl.value = result.suggested_mitigation;\r\n          toast.success('Owner and mitigation suggested');\r\n        } catch (e) {\r\n          toast.error((e as Error).message || 'AI suggest failed');\r\n        } finally {\r\n          (suggestBtn as HTMLButtonElement).disabled = false;\r\n          (suggestBtn as HTMLButtonElement).textContent = ' AI suggest';\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (isView) {\r\n    const editBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Edit',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n    on(editBtn, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showRiskModal({ ...props, mode: 'edit' });\r\n    });\r\n\r\n    footer.appendChild(closeBtn);\r\n    footer.appendChild(editBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const saveBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: isEdit ? 'Save Changes' : 'Create Risk',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(saveBtn, 'click', async () => {\r\n      const form = content.querySelector('#risk-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\r\n\r\n      const desc = getValue('risk-description');\r\n      const owner = getValue('risk-owner') || undefined;\r\n      const riskData: Risk & { content?: string; likelihood?: string; owner?: string } = {\r\n        id: risk?.id || `risk-${Date.now()}`,\r\n        description: desc,\r\n        content: desc,\r\n        impact: getValue('risk-impact') as Risk['impact'],\r\n        probability: getValue('risk-probability') as Risk['probability'],\r\n        likelihood: getValue('risk-probability') as 'low' | 'medium' | 'high',\r\n        status: getValue('risk-status') as Risk['status'],\r\n        mitigation: getValue('risk-mitigation') || undefined,\r\n        owner,\r\n        createdAt: risk?.createdAt ?? (risk as { created_at?: string })?.created_at ?? new Date().toISOString(),\r\n      };\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        if (isEdit) {\r\n          await http.put(`/api/risks/${risk!.id}`, { content: riskData.content ?? riskData.description, impact: riskData.impact, likelihood: riskData.likelihood ?? riskData.probability, mitigation: riskData.mitigation, status: riskData.status, owner: riskData.owner });\r\n          toast.success('Risk updated');\r\n        } else {\r\n          const response = await http.post<{ id: string; risk: Risk }>('/api/risks', { content: riskData.content ?? riskData.description, impact: riskData.impact, likelihood: riskData.likelihood ?? riskData.probability, mitigation: riskData.mitigation, status: riskData.status, owner: riskData.owner });\r\n          const created = response.data.risk;\r\n          if (created) riskData.id = created.id as string;\r\n          else riskData.id = response.data.id as string;\r\n          toast.success('Risk created');\r\n        }\r\n\r\n        onSave?.({ ...riskData, description: riskData.description ?? riskData.content, content: riskData.content ?? riskData.description } as Risk);\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Risk';\r\n      }\r\n    });\r\n\r\n    if (isEdit) {\r\n      const deleteBtn = createElement('button', {\r\n        className: 'btn btn-danger',\r\n        textContent: 'Delete',\r\n      });\r\n\r\n      on(deleteBtn, 'click', async () => {\r\n        const { confirm } = await import('../Modal');\r\n        const confirmed = await confirm(\r\n          'Are you sure you want to delete this risk?',\r\n          {\r\n            title: 'Delete Risk',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await http.delete(`/api/risks/${risk!.id}`);\r\n            toast.success('Risk deleted');\r\n            onDelete?.(String(risk!.id));\r\n            closeModal(MODAL_ID);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n\r\n      footer.appendChild(saveBtn);\r\n      footer.appendChild(cancelBtn);\r\n      footer.appendChild(deleteBtn);\r\n    } else {\r\n      footer.appendChild(saveBtn);\r\n      footer.appendChild(cancelBtn);\r\n    }\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: isView ? 'Risk Details' : (isEdit ? 'Edit Risk' : 'New Risk'),\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showRiskModal;\r\n","/**\r\n * Risk Detail View\r\n * Full-page view for risk details: content, impact, likelihood, mitigation, status, owner, source, timeline\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Risk, RiskEvent, RiskOwnerSuggestion, risksService } from '../../services/risks';\r\nimport { contactsService, Contact } from '../../services/contacts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\r\n\r\nexport interface RiskDetailViewProps {\r\n  risk: Risk;\r\n  onClose: () => void;\r\n  onUpdate?: (risk: Risk) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nfunction getScoreColor(score: number): string {\r\n  if (score >= 70) return 'var(--success, #4ecdc4)';\r\n  if (score >= 50) return 'var(--warning, #ffe66d)';\r\n  return 'var(--text-muted, #6a6a8a)';\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .trim()\r\n    .split(/\\s+/)\r\n    .map((s) => s[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .substring(0, 2);\r\n}\r\n\r\nfunction getRiskEventIcon(eventType: string): string {\r\n  const icons: Record<string, string> = {\r\n    created: '',\r\n    updated: '',\r\n    deleted: '',\r\n    restored: '',\r\n  };\r\n  return icons[eventType] || '';\r\n}\r\n\r\nfunction getRiskEventDescription(ev: RiskEvent): string {\r\n  const data = ev.event_data || {};\r\n  const actor = ev.actor_name ? ` by ${ev.actor_name}` : '';\r\n\r\n  switch (ev.event_type) {\r\n    case 'created':\r\n      return `Created${actor}`;\r\n    case 'updated': {\r\n      const changes = (data.changes as Array<{ field: string; from: string; to: string }>) || [];\r\n      if (changes.length === 0) return `Updated${actor}`;\r\n      if (changes.length === 1) {\r\n        const c = changes[0];\r\n        const toStr = String(c.to).trim() ? c.to : '';\r\n        const fromStr = String(c.from).trim() ? c.from : '';\r\n        return `${c.field} changed: ${fromStr}  ${toStr}${actor}`;\r\n      }\r\n      return `${changes.map((c) => `${c.field}: ${c.from || ''}  ${c.to || ''}`).join('; ')}${actor}`;\r\n    }\r\n    case 'deleted':\r\n      return `Deleted${data.reason ? ` (${data.reason})` : ''}${actor}`;\r\n    case 'restored':\r\n      return `Restored${actor}`;\r\n    default:\r\n      return ev.event_type;\r\n  }\r\n}\r\n\r\nexport function createRiskDetailView(props: RiskDetailViewProps): HTMLElement {\r\n  const { risk, onClose, onUpdate } = props;\r\n\r\n  const container = createElement('div', { className: 'risk-detail-view question-detail-view' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header risk-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Risks</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Risk #${String(risk.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        <span class=\"status-badge status-${(risk.status || 'open').toLowerCase()}\">${escapeHtml(String(risk.status))}</span>\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content risk-detail-content\">\r\n      <div id=\"risk-view-content\">\r\n      <section class=\"detail-section risk-main\">\r\n        <div class=\"question-badges risk-badges\">\r\n          ${risk.impact ? `<span class=\"priority-pill impact-${risk.impact}\">${escapeHtml(risk.impact)} impact</span>` : ''}\r\n          ${risk.likelihood ? `<span class=\"priority-pill likelihood-${risk.likelihood}\">${escapeHtml(risk.likelihood)} likelihood</span>` : ''}\r\n          ${risk.generation_source ? `<span class=\"status-pill\">${escapeHtml(risk.generation_source)}</span>` : ''}\r\n          <span class=\"question-date risk-date\">Created ${formatRelativeTime(risk.created_at)}</span>\r\n        </div>\r\n        <h2 class=\"question-text risk-content-text\">${escapeHtml(risk.content)}</h2>\r\n      </section>\r\n\r\n      <div class=\"detail-columns\">\r\n        <div class=\"detail-column-left\">\r\n          <!-- Assignment (Owner) Section - SOTA (aligned with Questions) -->\r\n          <section class=\"detail-section\" id=\"risk-assignment-section\">\r\n            <div class=\"section-header-sota\">\r\n              <h3>\r\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Assignment\r\n                <span class=\"section-subtitle\">Who should own this risk?</span>\r\n              </h3>\r\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"risk-ai-suggest-btn\" title=\"Suggest owner and mitigation from risk content\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI Suggest\r\n              </button>\r\n            </div>\r\n\r\n            <!-- Current Assignment (Owner) Display -->\r\n            <div id=\"risk-current-assignment\" class=\"current-assignment-card\">\r\n              ${risk.owner ? `\r\n                <div class=\"assigned-contact-display\">\r\n                  <div class=\"contact-avatar-lg\" id=\"risk-assigned-avatar\">${getInitials(risk.owner)}</div>\r\n                  <div class=\"contact-details\">\r\n                    <div class=\"contact-name-lg\">${escapeHtml(risk.owner)}</div>\r\n                    <div class=\"contact-role-sm\" id=\"risk-assigned-role\"></div>\r\n                  </div>\r\n                  <button class=\"btn-change-assignment\" id=\"risk-change-owner-btn\" type=\"button\">\r\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                    Change\r\n                  </button>\r\n                </div>\r\n              ` : `\r\n                <div class=\"no-assignment\">\r\n                  <div class=\"no-assignment-icon\">\r\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\r\n                  </div>\r\n                  <span>No one assigned</span>\r\n                  <p class=\"no-assignment-hint\">Use AI Suggest or choose manually</p>\r\n                  <button class=\"btn-assign-now\" id=\"risk-show-picker-btn\" type=\"button\">Choose Manually</button>\r\n                </div>\r\n              `}\r\n            </div>\r\n\r\n            <!-- Contact Picker (hidden by default) -->\r\n            <div id=\"risk-contact-picker\" class=\"contact-picker-sota\" style=\"display: none;\">\r\n              <div class=\"picker-search\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\r\n                <input type=\"text\" id=\"risk-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"risk-contact-list\" class=\"contact-list-grid\">Loading...</div>\r\n            </div>\r\n\r\n            <!-- AI Suggestions Panel -->\r\n            <div id=\"risk-suggestions-panel\" class=\"suggestions-panel-sota risk-suggestions-panel\" style=\"display: none;\"></div>\r\n\r\n            <!-- Mitigation (below assignment) -->\r\n            <div class=\"risk-mitigation-block\">\r\n              <strong>Mitigation</strong>\r\n              <p id=\"risk-detail-mitigation\" class=\"risk-mitigation\">${risk.mitigation ? escapeHtml(risk.mitigation) : '<span class=\"text-muted\">No mitigation recorded</span>'}</p>\r\n            </div>\r\n          </section>\r\n\r\n          <section class=\"detail-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Source</h3>\r\n            </div>\r\n            ${risk.source_file ? `<p class=\"source-file\">${escapeHtml(risk.source_file)}</p>` : ''}\r\n            ${risk.source_document_id ? `\r\n              <p class=\"source-doc\">\r\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(risk.source_document_id))}\">View source document</a>\r\n              </p>\r\n            ` : ''}\r\n            ${!risk.source_file && !risk.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\r\n          </section>\r\n        </div>\r\n\r\n        <div class=\"detail-column-right\">\r\n          <section class=\"detail-section metadata-section\">\r\n            <h3>Metadata</h3>\r\n            <dl class=\"metadata-list\">\r\n              <dt>Created</dt>\r\n              <dd>${formatDate(risk.created_at)}</dd>\r\n              ${risk.updated_at ? `<dt>Updated</dt><dd>${formatDate(risk.updated_at)}</dd>` : ''}\r\n            </dl>\r\n          </section>\r\n\r\n          <section class=\"detail-section\" id=\"risk-timeline-section\">\r\n            <h3>Timeline</h3>\r\n            <div id=\"timeline-content\" class=\"timeline-content\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"detail-actions\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-risk-btn\">Edit</button>\r\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-risk-btn\">Delete</button>\r\n      </div>\r\n      </div>\r\n\r\n      <div id=\"risk-edit-form\" class=\"risk-detail-edit-form\" style=\"display: none;\">\r\n        <form id=\"risk-inline-form\" class=\"risk-form\">\r\n          <div class=\"form-group\">\r\n            <div style=\"display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px; margin-bottom: 6px;\">\r\n              <label for=\"risk-edit-content\" style=\"margin-bottom: 0;\">Risk description *</label>\r\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"risk-edit-ai-suggest-btn\" title=\"Suggest owner and mitigation from description\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI suggest\r\n              </button>\r\n            </div>\r\n            <textarea id=\"risk-edit-content\" rows=\"3\" required placeholder=\"Describe the risk...\">${escapeHtml(risk.content || '')}</textarea>\r\n          </div>\r\n          <div id=\"risk-edit-suggestions-panel\" class=\"suggestions-panel-sota risk-suggestions-panel\" style=\"display: none; margin-bottom: 16px;\"></div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group\">\r\n              <label for=\"risk-edit-impact\">Impact</label>\r\n              <select id=\"risk-edit-impact\">\r\n                <option value=\"low\" ${risk.impact === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${risk.impact === 'medium' || !risk.impact ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${risk.impact === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"risk-edit-likelihood\">Likelihood</label>\r\n              <select id=\"risk-edit-likelihood\">\r\n                <option value=\"low\" ${risk.likelihood === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${risk.likelihood === 'medium' || !risk.likelihood ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${risk.likelihood === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"risk-edit-status\">Status</label>\r\n              <select id=\"risk-edit-status\">\r\n                <option value=\"open\" ${risk.status === 'open' || !risk.status ? 'selected' : ''}>Open</option>\r\n                <option value=\"mitigating\" ${risk.status === 'mitigating' ? 'selected' : ''}>Mitigating</option>\r\n                <option value=\"mitigated\" ${risk.status === 'mitigated' ? 'selected' : ''}>Mitigated</option>\r\n                <option value=\"accepted\" ${risk.status === 'accepted' ? 'selected' : ''}>Accepted</option>\r\n                <option value=\"closed\" ${risk.status === 'closed' ? 'selected' : ''}>Closed</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group risk-owner-picker-wrap\">\r\n            <label>Owner</label>\r\n            <input type=\"hidden\" id=\"risk-edit-owner\" value=\"${escapeHtml(risk.owner || '')}\">\r\n            <div class=\"risk-owner-picker-trigger\" id=\"risk-owner-picker-trigger\" title=\"Click to select from project contacts\">\r\n              <span class=\"risk-owner-picker-value\" id=\"risk-owner-picker-value\">${risk.owner ? escapeHtml(risk.owner) : '<span class=\"text-muted\">Select owner...</span>'}</span>\r\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n            </div>\r\n            <div id=\"risk-owner-picker-dropdown\" class=\"risk-owner-picker-dropdown\" style=\"display: none;\">\r\n              <div class=\"risk-owner-picker-search\">\r\n                <input type=\"text\" id=\"risk-owner-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"risk-owner-picker-list\" class=\"risk-owner-picker-list\">Loading...</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"risk-edit-mitigation\">Mitigation strategy</label>\r\n            <textarea id=\"risk-edit-mitigation\" rows=\"3\" placeholder=\"How will this risk be mitigated?\">${escapeHtml(risk.mitigation || '')}</textarea>\r\n          </div>\r\n        </form>\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"risk-save-btn\">Save</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"risk-cancel-edit-btn\">Cancel</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"risk-delete-in-edit-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  const viewContent = container.querySelector('#risk-view-content') as HTMLElement;\r\n  const editForm = container.querySelector('#risk-edit-form') as HTMLElement;\r\n\r\n  const editBtn = container.querySelector('#edit-risk-btn');\r\n  if (editBtn && viewContent && editForm) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      viewContent.style.display = 'none';\r\n      editForm.style.display = 'block';\r\n    });\r\n  }\r\n\r\n  const cancelEditBtn = container.querySelector('#risk-cancel-edit-btn');\r\n  if (cancelEditBtn && viewContent && editForm) {\r\n    on(cancelEditBtn as HTMLElement, 'click', () => {\r\n      editForm.style.display = 'none';\r\n      viewContent.style.display = '';\r\n    });\r\n  }\r\n\r\n  const saveBtn = container.querySelector('#risk-save-btn');\r\n  if (saveBtn && editForm && onUpdate) {\r\n    on(saveBtn as HTMLElement, 'click', async () => {\r\n      const form = container.querySelector('#risk-inline-form') as HTMLFormElement;\r\n      if (!form?.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n      const contentEl = container.querySelector('#risk-edit-content') as HTMLTextAreaElement;\r\n      const impactEl = container.querySelector('#risk-edit-impact') as HTMLSelectElement;\r\n      const likelihoodEl = container.querySelector('#risk-edit-likelihood') as HTMLSelectElement;\r\n      const statusEl = container.querySelector('#risk-edit-status') as HTMLSelectElement;\r\n      const ownerEl = container.querySelector('#risk-edit-owner') as HTMLInputElement;\r\n      const mitigationEl = container.querySelector('#risk-edit-mitigation') as HTMLTextAreaElement;\r\n      const content = contentEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.error('Risk description is required');\r\n        return;\r\n      }\r\n      (saveBtn as HTMLButtonElement).disabled = true;\r\n      (saveBtn as HTMLButtonElement).textContent = 'Saving...';\r\n      try {\r\n        const updated = await risksService.update(risk.id, {\r\n          content,\r\n          impact: (impactEl?.value || 'medium') as Risk['impact'],\r\n          likelihood: (likelihoodEl?.value || 'medium') as Risk['likelihood'],\r\n          status: (statusEl?.value || 'open') as Risk['status'],\r\n          owner: ownerEl?.value?.trim() || undefined,\r\n          mitigation: mitigationEl?.value?.trim() || undefined,\r\n        });\r\n        toast.success('Risk updated');\r\n        onUpdate(updated);\r\n      } catch {\r\n        toast.error('Failed to save');\r\n      } finally {\r\n        (saveBtn as HTMLButtonElement).disabled = false;\r\n        (saveBtn as HTMLButtonElement).textContent = 'Save';\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteInEditBtn = container.querySelector('#risk-delete-in-edit-btn');\r\n  if (deleteInEditBtn) {\r\n    on(deleteInEditBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this risk?')) return;\r\n      try {\r\n        await risksService.delete(risk.id);\r\n        toast.success('Risk deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Owner contact picker in edit form (project contacts with cards)\r\n  const ownerPickerTrigger = container.querySelector('#risk-owner-picker-trigger');\r\n  const ownerPickerDropdown = container.querySelector('#risk-owner-picker-dropdown') as HTMLElement;\r\n  const ownerPickerValue = container.querySelector('#risk-owner-picker-value');\r\n  const ownerHiddenInput = container.querySelector('#risk-edit-owner') as HTMLInputElement;\r\n  const ownerPickerList = container.querySelector('#risk-owner-picker-list') as HTMLElement;\r\n  const ownerPickerSearch = container.querySelector('#risk-owner-picker-search') as HTMLInputElement;\r\n\r\n  if (ownerPickerTrigger && ownerPickerDropdown && ownerPickerList && ownerHiddenInput) {\r\n    let editFormContacts: Contact[] = [];\r\n    const renderOwnerPickerList = (filter = '') => {\r\n      const filtered = filter\r\n        ? editFormContacts.filter(\r\n            (c) =>\r\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n          )\r\n        : editFormContacts;\r\n      if (editFormContacts.length === 0) {\r\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n        return;\r\n      }\r\n      if (filtered.length === 0) {\r\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n        return;\r\n      }\r\n      ownerPickerList.innerHTML = filtered\r\n        .map((c) => {\r\n          const photoUrl = c.photoUrl || c.avatarUrl;\r\n          const selected = (ownerHiddenInput?.value || '').trim() === (c.name || '').trim();\r\n          return `\r\n            <div class=\"risk-owner-card-picker ${selected ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"risk-owner-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n              <div class=\"risk-owner-card-info\">\r\n                <div class=\"risk-owner-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"risk-owner-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `;\r\n        })\r\n        .join('');\r\n      ownerPickerList.querySelectorAll('.risk-owner-card-picker').forEach((card) => {\r\n        on(card as HTMLElement, 'click', () => {\r\n          const name = card.getAttribute('data-contact-name') || '';\r\n          ownerHiddenInput.value = name;\r\n          if (ownerPickerValue) ownerPickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select owner...</span>';\r\n          ownerPickerDropdown.style.display = 'none';\r\n        });\r\n      });\r\n    };\r\n    on(ownerPickerTrigger as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const isOpen = ownerPickerDropdown.style.display === 'block';\r\n      ownerPickerDropdown.style.display = isOpen ? 'none' : 'block';\r\n      if (!isOpen && editFormContacts.length === 0) {\r\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          editFormContacts = res?.contacts || [];\r\n          renderOwnerPickerList(ownerPickerSearch?.value || '');\r\n        } catch {\r\n          ownerPickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        }\r\n      } else if (!isOpen) renderOwnerPickerList(ownerPickerSearch?.value || '');\r\n    });\r\n    if (ownerPickerSearch) {\r\n      ownerPickerSearch.addEventListener('input', () => renderOwnerPickerList(ownerPickerSearch.value));\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.risk-owner-picker-wrap') && ownerPickerDropdown?.style.display === 'block') {\r\n        ownerPickerDropdown.style.display = 'none';\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI suggest in edit form (fill owner + mitigation)\r\n  const editAiSuggestBtn = container.querySelector('#risk-edit-ai-suggest-btn');\r\n  const editSuggestionsPanel = container.querySelector('#risk-edit-suggestions-panel') as HTMLElement;\r\n  if (editAiSuggestBtn && editSuggestionsPanel) {\r\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const contentEl = container.querySelector('#risk-edit-content') as HTMLTextAreaElement;\r\n      const content = contentEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.error('Enter a risk description first');\r\n        return;\r\n      }\r\n      const btn = editAiSuggestBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.innerHTML = '<span class=\"spin\"></span> Analyzing...';\r\n      editSuggestionsPanel.style.display = 'block';\r\n      editSuggestionsPanel.innerHTML = '<div class=\"suggestions-loading\"><div class=\"loading-text\">AI is suggesting owners and mitigation...</div></div>';\r\n      try {\r\n        const [result, contactsRes] = await Promise.all([\r\n          risksService.suggest({ content, impact: (container.querySelector('#risk-edit-impact') as HTMLSelectElement)?.value || 'medium', likelihood: (container.querySelector('#risk-edit-likelihood') as HTMLSelectElement)?.value || 'medium' }),\r\n          contactsService.getAll(),\r\n        ]);\r\n        const contacts: Contact[] = contactsRes?.contacts || [];\r\n        const owners: RiskOwnerSuggestion[] = result.suggested_owners?.length ? result.suggested_owners : result.suggested_owner ? [{ name: result.suggested_owner, reason: '', score: 0 }] : [];\r\n        const mitigation = result.suggested_mitigation || '';\r\n        if (owners.length === 0 && !mitigation) {\r\n          editSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\"><div class=\"no-suggestions-text\">No suggestions</div><button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close</button></div>';\r\n        } else {\r\n          editSuggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\"><div class=\"ai-badge\"> AI Recommended</div></div>\r\n            ${owners.length > 0 ? `<div class=\"suggestions-list-sota\">${owners.map((s, i) => {\r\n              const contact = contacts.find((c) => (c.name || '').trim().toLowerCase() === (s.name || '').trim().toLowerCase());\r\n              const photoUrl = contact?.photoUrl || contact?.avatarUrl || (contact as { photo_url?: string })?.photo_url || (contact as { avatar_url?: string })?.avatar_url;\r\n              const roleOrReason = contact?.role ?? s.reason ?? '';\r\n              const score = s.score ?? 0;\r\n              const scoreColor = getScoreColor(score);\r\n              return `<div class=\"suggestion-card-sota risk-owner-card\" data-owner-name=\"${escapeHtml(s.name || '')}\">\r\n                <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                <div class=\"suggestion-info-sota\"><div class=\"suggestion-name-sota\">${escapeHtml(s.name || '')}</div>${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}</div>\r\n                ${score > 0 ? `<div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\"><div class=\"score-value\">${score}%</div></div>` : ''}\r\n                <button type=\"button\" class=\"btn-select-suggestion\">Assign</button>\r\n              </div>`;\r\n            }).join('')}</div>` : ''}\r\n            ${mitigation ? `<div class=\"risk-suggestion-card risk-mitigation-suggestion\"><strong>Suggested mitigation</strong><p class=\"risk-suggestion-mitigation\">${escapeHtml(mitigation)}</p><button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-edit-apply-mitigation-btn\">Apply mitigation</button></div>` : ''}\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close suggestions</button></div>\r\n          `;\r\n          editSuggestionsPanel.querySelectorAll('.risk-owner-card .btn-select-suggestion').forEach((assignBtn) => {\r\n            const card = (assignBtn as HTMLElement).closest('.risk-owner-card');\r\n            const name = card?.getAttribute('data-owner-name') || '';\r\n            if (!name) return;\r\n            on(assignBtn as HTMLElement, 'click', () => {\r\n              if (ownerHiddenInput) ownerHiddenInput.value = name;\r\n              if (ownerPickerValue) ownerPickerValue.innerHTML = escapeHtml(name);\r\n              editSuggestionsPanel.style.display = 'none';\r\n              toast.success(`Owner set to ${name}`);\r\n            });\r\n          });\r\n          const applyMitigationBtn = editSuggestionsPanel.querySelector('#risk-edit-apply-mitigation-btn');\r\n          if (applyMitigationBtn && mitigation) {\r\n            on(applyMitigationBtn as HTMLElement, 'click', () => {\r\n              const mitigationEl = container.querySelector('#risk-edit-mitigation') as HTMLTextAreaElement;\r\n              if (mitigationEl) mitigationEl.value = mitigation;\r\n              toast.success('Mitigation applied');\r\n            });\r\n          }\r\n        }\r\n        const hideBtn = editSuggestionsPanel.querySelector('#risk-edit-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { editSuggestionsPanel.style.display = 'none'; });\r\n      } catch {\r\n        editSuggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close</button></div>';\r\n        const h = editSuggestionsPanel.querySelector('#risk-edit-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { editSuggestionsPanel.style.display = 'none'; });\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.innerHTML = '<svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> AI suggest';\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteBtn = container.querySelector('#delete-risk-btn');\r\n  if (deleteBtn) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this risk?')) return;\r\n      try {\r\n        await risksService.delete(risk.id);\r\n        toast.success('Risk deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete risk');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI suggest owner & mitigation (same UX as Question Assignment: list of owner cards with Assign each)\r\n  let lastMitigation = '';\r\n  const aiSuggestBtn = container.querySelector('#risk-ai-suggest-btn');\r\n  const suggestionsPanel = container.querySelector('#risk-suggestions-panel') as HTMLElement;\r\n  if (aiSuggestBtn && suggestionsPanel) {\r\n    on(aiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const btn = aiSuggestBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.innerHTML = `\r\n        <svg class=\"spin\" width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\r\n        </svg>\r\n        Analyzing...\r\n      `;\r\n      suggestionsPanel.style.display = 'block';\r\n      suggestionsPanel.innerHTML = `\r\n        <div class=\"suggestions-loading\">\r\n          <div class=\"ai-thinking-animation\"><span></span><span></span><span></span></div>\r\n          <div class=\"loading-text\">AI is suggesting owners and mitigation...</div>\r\n        </div>\r\n      `;\r\n      try {\r\n        const [result, contactsRes] = await Promise.all([\r\n          risksService.suggest({\r\n            content: risk.content || '',\r\n            impact: risk.impact || 'medium',\r\n            likelihood: risk.likelihood || 'medium',\r\n          }),\r\n          contactsService.getAll(),\r\n        ]);\r\n        const contacts: Contact[] = contactsRes?.contacts || [];\r\n        lastMitigation = result.suggested_mitigation || '';\r\n        const owners: RiskOwnerSuggestion[] = result.suggested_owners?.length ? result.suggested_owners : (result.suggested_owner ? [{ name: result.suggested_owner, reason: '', score: 0 }] : []);\r\n\r\n        if (owners.length === 0 && !lastMitigation) {\r\n          suggestionsPanel.innerHTML = `\r\n            <div class=\"no-suggestions\">\r\n              <div class=\"no-suggestions-text\">No owner or mitigation suggestions</div>\r\n              <button type=\"button\" class=\"btn-link\" id=\"risk-hide-suggestions-btn\">Close</button>\r\n            </div>\r\n          `;\r\n        } else {\r\n          suggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\">\r\n              <div class=\"ai-badge\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n                </svg>\r\n                AI Recommended\r\n              </div>\r\n            </div>\r\n            ${owners.length > 0 ? `\r\n            <div class=\"suggestions-list-sota\">\r\n              ${owners.map((s, i) => {\r\n                const score = s.score ?? 0;\r\n                const scoreColor = getScoreColor(score);\r\n                const contact = contacts.find((c) => (c.name || '').trim().toLowerCase() === (s.name || '').trim().toLowerCase());\r\n                const photoUrl = contact?.photoUrl || contact?.avatarUrl || (contact as { photo_url?: string })?.photo_url || (contact as { avatar_url?: string })?.avatar_url;\r\n                const roleOrReason = contact?.role ?? s.reason ?? '';\r\n                return `\r\n                  <div class=\"suggestion-card-sota risk-owner-card\" data-index=\"${i}\">\r\n                    <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                    <div class=\"suggestion-avatar-sota\">${photoUrl\r\n                      ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(s.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">`\r\n                      : getInitials(s.name)}</div>\r\n                    <div class=\"suggestion-info-sota\">\r\n                      <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\r\n                      ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                    </div>\r\n                    ${score > 0 ? `\r\n                    <div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\">\r\n                      <div class=\"score-ring\">\r\n                        <svg viewBox=\"0 0 36 36\">\r\n                          <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                          <path class=\"score-fill\" stroke-dasharray=\"${score}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                        </svg>\r\n                        <div class=\"score-value\">${score}%</div>\r\n                      </div>\r\n                      <div class=\"score-label\">Match</div>\r\n                    </div>\r\n                    ` : ''}\r\n                    <button type=\"button\" class=\"btn-select-suggestion\">\r\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n                      </svg>\r\n                      Assign\r\n                    </button>\r\n                  </div>\r\n                `;\r\n              }).join('')}\r\n            </div>\r\n            ` : ''}\r\n            ${lastMitigation ? `\r\n            <div class=\"risk-suggestion-card risk-mitigation-suggestion\">\r\n              <strong>Suggested mitigation</strong>\r\n              <p class=\"risk-suggestion-mitigation\">${escapeHtml(lastMitigation)}</p>\r\n              <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-apply-mitigation-btn\">Apply mitigation</button>\r\n            </div>\r\n            ` : ''}\r\n            <div class=\"suggestions-footer\">\r\n              <button type=\"button\" class=\"btn-link\" id=\"risk-hide-suggestions-btn\">Close suggestions</button>\r\n            </div>\r\n          `;\r\n\r\n          // Bind Assign per owner card\r\n          suggestionsPanel.querySelectorAll('.risk-owner-card').forEach((item) => {\r\n            const selectBtn = item.querySelector('.btn-select-suggestion');\r\n            if (!selectBtn) return;\r\n            const idx = parseInt(item.getAttribute('data-index') || '0');\r\n            const suggestion = owners[idx];\r\n            if (!suggestion || !onUpdate) return;\r\n            on(selectBtn as HTMLElement, 'click', async (e) => {\r\n              e.stopPropagation();\r\n              try {\r\n                const updated = await risksService.update(risk.id, { owner: suggestion.name });\r\n                suggestionsPanel.style.display = 'none';\r\n                onUpdate(updated);\r\n                toast.success(`Assigned to ${suggestion.name}`);\r\n              } catch {\r\n                toast.error('Failed to save');\r\n              }\r\n            });\r\n          });\r\n\r\n          // Bind Apply mitigation\r\n          const applyMitigationBtn = suggestionsPanel.querySelector('#risk-apply-mitigation-btn');\r\n          if (applyMitigationBtn && lastMitigation && onUpdate) {\r\n            on(applyMitigationBtn as HTMLElement, 'click', async () => {\r\n              try {\r\n                const updated = await risksService.update(risk.id, { mitigation: lastMitigation });\r\n                const mitigationEl = container.querySelector('#risk-detail-mitigation');\r\n                if (mitigationEl) mitigationEl.innerHTML = escapeHtml(lastMitigation);\r\n                onUpdate(updated);\r\n                toast.success('Mitigation updated');\r\n              } catch {\r\n                toast.error('Failed to save');\r\n              }\r\n            });\r\n          }\r\n        }\r\n\r\n        const hideBtn = suggestionsPanel.querySelector('#risk-hide-suggestions-btn');\r\n        if (hideBtn) {\r\n          on(hideBtn as HTMLElement, 'click', () => {\r\n            suggestionsPanel.style.display = 'none';\r\n          });\r\n        }\r\n      } catch {\r\n        suggestionsPanel.innerHTML = `\r\n          <div class=\"suggestions-error\">\r\n            <div>Failed to get AI suggestions</div>\r\n            <button type=\"button\" class=\"btn-retry\" id=\"risk-retry-suggest-btn\">Try again</button>\r\n          </div>\r\n        `;\r\n        const retryBtn = suggestionsPanel.querySelector('#risk-retry-suggest-btn');\r\n        if (retryBtn) {\r\n          on(retryBtn as HTMLElement, 'click', () => (aiSuggestBtn as HTMLElement).click());\r\n        }\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.innerHTML = `\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n          </svg>\r\n          AI suggest\r\n        `;\r\n      }\r\n    });\r\n  }\r\n\r\n  const docLink = container.querySelector('.doc-link');\r\n  if (docLink && risk.source_document_id) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n        detail: { tab: 'files', documentId: risk.source_document_id }\r\n      }));\r\n    });\r\n  }\r\n\r\n  const timelineEl = container.querySelector('#timeline-content');\r\n  if (timelineEl) {\r\n    risksService.getEvents(risk.id).then((events: RiskEvent[]) => {\r\n      if (events.length === 0) {\r\n        (timelineEl as HTMLElement).innerHTML = '<p class=\"empty-state\">No events recorded</p>';\r\n        return;\r\n      }\r\n      const html = events.map((ev) => {\r\n        const icon = getRiskEventIcon(ev.event_type);\r\n        const description = getRiskEventDescription(ev);\r\n        return `\r\n          <div class=\"timeline-item risk-event-${escapeHtml(ev.event_type)}\">\r\n            <div class=\"timeline-icon\">${icon}</div>\r\n            <div class=\"timeline-content\">\r\n              <div class=\"timeline-title\">${escapeHtml(description)}</div>\r\n              <div class=\"timeline-date\">${formatDateTime(ev.created_at)}</div>\r\n            </div>\r\n          </div>`;\r\n      }).join('');\r\n      (timelineEl as HTMLElement).innerHTML = `<div class=\"timeline-list\">${html}</div>`;\r\n    }).catch(() => {\r\n      (timelineEl as HTMLElement).innerHTML = '<p class=\"error\">Failed to load timeline</p>';\r\n    });\r\n  }\r\n\r\n  // Contact picker in view: show on Change/Choose Manually, on select update owner via API\r\n  let viewContacts: Contact[] = [];\r\n  const owner = risk.owner || '';\r\n  const riskContactPicker = container.querySelector('#risk-contact-picker') as HTMLElement;\r\n  const riskContactList = container.querySelector('#risk-contact-list') as HTMLElement;\r\n  const riskContactSearch = container.querySelector('#risk-contact-search') as HTMLInputElement;\r\n\r\n  const renderRiskContactGrid = (filter = '') => {\r\n    if (!riskContactList) return;\r\n    const list = filter\r\n      ? viewContacts.filter(\r\n          (c) =>\r\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\r\n        )\r\n      : viewContacts;\r\n    if (viewContacts.length === 0) {\r\n      riskContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n      return;\r\n    }\r\n    if (list.length === 0) {\r\n      riskContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n      return;\r\n    }\r\n    riskContactList.innerHTML = list\r\n      .map((c) => {\r\n        const photoUrl = getContactPhotoUrl(c);\r\n        const isCurrent = (owner || '').trim() === (c.name || '').trim();\r\n        return `\r\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n            <div class=\"contact-info-picker\">\r\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\r\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\r\n            </div>\r\n          </div>`;\r\n      })\r\n      .join('');\r\n    riskContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\r\n      on(card as HTMLElement, 'click', async () => {\r\n        const name = card.getAttribute('data-contact-name') || '';\r\n        if (!name) return;\r\n        try {\r\n          const updated = await risksService.update(risk.id, { owner: name });\r\n          toast.success(`Owner set to ${name}`);\r\n          if (riskContactPicker) riskContactPicker.style.display = 'none';\r\n          onUpdate?.(updated);\r\n        } catch {\r\n          toast.error('Failed to save');\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  const showRiskPicker = () => {\r\n    if (!riskContactPicker) return;\r\n    riskContactPicker.style.display = riskContactPicker.style.display === 'none' ? 'block' : 'none';\r\n    if (riskContactPicker.style.display === 'block' && viewContacts.length === 0) {\r\n      contactsService.getAll().then((res) => {\r\n        viewContacts = res?.contacts || [];\r\n        renderRiskContactGrid(riskContactSearch?.value || '');\r\n      }).catch(() => {\r\n        if (riskContactList) riskContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n      });\r\n    } else if (riskContactPicker.style.display === 'block') {\r\n      renderRiskContactGrid(riskContactSearch?.value || '');\r\n    }\r\n    if (riskContactSearch) riskContactSearch.focus();\r\n  };\r\n\r\n  const changeOwnerBtn = container.querySelector('#risk-change-owner-btn');\r\n  const showPickerBtn = container.querySelector('#risk-show-picker-btn');\r\n  if (changeOwnerBtn && riskContactPicker) on(changeOwnerBtn as HTMLElement, 'click', showRiskPicker);\r\n  if (showPickerBtn && riskContactPicker) on(showPickerBtn as HTMLElement, 'click', showRiskPicker);\r\n  if (riskContactSearch) {\r\n    riskContactSearch.addEventListener('input', () => renderRiskContactGrid(riskContactSearch.value));\r\n  }\r\n\r\n  function findContactByOwner(name: string): Contact | undefined {\r\n    if (!name || !viewContacts.length) return undefined;\r\n    const n = name.trim().toLowerCase();\r\n    if (!n) return undefined;\r\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n    if (byExact) return byExact;\r\n    const byPartial = viewContacts.find(\r\n      (c) =>\r\n        (c.name || '').trim().toLowerCase().includes(n) ||\r\n        n.includes((c.name || '').trim().toLowerCase())\r\n    );\r\n    if (byPartial) return byPartial;\r\n    const byAlias = viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n    );\r\n    if (byAlias) return byAlias;\r\n    return viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => {\r\n        const aLower = String(a).trim().toLowerCase();\r\n        return aLower.includes(n) || n.includes(aLower);\r\n      })\r\n    );\r\n  }\r\n\r\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\r\n    if (!c) return null;\r\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\r\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\r\n  }\r\n\r\n  contactsService.getAll().then((res) => {\r\n    viewContacts = res?.contacts || [];\r\n    const contact = findContactByOwner(owner);\r\n    const roleEl = container.querySelector('#risk-assigned-role');\r\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\r\n    const avatarEl = container.querySelector('#risk-assigned-avatar');\r\n    if (avatarEl && owner) {\r\n      const photoUrl = getContactPhotoUrl(contact);\r\n      if (photoUrl) {\r\n        avatarEl.innerHTML = '';\r\n        const img = document.createElement('img');\r\n        img.src = photoUrl;\r\n        img.alt = '';\r\n        img.onerror = () => { avatarEl.textContent = getInitials(owner); };\r\n        avatarEl.appendChild(img);\r\n      }\r\n    }\r\n  }).catch(() => {});\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Risks Panel Component\r\n * Displays and manages risks with view tabs, search, grouping, detail view, and removed section (SOTA parity)\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { risksService, Risk } from '../../services/risks';\r\nimport { dataStore } from '../../stores/data';\r\nimport { showRiskModal } from '../modals/RiskModal';\r\nimport { createRiskDetailView, RiskDetailViewProps } from '../risks/RiskDetailView';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nfunction riskDetailProps(containerEl: HTMLElement, props: RisksPanelProps, risk: Risk): RiskDetailViewProps {\r\n  return {\r\n    risk,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createRisksPanel(props));\r\n    },\r\n    onUpdate: (updatedRisk?: Risk) => {\r\n      containerEl.innerHTML = '';\r\n      if (updatedRisk) {\r\n        containerEl.appendChild(createRiskDetailView(riskDetailProps(containerEl, props, updatedRisk)));\r\n      } else {\r\n        containerEl.appendChild(createRisksPanel(props));\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport interface RisksPanelProps {\r\n  onRiskClick?: (risk: Risk) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentSearch: string = '';\r\nlet currentView: 'status' | 'source' = 'status';\r\nlet showMatrix: boolean = false;\r\nlet lastLoadedRisks: Risk[] = [];\r\n\r\n/**\r\n * Create risks panel\r\n */\r\nexport function createRisksPanel(props: RisksPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel risks-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Risks</h2>\r\n        <span class=\"panel-count\" id=\"risks-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"risks-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"open\">Open</option>\r\n          <option value=\"mitigating\">Mitigating</option>\r\n          <option value=\"mitigated\">Mitigated</option>\r\n          <option value=\"high\">High Impact</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\r\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\r\n        </div>\r\n        <input type=\"search\" id=\"risks-search\" class=\"search-input\" placeholder=\"Search risks...\" title=\"Search\">\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"toggle-matrix-btn\">Show Matrix</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-risk-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"risk-matrix-container\" class=\"risk-matrix-container\" style=\"display: none;\"></div>\r\n    <div class=\"panel-content\" id=\"risks-content\">\r\n      <div class=\"loading\">Loading risks...</div>\r\n    </div>\r\n    <div id=\"removed-risks-container\" class=\"removed-risks-container\" style=\"display: none;\"></div>\r\n  `;\r\n\r\n  const filterSelect = panel.querySelector('#risks-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadRisks(panel, props);\r\n  });\r\n\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'status' | 'source';\r\n      loadRisks(panel, props);\r\n    });\r\n  });\r\n\r\n  const searchInput = panel.querySelector('#risks-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value.trim();\r\n      loadRisks(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  const matrixBtn = panel.querySelector('#toggle-matrix-btn') as HTMLButtonElement;\r\n  on(matrixBtn, 'click', () => {\r\n    showMatrix = !showMatrix;\r\n    matrixBtn.textContent = showMatrix ? 'Hide Matrix' : 'Show Matrix';\r\n    const matrixContainer = panel.querySelector('#risk-matrix-container') as HTMLElement;\r\n    matrixContainer.style.display = showMatrix ? 'block' : 'none';\r\n    if (showMatrix) {\r\n      const risksToShow = lastLoadedRisks.length > 0 ? lastLoadedRisks : (dataStore.getState().risks as unknown as Risk[]) || [];\r\n      renderRiskMatrix(matrixContainer, Array.isArray(risksToShow) ? risksToShow : []);\r\n    }\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-risk-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showRiskModal({\r\n        mode: 'create',\r\n        onSave: () => {\r\n          loadRisks(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  loadRisks(panel, props);\r\n  refreshRemovedSection(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\nasync function refreshRemovedSection(panel: HTMLElement, props: RisksPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-risks-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await risksService.getDeleted();\r\n    if (deleted.length === 0) {\r\n      container.style.display = 'none';\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.style.display = 'block';\r\n    container.innerHTML = `\r\n      <div class=\"removed-risks-section\">\r\n        <div class=\"removed-risks-header section-header-sota\">\r\n          <h3>Removed risks</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-risks-hint\">Restore to bring the risk back; it will be synced to the graph.</p>\r\n        <div class=\"removed-risks-list\">\r\n          ${deleted.map((r) => `\r\n            <div class=\"removed-risk-item\" data-risk-id=\"${r.id}\">\r\n              <div class=\"removed-risk-content\">${escapeHtml(truncate(r.content ?? '', 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach((restoreBtn) => {\r\n      on(restoreBtn as HTMLElement, 'click', async () => {\r\n        const id = (restoreBtn as HTMLElement).closest('.removed-risk-item')?.getAttribute('data-risk-id');\r\n        if (!id) return;\r\n        try {\r\n          await risksService.restore(id);\r\n          toast.success('Risk restored');\r\n          loadRisks(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        } catch {\r\n          toast.error('Failed to restore risk');\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.style.display = 'none';\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\nfunction truncate(s: string, len: number): string {\r\n  if (s.length <= len) return s;\r\n  return s.substring(0, len) + '';\r\n}\r\n\r\nfunction filterRisksBySearch(risks: Risk[], q: string): Risk[] {\r\n  if (!q) return risks;\r\n  const lower = q.toLowerCase();\r\n  return risks.filter(\r\n    r =>\r\n      (r.content || '').toLowerCase().includes(lower) ||\r\n      (r.mitigation || '').toLowerCase().includes(lower) ||\r\n      (r.owner || '').toLowerCase().includes(lower) ||\r\n      (r.source_file || '').toLowerCase().includes(lower)\r\n  );\r\n}\r\n\r\nasync function loadRisks(panel: HTMLElement, props: RisksPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#risks-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const status = currentFilter === 'all' || currentFilter === 'high' ? undefined : currentFilter;\r\n    let risks = await risksService.getAll(status);\r\n    if (currentFilter === 'high') {\r\n      risks = risks.filter(r => r.impact === 'high' || r.impact === 'critical');\r\n    }\r\n    risks = filterRisksBySearch(risks, currentSearch);\r\n\r\n    if (currentView === 'source') {\r\n      renderRisksBySource(content, risks, props);\r\n    } else {\r\n      renderRisks(content, risks, props);\r\n    }\r\n    lastLoadedRisks = risks;\r\n    dataStore.setRisks(risks as unknown as []);\r\n    updateCount(panel, risks.length);\r\n\r\n    if (showMatrix) {\r\n      const matrixContainer = panel.querySelector('#risk-matrix-container') as HTMLElement;\r\n      renderRiskMatrix(matrixContainer, risks);\r\n    }\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load risks</div>';\r\n  }\r\n}\r\n\r\nfunction renderRisks(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\r\n  if (risks.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No risks match your search' : 'No risks found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Risk</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showRiskModal({ mode: 'create', onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const byStatus: Record<string, Risk[]> = {};\r\n  risks.forEach(r => {\r\n    const s = (r.status || 'open').toLowerCase();\r\n    if (!byStatus[s]) byStatus[s] = [];\r\n    byStatus[s].push(r);\r\n  });\r\n  const statuses = Object.keys(byStatus);\r\n\r\n  if (statuses.length > 1) {\r\n    container.innerHTML = statuses.map(status => `\r\n      <div class=\"question-group\">\r\n        <div class=\"group-header\">\r\n          <h3>${escapeHtml(status)}</h3>\r\n          <span class=\"group-count\">${byStatus[status].length}</span>\r\n        </div>\r\n        <div class=\"group-items\">\r\n          ${byStatus[status].map(r => createRiskCard(r, contacts)).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    container.innerHTML = risks.map(r => createRiskCard(r, contacts)).join('');\r\n  }\r\n  bindRiskCards(container, risks, props);\r\n}\r\n\r\nfunction renderRisksBySource(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\r\n  if (risks.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No risks match your search' : 'No risks found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Risk</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showRiskModal({ mode: 'create', onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const bySource: Record<string, Risk[]> = {};\r\n  risks.forEach(r => {\r\n    const src = r.source_file || 'Unknown source';\r\n    if (!bySource[src]) bySource[src] = [];\r\n    bySource[src].push(r);\r\n  });\r\n  container.innerHTML = Object.entries(bySource).map(([source, list]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(source)}</h3>\r\n        <span class=\"group-count\">${list.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${list.map(r => createRiskCard(r, contacts)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n  bindRiskCards(container, risks, props);\r\n}\r\n\r\nconst IMPACT_BAR_COLOR: Record<string, string> = {\r\n  critical: '#dc2626',\r\n  high: '#ea580c',\r\n  medium: '#ca8a04',\r\n  low: '#16a34a',\r\n};\r\n\r\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\r\n\r\nfunction findContactByOwner(contacts: ContactLike[], name: string): ContactLike | undefined {\r\n  if (!name || !contacts.length) return undefined;\r\n  const n = name.trim().toLowerCase();\r\n  if (!n) return undefined;\r\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n  if (byExact) return byExact;\r\n  const byPartial = contacts.find(\r\n    (c) =>\r\n      (c.name || '').trim().toLowerCase().includes(n) ||\r\n      n.includes((c.name || '').trim().toLowerCase())\r\n  );\r\n  if (byPartial) return byPartial;\r\n  const byAlias = contacts.find((c) =>\r\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n  );\r\n  return byAlias || contacts.find((c) =>\r\n    (c.aliases || []).some((a) => {\r\n      const aLower = String(a).trim().toLowerCase();\r\n      return aLower.includes(n) || n.includes(aLower);\r\n    })\r\n  );\r\n}\r\n\r\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\r\n  if (!c) return null;\r\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\nfunction createRiskCard(risk: Risk, contacts: ContactLike[]): string {\r\n  const impact = (risk.impact || 'medium').toLowerCase();\r\n  const barColor = IMPACT_BAR_COLOR[impact] ?? IMPACT_BAR_COLOR.medium;\r\n  const content = risk.content || '';\r\n  const source = risk.source_file || '';\r\n  const owner = risk.owner || '';\r\n  const contact = owner ? findContactByOwner(contacts, owner) : undefined;\r\n  const photoUrl = getContactPhotoUrl(contact);\r\n  const ownerChipHtml = owner\r\n    ? `\r\n        <div class=\"assignee-chip\">\r\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(owner)}\" onerror=\"this.parentElement.innerHTML='${getInitials(owner)}'\">` : getInitials(owner)}</div>\r\n          <div class=\"assignee-info\">\r\n            <span class=\"assignee-name\">${escapeHtml(owner)}</span>\r\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n          </div>\r\n        </div>\r\n      `\r\n    : '<span class=\"card-owner-placeholder text-muted\">No owner</span>';\r\n  const sourceChip = source ? `<span class=\"card-source-chip\">${escapeHtml(truncate(source, 40))}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>';\r\n\r\n  return `\r\n    <div class=\"risk-card-sota question-card-sota\" data-id=\"${risk.id}\" style=\"--risk-impact-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar risk-impact-bar\" style=\"background: ${barColor}\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"priority-pill impact-${impact}\">${escapeHtml(risk.impact || 'medium')}</span>\r\n            <span class=\"status-pill\">L: ${escapeHtml(risk.likelihood || 'medium')}</span>\r\n            <span class=\"status-pill status-${(risk.status || 'open').toLowerCase()}\">${escapeHtml(risk.status || 'open')}</span>\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(risk.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\r\n        ${risk.mitigation ? `<div class=\"card-mitigation text-muted\">${escapeHtml(truncate(risk.mitigation, 120))}</div>` : ''}\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${sourceChip}\r\n            ${ownerChipHtml}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            <button type=\"button\" class=\"btn-link risk-view-link\">View</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindRiskCards(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\r\n  container.querySelectorAll('.risk-card-sota').forEach((card) => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.card-actions')) return;\r\n      const id = card.getAttribute('data-id');\r\n      const risk = risks.find(r => String(r.id) === id);\r\n      if (!risk) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createRiskDetailView(riskDetailProps(containerEl, props, risk)));\r\n      } else if (props.onRiskClick) {\r\n        props.onRiskClick(risk);\r\n      } else {\r\n        showRiskModal({\r\n          mode: 'edit',\r\n          risk: { ...risk },\r\n          onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props),\r\n        });\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction renderRiskMatrix(container: HTMLElement, risks: Risk[]): void {\r\n  const activeRisks = risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed');\r\n  const getSeverity = (impact?: string, likelihood?: string): string => {\r\n    const impactLevel = ['low', 'medium', 'high', 'critical'].indexOf((impact || '').toString().toLowerCase() || 'low');\r\n    const likelihoodLevel = ['low', 'medium', 'high'].indexOf((likelihood || '').toString().toLowerCase() || 'low');\r\n    const score = impactLevel + likelihoodLevel;\r\n    if (score >= 4) return 'critical';\r\n    if (score >= 3) return 'high';\r\n    if (score >= 2) return 'medium';\r\n    return 'low';\r\n  };\r\n  const counts = { critical: 0, high: 0, medium: 0, low: 0 };\r\n  activeRisks.forEach(risk => {\r\n    const severity = getSeverity(risk.impact, risk.likelihood);\r\n    counts[severity as keyof typeof counts]++;\r\n  });\r\n  const total = activeRisks.length;\r\n  const mitigated = risks.length - activeRisks.length;\r\n  const getPercent = (count: number) => total > 0 ? Math.round((count / total) * 100) : 0;\r\n  let conicStops = '';\r\n  let currentDeg = 0;\r\n  const colors = { critical: '#ef4444', high: '#f97316', medium: '#eab308', low: '#22c55e' };\r\n  (['critical', 'high', 'medium', 'low'] as const).forEach(level => {\r\n    const percent = getPercent(counts[level]);\r\n    const degrees = (percent / 100) * 360;\r\n    if (degrees > 0) {\r\n      conicStops += `${colors[level]} ${currentDeg}deg ${currentDeg + degrees}deg, `;\r\n      currentDeg += degrees;\r\n    }\r\n  });\r\n  if (!conicStops) conicStops = 'var(--color-border) 0deg 360deg';\r\n  else conicStops = conicStops.slice(0, -2);\r\n\r\n  container.innerHTML = `\r\n    <div class=\"risk-summary\">\r\n      <div class=\"risk-summary-header\">\r\n        <h4>Risk Overview</h4>\r\n        <span class=\"risk-total\">${total} active</span>\r\n      </div>\r\n      <div class=\"risk-summary-content\">\r\n        <div class=\"risk-donut-container\">\r\n          <div class=\"risk-donut\" style=\"background: conic-gradient(${conicStops})\">\r\n            <div class=\"risk-donut-center\">\r\n              <span class=\"donut-value\">${total}</span>\r\n              <span class=\"donut-label\">Risks</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"risk-bars\">\r\n          <div class=\"risk-bar-item critical\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Critical</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.critical)}%\"></div></div>\r\n            <span class=\"bar-count\">${counts.critical}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item high\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">High</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.high)}%\"></div></div>\r\n            <span class=\"bar-count\">${counts.high}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item medium\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Medium</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.medium)}%\"></div></div>\r\n            <span class=\"bar-count\">${counts.medium}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item low\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Low</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.low)}%\"></div></div>\r\n            <span class=\"bar-count\">${counts.low}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      ${mitigated > 0 ? `<div class=\"risk-mitigated\"><span class=\"mitigated-icon\"></span><span>${mitigated} risk${mitigated > 1 ? 's' : ''} mitigated</span></div>` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#risks-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createRisksPanel;\r\n","/**\r\n * Action Modal Component\r\n * Create, view and edit actions/tasks\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { Action } from '../../services/actions';\r\nimport { actionsService } from '../../services/actions';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'action-modal';\r\n\r\nexport interface ActionModalProps {\r\n  mode: 'view' | 'edit' | 'create';\r\n  action?: Action;\r\n  onSave?: (action: Action) => void;\r\n  onDelete?: (actionId: string) => void;\r\n}\r\n\r\nfunction taskText(a: Action | undefined): string {\r\n  return (a?.content ?? a?.task ?? '') as string;\r\n}\r\nfunction dueDateText(a: Action | undefined): string {\r\n  return (a?.due_date ?? (a as { dueDate?: string })?.dueDate ?? '') as string;\r\n}\r\nfunction createdText(a: Action | undefined): string {\r\n  return (a?.created_at ?? (a as { createdAt?: string })?.createdAt ?? '') as string;\r\n}\r\n\r\n/**\r\n * Show action modal\r\n */\r\nexport function showActionModal(props: ActionModalProps): void {\r\n  const { mode, action, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit' && action?.id;\r\n  const isView = mode === 'view';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'action-modal-content' });\r\n\r\n  if (isView && action) {\r\n    const due = dueDateText(action);\r\n    const isOverdue = due && new Date(due) < new Date() && action.status !== 'completed';\r\n\r\n    content.innerHTML = `\r\n      <div class=\"action-view\">\r\n        <div class=\"action-meta\">\r\n          <span class=\"priority-badge priority-${action.priority || 'medium'}\">${action.priority || 'medium'}</span>\r\n          <span class=\"status-badge ${action.status}\">${action.status.replace('_', ' ')}</span>\r\n          ${isOverdue ? '<span class=\"status-badge overdue\">Overdue</span>' : ''}\r\n        </div>\r\n        \r\n        <div class=\"action-task-large ${action.status === 'completed' ? 'completed' : ''}\">\r\n          ${escapeHtml(taskText(action))}\r\n        </div>\r\n        \r\n        <div class=\"action-details\">\r\n          ${action.assignee ? `<div class=\"detail-item\"><strong>Assignee:</strong> ${escapeHtml(action.assignee)}</div>` : ''}\r\n          ${due ? `<div class=\"detail-item\"><strong>Due Date:</strong> ${due}</div>` : ''}\r\n          <div class=\"detail-item\"><strong>Created:</strong> ${formatRelativeTime(createdText(action))}</div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  } else {\r\n    content.innerHTML = `\r\n      <form id=\"action-form\" class=\"action-form\">\r\n        <div class=\"form-group\">\r\n          <label for=\"action-task\">Task *</label>\r\n          <textarea id=\"action-task\" rows=\"2\" required \r\n                    placeholder=\"What needs to be done?\">${escapeHtml(taskText(action))}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"action-priority\">Priority</label>\r\n            <select id=\"action-priority\">\r\n              <option value=\"low\" ${action?.priority === 'low' ? 'selected' : ''}>Low</option>\r\n              <option value=\"medium\" ${action?.priority === 'medium' || !action ? 'selected' : ''}>Medium</option>\r\n              <option value=\"high\" ${action?.priority === 'high' ? 'selected' : ''}>High</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label for=\"action-status\">Status</label>\r\n            <select id=\"action-status\">\r\n              <option value=\"pending\" ${action?.status === 'pending' || !action ? 'selected' : ''}>Pending</option>\r\n              <option value=\"in_progress\" ${action?.status === 'in_progress' ? 'selected' : ''}>In Progress</option>\r\n              <option value=\"completed\" ${action?.status === 'completed' ? 'selected' : ''}>Completed</option>\r\n              <option value=\"cancelled\" ${action?.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"action-assignee\">Assignee</label>\r\n            <input type=\"text\" id=\"action-assignee\" \r\n                   value=\"${escapeHtml(action?.assignee ?? action?.owner ?? '')}\" \r\n                   placeholder=\"Who is responsible?\">\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label for=\"action-due\">Due Date</label>\r\n            <input type=\"date\" id=\"action-due\" \r\n                   value=\"${dueDateText(action)}\">\r\n          </div>\r\n        </div>\r\n      </form>\r\n    `;\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (isView && action) {\r\n    const editBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Edit',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    // Quick complete button if not completed\r\n    if (action.status !== 'completed') {\r\n      const completeBtn = createElement('button', {\r\n        className: 'btn btn-success',\r\n        textContent: 'Mark Complete',\r\n      });\r\n\r\n      on(completeBtn, 'click', async () => {\r\n        try {\r\n          const updated = await actionsService.update(action.id, { status: 'completed' });\r\n          toast.success('Action completed');\r\n          onSave?.(updated);\r\n          closeModal(MODAL_ID);\r\n        } catch {\r\n          // Error shown by API service\r\n        }\r\n      });\r\n\r\n      footer.appendChild(completeBtn);\r\n    }\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n    on(editBtn, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showActionModal({ ...props, mode: 'edit' });\r\n    });\r\n\r\n    footer.appendChild(closeBtn);\r\n    footer.appendChild(editBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const saveBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: isEdit ? 'Save Changes' : 'Create Action',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(saveBtn, 'click', async () => {\r\n      const form = content.querySelector('#action-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\r\n\r\n      const contentVal = getValue('action-task');\r\n      const payload = {\r\n        content: contentVal,\r\n        status: getValue('action-status') as Action['status'],\r\n        priority: getValue('action-priority') as Action['priority'],\r\n        assignee: getValue('action-assignee') || undefined,\r\n        due_date: getValue('action-due') || undefined,\r\n      };\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        if (isEdit) {\r\n          const updated = await actionsService.update(action!.id, payload);\r\n          toast.success('Action updated');\r\n          onSave?.(updated);\r\n        } else {\r\n          const created = await actionsService.create(payload);\r\n          toast.success('Action created');\r\n          onSave?.(created);\r\n        }\r\n\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Action';\r\n      }\r\n    });\r\n\r\n    if (isEdit) {\r\n      const deleteBtn = createElement('button', {\r\n        className: 'btn btn-danger',\r\n        textContent: 'Delete',\r\n      });\r\n\r\n      on(deleteBtn, 'click', async () => {\r\n        const { confirm } = await import('../Modal');\r\n        const confirmed = await confirm(\r\n          'Are you sure you want to delete this action?',\r\n          {\r\n            title: 'Delete Action',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await actionsService.delete(action!.id);\r\n            toast.success('Action deleted');\r\n            onDelete?.(String(action!.id));\r\n            closeModal(MODAL_ID);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n\r\n      footer.appendChild(deleteBtn);\r\n    }\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(saveBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: isView ? 'Action Details' : (isEdit ? 'Edit Action' : 'New Action'),\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showActionModal;\r\n","/**\r\n * Action Detail View\r\n * Full-page view for action details: task, status, priority, assignee, due date, source, timeline\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Action, ActionEvent, ActionAssigneeSuggestion, actionsService } from '../../services/actions';\r\nimport { contactsService, Contact } from '../../services/contacts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\r\n\r\nfunction getInitials(name: string): string {\r\n  return name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\r\n}\r\n\r\nexport interface ActionDetailViewProps {\r\n  action: Action;\r\n  onClose: () => void;\r\n  onUpdate?: (action: Action) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nfunction taskText(a: Action): string {\r\n  return (a.content ?? a.task ?? '') as string;\r\n}\r\n\r\nfunction getActionEventIcon(eventType: string): string {\r\n  const icons: Record<string, string> = {\r\n    created: '',\r\n    updated: '',\r\n    deleted: '',\r\n    restored: '',\r\n  };\r\n  return icons[eventType] || '';\r\n}\r\n\r\nfunction getActionEventDescription(ev: ActionEvent): string {\r\n  const data = ev.event_data || {};\r\n  const actor = ev.actor_name ? ` by ${ev.actor_name}` : '';\r\n\r\n  switch (ev.event_type) {\r\n    case 'created':\r\n      return `Created${actor}`;\r\n    case 'updated': {\r\n      const changes = (data.changes as Array<{ field: string; from: string; to: string }>) || [];\r\n      if (changes.length === 0) return `Updated${actor}`;\r\n      if (changes.length === 1) {\r\n        const c = changes[0];\r\n        const toStr = String(c.to).trim() ? c.to : '';\r\n        const fromStr = String(c.from).trim() ? c.from : '';\r\n        return `${c.field} changed: ${fromStr}  ${toStr}${actor}`;\r\n      }\r\n      return `${changes.map((c) => `${c.field}: ${c.from || ''}  ${c.to || ''}`).join('; ')}${actor}`;\r\n    }\r\n    case 'deleted':\r\n      return `Deleted${data.reason ? ` (${data.reason})` : ''}${actor}`;\r\n    case 'restored':\r\n      return `Restored${actor}`;\r\n    default:\r\n      return ev.event_type;\r\n  }\r\n}\r\n\r\nexport function createActionDetailView(props: ActionDetailViewProps): HTMLElement {\r\n  const { action, onClose, onUpdate } = props;\r\n\r\n  const container = createElement('div', { className: 'action-detail-view question-detail-view' });\r\n\r\n  const task = taskText(action);\r\n  const due = action.due_date ?? (action as { deadline?: string }).deadline ?? '';\r\n  const assignee = action.assignee ?? action.owner ?? '';\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header action-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Actions</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Action #${String(action.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        <span class=\"status-badge status-${(action.status || 'pending').toLowerCase()}\">${escapeHtml(String(action.status).replace('_', ' '))}</span>\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content action-detail-content\">\r\n      <div id=\"action-view-content\">\r\n        <section class=\"detail-section action-main\">\r\n          <div class=\"question-badges action-badges\">\r\n            ${action.priority ? `<span class=\"priority-pill priority-${action.priority}\">${escapeHtml(action.priority)}</span>` : ''}\r\n            <span class=\"question-date action-date\">Created ${formatRelativeTime(action.created_at)}</span>\r\n          </div>\r\n          <h2 class=\"question-text action-task-text\">${escapeHtml(task)}</h2>\r\n        </section>\r\n\r\n        <div class=\"detail-columns\">\r\n          <div class=\"detail-column-left\">\r\n            <!-- Assignment Section - SOTA (aligned with Questions) -->\r\n            <section class=\"detail-section\" id=\"action-assignment-section\">\r\n              <div class=\"section-header-sota\">\r\n                <h3>\r\n                  <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                  </svg>\r\n                  Assignment\r\n                  <span class=\"section-subtitle\">Who should do this?</span>\r\n                </h3>\r\n                <button type=\"button\" class=\"btn-ai-suggest\" id=\"action-ai-suggest-btn\" title=\"Suggest assignee from task content\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                  AI Suggest\r\n                </button>\r\n              </div>\r\n\r\n              <!-- Current Assignment Display -->\r\n              <div id=\"action-current-assignment\" class=\"current-assignment-card\">\r\n                ${assignee ? `\r\n                  <div class=\"assigned-contact-display\">\r\n                    <div class=\"contact-avatar-lg\" id=\"action-assigned-avatar\">${getInitials(assignee)}</div>\r\n                    <div class=\"contact-details\">\r\n                      <div class=\"contact-name-lg\">${escapeHtml(assignee)}</div>\r\n                      <div class=\"contact-role-sm\" id=\"action-assigned-role\"></div>\r\n                    </div>\r\n                    <button class=\"btn-change-assignment\" id=\"action-change-assignee-btn\" type=\"button\">\r\n                      <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                      Change\r\n                    </button>\r\n                  </div>\r\n                ` : `\r\n                  <div class=\"no-assignment\">\r\n                    <div class=\"no-assignment-icon\">\r\n                      <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\r\n                    </div>\r\n                    <span>No one assigned</span>\r\n                    <p class=\"no-assignment-hint\">Use AI Suggest or choose manually</p>\r\n                    <button class=\"btn-assign-now\" id=\"action-show-picker-btn\" type=\"button\">Choose Manually</button>\r\n                  </div>\r\n                `}\r\n              </div>\r\n\r\n              <!-- Contact Picker (hidden by default) -->\r\n              <div id=\"action-contact-picker\" class=\"contact-picker-sota\" style=\"display: none;\">\r\n                <div class=\"picker-search\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\r\n                  <input type=\"text\" id=\"action-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n                </div>\r\n                <div id=\"action-contact-list\" class=\"contact-list-grid\">Loading...</div>\r\n              </div>\r\n\r\n              <!-- AI Suggestions Panel -->\r\n              <div id=\"action-suggestions-panel\" class=\"suggestions-panel-sota action-suggestions-panel\" style=\"display: none; margin-bottom: 12px;\"></div>\r\n\r\n              <!-- Due date & Status (details) -->\r\n              <dl class=\"metadata-list action-meta-inline\">\r\n                <dt>Due date</dt>\r\n                <dd>${due ? formatDate(due) : ''}</dd>\r\n                <dt>Status</dt>\r\n                <dd>${escapeHtml(String(action.status).replace('_', ' '))}</dd>\r\n              </dl>\r\n            </section>\r\n\r\n            <section class=\"detail-section\">\r\n              <div class=\"section-header\"><h3>Source</h3></div>\r\n              ${action.source_file ? `<p class=\"source-file\">${escapeHtml(action.source_file)}</p>` : ''}\r\n              ${action.source_document_id ? `\r\n                <p class=\"source-doc\">\r\n                  <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(action.source_document_id))}\">View source document</a>\r\n                </p>\r\n              ` : ''}\r\n              ${!action.source_file && !action.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\r\n            </section>\r\n          </div>\r\n\r\n          <div class=\"detail-column-right\">\r\n            <section class=\"detail-section metadata-section\">\r\n              <h3>Metadata</h3>\r\n              <dl class=\"metadata-list\">\r\n                <dt>Created</dt>\r\n                <dd>${formatDate(action.created_at)}</dd>\r\n                ${action.updated_at ? `<dt>Updated</dt><dd>${formatDate(action.updated_at)}</dd>` : ''}\r\n              </dl>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-timeline-section\">\r\n              <h3>Timeline</h3>\r\n              <div id=\"timeline-content\" class=\"timeline-content\">\r\n                <span class=\"text-muted\">Loading</span>\r\n              </div>\r\n            </section>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-action-btn\">Edit</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"delete-action-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div id=\"action-edit-form\" class=\"action-detail-edit-form\" style=\"display: none;\">\r\n        <form id=\"action-inline-form\" class=\"action-form\">\r\n          <div class=\"form-group\">\r\n            <div style=\"display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px; margin-bottom: 6px;\">\r\n              <label for=\"action-edit-task\" style=\"margin-bottom: 0;\">Task *</label>\r\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"action-edit-ai-suggest-btn\" title=\"Suggest assignee from task content\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI suggest\r\n              </button>\r\n            </div>\r\n            <textarea id=\"action-edit-task\" rows=\"3\" required placeholder=\"What needs to be done?\">${escapeHtml(task)}</textarea>\r\n          </div>\r\n          <div id=\"action-edit-suggestions-panel\" class=\"suggestions-panel-sota action-suggestions-panel\" style=\"display: none; margin-bottom: 16px;\"></div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group\">\r\n              <label for=\"action-edit-status\">Status</label>\r\n              <select id=\"action-edit-status\">\r\n                <option value=\"pending\" ${action.status === 'pending' ? 'selected' : ''}>Pending</option>\r\n                <option value=\"in_progress\" ${action.status === 'in_progress' ? 'selected' : ''}>In Progress</option>\r\n                <option value=\"completed\" ${action.status === 'completed' ? 'selected' : ''}>Completed</option>\r\n                <option value=\"cancelled\" ${action.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"action-edit-priority\">Priority</label>\r\n              <select id=\"action-edit-priority\">\r\n                <option value=\"low\" ${action.priority === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${action.priority === 'medium' || !action.priority ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${action.priority === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group action-assignee-picker-wrap\">\r\n              <label>Assignee</label>\r\n              <input type=\"hidden\" id=\"action-edit-assignee\" value=\"${escapeHtml(assignee)}\">\r\n              <div class=\"action-assignee-picker-trigger\" id=\"action-assignee-picker-trigger\" title=\"Click to select from project contacts\">\r\n                <span class=\"action-assignee-picker-value\" id=\"action-assignee-picker-value\">${assignee ? escapeHtml(assignee) : '<span class=\"text-muted\">Select assignee...</span>'}</span>\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n              </div>\r\n              <div id=\"action-assignee-picker-dropdown\" class=\"action-assignee-picker-dropdown\" style=\"display: none;\">\r\n                <div class=\"action-assignee-picker-search\">\r\n                  <input type=\"text\" id=\"action-assignee-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n                </div>\r\n                <div id=\"action-assignee-picker-list\" class=\"action-assignee-picker-list\">Loading...</div>\r\n              </div>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"action-edit-due\">Due date</label>\r\n              <input type=\"date\" id=\"action-edit-due\" value=\"${due ? due.split('T')[0] : ''}\">\r\n            </div>\r\n          </div>\r\n        </form>\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"action-save-btn\">Save</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"action-cancel-edit-btn\">Cancel</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"action-delete-in-edit-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  const viewContent = container.querySelector('#action-view-content') as HTMLElement;\r\n  const editForm = container.querySelector('#action-edit-form') as HTMLElement;\r\n\r\n  const editBtn = container.querySelector('#edit-action-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      viewContent.style.display = 'none';\r\n      editForm.style.display = 'block';\r\n    });\r\n  }\r\n\r\n  const cancelEditBtn = container.querySelector('#action-cancel-edit-btn');\r\n  if (cancelEditBtn) {\r\n    on(cancelEditBtn as HTMLElement, 'click', () => {\r\n      editForm.style.display = 'none';\r\n      viewContent.style.display = 'block';\r\n    });\r\n  }\r\n\r\n  const assigneePickerTrigger = container.querySelector('#action-assignee-picker-trigger');\r\n  const assigneePickerDropdown = container.querySelector('#action-assignee-picker-dropdown') as HTMLElement;\r\n  const assigneePickerValue = container.querySelector('#action-assignee-picker-value');\r\n  const assigneeHiddenInput = container.querySelector('#action-edit-assignee') as HTMLInputElement;\r\n  const assigneePickerList = container.querySelector('#action-assignee-picker-list') as HTMLElement;\r\n  const assigneePickerSearch = container.querySelector('#action-assignee-picker-search') as HTMLInputElement;\r\n  if (assigneePickerTrigger && assigneePickerDropdown && assigneePickerList && assigneeHiddenInput) {\r\n    let editFormContacts: Contact[] = [];\r\n    const renderAssigneePickerList = (filter = '') => {\r\n      const filtered = filter\r\n        ? editFormContacts.filter(\r\n            (c) =>\r\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n          )\r\n        : editFormContacts;\r\n      if (editFormContacts.length === 0) {\r\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n        return;\r\n      }\r\n      if (filtered.length === 0) {\r\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n        return;\r\n      }\r\n      assigneePickerList.innerHTML = filtered\r\n        .map((c) => {\r\n          const photoUrl = (c as { photoUrl?: string }).photoUrl || (c as { avatarUrl?: string }).avatarUrl;\r\n          const selected = (assigneeHiddenInput?.value || '').trim() === (c.name || '').trim();\r\n          return `\r\n            <div class=\"action-assignee-card-picker ${selected ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"action-assignee-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n              <div class=\"action-assignee-card-info\">\r\n                <div class=\"action-assignee-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"action-assignee-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `;\r\n        })\r\n        .join('');\r\n      assigneePickerList.querySelectorAll('.action-assignee-card-picker').forEach((card) => {\r\n        on(card as HTMLElement, 'click', () => {\r\n          const name = card.getAttribute('data-contact-name') || '';\r\n          assigneeHiddenInput.value = name;\r\n          if (assigneePickerValue) assigneePickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select assignee...</span>';\r\n          assigneePickerDropdown.style.display = 'none';\r\n        });\r\n      });\r\n    };\r\n    on(assigneePickerTrigger as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const isOpen = assigneePickerDropdown.style.display === 'block';\r\n      assigneePickerDropdown.style.display = isOpen ? 'none' : 'block';\r\n      if (!isOpen && editFormContacts.length === 0) {\r\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          editFormContacts = res?.contacts || [];\r\n          renderAssigneePickerList(assigneePickerSearch?.value || '');\r\n        } catch {\r\n          assigneePickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        }\r\n      } else if (!isOpen) renderAssigneePickerList(assigneePickerSearch?.value || '');\r\n    });\r\n    if (assigneePickerSearch) {\r\n      assigneePickerSearch.addEventListener('input', () => renderAssigneePickerList(assigneePickerSearch.value));\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.action-assignee-picker-wrap') && assigneePickerDropdown?.style.display === 'block') {\r\n        assigneePickerDropdown.style.display = 'none';\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI suggest in edit form (suggest assignee from task; fill picker only, user clicks Save)\r\n  const editAiSuggestBtn = container.querySelector('#action-edit-ai-suggest-btn');\r\n  const editSuggestionsPanel = container.querySelector('#action-edit-suggestions-panel') as HTMLElement;\r\n  const editAssigneeHiddenInput = container.querySelector('#action-edit-assignee') as HTMLInputElement;\r\n  const editAssigneePickerValue = container.querySelector('#action-assignee-picker-value');\r\n  if (editAiSuggestBtn && editSuggestionsPanel) {\r\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const taskEl = container.querySelector('#action-edit-task') as HTMLTextAreaElement;\r\n      const content = taskEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.warning('Enter task content first');\r\n        return;\r\n      }\r\n      const btn = editAiSuggestBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.innerHTML = '<span class=\"spin\"></span> Analyzing...';\r\n      editSuggestionsPanel.style.display = 'block';\r\n      editSuggestionsPanel.innerHTML = '<div class=\"suggestions-loading\"><div class=\"loading-text\">AI is suggesting assignees...</div></div>';\r\n      try {\r\n        if (viewContacts.length === 0) {\r\n          const res = await contactsService.getAll();\r\n          viewContacts = res?.contacts || [];\r\n        }\r\n        const { suggested_assignees } = await actionsService.suggest({ content });\r\n        if (!suggested_assignees?.length) {\r\n          editSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\"><div class=\"no-suggestions-text\">No suggestions</div><button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close</button></div>';\r\n        } else {\r\n          editSuggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\"><div class=\"ai-badge\"> AI Recommended</div></div>\r\n            <div class=\"suggestions-list-sota\">\r\n              ${suggested_assignees.map((s: ActionAssigneeSuggestion) => {\r\n                const contact = findContactByAssignee(s.name);\r\n                const photoUrl = getContactPhotoUrl(contact);\r\n                const roleOrReason = contact?.role ?? s.reason ?? '';\r\n                return `\r\n                <div class=\"action-suggestion-card suggestion-card-sota\">\r\n                  <div class=\"suggestion-card-left\">\r\n                    <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                    <div class=\"suggestion-score-ring\" style=\"--score-color: ${(s.score ?? 0) >= 70 ? 'var(--success)' : (s.score ?? 0) >= 50 ? 'var(--warning)' : 'var(--text-muted)'}\">${s.score ?? 0}</div>\r\n                    <div>\r\n                      <div class=\"suggestion-name\">${escapeHtml(s.name)}</div>\r\n                      ${roleOrReason ? `<div class=\"suggestion-reason\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                    </div>\r\n                  </div>\r\n                  <button type=\"button\" class=\"btn-select-suggestion\" data-assignee-name=\"${escapeHtml(s.name)}\">Assign</button>\r\n                </div>\r\n              `;\r\n              }).join('')}\r\n            </div>\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close suggestions</button></div>\r\n          `;\r\n          editSuggestionsPanel.querySelectorAll('.btn-select-suggestion').forEach((assignBtn) => {\r\n            const name = (assignBtn as HTMLElement).getAttribute('data-assignee-name') || '';\r\n            if (!name) return;\r\n            on(assignBtn as HTMLElement, 'click', () => {\r\n              if (editAssigneeHiddenInput) editAssigneeHiddenInput.value = name;\r\n              if (editAssigneePickerValue) editAssigneePickerValue.innerHTML = escapeHtml(name);\r\n              editSuggestionsPanel.style.display = 'none';\r\n              toast.success(`Assignee set to ${name}`);\r\n            });\r\n          });\r\n        }\r\n        const hideBtn = editSuggestionsPanel.querySelector('#action-edit-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { editSuggestionsPanel.style.display = 'none'; });\r\n      } catch {\r\n        editSuggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close</button></div>';\r\n        const h = editSuggestionsPanel.querySelector('#action-edit-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { editSuggestionsPanel.style.display = 'none'; });\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.innerHTML = '<svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> AI suggest';\r\n      }\r\n    });\r\n  }\r\n\r\n  const saveBtn = container.querySelector('#action-save-btn');\r\n  if (saveBtn) {\r\n    on(saveBtn as HTMLElement, 'click', async () => {\r\n      const taskEl = container.querySelector('#action-edit-task') as HTMLTextAreaElement;\r\n      const statusEl = container.querySelector('#action-edit-status') as HTMLSelectElement;\r\n      const priorityEl = container.querySelector('#action-edit-priority') as HTMLSelectElement;\r\n      const assigneeEl = container.querySelector('#action-edit-assignee') as HTMLInputElement;\r\n      const dueEl = container.querySelector('#action-edit-due') as HTMLInputElement;\r\n      if (!taskEl?.value.trim()) {\r\n        toast.warning('Task is required');\r\n        return;\r\n      }\r\n      try {\r\n        const updated = await actionsService.update(action.id, {\r\n          content: taskEl.value.trim(),\r\n          status: statusEl?.value as Action['status'],\r\n          priority: priorityEl?.value as Action['priority'],\r\n          assignee: assigneeEl?.value.trim() || undefined,\r\n          due_date: dueEl?.value || undefined,\r\n        });\r\n        toast.success('Action updated');\r\n        onUpdate?.(updated);\r\n      } catch {\r\n        toast.error('Failed to update action');\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteBtn = container.querySelector('#delete-action-btn');\r\n  const deleteInEditBtn = container.querySelector('#action-delete-in-edit-btn');\r\n  const doDelete = async () => {\r\n    const { confirm } = await import('../Modal');\r\n    const confirmed = await confirm('Are you sure you want to delete this action?', {\r\n      title: 'Delete Action',\r\n      confirmText: 'Delete',\r\n      confirmClass: 'btn-danger',\r\n    });\r\n    if (confirmed) {\r\n      try {\r\n        await actionsService.delete(action.id);\r\n        toast.success('Action deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete action');\r\n      }\r\n    }\r\n  };\r\n  if (deleteBtn) on(deleteBtn as HTMLElement, 'click', doDelete);\r\n  if (deleteInEditBtn) on(deleteInEditBtn as HTMLElement, 'click', doDelete);\r\n\r\n  const docLink = container.querySelector('.doc-link[data-document-id]');\r\n  if (docLink) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      const docId = (docLink as HTMLElement).getAttribute('data-document-id');\r\n      if (docId) {\r\n        window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n          detail: { tab: 'files', documentId: docId }\r\n        }));\r\n      }\r\n    });\r\n  }\r\n\r\n  const aiSuggestBtn = container.querySelector('#action-ai-suggest-btn');\r\n  const suggestionsPanel = container.querySelector('#action-suggestions-panel') as HTMLElement;\r\n  if (aiSuggestBtn && suggestionsPanel) {\r\n    on(aiSuggestBtn as HTMLElement, 'click', async () => {\r\n      (aiSuggestBtn as HTMLButtonElement).disabled = true;\r\n      suggestionsPanel.style.display = 'block';\r\n      suggestionsPanel.innerHTML = '<div class=\"suggestions-loading\">Loading suggestions...</div>';\r\n      try {\r\n        const task = taskText(action);\r\n        if (viewContacts.length === 0) {\r\n          const res = await contactsService.getAll();\r\n          viewContacts = res?.contacts || [];\r\n        }\r\n        const { suggested_assignees } = await actionsService.suggest({ content: task });\r\n        if (!suggested_assignees?.length) {\r\n          suggestionsPanel.innerHTML = '<div class=\"no-suggestions\">No suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close suggestions</button></div>';\r\n        } else {\r\n          suggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\">\r\n              <div class=\"ai-badge\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI Recommended\r\n              </div>\r\n            </div>\r\n            <div class=\"suggestions-list-sota\">\r\n              ${suggested_assignees.map((s: ActionAssigneeSuggestion, i: number) => {\r\n                const contact = findContactByAssignee(s.name);\r\n                const photoUrl = getContactPhotoUrl(contact);\r\n                const roleOrReason = contact?.role ?? s.reason ?? '';\r\n                return `\r\n                <div class=\"suggestion-card-sota\" data-index=\"${i}\">\r\n                  <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                  <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                  <div class=\"suggestion-info-sota\">\r\n                    <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\r\n                    ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                  </div>\r\n                  <div class=\"suggestion-score-sota\" style=\"--score-color: ${(s.score ?? 0) >= 70 ? 'var(--success)' : (s.score ?? 0) >= 50 ? 'var(--warning)' : 'var(--text-muted)'}\">\r\n                    <div class=\"score-ring\">\r\n                      <svg viewBox=\"0 0 36 36\">\r\n                        <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                        <path class=\"score-fill\" stroke-dasharray=\"${s.score ?? 0}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                      </svg>\r\n                      <div class=\"score-value\">${s.score ?? 0}%</div>\r\n                    </div>\r\n                    <div class=\"score-label\">Match</div>\r\n                  </div>\r\n                  <button type=\"button\" class=\"btn-select-suggestion\" data-assignee-name=\"${escapeHtml(s.name)}\">\r\n                    <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>\r\n                    Assign\r\n                  </button>\r\n                </div>\r\n              `;\r\n              }).join('')}\r\n            </div>\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close suggestions</button></div>\r\n          `;\r\n          suggestionsPanel.querySelectorAll('.btn-select-suggestion').forEach((btn) => {\r\n            on(btn as HTMLElement, 'click', async () => {\r\n              const name = (btn as HTMLElement).getAttribute('data-assignee-name') || '';\r\n              if (!name) return;\r\n              try {\r\n                const updated = await actionsService.update(action.id, { assignee: name });\r\n                toast.success(`Assigned to ${name}`);\r\n                onUpdate?.(updated);\r\n                suggestionsPanel.style.display = 'none';\r\n              } catch {\r\n                toast.error('Failed to assign');\r\n              }\r\n            });\r\n          });\r\n        }\r\n        const hideBtn = suggestionsPanel.querySelector('#action-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { suggestionsPanel.style.display = 'none'; });\r\n      } catch {\r\n        suggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close</button></div>';\r\n        const h = suggestionsPanel.querySelector('#action-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { suggestionsPanel.style.display = 'none'; });\r\n      } finally {\r\n        (aiSuggestBtn as HTMLButtonElement).disabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  const timelineEl = container.querySelector('#timeline-content');\r\n  if (timelineEl) {\r\n    actionsService.getEvents(action.id).then((events: ActionEvent[]) => {\r\n      if (events.length === 0) {\r\n        (timelineEl as HTMLElement).innerHTML = '<p class=\"empty-state\">No events recorded</p>';\r\n        return;\r\n      }\r\n      const html = events.map((ev) => {\r\n        const icon = getActionEventIcon(ev.event_type);\r\n        const description = getActionEventDescription(ev);\r\n        return `\r\n          <div class=\"timeline-item action-event-${escapeHtml(ev.event_type)}\">\r\n            <div class=\"timeline-icon\">${icon}</div>\r\n            <div class=\"timeline-content\">\r\n              <div class=\"timeline-title\">${escapeHtml(description)}</div>\r\n              <div class=\"timeline-date\">${formatDateTime(ev.created_at)}</div>\r\n            </div>\r\n          </div>`;\r\n      }).join('');\r\n      (timelineEl as HTMLElement).innerHTML = `<div class=\"timeline-list\">${html}</div>`;\r\n    }).catch(() => {\r\n      (timelineEl as HTMLElement).innerHTML = '<p class=\"error\">Failed to load timeline</p>';\r\n    });\r\n  }\r\n\r\n  // Contact picker in view: load contacts, show picker on Change/Choose Manually, on select update assignee via API\r\n  let viewContacts: Contact[] = [];\r\n  const actionContactPicker = container.querySelector('#action-contact-picker') as HTMLElement;\r\n  const actionContactList = container.querySelector('#action-contact-list') as HTMLElement;\r\n  const actionContactSearch = container.querySelector('#action-contact-search') as HTMLInputElement;\r\n\r\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\r\n    if (!c) return null;\r\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\r\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\r\n  }\r\n\r\n  const renderActionContactGrid = (filter = '') => {\r\n    if (!actionContactList) return;\r\n    const list = filter\r\n      ? viewContacts.filter(\r\n          (c) =>\r\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\r\n        )\r\n      : viewContacts;\r\n    if (viewContacts.length === 0) {\r\n      actionContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n      return;\r\n    }\r\n    if (list.length === 0) {\r\n      actionContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n      return;\r\n    }\r\n    actionContactList.innerHTML = list\r\n      .map((c) => {\r\n        const photoUrl = getContactPhotoUrl(c);\r\n        const isCurrent = (assignee || '').trim() === (c.name || '').trim();\r\n        return `\r\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n            <div class=\"contact-info-picker\">\r\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\r\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\r\n            </div>\r\n          </div>`;\r\n      })\r\n      .join('');\r\n    actionContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\r\n      on(card as HTMLElement, 'click', async () => {\r\n        const name = card.getAttribute('data-contact-name') || '';\r\n        if (!name) return;\r\n        try {\r\n          const updated = await actionsService.update(action.id, { assignee: name });\r\n          toast.success(`Assigned to ${name}`);\r\n          if (actionContactPicker) actionContactPicker.style.display = 'none';\r\n          onUpdate?.(updated);\r\n        } catch {\r\n          toast.error('Failed to save assignment');\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  const showActionPicker = () => {\r\n    if (!actionContactPicker) return;\r\n    actionContactPicker.style.display = actionContactPicker.style.display === 'none' ? 'block' : 'none';\r\n    if (actionContactPicker.style.display === 'block' && viewContacts.length === 0) {\r\n      contactsService.getAll().then((res) => {\r\n        viewContacts = res?.contacts || [];\r\n        renderActionContactGrid(actionContactSearch?.value || '');\r\n      }).catch(() => {\r\n        if (actionContactList) actionContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n      });\r\n    } else if (actionContactPicker.style.display === 'block') {\r\n      renderActionContactGrid(actionContactSearch?.value || '');\r\n    }\r\n    if (actionContactSearch) actionContactSearch.focus();\r\n  };\r\n\r\n  const changeBtn = container.querySelector('#action-change-assignee-btn');\r\n  const showPickerBtn = container.querySelector('#action-show-picker-btn');\r\n  if (changeBtn && actionContactPicker) on(changeBtn as HTMLElement, 'click', showActionPicker);\r\n  if (showPickerBtn && actionContactPicker) on(showPickerBtn as HTMLElement, 'click', showActionPicker);\r\n  if (actionContactSearch) {\r\n    actionContactSearch.addEventListener('input', () => renderActionContactGrid(actionContactSearch.value));\r\n  }\r\n\r\n  // Find contact by assignee name: exact name, partial name, or any alias (case-insensitive)\r\n  function findContactByAssignee(name: string): Contact | undefined {\r\n    if (!name || !viewContacts.length) return undefined;\r\n    const n = name.trim().toLowerCase();\r\n    if (!n) return undefined;\r\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n    if (byExact) return byExact;\r\n    const byPartial = viewContacts.find(\r\n      (c) =>\r\n        (c.name || '').trim().toLowerCase().includes(n) ||\r\n        n.includes((c.name || '').trim().toLowerCase())\r\n    );\r\n    if (byPartial) return byPartial;\r\n    const byAlias = viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n    );\r\n    if (byAlias) return byAlias;\r\n    return viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => {\r\n        const aLower = String(a).trim().toLowerCase();\r\n        return aLower.includes(n) || n.includes(aLower);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Load contacts to show assigned role and avatar in current-assignment card\r\n  contactsService.getAll().then((res) => {\r\n    viewContacts = res?.contacts || [];\r\n    const contact = findContactByAssignee(assignee);\r\n    const roleEl = container.querySelector('#action-assigned-role');\r\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\r\n    const avatarEl = container.querySelector('#action-assigned-avatar');\r\n    if (avatarEl && assignee) {\r\n      const photoUrl = getContactPhotoUrl(contact);\r\n      if (photoUrl) {\r\n        avatarEl.innerHTML = '';\r\n        const img = document.createElement('img');\r\n        img.src = photoUrl;\r\n        img.alt = '';\r\n        img.onerror = () => { avatarEl.textContent = getInitials(assignee); };\r\n        avatarEl.appendChild(img);\r\n      }\r\n    }\r\n  }).catch(() => {});\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Actions Panel Component\r\n * Displays and manages action items\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { actionsService, Action } from '../../services/actions';\r\nimport { dataStore } from '../../stores/data';\r\nimport { showActionModal } from '../modals/ActionModal';\r\nimport { createActionDetailView, ActionDetailViewProps } from '../actions/ActionDetailView';\r\nimport { formatRelativeTime, formatDate } from '../../utils/format';\r\n\r\nfunction actionDetailProps(containerEl: HTMLElement, props: ActionsPanelProps, action: Action): ActionDetailViewProps {\r\n  return {\r\n    action,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createActionsPanel(props));\r\n    },\r\n    onUpdate: (updatedAction?: Action) => {\r\n      containerEl.innerHTML = '';\r\n      if (updatedAction) {\r\n        containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, updatedAction)));\r\n      } else {\r\n        containerEl.appendChild(createActionsPanel(props));\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport interface ActionsPanelProps {\r\n  onActionClick?: (action: Action) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\n\r\n/**\r\n * Create actions panel\r\n */\r\nexport function createActionsPanel(props: ActionsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel actions-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Actions</h2>\r\n        <span class=\"panel-count\" id=\"actions-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"actions-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"pending\">Pending</option>\r\n          <option value=\"in_progress\">In Progress</option>\r\n          <option value=\"completed\">Completed</option>\r\n          <option value=\"overdue\">Overdue</option>\r\n        </select>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-action-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"actions-content\">\r\n      <div class=\"loading\">Loading actions...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const filterSelect = panel.querySelector('#actions-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadActions(panel, props);\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-action-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showActionModal({\r\n        mode: 'create',\r\n        onSave: () => loadActions(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadActions(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load actions\r\n */\r\nasync function loadActions(panel: HTMLElement, props: ActionsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#actions-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const status = currentFilter === 'all' || currentFilter === 'overdue' ? undefined : currentFilter;\r\n    let actions = await actionsService.getAll(status);\r\n\r\n    // Filter overdue\r\n    if (currentFilter === 'overdue') {\r\n      actions = actions.filter(a => actionsService.isOverdue(a));\r\n    }\r\n\r\n    renderActions(content, actions, props);\r\n    dataStore.setActions(actions as unknown as []);\r\n    updateCount(panel, actions.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load actions</div>';\r\n  }\r\n}\r\n\r\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\r\n\r\nfunction findContactByAssignee(contacts: ContactLike[], name: string): ContactLike | undefined {\r\n  if (!name || !contacts.length) return undefined;\r\n  const n = name.trim().toLowerCase();\r\n  if (!n) return undefined;\r\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n  if (byExact) return byExact;\r\n  const byPartial = contacts.find(\r\n    (c) =>\r\n      (c.name || '').trim().toLowerCase().includes(n) ||\r\n      n.includes((c.name || '').trim().toLowerCase())\r\n  );\r\n  if (byPartial) return byPartial;\r\n  const byAlias = contacts.find((c) =>\r\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n  );\r\n  return byAlias || contacts.find((c) =>\r\n    (c.aliases || []).some((a) => {\r\n      const aLower = String(a).trim().toLowerCase();\r\n      return aLower.includes(n) || n.includes(aLower);\r\n    })\r\n  );\r\n}\r\n\r\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\r\n  if (!c) return null;\r\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\n/**\r\n * Render actions list\r\n */\r\nfunction renderActions(container: HTMLElement, actions: Action[], props: ActionsPanelProps): void {\r\n  if (actions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No actions found</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Action</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showActionModal({ mode: 'create' });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const priorityBarColor: Record<string, string> = { high: '#ea580c', medium: '#ca8a04', low: '#16a34a' };\r\n\r\n  container.innerHTML = actions.map(action => {\r\n    const isOverdue = actionsService.isOverdue(action);\r\n    const priority = (action.priority || 'medium').toLowerCase();\r\n    const barColor = priorityBarColor[priority] ?? priorityBarColor.medium;\r\n    const content = (action.content ?? (action as { task?: string }).task ?? '').trim();\r\n    const assignee = action.assignee ?? (action as { owner?: string }).owner ?? '';\r\n    const contact = assignee ? findContactByAssignee(contacts, assignee) : undefined;\r\n    const photoUrl = getContactPhotoUrl(contact);\r\n    const assigneeChipHtml = assignee\r\n      ? `\r\n        <div class=\"assignee-chip\">\r\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(assignee)}\" onerror=\"this.parentElement.innerHTML='${getInitials(assignee)}'\">` : getInitials(assignee)}</div>\r\n          <div class=\"assignee-info\">\r\n            <span class=\"assignee-name\">${escapeHtml(assignee)}</span>\r\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n          </div>\r\n        </div>\r\n      `\r\n      : '';\r\n    const dueChip = action.due_date ? `<span class=\"card-source-chip\">Due: ${formatDate(action.due_date)}</span>` : '<span class=\"card-source-chip text-muted\">No due date</span>';\r\n    return `\r\n      <div class=\"action-card-sota question-card-sota ${isOverdue ? 'overdue' : ''}\" data-id=\"${action.id}\" style=\"--action-priority-bar: ${barColor}\">\r\n        <div class=\"card-priority-bar action-priority-bar\" style=\"background: ${barColor}\"></div>\r\n        <div class=\"card-body\">\r\n          <div class=\"card-top-row\">\r\n            <div class=\"card-badges\">\r\n              <span class=\"status-pill status-${(action.status || 'pending').toLowerCase()}\">${escapeHtml(String(action.status).replace('_', ' '))}</span>\r\n              ${action.priority ? `<span class=\"priority-pill priority-${action.priority}\">${escapeHtml(action.priority)}</span>` : ''}\r\n              ${isOverdue ? '<span class=\"status-pill overdue\">OVERDUE</span>' : ''}\r\n            </div>\r\n            <span class=\"card-timestamp\">${formatRelativeTime(action.created_at)}</span>\r\n          </div>\r\n          <div class=\"card-question-text\">${escapeHtml(content)}</div>\r\n          <div class=\"card-bottom-row\">\r\n            <div class=\"card-requester\">\r\n              ${assigneeChipHtml}\r\n              ${dueChip}\r\n            </div>\r\n            <div class=\"card-assignment\">\r\n              <button type=\"button\" class=\"btn-link action-view-link\">View</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }).join('');\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.action-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.card-assignment')) return;\r\n      const id = card.getAttribute('data-id');\r\n      const action = actions.find(a => String(a.id) === id);\r\n      if (!action) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, action)));\r\n      } else if (props.onActionClick) {\r\n        props.onActionClick(action);\r\n      } else {\r\n        showActionModal({\r\n          mode: 'edit',\r\n          action,\r\n          onSave: () => loadActions(container.closest('.actions-panel') as HTMLElement, props),\r\n        });\r\n      }\r\n    });\r\n    const viewLink = card.querySelector('.action-view-link');\r\n    if (viewLink) {\r\n      on(viewLink as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        const action = actions.find(a => String(a.id) === id);\r\n        if (!action) return;\r\n        if (props.useDetailView && props.containerElement) {\r\n          const containerEl = props.containerElement;\r\n          containerEl.innerHTML = '';\r\n          containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, action)));\r\n        } else if (props.onActionClick) {\r\n          props.onActionClick(action);\r\n        } else {\r\n          showActionModal({\r\n            mode: 'edit',\r\n            action,\r\n            onSave: () => loadActions(container.closest('.actions-panel') as HTMLElement, props),\r\n          });\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Update count badge\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#actions-count');\r\n  if (countEl) {\r\n    countEl.textContent = String(count);\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createActionsPanel;\r\n","/**\r\n * Decision Modal Component\r\n * Create, view and edit decisions\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { Decision } from '../../stores/data';\r\nimport { http } from '../../services/api';\r\nimport { decisionsService } from '../../services/decisions';\r\nimport { contactsService, Contact } from '../../services/contacts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\nfunction getContactPhotoUrl(c: Contact | undefined): string | null {\r\n  if (!c) return null;\r\n  const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\r\n  return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\r\n}\r\n\r\nconst MODAL_ID = 'decision-modal';\r\n\r\nexport interface DecisionModalProps {\r\n  mode: 'view' | 'edit' | 'create';\r\n  decision?: Decision;\r\n  onSave?: (decision: Decision) => void;\r\n  onDelete?: (decisionId: string) => void;\r\n}\r\n\r\n/**\r\n * Show decision modal\r\n */\r\nexport function showDecisionModal(props: DecisionModalProps): void {\r\n  const { mode, decision, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit' && decision?.id;\r\n  const isView = mode === 'view';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'decision-modal-content' });\r\n\r\n  if (isView && decision) {\r\n    const viewContent = (decision as any).content ?? decision.decision;\r\n    const viewImpact = (decision as any).impact;\r\n    const viewSummary = (decision as any).summary;\r\n    content.innerHTML = `\r\n      <div class=\"decision-view\">\r\n        <div class=\"decision-meta\">\r\n          <span class=\"status-badge ${decision.status}\">${decision.status}</span>\r\n          ${viewImpact ? `<span class=\"impact-badge impact-${viewImpact}\">${escapeHtml(viewImpact)} impact</span>` : ''}\r\n          <span class=\"decision-date\">${formatRelativeTime(decision.madeAt)}</span>\r\n        </div>\r\n        \r\n        <div class=\"decision-text-large\">\r\n          ${escapeHtml(viewContent)}\r\n        </div>\r\n        \r\n        ${viewSummary ? `\r\n          <div class=\"decision-section decision-summary\">\r\n            <h4>Summary</h4>\r\n            <p>${escapeHtml(viewSummary)}</p>\r\n          </div>\r\n        ` : ''}\r\n        \r\n        ${decision.rationale ? `\r\n          <div class=\"decision-section\">\r\n            <h4>Rationale</h4>\r\n            <p>${escapeHtml(decision.rationale)}</p>\r\n          </div>\r\n        ` : ''}\r\n        \r\n        ${decision.madeBy ? `\r\n          <div class=\"decision-made-by\">\r\n            <strong>Decision made by:</strong> ${escapeHtml(decision.madeBy)}\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n  } else {\r\n    const decisionContent = (decision as any)?.content ?? decision?.decision ?? '';\r\n    const decisionImpact = (decision as any)?.impact ?? '';\r\n    const decisionSummary = (decision as any)?.summary ?? '';\r\n    content.innerHTML = `\r\n      <form id=\"decision-form\" class=\"decision-form\">\r\n        <div class=\"form-group\">\r\n          <label for=\"decision-text\">Decision *</label>\r\n          <textarea id=\"decision-text\" rows=\"3\" required \r\n                    placeholder=\"What was decided?\">${escapeHtml(decisionContent)}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"decision-rationale\">Rationale</label>\r\n          <div class=\"form-group-with-action\">\r\n            <textarea id=\"decision-rationale\" rows=\"2\" \r\n                      placeholder=\"Why was this decision made?\">${escapeHtml(decision?.rationale || '')}</textarea>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"decision-impact\">Impact</label>\r\n            <select id=\"decision-impact\">\r\n              <option value=\"\"></option>\r\n              <option value=\"low\" ${decisionImpact === 'low' ? 'selected' : ''}>Low</option>\r\n              <option value=\"medium\" ${decisionImpact === 'medium' || !decisionImpact ? 'selected' : ''}>Medium</option>\r\n              <option value=\"high\" ${decisionImpact === 'high' ? 'selected' : ''}>High</option>\r\n            </select>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"decision-summary\">Summary (one line)</label>\r\n            <input type=\"text\" id=\"decision-summary\" \r\n                   value=\"${escapeHtml(decisionSummary)}\" \r\n                   placeholder=\"One-line summary for lists/reports\">\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-row form-row-actions\">\r\n          <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"decision-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\r\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n            AI suggest\r\n          </button>\r\n          <span class=\"form-hint\" id=\"decision-suggest-hint\"></span>\r\n        </div>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"decision-status\">Status</label>\r\n            <select id=\"decision-status\">\r\n              <option value=\"proposed\" ${decision?.status === 'proposed' || !decision ? 'selected' : ''}>Proposed</option>\r\n              <option value=\"approved\" ${decision?.status === 'approved' ? 'selected' : ''}>Approved</option>\r\n              <option value=\"rejected\" ${decision?.status === 'rejected' ? 'selected' : ''}>Rejected</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label>Made By</label>\r\n            <input type=\"hidden\" id=\"decision-by\" value=\"${escapeHtml(decision?.madeBy || '')}\">\r\n            <div id=\"decision-made-by-display\" class=\"current-assignment-card decision-modal-owner-card\"></div>\r\n            <div id=\"decision-modal-contact-picker\" class=\"contact-picker-sota\" style=\"display: none; margin-top: 8px;\">\r\n              <div class=\"picker-search\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\r\n                <input type=\"text\" id=\"decision-modal-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"decision-modal-contact-list\" class=\"contact-list-grid\">Loading...</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </form>\r\n    `;\r\n\r\n    const suggestBtn = content.querySelector('#decision-ai-suggest-btn');\r\n    const hintEl = content.querySelector('#decision-suggest-hint');\r\n    if (suggestBtn) {\r\n      on(suggestBtn as HTMLElement, 'click', async () => {\r\n        const getVal = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value?.trim() || '';\r\n        const text = getVal('decision-text');\r\n        if (!text) {\r\n          toast.warning('Enter decision text first');\r\n          return;\r\n        }\r\n        (suggestBtn as HTMLButtonElement).disabled = true;\r\n        if (hintEl) hintEl.textContent = 'Asking AI';\r\n        try {\r\n          const result = await decisionsService.suggest(text, getVal('decision-rationale'));\r\n          (content.querySelector('#decision-rationale') as HTMLTextAreaElement).value = result.rationale || '';\r\n          (content.querySelector('#decision-impact') as HTMLSelectElement).value = result.impact || 'medium';\r\n          (content.querySelector('#decision-summary') as HTMLInputElement).value = result.summary || '';\r\n          if (hintEl) hintEl.textContent = result.impact_summary ? `Impact: ${result.impact_summary}` : 'Done';\r\n        } catch {\r\n          if (hintEl) hintEl.textContent = '';\r\n          toast.error('AI suggest failed');\r\n        } finally {\r\n          (suggestBtn as HTMLButtonElement).disabled = false;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Made By: contact picker + current-assignment display\r\n    let modalContacts: Contact[] = [];\r\n    const madeByDisplay = content.querySelector('#decision-made-by-display') as HTMLElement;\r\n    const madeByInput = content.querySelector('#decision-by') as HTMLInputElement;\r\n    const modalPicker = content.querySelector('#decision-modal-contact-picker') as HTMLElement;\r\n    const modalContactList = content.querySelector('#decision-modal-contact-list') as HTMLElement;\r\n    const modalContactSearch = content.querySelector('#decision-modal-contact-search') as HTMLInputElement;\r\n\r\n    function findContactByName(name: string): Contact | undefined {\r\n      if (!name || !modalContacts.length) return undefined;\r\n      const n = name.trim().toLowerCase();\r\n      if (!n) return undefined;\r\n      const byExact = modalContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n      if (byExact) return byExact;\r\n      const byAlias = modalContacts.find((c) =>\r\n        (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n      );\r\n      return byAlias;\r\n    }\r\n\r\n    function renderMadeByDisplay(madeBy: string) {\r\n      if (!madeByDisplay || !madeByInput) return;\r\n      madeByInput.value = madeBy;\r\n      if (madeBy) {\r\n        const contact = findContactByName(madeBy);\r\n        const photoUrl = getContactPhotoUrl(contact);\r\n        madeByDisplay.innerHTML = `\r\n          <div class=\"assigned-contact-display\">\r\n            <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(madeBy)}'\">` : getInitials(madeBy)}</div>\r\n            <div class=\"contact-details\">\r\n              <div class=\"contact-name-lg\">${escapeHtml(madeBy)}</div>\r\n              ${contact?.role ? `<div class=\"contact-role-sm\">${escapeHtml(contact.role)}</div>` : ''}\r\n            </div>\r\n            <button type=\"button\" class=\"btn-change-assignment\" id=\"decision-modal-change-owner-btn\">\r\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n              Change\r\n            </button>\r\n          </div>`;\r\n      } else {\r\n        madeByDisplay.innerHTML = `\r\n          <div class=\"no-assignment\">\r\n            <span>No owner</span>\r\n            <button type=\"button\" class=\"btn-assign-now\" id=\"decision-modal-choose-owner-btn\">Choose</button>\r\n          </div>`;\r\n      }\r\n      const changeBtn = madeByDisplay.querySelector('#decision-modal-change-owner-btn');\r\n      const chooseBtn = madeByDisplay.querySelector('#decision-modal-choose-owner-btn');\r\n      if (changeBtn) on(changeBtn as HTMLElement, 'click', showModalPicker);\r\n      if (chooseBtn) on(chooseBtn as HTMLElement, 'click', showModalPicker);\r\n    }\r\n\r\n    function showModalPicker() {\r\n      if (!modalPicker) return;\r\n      modalPicker.style.display = modalPicker.style.display === 'none' ? 'block' : 'none';\r\n      if (modalPicker.style.display === 'block' && modalContacts.length === 0) {\r\n        contactsService.getAll().then((res) => {\r\n          modalContacts = res?.contacts || [];\r\n          renderModalContactGrid(modalContactSearch?.value || '');\r\n        }).catch(() => {\r\n          if (modalContactList) modalContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        });\r\n      } else if (modalPicker.style.display === 'block') {\r\n        renderModalContactGrid(modalContactSearch?.value || '');\r\n      }\r\n      if (modalContactSearch) modalContactSearch.focus();\r\n    }\r\n\r\n    function renderModalContactGrid(filter: string) {\r\n      if (!modalContactList) return;\r\n      const list = filter\r\n        ? modalContacts.filter(\r\n            (c) =>\r\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n          )\r\n        : modalContacts;\r\n      if (modalContacts.length === 0) {\r\n        modalContactList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n        return;\r\n      }\r\n      if (list.length === 0) {\r\n        modalContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n        return;\r\n      }\r\n      const currentMadeBy = (madeByInput?.value || '').trim();\r\n      modalContactList.innerHTML = list\r\n        .map((c) => {\r\n          const photoUrl = getContactPhotoUrl(c);\r\n          const isCurrent = currentMadeBy === (c.name || '').trim();\r\n          return `\r\n            <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n              <div class=\"contact-info-picker\">\r\n                <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>`;\r\n        })\r\n        .join('');\r\n      modalContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\r\n        on(card as HTMLElement, 'click', () => {\r\n          const name = card.getAttribute('data-contact-name') || '';\r\n          if (name) {\r\n            renderMadeByDisplay(name);\r\n            if (modalPicker) modalPicker.style.display = 'none';\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    contactsService.getAll().then((res) => {\r\n      modalContacts = res?.contacts || [];\r\n      renderMadeByDisplay(decision?.madeBy || '');\r\n    }).catch(() => {\r\n      renderMadeByDisplay(decision?.madeBy || '');\r\n    });\r\n\r\n    if (modalContactSearch) {\r\n      modalContactSearch.addEventListener('input', () => renderModalContactGrid(modalContactSearch.value));\r\n    }\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (isView && decision) {\r\n    // Quick status change buttons for proposed decisions\r\n    if (decision.status === 'proposed') {\r\n      const approveBtn = createElement('button', {\r\n        className: 'btn btn-success',\r\n        textContent: 'Approve',\r\n      });\r\n\r\n      const rejectBtn = createElement('button', {\r\n        className: 'btn btn-danger',\r\n        textContent: 'Reject',\r\n      });\r\n\r\n      on(approveBtn, 'click', () => updateStatus(String(decision.id), 'approved', onSave));\r\n      on(rejectBtn, 'click', () => updateStatus(String(decision.id), 'rejected', onSave));\r\n\r\n      footer.appendChild(rejectBtn);\r\n      footer.appendChild(approveBtn);\r\n    }\r\n\r\n    const editBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Edit',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n    on(editBtn, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showDecisionModal({ ...props, mode: 'edit' });\r\n    });\r\n\r\n    footer.appendChild(closeBtn);\r\n    footer.appendChild(editBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const saveBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: isEdit ? 'Save Changes' : 'Create Decision',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(saveBtn, 'click', async () => {\r\n      const form = content.querySelector('#decision-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\r\n\r\n      const decisionData: Decision & { impact?: string; summary?: string } = {\r\n        id: decision?.id || `dec-${Date.now()}`,\r\n        decision: getValue('decision-text'),\r\n        rationale: getValue('decision-rationale') || undefined,\r\n        status: getValue('decision-status') as Decision['status'],\r\n        madeBy: getValue('decision-by') || undefined,\r\n        madeAt: decision?.madeAt || new Date().toISOString(),\r\n        impact: getValue('decision-impact') as 'low' | 'medium' | 'high' || undefined,\r\n        summary: getValue('decision-summary') || undefined,\r\n      };\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      const apiPayload = {\r\n        content: decisionData.decision,\r\n        decision: decisionData.decision,\r\n        rationale: decisionData.rationale,\r\n        status: decisionData.status,\r\n        made_by: decisionData.madeBy,\r\n        impact: decisionData.impact,\r\n        summary: decisionData.summary,\r\n      };\r\n      try {\r\n        if (isEdit) {\r\n          await http.put(`/api/decisions/${decision!.id}`, apiPayload);\r\n          toast.success('Decision updated');\r\n        } else {\r\n          const response = await http.post<{ id: string }>('/api/decisions', apiPayload);\r\n          decisionData.id = response.data.id;\r\n          toast.success('Decision recorded');\r\n        }\r\n\r\n        onSave?.(decisionData);\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Decision';\r\n      }\r\n    });\r\n\r\n    if (isEdit) {\r\n      const deleteBtn = createElement('button', {\r\n        className: 'btn btn-danger',\r\n        textContent: 'Delete',\r\n      });\r\n\r\n      on(deleteBtn, 'click', async () => {\r\n        const { confirm } = await import('../Modal');\r\n        const confirmed = await confirm(\r\n          'Are you sure you want to delete this decision?',\r\n          {\r\n            title: 'Delete Decision',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await http.delete(`/api/decisions/${decision!.id}`);\r\n            toast.success('Decision deleted');\r\n            onDelete?.(String(decision!.id));\r\n            closeModal(MODAL_ID);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n\r\n      footer.appendChild(deleteBtn);\r\n    }\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(saveBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: isView ? 'Decision Details' : (isEdit ? 'Edit Decision' : 'Record Decision'),\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Update decision status\r\n */\r\nasync function updateStatus(\r\n  decisionId: string,\r\n  status: Decision['status'],\r\n  onSave?: (decision: Decision) => void\r\n): Promise<void> {\r\n  try {\r\n    await http.patch(`/api/decisions/${decisionId}`, { status });\r\n    toast.success(`Decision ${status}`);\r\n    closeModal(MODAL_ID);\r\n    // Note: In a real app, we'd update the local state here\r\n  } catch {\r\n    // Error shown by API service\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showDecisionModal;\r\n","/**\r\n * Decision Detail View\r\n * Full-page view for decision details: content, status, rationale, owner, source, timeline, similar decisions\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Decision, decisionsService } from '../../services/decisions';\r\nimport { contactsService, Contact } from '../../services/contacts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\r\n\r\nfunction getInitials(name: string): string {\r\n  return name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\r\n}\r\n\r\nexport interface DecisionDetailViewProps {\r\n  decision: Decision;\r\n  onClose: () => void;\r\n  onUpdate?: (decision: Decision) => void;\r\n  onDecisionClick?: (decision: Decision) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nexport function createDecisionDetailView(props: DecisionDetailViewProps): HTMLElement {\r\n  const { decision, onClose, onUpdate, onDecisionClick } = props;\r\n\r\n  const container = createElement('div', { className: 'decision-detail-view question-detail-view' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header decision-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Decisions</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Decision #${String(decision.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        <span class=\"status-badge status-${(decision.status || 'active').toLowerCase()}\">${escapeHtml(String(decision.status))}</span>\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content decision-detail-content\">\r\n      <div id=\"decision-view-content\">\r\n      <section class=\"detail-section decision-main\">\r\n        <div class=\"question-badges decision-badges\">\r\n          ${decision.impact ? `<span class=\"priority-pill impact-${decision.impact}\">${escapeHtml(decision.impact)} impact</span>` : ''}\r\n          ${decision.generation_source ? `<span class=\"status-pill\">${escapeHtml(decision.generation_source)}</span>` : ''}\r\n          <span class=\"question-date decision-date\">Created ${formatRelativeTime(decision.created_at)}</span>\r\n        </div>\r\n        <h2 class=\"question-text decision-content-text\" id=\"decision-view-content-text\">${escapeHtml(decision.content)}</h2>\r\n      </section>\r\n\r\n      <div class=\"detail-columns\">\r\n        <div class=\"detail-column-left\">\r\n          <section class=\"detail-section\">\r\n            <div class=\"section-header-sota\">\r\n              <h3>Rationale / Context</h3>\r\n              <span class=\"section-subtitle\">Why was this decision made?</span>\r\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"decision-rationale-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI Suggest\r\n              </button>\r\n            </div>\r\n            <div id=\"decision-view-rationale\">${(decision.rationale || decision.context) ? `<p class=\"decision-rationale\">${escapeHtml(decision.rationale || decision.context || '')}</p>` : '<p class=\"text-muted\">No rationale recorded</p>'}</div>\r\n            <div id=\"decision-suggestions-panel\" class=\"suggestions-panel-sota decision-suggestions-panel\" style=\"display: none; margin-top: 8px;\"></div>\r\n          </section>\r\n\r\n          <section class=\"detail-section\" id=\"decision-owner-section\">\r\n            <div class=\"section-header-sota\">\r\n              <h3>\r\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Owner / Made by\r\n                <span class=\"section-subtitle\">Who made this decision?</span>\r\n              </h3>\r\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"decision-owner-ai-suggest-btn\" title=\"Suggest owner from decision content\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI Suggest\r\n              </button>\r\n            </div>\r\n\r\n            <div id=\"decision-current-owner\" class=\"current-assignment-card\">\r\n              ${(decision.made_by || decision.owner) ? `\r\n                <div class=\"assigned-contact-display\">\r\n                  <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${getInitials(decision.made_by || decision.owner || '')}</div>\r\n                  <div class=\"contact-details\">\r\n                    <div class=\"contact-name-lg\">${escapeHtml(decision.made_by || decision.owner || '')}</div>\r\n                    <div class=\"contact-role-sm\" id=\"decision-owner-role\"></div>\r\n                  </div>\r\n                  <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\r\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                    Change\r\n                  </button>\r\n                </div>\r\n              ` : `\r\n                <div class=\"no-assignment\">\r\n                  <div class=\"no-assignment-icon\">\r\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\r\n                  </div>\r\n                  <span>No owner</span>\r\n                  <p class=\"no-assignment-hint\">Choose from contacts</p>\r\n                  <button class=\"btn-assign-now\" id=\"decision-show-owner-picker-btn\" type=\"button\">Choose</button>\r\n                </div>\r\n              `}\r\n            </div>\r\n\r\n            <div id=\"decision-contact-picker\" class=\"contact-picker-sota\" style=\"display: none;\">\r\n              <div class=\"picker-search\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\r\n                <input type=\"text\" id=\"decision-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"decision-contact-list\" class=\"contact-list-grid\">Loading...</div>\r\n            </div>\r\n\r\n            <div id=\"decision-owner-suggestions-panel\" class=\"suggestions-panel-sota decision-owner-suggestions-panel\" style=\"display: none; margin-top: 8px;\"></div>\r\n\r\n            ${decision.approved_by ? `<p class=\"text-muted\" style=\"margin-top: 8px;\">Approved by: ${escapeHtml(decision.approved_by)}</p>` : ''}\r\n            ${decision.decided_at ? `<p class=\"text-muted\">Decided: ${formatDate(decision.decided_at)}</p>` : ''}\r\n          </section>\r\n\r\n          <section class=\"detail-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Source</h3>\r\n            </div>\r\n            ${decision.source_file ? `<p class=\"source-file\">${escapeHtml(decision.source_file)}</p>` : ''}\r\n            ${decision.source_document_id ? `\r\n              <p class=\"source-doc\">\r\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(decision.source_document_id))}\">View source document</a>\r\n              </p>\r\n            ` : ''}\r\n            ${!decision.source_file && !decision.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\r\n          </section>\r\n        </div>\r\n\r\n        <div class=\"detail-column-right\">\r\n          <section class=\"detail-section metadata-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Metadata</h3>\r\n            </div>\r\n            <dl class=\"metadata-list\">\r\n              <dt>Created</dt>\r\n              <dd>${formatDate(decision.created_at)}</dd>\r\n              ${decision.updated_at ? `<dt>Updated</dt><dd>${formatDate(decision.updated_at)}</dd>` : ''}\r\n            </dl>\r\n          </section>\r\n\r\n          <section class=\"detail-section decision-timeline-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Timeline</h3>\r\n            </div>\r\n            <div id=\"decision-timeline-list\" class=\"decision-timeline-list\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n\r\n          <section class=\"detail-section decision-similar-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Similar decisions</h3>\r\n            </div>\r\n            <div id=\"decision-similar-list\" class=\"decision-similar-list\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"detail-actions\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-decision-btn\">Edit</button>\r\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-decision-btn\">Delete</button>\r\n      </div>\r\n      </div>\r\n\r\n      <div id=\"decision-edit-form\" class=\"decision-detail-edit-form\" style=\"display: none;\">\r\n        <form id=\"decision-inline-form\" class=\"decision-form\">\r\n          <div class=\"form-group\">\r\n            <label for=\"decision-edit-content\">Decision *</label>\r\n            <textarea id=\"decision-edit-content\" rows=\"3\" required placeholder=\"What was decided?\">${escapeHtml(decision.content || '')}</textarea>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <div style=\"display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px; margin-bottom: 6px;\">\r\n              <label for=\"decision-edit-rationale\" style=\"margin-bottom: 0;\">Rationale</label>\r\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"decision-edit-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI suggest\r\n              </button>\r\n            </div>\r\n            <textarea id=\"decision-edit-rationale\" rows=\"2\" placeholder=\"Why was this decision made?\">${escapeHtml(decision.rationale || decision.context || '')}</textarea>\r\n          </div>\r\n          <div id=\"decision-edit-suggestions-panel\" class=\"suggestions-panel-sota\" style=\"display: none; margin-bottom: 12px;\"></div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group\">\r\n              <label for=\"decision-edit-impact\">Impact</label>\r\n              <select id=\"decision-edit-impact\">\r\n                <option value=\"low\" ${decision.impact === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${decision.impact === 'medium' || !decision.impact ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${decision.impact === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"decision-edit-summary\">Summary (one line)</label>\r\n              <input type=\"text\" id=\"decision-edit-summary\" value=\"${escapeHtml((decision as { summary?: string }).summary || '')}\" placeholder=\"One-line summary for lists/reports\">\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"decision-edit-status\">Status</label>\r\n              <select id=\"decision-edit-status\">\r\n                <option value=\"proposed\" ${decision.status === 'proposed' || !decision.status ? 'selected' : ''}>Proposed</option>\r\n                <option value=\"approved\" ${decision.status === 'approved' ? 'selected' : ''}>Approved</option>\r\n                <option value=\"rejected\" ${decision.status === 'rejected' ? 'selected' : ''}>Rejected</option>\r\n                <option value=\"deferred\" ${decision.status === 'deferred' ? 'selected' : ''}>Deferred</option>\r\n                <option value=\"active\" ${decision.status === 'active' ? 'selected' : ''}>Active</option>\r\n                <option value=\"superseded\" ${decision.status === 'superseded' ? 'selected' : ''}>Superseded</option>\r\n                <option value=\"revoked\" ${decision.status === 'revoked' ? 'selected' : ''}>Revoked</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label>Made by</label>\r\n            <input type=\"hidden\" id=\"decision-edit-made-by\" value=\"${escapeHtml(decision.made_by || (decision as { owner?: string }).owner || '')}\">\r\n            <div id=\"decision-edit-owner-display\" class=\"current-assignment-card decision-edit-owner-card\"></div>\r\n            <div id=\"decision-edit-contact-picker\" class=\"contact-picker-sota\" style=\"display: none; margin-top: 8px;\">\r\n              <div class=\"picker-search\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\r\n                <input type=\"text\" id=\"decision-edit-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"decision-edit-contact-list\" class=\"contact-list-grid\">Loading...</div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"decision-save-btn\">Save</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"decision-cancel-edit-btn\">Cancel</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"decision-delete-in-edit-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  const viewContent = container.querySelector('#decision-view-content') as HTMLElement;\r\n  const editForm = container.querySelector('#decision-edit-form') as HTMLElement;\r\n\r\n  const editBtn = container.querySelector('#edit-decision-btn');\r\n  if (editBtn && viewContent && editForm) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      viewContent.style.display = 'none';\r\n      editForm.style.display = 'block';\r\n      // Sync edit form owner (in case owner was changed in view)\r\n      renderEditFormOwnerDisplay(currentOwnerName);\r\n    });\r\n  }\r\n\r\n  const cancelEditBtn = container.querySelector('#decision-cancel-edit-btn');\r\n  if (cancelEditBtn && viewContent && editForm) {\r\n    on(cancelEditBtn as HTMLElement, 'click', () => {\r\n      editForm.style.display = 'none';\r\n      viewContent.style.display = '';\r\n    });\r\n  }\r\n\r\n  const saveBtn = container.querySelector('#decision-save-btn');\r\n  if (saveBtn && editForm && onUpdate) {\r\n    on(saveBtn as HTMLElement, 'click', async () => {\r\n      const form = container.querySelector('#decision-inline-form') as HTMLFormElement;\r\n      if (!form?.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n      const contentEl = container.querySelector('#decision-edit-content') as HTMLTextAreaElement;\r\n      const rationaleEl = container.querySelector('#decision-edit-rationale') as HTMLTextAreaElement;\r\n      const impactEl = container.querySelector('#decision-edit-impact') as HTMLSelectElement;\r\n      const summaryEl = container.querySelector('#decision-edit-summary') as HTMLInputElement;\r\n      const statusEl = container.querySelector('#decision-edit-status') as HTMLSelectElement;\r\n      const madeByEl = container.querySelector('#decision-edit-made-by') as HTMLInputElement;\r\n      const content = contentEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.error('Decision text is required');\r\n        return;\r\n      }\r\n      (saveBtn as HTMLButtonElement).disabled = true;\r\n      (saveBtn as HTMLButtonElement).textContent = 'Saving...';\r\n      try {\r\n        const updated = await decisionsService.update(decision.id, {\r\n          content,\r\n          rationale: rationaleEl?.value?.trim() || undefined,\r\n          impact: (impactEl?.value || undefined) as Decision['impact'],\r\n          summary: (summaryEl?.value?.trim() || undefined) as string | undefined,\r\n          status: (statusEl?.value || 'active') as Decision['status'],\r\n          made_by: madeByEl?.value?.trim() || undefined,\r\n        });\r\n        toast.success('Decision updated');\r\n        // Update view DOM from response\r\n        const viewContentText = container.querySelector('#decision-view-content-text');\r\n        if (viewContentText) viewContentText.textContent = updated.content || content;\r\n        const viewRationale = container.querySelector('#decision-view-rationale');\r\n        if (viewRationale) {\r\n          viewRationale.innerHTML = (updated.rationale || updated.context)\r\n            ? `<p class=\"decision-rationale\">${escapeHtml(updated.rationale || updated.context || '')}</p>`\r\n            : '<p class=\"text-muted\">No rationale recorded</p>';\r\n        }\r\n        const statusBadge = container.querySelector('.decision-detail-header .status-badge');\r\n        if (statusBadge) {\r\n          statusBadge.textContent = String(updated.status || 'active');\r\n          statusBadge.className = `status-badge status-${(updated.status || 'active').toLowerCase()}`;\r\n        }\r\n        const badges = container.querySelector('.decision-badges');\r\n        if (badges) {\r\n          const impactPill = (updated as Decision).impact\r\n            ? `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span>`\r\n            : '';\r\n          const existing = badges.innerHTML;\r\n          if (impactPill && !existing.includes('impact-')) {\r\n            badges.insertAdjacentHTML('afterbegin', impactPill + ' ');\r\n          } else if (impactPill) {\r\n            const oldPill = badges.querySelector('.priority-pill.impact-');\r\n            if (oldPill) oldPill.outerHTML = impactPill;\r\n          }\r\n        }\r\n        currentOwnerName = updated.made_by || (updated as { owner?: string }).owner || '';\r\n        // Refresh owner display in view\r\n        const currentOwnerEl = container.querySelector('#decision-current-owner');\r\n        if (currentOwnerEl && currentOwnerName) {\r\n          const contact = findContactByOwner(currentOwnerName);\r\n          const photoUrl = getContactPhotoUrl(contact);\r\n          currentOwnerEl.innerHTML = `\r\n            <div class=\"assigned-contact-display\">\r\n              <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(currentOwnerName)}'\">` : getInitials(currentOwnerName)}</div>\r\n              <div class=\"contact-details\">\r\n                <div class=\"contact-name-lg\">${escapeHtml(currentOwnerName)}</div>\r\n                <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\r\n              </div>\r\n              <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                Change\r\n              </button>\r\n            </div>`;\r\n          const chBtn = currentOwnerEl.querySelector('#decision-change-owner-btn');\r\n          if (chBtn) on(chBtn as HTMLElement, 'click', showOwnerPicker);\r\n        } else if (currentOwnerEl && !currentOwnerName) {\r\n          currentOwnerEl.innerHTML = `\r\n            <div class=\"no-assignment\">\r\n              <div class=\"no-assignment-icon\">\r\n                <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\r\n              </div>\r\n              <span>No owner</span>\r\n              <p class=\"no-assignment-hint\">Choose from contacts</p>\r\n              <button class=\"btn-assign-now\" id=\"decision-show-owner-picker-btn\" type=\"button\">Choose</button>\r\n            </div>`;\r\n          const showBtn = currentOwnerEl.querySelector('#decision-show-owner-picker-btn');\r\n          if (showBtn) on(showBtn as HTMLElement, 'click', showOwnerPicker);\r\n        }\r\n        onUpdate(updated);\r\n        editForm.style.display = 'none';\r\n        viewContent.style.display = '';\r\n      } catch {\r\n        toast.error('Failed to save decision');\r\n      } finally {\r\n        (saveBtn as HTMLButtonElement).disabled = false;\r\n        (saveBtn as HTMLButtonElement).textContent = 'Save';\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteInEditBtn = container.querySelector('#decision-delete-in-edit-btn');\r\n  if (deleteInEditBtn) {\r\n    on(deleteInEditBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this decision?')) return;\r\n      try {\r\n        await decisionsService.delete(decision.id);\r\n        toast.success('Decision deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete decision');\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteBtn = container.querySelector('#delete-decision-btn');\r\n  if (deleteBtn) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this decision?')) return;\r\n      try {\r\n        await decisionsService.delete(decision.id);\r\n        toast.success('Decision deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete decision');\r\n      }\r\n    });\r\n  }\r\n\r\n  const docLink = container.querySelector('.doc-link');\r\n  if (docLink && decision.source_document_id) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n        detail: { tab: 'files', documentId: decision.source_document_id }\r\n      }));\r\n    });\r\n  }\r\n\r\n  // Owner section: load contacts, show avatar/role, contact picker\r\n  let viewContacts: Contact[] = [];\r\n  let currentOwnerName = decision.made_by || (decision as { owner?: string }).owner || '';\r\n  const ownerPicker = container.querySelector('#decision-contact-picker') as HTMLElement;\r\n  const ownerList = container.querySelector('#decision-contact-list') as HTMLElement;\r\n  const ownerSearch = container.querySelector('#decision-contact-search') as HTMLInputElement;\r\n\r\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\r\n    if (!c) return null;\r\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\r\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\r\n  }\r\n\r\n  function findContactByOwner(name: string): Contact | undefined {\r\n    if (!name || !viewContacts.length) return undefined;\r\n    const n = name.trim().toLowerCase();\r\n    if (!n) return undefined;\r\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n    if (byExact) return byExact;\r\n    const byPartial = viewContacts.find(\r\n      (c) =>\r\n        (c.name || '').trim().toLowerCase().includes(n) ||\r\n        n.includes((c.name || '').trim().toLowerCase())\r\n    );\r\n    if (byPartial) return byPartial;\r\n    const byAlias = viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n    );\r\n    return byAlias || viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => {\r\n        const aLower = String(a).trim().toLowerCase();\r\n        return aLower.includes(n) || n.includes(aLower);\r\n      })\r\n    );\r\n  }\r\n\r\n  const renderOwnerContactGrid = (filter = '') => {\r\n    if (!ownerList) return;\r\n    const list = filter\r\n      ? viewContacts.filter(\r\n          (c) =>\r\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\r\n        )\r\n      : viewContacts;\r\n    if (viewContacts.length === 0) {\r\n      ownerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n      return;\r\n    }\r\n    if (list.length === 0) {\r\n      ownerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n      return;\r\n    }\r\n    ownerList.innerHTML = list\r\n      .map((c) => {\r\n        const photoUrl = getContactPhotoUrl(c);\r\n        const isCurrent = (currentOwnerName || '').trim() === (c.name || '').trim();\r\n        return `\r\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n            <div class=\"contact-info-picker\">\r\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\r\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\r\n            </div>\r\n          </div>`;\r\n      })\r\n      .join('');\r\n    ownerList.querySelectorAll('.contact-card-picker').forEach((card) => {\r\n      on(card as HTMLElement, 'click', async () => {\r\n        const name = card.getAttribute('data-contact-name') || '';\r\n        if (!name) return;\r\n        try {\r\n          const updated = await decisionsService.update(decision.id, { made_by: name });\r\n          currentOwnerName = name;\r\n          toast.success(`Owner set to ${name}`);\r\n          if (ownerPicker) ownerPicker.style.display = 'none';\r\n          if (onUpdate) onUpdate({ ...decision, made_by: name, ...updated });\r\n          // Refresh displayed owner in current-assignment card\r\n          const currentEl = container.querySelector('#decision-current-owner');\r\n          if (currentEl) {\r\n            const contact = findContactByOwner(name);\r\n            const photoUrl = getContactPhotoUrl(contact);\r\n            currentEl.innerHTML = `\r\n              <div class=\"assigned-contact-display\">\r\n                <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\">` : getInitials(name)}</div>\r\n                <div class=\"contact-details\">\r\n                  <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\r\n                  <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\r\n                </div>\r\n                <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\r\n                  <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                  Change\r\n                </button>\r\n              </div>`;\r\n            const changeBtn = currentEl.querySelector('#decision-change-owner-btn');\r\n            if (changeBtn) on(changeBtn as HTMLElement, 'click', showOwnerPicker);\r\n          }\r\n        } catch {\r\n          toast.error('Failed to save owner');\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  const showOwnerPicker = () => {\r\n    if (!ownerPicker) return;\r\n    ownerPicker.style.display = ownerPicker.style.display === 'none' ? 'block' : 'none';\r\n    if (ownerPicker.style.display === 'block' && viewContacts.length === 0) {\r\n      contactsService.getAll().then((res) => {\r\n        viewContacts = res?.contacts || [];\r\n        renderOwnerContactGrid(ownerSearch?.value || '');\r\n      }).catch(() => {\r\n        if (ownerList) ownerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n      });\r\n    } else if (ownerPicker.style.display === 'block') {\r\n      renderOwnerContactGrid(ownerSearch?.value || '');\r\n    }\r\n    if (ownerSearch) ownerSearch.focus();\r\n  };\r\n\r\n  const changeOwnerBtn = container.querySelector('#decision-change-owner-btn');\r\n  const showOwnerPickerBtn = container.querySelector('#decision-show-owner-picker-btn');\r\n  if (changeOwnerBtn && ownerPicker) on(changeOwnerBtn as HTMLElement, 'click', showOwnerPicker);\r\n  if (showOwnerPickerBtn && ownerPicker) on(showOwnerPickerBtn as HTMLElement, 'click', showOwnerPicker);\r\n  if (ownerSearch) {\r\n    ownerSearch.addEventListener('input', () => renderOwnerContactGrid(ownerSearch.value));\r\n  }\r\n\r\n  contactsService.getAll().then((res) => {\r\n    viewContacts = res?.contacts || [];\r\n    const contact = findContactByOwner(currentOwnerName);\r\n    const roleEl = container.querySelector('#decision-owner-role');\r\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\r\n    const avatarEl = container.querySelector('#decision-owner-avatar');\r\n    if (avatarEl && currentOwnerName) {\r\n      const photoUrl = getContactPhotoUrl(contact);\r\n      if (photoUrl) {\r\n        avatarEl.innerHTML = '';\r\n        const img = document.createElement('img');\r\n        img.src = photoUrl;\r\n        img.alt = '';\r\n        img.onerror = () => { avatarEl.textContent = getInitials(currentOwnerName); };\r\n        avatarEl.appendChild(img);\r\n      }\r\n    }\r\n  }).catch(() => {});\r\n\r\n  // Edit form: owner display and contact picker (reuse viewContacts)\r\n  const editOwnerDisplay = container.querySelector('#decision-edit-owner-display') as HTMLElement;\r\n  const editMadeByInput = container.querySelector('#decision-edit-made-by') as HTMLInputElement;\r\n  const editContactPicker = container.querySelector('#decision-edit-contact-picker') as HTMLElement;\r\n  const editContactList = container.querySelector('#decision-edit-contact-list') as HTMLElement;\r\n  const editContactSearch = container.querySelector('#decision-edit-contact-search') as HTMLInputElement;\r\n\r\n  function renderEditFormOwnerDisplay(madeBy: string) {\r\n    if (!editOwnerDisplay || !editMadeByInput) return;\r\n    editMadeByInput.value = madeBy;\r\n    if (madeBy) {\r\n      const contact = findContactByOwner(madeBy);\r\n      const photoUrl = getContactPhotoUrl(contact);\r\n      editOwnerDisplay.innerHTML = `\r\n        <div class=\"assigned-contact-display\">\r\n          <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(madeBy)}'\">` : getInitials(madeBy)}</div>\r\n          <div class=\"contact-details\">\r\n            <div class=\"contact-name-lg\">${escapeHtml(madeBy)}</div>\r\n            ${contact?.role ? `<div class=\"contact-role-sm\">${escapeHtml(contact.role)}</div>` : ''}\r\n          </div>\r\n          <button type=\"button\" class=\"btn-change-assignment\" id=\"decision-edit-change-owner-btn\">\r\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n            Change\r\n          </button>\r\n        </div>`;\r\n    } else {\r\n      editOwnerDisplay.innerHTML = `\r\n        <div class=\"no-assignment\">\r\n          <span>No owner</span>\r\n          <button type=\"button\" class=\"btn-assign-now\" id=\"decision-edit-choose-owner-btn\">Choose</button>\r\n        </div>`;\r\n    }\r\n    const chBtn = editOwnerDisplay.querySelector('#decision-edit-change-owner-btn');\r\n    const chooseBtn = editOwnerDisplay.querySelector('#decision-edit-choose-owner-btn');\r\n    if (chBtn) on(chBtn as HTMLElement, 'click', showEditOwnerPicker);\r\n    if (chooseBtn) on(chooseBtn as HTMLElement, 'click', showEditOwnerPicker);\r\n  }\r\n\r\n  function renderEditFormContactGrid(filter = '') {\r\n    if (!editContactList) return;\r\n    const list = filter\r\n      ? viewContacts.filter(\r\n          (c) =>\r\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n        )\r\n      : viewContacts;\r\n    if (viewContacts.length === 0) {\r\n      editContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n      return;\r\n    }\r\n    if (list.length === 0) {\r\n      editContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n      return;\r\n    }\r\n    const currentMadeBy = (editMadeByInput?.value || '').trim();\r\n    editContactList.innerHTML = list\r\n      .map((c) => {\r\n        const photoUrl = getContactPhotoUrl(c);\r\n        const isCurrent = currentMadeBy === (c.name || '').trim();\r\n        return `\r\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n            <div class=\"contact-info-picker\">\r\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\r\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\r\n            </div>\r\n          </div>`;\r\n      })\r\n      .join('');\r\n    editContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\r\n      on(card as HTMLElement, 'click', () => {\r\n        const name = card.getAttribute('data-contact-name') || '';\r\n        if (name) {\r\n          renderEditFormOwnerDisplay(name);\r\n          if (editContactPicker) editContactPicker.style.display = 'none';\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  function showEditOwnerPicker() {\r\n    if (!editContactPicker) return;\r\n    editContactPicker.style.display = editContactPicker.style.display === 'none' ? 'block' : 'none';\r\n    if (editContactPicker.style.display === 'block') {\r\n      if (viewContacts.length === 0) {\r\n        contactsService.getAll().then((res) => {\r\n          viewContacts = res?.contacts || [];\r\n          renderEditFormContactGrid(editContactSearch?.value || '');\r\n        }).catch(() => {\r\n          if (editContactList) editContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        });\r\n      } else {\r\n        renderEditFormContactGrid(editContactSearch?.value || '');\r\n      }\r\n    }\r\n    if (editContactSearch) editContactSearch.focus();\r\n  }\r\n\r\n  if (editContactSearch) {\r\n    editContactSearch.addEventListener('input', () => renderEditFormContactGrid(editContactSearch.value));\r\n  }\r\n\r\n  // Initial edit form owner display (when user opens edit, we call renderEditFormOwnerDisplay in edit button handler)\r\n  renderEditFormOwnerDisplay(decision.made_by || (decision as { owner?: string }).owner || '');\r\n\r\n  // AI Suggest (view mode): Owner section  suggest owner from decision content (project contacts only)\r\n  const ownerAiSuggestBtn = container.querySelector('#decision-owner-ai-suggest-btn');\r\n  const ownerSuggestionsPanel = container.querySelector('#decision-owner-suggestions-panel') as HTMLElement;\r\n  if (ownerAiSuggestBtn && ownerSuggestionsPanel) {\r\n    on(ownerAiSuggestBtn as HTMLElement, 'click', async () => {\r\n      (ownerAiSuggestBtn as HTMLButtonElement).disabled = true;\r\n      ownerSuggestionsPanel.style.display = 'block';\r\n      ownerSuggestionsPanel.innerHTML = '<div class=\"loading\">Asking AI</div>';\r\n      try {\r\n        if (viewContacts.length === 0) {\r\n          const res = await contactsService.getAll();\r\n          viewContacts = res?.contacts || [];\r\n        }\r\n        const { suggested_owners } = await decisionsService.suggestOwner(decision.content || '', decision.rationale || decision.context || '');\r\n        if (!suggested_owners?.length) {\r\n          ownerSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\">No owner suggestions. <button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>';\r\n        } else {\r\n          ownerSuggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\">\r\n              <div class=\"ai-badge\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI Recommended\r\n              </div>\r\n            </div>\r\n            <div class=\"suggestions-list-sota\">\r\n              ${suggested_owners.map((s, i) => {\r\n                const contact = findContactByOwner(s.name);\r\n                const photoUrl = getContactPhotoUrl(contact);\r\n                const roleOrReason = contact?.role ?? s.reason ?? '';\r\n                const score = s.score ?? 0;\r\n                const scoreColor = score >= 70 ? 'var(--success)' : score >= 50 ? 'var(--warning)' : 'var(--text-muted)';\r\n                return `\r\n                <div class=\"suggestion-card-sota decision-owner-card\" data-owner-name=\"${escapeHtml(s.name)}\">\r\n                  <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                  <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                  <div class=\"suggestion-info-sota\">\r\n                    <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\r\n                    ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                  </div>\r\n                  ${score > 0 ? `<div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\"><div class=\"score-value\">${score}%</div><div class=\"score-label\">Match</div></div>` : ''}\r\n                  <button type=\"button\" class=\"btn-select-suggestion\">Assign</button>\r\n                </div>`;\r\n              }).join('')}\r\n            </div>\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>\r\n          `;\r\n          ownerSuggestionsPanel.querySelectorAll('.decision-owner-card .btn-select-suggestion').forEach((btn) => {\r\n            const card = (btn as HTMLElement).closest('.decision-owner-card');\r\n            const name = card?.getAttribute('data-owner-name') || '';\r\n            if (!name) return;\r\n            on(btn as HTMLElement, 'click', async () => {\r\n              try {\r\n                const updated = await decisionsService.update(decision.id, { made_by: name });\r\n                currentOwnerName = name;\r\n                toast.success(`Owner set to ${name}`);\r\n                ownerSuggestionsPanel.style.display = 'none';\r\n                const currentOwnerEl = container.querySelector('#decision-current-owner');\r\n                if (currentOwnerEl) {\r\n                  const contact = findContactByOwner(name);\r\n                  const photoUrl = getContactPhotoUrl(contact);\r\n                  currentOwnerEl.innerHTML = `\r\n                    <div class=\"assigned-contact-display\">\r\n                      <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\">` : getInitials(name)}</div>\r\n                      <div class=\"contact-details\">\r\n                        <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\r\n                        <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\r\n                      </div>\r\n                      <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\r\n                        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                        Change\r\n                      </button>\r\n                    </div>`;\r\n                  const chBtn = currentOwnerEl.querySelector('#decision-change-owner-btn');\r\n                  if (chBtn) on(chBtn as HTMLElement, 'click', showOwnerPicker);\r\n                }\r\n                if (onUpdate) onUpdate(updated);\r\n              } catch {\r\n                toast.error('Failed to save owner');\r\n              }\r\n            });\r\n          });\r\n        }\r\n        const hideBtn = ownerSuggestionsPanel.querySelector('#decision-owner-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { ownerSuggestionsPanel.style.display = 'none'; });\r\n      } catch {\r\n        ownerSuggestionsPanel.innerHTML = '<div class=\"error\">AI suggest failed. <button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>';\r\n        const h = ownerSuggestionsPanel.querySelector('#decision-owner-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { ownerSuggestionsPanel.style.display = 'none'; });\r\n        toast.error('AI suggest failed');\r\n      } finally {\r\n        (ownerAiSuggestBtn as HTMLButtonElement).disabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI Suggest (view mode): Rationale section  fetch suggestion, show panel, Apply updates decision\r\n  const rationaleAiSuggestBtn = container.querySelector('#decision-rationale-ai-suggest-btn');\r\n  const suggestionsPanel = container.querySelector('#decision-suggestions-panel') as HTMLElement;\r\n  if (rationaleAiSuggestBtn && suggestionsPanel) {\r\n    on(rationaleAiSuggestBtn as HTMLElement, 'click', async () => {\r\n      (rationaleAiSuggestBtn as HTMLButtonElement).disabled = true;\r\n      suggestionsPanel.style.display = 'block';\r\n      suggestionsPanel.innerHTML = '<div class=\"loading\">Asking AI</div>';\r\n      try {\r\n        const result = await decisionsService.suggest(decision.content || '', decision.rationale || decision.context || '');\r\n        suggestionsPanel.innerHTML = `\r\n          <div class=\"suggestion-card\">\r\n            <p><strong>Rationale:</strong> ${escapeHtml((result.rationale || '').substring(0, 300))}${(result.rationale || '').length > 300 ? '' : ''}</p>\r\n            <p><strong>Impact:</strong> ${escapeHtml(result.impact || '')} ${result.impact_summary ? ` ${escapeHtml(result.impact_summary)}` : ''}</p>\r\n            <p><strong>Summary:</strong> ${escapeHtml(result.summary || '')}</p>\r\n            <button type=\"button\" class=\"btn btn-primary btn-sm\" id=\"decision-apply-suggestion-btn\">Apply</button>\r\n          </div>`;\r\n        const applyBtn = suggestionsPanel.querySelector('#decision-apply-suggestion-btn');\r\n        if (applyBtn) {\r\n          on(applyBtn as HTMLElement, 'click', async () => {\r\n            try {\r\n              const updated = await decisionsService.update(decision.id, {\r\n                rationale: result.rationale,\r\n                impact: result.impact,\r\n                summary: result.summary,\r\n              });\r\n              toast.success('Suggestion applied');\r\n              const viewRationale = container.querySelector('#decision-view-rationale');\r\n              if (viewRationale) {\r\n                viewRationale.innerHTML = (updated.rationale || updated.context)\r\n                  ? `<p class=\"decision-rationale\">${escapeHtml(updated.rationale || updated.context || '')}</p>`\r\n                  : '<p class=\"text-muted\">No rationale recorded</p>';\r\n              }\r\n              const badges = container.querySelector('.decision-badges');\r\n              if (badges && (updated as Decision).impact) {\r\n                const impactPill = badges.querySelector('.priority-pill.impact-low, .priority-pill.impact-medium, .priority-pill.impact-high');\r\n                if (impactPill) impactPill.outerHTML = `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span>`;\r\n                else badges.insertAdjacentHTML('afterbegin', `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span> `);\r\n              }\r\n              if (onUpdate) onUpdate(updated);\r\n              suggestionsPanel.style.display = 'none';\r\n            } catch {\r\n              toast.error('Failed to apply');\r\n            }\r\n          });\r\n        }\r\n      } catch {\r\n        suggestionsPanel.innerHTML = '<div class=\"error\">AI suggest failed</div>';\r\n        toast.error('AI suggest failed');\r\n      } finally {\r\n        (rationaleAiSuggestBtn as HTMLButtonElement).disabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI Suggest (edit form): fill rationale, impact, summary\r\n  const editAiSuggestBtn = container.querySelector('#decision-edit-ai-suggest-btn');\r\n  const editSuggestionsPanel = container.querySelector('#decision-edit-suggestions-panel') as HTMLElement;\r\n  if (editAiSuggestBtn) {\r\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const contentEl = container.querySelector('#decision-edit-content') as HTMLTextAreaElement;\r\n      const rationaleEl = container.querySelector('#decision-edit-rationale') as HTMLTextAreaElement;\r\n      const impactEl = container.querySelector('#decision-edit-impact') as HTMLSelectElement;\r\n      const summaryEl = container.querySelector('#decision-edit-summary') as HTMLInputElement;\r\n      const content = contentEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.warning('Enter decision text first');\r\n        return;\r\n      }\r\n      (editAiSuggestBtn as HTMLButtonElement).disabled = true;\r\n      if (editSuggestionsPanel) {\r\n        editSuggestionsPanel.style.display = 'block';\r\n        editSuggestionsPanel.innerHTML = '<span class=\"text-muted\">Asking AI</span>';\r\n      }\r\n      try {\r\n        const result = await decisionsService.suggest(content, rationaleEl?.value?.trim() || '');\r\n        if (rationaleEl) rationaleEl.value = result.rationale || '';\r\n        if (impactEl) impactEl.value = result.impact || 'medium';\r\n        if (summaryEl) summaryEl.value = result.summary || '';\r\n        if (editSuggestionsPanel) {\r\n          editSuggestionsPanel.style.display = 'none';\r\n          editSuggestionsPanel.innerHTML = '';\r\n        }\r\n        toast.success('Suggestion applied');\r\n      } catch {\r\n        if (editSuggestionsPanel) {\r\n          editSuggestionsPanel.innerHTML = '<span class=\"error\">AI suggest failed</span>';\r\n        }\r\n        toast.error('AI suggest failed');\r\n      } finally {\r\n        (editAiSuggestBtn as HTMLButtonElement).disabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  const timelineEl = container.querySelector('#decision-timeline-list');\r\n  if (timelineEl) {\r\n    decisionsService.getEvents(decision.id).then((events) => {\r\n      const labels: Record<string, string> = {\r\n        created: 'Created',\r\n        updated: 'Updated',\r\n        conflict_detected: 'Conflict detected',\r\n        deleted: 'Deleted',\r\n        restored: 'Restored',\r\n      };\r\n      const actorLabel = (ev: { actor_name?: string; event_data?: { trigger?: string } }) =>\r\n        ev.actor_name || (ev.event_data?.trigger === 'decision_check_flow' ? 'System' : null);\r\n      if (events.length === 0) {\r\n        (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No events yet</span>';\r\n        return;\r\n      }\r\n      (timelineEl as HTMLElement).innerHTML = events\r\n        .map((ev) => {\r\n          const actor = actorLabel(ev);\r\n          return `<div class=\"decision-timeline-item decision-event-${escapeHtml(ev.event_type)}\">\r\n            <span class=\"decision-event-type\">${escapeHtml(labels[ev.event_type] || ev.event_type)}</span>\r\n            ${actor ? `<span class=\"decision-event-actor\">${escapeHtml(actor)}</span>` : ''}\r\n            <span class=\"decision-event-date\">${formatRelativeTime(ev.created_at)}</span>\r\n          </div>`;\r\n        })\r\n        .join('');\r\n    }).catch(() => {\r\n      (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load timeline</span>';\r\n    });\r\n  }\r\n\r\n  const similarEl = container.querySelector('#decision-similar-list');\r\n  if (similarEl) {\r\n    decisionsService.getSimilarDecisions(decision.id, 10).then((similar) => {\r\n      if (similar.length === 0) {\r\n        (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No similar decisions</span>';\r\n        return;\r\n      }\r\n      (similarEl as HTMLElement).innerHTML = similar\r\n        .map((s) => `\r\n          <div class=\"decision-similar-item\" data-decision-id=\"${s.decision.id}\" role=\"${onDecisionClick ? 'button' : 'none'}\">\r\n            <span class=\"decision-similar-score\">${Math.round(s.similarityScore * 100)}%</span>\r\n            <span class=\"decision-similar-content\">${escapeHtml((s.decision.content || '').substring(0, 80))}${(s.decision.content || '').length > 80 ? '' : ''}</span>\r\n          </div>\r\n        `)\r\n        .join('');\r\n      if (onDecisionClick) {\r\n        (similarEl as HTMLElement).querySelectorAll('.decision-similar-item').forEach((el) => {\r\n          on(el as HTMLElement, 'click', () => {\r\n            const item = similar.find((s) => String(s.decision.id) === (el as HTMLElement).getAttribute('data-decision-id'));\r\n            if (item) onDecisionClick(item.decision);\r\n          });\r\n        });\r\n      }\r\n    }).catch(() => {\r\n      (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load similar decisions</span>';\r\n    });\r\n  }\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Decisions Panel Component\r\n * Displays and manages decisions with conflict detection, filters, detail view, and removed section\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { decisionsService, Decision, DecisionConflict } from '../../services/decisions';\r\nimport { dataStore } from '../../stores/data';\r\nimport { showDecisionModal } from '../modals/DecisionModal';\r\nimport { createDecisionDetailView, DecisionDetailViewProps } from '../decisions/DecisionDetailView';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\n/** Build DecisionDetailView props with onDecisionClick so similar-decision clicks open that decision in the same container */\r\nfunction decisionDetailProps(containerEl: HTMLElement, props: DecisionsPanelProps, decision: Decision): DecisionDetailViewProps {\r\n  return {\r\n    decision,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createDecisionsPanel(props));\r\n    },\r\n    onUpdate: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createDecisionsPanel(props));\r\n    },\r\n    onDecisionClick: (clickedDecision) => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createDecisionDetailView(decisionDetailProps(containerEl, props, clickedDecision)));\r\n    },\r\n  };\r\n}\r\n\r\nexport interface DecisionsPanelProps {\r\n  onDecisionClick?: (decision: Decision) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentSearch: string = '';\r\nlet currentView: 'status' | 'source' = 'status';\r\n\r\n/**\r\n * Create decisions panel\r\n */\r\nexport function createDecisionsPanel(props: DecisionsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel decisions-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Decisions</h2>\r\n        <span class=\"panel-count\" id=\"decisions-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"decisions-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"proposed\">Proposed</option>\r\n          <option value=\"approved\">Approved</option>\r\n          <option value=\"rejected\">Rejected</option>\r\n          <option value=\"deferred\">Deferred</option>\r\n          <option value=\"active\">Active</option>\r\n          <option value=\"superseded\">Superseded</option>\r\n          <option value=\"revoked\">Revoked</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\r\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\r\n        </div>\r\n        <input type=\"search\" id=\"decisions-search\" class=\"search-input\" placeholder=\"Search decisions...\" title=\"Search\">\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"check-conflicts-btn\" title=\"Check for conflicting decisions\">Check Conflicts</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-decision-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"conflicts-container\" class=\"conflicts-container\" style=\"display: none;\"></div>\r\n    <div class=\"panel-content\" id=\"decisions-content\">\r\n      <div class=\"loading\">Loading decisions...</div>\r\n    </div>\r\n    <div id=\"removed-decisions-container\" class=\"removed-decisions-container\" style=\"display: none;\"></div>\r\n  `;\r\n\r\n  const filterSelect = panel.querySelector('#decisions-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadDecisions(panel, props);\r\n  });\r\n\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'status' | 'source';\r\n      loadDecisions(panel, props);\r\n    });\r\n  });\r\n\r\n  const searchInput = panel.querySelector('#decisions-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value.trim();\r\n      loadDecisions(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  const checkConflictsBtn = panel.querySelector('#check-conflicts-btn');\r\n  if (checkConflictsBtn) {\r\n    on(checkConflictsBtn as HTMLElement, 'click', async () => {\r\n      const container = panel.querySelector('#conflicts-container') as HTMLElement;\r\n      await checkConflicts(container, panel, props);\r\n    });\r\n  }\r\n\r\n  const addBtn = panel.querySelector('#add-decision-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showDecisionModal({\r\n        mode: 'create',\r\n        onSave: () => {\r\n          loadDecisions(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  loadDecisions(panel, props);\r\n  refreshRemovedSection(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\nasync function checkConflicts(container: HTMLElement, panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\r\n  container.style.display = 'block';\r\n  container.innerHTML = '<div class=\"loading\">Checking for conflicts...</div>';\r\n  try {\r\n    const result = await decisionsService.runDecisionCheck();\r\n    const conflicts = result.conflicts || [];\r\n    if (conflicts.length === 0) {\r\n      container.innerHTML = `\r\n        <div class=\"no-conflicts\">\r\n          <span class=\"success-icon\"></span>\r\n          <p>No conflicts detected</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n    container.innerHTML = conflicts.map((c: DecisionConflict) => createConflictCard(c, panel, props)).join('');\r\n    bindConflictCards(container, panel, props);\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to check conflicts</div>';\r\n  }\r\n}\r\n\r\nfunction createConflictCard(c: DecisionConflict, panel: HTMLElement, props: DecisionsPanelProps): string {\r\n  const d1 = c.decision1;\r\n  const d2 = c.decision2;\r\n  const desc = (c.description || c.reason || 'Conflict').substring(0, 200);\r\n  return `\r\n    <div class=\"conflict-card-sota\" data-decision-id1=\"${d1.id}\" data-decision-id2=\"${d2.id}\">\r\n      <div class=\"conflict-card-priority-bar\" style=\"background: var(--warning);\"></div>\r\n      <div class=\"conflict-card-body\">\r\n        <div class=\"conflict-card-header\">\r\n          <span class=\"conflict-type-badge\">Conflict</span>\r\n          <p class=\"conflict-description\">${escapeHtml(desc)}</p>\r\n        </div>\r\n        <div class=\"conflict-pair\">\r\n          <div class=\"conflict-item\">\r\n            <div class=\"conflict-item-content\">${escapeHtml((d1.content || '').substring(0, 120))}${(d1.content || '').length > 120 ? '' : ''}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-keep-btn\" data-keep-id=\"${d1.id}\" data-discard-id=\"${d2.id}\">Keep this</button>\r\n          </div>\r\n          <div class=\"conflict-vs\">vs</div>\r\n          <div class=\"conflict-item\">\r\n            <div class=\"conflict-item-content\">${escapeHtml((d2.content || '').substring(0, 120))}${(d2.content || '').length > 120 ? '' : ''}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-keep-btn\" data-keep-id=\"${d2.id}\" data-discard-id=\"${d1.id}\">Keep this</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindConflictCards(container: HTMLElement, panel: HTMLElement, props: DecisionsPanelProps): void {\r\n  container.querySelectorAll('.conflict-keep-btn').forEach((btn) => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const keepId = (btn as HTMLElement).getAttribute('data-keep-id');\r\n      const discardId = (btn as HTMLElement).getAttribute('data-discard-id');\r\n      if (!keepId || !discardId) return;\r\n      try {\r\n        await decisionsService.delete(discardId);\r\n        await decisionsService.runDecisionCheck();\r\n        await decisionsService.update(keepId, { status: 'approved' as const });\r\n        toast.success('Conflict resolved');\r\n        loadDecisions(panel, props);\r\n        await checkConflicts(container, panel, props);\r\n        refreshRemovedSection(panel, props);\r\n      } catch {\r\n        toast.error('Failed to resolve conflict');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nasync function refreshRemovedSection(panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-decisions-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await decisionsService.getDeletedDecisions();\r\n    if (deleted.length === 0) {\r\n      container.style.display = 'none';\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.style.display = 'block';\r\n    container.innerHTML = `\r\n      <div class=\"removed-decisions-section\">\r\n        <div class=\"removed-decisions-header section-header-sota\">\r\n          <h3>Removed decisions</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-decisions-hint\">Restore to undo a conflict resolution; decision will be synced back to the graph.</p>\r\n        <div class=\"removed-decisions-list\">\r\n          ${deleted.map((d) => `\r\n            <div class=\"removed-decision-item\" data-decision-id=\"${d.id}\">\r\n              <div class=\"removed-decision-content\">${escapeHtml(truncate(d.content ?? '', 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach((restoreBtn) => {\r\n      on(restoreBtn as HTMLElement, 'click', async () => {\r\n        const id = (restoreBtn as HTMLElement).closest('.removed-decision-item')?.getAttribute('data-decision-id');\r\n        if (!id) return;\r\n        try {\r\n          await decisionsService.restore(id);\r\n          toast.success('Decision restored');\r\n          loadDecisions(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        } catch {\r\n          toast.error('Failed to restore decision');\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.style.display = 'none';\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\nfunction truncate(s: string, len: number): string {\r\n  if (s.length <= len) return s;\r\n  return s.substring(0, len) + '';\r\n}\r\n\r\n/**\r\n * Filter decisions by search (client-side)\r\n */\r\nfunction filterDecisionsBySearch(decisions: Decision[], q: string): Decision[] {\r\n  if (!q) return decisions;\r\n  const lower = q.toLowerCase();\r\n  return decisions.filter(\r\n    d =>\r\n      (d.content || '').toLowerCase().includes(lower) ||\r\n      (d.rationale || '').toLowerCase().includes(lower) ||\r\n      (d.made_by || '').toLowerCase().includes(lower) ||\r\n      (d.source_file || '').toLowerCase().includes(lower)\r\n  );\r\n}\r\n\r\n/**\r\n * Load decisions\r\n */\r\nasync function loadDecisions(panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#decisions-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const status = currentFilter === 'all' ? undefined : currentFilter;\r\n    const raw = await decisionsService.getAll(status);\r\n    const decisions = filterDecisionsBySearch(raw, currentSearch);\r\n\r\n    if (currentView === 'source') {\r\n      renderDecisionsBySource(content, decisions, props);\r\n    } else {\r\n      renderDecisions(content, decisions, props);\r\n    }\r\n    dataStore.setDecisions(raw as unknown as []);\r\n    updateCount(panel, decisions.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load decisions</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render decisions list (grouped by status when multiple statuses)\r\n */\r\nfunction renderDecisions(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\r\n  if (decisions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No decisions match your search' : 'No decisions found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Decision</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showDecisionModal({ mode: 'create', onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const byStatus: Record<string, Decision[]> = {};\r\n  decisions.forEach(d => {\r\n    const s = (d.status || 'active').toLowerCase();\r\n    if (!byStatus[s]) byStatus[s] = [];\r\n    byStatus[s].push(d);\r\n  });\r\n  const statuses = Object.keys(byStatus);\r\n\r\n  if (statuses.length > 1) {\r\n    container.innerHTML = statuses.map(status => `\r\n      <div class=\"question-group\">\r\n        <div class=\"group-header\">\r\n          <h3>${escapeHtml(status)}</h3>\r\n          <span class=\"group-count\">${byStatus[status].length}</span>\r\n        </div>\r\n        <div class=\"group-items\">\r\n          ${byStatus[status].map(d => createDecisionCard(d, contacts)).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    container.innerHTML = decisions.map(d => createDecisionCard(d, contacts)).join('');\r\n  }\r\n\r\n  bindDecisionCards(container, decisions, props);\r\n}\r\n\r\n/**\r\n * Render decisions grouped by source\r\n */\r\nfunction renderDecisionsBySource(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\r\n  if (decisions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No decisions match your search' : 'No decisions found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Decision</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showDecisionModal({ mode: 'create', onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const bySource: Record<string, Decision[]> = {};\r\n  decisions.forEach(d => {\r\n    const src = d.source_file || d.source || 'Unknown source';\r\n    if (!bySource[src]) bySource[src] = [];\r\n    bySource[src].push(d);\r\n  });\r\n  container.innerHTML = Object.entries(bySource).map(([source, list]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(source)}</h3>\r\n        <span class=\"group-count\">${list.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${list.map(d => createDecisionCard(d, contacts)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  bindDecisionCards(container, decisions, props);\r\n}\r\n\r\nfunction bindDecisionCards(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\r\n  container.querySelectorAll('.decision-card-sota').forEach((card) => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.card-actions')) return;\r\n      const id = card.getAttribute('data-id');\r\n      const decision = decisions.find((d) => String(d.id) === id);\r\n      if (!decision) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createDecisionDetailView(decisionDetailProps(containerEl, props, decision)));\r\n      } else if (props.onDecisionClick) {\r\n        props.onDecisionClick(decision);\r\n      } else {\r\n        showDecisionModal({\r\n          mode: 'edit',\r\n          decision: { ...decision, decision: decision.content, madeBy: decision.made_by, madeAt: decision.created_at },\r\n          onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props),\r\n        });\r\n      }\r\n    });\r\n\r\n    const approveBtn = card.querySelector('.approve-btn');\r\n    const rejectBtn = card.querySelector('.reject-btn');\r\n    const id = card.getAttribute('data-id');\r\n\r\n    if (approveBtn && id) {\r\n      on(approveBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        try {\r\n          await decisionsService.approve(id, 'Current User');\r\n          loadDecisions(container.closest('.decisions-panel') as HTMLElement, props);\r\n        } catch {\r\n          // no-op\r\n        }\r\n      });\r\n    }\r\n    if (rejectBtn && id) {\r\n      on(rejectBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        try {\r\n          await decisionsService.reject(id);\r\n          loadDecisions(container.closest('.decisions-panel') as HTMLElement, props);\r\n        } catch {\r\n          // no-op\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/** Status bar color (left edge) - align with fact category bar */\r\nconst STATUS_BAR_COLOR: Record<string, string> = {\r\n  proposed: '#f59e0b',\r\n  approved: '#10b981',\r\n  rejected: '#ef4444',\r\n  deferred: '#6b7280',\r\n  active: '#3b82f6',\r\n  superseded: '#8b5cf6',\r\n  revoked: '#6b7280',\r\n};\r\n\r\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\r\n\r\nfunction findContactByOwner(contacts: ContactLike[], name: string): ContactLike | undefined {\r\n  if (!name || !contacts.length) return undefined;\r\n  const n = name.trim().toLowerCase();\r\n  if (!n) return undefined;\r\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n  if (byExact) return byExact;\r\n  const byPartial = contacts.find(\r\n    (c) =>\r\n      (c.name || '').trim().toLowerCase().includes(n) ||\r\n      n.includes((c.name || '').trim().toLowerCase())\r\n  );\r\n  if (byPartial) return byPartial;\r\n  const byAlias = contacts.find((c) =>\r\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n  );\r\n  return byAlias || contacts.find((c) =>\r\n    (c.aliases || []).some((a) => {\r\n      const aLower = String(a).trim().toLowerCase();\r\n      return aLower.includes(n) || n.includes(aLower);\r\n    })\r\n  );\r\n}\r\n\r\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\r\n  if (!c) return null;\r\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\nfunction createDecisionCard(decision: Decision, contacts: ContactLike[]): string {\r\n  const status = (decision.status || 'active').toLowerCase();\r\n  const statusClass = status.replace(/\\s+/g, '-');\r\n  const barColor = STATUS_BAR_COLOR[status] ?? STATUS_BAR_COLOR.active;\r\n  const content = decision.content || '';\r\n  const source = decision.source_file || decision.source || '';\r\n  const owner = decision.made_by || (decision as { owner?: string }).owner || '';\r\n  const contact = owner ? findContactByOwner(contacts, owner) : undefined;\r\n  const photoUrl = getContactPhotoUrl(contact);\r\n  const ownerChipHtml = owner\r\n    ? `\r\n        <div class=\"assignee-chip\">\r\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(owner)}\" onerror=\"this.parentElement.innerHTML='${getInitials(owner)}'\">` : getInitials(owner)}</div>\r\n          <div class=\"assignee-info\">\r\n            <span class=\"assignee-name\">${escapeHtml(owner)}</span>\r\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n          </div>\r\n        </div>\r\n      `\r\n    : '<span class=\"card-owner-placeholder text-muted\">No owner</span>';\r\n  const sourceChip = source ? `<span class=\"card-source-chip\">${escapeHtml(source.substring(0, 40))}${source.length > 40 ? '' : ''}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>';\r\n\r\n  return `\r\n    <div class=\"decision-card-sota question-card-sota\" data-id=\"${decision.id}\" style=\"--decision-status-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar decision-status-bar\" style=\"background: ${barColor}\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"priority-pill status-${statusClass}\">${escapeHtml(String(decision.status))}</span>\r\n            ${decision.impact ? `<span class=\"status-pill\">${escapeHtml(decision.impact)} impact</span>` : ''}\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(decision.decided_at || decision.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\r\n        ${(decision as any).summary ? `<div class=\"card-summary text-muted\">${escapeHtml((decision as any).summary)}</div>` : ''}\r\n        ${decision.rationale ? `<div class=\"card-rationale text-muted\">${escapeHtml((decision.rationale || '').substring(0, 100))}${(decision.rationale || '').length > 100 ? '' : ''}</div>` : ''}\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${sourceChip}\r\n            ${ownerChipHtml}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            ${decision.status === 'proposed' || decision.status === 'active'\r\n              ? `<span class=\"card-actions\"><button type=\"button\" class=\"btn btn-sm btn-success approve-btn\">Approve</button><button type=\"button\" class=\"btn btn-sm btn-danger reject-btn\">Reject</button></span>`\r\n              : '<button type=\"button\" class=\"btn-link decision-view-link\">View</button>'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#decisions-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createDecisionsPanel;\r\n","/**\r\n * Fact Detail View\r\n * Full-page view for fact details: content, category, confidence, source, verified, document link\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Fact, factsService } from '../../services/facts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\r\n\r\nexport interface FactDetailViewProps {\r\n  fact: Fact;\r\n  onClose: () => void;\r\n  onUpdate?: (fact: Fact) => void;\r\n  /** When user clicks a similar fact, open that fact (e.g. replace view) */\r\n  onFactClick?: (fact: Fact) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\n/**\r\n * Create and show the fact detail view\r\n */\r\nexport function createFactDetailView(props: FactDetailViewProps): HTMLElement {\r\n  const { fact, onClose, onUpdate, onFactClick } = props;\r\n\r\n  const container = createElement('div', { className: 'fact-detail-view question-detail-view' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header fact-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Facts</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Fact #${String(fact.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        ${fact.verified ? '<span class=\"verified-badge detail sla-badge\" style=\"background:var(--success);color:white\"> Verified</span>' : ''}\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content fact-detail-content\">\r\n      <section class=\"detail-section question-main fact-main\">\r\n        <div class=\"question-badges fact-badges\">\r\n          ${fact.category ? `<span class=\"priority-pill category-${(fact.category || 'general').toLowerCase().replace(/\\s+/g, '-')}\">${escapeHtml(fact.category)}</span>` : ''}\r\n          ${fact.confidence != null ? `<span class=\"status-pill status-pending\">${Math.round((fact.confidence ?? 0) * 100)}%</span>` : ''}\r\n          ${fact.verified ? '<span class=\"auto-pill\"> Verified</span>' : ''}\r\n          <span class=\"question-date fact-date\">Created ${formatRelativeTime(fact.created_at)}</span>\r\n        </div>\r\n        <h2 class=\"question-text fact-content-text\">${escapeHtml(fact.content)}</h2>\r\n      </section>\r\n\r\n      <div class=\"detail-columns\">\r\n        <div class=\"detail-column-left\">\r\n          <section class=\"detail-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Source</h3>\r\n            </div>\r\n            ${fact.source_file ? `<p class=\"source-file\">${escapeHtml(fact.source_file)}</p>` : ''}\r\n            ${fact.source ? `<p class=\"source-ref\">${escapeHtml(fact.source)}</p>` : ''}\r\n            ${fact.source_document_id ? `\r\n              <p class=\"source-doc\">\r\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(fact.source_document_id))}\">View source document</a>\r\n              </p>\r\n            ` : ''}\r\n            ${!fact.source && !fact.source_file && !fact.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\r\n          </section>\r\n\r\n          <section class=\"detail-section verification-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Verification</h3>\r\n            </div>\r\n            ${fact.verified\r\n              ? `\r\n              <div class=\"verified-info\">\r\n                <span class=\"verified-badge auto-pill\"> Verified</span>\r\n                ${fact.verified_at ? `<span class=\"text-muted\">on ${formatDate(fact.verified_at)}</span>` : ''}\r\n              </div>\r\n            `\r\n              : `\r\n              <div class=\"unverified-info\">\r\n                <p class=\"text-muted\">This fact has not been verified.</p>\r\n                <button type=\"button\" class=\"btn btn-success btn-sm\" id=\"verify-fact-btn\">Verify</button>\r\n              </div>\r\n            `}\r\n          </section>\r\n        </div>\r\n\r\n        <div class=\"detail-column-right\">\r\n          <section class=\"detail-section metadata-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Metadata</h3>\r\n            </div>\r\n            <dl class=\"metadata-list\">\r\n              <dt>Created</dt>\r\n              <dd>${formatDate(fact.created_at)}</dd>\r\n              ${fact.updated_at ? `<dt>Updated</dt><dd>${formatDate(fact.updated_at)}</dd>` : ''}\r\n            </dl>\r\n          </section>\r\n\r\n          <section class=\"detail-section fact-timeline-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Timeline</h3>\r\n            </div>\r\n            <div id=\"fact-timeline-list\" class=\"fact-timeline-list\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n\r\n          <section class=\"detail-section fact-similar-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Similar facts</h3>\r\n            </div>\r\n            <div id=\"fact-similar-list\" class=\"fact-similar-list\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"detail-actions\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-fact-btn\">Edit</button>\r\n        ${!fact.verified ? '<button type=\"button\" class=\"btn btn-success\" id=\"verify-btn\">Verify</button>' : ''}\r\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-fact-btn\">Delete</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Back / Close\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  // Verify (header or section)\r\n  const verifyFactBtn = container.querySelector('#verify-fact-btn');\r\n  if (verifyFactBtn) {\r\n    on(verifyFactBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        const updated = await factsService.verify(fact.id);\r\n        toast.success('Fact verified');\r\n        if (onUpdate) onUpdate(updated);\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to verify fact');\r\n      }\r\n    });\r\n  }\r\n  const verifyBtn = container.querySelector('#verify-btn');\r\n  if (verifyBtn) {\r\n    on(verifyBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        const updated = await factsService.verify(fact.id);\r\n        toast.success('Fact verified');\r\n        if (onUpdate) onUpdate(updated);\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to verify fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Edit\r\n  const editBtn = container.querySelector('#edit-fact-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      import('../modals/FactModal').then(({ showFactModal }) => {\r\n        showFactModal({\r\n          mode: 'edit',\r\n          fact,\r\n          onSave: (updated) => {\r\n            if (onUpdate) onUpdate(updated);\r\n            onClose();\r\n          },\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  // Delete\r\n  const deleteBtn = container.querySelector('#delete-fact-btn');\r\n  if (deleteBtn) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this fact?')) return;\r\n      try {\r\n        await factsService.delete(fact.id);\r\n        toast.success('Fact deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Document link (navigate to files / document preview if implemented)\r\n  const docLink = container.querySelector('.doc-link');\r\n  if (docLink && fact.source_document_id) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n        detail: { tab: 'files', documentId: fact.source_document_id }\r\n      }));\r\n    });\r\n  }\r\n\r\n  // Load timeline (fact events)\r\n  const timelineEl = container.querySelector('#fact-timeline-list');\r\n  if (timelineEl) {\r\n    factsService.getEvents(fact.id).then((events) => {\r\n      const labels: Record<string, string> = {\r\n        created: 'Created',\r\n        verified: 'Verified',\r\n        updated: 'Updated',\r\n        conflict_detected: 'Conflict detected',\r\n        deleted: 'Deleted',\r\n        restored: 'Restored',\r\n      };\r\n      const actorLabel = (ev: { actor_name?: string; event_data?: { trigger?: string } }) =>\r\n        ev.actor_name || (ev.event_data?.trigger === 'fact_check_flow' ? 'System' : null);\r\n      if (events.length === 0) {\r\n        (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No events yet</span>';\r\n        return;\r\n      }\r\n      (timelineEl as HTMLElement).innerHTML = events\r\n        .map(\r\n          (ev) => {\r\n            const actor = actorLabel(ev);\r\n            return `<div class=\"fact-timeline-item fact-event-${escapeHtml(ev.event_type)}\">\r\n              <span class=\"fact-event-type\">${escapeHtml(labels[ev.event_type] || ev.event_type)}</span>\r\n              ${actor ? `<span class=\"fact-event-actor\">${escapeHtml(actor)}</span>` : ''}\r\n              <span class=\"fact-event-date\">${formatRelativeTime(ev.created_at)}</span>\r\n            </div>`;\r\n          }\r\n        )\r\n        .join('');\r\n    }).catch(() => {\r\n      (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load timeline</span>';\r\n    });\r\n  }\r\n\r\n  // Load similar facts\r\n  const similarEl = container.querySelector('#fact-similar-list');\r\n  if (similarEl) {\r\n    factsService.getSimilarFacts(fact.id, 10).then((similar) => {\r\n      if (similar.length === 0) {\r\n        (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No similar facts</span>';\r\n        return;\r\n      }\r\n      (similarEl as HTMLElement).innerHTML = similar\r\n        .map(\r\n          (s) => `\r\n            <div class=\"fact-similar-item\" data-fact-id=\"${s.fact.id}\" role=\"${onFactClick ? 'button' : 'none'}\">\r\n              <span class=\"fact-similar-score\">${Math.round(s.similarityScore * 100)}%</span>\r\n              <span class=\"fact-similar-content\">${escapeHtml((s.fact.content || '').substring(0, 80))}${(s.fact.content || '').length > 80 ? '' : ''}</span>\r\n            </div>\r\n          `\r\n        )\r\n        .join('');\r\n      if (onFactClick) {\r\n        (similarEl as HTMLElement).querySelectorAll('.fact-similar-item').forEach((el) => {\r\n          on(el as HTMLElement, 'click', () => {\r\n            const item = similar.find((s) => String(s.fact.id) === (el as HTMLElement).getAttribute('data-fact-id'));\r\n            if (item) onFactClick(item.fact);\r\n          });\r\n        });\r\n      }\r\n    }).catch(() => {\r\n      (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load similar facts</span>';\r\n    });\r\n  }\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Facts Panel Component\r\n * Displays and manages facts with conflict detection, filters, and detail view\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { factsService, Fact, FactConflict } from '../../services/facts';\r\nimport { createFactDetailView, FactDetailViewProps } from '../facts/FactDetailView';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst CATEGORIES = ['technical', 'process', 'policy', 'people', 'timeline', 'general'] as const;\r\n\r\n/** Build FactDetailView props with onFactClick so similar-fact clicks open that fact in the same container */\r\nfunction factDetailProps(containerEl: HTMLElement, props: FactsPanelProps, fact: Fact): FactDetailViewProps {\r\n  return {\r\n    fact,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createFactsPanel(props));\r\n    },\r\n    onUpdate: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createFactsPanel(props));\r\n    },\r\n    onFactClick: (clickedFact) => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createFactDetailView(factDetailProps(containerEl, props, clickedFact)));\r\n    },\r\n  };\r\n}\r\n\r\nexport interface FactsPanelProps {\r\n  onFactClick?: (fact: Fact) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentSearch: string = '';\r\nlet currentFilter: string = 'all';\r\nlet currentView: 'category' | 'source' = 'category';\r\nlet showConflicts: boolean = false;\r\n\r\n/**\r\n * Create facts panel\r\n */\r\nexport function createFactsPanel(props: FactsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel facts-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Facts</h2>\r\n        <span class=\"panel-count\" id=\"facts-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"facts-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"verified\"> Verified</option>\r\n          <option value=\"unverified\">Unverified</option>\r\n          <option value=\"technical\">Technical</option>\r\n          <option value=\"process\">Process</option>\r\n          <option value=\"policy\">Policy</option>\r\n          <option value=\"people\">People</option>\r\n          <option value=\"timeline\">Timeline</option>\r\n          <option value=\"general\">General</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"category\">By Category</button>\r\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\r\n        </div>\r\n        <input type=\"search\" id=\"facts-search\" class=\"search-input\" placeholder=\"Search facts...\" title=\"Search\">\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"check-conflicts-btn\" title=\"Check for conflicting facts\">Check Conflicts</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-fact-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"conflicts-container\" class=\"conflicts-container\" style=\"display: none;\"></div>\r\n    <div class=\"panel-content\" id=\"facts-content\">\r\n      <div class=\"loading\">Loading facts...</div>\r\n    </div>\r\n    <div id=\"removed-facts-container\" class=\"removed-facts-container\" style=\"display: none;\"></div>\r\n  `;\r\n\r\n  // Filter\r\n  const filterSelect = panel.querySelector('#facts-filter') as HTMLSelectElement;\r\n  if (filterSelect) {\r\n    on(filterSelect, 'change', () => {\r\n      currentFilter = filterSelect.value;\r\n      loadFacts(panel, props);\r\n    });\r\n  }\r\n\r\n  // View tabs\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'category' | 'source';\r\n      loadFacts(panel, props);\r\n    });\r\n  });\r\n\r\n  // Search\r\n  const searchInput = panel.querySelector('#facts-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value;\r\n      loadFacts(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  const conflictsBtn = panel.querySelector('#check-conflicts-btn');\r\n  if (conflictsBtn) {\r\n    on(conflictsBtn as HTMLElement, 'click', async () => {\r\n      const container = panel.querySelector('#conflicts-container') as HTMLElement;\r\n      await checkConflicts(container, panel, props);\r\n    });\r\n  }\r\n\r\n  const addBtn = panel.querySelector('#add-fact-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showAddFactModal(panel, props);\r\n    });\r\n  }\r\n\r\n  // Initial load (loadFacts calls refreshRemovedFactsSection at end)\r\n  loadFacts(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load facts\r\n */\r\nasync function loadFacts(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#facts-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const categoryFilter = CATEGORIES.includes(currentFilter as typeof CATEGORIES[number])\r\n      ? currentFilter\r\n      : undefined;\r\n\r\n    const { facts: rawFacts, total } = await factsService.getAll({\r\n      search: currentSearch || undefined,\r\n      limit: 500,\r\n      category: categoryFilter,\r\n    });\r\n\r\n    // Client-side filter for verified/unverified (API may not support these params)\r\n    const facts =\r\n      currentFilter === 'verified' ? rawFacts.filter(f => f.verified) :\r\n      currentFilter === 'unverified' ? rawFacts.filter(f => !f.verified) :\r\n      rawFacts;\r\n\r\n    if (currentView === 'source') {\r\n      renderFactsBySource(content, facts, props);\r\n    } else {\r\n      renderFacts(content, facts, props);\r\n    }\r\n    updateCount(panel, facts.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load facts</div>';\r\n  }\r\n  await refreshRemovedFactsSection(panel, props);\r\n}\r\n\r\n/**\r\n * Load and render the \"Removed facts\" section (for restore / undo). Syncs with graph/FalkorDB on restore.\r\n */\r\nasync function refreshRemovedFactsSection(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-facts-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await factsService.getDeletedFacts();\r\n    if (deleted.length === 0) {\r\n      container.style.display = 'none';\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.style.display = 'block';\r\n    container.innerHTML = `\r\n      <div class=\"removed-facts-section\">\r\n        <div class=\"removed-facts-header section-header-sota\">\r\n          <h3>Removed facts</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-facts-hint\">Restore to undo a conflict resolution; fact will be synced back to the graph.</p>\r\n        <div class=\"removed-facts-list\">\r\n          ${deleted.map(f => `\r\n            <div class=\"removed-fact-item\" data-fact-id=\"${f.id}\">\r\n              <div class=\"removed-fact-content\">${escapeHtml(truncate(f.content ?? '', 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach(btn => {\r\n      const item = (btn as HTMLElement).closest('.removed-fact-item');\r\n      const id = item?.getAttribute('data-fact-id');\r\n      if (id) {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          try {\r\n            await factsService.restoreFact(id);\r\n            toast.success('Fact restored');\r\n            await loadFacts(panel, props);\r\n            refreshRemovedFactsSection(panel, props);\r\n            const conflictsContainer = panel.querySelector('#conflicts-container') as HTMLElement;\r\n            if (conflictsContainer?.style.display !== 'none') {\r\n              await checkConflicts(conflictsContainer, panel, props);\r\n            }\r\n          } catch {\r\n            toast.error('Failed to restore fact');\r\n          }\r\n        });\r\n      }\r\n    });\r\n  } catch {\r\n    container.style.display = 'none';\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Render facts list\r\n */\r\nfunction renderFacts(container: HTMLElement, facts: Fact[], props: FactsPanelProps): void {\r\n  if (facts.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No facts match your search' : 'No facts found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-fact-btn\">Add Fact</button>\r\n      </div>\r\n    `;\r\n    const emptyAddBtn = container.querySelector('#empty-add-fact-btn');\r\n    if (emptyAddBtn) {\r\n      on(emptyAddBtn as HTMLElement, 'click', () => {\r\n        const panel = container.closest('.facts-panel') as HTMLElement;\r\n        if (panel) showAddFactModal(panel, props);\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Group by category (same structure as Questions: question-group, group-header, group-items)\r\n  const factsByCategory: Record<string, Fact[]> = {};\r\n  facts.forEach(fact => {\r\n    const cat = fact.category || 'Uncategorized';\r\n    if (!factsByCategory[cat]) factsByCategory[cat] = [];\r\n    factsByCategory[cat].push(fact);\r\n  });\r\n  const categories = Object.keys(factsByCategory);\r\n\r\n  if (categories.length > 1) {\r\n    container.innerHTML = Object.entries(factsByCategory).map(([category, catFacts]) => `\r\n      <div class=\"question-group\">\r\n        <div class=\"group-header\">\r\n          <h3>${escapeHtml(category)}</h3>\r\n          <span class=\"group-count\">${catFacts.length}</span>\r\n        </div>\r\n        <div class=\"group-items\">\r\n          ${catFacts.map(fact => createFactCard(fact)).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    container.innerHTML = facts.map(fact => createFactCard(fact)).join('');\r\n  }\r\n\r\n  // Bind click events (cards use .fact-card-sota, same click target)\r\n  container.querySelectorAll('.fact-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const fact = facts.find(f => String(f.id) === id);\r\n      if (!fact) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createFactDetailView(factDetailProps(containerEl, props, fact)));\r\n      } else if (props.onFactClick) {\r\n        props.onFactClick(fact);\r\n      } else {\r\n        import('../modals/FactModal').then(({ showFactModal }) => {\r\n          showFactModal({ mode: 'view', fact });\r\n        });\r\n      }\r\n    });\r\n\r\n    // Bind verify button\r\n    const verifyBtn = card.querySelector('.fact-verify-btn');\r\n    if (verifyBtn) {\r\n      on(verifyBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (id) {\r\n          try {\r\n            await factsService.verify(id);\r\n            toast.success('Fact verified');\r\n            loadFacts(container.closest('.facts-panel') as HTMLElement, props);\r\n          } catch {\r\n            // Error handled by service\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render facts grouped by source (same group structure as Questions)\r\n */\r\nfunction renderFactsBySource(container: HTMLElement, facts: Fact[], props: FactsPanelProps): void {\r\n  if (facts.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No facts match your search' : 'No facts found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-fact-btn\">Add Fact</button>\r\n      </div>\r\n    `;\r\n    const emptyAddBtn = container.querySelector('#empty-add-fact-btn');\r\n    if (emptyAddBtn) {\r\n      on(emptyAddBtn as HTMLElement, 'click', () => {\r\n        const panel = container.closest('.facts-panel') as HTMLElement;\r\n        if (panel) showAddFactModal(panel, props);\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  const bySource: Record<string, Fact[]> = {};\r\n  facts.forEach(fact => {\r\n    const source = fact.source_file || fact.source || 'Unknown source';\r\n    if (!bySource[source]) bySource[source] = [];\r\n    bySource[source].push(fact);\r\n  });\r\n  container.innerHTML = Object.entries(bySource).map(([source, catFacts]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(source)}</h3>\r\n        <span class=\"group-count\">${catFacts.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${catFacts.map(fact => createFactCard(fact)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  container.querySelectorAll('.fact-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const fact = facts.find(f => String(f.id) === id);\r\n      if (!fact) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        const detailView = createFactDetailView({\r\n          fact,\r\n          onClose: () => {\r\n            containerEl.innerHTML = '';\r\n            const newPanel = createFactsPanel(props);\r\n            containerEl.appendChild(newPanel);\r\n          },\r\n          onUpdate: () => {\r\n            containerEl.innerHTML = '';\r\n            const newPanel = createFactsPanel(props);\r\n            containerEl.appendChild(newPanel);\r\n          },\r\n        });\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(detailView);\r\n      } else if (props.onFactClick) {\r\n        props.onFactClick(fact);\r\n      } else {\r\n        import('../modals/FactModal').then(({ showFactModal }) => {\r\n          showFactModal({ mode: 'view', fact });\r\n        });\r\n      }\r\n    });\r\n    const verifyBtn = card.querySelector('.fact-verify-btn');\r\n    if (verifyBtn) {\r\n      on(verifyBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (id) {\r\n          try {\r\n            await factsService.verify(id);\r\n            toast.success('Fact verified');\r\n            loadFacts(container.closest('.facts-panel') as HTMLElement, props);\r\n          } catch {\r\n            // Error handled by service\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/** Category bar color (left edge) - align with question priority bar */\r\nconst CATEGORY_BAR_COLOR: Record<string, string> = {\r\n  technical: '#3b82f6',\r\n  process: '#8b5cf6',\r\n  policy: '#ec4899',\r\n  people: '#10b981',\r\n  timeline: '#f59e0b',\r\n  general: '#6b7280',\r\n};\r\n\r\n/**\r\n * Create fact card HTML - SOTA design aligned with question-card-sota\r\n */\r\nfunction createFactCard(fact: Fact): string {\r\n  const category = (fact.category || 'general').toLowerCase();\r\n  const categoryClass = category.replace(/\\s+/g, '-');\r\n  const barColor = CATEGORY_BAR_COLOR[category] || CATEGORY_BAR_COLOR.general;\r\n  const confidencePct = fact.confidence != null ? Math.round(fact.confidence * 100) : null;\r\n\r\n  return `\r\n    <div class=\"fact-card-sota question-card-sota ${fact.verified ? 'has-answer' : ''}\" data-id=\"${fact.id}\" style=\"--fact-category-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar fact-category-bar\" style=\"background: ${barColor}\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"priority-pill fact-category-pill category-${categoryClass}\">${escapeHtml(fact.category || 'general')}</span>\r\n            ${confidencePct != null ? `<span class=\"status-pill status-pending\">${confidencePct}%</span>` : ''}\r\n            ${fact.verified ? '<span class=\"auto-pill\"> Verified</span>' : ''}\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(fact.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(fact.content)}</div>\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${fact.source_file || fact.source ? `<span class=\"card-source-chip\">${escapeHtml((fact.source_file || fact.source || '').substring(0, 40))}${(fact.source_file || fact.source || '').length > 40 ? '' : ''}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>'}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            ${fact.verified ? '<span class=\"answered-badge\">Verified</span>' : '<button type=\"button\" class=\"btn-link fact-verify-btn\">Verify</button>'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Check for conflicts\r\n */\r\nasync function checkConflicts(container: HTMLElement, panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  container.style.display = 'block';\r\n  container.innerHTML = '<div class=\"loading\">Checking for conflicts...</div>';\r\n\r\n  try {\r\n    const conflicts = await factsService.detectConflicts();\r\n\r\n    if (conflicts.length === 0) {\r\n      container.innerHTML = `\r\n        <div class=\"no-conflicts\">\r\n          <span class=\"success-icon\"></span>\r\n          <p>No conflicts detected</p>\r\n        </div>\r\n      `;\r\n      setTimeout(() => {\r\n        container.style.display = 'none';\r\n      }, 3000);\r\n    } else {\r\n      renderConflicts(container, conflicts, panel, props);\r\n    }\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to check conflicts</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render conflicts  SOTA-style cards; each card has \"Keep left\" / \"Keep right\" to resolve.\r\n */\r\nfunction renderConflicts(container: HTMLElement, conflicts: FactConflict[], panel: HTMLElement, props: FactsPanelProps): void {\r\n  container.innerHTML = `\r\n    <div class=\"conflicts-section\">\r\n      <div class=\"conflicts-header section-header-sota\">\r\n        <h3>Conflicts Detected</h3>\r\n        <span class=\"conflicts-count panel-count\">${conflicts.length}</span>\r\n        <button type=\"button\" class=\"btn-icon close-conflicts\" title=\"Close\"></button>\r\n      </div>\r\n      <div class=\"conflicts-list question-group\">\r\n        ${conflicts.map((conflict, index) => createConflictCard(conflict, index)).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const closeBtn = container.querySelector('.close-conflicts');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => {\r\n      container.style.display = 'none';\r\n    });\r\n  }\r\n\r\n  conflicts.forEach((conflict, index) => {\r\n    const card = container.querySelector(`[data-conflict-index=\"${index}\"]`);\r\n    if (!card) return;\r\n    const keepLeftBtn = card.querySelector('.conflict-resolve-keep-left');\r\n    const keepRightBtn = card.querySelector('.conflict-resolve-keep-right');\r\n    if (keepLeftBtn) {\r\n      on(keepLeftBtn as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        resolveConflict(conflict, 'left', panel, props, container);\r\n      });\r\n    }\r\n    if (keepRightBtn) {\r\n      on(keepRightBtn as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        resolveConflict(conflict, 'right', panel, props, container);\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Resolve conflict: keep chosen fact, delete the other, refresh facts, re-run AI fact-check, optionally verify kept fact.\r\n */\r\nasync function resolveConflict(\r\n  conflict: FactConflict,\r\n  keep: 'left' | 'right',\r\n  panel: HTMLElement,\r\n  props: FactsPanelProps,\r\n  conflictsContainer: HTMLElement\r\n): Promise<void> {\r\n  const toDelete = keep === 'left' ? conflict.fact2 : conflict.fact1;\r\n  const toKeep = keep === 'left' ? conflict.fact1 : conflict.fact2;\r\n  if (!toDelete?.id) return;\r\n  try {\r\n    await factsService.deleteFact(toDelete.id);\r\n    toast.success(`Removed conflicting fact; kept: \"${truncate(toKeep?.content ?? '', 50)}\"`);\r\n    await loadFacts(panel, props);\r\n    // Re-run AI fact-check on remaining facts (automatic analysis)\r\n    try {\r\n      await factsService.runFactCheck();\r\n    } catch {\r\n      // Non-blocking\r\n    }\r\n    if (toKeep?.id) {\r\n      try {\r\n        await factsService.verifyFact(toKeep.id);\r\n      } catch {\r\n        // Non-blocking\r\n      }\r\n    }\r\n    await checkConflicts(conflictsContainer, panel, props);\r\n    const updated = await factsService.detectConflicts();\r\n    if (updated.length === 0) {\r\n      conflictsContainer.style.display = 'none';\r\n      conflictsContainer.innerHTML = '';\r\n    } else {\r\n      renderConflicts(conflictsContainer, updated, panel, props);\r\n    }\r\n    refreshRemovedFactsSection(panel, props);\r\n  } catch {\r\n    toast.error('Failed to resolve conflict');\r\n  }\r\n}\r\n\r\n/**\r\n * Create a single conflict card  isolated layout (no fact-card-sota) + Keep left / Keep right.\r\n */\r\nfunction createConflictCard(conflict: FactConflict, index: number): string {\r\n  const type = (conflict.conflictType || 'contradiction').toLowerCase();\r\n  const desc = conflict.description || conflict.reason || 'Conflict detected';\r\n  const barClass = type === 'contradiction' ? 'conflict-bar-contradiction' : type === 'inconsistency' ? 'conflict-bar-inconsistency' : 'conflict-bar-process';\r\n\r\n  return `\r\n    <div class=\"conflict-card-sota\" data-conflict-index=\"${index}\">\r\n      <div class=\"conflict-type-bar ${barClass}\"></div>\r\n      <div class=\"conflict-card-body\">\r\n        <div class=\"conflict-card-top\">\r\n          <span class=\"conflict-type-pill conflict-type-${type}\">${escapeHtml(type)}</span>\r\n          ${conflict.confidence != null ? `<span class=\"conflict-confidence-pill\">${Math.round(conflict.confidence * 100)}%</span>` : ''}\r\n        </div>\r\n        <div class=\"conflict-facts-row\">\r\n          <div class=\"conflict-fact-cell\">\r\n            <div class=\"conflict-fact-snippet\">${escapeHtml(truncate(conflict.fact1?.content ?? '', 120))}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-resolve-keep-left\">Keep this</button>\r\n          </div>\r\n          <span class=\"conflict-vs\">vs</span>\r\n          <div class=\"conflict-fact-cell\">\r\n            <div class=\"conflict-fact-snippet\">${escapeHtml(truncate(conflict.fact2?.content ?? '', 120))}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-resolve-keep-right\">Keep this</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"conflict-description-row\">\r\n          <div class=\"conflict-description\">${escapeHtml(desc)}</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction truncate(s: string, max: number): string {\r\n  if (s.length <= max) return s;\r\n  return s.slice(0, max).trim() + '';\r\n}\r\n\r\n/**\r\n * Show add fact modal\r\n */\r\nasync function showAddFactModal(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  // Dynamic import to avoid circular dependency\r\n  const { showFactModal } = await import('../modals/FactModal');\r\n  showFactModal({\r\n    mode: 'create',\r\n    onSave: () => loadFacts(panel, props),\r\n  });\r\n}\r\n\r\n/**\r\n * Update count badge\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#facts-count');\r\n  if (countEl) {\r\n    countEl.textContent = String(count);\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createFactsPanel;\r\n","/**\r\n * Stats Card Widget\r\n * Displays a single statistic with icon and optional trend\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { formatNumber } from '../../utils/format';\r\n\r\nexport interface StatsCardProps {\r\n  id: string;\r\n  label: string;\r\n  value: number | string;\r\n  icon?: string;\r\n  subValue?: string;\r\n  trend?: {\r\n    direction: 'up' | 'down' | 'stable';\r\n    value: number;\r\n    sentiment: 'positive' | 'negative' | 'neutral';\r\n  };\r\n  color?: string;\r\n  onClick?: () => void;\r\n}\r\n\r\n/**\r\n * Create stats card element\r\n */\r\nexport function createStatsCard(props: StatsCardProps): HTMLElement {\r\n  const card = createElement('div', {\r\n    className: `stats-card ${props.onClick ? 'clickable' : ''} ${props.color ? `color-${props.color}` : ''}`,\r\n  });\r\n  card.setAttribute('data-stat-id', props.id);\r\n\r\n  const trendHtml = props.trend ? `\r\n    <div class=\"stat-trend ${props.trend.direction} ${props.trend.sentiment}\">\r\n      <span class=\"trend-arrow\">${getTrendArrow(props.trend.direction)}</span>\r\n      <span class=\"trend-value\">${props.trend.value}%</span>\r\n    </div>\r\n  ` : '';\r\n\r\n  card.innerHTML = `\r\n    ${props.icon ? `<div class=\"stat-icon\">${props.icon}</div>` : ''}\r\n    <div class=\"stat-value\">${typeof props.value === 'number' ? formatNumber(props.value) : props.value}</div>\r\n    <div class=\"stat-label\">${props.label}</div>\r\n    ${props.subValue ? `<div class=\"stat-sub\">${props.subValue}</div>` : ''}\r\n    ${trendHtml}\r\n  `;\r\n\r\n  if (props.onClick) {\r\n    on(card, 'click', props.onClick);\r\n  }\r\n\r\n  return card;\r\n}\r\n\r\n/**\r\n * Get trend arrow character\r\n */\r\nfunction getTrendArrow(direction: 'up' | 'down' | 'stable'): string {\r\n  switch (direction) {\r\n    case 'up': return '';\r\n    case 'down': return '';\r\n    case 'stable': return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Update stats card value\r\n */\r\nexport function updateStatsCard(card: HTMLElement, value: number | string, subValue?: string): void {\r\n  const valueEl = card.querySelector('.stat-value');\r\n  const subEl = card.querySelector('.stat-sub');\r\n  \r\n  if (valueEl) {\r\n    valueEl.textContent = typeof value === 'number' ? formatNumber(value) : value;\r\n  }\r\n  \r\n  if (subEl && subValue !== undefined) {\r\n    subEl.textContent = subValue;\r\n  }\r\n}\r\n\r\n/**\r\n * Create stats grid with multiple cards\r\n */\r\nexport function createStatsGrid(stats: StatsCardProps[]): HTMLElement {\r\n  const grid = createElement('div', { className: 'stats-grid' });\r\n  \r\n  stats.forEach(stat => {\r\n    const card = createStatsCard(stat);\r\n    grid.appendChild(card);\r\n  });\r\n\r\n  return grid;\r\n}\r\n\r\nexport default createStatsCard;\r\n","/**\r\n * Health Indicator Widget\r\n * Displays project health score with gauge and factors\r\n */\r\n\r\nimport { createElement } from '../../utils/dom';\r\nimport { HealthData } from '../../services/dashboard';\r\n\r\nexport interface HealthIndicatorProps {\r\n  health: HealthData;\r\n  showFactors?: boolean;\r\n  size?: 'sm' | 'md' | 'lg';\r\n}\r\n\r\n/**\r\n * Create health indicator element\r\n */\r\nexport function createHealthIndicator(props: HealthIndicatorProps): HTMLElement {\r\n  const { health, showFactors = true, size = 'md' } = props;\r\n  const statusClass = health.status.toLowerCase().replace(/\\s+/g, '-');\r\n\r\n  const indicator = createElement('div', {\r\n    className: `health-indicator ${statusClass} size-${size}`,\r\n  });\r\n\r\n  indicator.innerHTML = `\r\n    <div class=\"health-gauge\">\r\n      <svg class=\"gauge-svg\" viewBox=\"0 0 100 50\">\r\n        <path class=\"gauge-bg\" d=\"M 10 50 A 40 40 0 0 1 90 50\" />\r\n        <path class=\"gauge-fill\" d=\"M 10 50 A 40 40 0 0 1 90 50\" \r\n              style=\"stroke-dasharray: ${(health.score / 100) * 126} 126; stroke: ${health.color};\" />\r\n      </svg>\r\n      <div class=\"gauge-center\">\r\n        <span class=\"score-value\">${health.score}</span>\r\n        <span class=\"score-label\">Health</span>\r\n      </div>\r\n    </div>\r\n    <div class=\"health-status\" style=\"color: ${health.color}\">${health.status}</div>\r\n    ${showFactors && health.factors.length > 0 ? `\r\n      <div class=\"health-factors\">\r\n        ${health.factors.slice(0, 4).map(f => `\r\n          <div class=\"factor ${f.type}\">\r\n            <span class=\"factor-icon\">${f.type === 'positive' ? '' : '!'}</span>\r\n            <span class=\"factor-text\">${f.factor}</span>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  return indicator;\r\n}\r\n\r\n/**\r\n * Create mini health badge (for header/compact views)\r\n */\r\nexport function createHealthBadge(score: number, status: string, color: string): HTMLElement {\r\n  const badge = createElement('div', { className: 'health-badge' });\r\n  \r\n  badge.innerHTML = `\r\n    <span class=\"badge-score\" style=\"background: ${color}\">${score}</span>\r\n    <span class=\"badge-status\">${status}</span>\r\n  `;\r\n\r\n  return badge;\r\n}\r\n\r\n/**\r\n * Get health color based on score\r\n */\r\nexport function getHealthColor(score: number): string {\r\n  if (score >= 80) return '#22c55e'; // green\r\n  if (score >= 60) return '#84cc16'; // lime\r\n  if (score >= 40) return '#eab308'; // yellow\r\n  if (score >= 20) return '#f97316'; // orange\r\n  return '#ef4444'; // red\r\n}\r\n\r\n/**\r\n * Get health status based on score\r\n */\r\nexport function getHealthStatus(score: number): string {\r\n  if (score >= 80) return 'Healthy';\r\n  if (score >= 60) return 'Good';\r\n  if (score >= 40) return 'Needs Attention';\r\n  if (score >= 20) return 'At Risk';\r\n  return 'Critical';\r\n}\r\n\r\nexport default createHealthIndicator;\r\n","/**\r\n * Trend Chart Widget\r\n * Displays trends over time using Chart.js\r\n */\r\n\r\nimport { createElement } from '../../utils/dom';\r\nimport { TrendHistory } from '../../services/dashboard';\r\n\r\nexport interface TrendChartProps {\r\n  data: TrendHistory[];\r\n  metrics?: ('facts' | 'questions' | 'risks' | 'actions' | 'decisions')[];\r\n  height?: number;\r\n}\r\n\r\n// Color palette for metrics\r\nconst METRIC_COLORS: Record<string, { line: string; fill: string }> = {\r\n  facts: { line: '#6366f1', fill: 'rgba(99, 102, 241, 0.1)' },\r\n  questions: { line: '#f59e0b', fill: 'rgba(245, 158, 11, 0.1)' },\r\n  risks: { line: '#ef4444', fill: 'rgba(239, 68, 68, 0.1)' },\r\n  actions: { line: '#22c55e', fill: 'rgba(34, 197, 94, 0.1)' },\r\n  decisions: { line: '#8b5cf6', fill: 'rgba(139, 92, 246, 0.1)' },\r\n};\r\n\r\n/**\r\n * Create trend chart element\r\n */\r\nexport function createTrendChart(props: TrendChartProps): HTMLElement {\r\n  const { data, metrics = ['facts', 'questions', 'risks'], height = 200 } = props;\r\n\r\n  const container = createElement('div', { className: 'trend-chart-container' });\r\n  container.style.height = `${height}px`;\r\n\r\n  if (data.length === 0) {\r\n    container.innerHTML = '<div class=\"empty-chart\">No trend data available</div>';\r\n    return container;\r\n  }\r\n\r\n  // Create canvas for Chart.js\r\n  const canvas = createElement('canvas', { id: `trend-chart-${Date.now()}` }) as HTMLCanvasElement;\r\n  container.appendChild(canvas);\r\n\r\n  // Initialize chart (requires Chart.js to be loaded)\r\n  initChart(canvas, data, metrics);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Initialize Chart.js chart\r\n */\r\nfunction initChart(\r\n  canvas: HTMLCanvasElement,\r\n  data: TrendHistory[],\r\n  metrics: string[]\r\n): void {\r\n  // Check if Chart.js is available\r\n  if (typeof (window as unknown as { Chart?: unknown }).Chart === 'undefined') {\r\n    console.warn('Chart.js not loaded, using fallback');\r\n    renderFallbackChart(canvas.parentElement as HTMLElement, data, metrics);\r\n    return;\r\n  }\r\n\r\n  const Chart = (window as unknown as { Chart: typeof import('chart.js').Chart }).Chart;\r\n\r\n  const labels = data.map(d => formatDate(d.date));\r\n  const datasets = metrics.map(metric => ({\r\n    label: capitalize(metric),\r\n    data: data.map(d => (d as Record<string, number>)[metric] || 0),\r\n    borderColor: METRIC_COLORS[metric]?.line || '#6366f1',\r\n    backgroundColor: METRIC_COLORS[metric]?.fill || 'rgba(99, 102, 241, 0.1)',\r\n    fill: true,\r\n    tension: 0.3,\r\n  }));\r\n\r\n  new Chart(canvas, {\r\n    type: 'line',\r\n    data: { labels, datasets },\r\n    options: {\r\n      responsive: true,\r\n      maintainAspectRatio: false,\r\n      plugins: {\r\n        legend: {\r\n          position: 'bottom',\r\n        },\r\n      },\r\n      scales: {\r\n        y: {\r\n          beginAtZero: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Render fallback chart (pure CSS/HTML)\r\n */\r\nfunction renderFallbackChart(container: HTMLElement, data: TrendHistory[], metrics: string[]): void {\r\n  const maxValue = Math.max(\r\n    ...data.flatMap(d => metrics.map(m => (d as Record<string, number>)[m] || 0))\r\n  );\r\n\r\n  container.innerHTML = `\r\n    <div class=\"fallback-chart\">\r\n      <div class=\"chart-legend\">\r\n        ${metrics.map(m => `\r\n          <span class=\"legend-item\">\r\n            <span class=\"legend-color\" style=\"background: ${METRIC_COLORS[m]?.line || '#6366f1'}\"></span>\r\n            ${capitalize(m)}\r\n          </span>\r\n        `).join('')}\r\n      </div>\r\n      <div class=\"chart-bars\">\r\n        ${data.slice(-7).map(d => `\r\n          <div class=\"bar-group\">\r\n            ${metrics.map(m => {\r\n              const value = (d as Record<string, number>)[m] || 0;\r\n              const height = maxValue > 0 ? (value / maxValue) * 100 : 0;\r\n              return `<div class=\"bar\" style=\"height: ${height}%; background: ${METRIC_COLORS[m]?.line || '#6366f1'}\" title=\"${capitalize(m)}: ${value}\"></div>`;\r\n            }).join('')}\r\n            <div class=\"bar-label\">${formatDate(d.date)}</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Format date for display\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\r\n}\r\n\r\n/**\r\n * Capitalize first letter\r\n */\r\nfunction capitalize(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\nexport default createTrendChart;\r\n","/**\r\n * Risk Matrix Widget\r\n * 5x4 matrix showing risks by impact and likelihood\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Risk, risksService } from '../../services/risks';\r\n\r\nexport interface RiskMatrixProps {\r\n  risks: Risk[];\r\n  onCellClick?: (risks: Risk[], impact: string, likelihood: string) => void;\r\n  size?: 'sm' | 'md' | 'lg';\r\n}\r\n\r\nconst IMPACTS = ['critical', 'high', 'medium', 'low'];\r\nconst LIKELIHOODS = ['high', 'medium', 'low'];\r\n\r\n// Cell colors based on risk level\r\nconst CELL_COLORS: Record<string, string> = {\r\n  'critical-high': '#dc2626',   // dark red\r\n  'critical-medium': '#ef4444', // red\r\n  'critical-low': '#f87171',    // light red\r\n  'high-high': '#ef4444',       // red\r\n  'high-medium': '#f97316',     // orange\r\n  'high-low': '#fb923c',        // light orange\r\n  'medium-high': '#f97316',     // orange\r\n  'medium-medium': '#eab308',   // yellow\r\n  'medium-low': '#facc15',      // light yellow\r\n  'low-high': '#eab308',        // yellow\r\n  'low-medium': '#84cc16',      // lime\r\n  'low-low': '#22c55e',         // green\r\n};\r\n\r\n/**\r\n * Create risk matrix element\r\n */\r\nexport function createRiskMatrix(props: RiskMatrixProps): HTMLElement {\r\n  const { risks, onCellClick, size = 'md' } = props;\r\n\r\n  const matrix = createElement('div', { className: `risk-matrix size-${size}` });\r\n  \r\n  // Group risks by cell\r\n  const grouped = groupRisksByCell(risks);\r\n\r\n  matrix.innerHTML = `\r\n    <div class=\"matrix-container\">\r\n      <div class=\"matrix-y-label\">Impact</div>\r\n      <div class=\"matrix-grid\">\r\n        <div class=\"matrix-header\">\r\n          <div class=\"matrix-corner\"></div>\r\n          ${LIKELIHOODS.map(l => `<div class=\"matrix-col-header\">${capitalize(l)}</div>`).join('')}\r\n        </div>\r\n        ${IMPACTS.map(impact => `\r\n          <div class=\"matrix-row\">\r\n            <div class=\"matrix-row-header\">${capitalize(impact)}</div>\r\n            ${LIKELIHOODS.map(likelihood => {\r\n              const key = `${impact}-${likelihood}`;\r\n              const cellRisks = grouped[key] || [];\r\n              const color = CELL_COLORS[key] || '#e5e7eb';\r\n              const count = cellRisks.length;\r\n              return `\r\n                <div class=\"matrix-cell ${count > 0 ? 'has-risks' : ''}\" \r\n                     data-impact=\"${impact}\" \r\n                     data-likelihood=\"${likelihood}\"\r\n                     style=\"background-color: ${count > 0 ? color : 'var(--color-surface-hover)'}\">\r\n                  ${count > 0 ? `<span class=\"cell-count\">${count}</span>` : ''}\r\n                </div>\r\n              `;\r\n            }).join('')}\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n      <div class=\"matrix-x-label\">Likelihood</div>\r\n    </div>\r\n    <div class=\"matrix-legend\">\r\n      <span class=\"legend-item\"><span class=\"legend-color\" style=\"background: #22c55e\"></span> Low</span>\r\n      <span class=\"legend-item\"><span class=\"legend-color\" style=\"background: #eab308\"></span> Medium</span>\r\n      <span class=\"legend-item\"><span class=\"legend-color\" style=\"background: #f97316\"></span> High</span>\r\n      <span class=\"legend-item\"><span class=\"legend-color\" style=\"background: #ef4444\"></span> Critical</span>\r\n    </div>\r\n  `;\r\n\r\n  // Bind cell click events\r\n  if (onCellClick) {\r\n    matrix.querySelectorAll('.matrix-cell.has-risks').forEach(cell => {\r\n      on(cell as HTMLElement, 'click', () => {\r\n        const impact = cell.getAttribute('data-impact') || '';\r\n        const likelihood = cell.getAttribute('data-likelihood') || '';\r\n        const key = `${impact}-${likelihood}`;\r\n        const cellRisks = grouped[key] || [];\r\n        onCellClick(cellRisks, impact, likelihood);\r\n      });\r\n    });\r\n  }\r\n\r\n  return matrix;\r\n}\r\n\r\n/**\r\n * Group risks by matrix cell\r\n */\r\nfunction groupRisksByCell(risks: Risk[]): Record<string, Risk[]> {\r\n  const grouped: Record<string, Risk[]> = {};\r\n  \r\n  risks\r\n    .filter(r => r.status !== 'mitigated' && r.status !== 'closed')\r\n    .forEach(risk => {\r\n      const key = `${risk.impact}-${risk.likelihood}`;\r\n      if (!grouped[key]) grouped[key] = [];\r\n      grouped[key].push(risk);\r\n    });\r\n  \r\n  return grouped;\r\n}\r\n\r\n/**\r\n * Capitalize first letter\r\n */\r\nfunction capitalize(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\n/**\r\n * Create compact risk summary (for dashboard)\r\n */\r\nexport function createRiskSummary(risks: Risk[]): HTMLElement {\r\n  const summary = createElement('div', { className: 'risk-summary' });\r\n  \r\n  const bySeverity = {\r\n    critical: risks.filter(r => r.impact === 'critical' && r.status === 'open').length,\r\n    high: risks.filter(r => r.impact === 'high' && r.status === 'open').length,\r\n    medium: risks.filter(r => r.impact === 'medium' && r.status === 'open').length,\r\n    low: risks.filter(r => r.impact === 'low' && r.status === 'open').length,\r\n  };\r\n\r\n  summary.innerHTML = `\r\n    <div class=\"summary-bars\">\r\n      ${Object.entries(bySeverity).map(([level, count]) => `\r\n        <div class=\"summary-bar\">\r\n          <span class=\"bar-label\">${capitalize(level)}</span>\r\n          <div class=\"bar-track\">\r\n            <div class=\"bar-fill impact-${level}\" style=\"width: ${Math.min(count * 20, 100)}%\"></div>\r\n          </div>\r\n          <span class=\"bar-count\">${count}</span>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  return summary;\r\n}\r\n\r\nexport default createRiskMatrix;\r\n","/**\r\n * File Uploader Component\r\n * Drag-and-drop file upload with progress and file list\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { documentsService, UploadResult, ProcessingStatus } from '../services/documents';\r\nimport { toast } from '../services/toast';\r\nimport { formatFileSize } from '../utils/format';\r\n\r\nexport interface FileUploaderProps {\r\n  onUploadComplete?: (result: UploadResult) => void;\r\n  onProcessingStart?: () => void;\r\n  allowedTypes?: string[];\r\n  maxFileSize?: number; // in bytes\r\n  multiple?: boolean;\r\n}\r\n\r\ninterface QueuedFile {\r\n  file: File;\r\n  id: string;\r\n  progress: number;\r\n  status: 'pending' | 'uploading' | 'complete' | 'error';\r\n  error?: string;\r\n}\r\n\r\nlet fileQueue: QueuedFile[] = [];\r\nlet isProcessing = false;\r\n\r\n/**\r\n * Create file uploader component\r\n */\r\nexport function createFileUploader(props: FileUploaderProps = {}): HTMLElement {\r\n  const { allowedTypes, maxFileSize = 50 * 1024 * 1024, multiple = true } = props;\r\n\r\n  const uploader = createElement('div', { className: 'file-uploader' });\r\n\r\n  uploader.innerHTML = `\r\n    <div class=\"dropzone\" id=\"dropzone\">\r\n      <div class=\"dropzone-content\">\r\n        <div class=\"dropzone-icon\"></div>\r\n        <div class=\"dropzone-text\">\r\n          <p>Drag & drop files here</p>\r\n          <p class=\"dropzone-subtext\">or click to browse</p>\r\n        </div>\r\n        <input type=\"file\" id=\"file-input\" ${multiple ? 'multiple' : ''} \r\n               ${allowedTypes ? `accept=\"${allowedTypes.join(',')}\"` : ''} hidden>\r\n      </div>\r\n    </div>\r\n    <div class=\"file-queue\" id=\"file-queue\" style=\"display: none;\"></div>\r\n    <div class=\"upload-actions\" id=\"upload-actions\" style=\"display: none;\">\r\n      <button class=\"btn btn-secondary\" id=\"clear-queue-btn\">Clear</button>\r\n      <button class=\"btn btn-primary\" id=\"upload-btn\">Upload Files</button>\r\n    </div>\r\n    <div class=\"processing-status\" id=\"processing-status\" style=\"display: none;\"></div>\r\n  `;\r\n\r\n  const dropzone = uploader.querySelector('#dropzone') as HTMLElement;\r\n  const fileInput = uploader.querySelector('#file-input') as HTMLInputElement;\r\n  const queueContainer = uploader.querySelector('#file-queue') as HTMLElement;\r\n  const actionsContainer = uploader.querySelector('#upload-actions') as HTMLElement;\r\n  const statusContainer = uploader.querySelector('#processing-status') as HTMLElement;\r\n\r\n  // Click to browse\r\n  on(dropzone, 'click', () => fileInput.click());\r\n\r\n  // File input change\r\n  on(fileInput, 'change', () => {\r\n    if (fileInput.files) {\r\n      addFilesToQueue(Array.from(fileInput.files), maxFileSize);\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    }\r\n    fileInput.value = ''; // Reset for same file selection\r\n  });\r\n\r\n  // Drag events\r\n  on(dropzone, 'dragover', (e) => {\r\n    e.preventDefault();\r\n    dropzone.classList.add('dragover');\r\n  });\r\n\r\n  on(dropzone, 'dragleave', () => {\r\n    dropzone.classList.remove('dragover');\r\n  });\r\n\r\n  on(dropzone, 'drop', (e) => {\r\n    e.preventDefault();\r\n    dropzone.classList.remove('dragover');\r\n    const files = Array.from(e.dataTransfer?.files || []);\r\n    if (files.length > 0) {\r\n      addFilesToQueue(files, maxFileSize);\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    }\r\n  });\r\n\r\n  // Clear queue\r\n  const clearBtn = uploader.querySelector('#clear-queue-btn');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      fileQueue = [];\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    });\r\n  }\r\n\r\n  // Upload button\r\n  const uploadBtn = uploader.querySelector('#upload-btn');\r\n  if (uploadBtn) {\r\n    on(uploadBtn as HTMLElement, 'click', async () => {\r\n      await uploadFiles(queueContainer, actionsContainer, statusContainer, props);\r\n    });\r\n  }\r\n\r\n  // Check processing status on mount\r\n  checkProcessingStatus(statusContainer);\r\n\r\n  return uploader;\r\n}\r\n\r\n/**\r\n * Add files to queue\r\n */\r\nfunction addFilesToQueue(files: File[], maxSize: number): void {\r\n  files.forEach(file => {\r\n    // Check size\r\n    if (file.size > maxSize) {\r\n      toast.warning(`${file.name} is too large (max ${formatFileSize(maxSize)})`);\r\n      return;\r\n    }\r\n\r\n    // Check if already in queue\r\n    if (fileQueue.some(f => f.file.name === file.name && f.file.size === file.size)) {\r\n      return;\r\n    }\r\n\r\n    fileQueue.push({\r\n      file,\r\n      id: `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      progress: 0,\r\n      status: 'pending',\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Update queue UI\r\n */\r\nfunction updateQueueUI(container: HTMLElement, actionsContainer: HTMLElement): void {\r\n  if (fileQueue.length === 0) {\r\n    container.style.display = 'none';\r\n    actionsContainer.style.display = 'none';\r\n    return;\r\n  }\r\n\r\n  container.style.display = 'block';\r\n  actionsContainer.style.display = 'flex';\r\n\r\n  container.innerHTML = fileQueue.map(qf => `\r\n    <div class=\"queued-file ${qf.status}\" data-id=\"${qf.id}\">\r\n      <div class=\"file-info\">\r\n        <span class=\"file-icon\">${getFileIcon(qf.file.type)}</span>\r\n        <span class=\"file-name\">${escapeHtml(qf.file.name)}</span>\r\n        <span class=\"file-size\">${formatFileSize(qf.file.size)}</span>\r\n      </div>\r\n      <div class=\"file-status\">\r\n        ${qf.status === 'uploading' ? `\r\n          <div class=\"progress-bar\">\r\n            <div class=\"progress-fill\" style=\"width: ${qf.progress}%\"></div>\r\n          </div>\r\n          <span class=\"progress-text\">${qf.progress}%</span>\r\n        ` : qf.status === 'complete' ? `\r\n          <span class=\"status-icon success\"></span>\r\n        ` : qf.status === 'error' ? `\r\n          <span class=\"status-icon error\"></span>\r\n          <span class=\"error-text\">${escapeHtml(qf.error || 'Error')}</span>\r\n        ` : `\r\n          <button class=\"btn-icon remove-file\" data-id=\"${qf.id}\"></button>\r\n        `}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind remove buttons\r\n  container.querySelectorAll('.remove-file').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      fileQueue = fileQueue.filter(f => f.id !== id);\r\n      updateQueueUI(container, actionsContainer);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Upload files\r\n */\r\nasync function uploadFiles(\r\n  queueContainer: HTMLElement,\r\n  actionsContainer: HTMLElement,\r\n  statusContainer: HTMLElement,\r\n  props: FileUploaderProps\r\n): Promise<void> {\r\n  const pendingFiles = fileQueue.filter(f => f.status === 'pending');\r\n  if (pendingFiles.length === 0) return;\r\n\r\n  // Disable buttons during upload\r\n  const uploadBtn = actionsContainer.querySelector('#upload-btn') as HTMLButtonElement;\r\n  if (uploadBtn) uploadBtn.disabled = true;\r\n\r\n  try {\r\n    // Mark all as uploading\r\n    pendingFiles.forEach(f => {\r\n      f.status = 'uploading';\r\n      f.progress = 0;\r\n    });\r\n    updateQueueUI(queueContainer, actionsContainer);\r\n\r\n    // Upload files\r\n    const result = await documentsService.upload(\r\n      pendingFiles.map(f => f.file),\r\n      (progress) => {\r\n        pendingFiles.forEach(f => {\r\n          f.progress = progress;\r\n        });\r\n        updateQueueUI(queueContainer, actionsContainer);\r\n      }\r\n    );\r\n\r\n    // Mark as complete\r\n    pendingFiles.forEach(f => {\r\n      f.status = 'complete';\r\n      f.progress = 100;\r\n    });\r\n    updateQueueUI(queueContainer, actionsContainer);\r\n\r\n    toast.success(`Uploaded ${result.files.length} file(s)`);\r\n    props.onUploadComplete?.(result);\r\n\r\n    // Clear completed after delay\r\n    setTimeout(() => {\r\n      fileQueue = fileQueue.filter(f => f.status !== 'complete');\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    }, 2000);\r\n\r\n    // Check if processing started\r\n    if (result.processingStarted) {\r\n      props.onProcessingStart?.();\r\n      pollProcessingStatus(statusContainer);\r\n    }\r\n  } catch (error) {\r\n    pendingFiles.forEach(f => {\r\n      f.status = 'error';\r\n      f.error = error instanceof Error ? error.message : 'Upload failed';\r\n    });\r\n    updateQueueUI(queueContainer, actionsContainer);\r\n  } finally {\r\n    if (uploadBtn) uploadBtn.disabled = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Check processing status\r\n */\r\nasync function checkProcessingStatus(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const status = await documentsService.getProcessingStatus();\r\n    if (status.isProcessing || status.queueLength > 0) {\r\n      renderProcessingStatus(container, status);\r\n      pollProcessingStatus(container);\r\n    }\r\n  } catch {\r\n    // Ignore errors\r\n  }\r\n}\r\n\r\n/**\r\n * Poll processing status\r\n */\r\nlet pollingInterval: number | null = null;\r\n\r\nfunction pollProcessingStatus(container: HTMLElement): void {\r\n  if (pollingInterval) return;\r\n\r\n  pollingInterval = window.setInterval(async () => {\r\n    try {\r\n      const status = await documentsService.getProcessingStatus();\r\n      renderProcessingStatus(container, status);\r\n\r\n      if (!status.isProcessing && status.queueLength === 0) {\r\n        if (pollingInterval) {\r\n          clearInterval(pollingInterval);\r\n          pollingInterval = null;\r\n        }\r\n        setTimeout(() => {\r\n          container.style.display = 'none';\r\n        }, 3000);\r\n      }\r\n    } catch {\r\n      if (pollingInterval) {\r\n        clearInterval(pollingInterval);\r\n        pollingInterval = null;\r\n      }\r\n    }\r\n  }, 2000);\r\n}\r\n\r\n/**\r\n * Render processing status\r\n */\r\nfunction renderProcessingStatus(container: HTMLElement, status: ProcessingStatus): void {\r\n  container.style.display = 'block';\r\n\r\n  container.innerHTML = `\r\n    <div class=\"processing-header\">\r\n      <span class=\"processing-icon\">${status.isProcessing ? '' : ''}</span>\r\n      <span class=\"processing-title\">${status.isProcessing ? 'Processing...' : 'Complete'}</span>\r\n    </div>\r\n    <div class=\"processing-stats\">\r\n      <span>Completed: ${status.completedCount}</span>\r\n      <span>Pending: ${status.queueLength}</span>\r\n      ${status.errorCount > 0 ? `<span class=\"error\">Errors: ${status.errorCount}</span>` : ''}\r\n    </div>\r\n    ${status.processingFile ? `<div class=\"current-file\">Current: ${escapeHtml(status.processingFile)}</div>` : ''}\r\n    ${status.isProcessing ? `\r\n      <div class=\"processing-progress\">\r\n        <div class=\"progress-bar\">\r\n          <div class=\"progress-fill\" style=\"width: ${(status.completedCount / (status.completedCount + status.queueLength + 1)) * 100}%\"></div>\r\n        </div>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Get file icon based on type\r\n */\r\nfunction getFileIcon(mimeType: string): string {\r\n  if (mimeType.startsWith('image/')) return '';\r\n  if (mimeType.startsWith('video/')) return '';\r\n  if (mimeType.startsWith('audio/')) return '';\r\n  if (mimeType === 'application/pdf') return '';\r\n  if (mimeType.includes('spreadsheet') || mimeType.includes('excel')) return '';\r\n  if (mimeType.includes('document') || mimeType.includes('word')) return '';\r\n  if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return '';\r\n  if (mimeType.includes('text')) return '';\r\n  return '';\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createFileUploader;\r\n","/**\r\n * Knowledge Graph Component\r\n * Interactive graph visualization using vis-network\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { graphService, GraphNode, GraphEdge, GraphStats } from '../services/graph';\r\nimport { toast } from '../services/toast';\r\n\r\nexport interface KnowledgeGraphProps {\r\n  onNodeClick?: (node: GraphNode) => void;\r\n  onEdgeClick?: (edge: GraphEdge) => void;\r\n  height?: number;\r\n}\r\n\r\ninterface VisNetwork {\r\n  setData: (data: { nodes: unknown[]; edges: unknown[] }) => void;\r\n  on: (event: string, callback: (params: unknown) => void) => void;\r\n  fit: () => void;\r\n  focus: (nodeId: string, options?: { scale?: number }) => void;\r\n  destroy: () => void;\r\n}\r\n\r\ndeclare global {\r\n  interface Window {\r\n    vis?: {\r\n      Network: new (container: HTMLElement, data: unknown, options: unknown) => VisNetwork;\r\n      DataSet: new (data: unknown[]) => unknown;\r\n    };\r\n  }\r\n}\r\n\r\nconst NODE_COLORS: Record<string, string> = {\r\n  Person: '#6366f1',\r\n  Document: '#22c55e',\r\n  Question: '#f59e0b',\r\n  Risk: '#ef4444',\r\n  Action: '#8b5cf6',\r\n  Decision: '#06b6d4',\r\n  Fact: '#84cc16',\r\n  Email: '#ec4899',\r\n  default: '#9ca3af',\r\n};\r\n\r\n/**\r\n * Create knowledge graph component\r\n */\r\nexport function createKnowledgeGraph(props: KnowledgeGraphProps = {}): HTMLElement {\r\n  const { height = 500 } = props;\r\n\r\n  const container = createElement('div', { className: 'knowledge-graph' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"graph-toolbar\">\r\n      <div class=\"graph-filters\">\r\n        <label class=\"filter-item\">\r\n          <input type=\"checkbox\" checked data-type=\"Person\"> People\r\n        </label>\r\n        <label class=\"filter-item\">\r\n          <input type=\"checkbox\" checked data-type=\"Document\"> Documents\r\n        </label>\r\n        <label class=\"filter-item\">\r\n          <input type=\"checkbox\" checked data-type=\"Question\"> Questions\r\n        </label>\r\n        <label class=\"filter-item\">\r\n          <input type=\"checkbox\" checked data-type=\"Risk\"> Risks\r\n        </label>\r\n      </div>\r\n      <div class=\"graph-actions\">\r\n        <input type=\"search\" id=\"graph-search\" class=\"search-input\" placeholder=\"Search nodes...\">\r\n        <button class=\"btn btn-sm\" id=\"graph-refresh\">Refresh</button>\r\n        <button class=\"btn btn-sm\" id=\"graph-fit\">Fit</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"graph-container\" id=\"graph-container\" style=\"height: ${height}px;\">\r\n      <div class=\"graph-loading\">Loading graph...</div>\r\n    </div>\r\n    <div class=\"graph-stats\" id=\"graph-stats\"></div>\r\n    <div class=\"node-details\" id=\"node-details\" style=\"display: none;\"></div>\r\n  `;\r\n\r\n  // Initialize graph\r\n  initGraph(container, props);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Initialize graph visualization\r\n */\r\nasync function initGraph(container: HTMLElement, props: KnowledgeGraphProps): Promise<void> {\r\n  const graphContainer = container.querySelector('#graph-container') as HTMLElement;\r\n  const statsContainer = container.querySelector('#graph-stats') as HTMLElement;\r\n\r\n  // Check if vis-network is available\r\n  if (!window.vis) {\r\n    graphContainer.innerHTML = `\r\n      <div class=\"graph-fallback\">\r\n        <p>Graph visualization requires vis-network library</p>\r\n        <p class=\"text-muted\">Add vis-network to enable interactive graph</p>\r\n      </div>\r\n    `;\r\n    await loadStats(statsContainer);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    // Load graph data\r\n    const { nodes, edges } = await graphService.getVisualizationData();\r\n    \r\n    if (nodes.length === 0) {\r\n      graphContainer.innerHTML = `\r\n        <div class=\"graph-empty\">\r\n          <p>No graph data available</p>\r\n          <p class=\"text-muted\">Process some documents to populate the knowledge graph</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    // Create vis-network\r\n    const network = createVisNetwork(graphContainer, nodes, edges, props);\r\n    \r\n    // Bind toolbar events\r\n    bindToolbarEvents(container, network, nodes, props);\r\n\r\n    // Load stats\r\n    await loadStats(statsContainer);\r\n\r\n  } catch (error) {\r\n    graphContainer.innerHTML = `\r\n      <div class=\"graph-error\">\r\n        <p>Failed to load graph</p>\r\n        <button class=\"btn btn-sm\" id=\"retry-graph\">Retry</button>\r\n      </div>\r\n    `;\r\n    const retryBtn = graphContainer.querySelector('#retry-graph');\r\n    if (retryBtn) {\r\n      on(retryBtn as HTMLElement, 'click', () => initGraph(container, props));\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Create vis-network instance\r\n */\r\nfunction createVisNetwork(\r\n  container: HTMLElement,\r\n  nodes: GraphNode[],\r\n  edges: GraphEdge[],\r\n  props: KnowledgeGraphProps\r\n): VisNetwork {\r\n  container.innerHTML = ''; // Clear loading\r\n\r\n  const visNodes = nodes.map(n => ({\r\n    id: n.id,\r\n    label: n.label || n.name || n.id,\r\n    color: NODE_COLORS[n.type] || NODE_COLORS.default,\r\n    title: `${n.type}: ${n.label || n.name || n.id}`,\r\n    shape: 'dot',\r\n    size: getNodeSize(n),\r\n  }));\r\n\r\n  const visEdges = edges.map(e => ({\r\n    from: e.source,\r\n    to: e.target,\r\n    label: e.type,\r\n    arrows: 'to',\r\n    color: { color: '#9ca3af', opacity: 0.6 },\r\n  }));\r\n\r\n  const options = {\r\n    nodes: {\r\n      borderWidth: 2,\r\n      shadow: true,\r\n      font: {\r\n        size: 12,\r\n        color: getComputedStyle(document.documentElement).getPropertyValue('--color-text').trim() || '#333',\r\n      },\r\n    },\r\n    edges: {\r\n      width: 1,\r\n      shadow: false,\r\n      smooth: {\r\n        type: 'continuous',\r\n      },\r\n      font: {\r\n        size: 10,\r\n        color: '#9ca3af',\r\n      },\r\n    },\r\n    physics: {\r\n      stabilization: {\r\n        iterations: 100,\r\n      },\r\n      barnesHut: {\r\n        gravitationalConstant: -5000,\r\n        springLength: 150,\r\n      },\r\n    },\r\n    interaction: {\r\n      hover: true,\r\n      tooltipDelay: 200,\r\n    },\r\n  };\r\n\r\n  const network = new window.vis!.Network(container, {\r\n    nodes: new window.vis!.DataSet(visNodes),\r\n    edges: new window.vis!.DataSet(visEdges),\r\n  }, options);\r\n\r\n  // Node click handler\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  network.on('click', (params: any) => {\r\n    if (params.nodes && params.nodes.length > 0) {\r\n      const nodeId = params.nodes[0];\r\n      const node = nodes.find(n => n.id === nodeId);\r\n      if (node && props.onNodeClick) {\r\n        props.onNodeClick(node);\r\n      }\r\n      showNodeDetails(container, node);\r\n    }\r\n  });\r\n\r\n  return network;\r\n}\r\n\r\n/**\r\n * Get node size based on connections\r\n */\r\nfunction getNodeSize(node: GraphNode): number {\r\n  const connections = (node as unknown as { connections?: number }).connections || 1;\r\n  return Math.min(10 + connections * 2, 30);\r\n}\r\n\r\n/**\r\n * Bind toolbar events\r\n */\r\nfunction bindToolbarEvents(\r\n  container: HTMLElement,\r\n  network: VisNetwork,\r\n  nodes: GraphNode[],\r\n  props: KnowledgeGraphProps\r\n): void {\r\n  // Search\r\n  const searchInput = container.querySelector('#graph-search') as HTMLInputElement;\r\n  on(searchInput, 'input', () => {\r\n    const query = searchInput.value.toLowerCase();\r\n    const matchingNode = nodes.find(n => \r\n      (n.label || n.name || n.id).toLowerCase().includes(query)\r\n    );\r\n    if (matchingNode) {\r\n      network.focus(matchingNode.id, { scale: 1.5 });\r\n    }\r\n  });\r\n\r\n  // Refresh\r\n  const refreshBtn = container.querySelector('#graph-refresh');\r\n  if (refreshBtn) {\r\n    on(refreshBtn as HTMLElement, 'click', () => {\r\n      initGraph(container, props);\r\n    });\r\n  }\r\n\r\n  // Fit\r\n  const fitBtn = container.querySelector('#graph-fit');\r\n  if (fitBtn) {\r\n    on(fitBtn as HTMLElement, 'click', () => {\r\n      network.fit();\r\n    });\r\n  }\r\n\r\n  // Filters\r\n  container.querySelectorAll('.filter-item input').forEach(checkbox => {\r\n    on(checkbox as HTMLElement, 'change', () => {\r\n      // TODO: Implement filtering\r\n      toast.info('Filtering not yet implemented');\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show node details\r\n */\r\nfunction showNodeDetails(container: HTMLElement, node?: GraphNode): void {\r\n  const detailsContainer = container.querySelector('#node-details') as HTMLElement;\r\n  \r\n  if (!node) {\r\n    detailsContainer.style.display = 'none';\r\n    return;\r\n  }\r\n\r\n  detailsContainer.style.display = 'block';\r\n  detailsContainer.innerHTML = `\r\n    <div class=\"details-header\">\r\n      <span class=\"node-type\" style=\"background: ${NODE_COLORS[node.type] || NODE_COLORS.default}\">${node.type}</span>\r\n      <span class=\"node-label\">${escapeHtml(node.label || node.name || node.id)}</span>\r\n      <button class=\"btn-icon close-details\"></button>\r\n    </div>\r\n    ${node.properties ? `\r\n      <div class=\"details-properties\">\r\n        ${Object.entries(node.properties).map(([key, value]) => `\r\n          <div class=\"property\">\r\n            <span class=\"property-key\">${escapeHtml(key)}:</span>\r\n            <span class=\"property-value\">${escapeHtml(String(value))}</span>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  const closeBtn = detailsContainer.querySelector('.close-details');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => {\r\n      detailsContainer.style.display = 'none';\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Load graph stats\r\n */\r\nasync function loadStats(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const stats = await graphService.getStats();\r\n    renderStats(container, stats);\r\n  } catch {\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Render stats\r\n */\r\nfunction renderStats(container: HTMLElement, stats: GraphStats): void {\r\n  container.innerHTML = `\r\n    <div class=\"stat-item\">\r\n      <span class=\"stat-value\">${stats.nodeCount}</span>\r\n      <span class=\"stat-label\">Nodes</span>\r\n    </div>\r\n    <div class=\"stat-item\">\r\n      <span class=\"stat-value\">${stats.edgeCount}</span>\r\n      <span class=\"stat-label\">Edges</span>\r\n    </div>\r\n    ${stats.nodeTypes ? Object.entries(stats.nodeTypes).map(([type, count]) => `\r\n      <div class=\"stat-item type-${type.toLowerCase()}\">\r\n        <span class=\"stat-value\">${count}</span>\r\n        <span class=\"stat-label\">${type}</span>\r\n      </div>\r\n    `).join('') : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createKnowledgeGraph;\r\n","/**\r\n * Timeline Component\r\n * Vertical timeline with events\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { timelineService, TimelineEvent } from '../services/graph';\r\nimport { formatRelativeTime, formatDate } from '../utils/format';\r\n\r\nexport interface TimelineProps {\r\n  days?: number;\r\n  onEventClick?: (event: TimelineEvent) => void;\r\n}\r\n\r\n/**\r\n * Create timeline component\r\n */\r\nexport function createTimeline(props: TimelineProps = {}): HTMLElement {\r\n  const { days = 30 } = props;\r\n\r\n  const container = createElement('div', { className: 'timeline-container' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"timeline-header\">\r\n      <h3>Timeline</h3>\r\n      <select id=\"timeline-days\" class=\"filter-select\">\r\n        <option value=\"7\" ${days === 7 ? 'selected' : ''}>Last 7 days</option>\r\n        <option value=\"14\" ${days === 14 ? 'selected' : ''}>Last 14 days</option>\r\n        <option value=\"30\" ${days === 30 ? 'selected' : ''}>Last 30 days</option>\r\n        <option value=\"90\" ${days === 90 ? 'selected' : ''}>Last 90 days</option>\r\n      </select>\r\n    </div>\r\n    <div class=\"timeline-filters\">\r\n      <button class=\"filter-btn active\" data-type=\"all\">All</button>\r\n      <button class=\"filter-btn\" data-type=\"document\">Documents</button>\r\n      <button class=\"filter-btn\" data-type=\"question\">Questions</button>\r\n      <button class=\"filter-btn\" data-type=\"decision\">Decisions</button>\r\n      <button class=\"filter-btn\" data-type=\"risk\">Risks</button>\r\n    </div>\r\n    <div class=\"timeline-content\" id=\"timeline-content\">\r\n      <div class=\"loading\">Loading timeline...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const daysSelect = container.querySelector('#timeline-days') as HTMLSelectElement;\r\n  on(daysSelect, 'change', () => {\r\n    loadTimeline(container, parseInt(daysSelect.value), props);\r\n  });\r\n\r\n  const filterBtns = container.querySelectorAll('.filter-btn');\r\n  filterBtns.forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      filterBtns.forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n      filterEvents(container, btn.getAttribute('data-type') || 'all');\r\n    });\r\n  });\r\n\r\n  // Initial load\r\n  loadTimeline(container, days, props);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load timeline events\r\n */\r\nasync function loadTimeline(container: HTMLElement, days: number, props: TimelineProps): Promise<void> {\r\n  const content = container.querySelector('#timeline-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const data = await timelineService.getAll({ limit: days * 10 }); // Approximate events per day\r\n    renderTimeline(content, data.events || [], props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load timeline</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render timeline\r\n */\r\nfunction renderTimeline(container: HTMLElement, events: TimelineEvent[], props: TimelineProps): void {\r\n  if (events.length === 0) {\r\n    container.innerHTML = '<div class=\"empty-state\">No events in this period</div>';\r\n    return;\r\n  }\r\n\r\n  // Group by date\r\n  const grouped = groupByDate(events);\r\n\r\n  container.innerHTML = `\r\n    <div class=\"timeline\">\r\n      ${Object.entries(grouped).map(([date, dayEvents]) => `\r\n        <div class=\"timeline-day\">\r\n          <div class=\"timeline-date\">${formatDate(date)}</div>\r\n          ${dayEvents.map(event => `\r\n            <div class=\"timeline-event\" data-type=\"${event.type}\" data-id=\"${event.id}\">\r\n              <div class=\"event-marker ${event.type}\"></div>\r\n              <div class=\"event-content\">\r\n                <div class=\"event-header\">\r\n                  <span class=\"event-type\">${event.type}</span>\r\n                  <span class=\"event-time\">${formatTime(event.date)}</span>\r\n                </div>\r\n                <div class=\"event-title\">${escapeHtml(event.title)}</div>\r\n                ${event.description ? `<div class=\"event-description\">${escapeHtml(event.description)}</div>` : ''}\r\n                ${event.user ? `<div class=\"event-user\">by ${escapeHtml(event.user)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.timeline-event').forEach(el => {\r\n    on(el as HTMLElement, 'click', () => {\r\n      const id = el.getAttribute('data-id');\r\n      const event = events.find(e => String(e.id) === id);\r\n      if (event && props.onEventClick) {\r\n        props.onEventClick(event);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Group events by date\r\n */\r\nfunction groupByDate(events: TimelineEvent[]): Record<string, TimelineEvent[]> {\r\n  const grouped: Record<string, TimelineEvent[]> = {};\r\n  \r\n  events.forEach(event => {\r\n    const date = event.date.split('T')[0];\r\n    if (!grouped[date]) grouped[date] = [];\r\n    grouped[date].push(event);\r\n  });\r\n\r\n  // Sort by date descending\r\n  return Object.fromEntries(\r\n    Object.entries(grouped).sort(([a], [b]) => b.localeCompare(a))\r\n  );\r\n}\r\n\r\n/**\r\n * Filter events by type\r\n */\r\nfunction filterEvents(container: HTMLElement, type: string): void {\r\n  const events = container.querySelectorAll('.timeline-event');\r\n  events.forEach(el => {\r\n    if (type === 'all' || el.getAttribute('data-type') === type) {\r\n      (el as HTMLElement).style.display = '';\r\n    } else {\r\n      (el as HTMLElement).style.display = 'none';\r\n    }\r\n  });\r\n\r\n  // Hide empty days\r\n  container.querySelectorAll('.timeline-day').forEach(day => {\r\n    const visibleEvents = day.querySelectorAll('.timeline-event:not([style*=\"display: none\"])');\r\n    (day as HTMLElement).style.display = visibleEvents.length > 0 ? '' : 'none';\r\n  });\r\n}\r\n\r\n/**\r\n * Format time\r\n */\r\nfunction formatTime(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createTimeline;\r\n","/**\r\n * TimelinePanel - SOTA Timeline Component\r\n * \r\n * Features:\r\n * - Sticky date headers\r\n * - \"Today\" line marker\r\n * - Density toggle (compact, comfortable, spacious)\r\n * - Rich event cards with avatars, icons, status badges\r\n * - Relative time formatting with tooltip\r\n * - In-timeline search\r\n * - Keyboard navigation (J/K, Enter, /, Esc)\r\n * - Type filters with counts\r\n * - Skeleton loading\r\n * - Empty states with illustrations\r\n * - Export options\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { getTimeline, TimelineEvent, TimelineData } from '../services/graph';\r\nimport { formatRelativeTime, formatDate, formatDateTime } from '../utils/format';\r\n\r\n// ============================================\r\n// TYPES\r\n// ============================================\r\n\r\nexport interface TimelinePanelProps {\r\n  onEventClick?: (event: TimelineEvent) => void;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\ninterface EventTypeConfig {\r\n  label: string;\r\n  icon: string;\r\n  color: string;\r\n}\r\n\r\ntype Density = 'compact' | 'comfortable' | 'spacious';\r\n\r\n// ============================================\r\n// CONSTANTS\r\n// ============================================\r\n\r\nconst EVENT_TYPES: Record<string, EventTypeConfig> = {\r\n  document: { label: 'Documents', icon: '', color: '#1abc9c' },\r\n  transcript: { label: 'Transcripts', icon: '', color: '#8b5cf6' },\r\n  email: { label: 'Emails', icon: '', color: '#6366f1' },\r\n  conversation: { label: 'Conversations', icon: '', color: '#ec4899' },\r\n  chat_session: { label: 'Chat Sessions', icon: '', color: '#0ea5e9' },\r\n  fact: { label: 'Facts', icon: '', color: '#3b82f6' },\r\n  question: { label: 'Questions', icon: '', color: '#f59e0b' },\r\n  question_answered: { label: 'Answered', icon: '', color: '#10b981' },\r\n  decision: { label: 'Decisions', icon: '', color: '#3498db' },\r\n  risk: { label: 'Risks', icon: '', color: '#f39c12' },\r\n  action: { label: 'Actions', icon: '', color: '#9b59b6' },\r\n  action_completed: { label: 'Completed', icon: '', color: '#2ecc71' },\r\n  deadline: { label: 'Deadlines', icon: '', color: '#9b59b6' },\r\n};\r\n\r\nconst DAY_PERIODS = [\r\n  { label: 'Last 7 days', days: 7 },\r\n  { label: 'Last 14 days', days: 14 },\r\n  { label: 'Last 30 days', days: 30 },\r\n  { label: 'Last 90 days', days: 90 },\r\n  { label: 'All time', days: 365 },\r\n];\r\n\r\n// ============================================\r\n// STATE\r\n// ============================================\r\n\r\nlet currentDays = 30;\r\nlet currentDensity: Density = 'comfortable';\r\nlet currentTypeFilters: string[] = [];\r\nlet currentSearch = '';\r\nlet allEvents: TimelineEvent[] = [];\r\nlet focusedEventIndex = -1;\r\n\r\n// ============================================\r\n// MAIN COMPONENT\r\n// ============================================\r\n\r\n/**\r\n * Create SOTA Timeline Panel\r\n */\r\nexport function createTimelinePanel(props: TimelinePanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'timeline-panel sot-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Timeline</h2>\r\n        <span class=\"panel-count\" id=\"timeline-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <div class=\"timeline-search-wrapper\">\r\n          <input type=\"text\" id=\"timeline-search\" class=\"timeline-search\" placeholder=\"Search events...\" />\r\n        </div>\r\n        <select id=\"timeline-period\" class=\"filter-select\">\r\n          ${DAY_PERIODS.map(p => `<option value=\"${p.days}\" ${p.days === currentDays ? 'selected' : ''}>${p.label}</option>`).join('')}\r\n        </select>\r\n        <div class=\"density-toggle\" title=\"View density\">\r\n          <button class=\"density-btn ${currentDensity === 'compact' ? 'active' : ''}\" data-density=\"compact\" title=\"Compact\"></button>\r\n          <button class=\"density-btn ${currentDensity === 'comfortable' ? 'active' : ''}\" data-density=\"comfortable\" title=\"Comfortable\"></button>\r\n          <button class=\"density-btn ${currentDensity === 'spacious' ? 'active' : ''}\" data-density=\"spacious\" title=\"Spacious\"></button>\r\n        </div>\r\n        <div class=\"timeline-actions-menu\">\r\n          <button class=\"btn btn-secondary btn-sm timeline-export-btn\" title=\"Export\"></button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"timeline-filters\" id=\"timeline-type-filters\">\r\n      <button class=\"filter-chip active\" data-type=\"\">All</button>\r\n    </div>\r\n    <div class=\"timeline-content\" id=\"timeline-content\">\r\n      ${renderSkeletons()}\r\n    </div>\r\n    <div class=\"timeline-footer\" id=\"timeline-footer\" style=\"display:none;\">\r\n      <button class=\"btn btn-secondary btn-sm\" id=\"timeline-load-more\">Load more</button>\r\n    </div>\r\n  `;\r\n\r\n  bindEvents(panel, props);\r\n  loadTimeline(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n// ============================================\r\n// EVENT BINDING\r\n// ============================================\r\n\r\nfunction bindEvents(panel: HTMLElement, props: TimelinePanelProps): void {\r\n  // Period selector\r\n  const periodSelect = panel.querySelector('#timeline-period') as HTMLSelectElement;\r\n  on(periodSelect, 'change', () => {\r\n    currentDays = parseInt(periodSelect.value);\r\n    loadTimeline(panel, props);\r\n  });\r\n\r\n  // Density toggle\r\n  const densityBtns = panel.querySelectorAll('.density-btn');\r\n  densityBtns.forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      densityBtns.forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n      currentDensity = btn.getAttribute('data-density') as Density;\r\n      updateDensity(panel);\r\n    });\r\n  });\r\n\r\n  // Search\r\n  const searchInput = panel.querySelector('#timeline-search') as HTMLInputElement;\r\n  let searchTimeout: ReturnType<typeof setTimeout>;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = setTimeout(() => {\r\n      currentSearch = searchInput.value.toLowerCase();\r\n      renderFilteredEvents(panel, props);\r\n    }, 200);\r\n  });\r\n\r\n  // Export\r\n  const exportBtn = panel.querySelector('.timeline-export-btn');\r\n  if (exportBtn) {\r\n    on(exportBtn as HTMLElement, 'click', () => showExportMenu(panel));\r\n  }\r\n\r\n  // Keyboard navigation\r\n  on(panel, 'keydown', (e: KeyboardEvent) => {\r\n    const content = panel.querySelector('#timeline-content');\r\n    if (!content) return;\r\n\r\n    if (e.key === 'j' || e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      navigateEvents(panel, 1, props);\r\n    } else if (e.key === 'k' || e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      navigateEvents(panel, -1, props);\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      selectFocusedEvent(panel, props);\r\n    } else if (e.key === '/') {\r\n      e.preventDefault();\r\n      searchInput.focus();\r\n    } else if (e.key === 'Escape') {\r\n      searchInput.blur();\r\n      focusedEventIndex = -1;\r\n      clearEventFocus(panel);\r\n    }\r\n  });\r\n\r\n  // Make panel focusable for keyboard events\r\n  panel.setAttribute('tabindex', '0');\r\n}\r\n\r\n// ============================================\r\n// DATA LOADING\r\n// ============================================\r\n\r\nasync function loadTimeline(panel: HTMLElement, props: TimelinePanelProps): Promise<void> {\r\n  const content = panel.querySelector('#timeline-content') as HTMLElement;\r\n  content.innerHTML = renderSkeletons();\r\n\r\n  try {\r\n    const endDate = new Date();\r\n    const startDate = new Date();\r\n    startDate.setDate(startDate.getDate() - currentDays);\r\n\r\n    const data: TimelineData = await getTimeline({\r\n      startDate: startDate.toISOString().split('T')[0],\r\n      endDate: endDate.toISOString().split('T')[0],\r\n      limit: 500,\r\n    });\r\n\r\n    allEvents = data.events || [];\r\n    updateTypeCounts(panel, allEvents);\r\n    renderFilteredEvents(panel, props);\r\n    updateCount(panel, allEvents.length);\r\n  } catch (error) {\r\n    console.error('Failed to load timeline:', error);\r\n    content.innerHTML = renderError();\r\n  }\r\n}\r\n\r\n// ============================================\r\n// RENDERING\r\n// ============================================\r\n\r\nfunction renderFilteredEvents(panel: HTMLElement, props: TimelinePanelProps): void {\r\n  let filtered = [...allEvents];\r\n\r\n  // Apply type filter\r\n  if (currentTypeFilters.length > 0) {\r\n    filtered = filtered.filter(e => currentTypeFilters.includes(e.type));\r\n  }\r\n\r\n  // Apply search filter\r\n  if (currentSearch) {\r\n    filtered = filtered.filter(e => {\r\n      const title = (e.title || '').toLowerCase();\r\n      const content = (e.content || e.description || '').toLowerCase();\r\n      const owner = (e.owner || e.user || e.actor || '').toLowerCase();\r\n      return title.includes(currentSearch) || content.includes(currentSearch) || owner.includes(currentSearch);\r\n    });\r\n  }\r\n\r\n  const content = panel.querySelector('#timeline-content') as HTMLElement;\r\n\r\n  if (filtered.length === 0) {\r\n    content.innerHTML = renderEmptyState();\r\n    return;\r\n  }\r\n\r\n  // Group by date\r\n  const grouped = groupByDate(filtered);\r\n  const today = new Date().toISOString().split('T')[0];\r\n\r\n  content.innerHTML = `\r\n    <div class=\"timeline-list density-${currentDensity}\">\r\n      ${Object.entries(grouped).map(([date, events]) => `\r\n        <div class=\"timeline-day\" data-date=\"${date}\">\r\n          <div class=\"timeline-date-header sticky\">\r\n            <span class=\"date-label\">${formatDateLabel(date)}</span>\r\n            <span class=\"event-count\">${events.length} event${events.length === 1 ? '' : 's'}</span>\r\n          </div>\r\n          ${date === today ? '<div class=\"today-marker\"><span>Today</span></div>' : ''}\r\n          <div class=\"timeline-day-events\">\r\n            ${events.map((event, idx) => renderEventCard(event, idx)).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  bindEventCardClicks(panel, filtered, props);\r\n  focusedEventIndex = -1;\r\n}\r\n\r\nfunction renderEventCard(event: TimelineEvent, index: number): string {\r\n  const config = EVENT_TYPES[event.type] || { label: event.type, icon: '', color: '#888' };\r\n  const icon = event.icon || config.icon;\r\n  const color = event.color || config.color;\r\n  const owner = event.owner || event.user || event.actor;\r\n  const initials = owner ? getInitials(owner) : '';\r\n  const statusBadge = event.status ? `<span class=\"status-badge status-${event.status}\">${event.status}</span>` : '';\r\n  const time = event.date ? formatTime(event.date) : '';\r\n  const relativeTime = event.date ? formatRelativeTime(event.date) : '';\r\n  const fullDateTime = event.date ? formatDateTime(event.date) : '';\r\n\r\n  return `\r\n    <div class=\"timeline-event\" data-id=\"${event.id}\" data-index=\"${index}\" tabindex=\"0\">\r\n      <div class=\"event-avatar\" style=\"background: ${color}20; color: ${color};\">\r\n        ${initials || icon}\r\n      </div>\r\n      <div class=\"event-body\">\r\n        <div class=\"event-header\">\r\n          <span class=\"event-type-badge\" style=\"background: ${color}20; color: ${color};\">\r\n            <span class=\"type-icon\">${icon}</span>\r\n            ${config.label}\r\n          </span>\r\n          ${statusBadge}\r\n          <span class=\"event-time\" title=\"${fullDateTime}\">${relativeTime}</span>\r\n        </div>\r\n        <div class=\"event-title\">${escapeHtml(event.title)}</div>\r\n        ${event.content || event.description ? `<div class=\"event-content\">${escapeHtml(truncate(event.content || event.description || '', 150))}</div>` : ''}\r\n        ${owner ? `<div class=\"event-owner\"><span class=\"owner-name\">by ${escapeHtml(owner)}</span></div>` : ''}\r\n      </div>\r\n      <div class=\"event-meta\">\r\n        <span class=\"meta-time\">${time}</span>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderSkeletons(): string {\r\n  const skeletonCount = 8;\r\n  return `\r\n    <div class=\"timeline-skeletons\">\r\n      ${Array(skeletonCount).fill(0).map(() => `\r\n        <div class=\"skeleton-event\">\r\n          <div class=\"skeleton-avatar shimmer\"></div>\r\n          <div class=\"skeleton-body\">\r\n            <div class=\"skeleton-line short shimmer\"></div>\r\n            <div class=\"skeleton-line long shimmer\"></div>\r\n            <div class=\"skeleton-line medium shimmer\"></div>\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderEmptyState(): string {\r\n  return `\r\n    <div class=\"timeline-empty\">\r\n      <div class=\"empty-illustration\">\r\n        <svg width=\"120\" height=\"120\" viewBox=\"0 0 120 120\" fill=\"none\">\r\n          <circle cx=\"60\" cy=\"60\" r=\"50\" fill=\"var(--bg-card)\" stroke=\"var(--border)\" stroke-width=\"2\"/>\r\n          <path d=\"M60 30V60L80 75\" stroke=\"var(--accent)\" stroke-width=\"4\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          <circle cx=\"60\" cy=\"60\" r=\"6\" fill=\"var(--accent)\"/>\r\n        </svg>\r\n      </div>\r\n      <h3>No events found</h3>\r\n      <p>Try adjusting your filters or date range</p>\r\n      <div class=\"empty-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"empty-clear-filters\">Clear Filters</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderError(): string {\r\n  return `\r\n    <div class=\"timeline-error\">\r\n      <div class=\"error-icon\"></div>\r\n      <h3>Failed to load timeline</h3>\r\n      <p>Please try again later</p>\r\n      <button class=\"btn btn-primary btn-sm\" id=\"timeline-retry\">Retry</button>\r\n    </div>\r\n  `;\r\n}\r\n\r\n// ============================================\r\n// TYPE FILTERS\r\n// ============================================\r\n\r\nfunction updateTypeCounts(panel: HTMLElement, events: TimelineEvent[]): void {\r\n  const counts: Record<string, number> = {};\r\n  events.forEach(e => {\r\n    counts[e.type] = (counts[e.type] || 0) + 1;\r\n  });\r\n\r\n  const container = panel.querySelector('#timeline-type-filters') as HTMLElement;\r\n  const typesWithEvents = Object.keys(counts).filter(type => counts[type] > 0);\r\n\r\n  container.innerHTML = `\r\n    <button class=\"filter-chip ${currentTypeFilters.length === 0 ? 'active' : ''}\" data-type=\"\">All (${events.length})</button>\r\n    ${typesWithEvents.map(type => {\r\n      const config = EVENT_TYPES[type] || { label: type, icon: '', color: '#888' };\r\n      const isActive = currentTypeFilters.includes(type);\r\n      return `\r\n        <button class=\"filter-chip ${isActive ? 'active' : ''}\" data-type=\"${type}\" style=\"--chip-color: ${config.color}\">\r\n          ${config.icon} ${config.label} (${counts[type]})\r\n        </button>\r\n      `;\r\n    }).join('')}\r\n  `;\r\n\r\n  // Bind filter clicks\r\n  const chips = container.querySelectorAll('.filter-chip');\r\n  chips.forEach(chip => {\r\n    on(chip as HTMLElement, 'click', () => {\r\n      const type = chip.getAttribute('data-type') || '';\r\n      if (!type) {\r\n        currentTypeFilters = [];\r\n        chips.forEach(c => c.classList.remove('active'));\r\n        chip.classList.add('active');\r\n      } else {\r\n        const allChip = container.querySelector('[data-type=\"\"]');\r\n        allChip?.classList.remove('active');\r\n\r\n        if (currentTypeFilters.includes(type)) {\r\n          currentTypeFilters = currentTypeFilters.filter(t => t !== type);\r\n          chip.classList.remove('active');\r\n        } else {\r\n          currentTypeFilters.push(type);\r\n          chip.classList.add('active');\r\n        }\r\n\r\n        if (currentTypeFilters.length === 0) {\r\n          allChip?.classList.add('active');\r\n        }\r\n      }\r\n      renderFilteredEvents(panel, {});\r\n    });\r\n  });\r\n}\r\n\r\n// ============================================\r\n// NAVIGATION & INTERACTION\r\n// ============================================\r\n\r\nfunction bindEventCardClicks(panel: HTMLElement, events: TimelineEvent[], props: TimelinePanelProps): void {\r\n  const cards = panel.querySelectorAll('.timeline-event');\r\n  cards.forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const event = events.find(e => String(e.id) === id);\r\n      if (event && props.onEventClick) {\r\n        props.onEventClick(event);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Clear filters button in empty state\r\n  const clearBtn = panel.querySelector('#empty-clear-filters');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      currentTypeFilters = [];\r\n      currentSearch = '';\r\n      const searchInput = panel.querySelector('#timeline-search') as HTMLInputElement;\r\n      if (searchInput) searchInput.value = '';\r\n      updateTypeCounts(panel, allEvents);\r\n      renderFilteredEvents(panel, props);\r\n    });\r\n  }\r\n\r\n  // Retry button in error state\r\n  const retryBtn = panel.querySelector('#timeline-retry');\r\n  if (retryBtn) {\r\n    on(retryBtn as HTMLElement, 'click', () => loadTimeline(panel, props));\r\n  }\r\n}\r\n\r\nfunction navigateEvents(panel: HTMLElement, direction: number, props: TimelinePanelProps): void {\r\n  const cards = panel.querySelectorAll('.timeline-event');\r\n  if (cards.length === 0) return;\r\n\r\n  clearEventFocus(panel);\r\n  focusedEventIndex = Math.max(0, Math.min(cards.length - 1, focusedEventIndex + direction));\r\n  \r\n  const targetCard = cards[focusedEventIndex] as HTMLElement;\r\n  if (targetCard) {\r\n    targetCard.classList.add('focused');\r\n    targetCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n    targetCard.focus();\r\n  }\r\n}\r\n\r\nfunction selectFocusedEvent(panel: HTMLElement, props: TimelinePanelProps): void {\r\n  const cards = panel.querySelectorAll('.timeline-event');\r\n  if (focusedEventIndex >= 0 && focusedEventIndex < cards.length) {\r\n    const card = cards[focusedEventIndex] as HTMLElement;\r\n    card.click();\r\n  }\r\n}\r\n\r\nfunction clearEventFocus(panel: HTMLElement): void {\r\n  panel.querySelectorAll('.timeline-event.focused').forEach(el => el.classList.remove('focused'));\r\n}\r\n\r\nfunction updateDensity(panel: HTMLElement): void {\r\n  const list = panel.querySelector('.timeline-list');\r\n  if (list) {\r\n    list.className = `timeline-list density-${currentDensity}`;\r\n  }\r\n}\r\n\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#timeline-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n// ============================================\r\n// EXPORT MENU\r\n// ============================================\r\n\r\nfunction showExportMenu(panel: HTMLElement): void {\r\n  const existing = panel.querySelector('.export-menu');\r\n  if (existing) {\r\n    existing.remove();\r\n    return;\r\n  }\r\n\r\n  const menu = createElement('div', { className: 'export-menu dropdown-menu' });\r\n  menu.innerHTML = `\r\n    <button class=\"dropdown-item\" data-format=\"csv\"> Export CSV</button>\r\n    <button class=\"dropdown-item\" data-format=\"json\"> Export JSON</button>\r\n  `;\r\n\r\n  const exportBtn = panel.querySelector('.timeline-export-btn');\r\n  if (exportBtn) {\r\n    exportBtn.appendChild(menu);\r\n  }\r\n\r\n  menu.querySelectorAll('.dropdown-item').forEach(item => {\r\n    on(item as HTMLElement, 'click', () => {\r\n      const format = item.getAttribute('data-format');\r\n      exportTimeline(format || 'csv');\r\n      menu.remove();\r\n    });\r\n  });\r\n\r\n  // Close on outside click\r\n  setTimeout(() => {\r\n    const closeHandler = (e: Event) => {\r\n      if (!menu.contains(e.target as Node)) {\r\n        menu.remove();\r\n        document.removeEventListener('click', closeHandler);\r\n      }\r\n    };\r\n    document.addEventListener('click', closeHandler);\r\n  }, 0);\r\n}\r\n\r\nfunction exportTimeline(format: string): void {\r\n  const data = allEvents.map(e => ({\r\n    date: e.date,\r\n    type: e.type,\r\n    title: e.title,\r\n    content: e.content || e.description,\r\n    owner: e.owner || e.user || e.actor,\r\n    status: e.status,\r\n  }));\r\n\r\n  let content: string;\r\n  let filename: string;\r\n  let mimeType: string;\r\n\r\n  if (format === 'csv') {\r\n    const headers = ['Date', 'Type', 'Title', 'Content', 'Owner', 'Status'];\r\n    const rows = data.map(d => [\r\n      d.date, d.type, `\"${(d.title || '').replace(/\"/g, '\"\"')}\"`,\r\n      `\"${(d.content || '').replace(/\"/g, '\"\"')}\"`,\r\n      `\"${(d.owner || '').replace(/\"/g, '\"\"')}\"`, d.status || ''\r\n    ].join(','));\r\n    content = [headers.join(','), ...rows].join('\\n');\r\n    filename = `timeline-${new Date().toISOString().split('T')[0]}.csv`;\r\n    mimeType = 'text/csv';\r\n  } else {\r\n    content = JSON.stringify(data, null, 2);\r\n    filename = `timeline-${new Date().toISOString().split('T')[0]}.json`;\r\n    mimeType = 'application/json';\r\n  }\r\n\r\n  const blob = new Blob([content], { type: mimeType });\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = filename;\r\n  a.click();\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\n// ============================================\r\n// UTILITIES\r\n// ============================================\r\n\r\nfunction groupByDate(events: TimelineEvent[]): Record<string, TimelineEvent[]> {\r\n  const grouped: Record<string, TimelineEvent[]> = {};\r\n  \r\n  events.forEach(event => {\r\n    const date = event.date ? event.date.split('T')[0] : 'unknown';\r\n    if (!grouped[date]) grouped[date] = [];\r\n    grouped[date].push(event);\r\n  });\r\n\r\n  // Sort by date descending\r\n  return Object.fromEntries(\r\n    Object.entries(grouped).sort(([a], [b]) => b.localeCompare(a))\r\n  );\r\n}\r\n\r\nfunction formatDateLabel(dateStr: string): string {\r\n  const date = new Date(dateStr + 'T00:00:00');\r\n  const today = new Date();\r\n  const yesterday = new Date(today);\r\n  yesterday.setDate(yesterday.getDate() - 1);\r\n  const thisWeekStart = new Date(today);\r\n  thisWeekStart.setDate(today.getDate() - today.getDay());\r\n\r\n  const todayStr = today.toISOString().split('T')[0];\r\n  const yesterdayStr = yesterday.toISOString().split('T')[0];\r\n\r\n  if (dateStr === todayStr) return 'Today';\r\n  if (dateStr === yesterdayStr) return 'Yesterday';\r\n  if (date >= thisWeekStart) return 'This week - ' + formatDate(date, { weekday: 'long' });\r\n\r\n  return formatDate(date, { weekday: 'short', month: 'short', day: 'numeric' });\r\n}\r\n\r\nfunction formatTime(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(/\\s+/)\r\n    .map(part => part.charAt(0).toUpperCase())\r\n    .slice(0, 2)\r\n    .join('');\r\n}\r\n\r\nfunction truncate(text: string, maxLength: number): string {\r\n  if (text.length <= maxLength) return text;\r\n  return text.slice(0, maxLength - 3) + '...';\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createTimelinePanel;\r\n","/**\r\n * Costs Dashboard Component\r\n * LLM costs tracking and visualization\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { createModal, openModal, closeModal } from './Modal';\r\nimport { costsService, CostSummary, RecentCostRequest } from '../services/graph';\r\nimport { formatCurrency, formatNumber } from '../utils/format';\r\nimport { toast } from '../services/toast';\r\n\r\nconst BUDGET_MODAL_ID = 'costs-budget-modal';\r\n\r\nexport interface CostsDashboardProps {\r\n  period?: 'day' | 'week' | 'month' | 'all';\r\n}\r\n\r\n/**\r\n * Create costs dashboard component\r\n */\r\nexport function createCostsDashboard(props: CostsDashboardProps = {}): HTMLElement {\r\n  const { period = 'month' } = props;\r\n\r\n  const container = createElement('div', { className: 'costs-dashboard' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"costs-header\">\r\n      <div class=\"costs-header-title\">\r\n        <h3>LLM Costs</h3>\r\n        <span class=\"costs-period-range\" id=\"costs-period-range\" aria-live=\"polite\"></span>\r\n      </div>\r\n      <div class=\"costs-header-actions\">\r\n        <select id=\"costs-period\" class=\"filter-select\" aria-label=\"Time period\">\r\n          <option value=\"day\" ${period === 'day' ? 'selected' : ''}>Today</option>\r\n          <option value=\"week\" ${period === 'week' ? 'selected' : ''}>This Week</option>\r\n          <option value=\"month\" ${period === 'month' ? 'selected' : ''}>This Month</option>\r\n          <option value=\"all\" ${period === 'all' ? 'selected' : ''}>All Time</option>\r\n        </select>\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-export-btn\" title=\"Export CSV or JSON\">Export</button>\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-pricing-btn\" title=\"View pricing table\">Pricing</button>\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-budget-btn\" title=\"Set budget and alert\">Budget</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"costs-content\" id=\"costs-content\">\r\n      <div class=\"loading\">Loading costs...</div>\r\n    </div>\r\n    <div id=\"costs-pricing-panel\" class=\"costs-pricing-panel hidden\" aria-hidden=\"true\"></div>\r\n  `;\r\n\r\n  // Bind events\r\n  const periodSelect = container.querySelector('#costs-period') as HTMLSelectElement;\r\n  on(periodSelect, 'change', () => {\r\n    loadCosts(container, periodSelect.value as 'day' | 'week' | 'month' | 'all');\r\n  });\r\n  const exportBtn = container.querySelector('#costs-export-btn');\r\n  if (exportBtn) {\r\n    on(exportBtn, 'click', () => handleExport(periodSelect.value as 'day' | 'week' | 'month' | 'all'));\r\n  }\r\n  const pricingBtn = container.querySelector('#costs-pricing-btn');\r\n  const pricingPanel = container.querySelector('#costs-pricing-panel') as HTMLElement;\r\n  if (pricingBtn && pricingPanel) {\r\n    on(pricingBtn, 'click', () => togglePricingPanel(pricingPanel));\r\n  }\r\n  on(container, 'click', (e: Event) => {\r\n    if ((e.target as HTMLElement).id === 'costs-pricing-close') {\r\n      pricingPanel?.classList.add('hidden');\r\n      pricingPanel?.setAttribute('aria-hidden', 'true');\r\n    }\r\n  });\r\n  const budgetBtn = container.querySelector('#costs-budget-btn');\r\n  if (budgetBtn) {\r\n    on(budgetBtn, 'click', () => showBudgetModal(container, periodSelect));\r\n  }\r\n\r\n  // Initial load\r\n  loadCosts(container, period);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load costs data\r\n */\r\nasync function loadCosts(container: HTMLElement, period: 'day' | 'week' | 'month' | 'all'): Promise<void> {\r\n  const content = container.querySelector('#costs-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const [data, recentRequests] = await Promise.all([\r\n      costsService.getSummary(period),\r\n      costsService.getRecentRequests(20),\r\n    ]);\r\n    renderCosts(content, data, recentRequests);\r\n    const periodRangeEl = container.querySelector('#costs-period-range');\r\n    if (periodRangeEl) periodRangeEl.textContent = formatPeriod(data.period ?? { start: '', end: '' });\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load costs</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render costs\r\n */\r\nfunction renderCosts(\r\n  container: HTMLElement,\r\n  data: CostSummary,\r\n  recentRequests: RecentCostRequest[] = []\r\n): void {\r\n  const dailyBreakdown = data.dailyBreakdown ?? [];\r\n  const byProvider = data.byProvider ?? {};\r\n  const byModel = data.byModel ?? {};\r\n  const totalCalls = dailyBreakdown.reduce((sum, d) => sum + (d.calls ?? 0), 0);\r\n  const avgPerCall = totalCalls > 0 ? data.total / totalCalls : 0;\r\n\r\n  // Convert records to arrays for rendering (normalize empty operation keys to \"other\")\r\n  const byProviderArray = Object.entries(byProvider)\r\n    .map(([provider, cost]) => ({ provider, cost }))\r\n    .sort((a, b) => b.cost - a.cost);\r\n  const byModelArray = Object.entries(byModel)\r\n    .map(([model, cost]) => ({ model, cost }))\r\n    .sort((a, b) => b.cost - a.cost);\r\n  const byOperationMap = new Map<string, number>();\r\n  for (const [op, cost] of Object.entries(data.byOperation || {})) {\r\n    const key = (op && String(op).trim()) ? String(op).trim() : 'other';\r\n    byOperationMap.set(key, (byOperationMap.get(key) ?? 0) + cost);\r\n  }\r\n  const byOperationArray = Array.from(byOperationMap.entries())\r\n    .map(([operation, cost]) => ({ operation, cost }))\r\n    .sort((a, b) => b.cost - a.cost);\r\n  // By context: sort by cost desc, show \"unknown\" as \"Other\"\r\n  const byContextArray = Object.entries(data.byContext || {})\r\n    .map(([ctx, cost]) => ({ context: (ctx === 'unknown' || !ctx?.trim()) ? 'Other' : ctx, cost }))\r\n    .sort((a, b) => b.cost - a.cost);\r\n  const totalInput = data.totalInputTokens ?? 0;\r\n  const totalOutput = data.totalOutputTokens ?? 0;\r\n  const hasNoData =\r\n    (data.total ?? 0) === 0 &&\r\n    dailyBreakdown.length === 0 &&\r\n    Object.keys(byProvider).length === 0 &&\r\n    Object.keys(byModel).length === 0;\r\n  const periodChangeHtml =\r\n    data.previousPeriodCost != null && data.percentChange != null\r\n      ? `<div class=\"card-sub period-change ${data.percentChange >= 0 ? 'up' : 'down'}\">vs previous period: ${data.percentChange >= 0 ? '+' : ''}${data.percentChange.toFixed(1)}%</div>`\r\n      : '';\r\n\r\n  const budgetHtml =\r\n    data.budgetLimit != null && data.budgetUsedPercent != null\r\n      ? `\r\n    <div class=\"costs-budget-bar ${data.budgetAlertTriggered ? 'alert' : ''}\">\r\n      <div class=\"costs-budget-bar-fill\" style=\"width: ${Math.min(100, data.budgetUsedPercent)}%\"></div>\r\n      <span class=\"costs-budget-label\">${formatCurrency(data.total)} / ${formatCurrency(data.budgetLimit)} (${data.budgetUsedPercent}%)</span>\r\n      ${data.budgetAlertTriggered ? '<span class=\"costs-budget-alert\">Alert threshold reached</span>' : ''}\r\n    </div>`\r\n      : !hasNoData\r\n      ? '<div class=\"costs-budget-bar costs-budget-bar-empty\"><span class=\"costs-budget-label\">No budget set</span><span class=\"costs-budget-set-hint\">Use the Budget button above to set a limit.</span></div>'\r\n      : '';\r\n\r\n  const emptyStateHtml =\r\n    hasNoData\r\n      ? '<div class=\"costs-empty-state\">No cost data for this period. LLM usage from Chat, document processing, and other features will appear here.</div>'\r\n      : '';\r\n\r\n  container.innerHTML = `\r\n    <div class=\"costs-dashboard-row\">\r\n      <div class=\"costs-stats-grid stats-grid\">\r\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-total\">\r\n          <div class=\"stat-value\">${formatCurrency(data.total)}</div>\r\n          <div class=\"stat-label\">Total Cost</div>\r\n          ${periodChangeHtml}\r\n        </div>\r\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-calls\">\r\n          <div class=\"stat-value\">${formatNumber(totalCalls)}</div>\r\n          <div class=\"stat-label\">API Calls</div>\r\n        </div>\r\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-avg\">\r\n          <div class=\"stat-value\">${formatCurrency(avgPerCall)}</div>\r\n          <div class=\"stat-label\">Avg per Call</div>\r\n        </div>\r\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-input\">\r\n          <div class=\"stat-value\">${formatNumber(totalInput)}</div>\r\n          <div class=\"stat-label\">Input Tokens</div>\r\n        </div>\r\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-output\">\r\n          <div class=\"stat-value\">${formatNumber(totalOutput)}</div>\r\n          <div class=\"stat-label\">Output Tokens</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    ${budgetHtml}\r\n    ${emptyStateHtml}\r\n\r\n    <div class=\"costs-chart-section chart-container\">\r\n      <h4 class=\"costs-chart-title\">Daily Costs</h4>\r\n      <div class=\"costs-chart-inner\">\r\n        ${renderDailyChart(dailyBreakdown, data.period ?? { start: '', end: '' })}\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"costs-breakdown\">\r\n      <div class=\"breakdown-section\">\r\n        <h4>By Provider</h4>\r\n        <div class=\"breakdown-list\">\r\n          ${byProviderArray.length > 0 ? byProviderArray.map(p => `\r\n            <div class=\"breakdown-item\">\r\n              <span class=\"item-name\">${escapeHtml(p.provider)}</span>\r\n              <span class=\"item-value\">${formatCurrency(p.cost)}</span>\r\n            </div>\r\n          `).join('') : '<div class=\"empty\">No data</div>'}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"breakdown-section\">\r\n        <h4>By Model</h4>\r\n        <div class=\"breakdown-list\">\r\n          ${byModelArray.length > 0 ? byModelArray.map(m => `\r\n            <div class=\"breakdown-item\">\r\n              <span class=\"item-name\">${escapeHtml(m.model)}</span>\r\n              <span class=\"item-value\">${formatCurrency(m.cost)}</span>\r\n            </div>\r\n          `).join('') : '<div class=\"empty\">No data</div>'}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"breakdown-section\">\r\n        <h4>By Operation</h4>\r\n        <div class=\"breakdown-list\">\r\n          ${byOperationArray.length > 0 ? byOperationArray.map(o => `\r\n            <div class=\"breakdown-item\">\r\n              <span class=\"item-name\">${escapeHtml(o.operation)}</span>\r\n              <span class=\"item-value\">${formatCurrency(o.cost)}</span>\r\n            </div>\r\n          `).join('') : '<div class=\"empty\">No data</div>'}\r\n        </div>\r\n      </div>\r\n\r\n      ${byContextArray.length > 0 ? `\r\n      <div class=\"breakdown-section\">\r\n        <h4>By Context</h4>\r\n        <div class=\"breakdown-list\">\r\n          ${byContextArray.map(c => `\r\n            <div class=\"breakdown-item\">\r\n              <span class=\"item-name\">${escapeHtml(c.context)}</span>\r\n              <span class=\"item-value\">${formatCurrency(c.cost)}</span>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n      ` : ''}\r\n    </div>\r\n\r\n    <div class=\"costs-recent-section\">\r\n      <h4>Recent Requests <span class=\"costs-recent-caption\">(last 20, all time)</span></h4>\r\n      ${renderRecentRequests(recentRequests)}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render recent requests table\r\n */\r\nfunction renderRecentRequests(requests: RecentCostRequest[]): string {\r\n  if (!requests.length) {\r\n    return '<div class=\"empty-recent\">No recent requests</div>';\r\n  }\r\n  return `\r\n    <div class=\"costs-recent-table-wrap\">\r\n      <table class=\"costs-recent-table\" aria-label=\"Recent LLM requests\">\r\n        <thead>\r\n          <tr>\r\n            <th>Time</th>\r\n            <th>Provider / Model</th>\r\n            <th>Operation</th>\r\n            <th>Tokens</th>\r\n            <th>Cost</th>\r\n            <th>Latency</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          ${requests\r\n            .slice(0, 20)\r\n            .map(\r\n              (r) => `\r\n            <tr>\r\n              <td>${formatRequestTime(r.timestamp)}</td>\r\n              <td>${escapeHtml(r.provider)} / ${escapeHtml(r.model)}</td>\r\n              <td>${escapeHtml(r.request_type || r.operation || '')}</td>\r\n              <td>${(r.input_tokens ?? 0)}+${r.output_tokens ?? 0}</td>\r\n              <td>${r.cost != null ? formatCurrency(r.cost) : ''}</td>\r\n              <td>${r.latency_ms != null ? `${r.latency_ms}ms` : ''}</td>\r\n            </tr>\r\n          `\r\n            )\r\n            .join('')}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction formatRequestTime(iso: string): string {\r\n  const d = new Date(iso);\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - d.getTime();\r\n  if (diffMs < 60000) return 'Just now';\r\n  if (diffMs < 3600000) return `${Math.floor(diffMs / 60000)}m ago`;\r\n  if (diffMs < 86400000) return `${Math.floor(diffMs / 3600000)}h ago`;\r\n  return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });\r\n}\r\n\r\n/**\r\n * Export costs as CSV or JSON (user chooses via prompt)\r\n */\r\nasync function handleExport(period: 'day' | 'week' | 'month' | 'all'): Promise<void> {\r\n  const format = window.confirm('Download as JSON?\\n\\nCancel = CSV, OK = JSON') ? 'json' : 'csv';\r\n  const ext = format === 'json' ? 'json' : 'csv';\r\n  const url = `/api/costs/export?period=${period}&format=${format}`;\r\n  try {\r\n    const res = await fetch(url, { credentials: 'include' });\r\n    if (!res.ok) throw new Error(res.statusText);\r\n    const blob = await res.blob();\r\n    const name = `llm-costs-${period}-${new Date().toISOString().split('T')[0]}.${ext}`;\r\n    const a = document.createElement('a');\r\n    a.href = URL.createObjectURL(blob);\r\n    a.download = name;\r\n    a.click();\r\n    URL.revokeObjectURL(a.href);\r\n  } catch (e) {\r\n    console.error('Export failed:', e);\r\n    alert('Export failed. Try again.');\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle pricing panel (fetch on first open)\r\n */\r\nasync function togglePricingPanel(panel: HTMLElement): Promise<void> {\r\n  const isHidden = panel.classList.contains('hidden');\r\n  if (isHidden && !panel.innerHTML.trim()) {\r\n    panel.innerHTML = '<div class=\"loading\">Loading pricing...</div>';\r\n    panel.classList.remove('hidden');\r\n    panel.setAttribute('aria-hidden', 'false');\r\n    try {\r\n      const pricing = await costsService.getPricing();\r\n      panel.innerHTML = renderPricingTable(pricing);\r\n    } catch {\r\n      panel.innerHTML = '<div class=\"error\">Failed to load pricing</div>';\r\n    }\r\n  } else {\r\n    panel.classList.toggle('hidden');\r\n    panel.setAttribute('aria-hidden', String(panel.classList.contains('hidden')));\r\n  }\r\n}\r\n\r\nasync function showBudgetModal(container: HTMLElement, periodSelect: HTMLSelectElement): Promise<void> {\r\n  const period = periodSelect.value as 'day' | 'week' | 'month' | 'all';\r\n  const budgetPeriod: 'week' | 'month' =\r\n    period === 'week' ? 'week' : period === 'month' ? 'month' : 'month';\r\n\r\n  const existing = document.querySelector(`[data-modal-id=\"${BUDGET_MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  let currentLimit = 100;\r\n  let currentThreshold = 80;\r\n  try {\r\n    const budget = await costsService.getBudget(budgetPeriod);\r\n    if (budget?.limitUsd != null && budget.limitUsd > 0) currentLimit = budget.limitUsd;\r\n    if (budget?.alertThresholdPercent != null) currentThreshold = Math.min(100, Math.max(0, budget.alertThresholdPercent));\r\n  } catch {\r\n    // use defaults\r\n  }\r\n\r\n  const body = createElement('div', { className: 'costs-budget-modal-body' });\r\n  body.innerHTML = `\r\n    <p class=\"costs-budget-modal-desc\">Set a ${budgetPeriod}ly spending limit and get an alert when usage reaches a percentage of that limit.</p>\r\n    <div class=\"form-group\">\r\n      <label for=\"costs-budget-limit\">Budget limit (USD)</label>\r\n      <input type=\"number\" id=\"costs-budget-limit\" class=\"form-input\" min=\"1\" max=\"999999\" step=\"0.01\" value=\"${currentLimit}\" placeholder=\"e.g. 100\" aria-label=\"Budget limit in USD\">\r\n      <span class=\"form-hint\">Min 1 USD</span>\r\n    </div>\r\n    <div class=\"form-group\">\r\n      <label for=\"costs-budget-threshold\">Alert when usage reaches (%)</label>\r\n      <input type=\"number\" id=\"costs-budget-threshold\" class=\"form-input\" min=\"0\" max=\"100\" value=\"${currentThreshold}\" placeholder=\"e.g. 80\" aria-label=\"Alert threshold percentage\">\r\n      <span class=\"form-hint\">0100%</span>\r\n    </div>\r\n    <p class=\"costs-budget-modal-hint\" role=\"status\">You will be notified when LLM costs reach this percentage of your budget.</p>\r\n  `;\r\n\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n  const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\r\n  const saveBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save budget' });\r\n\r\n  const modal = createModal({\r\n    id: BUDGET_MODAL_ID,\r\n    title: `Set ${budgetPeriod === 'week' ? 'weekly' : 'monthly'} budget`,\r\n    content: body,\r\n    size: 'md',\r\n    closable: true,\r\n    footer,\r\n  });\r\n\r\n  modal.classList.add('costs-budget-modal');\r\n\r\n  const hintEl = body.querySelector('.costs-budget-modal-hint') as HTMLElement;\r\n\r\n  on(cancelBtn, 'click', () => closeModal(BUDGET_MODAL_ID));\r\n  on(saveBtn, 'click', async () => {\r\n    const limitEl = body.querySelector('#costs-budget-limit') as HTMLInputElement;\r\n    const thresholdEl = body.querySelector('#costs-budget-threshold') as HTMLInputElement;\r\n    const limitUsd = limitEl ? parseFloat(limitEl.value) : NaN;\r\n    const thresholdRaw = thresholdEl != null ? parseInt(thresholdEl.value, 10) : NaN;\r\n    const threshold = Number.isFinite(thresholdRaw) ? Math.min(100, Math.max(0, thresholdRaw)) : 80;\r\n\r\n    hintEl.textContent = 'You will be notified when LLM costs reach this percentage of your budget.';\r\n    if (!Number.isFinite(limitUsd) || limitUsd < 1) {\r\n      hintEl.textContent = 'Enter a valid budget (min 1 USD).';\r\n      hintEl.classList.add('costs-budget-modal-hint-error');\r\n      limitEl?.focus();\r\n      return;\r\n    }\r\n    if (!Number.isFinite(thresholdRaw) || thresholdRaw < 0 || thresholdRaw > 100) {\r\n      hintEl.textContent = 'Alert threshold must be between 0 and 100%.';\r\n      hintEl.classList.add('costs-budget-modal-hint-error');\r\n      thresholdEl?.focus();\r\n      return;\r\n    }\r\n    hintEl.classList.remove('costs-budget-modal-hint-error');\r\n    saveBtn.setAttribute('disabled', 'true');\r\n    saveBtn.textContent = 'Saving';\r\n    try {\r\n      await costsService.setBudget(budgetPeriod, limitUsd, threshold);\r\n      closeModal(BUDGET_MODAL_ID);\r\n      loadCosts(container, periodSelect.value as 'day' | 'week' | 'month' | 'all');\r\n      toast.success('Budget saved');\r\n    } catch (e) {\r\n      console.error('Set budget failed:', e);\r\n      hintEl.textContent = 'Failed to save. Please try again.';\r\n      hintEl.classList.add('costs-budget-modal-hint-error');\r\n      toast.error('Failed to save budget');\r\n    } finally {\r\n      saveBtn.removeAttribute('disabled');\r\n      saveBtn.textContent = 'Save budget';\r\n    }\r\n  });\r\n\r\n  footer.append(cancelBtn, saveBtn);\r\n  document.body.appendChild(modal);\r\n  openModal(BUDGET_MODAL_ID);\r\n}\r\n\r\nfunction renderPricingTable(rows: Array<{ model: string; inputPer1M: number; outputPer1M: number }>): string {\r\n  if (!rows.length) return '<div class=\"empty\">No pricing data</div>';\r\n  return `\r\n    <div class=\"costs-pricing-header\">\r\n      <h4>Model pricing (USD per 1M tokens)</h4>\r\n      <button type=\"button\" class=\"btn btn-sm\" id=\"costs-pricing-close\" aria-label=\"Close\"></button>\r\n    </div>\r\n    <div class=\"costs-pricing-table-wrap\">\r\n      <table class=\"costs-pricing-table\">\r\n        <thead>\r\n          <tr>\r\n            <th>Model</th>\r\n            <th>Input</th>\r\n            <th>Output</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          ${rows\r\n            .map(\r\n              (r) => `\r\n            <tr>\r\n              <td>${escapeHtml(r.model)}</td>\r\n              <td>$${r.inputPer1M.toFixed(2)}</td>\r\n              <td>$${r.outputPer1M.toFixed(2)}</td>\r\n            </tr>\r\n          `\r\n            )\r\n            .join('')}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Build skeleton daily array for period so chart always shows structure\r\n */\r\nfunction skeletonDailyForPeriod(period: { start: string; end: string }): Array<{ date: string; cost: number; calls: number }> {\r\n  const days = 14;\r\n  const result: Array<{ date: string; cost: number; calls: number }> = [];\r\n  const d = new Date();\r\n  for (let i = days - 1; i >= 0; i--) {\r\n    const date = new Date(d);\r\n    date.setDate(date.getDate() - i);\r\n    result.push({\r\n      date: date.toISOString().split('T')[0],\r\n      cost: 0,\r\n      calls: 0,\r\n    });\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * Render daily costs chart. When no data, show skeleton bars so chart area is visible.\r\n */\r\nfunction renderDailyChart(\r\n  daily: Array<{ date: string; cost: number; calls: number }>,\r\n  period?: { start: string; end: string }\r\n): string {\r\n  const chartDaily = daily.length > 0 ? daily : skeletonDailyForPeriod(period ?? { start: '', end: '' });\r\n  const maxCost = Math.max(1e-9, ...chartDaily.map(d => d.cost));\r\n  const isPlaceholder = daily.length === 0;\r\n\r\n  return `\r\n    <div class=\"daily-chart\">\r\n      <div class=\"chart-bars\">\r\n        ${chartDaily.map(d => {\r\n          const height = maxCost > 0 ? Math.max(2, (d.cost / maxCost) * 100) : 2;\r\n          return `\r\n            <div class=\"bar-column\" title=\"${d.date}: ${formatCurrency(d.cost)} (${d.calls} calls)\">\r\n              <div class=\"bar ${isPlaceholder && d.cost === 0 ? 'bar-placeholder' : ''}\" style=\"height: ${height}%\"></div>\r\n              <div class=\"bar-label\">${formatDateShort(d.date)}</div>\r\n            </div>\r\n          `;\r\n        }).join('')}\r\n      </div>\r\n      ${isPlaceholder ? '<p class=\"chart-placeholder-hint\">No cost data for this period. Usage will appear here as you use LLM features.</p>' : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Format period display\r\n */\r\nfunction formatPeriod(period: { start: string; end: string }): string {\r\n  if (!period.start || !period.end) return 'All time';\r\n  \r\n  const start = new Date(period.start);\r\n  const end = new Date(period.end);\r\n  \r\n  const formatDate = (d: Date) => d.toLocaleDateString(undefined, { \r\n    month: 'short', \r\n    day: 'numeric' \r\n  });\r\n  \r\n  return `${formatDate(start)} - ${formatDate(end)}`;\r\n}\r\n\r\n/**\r\n * Format date short\r\n */\r\nfunction formatDateShort(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createCostsDashboard;\r\n","/**\r\n * Global Search Component\r\n * Command palette style search (Cmd+K / Ctrl+K)\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { shortcuts } from '../services/shortcuts';\r\n\r\nexport interface GlobalSearchProps {\r\n  onResultClick?: (result: SearchResult) => void;\r\n}\r\n\r\nexport interface SearchResult {\r\n  id: string;\r\n  type: 'question' | 'risk' | 'action' | 'decision' | 'contact' | 'document' | 'email' | 'fact';\r\n  title: string;\r\n  subtitle?: string;\r\n  icon?: string;\r\n  url?: string;\r\n}\r\n\r\ninterface SearchResponse {\r\n  results: SearchResult[];\r\n  total: number;\r\n}\r\n\r\nlet isOpen = false;\r\nlet currentQuery = '';\r\nlet selectedIndex = 0;\r\nlet results: SearchResult[] = [];\r\n\r\nconst TYPE_ICONS: Record<string, string> = {\r\n  question: '',\r\n  risk: '',\r\n  action: '',\r\n  decision: '',\r\n  contact: '',\r\n  document: '',\r\n  email: '',\r\n  fact: '',\r\n};\r\n\r\n/**\r\n * Initialize global search\r\n */\r\nexport function initGlobalSearch(props: GlobalSearchProps = {}): void {\r\n  // Create modal if not exists\r\n  let modal = document.getElementById('global-search-modal');\r\n  if (!modal) {\r\n    modal = createSearchModal(props);\r\n    document.body.appendChild(modal);\r\n  }\r\n\r\n  // Register keyboard shortcut\r\n  shortcuts.register('mod+k', (e) => {\r\n    e.preventDefault();\r\n    toggleSearch();\r\n  });\r\n\r\n  // Also register / for quick search\r\n  shortcuts.register('/', (e) => {\r\n    // Only if not in an input\r\n    if (document.activeElement?.tagName !== 'INPUT' && \r\n        document.activeElement?.tagName !== 'TEXTAREA') {\r\n      e.preventDefault();\r\n      toggleSearch();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Create search modal\r\n */\r\nfunction createSearchModal(props: GlobalSearchProps): HTMLElement {\r\n  const modal = createElement('div', {\r\n    id: 'global-search-modal',\r\n    className: 'global-search-modal',\r\n  });\r\n  modal.style.display = 'none';\r\n\r\n  modal.innerHTML = `\r\n    <div class=\"search-backdrop\"></div>\r\n    <div class=\"search-dialog\">\r\n      <div class=\"search-input-wrapper\">\r\n        <span class=\"search-icon\"></span>\r\n        <input type=\"text\" id=\"global-search-input\" class=\"search-input\" \r\n               placeholder=\"Search questions, risks, contacts...\" autocomplete=\"off\">\r\n        <kbd class=\"search-shortcut\">ESC</kbd>\r\n      </div>\r\n      <div class=\"search-results\" id=\"search-results\">\r\n        <div class=\"search-hint\">\r\n          <p>Start typing to search...</p>\r\n          <div class=\"search-tips\">\r\n            <span><kbd></kbd> Navigate</span>\r\n            <span><kbd>Enter</kbd> Select</span>\r\n            <span><kbd>ESC</kbd> Close</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"search-footer\">\r\n        <span>Type to search</span>\r\n        <span>Press <kbd>?</kbd> for more shortcuts</span>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backdrop = modal.querySelector('.search-backdrop') as HTMLElement;\r\n  const input = modal.querySelector('#global-search-input') as HTMLInputElement;\r\n  const resultsContainer = modal.querySelector('#search-results') as HTMLElement;\r\n\r\n  // Close on backdrop click\r\n  on(backdrop, 'click', closeSearch);\r\n\r\n  // Input events\r\n  on(input, 'input', () => {\r\n    currentQuery = input.value;\r\n    selectedIndex = 0;\r\n    debounceSearch(resultsContainer, props);\r\n  });\r\n\r\n  on(input, 'keydown', (e) => {\r\n    handleKeydown(e, resultsContainer, props);\r\n  });\r\n\r\n  return modal;\r\n}\r\n\r\n/**\r\n * Toggle search visibility\r\n */\r\nexport function toggleSearch(): void {\r\n  if (isOpen) {\r\n    closeSearch();\r\n  } else {\r\n    openSearch();\r\n  }\r\n}\r\n\r\n/**\r\n * Open search\r\n */\r\nexport function openSearch(): void {\r\n  const modal = document.getElementById('global-search-modal');\r\n  if (!modal) return;\r\n\r\n  isOpen = true;\r\n  modal.style.display = 'block';\r\n  \r\n  const input = modal.querySelector('#global-search-input') as HTMLInputElement;\r\n  input.value = '';\r\n  input.focus();\r\n  \r\n  currentQuery = '';\r\n  results = [];\r\n  selectedIndex = 0;\r\n\r\n  // Reset results\r\n  const resultsContainer = modal.querySelector('#search-results') as HTMLElement;\r\n  resultsContainer.innerHTML = `\r\n    <div class=\"search-hint\">\r\n      <p>Start typing to search...</p>\r\n      <div class=\"search-tips\">\r\n        <span><kbd></kbd> Navigate</span>\r\n        <span><kbd>Enter</kbd> Select</span>\r\n        <span><kbd>ESC</kbd> Close</span>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Add escape listener\r\n  document.addEventListener('keydown', handleEscape);\r\n}\r\n\r\n/**\r\n * Close search\r\n */\r\nexport function closeSearch(): void {\r\n  const modal = document.getElementById('global-search-modal');\r\n  if (!modal) return;\r\n\r\n  isOpen = false;\r\n  modal.style.display = 'none';\r\n  \r\n  document.removeEventListener('keydown', handleEscape);\r\n}\r\n\r\n/**\r\n * Handle escape key\r\n */\r\nfunction handleEscape(e: KeyboardEvent): void {\r\n  if (e.key === 'Escape') {\r\n    closeSearch();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle keyboard navigation\r\n */\r\nfunction handleKeydown(e: KeyboardEvent, container: HTMLElement, props: GlobalSearchProps): void {\r\n  switch (e.key) {\r\n    case 'ArrowDown':\r\n      e.preventDefault();\r\n      selectedIndex = Math.min(selectedIndex + 1, results.length - 1);\r\n      updateSelection(container);\r\n      break;\r\n    case 'ArrowUp':\r\n      e.preventDefault();\r\n      selectedIndex = Math.max(selectedIndex - 1, 0);\r\n      updateSelection(container);\r\n      break;\r\n    case 'Enter':\r\n      e.preventDefault();\r\n      const selected = results[selectedIndex];\r\n      if (selected) {\r\n        selectResult(selected, props);\r\n      }\r\n      break;\r\n    case 'Escape':\r\n      closeSearch();\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Update selection highlight\r\n */\r\nfunction updateSelection(container: HTMLElement): void {\r\n  const items = container.querySelectorAll('.search-result');\r\n  items.forEach((item, i) => {\r\n    item.classList.toggle('selected', i === selectedIndex);\r\n    if (i === selectedIndex) {\r\n      item.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Debounced search\r\n */\r\nlet searchTimeout: number;\r\nfunction debounceSearch(container: HTMLElement, props: GlobalSearchProps): void {\r\n  clearTimeout(searchTimeout);\r\n  searchTimeout = window.setTimeout(() => {\r\n    performSearch(container, props);\r\n  }, 200);\r\n}\r\n\r\n/**\r\n * Perform search\r\n */\r\nasync function performSearch(container: HTMLElement, props: GlobalSearchProps): Promise<void> {\r\n  if (!currentQuery.trim()) {\r\n    container.innerHTML = `\r\n      <div class=\"search-hint\">\r\n        <p>Start typing to search...</p>\r\n        <div class=\"search-tips\">\r\n          <span><kbd></kbd> Navigate</span>\r\n          <span><kbd>Enter</kbd> Select</span>\r\n          <span><kbd>ESC</kbd> Close</span>\r\n        </div>\r\n      </div>\r\n    `;\r\n    results = [];\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = '<div class=\"search-loading\">Searching...</div>';\r\n\r\n  try {\r\n    const response = await http.get<SearchResponse>(\r\n      `/api/search?q=${encodeURIComponent(currentQuery)}&limit=10`\r\n    );\r\n    results = response.data.results || [];\r\n    \r\n    renderResults(container, results, props);\r\n  } catch {\r\n    // Fallback to local search if API fails\r\n    results = performLocalSearch(currentQuery);\r\n    renderResults(container, results, props);\r\n  }\r\n}\r\n\r\n/**\r\n * Local fallback search\r\n */\r\nfunction performLocalSearch(query: string): SearchResult[] {\r\n  // TODO: Search local stores\r\n  return [];\r\n}\r\n\r\n/**\r\n * Render results\r\n */\r\nfunction renderResults(container: HTMLElement, results: SearchResult[], props: GlobalSearchProps): void {\r\n  if (results.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"search-empty\">\r\n        <p>No results found for \"${escapeHtml(currentQuery)}\"</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  // Group by type\r\n  const grouped = groupByType(results);\r\n\r\n  container.innerHTML = Object.entries(grouped).map(([type, items]) => `\r\n    <div class=\"search-group\">\r\n      <div class=\"group-label\">${capitalize(type)}s</div>\r\n      ${items.map((result, i) => `\r\n        <div class=\"search-result ${i === selectedIndex ? 'selected' : ''}\" data-index=\"${results.indexOf(result)}\">\r\n          <span class=\"result-icon\">${TYPE_ICONS[result.type] || ''}</span>\r\n          <div class=\"result-content\">\r\n            <div class=\"result-title\">${escapeHtml(result.title)}</div>\r\n            ${result.subtitle ? `<div class=\"result-subtitle\">${escapeHtml(result.subtitle)}</div>` : ''}\r\n          </div>\r\n          <span class=\"result-type\">${result.type}</span>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.search-result').forEach(el => {\r\n    on(el as HTMLElement, 'click', () => {\r\n      const index = parseInt(el.getAttribute('data-index') || '0');\r\n      const result = results[index];\r\n      if (result) {\r\n        selectResult(result, props);\r\n      }\r\n    });\r\n\r\n    on(el as HTMLElement, 'mouseenter', () => {\r\n      const index = parseInt(el.getAttribute('data-index') || '0');\r\n      selectedIndex = index;\r\n      updateSelection(container);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Select result\r\n */\r\nfunction selectResult(result: SearchResult, props: GlobalSearchProps): void {\r\n  closeSearch();\r\n  \r\n  if (props.onResultClick) {\r\n    props.onResultClick(result);\r\n  } else {\r\n    // Default navigation\r\n    navigateToResult(result);\r\n  }\r\n}\r\n\r\n/**\r\n * Navigate to result\r\n */\r\nfunction navigateToResult(result: SearchResult): void {\r\n  // Dispatch custom event for navigation\r\n  window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n    detail: { type: result.type, id: result.id }\r\n  }));\r\n}\r\n\r\n/**\r\n * Group results by type\r\n */\r\nfunction groupByType(results: SearchResult[]): Record<string, SearchResult[]> {\r\n  const grouped: Record<string, SearchResult[]> = {};\r\n  results.forEach(r => {\r\n    if (!grouped[r.type]) grouped[r.type] = [];\r\n    grouped[r.type].push(r);\r\n  });\r\n  return grouped;\r\n}\r\n\r\n/**\r\n * Capitalize\r\n */\r\nfunction capitalize(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default initGlobalSearch;\r\n","/**\r\n * Bulk Actions Component\r\n * Selection management and bulk operations\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { undoManager } from '../services/undo';\r\n\r\nexport interface BulkActionsProps {\r\n  type: 'questions' | 'risks' | 'actions' | 'decisions' | 'contacts' | 'documents';\r\n  onComplete?: () => void;\r\n}\r\n\r\ninterface BulkOperation {\r\n  type: string;\r\n  ids: string[];\r\n  action: string;\r\n  data?: Record<string, unknown>;\r\n}\r\n\r\nlet selectedIds: Set<string> = new Set();\r\n\r\n/**\r\n * Create bulk actions bar\r\n */\r\nexport function createBulkActionsBar(props: BulkActionsProps): HTMLElement {\r\n  const bar = createElement('div', { className: 'bulk-actions-bar' });\r\n  bar.style.display = 'none';\r\n\r\n  bar.innerHTML = `\r\n    <div class=\"bulk-info\">\r\n      <span class=\"bulk-count\">0</span> selected\r\n    </div>\r\n    <div class=\"bulk-buttons\">\r\n      ${getActionsForType(props.type)}\r\n      <button class=\"btn btn-sm btn-secondary\" id=\"bulk-clear\">Clear</button>\r\n    </div>\r\n  `;\r\n\r\n  // Bind clear\r\n  const clearBtn = bar.querySelector('#bulk-clear');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      clearSelection();\r\n      updateBar(bar);\r\n    });\r\n  }\r\n\r\n  // Bind actions\r\n  bindActionButtons(bar, props);\r\n\r\n  return bar;\r\n}\r\n\r\n/**\r\n * Get action buttons for type\r\n */\r\nfunction getActionsForType(type: string): string {\r\n  const common = `\r\n    <button class=\"btn btn-sm btn-danger\" id=\"bulk-delete\">Delete</button>\r\n  `;\r\n\r\n  switch (type) {\r\n    case 'questions':\r\n      return `\r\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"resolved\">Mark Resolved</button>\r\n        <button class=\"btn btn-sm\" id=\"bulk-assign\">Assign To...</button>\r\n        ${common}\r\n      `;\r\n    case 'actions':\r\n      return `\r\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"completed\">Mark Complete</button>\r\n        <button class=\"btn btn-sm\" id=\"bulk-assign\">Assign To...</button>\r\n        ${common}\r\n      `;\r\n    case 'risks':\r\n      return `\r\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"mitigated\">Mark Mitigated</button>\r\n        ${common}\r\n      `;\r\n    case 'decisions':\r\n      return `\r\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"approved\">Approve</button>\r\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"rejected\">Reject</button>\r\n        ${common}\r\n      `;\r\n    default:\r\n      return common;\r\n  }\r\n}\r\n\r\n/**\r\n * Bind action buttons\r\n */\r\nfunction bindActionButtons(bar: HTMLElement, props: BulkActionsProps): void {\r\n  // Delete\r\n  const deleteBtn = bar.querySelector('#bulk-delete');\r\n  if (deleteBtn) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm(`Delete ${selectedIds.size} items?`)) return;\r\n      \r\n      await performBulkAction({\r\n        type: props.type,\r\n        ids: Array.from(selectedIds),\r\n        action: 'delete',\r\n      }, props);\r\n    });\r\n  }\r\n\r\n  // Status change\r\n  const statusBtns = bar.querySelectorAll('[id^=\"bulk-status\"]');\r\n  statusBtns.forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const status = btn.getAttribute('data-status');\r\n      if (!status) return;\r\n\r\n      await performBulkAction({\r\n        type: props.type,\r\n        ids: Array.from(selectedIds),\r\n        action: 'status',\r\n        data: { status },\r\n      }, props);\r\n    });\r\n  });\r\n\r\n  // Assign\r\n  const assignBtn = bar.querySelector('#bulk-assign');\r\n  if (assignBtn) {\r\n    on(assignBtn as HTMLElement, 'click', () => {\r\n      const assignee = prompt('Assign to:');\r\n      if (!assignee) return;\r\n\r\n      performBulkAction({\r\n        type: props.type,\r\n        ids: Array.from(selectedIds),\r\n        action: 'assign',\r\n        data: { assignee },\r\n      }, props);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Perform bulk action\r\n */\r\nasync function performBulkAction(operation: BulkOperation, props: BulkActionsProps): Promise<void> {\r\n  try {\r\n    let endpoint = '';\r\n    let body: Record<string, unknown> = { type: operation.type, ids: operation.ids };\r\n\r\n    switch (operation.action) {\r\n      case 'delete':\r\n        endpoint = '/api/bulk/delete';\r\n        break;\r\n      case 'status':\r\n        endpoint = '/api/bulk/status';\r\n        body = { ...body, status: operation.data?.status };\r\n        break;\r\n      case 'assign':\r\n        endpoint = '/api/bulk/assign';\r\n        body = { ...body, assignee: operation.data?.assignee };\r\n        break;\r\n    }\r\n\r\n    const response = await http.post<{ actionId?: string; affected: number }>(endpoint, body);\r\n    \r\n    // Register for undo if supported\r\n    if (response.data.actionId) {\r\n      undoManager.push({\r\n        type: `bulk-${operation.action}`,\r\n        description: `${operation.action} ${operation.ids.length} items`,\r\n        undo: async () => {\r\n          await http.post(`/api/undo/${response.data.actionId}`);\r\n          props.onComplete?.();\r\n        },\r\n      });\r\n    }\r\n\r\n    toast.success(`Updated ${response.data.affected || operation.ids.length} items`);\r\n    clearSelection();\r\n    props.onComplete?.();\r\n  } catch {\r\n    toast.error('Bulk operation failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle item selection\r\n */\r\nexport function toggleSelection(id: string, bar: HTMLElement): void {\r\n  if (selectedIds.has(id)) {\r\n    selectedIds.delete(id);\r\n  } else {\r\n    selectedIds.add(id);\r\n  }\r\n  updateBar(bar);\r\n}\r\n\r\n/**\r\n * Select item\r\n */\r\nexport function selectItem(id: string, bar: HTMLElement): void {\r\n  selectedIds.add(id);\r\n  updateBar(bar);\r\n}\r\n\r\n/**\r\n * Deselect item\r\n */\r\nexport function deselectItem(id: string, bar: HTMLElement): void {\r\n  selectedIds.delete(id);\r\n  updateBar(bar);\r\n}\r\n\r\n/**\r\n * Clear selection\r\n */\r\nexport function clearSelection(): void {\r\n  selectedIds.clear();\r\n  // Update checkboxes in DOM\r\n  document.querySelectorAll('.bulk-checkbox:checked').forEach(cb => {\r\n    (cb as HTMLInputElement).checked = false;\r\n  });\r\n}\r\n\r\n/**\r\n * Get selected IDs\r\n */\r\nexport function getSelectedIds(): string[] {\r\n  return Array.from(selectedIds);\r\n}\r\n\r\n/**\r\n * Is item selected\r\n */\r\nexport function isSelected(id: string): boolean {\r\n  return selectedIds.has(id);\r\n}\r\n\r\n/**\r\n * Update bar visibility and count\r\n */\r\nfunction updateBar(bar: HTMLElement): void {\r\n  const count = selectedIds.size;\r\n  \r\n  bar.style.display = count > 0 ? 'flex' : 'none';\r\n  \r\n  const countEl = bar.querySelector('.bulk-count');\r\n  if (countEl) {\r\n    countEl.textContent = String(count);\r\n  }\r\n}\r\n\r\n/**\r\n * Create checkbox for bulk selection\r\n */\r\nexport function createBulkCheckbox(id: string, bar: HTMLElement): HTMLElement {\r\n  const checkbox = createElement('input', {\r\n    type: 'checkbox',\r\n    className: 'bulk-checkbox',\r\n  }) as HTMLInputElement;\r\n  checkbox.setAttribute('data-id', id);\r\n  checkbox.checked = isSelected(id);\r\n\r\n  on(checkbox, 'change', (e) => {\r\n    e.stopPropagation();\r\n    toggleSelection(id, bar);\r\n    checkbox.checked = isSelected(id);\r\n  });\r\n\r\n  return checkbox;\r\n}\r\n\r\nexport default createBulkActionsBar;\r\n","/**\r\n * Sync Status Component\r\n * Shows synchronization status and dead letters\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface SyncStatusProps {\r\n  showDetails?: boolean;\r\n}\r\n\r\ninterface SyncState {\r\n  connected: boolean;\r\n  lastSync: string | null;\r\n  pendingCount: number;\r\n  errorCount: number;\r\n}\r\n\r\ninterface DeadLetter {\r\n  id: string;\r\n  type: string;\r\n  payload: unknown;\r\n  error: string;\r\n  failedAt: string;\r\n  retryCount: number;\r\n}\r\n\r\n/**\r\n * Create sync status component\r\n */\r\nexport function createSyncStatus(props: SyncStatusProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'sync-status' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"sync-indicator\" id=\"sync-indicator\">\r\n      <span class=\"sync-icon\"></span>\r\n      <span class=\"sync-text\">Checking...</span>\r\n    </div>\r\n    ${props.showDetails ? `\r\n      <div class=\"sync-details\" id=\"sync-details\" style=\"display: none;\">\r\n        <div class=\"sync-info\"></div>\r\n        <div class=\"dead-letters\"></div>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  const indicator = container.querySelector('#sync-indicator') as HTMLElement;\r\n  \r\n  // Toggle details on click\r\n  if (props.showDetails) {\r\n    on(indicator, 'click', () => {\r\n      const details = container.querySelector('#sync-details') as HTMLElement;\r\n      const isVisible = details.style.display !== 'none';\r\n      details.style.display = isVisible ? 'none' : 'block';\r\n      if (!isVisible) {\r\n        loadSyncDetails(container);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initial check\r\n  checkSyncStatus(container);\r\n\r\n  // Periodic refresh\r\n  setInterval(() => checkSyncStatus(container), 30000);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Check sync status\r\n */\r\nasync function checkSyncStatus(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<SyncState>('/api/sync/status');\r\n    updateIndicator(container, response.data);\r\n  } catch {\r\n    updateIndicator(container, {\r\n      connected: false,\r\n      lastSync: null,\r\n      pendingCount: 0,\r\n      errorCount: 0,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Update indicator\r\n */\r\nfunction updateIndicator(container: HTMLElement, state: SyncState): void {\r\n  const icon = container.querySelector('.sync-icon') as HTMLElement;\r\n  const text = container.querySelector('.sync-text') as HTMLElement;\r\n  const indicator = container.querySelector('.sync-indicator') as HTMLElement;\r\n\r\n  if (!state.connected) {\r\n    icon.textContent = '';\r\n    text.textContent = 'Disconnected';\r\n    indicator.classList.remove('synced', 'syncing');\r\n    indicator.classList.add('error');\r\n  } else if (state.pendingCount > 0) {\r\n    icon.textContent = '';\r\n    text.textContent = `Syncing (${state.pendingCount})`;\r\n    indicator.classList.remove('synced', 'error');\r\n    indicator.classList.add('syncing');\r\n  } else if (state.errorCount > 0) {\r\n    icon.textContent = '!';\r\n    text.textContent = `${state.errorCount} errors`;\r\n    indicator.classList.remove('synced', 'syncing');\r\n    indicator.classList.add('error');\r\n  } else {\r\n    icon.textContent = '';\r\n    text.textContent = state.lastSync ? formatRelativeTime(state.lastSync) : 'Synced';\r\n    indicator.classList.remove('syncing', 'error');\r\n    indicator.classList.add('synced');\r\n  }\r\n}\r\n\r\n/**\r\n * Load sync details\r\n */\r\nasync function loadSyncDetails(container: HTMLElement): Promise<void> {\r\n  const infoContainer = container.querySelector('.sync-info') as HTMLElement;\r\n  const deadLettersContainer = container.querySelector('.dead-letters') as HTMLElement;\r\n\r\n  infoContainer.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    // Get sync status\r\n    const statusResponse = await http.get<SyncState>('/api/sync/status');\r\n    const state = statusResponse.data;\r\n\r\n    infoContainer.innerHTML = `\r\n      <div class=\"info-grid\">\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Status</span>\r\n          <span class=\"info-value ${state.connected ? 'success' : 'error'}\">\r\n            ${state.connected ? 'Connected' : 'Disconnected'}\r\n          </span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Last Sync</span>\r\n          <span class=\"info-value\">${state.lastSync ? formatRelativeTime(state.lastSync) : 'Never'}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Pending</span>\r\n          <span class=\"info-value\">${state.pendingCount}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Errors</span>\r\n          <span class=\"info-value ${state.errorCount > 0 ? 'error' : ''}\">${state.errorCount}</span>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Get dead letters\r\n    const deadLettersResponse = await http.get<{ deadLetters: DeadLetter[] }>('/api/sync/dead-letters');\r\n    const deadLetters = deadLettersResponse.data.deadLetters || [];\r\n\r\n    if (deadLetters.length > 0) {\r\n      deadLettersContainer.innerHTML = `\r\n        <h4>Failed Operations</h4>\r\n        <div class=\"dead-letters-list\">\r\n          ${deadLetters.map(dl => `\r\n            <div class=\"dead-letter\" data-id=\"${dl.id}\">\r\n              <div class=\"dl-header\">\r\n                <span class=\"dl-type\">${dl.type}</span>\r\n                <span class=\"dl-time\">${formatRelativeTime(dl.failedAt)}</span>\r\n              </div>\r\n              <div class=\"dl-error\">${escapeHtml(dl.error)}</div>\r\n              <div class=\"dl-actions\">\r\n                <button class=\"btn btn-sm retry-btn\" data-id=\"${dl.id}\">Retry</button>\r\n                <span class=\"dl-retries\">${dl.retryCount} attempts</span>\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      `;\r\n\r\n      // Bind retry buttons\r\n      deadLettersContainer.querySelectorAll('.retry-btn').forEach(btn => {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          const id = btn.getAttribute('data-id');\r\n          if (!id) return;\r\n\r\n          try {\r\n            await http.post(`/api/sync/retry/${id}`);\r\n            toast.success('Retry scheduled');\r\n            loadSyncDetails(container);\r\n          } catch {\r\n            toast.error('Retry failed');\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      deadLettersContainer.innerHTML = '';\r\n    }\r\n  } catch {\r\n    infoContainer.innerHTML = '<div class=\"error\">Failed to load details</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Create mini sync indicator for header\r\n */\r\nexport function createSyncIndicator(): HTMLElement {\r\n  const indicator = createElement('div', { className: 'sync-indicator-mini' });\r\n  indicator.innerHTML = '<span class=\"sync-dot\"></span>';\r\n\r\n  // Initial check\r\n  checkMiniStatus(indicator);\r\n\r\n  // Periodic refresh\r\n  setInterval(() => checkMiniStatus(indicator), 30000);\r\n\r\n  return indicator;\r\n}\r\n\r\n/**\r\n * Check mini status\r\n */\r\nasync function checkMiniStatus(indicator: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<SyncState>('/api/sync/status');\r\n    const dot = indicator.querySelector('.sync-dot') as HTMLElement;\r\n    \r\n    if (!response.data.connected) {\r\n      dot.className = 'sync-dot error';\r\n      indicator.title = 'Disconnected';\r\n    } else if (response.data.errorCount > 0) {\r\n      dot.className = 'sync-dot warning';\r\n      indicator.title = `${response.data.errorCount} sync errors`;\r\n    } else {\r\n      dot.className = 'sync-dot success';\r\n      indicator.title = 'Synced';\r\n    }\r\n  } catch {\r\n    const dot = indicator.querySelector('.sync-dot') as HTMLElement;\r\n    dot.className = 'sync-dot error';\r\n    indicator.title = 'Connection error';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createSyncStatus;\r\n","/**\r\n * Settings Modal Component - User Preferences\r\n * Simplified modal for user settings (Theme, Language, Data & Privacy)\r\n * Admin/LLM settings are now in the Admin panel (sidebar)\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { appStore } from '../../stores/app';\r\nimport { theme } from '../../services/theme';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'settings-modal';\r\n\r\nexport interface SettingsModalProps {\r\n  onSave?: (settings: Record<string, unknown>) => void;\r\n  initialTab?: 'general' | 'data';\r\n}\r\n\r\n/**\r\n * Create and show settings modal\r\n */\r\nexport function showSettingsModal(props: SettingsModalProps = {}): void {\r\n  // Remove existing modal if any\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const state = appStore.getState();\r\n  const currentTheme = theme.getMode();\r\n  const initialTab = props.initialTab || 'general';\r\n\r\n  // Create modal container\r\n  const modalOverlay = createElement('div', { className: 'settings-modal-overlay' });\r\n  modalOverlay.setAttribute('data-modal-id', MODAL_ID);\r\n  \r\n  const container = createElement('div', { className: 'settings-modal-container' });\r\n  \r\n  container.innerHTML = `\r\n    <style>\r\n      .settings-modal-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0, 0, 0, 0.5);\r\n        backdrop-filter: blur(4px);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 1000;\r\n        padding: 20px;\r\n      }\r\n      \r\n      .settings-modal-container {\r\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n        width: 100%;\r\n        max-width: 520px;\r\n      }\r\n      \r\n      .settings-card {\r\n        background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(248,250,252,0.98) 100%);\r\n        backdrop-filter: blur(20px);\r\n        border-radius: 20px;\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\r\n          0 0 0 1px rgba(255, 255, 255, 0.8);\r\n        overflow: hidden;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-card {\r\n        background: linear-gradient(135deg, rgba(30,41,59,0.98) 0%, rgba(15,23,42,0.98) 100%);\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1);\r\n      }\r\n      \r\n      .settings-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        padding: 24px 28px;\r\n        position: relative;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .settings-header::before {\r\n        content: '';\r\n        position: absolute;\r\n        top: -50%;\r\n        right: -50%;\r\n        width: 100%;\r\n        height: 200%;\r\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\r\n        pointer-events: none;\r\n      }\r\n      \r\n      .settings-header-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 14px;\r\n        position: relative;\r\n        z-index: 1;\r\n      }\r\n      \r\n      .settings-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        border-radius: 12px;\r\n        background: rgba(255,255,255,0.2);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        border: 2px solid rgba(255,255,255,0.3);\r\n      }\r\n      \r\n      .settings-icon svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        stroke: white;\r\n        fill: none;\r\n      }\r\n      \r\n      .settings-title {\r\n        flex: 1;\r\n      }\r\n      \r\n      .settings-title h2 {\r\n        color: white;\r\n        font-size: 1.4rem;\r\n        font-weight: 600;\r\n        margin: 0;\r\n        text-shadow: 0 1px 2px rgba(0,0,0,0.1);\r\n      }\r\n      \r\n      .settings-title p {\r\n        color: rgba(255,255,255,0.85);\r\n        font-size: 0.85rem;\r\n        margin: 4px 0 0;\r\n      }\r\n      \r\n      .settings-close {\r\n        position: absolute;\r\n        top: 16px;\r\n        right: 16px;\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        transition: background 0.2s;\r\n        z-index: 2;\r\n      }\r\n      \r\n      .settings-close:hover {\r\n        background: rgba(255,255,255,0.3);\r\n      }\r\n      \r\n      .settings-close svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        stroke: white;\r\n      }\r\n      \r\n      .settings-tabs {\r\n        display: flex;\r\n        gap: 8px;\r\n        padding: 16px 24px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-tabs {\r\n        background: rgba(30,41,59,0.5);\r\n        border-bottom-color: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .settings-tab {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 10px 16px;\r\n        border: none;\r\n        background: transparent;\r\n        color: var(--text-secondary, #64748b);\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        border-radius: 10px;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .settings-tab:hover {\r\n        background: var(--bg-hover, rgba(0,0,0,0.05));\r\n        color: var(--text-primary, #1e293b);\r\n      }\r\n      \r\n      .settings-tab.active {\r\n        background: white;\r\n        color: #e11d48;\r\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-tab.active {\r\n        background: rgba(225,29,72,0.15);\r\n        color: #fb7185;\r\n      }\r\n      \r\n      .settings-tab svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        stroke: currentColor;\r\n        fill: none;\r\n      }\r\n      \r\n      .settings-body {\r\n        padding: 24px;\r\n        max-height: 400px;\r\n        overflow-y: auto;\r\n      }\r\n      \r\n      .settings-section {\r\n        display: none;\r\n      }\r\n      \r\n      .settings-section.active {\r\n        display: block;\r\n      }\r\n      \r\n      .settings-section h3 {\r\n        font-size: 0.85rem;\r\n        font-weight: 600;\r\n        color: var(--text-secondary, #64748b);\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n        margin: 0 0 16px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      .settings-section h3 svg {\r\n        width: 16px;\r\n        height: 16px;\r\n        stroke: currentColor;\r\n      }\r\n      \r\n      .form-group {\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .form-group:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .form-group label {\r\n        display: block;\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        color: var(--text-primary, #1e293b);\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .form-group p.hint {\r\n        font-size: 0.8rem;\r\n        color: var(--text-secondary, #64748b);\r\n        margin: 6px 0 0;\r\n      }\r\n      \r\n      .form-select {\r\n        width: 100%;\r\n        padding: 12px 14px;\r\n        border: 1px solid var(--border-color, #e2e8f0);\r\n        border-radius: 10px;\r\n        background: var(--bg-primary, white);\r\n        color: var(--text-primary, #1e293b);\r\n        font-size: 0.9rem;\r\n        transition: border-color 0.2s, box-shadow 0.2s;\r\n        appearance: none;\r\n        background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2364748b' d='M2.5 4.5L6 8l3.5-3.5'/%3E%3C/svg%3E\");\r\n        background-repeat: no-repeat;\r\n        background-position: right 12px center;\r\n        cursor: pointer;\r\n      }\r\n      \r\n      .form-select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-select {\r\n        background-color: rgba(30,41,59,0.8);\r\n        border-color: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .toggle-group {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding: 14px 16px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-radius: 10px;\r\n        margin-bottom: 12px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .toggle-group {\r\n        background: rgba(30,41,59,0.5);\r\n      }\r\n      \r\n      .toggle-group:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .toggle-info {\r\n        flex: 1;\r\n      }\r\n      \r\n      .toggle-info strong {\r\n        display: block;\r\n        font-size: 0.9rem;\r\n        color: var(--text-primary, #1e293b);\r\n        margin-bottom: 2px;\r\n      }\r\n      \r\n      .toggle-info span {\r\n        font-size: 0.8rem;\r\n        color: var(--text-secondary, #64748b);\r\n      }\r\n      \r\n      .toggle-switch {\r\n        position: relative;\r\n        width: 48px;\r\n        height: 26px;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .toggle-switch input {\r\n        opacity: 0;\r\n        width: 0;\r\n        height: 0;\r\n      }\r\n      \r\n      .toggle-slider {\r\n        position: absolute;\r\n        cursor: pointer;\r\n        inset: 0;\r\n        background: var(--bg-tertiary, #cbd5e1);\r\n        border-radius: 26px;\r\n        transition: 0.3s;\r\n      }\r\n      \r\n      .toggle-slider::before {\r\n        content: '';\r\n        position: absolute;\r\n        width: 20px;\r\n        height: 20px;\r\n        left: 3px;\r\n        bottom: 3px;\r\n        background: white;\r\n        border-radius: 50%;\r\n        transition: 0.3s;\r\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\r\n      }\r\n      \r\n      .toggle-switch input:checked + .toggle-slider {\r\n        background: #e11d48;\r\n      }\r\n      \r\n      .toggle-switch input:checked + .toggle-slider::before {\r\n        transform: translateX(22px);\r\n      }\r\n      \r\n      .settings-footer {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 12px;\r\n        padding: 20px 24px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-top: 1px solid var(--border-color, #e2e8f0);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-footer {\r\n        background: rgba(30,41,59,0.5);\r\n        border-top-color: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .btn-cancel {\r\n        padding: 10px 20px;\r\n        border: 1px solid var(--border-color, #e2e8f0);\r\n        border-radius: 10px;\r\n        background: var(--bg-primary, white);\r\n        color: var(--text-primary, #1e293b);\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: background 0.2s;\r\n      }\r\n      \r\n      .btn-cancel:hover {\r\n        background: var(--bg-hover, #f1f5f9);\r\n      }\r\n      \r\n      .btn-save {\r\n        padding: 10px 24px;\r\n        border: none;\r\n        border-radius: 10px;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        transition: transform 0.2s, box-shadow 0.2s;\r\n      }\r\n      \r\n      .btn-save:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .btn-save svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        stroke: white;\r\n      }\r\n      \r\n      .admin-notice {\r\n        background: linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(37,99,235,0.1) 100%);\r\n        border: 1px solid rgba(59,130,246,0.3);\r\n        border-radius: 10px;\r\n        padding: 14px 16px;\r\n        margin-top: 20px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .admin-notice svg {\r\n        width: 20px;\r\n        height: 20px;\r\n        stroke: #3b82f6;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .admin-notice p {\r\n        font-size: 0.85rem;\r\n        color: var(--text-secondary, #64748b);\r\n        margin: 0;\r\n      }\r\n      \r\n      .admin-notice strong {\r\n        color: #3b82f6;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"settings-card\">\r\n      <!-- Header -->\r\n      <div class=\"settings-header\">\r\n        <button class=\"settings-close\" id=\"close-settings-btn\">\r\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M18 6L6 18M6 6l12 12\"/>\r\n          </svg>\r\n        </button>\r\n        <div class=\"settings-header-content\">\r\n          <div class=\"settings-icon\">\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n              <path d=\"M12 15a3 3 0 100-6 3 3 0 000 6z\"/>\r\n              <path d=\"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z\"/>\r\n            </svg>\r\n          </div>\r\n          <div class=\"settings-title\">\r\n            <h2>Settings</h2>\r\n            <p>Your personal preferences</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Tabs -->\r\n      <div class=\"settings-tabs\">\r\n        <button class=\"settings-tab ${initialTab === 'general' ? 'active' : ''}\" data-tab=\"general\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"3\"/>\r\n            <path d=\"M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41\"/>\r\n          </svg>\r\n          General\r\n        </button>\r\n        <button class=\"settings-tab ${initialTab === 'data' ? 'active' : ''}\" data-tab=\"data\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\"/>\r\n          </svg>\r\n          Data & Privacy\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- Body -->\r\n      <div class=\"settings-body\">\r\n        <!-- General Section -->\r\n        <div class=\"settings-section ${initialTab === 'general' ? 'active' : ''}\" id=\"section-general\">\r\n          <h3>\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n              <path d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707\"/>\r\n            </svg>\r\n            Appearance\r\n          </h3>\r\n          \r\n          <div class=\"form-group\">\r\n            <label>Theme</label>\r\n            <select class=\"form-select\" id=\"setting-theme\">\r\n              <option value=\"system\" ${currentTheme === 'system' ? 'selected' : ''}>System (Auto)</option>\r\n              <option value=\"light\" ${currentTheme === 'light' ? 'selected' : ''}>Light</option>\r\n              <option value=\"dark\" ${currentTheme === 'dark' ? 'selected' : ''}>Dark</option>\r\n            </select>\r\n            <p class=\"hint\">Choose your preferred color scheme</p>\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label>Language</label>\r\n            <select class=\"form-select\" id=\"setting-language\">\r\n              <option value=\"en\" ${state.config.language === 'en' ? 'selected' : ''}>English</option>\r\n              <option value=\"pt\" ${state.config.language === 'pt' ? 'selected' : ''}>Portugues</option>\r\n              <option value=\"es\" ${state.config.language === 'es' ? 'selected' : ''}>Espanol</option>\r\n            </select>\r\n            <p class=\"hint\">Interface language preference</p>\r\n          </div>\r\n          \r\n          ${state.currentUser?.role === 'superadmin' ? `\r\n            <div class=\"admin-notice\">\r\n              <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                <path d=\"M12 16v-4M12 8h.01\"/>\r\n              </svg>\r\n              <p>For <strong>LLM configuration</strong>, <strong>Graph</strong>, and other platform settings, use the <strong>Admin</strong> section in the sidebar menu.</p>\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n        \r\n        <!-- Data & Privacy Section -->\r\n        <div class=\"settings-section ${initialTab === 'data' ? 'active' : ''}\" id=\"section-data\">\r\n          <h3>\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n              <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\"/>\r\n            </svg>\r\n            Privacy Settings\r\n          </h3>\r\n          \r\n          <div class=\"toggle-group\">\r\n            <div class=\"toggle-info\">\r\n              <strong>Analytics</strong>\r\n              <span>Help improve GodMode with anonymous usage data</span>\r\n            </div>\r\n            <label class=\"toggle-switch\">\r\n              <input type=\"checkbox\" id=\"setting-analytics\" ${state.config.analyticsEnabled !== false ? 'checked' : ''}>\r\n              <span class=\"toggle-slider\"></span>\r\n            </label>\r\n          </div>\r\n          \r\n          <div class=\"toggle-group\">\r\n            <div class=\"toggle-info\">\r\n              <strong>Error Reporting</strong>\r\n              <span>Automatically report errors to help fix bugs</span>\r\n            </div>\r\n            <label class=\"toggle-switch\">\r\n              <input type=\"checkbox\" id=\"setting-error-reporting\" ${state.config.errorReportingEnabled !== false ? 'checked' : ''}>\r\n              <span class=\"toggle-slider\"></span>\r\n            </label>\r\n          </div>\r\n          \r\n          <div class=\"toggle-group\">\r\n            <div class=\"toggle-info\">\r\n              <strong>AI Data Improvement</strong>\r\n              <span>Allow anonymized data to improve AI responses</span>\r\n            </div>\r\n            <label class=\"toggle-switch\">\r\n              <input type=\"checkbox\" id=\"setting-ai-improvement\" ${state.config.aiImprovementEnabled === true ? 'checked' : ''}>\r\n              <span class=\"toggle-slider\"></span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Footer -->\r\n      <div class=\"settings-footer\">\r\n        <button class=\"btn-cancel\" id=\"cancel-settings-btn\">Cancel</button>\r\n        <button class=\"btn-save\" id=\"save-settings-btn\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <polyline points=\"20 6 9 17 4 12\"/>\r\n          </svg>\r\n          Save Settings\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n  \r\n  modalOverlay.appendChild(container);\r\n  document.body.appendChild(modalOverlay);\r\n  \r\n  // Bind events\r\n  bindSettingsEvents(modalOverlay, props);\r\n}\r\n\r\n/**\r\n * Bind event handlers\r\n */\r\nfunction bindSettingsEvents(overlay: HTMLElement, props: SettingsModalProps): void {\r\n  // Close buttons\r\n  const closeBtn = overlay.querySelector('#close-settings-btn');\r\n  const cancelBtn = overlay.querySelector('#cancel-settings-btn');\r\n  \r\n  const closeModal = () => overlay.remove();\r\n  \r\n  if (closeBtn) on(closeBtn as HTMLElement, 'click', closeModal);\r\n  if (cancelBtn) on(cancelBtn as HTMLElement, 'click', closeModal);\r\n  \r\n  // Close on overlay click\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) closeModal();\r\n  });\r\n  \r\n  // Tab switching\r\n  const tabs = overlay.querySelectorAll('.settings-tab');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      const tabId = tab.getAttribute('data-tab');\r\n      \r\n      // Update tab buttons\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      \r\n      // Update sections\r\n      overlay.querySelectorAll('.settings-section').forEach(section => {\r\n        section.classList.remove('active');\r\n      });\r\n      const targetSection = overlay.querySelector(`#section-${tabId}`);\r\n      if (targetSection) targetSection.classList.add('active');\r\n    });\r\n  });\r\n  \r\n  // Theme change (immediate preview)\r\n  const themeSelect = overlay.querySelector('#setting-theme') as HTMLSelectElement;\r\n  if (themeSelect) {\r\n    on(themeSelect, 'change', () => {\r\n      theme.set(themeSelect.value as 'light' | 'dark' | 'system');\r\n    });\r\n  }\r\n  \r\n  // Save button\r\n  const saveBtn = overlay.querySelector('#save-settings-btn');\r\n  if (saveBtn) {\r\n    on(saveBtn as HTMLElement, 'click', () => {\r\n      const settings = {\r\n        theme: (overlay.querySelector('#setting-theme') as HTMLSelectElement)?.value,\r\n        language: (overlay.querySelector('#setting-language') as HTMLSelectElement)?.value,\r\n        analyticsEnabled: (overlay.querySelector('#setting-analytics') as HTMLInputElement)?.checked,\r\n        errorReportingEnabled: (overlay.querySelector('#setting-error-reporting') as HTMLInputElement)?.checked,\r\n        aiImprovementEnabled: (overlay.querySelector('#setting-ai-improvement') as HTMLInputElement)?.checked,\r\n      };\r\n      \r\n      // Update app state\r\n      appStore.setConfig({\r\n        ...appStore.getState().config,\r\n        ...settings,\r\n      });\r\n      \r\n      // Call onSave callback\r\n      props.onSave?.(settings);\r\n      \r\n      toast.success('Settings saved');\r\n      closeModal();\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Close settings modal\r\n */\r\nexport function closeSettingsModal(): void {\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) modal.remove();\r\n}\r\n\r\nexport default showSettingsModal;\r\n","/**\r\n * Processing Modal Component\r\n * Shows progress for file processing operations\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal, updateModalContent } from '../Modal';\r\n\r\nconst MODAL_ID = 'processing-modal';\r\n\r\nexport interface ProcessingStep {\r\n  id: string;\r\n  label: string;\r\n  status: 'pending' | 'running' | 'completed' | 'error';\r\n  progress?: number;\r\n  message?: string;\r\n}\r\n\r\nexport interface ProcessingModalProps {\r\n  title?: string;\r\n  steps?: ProcessingStep[];\r\n  onCancel?: () => void;\r\n  allowCancel?: boolean;\r\n}\r\n\r\nlet currentSteps: ProcessingStep[] = [];\r\nlet cancelCallback: (() => void) | undefined;\r\n\r\n/**\r\n * Show processing modal\r\n */\r\nexport function showProcessingModal(props: ProcessingModalProps = {}): void {\r\n  const {\r\n    title = 'Processing',\r\n    steps = [],\r\n    onCancel,\r\n    allowCancel = true,\r\n  } = props;\r\n\r\n  currentSteps = steps;\r\n  cancelCallback = onCancel;\r\n\r\n  // Remove existing modal if any\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'processing-content' });\r\n  renderContent(content);\r\n\r\n  const footer = allowCancel ? createFooter() : null;\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    content,\r\n    size: 'md',\r\n    closable: false,\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Render processing content\r\n */\r\nfunction renderContent(container: HTMLElement): void {\r\n  container.innerHTML = `\r\n    <div class=\"processing-steps\">\r\n      ${currentSteps.map(step => renderStep(step)).join('')}\r\n    </div>\r\n    <div class=\"processing-overall\">\r\n      <div class=\"progress-bar\">\r\n        <div class=\"progress-fill\" style=\"width: ${calculateOverallProgress()}%\"></div>\r\n      </div>\r\n      <div class=\"progress-text\">${calculateOverallProgress()}% complete</div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render a single step\r\n */\r\nfunction renderStep(step: ProcessingStep): string {\r\n  const statusIcon = {\r\n    pending: '',\r\n    running: '',\r\n    completed: '',\r\n    error: '',\r\n  }[step.status];\r\n\r\n  const statusClass = step.status;\r\n\r\n  return `\r\n    <div class=\"processing-step ${statusClass}\" data-step-id=\"${step.id}\">\r\n      <span class=\"step-icon\">${statusIcon}</span>\r\n      <div class=\"step-content\">\r\n        <div class=\"step-label\">${step.label}</div>\r\n        ${step.message ? `<div class=\"step-message\">${step.message}</div>` : ''}\r\n        ${step.status === 'running' && step.progress !== undefined ? `\r\n          <div class=\"step-progress\">\r\n            <div class=\"progress-bar small\">\r\n              <div class=\"progress-fill\" style=\"width: ${step.progress}%\"></div>\r\n            </div>\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Calculate overall progress\r\n */\r\nfunction calculateOverallProgress(): number {\r\n  if (currentSteps.length === 0) return 0;\r\n\r\n  const completed = currentSteps.filter(s => s.status === 'completed').length;\r\n  const running = currentSteps.find(s => s.status === 'running');\r\n  const runningProgress = running?.progress || 0;\r\n\r\n  return Math.round(\r\n    ((completed + (running ? runningProgress / 100 : 0)) / currentSteps.length) * 100\r\n  );\r\n}\r\n\r\n/**\r\n * Create footer with cancel button\r\n */\r\nfunction createFooter(): HTMLElement {\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => {\r\n    cancelCallback?.();\r\n    closeProcessingModal();\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  return footer;\r\n}\r\n\r\n/**\r\n * Update processing step\r\n */\r\nexport function updateProcessingStep(\r\n  stepId: string,\r\n  updates: Partial<ProcessingStep>\r\n): void {\r\n  const stepIndex = currentSteps.findIndex(s => s.id === stepId);\r\n  if (stepIndex === -1) return;\r\n\r\n  currentSteps[stepIndex] = { ...currentSteps[stepIndex], ...updates };\r\n\r\n  // Re-render\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) {\r\n    const content = modal.querySelector('.processing-content');\r\n    if (content) {\r\n      renderContent(content as HTMLElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Add a new step\r\n */\r\nexport function addProcessingStep(step: ProcessingStep): void {\r\n  currentSteps.push(step);\r\n\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) {\r\n    const content = modal.querySelector('.processing-content');\r\n    if (content) {\r\n      renderContent(content as HTMLElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Set all steps at once\r\n */\r\nexport function setProcessingSteps(steps: ProcessingStep[]): void {\r\n  currentSteps = steps;\r\n\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) {\r\n    const content = modal.querySelector('.processing-content');\r\n    if (content) {\r\n      renderContent(content as HTMLElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Close processing modal\r\n */\r\nexport function closeProcessingModal(): void {\r\n  closeModal(MODAL_ID);\r\n  currentSteps = [];\r\n  cancelCallback = undefined;\r\n}\r\n\r\n/**\r\n * Check if processing modal is open\r\n */\r\nexport function isProcessingModalOpen(): boolean {\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  return modal?.classList.contains('open') || false;\r\n}\r\n\r\nexport default showProcessingModal;\r\n","/**\r\n * Auth Modal Component\r\n * Login, registration, and password reset dialogs\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { auth } from '../../services/auth';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'auth-modal';\r\n\r\nexport type AuthMode = 'login' | 'register' | 'forgot' | 'reset';\r\n\r\nexport interface AuthModalProps {\r\n  initialMode?: AuthMode;\r\n  resetToken?: string; // For password reset flow\r\n  onSuccess?: (user: { id: string; email: string; name?: string }) => void;\r\n  onClose?: () => void;\r\n  required?: boolean; // If true, modal cannot be closed without logging in\r\n}\r\n\r\nlet currentMode: AuthMode = 'login';\r\nlet currentProps: AuthModalProps = {};\r\n\r\n/**\r\n * Show auth modal\r\n */\r\nexport function showAuthModal(props: AuthModalProps = {}): void {\r\n  currentMode = props.initialMode || 'login';\r\n  currentProps = props;\r\n\r\n  // Remove existing modal if any\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'auth-content' });\r\n  renderAuthContent(content);\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: getTitle(),\r\n    content,\r\n    size: 'sm',\r\n    closable: !props.required, // Can't close if login is required\r\n    onClose: props.onClose,\r\n    footer: null,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Focus first input\r\n  setTimeout(() => {\r\n    const firstInput = content.querySelector('input') as HTMLInputElement;\r\n    if (firstInput) firstInput.focus();\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Get modal title based on mode\r\n */\r\nfunction getTitle(): string {\r\n  switch (currentMode) {\r\n    case 'login': return 'Sign In';\r\n    case 'register': return 'Create Account';\r\n    case 'forgot': return 'Reset Password';\r\n    case 'reset': return 'Set New Password';\r\n  }\r\n}\r\n\r\n/**\r\n * Render auth content\r\n */\r\nfunction renderAuthContent(container: HTMLElement): void {\r\n  switch (currentMode) {\r\n    case 'login':\r\n      renderLoginForm(container);\r\n      break;\r\n    case 'register':\r\n      renderRegisterForm(container);\r\n      break;\r\n    case 'forgot':\r\n      renderForgotForm(container);\r\n      break;\r\n    case 'reset':\r\n      renderResetForm(container);\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Render login form\r\n */\r\nfunction renderLoginForm(container: HTMLElement): void {\r\n  container.innerHTML = `\r\n    <form id=\"login-form\" class=\"auth-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"login-email\">Email</label>\r\n        <input type=\"email\" id=\"login-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"login-password\">Password</label>\r\n        <input type=\"password\" id=\"login-password\" required autocomplete=\"current-password\" placeholder=\"\">\r\n      </div>\r\n      <div class=\"form-error\" id=\"login-error\" style=\"display: none;\"></div>\r\n      <div class=\"form-group\">\r\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\r\n          <span class=\"btn-text\">Sign In</span>\r\n          <span class=\"btn-loading\" style=\"display: none;\">Signing in...</span>\r\n        </button>\r\n      </div>\r\n      <div class=\"auth-links\">\r\n        <button type=\"button\" class=\"btn-link\" data-action=\"forgot\">Forgot password?</button>\r\n        <span class=\"separator\">|</span>\r\n        <button type=\"button\" class=\"btn-link\" data-action=\"register\">Create account</button>\r\n      </div>\r\n    </form>\r\n  `;\r\n\r\n  const form = container.querySelector('#login-form') as HTMLFormElement;\r\n  on(form, 'submit', async (e) => {\r\n    e.preventDefault();\r\n    await handleLogin(form);\r\n  });\r\n\r\n  bindModeLinks(container);\r\n}\r\n\r\n/**\r\n * Render registration form\r\n */\r\nfunction renderRegisterForm(container: HTMLElement): void {\r\n  container.innerHTML = `\r\n    <form id=\"register-form\" class=\"auth-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"register-email\">Email <span class=\"required\">*</span></label>\r\n        <input type=\"email\" id=\"register-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"register-username\">Username</label>\r\n        <input type=\"text\" id=\"register-username\" autocomplete=\"username\" placeholder=\"username (optional)\" \r\n               pattern=\"^[a-zA-Z0-9_]+$\" minlength=\"3\">\r\n        <small class=\"form-hint\">Letters, numbers, and underscores only. Min 3 characters.</small>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"register-display-name\">Display Name</label>\r\n        <input type=\"text\" id=\"register-display-name\" autocomplete=\"name\" placeholder=\"Your Name (optional)\">\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"register-password\">Password <span class=\"required\">*</span></label>\r\n        <input type=\"password\" id=\"register-password\" required autocomplete=\"new-password\" \r\n               minlength=\"12\" placeholder=\"Min. 12 characters\">\r\n        <div class=\"password-strength\" id=\"password-strength\"></div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"register-confirm\">Confirm Password <span class=\"required\">*</span></label>\r\n        <input type=\"password\" id=\"register-confirm\" required autocomplete=\"new-password\" placeholder=\"\">\r\n      </div>\r\n      <div class=\"form-error\" id=\"register-error\" style=\"display: none;\"></div>\r\n      <div class=\"form-group\">\r\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\r\n          <span class=\"btn-text\">Create Account</span>\r\n          <span class=\"btn-loading\" style=\"display: none;\">Creating account...</span>\r\n        </button>\r\n      </div>\r\n      <div class=\"auth-links\">\r\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Already have an account? Sign in</button>\r\n      </div>\r\n    </form>\r\n  `;\r\n\r\n  const form = container.querySelector('#register-form') as HTMLFormElement;\r\n  \r\n  // Password strength indicator\r\n  const passwordInput = form.querySelector('#register-password') as HTMLInputElement;\r\n  on(passwordInput, 'input', () => {\r\n    updatePasswordStrength(passwordInput.value);\r\n  });\r\n\r\n  on(form, 'submit', async (e) => {\r\n    e.preventDefault();\r\n    await handleRegister(form);\r\n  });\r\n\r\n  bindModeLinks(container);\r\n}\r\n\r\n/**\r\n * Render forgot password form\r\n */\r\nfunction renderForgotForm(container: HTMLElement): void {\r\n  container.innerHTML = `\r\n    <form id=\"forgot-form\" class=\"auth-form\">\r\n      <p class=\"form-description\">\r\n        Enter your email address and we'll send you a link to reset your password.\r\n      </p>\r\n      <div class=\"form-group\">\r\n        <label for=\"forgot-email\">Email</label>\r\n        <input type=\"email\" id=\"forgot-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\r\n      </div>\r\n      <div class=\"form-error\" id=\"forgot-error\" style=\"display: none;\"></div>\r\n      <div class=\"form-group\">\r\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\r\n          <span class=\"btn-text\">Send Reset Link</span>\r\n          <span class=\"btn-loading\" style=\"display: none;\">Sending...</span>\r\n        </button>\r\n      </div>\r\n      <div class=\"auth-links\">\r\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Back to sign in</button>\r\n      </div>\r\n    </form>\r\n  `;\r\n\r\n  const form = container.querySelector('#forgot-form') as HTMLFormElement;\r\n  on(form, 'submit', async (e) => {\r\n    e.preventDefault();\r\n    await handleForgot(form);\r\n  });\r\n\r\n  bindModeLinks(container);\r\n}\r\n\r\n/**\r\n * Render reset password form\r\n */\r\nfunction renderResetForm(container: HTMLElement): void {\r\n  container.innerHTML = `\r\n    <form id=\"reset-form\" class=\"auth-form\">\r\n      <p class=\"form-description\">\r\n        Enter your new password below.\r\n      </p>\r\n      <div class=\"form-group\">\r\n        <label for=\"reset-password\">New Password</label>\r\n        <input type=\"password\" id=\"reset-password\" required autocomplete=\"new-password\" \r\n               minlength=\"12\" placeholder=\"Min. 12 characters\">\r\n        <div class=\"password-strength\" id=\"reset-password-strength\"></div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"reset-confirm\">Confirm Password</label>\r\n        <input type=\"password\" id=\"reset-confirm\" required autocomplete=\"new-password\" placeholder=\"\">\r\n      </div>\r\n      <div class=\"form-error\" id=\"reset-error\" style=\"display: none;\"></div>\r\n      <div class=\"form-group\">\r\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\r\n          <span class=\"btn-text\">Reset Password</span>\r\n          <span class=\"btn-loading\" style=\"display: none;\">Resetting...</span>\r\n        </button>\r\n      </div>\r\n    </form>\r\n  `;\r\n\r\n  const form = container.querySelector('#reset-form') as HTMLFormElement;\r\n  \r\n  // Password strength indicator\r\n  const passwordInput = form.querySelector('#reset-password') as HTMLInputElement;\r\n  on(passwordInput, 'input', () => {\r\n    updatePasswordStrength(passwordInput.value, 'reset-password-strength');\r\n  });\r\n\r\n  on(form, 'submit', async (e) => {\r\n    e.preventDefault();\r\n    await handleReset(form);\r\n  });\r\n}\r\n\r\n/**\r\n * Bind mode switch links\r\n */\r\nfunction bindModeLinks(container: HTMLElement): void {\r\n  const links = container.querySelectorAll('[data-action]');\r\n  links.forEach(link => {\r\n    on(link as HTMLElement, 'click', () => {\r\n      const action = link.getAttribute('data-action') as AuthMode;\r\n      currentMode = action;\r\n\r\n      // Update modal title\r\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\r\n      if (titleEl) titleEl.textContent = getTitle();\r\n\r\n      // Re-render content\r\n      renderAuthContent(container);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Handle login submission\r\n */\r\nasync function handleLogin(form: HTMLFormElement): Promise<void> {\r\n  const email = (form.querySelector('#login-email') as HTMLInputElement).value.trim();\r\n  const password = (form.querySelector('#login-password') as HTMLInputElement).value;\r\n  const errorEl = form.querySelector('#login-error') as HTMLElement;\r\n  \r\n  setFormLoading(form, true);\r\n  hideError(errorEl);\r\n\r\n  try {\r\n    const user = await auth.login({ email, password });\r\n    \r\n    toast.success('Signed in successfully');\r\n    currentProps.onSuccess?.(user);\r\n    closeModal(MODAL_ID);\r\n    \r\n    // Trigger data refresh\r\n    window.dispatchEvent(new CustomEvent('godmode:auth-success'));\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Login failed';\r\n    showError(errorEl, message);\r\n  } finally {\r\n    setFormLoading(form, false);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle registration submission\r\n */\r\nasync function handleRegister(form: HTMLFormElement): Promise<void> {\r\n  const email = (form.querySelector('#register-email') as HTMLInputElement).value.trim();\r\n  const username = (form.querySelector('#register-username') as HTMLInputElement).value.trim();\r\n  const displayName = (form.querySelector('#register-display-name') as HTMLInputElement).value.trim();\r\n  const password = (form.querySelector('#register-password') as HTMLInputElement).value;\r\n  const confirm = (form.querySelector('#register-confirm') as HTMLInputElement).value;\r\n  const errorEl = form.querySelector('#register-error') as HTMLElement;\r\n\r\n  // Validate passwords match\r\n  if (password !== confirm) {\r\n    showError(errorEl, 'Passwords do not match');\r\n    return;\r\n  }\r\n\r\n  // Validate password length\r\n  if (password.length < 12) {\r\n    showError(errorEl, 'Password must be at least 12 characters');\r\n    return;\r\n  }\r\n\r\n  setFormLoading(form, true);\r\n  hideError(errorEl);\r\n\r\n  try {\r\n    const result = await auth.register({\r\n      email,\r\n      password,\r\n      username: username || undefined,\r\n      display_name: displayName || undefined,\r\n    });\r\n\r\n    if (result.needsEmailVerification) {\r\n      toast.success('Account created! Please check your email to verify.');\r\n      // Switch to login mode\r\n      currentMode = 'login';\r\n      const container = form.parentElement as HTMLElement;\r\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\r\n      if (titleEl) titleEl.textContent = getTitle();\r\n      renderAuthContent(container);\r\n    } else {\r\n      toast.success('Account created successfully');\r\n      currentProps.onSuccess?.(result.user);\r\n      closeModal(MODAL_ID);\r\n      window.dispatchEvent(new CustomEvent('godmode:auth-success'));\r\n    }\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Registration failed';\r\n    showError(errorEl, message);\r\n  } finally {\r\n    setFormLoading(form, false);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle forgot password submission\r\n */\r\nasync function handleForgot(form: HTMLFormElement): Promise<void> {\r\n  const email = (form.querySelector('#forgot-email') as HTMLInputElement).value.trim();\r\n  const errorEl = form.querySelector('#forgot-error') as HTMLElement;\r\n\r\n  setFormLoading(form, true);\r\n  hideError(errorEl);\r\n\r\n  try {\r\n    await auth.forgotPassword(email);\r\n    toast.success('If an account exists with this email, you will receive a reset link.');\r\n    \r\n    // Switch back to login\r\n    currentMode = 'login';\r\n    const container = form.parentElement as HTMLElement;\r\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\r\n    if (titleEl) titleEl.textContent = getTitle();\r\n    renderAuthContent(container);\r\n  } catch (error) {\r\n    // Always show success message to not reveal if email exists\r\n    toast.success('If an account exists with this email, you will receive a reset link.');\r\n  } finally {\r\n    setFormLoading(form, false);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle password reset submission\r\n */\r\nasync function handleReset(form: HTMLFormElement): Promise<void> {\r\n  const password = (form.querySelector('#reset-password') as HTMLInputElement).value;\r\n  const confirm = (form.querySelector('#reset-confirm') as HTMLInputElement).value;\r\n  const errorEl = form.querySelector('#reset-error') as HTMLElement;\r\n\r\n  if (password !== confirm) {\r\n    showError(errorEl, 'Passwords do not match');\r\n    return;\r\n  }\r\n\r\n  if (password.length < 12) {\r\n    showError(errorEl, 'Password must be at least 12 characters');\r\n    return;\r\n  }\r\n\r\n  if (!currentProps.resetToken) {\r\n    showError(errorEl, 'Invalid reset token. Please request a new reset link.');\r\n    return;\r\n  }\r\n\r\n  setFormLoading(form, true);\r\n  hideError(errorEl);\r\n\r\n  try {\r\n    await auth.resetPassword(password, currentProps.resetToken);\r\n    toast.success('Password reset successfully. You can now sign in.');\r\n    \r\n    // Switch to login\r\n    currentMode = 'login';\r\n    const container = form.parentElement as HTMLElement;\r\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\r\n    if (titleEl) titleEl.textContent = getTitle();\r\n    renderAuthContent(container);\r\n  } catch (error) {\r\n    const message = error instanceof Error ? error.message : 'Password reset failed';\r\n    showError(errorEl, message);\r\n  } finally {\r\n    setFormLoading(form, false);\r\n  }\r\n}\r\n\r\n/**\r\n * Set form loading state\r\n */\r\nfunction setFormLoading(form: HTMLFormElement, loading: boolean): void {\r\n  const submitBtn = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\r\n  const inputs = form.querySelectorAll('input');\r\n  const btnText = submitBtn.querySelector('.btn-text') as HTMLElement;\r\n  const btnLoading = submitBtn.querySelector('.btn-loading') as HTMLElement;\r\n\r\n  submitBtn.disabled = loading;\r\n  inputs.forEach(input => input.disabled = loading);\r\n  \r\n  if (btnText && btnLoading) {\r\n    btnText.style.display = loading ? 'none' : '';\r\n    btnLoading.style.display = loading ? '' : 'none';\r\n  }\r\n}\r\n\r\n/**\r\n * Show error message\r\n */\r\nfunction showError(errorEl: HTMLElement, message: string): void {\r\n  errorEl.textContent = message;\r\n  errorEl.style.display = 'block';\r\n}\r\n\r\n/**\r\n * Hide error message\r\n */\r\nfunction hideError(errorEl: HTMLElement): void {\r\n  errorEl.style.display = 'none';\r\n  errorEl.textContent = '';\r\n}\r\n\r\n/**\r\n * Update password strength indicator\r\n */\r\nfunction updatePasswordStrength(password: string, elementId = 'password-strength'): void {\r\n  const strengthEl = document.getElementById(elementId);\r\n  if (!strengthEl) return;\r\n\r\n  const strength = calculatePasswordStrength(password);\r\n  \r\n  strengthEl.className = `password-strength strength-${strength.level}`;\r\n  strengthEl.innerHTML = `\r\n    <div class=\"strength-bar\">\r\n      <div class=\"strength-fill\" style=\"width: ${strength.score}%\"></div>\r\n    </div>\r\n    <span class=\"strength-label\">${strength.label}</span>\r\n  `;\r\n}\r\n\r\n/**\r\n * Calculate password strength\r\n */\r\nfunction calculatePasswordStrength(password: string): { level: string; score: number; label: string } {\r\n  let score = 0;\r\n\r\n  if (password.length >= 12) score += 25;\r\n  if (password.length >= 16) score += 15;\r\n  if (/[a-z]/.test(password)) score += 15;\r\n  if (/[A-Z]/.test(password)) score += 15;\r\n  if (/[0-9]/.test(password)) score += 15;\r\n  if (/[^a-zA-Z0-9]/.test(password)) score += 15;\r\n\r\n  if (score < 30) return { level: 'weak', score, label: 'Weak' };\r\n  if (score < 60) return { level: 'fair', score, label: 'Fair' };\r\n  if (score < 80) return { level: 'good', score, label: 'Good' };\r\n  return { level: 'strong', score: Math.min(score, 100), label: 'Strong' };\r\n}\r\n\r\n/**\r\n * Close auth modal\r\n */\r\nexport function closeAuthModal(): void {\r\n  closeModal(MODAL_ID);\r\n}\r\n\r\nexport default showAuthModal;\r\n","/**\r\n * Contact Modal Component - SOTA Design\r\n * Create and edit contacts with tabs for Info, Projects, Relations, Activity\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal, confirm } from '../Modal';\r\nimport { Contact } from '../../stores/data';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'contact-modal';\r\n\r\n// Types\r\ninterface RoleTemplate {\r\n  id: string;\r\n  name: string;\r\n  display_name: string;\r\n  description?: string;\r\n  prompt_template?: string;\r\n  is_active: boolean;\r\n}\r\n\r\ninterface ContactRelation {\r\n  id: string;\r\n  from_contact_id: string;\r\n  to_contact_id: string;\r\n  relationship_type: string;\r\n  to_contact?: {\r\n    id: string;\r\n    name: string;\r\n    role?: string;\r\n    organization?: string;\r\n    avatar_url?: string;\r\n  };\r\n}\r\n\r\ninterface ContactActivity {\r\n  id: string;\r\n  activity_type: string;\r\n  description: string;\r\n  occurred_at: string;\r\n  source_type?: string;\r\n}\r\n\r\ninterface ContactProject {\r\n  id: string;\r\n  name: string;\r\n  role?: string;\r\n  is_primary?: boolean;\r\n}\r\n\r\nexport interface ContactModalProps {\r\n  mode: 'create' | 'edit' | 'view';\r\n  contact?: Contact;\r\n  onSave?: (contact: Contact) => void;\r\n  onDelete?: (contactId: string) => void;\r\n}\r\n\r\n// State\r\nlet currentContact: Contact | null = null;\r\nlet contactProjects: ContactProject[] = [];\r\nlet contactRelations: ContactRelation[] = [];\r\nlet contactActivity: ContactActivity[] = [];\r\nlet allProjects: { id: string; name: string }[] = [];\r\nlet roleTemplates: RoleTemplate[] = [];\r\n\r\n/**\r\n * Show contact modal\r\n */\r\nexport function showContactModal(props: ContactModalProps): void {\r\n  const { mode, contact } = props;\r\n  currentContact = contact || null;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createModalContent(mode, contact);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: '',\r\n    content,\r\n    size: 'lg',\r\n  });\r\n\r\n  // Remove default modal styling for custom design\r\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\r\n  if (modalContent) {\r\n    modalContent.style.cssText = 'background: transparent; box-shadow: none; padding: 0; max-width: 900px;';\r\n  }\r\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\r\n  if (modalHeader) {\r\n    modalHeader.style.display = 'none';\r\n  }\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load data for edit mode\r\n  if (mode === 'edit' && contact?.id) {\r\n    loadContactData(content, contact.id);\r\n  } else {\r\n    loadRoleTemplates(content);\r\n    loadAllProjects(content);\r\n    loadTimezones(content);\r\n  }\r\n\r\n  // Bind events\r\n  bindEvents(content, props);\r\n}\r\n\r\n/**\r\n * Create modal content\r\n */\r\nfunction createModalContent(mode: 'create' | 'edit' | 'view', contact?: Contact): HTMLElement {\r\n  const container = createElement('div', { className: 'contact-modal-sota' });\r\n  const isEdit = mode === 'edit';\r\n  const initials = contact ? getInitials(contact.name) : '?';\r\n  const hasPhoto = !!(contact?.photoUrl || contact?.avatarUrl);\r\n  const photoUrl = contact?.photoUrl || contact?.avatarUrl;\r\n\r\n  container.innerHTML = `\r\n    <style>\r\n      .contact-modal-sota {\r\n        background: var(--bg-primary);\r\n        border-radius: 20px;\r\n        overflow: hidden;\r\n        box-shadow: 0 25px 60px rgba(0,0,0,0.3);\r\n      }\r\n\r\n      /* Header */\r\n      .contact-modal-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 50%, #9f1239 100%);\r\n        padding: 32px 32px 24px;\r\n        position: relative;\r\n      }\r\n\r\n      .contact-modal-close {\r\n        position: absolute;\r\n        top: 16px;\r\n        right: 16px;\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .contact-modal-close:hover {\r\n        background: rgba(255,255,255,0.3);\r\n        transform: scale(1.1);\r\n      }\r\n\r\n      .contact-modal-close svg {\r\n        width: 20px;\r\n        height: 20px;\r\n      }\r\n\r\n      .contact-header-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 20px;\r\n      }\r\n\r\n      .contact-avatar-large {\r\n        width: 90px;\r\n        height: 90px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 32px;\r\n        font-weight: 700;\r\n        color: white;\r\n        border: 4px solid rgba(255,255,255,0.3);\r\n        overflow: hidden;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        position: relative;\r\n      }\r\n\r\n      .contact-avatar-large:hover {\r\n        border-color: rgba(255,255,255,0.5);\r\n      }\r\n\r\n      .contact-avatar-large img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n\r\n      .contact-avatar-large .avatar-upload-hint {\r\n        position: absolute;\r\n        inset: 0;\r\n        background: rgba(0,0,0,0.5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        opacity: 0;\r\n        transition: opacity 0.2s;\r\n      }\r\n\r\n      .contact-avatar-large:hover .avatar-upload-hint {\r\n        opacity: 1;\r\n      }\r\n\r\n      .contact-avatar-large .avatar-upload-hint svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        color: white;\r\n      }\r\n\r\n      .contact-header-info {\r\n        flex: 1;\r\n        color: white;\r\n      }\r\n\r\n      .contact-header-info h2 {\r\n        margin: 0 0 4px 0;\r\n        font-size: 26px;\r\n        font-weight: 700;\r\n      }\r\n\r\n      .contact-header-info p {\r\n        margin: 0;\r\n        font-size: 15px;\r\n        opacity: 0.85;\r\n      }\r\n\r\n      .contact-header-actions {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .header-action-btn {\r\n        padding: 10px 16px;\r\n        border-radius: 10px;\r\n        background: rgba(255,255,255,0.15);\r\n        border: 1px solid rgba(255,255,255,0.2);\r\n        color: white;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .header-action-btn:hover {\r\n        background: rgba(255,255,255,0.25);\r\n      }\r\n\r\n      .header-action-btn svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      /* Tabs */\r\n      .contact-tabs {\r\n        display: flex;\r\n        border-bottom: 1px solid var(--border-color);\r\n        padding: 0 32px;\r\n        background: var(--bg-secondary);\r\n      }\r\n\r\n      .contact-tab-btn {\r\n        padding: 14px 20px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        background: none;\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        position: relative;\r\n        transition: color 0.2s;\r\n      }\r\n\r\n      .contact-tab-btn:hover {\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .contact-tab-btn.active {\r\n        color: #e11d48;\r\n      }\r\n\r\n      .contact-tab-btn.active::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: -1px;\r\n        left: 0;\r\n        right: 0;\r\n        height: 3px;\r\n        background: linear-gradient(90deg, #e11d48, #f59e0b);\r\n        border-radius: 3px 3px 0 0;\r\n      }\r\n\r\n      .contact-tab-btn svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      .contact-tab-btn .tab-count {\r\n        background: rgba(225,29,72,0.1);\r\n        color: #e11d48;\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        font-size: 11px;\r\n      }\r\n\r\n      /* Tab Content */\r\n      .contact-tab-content {\r\n        padding: 28px 32px;\r\n        min-height: 400px;\r\n        max-height: 500px;\r\n        overflow-y: auto;\r\n      }\r\n\r\n      .contact-section {\r\n        display: none;\r\n      }\r\n\r\n      .contact-section.active {\r\n        display: block;\r\n      }\r\n\r\n      /* Form Styles */\r\n      .form-grid {\r\n        display: grid;\r\n        grid-template-columns: 1fr 1fr;\r\n        gap: 20px;\r\n      }\r\n\r\n      .form-grid.full {\r\n        grid-template-columns: 1fr;\r\n      }\r\n\r\n      .form-field {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 6px;\r\n      }\r\n\r\n      .form-field.full-width {\r\n        grid-column: 1 / -1;\r\n      }\r\n\r\n      .form-field label {\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n\r\n      .form-field label svg {\r\n        width: 14px;\r\n        height: 14px;\r\n        color: #e11d48;\r\n      }\r\n\r\n      .form-field input,\r\n      .form-field textarea,\r\n      .form-field select {\r\n        padding: 12px 14px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .form-field input:focus,\r\n      .form-field textarea:focus,\r\n      .form-field select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\r\n      }\r\n\r\n      .form-field textarea {\r\n        resize: vertical;\r\n        min-height: 100px;\r\n      }\r\n\r\n      .form-hint {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n      }\r\n\r\n      /* Projects Section */\r\n      .projects-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 10px;\r\n      }\r\n\r\n      .project-item {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 14px;\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .project-item:hover {\r\n        border-color: rgba(225,29,72,0.3);\r\n      }\r\n\r\n      .project-checkbox {\r\n        width: 20px;\r\n        height: 20px;\r\n        accent-color: #e11d48;\r\n      }\r\n\r\n      .project-item label {\r\n        flex: 1;\r\n        font-size: 14px;\r\n        color: var(--text-primary);\r\n        cursor: pointer;\r\n      }\r\n\r\n      .project-item .primary-badge {\r\n        padding: 3px 8px;\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        color: white;\r\n        border-radius: 4px;\r\n        font-size: 10px;\r\n        font-weight: 600;\r\n      }\r\n\r\n      /* Relations Section */\r\n      .relations-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n\r\n      .relation-card {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 14px;\r\n        padding: 14px;\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .relation-card:hover {\r\n        border-color: rgba(225,29,72,0.3);\r\n        transform: translateX(4px);\r\n      }\r\n\r\n      .relation-avatar {\r\n        width: 44px;\r\n        height: 44px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #6366f1, #4f46e5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 16px;\r\n        font-weight: 600;\r\n        color: white;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .relation-avatar img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n\r\n      .relation-info {\r\n        flex: 1;\r\n      }\r\n\r\n      .relation-info h4 {\r\n        margin: 0 0 2px 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .relation-info p {\r\n        margin: 0;\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .relation-type {\r\n        padding: 4px 10px;\r\n        background: rgba(99,102,241,0.1);\r\n        color: #6366f1;\r\n        border-radius: 6px;\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n      }\r\n\r\n      .add-relation-btn {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        gap: 8px;\r\n        padding: 14px;\r\n        background: var(--bg-secondary);\r\n        border: 2px dashed var(--border-color);\r\n        border-radius: 12px;\r\n        color: var(--text-secondary);\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .add-relation-btn:hover {\r\n        border-color: #e11d48;\r\n        color: #e11d48;\r\n      }\r\n\r\n      .add-relation-btn svg {\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n\r\n      /* Activity Section */\r\n      .activity-timeline {\r\n        position: relative;\r\n        padding-left: 28px;\r\n      }\r\n\r\n      .activity-timeline::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: 8px;\r\n        top: 0;\r\n        bottom: 0;\r\n        width: 2px;\r\n        background: var(--border-color);\r\n      }\r\n\r\n      .activity-item {\r\n        position: relative;\r\n        padding-bottom: 20px;\r\n      }\r\n\r\n      .activity-item::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: -24px;\r\n        top: 4px;\r\n        width: 12px;\r\n        height: 12px;\r\n        border-radius: 50%;\r\n        background: #e11d48;\r\n        border: 2px solid var(--bg-primary);\r\n      }\r\n\r\n      .activity-item.email::before { background: #3b82f6; }\r\n      .activity-item.meeting::before { background: #10b981; }\r\n      .activity-item.note::before { background: #f59e0b; }\r\n\r\n      .activity-time {\r\n        font-size: 11px;\r\n        color: var(--text-tertiary);\r\n        margin-bottom: 4px;\r\n      }\r\n\r\n      .activity-content {\r\n        font-size: 14px;\r\n        color: var(--text-primary);\r\n        line-height: 1.5;\r\n      }\r\n\r\n      .activity-empty {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .activity-empty svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        opacity: 0.4;\r\n        margin-bottom: 12px;\r\n      }\r\n\r\n      /* Footer */\r\n      .contact-modal-footer {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        padding: 20px 32px;\r\n        border-top: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n\r\n      .footer-left {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .footer-right {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .btn-sota {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 12px 20px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n\r\n      .btn-sota.primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n\r\n      .btn-sota.primary:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 6px 16px rgba(225,29,72,0.4);\r\n      }\r\n\r\n      .btn-sota.secondary {\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n\r\n      .btn-sota.secondary:hover {\r\n        background: var(--bg-tertiary);\r\n        border-color: #e11d48;\r\n      }\r\n\r\n      .btn-sota.danger {\r\n        background: transparent;\r\n        color: #dc2626;\r\n        border: 1px solid #dc2626;\r\n      }\r\n\r\n      .btn-sota.danger:hover {\r\n        background: #dc2626;\r\n        color: white;\r\n      }\r\n\r\n      .btn-sota svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      .btn-sota:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n      }\r\n\r\n      /* Loading */\r\n      .loading-spinner {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 40px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .loading-spinner::after {\r\n        content: '';\r\n        width: 24px;\r\n        height: 24px;\r\n        border: 3px solid var(--border-color);\r\n        border-top-color: #e11d48;\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n        margin-left: 12px;\r\n      }\r\n\r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n    </style>\r\n\r\n    <!-- Header -->\r\n    <div class=\"contact-modal-header\">\r\n      <button class=\"contact-modal-close\" id=\"close-contact-btn\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n        </svg>\r\n      </button>\r\n\r\n      <div class=\"contact-header-content\">\r\n        <div class=\"contact-avatar-large\" id=\"contact-avatar-upload\">\r\n          ${hasPhoto \r\n            ? `<img src=\"${photoUrl}\" alt=\"\">`\r\n            : `<span>${initials}</span>`\r\n          }\r\n          <div class=\"avatar-upload-hint\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n            </svg>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"contact-header-info\">\r\n          <h2 id=\"header-contact-name\">${isEdit ? escapeHtml(contact?.name || '') : 'New Contact'}</h2>\r\n          <p id=\"header-contact-org\">${isEdit && contact?.organization ? escapeHtml(contact.organization) : 'Add organization'}</p>\r\n        </div>\r\n\r\n        ${isEdit ? `\r\n          <div class=\"contact-header-actions\">\r\n            <button class=\"header-action-btn\" id=\"enrich-ai-btn\" title=\"Enrich with AI\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n              </svg>\r\n              Enrich with AI\r\n            </button>\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Tabs -->\r\n    <div class=\"contact-tabs\">\r\n      <button class=\"contact-tab-btn active\" data-tab=\"info\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n        </svg>\r\n        Info\r\n      </button>\r\n      <button class=\"contact-tab-btn\" data-tab=\"projects\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\r\n        </svg>\r\n        Projects\r\n        <span class=\"tab-count\" id=\"projects-count\">0</span>\r\n      </button>\r\n      <button class=\"contact-tab-btn\" data-tab=\"relations\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n        </svg>\r\n        Relations\r\n        <span class=\"tab-count\" id=\"relations-count\">0</span>\r\n      </button>\r\n      <button class=\"contact-tab-btn\" data-tab=\"activity\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n        </svg>\r\n        Activity\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Tab Content -->\r\n    <div class=\"contact-tab-content\">\r\n      <!-- Info Section -->\r\n      <div class=\"contact-section active\" id=\"section-info\">\r\n        <form id=\"contact-form\">\r\n          <div class=\"form-grid\">\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Name *\r\n              </label>\r\n              <input type=\"text\" id=\"contact-name\" required value=\"${escapeHtml(contact?.name || '')}\" placeholder=\"Full name\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Role\r\n              </label>\r\n              <select id=\"contact-role\">\r\n                <option value=\"\">-- Select role --</option>\r\n                <option value=\"__custom__\">Custom role...</option>\r\n              </select>\r\n              <input type=\"text\" id=\"contact-role-custom\" placeholder=\"Enter custom role\" style=\"display: none; margin-top: 8px;\" value=\"${contact?.role && !roleTemplates.some(r => r.display_name === contact.role) ? escapeHtml(contact.role) : ''}\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Email\r\n              </label>\r\n              <input type=\"email\" id=\"contact-email\" value=\"${escapeHtml(contact?.email || '')}\" placeholder=\"email@example.com\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"/>\r\n                </svg>\r\n                Phone\r\n              </label>\r\n              <input type=\"tel\" id=\"contact-phone\" value=\"${escapeHtml(contact?.phone || '')}\" placeholder=\"+1 234 567 890\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\r\n                </svg>\r\n                Organization\r\n              </label>\r\n              <input type=\"text\" id=\"contact-organization\" value=\"${escapeHtml(contact?.organization || contact?.company || '')}\" placeholder=\"Company name\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9\"/>\r\n                </svg>\r\n                LinkedIn\r\n              </label>\r\n              <input type=\"url\" id=\"contact-linkedin\" value=\"${escapeHtml(contact?.linkedin || '')}\" placeholder=\"https://linkedin.com/in/...\">\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Avatar URL\r\n              </label>\r\n              <input type=\"url\" id=\"contact-avatar-url\" value=\"${escapeHtml(contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url || '')}\" placeholder=\"https://example.com/photo.jpg\">\r\n              <div class=\"form-hint\">Enter a URL to set the contact's profile picture</div>\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\r\n                </svg>\r\n                Department\r\n              </label>\r\n              <input type=\"text\" id=\"contact-department\" value=\"${escapeHtml(contact?.department || '')}\" placeholder=\"Engineering, Sales, etc.\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"/>\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n                </svg>\r\n                Location\r\n              </label>\r\n              <input type=\"text\" id=\"contact-location\" value=\"${escapeHtml(contact?.location || '')}\" placeholder=\"City, Country\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n                </svg>\r\n                Timezone\r\n              </label>\r\n              <select id=\"contact-timezone\" data-current=\"${escapeHtml(contact?.timezone || '')}\">\r\n                <option value=\"\">Select timezone...</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n                </svg>\r\n                Aliases\r\n              </label>\r\n              <input type=\"text\" id=\"contact-aliases\" value=\"${contact?.aliases?.join(', ') || ''}\" placeholder=\"Alternative names (comma separated)\">\r\n              <div class=\"form-hint\">Names used to identify this person in documents (e.g., \"Luuc\" for \"Luuk\")</div>\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\r\n                </svg>\r\n                Notes\r\n              </label>\r\n              <textarea id=\"contact-notes\" placeholder=\"Additional notes about this contact...\">${escapeHtml(contact?.notes || '')}</textarea>\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\"/>\r\n                </svg>\r\n                Tags\r\n              </label>\r\n              <input type=\"text\" id=\"contact-tags\" value=\"${contact?.tags?.join(', ') || ''}\" placeholder=\"client, vip, technical (comma separated)\">\r\n              <div class=\"form-hint\">Separate tags with commas</div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n\r\n      <!-- Projects Section -->\r\n      <div class=\"contact-section\" id=\"section-projects\">\r\n        <div class=\"projects-list\" id=\"projects-list\">\r\n          <div class=\"loading-spinner\">Loading projects</div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Relations Section -->\r\n      <div class=\"contact-section\" id=\"section-relations\">\r\n        <div class=\"relations-list\" id=\"relations-list\">\r\n          <div class=\"loading-spinner\">Loading relations</div>\r\n        </div>\r\n        <button class=\"add-relation-btn\" id=\"add-relation-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Add Relationship\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Activity Section -->\r\n      <div class=\"contact-section\" id=\"section-activity\">\r\n        <div class=\"activity-timeline\" id=\"activity-timeline\">\r\n          <div class=\"loading-spinner\">Loading activity</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Footer -->\r\n    <div class=\"contact-modal-footer\">\r\n      <div class=\"footer-left\">\r\n        ${isEdit ? `\r\n          <button class=\"btn-sota danger\" id=\"delete-contact-btn\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\r\n            </svg>\r\n            Delete\r\n          </button>\r\n        ` : ''}\r\n      </div>\r\n      <div class=\"footer-right\">\r\n        <button class=\"btn-sota secondary\" id=\"cancel-contact-btn\">Cancel</button>\r\n        <button class=\"btn-sota primary\" id=\"save-contact-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n          </svg>\r\n          ${isEdit ? 'Save Changes' : 'Create Contact'}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load contact data for edit mode\r\n */\r\nasync function loadContactData(container: HTMLElement, contactId: string): Promise<void> {\r\n  try {\r\n    const [projectsRes, relationsRes, activityRes, rolesRes, allProjectsRes, timezonesRes] = await Promise.all([\r\n      http.get<{ projects: ContactProject[] }>(`/api/contacts/${contactId}/projects`).catch(() => ({ data: { projects: [] } })),\r\n      http.get<{ relationships: ContactRelation[] }>(`/api/contacts/${contactId}/relationships`).catch(() => ({ data: { relationships: [] } })),\r\n      http.get<{ activities: ContactActivity[] }>(`/api/contacts/${contactId}/activity`).catch(() => ({ data: { activities: [] } })),\r\n      http.get<{ roles: RoleTemplate[] }>('/api/role-templates').catch(() => ({ data: { roles: [] } })),\r\n      http.get<{ projects: { id: string; name: string }[] }>('/api/projects').catch(() => ({ data: { projects: [] } })),\r\n      http.get<{ timezones: { code: string; name: string; utc_offset: string }[] }>('/api/timezones').catch(() => ({ data: { timezones: [] } })),\r\n    ]);\r\n\r\n    contactProjects = projectsRes.data?.projects || [];\r\n    contactRelations = relationsRes.data?.relationships || [];\r\n    contactActivity = activityRes.data?.activities || [];\r\n    roleTemplates = rolesRes.data?.roles || [];\r\n    allProjects = allProjectsRes.data?.projects || [];\r\n    const timezones = timezonesRes.data?.timezones || [];\r\n\r\n    // Render timezone dropdown\r\n    renderTimezoneDropdown(container, timezones);\r\n\r\n    // Render sections\r\n    renderRoleDropdown(container);\r\n    renderProjectsList(container);\r\n    renderRelationsList(container);\r\n    renderActivityTimeline(container);\r\n    \r\n    // Update counts\r\n    updateTabCounts(container);\r\n  } catch (error) {\r\n    console.error('Failed to load contact data:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Load role templates\r\n */\r\nasync function loadRoleTemplates(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ roles: RoleTemplate[] }>('/api/role-templates');\r\n    roleTemplates = response.data?.roles || [];\r\n    renderRoleDropdown(container);\r\n  } catch {\r\n    roleTemplates = [];\r\n  }\r\n}\r\n\r\n/**\r\n * Load timezones for new contact\r\n */\r\nasync function loadTimezones(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ timezones: { code: string; name: string; utc_offset: string }[] }>('/api/timezones');\r\n    const timezones = response.data?.timezones || [];\r\n    renderTimezoneDropdown(container, timezones);\r\n  } catch {\r\n    // Leave empty\r\n  }\r\n}\r\n\r\n/**\r\n * Load all projects\r\n */\r\nasync function loadAllProjects(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ projects: { id: string; name: string }[] }>('/api/projects');\r\n    allProjects = response.data?.projects || [];\r\n    renderProjectsList(container);\r\n  } catch {\r\n    allProjects = [];\r\n  }\r\n}\r\n\r\n/**\r\n * Render timezone dropdown\r\n */\r\nfunction renderTimezoneDropdown(container: HTMLElement, timezones: { code: string; name: string; utc_offset: string }[]): void {\r\n  const tzSelect = container.querySelector('#contact-timezone') as HTMLSelectElement;\r\n  if (!tzSelect) return;\r\n\r\n  const currentTz = tzSelect.dataset.current || '';\r\n  \r\n  // Group timezones by region\r\n  const grouped: Record<string, typeof timezones> = {};\r\n  for (const tz of timezones) {\r\n    const region = tz.code.includes('/') ? tz.code.split('/')[0] : 'Other';\r\n    if (!grouped[region]) grouped[region] = [];\r\n    grouped[region].push(tz);\r\n  }\r\n\r\n  // Sort regions\r\n  const sortedRegions = Object.keys(grouped).sort();\r\n\r\n  tzSelect.innerHTML = `\r\n    <option value=\"\">Select timezone...</option>\r\n    ${sortedRegions.map(region => `\r\n      <optgroup label=\"${region}\">\r\n        ${grouped[region].map(tz => `\r\n          <option value=\"${escapeHtml(tz.code)}\" ${currentTz === tz.code ? 'selected' : ''}>\r\n            ${escapeHtml(tz.name || tz.code)} (${tz.utc_offset})\r\n          </option>\r\n        `).join('')}\r\n      </optgroup>\r\n    `).join('')}\r\n  `;\r\n}\r\n\r\n/**\r\n * Render role dropdown\r\n */\r\nfunction renderRoleDropdown(container: HTMLElement): void {\r\n  const roleSelect = container.querySelector('#contact-role') as HTMLSelectElement;\r\n  const customInput = container.querySelector('#contact-role-custom') as HTMLInputElement;\r\n  if (!roleSelect) return;\r\n\r\n  const currentRole = currentContact?.role;\r\n  const isCustomRole = currentRole && !roleTemplates.some(r => r.display_name === currentRole || r.name === currentRole);\r\n\r\n  roleSelect.innerHTML = `\r\n    <option value=\"\">-- Select role --</option>\r\n    ${roleTemplates.filter(r => r.is_active).map(r => `\r\n      <option value=\"${escapeHtml(r.display_name || r.name)}\" ${currentRole === r.display_name || currentRole === r.name ? 'selected' : ''}>\r\n        ${escapeHtml(r.display_name || r.name)}\r\n      </option>\r\n    `).join('')}\r\n    <option value=\"__custom__\" ${isCustomRole ? 'selected' : ''}>Custom role...</option>\r\n  `;\r\n\r\n  // Show custom input if custom is selected\r\n  if (isCustomRole && customInput) {\r\n    customInput.style.display = 'block';\r\n    customInput.value = currentRole;\r\n  }\r\n\r\n  // Handle role change\r\n  on(roleSelect, 'change', () => {\r\n    const isCustom = roleSelect.value === '__custom__';\r\n    customInput.style.display = isCustom ? 'block' : 'none';\r\n    if (isCustom) {\r\n      customInput.focus();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render projects list\r\n */\r\nfunction renderProjectsList(container: HTMLElement): void {\r\n  const listContainer = container.querySelector('#projects-list') as HTMLElement;\r\n  if (!listContainer) return;\r\n\r\n  if (allProjects.length === 0) {\r\n    listContainer.innerHTML = '<p style=\"color: var(--text-secondary); text-align: center; padding: 20px;\">No projects available</p>';\r\n    return;\r\n  }\r\n\r\n  const associatedIds = new Set(contactProjects.map(p => p.id));\r\n\r\n  listContainer.innerHTML = allProjects.map(project => `\r\n    <div class=\"project-item\">\r\n      <input type=\"checkbox\" class=\"project-checkbox\" name=\"contact-project\" value=\"${project.id}\" \r\n             ${associatedIds.has(project.id) ? 'checked' : ''}>\r\n      <label>${escapeHtml(project.name)}</label>\r\n      ${contactProjects.find(p => p.id === project.id)?.is_primary ? '<span class=\"primary-badge\">Primary</span>' : ''}\r\n    </div>\r\n  `).join('');\r\n\r\n  container.querySelector('#projects-count')!.textContent = String(associatedIds.size);\r\n}\r\n\r\n/**\r\n * Render relations list\r\n */\r\nfunction renderRelationsList(container: HTMLElement): void {\r\n  const listContainer = container.querySelector('#relations-list') as HTMLElement;\r\n  if (!listContainer) return;\r\n\r\n  if (contactRelations.length === 0) {\r\n    listContainer.innerHTML = `\r\n      <div class=\"activity-empty\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n        </svg>\r\n        <p>No relationships yet</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  listContainer.innerHTML = contactRelations.map(relation => {\r\n    const contact = relation.to_contact;\r\n    const initials = contact ? getInitials(contact.name) : '?';\r\n\r\n    return `\r\n      <div class=\"relation-card\" data-id=\"${relation.id}\">\r\n        <div class=\"relation-avatar\">\r\n          ${contact?.avatar_url \r\n            ? `<img src=\"${contact.avatar_url}\" alt=\"\">`\r\n            : initials\r\n          }\r\n        </div>\r\n        <div class=\"relation-info\">\r\n          <h4>${escapeHtml(contact?.name || 'Unknown')}</h4>\r\n          <p>${escapeHtml(contact?.organization || contact?.role || '')}</p>\r\n        </div>\r\n        <span class=\"relation-type\">${formatRelationType(relation.relationship_type)}</span>\r\n      </div>\r\n    `;\r\n  }).join('');\r\n\r\n  container.querySelector('#relations-count')!.textContent = String(contactRelations.length);\r\n}\r\n\r\n/**\r\n * Render activity timeline\r\n */\r\nfunction renderActivityTimeline(container: HTMLElement): void {\r\n  const timeline = container.querySelector('#activity-timeline') as HTMLElement;\r\n  if (!timeline) return;\r\n\r\n  if (contactActivity.length === 0) {\r\n    timeline.innerHTML = `\r\n      <div class=\"activity-empty\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n        </svg>\r\n        <p>No activity recorded yet</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  timeline.innerHTML = contactActivity.map(activity => `\r\n    <div class=\"activity-item ${activity.activity_type}\">\r\n      <div class=\"activity-time\">${formatDate(activity.occurred_at)}</div>\r\n      <div class=\"activity-content\">${escapeHtml(activity.description)}</div>\r\n    </div>\r\n  `).join('');\r\n}\r\n\r\n/**\r\n * Update tab counts\r\n */\r\nfunction updateTabCounts(container: HTMLElement): void {\r\n  const projectsCount = container.querySelector('#projects-count');\r\n  const relationsCount = container.querySelector('#relations-count');\r\n\r\n  if (projectsCount) projectsCount.textContent = String(contactProjects.length);\r\n  if (relationsCount) relationsCount.textContent = String(contactRelations.length);\r\n}\r\n\r\n/**\r\n * Bind events\r\n */\r\nfunction bindEvents(container: HTMLElement, props: ContactModalProps): void {\r\n  const { mode, contact, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit';\r\n\r\n  // Close button\r\n  const closeBtn = container.querySelector('#close-contact-btn');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n  }\r\n\r\n  // Cancel button\r\n  const cancelBtn = container.querySelector('#cancel-contact-btn');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n  }\r\n\r\n  // Tab switching\r\n  const tabs = container.querySelectorAll('.contact-tab-btn');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n\r\n      const tabId = tab.getAttribute('data-tab');\r\n      container.querySelectorAll('.contact-section').forEach(section => {\r\n        section.classList.toggle('active', section.id === `section-${tabId}`);\r\n      });\r\n    });\r\n  });\r\n\r\n  // Save button\r\n  const saveBtn = container.querySelector('#save-contact-btn') as HTMLButtonElement;\r\n  if (saveBtn) {\r\n    on(saveBtn, 'click', async () => {\r\n      const form = container.querySelector('#contact-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const getValue = (id: string) => (container.querySelector(`#${id}`) as HTMLInputElement)?.value.trim() || '';\r\n      \r\n      // Get role value\r\n      const roleSelect = container.querySelector('#contact-role') as HTMLSelectElement;\r\n      const customRoleInput = container.querySelector('#contact-role-custom') as HTMLInputElement;\r\n      const role = roleSelect.value === '__custom__' ? customRoleInput.value.trim() : roleSelect.value;\r\n\r\n      const tagsInput = getValue('contact-tags');\r\n      const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(Boolean) : [];\r\n\r\n      // Get aliases\r\n      const aliasesInput = getValue('contact-aliases');\r\n      const aliases = aliasesInput ? aliasesInput.split(',').map(a => a.trim()).filter(Boolean) : [];\r\n\r\n      const contactData: Contact = {\r\n        id: contact?.id || `contact-${Date.now()}`,\r\n        name: getValue('contact-name'),\r\n        email: getValue('contact-email') || undefined,\r\n        phone: getValue('contact-phone') || undefined,\r\n        organization: getValue('contact-organization') || undefined,\r\n        company: getValue('contact-organization') || undefined,\r\n        role: role || undefined,\r\n        department: getValue('contact-department') || undefined,\r\n        linkedin: getValue('contact-linkedin') || undefined,\r\n        location: getValue('contact-location') || undefined,\r\n        timezone: getValue('contact-timezone') || undefined,\r\n        photoUrl: getValue('contact-avatar-url') || undefined,\r\n        avatarUrl: getValue('contact-avatar-url') || undefined,\r\n        aliases: aliases.length > 0 ? aliases : undefined,\r\n        notes: getValue('contact-notes') || undefined,\r\n        tags: tags.length > 0 ? tags : undefined,\r\n      };\r\n\r\n      // Get selected projects\r\n      const selectedProjects: string[] = [];\r\n      container.querySelectorAll('input[name=\"contact-project\"]:checked').forEach(input => {\r\n        selectedProjects.push((input as HTMLInputElement).value);\r\n      });\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        let savedContactId = contact?.id;\r\n        \r\n        if (isEdit) {\r\n          await http.put(`/api/contacts/${contact!.id}`, contactData);\r\n          toast.success('Contact updated');\r\n        } else {\r\n          const response = await http.post<{ id: string }>('/api/contacts', contactData);\r\n          contactData.id = response.data.id;\r\n          savedContactId = response.data.id;\r\n          toast.success('Contact created');\r\n        }\r\n\r\n        // Save project associations\r\n        if (savedContactId && selectedProjects.length >= 0) {\r\n          try {\r\n            await http.post(`/api/contacts/${savedContactId}/projects/sync`, {\r\n              projectIds: selectedProjects\r\n            });\r\n          } catch (err) {\r\n            console.warn('Failed to sync project associations:', err);\r\n          }\r\n        }\r\n\r\n        onSave?.(contactData);\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        toast.error('Failed to save contact');\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.innerHTML = `\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n          </svg>\r\n          ${isEdit ? 'Save Changes' : 'Create Contact'}\r\n        `;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete button\r\n  const deleteBtn = container.querySelector('#delete-contact-btn');\r\n  if (deleteBtn && isEdit) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      const confirmed = await confirm(\r\n        `Are you sure you want to delete \"${contact!.name}\"?`,\r\n        {\r\n          title: 'Delete Contact',\r\n          confirmText: 'Delete',\r\n          confirmClass: 'btn-danger',\r\n        }\r\n      );\r\n\r\n      if (confirmed) {\r\n        try {\r\n          await http.delete(`/api/contacts/${contact!.id}`);\r\n          toast.success('Contact deleted');\r\n          onDelete?.(contact!.id);\r\n          closeModal(MODAL_ID);\r\n        } catch {\r\n          toast.error('Failed to delete contact');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI Enrich button\r\n  const enrichBtn = container.querySelector('#enrich-ai-btn');\r\n  if (enrichBtn && isEdit) {\r\n    on(enrichBtn as HTMLElement, 'click', async () => {\r\n      toast.info('AI enrichment is processing...');\r\n      try {\r\n        await http.post(`/api/contacts/${contact!.id}/enrich`);\r\n        toast.success('Contact enriched! Refreshing...');\r\n        // Reload modal with updated data\r\n        closeModal(MODAL_ID);\r\n        const response = await http.get<{ contact: Contact }>(`/api/contacts/${contact!.id}`);\r\n        showContactModal({ ...props, contact: response.data.contact });\r\n      } catch {\r\n        toast.error('AI enrichment failed');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Add relation button\r\n  const addRelationBtn = container.querySelector('#add-relation-btn');\r\n  if (addRelationBtn && contact?.id) {\r\n    on(addRelationBtn as HTMLElement, 'click', () => {\r\n      showAddRelationDialog(container, contact.id, props);\r\n    });\r\n  }\r\n\r\n  // Update header on name/org input change\r\n  const nameInput = container.querySelector('#contact-name') as HTMLInputElement;\r\n  const orgInput = container.querySelector('#contact-organization') as HTMLInputElement;\r\n  const headerName = container.querySelector('#header-contact-name');\r\n  const headerOrg = container.querySelector('#header-contact-org');\r\n\r\n  if (nameInput && headerName) {\r\n    on(nameInput, 'input', () => {\r\n      headerName.textContent = nameInput.value || 'New Contact';\r\n      // Update avatar initials\r\n      const avatar = container.querySelector('.contact-avatar-large');\r\n      if (avatar && !avatar.querySelector('img')) {\r\n        const span = avatar.querySelector('span');\r\n        if (span) span.textContent = getInitials(nameInput.value || '?');\r\n      }\r\n    });\r\n  }\r\n\r\n  if (orgInput && headerOrg) {\r\n    on(orgInput, 'input', () => {\r\n      headerOrg.textContent = orgInput.value || 'Add organization';\r\n    });\r\n  }\r\n\r\n  // Update avatar preview on URL input change\r\n  const avatarUrlInput = container.querySelector('#contact-avatar-url') as HTMLInputElement;\r\n  const avatarContainer = container.querySelector('.contact-avatar-large');\r\n  \r\n  if (avatarUrlInput && avatarContainer) {\r\n    on(avatarUrlInput, 'input', () => {\r\n      const url = avatarUrlInput.value.trim();\r\n      if (url) {\r\n        // Test if image loads\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          avatarContainer.innerHTML = `\r\n            <img src=\"${url}\" alt=\"\">\r\n            <div class=\"avatar-upload-hint\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n              </svg>\r\n            </div>\r\n          `;\r\n        };\r\n        img.onerror = () => {\r\n          // Keep initials if image fails\r\n          const currentName = (container.querySelector('#contact-name') as HTMLInputElement)?.value || '?';\r\n          avatarContainer.innerHTML = `\r\n            <span>${getInitials(currentName)}</span>\r\n            <div class=\"avatar-upload-hint\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n              </svg>\r\n            </div>\r\n          `;\r\n        };\r\n        img.src = url;\r\n      } else {\r\n        // No URL - show initials\r\n        const currentName = (container.querySelector('#contact-name') as HTMLInputElement)?.value || '?';\r\n        avatarContainer.innerHTML = `\r\n          <span>${getInitials(currentName)}</span>\r\n          <div class=\"avatar-upload-hint\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n            </svg>\r\n          </div>\r\n        `;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Show dialog to add a relationship to another contact\r\n */\r\nasync function showAddRelationDialog(parentContainer: HTMLElement, contactId: string, props: ContactModalProps): Promise<void> {\r\n  // Fetch all contacts for selection\r\n  let availableContacts: { id: string; name: string; organization?: string }[] = [];\r\n  try {\r\n    const response = await http.get<{ contacts: { id: string; name: string; organization?: string }[] }>('/api/contacts');\r\n    availableContacts = (response.data?.contacts || []).filter(c => c.id !== contactId);\r\n  } catch {\r\n    toast.error('Failed to load contacts');\r\n    return;\r\n  }\r\n\r\n  if (availableContacts.length === 0) {\r\n    toast.info('No other contacts available to create a relationship');\r\n    return;\r\n  }\r\n\r\n  // Create overlay dialog\r\n  const overlay = createElement('div', { className: 'relation-dialog-overlay' });\r\n  overlay.innerHTML = `\r\n    <style>\r\n      .relation-dialog-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0,0,0,0.5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 10000;\r\n        animation: fadeIn 0.2s ease;\r\n      }\r\n      \r\n      @keyframes fadeIn {\r\n        from { opacity: 0; }\r\n        to { opacity: 1; }\r\n      }\r\n      \r\n      .relation-dialog {\r\n        background: var(--bg-primary);\r\n        border-radius: 16px;\r\n        padding: 24px;\r\n        width: 400px;\r\n        max-width: 90vw;\r\n        box-shadow: 0 25px 50px rgba(0,0,0,0.25);\r\n        animation: slideUp 0.2s ease;\r\n      }\r\n      \r\n      @keyframes slideUp {\r\n        from { transform: translateY(20px); opacity: 0; }\r\n        to { transform: translateY(0); opacity: 1; }\r\n      }\r\n      \r\n      .relation-dialog h3 {\r\n        margin: 0 0 20px 0;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n      }\r\n      \r\n      .relation-dialog h3 svg {\r\n        width: 22px;\r\n        height: 22px;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .relation-dialog-field {\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      .relation-dialog-field label {\r\n        display: block;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 6px;\r\n      }\r\n      \r\n      .relation-dialog-field select {\r\n        width: 100%;\r\n        padding: 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        font-size: 14px;\r\n      }\r\n      \r\n      .relation-dialog-field select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n      }\r\n      \r\n      .relation-dialog-actions {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 10px;\r\n        margin-top: 24px;\r\n      }\r\n      \r\n      .relation-dialog-actions button {\r\n        padding: 10px 20px;\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .relation-dialog-actions .cancel-btn {\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .relation-dialog-actions .cancel-btn:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .relation-dialog-actions .save-btn {\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        border: none;\r\n        color: white;\r\n      }\r\n      \r\n      .relation-dialog-actions .save-btn:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .relation-dialog-actions .save-btn:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n        transform: none;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"relation-dialog\">\r\n      <h3>\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n        </svg>\r\n        Add Relationship\r\n      </h3>\r\n      \r\n      <div class=\"relation-dialog-field\">\r\n        <label>Related Contact</label>\r\n        <select id=\"rel-contact-select\">\r\n          <option value=\"\">-- Select contact --</option>\r\n          ${availableContacts.map(c => `\r\n            <option value=\"${c.id}\">${escapeHtml(c.name)}${c.organization ? ` (${escapeHtml(c.organization)})` : ''}</option>\r\n          `).join('')}\r\n        </select>\r\n      </div>\r\n      \r\n      <div class=\"relation-dialog-field\">\r\n        <label>Relationship Type</label>\r\n        <select id=\"rel-type-select\">\r\n          <option value=\"\">-- Select type --</option>\r\n          <option value=\"reports_to\">Reports to</option>\r\n          <option value=\"manages\">Manages</option>\r\n          <option value=\"works_with\">Works with</option>\r\n          <option value=\"knows\">Knows</option>\r\n          <option value=\"referred_by\">Referred by</option>\r\n        </select>\r\n      </div>\r\n      \r\n      <div class=\"relation-dialog-actions\">\r\n        <button class=\"cancel-btn\" id=\"rel-cancel-btn\">Cancel</button>\r\n        <button class=\"save-btn\" id=\"rel-save-btn\">Add Relationship</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Bind events\r\n  const cancelBtn = overlay.querySelector('#rel-cancel-btn');\r\n  const saveBtn = overlay.querySelector('#rel-save-btn') as HTMLButtonElement;\r\n  const contactSelect = overlay.querySelector('#rel-contact-select') as HTMLSelectElement;\r\n  const typeSelect = overlay.querySelector('#rel-type-select') as HTMLSelectElement;\r\n\r\n  // Close on cancel or overlay click\r\n  const closeDialog = () => overlay.remove();\r\n  \r\n  on(cancelBtn as HTMLElement, 'click', closeDialog);\r\n  on(overlay, 'click', (e: Event) => {\r\n    if (e.target === overlay) closeDialog();\r\n  });\r\n\r\n  // Save relationship\r\n  on(saveBtn, 'click', async () => {\r\n    const toContactId = contactSelect.value;\r\n    const relationType = typeSelect.value;\r\n\r\n    if (!toContactId || !relationType) {\r\n      toast.error('Please select both a contact and relationship type');\r\n      return;\r\n    }\r\n\r\n    saveBtn.disabled = true;\r\n    saveBtn.textContent = 'Saving...';\r\n\r\n    try {\r\n      await http.post(`/api/contacts/${contactId}/relationships`, {\r\n        toContactId,\r\n        type: relationType\r\n      });\r\n\r\n      toast.success('Relationship added');\r\n      closeDialog();\r\n\r\n      // Reload contact data to show new relationship\r\n      const relationsRes = await http.get<{ relationships: ContactRelation[] }>(`/api/contacts/${contactId}/relationships`);\r\n      contactRelations = relationsRes.data?.relationships || [];\r\n      renderRelationsList(parentContainer);\r\n      updateTabCounts(parentContainer);\r\n    } catch (error: unknown) {\r\n      const message = error instanceof Error ? error.message : 'Failed to add relationship';\r\n      toast.error(message);\r\n      saveBtn.disabled = false;\r\n      saveBtn.textContent = 'Add Relationship';\r\n    }\r\n  });\r\n}\r\n\r\n// Helpers\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2) || '?';\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatRelationType(type: string): string {\r\n  const types: Record<string, string> = {\r\n    reports_to: 'Reports to',\r\n    manages: 'Manages',\r\n    works_with: 'Works with',\r\n    knows: 'Knows',\r\n    referred_by: 'Referred by',\r\n  };\r\n  return types[type] || type.replace(/_/g, ' ');\r\n}\r\n\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - date.getTime();\r\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n\r\n  if (diffDays === 0) return 'Today';\r\n  if (diffDays === 1) return 'Yesterday';\r\n  if (diffDays < 7) return `${diffDays} days ago`;\r\n  \r\n  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\r\n}\r\n\r\nexport default showContactModal;\r\n","/**\r\n * Team Modal Component\r\n * Manage project team members\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'team-modal';\r\n\r\nexport interface TeamMember {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  role: 'superadmin' | 'admin' | 'member';\r\n  joinedAt: string;\r\n  avatarUrl?: string;\r\n}\r\n\r\nexport interface TeamModalProps {\r\n  projectId?: string;\r\n  mode?: 'view' | 'edit' | 'manage' | 'create';\r\n  team?: { id: string; name: string };\r\n  onInvite?: () => void;\r\n  onSave?: (team: { name: string; description?: string }) => void;\r\n  onRemove?: (memberId: string) => void;\r\n  onRoleChange?: (memberId: string, role: TeamMember['role']) => void;\r\n}\r\n\r\nlet currentMembers: TeamMember[] = [];\r\n\r\n/**\r\n * Show team modal\r\n */\r\nexport async function showTeamModal(props: TeamModalProps): Promise<void> {\r\n  const { projectId, onInvite, onRemove, onRoleChange } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'team-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading team members...</div>';\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const inviteBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Invite Member',\r\n  });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  on(inviteBtn, 'click', () => {\r\n    closeModal(MODAL_ID);\r\n    onInvite?.();\r\n  });\r\n\r\n  footer.appendChild(closeBtn);\r\n  footer.appendChild(inviteBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Team Members',\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load team members\r\n  try {\r\n    const response = await http.get<TeamMember[]>(`/api/projects/${projectId}/members`);\r\n    currentMembers = response.data;\r\n    renderMembers(content, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load team members</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render team members list\r\n */\r\nfunction renderMembers(container: HTMLElement, props: TeamModalProps): void {\r\n  if (currentMembers.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No team members yet</p>\r\n        <p class=\"text-muted\">Invite members to collaborate on this project</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"team-list\">\r\n      ${currentMembers.map(member => renderMemberCard(member)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind actions\r\n  container.querySelectorAll('.member-card').forEach(card => {\r\n    const memberId = card.getAttribute('data-member-id');\r\n    if (!memberId) return;\r\n\r\n    const member = currentMembers.find(m => m.id === memberId);\r\n    if (!member) return;\r\n\r\n    // Role change\r\n    const roleSelect = card.querySelector('.role-select') as HTMLSelectElement;\r\n    if (roleSelect) {\r\n      on(roleSelect, 'change', async () => {\r\n        const newRole = roleSelect.value as TeamMember['role'];\r\n        try {\r\n          await http.patch(`/api/projects/${props.projectId}/members/${memberId}`, { role: newRole });\r\n          member.role = newRole;\r\n          toast.success('Role updated');\r\n          props.onRoleChange?.(memberId, newRole);\r\n        } catch {\r\n          roleSelect.value = member.role;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Remove member\r\n    const removeBtn = card.querySelector('.btn-remove');\r\n    if (removeBtn) {\r\n      on(removeBtn as HTMLElement, 'click', async () => {\r\n        const { confirm } = await import('../Modal');\r\n        const confirmed = await confirm(\r\n          `Remove ${member.name} from this project?`,\r\n          {\r\n            title: 'Remove Member',\r\n            confirmText: 'Remove',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await http.delete(`/api/projects/${props.projectId}/members/${memberId}`);\r\n            currentMembers = currentMembers.filter(m => m.id !== memberId);\r\n            renderMembers(container, props);\r\n            toast.success('Member removed');\r\n            props.onRemove?.(memberId);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render individual member card\r\n */\r\nfunction renderMemberCard(member: TeamMember): string {\r\n  const initials = member.name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n\r\n  const isSuperadmin = member.role === 'superadmin';\r\n\r\n  return `\r\n    <div class=\"member-card\" data-member-id=\"${member.id}\">\r\n      <div class=\"member-avatar\">\r\n        ${member.avatarUrl \r\n          ? `<img src=\"${member.avatarUrl}\" alt=\"${escapeHtml(member.name)}\">`\r\n          : initials\r\n        }\r\n      </div>\r\n      <div class=\"member-info\">\r\n        <div class=\"member-name\">${escapeHtml(member.name)}</div>\r\n        <div class=\"member-email\">${escapeHtml(member.email)}</div>\r\n      </div>\r\n      <div class=\"member-role\">\r\n        ${isSuperadmin \r\n          ? `<span class=\"role-badge superadmin\">Owner</span>`\r\n          : `<select class=\"role-select form-control\">\r\n              <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\r\n              <option value=\"member\" ${member.role === 'member' ? 'selected' : ''}>Member</option>\r\n            </select>`\r\n        }\r\n      </div>\r\n      <div class=\"member-actions\">\r\n        ${!isSuperadmin \r\n          ? `<button class=\"btn btn-sm btn-danger btn-remove\" title=\"Remove member\"></button>`\r\n          : ''\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showTeamModal;\r\n","/**\r\n * Invite Modal Component\r\n * Invite new team members\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'invite-modal';\r\n\r\ninterface Contact {\r\n  id: string;\r\n  name: string;\r\n  email?: string;\r\n  avatar_url?: string;\r\n  photo_url?: string;\r\n  organization?: string;\r\n  role?: string;\r\n}\r\n\r\ninterface ProjectMember {\r\n  user_id: string;\r\n  linked_contact_id?: string;\r\n}\r\n\r\nexport interface InviteModalProps {\r\n  projectId: string;\r\n  onInvite?: () => void;\r\n  onInviteSent?: (email: string) => void;\r\n}\r\n\r\n// Cache for loaded data\r\nlet cachedMembers: ProjectMember[] = [];\r\n\r\n/**\r\n * Show invite modal\r\n */\r\nexport function showInviteModal(props: InviteModalProps): void {\r\n  const { projectId, onInviteSent } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'invite-modal-content' });\r\n\r\n  content.innerHTML = `\r\n    <style>\r\n      .invite-tabs {\r\n        display: flex;\r\n        gap: 0;\r\n        margin-bottom: 20px;\r\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\r\n      }\r\n      \r\n      .invite-tab-btn {\r\n        flex: 1;\r\n        padding: 12px 16px;\r\n        background: transparent;\r\n        border: none;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        color: var(--text-secondary, #64748b);\r\n        cursor: pointer;\r\n        position: relative;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .invite-tab-btn:hover {\r\n        color: var(--text-primary, #1e293b);\r\n      }\r\n      \r\n      .invite-tab-btn.active {\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .invite-tab-btn.active::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: -1px;\r\n        left: 0;\r\n        right: 0;\r\n        height: 2px;\r\n        background: #e11d48;\r\n      }\r\n      \r\n      .invite-tab-content {\r\n        display: none;\r\n      }\r\n      \r\n      .invite-tab-content.active {\r\n        display: block;\r\n      }\r\n      \r\n      .contacts-list {\r\n        max-height: 300px;\r\n        overflow-y: auto;\r\n        border: 1px solid var(--border-color, #e2e8f0);\r\n        border-radius: 8px;\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      .contact-option {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 12px 16px;\r\n        cursor: pointer;\r\n        transition: background 0.2s;\r\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\r\n      }\r\n      \r\n      .contact-option:last-child {\r\n        border-bottom: none;\r\n      }\r\n      \r\n      .contact-option:hover {\r\n        background: var(--bg-secondary, #f8fafc);\r\n      }\r\n      \r\n      .contact-option.selected {\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.04) 100%);\r\n      }\r\n      \r\n      .contact-option input[type=\"radio\"] {\r\n        display: none;\r\n      }\r\n      \r\n      .contact-option .radio-circle {\r\n        width: 18px;\r\n        height: 18px;\r\n        border: 2px solid var(--border-color, #cbd5e1);\r\n        border-radius: 50%;\r\n        flex-shrink: 0;\r\n        position: relative;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .contact-option.selected .radio-circle {\r\n        border-color: #e11d48;\r\n      }\r\n      \r\n      .contact-option.selected .radio-circle::after {\r\n        content: '';\r\n        position: absolute;\r\n        top: 3px;\r\n        left: 3px;\r\n        width: 8px;\r\n        height: 8px;\r\n        background: #e11d48;\r\n        border-radius: 50%;\r\n      }\r\n      \r\n      .contact-avatar {\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #667eea, #764ba2);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        flex-shrink: 0;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .contact-avatar img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n      \r\n      .contact-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      \r\n      .contact-name {\r\n        font-weight: 500;\r\n        color: var(--text-primary, #1e293b);\r\n        margin-bottom: 2px;\r\n      }\r\n      \r\n      .contact-email {\r\n        font-size: 12px;\r\n        color: var(--text-secondary, #64748b);\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n      \r\n      .no-contacts-msg {\r\n        padding: 24px;\r\n        text-align: center;\r\n        color: var(--text-secondary, #64748b);\r\n      }\r\n      \r\n      .email-status {\r\n        margin-top: 8px;\r\n        padding: 8px 12px;\r\n        background: #f0fdf4;\r\n        border: 1px solid #bbf7d0;\r\n        border-radius: 8px;\r\n        font-size: 12px;\r\n        color: #166534;\r\n        display: none;\r\n      }\r\n      \r\n      .email-status.show {\r\n        display: block;\r\n      }\r\n      \r\n      .email-status.error {\r\n        background: #fef2f2;\r\n        border-color: #fecaca;\r\n        color: #991b1b;\r\n      }\r\n    </style>\r\n    \r\n    <!-- Tabs -->\r\n    <div class=\"invite-tabs\">\r\n      <button type=\"button\" class=\"invite-tab-btn active\" data-tab=\"new\">\r\n        New Email\r\n      </button>\r\n      <button type=\"button\" class=\"invite-tab-btn\" data-tab=\"contacts\">\r\n        Existing Contacts\r\n      </button>\r\n    </div>\r\n    \r\n    <!-- Tab: New Email -->\r\n    <div class=\"invite-tab-content active\" id=\"tab-new\">\r\n      <form id=\"invite-form\" class=\"invite-form\">\r\n        <div class=\"form-group\">\r\n          <label for=\"invite-email\">Email Address *</label>\r\n          <input type=\"email\" id=\"invite-email\" required \r\n                 placeholder=\"colleague@example.com\">\r\n          <div class=\"form-hint\">They will receive an email invitation to join this project</div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"invite-role\">Access Level</label>\r\n          <select id=\"invite-role\">\r\n            <option value=\"read\">Viewer - Can view data only</option>\r\n            <option value=\"write\" selected>Member - Can view and edit data</option>\r\n            <option value=\"admin\">Admin - Can manage team and settings</option>\r\n          </select>\r\n          <div class=\"form-hint\" style=\"margin-top: 4px;\">You can assign a project role after they join.</div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"invite-message\">Personal Message (optional)</label>\r\n          <textarea id=\"invite-message\" rows=\"2\" \r\n                    placeholder=\"Add a personal note to the invitation...\"></textarea>\r\n        </div>\r\n        \r\n        <div class=\"email-status\" id=\"email-status\"></div>\r\n      </form>\r\n    </div>\r\n    \r\n    <!-- Tab: Existing Contacts -->\r\n    <div class=\"invite-tab-content\" id=\"tab-contacts\">\r\n      <div id=\"contacts-list\" class=\"contacts-list\">\r\n        <div class=\"no-contacts-msg\">Loading contacts...</div>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label for=\"invite-role-contact\">Access Level</label>\r\n        <select id=\"invite-role-contact\">\r\n          <option value=\"read\">Viewer - Can view data only</option>\r\n          <option value=\"write\" selected>Member - Can view and edit data</option>\r\n          <option value=\"admin\">Admin - Can manage team and settings</option>\r\n        </select>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label for=\"invite-message-contact\">Personal Message (optional)</label>\r\n        <textarea id=\"invite-message-contact\" rows=\"2\" \r\n                  placeholder=\"Add a personal note to the invitation...\"></textarea>\r\n      </div>\r\n      \r\n      <div class=\"email-status\" id=\"email-status-contact\"></div>\r\n    </div>\r\n    \r\n    <div class=\"invite-link-section\" style=\"margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-color, #e2e8f0);\">\r\n      <h4 style=\"margin: 0 0 8px; font-size: 13px; color: var(--text-secondary, #64748b);\">Or share invite link</h4>\r\n      <div class=\"input-group\" style=\"display: flex; gap: 8px;\">\r\n        <input type=\"text\" id=\"invite-link\" readonly \r\n               value=\"Generating link...\" class=\"form-control\" style=\"flex: 1;\">\r\n        <button type=\"button\" id=\"btn-copy-link\" class=\"btn btn-secondary\">Copy</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // State\r\n  let activeTab = 'new';\r\n  let selectedContact: Contact | null = null;\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  const sendBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Send Invitation',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n  on(sendBtn, 'click', async () => {\r\n    let email: string;\r\n    let role: string;\r\n    let message: string;\r\n\r\n    if (activeTab === 'new') {\r\n      const form = content.querySelector('#invite-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n      email = (content.querySelector('#invite-email') as HTMLInputElement).value.trim();\r\n      role = (content.querySelector('#invite-role') as HTMLSelectElement).value;\r\n      message = (content.querySelector('#invite-message') as HTMLTextAreaElement).value.trim();\r\n    } else {\r\n      if (!selectedContact || !selectedContact.email) {\r\n        toast.error('Please select a contact with an email address');\r\n        return;\r\n      }\r\n      email = selectedContact.email;\r\n      role = (content.querySelector('#invite-role-contact') as HTMLSelectElement).value;\r\n      message = (content.querySelector('#invite-message-contact') as HTMLTextAreaElement).value.trim();\r\n    }\r\n\r\n    sendBtn.disabled = true;\r\n    sendBtn.textContent = 'Sending...';\r\n\r\n    const statusEl = content.querySelector(activeTab === 'new' ? '#email-status' : '#email-status-contact') as HTMLElement;\r\n\r\n    try {\r\n      const response = await http.post<{ success: boolean; email_sent: boolean }>(`/api/projects/${projectId}/invites`, {\r\n        email,\r\n        role,\r\n        message: message || undefined,\r\n      });\r\n\r\n      // Show email status\r\n      if (response.data.email_sent) {\r\n        statusEl.textContent = ` Invitation email sent to ${email}`;\r\n        statusEl.classList.remove('error');\r\n        statusEl.classList.add('show');\r\n      } else {\r\n        statusEl.textContent = `Invitation created, but email could not be sent. Share the link manually.`;\r\n        statusEl.classList.add('error', 'show');\r\n      }\r\n\r\n      toast.success(`Invitation sent to ${email}`);\r\n      onInviteSent?.(email);\r\n      \r\n      // Close after a short delay to show status\r\n      setTimeout(() => closeModal(MODAL_ID), 1500);\r\n    } catch {\r\n      statusEl.textContent = 'Failed to create invitation';\r\n      statusEl.classList.add('error', 'show');\r\n    } finally {\r\n      sendBtn.disabled = false;\r\n      sendBtn.textContent = 'Send Invitation';\r\n    }\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  footer.appendChild(sendBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Invite Team Member',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Generate invite link\r\n  generateInviteLink(content, projectId);\r\n\r\n  // Tab switching\r\n  const tabBtns = content.querySelectorAll('.invite-tab-btn');\r\n  tabBtns.forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const tabId = btn.getAttribute('data-tab') || 'new';\r\n      activeTab = tabId;\r\n      \r\n      tabBtns.forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n      \r\n      content.querySelectorAll('.invite-tab-content').forEach(tab => {\r\n        tab.classList.toggle('active', tab.id === `tab-${tabId}`);\r\n      });\r\n    });\r\n  });\r\n\r\n  // Load contacts for the contacts tab (pass projectId to filter already-linked contacts)\r\n  loadContacts(content, projectId, (contact) => {\r\n    selectedContact = contact;\r\n  });\r\n\r\n  // Bind copy button\r\n  setTimeout(() => {\r\n    const copyBtn = content.querySelector('#btn-copy-link');\r\n    if (copyBtn) {\r\n      on(copyBtn as HTMLElement, 'click', () => {\r\n        const linkInput = content.querySelector('#invite-link') as HTMLInputElement;\r\n        navigator.clipboard.writeText(linkInput.value).then(() => {\r\n          toast.success('Link copied to clipboard');\r\n        }).catch(() => {\r\n          // Fallback\r\n          linkInput.select();\r\n          document.execCommand('copy');\r\n          toast.success('Link copied');\r\n        });\r\n      });\r\n    }\r\n  }, 0);\r\n}\r\n\r\n/**\r\n * Generate invite link\r\n */\r\nasync function generateInviteLink(container: HTMLElement, projectId: string): Promise<void> {\r\n  const linkInput = container.querySelector('#invite-link') as HTMLInputElement;\r\n\r\n  try {\r\n    const response = await http.get<{ link?: string; invite_url?: string }>(`/api/projects/${projectId}/invites/link`);\r\n    linkInput.value = response.data.link || response.data.invite_url || 'Link not available';\r\n  } catch {\r\n    // Try alternate endpoint\r\n    try {\r\n      const response = await http.post<{ invite_url?: string; token?: string }>(`/api/projects/${projectId}/invites`, {\r\n        email: '',\r\n        role: 'member',\r\n        generate_link_only: true,\r\n      });\r\n      if (response.data.invite_url) {\r\n        linkInput.value = response.data.invite_url;\r\n      } else {\r\n        linkInput.value = 'Use email invitation instead';\r\n      }\r\n    } catch {\r\n      linkInput.value = 'Use email invitation instead';\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Load project members to filter out already-linked contacts\r\n */\r\nasync function loadProjectMembers(projectId: string): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\r\n    cachedMembers = response.data.members || [];\r\n  } catch (error) {\r\n    console.warn('[InviteModal] Failed to load project members:', error);\r\n    cachedMembers = [];\r\n  }\r\n}\r\n\r\n/**\r\n * Load contacts for selection\r\n */\r\nasync function loadContacts(container: HTMLElement, projectId: string, onSelect: (contact: Contact | null) => void): Promise<void> {\r\n  const listEl = container.querySelector('#contacts-list') as HTMLElement;\r\n  if (!listEl) return;\r\n\r\n  try {\r\n    // Load members first to know which contacts are already linked\r\n    await loadProjectMembers(projectId);\r\n    \r\n    const response = await http.get<{ contacts: Contact[] }>('/api/contacts');\r\n    const contacts = response.data.contacts || [];\r\n    \r\n    // Get IDs of contacts already linked to project members\r\n    const linkedContactIds = new Set(\r\n      cachedMembers\r\n        .filter(m => m.linked_contact_id)\r\n        .map(m => m.linked_contact_id)\r\n    );\r\n    \r\n    // Filter to only contacts with email AND not already linked to a member\r\n    const availableContacts = contacts.filter(c => \r\n      c.email && !linkedContactIds.has(c.id)\r\n    );\r\n\r\n    if (availableContacts.length === 0) {\r\n      const allHaveEmail = contacts.filter(c => c.email).length;\r\n      listEl.innerHTML = `\r\n        <div class=\"no-contacts-msg\">\r\n          ${allHaveEmail > 0 && linkedContactIds.size > 0 \r\n            ? 'All contacts with email are already team members.' \r\n            : 'No contacts with email addresses found.'}\r\n          <br>\r\n          <small style=\"opacity: 0.7;\">Add contacts in the Contacts panel or use the email tab.</small>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    listEl.innerHTML = availableContacts.map(contact => {\r\n      const initials = contact.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n      const avatarUrl = contact.avatar_url || contact.photo_url;\r\n      \r\n      return `\r\n        <label class=\"contact-option\" data-id=\"${contact.id}\">\r\n          <input type=\"radio\" name=\"contact-select\" value=\"${contact.id}\">\r\n          <span class=\"radio-circle\"></span>\r\n          <div class=\"contact-avatar\">\r\n            ${avatarUrl ? `<img src=\"${avatarUrl}\" alt=\"${escapeHtml(contact.name)}\">` : initials}\r\n          </div>\r\n          <div class=\"contact-info\">\r\n            <div class=\"contact-name\">${escapeHtml(contact.name)}</div>\r\n            <div class=\"contact-email\">${escapeHtml(contact.email || '')}${contact.organization ? `  ${escapeHtml(contact.organization)}` : ''}</div>\r\n          </div>\r\n        </label>\r\n      `;\r\n    }).join('');\r\n\r\n    // Bind selection events\r\n    const options = listEl.querySelectorAll('.contact-option');\r\n    options.forEach(option => {\r\n      on(option as HTMLElement, 'click', () => {\r\n        options.forEach(o => o.classList.remove('selected'));\r\n        option.classList.add('selected');\r\n        \r\n        const contactId = option.getAttribute('data-id');\r\n        const selectedContact = availableContacts.find(c => c.id === contactId) || null;\r\n        onSelect(selectedContact);\r\n      });\r\n    });\r\n  } catch (error) {\r\n    listEl.innerHTML = `\r\n      <div class=\"no-contacts-msg\">\r\n        Failed to load contacts\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showInviteModal;\r\n","/**\r\n * Role Modal Component\r\n * Manage user roles and permissions\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'role-modal';\r\n\r\nexport interface Role {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  permissions: string[];\r\n  color?: string;\r\n  isDefault?: boolean;\r\n}\r\n\r\nexport interface RoleModalProps {\r\n  mode: 'view' | 'edit' | 'create';\r\n  role?: Role;\r\n  availablePermissions?: string[];\r\n  onSave?: (role: Role) => void;\r\n  onDelete?: (roleId: string) => void;\r\n}\r\n\r\nconst defaultPermissions = [\r\n  'view:dashboard',\r\n  'view:chat',\r\n  'view:sot',\r\n  'view:contacts',\r\n  'edit:questions',\r\n  'edit:risks',\r\n  'edit:actions',\r\n  'edit:decisions',\r\n  'edit:contacts',\r\n  'manage:team',\r\n  'manage:settings',\r\n  'manage:roles',\r\n  'delete:data',\r\n  'export:data',\r\n];\r\n\r\n/**\r\n * Show role modal\r\n */\r\nexport function showRoleModal(props: RoleModalProps): void {\r\n  const { mode, role, availablePermissions = defaultPermissions, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit' && role?.id;\r\n  const isView = mode === 'view';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'role-modal-content' });\r\n\r\n  if (isView && role) {\r\n    content.innerHTML = `\r\n      <div class=\"role-view\">\r\n        <div class=\"role-header-info\">\r\n          <div class=\"role-color-badge\" style=\"background: ${role.color || '#e94560'}\"></div>\r\n          <div>\r\n            <h3>${escapeHtml(role.name)}</h3>\r\n            ${role.description ? `<p class=\"text-muted\">${escapeHtml(role.description)}</p>` : ''}\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"role-permissions\">\r\n          <h4>Permissions (${role.permissions.length})</h4>\r\n          <div class=\"permissions-list\">\r\n            ${role.permissions.map(p => `\r\n              <span class=\"permission-tag\">${formatPermission(p)}</span>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n        \r\n        ${role.isDefault ? '<p class=\"text-muted\"><em>This is a system role and cannot be modified.</em></p>' : ''}\r\n      </div>\r\n    `;\r\n  } else {\r\n    const rolePermissions = role?.permissions || [];\r\n    \r\n    content.innerHTML = `\r\n      <form id=\"role-form\" class=\"role-form\">\r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\" style=\"flex: 1\">\r\n            <label for=\"role-name\">Role Name *</label>\r\n            <input type=\"text\" id=\"role-name\" required \r\n                   value=\"${role?.name || ''}\" \r\n                   placeholder=\"e.g., Project Manager\">\r\n          </div>\r\n          <div class=\"form-group\" style=\"width: 80px\">\r\n            <label for=\"role-color\">Color</label>\r\n            <input type=\"color\" id=\"role-color\" \r\n                   value=\"${role?.color || '#e94560'}\">\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"role-description\">Description</label>\r\n          <textarea id=\"role-description\" rows=\"2\" \r\n                    placeholder=\"Brief description of this role...\">${role?.description || ''}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Permissions</label>\r\n          <div class=\"permissions-grid\">\r\n            ${availablePermissions.map(p => `\r\n              <label class=\"permission-checkbox\">\r\n                <input type=\"checkbox\" name=\"permissions\" value=\"${p}\" \r\n                       ${rolePermissions.includes(p) ? 'checked' : ''}>\r\n                <span>${formatPermission(p)}</span>\r\n              </label>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary\" data-action=\"select-all\">Select All</button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary\" data-action=\"select-none\">Select None</button>\r\n        </div>\r\n      </form>\r\n    `;\r\n\r\n    // Bind select all/none\r\n    setTimeout(() => {\r\n      const selectAll = content.querySelector('[data-action=\"select-all\"]');\r\n      const selectNone = content.querySelector('[data-action=\"select-none\"]');\r\n\r\n      if (selectAll) {\r\n        on(selectAll as HTMLElement, 'click', () => {\r\n          content.querySelectorAll('[name=\"permissions\"]').forEach(cb => {\r\n            (cb as HTMLInputElement).checked = true;\r\n          });\r\n        });\r\n      }\r\n\r\n      if (selectNone) {\r\n        on(selectNone as HTMLElement, 'click', () => {\r\n          content.querySelectorAll('[name=\"permissions\"]').forEach(cb => {\r\n            (cb as HTMLInputElement).checked = false;\r\n          });\r\n        });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (isView) {\r\n    const editBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Edit',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    if (!role?.isDefault) {\r\n      on(editBtn, 'click', () => {\r\n        closeModal(MODAL_ID);\r\n        showRoleModal({ ...props, mode: 'edit' });\r\n      });\r\n      footer.appendChild(editBtn);\r\n    }\r\n\r\n    footer.appendChild(closeBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const saveBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: isEdit ? 'Save Changes' : 'Create Role',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(saveBtn, 'click', async () => {\r\n      const form = content.querySelector('#role-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const name = (content.querySelector('#role-name') as HTMLInputElement).value.trim();\r\n      const description = (content.querySelector('#role-description') as HTMLTextAreaElement).value.trim();\r\n      const color = (content.querySelector('#role-color') as HTMLInputElement).value;\r\n      \r\n      const permissions: string[] = [];\r\n      content.querySelectorAll('[name=\"permissions\"]:checked').forEach(cb => {\r\n        permissions.push((cb as HTMLInputElement).value);\r\n      });\r\n\r\n      const roleData: Role = {\r\n        id: role?.id || `role-${Date.now()}`,\r\n        name,\r\n        description: description || undefined,\r\n        color,\r\n        permissions,\r\n      };\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        if (isEdit) {\r\n          await http.put(`/api/roles/${role!.id}`, roleData);\r\n          toast.success('Role updated');\r\n        } else {\r\n          const response = await http.post<{ id: string }>('/api/roles', roleData);\r\n          roleData.id = response.data.id;\r\n          toast.success('Role created');\r\n        }\r\n\r\n        onSave?.(roleData);\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Role';\r\n      }\r\n    });\r\n\r\n    if (isEdit && !role?.isDefault) {\r\n      const deleteBtn = createElement('button', {\r\n        className: 'btn btn-danger',\r\n        textContent: 'Delete',\r\n      });\r\n\r\n      on(deleteBtn, 'click', async () => {\r\n        const { confirm } = await import('../Modal');\r\n        const confirmed = await confirm(\r\n          `Are you sure you want to delete the \"${role!.name}\" role?`,\r\n          {\r\n            title: 'Delete Role',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await http.delete(`/api/roles/${role!.id}`);\r\n            toast.success('Role deleted');\r\n            onDelete?.(role!.id);\r\n            closeModal(MODAL_ID);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n\r\n      footer.appendChild(deleteBtn);\r\n    }\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(saveBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: isView ? 'Role Details' : (isEdit ? 'Edit Role' : 'New Role'),\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Format permission for display\r\n */\r\nfunction formatPermission(permission: string): string {\r\n  return permission\r\n    .replace(':', ': ')\r\n    .split(/[_:]/)\r\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\r\n    .join(' ');\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showRoleModal;\r\n","/**\r\n * Export Modal Component\r\n * Export project data in various formats\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { appStore } from '../../stores/app';\r\n\r\nconst MODAL_ID = 'export-modal';\r\n\r\nexport type ExportFormat = 'json' | 'csv' | 'pdf' | 'markdown';\r\nexport type ExportScope = 'all' | 'questions' | 'risks' | 'actions' | 'decisions' | 'contacts';\r\n\r\nexport interface ExportModalProps {\r\n  defaultFormat?: ExportFormat;\r\n  defaultScope?: ExportScope;\r\n  onExport?: (format: ExportFormat, scope: ExportScope) => void;\r\n}\r\n\r\n/**\r\n * Show export modal\r\n */\r\nexport function showExportModal(props: ExportModalProps = {}): void {\r\n  const { defaultFormat = 'json', defaultScope = 'all' } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'export-modal-content' });\r\n\r\n  content.innerHTML = `\r\n    <div class=\"export-options\">\r\n      <div class=\"form-group\">\r\n        <label>What to Export</label>\r\n        <div class=\"scope-options\">\r\n          <label class=\"radio-card ${defaultScope === 'all' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"all\" ${defaultScope === 'all' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Everything</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'questions' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"questions\" ${defaultScope === 'questions' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Questions</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'risks' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"risks\" ${defaultScope === 'risks' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Risks</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'actions' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"actions\" ${defaultScope === 'actions' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Actions</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'decisions' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"decisions\" ${defaultScope === 'decisions' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Decisions</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'contacts' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"contacts\" ${defaultScope === 'contacts' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Contacts</span>\r\n            </div>\r\n          </label>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label>Format</label>\r\n        <div class=\"format-options\">\r\n          <label class=\"radio-card ${defaultFormat === 'json' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"json\" ${defaultFormat === 'json' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\">{ }</span>\r\n              <span class=\"label\">JSON</span>\r\n              <span class=\"hint\">Full data backup</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultFormat === 'csv' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"csv\" ${defaultFormat === 'csv' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">CSV</span>\r\n              <span class=\"hint\">Spreadsheet</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultFormat === 'markdown' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"markdown\" ${defaultFormat === 'markdown' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Markdown</span>\r\n              <span class=\"hint\">Documentation</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultFormat === 'pdf' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"pdf\" ${defaultFormat === 'pdf' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">PDF</span>\r\n              <span class=\"hint\">Report</span>\r\n            </div>\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Handle radio card selection styling\r\n  content.querySelectorAll('.radio-card input').forEach(input => {\r\n    on(input as HTMLElement, 'change', () => {\r\n      const group = (input as HTMLInputElement).name;\r\n      content.querySelectorAll(`[name=\"${group}\"]`).forEach(radio => {\r\n        const card = radio.closest('.radio-card');\r\n        if (card) {\r\n          if ((radio as HTMLInputElement).checked) {\r\n            addClass(card as HTMLElement, 'selected');\r\n          } else {\r\n            removeClass(card as HTMLElement, 'selected');\r\n          }\r\n        }\r\n      });\r\n    });\r\n  });\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  const exportBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Export',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n  on(exportBtn, 'click', async () => {\r\n    const format = (content.querySelector('[name=\"export-format\"]:checked') as HTMLInputElement)?.value as ExportFormat;\r\n    const scope = (content.querySelector('[name=\"export-scope\"]:checked') as HTMLInputElement)?.value as ExportScope;\r\n\r\n    exportBtn.disabled = true;\r\n    exportBtn.textContent = 'Exporting...';\r\n\r\n    try {\r\n      await performExport(format, scope);\r\n      props.onExport?.(format, scope);\r\n      closeModal(MODAL_ID);\r\n    } catch {\r\n      // Error handled in performExport\r\n    } finally {\r\n      exportBtn.disabled = false;\r\n      exportBtn.textContent = 'Export';\r\n    }\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  footer.appendChild(exportBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Export Data',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Perform the export\r\n */\r\nasync function performExport(format: ExportFormat, scope: ExportScope): Promise<void> {\r\n  const projectId = appStore.getState().currentProjectId;\r\n  if (!projectId) {\r\n    toast.error('No project selected');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const response = await http.get<unknown>(`/api/projects/${projectId}/export`, {\r\n      headers: {\r\n        'Accept': getContentType(format),\r\n      },\r\n    });\r\n\r\n    // Create download\r\n    const blob = createBlob(response.data, format);\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `godmode-${scope}-${new Date().toISOString().split('T')[0]}.${getExtension(format)}`;\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n\r\n    toast.success('Export completed');\r\n  } catch {\r\n    toast.error('Export failed');\r\n    throw new Error('Export failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Get content type for format\r\n */\r\nfunction getContentType(format: ExportFormat): string {\r\n  switch (format) {\r\n    case 'json': return 'application/json';\r\n    case 'csv': return 'text/csv';\r\n    case 'markdown': return 'text/markdown';\r\n    case 'pdf': return 'application/pdf';\r\n  }\r\n}\r\n\r\n/**\r\n * Get file extension for format\r\n */\r\nfunction getExtension(format: ExportFormat): string {\r\n  switch (format) {\r\n    case 'json': return 'json';\r\n    case 'csv': return 'csv';\r\n    case 'markdown': return 'md';\r\n    case 'pdf': return 'pdf';\r\n  }\r\n}\r\n\r\n/**\r\n * Create blob from data\r\n */\r\nfunction createBlob(data: unknown, format: ExportFormat): Blob {\r\n  let content: string;\r\n  let type: string;\r\n\r\n  switch (format) {\r\n    case 'json':\r\n      content = JSON.stringify(data, null, 2);\r\n      type = 'application/json';\r\n      break;\r\n    case 'csv':\r\n      content = typeof data === 'string' ? data : JSON.stringify(data);\r\n      type = 'text/csv';\r\n      break;\r\n    case 'markdown':\r\n      content = typeof data === 'string' ? data : JSON.stringify(data, null, 2);\r\n      type = 'text/markdown';\r\n      break;\r\n    case 'pdf':\r\n      // PDF would need special handling\r\n      content = typeof data === 'string' ? data : '';\r\n      type = 'application/pdf';\r\n      break;\r\n  }\r\n\r\n  return new Blob([content], { type });\r\n}\r\n\r\nexport default showExportModal;\r\n","/**\r\n * File Upload Modal Component\r\n * Handle file uploads with progress\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { toast } from '../../services/toast';\r\nimport { formatFileSize } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'file-upload-modal';\r\n\r\nexport interface UploadFile {\r\n  id: string;\r\n  file: File;\r\n  progress: number;\r\n  status: 'pending' | 'uploading' | 'completed' | 'error';\r\n  error?: string;\r\n}\r\n\r\nexport interface FileUploadModalProps {\r\n  accept?: string;\r\n  multiple?: boolean;\r\n  maxSize?: number; // bytes\r\n  onUpload?: (files: File[]) => Promise<void>;\r\n  onComplete?: (results: UploadFile[]) => void;\r\n}\r\n\r\nlet uploadQueue: UploadFile[] = [];\r\nlet isUploading = false;\r\n\r\n/**\r\n * Show file upload modal\r\n */\r\nexport function showFileUploadModal(props: FileUploadModalProps = {}): void {\r\n  const {\r\n    accept = '*/*',\r\n    multiple = true,\r\n    maxSize = 50 * 1024 * 1024, // 50MB default\r\n    onUpload,\r\n    onComplete,\r\n  } = props;\r\n\r\n  uploadQueue = [];\r\n  isUploading = false;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'file-upload-modal-content' });\r\n\r\n  function render(): void {\r\n    content.innerHTML = `\r\n      <div class=\"drop-zone\" id=\"drop-zone\">\r\n        <div class=\"drop-zone-icon\"></div>\r\n        <div class=\"drop-zone-text\">\r\n          <strong>Drop files here</strong> or click to browse\r\n        </div>\r\n        <div class=\"drop-zone-hint\">\r\n          ${multiple ? 'You can upload multiple files' : 'Single file only'}\r\n          ${maxSize ? `  Max ${formatFileSize(maxSize)}` : ''}\r\n        </div>\r\n        <input type=\"file\" id=\"file-input\" ${accept !== '*/*' ? `accept=\"${accept}\"` : ''} ${multiple ? 'multiple' : ''} hidden>\r\n      </div>\r\n      \r\n      ${uploadQueue.length > 0 ? `\r\n        <div class=\"upload-list\">\r\n          <h4>Files (${uploadQueue.length})</h4>\r\n          ${uploadQueue.map(f => renderFileItem(f)).join('')}\r\n        </div>\r\n      ` : ''}\r\n    `;\r\n\r\n    bindDropZone();\r\n    bindFileItems();\r\n  }\r\n\r\n  function bindDropZone(): void {\r\n    const dropZone = content.querySelector('#drop-zone') as HTMLElement;\r\n    const fileInput = content.querySelector('#file-input') as HTMLInputElement;\r\n\r\n    if (!dropZone || !fileInput) return;\r\n\r\n    // Click to browse\r\n    on(dropZone, 'click', () => fileInput.click());\r\n\r\n    // File input change\r\n    on(fileInput, 'change', () => {\r\n      if (fileInput.files) {\r\n        addFiles(Array.from(fileInput.files), maxSize);\r\n        render();\r\n      }\r\n    });\r\n\r\n    // Drag and drop\r\n    on(dropZone, 'dragover', (e) => {\r\n      e.preventDefault();\r\n      addClass(dropZone, 'drag-over');\r\n    });\r\n\r\n    on(dropZone, 'dragleave', () => {\r\n      removeClass(dropZone, 'drag-over');\r\n    });\r\n\r\n    on(dropZone, 'drop', (e) => {\r\n      e.preventDefault();\r\n      removeClass(dropZone, 'drag-over');\r\n      \r\n      const dt = (e as DragEvent).dataTransfer;\r\n      if (dt?.files) {\r\n        addFiles(Array.from(dt.files), maxSize);\r\n        render();\r\n      }\r\n    });\r\n  }\r\n\r\n  function bindFileItems(): void {\r\n    content.querySelectorAll('[data-action=\"remove\"]').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => {\r\n        const fileId = btn.getAttribute('data-file-id');\r\n        if (fileId) {\r\n          uploadQueue = uploadQueue.filter(f => f.id !== fileId);\r\n          render();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  render();\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  const uploadBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Upload',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => {\r\n    if (isUploading) {\r\n      toast.warning('Upload in progress');\r\n      return;\r\n    }\r\n    closeModal(MODAL_ID);\r\n  });\r\n\r\n  on(uploadBtn, 'click', async () => {\r\n    if (uploadQueue.length === 0) {\r\n      toast.warning('No files selected');\r\n      return;\r\n    }\r\n\r\n    if (isUploading) return;\r\n\r\n    isUploading = true;\r\n    uploadBtn.disabled = true;\r\n    uploadBtn.textContent = 'Uploading...';\r\n\r\n    try {\r\n      if (onUpload) {\r\n        const files = uploadQueue.map(f => f.file);\r\n        await onUpload(files);\r\n        \r\n        // Mark all as completed\r\n        uploadQueue.forEach(f => {\r\n          f.status = 'completed';\r\n          f.progress = 100;\r\n        });\r\n      } else {\r\n        // Default upload behavior\r\n        await uploadFiles(uploadQueue, render);\r\n      }\r\n\r\n      toast.success('Upload complete');\r\n      onComplete?.(uploadQueue);\r\n      closeModal(MODAL_ID);\r\n    } catch (error) {\r\n      toast.error('Upload failed');\r\n    } finally {\r\n      isUploading = false;\r\n      uploadBtn.disabled = false;\r\n      uploadBtn.textContent = 'Upload';\r\n      render();\r\n    }\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  footer.appendChild(uploadBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Upload Files',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Add files to queue\r\n */\r\nfunction addFiles(files: File[], maxSize: number): void {\r\n  files.forEach(file => {\r\n    if (file.size > maxSize) {\r\n      toast.error(`${file.name} exceeds max size`);\r\n      return;\r\n    }\r\n\r\n    // Check for duplicates\r\n    if (uploadQueue.some(f => f.file.name === file.name && f.file.size === file.size)) {\r\n      return;\r\n    }\r\n\r\n    uploadQueue.push({\r\n      id: `file-${Date.now()}-${Math.random().toString(36).slice(2)}`,\r\n      file,\r\n      progress: 0,\r\n      status: 'pending',\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render file item\r\n */\r\nfunction renderFileItem(item: UploadFile): string {\r\n  const icon = getFileIcon(item.file.type);\r\n  const statusClass = item.status;\r\n\r\n  return `\r\n    <div class=\"upload-item ${statusClass}\" data-file-id=\"${item.id}\">\r\n      <span class=\"file-icon\">${icon}</span>\r\n      <div class=\"file-info\">\r\n        <div class=\"file-name\">${escapeHtml(item.file.name)}</div>\r\n        <div class=\"file-size\">${formatFileSize(item.file.size)}</div>\r\n        ${item.status === 'uploading' ? `\r\n          <div class=\"progress-bar\">\r\n            <div class=\"progress-fill\" style=\"width: ${item.progress}%\"></div>\r\n          </div>\r\n        ` : ''}\r\n        ${item.error ? `<div class=\"file-error\">${escapeHtml(item.error)}</div>` : ''}\r\n      </div>\r\n      <div class=\"file-status\">\r\n        ${item.status === 'completed' ? '' : ''}\r\n        ${item.status === 'error' ? '' : ''}\r\n        ${item.status === 'pending' ? `\r\n          <button class=\"btn-sm btn-danger\" data-action=\"remove\" data-file-id=\"${item.id}\"></button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Default upload handler\r\n */\r\nasync function uploadFiles(\r\n  files: UploadFile[],\r\n  rerender: () => void\r\n): Promise<void> {\r\n  for (const file of files) {\r\n    file.status = 'uploading';\r\n    rerender();\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('file', file.file);\r\n\r\n      const xhr = new XMLHttpRequest();\r\n      \r\n      await new Promise<void>((resolve, reject) => {\r\n        xhr.upload.addEventListener('progress', (e) => {\r\n          if (e.lengthComputable) {\r\n            file.progress = Math.round((e.loaded / e.total) * 100);\r\n            rerender();\r\n          }\r\n        });\r\n\r\n        xhr.addEventListener('load', () => {\r\n          if (xhr.status >= 200 && xhr.status < 300) {\r\n            file.status = 'completed';\r\n            file.progress = 100;\r\n            resolve();\r\n          } else {\r\n            file.status = 'error';\r\n            file.error = 'Upload failed';\r\n            reject(new Error('Upload failed'));\r\n          }\r\n        });\r\n\r\n        xhr.addEventListener('error', () => {\r\n          file.status = 'error';\r\n          file.error = 'Network error';\r\n          reject(new Error('Network error'));\r\n        });\r\n\r\n        xhr.open('POST', '/api/upload');\r\n        xhr.send(formData);\r\n      });\r\n    } catch {\r\n      file.status = 'error';\r\n    }\r\n\r\n    rerender();\r\n  }\r\n}\r\n\r\n/**\r\n * Get icon for file type\r\n */\r\nfunction getFileIcon(mimeType: string): string {\r\n  if (mimeType.startsWith('image/')) return '';\r\n  if (mimeType.startsWith('video/')) return '';\r\n  if (mimeType.startsWith('audio/')) return '';\r\n  if (mimeType.includes('pdf')) return '';\r\n  if (mimeType.includes('word') || mimeType.includes('document')) return '';\r\n  if (mimeType.includes('sheet') || mimeType.includes('excel')) return '';\r\n  if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return '';\r\n  if (mimeType.includes('zip') || mimeType.includes('archive')) return '';\r\n  if (mimeType.includes('text')) return '';\r\n  return '';\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showFileUploadModal;\r\n","/**\r\n * Developer Modal Component\r\n * Developer tools and debugging options\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { appStore } from '../../stores/app';\r\nimport { dataStore } from '../../stores/data';\r\nimport { uiStore } from '../../stores/ui';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'developer-modal';\r\n\r\ntype DevTab = 'info' | 'logs' | 'cache' | 'api';\r\n\r\n/**\r\n * Show developer modal\r\n */\r\nexport function showDeveloperModal(): void {\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'developer-modal-content' });\r\n  \r\n  let currentTab: DevTab = 'info';\r\n\r\n  function render(): void {\r\n    content.innerHTML = `\r\n      <div class=\"dev-tabs\">\r\n        <button class=\"dev-tab ${currentTab === 'info' ? 'active' : ''}\" data-tab=\"info\">Info</button>\r\n        <button class=\"dev-tab ${currentTab === 'logs' ? 'active' : ''}\" data-tab=\"logs\">Logs</button>\r\n        <button class=\"dev-tab ${currentTab === 'cache' ? 'active' : ''}\" data-tab=\"cache\">Cache</button>\r\n        <button class=\"dev-tab ${currentTab === 'api' ? 'active' : ''}\" data-tab=\"api\">API Test</button>\r\n      </div>\r\n      <div class=\"dev-content\">\r\n        ${renderTabContent(currentTab)}\r\n      </div>\r\n    `;\r\n\r\n    // Bind tab clicks\r\n    content.querySelectorAll('.dev-tab').forEach(tab => {\r\n      on(tab as HTMLElement, 'click', () => {\r\n        currentTab = tab.getAttribute('data-tab') as DevTab;\r\n        render();\r\n      });\r\n    });\r\n\r\n    // Bind actions\r\n    bindActions(content);\r\n  }\r\n\r\n  render();\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Close',\r\n  });\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Developer Tools',\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Render tab content\r\n */\r\nfunction renderTabContent(tab: DevTab): string {\r\n  switch (tab) {\r\n    case 'info':\r\n      return renderInfoTab();\r\n    case 'logs':\r\n      return renderLogsTab();\r\n    case 'cache':\r\n      return renderCacheTab();\r\n    case 'api':\r\n      return renderApiTab();\r\n  }\r\n}\r\n\r\n/**\r\n * Render info tab\r\n */\r\nfunction renderInfoTab(): string {\r\n  const appState = appStore.getState();\r\n  const dataState = dataStore.getState();\r\n  const uiState = uiStore.getState();\r\n\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>Application State</h4>\r\n      <pre class=\"code-block\">${JSON.stringify({\r\n        projectId: appState.currentProjectId,\r\n        user: appState.currentUser?.email,\r\n        authConfigured: appState.authConfigured,\r\n      }, null, 2)}</pre>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Data Counts</h4>\r\n      <table class=\"dev-table\">\r\n        <tr><td>Questions</td><td>${dataState.questions.length}</td></tr>\r\n        <tr><td>Risks</td><td>${dataState.risks.length}</td></tr>\r\n        <tr><td>Actions</td><td>${dataState.actions.length}</td></tr>\r\n        <tr><td>Decisions</td><td>${dataState.decisions.length}</td></tr>\r\n        <tr><td>Contacts</td><td>${dataState.contacts.length}</td></tr>\r\n        <tr><td>Chat Messages</td><td>${dataState.chatHistory.length}</td></tr>\r\n      </table>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>UI State</h4>\r\n      <pre class=\"code-block\">${JSON.stringify({\r\n        currentTab: uiState.currentTab,\r\n        sotView: uiState.sotCurrentView,\r\n        sidebarOpen: uiState.sidebarOpen,\r\n        modalOpen: uiState.modalOpen,\r\n      }, null, 2)}</pre>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Environment</h4>\r\n      <table class=\"dev-table\">\r\n        <tr><td>User Agent</td><td>${navigator.userAgent.slice(0, 50)}...</td></tr>\r\n        <tr><td>Screen</td><td>${window.innerWidth}x${window.innerHeight}</td></tr>\r\n        <tr><td>Theme</td><td>${document.documentElement.getAttribute('data-theme')}</td></tr>\r\n      </table>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render logs tab\r\n */\r\nfunction renderLogsTab(): string {\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>Console Logs</h4>\r\n      <p class=\"text-muted\">Open browser DevTools (F12) to view console logs.</p>\r\n      <div class=\"dev-actions\">\r\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"clear-console\">Clear Console</button>\r\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"log-state\">Log State</button>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Performance</h4>\r\n      <table class=\"dev-table\">\r\n        <tr><td>Page Load</td><td>${Math.round(performance.now())}ms</td></tr>\r\n        <tr><td>Memory</td><td>${getMemoryUsage()}</td></tr>\r\n      </table>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render cache tab\r\n */\r\nfunction renderCacheTab(): string {\r\n  const keys = Object.keys(localStorage);\r\n  const totalSize = keys.reduce((acc, key) => acc + (localStorage.getItem(key)?.length || 0), 0);\r\n\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>LocalStorage</h4>\r\n      <p>Items: ${keys.length} | Size: ${formatBytes(totalSize * 2)}</p>\r\n      <div class=\"dev-actions\">\r\n        <button class=\"btn btn-danger btn-sm\" data-action=\"clear-storage\">Clear All Storage</button>\r\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"export-storage\">Export Storage</button>\r\n      </div>\r\n      <div class=\"storage-list\">\r\n        ${keys.map(key => `\r\n          <div class=\"storage-item\">\r\n            <span class=\"storage-key\">${key}</span>\r\n            <span class=\"storage-size\">${formatBytes((localStorage.getItem(key)?.length || 0) * 2)}</span>\r\n            <button class=\"btn-sm btn-danger\" data-action=\"delete-key\" data-key=\"${key}\"></button>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render API tab\r\n */\r\nfunction renderApiTab(): string {\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>API Test</h4>\r\n      <div class=\"form-group\">\r\n        <label>Endpoint</label>\r\n        <div class=\"input-group\">\r\n          <select id=\"api-method\" class=\"form-control\" style=\"width: 100px\">\r\n            <option value=\"GET\">GET</option>\r\n            <option value=\"POST\">POST</option>\r\n            <option value=\"PUT\">PUT</option>\r\n            <option value=\"DELETE\">DELETE</option>\r\n          </select>\r\n          <input type=\"text\" id=\"api-endpoint\" class=\"form-control\" value=\"/api/health\" placeholder=\"/api/...\">\r\n        </div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Body (JSON)</label>\r\n        <textarea id=\"api-body\" class=\"form-control\" rows=\"3\" placeholder='{\"key\": \"value\"}'></textarea>\r\n      </div>\r\n      <button class=\"btn btn-primary\" data-action=\"test-api\">Send Request</button>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Response</h4>\r\n      <pre id=\"api-response\" class=\"code-block\">No request sent yet</pre>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind action handlers\r\n */\r\nfunction bindActions(container: HTMLElement): void {\r\n  container.querySelectorAll('[data-action]').forEach(el => {\r\n    const action = el.getAttribute('data-action');\r\n    \r\n    on(el as HTMLElement, 'click', async () => {\r\n      switch (action) {\r\n        case 'clear-console':\r\n          console.clear();\r\n          toast.success('Console cleared');\r\n          break;\r\n          \r\n        case 'log-state':\r\n          console.group('Application State');\r\n          console.log('App:', appStore.getState());\r\n          console.log('Data:', dataStore.getState());\r\n          console.log('UI:', uiStore.getState());\r\n          console.groupEnd();\r\n          toast.success('State logged to console');\r\n          break;\r\n          \r\n        case 'clear-storage':\r\n          localStorage.clear();\r\n          toast.success('Storage cleared');\r\n          location.reload();\r\n          break;\r\n          \r\n        case 'export-storage':\r\n          const data = { ...localStorage };\r\n          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\r\n          const url = URL.createObjectURL(blob);\r\n          const a = document.createElement('a');\r\n          a.href = url;\r\n          a.download = 'localstorage-backup.json';\r\n          a.click();\r\n          toast.success('Storage exported');\r\n          break;\r\n          \r\n        case 'delete-key':\r\n          const key = el.getAttribute('data-key');\r\n          if (key) {\r\n            localStorage.removeItem(key);\r\n            toast.success(`Removed: ${key}`);\r\n            showDeveloperModal(); // Refresh\r\n          }\r\n          break;\r\n          \r\n        case 'test-api':\r\n          await testApi(container);\r\n          break;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Test API endpoint\r\n */\r\nasync function testApi(container: HTMLElement): Promise<void> {\r\n  const method = (container.querySelector('#api-method') as HTMLSelectElement).value;\r\n  const endpoint = (container.querySelector('#api-endpoint') as HTMLInputElement).value;\r\n  const bodyText = (container.querySelector('#api-body') as HTMLTextAreaElement).value;\r\n  const responseEl = container.querySelector('#api-response') as HTMLPreElement;\r\n\r\n  responseEl.textContent = 'Loading...';\r\n\r\n  try {\r\n    const options: RequestInit = { method };\r\n    if (bodyText && method !== 'GET') {\r\n      options.body = bodyText;\r\n      options.headers = { 'Content-Type': 'application/json' };\r\n    }\r\n\r\n    const start = performance.now();\r\n    const response = await fetch(endpoint, options);\r\n    const elapsed = Math.round(performance.now() - start);\r\n    const data = await response.json().catch(() => response.text());\r\n\r\n    responseEl.textContent = `Status: ${response.status} (${elapsed}ms)\\n\\n${JSON.stringify(data, null, 2)}`;\r\n  } catch (error) {\r\n    responseEl.textContent = `Error: ${error instanceof Error ? error.message : 'Unknown error'}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Get memory usage\r\n */\r\nfunction getMemoryUsage(): string {\r\n  const perf = performance as Performance & { memory?: { usedJSHeapSize: number } };\r\n  if (perf.memory) {\r\n    return formatBytes(perf.memory.usedJSHeapSize);\r\n  }\r\n  return 'N/A';\r\n}\r\n\r\n/**\r\n * Format bytes\r\n */\r\nfunction formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\r\n}\r\n\r\nexport default showDeveloperModal;\r\n","/**\r\n * Shortcuts Modal Component\r\n * Display keyboard shortcuts reference\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { shortcuts } from '../../services/shortcuts';\r\n\r\nconst MODAL_ID = 'shortcuts-modal';\r\n\r\ninterface ShortcutGroup {\r\n  title: string;\r\n  shortcuts: Array<{\r\n    keys: string[];\r\n    description: string;\r\n  }>;\r\n}\r\n\r\nconst shortcutGroups: ShortcutGroup[] = [\r\n  {\r\n    title: 'General',\r\n    shortcuts: [\r\n      { keys: ['Ctrl', 'Z'], description: 'Undo last action' },\r\n      { keys: ['Ctrl', 'Shift', 'Z'], description: 'Redo' },\r\n      { keys: ['Ctrl', 'S'], description: 'Save current item' },\r\n      { keys: ['Esc'], description: 'Close modal / Cancel' },\r\n      { keys: ['?'], description: 'Show this help' },\r\n    ],\r\n  },\r\n  {\r\n    title: 'Navigation',\r\n    shortcuts: [\r\n      { keys: ['Ctrl', '1'], description: 'Go to Dashboard' },\r\n      { keys: ['Ctrl', '2'], description: 'Go to Chat' },\r\n      { keys: ['Ctrl', '3'], description: 'Go to Source of Truth' },\r\n      { keys: ['Ctrl', '4'], description: 'Go to Timeline' },\r\n      { keys: ['Ctrl', '5'], description: 'Go to Contacts' },\r\n    ],\r\n  },\r\n  {\r\n    title: 'Actions',\r\n    shortcuts: [\r\n      { keys: ['Ctrl', 'K'], description: 'Quick search' },\r\n      { keys: ['Ctrl', 'N'], description: 'New item' },\r\n      { keys: ['Ctrl', 'E'], description: 'Export data' },\r\n      { keys: ['Ctrl', 'Shift', 'T'], description: 'Toggle theme' },\r\n    ],\r\n  },\r\n  {\r\n    title: 'Chat',\r\n    shortcuts: [\r\n      { keys: ['Enter'], description: 'Send message' },\r\n      { keys: ['Shift', 'Enter'], description: 'New line' },\r\n      { keys: [''], description: 'Previous message' },\r\n    ],\r\n  },\r\n];\r\n\r\n/**\r\n * Show shortcuts modal\r\n */\r\nexport function showShortcutsModal(): void {\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'shortcuts-modal-content' });\r\n\r\n  // Get registered shortcuts from service\r\n  const registeredShortcuts = shortcuts.getAll();\r\n\r\n  content.innerHTML = `\r\n    <div class=\"shortcuts-grid\">\r\n      ${shortcutGroups.map(group => `\r\n        <div class=\"shortcut-group\">\r\n          <h4>${group.title}</h4>\r\n          <div class=\"shortcut-list\">\r\n            ${group.shortcuts.map(s => `\r\n              <div class=\"shortcut-item\">\r\n                <div class=\"shortcut-keys\">\r\n                  ${s.keys.map(k => `<kbd>${k}</kbd>`).join(' + ')}\r\n                </div>\r\n                <div class=\"shortcut-desc\">${s.description}</div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    \r\n    ${registeredShortcuts.length > 0 ? `\r\n      <div class=\"shortcuts-custom\">\r\n        <h4>Active Shortcuts</h4>\r\n        <div class=\"shortcut-list\">\r\n          ${registeredShortcuts.map(s => {\r\n            const keys: string[] = [];\r\n            if (s.ctrl) keys.push('Ctrl');\r\n            if (s.shift) keys.push('Shift');\r\n            if (s.alt) keys.push('Alt');\r\n            if (s.meta) keys.push('Cmd');\r\n            keys.push(s.key.toUpperCase());\r\n            \r\n            return `\r\n              <div class=\"shortcut-item\">\r\n                <div class=\"shortcut-keys\">\r\n                  ${keys.map(k => `<kbd>${k}</kbd>`).join(' + ')}\r\n                </div>\r\n                <div class=\"shortcut-desc\">${s.description}</div>\r\n              </div>\r\n            `;\r\n          }).join('')}\r\n        </div>\r\n      </div>\r\n    ` : ''}\r\n    \r\n    <div class=\"shortcuts-tip\">\r\n      <p class=\"text-muted\">\r\n         Tip: Most shortcuts use Ctrl on Windows/Linux or Cmd on Mac.\r\n      </p>\r\n    </div>\r\n  `;\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Got it',\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Keyboard Shortcuts',\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\nexport default showShortcutsModal;\r\n","/**\r\n * Notifications Modal Component\r\n * Display and manage notifications\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'notifications-modal';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  type: 'info' | 'success' | 'warning' | 'error' | 'mention' | 'update';\r\n  title: string;\r\n  message: string;\r\n  read: boolean;\r\n  createdAt: string;\r\n  link?: string;\r\n  actor?: {\r\n    name: string;\r\n    avatar?: string;\r\n  };\r\n}\r\n\r\nexport interface NotificationsModalProps {\r\n  onMarkAllRead?: () => void;\r\n  onNotificationClick?: (notification: Notification) => void;\r\n}\r\n\r\nlet notifications: Notification[] = [];\r\nlet filter: 'all' | 'unread' = 'all';\r\n\r\n/**\r\n * Show notifications modal\r\n */\r\nexport async function showNotificationsModal(props: NotificationsModalProps = {}): Promise<void> {\r\n  filter = 'all';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'notifications-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading notifications...</div>';\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const markAllBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Mark All Read',\r\n  });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(markAllBtn, 'click', async () => {\r\n    try {\r\n      await http.post('/api/notifications/mark-all-read');\r\n      notifications.forEach(n => n.read = true);\r\n      render();\r\n      toast.success('All marked as read');\r\n      props.onMarkAllRead?.();\r\n    } catch {\r\n      // Error shown by API service\r\n    }\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n  footer.appendChild(markAllBtn);\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Notifications',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load notifications\r\n  try {\r\n    const response = await http.get<Notification[]>('/api/notifications');\r\n    notifications = response.data;\r\n    render();\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load notifications</div>';\r\n  }\r\n\r\n  function render(): void {\r\n    const filtered = filter === 'unread' \r\n      ? notifications.filter(n => !n.read) \r\n      : notifications;\r\n\r\n    const unreadCount = notifications.filter(n => !n.read).length;\r\n\r\n    content.innerHTML = `\r\n      <div class=\"notifications-header\">\r\n        <div class=\"filter-tabs\">\r\n          <button class=\"filter-tab ${filter === 'all' ? 'active' : ''}\" data-filter=\"all\">\r\n            All (${notifications.length})\r\n          </button>\r\n          <button class=\"filter-tab ${filter === 'unread' ? 'active' : ''}\" data-filter=\"unread\">\r\n            Unread (${unreadCount})\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      ${filtered.length === 0 ? `\r\n        <div class=\"empty-state\">\r\n          <span class=\"empty-icon\"></span>\r\n          <p>${filter === 'unread' ? 'No unread notifications' : 'No notifications yet'}</p>\r\n        </div>\r\n      ` : `\r\n        <div class=\"notifications-list\">\r\n          ${filtered.map(n => renderNotification(n)).join('')}\r\n        </div>\r\n      `}\r\n    `;\r\n\r\n    // Bind filter tabs\r\n    content.querySelectorAll('.filter-tab').forEach(tab => {\r\n      on(tab as HTMLElement, 'click', () => {\r\n        filter = tab.getAttribute('data-filter') as 'all' | 'unread';\r\n        render();\r\n      });\r\n    });\r\n\r\n    // Bind notification clicks\r\n    content.querySelectorAll('.notification-item').forEach(item => {\r\n      const id = item.getAttribute('data-notification-id');\r\n      const notification = notifications.find(n => n.id === id);\r\n      \r\n      if (notification) {\r\n        on(item as HTMLElement, 'click', async () => {\r\n          // Mark as read\r\n          if (!notification.read) {\r\n            try {\r\n              await http.patch(`/api/notifications/${id}/read`);\r\n              notification.read = true;\r\n              removeClass(item as HTMLElement, 'unread');\r\n            } catch {\r\n              // Silent fail\r\n            }\r\n          }\r\n\r\n          props.onNotificationClick?.(notification);\r\n\r\n          // Navigate if link exists\r\n          if (notification.link) {\r\n            closeModal(MODAL_ID);\r\n            // Handle navigation\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Render single notification\r\n */\r\nfunction renderNotification(notification: Notification): string {\r\n  const icon = getNotificationIcon(notification.type);\r\n\r\n  return `\r\n    <div class=\"notification-item ${notification.read ? '' : 'unread'}\" \r\n         data-notification-id=\"${notification.id}\">\r\n      <div class=\"notification-icon ${notification.type}\">${icon}</div>\r\n      <div class=\"notification-content\">\r\n        <div class=\"notification-title\">${escapeHtml(notification.title)}</div>\r\n        <div class=\"notification-message\">${escapeHtml(notification.message)}</div>\r\n        <div class=\"notification-meta\">\r\n          ${notification.actor ? `<span class=\"notification-actor\">${escapeHtml(notification.actor.name)}</span>  ` : ''}\r\n          <span class=\"notification-time\">${formatRelativeTime(notification.createdAt)}</span>\r\n        </div>\r\n      </div>\r\n      ${!notification.read ? '<div class=\"notification-dot\"></div>' : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get icon for notification type\r\n */\r\nfunction getNotificationIcon(type: Notification['type']): string {\r\n  switch (type) {\r\n    case 'info': return '';\r\n    case 'success': return '';\r\n    case 'warning': return '';\r\n    case 'error': return '';\r\n    case 'mention': return '';\r\n    case 'update': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showNotificationsModal;\r\n","/**\r\n * Email Modal Component\r\n * View and compose emails\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'email-modal';\r\n\r\nexport interface Email {\r\n  id: string;\r\n  from: { name: string; email: string };\r\n  to: Array<{ name: string; email: string }>;\r\n  cc?: Array<{ name: string; email: string }>;\r\n  subject: string;\r\n  body: string;\r\n  bodyHtml?: string;\r\n  date: string;\r\n  read: boolean;\r\n  attachments?: Array<{ name: string; size: number; type: string }>;\r\n  thread?: Email[];\r\n}\r\n\r\nexport interface EmailModalProps {\r\n  mode: 'view' | 'compose' | 'reply';\r\n  email?: Email;\r\n  onSend?: (email: Partial<Email>) => Promise<void>;\r\n}\r\n\r\n/**\r\n * Show email modal\r\n */\r\nexport function showEmailModal(props: EmailModalProps): void {\r\n  const { mode, email, onSend } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'email-modal-content' });\r\n\r\n  if (mode === 'view' && email) {\r\n    content.innerHTML = `\r\n      <div class=\"email-view\">\r\n        <div class=\"email-header\">\r\n          <div class=\"email-subject\">${escapeHtml(email.subject)}</div>\r\n          <div class=\"email-meta\">\r\n            <div class=\"email-from\">\r\n              <strong>${escapeHtml(email.from.name)}</strong>\r\n              <span class=\"text-muted\">&lt;${escapeHtml(email.from.email)}&gt;</span>\r\n            </div>\r\n            <div class=\"email-to\">\r\n              To: ${email.to.map(r => escapeHtml(r.name || r.email)).join(', ')}\r\n            </div>\r\n            ${email.cc?.length ? `\r\n              <div class=\"email-cc\">\r\n                Cc: ${email.cc.map(r => escapeHtml(r.name || r.email)).join(', ')}\r\n              </div>\r\n            ` : ''}\r\n            <div class=\"email-date\">${formatRelativeTime(email.date)}</div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"email-body\">\r\n          ${email.bodyHtml || escapeHtml(email.body).replace(/\\n/g, '<br>')}\r\n        </div>\r\n        \r\n        ${email.attachments?.length ? `\r\n          <div class=\"email-attachments\">\r\n            <h4>Attachments (${email.attachments.length})</h4>\r\n            <div class=\"attachments-list\">\r\n              ${email.attachments.map(a => `\r\n                <div class=\"attachment-item\">\r\n                  <span class=\"attachment-icon\"></span>\r\n                  <span class=\"attachment-name\">${escapeHtml(a.name)}</span>\r\n                  <span class=\"attachment-size\">${formatBytes(a.size)}</span>\r\n                </div>\r\n              `).join('')}\r\n            </div>\r\n          </div>\r\n        ` : ''}\r\n        \r\n        ${email.thread?.length ? `\r\n          <div class=\"email-thread\">\r\n            <h4>Thread (${email.thread.length} messages)</h4>\r\n            ${email.thread.map(t => `\r\n              <div class=\"thread-message\">\r\n                <div class=\"thread-header\">\r\n                  <strong>${escapeHtml(t.from.name)}</strong>\r\n                  <span>${formatRelativeTime(t.date)}</span>\r\n                </div>\r\n                <div class=\"thread-preview\">${escapeHtml(t.body.slice(0, 100))}...</div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n  } else {\r\n    // Compose / Reply mode\r\n    const isReply = mode === 'reply' && email;\r\n    const replyTo = isReply ? email.from.email : '';\r\n    const replySubject = isReply ? `Re: ${email.subject}` : '';\r\n\r\n    content.innerHTML = `\r\n      <form id=\"email-form\" class=\"email-form\">\r\n        <div class=\"form-group\">\r\n          <label for=\"email-to\">To *</label>\r\n          <input type=\"text\" id=\"email-to\" required \r\n                 value=\"${replyTo}\" \r\n                 placeholder=\"recipient@example.com\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"email-cc\">Cc</label>\r\n          <input type=\"text\" id=\"email-cc\" \r\n                 placeholder=\"cc@example.com\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"email-subject\">Subject *</label>\r\n          <input type=\"text\" id=\"email-subject\" required \r\n                 value=\"${escapeHtml(replySubject)}\" \r\n                 placeholder=\"Email subject\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"email-body\">Message *</label>\r\n          <textarea id=\"email-body\" rows=\"10\" required \r\n                    placeholder=\"Write your message...\">${isReply ? `\\n\\n---\\nOn ${email.date}, ${email.from.name} wrote:\\n${email.body}` : ''}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Attachments</label>\r\n          <div class=\"attachment-dropzone\" id=\"attachment-zone\">\r\n            <span>Drop files here or click to attach</span>\r\n            <input type=\"file\" id=\"attachment-input\" multiple hidden>\r\n          </div>\r\n          <div id=\"attachments-preview\"></div>\r\n        </div>\r\n      </form>\r\n    `;\r\n\r\n    // Bind attachment zone\r\n    setTimeout(() => {\r\n      const zone = content.querySelector('#attachment-zone') as HTMLElement;\r\n      const input = content.querySelector('#attachment-input') as HTMLInputElement;\r\n\r\n      if (zone && input) {\r\n        on(zone, 'click', () => input.click());\r\n        on(input, 'change', () => {\r\n          // Handle file selection\r\n          if (input.files) {\r\n            const preview = content.querySelector('#attachments-preview') as HTMLElement;\r\n            preview.innerHTML = Array.from(input.files)\r\n              .map(f => `<div class=\"attachment-item\">${escapeHtml(f.name)}</div>`)\r\n              .join('');\r\n          }\r\n        });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (mode === 'view') {\r\n    const replyBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Reply',\r\n    });\r\n\r\n    const forwardBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Forward',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    on(replyBtn, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showEmailModal({ ...props, mode: 'reply' });\r\n    });\r\n\r\n    on(forwardBtn, 'click', () => {\r\n      // Forward logic\r\n      toast.info('Forward not implemented');\r\n    });\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    footer.appendChild(closeBtn);\r\n    footer.appendChild(forwardBtn);\r\n    footer.appendChild(replyBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const sendBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Send',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(sendBtn, 'click', async () => {\r\n      const form = content.querySelector('#email-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const to = (content.querySelector('#email-to') as HTMLInputElement).value;\r\n      const cc = (content.querySelector('#email-cc') as HTMLInputElement).value;\r\n      const subject = (content.querySelector('#email-subject') as HTMLInputElement).value;\r\n      const body = (content.querySelector('#email-body') as HTMLTextAreaElement).value;\r\n\r\n      const emailData: Partial<Email> = {\r\n        to: to.split(',').map(e => ({ name: '', email: e.trim() })),\r\n        cc: cc ? cc.split(',').map(e => ({ name: '', email: e.trim() })) : undefined,\r\n        subject,\r\n        body,\r\n      };\r\n\r\n      sendBtn.disabled = true;\r\n      sendBtn.textContent = 'Sending...';\r\n\r\n      try {\r\n        if (onSend) {\r\n          await onSend(emailData);\r\n        } else {\r\n          await http.post('/api/emails/send', emailData);\r\n        }\r\n        toast.success('Email sent');\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        sendBtn.disabled = false;\r\n        sendBtn.textContent = 'Send';\r\n      }\r\n    });\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(sendBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: mode === 'view' ? 'Email' : (mode === 'reply' ? 'Reply' : 'Compose Email'),\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Format bytes\r\n */\r\nfunction formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showEmailModal;\r\n","/**\r\n * Charts Store\r\n * Chart instances and visualization state\r\n */\r\n\r\nimport type { Chart } from 'chart.js';\r\n\r\n// Types\r\nexport interface ChartInstance {\r\n  id: string;\r\n  chart: Chart | null;\r\n  container: string;\r\n  type: 'bar' | 'line' | 'pie' | 'doughnut' | 'radar';\r\n}\r\n\r\nexport interface NetworkInstance {\r\n  id: string;\r\n  network: unknown | null;\r\n  container: string;\r\n}\r\n\r\nexport interface ChartsState {\r\n  charts: Map<string, ChartInstance>;\r\n  networks: Map<string, NetworkInstance>;\r\n  activeChart: string | null;\r\n}\r\n\r\n// State\r\nconst state: ChartsState = {\r\n  charts: new Map(),\r\n  networks: new Map(),\r\n  activeChart: null,\r\n};\r\n\r\n// Listeners\r\nconst listeners: Set<() => void> = new Set();\r\n\r\n/**\r\n * Notify listeners\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn());\r\n}\r\n\r\n/**\r\n * Register a chart instance\r\n */\r\nexport function registerChart(id: string, chart: Chart, container: string, type: ChartInstance['type']): void {\r\n  state.charts.set(id, { id, chart, container, type });\r\n  notify();\r\n}\r\n\r\n/**\r\n * Get a chart instance\r\n */\r\nexport function getChart(id: string): Chart | null {\r\n  return state.charts.get(id)?.chart ?? null;\r\n}\r\n\r\n/**\r\n * Destroy and remove a chart\r\n */\r\nexport function destroyChart(id: string): void {\r\n  const instance = state.charts.get(id);\r\n  if (instance?.chart) {\r\n    instance.chart.destroy();\r\n  }\r\n  state.charts.delete(id);\r\n  notify();\r\n}\r\n\r\n/**\r\n * Update chart data\r\n */\r\nexport function updateChartData(id: string, data: unknown): void {\r\n  const instance = state.charts.get(id);\r\n  if (instance?.chart) {\r\n    instance.chart.data = data as Chart['data'];\r\n    instance.chart.update();\r\n  }\r\n}\r\n\r\n/**\r\n * Register a network visualization\r\n */\r\nexport function registerNetwork(id: string, network: unknown, container: string): void {\r\n  state.networks.set(id, { id, network, container });\r\n  notify();\r\n}\r\n\r\n/**\r\n * Get a network instance\r\n */\r\nexport function getNetwork(id: string): unknown | null {\r\n  return state.networks.get(id)?.network ?? null;\r\n}\r\n\r\n/**\r\n * Destroy and remove a network\r\n */\r\nexport function destroyNetwork(id: string): void {\r\n  const instance = state.networks.get(id);\r\n  if (instance?.network && typeof (instance.network as { destroy?: () => void }).destroy === 'function') {\r\n    (instance.network as { destroy: () => void }).destroy();\r\n  }\r\n  state.networks.delete(id);\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set active chart for highlighting\r\n */\r\nexport function setActiveChart(id: string | null): void {\r\n  state.activeChart = id;\r\n  notify();\r\n}\r\n\r\n/**\r\n * Get all chart IDs\r\n */\r\nexport function getChartIds(): string[] {\r\n  return Array.from(state.charts.keys());\r\n}\r\n\r\n/**\r\n * Get all network IDs\r\n */\r\nexport function getNetworkIds(): string[] {\r\n  return Array.from(state.networks.keys());\r\n}\r\n\r\n/**\r\n * Destroy all charts and networks\r\n */\r\nexport function destroyAll(): void {\r\n  state.charts.forEach((instance) => {\r\n    if (instance.chart) {\r\n      instance.chart.destroy();\r\n    }\r\n  });\r\n  state.networks.forEach((instance) => {\r\n    if (instance.network && typeof (instance.network as { destroy?: () => void }).destroy === 'function') {\r\n      (instance.network as { destroy: () => void }).destroy();\r\n    }\r\n  });\r\n  state.charts.clear();\r\n  state.networks.clear();\r\n  state.activeChart = null;\r\n  notify();\r\n}\r\n\r\n/**\r\n * Subscribe to changes\r\n */\r\nexport function subscribe(callback: () => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n// Export as namespace\r\nexport const chartsStore = {\r\n  registerChart,\r\n  getChart,\r\n  destroyChart,\r\n  updateChartData,\r\n  registerNetwork,\r\n  getNetwork,\r\n  destroyNetwork,\r\n  setActiveChart,\r\n  getChartIds,\r\n  getNetworkIds,\r\n  destroyAll,\r\n  subscribe,\r\n};\r\n","/**\r\n * Graph Modal Component\r\n * Display graph/network visualizations\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { chartsStore } from '../../stores/charts';\r\n\r\nconst MODAL_ID = 'graph-modal';\r\n\r\nexport interface GraphNode {\r\n  id: string;\r\n  label: string;\r\n  type?: string;\r\n  color?: string;\r\n  size?: number;\r\n  data?: Record<string, unknown>;\r\n}\r\n\r\nexport interface GraphEdge {\r\n  id: string;\r\n  from: string;\r\n  to: string;\r\n  label?: string;\r\n  type?: string;\r\n  color?: string;\r\n}\r\n\r\nexport interface GraphModalProps {\r\n  title?: string;\r\n  nodes: GraphNode[];\r\n  edges: GraphEdge[];\r\n  onNodeClick?: (node: GraphNode) => void;\r\n  onEdgeClick?: (edge: GraphEdge) => void;\r\n}\r\n\r\n/**\r\n * Show graph modal\r\n */\r\nexport function showGraphModal(props: GraphModalProps): void {\r\n  const { title = 'Graph View', nodes, edges, onNodeClick, onEdgeClick } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'graph-modal-content' });\r\n\r\n  content.innerHTML = `\r\n    <div class=\"graph-toolbar\">\r\n      <div class=\"graph-info\">\r\n        <span>Nodes: ${nodes.length}</span>\r\n        <span>Edges: ${edges.length}</span>\r\n      </div>\r\n      <div class=\"graph-controls\">\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"zoom-in\" title=\"Zoom In\">+</button>\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"zoom-out\" title=\"Zoom Out\"></button>\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"fit\" title=\"Fit to View\"></button>\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"fullscreen\" title=\"Fullscreen\"></button>\r\n      </div>\r\n    </div>\r\n    <div id=\"graph-container\" class=\"graph-container\">\r\n      <div class=\"graph-placeholder\">\r\n        <p>Loading graph visualization...</p>\r\n        <p class=\"text-muted\">Requires vis-network library</p>\r\n      </div>\r\n    </div>\r\n    <div class=\"graph-legend\">\r\n      ${getUniqueTypes(nodes).map(type => `\r\n        <span class=\"legend-item\">\r\n          <span class=\"legend-color\" style=\"background: ${getTypeColor(type)}\"></span>\r\n          ${type}\r\n        </span>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const exportBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Export Image',\r\n  });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(exportBtn, 'click', () => {\r\n    // Export graph as image\r\n    const canvas = content.querySelector('canvas') as HTMLCanvasElement;\r\n    if (canvas) {\r\n      const link = document.createElement('a');\r\n      link.download = 'graph.png';\r\n      link.href = canvas.toDataURL();\r\n      link.click();\r\n    } else {\r\n      toast.warning('Graph not rendered');\r\n    }\r\n  });\r\n\r\n  on(closeBtn, 'click', () => {\r\n    // Destroy network before closing\r\n    chartsStore.destroyNetwork('modal-graph');\r\n    closeModal(MODAL_ID);\r\n  });\r\n\r\n  footer.appendChild(exportBtn);\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    content,\r\n    size: 'xl',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Initialize graph after modal is visible\r\n  setTimeout(() => {\r\n    initializeGraph(content, nodes, edges, onNodeClick, onEdgeClick);\r\n    bindControls(content);\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Initialize graph visualization\r\n */\r\nfunction initializeGraph(\r\n  container: HTMLElement,\r\n  nodes: GraphNode[],\r\n  edges: GraphEdge[],\r\n  onNodeClick?: (node: GraphNode) => void,\r\n  onEdgeClick?: (edge: GraphEdge) => void\r\n): void {\r\n  const graphContainer = container.querySelector('#graph-container') as HTMLElement;\r\n  \r\n  // Check if vis-network is available\r\n  if (typeof (window as unknown as { vis?: unknown }).vis === 'undefined') {\r\n    graphContainer.innerHTML = `\r\n      <div class=\"graph-fallback\">\r\n        <h4>Graph Data</h4>\r\n        <div class=\"graph-data\">\r\n          <strong>Nodes (${nodes.length}):</strong>\r\n          <ul>${nodes.slice(0, 10).map(n => `<li>${n.label} (${n.type || 'default'})</li>`).join('')}</ul>\r\n          ${nodes.length > 10 ? `<p class=\"text-muted\">...and ${nodes.length - 10} more</p>` : ''}\r\n        </div>\r\n        <div class=\"graph-data\">\r\n          <strong>Edges (${edges.length}):</strong>\r\n          <ul>${edges.slice(0, 10).map(e => `<li>${e.from}  ${e.to}${e.label ? ` (${e.label})` : ''}</li>`).join('')}</ul>\r\n          ${edges.length > 10 ? `<p class=\"text-muted\">...and ${edges.length - 10} more</p>` : ''}\r\n        </div>\r\n        <p class=\"text-muted\"><em>vis-network library not loaded</em></p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  const vis = (window as unknown as { vis: typeof import('vis-network') }).vis;\r\n\r\n  // Prepare data\r\n  const visNodes = new vis.DataSet(\r\n    nodes.map(n => ({\r\n      id: n.id,\r\n      label: n.label,\r\n      color: n.color || getTypeColor(n.type),\r\n      size: n.size || 20,\r\n    }))\r\n  );\r\n\r\n  const visEdges = new vis.DataSet(\r\n    edges.map(e => ({\r\n      id: e.id,\r\n      from: e.from,\r\n      to: e.to,\r\n      label: e.label,\r\n      color: e.color,\r\n    }))\r\n  );\r\n\r\n  const options = {\r\n    nodes: {\r\n      shape: 'dot',\r\n      font: { color: '#eaeaea', size: 12 },\r\n      borderWidth: 2,\r\n    },\r\n    edges: {\r\n      arrows: 'to',\r\n      color: { color: '#2a2a4a', highlight: '#e94560' },\r\n      font: { color: '#a0a0a0', size: 10 },\r\n    },\r\n    physics: {\r\n      enabled: true,\r\n      stabilization: { iterations: 100 },\r\n    },\r\n    interaction: {\r\n      hover: true,\r\n      tooltipDelay: 200,\r\n    },\r\n  };\r\n\r\n  graphContainer.innerHTML = '';\r\n  const network = new vis.Network(graphContainer, { nodes: visNodes, edges: visEdges }, options);\r\n\r\n  // Store reference\r\n  chartsStore.registerNetwork('modal-graph', network, '#graph-container');\r\n\r\n  // Bind events\r\n  if (onNodeClick) {\r\n    network.on('click', (params: { nodes: string[] }) => {\r\n      if (params.nodes.length > 0) {\r\n        const node = nodes.find(n => n.id === params.nodes[0]);\r\n        if (node) onNodeClick(node);\r\n      }\r\n    });\r\n  }\r\n\r\n  if (onEdgeClick) {\r\n    network.on('click', (params: { edges: string[] }) => {\r\n      if (params.edges.length > 0) {\r\n        const edge = edges.find(e => e.id === params.edges[0]);\r\n        if (edge) onEdgeClick(edge);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Bind control buttons\r\n */\r\nfunction bindControls(container: HTMLElement): void {\r\n  const network = chartsStore.getNetwork('modal-graph') as { \r\n    moveTo?: (options: object) => void;\r\n    fit?: () => void;\r\n  } | null;\r\n  \r\n  if (!network) return;\r\n\r\n  container.querySelectorAll('[data-action]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const action = btn.getAttribute('data-action');\r\n      \r\n      switch (action) {\r\n        case 'zoom-in':\r\n          network.moveTo?.({ scale: 1.2 });\r\n          break;\r\n        case 'zoom-out':\r\n          network.moveTo?.({ scale: 0.8 });\r\n          break;\r\n        case 'fit':\r\n          network.fit?.();\r\n          break;\r\n        case 'fullscreen':\r\n          const graphContainer = container.querySelector('.graph-container') as HTMLElement;\r\n          if (graphContainer) {\r\n            graphContainer.requestFullscreen?.();\r\n          }\r\n          break;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get unique node types\r\n */\r\nfunction getUniqueTypes(nodes: GraphNode[]): string[] {\r\n  const types = new Set(nodes.map(n => n.type || 'default'));\r\n  return Array.from(types);\r\n}\r\n\r\n/**\r\n * Get color for type\r\n */\r\nfunction getTypeColor(type?: string): string {\r\n  const colors: Record<string, string> = {\r\n    person: '#4ecdc4',\r\n    organization: '#e94560',\r\n    document: '#ffe66d',\r\n    event: '#ff6b6b',\r\n    location: '#45b7d1',\r\n    default: '#a0a0a0',\r\n  };\r\n  return colors[type || 'default'] || colors.default;\r\n}\r\n\r\n// Toast import for export feedback\r\nimport { toast } from '../../services/toast';\r\n\r\nexport default showGraphModal;\r\n","/**\r\n * History Modal Component\r\n * Display change history / audit log\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'history-modal';\r\n\r\nexport interface HistoryEntry {\r\n  id: string;\r\n  action: 'create' | 'update' | 'delete' | 'restore';\r\n  entityType: string;\r\n  entityId: string;\r\n  entityName?: string;\r\n  changes?: Record<string, { old: unknown; new: unknown }>;\r\n  actor: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n  };\r\n  timestamp: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface HistoryModalProps {\r\n  entityType?: string;\r\n  entityId?: string;\r\n  title?: string;\r\n  onRestore?: (entry: HistoryEntry) => void;\r\n}\r\n\r\nlet entries: HistoryEntry[] = [];\r\nlet page = 1;\r\nlet hasMore = true;\r\nlet loading = false;\r\n\r\n/**\r\n * Show history modal\r\n */\r\nexport async function showHistoryModal(props: HistoryModalProps = {}): Promise<void> {\r\n  const { entityType, entityId, title = 'History', onRestore } = props;\r\n\r\n  entries = [];\r\n  page = 1;\r\n  hasMore = true;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'history-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading history...</div>';\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load initial data\r\n  await loadHistory(content, entityType, entityId, onRestore);\r\n}\r\n\r\n/**\r\n * Load history entries\r\n */\r\nasync function loadHistory(\r\n  container: HTMLElement,\r\n  entityType?: string,\r\n  entityId?: string,\r\n  onRestore?: (entry: HistoryEntry) => void\r\n): Promise<void> {\r\n  if (loading || !hasMore) return;\r\n\r\n  loading = true;\r\n\r\n  try {\r\n    const params = new URLSearchParams({ page: String(page), limit: '20' });\r\n    if (entityType) params.set('entityType', entityType);\r\n    if (entityId) params.set('entityId', entityId);\r\n\r\n    const response = await http.get<{ entries: HistoryEntry[]; hasMore: boolean }>(\r\n      `/api/history?${params}`\r\n    );\r\n\r\n    entries = [...entries, ...response.data.entries];\r\n    hasMore = response.data.hasMore;\r\n    page++;\r\n\r\n    render(container, onRestore);\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to load history</div>';\r\n  } finally {\r\n    loading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Render history\r\n */\r\nfunction render(container: HTMLElement, onRestore?: (entry: HistoryEntry) => void): void {\r\n  if (entries.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <span class=\"empty-icon\"></span>\r\n        <p>No history entries</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  // Group by date\r\n  const grouped = groupByDate(entries);\r\n\r\n  container.innerHTML = `\r\n    <div class=\"history-timeline\">\r\n      ${Object.entries(grouped).map(([date, items]) => `\r\n        <div class=\"history-date-group\">\r\n          <div class=\"history-date\">${date}</div>\r\n          ${items.map(entry => renderEntry(entry)).join('')}\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    ${hasMore ? `\r\n      <div class=\"history-load-more\">\r\n        <button class=\"btn btn-secondary\" data-action=\"load-more\">Load More</button>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  // Bind load more\r\n  const loadMoreBtn = container.querySelector('[data-action=\"load-more\"]');\r\n  if (loadMoreBtn) {\r\n    on(loadMoreBtn as HTMLElement, 'click', async () => {\r\n      await loadHistory(container, undefined, undefined, onRestore);\r\n    });\r\n  }\r\n\r\n  // Bind restore buttons\r\n  if (onRestore) {\r\n    container.querySelectorAll('[data-action=\"restore\"]').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', async () => {\r\n        const entryId = btn.getAttribute('data-entry-id');\r\n        const entry = entries.find(e => e.id === entryId);\r\n        if (entry) {\r\n          const { confirm } = await import('../Modal');\r\n          const confirmed = await confirm(\r\n            'Are you sure you want to restore this version?',\r\n            { title: 'Restore', confirmText: 'Restore' }\r\n          );\r\n          if (confirmed) {\r\n            onRestore(entry);\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // Bind expand buttons\r\n  container.querySelectorAll('[data-action=\"expand\"]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const changesEl = btn.closest('.history-entry')?.querySelector('.history-changes');\r\n      if (changesEl) {\r\n        changesEl.classList.toggle('expanded');\r\n        btn.textContent = changesEl.classList.contains('expanded') ? 'Hide details' : 'Show details';\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render single entry\r\n */\r\nfunction renderEntry(entry: HistoryEntry): string {\r\n  const actionIcons: Record<string, string> = {\r\n    create: '',\r\n    update: '',\r\n    delete: '',\r\n    restore: '',\r\n  };\r\n\r\n  const actionColors: Record<string, string> = {\r\n    create: 'success',\r\n    update: 'info',\r\n    delete: 'danger',\r\n    restore: 'warning',\r\n  };\r\n\r\n  const hasChanges = entry.changes && Object.keys(entry.changes).length > 0;\r\n\r\n  return `\r\n    <div class=\"history-entry ${actionColors[entry.action]}\" data-entry-id=\"${entry.id}\">\r\n      <div class=\"history-icon\">${actionIcons[entry.action]}</div>\r\n      <div class=\"history-content\">\r\n        <div class=\"history-summary\">\r\n          <strong>${entry.actor.name}</strong>\r\n          ${entry.action}d\r\n          <span class=\"entity-type\">${entry.entityType}</span>\r\n          ${entry.entityName ? `\"${escapeHtml(entry.entityName)}\"` : ''}\r\n        </div>\r\n        <div class=\"history-time\">${formatRelativeTime(entry.timestamp)}</div>\r\n        \r\n        ${hasChanges ? `\r\n          <div class=\"history-changes\">\r\n            ${Object.entries(entry.changes!).map(([field, change]) => `\r\n              <div class=\"change-item\">\r\n                <span class=\"change-field\">${field}:</span>\r\n                <span class=\"change-old\">${formatValue(change.old)}</span>\r\n                <span class=\"change-arrow\"></span>\r\n                <span class=\"change-new\">${formatValue(change.new)}</span>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n          <button class=\"btn-link\" data-action=\"expand\">Show details</button>\r\n        ` : ''}\r\n        \r\n        ${entry.action === 'delete' ? `\r\n          <button class=\"btn btn-sm btn-secondary\" data-action=\"restore\" data-entry-id=\"${entry.id}\">\r\n            Restore\r\n          </button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Group entries by date\r\n */\r\nfunction groupByDate(items: HistoryEntry[]): Record<string, HistoryEntry[]> {\r\n  const groups: Record<string, HistoryEntry[]> = {};\r\n\r\n  items.forEach(item => {\r\n    const date = new Date(item.timestamp).toLocaleDateString();\r\n    if (!groups[date]) {\r\n      groups[date] = [];\r\n    }\r\n    groups[date].push(item);\r\n  });\r\n\r\n  return groups;\r\n}\r\n\r\n/**\r\n * Format value for display\r\n */\r\nfunction formatValue(value: unknown): string {\r\n  if (value === null || value === undefined) return '(empty)';\r\n  if (typeof value === 'object') return JSON.stringify(value);\r\n  return String(value);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showHistoryModal;\r\n","/**\r\n * Comment Modal Component\r\n * Add and view comments on entities\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { appStore } from '../../stores/app';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'comment-modal';\r\n\r\nexport interface Comment {\r\n  id: string;\r\n  content: string;\r\n  author: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n    avatar?: string;\r\n  };\r\n  createdAt: string;\r\n  updatedAt?: string;\r\n  edited?: boolean;\r\n  replies?: Comment[];\r\n}\r\n\r\nexport interface CommentModalProps {\r\n  entityType: string;\r\n  entityId: string;\r\n  entityName?: string;\r\n  onCommentAdded?: (comment: Comment) => void;\r\n}\r\n\r\nlet comments: Comment[] = [];\r\n\r\n/**\r\n * Show comment modal\r\n */\r\nexport async function showCommentModal(props: CommentModalProps): Promise<void> {\r\n  const { entityType, entityId, entityName, onCommentAdded } = props;\r\n\r\n  comments = [];\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'comment-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading comments...</div>';\r\n\r\n  // Footer with comment input\r\n  const footer = createElement('div', { className: 'modal-footer comment-footer' });\r\n  footer.innerHTML = `\r\n    <div class=\"comment-input-wrapper\">\r\n      <textarea id=\"comment-input\" placeholder=\"Write a comment...\" rows=\"2\"></textarea>\r\n      <button id=\"submit-comment\" class=\"btn btn-primary\">Post</button>\r\n    </div>\r\n  `;\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: entityName ? `Comments on \"${entityName}\"` : 'Comments',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Bind submit\r\n  const submitBtn = footer.querySelector('#submit-comment') as HTMLButtonElement;\r\n  const input = footer.querySelector('#comment-input') as HTMLTextAreaElement;\r\n\r\n  on(submitBtn, 'click', async () => {\r\n    const text = input.value.trim();\r\n    if (!text) {\r\n      toast.warning('Please write a comment');\r\n      return;\r\n    }\r\n\r\n    submitBtn.disabled = true;\r\n    submitBtn.textContent = 'Posting...';\r\n\r\n    try {\r\n      const response = await http.post<Comment>(`/api/${entityType}/${entityId}/comments`, {\r\n        content: text,\r\n      });\r\n\r\n      comments.unshift(response.data);\r\n      input.value = '';\r\n      render(content, props);\r\n      onCommentAdded?.(response.data);\r\n      toast.success('Comment added');\r\n    } catch {\r\n      // Error shown by API service\r\n    } finally {\r\n      submitBtn.disabled = false;\r\n      submitBtn.textContent = 'Post';\r\n    }\r\n  });\r\n\r\n  // Ctrl+Enter to submit\r\n  on(input, 'keydown', (e) => {\r\n    if (e.key === 'Enter' && e.ctrlKey) {\r\n      submitBtn.click();\r\n    }\r\n  });\r\n\r\n  // Load comments\r\n  try {\r\n    const response = await http.get<Comment[]>(`/api/${entityType}/${entityId}/comments`);\r\n    comments = response.data;\r\n    render(content, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load comments</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render comments\r\n */\r\nfunction render(container: HTMLElement, props: CommentModalProps): void {\r\n  if (comments.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <span class=\"empty-icon\"></span>\r\n        <p>No comments yet</p>\r\n        <p class=\"text-muted\">Be the first to comment!</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"comments-list\">\r\n      ${comments.map(c => renderComment(c, props)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind actions\r\n  bindCommentActions(container, props);\r\n}\r\n\r\n/**\r\n * Render single comment\r\n */\r\nfunction renderComment(comment: Comment, props: CommentModalProps, depth = 0): string {\r\n  const currentUser = appStore.getState().currentUser;\r\n  const isAuthor = currentUser?.id === comment.author.id;\r\n  const initials = comment.author.name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n\r\n  return `\r\n    <div class=\"comment ${depth > 0 ? 'reply' : ''}\" data-comment-id=\"${comment.id}\" style=\"margin-left: ${depth * 20}px\">\r\n      <div class=\"comment-avatar\">\r\n        ${comment.author.avatar \r\n          ? `<img src=\"${comment.author.avatar}\" alt=\"${escapeHtml(comment.author.name)}\">`\r\n          : initials\r\n        }\r\n      </div>\r\n      <div class=\"comment-body\">\r\n        <div class=\"comment-header\">\r\n          <strong class=\"comment-author\">${escapeHtml(comment.author.name)}</strong>\r\n          <span class=\"comment-time\">${formatRelativeTime(comment.createdAt)}</span>\r\n          ${comment.edited ? '<span class=\"comment-edited\">(edited)</span>' : ''}\r\n        </div>\r\n        <div class=\"comment-content\">${escapeHtml(comment.content)}</div>\r\n        <div class=\"comment-actions\">\r\n          <button class=\"btn-link\" data-action=\"reply\" data-comment-id=\"${comment.id}\">Reply</button>\r\n          ${isAuthor ? `\r\n            <button class=\"btn-link\" data-action=\"edit\" data-comment-id=\"${comment.id}\">Edit</button>\r\n            <button class=\"btn-link text-danger\" data-action=\"delete\" data-comment-id=\"${comment.id}\">Delete</button>\r\n          ` : ''}\r\n        </div>\r\n      </div>\r\n    </div>\r\n    ${comment.replies?.map(r => renderComment(r, props, depth + 1)).join('') || ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind comment action handlers\r\n */\r\nfunction bindCommentActions(container: HTMLElement, props: CommentModalProps): void {\r\n  container.querySelectorAll('[data-action]').forEach(btn => {\r\n    const action = btn.getAttribute('data-action');\r\n    const commentId = btn.getAttribute('data-comment-id');\r\n\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = findComment(comments, commentId!);\r\n      if (!comment) return;\r\n\r\n      switch (action) {\r\n        case 'reply':\r\n          // Show reply input\r\n          const replyContainer = btn.closest('.comment')?.querySelector('.comment-body');\r\n          if (replyContainer && !replyContainer.querySelector('.reply-input')) {\r\n            const replyInput = createElement('div', { className: 'reply-input' });\r\n            replyInput.innerHTML = `\r\n              <textarea placeholder=\"Write a reply...\" rows=\"2\"></textarea>\r\n              <div class=\"reply-actions\">\r\n                <button class=\"btn btn-sm btn-secondary cancel-reply\">Cancel</button>\r\n                <button class=\"btn btn-sm btn-primary submit-reply\">Reply</button>\r\n              </div>\r\n            `;\r\n\r\n            replyContainer.appendChild(replyInput);\r\n\r\n            const cancelBtn = replyInput.querySelector('.cancel-reply');\r\n            const submitBtn = replyInput.querySelector('.submit-reply');\r\n            const textarea = replyInput.querySelector('textarea') as HTMLTextAreaElement;\r\n\r\n            on(cancelBtn as HTMLElement, 'click', () => replyInput.remove());\r\n            on(submitBtn as HTMLElement, 'click', async () => {\r\n              const text = textarea.value.trim();\r\n              if (!text) return;\r\n\r\n              try {\r\n                const response = await http.post<Comment>(\r\n                  `/api/${props.entityType}/${props.entityId}/comments/${commentId}/replies`,\r\n                  { content: text }\r\n                );\r\n\r\n                if (!comment.replies) comment.replies = [];\r\n                comment.replies.push(response.data);\r\n                render(container, props);\r\n              } catch {\r\n                // Error shown by API service\r\n              }\r\n            });\r\n\r\n            textarea.focus();\r\n          }\r\n          break;\r\n\r\n        case 'edit':\r\n          // Inline edit\r\n          const contentEl = btn.closest('.comment')?.querySelector('.comment-content');\r\n          if (contentEl) {\r\n            const originalText = comment.content;\r\n            contentEl.innerHTML = `\r\n              <textarea class=\"edit-textarea\">${escapeHtml(originalText)}</textarea>\r\n              <div class=\"edit-actions\">\r\n                <button class=\"btn btn-sm btn-secondary cancel-edit\">Cancel</button>\r\n                <button class=\"btn btn-sm btn-primary save-edit\">Save</button>\r\n              </div>\r\n            `;\r\n\r\n            const textarea = contentEl.querySelector('textarea') as HTMLTextAreaElement;\r\n            const cancelBtn = contentEl.querySelector('.cancel-edit');\r\n            const saveBtn = contentEl.querySelector('.save-edit');\r\n\r\n            on(cancelBtn as HTMLElement, 'click', () => {\r\n              contentEl.textContent = originalText;\r\n            });\r\n\r\n            on(saveBtn as HTMLElement, 'click', async () => {\r\n              const newText = textarea.value.trim();\r\n              if (!newText) return;\r\n\r\n              try {\r\n                await http.patch(\r\n                  `/api/${props.entityType}/${props.entityId}/comments/${commentId}`,\r\n                  { content: newText }\r\n                );\r\n                comment.content = newText;\r\n                comment.edited = true;\r\n                render(container, props);\r\n              } catch {\r\n                // Error shown by API service\r\n              }\r\n            });\r\n\r\n            textarea.focus();\r\n          }\r\n          break;\r\n\r\n        case 'delete':\r\n          const { confirm } = await import('../Modal');\r\n          const confirmed = await confirm('Delete this comment?', {\r\n            title: 'Delete Comment',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          });\r\n\r\n          if (confirmed) {\r\n            try {\r\n              await http.delete(\r\n                `/api/${props.entityType}/${props.entityId}/comments/${commentId}`\r\n              );\r\n              removeComment(comments, commentId!);\r\n              render(container, props);\r\n              toast.success('Comment deleted');\r\n            } catch {\r\n              // Error shown by API service\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Find comment by ID (recursive)\r\n */\r\nfunction findComment(list: Comment[], id: string): Comment | undefined {\r\n  for (const comment of list) {\r\n    if (comment.id === id) return comment;\r\n    if (comment.replies) {\r\n      const found = findComment(comment.replies, id);\r\n      if (found) return found;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * Remove comment by ID (recursive)\r\n */\r\nfunction removeComment(list: Comment[], id: string): boolean {\r\n  const index = list.findIndex(c => c.id === id);\r\n  if (index !== -1) {\r\n    list.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  for (const comment of list) {\r\n    if (comment.replies && removeComment(comment.replies, id)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showCommentModal;\r\n","/**\r\n * Profile Modal - SOTA Design\r\n * View and edit user profile with modern glassmorphism design\r\n */\r\n\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { profileService, UserProfile } from '../../services/profile';\r\nimport { appStore } from '../../stores/app';\r\nimport { toast } from '../../services/toast';\r\nimport { http } from '../../services/api';\r\n\r\nconst MODAL_ID = 'profile-modal';\r\n\r\ninterface Timezone {\r\n  code: string;\r\n  name: string;\r\n  region?: string;\r\n  utc_offset: string;\r\n  abbreviation?: string;\r\n}\r\n\r\nexport interface ProfileModalProps {\r\n  onClose?: () => void;\r\n  onUpdate?: (profile: UserProfile) => void;\r\n}\r\n\r\nlet currentProps: ProfileModalProps = {};\r\nlet currentProfile: UserProfile | null = null;\r\nlet cachedTimezones: Timezone[] | null = null;\r\n\r\n/**\r\n * Show profile modal\r\n */\r\nexport function showProfileModal(props: ProfileModalProps = {}): void {\r\n  currentProps = props;\r\n\r\n  const content = createModalContent();\r\n  \r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: '',\r\n    size: 'lg',\r\n    content: content,\r\n    onClose: props.onClose,\r\n  });\r\n\r\n  // Remove default modal styling for custom design\r\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\r\n  if (modalContent) {\r\n    modalContent.style.cssText = 'background: transparent; box-shadow: none; padding: 0; max-width: 720px;';\r\n  }\r\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\r\n  if (modalHeader) {\r\n    modalHeader.style.display = 'none';\r\n  }\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n  \r\n  loadProfile(content);\r\n}\r\n\r\n/**\r\n * Create modal content\r\n */\r\nfunction createModalContent(): HTMLElement {\r\n  const container = createElement('div', { className: 'profile-modal-sota' });\r\n\r\n  container.innerHTML = `\r\n    <style>\r\n      .profile-modal-sota {\r\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n      }\r\n      \r\n      .profile-card {\r\n        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\r\n        backdrop-filter: blur(20px);\r\n        border-radius: 24px;\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\r\n          0 0 0 1px rgba(255, 255, 255, 0.8),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.9);\r\n        overflow: hidden;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .profile-card {\r\n        background: linear-gradient(135deg, rgba(30,41,59,0.95) 0%, rgba(15,23,42,0.95) 100%);\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1),\r\n          inset 0 1px 0 rgba(255, 255, 255, 0.05);\r\n      }\r\n      \r\n      .profile-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        padding: 32px;\r\n        position: relative;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .profile-header::before {\r\n        content: '';\r\n        position: absolute;\r\n        top: -50%;\r\n        right: -50%;\r\n        width: 100%;\r\n        height: 200%;\r\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\r\n        pointer-events: none;\r\n      }\r\n      \r\n      .profile-header-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 24px;\r\n        position: relative;\r\n        z-index: 1;\r\n      }\r\n      \r\n      .profile-avatar-large {\r\n        width: 100px;\r\n        height: 100px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 36px;\r\n        font-weight: 600;\r\n        color: white;\r\n        border: 4px solid rgba(255,255,255,0.3);\r\n        overflow: hidden;\r\n        flex-shrink: 0;\r\n        cursor: pointer;\r\n        transition: all 0.2s ease;\r\n        position: relative;\r\n      }\r\n      \r\n      .profile-avatar-large:hover {\r\n        border-color: rgba(255,255,255,0.5);\r\n        transform: scale(1.05);\r\n      }\r\n      \r\n      .profile-avatar-large img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n      \r\n      .avatar-overlay {\r\n        position: absolute;\r\n        inset: 0;\r\n        background: rgba(0,0,0,0.5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        opacity: 0;\r\n        transition: opacity 0.2s;\r\n        border-radius: 50%;\r\n      }\r\n      \r\n      .profile-avatar-large:hover .avatar-overlay {\r\n        opacity: 1;\r\n      }\r\n      \r\n      .avatar-overlay svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        color: white;\r\n      }\r\n      \r\n      .profile-user-info h2 {\r\n        margin: 0 0 4px 0;\r\n        font-size: 28px;\r\n        font-weight: 700;\r\n        color: white;\r\n      }\r\n      \r\n      .profile-user-info .email {\r\n        color: rgba(255,255,255,0.8);\r\n        font-size: 14px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      .profile-user-info .role-badge {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n        background: rgba(255,255,255,0.2);\r\n        padding: 4px 10px;\r\n        border-radius: 20px;\r\n        font-size: 11px;\r\n        font-weight: 600;\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n        color: white;\r\n      }\r\n      \r\n      .profile-close-btn {\r\n        position: absolute;\r\n        top: 16px;\r\n        right: 16px;\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        transition: all 0.2s;\r\n        z-index: 10;\r\n      }\r\n      \r\n      .profile-close-btn:hover {\r\n        background: rgba(255,255,255,0.3);\r\n        transform: rotate(90deg);\r\n      }\r\n      \r\n      .profile-close-btn svg {\r\n        width: 20px;\r\n        height: 20px;\r\n        color: white;\r\n      }\r\n      \r\n      .profile-tabs-nav {\r\n        display: flex;\r\n        gap: 0;\r\n        padding: 0 24px;\r\n        background: rgba(0,0,0,0.02);\r\n        border-bottom: 1px solid rgba(0,0,0,0.06);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .profile-tabs-nav {\r\n        background: rgba(255,255,255,0.02);\r\n        border-bottom-color: rgba(255,255,255,0.06);\r\n      }\r\n      \r\n      .profile-tab-btn {\r\n        padding: 16px 24px;\r\n        background: transparent;\r\n        border: none;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        color: #64748b;\r\n        cursor: pointer;\r\n        position: relative;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .profile-tab-btn:hover {\r\n        color: #1e293b;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .profile-tab-btn:hover {\r\n        color: #e2e8f0;\r\n      }\r\n      \r\n      .profile-tab-btn.active {\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .profile-tab-btn.active::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: 0;\r\n        left: 24px;\r\n        right: 24px;\r\n        height: 2px;\r\n        background: #e11d48;\r\n        border-radius: 2px 2px 0 0;\r\n      }\r\n      \r\n      .profile-tab-icon {\r\n        width: 18px;\r\n        height: 18px;\r\n        margin-right: 8px;\r\n        vertical-align: middle;\r\n      }\r\n      \r\n      .profile-body {\r\n        padding: 32px;\r\n      }\r\n      \r\n      .profile-section {\r\n        display: none;\r\n      }\r\n      \r\n      .profile-section.active {\r\n        display: block;\r\n      }\r\n      \r\n      .form-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(2, 1fr);\r\n        gap: 20px;\r\n      }\r\n      \r\n      .form-grid .full-width {\r\n        grid-column: 1 / -1;\r\n      }\r\n      \r\n      .form-field {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 6px;\r\n      }\r\n      \r\n      .form-field label {\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: #475569;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-field label {\r\n        color: #94a3b8;\r\n      }\r\n      \r\n      .form-field input,\r\n      .form-field select,\r\n      .form-field textarea {\r\n        padding: 12px 16px;\r\n        border: 1px solid #e2e8f0;\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        background: #f8fafc;\r\n        color: #1e293b;\r\n        transition: all 0.2s;\r\n        outline: none;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-field input,\r\n      [data-theme=\"dark\"] .form-field select,\r\n      [data-theme=\"dark\"] .form-field textarea {\r\n        background: rgba(255,255,255,0.05);\r\n        border-color: rgba(255,255,255,0.1);\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .form-field input:focus,\r\n      .form-field select:focus,\r\n      .form-field textarea:focus {\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\r\n      }\r\n      \r\n      .form-field input:disabled {\r\n        background: #f1f5f9;\r\n        color: #94a3b8;\r\n        cursor: not-allowed;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-field input:disabled {\r\n        background: rgba(255,255,255,0.02);\r\n        color: #64748b;\r\n      }\r\n      \r\n      .form-field textarea {\r\n        resize: vertical;\r\n        min-height: 100px;\r\n      }\r\n      \r\n      .form-hint {\r\n        font-size: 12px;\r\n        color: #94a3b8;\r\n      }\r\n      \r\n      .form-actions {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 12px;\r\n        margin-top: 24px;\r\n        padding-top: 24px;\r\n        border-top: 1px solid rgba(0,0,0,0.06);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-actions {\r\n        border-top-color: rgba(255,255,255,0.06);\r\n      }\r\n      \r\n      .btn-sota {\r\n        padding: 12px 24px;\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      .btn-sota.primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-sota.primary:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n      \r\n      .btn-sota.secondary {\r\n        background: #f1f5f9;\r\n        color: #475569;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .btn-sota.secondary {\r\n        background: rgba(255,255,255,0.1);\r\n        color: #e2e8f0;\r\n      }\r\n      \r\n      .btn-sota.secondary:hover {\r\n        background: #e2e8f0;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .btn-sota.secondary:hover {\r\n        background: rgba(255,255,255,0.15);\r\n      }\r\n      \r\n      .btn-sota.danger {\r\n        background: transparent;\r\n        color: #dc2626;\r\n        border: 1px solid #fecaca;\r\n      }\r\n      \r\n      .btn-sota.danger:hover {\r\n        background: #fef2f2;\r\n        border-color: #dc2626;\r\n      }\r\n      \r\n      /* Security Section */\r\n      .security-section {\r\n        margin-bottom: 32px;\r\n      }\r\n      \r\n      .security-section h3 {\r\n        font-size: 16px;\r\n        font-weight: 600;\r\n        color: #1e293b;\r\n        margin: 0 0 16px 0;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .security-section h3 {\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .danger-zone {\r\n        background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);\r\n        border: 1px solid #fecaca;\r\n        border-radius: 16px;\r\n        padding: 24px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .danger-zone {\r\n        background: linear-gradient(135deg, rgba(220,38,38,0.1) 0%, rgba(220,38,38,0.05) 100%);\r\n        border-color: rgba(220,38,38,0.3);\r\n      }\r\n      \r\n      .danger-zone h3 {\r\n        color: #dc2626 !important;\r\n      }\r\n      \r\n      .danger-zone p {\r\n        color: #991b1b;\r\n        font-size: 14px;\r\n        margin: 0 0 16px 0;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .danger-zone p {\r\n        color: #fca5a5;\r\n      }\r\n      \r\n      /* Sessions */\r\n      .sessions-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .session-card {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding: 16px 20px;\r\n        background: #f8fafc;\r\n        border-radius: 12px;\r\n        border: 1px solid transparent;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .session-card {\r\n        background: rgba(255,255,255,0.03);\r\n      }\r\n      \r\n      .session-card.current {\r\n        border-color: #e11d48;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\r\n      }\r\n      \r\n      .session-info {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n      }\r\n      \r\n      .session-icon {\r\n        width: 44px;\r\n        height: 44px;\r\n        background: #e2e8f0;\r\n        border-radius: 12px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .session-icon {\r\n        background: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .session-icon svg {\r\n        width: 22px;\r\n        height: 22px;\r\n        color: #64748b;\r\n      }\r\n      \r\n      .session-details h4 {\r\n        margin: 0 0 4px 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: #1e293b;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .session-details h4 {\r\n        color: #f1f5f9;\r\n      }\r\n      \r\n      .session-details p {\r\n        margin: 0;\r\n        font-size: 12px;\r\n        color: #64748b;\r\n      }\r\n      \r\n      .session-badge {\r\n        font-size: 11px;\r\n        font-weight: 600;\r\n        padding: 4px 10px;\r\n        border-radius: 20px;\r\n        background: #e11d48;\r\n        color: white;\r\n      }\r\n      \r\n      .empty-state {\r\n        text-align: center;\r\n        padding: 48px 24px;\r\n        color: #94a3b8;\r\n      }\r\n      \r\n      .empty-state svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        margin-bottom: 16px;\r\n        opacity: 0.5;\r\n      }\r\n      \r\n      .loading-spinner {\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        padding: 48px;\r\n      }\r\n      \r\n      .loading-spinner::after {\r\n        content: '';\r\n        width: 32px;\r\n        height: 32px;\r\n        border: 3px solid #e2e8f0;\r\n        border-top-color: #e11d48;\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n      }\r\n      \r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"profile-card\">\r\n      <div class=\"loading-spinner\"></div>\r\n    </div>\r\n  `;\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load profile data\r\n */\r\nasync function loadProfile(container: HTMLElement): Promise<void> {\r\n  const card = container.querySelector('.profile-card') as HTMLElement;\r\n  if (!card) return;\r\n\r\n  try {\r\n    // Load profile and timezones in parallel\r\n    const [apiProfile, timezones] = await Promise.all([\r\n      profileService.get(),\r\n      loadTimezones()\r\n    ]);\r\n    \r\n    if (apiProfile) {\r\n      currentProfile = apiProfile;\r\n      renderProfile(card, currentProfile, timezones);\r\n    } else {\r\n      // Fallback to current user from store\r\n      const currentUser = appStore.getState().currentUser;\r\n      if (currentUser) {\r\n        currentProfile = {\r\n          id: currentUser.id,\r\n          email: currentUser.email,\r\n          display_name: currentUser.name || currentUser.email?.split('@')[0] || 'User',\r\n          avatar_url: currentUser.avatar,\r\n          created_at: new Date().toISOString(),\r\n        };\r\n        renderProfile(card, currentProfile, timezones);\r\n      } else {\r\n        card.innerHTML = '<div class=\"empty-state\">Please log in to view your profile</div>';\r\n      }\r\n    }\r\n  } catch {\r\n    // Fallback to current user\r\n    const currentUser = appStore.getState().currentUser;\r\n    if (currentUser) {\r\n      currentProfile = {\r\n        id: currentUser.id,\r\n        email: currentUser.email,\r\n        display_name: currentUser.name || 'User',\r\n        avatar_url: currentUser.avatar,\r\n        created_at: new Date().toISOString(),\r\n      };\r\n      renderProfile(card, currentProfile);\r\n    } else {\r\n      card.innerHTML = '<div class=\"empty-state\">Failed to load profile</div>';\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Render profile\r\n */\r\nfunction renderProfile(container: HTMLElement, profile: UserProfile, timezones?: Timezone[]): void {\r\n  const initials = getInitials(profile.display_name || profile.email);\r\n  const currentUser = appStore.getState().currentUser;\r\n  const role = currentUser?.role || profile.role || 'user';\r\n  \r\n  container.innerHTML = `\r\n    <!-- Header -->\r\n    <div class=\"profile-header\">\r\n      <button class=\"profile-close-btn\" id=\"close-profile-btn\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n        </svg>\r\n      </button>\r\n      \r\n      <div class=\"profile-header-content\">\r\n        <label class=\"profile-avatar-large\" for=\"avatar-input-hidden\" id=\"profile-avatar-display\">\r\n          <img src=\"${profile.avatar_url || generateFallbackAvatar(profile.display_name || profile.email)}\" alt=\"Avatar\" onerror=\"this.src='${generateFallbackAvatar(profile.display_name || profile.email)}'\">\r\n          <div class=\"avatar-overlay\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n            </svg>\r\n          </div>\r\n          <input type=\"file\" id=\"avatar-input-hidden\" accept=\"image/*\" hidden>\r\n        </label>\r\n        \r\n        <div class=\"profile-user-info\">\r\n          <h2>${escapeHtml(profile.display_name || profile.username || 'User')}</h2>\r\n          <div class=\"email\">\r\n            ${escapeHtml(profile.email)}\r\n            <span class=\"role-badge\">\r\n              <svg width=\"12\" height=\"12\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                ${role === 'superadmin' \r\n                  ? '<path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"/>'\r\n                  : '<path fill-rule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clip-rule=\"evenodd\"/>'\r\n                }\r\n              </svg>\r\n              ${role === 'superadmin' ? 'Super Admin' : 'User'}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- Tabs Navigation -->\r\n    <nav class=\"profile-tabs-nav\">\r\n      <button class=\"profile-tab-btn active\" data-tab=\"general\">\r\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n        </svg>\r\n        General\r\n      </button>\r\n      <button class=\"profile-tab-btn\" data-tab=\"security\">\r\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"/>\r\n        </svg>\r\n        Security\r\n      </button>\r\n      <button class=\"profile-tab-btn\" data-tab=\"sessions\">\r\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n        </svg>\r\n        Sessions\r\n      </button>\r\n    </nav>\r\n    \r\n    <!-- Tab Content -->\r\n    <div class=\"profile-body\">\r\n      <!-- General Tab -->\r\n      <div class=\"profile-section active\" id=\"section-general\">\r\n        <form id=\"profile-form\">\r\n          <div class=\"form-grid\">\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Email\r\n              </label>\r\n              <input type=\"email\" value=\"${escapeHtml(profile.email)}\" disabled>\r\n              <span class=\"form-hint\">Email cannot be changed</span>\r\n            </div>\r\n            \r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207\"/>\r\n                </svg>\r\n                Username\r\n              </label>\r\n              <input type=\"text\" name=\"username\" value=\"${escapeHtml(profile.username || '')}\" placeholder=\"Enter username\">\r\n            </div>\r\n            \r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n                </svg>\r\n                Display Name\r\n              </label>\r\n              <input type=\"text\" name=\"display_name\" value=\"${escapeHtml(profile.display_name || '')}\" placeholder=\"Your display name\">\r\n            </div>\r\n            \r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\r\n                </svg>\r\n                Bio\r\n              </label>\r\n              <textarea name=\"bio\" placeholder=\"Tell us a bit about yourself\">${escapeHtml(profile.bio || '')}</textarea>\r\n            </div>\r\n            \r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Avatar URL\r\n              </label>\r\n              <input type=\"url\" name=\"avatar_url\" id=\"avatar-url-input\" value=\"${escapeHtml(profile.avatar_url || '')}\" placeholder=\"https://example.com/avatar.jpg\">\r\n              <span class=\"form-hint\">Enter an image URL or upload using the avatar above. Leave empty for auto-generated avatar.</span>\r\n            </div>\r\n            \r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n                </svg>\r\n                Timezone\r\n              </label>\r\n              <select name=\"timezone\">\r\n                ${generateTimezoneOptions(profile.timezone, timezones)}\r\n              </select>\r\n            </div>\r\n            \r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129\"/>\r\n                </svg>\r\n                Language\r\n              </label>\r\n              <select name=\"locale\">\r\n                <option value=\"en\" ${profile.locale === 'en' ? 'selected' : ''}>English</option>\r\n                <option value=\"pt\" ${profile.locale === 'pt' ? 'selected' : ''}>Portugus</option>\r\n                <option value=\"es\" ${profile.locale === 'es' ? 'selected' : ''}>Espaol</option>\r\n                <option value=\"fr\" ${profile.locale === 'fr' ? 'selected' : ''}>Franais</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"form-actions\">\r\n            <button type=\"submit\" class=\"btn-sota primary\">\r\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n              </svg>\r\n              Save Changes\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n      \r\n      <!-- Security Tab -->\r\n      <div class=\"profile-section\" id=\"section-security\">\r\n        <div class=\"security-section\">\r\n          <h3>\r\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"/>\r\n            </svg>\r\n            Change Password\r\n          </h3>\r\n          \r\n          <form id=\"password-form\">\r\n            <div class=\"form-grid\">\r\n              <div class=\"form-field full-width\">\r\n                <label>Current Password</label>\r\n                <input type=\"password\" name=\"current_password\" required>\r\n              </div>\r\n              \r\n              <div class=\"form-field\">\r\n                <label>New Password</label>\r\n                <input type=\"password\" name=\"new_password\" minlength=\"12\" required>\r\n                <span class=\"form-hint\">Minimum 12 characters</span>\r\n              </div>\r\n              \r\n              <div class=\"form-field\">\r\n                <label>Confirm Password</label>\r\n                <input type=\"password\" name=\"confirm_password\" required>\r\n              </div>\r\n            </div>\r\n            \r\n            <div class=\"form-actions\">\r\n              <button type=\"submit\" class=\"btn-sota primary\">Update Password</button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n        \r\n        <div class=\"danger-zone\">\r\n          <h3>\r\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\r\n            </svg>\r\n            Danger Zone\r\n          </h3>\r\n          <p>Permanently delete your account and all associated data. This action cannot be undone.</p>\r\n          <button type=\"button\" class=\"btn-sota danger\" id=\"delete-account-btn\">\r\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\r\n            </svg>\r\n            Delete Account\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Sessions Tab -->\r\n      <div class=\"profile-section\" id=\"section-sessions\">\r\n        <div id=\"sessions-list\" class=\"sessions-list\">\r\n          <div class=\"loading-spinner\"></div>\r\n        </div>\r\n        \r\n        <div class=\"form-actions\">\r\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"revoke-all-btn\">\r\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"/>\r\n            </svg>\r\n            Sign out all other sessions\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  bindEvents(container);\r\n}\r\n\r\n/**\r\n * Bind event handlers\r\n */\r\nfunction bindEvents(container: HTMLElement): void {\r\n  // Close button\r\n  const closeBtn = container.querySelector('#close-profile-btn');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      currentProps.onClose?.();\r\n    });\r\n  }\r\n\r\n  // Tab switching\r\n  const tabs = container.querySelectorAll('.profile-tab-btn');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n\r\n      const tabId = tab.getAttribute('data-tab');\r\n      container.querySelectorAll('.profile-section').forEach(section => {\r\n        section.classList.toggle('active', section.id === `section-${tabId}`);\r\n      });\r\n\r\n      if (tabId === 'sessions') {\r\n        loadSessions();\r\n      }\r\n    });\r\n  });\r\n\r\n  // Avatar upload\r\n  const avatarInput = container.querySelector('#avatar-input-hidden') as HTMLInputElement;\r\n  if (avatarInput) {\r\n    on(avatarInput, 'change', async () => {\r\n      const file = avatarInput.files?.[0];\r\n      if (file) {\r\n        try {\r\n          const avatarUrl = await profileService.uploadAvatar(file);\r\n          const avatarEl = container.querySelector('.profile-avatar-large') as HTMLElement;\r\n          if (avatarEl) {\r\n            const img = avatarEl.querySelector('img');\r\n            if (img) {\r\n              img.src = avatarUrl;\r\n            } else {\r\n              avatarEl.innerHTML = `\r\n                <img src=\"${avatarUrl}\" alt=\"Avatar\">\r\n                <div class=\"avatar-overlay\">\r\n                  <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n                  </svg>\r\n                </div>\r\n                <input type=\"file\" id=\"avatar-input-hidden\" accept=\"image/*\" hidden>\r\n              `;\r\n            }\r\n          }\r\n          toast.success('Avatar updated');\r\n        } catch {\r\n          toast.error('Failed to upload avatar');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // Avatar URL input - live preview\r\n  const avatarUrlInput = container.querySelector('#avatar-url-input') as HTMLInputElement;\r\n  const avatarDisplay = container.querySelector('#profile-avatar-display img') as HTMLImageElement;\r\n  if (avatarUrlInput && avatarDisplay) {\r\n    on(avatarUrlInput, 'input', () => {\r\n      const url = avatarUrlInput.value.trim();\r\n      if (url) {\r\n        avatarDisplay.src = url;\r\n      } else if (currentProfile) {\r\n        // Use fallback if empty\r\n        avatarDisplay.src = generateFallbackAvatar(currentProfile.display_name || currentProfile.email);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Profile form submit\r\n  const profileForm = container.querySelector('#profile-form') as HTMLFormElement;\r\n  if (profileForm) {\r\n    on(profileForm, 'submit', async (e) => {\r\n      e.preventDefault();\r\n      const formData = new FormData(profileForm);\r\n      const avatarUrl = (formData.get('avatar_url') as string)?.trim();\r\n      const displayName = formData.get('display_name') as string || undefined;\r\n      \r\n      const data = {\r\n        username: formData.get('username') as string || undefined,\r\n        display_name: displayName,\r\n        bio: formData.get('bio') as string || undefined,\r\n        timezone: formData.get('timezone') as string || undefined,\r\n        locale: formData.get('locale') as string || undefined,\r\n        avatar_url: avatarUrl || (displayName ? generateFallbackAvatar(displayName) : undefined),\r\n      };\r\n\r\n      try {\r\n        const updated = await profileService.update(data);\r\n        currentProfile = updated;\r\n        toast.success('Profile updated');\r\n        currentProps.onUpdate?.(updated);\r\n        \r\n        // Update the avatar display\r\n        if (avatarDisplay) {\r\n          avatarDisplay.src = updated.avatar_url || generateFallbackAvatar(updated.display_name || updated.email);\r\n        }\r\n      } catch {\r\n        toast.error('Failed to update profile');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Password form submit\r\n  const passwordForm = container.querySelector('#password-form') as HTMLFormElement;\r\n  if (passwordForm) {\r\n    on(passwordForm, 'submit', async (e) => {\r\n      e.preventDefault();\r\n      const formData = new FormData(passwordForm);\r\n      const currentPassword = formData.get('current_password') as string;\r\n      const newPassword = formData.get('new_password') as string;\r\n      const confirmPassword = formData.get('confirm_password') as string;\r\n\r\n      if (newPassword !== confirmPassword) {\r\n        toast.error('Passwords do not match');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        await profileService.changePassword({\r\n          current_password: currentPassword,\r\n          new_password: newPassword,\r\n        });\r\n        toast.success('Password changed');\r\n        passwordForm.reset();\r\n      } catch (error) {\r\n        toast.error(error instanceof Error ? error.message : 'Failed to change password');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete account\r\n  const deleteAccountBtn = container.querySelector('#delete-account-btn');\r\n  if (deleteAccountBtn) {\r\n    on(deleteAccountBtn as HTMLElement, 'click', async () => {\r\n      const password = prompt('Enter your password to confirm account deletion:');\r\n      if (!password) return;\r\n\r\n      if (!confirm('Are you sure? This action cannot be undone.')) return;\r\n\r\n      try {\r\n        await profileService.deleteAccount(password);\r\n        closeModal(MODAL_ID);\r\n        toast.success('Account deleted');\r\n        window.location.reload();\r\n      } catch {\r\n        toast.error('Failed to delete account');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Revoke all sessions\r\n  const revokeAllBtn = container.querySelector('#revoke-all-btn');\r\n  if (revokeAllBtn) {\r\n    on(revokeAllBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Sign out from all other devices?')) return;\r\n\r\n      try {\r\n        await profileService.revokeAllSessions();\r\n        toast.success('All other sessions signed out');\r\n        loadSessions();\r\n      } catch {\r\n        toast.error('Failed to revoke sessions');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Load sessions\r\n */\r\nasync function loadSessions(): Promise<void> {\r\n  const container = document.querySelector('#sessions-list');\r\n  if (!container) return;\r\n\r\n  try {\r\n    const sessions = await profileService.getSessions();\r\n\r\n    if (!sessions || sessions.length === 0) {\r\n      container.innerHTML = `\r\n        <div class=\"empty-state\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n          </svg>\r\n          <p>No active sessions found</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    container.innerHTML = sessions.map(session => `\r\n      <div class=\"session-card ${session.is_current ? 'current' : ''}\">\r\n        <div class=\"session-info\">\r\n          <div class=\"session-icon\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              ${session.device?.toLowerCase().includes('mobile') \r\n                ? '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z\"/>'\r\n                : '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>'\r\n              }\r\n            </svg>\r\n          </div>\r\n          <div class=\"session-details\">\r\n            <h4>${escapeHtml(session.device || 'Unknown device')}</h4>\r\n            <p>${session.location ? `${escapeHtml(session.location)}  ` : ''}${escapeHtml(session.ip_address || 'Unknown IP')}  Last active: ${formatDate(session.last_active)}</p>\r\n          </div>\r\n        </div>\r\n        ${session.is_current \r\n          ? '<span class=\"session-badge\">Current</span>'\r\n          : `<button class=\"btn-sota secondary revoke-session-btn\" data-id=\"${session.id}\">Revoke</button>`\r\n        }\r\n      </div>\r\n    `).join('');\r\n\r\n    // Bind revoke buttons\r\n    container.querySelectorAll('.revoke-session-btn').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', async () => {\r\n        const sessionId = btn.getAttribute('data-id');\r\n        if (!sessionId) return;\r\n\r\n        try {\r\n          await profileService.revokeSession(sessionId);\r\n          toast.success('Session revoked');\r\n          loadSessions();\r\n        } catch {\r\n          toast.error('Failed to revoke session');\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n        </svg>\r\n        <p>Session management requires authentication</p>\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n\r\n/**\r\n * Helper functions\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\r\n}\r\n\r\n/**\r\n * Generate a fallback avatar URL using UI Avatars\r\n */\r\nfunction generateFallbackAvatar(name: string): string {\r\n  const encoded = encodeURIComponent(name || 'User');\r\n  return `https://ui-avatars.com/api/?name=${encoded}&background=e11d48&color=fff&size=200&font-size=0.4&bold=true`;\r\n}\r\n\r\n/**\r\n * Load timezones from API\r\n */\r\nasync function loadTimezones(): Promise<Timezone[]> {\r\n  if (cachedTimezones) {\r\n    return cachedTimezones;\r\n  }\r\n  \r\n  try {\r\n    const response = await http.get<{ timezones: Timezone[] }>('/api/timezones');\r\n    cachedTimezones = response.data.timezones;\r\n    return cachedTimezones;\r\n  } catch {\r\n    // Fallback to minimal list\r\n    return [\r\n      { code: 'UTC', name: 'Coordinated Universal Time', utc_offset: '+00:00' },\r\n      { code: 'Europe/Lisbon', name: 'Lisbon, Portugal', utc_offset: '+00:00' },\r\n      { code: 'Europe/London', name: 'London, United Kingdom', utc_offset: '+00:00' },\r\n    ];\r\n  }\r\n}\r\n\r\n/**\r\n * Generate timezone options HTML - uses cached timezones or fallback\r\n */\r\nfunction generateTimezoneOptions(selected?: string, timezones?: Timezone[]): string {\r\n  const tzList = timezones || cachedTimezones || [\r\n    { code: 'UTC', name: 'Coordinated Universal Time', utc_offset: '+00:00' },\r\n  ];\r\n\r\n  // Group by region for better UX\r\n  const grouped = tzList.reduce((acc, tz) => {\r\n    const region = tz.region || 'Other';\r\n    if (!acc[region]) acc[region] = [];\r\n    acc[region].push(tz);\r\n    return acc;\r\n  }, {} as Record<string, Timezone[]>);\r\n\r\n  // Sort regions\r\n  const regionOrder = ['Europe', 'Americas', 'Asia', 'Oceania', 'Africa', 'Atlantic', 'UTC', 'Other'];\r\n  const sortedRegions = Object.keys(grouped).sort((a, b) => {\r\n    const aIdx = regionOrder.indexOf(a);\r\n    const bIdx = regionOrder.indexOf(b);\r\n    return (aIdx === -1 ? 999 : aIdx) - (bIdx === -1 ? 999 : bIdx);\r\n  });\r\n\r\n  let html = '';\r\n  for (const region of sortedRegions) {\r\n    html += `<optgroup label=\"${region}\">`;\r\n    for (const tz of grouped[region]) {\r\n      const label = `${tz.name} (${tz.utc_offset})`;\r\n      html += `<option value=\"${tz.code}\" ${selected === tz.code ? 'selected' : ''}>${label}</option>`;\r\n    }\r\n    html += '</optgroup>';\r\n  }\r\n\r\n  return html;\r\n}\r\n\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  const now = new Date();\r\n  const diff = now.getTime() - date.getTime();\r\n  \r\n  if (diff < 60000) return 'Just now';\r\n  if (diff < 3600000) return `${Math.floor(diff / 60000)} min ago`;\r\n  if (diff < 86400000) return `${Math.floor(diff / 3600000)} hours ago`;\r\n  if (diff < 604800000) return `${Math.floor(diff / 86400000)} days ago`;\r\n  \r\n  return date.toLocaleDateString();\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport function closeProfileModal(): void {\r\n  closeModal(MODAL_ID);\r\n}\r\n","/**\r\n * Fact Modal\r\n * CRUD modal for facts\r\n */\r\n\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { factsService, Fact, CreateFactRequest } from '../../services/facts';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'fact-modal';\r\n\r\nexport interface FactModalProps {\r\n  mode: 'view' | 'create' | 'edit';\r\n  fact?: Fact;\r\n  onSave?: (fact: Fact) => void;\r\n  onDelete?: (factId: string | number) => void;\r\n  onClose?: () => void;\r\n}\r\n\r\nlet currentProps: FactModalProps = { mode: 'create' };\r\n\r\n/**\r\n * Show fact modal\r\n */\r\nexport function showFactModal(props: FactModalProps): void {\r\n  currentProps = props;\r\n\r\n  const title = props.mode === 'create' \r\n    ? 'Add Fact' \r\n    : props.mode === 'edit' \r\n      ? 'Edit Fact' \r\n      : 'View Fact';\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    size: 'md',\r\n    content: createModalContent(props),\r\n    onClose: props.onClose,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Create modal content\r\n */\r\nfunction createModalContent(props: FactModalProps): HTMLElement {\r\n  const container = createElement('div', { className: 'fact-modal-content' });\r\n  const fact = props.fact;\r\n  const isViewMode = props.mode === 'view';\r\n\r\n  container.innerHTML = `\r\n    <form id=\"fact-form\" class=\"fact-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"content\">Fact Content *</label>\r\n        <textarea id=\"content\" name=\"content\" rows=\"4\" required \r\n                  ${isViewMode ? 'disabled' : ''}\r\n                  placeholder=\"Enter the fact...\">${escapeHtml(fact?.content || '')}</textarea>\r\n      </div>\r\n\r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"source\">Source</label>\r\n          <input type=\"text\" id=\"source\" name=\"source\" \r\n                 ${isViewMode ? 'disabled' : ''}\r\n                 value=\"${escapeHtml(fact?.source || '')}\"\r\n                 placeholder=\"Document, conversation, etc.\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"category\">Category</label>\r\n          <input type=\"text\" id=\"category\" name=\"category\" \r\n                 ${isViewMode ? 'disabled' : ''}\r\n                 value=\"${escapeHtml(fact?.category || '')}\"\r\n                 placeholder=\"Technical, Business, etc.\">\r\n        </div>\r\n      </div>\r\n\r\n      ${fact?.verified ? `\r\n        <div class=\"verified-info\">\r\n          <span class=\"verified-badge\"> Verified</span>\r\n          ${fact.verified_by ? `<span>by ${escapeHtml(fact.verified_by)}</span>` : ''}\r\n          ${fact.verified_at ? `<span>on ${formatDate(fact.verified_at)}</span>` : ''}\r\n        </div>\r\n      ` : ''}\r\n\r\n      ${fact?.source_file ? `\r\n        <div class=\"source-file\">\r\n          <span class=\"label\">Source File:</span>\r\n          <span class=\"value\">${escapeHtml(fact.source_file)}</span>\r\n        </div>\r\n      ` : ''}\r\n\r\n      ${fact ? `\r\n        <div class=\"metadata\">\r\n          <span>Created: ${formatDate(fact.created_at)}</span>\r\n          ${fact.updated_at ? `<span>Updated: ${formatDate(fact.updated_at)}</span>` : ''}\r\n        </div>\r\n      ` : ''}\r\n\r\n      <div class=\"form-actions\">\r\n        ${props.mode === 'view' ? `\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-btn\">Edit</button>\r\n          ${!fact?.verified ? `<button type=\"button\" class=\"btn btn-success\" id=\"verify-btn\">Verify</button>` : ''}\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"delete-btn\">Delete</button>\r\n        ` : `\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\r\n          <button type=\"submit\" class=\"btn btn-primary\">\r\n            ${props.mode === 'create' ? 'Add Fact' : 'Save Changes'}\r\n          </button>\r\n        `}\r\n      </div>\r\n    </form>\r\n  `;\r\n\r\n  bindEvents(container, props);\r\n  return container;\r\n}\r\n\r\n/**\r\n * Bind event handlers\r\n */\r\nfunction bindEvents(container: HTMLElement, props: FactModalProps): void {\r\n  const form = container.querySelector('#fact-form') as HTMLFormElement;\r\n\r\n  // Form submit\r\n  if (form) {\r\n    on(form, 'submit', async (e) => {\r\n      e.preventDefault();\r\n\r\n      const formData = new FormData(form);\r\n      const data: CreateFactRequest = {\r\n        content: formData.get('content') as string,\r\n        source: formData.get('source') as string || undefined,\r\n        category: formData.get('category') as string || undefined,\r\n      };\r\n\r\n      if (!data.content.trim()) {\r\n        toast.error('Fact content is required');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        let savedFact: Fact;\r\n\r\n        if (props.mode === 'create') {\r\n          savedFact = await factsService.create(data);\r\n          toast.success('Fact added');\r\n        } else {\r\n          savedFact = await factsService.update(props.fact!.id, data);\r\n          toast.success('Fact updated');\r\n        }\r\n\r\n        closeModal(MODAL_ID);\r\n        props.onSave?.(savedFact);\r\n      } catch {\r\n        toast.error('Failed to save fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Cancel button\r\n  const cancelBtn = container.querySelector('#cancel-btn');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n    });\r\n  }\r\n\r\n  // Edit button (in view mode)\r\n  const editBtn = container.querySelector('#edit-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showFactModal({\r\n        ...props,\r\n        mode: 'edit',\r\n      });\r\n    });\r\n  }\r\n\r\n  // Verify button\r\n  const verifyBtn = container.querySelector('#verify-btn');\r\n  if (verifyBtn && props.fact) {\r\n    on(verifyBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        const verifiedFact = await factsService.verify(props.fact!.id);\r\n        toast.success('Fact verified');\r\n        closeModal(MODAL_ID);\r\n        props.onSave?.(verifiedFact);\r\n      } catch {\r\n        toast.error('Failed to verify fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete button\r\n  const deleteBtn = container.querySelector('#delete-btn');\r\n  if (deleteBtn && props.fact) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this fact?')) return;\r\n\r\n      try {\r\n        await factsService.delete(props.fact!.id);\r\n        toast.success('Fact deleted');\r\n        closeModal(MODAL_ID);\r\n        props.onDelete?.(props.fact!.id);\r\n      } catch {\r\n        toast.error('Failed to delete fact');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Format date\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString();\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport function closeFactModal(): void {\r\n  closeModal(MODAL_ID);\r\n}\r\n","/**\r\n * Conversation Preview Modal - SOTA\r\n * Full conversation preview with AI extraction results, entities, notes\r\n */\r\n\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nexport interface Conversation {\r\n  id: string;\r\n  title: string;\r\n  conversation_type: string;\r\n  participants: string[];\r\n  messages: Array<{ speaker: string; text: string; timestamp?: string }>;\r\n  metadata?: {\r\n    extraction_result?: ExtractionResult;\r\n    extractedEntities?: Entity[];\r\n    extractedRelationships?: Relationship[];\r\n    aiProcessedAt?: string;\r\n  };\r\n  summary?: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface Entity {\r\n  id: string;\r\n  type: string;\r\n  name: string;\r\n  properties?: Record<string, unknown>;\r\n  confidence?: number;\r\n}\r\n\r\ninterface Relationship {\r\n  id: string;\r\n  from_id: string;\r\n  to_id: string;\r\n  relation: string;\r\n}\r\n\r\ninterface ExtractionResult {\r\n  summary?: string;\r\n  entities?: Entity[];\r\n  relationships?: Relationship[];\r\n  facts?: Array<{ id: string; content: string; category?: string; confidence?: number }>;\r\n  decisions?: Array<{ id: string; content: string; owner_id?: string; confidence?: number }>;\r\n  action_items?: Array<{ id: string; task: string; owner?: string; status?: string }>;\r\n  questions?: Array<{ id: string; content: string }>;\r\n  notes_rendered_text?: string;\r\n  notes?: {\r\n    key_points?: Array<{ text: string }>;\r\n    outline?: Array<{ topic: string; bullets: Array<{ text: string }> }>;\r\n  };\r\n}\r\n\r\nlet currentTab = 'messages';\r\n\r\n/**\r\n * Show conversation preview modal\r\n */\r\nexport function showConversationPreviewModal(conversation: Conversation, onClose?: () => void): void {\r\n  const existing = document.querySelector('.conversation-preview-overlay');\r\n  if (existing) existing.remove();\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'conversation-preview-modal';\r\n  content.innerHTML = `\r\n    <style>\r\n      .conversation-preview-modal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 80vh;\r\n        max-height: 800px;\r\n        width: 900px;\r\n        max-width: 95vw;\r\n      }\r\n      .conv-preview-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n      }\r\n      .conv-preview-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n      }\r\n      .conv-preview-title {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin: 0 0 4px 0;\r\n      }\r\n      .conv-preview-meta {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        display: flex;\r\n        gap: 16px;\r\n      }\r\n      .conv-preview-tabs {\r\n        display: flex;\r\n        gap: 4px;\r\n        padding: 0 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      .conv-preview-tab {\r\n        padding: 12px 16px;\r\n        background: none;\r\n        border: none;\r\n        border-bottom: 2px solid transparent;\r\n        color: var(--text-secondary);\r\n        cursor: pointer;\r\n        font-size: 14px;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .conv-preview-tab:hover {\r\n        color: var(--text-primary);\r\n      }\r\n      .conv-preview-tab.active {\r\n        color: var(--primary);\r\n        border-bottom-color: var(--primary);\r\n      }\r\n      .conv-preview-tab-badge {\r\n        background: var(--bg-tertiary);\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        font-size: 11px;\r\n        margin-left: 6px;\r\n      }\r\n      .conv-preview-body {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 20px 24px;\r\n      }\r\n      .conv-preview-section {\r\n        display: none;\r\n      }\r\n      .conv-preview-section.active {\r\n        display: block;\r\n      }\r\n      .messages-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      .message-item {\r\n        padding: 12px 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n      }\r\n      .message-speaker {\r\n        font-weight: 600;\r\n        color: var(--primary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .message-text {\r\n        color: var(--text-primary);\r\n        line-height: 1.5;\r\n      }\r\n      .message-time {\r\n        font-size: 11px;\r\n        color: var(--text-tertiary);\r\n        margin-top: 4px;\r\n      }\r\n      .entity-card {\r\n        padding: 12px 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .entity-type {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .entity-content {\r\n        color: var(--text-primary);\r\n      }\r\n      .entity-meta {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n        margin-top: 4px;\r\n      }\r\n      .section-title {\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 12px;\r\n        text-transform: uppercase;\r\n      }\r\n      .empty-section {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      .notes-rendered {\r\n        padding: 20px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 12px;\r\n        line-height: 1.7;\r\n      }\r\n      .notes-header {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin-bottom: 4px;\r\n      }\r\n      .notes-meta {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 20px;\r\n        padding-bottom: 16px;\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      .notes-topic {\r\n        margin-bottom: 20px;\r\n      }\r\n      .notes-topic-title {\r\n        font-size: 15px;\r\n        font-weight: 600;\r\n        margin-bottom: 10px;\r\n        padding-left: 8px;\r\n        border-left: 3px solid var(--primary);\r\n      }\r\n      .notes-bullet {\r\n        padding: 10px 12px;\r\n        background: var(--bg-primary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n        font-size: 14px;\r\n        line-height: 1.6;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"conv-preview-header\">\r\n      <div class=\"conv-preview-icon\"></div>\r\n      <div style=\"flex: 1;\">\r\n        <h2 class=\"conv-preview-title\">${escapeHtml(conversation.title || 'Untitled Conversation')}</h2>\r\n        <div class=\"conv-preview-meta\">\r\n          <span>${conversation.participants?.length || 0} participants</span>\r\n          <span>${conversation.messages?.length || 0} messages</span>\r\n          <span>${formatRelativeTime(conversation.created_at)}</span>\r\n        </div>\r\n      </div>\r\n      <button class=\"btn btn-sm close-btn\" style=\"font-size: 20px; padding: 4px 12px;\"></button>\r\n    </div>\r\n    \r\n    <div class=\"conv-preview-tabs\">\r\n      <button class=\"conv-preview-tab active\" data-tab=\"messages\">Messages</button>\r\n      <button class=\"conv-preview-tab\" data-tab=\"entities\">\r\n        Entities\r\n        <span class=\"conv-preview-tab-badge\" id=\"entities-count\">0</span>\r\n      </button>\r\n      <button class=\"conv-preview-tab\" data-tab=\"extraction\">\r\n        Extraction\r\n        <span class=\"conv-preview-tab-badge\" id=\"extraction-count\">0</span>\r\n      </button>\r\n      <button class=\"conv-preview-tab\" data-tab=\"notes\" id=\"notes-tab\" style=\"display:none\">\r\n        Notes\r\n      </button>\r\n    </div>\r\n    \r\n    <div class=\"conv-preview-body\">\r\n      <div class=\"conv-preview-section active\" data-section=\"messages\" id=\"messages-container\">\r\n        <div class=\"messages-list\">\r\n          ${(conversation.messages || []).map(m => `\r\n            <div class=\"message-item\">\r\n              <div class=\"message-speaker\">${escapeHtml(m.speaker || 'Unknown')}</div>\r\n              <div class=\"message-text\">${escapeHtml(m.text || '')}</div>\r\n              ${m.timestamp ? `<div class=\"message-time\">${m.timestamp}</div>` : ''}\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"conv-preview-section\" data-section=\"entities\" id=\"entities-container\">\r\n        <div class=\"empty-section\">Loading entities...</div>\r\n      </div>\r\n      \r\n      <div class=\"conv-preview-section\" data-section=\"extraction\" id=\"extraction-container\">\r\n        <div class=\"empty-section\">Loading extraction results...</div>\r\n      </div>\r\n      \r\n      <div class=\"conv-preview-section\" data-section=\"notes\" id=\"notes-container\">\r\n        <div class=\"empty-section\">No notes available</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Tab switching\r\n  content.querySelectorAll('.conv-preview-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      const tabName = (tab as HTMLElement).dataset.tab;\r\n      content.querySelectorAll('.conv-preview-tab').forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      content.querySelectorAll('.conv-preview-section').forEach(s => s.classList.remove('active'));\r\n      content.querySelector(`[data-section=\"${tabName}\"]`)?.classList.add('active');\r\n    });\r\n  });\r\n\r\n  // Close button\r\n  content.querySelector('.close-btn')?.addEventListener('click', () => {\r\n    overlay.remove();\r\n    onClose?.();\r\n  });\r\n\r\n  // Load extraction data\r\n  loadExtractionData(content, conversation);\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'modal-overlay conversation-preview-overlay';\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    inset: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    backdrop-filter: blur(4px);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 10000;\r\n  `;\r\n\r\n  const modal = document.createElement('div');\r\n  modal.style.cssText = `\r\n    background: var(--bg-primary);\r\n    border-radius: 16px;\r\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\r\n    overflow: hidden;\r\n  `;\r\n  modal.appendChild(content);\r\n  overlay.appendChild(modal);\r\n\r\n  // Close on backdrop click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      overlay.remove();\r\n      onClose?.();\r\n    }\r\n  });\r\n\r\n  // Close on escape\r\n  const handleEsc = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      overlay.remove();\r\n      onClose?.();\r\n      document.removeEventListener('keydown', handleEsc);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', handleEsc);\r\n\r\n  document.body.appendChild(overlay);\r\n}\r\n\r\n/**\r\n * Load extraction data from conversation metadata\r\n */\r\nfunction loadExtractionData(container: HTMLElement, conversation: Conversation): void {\r\n  const meta = conversation.metadata;\r\n  const extraction = meta?.extraction_result;\r\n  \r\n  // Update entities tab\r\n  const entities = meta?.extractedEntities || extraction?.entities || [];\r\n  const entitiesContainer = container.querySelector('#entities-container') as HTMLElement;\r\n  const entitiesCount = container.querySelector('#entities-count') as HTMLElement;\r\n  \r\n  if (entitiesCount) entitiesCount.textContent = String(entities.length);\r\n  \r\n  if (entities.length > 0) {\r\n    entitiesContainer.innerHTML = entities.map(e => `\r\n      <div class=\"entity-card\">\r\n        <div class=\"entity-type\">${escapeHtml(e.type)}</div>\r\n        <div class=\"entity-content\">${escapeHtml(e.name)}</div>\r\n        ${e.confidence ? `<div class=\"entity-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    entitiesContainer.innerHTML = '<div class=\"empty-section\">No entities extracted</div>';\r\n  }\r\n  \r\n  // Update extraction tab\r\n  const extractionContainer = container.querySelector('#extraction-container') as HTMLElement;\r\n  const facts = extraction?.facts || [];\r\n  const decisions = extraction?.decisions || [];\r\n  const actions = extraction?.action_items || [];\r\n  const questions = extraction?.questions || [];\r\n  \r\n  const extractionCount = container.querySelector('#extraction-count') as HTMLElement;\r\n  const totalItems = facts.length + decisions.length + actions.length + questions.length;\r\n  if (extractionCount) extractionCount.textContent = String(totalItems);\r\n  \r\n  if (totalItems > 0) {\r\n    let html = '';\r\n    \r\n    if (facts.length > 0) {\r\n      html += `<div class=\"section-title\">Facts (${facts.length})</div>`;\r\n      html += facts.map(f => `\r\n        <div class=\"entity-card\">\r\n          <div class=\"entity-type\">${f.category || 'fact'}</div>\r\n          <div class=\"entity-content\">${escapeHtml(f.content)}</div>\r\n        </div>\r\n      `).join('');\r\n    }\r\n    \r\n    if (decisions.length > 0) {\r\n      html += `<div class=\"section-title\" style=\"margin-top: 20px;\">Decisions (${decisions.length})</div>`;\r\n      html += decisions.map(d => `\r\n        <div class=\"entity-card\">\r\n          <div class=\"entity-content\">${escapeHtml(d.content)}</div>\r\n        </div>\r\n      `).join('');\r\n    }\r\n    \r\n    if (actions.length > 0) {\r\n      html += `<div class=\"section-title\" style=\"margin-top: 20px;\">Action Items (${actions.length})</div>`;\r\n      html += actions.map(a => `\r\n        <div class=\"entity-card\">\r\n          <div class=\"entity-content\">${escapeHtml(a.task)}</div>\r\n          ${a.owner ? `<div class=\"entity-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\r\n        </div>\r\n      `).join('');\r\n    }\r\n    \r\n    if (questions.length > 0) {\r\n      html += `<div class=\"section-title\" style=\"margin-top: 20px;\">Questions (${questions.length})</div>`;\r\n      html += questions.map(q => `\r\n        <div class=\"entity-card\">\r\n          <div class=\"entity-content\">${escapeHtml(q.content)}</div>\r\n        </div>\r\n      `).join('');\r\n    }\r\n    \r\n    extractionContainer.innerHTML = html;\r\n  } else {\r\n    extractionContainer.innerHTML = '<div class=\"empty-section\">No extraction results available</div>';\r\n  }\r\n  \r\n  // Update notes tab\r\n  const notesContainer = container.querySelector('#notes-container') as HTMLElement;\r\n  const notesTab = container.querySelector('#notes-tab') as HTMLElement;\r\n  const notesText = extraction?.notes_rendered_text;\r\n  \r\n  if (notesText) {\r\n    if (notesTab) notesTab.style.display = '';\r\n    notesContainer.innerHTML = `\r\n      <div class=\"notes-rendered\">\r\n        ${renderNotesAsHtml(notesText)}\r\n        <div style=\"margin-top: 16px;\">\r\n          <button class=\"btn btn-secondary btn-sm\" id=\"copy-notes-btn\"> Copy Notes</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    container.querySelector('#copy-notes-btn')?.addEventListener('click', () => {\r\n      navigator.clipboard.writeText(notesText);\r\n      toast.success('Notes copied to clipboard');\r\n    });\r\n  } else if (extraction?.notes?.outline?.length) {\r\n    if (notesTab) notesTab.style.display = '';\r\n    const outline = extraction.notes.outline;\r\n    notesContainer.innerHTML = `\r\n      <div class=\"notes-rendered\">\r\n        ${outline.map(t => `\r\n          <div class=\"notes-topic\">\r\n            <div class=\"notes-topic-title\">${escapeHtml(t.topic)}</div>\r\n            ${t.bullets?.map(b => `<div class=\"notes-bullet\">${escapeHtml(b.text)}</div>`).join('') || ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n\r\n/**\r\n * Render notes text as HTML\r\n */\r\nfunction renderNotesAsHtml(text: string): string {\r\n  const lines = text.split('\\n');\r\n  let html = '';\r\n  let currentTopic = '';\r\n  let bulletsHtml = '';\r\n  let headerDone = false;\r\n  let metaDone = false;\r\n  \r\n  const flushTopic = () => {\r\n    if (currentTopic && bulletsHtml) {\r\n      html += `\r\n        <div class=\"notes-topic\">\r\n          <div class=\"notes-topic-title\">${escapeHtml(currentTopic)}</div>\r\n          ${bulletsHtml}\r\n        </div>\r\n      `;\r\n    }\r\n    currentTopic = '';\r\n    bulletsHtml = '';\r\n  };\r\n  \r\n  for (const line of lines) {\r\n    const trimmed = line.trim();\r\n    if (!trimmed) continue;\r\n    \r\n    if (!headerDone && trimmed.startsWith('')) {\r\n      html += `<div class=\"notes-header\">${escapeHtml(trimmed)}</div>`;\r\n      headerDone = true;\r\n      continue;\r\n    }\r\n    \r\n    if (!metaDone && trimmed.startsWith('')) {\r\n      html += `<div class=\"notes-meta\">${escapeHtml(trimmed)}</div>`;\r\n      metaDone = true;\r\n      continue;\r\n    }\r\n    \r\n    if (trimmed.startsWith('-')) {\r\n      const bulletText = trimmed.substring(1).trim();\r\n      bulletsHtml += `<div class=\"notes-bullet\">${escapeHtml(bulletText)}</div>`;\r\n      continue;\r\n    }\r\n    \r\n    flushTopic();\r\n    currentTopic = trimmed;\r\n  }\r\n  \r\n  flushTopic();\r\n  \r\n  if (!html.includes('notes-topic')) {\r\n    return `<pre style=\"white-space: pre-wrap; font-family: inherit; margin: 0; line-height: 1.6;\">${escapeHtml(text)}</pre>`;\r\n  }\r\n  \r\n  return html;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showConversationPreviewModal;\r\n","/**\r\n * Email Preview Modal - SOTA\r\n * Full email preview with AI extraction results, entities, analysis\r\n */\r\n\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nexport interface EmailData {\r\n  id: string;\r\n  subject: string;\r\n  from: { name: string; email: string };\r\n  to: Array<{ name: string; email: string }>;\r\n  cc?: Array<{ name: string; email: string }>;\r\n  body: string;\r\n  body_html?: string;\r\n  date: string;\r\n  attachments?: Array<{ name: string; size: number }>;\r\n  // AI extraction fields\r\n  extracted_entities?: ExtractionResult;\r\n  ai_summary?: string;\r\n  detected_intent?: string;\r\n  sentiment?: string;\r\n  requires_response?: boolean;\r\n  processed_at?: string;\r\n}\r\n\r\ninterface ExtractionResult {\r\n  summary?: string;\r\n  intent?: string;\r\n  sentiment?: string;\r\n  key_points?: string[];\r\n  action_items?: Array<{ task: string; owner?: string }>;\r\n  questions?: string[];\r\n  entities?: Array<{ type: string; name: string; confidence?: number }>;\r\n  contacts?: Array<{ name: string; email?: string; title?: string; organization?: string }>;\r\n}\r\n\r\nlet currentTab = 'content';\r\n\r\n/**\r\n * Show email preview modal\r\n */\r\nexport function showEmailPreviewModal(email: EmailData, onClose?: () => void): void {\r\n  const existing = document.querySelector('.email-preview-overlay');\r\n  if (existing) existing.remove();\r\n\r\n  const extraction = email.extracted_entities;\r\n  const hasExtraction = extraction && (\r\n    extraction.key_points?.length || \r\n    extraction.action_items?.length || \r\n    extraction.entities?.length\r\n  );\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'email-preview-modal';\r\n  content.innerHTML = `\r\n    <style>\r\n      .email-preview-modal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 80vh;\r\n        max-height: 800px;\r\n        width: 900px;\r\n        max-width: 95vw;\r\n      }\r\n      .email-preview-header {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n      }\r\n      .email-preview-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n        flex-shrink: 0;\r\n      }\r\n      .email-preview-title {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin: 0 0 8px 0;\r\n        line-height: 1.3;\r\n      }\r\n      .email-preview-meta {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .email-preview-meta-row {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-bottom: 4px;\r\n      }\r\n      .email-preview-meta-label {\r\n        color: var(--text-tertiary);\r\n        min-width: 40px;\r\n      }\r\n      .email-preview-badges {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-top: 8px;\r\n        flex-wrap: wrap;\r\n      }\r\n      .email-badge {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n        padding: 4px 10px;\r\n        border-radius: 12px;\r\n        font-size: 12px;\r\n        font-weight: 500;\r\n      }\r\n      .email-badge.intent {\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        color: var(--primary);\r\n      }\r\n      .email-badge.sentiment-positive {\r\n        background: rgba(46, 160, 67, 0.1);\r\n        color: #2ea043;\r\n      }\r\n      .email-badge.sentiment-negative {\r\n        background: rgba(248, 81, 73, 0.1);\r\n        color: #f85149;\r\n      }\r\n      .email-badge.sentiment-neutral {\r\n        background: var(--bg-tertiary);\r\n        color: var(--text-secondary);\r\n      }\r\n      .email-badge.response-needed {\r\n        background: rgba(248, 81, 73, 0.1);\r\n        color: #f85149;\r\n      }\r\n      .email-preview-tabs {\r\n        display: flex;\r\n        gap: 4px;\r\n        padding: 0 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      .email-preview-tab {\r\n        padding: 12px 16px;\r\n        background: none;\r\n        border: none;\r\n        border-bottom: 2px solid transparent;\r\n        color: var(--text-secondary);\r\n        cursor: pointer;\r\n        font-size: 14px;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .email-preview-tab:hover {\r\n        color: var(--text-primary);\r\n      }\r\n      .email-preview-tab.active {\r\n        color: var(--primary);\r\n        border-bottom-color: var(--primary);\r\n      }\r\n      .email-preview-tab-badge {\r\n        background: var(--bg-tertiary);\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        font-size: 11px;\r\n        margin-left: 6px;\r\n      }\r\n      .email-preview-body {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 20px 24px;\r\n      }\r\n      .email-preview-section {\r\n        display: none;\r\n      }\r\n      .email-preview-section.active {\r\n        display: block;\r\n      }\r\n      .email-content-body {\r\n        background: var(--bg-secondary);\r\n        padding: 20px;\r\n        border-radius: 12px;\r\n        line-height: 1.7;\r\n      }\r\n      .extraction-card {\r\n        padding: 12px 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .extraction-type {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .extraction-content {\r\n        color: var(--text-primary);\r\n      }\r\n      .extraction-meta {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n        margin-top: 4px;\r\n      }\r\n      .section-title {\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 12px;\r\n        text-transform: uppercase;\r\n      }\r\n      .empty-section {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      .ai-summary-box {\r\n        padding: 16px;\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n        border-left: 3px solid var(--primary);\r\n        border-radius: 8px;\r\n        margin-bottom: 20px;\r\n      }\r\n      .ai-summary-label {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 8px;\r\n      }\r\n      .key-points-list {\r\n        list-style: none;\r\n        padding: 0;\r\n        margin: 0;\r\n      }\r\n      .key-points-list li {\r\n        padding: 8px 0;\r\n        border-bottom: 1px solid var(--border-color);\r\n        display: flex;\r\n        gap: 8px;\r\n      }\r\n      .key-points-list li:last-child {\r\n        border-bottom: none;\r\n      }\r\n      .key-points-list li::before {\r\n        content: \"\";\r\n        color: var(--primary);\r\n      }\r\n      .contact-card {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 12px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .contact-avatar {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 50%;\r\n        background: var(--bg-tertiary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n      }\r\n      .contact-info {\r\n        flex: 1;\r\n      }\r\n      .contact-name {\r\n        font-weight: 600;\r\n      }\r\n      .contact-details {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"email-preview-header\">\r\n      <div class=\"email-preview-icon\"></div>\r\n      <div style=\"flex: 1;\">\r\n        <h2 class=\"email-preview-title\">${escapeHtml(email.subject || 'No Subject')}</h2>\r\n        <div class=\"email-preview-meta\">\r\n          <div class=\"email-preview-meta-row\">\r\n            <span class=\"email-preview-meta-label\">From:</span>\r\n            <span><strong>${escapeHtml(email.from?.name || '')}</strong> &lt;${escapeHtml(email.from?.email || '')}&gt;</span>\r\n          </div>\r\n          <div class=\"email-preview-meta-row\">\r\n            <span class=\"email-preview-meta-label\">To:</span>\r\n            <span>${(email.to || []).map(r => escapeHtml(r.name || r.email)).join(', ')}</span>\r\n          </div>\r\n          <div class=\"email-preview-meta-row\">\r\n            <span class=\"email-preview-meta-label\">Date:</span>\r\n            <span>${formatRelativeTime(email.date)}</span>\r\n          </div>\r\n        </div>\r\n        <div class=\"email-preview-badges\">\r\n          ${extraction?.intent ? `<span class=\"email-badge intent\"> ${escapeHtml(extraction.intent)}</span>` : ''}\r\n          ${extraction?.sentiment ? `<span class=\"email-badge sentiment-${extraction.sentiment}\">${getSentimentEmoji(extraction.sentiment)} ${escapeHtml(extraction.sentiment)}</span>` : ''}\r\n          ${email.requires_response ? `<span class=\"email-badge response-needed\"> Response Needed</span>` : ''}\r\n        </div>\r\n      </div>\r\n      <button class=\"btn btn-sm close-btn\" style=\"font-size: 20px; padding: 4px 12px;\"></button>\r\n    </div>\r\n    \r\n    <div class=\"email-preview-tabs\">\r\n      <button class=\"email-preview-tab active\" data-tab=\"content\">Content</button>\r\n      <button class=\"email-preview-tab\" data-tab=\"analysis\" ${!hasExtraction ? 'style=\"display:none\"' : ''}>\r\n        Analysis\r\n      </button>\r\n      <button class=\"email-preview-tab\" data-tab=\"entities\" ${!extraction?.entities?.length ? 'style=\"display:none\"' : ''}>\r\n        Entities\r\n        <span class=\"email-preview-tab-badge\">${extraction?.entities?.length || 0}</span>\r\n      </button>\r\n      <button class=\"email-preview-tab\" data-tab=\"contacts\" ${!extraction?.contacts?.length ? 'style=\"display:none\"' : ''}>\r\n        Contacts\r\n        <span class=\"email-preview-tab-badge\">${extraction?.contacts?.length || 0}</span>\r\n      </button>\r\n    </div>\r\n    \r\n    <div class=\"email-preview-body\">\r\n      <div class=\"email-preview-section active\" data-section=\"content\">\r\n        ${extraction?.summary || email.ai_summary ? `\r\n          <div class=\"ai-summary-box\">\r\n            <div class=\"ai-summary-label\"> AI Summary</div>\r\n            <div>${escapeHtml(extraction?.summary || email.ai_summary || '')}</div>\r\n          </div>\r\n        ` : ''}\r\n        <div class=\"email-content-body\">\r\n          ${email.body_html || escapeHtml(email.body || '').replace(/\\n/g, '<br>')}\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"email-preview-section\" data-section=\"analysis\">\r\n        ${extraction?.key_points?.length ? `\r\n          <div class=\"section-title\">Key Points</div>\r\n          <ul class=\"key-points-list\">\r\n            ${extraction.key_points.map(p => `<li>${escapeHtml(p)}</li>`).join('')}\r\n          </ul>\r\n        ` : ''}\r\n        \r\n        ${extraction?.action_items?.length ? `\r\n          <div class=\"section-title\" style=\"margin-top: 20px;\">Action Items</div>\r\n          ${extraction.action_items.map(a => `\r\n            <div class=\"extraction-card\">\r\n              <div class=\"extraction-content\"> ${escapeHtml(a.task)}</div>\r\n              ${a.owner ? `<div class=\"extraction-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\r\n            </div>\r\n          `).join('')}\r\n        ` : ''}\r\n        \r\n        ${extraction?.questions?.length ? `\r\n          <div class=\"section-title\" style=\"margin-top: 20px;\">Questions</div>\r\n          ${extraction.questions.map(q => `\r\n            <div class=\"extraction-card\">\r\n              <div class=\"extraction-content\"> ${escapeHtml(q)}</div>\r\n            </div>\r\n          `).join('')}\r\n        ` : ''}\r\n        \r\n        ${!extraction?.key_points?.length && !extraction?.action_items?.length && !extraction?.questions?.length ? `\r\n          <div class=\"empty-section\">No analysis available</div>\r\n        ` : ''}\r\n      </div>\r\n      \r\n      <div class=\"email-preview-section\" data-section=\"entities\">\r\n        ${extraction?.entities?.length ? extraction.entities.map(e => `\r\n          <div class=\"extraction-card\">\r\n            <div class=\"extraction-type\">${escapeHtml(e.type)}</div>\r\n            <div class=\"extraction-content\">${escapeHtml(e.name)}</div>\r\n            ${e.confidence ? `<div class=\"extraction-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\r\n          </div>\r\n        `).join('') : '<div class=\"empty-section\">No entities extracted</div>'}\r\n      </div>\r\n      \r\n      <div class=\"email-preview-section\" data-section=\"contacts\">\r\n        ${extraction?.contacts?.length ? extraction.contacts.map(c => `\r\n          <div class=\"contact-card\">\r\n            <div class=\"contact-avatar\">${getInitials(c.name)}</div>\r\n            <div class=\"contact-info\">\r\n              <div class=\"contact-name\">${escapeHtml(c.name)}</div>\r\n              <div class=\"contact-details\">\r\n                ${c.title ? escapeHtml(c.title) + (c.organization ? ' at ' : '') : ''}\r\n                ${c.organization ? escapeHtml(c.organization) : ''}\r\n                ${c.email ? `<br>${escapeHtml(c.email)}` : ''}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        `).join('') : '<div class=\"empty-section\">No contacts extracted</div>'}\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Tab switching\r\n  content.querySelectorAll('.email-preview-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      const tabName = (tab as HTMLElement).dataset.tab;\r\n      content.querySelectorAll('.email-preview-tab').forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      content.querySelectorAll('.email-preview-section').forEach(s => s.classList.remove('active'));\r\n      content.querySelector(`[data-section=\"${tabName}\"]`)?.classList.add('active');\r\n    });\r\n  });\r\n\r\n  // Close button\r\n  content.querySelector('.close-btn')?.addEventListener('click', () => {\r\n    overlay.remove();\r\n    onClose?.();\r\n  });\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'modal-overlay email-preview-overlay';\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    inset: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    backdrop-filter: blur(4px);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 10000;\r\n  `;\r\n\r\n  const modal = document.createElement('div');\r\n  modal.style.cssText = `\r\n    background: var(--bg-primary);\r\n    border-radius: 16px;\r\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\r\n    overflow: hidden;\r\n  `;\r\n  modal.appendChild(content);\r\n  overlay.appendChild(modal);\r\n\r\n  // Close on backdrop click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      overlay.remove();\r\n      onClose?.();\r\n    }\r\n  });\r\n\r\n  // Close on escape\r\n  const handleEsc = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      overlay.remove();\r\n      onClose?.();\r\n      document.removeEventListener('keydown', handleEsc);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', handleEsc);\r\n\r\n  document.body.appendChild(overlay);\r\n}\r\n\r\nfunction getSentimentEmoji(sentiment: string): string {\r\n  switch (sentiment?.toLowerCase()) {\r\n    case 'positive': return '';\r\n    case 'negative': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(p => p[0])\r\n    .slice(0, 2)\r\n    .join('')\r\n    .toUpperCase();\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showEmailPreviewModal;\r\n","/**\r\n * Briefing Panel Component\r\n * Displays daily AI-generated briefing with history\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { chatService, Briefing, BriefingHistoryItem } from '../services/chat';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface BriefingPanelProps {\r\n  onActionClick?: (action: { type: string; id: string }) => void;\r\n}\r\n\r\nlet currentBriefing: Briefing | null = null;\r\nlet showHistory = false;\r\n\r\n/**\r\n * Create briefing panel\r\n */\r\nexport function createBriefingPanel(props: BriefingPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'briefing-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"briefing-header\">\r\n      <h2>Daily Briefing</h2>\r\n      <div class=\"briefing-actions\">\r\n        <button class=\"btn btn-sm\" id=\"toggle-history-btn\">History</button>\r\n        <button class=\"btn btn-sm btn-primary\" id=\"refresh-briefing-btn\">Refresh</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"briefing-content\" id=\"briefing-content\">\r\n      <div class=\"loading\">Generating briefing...</div>\r\n    </div>\r\n    <div class=\"briefing-history hidden\" id=\"briefing-history\"></div>\r\n  `;\r\n\r\n  // Bind events\r\n  const refreshBtn = panel.querySelector('#refresh-briefing-btn');\r\n  if (refreshBtn) {\r\n    on(refreshBtn as HTMLElement, 'click', () => loadBriefing(panel, true, props));\r\n  }\r\n\r\n  const historyBtn = panel.querySelector('#toggle-history-btn');\r\n  if (historyBtn) {\r\n    on(historyBtn as HTMLElement, 'click', () => {\r\n      showHistory = !showHistory;\r\n      const historyContainer = panel.querySelector('#briefing-history') as HTMLElement;\r\n      historyContainer.classList.toggle('hidden', !showHistory);\r\n      if (showHistory) {\r\n        loadHistory(historyContainer);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadBriefing(panel, false, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load briefing\r\n */\r\nasync function loadBriefing(\r\n  panel: HTMLElement, \r\n  refresh: boolean,\r\n  props: BriefingPanelProps\r\n): Promise<void> {\r\n  const content = panel.querySelector('#briefing-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Generating briefing...</div>';\r\n\r\n  try {\r\n    const briefing = await chatService.getBriefing(refresh);\r\n    currentBriefing = briefing;\r\n    renderBriefing(content, briefing, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to generate briefing</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render briefing content\r\n */\r\nfunction renderBriefing(\r\n  container: HTMLElement, \r\n  briefing: Briefing,\r\n  props: BriefingPanelProps\r\n): void {\r\n  container.innerHTML = `\r\n    <div class=\"briefing-meta\">\r\n      <span class=\"briefing-date\">${formatDate(briefing.generated_at)}</span>\r\n      ${briefing.cached ? `<span class=\"cached-badge\">Cached</span>` : ''}\r\n    </div>\r\n\r\n    <div class=\"briefing-text\">\r\n      ${renderMarkdown(briefing.briefing)}\r\n    </div>\r\n\r\n    ${briefing.analysis ? `\r\n      <div class=\"briefing-analysis\">\r\n        <h4>Analysis</h4>\r\n        <div class=\"analysis-content\">${renderMarkdown(briefing.analysis)}</div>\r\n      </div>\r\n    ` : ''}\r\n\r\n  `;\r\n}\r\n\r\n/**\r\n * Load briefing history\r\n */\r\nasync function loadHistory(container: HTMLElement): Promise<void> {\r\n  container.innerHTML = '<div class=\"loading\">Loading history...</div>';\r\n\r\n  try {\r\n    const history = await chatService.getBriefingHistory(10);\r\n    \r\n    if (!history || history.length === 0) {\r\n      container.innerHTML = '<p class=\"empty\">No previous briefings</p>';\r\n      return;\r\n    }\r\n\r\n    container.innerHTML = `\r\n      <h4>Previous Briefings</h4>\r\n      <div class=\"history-list\">\r\n        ${history.map((item: BriefingHistoryItem) => `\r\n          <div class=\"history-item\" data-id=\"${item.id}\">\r\n            <div class=\"history-date\">${formatDate(item.generated_at)}</div>\r\n            <div class=\"history-preview\">${escapeHtml(item.briefing.substring(0, 150))}...</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    `;\r\n\r\n    // Bind click events\r\n    container.querySelectorAll('.history-item').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        const id = item.getAttribute('data-id');\r\n        const historyItem = history.find((h: BriefingHistoryItem) => h.id === id);\r\n        if (historyItem) {\r\n          showHistoryDetail(container.closest('.briefing-panel') as HTMLElement, historyItem);\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to load history</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Show history detail\r\n */\r\nfunction showHistoryDetail(panel: HTMLElement, item: BriefingHistoryItem): void {\r\n  const content = panel.querySelector('#briefing-content') as HTMLElement;\r\n  \r\n  content.innerHTML = `\r\n    <div class=\"history-detail\">\r\n      <button class=\"btn btn-sm back-btn\" id=\"back-to-current\"> Back to current</button>\r\n      <div class=\"briefing-meta\">\r\n        <span class=\"briefing-date\">${formatDate(item.generated_at)}</span>\r\n        <span class=\"history-badge\">Historical</span>\r\n      </div>\r\n      <div class=\"briefing-text\">${renderMarkdown(item.briefing)}</div>\r\n    </div>\r\n  `;\r\n\r\n  const backBtn = content.querySelector('#back-to-current');\r\n  if (backBtn && currentBriefing) {\r\n    on(backBtn as HTMLElement, 'click', () => {\r\n      renderBriefing(content, currentBriefing!, {});\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Simple markdown renderer\r\n */\r\nfunction renderMarkdown(text: string): string {\r\n  return text\r\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\r\n    .replace(/^### (.*$)/gm, '<h5>$1</h5>')\r\n    .replace(/^## (.*$)/gm, '<h4>$1</h4>')\r\n    .replace(/^# (.*$)/gm, '<h3>$1</h3>')\r\n    .replace(/^- (.*$)/gm, '<li>$1</li>')\r\n    .replace(/(<li>.*<\\/li>)/gs, '<ul>$1</ul>')\r\n    .replace(/\\n\\n/g, '</p><p>')\r\n    .replace(/^(.+)$/gm, '<p>$1</p>')\r\n    .replace(/<p><\\/p>/g, '')\r\n    .replace(/<p>(<[hul])/g, '$1')\r\n    .replace(/(<\\/[hul][^>]*>)<\\/p>/g, '$1');\r\n}\r\n\r\n/**\r\n * Format date\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString(undefined, {\r\n    weekday: 'long',\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n  });\r\n}\r\n\r\n/**\r\n * Format label\r\n */\r\nfunction formatLabel(key: string): string {\r\n  return key\r\n    .replace(/_/g, ' ')\r\n    .replace(/([A-Z])/g, ' $1')\r\n    .replace(/^./, str => str.toUpperCase());\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createBriefingPanel;\r\n","/**\r\n * Reports Panel Component\r\n * Weekly reports and executive summaries with export\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { chatService } from '../services/chat';\r\nimport { toast } from '../services/toast';\r\n\r\nexport interface ReportsPanelProps {\r\n  onExport?: (type: 'pdf' | 'md', content: string) => void;\r\n}\r\n\r\ntype ReportType = 'weekly' | 'executive';\r\n\r\nlet currentReport: string = '';\r\nlet currentType: ReportType = 'weekly';\r\n\r\n/**\r\n * Create reports panel\r\n */\r\nexport function createReportsPanel(props: ReportsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'reports-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"reports-header\">\r\n      <h2>Reports</h2>\r\n      <div class=\"reports-actions\">\r\n        <button class=\"btn btn-sm\" id=\"export-md-btn\">Export MD</button>\r\n        <button class=\"btn btn-sm btn-primary\" id=\"export-pdf-btn\">Export PDF</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"reports-tabs\">\r\n      <button class=\"report-tab active\" data-type=\"weekly\">Weekly Report</button>\r\n      <button class=\"report-tab\" data-type=\"executive\">Executive Summary</button>\r\n    </div>\r\n    <div class=\"reports-content\" id=\"reports-content\">\r\n      <div class=\"loading\">Generating report...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind tab events\r\n  const tabs = panel.querySelectorAll('.report-tab');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentType = tab.getAttribute('data-type') as ReportType;\r\n      loadReport(panel, currentType);\r\n    });\r\n  });\r\n\r\n  // Export buttons\r\n  const exportMdBtn = panel.querySelector('#export-md-btn');\r\n  if (exportMdBtn) {\r\n    on(exportMdBtn as HTMLElement, 'click', () => exportReport('md', props));\r\n  }\r\n\r\n  const exportPdfBtn = panel.querySelector('#export-pdf-btn');\r\n  if (exportPdfBtn) {\r\n    on(exportPdfBtn as HTMLElement, 'click', () => exportReport('pdf', props));\r\n  }\r\n\r\n  // Initial load\r\n  loadReport(panel, 'weekly');\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load report\r\n */\r\nasync function loadReport(panel: HTMLElement, type: ReportType): Promise<void> {\r\n  const content = panel.querySelector('#reports-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Generating report...</div>';\r\n\r\n  try {\r\n    let report: string;\r\n\r\n    if (type === 'weekly') {\r\n      report = await chatService.getWeeklyReport();\r\n    } else {\r\n      report = await chatService.generateExecutiveSummary();\r\n    }\r\n\r\n    currentReport = report;\r\n    renderReport(content, report);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to generate report</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render report\r\n */\r\nfunction renderReport(container: HTMLElement, markdown: string): void {\r\n  container.innerHTML = `\r\n    <div class=\"report-preview\">\r\n      ${renderMarkdown(markdown)}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Export report\r\n */\r\nasync function exportReport(format: 'pdf' | 'md', props: ReportsPanelProps): Promise<void> {\r\n  if (!currentReport) {\r\n    toast.error('No report to export');\r\n    return;\r\n  }\r\n\r\n  if (props.onExport) {\r\n    props.onExport(format, currentReport);\r\n    return;\r\n  }\r\n\r\n  if (format === 'md') {\r\n    downloadFile(`${currentType}-report.md`, currentReport, 'text/markdown');\r\n    toast.success('Report downloaded');\r\n  } else if (format === 'pdf') {\r\n    await exportToPdf(currentReport, `${currentType}-report`);\r\n  }\r\n}\r\n\r\n/**\r\n * Download file\r\n */\r\nfunction downloadFile(filename: string, content: string, mimeType: string): void {\r\n  const blob = new Blob([content], { type: mimeType });\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = filename;\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  document.body.removeChild(a);\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\n/**\r\n * Export to PDF using html2pdf.js\r\n */\r\nasync function exportToPdf(markdown: string, filename: string): Promise<void> {\r\n  // Check if html2pdf is available\r\n  const html2pdf = (window as unknown as { html2pdf?: unknown }).html2pdf;\r\n  \r\n  if (!html2pdf) {\r\n    // Fallback: download as HTML\r\n    const html = `\r\n      <!DOCTYPE html>\r\n      <html>\r\n      <head>\r\n        <meta charset=\"utf-8\">\r\n        <title>${filename}</title>\r\n        <style>\r\n          body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 40px; }\r\n          h1 { color: #1a1a2e; }\r\n          h2 { color: #16213e; border-bottom: 1px solid #eee; padding-bottom: 10px; }\r\n          h3 { color: #0f3460; }\r\n          ul { padding-left: 20px; }\r\n          li { margin: 5px 0; }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        ${renderMarkdown(markdown)}\r\n      </body>\r\n      </html>\r\n    `;\r\n    downloadFile(`${filename}.html`, html, 'text/html');\r\n    toast.info('Downloaded as HTML (PDF library not available)');\r\n    return;\r\n  }\r\n\r\n  // Create temporary element for PDF generation\r\n  const tempDiv = document.createElement('div');\r\n  tempDiv.innerHTML = renderMarkdown(markdown);\r\n  tempDiv.style.cssText = 'font-family: system-ui, sans-serif; padding: 40px; max-width: 800px;';\r\n  document.body.appendChild(tempDiv);\r\n\r\n  try {\r\n    await (html2pdf as (element: HTMLElement) => { save: (filename: string) => Promise<void> })(tempDiv)\r\n      .save(`${filename}.pdf`);\r\n    toast.success('PDF exported');\r\n  } catch {\r\n    toast.error('Failed to export PDF');\r\n  } finally {\r\n    document.body.removeChild(tempDiv);\r\n  }\r\n}\r\n\r\n/**\r\n * Simple markdown renderer\r\n */\r\nfunction renderMarkdown(text: string): string {\r\n  return text\r\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\r\n    .replace(/^### (.*$)/gm, '<h3>$1</h3>')\r\n    .replace(/^## (.*$)/gm, '<h2>$1</h2>')\r\n    .replace(/^# (.*$)/gm, '<h1>$1</h1>')\r\n    .replace(/^- (.*$)/gm, '<li>$1</li>')\r\n    .replace(/(<li>.*<\\/li>)/gs, '<ul>$1</ul>')\r\n    .replace(/\\n\\n/g, '</p><p>')\r\n    .replace(/^(.+)$/gm, '<p>$1</p>')\r\n    .replace(/<p><\\/p>/g, '')\r\n    .replace(/<p>(<[hul])/g, '$1')\r\n    .replace(/(<\\/[hul][^>]*>)<\\/p>/g, '$1');\r\n}\r\n\r\nexport default createReportsPanel;\r\n","/**\r\n * Contacts Panel Component - SOTA Design\r\n * Contact list with search, filters, favorites, and management\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { contactsService, Contact } from '../services/contacts';\r\nimport { showContactModal } from './modals/ContactModal';\r\nimport { toast } from '../services/toast';\r\nimport { http } from '../services/api';\r\n\r\nexport interface ContactsPanelProps {\r\n  onContactClick?: (contact: Contact) => void;\r\n}\r\n\r\nlet currentSearch = '';\r\nlet currentFilter: { organization?: string; tag?: string; favorites?: boolean } = {};\r\nlet allContacts: Contact[] = [];\r\nlet selectedContactIds: Set<string> = new Set();\r\n\r\n/**\r\n * Create contacts panel\r\n */\r\nexport function createContactsPanel(props: ContactsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'contacts-panel-sota' });\r\n\r\n  panel.innerHTML = `\r\n    <style>\r\n      .contacts-panel-sota {\r\n        padding: 24px;\r\n        min-height: 100%;\r\n      }\r\n\r\n      /* Header */\r\n      .contacts-header {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        margin-bottom: 24px;\r\n        flex-wrap: wrap;\r\n        gap: 16px;\r\n      }\r\n\r\n      .contacts-title {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n\r\n      .contacts-title-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        border-radius: 14px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        box-shadow: 0 4px 12px rgba(225, 29, 72, 0.3);\r\n      }\r\n\r\n      .contacts-title-icon svg {\r\n        width: 26px;\r\n        height: 26px;\r\n        color: white;\r\n      }\r\n\r\n      .contacts-title h1 {\r\n        margin: 0;\r\n        font-size: 28px;\r\n        font-weight: 700;\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .contacts-count {\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        color: white;\r\n        padding: 4px 12px;\r\n        border-radius: 20px;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n      }\r\n\r\n      .contacts-actions {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n      }\r\n\r\n      /* Search Bar */\r\n      .contacts-search-wrapper {\r\n        position: relative;\r\n        flex: 1;\r\n        max-width: 400px;\r\n        min-width: 200px;\r\n      }\r\n\r\n      .contacts-search-wrapper svg {\r\n        position: absolute;\r\n        left: 14px;\r\n        top: 50%;\r\n        transform: translateY(-50%);\r\n        width: 18px;\r\n        height: 18px;\r\n        color: var(--text-tertiary);\r\n        pointer-events: none;\r\n        transition: color 0.2s;\r\n      }\r\n\r\n      .contacts-search {\r\n        width: 100%;\r\n        padding: 12px 14px 12px 44px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .contacts-search:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\r\n      }\r\n\r\n      .contacts-search:focus + svg {\r\n        color: #e11d48;\r\n      }\r\n\r\n      /* SOTA Buttons */\r\n      .btn-sota {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 10px 18px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n\r\n      .btn-sota.primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 12px rgba(225, 29, 72, 0.3);\r\n      }\r\n\r\n      .btn-sota.primary:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 6px 16px rgba(225, 29, 72, 0.4);\r\n      }\r\n\r\n      .btn-sota.secondary {\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n\r\n      .btn-sota.secondary:hover {\r\n        background: var(--bg-tertiary);\r\n        border-color: #e11d48;\r\n      }\r\n\r\n      .btn-sota svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      /* Filters */\r\n      .contacts-filters {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n        margin-bottom: 20px;\r\n        flex-wrap: wrap;\r\n      }\r\n\r\n      .filter-chip {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        padding: 8px 14px;\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 20px;\r\n        font-size: 13px;\r\n        font-weight: 500;\r\n        color: var(--text-secondary);\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .filter-chip:hover {\r\n        background: var(--bg-tertiary);\r\n        border-color: #e11d48;\r\n        color: #e11d48;\r\n      }\r\n\r\n      .filter-chip.active {\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\r\n        border-color: #e11d48;\r\n        color: #e11d48;\r\n      }\r\n\r\n      .filter-chip svg {\r\n        width: 14px;\r\n        height: 14px;\r\n      }\r\n\r\n      .filter-select {\r\n        padding: 8px 32px 8px 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 20px;\r\n        font-size: 13px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        cursor: pointer;\r\n        appearance: none;\r\n        background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E\");\r\n        background-repeat: no-repeat;\r\n        background-position: right 12px center;\r\n      }\r\n\r\n      .filter-select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n      }\r\n\r\n      /* Alerts */\r\n      .contacts-alerts {\r\n        margin-bottom: 20px;\r\n      }\r\n\r\n      .alert-sota {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 14px 18px;\r\n        background: linear-gradient(135deg, rgba(245,158,11,0.1) 0%, rgba(245,158,11,0.05) 100%);\r\n        border: 1px solid rgba(245,158,11,0.3);\r\n        border-radius: 12px;\r\n        color: #d97706;\r\n      }\r\n\r\n      .alert-sota svg {\r\n        width: 20px;\r\n        height: 20px;\r\n        flex-shrink: 0;\r\n      }\r\n\r\n      .alert-sota span {\r\n        flex: 1;\r\n        font-size: 14px;\r\n      }\r\n\r\n      .alert-sota .btn-sota {\r\n        padding: 6px 12px;\r\n        font-size: 12px;\r\n      }\r\n\r\n      /* Favorites Section */\r\n      .favorites-section {\r\n        margin-bottom: 28px;\r\n      }\r\n\r\n      .section-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        margin-bottom: 14px;\r\n        color: var(--text-secondary);\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n      }\r\n\r\n      .section-header svg {\r\n        width: 16px;\r\n        height: 16px;\r\n        color: #f59e0b;\r\n      }\r\n\r\n      .favorites-grid {\r\n        display: flex;\r\n        gap: 12px;\r\n        overflow-x: auto;\r\n        padding-bottom: 8px;\r\n      }\r\n\r\n      .favorite-card {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n        padding: 12px 16px;\r\n        background: linear-gradient(135deg, rgba(245,158,11,0.08) 0%, rgba(245,158,11,0.02) 100%);\r\n        border: 1px solid rgba(245,158,11,0.2);\r\n        border-radius: 12px;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        white-space: nowrap;\r\n      }\r\n\r\n      .favorite-card:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 4px 12px rgba(245,158,11,0.15);\r\n        border-color: #f59e0b;\r\n      }\r\n\r\n      .favorite-avatar {\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #f59e0b, #d97706);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: white;\r\n        flex-shrink: 0;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .favorite-avatar img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n\r\n      .favorite-info h4 {\r\n        margin: 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .favorite-info p {\r\n        margin: 2px 0 0 0;\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      /* Contacts Grid */\r\n      .contacts-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\r\n        gap: 16px;\r\n      }\r\n\r\n      .contact-card-sota {\r\n        background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.5) 100%);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 16px;\r\n        padding: 20px;\r\n        cursor: pointer;\r\n        transition: all 0.25s ease;\r\n        position: relative;\r\n        overflow: hidden;\r\n      }\r\n\r\n      [data-theme=\"dark\"] .contact-card-sota {\r\n        background: linear-gradient(135deg, rgba(30,41,59,0.9) 0%, rgba(30,41,59,0.5) 100%);\r\n      }\r\n\r\n      .contact-card-sota:hover {\r\n        transform: translateY(-4px);\r\n        box-shadow: 0 12px 32px rgba(0,0,0,0.1);\r\n        border-color: rgba(225,29,72,0.3);\r\n      }\r\n\r\n      .contact-card-sota::before {\r\n        content: '';\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        height: 4px;\r\n        background: linear-gradient(90deg, #e11d48, #f59e0b);\r\n        opacity: 0;\r\n        transition: opacity 0.2s;\r\n      }\r\n\r\n      .contact-card-sota:hover::before {\r\n        opacity: 1;\r\n      }\r\n\r\n      .contact-card-header {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 14px;\r\n        margin-bottom: 14px;\r\n      }\r\n\r\n      .contact-avatar-sota {\r\n        width: 56px;\r\n        height: 56px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 20px;\r\n        font-weight: 700;\r\n        color: white;\r\n        flex-shrink: 0;\r\n        overflow: hidden;\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.25);\r\n      }\r\n\r\n      .contact-avatar-sota img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n\r\n      .contact-main-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n\r\n      .contact-name-sota {\r\n        margin: 0 0 4px 0;\r\n        font-size: 17px;\r\n        font-weight: 700;\r\n        color: var(--text-primary);\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n\r\n      .contact-role-badge {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n        padding: 4px 10px;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\r\n        border-radius: 6px;\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n        color: #e11d48;\r\n        margin-bottom: 4px;\r\n      }\r\n\r\n      .contact-org-sota {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n      }\r\n\r\n      .contact-org-sota svg {\r\n        width: 14px;\r\n        height: 14px;\r\n        opacity: 0.6;\r\n      }\r\n\r\n      .contact-details-sota {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 6px;\r\n        padding-top: 12px;\r\n        border-top: 1px solid var(--border-color);\r\n      }\r\n\r\n      .contact-detail-item {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .contact-detail-item svg {\r\n        width: 14px;\r\n        height: 14px;\r\n        color: #e11d48;\r\n        flex-shrink: 0;\r\n      }\r\n\r\n      .contact-detail-item span {\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n\r\n      .contact-tags-sota {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 6px;\r\n        margin-top: 12px;\r\n      }\r\n\r\n      .contact-tag {\r\n        padding: 3px 8px;\r\n        background: var(--bg-tertiary);\r\n        border-radius: 4px;\r\n        font-size: 11px;\r\n        font-weight: 500;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .contact-quick-actions {\r\n        position: absolute;\r\n        top: 12px;\r\n        right: 12px;\r\n        display: flex;\r\n        gap: 6px;\r\n        opacity: 0;\r\n        transition: opacity 0.2s;\r\n      }\r\n\r\n      .contact-card-sota:hover .contact-quick-actions {\r\n        opacity: 1;\r\n      }\r\n\r\n      .quick-action-btn {\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 8px;\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .quick-action-btn:hover {\r\n        background: #e11d48;\r\n        border-color: #e11d48;\r\n        color: white;\r\n      }\r\n\r\n      .quick-action-btn.favorite {\r\n        color: #f59e0b;\r\n      }\r\n\r\n      .quick-action-btn.favorite.active {\r\n        background: #f59e0b;\r\n        border-color: #f59e0b;\r\n        color: white;\r\n      }\r\n\r\n      .quick-action-btn svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      /* Selection Checkbox */\r\n      .contact-select-checkbox {\r\n        position: absolute;\r\n        top: 12px;\r\n        left: 12px;\r\n        width: 22px;\r\n        height: 22px;\r\n        border-radius: 6px;\r\n        border: 2px solid var(--border-color);\r\n        background: var(--bg-primary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        z-index: 5;\r\n        opacity: 0;\r\n      }\r\n\r\n      .contact-card-sota:hover .contact-select-checkbox,\r\n      .contact-card-sota.selected .contact-select-checkbox {\r\n        opacity: 1;\r\n      }\r\n\r\n      .contact-select-checkbox:hover {\r\n        border-color: #e11d48;\r\n      }\r\n\r\n      .contact-select-checkbox.checked {\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        border-color: #e11d48;\r\n      }\r\n\r\n      .contact-select-checkbox svg {\r\n        width: 14px;\r\n        height: 14px;\r\n        color: white;\r\n        display: none;\r\n      }\r\n\r\n      .contact-select-checkbox.checked svg {\r\n        display: block;\r\n      }\r\n\r\n      .contact-card-sota.selected {\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 2px rgba(225,29,72,0.2);\r\n      }\r\n\r\n      /* Selection Bar */\r\n      .selection-bar {\r\n        position: fixed;\r\n        bottom: 24px;\r\n        left: 50%;\r\n        transform: translateX(-50%);\r\n        background: linear-gradient(135deg, #1e293b, #0f172a);\r\n        padding: 12px 24px;\r\n        border-radius: 50px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        box-shadow: 0 10px 40px rgba(0,0,0,0.3);\r\n        z-index: 1000;\r\n        animation: slideUp 0.3s ease;\r\n      }\r\n\r\n      @keyframes slideUp {\r\n        from { transform: translateX(-50%) translateY(100px); opacity: 0; }\r\n        to { transform: translateX(-50%) translateY(0); opacity: 1; }\r\n      }\r\n\r\n      .selection-bar-count {\r\n        color: white;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n      }\r\n\r\n      .selection-bar-count span {\r\n        color: #f59e0b;\r\n      }\r\n\r\n      .selection-bar-btn {\r\n        padding: 10px 20px;\r\n        border-radius: 25px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n\r\n      .selection-bar-btn.merge {\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        color: white;\r\n      }\r\n\r\n      .selection-bar-btn.merge:hover {\r\n        transform: scale(1.05);\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.4);\r\n      }\r\n\r\n      .selection-bar-btn.cancel {\r\n        background: rgba(255,255,255,0.1);\r\n        color: white;\r\n        border: 1px solid rgba(255,255,255,0.2);\r\n      }\r\n\r\n      .selection-bar-btn.cancel:hover {\r\n        background: rgba(255,255,255,0.2);\r\n      }\r\n\r\n      .selection-bar-btn svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      /* Empty State */\r\n      .contacts-empty-state {\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 80px 24px;\r\n        text-align: center;\r\n      }\r\n\r\n      .contacts-empty-state svg {\r\n        width: 80px;\r\n        height: 80px;\r\n        color: #e11d48;\r\n        opacity: 0.4;\r\n        margin-bottom: 24px;\r\n      }\r\n\r\n      .contacts-empty-state h3 {\r\n        margin: 0 0 8px 0;\r\n        font-size: 20px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .contacts-empty-state p {\r\n        margin: 0 0 24px 0;\r\n        font-size: 14px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      /* Loading */\r\n      .contacts-loading {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 60px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .contacts-loading::after {\r\n        content: '';\r\n        width: 24px;\r\n        height: 24px;\r\n        border: 3px solid var(--border-color);\r\n        border-top-color: #e11d48;\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n        margin-left: 12px;\r\n      }\r\n\r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n\r\n      /* Projects indicator */\r\n      .contact-projects-indicator {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        margin-top: 10px;\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n      }\r\n\r\n      .contact-projects-indicator svg {\r\n        width: 14px;\r\n        height: 14px;\r\n      }\r\n\r\n      .project-dot {\r\n        width: 8px;\r\n        height: 8px;\r\n        border-radius: 50%;\r\n        background: #e11d48;\r\n      }\r\n    </style>\r\n\r\n    <!-- Header -->\r\n    <div class=\"contacts-header\">\r\n      <div class=\"contacts-title\">\r\n        <div class=\"contacts-title-icon\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n          </svg>\r\n        </div>\r\n        <h1>Contacts</h1>\r\n        <span class=\"contacts-count\" id=\"contacts-count\">0</span>\r\n      </div>\r\n\r\n      <div class=\"contacts-actions\">\r\n        <div class=\"contacts-search-wrapper\">\r\n          <input type=\"search\" class=\"contacts-search\" id=\"contacts-search\" placeholder=\"Search contacts...\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/>\r\n          </svg>\r\n        </div>\r\n        <button class=\"btn-sota secondary\" id=\"import-contacts-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"/>\r\n          </svg>\r\n          Import\r\n        </button>\r\n        <button class=\"btn-sota secondary\" id=\"export-contacts-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"/>\r\n          </svg>\r\n          Export\r\n        </button>\r\n        <button class=\"btn-sota primary\" id=\"add-contact-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Add Contact\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Filters -->\r\n    <div class=\"contacts-filters\">\r\n      <div class=\"filter-chip\" id=\"filter-favorites\" data-filter=\"favorites\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\r\n        </svg>\r\n        Favorites\r\n      </div>\r\n      <select class=\"filter-select\" id=\"org-filter\">\r\n        <option value=\"\">All Organizations</option>\r\n      </select>\r\n      <select class=\"filter-select\" id=\"tag-filter\">\r\n        <option value=\"\">All Tags</option>\r\n      </select>\r\n    </div>\r\n\r\n    <!-- Alerts -->\r\n    <div class=\"contacts-alerts\" id=\"contacts-alerts\"></div>\r\n\r\n    <!-- Favorites Section -->\r\n    <div class=\"favorites-section\" id=\"favorites-section\" style=\"display: none;\">\r\n      <div class=\"section-header\">\r\n        <svg fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\r\n        </svg>\r\n        Favorites\r\n      </div>\r\n      <div class=\"favorites-grid\" id=\"favorites-grid\"></div>\r\n    </div>\r\n\r\n    <!-- Main Content -->\r\n    <div id=\"contacts-content\">\r\n      <div class=\"contacts-loading\">Loading contacts</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  bindEvents(panel, props);\r\n\r\n  // Initial load\r\n  loadContacts(panel, props);\r\n  checkDuplicates(panel);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Bind panel events\r\n */\r\nfunction bindEvents(panel: HTMLElement, props: ContactsPanelProps): void {\r\n  // Search\r\n  const searchInput = panel.querySelector('#contacts-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value;\r\n      loadContacts(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  // Organization filter\r\n  const orgFilter = panel.querySelector('#org-filter') as HTMLSelectElement;\r\n  on(orgFilter, 'change', () => {\r\n    currentFilter.organization = orgFilter.value || undefined;\r\n    loadContacts(panel, props);\r\n  });\r\n\r\n  // Tag filter\r\n  const tagFilter = panel.querySelector('#tag-filter') as HTMLSelectElement;\r\n  on(tagFilter, 'change', () => {\r\n    currentFilter.tag = tagFilter.value || undefined;\r\n    loadContacts(panel, props);\r\n  });\r\n\r\n  // Favorites filter\r\n  const favoritesChip = panel.querySelector('#filter-favorites');\r\n  if (favoritesChip) {\r\n    on(favoritesChip as HTMLElement, 'click', () => {\r\n      favoritesChip.classList.toggle('active');\r\n      currentFilter.favorites = favoritesChip.classList.contains('active');\r\n      loadContacts(panel, props);\r\n    });\r\n  }\r\n\r\n  // Add contact\r\n  const addBtn = panel.querySelector('#add-contact-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showContactModal({\r\n        mode: 'create',\r\n        onSave: () => loadContacts(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Export\r\n  const exportBtn = panel.querySelector('#export-contacts-btn');\r\n  if (exportBtn) {\r\n    on(exportBtn as HTMLElement, 'click', () => exportContacts());\r\n  }\r\n\r\n  // Import\r\n  const importBtn = panel.querySelector('#import-contacts-btn');\r\n  if (importBtn) {\r\n    on(importBtn as HTMLElement, 'click', () => {\r\n      toast.info('Import functionality coming soon');\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Load contacts\r\n */\r\nasync function loadContacts(panel: HTMLElement, props?: ContactsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#contacts-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"contacts-loading\">Loading contacts</div>';\r\n\r\n  try {\r\n    const { contacts, total } = await contactsService.getAll({\r\n      search: currentSearch || undefined,\r\n      organization: currentFilter.organization,\r\n      tag: currentFilter.tag,\r\n    });\r\n\r\n    // Filter favorites if needed\r\n    let filteredContacts = contacts;\r\n    if (currentFilter.favorites) {\r\n      filteredContacts = contacts.filter(c => c.isFavorite);\r\n    }\r\n\r\n    allContacts = contacts;\r\n\r\n    renderContacts(content, filteredContacts, props);\r\n    renderFavorites(panel, contacts.filter(c => c.isFavorite), props);\r\n    updateCount(panel, total);\r\n    updateFilters(panel, contacts);\r\n  } catch {\r\n    content.innerHTML = `\r\n      <div class=\"contacts-empty-state\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\r\n        </svg>\r\n        <h3>Failed to load contacts</h3>\r\n        <p>Please try again later</p>\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n\r\n/**\r\n * Render contacts grid\r\n */\r\nfunction renderContacts(container: HTMLElement, contacts: Contact[], props?: ContactsPanelProps): void {\r\n  if (contacts.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"contacts-empty-state\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n        </svg>\r\n        <h3>${currentSearch ? 'No contacts match your search' : 'No contacts yet'}</h3>\r\n        <p>${currentSearch ? 'Try a different search term' : 'Add your first contact to get started'}</p>\r\n        <button class=\"btn-sota primary\" id=\"empty-add-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Add Contact\r\n        </button>\r\n      </div>\r\n    `;\r\n    \r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showContactModal({ mode: 'create' });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"contacts-grid\">\r\n      ${contacts.map(contact => createContactCard(contact)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  bindContactCardEvents(container, contacts, props);\r\n}\r\n\r\n/**\r\n * Create contact card HTML\r\n */\r\nfunction createContactCard(contact: Contact): string {\r\n  const initials = getInitials(contact.name);\r\n  const hasPhoto = !!(contact.photoUrl || contact.avatarUrl);\r\n  const photoUrl = contact.photoUrl || contact.avatarUrl;\r\n  const isSelected = selectedContactIds.has(contact.id);\r\n\r\n  return `\r\n    <div class=\"contact-card-sota ${isSelected ? 'selected' : ''}\" data-id=\"${contact.id}\">\r\n      <div class=\"contact-select-checkbox ${isSelected ? 'checked' : ''}\" data-action=\"select\" data-id=\"${contact.id}\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M5 13l4 4L19 7\"/>\r\n        </svg>\r\n      </div>\r\n      <div class=\"contact-quick-actions\">\r\n        <button class=\"quick-action-btn favorite ${contact.isFavorite ? 'active' : ''}\" data-action=\"favorite\" data-id=\"${contact.id}\" title=\"Toggle favorite\">\r\n          <svg fill=\"${contact.isFavorite ? 'currentColor' : 'none'}\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\r\n          </svg>\r\n        </button>\r\n        <button class=\"quick-action-btn\" data-action=\"edit\" data-id=\"${contact.id}\" title=\"Edit contact\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <div class=\"contact-card-header\">\r\n        <div class=\"contact-avatar-sota\">\r\n          ${hasPhoto \r\n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\">`\r\n            : initials\r\n          }\r\n        </div>\r\n        <div class=\"contact-main-info\">\r\n          <h3 class=\"contact-name-sota\">${escapeHtml(contact.name)}</h3>\r\n          ${contact.role ? `<span class=\"contact-role-badge\">${escapeHtml(contact.role)}</span>` : ''}\r\n          ${contact.organization ? `\r\n            <div class=\"contact-org-sota\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\r\n              </svg>\r\n              ${escapeHtml(contact.organization)}\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"contact-details-sota\">\r\n        ${contact.email ? `\r\n          <div class=\"contact-detail-item\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n            </svg>\r\n            <span>${escapeHtml(contact.email)}</span>\r\n          </div>\r\n        ` : ''}\r\n        ${contact.phone ? `\r\n          <div class=\"contact-detail-item\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"/>\r\n            </svg>\r\n            <span>${escapeHtml(contact.phone)}</span>\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n\r\n      ${contact.tags && contact.tags.length > 0 ? `\r\n        <div class=\"contact-tags-sota\">\r\n          ${contact.tags.slice(0, 4).map(tag => `<span class=\"contact-tag\">${escapeHtml(tag)}</span>`).join('')}\r\n          ${contact.tags.length > 4 ? `<span class=\"contact-tag\">+${contact.tags.length - 4}</span>` : ''}\r\n        </div>\r\n      ` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind contact card events\r\n */\r\nfunction bindContactCardEvents(container: HTMLElement, contacts: Contact[], props?: ContactsPanelProps): void {\r\n  const panel = container.closest('.contacts-panel-sota') as HTMLElement;\r\n\r\n  // Selection checkbox click\r\n  container.querySelectorAll('.contact-select-checkbox').forEach(checkbox => {\r\n    on(checkbox as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      const id = checkbox.getAttribute('data-id');\r\n      if (!id) return;\r\n\r\n      const card = checkbox.closest('.contact-card-sota') as HTMLElement;\r\n      \r\n      if (selectedContactIds.has(id)) {\r\n        selectedContactIds.delete(id);\r\n        checkbox.classList.remove('checked');\r\n        card.classList.remove('selected');\r\n      } else {\r\n        selectedContactIds.add(id);\r\n        checkbox.classList.add('checked');\r\n        card.classList.add('selected');\r\n      }\r\n\r\n      if (props) updateSelectionBar(panel, contacts, props);\r\n    });\r\n  });\r\n\r\n  // Card click (open modal)\r\n  container.querySelectorAll('.contact-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      // Ignore if clicking quick action buttons or checkbox\r\n      if ((e.target as HTMLElement).closest('.quick-action-btn')) return;\r\n      if ((e.target as HTMLElement).closest('.contact-select-checkbox')) return;\r\n\r\n      const id = card.getAttribute('data-id');\r\n      const contact = contacts.find(c => String(c.id) === id);\r\n      if (contact) {\r\n        if (props?.onContactClick) {\r\n          props.onContactClick(contact);\r\n        } else {\r\n          showContactModal({\r\n            mode: 'edit',\r\n            contact,\r\n            onSave: () => loadContacts(panel, props),\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  // Quick action buttons\r\n  container.querySelectorAll('.quick-action-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const action = btn.getAttribute('data-action');\r\n      const id = btn.getAttribute('data-id');\r\n      const contact = contacts.find(c => String(c.id) === id);\r\n\r\n      if (!contact) return;\r\n\r\n      if (action === 'favorite') {\r\n        if (props) await toggleFavorite(contact, btn as HTMLElement, panel, props);\r\n      } else if (action === 'edit') {\r\n        showContactModal({\r\n          mode: 'edit',\r\n          contact,\r\n          onSave: () => loadContacts(panel, props),\r\n        });\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Update selection bar visibility and content\r\n */\r\nfunction updateSelectionBar(panel: HTMLElement, contacts: Contact[], props: ContactsPanelProps): void {\r\n  // Remove existing selection bar\r\n  const existingBar = document.querySelector('.selection-bar');\r\n  if (existingBar) existingBar.remove();\r\n\r\n  if (selectedContactIds.size < 2) return;\r\n\r\n  // Create selection bar\r\n  const bar = createElement('div', { className: 'selection-bar' });\r\n  bar.innerHTML = `\r\n    <span class=\"selection-bar-count\"><span>${selectedContactIds.size}</span> contacts selected</span>\r\n    <button class=\"selection-bar-btn merge\" id=\"merge-selected-btn\">\r\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\r\n      </svg>\r\n      Merge Selected\r\n    </button>\r\n    <button class=\"selection-bar-btn cancel\" id=\"cancel-selection-btn\">\r\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n      </svg>\r\n      Cancel\r\n    </button>\r\n  `;\r\n\r\n  document.body.appendChild(bar);\r\n\r\n  // Bind events\r\n  const mergeBtn = bar.querySelector('#merge-selected-btn');\r\n  const cancelBtn = bar.querySelector('#cancel-selection-btn');\r\n\r\n  on(cancelBtn as HTMLElement, 'click', () => {\r\n    clearSelection(panel);\r\n  });\r\n\r\n  on(mergeBtn as HTMLElement, 'click', async () => {\r\n    const ids = Array.from(selectedContactIds);\r\n    \r\n    // Get selected contacts for confirmation\r\n    const selectedContacts = contacts.filter(c => selectedContactIds.has(c.id));\r\n\r\n    const confirmed = await showMergeConfirmModal(selectedContacts);\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    (mergeBtn as HTMLButtonElement).disabled = true;\r\n    (mergeBtn as HTMLButtonElement).textContent = 'Merging...';\r\n\r\n    try {\r\n      await contactsService.mergeContacts(ids);\r\n      toast.success(`Merged ${ids.length} contacts successfully`);\r\n      clearSelection(panel);\r\n      await loadContacts(panel, props);\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : 'Failed to merge contacts';\r\n      toast.error(message);\r\n      (mergeBtn as HTMLButtonElement).disabled = false;\r\n      (mergeBtn as HTMLButtonElement).innerHTML = `\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\r\n        </svg>\r\n        Merge Selected\r\n      `;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Show styled merge confirmation modal\r\n */\r\nfunction showMergeConfirmModal(contacts: Contact[]): Promise<boolean> {\r\n  return new Promise((resolve) => {\r\n    const overlay = createElement('div', { className: 'merge-confirm-overlay' });\r\n    \r\n    const primaryContact = contacts[0];\r\n    const otherContacts = contacts.slice(1);\r\n    \r\n    overlay.innerHTML = `\r\n      <style>\r\n        .merge-confirm-overlay {\r\n          position: fixed;\r\n          top: 0;\r\n          left: 0;\r\n          right: 0;\r\n          bottom: 0;\r\n          background: rgba(0, 0, 0, 0.6);\r\n          backdrop-filter: blur(4px);\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          z-index: 10000;\r\n          animation: fadeIn 0.2s ease;\r\n        }\r\n        \r\n        @keyframes fadeIn {\r\n          from { opacity: 0; }\r\n          to { opacity: 1; }\r\n        }\r\n        \r\n        .merge-confirm-modal {\r\n          background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\r\n          border-radius: 16px;\r\n          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\r\n          max-width: 480px;\r\n          width: 90%;\r\n          overflow: hidden;\r\n          animation: slideUp 0.3s ease;\r\n        }\r\n        \r\n        @keyframes slideUp {\r\n          from { transform: translateY(20px); opacity: 0; }\r\n          to { transform: translateY(0); opacity: 1; }\r\n        }\r\n        \r\n        .merge-confirm-header {\r\n          background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\r\n          color: white;\r\n          padding: 20px 24px;\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 12px;\r\n        }\r\n        \r\n        .merge-confirm-header svg {\r\n          width: 24px;\r\n          height: 24px;\r\n        }\r\n        \r\n        .merge-confirm-header h3 {\r\n          margin: 0;\r\n          font-size: 18px;\r\n          font-weight: 600;\r\n        }\r\n        \r\n        .merge-confirm-body {\r\n          padding: 24px;\r\n        }\r\n        \r\n        .merge-confirm-body p {\r\n          margin: 0 0 16px 0;\r\n          color: #64748b;\r\n          font-size: 14px;\r\n        }\r\n        \r\n        .merge-contact-list {\r\n          display: flex;\r\n          flex-direction: column;\r\n          gap: 8px;\r\n          margin-bottom: 16px;\r\n        }\r\n        \r\n        .merge-contact-item {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 12px;\r\n          padding: 12px;\r\n          background: #f8fafc;\r\n          border-radius: 10px;\r\n          border: 1px solid #e2e8f0;\r\n        }\r\n        \r\n        .merge-contact-item.primary {\r\n          background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\r\n          border-color: #f59e0b;\r\n        }\r\n        \r\n        .merge-contact-avatar {\r\n          width: 40px;\r\n          height: 40px;\r\n          border-radius: 50%;\r\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n          color: white;\r\n          font-weight: 600;\r\n          font-size: 14px;\r\n          flex-shrink: 0;\r\n        }\r\n        \r\n        .merge-contact-avatar img {\r\n          width: 100%;\r\n          height: 100%;\r\n          border-radius: 50%;\r\n          object-fit: cover;\r\n        }\r\n        \r\n        .merge-contact-info {\r\n          flex: 1;\r\n          min-width: 0;\r\n        }\r\n        \r\n        .merge-contact-name {\r\n          font-weight: 600;\r\n          color: #1e293b;\r\n          font-size: 14px;\r\n          margin-bottom: 2px;\r\n        }\r\n        \r\n        .merge-contact-details {\r\n          font-size: 12px;\r\n          color: #64748b;\r\n          white-space: nowrap;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis;\r\n        }\r\n        \r\n        .merge-contact-badge {\r\n          background: #f59e0b;\r\n          color: white;\r\n          font-size: 10px;\r\n          font-weight: 600;\r\n          padding: 4px 8px;\r\n          border-radius: 6px;\r\n          text-transform: uppercase;\r\n        }\r\n        \r\n        .merge-warning {\r\n          display: flex;\r\n          align-items: flex-start;\r\n          gap: 10px;\r\n          padding: 12px;\r\n          background: #fef3c7;\r\n          border-radius: 10px;\r\n          margin-top: 16px;\r\n        }\r\n        \r\n        .merge-warning svg {\r\n          width: 18px;\r\n          height: 18px;\r\n          color: #d97706;\r\n          flex-shrink: 0;\r\n          margin-top: 1px;\r\n        }\r\n        \r\n        .merge-warning p {\r\n          margin: 0;\r\n          color: #92400e;\r\n          font-size: 13px;\r\n          line-height: 1.5;\r\n        }\r\n        \r\n        .merge-confirm-footer {\r\n          display: flex;\r\n          gap: 12px;\r\n          padding: 16px 24px 24px;\r\n          justify-content: flex-end;\r\n        }\r\n        \r\n        .merge-confirm-btn {\r\n          padding: 10px 20px;\r\n          border-radius: 10px;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          cursor: pointer;\r\n          transition: all 0.2s ease;\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 8px;\r\n        }\r\n        \r\n        .merge-confirm-btn.cancel {\r\n          background: #f1f5f9;\r\n          border: 1px solid #e2e8f0;\r\n          color: #64748b;\r\n        }\r\n        \r\n        .merge-confirm-btn.cancel:hover {\r\n          background: #e2e8f0;\r\n        }\r\n        \r\n        .merge-confirm-btn.confirm {\r\n          background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\r\n          border: none;\r\n          color: white;\r\n          box-shadow: 0 4px 14px rgba(245, 158, 11, 0.4);\r\n        }\r\n        \r\n        .merge-confirm-btn.confirm:hover {\r\n          transform: translateY(-1px);\r\n          box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5);\r\n        }\r\n        \r\n        .merge-confirm-btn svg {\r\n          width: 16px;\r\n          height: 16px;\r\n        }\r\n      </style>\r\n      \r\n      <div class=\"merge-confirm-modal\">\r\n        <div class=\"merge-confirm-header\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\r\n          </svg>\r\n          <h3>Merge Contacts</h3>\r\n        </div>\r\n        \r\n        <div class=\"merge-confirm-body\">\r\n          <p>The following contacts will be merged into one:</p>\r\n          \r\n          <div class=\"merge-contact-list\">\r\n            ${contacts.map((c, i) => {\r\n              const avatar = c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url;\r\n              const initials = (c.name || '?').split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n              const detail = c.email || c.organization || c.company || '';\r\n              \r\n              return `\r\n                <div class=\"merge-contact-item ${i === 0 ? 'primary' : ''}\">\r\n                  <div class=\"merge-contact-avatar\">\r\n                    ${avatar ? `<img src=\"${avatar}\" alt=\"${c.name}\">` : initials}\r\n                  </div>\r\n                  <div class=\"merge-contact-info\">\r\n                    <div class=\"merge-contact-name\">${c.name || 'Unknown'}</div>\r\n                    <div class=\"merge-contact-details\">${detail}</div>\r\n                  </div>\r\n                  ${i === 0 ? '<span class=\"merge-contact-badge\">Primary</span>' : ''}\r\n                </div>\r\n              `;\r\n            }).join('')}\r\n          </div>\r\n          \r\n          <div class=\"merge-warning\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n            </svg>\r\n            <p>All information will be combined into the primary contact. Other contacts will be archived. This action cannot be undone.</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"merge-confirm-footer\">\r\n          <button class=\"merge-confirm-btn cancel\" id=\"merge-cancel-btn\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n            </svg>\r\n            Cancel\r\n          </button>\r\n          <button class=\"merge-confirm-btn confirm\" id=\"merge-confirm-btn\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n            </svg>\r\n            Merge Contacts\r\n          </button>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    document.body.appendChild(overlay);\r\n    \r\n    const cancelBtn = overlay.querySelector('#merge-cancel-btn');\r\n    const confirmBtn = overlay.querySelector('#merge-confirm-btn');\r\n    \r\n    const close = (result: boolean) => {\r\n      overlay.remove();\r\n      resolve(result);\r\n    };\r\n    \r\n    on(cancelBtn as HTMLElement, 'click', () => close(false));\r\n    on(confirmBtn as HTMLElement, 'click', () => close(true));\r\n    on(overlay, 'click', (e) => {\r\n      if (e.target === overlay) close(false);\r\n    });\r\n    \r\n    // ESC to close\r\n    const handleEsc = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        document.removeEventListener('keydown', handleEsc);\r\n        close(false);\r\n      }\r\n    };\r\n    document.addEventListener('keydown', handleEsc);\r\n  });\r\n}\r\n\r\n/**\r\n * Clear selection\r\n */\r\nfunction clearSelection(panel: HTMLElement): void {\r\n  selectedContactIds.clear();\r\n  \r\n  // Remove selected class from cards\r\n  panel.querySelectorAll('.contact-card-sota.selected').forEach(card => {\r\n    card.classList.remove('selected');\r\n  });\r\n  panel.querySelectorAll('.contact-select-checkbox.checked').forEach(checkbox => {\r\n    checkbox.classList.remove('checked');\r\n  });\r\n\r\n  // Remove selection bar\r\n  const bar = document.querySelector('.selection-bar');\r\n  if (bar) bar.remove();\r\n}\r\n\r\n/**\r\n * Toggle favorite\r\n */\r\nasync function toggleFavorite(contact: Contact, btn: HTMLElement, panel: HTMLElement, props: ContactsPanelProps): Promise<void> {\r\n  const newValue = !contact.isFavorite;\r\n  \r\n  try {\r\n    await http.put(`/api/contacts/${contact.id}`, { is_favorite: newValue });\r\n    contact.isFavorite = newValue;\r\n    \r\n    // Update button visually\r\n    btn.classList.toggle('active', newValue);\r\n    const svg = btn.querySelector('svg');\r\n    if (svg) {\r\n      svg.setAttribute('fill', newValue ? 'currentColor' : 'none');\r\n    }\r\n\r\n    // Refresh favorites section\r\n    renderFavorites(panel, allContacts.filter(c => c.isFavorite || (c.id === contact.id && newValue)), props);\r\n    \r\n    toast.success(newValue ? 'Added to favorites' : 'Removed from favorites');\r\n  } catch {\r\n    toast.error('Failed to update favorite');\r\n  }\r\n}\r\n\r\n/**\r\n * Render favorites section\r\n */\r\nfunction renderFavorites(panel: HTMLElement, favorites: Contact[], props?: ContactsPanelProps): void {\r\n  const section = panel.querySelector('#favorites-section') as HTMLElement;\r\n  const grid = panel.querySelector('#favorites-grid') as HTMLElement;\r\n\r\n  if (favorites.length === 0) {\r\n    section.style.display = 'none';\r\n    return;\r\n  }\r\n\r\n  section.style.display = 'block';\r\n  grid.innerHTML = favorites.map(contact => {\r\n    const initials = getInitials(contact.name);\r\n    const hasPhoto = !!(contact.photoUrl || contact.avatarUrl);\r\n    const photoUrl = contact.photoUrl || contact.avatarUrl;\r\n\r\n    return `\r\n      <div class=\"favorite-card\" data-id=\"${contact.id}\">\r\n        <div class=\"favorite-avatar\">\r\n          ${hasPhoto \r\n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\">`\r\n            : initials\r\n          }\r\n        </div>\r\n        <div class=\"favorite-info\">\r\n          <h4>${escapeHtml(contact.name)}</h4>\r\n          ${contact.organization ? `<p>${escapeHtml(contact.organization)}</p>` : ''}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }).join('');\r\n\r\n  // Bind click events\r\n  grid.querySelectorAll('.favorite-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const contact = favorites.find(c => String(c.id) === id);\r\n      if (contact) {\r\n        showContactModal({\r\n          mode: 'edit',\r\n          contact,\r\n          onSave: () => loadContacts(panel, props),\r\n        });\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Check for duplicates\r\n */\r\nasync function checkDuplicates(panel: HTMLElement): Promise<void> {\r\n  const alertsContainer = panel.querySelector('#contacts-alerts') as HTMLElement;\r\n\r\n  try {\r\n    const { duplicates } = await contactsService.getDuplicates();\r\n    \r\n    if (duplicates.length > 0) {\r\n      alertsContainer.innerHTML = `\r\n        <div class=\"alert-sota\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\r\n          </svg>\r\n          <span><strong>${duplicates.length}</strong> potential duplicate contacts found</span>\r\n          <button class=\"btn-sota secondary\" id=\"review-duplicates-btn\">Review Duplicates</button>\r\n        </div>\r\n      `;\r\n\r\n      const reviewBtn = alertsContainer.querySelector('#review-duplicates-btn');\r\n      if (reviewBtn) {\r\n        on(reviewBtn as HTMLElement, 'click', () => {\r\n          showDuplicatesReviewModal(duplicates, panel);\r\n        });\r\n      }\r\n    }\r\n  } catch {\r\n    // Ignore errors\r\n  }\r\n}\r\n\r\n/**\r\n * Show duplicates review modal\r\n */\r\nfunction showDuplicatesReviewModal(duplicateGroups: Contact[][], panel: HTMLElement): void {\r\n  // Create overlay\r\n  const overlay = createElement('div', { className: 'duplicates-review-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <style>\r\n      .duplicates-review-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0,0,0,0.6);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 10000;\r\n        animation: fadeIn 0.2s ease;\r\n      }\r\n      \r\n      @keyframes fadeIn {\r\n        from { opacity: 0; }\r\n        to { opacity: 1; }\r\n      }\r\n      \r\n      .duplicates-modal {\r\n        background: var(--bg-primary);\r\n        border-radius: 16px;\r\n        width: 700px;\r\n        max-width: 95vw;\r\n        max-height: 85vh;\r\n        display: flex;\r\n        flex-direction: column;\r\n        box-shadow: 0 25px 60px rgba(0,0,0,0.3);\r\n        animation: slideUp 0.2s ease;\r\n      }\r\n      \r\n      @keyframes slideUp {\r\n        from { transform: translateY(20px); opacity: 0; }\r\n        to { transform: translateY(0); opacity: 1; }\r\n      }\r\n      \r\n      .duplicates-header {\r\n        padding: 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n      }\r\n      \r\n      .duplicates-header h2 {\r\n        margin: 0;\r\n        font-size: 20px;\r\n        font-weight: 600;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n      }\r\n      \r\n      .duplicates-header h2 svg {\r\n        width: 24px;\r\n        height: 24px;\r\n        color: #f59e0b;\r\n      }\r\n      \r\n      .duplicates-header .close-btn {\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 50%;\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .duplicates-header .close-btn:hover {\r\n        background: var(--bg-tertiary);\r\n        border-color: #e11d48;\r\n      }\r\n      \r\n      .duplicates-header .close-btn svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      .duplicates-content {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 24px;\r\n      }\r\n      \r\n      .duplicate-group {\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        padding: 16px;\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      .duplicate-group:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .duplicate-group-header {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        margin-bottom: 12px;\r\n        padding-bottom: 12px;\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .duplicate-group-header h4 {\r\n        margin: 0;\r\n        font-size: 14px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      .merge-group-btn {\r\n        padding: 8px 16px;\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        color: white;\r\n        border: none;\r\n        border-radius: 8px;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .merge-group-btn:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .merge-group-btn svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n      \r\n      .duplicate-contacts {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 8px;\r\n      }\r\n      \r\n      .duplicate-contact-row {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 10px 12px;\r\n        background: var(--bg-primary);\r\n        border-radius: 8px;\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .duplicate-contact-row input[type=\"radio\"] {\r\n        width: 18px;\r\n        height: 18px;\r\n        accent-color: #e11d48;\r\n      }\r\n      \r\n      .duplicate-avatar {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: white;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .duplicate-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      \r\n      .duplicate-info h5 {\r\n        margin: 0 0 2px 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .duplicate-info p {\r\n        margin: 0;\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      .duplicate-aliases {\r\n        margin-top: 4px;\r\n        display: flex;\r\n        gap: 4px;\r\n        flex-wrap: wrap;\r\n      }\r\n      \r\n      .alias-tag {\r\n        padding: 2px 6px;\r\n        background: rgba(99,102,241,0.1);\r\n        color: #6366f1;\r\n        border-radius: 4px;\r\n        font-size: 10px;\r\n        font-weight: 500;\r\n      }\r\n      \r\n      .duplicates-footer {\r\n        padding: 16px 24px;\r\n        border-top: 1px solid var(--border-color);\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 10px;\r\n      }\r\n      \r\n      .duplicates-footer button {\r\n        padding: 10px 20px;\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .duplicates-footer .close-review-btn {\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .duplicates-footer .close-review-btn:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .no-duplicates-msg {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      .no-duplicates-msg svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        opacity: 0.4;\r\n        margin-bottom: 12px;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"duplicates-modal\">\r\n      <div class=\"duplicates-header\">\r\n        <h2>\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n          </svg>\r\n          Review Duplicate Contacts\r\n        </h2>\r\n        <button class=\"close-btn\" id=\"close-duplicates-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      \r\n      <div class=\"duplicates-content\" id=\"duplicates-content\">\r\n        ${duplicateGroups.length === 0 ? `\r\n          <div class=\"no-duplicates-msg\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n            </svg>\r\n            <p>No duplicate contacts found</p>\r\n          </div>\r\n        ` : duplicateGroups.map((group, groupIndex) => `\r\n          <div class=\"duplicate-group\" data-group-index=\"${groupIndex}\">\r\n            <div class=\"duplicate-group-header\">\r\n              <h4>Potential duplicates (${group.length} contacts)</h4>\r\n              <button class=\"merge-group-btn\" data-group-index=\"${groupIndex}\">\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\r\n                </svg>\r\n                Merge All\r\n              </button>\r\n            </div>\r\n            <div class=\"duplicate-contacts\">\r\n              ${group.map((contact, idx) => `\r\n                <div class=\"duplicate-contact-row\">\r\n                  <input type=\"radio\" name=\"primary-${groupIndex}\" value=\"${contact.id}\" ${idx === 0 ? 'checked' : ''}>\r\n                  <div class=\"duplicate-avatar\">${getInitials(contact.name)}</div>\r\n                  <div class=\"duplicate-info\">\r\n                    <h5>${escapeHtml(contact.name)}${idx === 0 ? ' (Primary)' : ''}</h5>\r\n                    <p>${escapeHtml(contact.email || '')}${contact.organization ? `  ${escapeHtml(contact.organization)}` : ''}</p>\r\n                    ${(contact.aliases && contact.aliases.length > 0) ? `\r\n                      <div class=\"duplicate-aliases\">\r\n                        ${contact.aliases.map(alias => `<span class=\"alias-tag\">${escapeHtml(alias)}</span>`).join('')}\r\n                      </div>\r\n                    ` : ''}\r\n                  </div>\r\n                </div>\r\n              `).join('')}\r\n            </div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n      \r\n      <div class=\"duplicates-footer\">\r\n        <button class=\"close-review-btn\" id=\"close-review-btn\">Close</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Close handlers\r\n  const closeOverlay = () => overlay.remove();\r\n  \r\n  const closeBtn = overlay.querySelector('#close-duplicates-btn');\r\n  const closeReviewBtn = overlay.querySelector('#close-review-btn');\r\n  \r\n  if (closeBtn) on(closeBtn as HTMLElement, 'click', closeOverlay);\r\n  if (closeReviewBtn) on(closeReviewBtn as HTMLElement, 'click', closeOverlay);\r\n  on(overlay, 'click', (e: Event) => {\r\n    if (e.target === overlay) closeOverlay();\r\n  });\r\n\r\n  // Merge handlers\r\n  overlay.querySelectorAll('.merge-group-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const groupIndex = parseInt(btn.getAttribute('data-group-index') || '0');\r\n      const group = duplicateGroups[groupIndex];\r\n      \r\n      if (!group || group.length < 2) return;\r\n\r\n      // Get selected primary contact\r\n      const selectedRadio = overlay.querySelector(`input[name=\"primary-${groupIndex}\"]:checked`) as HTMLInputElement;\r\n      const primaryId = selectedRadio?.value || group[0].id;\r\n      \r\n      // Reorder so primary is first\r\n      const orderedIds = [primaryId, ...group.filter(c => c.id !== primaryId).map(c => c.id)];\r\n      \r\n      (btn as HTMLButtonElement).disabled = true;\r\n      (btn as HTMLButtonElement).textContent = 'Merging...';\r\n      \r\n      try {\r\n        await contactsService.mergeContacts(orderedIds);\r\n        toast.success(`Merged ${group.length} contacts successfully`);\r\n        \r\n        // Remove this group from the UI\r\n        const groupEl = overlay.querySelector(`.duplicate-group[data-group-index=\"${groupIndex}\"]`);\r\n        if (groupEl) groupEl.remove();\r\n        \r\n        // Check if no more groups\r\n        const remainingGroups = overlay.querySelectorAll('.duplicate-group');\r\n        if (remainingGroups.length === 0) {\r\n          const content = overlay.querySelector('#duplicates-content');\r\n          if (content) {\r\n            content.innerHTML = `\r\n              <div class=\"no-duplicates-msg\">\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n                </svg>\r\n                <p>All duplicates have been merged!</p>\r\n              </div>\r\n            `;\r\n          }\r\n        }\r\n        \r\n        // Refresh contacts list\r\n        await loadContacts(panel);\r\n        \r\n      } catch (error) {\r\n        const message = error instanceof Error ? error.message : 'Failed to merge contacts';\r\n        toast.error(message);\r\n        (btn as HTMLButtonElement).disabled = false;\r\n        (btn as HTMLButtonElement).innerHTML = `\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\r\n          </svg>\r\n          Merge All\r\n        `;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Update filters\r\n */\r\nfunction updateFilters(panel: HTMLElement, contacts: Contact[]): void {\r\n  // Organizations\r\n  const orgFilter = panel.querySelector('#org-filter') as HTMLSelectElement;\r\n  const orgs = [...new Set(contacts.map(c => c.organization).filter(Boolean))].sort();\r\n  \r\n  const currentOrg = orgFilter.value;\r\n  orgFilter.innerHTML = `\r\n    <option value=\"\">All Organizations</option>\r\n    ${orgs.map(org => `<option value=\"${escapeHtml(org!)}\" ${currentOrg === org ? 'selected' : ''}>${escapeHtml(org!)}</option>`).join('')}\r\n  `;\r\n\r\n  // Tags\r\n  const tagFilter = panel.querySelector('#tag-filter') as HTMLSelectElement;\r\n  const allTags = contacts.flatMap(c => c.tags || []);\r\n  const uniqueTags = [...new Set(allTags)].sort();\r\n  \r\n  const currentTag = tagFilter.value;\r\n  tagFilter.innerHTML = `\r\n    <option value=\"\">All Tags</option>\r\n    ${uniqueTags.map(tag => `<option value=\"${escapeHtml(tag)}\" ${currentTag === tag ? 'selected' : ''}>${escapeHtml(tag)}</option>`).join('')}\r\n  `;\r\n}\r\n\r\n/**\r\n * Export contacts\r\n */\r\nasync function exportContacts(): Promise<void> {\r\n  try {\r\n    await contactsService.export('json');\r\n    toast.success('Contacts exported');\r\n  } catch {\r\n    toast.error('Failed to export contacts');\r\n  }\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#contacts-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createContactsPanel;\r\n","/**\r\n * Teams Panel Component\r\n * Team list with members management\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { teamsService, Team } from '../services/contacts';\r\nimport { showTeamModal } from './modals/TeamModal';\r\nimport { toast } from '../services/toast';\r\n\r\nexport interface TeamsPanelProps {\r\n  onTeamClick?: (team: Team) => void;\r\n}\r\n\r\n/**\r\n * Create teams panel\r\n */\r\nexport function createTeamsPanel(props: TeamsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'teams-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Teams</h2>\r\n        <span class=\"panel-count\" id=\"teams-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-team-btn\">+ Add Team</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"teams-content\">\r\n      <div class=\"loading\">Loading teams...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const addBtn = panel.querySelector('#add-team-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showTeamModal({\r\n        mode: 'create',\r\n        onSave: () => loadTeams(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadTeams(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load teams\r\n */\r\nasync function loadTeams(panel: HTMLElement, props: TeamsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#teams-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const teams = await teamsService.getAll();\r\n    renderTeams(content, teams, props);\r\n    updateCount(panel, teams.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load teams</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render teams\r\n */\r\nfunction renderTeams(container: HTMLElement, teams: Team[], props: TeamsPanelProps): void {\r\n  if (teams.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No teams yet</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Create Team</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showTeamModal({ mode: 'create' });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"teams-grid\">\r\n      ${teams.map(team => createTeamCard(team)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.team-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const team = teams.find(t => String(t.id) === id);\r\n      if (team) {\r\n        if (props.onTeamClick) {\r\n          props.onTeamClick(team);\r\n        } else {\r\n          showTeamModal({\r\n            mode: 'edit',\r\n            team,\r\n            onSave: () => loadTeams(card.closest('.teams-panel') as HTMLElement, props),\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Create team card HTML\r\n */\r\nfunction createTeamCard(team: Team): string {\r\n  const memberCount = team.memberCount || 0;\r\n  const leadMember = team.memberDetails?.find(m => m.isLead);\r\n\r\n  return `\r\n    <div class=\"team-card\" data-id=\"${team.id}\">\r\n      <div class=\"team-header\">\r\n        <div class=\"team-color\" style=\"background: ${team.color || '#6366f1'}\"></div>\r\n        <div class=\"team-name\">${escapeHtml(team.name)}</div>\r\n        ${team.team_type ? `<span class=\"team-type\">${team.team_type}</span>` : ''}\r\n      </div>\r\n      ${team.description ? `<div class=\"team-description\">${escapeHtml(team.description)}</div>` : ''}\r\n      <div class=\"team-stats\">\r\n        <span class=\"member-count\">${memberCount} member${memberCount !== 1 ? 's' : ''}</span>\r\n        ${leadMember ? `<span class=\"team-lead\">Lead: ${escapeHtml(leadMember.name)}</span>` : ''}\r\n      </div>\r\n      ${team.memberDetails && team.memberDetails.length > 0 ? `\r\n        <div class=\"team-members-preview\">\r\n          ${team.memberDetails.slice(0, 5).map(member => `\r\n            <div class=\"member-avatar\" title=\"${escapeHtml(member.name)}\">\r\n              ${getInitials(member.name)}\r\n            </div>\r\n          `).join('')}\r\n          ${team.memberDetails.length > 5 ? `<div class=\"more-members\">+${team.memberDetails.length - 5}</div>` : ''}\r\n        </div>\r\n      ` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#teams-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createTeamsPanel;\r\n","/**\r\n * Org Chart Component\r\n * Interactive organization chart using vis-network\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { contactsService, Contact } from '../services/contacts';\r\nimport { showContactModal } from './modals/ContactModal';\r\n\r\nexport interface OrgChartProps {\r\n  onNodeClick?: (contact: Contact) => void;\r\n}\r\n\r\ninterface OrgNode {\r\n  id: string;\r\n  label: string;\r\n  title: string;\r\n  level: number;\r\n  color?: string;\r\n}\r\n\r\ninterface OrgEdge {\r\n  from: string;\r\n  to: string;\r\n  arrows: string;\r\n}\r\n\r\n// vis.js types - using any for callback params to avoid conflicts with other vis.js declarations\r\ninterface VisNetworkOrgChart {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  on: (event: string, callback: (params: any) => void) => void;\r\n  fit: () => void;\r\n  destroy: () => void;\r\n}\r\n\r\n// Helper to get vis module from window\r\nfunction getVisOrgChart(): { Network: new (container: HTMLElement, data: unknown, options: unknown) => VisNetworkOrgChart; DataSet: new (data: unknown[]) => unknown } | undefined {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  return (window as any).vis;\r\n}\r\n\r\n/**\r\n * Create org chart\r\n */\r\nexport function createOrgChart(props: OrgChartProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'org-chart' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"chart-toolbar\">\r\n      <button class=\"btn btn-sm\" id=\"fit-chart-btn\">Fit</button>\r\n      <button class=\"btn btn-sm\" id=\"refresh-chart-btn\">Refresh</button>\r\n    </div>\r\n    <div class=\"chart-container\" id=\"org-chart-container\">\r\n      <div class=\"loading\">Loading org chart...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind toolbar events\r\n  const fitBtn = container.querySelector('#fit-chart-btn');\r\n  if (fitBtn) {\r\n    on(fitBtn as HTMLElement, 'click', () => {\r\n      const network = (container as unknown as { _network?: { fit: () => void } })._network;\r\n      network?.fit();\r\n    });\r\n  }\r\n\r\n  const refreshBtn = container.querySelector('#refresh-chart-btn');\r\n  if (refreshBtn) {\r\n    on(refreshBtn as HTMLElement, 'click', () => loadOrgChart(container, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadOrgChart(container, props);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load org chart data\r\n */\r\nasync function loadOrgChart(container: HTMLElement, props: OrgChartProps): Promise<void> {\r\n  const chartContainer = container.querySelector('#org-chart-container') as HTMLElement;\r\n  chartContainer.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    // Get contacts with relationships\r\n    const { contacts } = await contactsService.getAll({});\r\n    \r\n    if (contacts.length === 0) {\r\n      chartContainer.innerHTML = `\r\n        <div class=\"empty-state\">\r\n          <p>No contacts to display</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    // Build org chart data\r\n    const { nodes, edges } = buildOrgData(contacts);\r\n\r\n    // Check if vis-network is available\r\n    if (!getVisOrgChart()) {\r\n      renderFallbackChart(chartContainer, contacts, props);\r\n      return;\r\n    }\r\n\r\n    // Create vis-network\r\n    renderVisNetwork(chartContainer, nodes, edges, contacts, props);\r\n  } catch {\r\n    chartContainer.innerHTML = '<div class=\"error\">Failed to load org chart</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Build org chart data from contacts\r\n */\r\nfunction buildOrgData(contacts: Contact[]): { nodes: OrgNode[]; edges: OrgEdge[] } {\r\n  const nodes: OrgNode[] = [];\r\n  const edges: OrgEdge[] = [];\r\n  const levels: Map<string, number> = new Map();\r\n\r\n  // First pass: identify hierarchy\r\n  contacts.forEach(contact => {\r\n    const reportsTo = contact.relationships?.find(r => r.type === 'reports_to');\r\n    if (reportsTo) {\r\n      // Has a manager\r\n      const managerLevel = levels.get(reportsTo.contactId) || 0;\r\n      levels.set(String(contact.id), managerLevel + 1);\r\n    } else {\r\n      // Top level\r\n      levels.set(String(contact.id), 0);\r\n    }\r\n  });\r\n\r\n  // Build nodes\r\n  contacts.forEach(contact => {\r\n    nodes.push({\r\n      id: String(contact.id),\r\n      label: contact.name,\r\n      title: `${contact.name}${contact.role ? `\\n${contact.role}` : ''}${contact.organization ? `\\n${contact.organization}` : ''}`,\r\n      level: levels.get(String(contact.id)) || 0,\r\n      color: contact.teams?.[0]?.color,\r\n    });\r\n  });\r\n\r\n  // Build edges (reports_to relationships)\r\n  contacts.forEach(contact => {\r\n    contact.relationships?.forEach(rel => {\r\n      if (rel.type === 'reports_to') {\r\n        edges.push({\r\n          from: rel.contactId,\r\n          to: String(contact.id),\r\n          arrows: 'to',\r\n        });\r\n      }\r\n    });\r\n  });\r\n\r\n  return { nodes, edges };\r\n}\r\n\r\n/**\r\n * Render vis-network\r\n */\r\nfunction renderVisNetwork(\r\n  container: HTMLElement,\r\n  nodes: OrgNode[],\r\n  edges: OrgEdge[],\r\n  contacts: Contact[],\r\n  props: OrgChartProps\r\n): void {\r\n  container.innerHTML = '';\r\n\r\n  const visNodes = nodes.map(n => ({\r\n    id: n.id,\r\n    label: n.label,\r\n    title: n.title,\r\n    level: n.level,\r\n    color: {\r\n      background: n.color || '#6366f1',\r\n      border: n.color || '#4f46e5',\r\n      highlight: { background: '#818cf8', border: '#6366f1' },\r\n    },\r\n    font: { color: '#ffffff' },\r\n    shape: 'box',\r\n    margin: 10,\r\n  }));\r\n\r\n  const options = {\r\n    layout: {\r\n      hierarchical: {\r\n        direction: 'UD',\r\n        sortMethod: 'directed',\r\n        levelSeparation: 100,\r\n        nodeSpacing: 150,\r\n      },\r\n    },\r\n    nodes: {\r\n      borderWidth: 2,\r\n      shadow: true,\r\n    },\r\n    edges: {\r\n      color: { color: '#9ca3af', highlight: '#6366f1' },\r\n      width: 2,\r\n      smooth: { type: 'cubicBezier' },\r\n    },\r\n    physics: false,\r\n    interaction: {\r\n      hover: true,\r\n      tooltipDelay: 200,\r\n    },\r\n  };\r\n\r\n  const vis = getVisOrgChart()!;\r\n  const network = new vis.Network(container, {\r\n    nodes: new vis.DataSet(visNodes),\r\n    edges: new vis.DataSet(edges),\r\n  }, options);\r\n\r\n  // Store reference for fit button\r\n  (container.closest('.org-chart') as unknown as { _network: typeof network })._network = network;\r\n\r\n  // Node click handler\r\n  network.on('click', (params) => {\r\n    if (params.nodes.length > 0) {\r\n      const nodeId = params.nodes[0];\r\n      const contact = contacts.find(c => String(c.id) === nodeId);\r\n      if (contact) {\r\n        if (props.onNodeClick) {\r\n          props.onNodeClick(contact);\r\n        } else {\r\n          showContactModal({ mode: 'view', contact });\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  network.fit();\r\n}\r\n\r\n/**\r\n * Render fallback chart (when vis-network not available)\r\n */\r\nfunction renderFallbackChart(container: HTMLElement, contacts: Contact[], props: OrgChartProps): void {\r\n  // Group by organization\r\n  const byOrg: Record<string, Contact[]> = {};\r\n  contacts.forEach(c => {\r\n    const org = c.organization || 'Other';\r\n    if (!byOrg[org]) byOrg[org] = [];\r\n    byOrg[org].push(c);\r\n  });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"fallback-org-chart\">\r\n      ${Object.entries(byOrg).map(([org, members]) => `\r\n        <div class=\"org-group\">\r\n          <h4 class=\"org-name\">${escapeHtml(org)}</h4>\r\n          <div class=\"org-members\">\r\n            ${members.map(contact => `\r\n              <div class=\"org-member\" data-id=\"${contact.id}\">\r\n                <div class=\"member-avatar\">${getInitials(contact.name)}</div>\r\n                <div class=\"member-info\">\r\n                  <div class=\"member-name\">${escapeHtml(contact.name)}</div>\r\n                  ${contact.role ? `<div class=\"member-role\">${escapeHtml(contact.role)}</div>` : ''}\r\n                </div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.org-member').forEach(el => {\r\n    on(el as HTMLElement, 'click', () => {\r\n      const id = el.getAttribute('data-id');\r\n      const contact = contacts.find(c => String(c.id) === id);\r\n      if (contact) {\r\n        if (props.onNodeClick) {\r\n          props.onNodeClick(contact);\r\n        } else {\r\n          showContactModal({ mode: 'view', contact });\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createOrgChart;\r\n","/**\r\n * Documents Panel Component - Clean Minimal Design\r\n * Document list with elegant search, filters, and cards\r\n */\r\n\r\nimport { createElement } from '../utils/dom';\r\nimport { documentsService, Document } from '../services/documents';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime, formatFileSize } from '../utils/format';\r\nimport { http } from '../services/api';\r\n\r\nexport interface DocumentsPanelProps {\r\n  onDocumentClick?: (document: Document) => void;\r\n}\r\n\r\ntype StatusFilter = 'processed' | 'pending' | 'failed' | 'deleted' | 'all';\r\ntype TypeFilter = 'all' | 'documents' | 'transcripts' | 'emails' | 'images';\r\ntype SortOption = 'date' | 'name' | 'size';\r\ntype ViewMode = 'grid' | 'list';\r\n\r\nlet currentStatus: StatusFilter = 'processed';\r\nlet currentType: TypeFilter = 'all';\r\nlet currentSort: SortOption = 'date';\r\nlet currentViewMode: ViewMode = 'grid';\r\nlet currentSearch = '';\r\nlet selectedDocuments: Set<string> = new Set();\r\nlet allDocuments: Document[] = [];\r\n\r\n/**\r\n * Create documents panel - Clean Minimal\r\n */\r\nexport function createDocumentsPanel(props: DocumentsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'documents-panel-minimal' });\r\n\r\n  panel.innerHTML = `\r\n    <style>\r\n      .documents-panel-minimal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 100%;\r\n        background: var(--bg-primary);\r\n        padding: 32px;\r\n      }\r\n\r\n      /* Header - Minimal */\r\n      .docs-header-minimal {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        margin-bottom: 32px;\r\n      }\r\n      .docs-title-section {\r\n        display: flex;\r\n        align-items: baseline;\r\n        gap: 16px;\r\n      }\r\n      .docs-title-section h1 {\r\n        margin: 0;\r\n        font-size: 32px;\r\n        font-weight: 700;\r\n        color: var(--text-primary);\r\n      }\r\n      .docs-total-count {\r\n        font-size: 16px;\r\n        color: var(--text-tertiary);\r\n        font-weight: 400;\r\n      }\r\n      .docs-header-actions {\r\n        display: flex;\r\n        gap: 12px;\r\n        align-items: center;\r\n      }\r\n      \r\n      /* View Mode Toggle */\r\n      .view-mode-toggle {\r\n        display: flex;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        padding: 4px;\r\n        gap: 2px;\r\n      }\r\n      .view-mode-btn {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        width: 36px;\r\n        height: 32px;\r\n        border: none;\r\n        background: transparent;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        color: var(--text-tertiary);\r\n        transition: all 0.15s ease;\r\n      }\r\n      .view-mode-btn:hover {\r\n        color: var(--text-primary);\r\n        background: var(--bg-tertiary);\r\n      }\r\n      .view-mode-btn.active {\r\n        background: var(--primary);\r\n        color: white;\r\n      }\r\n      .view-mode-btn svg {\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n\r\n      .btn-minimal {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 10px 20px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n        border: none;\r\n      }\r\n      .btn-minimal.primary {\r\n        background: var(--primary);\r\n        color: white;\r\n      }\r\n      .btn-minimal.primary:hover {\r\n        opacity: 0.9;\r\n        transform: translateY(-1px);\r\n      }\r\n      .btn-minimal.secondary {\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      .btn-minimal.secondary:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      .btn-minimal svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      /* Search and Filters - Single Line */\r\n      .docs-controls {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        margin-bottom: 24px;\r\n        flex-wrap: wrap;\r\n      }\r\n      .docs-search-minimal {\r\n        flex: 1;\r\n        min-width: 280px;\r\n        max-width: 400px;\r\n        position: relative;\r\n      }\r\n      .docs-search-minimal input {\r\n        width: 100%;\r\n        padding: 12px 16px 12px 44px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        transition: all 0.15s ease;\r\n      }\r\n      .docs-search-minimal input:focus {\r\n        outline: none;\r\n        border-color: var(--primary);\r\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\r\n      }\r\n      .docs-search-minimal input::placeholder {\r\n        color: var(--text-tertiary);\r\n      }\r\n      .docs-search-minimal svg {\r\n        position: absolute;\r\n        left: 14px;\r\n        top: 50%;\r\n        transform: translateY(-50%);\r\n        color: var(--text-tertiary);\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n\r\n      /* Filter Chips */\r\n      .docs-filters {\r\n        display: flex;\r\n        gap: 8px;\r\n        flex-wrap: wrap;\r\n      }\r\n      .filter-chip-minimal {\r\n        padding: 8px 16px;\r\n        border-radius: 20px;\r\n        font-size: 13px;\r\n        font-weight: 500;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-secondary);\r\n        border: 1px solid transparent;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .filter-chip-minimal:hover {\r\n        background: var(--bg-tertiary);\r\n        color: var(--text-primary);\r\n      }\r\n      .filter-chip-minimal.active {\r\n        background: var(--primary);\r\n        color: white;\r\n      }\r\n\r\n      /* Divider with status */\r\n      .docs-status-bar {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 16px 0;\r\n        border-bottom: 1px solid var(--border-color);\r\n        margin-bottom: 24px;\r\n      }\r\n      .status-chip {\r\n        padding: 6px 14px;\r\n        border-radius: 8px;\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n        background: transparent;\r\n        border: none;\r\n        color: var(--text-secondary);\r\n      }\r\n      .status-chip:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      .status-chip.active {\r\n        background: var(--bg-tertiary);\r\n        color: var(--text-primary);\r\n      }\r\n      .status-chip.active.processed { color: #10b981; background: rgba(16, 185, 129, 0.1); }\r\n      .status-chip.active.pending { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }\r\n      .status-chip.active.failed { color: #ef4444; background: rgba(239, 68, 68, 0.1); }\r\n      .status-chip.active.deleted { color: #6b7280; background: rgba(107, 114, 128, 0.1); }\r\n      .status-chip .chip-count {\r\n        margin-left: 6px;\r\n        padding: 2px 6px;\r\n        font-size: 10px;\r\n        background: rgba(0,0,0,0.05);\r\n        border-radius: 6px;\r\n      }\r\n      [data-theme=\"dark\"] .status-chip .chip-count {\r\n        background: rgba(255,255,255,0.1);\r\n      }\r\n      .status-chip.active .chip-count {\r\n        background: rgba(0,0,0,0.1);\r\n      }\r\n      .docs-sort-minimal {\r\n        margin-left: auto;\r\n        padding: 8px 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 8px;\r\n        background: var(--bg-secondary);\r\n        font-size: 13px;\r\n        color: var(--text-primary);\r\n        cursor: pointer;\r\n      }\r\n\r\n      /* Documents Grid - Larger Cards */\r\n      .docs-content-minimal {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n      }\r\n      .docs-grid-minimal {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));\r\n        gap: 20px;\r\n      }\r\n      \r\n      /* List View Mode */\r\n      .docs-grid-minimal.list-view {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 8px;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-card-minimal {\r\n        flex-direction: row;\r\n        align-items: center;\r\n        padding: 12px 20px;\r\n        gap: 16px;\r\n        border-radius: 12px;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-card-header {\r\n        flex-shrink: 0;\r\n        gap: 12px;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-card-header .doc-icon {\r\n        width: 40px;\r\n        height: 40px;\r\n        font-size: 18px;\r\n        border-radius: 8px;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-info {\r\n        flex: 1;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 24px;\r\n        min-width: 0;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-filename {\r\n        flex: 1;\r\n        min-width: 0;\r\n        margin: 0;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-meta {\r\n        display: flex;\r\n        gap: 16px;\r\n        color: var(--text-tertiary);\r\n        font-size: 13px;\r\n        flex-shrink: 0;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-status-badge {\r\n        margin: 0;\r\n        flex-shrink: 0;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-summary-section,\r\n      .docs-grid-minimal.list-view .doc-entities-mini,\r\n      .docs-grid-minimal.list-view .doc-card-hover {\r\n        display: none;\r\n      }\r\n\r\n      /* Document Card - Clean Design */\r\n      .doc-card-minimal {\r\n        background: var(--bg-secondary);\r\n        border-radius: 16px;\r\n        border: 1px solid var(--border-color);\r\n        padding: 20px;\r\n        cursor: pointer;\r\n        transition: all 0.2s ease;\r\n        position: relative;\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 16px;\r\n      }\r\n      .doc-card-minimal:hover {\r\n        border-color: rgba(var(--primary-rgb), 0.4);\r\n        box-shadow: 0 8px 24px rgba(0,0,0,0.08);\r\n        transform: translateY(-2px);\r\n      }\r\n      .doc-card-minimal.selected {\r\n        border-color: var(--primary);\r\n        background: rgba(var(--primary-rgb), 0.02);\r\n      }\r\n\r\n      /* Card Header */\r\n      .doc-card-top {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 16px;\r\n      }\r\n      .doc-icon-minimal {\r\n        width: 52px;\r\n        height: 52px;\r\n        border-radius: 14px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n        flex-shrink: 0;\r\n      }\r\n      .doc-icon-minimal.pdf { background: linear-gradient(135deg, #fef2f2, #fee2e2); }\r\n      .doc-icon-minimal.doc { background: linear-gradient(135deg, #eff6ff, #dbeafe); }\r\n      .doc-icon-minimal.img { background: linear-gradient(135deg, #f0fdf4, #dcfce7); }\r\n      .doc-icon-minimal.txt { background: linear-gradient(135deg, #fefce8, #fef9c3); }\r\n      .doc-icon-minimal.default { background: linear-gradient(135deg, #f5f5f5, #e5e5e5); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.pdf { background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.1)); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.doc { background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(59,130,246,0.1)); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.img { background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.1)); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.txt { background: linear-gradient(135deg, rgba(234,179,8,0.15), rgba(234,179,8,0.1)); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.default { background: linear-gradient(135deg, rgba(107,114,128,0.15), rgba(107,114,128,0.1)); }\r\n\r\n      .doc-info-minimal {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .doc-filename-minimal {\r\n        font-size: 15px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        margin-bottom: 6px;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n      .doc-meta-minimal {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        font-size: 13px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      .doc-meta-minimal .sep {\r\n        color: var(--border-color);\r\n      }\r\n      .doc-status-badge {\r\n        padding: 4px 10px;\r\n        font-size: 11px;\r\n        font-weight: 600;\r\n        border-radius: 6px;\r\n        text-transform: capitalize;\r\n      }\r\n      .doc-status-badge.processed { background: rgba(16, 185, 129, 0.1); color: #10b981; }\r\n      .doc-status-badge.pending { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }\r\n      .doc-status-badge.failed { background: rgba(239, 68, 68, 0.1); color: #ef4444; }\r\n      .doc-status-badge.deleted { background: rgba(107, 114, 128, 0.1); color: #6b7280; }\r\n\r\n      /* Card Summary */\r\n      .doc-summary-minimal {\r\n        font-size: 14px;\r\n        line-height: 1.6;\r\n        color: var(--text-secondary);\r\n        display: -webkit-box;\r\n        -webkit-line-clamp: 2;\r\n        -webkit-box-orient: vertical;\r\n        overflow: hidden;\r\n      }\r\n\r\n      /* Card Footer */\r\n      .doc-card-footer {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding-top: 16px;\r\n        border-top: 1px solid var(--border-color);\r\n      }\r\n      .doc-entities {\r\n        display: flex;\r\n        gap: 16px;\r\n      }\r\n      .doc-entity-item {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .doc-entity-item .icon {\r\n        width: 20px;\r\n        height: 20px;\r\n        border-radius: 6px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 11px;\r\n      }\r\n      .doc-entity-item.facts .icon { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }\r\n      .doc-entity-item.decisions .icon { background: rgba(16, 185, 129, 0.1); color: #10b981; }\r\n      .doc-entity-item.risks .icon { background: rgba(239, 68, 68, 0.1); color: #ef4444; }\r\n\r\n      .doc-actions-minimal {\r\n        display: flex;\r\n        gap: 4px;\r\n        opacity: 0;\r\n        transition: opacity 0.15s ease;\r\n      }\r\n      .doc-card-minimal:hover .doc-actions-minimal {\r\n        opacity: 1;\r\n      }\r\n      .doc-action-btn {\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 8px;\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n        color: var(--text-secondary);\r\n        font-size: 14px;\r\n      }\r\n      .doc-action-btn:hover {\r\n        background: var(--primary);\r\n        border-color: var(--primary);\r\n        color: white;\r\n      }\r\n      .doc-action-btn.favorite.active {\r\n        color: #f59e0b;\r\n      }\r\n      .doc-action-btn.favorite:hover {\r\n        background: #f59e0b;\r\n        border-color: #f59e0b;\r\n        color: white;\r\n      }\r\n\r\n      /* Selection */\r\n      .doc-select-checkbox {\r\n        position: absolute;\r\n        top: 16px;\r\n        left: 16px;\r\n        width: 22px;\r\n        height: 22px;\r\n        border-radius: 6px;\r\n        border: 2px solid var(--border-color);\r\n        background: var(--bg-primary);\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        opacity: 0;\r\n        transition: all 0.15s ease;\r\n        font-size: 12px;\r\n        color: white;\r\n      }\r\n      .doc-card-minimal:hover .doc-select-checkbox,\r\n      .doc-card-minimal.selected .doc-select-checkbox {\r\n        opacity: 1;\r\n      }\r\n      .doc-card-minimal.selected .doc-select-checkbox {\r\n        background: var(--primary);\r\n        border-color: var(--primary);\r\n      }\r\n\r\n      /* Selection Bar */\r\n      .selection-bar-minimal {\r\n        position: fixed;\r\n        bottom: 32px;\r\n        left: 50%;\r\n        transform: translateX(-50%);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 16px 24px;\r\n        background: #1e293b;\r\n        border-radius: 16px;\r\n        box-shadow: 0 12px 40px rgba(0,0,0,0.25);\r\n        z-index: 100;\r\n        animation: slideUp 0.25s ease;\r\n      }\r\n      @keyframes slideUp {\r\n        from { transform: translateX(-50%) translateY(100px); opacity: 0; }\r\n        to { transform: translateX(-50%) translateY(0); opacity: 1; }\r\n      }\r\n      .selection-bar-minimal.hidden { display: none; }\r\n      .selection-count-minimal {\r\n        color: white;\r\n        font-weight: 600;\r\n        padding-right: 16px;\r\n        border-right: 1px solid rgba(255,255,255,0.2);\r\n      }\r\n      .selection-count-minimal span { color: #60a5fa; }\r\n      .selection-bar-minimal .btn-minimal {\r\n        padding: 8px 16px;\r\n        font-size: 13px;\r\n      }\r\n      .selection-bar-minimal .btn-minimal.secondary {\r\n        background: rgba(255,255,255,0.1);\r\n        color: white;\r\n        border-color: transparent;\r\n      }\r\n      .selection-bar-minimal .btn-minimal.secondary:hover {\r\n        background: rgba(255,255,255,0.2);\r\n      }\r\n      .selection-bar-minimal .btn-minimal.danger {\r\n        background: #ef4444;\r\n        color: white;\r\n        border: none;\r\n      }\r\n\r\n      /* Empty State */\r\n      .docs-empty-minimal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 80px 40px;\r\n        text-align: center;\r\n        grid-column: 1 / -1;\r\n      }\r\n      .docs-empty-minimal .empty-icon {\r\n        width: 80px;\r\n        height: 80px;\r\n        border-radius: 24px;\r\n        background: var(--bg-tertiary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 36px;\r\n        margin-bottom: 24px;\r\n      }\r\n      .docs-empty-minimal h3 {\r\n        margin: 0 0 8px 0;\r\n        font-size: 20px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n      .docs-empty-minimal p {\r\n        margin: 0 0 24px 0;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      /* Loading */\r\n      .docs-loading {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 60px;\r\n        grid-column: 1 / -1;\r\n        color: var(--text-secondary);\r\n        gap: 12px;\r\n      }\r\n      .docs-loading::after {\r\n        content: '';\r\n        width: 20px;\r\n        height: 20px;\r\n        border: 2px solid var(--border-color);\r\n        border-top-color: var(--primary);\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n      }\r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n      \r\n      /* Accessibility: Screen reader only content */\r\n      .visually-hidden {\r\n        position: absolute;\r\n        width: 1px;\r\n        height: 1px;\r\n        padding: 0;\r\n        margin: -1px;\r\n        overflow: hidden;\r\n        clip: rect(0, 0, 0, 0);\r\n        white-space: nowrap;\r\n        border: 0;\r\n      }\r\n      \r\n      /* Focus styles for keyboard navigation */\r\n      .doc-card-minimal:focus {\r\n        outline: 2px solid var(--primary);\r\n        outline-offset: 2px;\r\n      }\r\n      .doc-card-minimal:focus-visible {\r\n        outline: 2px solid var(--primary);\r\n        outline-offset: 2px;\r\n      }\r\n    </style>\r\n    \r\n    <!-- Header -->\r\n    <div class=\"docs-header-minimal\">\r\n      <div class=\"docs-title-section\">\r\n        <h1>Files</h1>\r\n        <span class=\"docs-total-count\"><span id=\"total-count\">0</span> documents</span>\r\n      </div>\r\n      <div class=\"docs-header-actions\">\r\n        <!-- View Mode Toggle -->\r\n        <div class=\"view-mode-toggle\">\r\n          <button class=\"view-mode-btn active\" data-view=\"grid\" title=\"Grid view\">\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"/>\r\n              <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"/>\r\n              <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"/>\r\n              <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"/>\r\n            </svg>\r\n          </button>\r\n          <button class=\"view-mode-btn\" data-view=\"list\" title=\"List view\">\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <line x1=\"8\" y1=\"6\" x2=\"21\" y2=\"6\"/>\r\n              <line x1=\"8\" y1=\"12\" x2=\"21\" y2=\"12\"/>\r\n              <line x1=\"8\" y1=\"18\" x2=\"21\" y2=\"18\"/>\r\n              <line x1=\"3\" y1=\"6\" x2=\"3.01\" y2=\"6\"/>\r\n              <line x1=\"3\" y1=\"12\" x2=\"3.01\" y2=\"12\"/>\r\n              <line x1=\"3\" y1=\"18\" x2=\"3.01\" y2=\"18\"/>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <button class=\"btn-minimal primary\" id=\"upload-btn\">\r\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n            <polyline points=\"17 8 12 3 7 8\"/>\r\n            <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\r\n          </svg>\r\n          Upload\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Controls -->\r\n    <div class=\"docs-controls\" role=\"search\">\r\n      <div class=\"docs-search-minimal\">\r\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" aria-hidden=\"true\">\r\n          <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n          <path d=\"m21 21-4.3-4.3\"/>\r\n        </svg>\r\n        <input type=\"text\" id=\"docs-search-input\" placeholder=\"Search files...\" \r\n               aria-label=\"Search files\" autocomplete=\"off\">\r\n      </div>\r\n      <div class=\"docs-filters\" role=\"tablist\" aria-label=\"Filter by document type\">\r\n        <button class=\"filter-chip-minimal active\" data-type=\"all\" role=\"tab\" aria-selected=\"true\">All</button>\r\n        <button class=\"filter-chip-minimal\" data-type=\"documents\" role=\"tab\" aria-selected=\"false\">Documents</button>\r\n        <button class=\"filter-chip-minimal\" data-type=\"transcripts\" role=\"tab\" aria-selected=\"false\">Transcripts</button>\r\n        <button class=\"filter-chip-minimal\" data-type=\"emails\" role=\"tab\" aria-selected=\"false\">Emails</button>\r\n        <button class=\"filter-chip-minimal\" data-type=\"images\" role=\"tab\" aria-selected=\"false\">Images</button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Status Bar -->\r\n    <div class=\"docs-status-bar\" role=\"tablist\" aria-label=\"Filter by status\">\r\n      <button class=\"status-chip active processed\" data-status=\"processed\" role=\"tab\" aria-selected=\"true\">\r\n        Processed <span class=\"chip-count\" id=\"count-processed\" aria-label=\"count\">0</span>\r\n      </button>\r\n      <button class=\"status-chip pending\" data-status=\"pending\" role=\"tab\" aria-selected=\"false\">\r\n        Pending <span class=\"chip-count\" id=\"count-pending\" aria-label=\"count\">0</span>\r\n      </button>\r\n      <button class=\"status-chip failed\" data-status=\"failed\" role=\"tab\" aria-selected=\"false\">\r\n        Failed <span class=\"chip-count\" id=\"count-failed\" aria-label=\"count\">0</span>\r\n      </button>\r\n      <button class=\"status-chip deleted\" data-status=\"deleted\" role=\"tab\" aria-selected=\"false\">\r\n        Deleted <span class=\"chip-count\" id=\"count-deleted\" aria-label=\"count\">0</span>\r\n      </button>\r\n      <label for=\"sort-select\" class=\"visually-hidden\">Sort order</label>\r\n      <select class=\"docs-sort-minimal\" id=\"sort-select\" aria-label=\"Sort files\">\r\n        <option value=\"date\">Newest first</option>\r\n        <option value=\"name\">Name A-Z</option>\r\n        <option value=\"size\">Largest first</option>\r\n      </select>\r\n    </div>\r\n\r\n    <!-- Content -->\r\n    <div class=\"docs-content-minimal\" role=\"main\">\r\n      <div class=\"docs-grid-minimal\" id=\"docs-grid\" role=\"list\" aria-label=\"Document list\" tabindex=\"0\">\r\n        <div class=\"docs-loading\" aria-live=\"polite\">Loading files</div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Selection Bar -->\r\n    <div class=\"selection-bar-minimal hidden\" id=\"selection-bar\" role=\"toolbar\" aria-label=\"Bulk actions\">\r\n      <span class=\"selection-count-minimal\" aria-live=\"polite\"><span id=\"selected-count\">0</span> selected</span>\r\n      <button class=\"btn-minimal secondary\" id=\"bulk-export-btn\" aria-label=\"Export selected files\">Export</button>\r\n      <button class=\"btn-minimal secondary\" id=\"bulk-reprocess-btn\" aria-label=\"Reprocess selected files\">Reprocess</button>\r\n      <button class=\"btn-minimal danger\" id=\"bulk-delete-btn\" aria-label=\"Delete selected files\">Delete</button>\r\n      <button class=\"btn-minimal secondary\" id=\"cancel-selection-btn\" aria-label=\"Cancel selection\">Cancel</button>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  bindPanelEvents(panel, props);\r\n  \r\n  // Initial load\r\n  loadDocuments(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Bind panel events\r\n */\r\nfunction bindPanelEvents(panel: HTMLElement, props: DocumentsPanelProps): void {\r\n  // Upload button\r\n  panel.querySelector('#upload-btn')?.addEventListener('click', async () => {\r\n    const { showFileUploadModal } = await import('./modals/FileUploadModal');\r\n    showFileUploadModal({ onComplete: () => loadDocuments(panel, props) });\r\n  });\r\n\r\n  // Search with server-side filtering and 500ms debounce\r\n  const searchInput = panel.querySelector('#docs-search-input') as HTMLInputElement;\r\n  let searchTimeout: ReturnType<typeof setTimeout>;\r\n  searchInput?.addEventListener('input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = setTimeout(() => {\r\n      const newSearch = searchInput.value.trim();\r\n      if (newSearch !== currentSearch) {\r\n        currentSearch = newSearch;\r\n        // Trigger server-side search if query is 2+ chars or empty\r\n        if (currentSearch.length >= 2 || currentSearch.length === 0) {\r\n          loadDocuments(panel, props);\r\n        }\r\n      }\r\n    }, 500); // Increased debounce for better UX\r\n  });\r\n\r\n  // Sort select\r\n  panel.querySelector('#sort-select')?.addEventListener('change', (e) => {\r\n    currentSort = (e.target as HTMLSelectElement).value as SortOption;\r\n    renderFilteredDocuments(panel, props);\r\n  });\r\n\r\n  // Type filters\r\n  panel.querySelectorAll('.filter-chip-minimal').forEach(chip => {\r\n    chip.addEventListener('click', () => {\r\n      panel.querySelectorAll('.filter-chip-minimal').forEach(c => c.classList.remove('active'));\r\n      chip.classList.add('active');\r\n      currentType = chip.getAttribute('data-type') as TypeFilter;\r\n      renderFilteredDocuments(panel, props);\r\n    });\r\n  });\r\n\r\n  // Status chips\r\n  panel.querySelectorAll('.status-chip').forEach(chip => {\r\n    chip.addEventListener('click', () => {\r\n      panel.querySelectorAll('.status-chip').forEach(c => c.classList.remove('active'));\r\n      chip.classList.add('active');\r\n      currentStatus = chip.getAttribute('data-status') as StatusFilter;\r\n      loadDocuments(panel, props);\r\n    });\r\n  });\r\n\r\n  // View mode toggle\r\n  panel.querySelectorAll('.view-mode-btn').forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      panel.querySelectorAll('.view-mode-btn').forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n      currentViewMode = btn.getAttribute('data-view') as ViewMode;\r\n      \r\n      const grid = panel.querySelector('#docs-grid');\r\n      if (grid) {\r\n        if (currentViewMode === 'list') {\r\n          grid.classList.add('list-view');\r\n        } else {\r\n          grid.classList.remove('list-view');\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bulk actions\r\n  panel.querySelector('#bulk-delete-btn')?.addEventListener('click', () => bulkDelete(panel, props));\r\n  panel.querySelector('#bulk-export-btn')?.addEventListener('click', () => bulkExport());\r\n  panel.querySelector('#bulk-reprocess-btn')?.addEventListener('click', () => bulkReprocess(panel, props));\r\n  panel.querySelector('#cancel-selection-btn')?.addEventListener('click', () => {\r\n    selectedDocuments.clear();\r\n    updateSelection(panel);\r\n  });\r\n}\r\n\r\n/**\r\n * Load documents\r\n */\r\nasync function loadDocuments(panel: HTMLElement, props: DocumentsPanelProps): Promise<void> {\r\n  const grid = panel.querySelector('#docs-grid') as HTMLElement;\r\n  grid.innerHTML = '<div class=\"docs-loading\" aria-live=\"polite\">Loading files</div>';\r\n\r\n  try {\r\n    // Use server-side filtering for better performance\r\n    const result = await documentsService.getAll({\r\n      status: currentStatus === 'all' ? undefined : currentStatus,\r\n      type: currentType === 'all' ? undefined : currentType,\r\n      search: currentSearch || undefined,\r\n      sort: currentSort === 'date' ? 'created_at' : currentSort === 'name' ? 'filename' : undefined,\r\n      order: currentSort === 'date' ? 'desc' : 'asc',\r\n      limit: 100 // Load more items for better UX\r\n    });\r\n    \r\n    allDocuments = result.documents || [];\r\n    \r\n    console.log('%c[DocumentsPanel] Load result:', 'color: green; font-weight: bold', { \r\n      total: result.total, \r\n      docsCount: allDocuments.length,\r\n      firstDoc: allDocuments[0],\r\n      currentStatus,\r\n      currentType\r\n    });\r\n    \r\n    // Update counts\r\n    const statuses = result.statuses || {};\r\n    panel.querySelector('#total-count')!.textContent = String(result.total || allDocuments.length);\r\n    panel.querySelector('#count-processed')!.textContent = String(statuses.processed || 0);\r\n    panel.querySelector('#count-pending')!.textContent = String((statuses.pending || 0) + (statuses.processing || 0));\r\n    panel.querySelector('#count-failed')!.textContent = String(statuses.failed || 0);\r\n    panel.querySelector('#count-deleted')!.textContent = String(statuses.deleted || 0);\r\n    \r\n    renderFilteredDocuments(panel, props);\r\n  } catch (err) {\r\n    console.error('[DocumentsPanel] Failed to load:', err);\r\n    grid.innerHTML = '<div class=\"docs-empty-minimal\"><div class=\"empty-icon\">!</div><h3>Failed to load files</h3><p>Please try again</p></div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render filtered documents\r\n * Note: Server-side filtering is used for status, type, and search.\r\n * This function now handles only local sorting for size (server doesn't support size sort).\r\n */\r\nfunction renderFilteredDocuments(panel: HTMLElement, props: DocumentsPanelProps): void {\r\n  let filtered = [...allDocuments];\r\n  \r\n  // Only need to handle size sorting locally (server handles date and name)\r\n  if (currentSort === 'size') {\r\n    filtered.sort((a, b) => (b.size || 0) - (a.size || 0));\r\n  }\r\n  \r\n  renderDocumentsGrid(panel, filtered, props);\r\n}\r\n\r\n/**\r\n * Get document type from filename\r\n */\r\nfunction getDocType(filename: string): string {\r\n  const ext = filename.split('.').pop()?.toLowerCase();\r\n  if (['pdf', 'doc', 'docx', 'txt', 'md', 'rtf'].includes(ext || '')) return 'document';\r\n  if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp'].includes(ext || '')) return 'image';\r\n  if (['eml', 'msg'].includes(ext || '')) return 'email';\r\n  return 'document';\r\n}\r\n\r\n/**\r\n * Render documents grid\r\n */\r\nfunction renderDocumentsGrid(panel: HTMLElement, documents: Document[], props: DocumentsPanelProps): void {\r\n  const grid = panel.querySelector('#docs-grid') as HTMLElement;\r\n  \r\n  if (documents.length === 0) {\r\n    grid.innerHTML = `\r\n      <div class=\"docs-empty-minimal\">\r\n        <div class=\"empty-icon\"></div>\r\n        <h3>No files found</h3>\r\n        <p>Upload files to get started</p>\r\n        <button class=\"btn-minimal primary\" id=\"empty-upload-btn\">Upload Files</button>\r\n      </div>\r\n    `;\r\n    \r\n    grid.querySelector('#empty-upload-btn')?.addEventListener('click', async () => {\r\n      const { showFileUploadModal } = await import('./modals/FileUploadModal');\r\n      showFileUploadModal({ onComplete: () => loadDocuments(panel, props) });\r\n    });\r\n    return;\r\n  }\r\n\r\n  // Add data-index for potential virtual scrolling\r\n  grid.innerHTML = documents.map((doc, index) => createDocumentCard(doc, index)).join('');\r\n  \r\n  // Add total count and scroll height data for virtual scrolling\r\n  grid.setAttribute('data-total', String(documents.length));\r\n\r\n  // Bind card events\r\n  grid.querySelectorAll('.doc-card-minimal').forEach(card => {\r\n    const id = card.getAttribute('data-id')!;\r\n    const doc = documents.find(d => String(d.id) === id);\r\n    \r\n    // Click to preview\r\n    card.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (target.closest('.doc-select-checkbox') || target.closest('.doc-action-btn')) return;\r\n      \r\n      if (doc && props.onDocumentClick) {\r\n        props.onDocumentClick(doc);\r\n      }\r\n    });\r\n    \r\n    // Keyboard navigation\r\n    card.addEventListener('keydown', (e: KeyboardEvent) => {\r\n      const cards = Array.from(grid.querySelectorAll('.doc-card-minimal'));\r\n      const currentIndex = cards.indexOf(card);\r\n      \r\n      switch (e.key) {\r\n        case 'Enter':\r\n        case ' ':\r\n          e.preventDefault();\r\n          if (doc && props.onDocumentClick) {\r\n            props.onDocumentClick(doc);\r\n          }\r\n          break;\r\n        case 'ArrowDown':\r\n        case 'ArrowRight':\r\n          e.preventDefault();\r\n          if (currentIndex < cards.length - 1) {\r\n            (cards[currentIndex + 1] as HTMLElement).focus();\r\n          }\r\n          break;\r\n        case 'ArrowUp':\r\n        case 'ArrowLeft':\r\n          e.preventDefault();\r\n          if (currentIndex > 0) {\r\n            (cards[currentIndex - 1] as HTMLElement).focus();\r\n          }\r\n          break;\r\n        case 's':\r\n          e.preventDefault();\r\n          // Toggle selection\r\n          if (selectedDocuments.has(id)) {\r\n            selectedDocuments.delete(id);\r\n          } else {\r\n            selectedDocuments.add(id);\r\n          }\r\n          updateSelection(panel);\r\n          break;\r\n        case 'Delete':\r\n        case 'Backspace':\r\n          e.preventDefault();\r\n          if (doc && confirm(`Delete \"${doc.filename}\"?`)) {\r\n            documentsService.delete(id, { softDelete: true }).then(() => {\r\n              toast.success('File deleted');\r\n              loadDocuments(panel, props);\r\n            }).catch(() => toast.error('Failed to delete'));\r\n          }\r\n          break;\r\n      }\r\n    });\r\n    \r\n    // Checkbox for selection\r\n    card.querySelector('.doc-select-checkbox')?.addEventListener('click', (e) => {\r\n      e.stopPropagation();\r\n      if (selectedDocuments.has(id)) {\r\n        selectedDocuments.delete(id);\r\n      } else {\r\n        selectedDocuments.add(id);\r\n      }\r\n      updateSelection(panel);\r\n    });\r\n    \r\n    // Favorite toggle\r\n    card.querySelector('.doc-action-btn.favorite')?.addEventListener('click', async (e) => {\r\n      e.stopPropagation();\r\n      try {\r\n        await http.post(`/api/documents/${id}/favorite`);\r\n        (e.target as HTMLElement).classList.toggle('active');\r\n        toast.success('Updated favorites');\r\n      } catch {\r\n        toast.error('Failed to update favorite');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Create document card HTML\r\n */\r\nfunction createDocumentCard(doc: Document, index = 0): string {\r\n  const iconClass = getIconClass(doc.filename || '');\r\n  const icon = getDocumentIcon(doc.filename || '');\r\n  const isSelected = selectedDocuments.has(doc.id);\r\n  const factsCount = doc.facts_count || 0;\r\n  const decisionsCount = (doc as any).decisions_count || 0;\r\n  const risksCount = (doc as any).risks_count || 0;\r\n\r\n  const entitiesLabel = [\r\n    factsCount > 0 ? `${factsCount} facts` : '',\r\n    decisionsCount > 0 ? `${decisionsCount} decisions` : '',\r\n    risksCount > 0 ? `${risksCount} risks` : ''\r\n  ].filter(Boolean).join(', ') || 'No entities';\r\n  \r\n  return `\r\n    <div class=\"doc-card-minimal ${isSelected ? 'selected' : ''}\" \r\n         data-id=\"${doc.id}\"\r\n         data-index=\"${index}\"\r\n         role=\"listitem\"\r\n         tabindex=\"0\"\r\n         aria-label=\"${escapeHtml(doc.filename || 'Untitled')}. Status: ${doc.status}. ${entitiesLabel}\">\r\n      <div class=\"doc-select-checkbox\" role=\"checkbox\" aria-checked=\"${isSelected}\" aria-label=\"Select document\">${isSelected ? '' : ''}</div>\r\n      \r\n      <div class=\"doc-card-top\">\r\n        <div class=\"doc-icon-minimal ${iconClass}\" aria-hidden=\"true\">${icon}</div>\r\n        <div class=\"doc-info-minimal\">\r\n          <div class=\"doc-filename-minimal\">${escapeHtml(doc.filename || 'Untitled')}</div>\r\n          <div class=\"doc-meta-minimal\">\r\n            <span>${formatFileSize((doc as any).file_size || doc.size || 0)}</span>\r\n            <span class=\"sep\" aria-hidden=\"true\"></span>\r\n            <span>${formatRelativeTime(doc.created_at)}</span>\r\n          </div>\r\n        </div>\r\n        <span class=\"doc-status-badge ${doc.status}\" aria-label=\"Status: ${doc.status}\">${doc.status}</span>\r\n      </div>\r\n      \r\n      ${doc.summary ? `<div class=\"doc-summary-minimal\">${escapeHtml(doc.summary)}</div>` : ''}\r\n      \r\n      <div class=\"doc-card-footer\">\r\n        <div class=\"doc-entities\" aria-label=\"Extracted entities\">\r\n          ${factsCount > 0 ? `<span class=\"doc-entity-item facts\"><span class=\"icon\" aria-hidden=\"true\"></span> ${factsCount} facts</span>` : ''}\r\n          ${decisionsCount > 0 ? `<span class=\"doc-entity-item decisions\"><span class=\"icon\" aria-hidden=\"true\"></span> ${decisionsCount}</span>` : ''}\r\n          ${risksCount > 0 ? `<span class=\"doc-entity-item risks\"><span class=\"icon\" aria-hidden=\"true\"></span> ${risksCount}</span>` : ''}\r\n          ${factsCount === 0 && decisionsCount === 0 && risksCount === 0 ? '<span class=\"doc-entity-item\" style=\"color: var(--text-tertiary);\">No entities</span>' : ''}\r\n        </div>\r\n        <div class=\"doc-actions-minimal\">\r\n          <button class=\"doc-action-btn favorite ${(doc as any).is_favorite ? 'active' : ''}\" \r\n                  title=\"Favorite\" aria-label=\"${(doc as any).is_favorite ? 'Remove from favorites' : 'Add to favorites'}\"\r\n                  aria-pressed=\"${(doc as any).is_favorite ? 'true' : 'false'}\"></button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get icon class based on file type\r\n */\r\nfunction getIconClass(filename: string): string {\r\n  const ext = filename.split('.').pop()?.toLowerCase();\r\n  switch (ext) {\r\n    case 'pdf': return 'pdf';\r\n    case 'doc':\r\n    case 'docx': return 'doc';\r\n    case 'jpg':\r\n    case 'jpeg':\r\n    case 'png':\r\n    case 'gif': return 'img';\r\n    case 'txt':\r\n    case 'md': return 'txt';\r\n    default: return 'default';\r\n  }\r\n}\r\n\r\n/**\r\n * Update selection state\r\n */\r\nfunction updateSelection(panel: HTMLElement): void {\r\n  const count = selectedDocuments.size;\r\n  const selectionBar = panel.querySelector('#selection-bar') as HTMLElement;\r\n  \r\n  selectionBar.classList.toggle('hidden', count === 0);\r\n  panel.querySelector('#selected-count')!.textContent = String(count);\r\n  \r\n  // Update card states\r\n  panel.querySelectorAll('.doc-card-minimal').forEach(card => {\r\n    const id = card.getAttribute('data-id')!;\r\n    const isSelected = selectedDocuments.has(id);\r\n    card.classList.toggle('selected', isSelected);\r\n    const checkbox = card.querySelector('.doc-select-checkbox');\r\n    if (checkbox) checkbox.textContent = isSelected ? '' : '';\r\n  });\r\n}\r\n\r\n/**\r\n * Show loading overlay on panel\r\n */\r\nfunction showLoadingOverlay(panel: HTMLElement, message: string): HTMLElement {\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'bulk-loading-overlay';\r\n  overlay.innerHTML = `\r\n    <div class=\"bulk-loading-content\">\r\n      <div class=\"bulk-loading-spinner\"></div>\r\n      <div class=\"bulk-loading-message\">${message}</div>\r\n      <div class=\"bulk-loading-progress\" id=\"bulk-progress\"></div>\r\n    </div>\r\n  `;\r\n  overlay.style.cssText = `\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(var(--bg-rgb, 255, 255, 255), 0.9);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 100;\r\n    backdrop-filter: blur(2px);\r\n  `;\r\n  const content = overlay.querySelector('.bulk-loading-content') as HTMLElement;\r\n  content.style.cssText = 'text-align: center;';\r\n  const spinner = overlay.querySelector('.bulk-loading-spinner') as HTMLElement;\r\n  spinner.style.cssText = `\r\n    width: 40px;\r\n    height: 40px;\r\n    border: 3px solid var(--border-color);\r\n    border-top-color: var(--primary);\r\n    border-radius: 50%;\r\n    animation: spin 0.8s linear infinite;\r\n    margin: 0 auto 16px;\r\n  `;\r\n  panel.style.position = 'relative';\r\n  panel.appendChild(overlay);\r\n  return overlay;\r\n}\r\n\r\n/**\r\n * Hide loading overlay\r\n */\r\nfunction hideLoadingOverlay(overlay: HTMLElement): void {\r\n  overlay?.remove();\r\n}\r\n\r\n/**\r\n * Disable bulk action buttons\r\n */\r\nfunction setBulkButtonsDisabled(panel: HTMLElement, disabled: boolean): void {\r\n  const buttons = panel.querySelectorAll('#bulk-delete-btn, #bulk-export-btn, #bulk-reprocess-btn');\r\n  buttons.forEach(btn => {\r\n    (btn as HTMLButtonElement).disabled = disabled;\r\n  });\r\n}\r\n\r\n/**\r\n * Bulk delete\r\n */\r\nasync function bulkDelete(panel: HTMLElement, props: DocumentsPanelProps): Promise<void> {\r\n  const count = selectedDocuments.size;\r\n  if (!confirm(`Delete ${count} files? This action can be undone from the Deleted tab.`)) return;\r\n  \r\n  const overlay = showLoadingOverlay(panel, `Deleting ${count} files...`);\r\n  setBulkButtonsDisabled(panel, true);\r\n  \r\n  try {\r\n    const ids = Array.from(selectedDocuments);\r\n    const response = await http.post<{ success: boolean; deleted: number; errors: Array<{ id: string; error: string }> }>(\r\n      '/api/documents/bulk/delete',\r\n      { ids }\r\n    );\r\n    \r\n    const result = response.data;\r\n    if (result.errors && result.errors.length > 0) {\r\n      toast.warning(`Deleted ${result.deleted} files, ${result.errors.length} failed`);\r\n    } else {\r\n      toast.success(`Deleted ${result.deleted} files`);\r\n    }\r\n    \r\n    selectedDocuments.clear();\r\n    loadDocuments(panel, props);\r\n  } catch (err) {\r\n    console.error('[BulkDelete] Error:', err);\r\n    toast.error('Failed to delete files');\r\n  } finally {\r\n    hideLoadingOverlay(overlay);\r\n    setBulkButtonsDisabled(panel, false);\r\n  }\r\n}\r\n\r\n/**\r\n * Bulk export\r\n */\r\nasync function bulkExport(): Promise<void> {\r\n  const count = selectedDocuments.size;\r\n  toast.info(`Preparing export of ${count} files...`);\r\n  \r\n  try {\r\n    const ids = Array.from(selectedDocuments);\r\n    \r\n    // Trigger download via form submission (for ZIP file)\r\n    const response = await http.post<Blob>(\r\n      '/api/documents/bulk/export',\r\n      { ids, format: 'original' },\r\n      { responseType: 'blob' }\r\n    );\r\n    \r\n    // Create download link\r\n    const blob = response.data;\r\n    const url = window.URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `documents-export-${new Date().toISOString().split('T')[0]}.zip`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    window.URL.revokeObjectURL(url);\r\n    \r\n    toast.success(`Exported ${count} files`);\r\n  } catch (err) {\r\n    console.error('[BulkExport] Error:', err);\r\n    toast.error('Failed to export files');\r\n  }\r\n}\r\n\r\n/**\r\n * Bulk reprocess\r\n */\r\nasync function bulkReprocess(panel: HTMLElement, props: DocumentsPanelProps): Promise<void> {\r\n  const count = selectedDocuments.size;\r\n  if (!confirm(`Reprocess ${count} files? This will use AI tokens.`)) return;\r\n  \r\n  const overlay = showLoadingOverlay(panel, `Queuing ${count} files for reprocessing...`);\r\n  setBulkButtonsDisabled(panel, true);\r\n  \r\n  try {\r\n    const ids = Array.from(selectedDocuments);\r\n    const response = await http.post<{ success: boolean; queued: string[]; failed: Array<{ id: string; error: string }> }>(\r\n      '/api/documents/bulk/reprocess',\r\n      { ids }\r\n    );\r\n    \r\n    const result = response.data;\r\n    if (result.failed && result.failed.length > 0) {\r\n      toast.warning(`Queued ${result.queued?.length || 0} files, ${result.failed.length} failed`);\r\n    } else {\r\n      toast.success(`Queued ${result.queued?.length || count} files for reprocessing`);\r\n    }\r\n    \r\n    selectedDocuments.clear();\r\n    updateSelection(panel);\r\n    \r\n    // Reload after a short delay to show updated statuses\r\n    setTimeout(() => loadDocuments(panel, props), 1000);\r\n  } catch (err) {\r\n    console.error('[BulkReprocess] Error:', err);\r\n    toast.error('Failed to queue files for reprocessing');\r\n  } finally {\r\n    hideLoadingOverlay(overlay);\r\n    setBulkButtonsDisabled(panel, false);\r\n  }\r\n}\r\n\r\n/**\r\n * Get document icon\r\n */\r\nfunction getDocumentIcon(filename: string): string {\r\n  const ext = filename.split('.').pop()?.toLowerCase();\r\n  switch (ext) {\r\n    case 'pdf': return '';\r\n    case 'doc':\r\n    case 'docx': return '';\r\n    case 'xls':\r\n    case 'xlsx': return '';\r\n    case 'ppt':\r\n    case 'pptx': return '';\r\n    case 'txt':\r\n    case 'md': return '';\r\n    case 'jpg':\r\n    case 'jpeg':\r\n    case 'png':\r\n    case 'gif': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createDocumentsPanel;\r\n","/**\r\n * Knowledge Panel Component\r\n * Knowledge base management with export, regenerate, status\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { knowledgeService, EmbeddingStatus } from '../services/documents';\r\nimport { toast } from '../services/toast';\r\n\r\nexport interface KnowledgePanelProps {\r\n  onExport?: (format: 'md' | 'json') => void;\r\n}\r\n\r\n/**\r\n * Create knowledge panel\r\n */\r\nexport function createKnowledgePanel(props: KnowledgePanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'knowledge-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <h2>Knowledge Base</h2>\r\n    </div>\r\n    <div class=\"panel-content\">\r\n      <div class=\"knowledge-status\" id=\"knowledge-status\">\r\n        <div class=\"loading\">Loading status...</div>\r\n      </div>\r\n      <div class=\"knowledge-actions\">\r\n        <div class=\"action-group\">\r\n          <h4>Export</h4>\r\n          <div class=\"action-buttons\">\r\n            <button class=\"btn btn-sm\" id=\"export-md-btn\">Export Markdown</button>\r\n            <button class=\"btn btn-sm\" id=\"export-json-btn\">Export JSON</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"action-group\">\r\n          <h4>Maintenance</h4>\r\n          <div class=\"action-buttons\">\r\n            <button class=\"btn btn-sm\" id=\"regenerate-btn\">Regenerate Files</button>\r\n            <button class=\"btn btn-sm\" id=\"synthesize-btn\">Synthesize Facts</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const exportMdBtn = panel.querySelector('#export-md-btn');\r\n  if (exportMdBtn) {\r\n    on(exportMdBtn as HTMLElement, 'click', () => exportKnowledge('md', props));\r\n  }\r\n\r\n  const exportJsonBtn = panel.querySelector('#export-json-btn');\r\n  if (exportJsonBtn) {\r\n    on(exportJsonBtn as HTMLElement, 'click', () => exportKnowledge('json', props));\r\n  }\r\n\r\n  const regenerateBtn = panel.querySelector('#regenerate-btn');\r\n  if (regenerateBtn) {\r\n    on(regenerateBtn as HTMLElement, 'click', () => regenerateKnowledge(panel));\r\n  }\r\n\r\n  const synthesizeBtn = panel.querySelector('#synthesize-btn');\r\n  if (synthesizeBtn) {\r\n    on(synthesizeBtn as HTMLElement, 'click', () => synthesizeFacts(panel));\r\n  }\r\n\r\n  // Load status\r\n  loadStatus(panel);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load embedding status\r\n */\r\nasync function loadStatus(panel: HTMLElement): Promise<void> {\r\n  const container = panel.querySelector('#knowledge-status') as HTMLElement;\r\n\r\n  try {\r\n    const status = await knowledgeService.getStatus();\r\n    renderStatus(container, status);\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to load status</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render status\r\n */\r\nfunction renderStatus(container: HTMLElement, status: EmbeddingStatus): void {\r\n  container.innerHTML = `\r\n    <div class=\"status-grid\">\r\n      <div class=\"status-item\">\r\n        <span class=\"status-label\">Documents Embedded</span>\r\n        <span class=\"status-value\">${status.embedded}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <span class=\"status-label\">Total Chunks</span>\r\n        <span class=\"status-value\">${status.totalChunks}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <span class=\"status-label\">Embedding Model</span>\r\n        <span class=\"status-value\">${status.model || 'Default'}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <span class=\"status-label\">Last Updated</span>\r\n        <span class=\"status-value\">${status.lastUpdated ? formatDate(status.lastUpdated) : 'Never'}</span>\r\n      </div>\r\n    </div>\r\n    ${status.available_embedding_models && status.available_embedding_models.length > 0 ? `\r\n      <div class=\"available-models\">\r\n        <h5>Available Models</h5>\r\n        <div class=\"model-list\">\r\n          ${status.available_embedding_models.map((model: string) => `\r\n            <span class=\"model-badge\">${model}</span>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Export knowledge base\r\n */\r\nasync function exportKnowledge(format: 'md' | 'json', props: KnowledgePanelProps): Promise<void> {\r\n  if (props.onExport) {\r\n    props.onExport(format);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    if (format === 'md') {\r\n      await knowledgeService.exportMarkdown();\r\n    } else {\r\n      await knowledgeService.exportJson();\r\n    }\r\n    toast.success(`Knowledge base exported as ${format.toUpperCase()}`);\r\n  } catch {\r\n    toast.error('Failed to export knowledge base');\r\n  }\r\n}\r\n\r\n/**\r\n * Regenerate knowledge files\r\n */\r\nasync function regenerateKnowledge(panel: HTMLElement): Promise<void> {\r\n  if (!confirm('This will regenerate all knowledge files. Continue?')) return;\r\n\r\n  const btn = panel.querySelector('#regenerate-btn') as HTMLButtonElement;\r\n  btn.disabled = true;\r\n  btn.textContent = 'Regenerating...';\r\n\r\n  try {\r\n    await knowledgeService.regenerate();\r\n    toast.success('Knowledge files regenerated');\r\n    loadStatus(panel);\r\n  } catch {\r\n    toast.error('Failed to regenerate knowledge files');\r\n  } finally {\r\n    btn.disabled = false;\r\n    btn.textContent = 'Regenerate Files';\r\n  }\r\n}\r\n\r\n/**\r\n * Synthesize facts\r\n */\r\nasync function synthesizeFacts(panel: HTMLElement): Promise<void> {\r\n  if (!confirm('This will consolidate and synthesize facts using AI. This may take a while. Continue?')) return;\r\n\r\n  const btn = panel.querySelector('#synthesize-btn') as HTMLButtonElement;\r\n  btn.disabled = true;\r\n  btn.textContent = 'Synthesizing...';\r\n\r\n  try {\r\n    await knowledgeService.synthesize();\r\n    toast.success('Facts synthesized');\r\n    loadStatus(panel);\r\n  } catch {\r\n    toast.error('Failed to synthesize facts');\r\n  } finally {\r\n    btn.disabled = false;\r\n    btn.textContent = 'Synthesize Facts';\r\n  }\r\n}\r\n\r\n/**\r\n * Format date\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString();\r\n}\r\n\r\nexport default createKnowledgePanel;\r\n","/**\n * Conversation Composer Component - SOTA UI\n * Multi-mode conversation/transcript input\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { conversationsService } from '../services/documents';\nimport { toast } from '../services/toast';\n\nexport interface ConversationComposerProps {\n  onImport?: (conversation: unknown) => void;\n  onClose?: () => void;\n}\n\ntype InputMode = 'paste' | 'upload';\nlet currentMode: InputMode = 'paste';\n\n/**\n * Show conversation composer modal\n */\nexport function showConversationComposer(props: ConversationComposerProps = {}): void {\n  const existing = document.getElementById('conversation-composer-overlay');\n  if (existing) existing.remove();\n\n  const overlay = createElement('div', { \n    id: 'conversation-composer-overlay',\n    className: 'composer-overlay' \n  });\n\n  const dialog = createConversationComposer(props);\n  overlay.appendChild(dialog);\n  document.body.appendChild(overlay);\n\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) {\n      closeConversationComposer();\n      props.onClose?.();\n    }\n  });\n\n  requestAnimationFrame(() => overlay.classList.add('visible'));\n}\n\n/**\n * Close conversation composer\n */\nexport function closeConversationComposer(): void {\n  const overlay = document.getElementById('conversation-composer-overlay');\n  if (overlay) {\n    overlay.classList.remove('visible');\n    setTimeout(() => overlay.remove(), 200);\n  }\n}\n\n/**\n * Create conversation composer\n */\nfunction createConversationComposer(props: ConversationComposerProps): HTMLElement {\n  const container = createElement('div', { className: 'composer-modal' });\n\n  container.innerHTML = `\n    <style>\n      .composer-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.5);\n        backdrop-filter: blur(8px);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n      }\n      .composer-overlay.visible {\n        opacity: 1;\n      }\n      .composer-overlay.visible .composer-modal {\n        transform: translateY(0) scale(1);\n        opacity: 1;\n      }\n      .composer-modal {\n        width: 640px;\n        max-width: 95vw;\n        max-height: 85vh;\n        background: var(--bg-primary);\n        border-radius: 16px;\n        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        transform: translateY(20px) scale(0.98);\n        opacity: 0;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n      \n      .composer-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      .composer-header h2 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n      .composer-close {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: var(--text-secondary);\n        transition: all 0.15s ease;\n      }\n      .composer-close:hover {\n        background: var(--bg-tertiary);\n        color: var(--text-primary);\n      }\n      \n      .composer-tabs {\n        display: flex;\n        padding: 0 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-tab {\n        padding: 14px 20px;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        background: none;\n        border: none;\n        cursor: pointer;\n        position: relative;\n        transition: color 0.15s ease;\n      }\n      .composer-tab:hover { color: var(--text-primary); }\n      .composer-tab.active { color: var(--primary); }\n      .composer-tab.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: var(--primary);\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .composer-body {\n        flex: 1;\n        padding: 24px;\n        overflow-y: auto;\n      }\n      \n      .paste-section label {\n        display: block;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 12px;\n      }\n      .paste-section textarea {\n        width: 100%;\n        min-height: 280px;\n        padding: 16px;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-family: 'SF Mono', Monaco, monospace;\n        font-size: 13px;\n        line-height: 1.6;\n        resize: vertical;\n        transition: border-color 0.15s ease, box-shadow 0.15s ease;\n      }\n      .paste-section textarea:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\n      }\n      .paste-section textarea::placeholder { color: var(--text-tertiary); }\n      .paste-hint {\n        margin-top: 12px;\n        font-size: 13px;\n        color: var(--text-tertiary);\n      }\n      \n      .format-row {\n        margin-top: 20px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n      .format-row label {\n        font-size: 13px;\n        color: var(--text-secondary);\n        white-space: nowrap;\n      }\n      .format-row select {\n        flex: 1;\n        max-width: 200px;\n        padding: 10px 14px;\n        border: 1px solid var(--border-color);\n        border-radius: 8px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-size: 13px;\n      }\n      \n      .upload-section .dropzone {\n        border: 2px dashed var(--border-color);\n        border-radius: 16px;\n        padding: 60px 40px;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        background: var(--bg-secondary);\n      }\n      .upload-section .dropzone:hover,\n      .upload-section .dropzone.dragover {\n        border-color: var(--primary);\n        background: rgba(var(--primary-rgb), 0.03);\n      }\n      .dropzone-icon { font-size: 48px; margin-bottom: 16px; }\n      .dropzone-title {\n        font-size: 16px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 8px;\n      }\n      .dropzone-hint { font-size: 13px; color: var(--text-tertiary); }\n      \n      .selected-file {\n        display: none;\n        align-items: center;\n        gap: 16px;\n        margin-top: 20px;\n        padding: 16px;\n        background: var(--bg-secondary);\n        border-radius: 12px;\n        border: 1px solid var(--border-color);\n      }\n      .selected-file.visible { display: flex; }\n      .file-icon {\n        width: 48px;\n        height: 48px;\n        background: linear-gradient(135deg, var(--primary), color-mix(in srgb, var(--primary) 70%, white));\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n      }\n      .file-info { flex: 1; min-width: 0; }\n      .file-name {\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .file-size { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }\n      .file-remove {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: transparent;\n        border-radius: 8px;\n        cursor: pointer;\n        color: var(--text-tertiary);\n        font-size: 18px;\n        transition: all 0.15s ease;\n      }\n      .file-remove:hover {\n        background: rgba(239, 68, 68, 0.1);\n        color: #ef4444;\n      }\n      \n      .preview-area {\n        margin-top: 20px;\n        padding: 16px;\n        background: var(--bg-tertiary);\n        border-radius: 12px;\n        display: none;\n      }\n      .preview-area.visible { display: block; }\n      .preview-area h4 {\n        margin: 0 0 12px 0;\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n      .preview-stats {\n        display: flex;\n        gap: 24px;\n        font-size: 14px;\n      }\n      .preview-stats span { color: var(--text-secondary); }\n      .preview-stats strong { color: var(--text-primary); }\n      \n      .composer-footer {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        padding: 16px 24px;\n        border-top: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-footer .btn {\n        padding: 10px 20px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        border: none;\n      }\n      .composer-footer .btn-secondary {\n        background: var(--bg-primary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      .composer-footer .btn-secondary:hover { background: var(--bg-tertiary); }\n      .composer-footer .btn-outline {\n        background: transparent;\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      .composer-footer .btn-outline:hover { background: var(--bg-tertiary); }\n      .composer-footer .btn-primary {\n        background: var(--primary);\n        color: white;\n      }\n      .composer-footer .btn-primary:hover:not(:disabled) {\n        opacity: 0.9;\n        transform: translateY(-1px);\n      }\n      .composer-footer .btn-primary:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n    </style>\n    \n    <div class=\"composer-header\">\n      <h2>Import Conversation</h2>\n      <button class=\"composer-close\" id=\"close-btn\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M18 6L6 18M6 6l12 12\"/>\n        </svg>\n      </button>\n    </div>\n    \n    <div class=\"composer-tabs\">\n      <button class=\"composer-tab active\" data-mode=\"paste\">Paste Text</button>\n      <button class=\"composer-tab\" data-mode=\"upload\">Upload File</button>\n    </div>\n    \n    <div class=\"composer-body\" id=\"composer-body\">\n      ${renderPasteMode()}\n    </div>\n    \n    <div class=\"composer-footer\">\n      <button class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\n      <button class=\"btn btn-outline\" id=\"preview-btn\" disabled>Preview</button>\n      <button class=\"btn btn-primary\" id=\"import-btn\" disabled>Import</button>\n    </div>\n  `;\n\n  // Bind tabs\n  container.querySelectorAll('.composer-tab').forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      container.querySelectorAll('.composer-tab').forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentMode = tab.getAttribute('data-mode') as InputMode;\n      renderMode(container);\n    });\n  });\n\n  on(container.querySelector('#close-btn') as HTMLElement, 'click', () => {\n    closeConversationComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#cancel-btn') as HTMLElement, 'click', () => {\n    closeConversationComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#preview-btn') as HTMLElement, 'click', () => handlePreview(container));\n  on(container.querySelector('#import-btn') as HTMLElement, 'click', () => handleImport(container, props));\n\n  bindPasteMode(container);\n\n  return container;\n}\n\nfunction renderMode(container: HTMLElement): void {\n  const body = container.querySelector('#composer-body') as HTMLElement;\n  body.innerHTML = currentMode === 'paste' ? renderPasteMode() : renderUploadMode();\n  \n  if (currentMode === 'paste') bindPasteMode(container);\n  else bindUploadMode(container);\n}\n\nfunction renderPasteMode(): string {\n  return `\n    <div class=\"paste-section\">\n      <label>Paste conversation or transcript:</label>\n      <textarea id=\"conversation-input\" placeholder=\"Paste your conversation here...\n\nSupported formats:\n WhatsApp, Slack, Teams, Discord chats\n Meeting transcripts (Zoom, Google Meet)\n Email threads\n Any text with speaker names\n\nExample:\n[10:30] John: Hello everyone\n[10:31] Jane: Hi John!\n[10:32] John: Let's discuss the project...\"></textarea>\n      <p class=\"paste-hint\">Include timestamps and speaker names for better parsing.</p>\n      <div class=\"format-row\">\n        <label>Format:</label>\n        <select id=\"format-select\">\n          <option value=\"\">Auto-detect</option>\n          <option value=\"whatsapp\">WhatsApp</option>\n          <option value=\"slack\">Slack</option>\n          <option value=\"teams\">Microsoft Teams</option>\n          <option value=\"discord\">Discord</option>\n          <option value=\"zoom\">Zoom Transcript</option>\n          <option value=\"generic\">Generic Chat</option>\n        </select>\n      </div>\n    </div>\n    <div class=\"preview-area\" id=\"preview-area\"></div>\n  `;\n}\n\nfunction bindPasteMode(container: HTMLElement): void {\n  const textarea = container.querySelector('#conversation-input') as HTMLTextAreaElement;\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n\n  if (textarea) {\n    on(textarea, 'input', () => {\n      const hasContent = textarea.value.trim().length > 10;\n      previewBtn.disabled = !hasContent;\n      importBtn.disabled = !hasContent;\n    });\n  }\n}\n\nfunction renderUploadMode(): string {\n  return `\n    <div class=\"upload-section\">\n      <div class=\"dropzone\" id=\"file-dropzone\">\n        <div class=\"dropzone-icon\"></div>\n        <p class=\"dropzone-title\">Drop chat file here</p>\n        <p class=\"dropzone-hint\">or click to browse  .txt, .json</p>\n        <input type=\"file\" id=\"file-input\" accept=\".txt,.md,.srt,.vtt,.json\" hidden>\n      </div>\n      <div class=\"selected-file\" id=\"selected-file\">\n        <div class=\"file-icon\"></div>\n        <div class=\"file-info\">\n          <div class=\"file-name\" id=\"file-name\"></div>\n          <div class=\"file-size\" id=\"file-size\"></div>\n        </div>\n        <button class=\"file-remove\" id=\"file-remove\"></button>\n      </div>\n    </div>\n    <div class=\"preview-area\" id=\"preview-area\"></div>\n  `;\n}\n\nfunction bindUploadMode(container: HTMLElement): void {\n  const dropzone = container.querySelector('#file-dropzone') as HTMLElement;\n  const input = container.querySelector('#file-input') as HTMLInputElement;\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n\n  on(dropzone, 'click', () => input.click());\n  on(dropzone, 'dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });\n  on(dropzone, 'dragleave', () => dropzone.classList.remove('dragover'));\n  on(dropzone, 'drop', (e) => {\n    e.preventDefault();\n    dropzone.classList.remove('dragover');\n    if (e.dataTransfer?.files[0]) selectFile(e.dataTransfer.files[0], container);\n  });\n  on(input, 'change', () => { if (input.files?.[0]) selectFile(input.files[0], container); });\n  on(container.querySelector('#file-remove') as HTMLElement, 'click', () => {\n    selectedFile.classList.remove('visible');\n    (container as any)._fileContent = null;\n    previewBtn.disabled = true;\n    importBtn.disabled = true;\n  });\n}\n\nfunction selectFile(file: File, container: HTMLElement): void {\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n  \n  container.querySelector('#file-name')!.textContent = file.name;\n  container.querySelector('#file-size')!.textContent = formatFileSize(file.size);\n  selectedFile.classList.add('visible');\n\n  const reader = new FileReader();\n  reader.onload = () => {\n    (container as any)._fileContent = reader.result;\n    previewBtn.disabled = false;\n    importBtn.disabled = false;\n  };\n  reader.readAsText(file);\n}\n\nfunction getContent(container: HTMLElement): string {\n  if (currentMode === 'paste') {\n    return (container.querySelector('#conversation-input') as HTMLTextAreaElement)?.value || '';\n  }\n  return (container as any)._fileContent || '';\n}\n\nasync function handlePreview(container: HTMLElement): Promise<void> {\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const previewArea = container.querySelector('#preview-area') as HTMLElement;\n  const content = getContent(container);\n  if (!content) return;\n\n  previewBtn.disabled = true;\n  previewBtn.textContent = 'Parsing...';\n\n  try {\n    const result = await conversationsService.parsePreview(content);\n    previewArea.classList.add('visible');\n    previewArea.innerHTML = `\n      <h4>Preview</h4>\n      <div class=\"preview-stats\">\n        <span>Messages: <strong>${result.message_count || 0}</strong></span>\n        <span>Participants: <strong>${result.participants?.length || 0}</strong></span>\n        <span>Format: <strong>${result.format || 'Unknown'}</strong></span>\n      </div>\n    `;\n  } catch {\n    toast.error('Failed to parse conversation');\n  } finally {\n    previewBtn.disabled = false;\n    previewBtn.textContent = 'Preview';\n  }\n}\n\nasync function handleImport(container: HTMLElement, props: ConversationComposerProps): Promise<void> {\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n  const content = getContent(container);\n  const formatSelect = container.querySelector('#format-select') as HTMLSelectElement;\n  if (!content) return;\n\n  importBtn.disabled = true;\n  importBtn.textContent = 'Importing...';\n\n  try {\n    const result = await conversationsService.import(content, { formatHint: formatSelect?.value });\n    toast.success('Conversation imported');\n    props.onImport?.(result);\n    closeConversationComposer();\n  } catch {\n    toast.error('Failed to import conversation');\n  } finally {\n    importBtn.disabled = false;\n    importBtn.textContent = 'Import';\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n\nexport default showConversationComposer;\n","/**\r\n * Conversations Panel Component\r\n * Conversation list with import and re-embed\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { conversationsService } from '../services/documents';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\nimport { showConversationComposer } from './ConversationComposer';\r\nimport { showConversationPreviewModal } from './modals/ConversationPreviewModal';\r\n\r\nexport interface ConversationsPanelProps {\r\n  onConversationClick?: (conversation: Conversation) => void;\r\n}\r\n\r\ninterface Conversation {\r\n  id: string;\r\n  title?: string;\r\n  participants?: string[];\r\n  message_count?: number;\r\n  source?: string;\r\n  created_at: string;\r\n  embedded?: boolean;\r\n}\r\n\r\n/**\r\n * Create conversations panel\r\n */\r\nexport function createConversationsPanel(props: ConversationsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'conversations-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Conversations</h2>\r\n        <span class=\"panel-count\" id=\"conversations-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"import-conv-btn\">Import</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"conversations-content\">\r\n      <div class=\"loading\">Loading conversations...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind import button\r\n  const importBtn = panel.querySelector('#import-conv-btn');\r\n  if (importBtn) {\r\n    on(importBtn as HTMLElement, 'click', () => showImportDialog(panel, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadConversations(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load conversations\r\n */\r\nasync function loadConversations(panel: HTMLElement, props: ConversationsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#conversations-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const conversations = await conversationsService.getAll();\r\n    renderConversations(content, conversations, props);\r\n    updateCount(panel, conversations.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load conversations</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render conversations\r\n */\r\nfunction renderConversations(\r\n  container: HTMLElement, \r\n  conversations: Conversation[], \r\n  props: ConversationsPanelProps\r\n): void {\r\n  if (conversations.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No conversations imported</p>\r\n        <p class=\"text-muted\">Import chat transcripts, meeting notes, or message threads</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"conversations-list\">\r\n      ${conversations.map(conv => createConversationCard(conv)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  container.querySelectorAll('.conversation-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', async (e) => {\r\n      if ((e.target as HTMLElement).closest('.conv-actions')) return;\r\n      \r\n      const id = card.getAttribute('data-id');\r\n      const conv = conversations.find(c => c.id === id);\r\n      if (conv) {\r\n        // Fetch full conversation with metadata\r\n        try {\r\n          const fullConv = await conversationsService.getById(id!);\r\n          showConversationPreviewModal(fullConv as any);\r\n        } catch {\r\n          // Fallback to basic data\r\n          showConversationPreviewModal(conv as any);\r\n        }\r\n        \r\n        if (props.onConversationClick) {\r\n          props.onConversationClick(conv);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Re-embed button\r\n    const reembedBtn = card.querySelector('.reembed-btn');\r\n    if (reembedBtn) {\r\n      on(reembedBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        const btn = reembedBtn as HTMLButtonElement;\r\n        btn.disabled = true;\r\n        btn.textContent = 'Processing...';\r\n\r\n        try {\r\n          await conversationsService.reembed(id);\r\n          toast.success('Conversation re-embedded');\r\n          loadConversations(container.closest('.conversations-panel') as HTMLElement, props);\r\n        } catch {\r\n          toast.error('Failed to re-embed conversation');\r\n          btn.disabled = false;\r\n          btn.textContent = 'Re-embed';\r\n        }\r\n      });\r\n    }\r\n\r\n    // Delete button\r\n    const deleteBtn = card.querySelector('.delete-conv-btn');\r\n    if (deleteBtn) {\r\n      on(deleteBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        if (!confirm('Delete this conversation?')) return;\r\n\r\n        try {\r\n          await conversationsService.delete(id);\r\n          toast.success('Conversation deleted');\r\n          loadConversations(container.closest('.conversations-panel') as HTMLElement, props);\r\n        } catch {\r\n          toast.error('Failed to delete conversation');\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Create conversation card HTML\r\n */\r\nfunction createConversationCard(conv: Conversation): string {\r\n  return `\r\n    <div class=\"conversation-card\" data-id=\"${conv.id}\">\r\n      <div class=\"conv-icon\"></div>\r\n      <div class=\"conv-info\">\r\n        <div class=\"conv-title\">${escapeHtml(conv.title || 'Untitled Conversation')}</div>\r\n        <div class=\"conv-meta\">\r\n          ${conv.participants ? `<span>${conv.participants.length} participants</span>` : ''}\r\n          ${conv.message_count ? `<span>${conv.message_count} messages</span>` : ''}\r\n          <span>${formatRelativeTime(conv.created_at)}</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"conv-status\">\r\n        ${conv.embedded \r\n          ? '<span class=\"embedded-badge\">Embedded</span>'\r\n          : '<span class=\"not-embedded-badge\">Not embedded</span>'\r\n        }\r\n      </div>\r\n      <div class=\"conv-actions\">\r\n        <button class=\"btn btn-sm reembed-btn\">Re-embed</button>\r\n        <button class=\"btn btn-sm btn-danger delete-conv-btn\">Delete</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Show import dialog using ConversationComposer\r\n */\r\nfunction showImportDialog(panel: HTMLElement, props: ConversationsPanelProps): void {\r\n  showConversationComposer({\r\n    onImport: () => {\r\n      loadConversations(panel, props);\r\n    },\r\n    onClose: () => {\r\n      // Nothing to do on close\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#conversations-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createConversationsPanel;\r\n","/**\r\n * Emails Panel Component\r\n * Email list with filters and management\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { emailsService, Email } from '../services/emails';\r\nimport { showEmailModal } from './modals/EmailModal';\r\nimport { showEmailPreviewModal } from './modals/EmailPreviewModal';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface EmailsPanelProps {\r\n  onEmailClick?: (email: Email) => void;\r\n}\r\n\r\ntype DirectionFilter = 'all' | 'inbound' | 'outbound' | 'internal';\r\nlet currentDirection: DirectionFilter = 'all';\r\nlet showNeedsResponse = false;\r\n\r\n/**\r\n * Create emails panel\r\n */\r\nexport function createEmailsPanel(props: EmailsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'emails-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Emails</h2>\r\n        <span class=\"panel-count\" id=\"emails-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"direction-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"inbound\">Inbound</option>\r\n          <option value=\"outbound\">Outbound</option>\r\n          <option value=\"internal\">Internal</option>\r\n        </select>\r\n        <label class=\"checkbox-label\">\r\n          <input type=\"checkbox\" id=\"needs-response-filter\"> Needs Response\r\n        </label>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-email-btn\">+ Add Email</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"emails-content\">\r\n      <div class=\"loading\">Loading emails...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const directionFilter = panel.querySelector('#direction-filter') as HTMLSelectElement;\r\n  on(directionFilter, 'change', () => {\r\n    currentDirection = directionFilter.value as DirectionFilter;\r\n    loadEmails(panel, props);\r\n  });\r\n\r\n  const needsResponseFilter = panel.querySelector('#needs-response-filter') as HTMLInputElement;\r\n  on(needsResponseFilter, 'change', () => {\r\n    showNeedsResponse = needsResponseFilter.checked;\r\n    loadEmails(panel, props);\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-email-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', async () => {\r\n      const { createEmailComposer, showEmailComposer } = await import('./EmailComposer');\r\n      showEmailComposer({\r\n        onSave: () => loadEmails(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadEmails(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load emails\r\n */\r\nasync function loadEmails(panel: HTMLElement, props: EmailsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#emails-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    let emails: Email[];\r\n\r\n    if (showNeedsResponse) {\r\n      emails = await emailsService.getNeedingResponse();\r\n    } else {\r\n      const result = await emailsService.getAll({\r\n        direction: currentDirection === 'all' ? undefined : currentDirection,\r\n      });\r\n      emails = result.emails;\r\n    }\r\n\r\n    renderEmails(content, emails, props);\r\n    updateCount(panel, emails.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load emails</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render emails\r\n */\r\nfunction renderEmails(container: HTMLElement, emails: Email[], props: EmailsPanelProps): void {\r\n  if (emails.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No emails found</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"emails-list\">\r\n      ${emails.map(email => createEmailCard(email)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  container.querySelectorAll('.email-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', async (e) => {\r\n      if ((e.target as HTMLElement).closest('.email-actions')) return;\r\n      \r\n      const id = card.getAttribute('data-id');\r\n      const email = emails.find(e => String(e.id) === id);\r\n      if (email) {\r\n        // Fetch full email data with extraction results\r\n        try {\r\n          const fullEmail = await emailsService.getById(id!);\r\n          showEmailPreviewModal(fullEmail as any);\r\n        } catch {\r\n          // Fallback to basic modal\r\n          showEmailPreviewModal(email as any);\r\n        }\r\n        \r\n        if (props.onEmailClick) {\r\n          props.onEmailClick(email);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Mark responded\r\n    const respondedBtn = card.querySelector('.mark-responded-btn');\r\n    if (respondedBtn) {\r\n      on(respondedBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        try {\r\n          await emailsService.markResponded(id);\r\n          toast.success('Marked as responded');\r\n          loadEmails(container.closest('.emails-panel') as HTMLElement, props);\r\n        } catch {\r\n          toast.error('Failed to update email');\r\n        }\r\n      });\r\n    }\r\n\r\n    // Generate response\r\n    const generateBtn = card.querySelector('.generate-response-btn');\r\n    if (generateBtn) {\r\n      on(generateBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        const btn = generateBtn as HTMLButtonElement;\r\n        btn.disabled = true;\r\n        btn.textContent = 'Generating...';\r\n\r\n        try {\r\n          const suggestions = await emailsService.generateResponse(id);\r\n          const draft = suggestions[0]?.response || '';\r\n          toast.success('Response generated');\r\n          \r\n          // Show the generated draft\r\n          const email = emails.find(e => String(e.id) === id);\r\n          if (email) {\r\n            email.draft_response = draft;\r\n            // Open email modal with draft\r\n            showEmailModal({ mode: 'view', email: email as unknown as Parameters<typeof showEmailModal>[0]['email'] });\r\n          }\r\n        } catch {\r\n          toast.error('Failed to generate response');\r\n        } finally {\r\n          btn.disabled = false;\r\n          btn.textContent = 'AI Response';\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Create email card HTML\r\n */\r\nfunction createEmailCard(email: Email): string {\r\n  const directionIcon = email.direction === 'inbound' ? '' : email.direction === 'outbound' ? '' : '';\r\n  const needsResponse = email.requires_response && !email.response_sent;\r\n\r\n  return `\r\n    <div class=\"email-card ${needsResponse ? 'needs-response' : ''}\" data-id=\"${email.id}\">\r\n      <div class=\"email-direction\">${directionIcon}</div>\r\n      <div class=\"email-info\">\r\n        <div class=\"email-header\">\r\n          <span class=\"email-from\">${escapeHtml(email.from_name || email.from_email || email.from || '')}</span>\r\n          <span class=\"email-date\">${formatRelativeTime(email.created_at || email.date || new Date().toISOString())}</span>\r\n        </div>\r\n        <div class=\"email-subject\">${escapeHtml(email.subject || '(No subject)')}</div>\r\n        <div class=\"email-preview\">${escapeHtml(getPreview(email.body_text || ''))}</div>\r\n      </div>\r\n      <div class=\"email-badges\">\r\n        ${needsResponse ? '<span class=\"needs-response-badge\">Needs Response</span>' : ''}\r\n        ${email.response_drafted ? '<span class=\"draft-badge\">Draft Ready</span>' : ''}\r\n        ${email.response_sent ? '<span class=\"responded-badge\">Responded</span>' : ''}\r\n        ${email.ai_summary ? '<span class=\"ai-badge\">AI Analyzed</span>' : ''}\r\n      </div>\r\n      <div class=\"email-actions\">\r\n        ${needsResponse ? `\r\n          <button class=\"btn btn-sm generate-response-btn\">AI Response</button>\r\n          <button class=\"btn btn-sm mark-responded-btn\">Mark Responded</button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get preview text\r\n */\r\nfunction getPreview(text: string, maxLength = 100): string {\r\n  const cleaned = text.replace(/\\s+/g, ' ').trim();\r\n  return cleaned.length > maxLength ? cleaned.slice(0, maxLength) + '...' : cleaned;\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#emails-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createEmailsPanel;\r\n","/**\r\n * Email Composer Component - SOTA UI\r\n * Multi-mode email input: paste, upload .eml/.msg, manual entry\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\n\r\nexport interface EmailComposerProps {\r\n  onSave?: (email: unknown) => void;\r\n  onClose?: () => void;\r\n}\r\n\r\ntype InputMode = 'paste' | 'upload' | 'manual';\r\nlet currentMode: InputMode = 'paste';\r\nlet composerContainer: HTMLElement | null = null;\r\n\r\n/**\r\n * Show email composer\r\n */\r\nexport function showEmailComposer(props: EmailComposerProps = {}): void {\r\n  const existing = document.getElementById('email-composer-overlay');\r\n  if (existing) existing.remove();\r\n\r\n  const overlay = createElement('div', { \r\n    id: 'email-composer-overlay',\r\n    className: 'composer-overlay' \r\n  });\r\n\r\n  const dialog = createEmailComposer(props);\r\n  overlay.appendChild(dialog);\r\n  document.body.appendChild(overlay);\r\n\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) {\r\n      closeEmailComposer();\r\n      props.onClose?.();\r\n    }\r\n  });\r\n\r\n  requestAnimationFrame(() => overlay.classList.add('visible'));\r\n  composerContainer = dialog;\r\n}\r\n\r\n/**\r\n * Close email composer\r\n */\r\nexport function closeEmailComposer(): void {\r\n  const overlay = document.getElementById('email-composer-overlay');\r\n  if (overlay) {\r\n    overlay.classList.remove('visible');\r\n    setTimeout(() => overlay.remove(), 200);\r\n  }\r\n  composerContainer = null;\r\n}\r\n\r\n/**\r\n * Create email composer\r\n */\r\nexport function createEmailComposer(props: EmailComposerProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'composer-modal' });\r\n\r\n  container.innerHTML = `\r\n    <style>\r\n      .composer-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0, 0, 0, 0.5);\r\n        backdrop-filter: blur(8px);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 10000;\r\n        opacity: 0;\r\n        transition: opacity 0.2s ease;\r\n      }\r\n      .composer-overlay.visible { opacity: 1; }\r\n      .composer-overlay.visible .composer-modal {\r\n        transform: translateY(0) scale(1);\r\n        opacity: 1;\r\n      }\r\n      .composer-modal {\r\n        width: 640px;\r\n        max-width: 95vw;\r\n        max-height: 85vh;\r\n        background: var(--bg-primary);\r\n        border-radius: 16px;\r\n        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\r\n        display: flex;\r\n        flex-direction: column;\r\n        overflow: hidden;\r\n        transform: translateY(20px) scale(0.98);\r\n        opacity: 0;\r\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n      }\r\n      \r\n      .composer-header {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding: 20px 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      .composer-header h2 {\r\n        margin: 0;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n      .composer-close {\r\n        width: 32px;\r\n        height: 32px;\r\n        border: none;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: var(--text-secondary);\r\n        transition: all 0.15s ease;\r\n      }\r\n      .composer-close:hover {\r\n        background: var(--bg-tertiary);\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .composer-tabs {\r\n        display: flex;\r\n        padding: 0 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      .composer-tab {\r\n        padding: 14px 20px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        color: var(--text-secondary);\r\n        background: none;\r\n        border: none;\r\n        cursor: pointer;\r\n        position: relative;\r\n        transition: color 0.15s ease;\r\n      }\r\n      .composer-tab:hover { color: var(--text-primary); }\r\n      .composer-tab.active { color: var(--primary); }\r\n      .composer-tab.active::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        height: 2px;\r\n        background: var(--primary);\r\n        border-radius: 2px 2px 0 0;\r\n      }\r\n      \r\n      .composer-body {\r\n        flex: 1;\r\n        padding: 24px;\r\n        overflow-y: auto;\r\n      }\r\n      \r\n      /* Paste Mode */\r\n      .paste-section label {\r\n        display: block;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        color: var(--text-primary);\r\n        margin-bottom: 12px;\r\n      }\r\n      .paste-section textarea {\r\n        width: 100%;\r\n        min-height: 280px;\r\n        padding: 16px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        font-family: 'SF Mono', Monaco, monospace;\r\n        font-size: 13px;\r\n        line-height: 1.6;\r\n        resize: vertical;\r\n        transition: border-color 0.15s ease, box-shadow 0.15s ease;\r\n      }\r\n      .paste-section textarea:focus {\r\n        outline: none;\r\n        border-color: var(--primary);\r\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\r\n      }\r\n      .paste-section textarea::placeholder { color: var(--text-tertiary); }\r\n      .paste-hint {\r\n        margin-top: 12px;\r\n        font-size: 13px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      \r\n      /* Upload Mode */\r\n      .upload-section .dropzone {\r\n        border: 2px dashed var(--border-color);\r\n        border-radius: 16px;\r\n        padding: 60px 40px;\r\n        text-align: center;\r\n        cursor: pointer;\r\n        transition: all 0.2s ease;\r\n        background: var(--bg-secondary);\r\n      }\r\n      .upload-section .dropzone:hover,\r\n      .upload-section .dropzone.dragover {\r\n        border-color: var(--primary);\r\n        background: rgba(var(--primary-rgb), 0.03);\r\n      }\r\n      .dropzone-icon { font-size: 48px; margin-bottom: 16px; }\r\n      .dropzone-title {\r\n        font-size: 16px;\r\n        font-weight: 500;\r\n        color: var(--text-primary);\r\n        margin-bottom: 8px;\r\n      }\r\n      .dropzone-hint { font-size: 13px; color: var(--text-tertiary); }\r\n      \r\n      .selected-file {\r\n        display: none;\r\n        align-items: center;\r\n        gap: 16px;\r\n        margin-top: 20px;\r\n        padding: 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 12px;\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      .selected-file.visible { display: flex; }\r\n      .file-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        background: linear-gradient(135deg, #3b82f6, #60a5fa);\r\n        border-radius: 12px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n      }\r\n      .file-info { flex: 1; min-width: 0; }\r\n      .file-name {\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        color: var(--text-primary);\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n      .file-size { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }\r\n      .file-remove {\r\n        width: 32px;\r\n        height: 32px;\r\n        border: none;\r\n        background: transparent;\r\n        border-radius: 8px;\r\n        cursor: pointer;\r\n        color: var(--text-tertiary);\r\n        font-size: 18px;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .file-remove:hover {\r\n        background: rgba(239, 68, 68, 0.1);\r\n        color: #ef4444;\r\n      }\r\n      \r\n      /* Manual Mode */\r\n      .manual-form {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 20px;\r\n      }\r\n      .form-row {\r\n        display: flex;\r\n        gap: 16px;\r\n      }\r\n      .form-row > .form-group { flex: 1; }\r\n      .form-group label {\r\n        display: block;\r\n        font-size: 13px;\r\n        font-weight: 500;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 8px;\r\n      }\r\n      .form-group label .required { color: var(--primary); }\r\n      .form-group input,\r\n      .form-group textarea {\r\n        width: 100%;\r\n        padding: 12px 14px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        font-size: 14px;\r\n        transition: border-color 0.15s ease, box-shadow 0.15s ease;\r\n      }\r\n      .form-group input:focus,\r\n      .form-group textarea:focus {\r\n        outline: none;\r\n        border-color: var(--primary);\r\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\r\n      }\r\n      .form-group textarea {\r\n        min-height: 120px;\r\n        resize: vertical;\r\n      }\r\n      .form-group input::placeholder,\r\n      .form-group textarea::placeholder { color: var(--text-tertiary); }\r\n      \r\n      .composer-footer {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 12px;\r\n        padding: 16px 24px;\r\n        border-top: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      .composer-footer .btn {\r\n        padding: 10px 20px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n        border: none;\r\n      }\r\n      .composer-footer .btn-secondary {\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      .composer-footer .btn-secondary:hover { background: var(--bg-tertiary); }\r\n      .composer-footer .btn-primary {\r\n        background: var(--primary);\r\n        color: white;\r\n      }\r\n      .composer-footer .btn-primary:hover:not(:disabled) {\r\n        opacity: 0.9;\r\n        transform: translateY(-1px);\r\n      }\r\n      .composer-footer .btn-primary:disabled {\r\n        opacity: 0.5;\r\n        cursor: not-allowed;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"composer-header\">\r\n      <h2>Add Email</h2>\r\n      <button class=\"composer-close\" id=\"close-btn\">\r\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M18 6L6 18M6 6l12 12\"/>\r\n        </svg>\r\n      </button>\r\n    </div>\r\n    \r\n    <div class=\"composer-tabs\">\r\n      <button class=\"composer-tab active\" data-mode=\"paste\">Paste Text</button>\r\n      <button class=\"composer-tab\" data-mode=\"upload\">Upload .eml/.msg</button>\r\n      <button class=\"composer-tab\" data-mode=\"manual\">Manual Entry</button>\r\n    </div>\r\n    \r\n    <div class=\"composer-body\" id=\"composer-body\">\r\n      ${renderPasteMode()}\r\n    </div>\r\n    \r\n    <div class=\"composer-footer\">\r\n      <button class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\r\n      <button class=\"btn btn-primary\" id=\"save-btn\" disabled>Add Email</button>\r\n    </div>\r\n  `;\r\n\r\n  // Bind tabs\r\n  container.querySelectorAll('.composer-tab').forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      container.querySelectorAll('.composer-tab').forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentMode = tab.getAttribute('data-mode') as InputMode;\r\n      renderMode(container);\r\n    });\r\n  });\r\n\r\n  on(container.querySelector('#close-btn') as HTMLElement, 'click', () => {\r\n    closeEmailComposer();\r\n    props.onClose?.();\r\n  });\r\n\r\n  on(container.querySelector('#cancel-btn') as HTMLElement, 'click', () => {\r\n    closeEmailComposer();\r\n    props.onClose?.();\r\n  });\r\n\r\n  on(container.querySelector('#save-btn') as HTMLElement, 'click', () => saveEmail(container, props));\r\n\r\n  bindPasteMode(container);\r\n\r\n  return container;\r\n}\r\n\r\nfunction renderMode(container: HTMLElement): void {\r\n  const body = container.querySelector('#composer-body') as HTMLElement;\r\n  \r\n  switch (currentMode) {\r\n    case 'paste':\r\n      body.innerHTML = renderPasteMode();\r\n      bindPasteMode(container);\r\n      break;\r\n    case 'upload':\r\n      body.innerHTML = renderUploadMode();\r\n      bindUploadMode(container);\r\n      break;\r\n    case 'manual':\r\n      body.innerHTML = renderManualMode();\r\n      bindManualMode(container);\r\n      break;\r\n  }\r\n}\r\n\r\nfunction renderPasteMode(): string {\r\n  return `\r\n    <div class=\"paste-section\">\r\n      <label>Paste email content:</label>\r\n      <textarea id=\"email-paste\" placeholder=\"Paste the full email content here...\r\n\r\nInclude headers if available:\r\nFrom: sender@example.com\r\nTo: recipient@example.com\r\nSubject: Meeting notes\r\nDate: Jan 31, 2026\r\n\r\nEmail body text...\"></textarea>\r\n      <p class=\"paste-hint\">Include headers (From, To, Subject, Date) for better parsing.</p>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindPasteMode(container: HTMLElement): void {\r\n  const textarea = container.querySelector('#email-paste') as HTMLTextAreaElement;\r\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\r\n\r\n  if (textarea) {\r\n    on(textarea, 'input', () => {\r\n      saveBtn.disabled = textarea.value.trim().length < 10;\r\n    });\r\n  }\r\n}\r\n\r\nfunction renderUploadMode(): string {\r\n  return `\r\n    <div class=\"upload-section\">\r\n      <div class=\"dropzone\" id=\"file-dropzone\">\r\n        <div class=\"dropzone-icon\"></div>\r\n        <p class=\"dropzone-title\">Drop email file here</p>\r\n        <p class=\"dropzone-hint\">or click to browse  .eml, .msg</p>\r\n        <input type=\"file\" id=\"file-input\" accept=\".eml,.msg\" hidden>\r\n      </div>\r\n      <div class=\"selected-file\" id=\"selected-file\">\r\n        <div class=\"file-icon\"></div>\r\n        <div class=\"file-info\">\r\n          <div class=\"file-name\" id=\"file-name\"></div>\r\n          <div class=\"file-size\" id=\"file-size\"></div>\r\n        </div>\r\n        <button class=\"file-remove\" id=\"file-remove\"></button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindUploadMode(container: HTMLElement): void {\r\n  const dropzone = container.querySelector('#file-dropzone') as HTMLElement;\r\n  const input = container.querySelector('#file-input') as HTMLInputElement;\r\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\r\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\r\n\r\n  on(dropzone, 'click', () => input.click());\r\n  on(dropzone, 'dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });\r\n  on(dropzone, 'dragleave', () => dropzone.classList.remove('dragover'));\r\n  on(dropzone, 'drop', (e) => {\r\n    e.preventDefault();\r\n    dropzone.classList.remove('dragover');\r\n    if (e.dataTransfer?.files[0]) handleFileSelect(e.dataTransfer.files[0], container);\r\n  });\r\n  on(input, 'change', () => { if (input.files?.[0]) handleFileSelect(input.files[0], container); });\r\n  on(container.querySelector('#file-remove') as HTMLElement, 'click', () => {\r\n    selectedFile.classList.remove('visible');\r\n    (container as any)._emlFile = null;\r\n    saveBtn.disabled = true;\r\n  });\r\n}\r\n\r\nfunction handleFileSelect(file: File, container: HTMLElement): void {\r\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\r\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\r\n  \r\n  container.querySelector('#file-name')!.textContent = file.name;\r\n  container.querySelector('#file-size')!.textContent = formatFileSize(file.size);\r\n  selectedFile.classList.add('visible');\r\n  \r\n  (container as any)._emlFile = file;\r\n  saveBtn.disabled = false;\r\n}\r\n\r\nfunction renderManualMode(): string {\r\n  return `\r\n    <form class=\"manual-form\" id=\"manual-form\">\r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label>From <span class=\"required\">*</span></label>\r\n          <input type=\"email\" name=\"from\" placeholder=\"sender@example.com\" required>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Date</label>\r\n          <input type=\"datetime-local\" name=\"date\">\r\n        </div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>To <span class=\"required\">*</span></label>\r\n        <input type=\"text\" name=\"to\" placeholder=\"recipient@example.com (comma-separated)\" required>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>CC</label>\r\n        <input type=\"text\" name=\"cc\" placeholder=\"cc@example.com (comma-separated)\">\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Subject</label>\r\n        <input type=\"text\" name=\"subject\" placeholder=\"Email subject\">\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Body <span class=\"required\">*</span></label>\r\n        <textarea name=\"body\" placeholder=\"Email content...\" required></textarea>\r\n      </div>\r\n    </form>\r\n  `;\r\n}\r\n\r\nfunction bindManualMode(container: HTMLElement): void {\r\n  const form = container.querySelector('#manual-form') as HTMLFormElement;\r\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\r\n\r\n  const checkValidity = () => {\r\n    const from = form.querySelector('[name=\"from\"]') as HTMLInputElement;\r\n    const to = form.querySelector('[name=\"to\"]') as HTMLInputElement;\r\n    const body = form.querySelector('[name=\"body\"]') as HTMLTextAreaElement;\r\n    saveBtn.disabled = !from.value || !to.value || !body.value;\r\n  };\r\n\r\n  form.querySelectorAll('input, textarea').forEach(el => {\r\n    on(el as HTMLElement, 'input', checkValidity);\r\n  });\r\n}\r\n\r\nasync function fileToBase64(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      const base64 = (reader.result as string).split(',')[1];\r\n      resolve(base64);\r\n    };\r\n    reader.onerror = reject;\r\n    reader.readAsDataURL(file);\r\n  });\r\n}\r\n\r\nasync function saveEmail(container: HTMLElement, props: EmailComposerProps): Promise<void> {\r\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\r\n  saveBtn.disabled = true;\r\n  saveBtn.textContent = 'Processing...';\r\n\r\n  try {\r\n    let data: Record<string, unknown>;\r\n\r\n    switch (currentMode) {\r\n      case 'paste': {\r\n        const text = (container.querySelector('#email-paste') as HTMLTextAreaElement).value;\r\n        data = { emailText: text };\r\n        break;\r\n      }\r\n      case 'upload': {\r\n        const file = (container as any)._emlFile as File;\r\n        if (!file) throw new Error('No file selected');\r\n        \r\n        const base64 = await fileToBase64(file);\r\n        if (file.name.toLowerCase().endsWith('.msg')) {\r\n          data = { msgBase64: base64, filename: file.name };\r\n        } else {\r\n          data = { emlBase64: base64, filename: file.name };\r\n        }\r\n        break;\r\n      }\r\n      case 'manual': {\r\n        const form = container.querySelector('#manual-form') as HTMLFormElement;\r\n        const formData = new FormData(form);\r\n        data = {\r\n          from: formData.get('from'),\r\n          to: (formData.get('to') as string).split(',').map(e => e.trim()),\r\n          cc: formData.get('cc') ? (formData.get('cc') as string).split(',').map(e => e.trim()) : undefined,\r\n          subject: formData.get('subject'),\r\n          body: formData.get('body'),\r\n          date: formData.get('date') || undefined,\r\n        };\r\n        break;\r\n      }\r\n    }\r\n\r\n    const result = await http.post('/api/emails/import', data);\r\n    toast.success('Email added successfully');\r\n    props.onSave?.(result);\r\n    closeEmailComposer();\r\n  } catch (err) {\r\n    toast.error('Failed to add email');\r\n    console.error('[EmailComposer] Error:', err);\r\n  } finally {\r\n    saveBtn.disabled = false;\r\n    saveBtn.textContent = 'Add Email';\r\n  }\r\n}\r\n\r\nfunction formatFileSize(bytes: number): string {\r\n  if (bytes < 1024) return `${bytes} B`;\r\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\r\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\r\n}\r\n\r\nexport default showEmailComposer;\r\n","/**\r\n * Notifications Dropdown Component\r\n * Bell icon with notification list in header\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { notificationsService, Notification } from '../services/notifications';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface NotificationsDropdownProps {\r\n  onNotificationClick?: (notification: Notification) => void;\r\n}\r\n\r\nlet isOpen = false;\r\nlet unreadCount = 0;\r\n\r\n/**\r\n * Create notifications dropdown\r\n */\r\nexport function createNotificationsDropdown(props: NotificationsDropdownProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'notifications-dropdown' });\r\n\r\n  container.innerHTML = `\r\n    <button class=\"notifications-trigger\" id=\"notifications-trigger\">\r\n      <span class=\"bell-icon\"></span>\r\n      <span class=\"notification-badge hidden\" id=\"notification-badge\">0</span>\r\n    </button>\r\n    <div class=\"notifications-panel hidden\" id=\"notifications-panel\">\r\n      <div class=\"notifications-header\">\r\n        <h3>Notifications</h3>\r\n        <button class=\"btn-link\" id=\"mark-all-read\">Mark all read</button>\r\n      </div>\r\n      <div class=\"notifications-list\" id=\"notifications-list\">\r\n        <div class=\"loading\">Loading...</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind trigger click\r\n  const trigger = container.querySelector('#notifications-trigger');\r\n  if (trigger) {\r\n    on(trigger as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      toggleDropdown(container, props);\r\n    });\r\n  }\r\n\r\n  // Mark all as read\r\n  const markAllBtn = container.querySelector('#mark-all-read');\r\n  if (markAllBtn) {\r\n    on(markAllBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        await notificationsService.markAllRead();\r\n        toast.success('All notifications marked as read');\r\n        loadNotifications(container, props);\r\n        updateBadge(container, 0);\r\n      } catch {\r\n        toast.error('Failed to mark notifications as read');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Close on outside click\r\n  document.addEventListener('click', () => {\r\n    closeDropdown(container);\r\n  });\r\n\r\n  // Initial count load\r\n  loadUnreadCount(container);\r\n\r\n  // Periodic refresh\r\n  setInterval(() => loadUnreadCount(container), 60000);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Toggle dropdown\r\n */\r\nfunction toggleDropdown(container: HTMLElement, props: NotificationsDropdownProps): void {\r\n  isOpen = !isOpen;\r\n  const panel = container.querySelector('#notifications-panel');\r\n  \r\n  if (panel) {\r\n    panel.classList.toggle('hidden', !isOpen);\r\n    \r\n    if (isOpen) {\r\n      loadNotifications(container, props);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Close dropdown\r\n */\r\nfunction closeDropdown(container: HTMLElement): void {\r\n  isOpen = false;\r\n  const panel = container.querySelector('#notifications-panel');\r\n  if (panel) {\r\n    panel.classList.add('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Load unread count\r\n */\r\nasync function loadUnreadCount(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const count = await notificationsService.getUnreadCount();\r\n    unreadCount = count;\r\n    updateBadge(container, count);\r\n  } catch {\r\n    // Ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Update badge\r\n */\r\nfunction updateBadge(container: HTMLElement, count: number): void {\r\n  const badge = container.querySelector('#notification-badge') as HTMLElement;\r\n  if (badge) {\r\n    badge.textContent = count > 99 ? '99+' : String(count);\r\n    badge.classList.toggle('hidden', count === 0);\r\n  }\r\n}\r\n\r\n/**\r\n * Load notifications\r\n */\r\nasync function loadNotifications(container: HTMLElement, props: NotificationsDropdownProps): Promise<void> {\r\n  const list = container.querySelector('#notifications-list') as HTMLElement;\r\n  list.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const notifications = await notificationsService.getAll({ limit: 20 });\r\n    renderNotifications(list, notifications, container, props);\r\n  } catch {\r\n    list.innerHTML = '<div class=\"error\">Failed to load</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render notifications\r\n */\r\nfunction renderNotifications(\r\n  container: HTMLElement, \r\n  notifications: Notification[],\r\n  dropdown: HTMLElement,\r\n  props: NotificationsDropdownProps\r\n): void {\r\n  if (notifications.length === 0) {\r\n    container.innerHTML = '<div class=\"empty\">No notifications</div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = notifications.map(n => `\r\n    <div class=\"notification-item ${n.read ? '' : 'unread'}\" data-id=\"${n.id}\">\r\n      <div class=\"notification-icon\">${getIcon(n.type)}</div>\r\n      <div class=\"notification-content\">\r\n        <div class=\"notification-title\">${escapeHtml(n.title)}</div>\r\n        ${n.message ? `<div class=\"notification-message\">${escapeHtml(n.message)}</div>` : ''}\r\n        <div class=\"notification-time\">${formatRelativeTime(n.created_at)}</div>\r\n      </div>\r\n      <button class=\"btn-icon dismiss-btn\" title=\"Dismiss\"></button>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.notification-item').forEach(item => {\r\n    on(item as HTMLElement, 'click', async (e) => {\r\n      if ((e.target as HTMLElement).closest('.dismiss-btn')) return;\r\n      \r\n      const id = item.getAttribute('data-id');\r\n      const notification = notifications.find(n => n.id === id);\r\n      if (notification) {\r\n        // Mark as read\r\n        if (!notification.read) {\r\n          await notificationsService.markRead(id!);\r\n          item.classList.remove('unread');\r\n          unreadCount = Math.max(0, unreadCount - 1);\r\n          updateBadge(dropdown, unreadCount);\r\n        }\r\n        \r\n        closeDropdown(dropdown);\r\n        props.onNotificationClick?.(notification);\r\n      }\r\n    });\r\n\r\n    // Dismiss button\r\n    const dismissBtn = item.querySelector('.dismiss-btn');\r\n    if (dismissBtn) {\r\n      on(dismissBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = item.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        try {\r\n          await notificationsService.delete(id);\r\n          item.remove();\r\n          if (!item.classList.contains('unread')) return;\r\n          unreadCount = Math.max(0, unreadCount - 1);\r\n          updateBadge(dropdown, unreadCount);\r\n        } catch {\r\n          // Ignore\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Get icon by type\r\n */\r\nfunction getIcon(type: string): string {\r\n  switch (type) {\r\n    case 'question': return '';\r\n    case 'risk': return '';\r\n    case 'action': return '';\r\n    case 'decision': return '';\r\n    case 'mention': return '@';\r\n    case 'comment': return '';\r\n    case 'assignment': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Initialize notifications in header\r\n */\r\nexport function initNotificationsDropdown(\r\n  container: HTMLElement,\r\n  props: NotificationsDropdownProps = {}\r\n): HTMLElement {\r\n  const dropdown = createNotificationsDropdown(props);\r\n  container.appendChild(dropdown);\r\n  return dropdown;\r\n}\r\n\r\nexport default createNotificationsDropdown;\r\n","/**\r\n * Comments Thread Component\r\n * Inline comments for entities\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { commentsService, Comment } from '../services/notifications';\r\nimport { appStore } from '../stores/app';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface CommentsThreadProps {\r\n  targetType: 'question' | 'risk' | 'action' | 'decision' | 'contact' | 'document' | 'email';\r\n  targetId: string;\r\n  projectId?: string;\r\n  onCommentAdded?: (comment: Comment) => void;\r\n}\r\n\r\n/**\r\n * Create comments thread\r\n */\r\nexport function createCommentsThread(props: CommentsThreadProps): HTMLElement {\r\n  const container = createElement('div', { className: 'comments-thread' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"comments-header\">\r\n      <h4>Comments</h4>\r\n      <span class=\"comments-count\" id=\"comments-count\">0</span>\r\n    </div>\r\n    <div class=\"comments-list\" id=\"comments-list\">\r\n      <div class=\"loading\">Loading comments...</div>\r\n    </div>\r\n    <div class=\"comment-form\">\r\n      <textarea id=\"comment-input\" placeholder=\"Add a comment...\" rows=\"2\"></textarea>\r\n      <div class=\"comment-form-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"submit-comment-btn\" disabled>Comment</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind input\r\n  const input = container.querySelector('#comment-input') as HTMLTextAreaElement;\r\n  const submitBtn = container.querySelector('#submit-comment-btn') as HTMLButtonElement;\r\n\r\n  on(input, 'input', () => {\r\n    submitBtn.disabled = !input.value.trim();\r\n  });\r\n\r\n  on(submitBtn, 'click', () => submitComment(container, props, input));\r\n\r\n  // Submit on Ctrl+Enter\r\n  on(input, 'keydown', (e) => {\r\n    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\r\n      e.preventDefault();\r\n      if (input.value.trim()) {\r\n        submitComment(container, props, input);\r\n      }\r\n    }\r\n  });\r\n\r\n  // Initial load\r\n  loadComments(container, props);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load comments\r\n */\r\nasync function loadComments(container: HTMLElement, props: CommentsThreadProps): Promise<void> {\r\n  const list = container.querySelector('#comments-list') as HTMLElement;\r\n  list.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const comments = await commentsService.getAll(props.targetType, props.targetId);\r\n\r\n    renderComments(list, comments, container, props);\r\n    updateCount(container, comments.length);\r\n  } catch {\r\n    list.innerHTML = '<div class=\"error\">Failed to load comments</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render comments\r\n */\r\nfunction renderComments(\r\n  container: HTMLElement, \r\n  comments: Comment[],\r\n  thread: HTMLElement,\r\n  props: CommentsThreadProps\r\n): void {\r\n  if (comments.length === 0) {\r\n    container.innerHTML = '<div class=\"empty\">No comments yet</div>';\r\n    return;\r\n  }\r\n\r\n  // Group by parent\r\n  const topLevel = comments.filter(c => !c.parent_id);\r\n  const replies = comments.filter(c => c.parent_id);\r\n  const repliesByParent: Record<string, Comment[]> = {};\r\n  \r\n  replies.forEach(r => {\r\n    if (!repliesByParent[r.parent_id!]) repliesByParent[r.parent_id!] = [];\r\n    repliesByParent[r.parent_id!].push(r);\r\n  });\r\n\r\n  container.innerHTML = topLevel.map(comment => \r\n    renderComment(comment, repliesByParent[comment.id] || [], thread, props)\r\n  ).join('');\r\n\r\n  bindCommentEvents(container, comments, thread, props);\r\n}\r\n\r\n/**\r\n * Render single comment\r\n */\r\nfunction renderComment(\r\n  comment: Comment, \r\n  replies: Comment[],\r\n  thread: HTMLElement,\r\n  props: CommentsThreadProps\r\n): string {\r\n  const currentUser = appStore.getState().currentUser;\r\n  const isOwn = currentUser?.id === comment.user_id;\r\n\r\n  return `\r\n    <div class=\"comment ${comment.resolved ? 'resolved' : ''}\" data-id=\"${comment.id}\">\r\n      <div class=\"comment-avatar\">${getInitials(comment.user_name || 'U')}</div>\r\n      <div class=\"comment-body\">\r\n        <div class=\"comment-header\">\r\n          <span class=\"comment-author\">${escapeHtml(comment.user_name || 'Unknown')}</span>\r\n          <span class=\"comment-time\">${formatRelativeTime(comment.created_at)}</span>\r\n          ${comment.resolved ? '<span class=\"resolved-badge\">Resolved</span>' : ''}\r\n        </div>\r\n        <div class=\"comment-content\">${escapeHtml(comment.content)}</div>\r\n        <div class=\"comment-actions\">\r\n          <button class=\"btn-link reply-btn\">Reply</button>\r\n          ${!comment.resolved ? '<button class=\"btn-link resolve-btn\">Resolve</button>' : ''}\r\n          ${isOwn ? '<button class=\"btn-link delete-btn\">Delete</button>' : ''}\r\n        </div>\r\n        <div class=\"reply-form hidden\">\r\n          <textarea class=\"reply-input\" placeholder=\"Reply...\" rows=\"2\"></textarea>\r\n          <div class=\"reply-actions\">\r\n            <button class=\"btn btn-sm cancel-reply-btn\">Cancel</button>\r\n            <button class=\"btn btn-primary btn-sm submit-reply-btn\">Reply</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    ${replies.length > 0 ? `\r\n      <div class=\"comment-replies\">\r\n        ${replies.map(r => `\r\n          <div class=\"comment reply\" data-id=\"${r.id}\">\r\n            <div class=\"comment-avatar small\">${getInitials(r.user_name || 'U')}</div>\r\n            <div class=\"comment-body\">\r\n              <div class=\"comment-header\">\r\n                <span class=\"comment-author\">${escapeHtml(r.user_name || 'Unknown')}</span>\r\n                <span class=\"comment-time\">${formatRelativeTime(r.created_at)}</span>\r\n              </div>\r\n              <div class=\"comment-content\">${escapeHtml(r.content)}</div>\r\n              ${currentUser?.id === r.user_id ? `\r\n                <div class=\"comment-actions\">\r\n                  <button class=\"btn-link delete-btn\">Delete</button>\r\n                </div>\r\n              ` : ''}\r\n            </div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind comment events\r\n */\r\nfunction bindCommentEvents(\r\n  container: HTMLElement,\r\n  comments: Comment[],\r\n  thread: HTMLElement,\r\n  props: CommentsThreadProps\r\n): void {\r\n  // Reply buttons\r\n  container.querySelectorAll('.reply-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const comment = btn.closest('.comment');\r\n      const replyForm = comment?.querySelector('.reply-form');\r\n      if (replyForm) {\r\n        replyForm.classList.toggle('hidden');\r\n        const input = replyForm.querySelector('.reply-input') as HTMLTextAreaElement;\r\n        input?.focus();\r\n      }\r\n    });\r\n  });\r\n\r\n  // Cancel reply\r\n  container.querySelectorAll('.cancel-reply-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const replyForm = btn.closest('.reply-form');\r\n      if (replyForm) {\r\n        replyForm.classList.add('hidden');\r\n        (replyForm.querySelector('.reply-input') as HTMLTextAreaElement).value = '';\r\n      }\r\n    });\r\n  });\r\n\r\n  // Submit reply\r\n  container.querySelectorAll('.submit-reply-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = btn.closest('.comment');\r\n      const id = comment?.getAttribute('data-id');\r\n      const input = comment?.querySelector('.reply-input') as HTMLTextAreaElement;\r\n      if (!id || !input?.value.trim()) return;\r\n\r\n      try {\r\n        await commentsService.create(props.targetType, props.targetId, input.value.trim(), id);\r\n        toast.success('Reply added');\r\n        loadComments(thread, props);\r\n      } catch {\r\n        toast.error('Failed to add reply');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Resolve\r\n  container.querySelectorAll('.resolve-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = btn.closest('.comment');\r\n      const id = comment?.getAttribute('data-id');\r\n      if (!id) return;\r\n\r\n      try {\r\n        await commentsService.resolve(id);\r\n        toast.success('Comment resolved');\r\n        loadComments(thread, props);\r\n      } catch {\r\n        toast.error('Failed to resolve comment');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Delete\r\n  container.querySelectorAll('.delete-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = btn.closest('.comment');\r\n      const id = comment?.getAttribute('data-id');\r\n      if (!id || !confirm('Delete this comment?')) return;\r\n\r\n      try {\r\n        await commentsService.delete(id);\r\n        toast.success('Comment deleted');\r\n        loadComments(thread, props);\r\n      } catch {\r\n        toast.error('Failed to delete comment');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Submit new comment\r\n */\r\nasync function submitComment(\r\n  container: HTMLElement,\r\n  props: CommentsThreadProps,\r\n  input: HTMLTextAreaElement\r\n): Promise<void> {\r\n  const content = input.value.trim();\r\n  if (!content) return;\r\n\r\n  const btn = container.querySelector('#submit-comment-btn') as HTMLButtonElement;\r\n  btn.disabled = true;\r\n\r\n  try {\r\n    const comment = await commentsService.create(props.targetType, props.targetId, content);\r\n\r\n    input.value = '';\r\n    toast.success('Comment added');\r\n    loadComments(container, props);\r\n    props.onCommentAdded?.(comment);\r\n  } catch {\r\n    toast.error('Failed to add comment');\r\n    btn.disabled = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(container: HTMLElement, count: number): void {\r\n  const countEl = container.querySelector('#comments-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createCommentsThread;\r\n","/**\r\n * Members Panel Component\r\n * Project members management with invites\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { membersService, ProjectMember } from '../services/notifications';\r\nimport { appStore } from '../stores/app';\r\nimport { showInviteModal } from './modals/InviteModal';\r\nimport { showMemberPermissionsModal } from './modals/MemberPermissionsModal';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface MembersPanelProps {\r\n  projectId?: string;\r\n  onMemberClick?: (member: ProjectMember) => void;\r\n}\r\n\r\n/**\r\n * Create members panel\r\n */\r\nexport function createMembersPanel(props: MembersPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'members-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Team Members</h2>\r\n        <span class=\"panel-count\" id=\"members-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"invite-member-btn\">+ Invite</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"members-content\">\r\n      <div class=\"loading\">Loading members...</div>\r\n    </div>\r\n    <div class=\"pending-invites\" id=\"pending-invites\"></div>\r\n  `;\r\n\r\n  // Bind invite button\r\n  const inviteBtn = panel.querySelector('#invite-member-btn');\r\n  if (inviteBtn) {\r\n    on(inviteBtn as HTMLElement, 'click', () => {\r\n      const projectId = props.projectId || appStore.getState().currentProject?.id;\r\n      if (!projectId) {\r\n        toast.error('No project selected');\r\n        return;\r\n      }\r\n      showInviteModal({\r\n        projectId,\r\n        onInvite: () => loadPendingInvites(panel, projectId),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  const projectId = props.projectId || appStore.getState().currentProject?.id;\r\n  if (projectId) {\r\n    loadMembers(panel, projectId, props);\r\n    loadPendingInvites(panel, projectId);\r\n  }\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load members\r\n */\r\nasync function loadMembers(\r\n  panel: HTMLElement, \r\n  projectId: string,\r\n  props: MembersPanelProps\r\n): Promise<void> {\r\n  const content = panel.querySelector('#members-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const members = await membersService.getAll(projectId);\r\n    renderMembers(content, members, projectId, props);\r\n    updateCount(panel, members.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load members</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render members\r\n */\r\nfunction renderMembers(\r\n  container: HTMLElement, \r\n  members: ProjectMember[],\r\n  projectId: string,\r\n  props: MembersPanelProps\r\n): void {\r\n  if (members.length === 0) {\r\n    container.innerHTML = '<div class=\"empty\">No team members</div>';\r\n    return;\r\n  }\r\n\r\n  const currentUser = appStore.getState().currentUser;\r\n\r\n  container.innerHTML = `\r\n    <div class=\"members-list\">\r\n      ${members.map(member => `\r\n        <div class=\"member-card\" data-id=\"${member.user_id}\">\r\n          <div class=\"member-avatar\">\r\n            ${member.avatar_url \r\n              ? `<img src=\"${member.avatar_url}\" alt=\"\">`\r\n              : `<span>${getInitials(member.name || member.email)}</span>`\r\n            }\r\n          </div>\r\n          <div class=\"member-info\">\r\n            <div class=\"member-name\">${escapeHtml(member.name || member.email)}</div>\r\n            <div class=\"member-email\">${escapeHtml(member.email)}</div>\r\n          </div>\r\n          <div class=\"member-role\">\r\n            <select class=\"role-select\" data-user-id=\"${member.user_id}\" ${member.user_id === currentUser?.id ? 'disabled' : ''}>\r\n              <option value=\"viewer\" ${member.role === 'viewer' ? 'selected' : ''}>Viewer</option>\r\n              <option value=\"editor\" ${member.role === 'editor' ? 'selected' : ''}>Editor</option>\r\n              <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\r\n              <option value=\"owner\" ${member.role === 'owner' ? 'selected' : ''}>Owner</option>\r\n            </select>\r\n          </div>\r\n          <button class=\"btn-icon permissions-btn\" data-user-id=\"${member.user_id}\" title=\"Permissions\" style=\"font-size: 14px;\"></button>\r\n          ${member.user_id !== currentUser?.id ? `\r\n            <button class=\"btn-icon remove-member-btn\" data-user-id=\"${member.user_id}\" title=\"Remove\"></button>\r\n          ` : ''}\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind role change\r\n  container.querySelectorAll('.role-select').forEach(select => {\r\n    on(select as HTMLElement, 'change', async () => {\r\n      const userId = select.getAttribute('data-user-id');\r\n      const role = (select as HTMLSelectElement).value as 'admin' | 'editor' | 'viewer';\r\n      if (!userId) return;\r\n\r\n      try {\r\n        await membersService.updateRole(userId, role, projectId);\r\n        toast.success('Role updated');\r\n      } catch {\r\n        toast.error('Failed to update role');\r\n        loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bind remove buttons\r\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const userId = btn.getAttribute('data-user-id');\r\n      if (!userId || !confirm('Remove this member from the project?')) return;\r\n\r\n      try {\r\n        await membersService.remove(projectId, userId);\r\n        toast.success('Member removed');\r\n        loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\r\n      } catch {\r\n        toast.error('Failed to remove member');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bind permissions buttons\r\n  container.querySelectorAll('.permissions-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const userId = btn.getAttribute('data-user-id');\r\n      const member = members.find(m => m.user_id === userId);\r\n      if (!member) return;\r\n\r\n      showMemberPermissionsModal({\r\n        projectId,\r\n        userId: member.user_id,\r\n        userName: member.name || '',\r\n        userEmail: member.email,\r\n        avatarUrl: member.avatar_url,\r\n        currentRole: member.role,\r\n        currentPermissions: (member as { permissions?: string[] }).permissions,\r\n        onSave: () => {\r\n          loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\r\n        },\r\n      });\r\n    });\r\n  });\r\n\r\n  // Bind member clicks\r\n  container.querySelectorAll('.member-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.role-select, .remove-member-btn')) return;\r\n      \r\n      const userId = card.getAttribute('data-id');\r\n      const member = members.find(m => m.user_id === userId);\r\n      if (member && props.onMemberClick) {\r\n        props.onMemberClick(member);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Load pending invites\r\n */\r\nasync function loadPendingInvites(panel: HTMLElement, projectId: string): Promise<void> {\r\n  const container = panel.querySelector('#pending-invites') as HTMLElement;\r\n\r\n  try {\r\n    const invites = await membersService.getInvites(projectId);\r\n    \r\n    if (invites.length === 0) {\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n\r\n    container.innerHTML = `\r\n      <div class=\"invites-section\">\r\n        <h4>Pending Invites</h4>\r\n        <div class=\"invites-list\">\r\n          ${invites.map(invite => `\r\n            <div class=\"invite-card\" data-id=\"${invite.id}\">\r\n              <div class=\"invite-info\">\r\n                <span class=\"invite-email\">${escapeHtml(invite.email)}</span>\r\n                <span class=\"invite-role\">${invite.role}</span>\r\n                <span class=\"invite-time\">Sent ${formatRelativeTime(invite.invited_at || invite.created_at || new Date().toISOString())}</span>\r\n              </div>\r\n              <button class=\"btn btn-sm cancel-invite-btn\" data-id=\"${invite.id}\">Cancel</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Bind cancel buttons\r\n    container.querySelectorAll('.cancel-invite-btn').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', async () => {\r\n        const inviteId = btn.getAttribute('data-id');\r\n        if (!inviteId) return;\r\n\r\n        try {\r\n          // TODO: Implement cancel invite in service\r\n          toast.info('Invite cancellation not implemented');\r\n        } catch {\r\n          toast.error('Failed to cancel invite');\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    // Ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#members-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createMembersPanel;\r\n","/**\r\n * API Keys Panel Component\r\n * Manage API keys with create, copy, revoke\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface ApiKeysPanelProps {\r\n  projectId?: string;\r\n}\r\n\r\ninterface ApiKey {\r\n  id: string;\r\n  name: string;\r\n  key_prefix: string;\r\n  created_at: string;\r\n  last_used?: string;\r\n  expires_at?: string;\r\n  scopes: string[];\r\n}\r\n\r\n/**\r\n * Create API keys panel\r\n */\r\nexport function createApiKeysPanel(props: ApiKeysPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'api-keys-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>API Keys</h2>\r\n        <span class=\"panel-count\" id=\"keys-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"create-key-btn\">+ Create Key</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"keys-content\">\r\n      <div class=\"loading\">Loading API keys...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind create button\r\n  const createBtn = panel.querySelector('#create-key-btn');\r\n  if (createBtn) {\r\n    on(createBtn as HTMLElement, 'click', () => showCreateKeyModal(panel, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadApiKeys(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load API keys\r\n */\r\nasync function loadApiKeys(panel: HTMLElement, props: ApiKeysPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#keys-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const response = await http.get<{ keys: ApiKey[] }>('/api/keys');\r\n    renderApiKeys(content, response.data.keys || [], panel, props);\r\n    updateCount(panel, response.data.keys?.length || 0);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load API keys</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render API keys\r\n */\r\nfunction renderApiKeys(\r\n  container: HTMLElement, \r\n  keys: ApiKey[],\r\n  panel: HTMLElement,\r\n  props: ApiKeysPanelProps\r\n): void {\r\n  if (keys.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No API keys created yet</p>\r\n        <p class=\"hint\">Create an API key to access the GodMode API programmatically</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"keys-list\">\r\n      ${keys.map(key => `\r\n        <div class=\"key-card\" data-id=\"${key.id}\">\r\n          <div class=\"key-info\">\r\n            <div class=\"key-name\">${escapeHtml(key.name)}</div>\r\n            <div class=\"key-preview\">${key.key_prefix}</div>\r\n            <div class=\"key-meta\">\r\n              Created ${formatRelativeTime(key.created_at)}\r\n              ${key.last_used ? ` Last used ${formatRelativeTime(key.last_used)}` : ' Never used'}\r\n              ${key.expires_at ? ` Expires ${formatRelativeTime(key.expires_at)}` : ''}\r\n            </div>\r\n            ${key.scopes.length > 0 ? `\r\n              <div class=\"key-scopes\">\r\n                ${key.scopes.map(s => `<span class=\"scope-badge\">${s}</span>`).join('')}\r\n              </div>\r\n            ` : ''}\r\n          </div>\r\n          <div class=\"key-actions\">\r\n            <button class=\"btn btn-sm revoke-key-btn\" data-id=\"${key.id}\">Revoke</button>\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind revoke buttons\r\n  container.querySelectorAll('.revoke-key-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      if (!id || !confirm('Revoke this API key? This action cannot be undone.')) return;\r\n\r\n      try {\r\n        await http.delete(`/api/keys/${id}`);\r\n        toast.success('API key revoked');\r\n        loadApiKeys(panel, props);\r\n      } catch {\r\n        toast.error('Failed to revoke API key');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show create key modal\r\n */\r\nfunction showCreateKeyModal(panel: HTMLElement, props: ApiKeysPanelProps): void {\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>Create API Key</h2>\r\n        <button class=\"btn-icon close-modal\"></button>\r\n      </div>\r\n      <form id=\"create-key-form\" class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label for=\"key-name\">Key Name *</label>\r\n          <input type=\"text\" id=\"key-name\" required placeholder=\"e.g., My Integration\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"key-expiry\">Expires</label>\r\n          <select id=\"key-expiry\">\r\n            <option value=\"\">Never</option>\r\n            <option value=\"30\">30 days</option>\r\n            <option value=\"90\">90 days</option>\r\n            <option value=\"365\">1 year</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Scopes</label>\r\n          <div class=\"scopes-grid\">\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"scopes\" value=\"read\" checked> Read\r\n            </label>\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"scopes\" value=\"write\"> Write\r\n            </label>\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"scopes\" value=\"chat\"> Chat\r\n            </label>\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"scopes\" value=\"admin\"> Admin\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </form>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary close-modal\">Cancel</button>\r\n        <button class=\"btn btn-primary\" id=\"submit-key-btn\">Create Key</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Bind events\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n\r\n  const submitBtn = overlay.querySelector('#submit-key-btn');\r\n  if (submitBtn) {\r\n    on(submitBtn as HTMLElement, 'click', async () => {\r\n      const form = overlay.querySelector('#create-key-form') as HTMLFormElement;\r\n      const nameInput = form.querySelector('#key-name') as HTMLInputElement;\r\n      const expirySelect = form.querySelector('#key-expiry') as HTMLSelectElement;\r\n      const scopeCheckboxes = form.querySelectorAll('input[name=\"scopes\"]:checked');\r\n\r\n      if (!nameInput.value.trim()) {\r\n        toast.error('Key name is required');\r\n        return;\r\n      }\r\n\r\n      const scopes = Array.from(scopeCheckboxes).map(cb => (cb as HTMLInputElement).value);\r\n\r\n      const btn = submitBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.textContent = 'Creating...';\r\n\r\n      try {\r\n        const response = await http.post<{ key: string; id: string }>('/api/keys', {\r\n          name: nameInput.value.trim(),\r\n          expires_in_days: expirySelect.value ? parseInt(expirySelect.value) : null,\r\n          scopes,\r\n        });\r\n\r\n        // Show the generated key\r\n        showNewKeyModal(response.data.key);\r\n        overlay.remove();\r\n        loadApiKeys(panel, props);\r\n      } catch {\r\n        toast.error('Failed to create API key');\r\n        btn.disabled = false;\r\n        btn.textContent = 'Create Key';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Show new key modal with copy button\r\n */\r\nfunction showNewKeyModal(key: string): void {\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>API Key Created</h2>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <p class=\"warning-text\"> Copy this key now! You won't be able to see it again.</p>\r\n        <div class=\"key-display\">\r\n          <code id=\"new-key-value\">${escapeHtml(key)}</code>\r\n          <button class=\"btn btn-sm\" id=\"copy-key-btn\">Copy</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-primary close-modal\">Done</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Copy button\r\n  const copyBtn = overlay.querySelector('#copy-key-btn');\r\n  if (copyBtn) {\r\n    on(copyBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        await navigator.clipboard.writeText(key);\r\n        toast.success('Key copied to clipboard');\r\n        copyBtn.textContent = 'Copied!';\r\n      } catch {\r\n        toast.error('Failed to copy');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Close button\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#keys-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createApiKeysPanel;\r\n","/**\r\n * Webhooks Panel Component\r\n * Manage webhooks with CRUD and test functionality\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface WebhooksPanelProps {\r\n  projectId?: string;\r\n}\r\n\r\ninterface Webhook {\r\n  id: string;\r\n  name: string;\r\n  url: string;\r\n  events: string[];\r\n  active: boolean;\r\n  secret?: string;\r\n  created_at: string;\r\n  last_triggered?: string;\r\n  last_status?: number;\r\n}\r\n\r\nconst AVAILABLE_EVENTS = [\r\n  'question.created',\r\n  'question.updated',\r\n  'question.answered',\r\n  'risk.created',\r\n  'risk.updated',\r\n  'risk.mitigated',\r\n  'action.created',\r\n  'action.completed',\r\n  'decision.created',\r\n  'decision.approved',\r\n  'decision.rejected',\r\n  'document.uploaded',\r\n  'document.processed',\r\n  'chat.message',\r\n];\r\n\r\n/**\r\n * Create webhooks panel\r\n */\r\nexport function createWebhooksPanel(props: WebhooksPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'webhooks-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Webhooks</h2>\r\n        <span class=\"panel-count\" id=\"webhooks-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"create-webhook-btn\">+ Add Webhook</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"webhooks-content\">\r\n      <div class=\"loading\">Loading webhooks...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind create button\r\n  const createBtn = panel.querySelector('#create-webhook-btn');\r\n  if (createBtn) {\r\n    on(createBtn as HTMLElement, 'click', () => showWebhookModal(panel, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadWebhooks(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load webhooks\r\n */\r\nasync function loadWebhooks(panel: HTMLElement, props: WebhooksPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#webhooks-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const response = await http.get<{ webhooks: Webhook[] }>('/api/webhooks');\r\n    renderWebhooks(content, response.data.webhooks || [], panel, props);\r\n    updateCount(panel, response.data.webhooks?.length || 0);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load webhooks</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render webhooks\r\n */\r\nfunction renderWebhooks(\r\n  container: HTMLElement, \r\n  webhooks: Webhook[],\r\n  panel: HTMLElement,\r\n  props: WebhooksPanelProps\r\n): void {\r\n  if (webhooks.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No webhooks configured</p>\r\n        <p class=\"hint\">Webhooks allow you to receive real-time notifications when events occur</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"webhooks-list\">\r\n      ${webhooks.map(webhook => `\r\n        <div class=\"webhook-card ${webhook.active ? '' : 'inactive'}\" data-id=\"${webhook.id}\">\r\n          <div class=\"webhook-status\">\r\n            <span class=\"status-indicator ${webhook.active ? 'active' : 'inactive'}\"></span>\r\n          </div>\r\n          <div class=\"webhook-info\">\r\n            <div class=\"webhook-name\">${escapeHtml(webhook.name)}</div>\r\n            <div class=\"webhook-url\">${escapeHtml(webhook.url)}</div>\r\n            <div class=\"webhook-events\">\r\n              ${webhook.events.slice(0, 3).map(e => `<span class=\"event-badge\">${e}</span>`).join('')}\r\n              ${webhook.events.length > 3 ? `<span class=\"more-events\">+${webhook.events.length - 3}</span>` : ''}\r\n            </div>\r\n            <div class=\"webhook-meta\">\r\n              Created ${formatRelativeTime(webhook.created_at)}\r\n              ${webhook.last_triggered \r\n                ? ` Last triggered ${formatRelativeTime(webhook.last_triggered)} (${webhook.last_status})` \r\n                : ' Never triggered'\r\n              }\r\n            </div>\r\n          </div>\r\n          <div class=\"webhook-actions\">\r\n            <button class=\"btn btn-sm test-webhook-btn\" data-id=\"${webhook.id}\">Test</button>\r\n            <button class=\"btn btn-sm edit-webhook-btn\" data-id=\"${webhook.id}\">Edit</button>\r\n            <button class=\"btn btn-sm btn-danger delete-webhook-btn\" data-id=\"${webhook.id}\">Delete</button>\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  container.querySelectorAll('.test-webhook-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      if (!id) return;\r\n\r\n      const button = btn as HTMLButtonElement;\r\n      button.disabled = true;\r\n      button.textContent = 'Testing...';\r\n\r\n      try {\r\n        await http.post(`/api/webhooks/${id}/test`);\r\n        toast.success('Test webhook sent');\r\n      } catch {\r\n        toast.error('Failed to send test webhook');\r\n      } finally {\r\n        button.disabled = false;\r\n        button.textContent = 'Test';\r\n      }\r\n    });\r\n  });\r\n\r\n  container.querySelectorAll('.edit-webhook-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      const webhook = webhooks.find(w => w.id === id);\r\n      if (webhook) {\r\n        showWebhookModal(panel, props, webhook);\r\n      }\r\n    });\r\n  });\r\n\r\n  container.querySelectorAll('.delete-webhook-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      if (!id || !confirm('Delete this webhook?')) return;\r\n\r\n      try {\r\n        await http.delete(`/api/webhooks/${id}`);\r\n        toast.success('Webhook deleted');\r\n        loadWebhooks(panel, props);\r\n      } catch {\r\n        toast.error('Failed to delete webhook');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show webhook modal (create/edit)\r\n */\r\nfunction showWebhookModal(panel: HTMLElement, props: WebhooksPanelProps, webhook?: Webhook): void {\r\n  const isEdit = !!webhook;\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>${isEdit ? 'Edit Webhook' : 'Create Webhook'}</h2>\r\n        <button class=\"btn-icon close-modal\"></button>\r\n      </div>\r\n      <form id=\"webhook-form\" class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label for=\"webhook-name\">Name *</label>\r\n          <input type=\"text\" id=\"webhook-name\" required value=\"${escapeHtml(webhook?.name || '')}\" placeholder=\"e.g., Slack Notifications\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"webhook-url\">URL *</label>\r\n          <input type=\"url\" id=\"webhook-url\" required value=\"${escapeHtml(webhook?.url || '')}\" placeholder=\"https://your-endpoint.com/webhook\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"webhook-secret\">Secret (Optional)</label>\r\n          <input type=\"text\" id=\"webhook-secret\" value=\"${escapeHtml(webhook?.secret || '')}\" placeholder=\"Used to sign payloads\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Events *</label>\r\n          <div class=\"events-grid\">\r\n            ${AVAILABLE_EVENTS.map(event => `\r\n              <label class=\"checkbox-label\">\r\n                <input type=\"checkbox\" name=\"events\" value=\"${event}\" ${webhook?.events.includes(event) ? 'checked' : ''}>\r\n                ${event}\r\n              </label>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label class=\"checkbox-label\">\r\n            <input type=\"checkbox\" id=\"webhook-active\" ${webhook?.active !== false ? 'checked' : ''}>\r\n            Active\r\n          </label>\r\n        </div>\r\n      </form>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary close-modal\">Cancel</button>\r\n        <button class=\"btn btn-primary\" id=\"submit-webhook-btn\">${isEdit ? 'Save' : 'Create'}</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Bind events\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n\r\n  const submitBtn = overlay.querySelector('#submit-webhook-btn');\r\n  if (submitBtn) {\r\n    on(submitBtn as HTMLElement, 'click', async () => {\r\n      const form = overlay.querySelector('#webhook-form') as HTMLFormElement;\r\n      const nameInput = form.querySelector('#webhook-name') as HTMLInputElement;\r\n      const urlInput = form.querySelector('#webhook-url') as HTMLInputElement;\r\n      const secretInput = form.querySelector('#webhook-secret') as HTMLInputElement;\r\n      const activeCheckbox = form.querySelector('#webhook-active') as HTMLInputElement;\r\n      const eventCheckboxes = form.querySelectorAll('input[name=\"events\"]:checked');\r\n\r\n      if (!nameInput.value.trim() || !urlInput.value.trim()) {\r\n        toast.error('Name and URL are required');\r\n        return;\r\n      }\r\n\r\n      const events = Array.from(eventCheckboxes).map(cb => (cb as HTMLInputElement).value);\r\n      if (events.length === 0) {\r\n        toast.error('Select at least one event');\r\n        return;\r\n      }\r\n\r\n      const data = {\r\n        name: nameInput.value.trim(),\r\n        url: urlInput.value.trim(),\r\n        secret: secretInput.value.trim() || undefined,\r\n        events,\r\n        active: activeCheckbox.checked,\r\n      };\r\n\r\n      const btn = submitBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.textContent = isEdit ? 'Saving...' : 'Creating...';\r\n\r\n      try {\r\n        if (isEdit) {\r\n          await http.put(`/api/webhooks/${webhook!.id}`, data);\r\n          toast.success('Webhook updated');\r\n        } else {\r\n          await http.post('/api/webhooks', data);\r\n          toast.success('Webhook created');\r\n        }\r\n        overlay.remove();\r\n        loadWebhooks(panel, props);\r\n      } catch {\r\n        toast.error(`Failed to ${isEdit ? 'update' : 'create'} webhook`);\r\n        btn.disabled = false;\r\n        btn.textContent = isEdit ? 'Save' : 'Create';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#webhooks-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createWebhooksPanel;\r\n","/**\r\n * Audit Panel Component\r\n * Audit logs viewer with export wizard\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface AuditPanelProps {\r\n  projectId?: string;\r\n}\r\n\r\ninterface AuditLog {\r\n  id: string;\r\n  action: string;\r\n  entity_type: string;\r\n  entity_id?: string;\r\n  user_id?: string;\r\n  user_email?: string;\r\n  user_name?: string;\r\n  ip_address?: string;\r\n  details?: Record<string, unknown>;\r\n  created_at: string;\r\n}\r\n\r\ninterface AuditFilters {\r\n  action?: string;\r\n  entity_type?: string;\r\n  user_id?: string;\r\n  from_date?: string;\r\n  to_date?: string;\r\n}\r\n\r\nlet currentFilters: AuditFilters = {};\r\nlet currentPage = 1;\r\nconst PAGE_SIZE = 50;\r\n\r\n/**\r\n * Create audit panel\r\n */\r\nexport function createAuditPanel(props: AuditPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'audit-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Audit Log</h2>\r\n        <span class=\"panel-count\" id=\"audit-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-sm\" id=\"export-audit-btn\">Export</button>\r\n        <button class=\"btn btn-sm\" id=\"filter-audit-btn\">Filter</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"audit-filters hidden\" id=\"audit-filters\">\r\n      <div class=\"filter-row\">\r\n        <select id=\"filter-action\" class=\"filter-select\">\r\n          <option value=\"\">All Actions</option>\r\n          <option value=\"create\">Create</option>\r\n          <option value=\"update\">Update</option>\r\n          <option value=\"delete\">Delete</option>\r\n          <option value=\"login\">Login</option>\r\n          <option value=\"logout\">Logout</option>\r\n          <option value=\"export\">Export</option>\r\n        </select>\r\n        <select id=\"filter-entity\" class=\"filter-select\">\r\n          <option value=\"\">All Entities</option>\r\n          <option value=\"question\">Questions</option>\r\n          <option value=\"risk\">Risks</option>\r\n          <option value=\"action\">Actions</option>\r\n          <option value=\"decision\">Decisions</option>\r\n          <option value=\"contact\">Contacts</option>\r\n          <option value=\"document\">Documents</option>\r\n          <option value=\"user\">Users</option>\r\n          <option value=\"project\">Projects</option>\r\n        </select>\r\n        <input type=\"date\" id=\"filter-from\" class=\"filter-date\" placeholder=\"From\">\r\n        <input type=\"date\" id=\"filter-to\" class=\"filter-date\" placeholder=\"To\">\r\n        <button class=\"btn btn-sm\" id=\"apply-filters-btn\">Apply</button>\r\n        <button class=\"btn btn-sm\" id=\"clear-filters-btn\">Clear</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"audit-content\">\r\n      <div class=\"loading\">Loading audit logs...</div>\r\n    </div>\r\n    <div class=\"audit-pagination\" id=\"audit-pagination\"></div>\r\n  `;\r\n\r\n  // Bind filter toggle\r\n  const filterBtn = panel.querySelector('#filter-audit-btn');\r\n  if (filterBtn) {\r\n    on(filterBtn as HTMLElement, 'click', () => {\r\n      const filters = panel.querySelector('#audit-filters');\r\n      filters?.classList.toggle('hidden');\r\n    });\r\n  }\r\n\r\n  // Bind apply filters\r\n  const applyBtn = panel.querySelector('#apply-filters-btn');\r\n  if (applyBtn) {\r\n    on(applyBtn as HTMLElement, 'click', () => {\r\n      currentFilters = {\r\n        action: (panel.querySelector('#filter-action') as HTMLSelectElement).value || undefined,\r\n        entity_type: (panel.querySelector('#filter-entity') as HTMLSelectElement).value || undefined,\r\n        from_date: (panel.querySelector('#filter-from') as HTMLInputElement).value || undefined,\r\n        to_date: (panel.querySelector('#filter-to') as HTMLInputElement).value || undefined,\r\n      };\r\n      currentPage = 1;\r\n      loadAuditLogs(panel, props);\r\n    });\r\n  }\r\n\r\n  // Bind clear filters\r\n  const clearBtn = panel.querySelector('#clear-filters-btn');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      currentFilters = {};\r\n      currentPage = 1;\r\n      (panel.querySelector('#filter-action') as HTMLSelectElement).value = '';\r\n      (panel.querySelector('#filter-entity') as HTMLSelectElement).value = '';\r\n      (panel.querySelector('#filter-from') as HTMLInputElement).value = '';\r\n      (panel.querySelector('#filter-to') as HTMLInputElement).value = '';\r\n      loadAuditLogs(panel, props);\r\n    });\r\n  }\r\n\r\n  // Bind export\r\n  const exportBtn = panel.querySelector('#export-audit-btn');\r\n  if (exportBtn) {\r\n    on(exportBtn as HTMLElement, 'click', () => showExportWizard(props));\r\n  }\r\n\r\n  // Initial load\r\n  loadAuditLogs(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load audit logs\r\n */\r\nasync function loadAuditLogs(panel: HTMLElement, props: AuditPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#audit-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const params = new URLSearchParams();\r\n    params.set('page', String(currentPage));\r\n    params.set('limit', String(PAGE_SIZE));\r\n    \r\n    if (currentFilters.action) params.set('action', currentFilters.action);\r\n    if (currentFilters.entity_type) params.set('entity_type', currentFilters.entity_type);\r\n    if (currentFilters.from_date) params.set('from_date', currentFilters.from_date);\r\n    if (currentFilters.to_date) params.set('to_date', currentFilters.to_date);\r\n\r\n    const response = await http.get<{ logs: AuditLog[]; total: number }>(`/api/audit?${params}`);\r\n    renderAuditLogs(content, response.data.logs || []);\r\n    updateCount(panel, response.data.total);\r\n    renderPagination(panel, response.data.total, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load audit logs</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render audit logs\r\n */\r\nfunction renderAuditLogs(container: HTMLElement, logs: AuditLog[]): void {\r\n  if (logs.length === 0) {\r\n    container.innerHTML = '<div class=\"empty\">No audit logs found</div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"audit-table\">\r\n      <div class=\"audit-header\">\r\n        <span class=\"audit-col time\">Time</span>\r\n        <span class=\"audit-col user\">User</span>\r\n        <span class=\"audit-col action\">Action</span>\r\n        <span class=\"audit-col entity\">Entity</span>\r\n        <span class=\"audit-col details\">Details</span>\r\n      </div>\r\n      <div class=\"audit-body\">\r\n        ${logs.map(log => `\r\n          <div class=\"audit-row\" data-id=\"${log.id}\">\r\n            <span class=\"audit-col time\" title=\"${new Date(log.created_at).toLocaleString()}\">\r\n              ${formatRelativeTime(log.created_at)}\r\n            </span>\r\n            <span class=\"audit-col user\">\r\n              ${log.user_name || log.user_email || 'System'}\r\n              ${log.ip_address ? `<span class=\"ip-address\">${log.ip_address}</span>` : ''}\r\n            </span>\r\n            <span class=\"audit-col action\">\r\n              <span class=\"action-badge ${getActionClass(log.action)}\">${log.action}</span>\r\n            </span>\r\n            <span class=\"audit-col entity\">\r\n              ${log.entity_type}${log.entity_id ? ` #${log.entity_id.slice(0, 8)}` : ''}\r\n            </span>\r\n            <span class=\"audit-col details\">\r\n              ${log.details ? `<button class=\"btn-link view-details-btn\">View</button>` : '-'}\r\n            </span>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind view details buttons\r\n  container.querySelectorAll('.view-details-btn').forEach((btn, index) => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const log = logs[index];\r\n      if (log?.details) {\r\n        showDetailsModal(log);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get action class for styling\r\n */\r\nfunction getActionClass(action: string): string {\r\n  if (action.includes('create')) return 'create';\r\n  if (action.includes('update')) return 'update';\r\n  if (action.includes('delete')) return 'delete';\r\n  if (action.includes('login')) return 'login';\r\n  if (action.includes('export')) return 'export';\r\n  return '';\r\n}\r\n\r\n/**\r\n * Render pagination\r\n */\r\nfunction renderPagination(panel: HTMLElement, total: number, props: AuditPanelProps): void {\r\n  const container = panel.querySelector('#audit-pagination') as HTMLElement;\r\n  const totalPages = Math.ceil(total / PAGE_SIZE);\r\n\r\n  if (totalPages <= 1) {\r\n    container.innerHTML = '';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <button class=\"btn btn-sm\" id=\"prev-page\" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>\r\n    <span class=\"page-info\">Page ${currentPage} of ${totalPages}</span>\r\n    <button class=\"btn btn-sm\" id=\"next-page\" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>\r\n  `;\r\n\r\n  const prevBtn = container.querySelector('#prev-page');\r\n  if (prevBtn) {\r\n    on(prevBtn as HTMLElement, 'click', () => {\r\n      if (currentPage > 1) {\r\n        currentPage--;\r\n        loadAuditLogs(panel, props);\r\n      }\r\n    });\r\n  }\r\n\r\n  const nextBtn = container.querySelector('#next-page');\r\n  if (nextBtn) {\r\n    on(nextBtn as HTMLElement, 'click', () => {\r\n      if (currentPage < totalPages) {\r\n        currentPage++;\r\n        loadAuditLogs(panel, props);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Show details modal\r\n */\r\nfunction showDetailsModal(log: AuditLog): void {\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>Audit Log Details</h2>\r\n        <button class=\"btn-icon close-modal\"></button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">ID:</span>\r\n          <span class=\"detail-value\">${log.id}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Time:</span>\r\n          <span class=\"detail-value\">${new Date(log.created_at).toLocaleString()}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Action:</span>\r\n          <span class=\"detail-value\">${log.action}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Entity:</span>\r\n          <span class=\"detail-value\">${log.entity_type} ${log.entity_id || ''}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">User:</span>\r\n          <span class=\"detail-value\">${log.user_name || log.user_email || 'System'}</span>\r\n        </div>\r\n        ${log.ip_address ? `\r\n          <div class=\"detail-row\">\r\n            <span class=\"detail-label\">IP Address:</span>\r\n            <span class=\"detail-value\">${log.ip_address}</span>\r\n          </div>\r\n        ` : ''}\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Details:</span>\r\n          <pre class=\"detail-json\">${JSON.stringify(log.details, null, 2)}</pre>\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-primary close-modal\">Close</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n}\r\n\r\n/**\r\n * Show export wizard\r\n */\r\nfunction showExportWizard(props: AuditPanelProps): void {\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>Export Audit Logs</h2>\r\n        <button class=\"btn-icon close-modal\"></button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label>Date Range</label>\r\n          <div class=\"date-range\">\r\n            <input type=\"date\" id=\"export-from\" placeholder=\"From\">\r\n            <span>to</span>\r\n            <input type=\"date\" id=\"export-to\" placeholder=\"To\">\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Format</label>\r\n          <select id=\"export-format\">\r\n            <option value=\"csv\">CSV</option>\r\n            <option value=\"json\">JSON</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Include</label>\r\n          <div class=\"checkbox-group\">\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"include\" value=\"details\" checked> Details\r\n            </label>\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"include\" value=\"ip\"> IP Addresses\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary close-modal\">Cancel</button>\r\n        <button class=\"btn btn-primary\" id=\"export-btn\">Export</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n\r\n  const exportBtn = overlay.querySelector('#export-btn');\r\n  if (exportBtn) {\r\n    on(exportBtn as HTMLElement, 'click', async () => {\r\n      const fromDate = (overlay.querySelector('#export-from') as HTMLInputElement).value;\r\n      const toDate = (overlay.querySelector('#export-to') as HTMLInputElement).value;\r\n      const format = (overlay.querySelector('#export-format') as HTMLSelectElement).value;\r\n      const includeCheckboxes = overlay.querySelectorAll('input[name=\"include\"]:checked');\r\n      const include = Array.from(includeCheckboxes).map(cb => (cb as HTMLInputElement).value);\r\n\r\n      const btn = exportBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.textContent = 'Exporting...';\r\n\r\n      try {\r\n        const params = new URLSearchParams();\r\n        params.set('format', format);\r\n        if (fromDate) params.set('from_date', fromDate);\r\n        if (toDate) params.set('to_date', toDate);\r\n        include.forEach(i => params.append('include', i));\r\n\r\n        const response = await fetch(`/api/audit/export?${params}`);\r\n        if (!response.ok) throw new Error('Export failed');\r\n\r\n        const blob = await response.blob();\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = `audit-logs-${new Date().toISOString().split('T')[0]}.${format}`;\r\n        a.click();\r\n        URL.revokeObjectURL(url);\r\n\r\n        toast.success('Audit logs exported');\r\n        overlay.remove();\r\n      } catch {\r\n        toast.error('Failed to export audit logs');\r\n        btn.disabled = false;\r\n        btn.textContent = 'Export';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#audit-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\nexport default createAuditPanel;\r\n","/**\r\n * Roles Panel - SOTA Design\r\n * Manage role templates with AI-enhanced context\r\n * Note: User permissions are managed separately per member in MembersPanel\r\n */\r\n\r\nimport { on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\n\r\ninterface Role {\r\n  id: string;\r\n  name: string;\r\n  display_name?: string;\r\n  description?: string;\r\n  role_context?: string;\r\n  color?: string;\r\n  category?: string;\r\n  is_template?: boolean;\r\n  is_system?: boolean;\r\n  created_at?: string;\r\n}\r\n\r\nconst ROLE_CATEGORIES = [\r\n  { id: 'project', name: 'Project', icon: '', examples: 'Project Manager, Scrum Master, Product Owner' },\r\n  { id: 'technical', name: 'Technical', icon: '', examples: 'Developer, Architect, DevOps, QA' },\r\n  { id: 'management', name: 'Management', icon: '', examples: 'Director, VP, C-Level' },\r\n  { id: 'stakeholder', name: 'Stakeholder', icon: '', examples: 'Client, Sponsor, External Partner' },\r\n  { id: 'custom', name: 'Custom', icon: '', examples: 'Custom roles for your team' },\r\n];\r\n\r\nlet currentRoles: Role[] = [];\r\nlet editingRole: Role | null = null;\r\n\r\n/**\r\n * Render Roles Panel\r\n */\r\nexport async function renderRolesPanel(container: HTMLElement): Promise<void> {\r\n  container.innerHTML = `\r\n    <style>\r\n      .roles-panel-sota {\r\n        padding: 24px;\r\n        max-width: 1200px;\r\n        margin: 0 auto;\r\n      }\r\n      \r\n      .roles-header {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        margin-bottom: 24px;\r\n      }\r\n      \r\n      .roles-header h2 {\r\n        margin: 0;\r\n        font-size: 24px;\r\n        font-weight: 700;\r\n        color: var(--text-primary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .roles-header h2 svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .roles-header-subtitle {\r\n        font-size: 14px;\r\n        color: var(--text-secondary);\r\n        margin-top: 4px;\r\n        font-weight: 400;\r\n      }\r\n      \r\n      .btn-create-role {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 12px 24px;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        border: none;\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-create-role:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n      \r\n      .roles-layout {\r\n        display: grid;\r\n        grid-template-columns: 320px 1fr;\r\n        gap: 24px;\r\n      }\r\n      \r\n      @media (max-width: 900px) {\r\n        .roles-layout {\r\n          grid-template-columns: 1fr;\r\n        }\r\n      }\r\n      \r\n      .roles-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .role-card {\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 16px;\r\n        padding: 16px;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        position: relative;\r\n      }\r\n      \r\n      .role-card:hover {\r\n        border-color: #e11d48;\r\n        transform: translateX(4px);\r\n      }\r\n      \r\n      .role-card.active {\r\n        border-color: #e11d48;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.03) 100%);\r\n      }\r\n      \r\n      .role-card-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .role-color-dot {\r\n        width: 12px;\r\n        height: 12px;\r\n        border-radius: 50%;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .role-card-name {\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        flex: 1;\r\n      }\r\n      \r\n      .role-card-badges {\r\n        display: flex;\r\n        gap: 4px;\r\n      }\r\n      \r\n      .role-badge {\r\n        font-size: 10px;\r\n        padding: 2px 6px;\r\n        border-radius: 4px;\r\n        font-weight: 500;\r\n      }\r\n      \r\n      .role-badge.template {\r\n        background: #dbeafe;\r\n        color: #1d4ed8;\r\n      }\r\n      \r\n      .role-badge.system {\r\n        background: #fef3c7;\r\n        color: #92400e;\r\n      }\r\n      \r\n      .role-card-category {\r\n        font-size: 11px;\r\n        color: var(--text-muted);\r\n        margin-bottom: 4px;\r\n      }\r\n      \r\n      .role-card-desc {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        line-height: 1.5;\r\n        display: -webkit-box;\r\n        -webkit-line-clamp: 2;\r\n        -webkit-box-orient: vertical;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      /* Editor Panel */\r\n      .role-editor {\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 20px;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .role-editor-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        padding: 24px;\r\n        color: white;\r\n      }\r\n      \r\n      .role-editor-header h3 {\r\n        margin: 0;\r\n        font-size: 20px;\r\n        font-weight: 700;\r\n      }\r\n      \r\n      .role-editor-body {\r\n        padding: 24px;\r\n      }\r\n      \r\n      .form-row {\r\n        display: flex;\r\n        gap: 16px;\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .form-group {\r\n        flex: 1;\r\n      }\r\n      \r\n      .form-group label {\r\n        display: block;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .form-group input,\r\n      .form-group textarea,\r\n      .form-group select {\r\n        width: 100%;\r\n        padding: 12px 16px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        transition: all 0.2s;\r\n        box-sizing: border-box;\r\n      }\r\n      \r\n      .form-group input:focus,\r\n      .form-group textarea:focus,\r\n      .form-group select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\r\n      }\r\n      \r\n      .form-group textarea {\r\n        resize: vertical;\r\n        min-height: 80px;\r\n      }\r\n      \r\n      .form-hint {\r\n        font-size: 12px;\r\n        color: var(--text-muted);\r\n        margin-top: 6px;\r\n      }\r\n      \r\n      .ai-enhance-section {\r\n        display: flex;\r\n        gap: 12px;\r\n        align-items: flex-start;\r\n        margin-top: 12px;\r\n      }\r\n      \r\n      .ai-enhance-btn {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        padding: 10px 16px;\r\n        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\r\n        color: white;\r\n        border: none;\r\n        border-radius: 10px;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        white-space: nowrap;\r\n      }\r\n      \r\n      .ai-enhance-btn:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\r\n      }\r\n      \r\n      .ai-enhance-btn:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n        transform: none;\r\n      }\r\n      \r\n      .ai-enhance-btn svg {\r\n        width: 14px;\r\n        height: 14px;\r\n      }\r\n      \r\n      @keyframes spin {\r\n        from { transform: rotate(0deg); }\r\n        to { transform: rotate(360deg); }\r\n      }\r\n      \r\n      .spin {\r\n        animation: spin 1s linear infinite;\r\n      }\r\n      \r\n      /* Actions */\r\n      .role-editor-actions {\r\n        display: flex;\r\n        gap: 12px;\r\n        justify-content: flex-end;\r\n        margin-top: 24px;\r\n        padding-top: 24px;\r\n        border-top: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .btn {\r\n        padding: 12px 24px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n      \r\n      .btn-secondary {\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .btn-secondary:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .btn-primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-primary:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n      \r\n      .btn-danger {\r\n        background: #fee2e2;\r\n        color: #dc2626;\r\n      }\r\n      \r\n      .btn-danger:hover {\r\n        background: #fecaca;\r\n      }\r\n      \r\n      .template-toggle {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        margin-top: 20px;\r\n        padding: 14px 16px;\r\n        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);\r\n        border: 1px solid #86efac;\r\n        border-radius: 12px;\r\n      }\r\n      \r\n      .template-toggle label {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: #166534;\r\n        font-weight: 500;\r\n      }\r\n      \r\n      .template-toggle input {\r\n        accent-color: #16a34a;\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n      \r\n      .empty-state {\r\n        text-align: center;\r\n        padding: 48px;\r\n        color: var(--text-muted);\r\n      }\r\n      \r\n      .empty-state svg {\r\n        width: 64px;\r\n        height: 64px;\r\n        opacity: 0.3;\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      .info-card {\r\n        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);\r\n        border: 1px solid #93c5fd;\r\n        border-radius: 12px;\r\n        padding: 16px;\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .info-card h4 {\r\n        margin: 0 0 8px;\r\n        font-size: 14px;\r\n        color: #1e40af;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n      \r\n      .info-card p {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: #3b82f6;\r\n        line-height: 1.5;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"roles-panel-sota\">\r\n      <div class=\"roles-header\">\r\n        <div>\r\n          <h2>\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\"/>\r\n            </svg>\r\n            Role Templates\r\n          </h2>\r\n          <div class=\"roles-header-subtitle\">Define roles to assign to team members and contacts. The AI uses role context to adapt responses.</div>\r\n        </div>\r\n        <button class=\"btn-create-role\" id=\"btn-create-role\">\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Create Role\r\n        </button>\r\n      </div>\r\n      \r\n      <div class=\"roles-layout\">\r\n        <div class=\"roles-list\" id=\"roles-list\">\r\n          <div class=\"empty-state\">Loading roles...</div>\r\n        </div>\r\n        \r\n        <div class=\"role-editor\" id=\"role-editor\" style=\"display: none;\">\r\n          <!-- Editor content will be rendered here -->\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Load roles\r\n  await loadRoles(container);\r\n\r\n  // Bind create button\r\n  const createBtn = container.querySelector('#btn-create-role');\r\n  if (createBtn) {\r\n    on(createBtn as HTMLElement, 'click', () => {\r\n      editingRole = null;\r\n      showRoleEditor(container, null);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Load roles from API\r\n */\r\nasync function loadRoles(container: HTMLElement): Promise<void> {\r\n  const listEl = container.querySelector('#roles-list') as HTMLElement;\r\n  if (!listEl) return;\r\n\r\n  try {\r\n    // Load role templates\r\n    const response = await http.get<{ roles: Role[] }>('/api/role-templates');\r\n    currentRoles = response.data.roles || [];\r\n\r\n    if (currentRoles.length === 0) {\r\n      listEl.innerHTML = `\r\n        <div class=\"empty-state\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197\"/>\r\n          </svg>\r\n          <p>No roles defined yet</p>\r\n          <p style=\"font-size: 13px; opacity: 0.7;\">Click \"Create Role\" to get started</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    renderRolesList(listEl, container);\r\n  } catch (error) {\r\n    console.error('[RolesPanel] Failed to load roles:', error);\r\n    listEl.innerHTML = `<div class=\"empty-state\">Failed to load roles</div>`;\r\n  }\r\n}\r\n\r\n/**\r\n * Render roles list\r\n */\r\nfunction renderRolesList(listEl: HTMLElement, container: HTMLElement): void {\r\n  const categoryMap = Object.fromEntries(ROLE_CATEGORIES.map(c => [c.id, c]));\r\n  \r\n  listEl.innerHTML = currentRoles.map(role => {\r\n    const cat = categoryMap[role.category || 'custom'];\r\n    return `\r\n      <div class=\"role-card${editingRole?.id === role.id ? ' active' : ''}\" data-id=\"${role.id}\">\r\n        <div class=\"role-card-header\">\r\n          <div class=\"role-color-dot\" style=\"background: ${role.color || '#e11d48'}\"></div>\r\n          <div class=\"role-card-name\">${escapeHtml(role.display_name || role.name)}</div>\r\n          <div class=\"role-card-badges\">\r\n            ${role.is_template ? '<span class=\"role-badge template\">Template</span>' : ''}\r\n            ${role.is_system ? '<span class=\"role-badge system\">System</span>' : ''}\r\n          </div>\r\n        </div>\r\n        <div class=\"role-card-category\">${cat?.icon || ''} ${cat?.name || 'Custom'}</div>\r\n        ${role.description ? `<div class=\"role-card-desc\">${escapeHtml(role.description)}</div>` : ''}\r\n      </div>\r\n    `;\r\n  }).join('');\r\n\r\n  // Bind click events\r\n  listEl.querySelectorAll('.role-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const roleId = card.getAttribute('data-id');\r\n      const role = currentRoles.find(r => r.id === roleId);\r\n      if (role) {\r\n        editingRole = role;\r\n        listEl.querySelectorAll('.role-card').forEach(c => c.classList.remove('active'));\r\n        card.classList.add('active');\r\n        showRoleEditor(container, role);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show role editor\r\n */\r\nfunction showRoleEditor(container: HTMLElement, role: Role | null): void {\r\n  const editorEl = container.querySelector('#role-editor') as HTMLElement;\r\n  if (!editorEl) return;\r\n\r\n  editorEl.style.display = 'block';\r\n\r\n  const isNew = !role;\r\n\r\n  editorEl.innerHTML = `\r\n    <div class=\"role-editor-header\">\r\n      <h3>${isNew ? 'Create New Role' : 'Edit Role'}</h3>\r\n    </div>\r\n    \r\n    <div class=\"role-editor-body\">\r\n      <div class=\"info-card\">\r\n        <h4> How Role Templates Work</h4>\r\n        <p>Role templates define job titles and context that helps the AI understand each person's perspective. When you assign a role to a team member or contact, the AI adapts its responses to be more relevant to their responsibilities.</p>\r\n      </div>\r\n      \r\n      <form id=\"role-form\">\r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\" style=\"flex: 2\">\r\n            <label>Role Name *</label>\r\n            <input type=\"text\" id=\"role-name\" required value=\"${escapeHtml(role?.display_name || role?.name || '')}\" placeholder=\"e.g., Project Manager, Senior Developer\">\r\n          </div>\r\n          <div class=\"form-group\" style=\"flex: 1\">\r\n            <label>Category</label>\r\n            <select id=\"role-category\">\r\n              ${ROLE_CATEGORIES.map(cat => `\r\n                <option value=\"${cat.id}\" ${role?.category === cat.id ? 'selected' : ''}>${cat.icon} ${cat.name}</option>\r\n              `).join('')}\r\n            </select>\r\n          </div>\r\n          <div class=\"form-group\" style=\"width: 80px\">\r\n            <label>Color</label>\r\n            <input type=\"color\" id=\"role-color\" value=\"${role?.color || '#e11d48'}\" style=\"height: 42px; padding: 4px;\">\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Description</label>\r\n          <textarea id=\"role-description\" rows=\"2\" placeholder=\"Brief description of this role's main responsibilities...\">${escapeHtml(role?.description || '')}</textarea>\r\n          <div class=\"form-hint\">A short summary shown in role lists and dropdowns.</div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Role Context (for AI)</label>\r\n          <textarea id=\"role-context\" rows=\"6\" placeholder=\"Describe this role in detail for the AI:&#10;&#10; What are their main responsibilities?&#10; What decisions do they typically make?&#10; What information is most relevant to them?&#10; How should the AI adapt its tone and detail level?\">${escapeHtml(role?.role_context || '')}</textarea>\r\n          <div class=\"form-hint\">This context helps the AI provide more relevant and targeted responses when interacting with people in this role.</div>\r\n          <div class=\"ai-enhance-section\">\r\n            <button type=\"button\" class=\"ai-enhance-btn\" id=\"btn-ai-enhance\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n              </svg>\r\n              Enhance with AI\r\n            </button>\r\n            <span class=\"form-hint\" style=\"margin: 0; padding-top: 10px;\">Let AI generate or improve the role context based on the role name.</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"template-toggle\">\r\n          <input type=\"checkbox\" id=\"is-template\" ${role?.is_template !== false ? 'checked' : ''}>\r\n          <label for=\"is-template\">Save as template (reusable across all projects)</label>\r\n        </div>\r\n        \r\n        <div class=\"role-editor-actions\">\r\n          ${!isNew && !role?.is_system ? `\r\n            <button type=\"button\" class=\"btn btn-danger\" id=\"btn-delete-role\">Delete</button>\r\n          ` : ''}\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"btn-cancel\">Cancel</button>\r\n          <button type=\"submit\" class=\"btn btn-primary\">${isNew ? 'Create Role' : 'Save Changes'}</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  `;\r\n\r\n  bindEditorEvents(container, role);\r\n}\r\n\r\n/**\r\n * Bind editor events\r\n */\r\nfunction bindEditorEvents(container: HTMLElement, role: Role | null): void {\r\n  const editorEl = container.querySelector('#role-editor') as HTMLElement;\r\n  if (!editorEl) return;\r\n\r\n  // Cancel button\r\n  const cancelBtn = editorEl.querySelector('#btn-cancel');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => {\r\n      editorEl.style.display = 'none';\r\n      editingRole = null;\r\n      const listEl = container.querySelector('#roles-list') as HTMLElement;\r\n      if (listEl) {\r\n        listEl.querySelectorAll('.role-card').forEach(c => c.classList.remove('active'));\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete button\r\n  const deleteBtn = editorEl.querySelector('#btn-delete-role');\r\n  if (deleteBtn && role) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm(`Are you sure you want to delete \"${role.display_name || role.name}\"?`)) return;\r\n\r\n      try {\r\n        await http.delete(`/api/role-templates/${role.id}`);\r\n        toast.success('Role deleted');\r\n        editorEl.style.display = 'none';\r\n        editingRole = null;\r\n        await loadRoles(container);\r\n      } catch {\r\n        toast.error('Failed to delete role');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI Enhance button\r\n  const aiBtn = editorEl.querySelector('#btn-ai-enhance');\r\n  if (aiBtn) {\r\n    on(aiBtn as HTMLElement, 'click', async () => {\r\n      const nameInput = editorEl.querySelector('#role-name') as HTMLInputElement;\r\n      const contextInput = editorEl.querySelector('#role-context') as HTMLTextAreaElement;\r\n      const descInput = editorEl.querySelector('#role-description') as HTMLTextAreaElement;\r\n\r\n      const roleName = nameInput.value.trim();\r\n      if (!roleName) {\r\n        toast.error('Please enter a role name first');\r\n        return;\r\n      }\r\n\r\n      (aiBtn as HTMLButtonElement).disabled = true;\r\n      aiBtn.innerHTML = `<svg class=\"spin\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/></svg> Enhancing...`;\r\n\r\n      try {\r\n        const response = await http.post<{ prompt: string; description?: string }>('/api/roles/generate', {\r\n          title: roleName,\r\n          currentContext: contextInput.value,\r\n        });\r\n\r\n        if (response.data.prompt) {\r\n          contextInput.value = response.data.prompt;\r\n        }\r\n        if (response.data.description && !descInput.value) {\r\n          descInput.value = response.data.description;\r\n        }\r\n        toast.success('Role context enhanced with AI');\r\n      } catch {\r\n        toast.error('Failed to enhance with AI');\r\n      } finally {\r\n        (aiBtn as HTMLButtonElement).disabled = false;\r\n        aiBtn.innerHTML = `<svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> Enhance with AI`;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Form submit\r\n  const form = editorEl.querySelector('#role-form') as HTMLFormElement;\r\n  if (form) {\r\n    on(form, 'submit', async (e) => {\r\n      e.preventDefault();\r\n\r\n      const name = (editorEl.querySelector('#role-name') as HTMLInputElement).value.trim();\r\n      const category = (editorEl.querySelector('#role-category') as HTMLSelectElement).value;\r\n      const color = (editorEl.querySelector('#role-color') as HTMLInputElement).value;\r\n      const description = (editorEl.querySelector('#role-description') as HTMLTextAreaElement).value.trim();\r\n      const roleContext = (editorEl.querySelector('#role-context') as HTMLTextAreaElement).value.trim();\r\n      const isTemplate = (editorEl.querySelector('#is-template') as HTMLInputElement).checked;\r\n\r\n      const roleData = {\r\n        name: name.toLowerCase().replace(/\\s+/g, '_'),\r\n        display_name: name,\r\n        description,\r\n        role_context: roleContext,\r\n        category,\r\n        color,\r\n        is_template: isTemplate,\r\n      };\r\n\r\n      try {\r\n        if (role) {\r\n          await http.put(`/api/role-templates/${role.id}`, roleData);\r\n          toast.success('Role updated');\r\n        } else {\r\n          await http.post('/api/role-templates', roleData);\r\n          toast.success('Role created');\r\n        }\r\n\r\n        editorEl.style.display = 'none';\r\n        editingRole = null;\r\n        await loadRoles(container);\r\n      } catch {\r\n        toast.error('Failed to save role');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default renderRolesPanel;\r\n","/**\r\n * AdminPanel Component\r\n * Platform administration for superadmin users\r\n * Includes: LLM Config, Graph, Prompts, Processing, Audit Log\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { appStore } from '../stores/app';\r\n\r\n// Types\r\ninterface SystemConfig {\r\n  id?: string;\r\n  key: string;\r\n  value: unknown;\r\n  category: string;\r\n  description?: string;\r\n}\r\n\r\ninterface LLMProvider {\r\n  id: string;\r\n  name: string;\r\n  enabled: boolean;\r\n  models: string[];\r\n  status?: 'healthy' | 'degraded' | 'offline';\r\n}\r\n\r\ninterface AuditLogEntry {\r\n  id: string;\r\n  table_name: string;\r\n  operation: string;\r\n  old_values?: Record<string, unknown>;\r\n  new_values?: Record<string, unknown>;\r\n  changed_by_email?: string;\r\n  changed_at: string;\r\n}\r\n\r\ninterface SystemPrompt {\r\n  id: string;\r\n  key: string;\r\n  name: string;\r\n  description: string;\r\n  category: string;\r\n  prompt_template: string;\r\n  uses_ontology: boolean;\r\n}\r\n\r\n// Ontology state (for Admin Ontology tab)\r\ninterface OntologyEntityType {\r\n  name: string;\r\n  properties?: string[];\r\n  searchable?: string[];\r\n  required?: string[];\r\n  sharedEntity?: boolean;\r\n}\r\ninterface OntologyRelationType {\r\n  name: string;\r\n  sourceType?: string;\r\n  targetType?: string;\r\n}\r\nlet ontologyEntities: OntologyEntityType[] = [];\r\nlet ontologyRelations: OntologyRelationType[] = [];\r\nlet ontologyLoaded = false;\r\nlet ontologyLoading = false;\r\n\r\n// Graph overview state (for Graph section)\r\ninterface GraphListItem {\r\n  graphName: string;\r\n  projectId?: string | null;\r\n  projectName?: string | null;\r\n}\r\nlet graphList: GraphListItem[] = [];\r\nlet graphStatus: { enabled?: boolean; graphName?: string; stats?: { nodes?: number; relationships?: number } } | null = null;\r\nlet graphOverviewLoaded = false;\r\nlet graphOverviewLoading = false;\r\nlet graphPasswordSet = false; // Track if GRAPH_PASSWORD secret exists\r\n\r\n// State\r\nlet currentSection = 'llm';\r\nlet systemConfig: Record<string, SystemConfig[]> = {};\r\nlet providers: LLMProvider[] = [];\r\nlet auditLogs: AuditLogEntry[] = [];\r\nlet systemPrompts: SystemPrompt[] = [];\r\nlet isLoading = false;\r\n\r\n// Team Analysis settings state (per-project, loaded on demand)\r\ninterface TeamAnalysisSettings {\r\n  enabled: boolean;\r\n  access: 'admin_only' | 'all';\r\n}\r\nlet teamAnalysisSettings: TeamAnalysisSettings = { enabled: true, access: 'admin_only' };\r\nlet teamAnalysisLoaded = false;\r\nlet teamAnalysisLoading = false;\r\n\r\n/**\r\n * Load system configuration\r\n */\r\nasync function loadSystemConfig(): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ \r\n      llm_pertask?: { text?: { provider: string; model: string }; vision?: { provider: string; model: string }; embeddings?: { provider: string; model: string } };\r\n      prompts?: Record<string, unknown>;\r\n      processing?: Record<string, unknown>;\r\n      graph?: Record<string, unknown>;\r\n    }>('/api/system/config');\r\n    \r\n    // Convert to internal format grouped by category\r\n    systemConfig = {};\r\n    \r\n    // LLM per-task configs\r\n    if (response.data?.llm_pertask) {\r\n      systemConfig['llm'] = [];\r\n      const perTask = response.data.llm_pertask;\r\n      if (perTask.text) {\r\n        systemConfig['llm'].push({ key: 'text_provider', value: perTask.text, category: 'llm' });\r\n      }\r\n      if (perTask.vision) {\r\n        systemConfig['llm'].push({ key: 'vision_provider', value: perTask.vision, category: 'llm' });\r\n      }\r\n      if (perTask.embeddings) {\r\n        systemConfig['llm'].push({ key: 'embeddings_provider', value: perTask.embeddings, category: 'llm' });\r\n      }\r\n    }\r\n    \r\n    // Processing config\r\n    if (response.data?.processing) {\r\n      systemConfig['processing'] = [{ key: 'processing', value: response.data.processing, category: 'processing' }];\r\n    }\r\n    \r\n    // Graph config\r\n    if (response.data?.graph) {\r\n      systemConfig['graph'] = [{ key: 'graph', value: response.data.graph, category: 'graph' }];\r\n    }\r\n    \r\n    console.log('[AdminPanel] Loaded system config:', systemConfig);\r\n  } catch (error) {\r\n    console.warn('Failed to load system config:', error);\r\n    systemConfig = {};\r\n  }\r\n}\r\n\r\n/**\r\n * Load secrets to check if graph password is set\r\n */\r\nasync function loadSecrets(): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ secrets: Array<{ name: string; masked_value?: string }> }>('/api/secrets');\r\n    const secrets = response.data?.secrets || [];\r\n    graphPasswordSet = secrets.some(s => s.name === 'GRAPH_PASSWORD');\r\n    console.log('[AdminPanel] Graph password set:', graphPasswordSet);\r\n  } catch (error) {\r\n    console.warn('Failed to load secrets:', error);\r\n    graphPasswordSet = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Load LLM providers status\r\n */\r\nasync function loadProviders(): Promise<void> {\r\n  // Default providers - all supported LLM providers\r\n  const defaultProviders: LLMProvider[] = [\r\n    { id: 'openai', name: 'OpenAI', enabled: false, models: ['gpt-4o', 'gpt-4-turbo', 'gpt-4', 'gpt-3.5-turbo'] },\r\n    { id: 'anthropic', name: 'Anthropic (Claude)', enabled: false, models: ['claude-3-opus', 'claude-3-sonnet', 'claude-3-haiku'] },\r\n    { id: 'google', name: 'Google AI (Gemini)', enabled: false, models: ['gemini-2.0-flash', 'gemini-pro', 'gemini-pro-vision'] },\r\n    { id: 'xai', name: 'xAI (Grok)', enabled: false, models: ['grok-2', 'grok-beta'] },\r\n    { id: 'deepseek', name: 'DeepSeek', enabled: false, models: ['deepseek-chat', 'deepseek-coder'] },\r\n    { id: 'kimi', name: 'Kimi (Moonshot)', enabled: false, models: ['moonshot-v1-8k', 'moonshot-v1-32k'] },\r\n    { id: 'minimax', name: 'MiniMax', enabled: false, models: ['abab5.5-chat', 'abab6-chat'] },\r\n    { id: 'ollama', name: 'Ollama (Local)', enabled: true, models: ['llama2', 'mistral', 'codellama', 'qwen2.5'] },\r\n  ];\r\n  \r\n  try {\r\n    const response = await http.get<{ providers: LLMProvider[] }>('/api/llm/providers');\r\n    const apiProviders = response.data?.providers;\r\n    providers = Array.isArray(apiProviders) && apiProviders.length > 0 ? apiProviders : defaultProviders;\r\n  } catch (error) {\r\n    console.warn('Failed to load providers, using defaults:', error);\r\n    providers = defaultProviders;\r\n  }\r\n}\r\n\r\n/**\r\n * Load audit logs\r\n */\r\nasync function loadAuditLogs(): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ logs: AuditLogEntry[] }>('/api/system/audit?limit=50');\r\n    auditLogs = Array.isArray(response.data?.logs) ? response.data.logs : [];\r\n  } catch (error) {\r\n    console.warn('Failed to load audit logs:', error);\r\n    auditLogs = [];\r\n  }\r\n}\r\n\r\n/**\r\n * Load system prompts\r\n */\r\nasync function loadSystemPrompts(): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ prompts: SystemPrompt[] }>('/api/system/prompts');\r\n    systemPrompts = Array.isArray(response.data?.prompts) ? response.data.prompts : [];\r\n  } catch (error) {\r\n    console.warn('Failed to load system prompts:', error);\r\n    // Use default prompts structure\r\n    systemPrompts = [\r\n      { id: '1', key: 'document', name: 'Document Extraction', description: 'Extract information from PDFs and text files', category: 'extraction', prompt_template: '', uses_ontology: true },\r\n      { id: '2', key: 'transcript', name: 'Transcript Extraction', description: 'Extract information from meeting transcripts', category: 'extraction', prompt_template: '', uses_ontology: true },\r\n      { id: '3', key: 'vision', name: 'Vision/Image Extraction', description: 'Extract information from images and diagrams', category: 'extraction', prompt_template: '', uses_ontology: true },\r\n      { id: '4', key: 'conversation', name: 'Conversation Extraction', description: 'Extract information from chat conversations', category: 'extraction', prompt_template: '', uses_ontology: true },\r\n      { id: '5', key: 'email', name: 'Email Extraction', description: 'Extract information from emails', category: 'extraction', prompt_template: '', uses_ontology: true },\r\n      { id: '6', key: 'summary', name: 'Content Summary', description: 'Generate concise summaries', category: 'analysis', prompt_template: '', uses_ontology: false },\r\n    ];\r\n  }\r\n}\r\n\r\n/**\r\n * Load ontology data (entities and relations) for Admin Ontology tab\r\n */\r\nasync function loadOntologyData(): Promise<void> {\r\n  ontologyLoading = true;\r\n  try {\r\n    const [entitiesRes, relationsRes] = await Promise.all([\r\n      http.get<{ ok: boolean; entityTypes?: OntologyEntityType[] }>('/api/ontology/entities'),\r\n      http.get<{ ok: boolean; relationTypes?: OntologyRelationType[] }>('/api/ontology/relations'),\r\n    ]);\r\n    ontologyEntities = entitiesRes.data?.entityTypes ?? [];\r\n    ontologyRelations = relationsRes.data?.relationTypes ?? [];\r\n    ontologyLoaded = true;\r\n  } catch (error) {\r\n    console.warn('Failed to load ontology:', error);\r\n    ontologyEntities = [];\r\n    ontologyRelations = [];\r\n  } finally {\r\n    ontologyLoading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Load graph overview (list + status) for Graph section\r\n */\r\nasync function loadGraphOverview(): Promise<void> {\r\n  graphOverviewLoading = true;\r\n  try {\r\n    const [listRes, statusRes] = await Promise.all([\r\n      http.get<{ ok: boolean; graphs?: GraphListItem[]; error?: string }>('/api/graph/list'),\r\n      http.get<{ enabled?: boolean; graphName?: string; stats?: { nodes?: number; relationships?: number } }>('/api/graph/status').catch(() => ({ data: {} })),\r\n    ]);\r\n    graphList = listRes.data?.graphs ?? [];\r\n    if (listRes.data?.error) {\r\n      graphList = [];\r\n    }\r\n    graphStatus = statusRes.data ?? null;\r\n    graphOverviewLoaded = true;\r\n  } catch (error) {\r\n    console.warn('Failed to load graph overview:', error);\r\n    graphList = [];\r\n    graphStatus = null;\r\n  } finally {\r\n    graphOverviewLoading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Save a config value\r\n */\r\nasync function saveConfig(key: string, value: unknown, category: string): Promise<void> {\r\n  try {\r\n    await http.post('/api/system/config', { key, value, category });\r\n    toast.success('Configuration saved');\r\n    await loadSystemConfig();\r\n  } catch (error) {\r\n    toast.error('Failed to save configuration');\r\n  }\r\n}\r\n\r\n/**\r\n * Test provider connection\r\n */\r\nasync function testProvider(providerId: string): Promise<void> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; error?: { message: string }; models?: number }>(`/api/llm/test/${providerId}`);\r\n    if (response.data.ok) {\r\n      const models = response.data.models ? ` (${response.data.models} models)` : '';\r\n      toast.success(`${providerId} connection successful${models}`);\r\n    } else {\r\n      toast.error(response.data.error?.message || 'Connection failed');\r\n    }\r\n  } catch (error) {\r\n    toast.error('Connection test failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Get config value by key\r\n */\r\nfunction getConfigValue(category: string, key: string, defaultValue: unknown = ''): unknown {\r\n  const configs = systemConfig[category] || [];\r\n  \r\n  // For graph category, the config is stored as { key: 'graph', value: { enabled, graphName, provider } }\r\n  if (category === 'graph') {\r\n    const graphConfigEntry = configs.find(c => c.key === 'graph');\r\n    if (graphConfigEntry?.value && typeof graphConfigEntry.value === 'object') {\r\n      const graphValue = graphConfigEntry.value as Record<string, unknown>;\r\n      return graphValue[key] ?? defaultValue;\r\n    }\r\n  }\r\n  \r\n  const config = configs.find(c => c.key === key);\r\n  return config?.value ?? defaultValue;\r\n}\r\n\r\n/**\r\n * Render section navigation\r\n */\r\nfunction renderNav(): string {\r\n  const sections = [\r\n    { id: 'llm', label: 'LLM Providers', icon: 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z' },\r\n    { id: 'models', label: 'Model Metadata', icon: 'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10' },\r\n    { id: 'queue', label: 'LLM Queue', icon: 'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15' },\r\n    { id: 'graph', label: 'Graph', icon: 'M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4' },\r\n    { id: 'ontology', label: 'Ontology', icon: 'M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z' },\r\n    { id: 'prompts', label: 'Prompts', icon: 'M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z' },\r\n    { id: 'processing', label: 'Processing', icon: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z' },\r\n    { id: 'team-analysis', label: 'Team Analysis', icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' },\r\n    { id: 'audit', label: 'Audit Log', icon: 'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01' },\r\n  ];\r\n\r\n  return sections.map(s => `\r\n    <button class=\"admin-nav-btn ${currentSection === s.id ? 'active' : ''}\" data-section=\"${s.id}\">\r\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"20\" height=\"20\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"${s.icon}\"/>\r\n      </svg>\r\n      <span>${s.label}</span>\r\n    </button>\r\n  `).join('');\r\n}\r\n\r\n/**\r\n * Render LLM Providers section\r\n */\r\nfunction renderLLMSection(): string {\r\n  const taskTypes = ['text', 'vision', 'embeddings'];\r\n  \r\n  return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>LLM Provider Configuration</h3>\r\n        <p>Configure AI providers for different task types</p>\r\n      </div>\r\n\r\n      <!-- Provider Status -->\r\n      <div class=\"admin-card\">\r\n        <h4>Provider Health</h4>\r\n        <div class=\"provider-grid\">\r\n          ${providers.map(p => `\r\n            <div class=\"provider-card ${p.enabled ? 'enabled' : 'disabled'}\">\r\n              <div class=\"provider-header\">\r\n                <span class=\"provider-name\">${p.name}</span>\r\n                <span class=\"provider-status ${p.status || 'unknown'}\">${p.status || 'unknown'}</span>\r\n              </div>\r\n              <div class=\"provider-models\">${p.models.slice(0, 3).join(', ')}</div>\r\n              <div class=\"provider-actions\">\r\n                <button class=\"btn-sm\" data-test-provider=\"${p.id}\">Test</button>\r\n                <label class=\"toggle-switch\">\r\n                  <input type=\"checkbox\" ${p.enabled ? 'checked' : ''} data-toggle-provider=\"${p.id}\">\r\n                  <span class=\"slider\"></span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Task Configuration -->\r\n      <div class=\"admin-card\">\r\n        <h4>Task-Specific AI Configuration</h4>\r\n        <p class=\"text-muted\">Configure which provider and model to use for each AI task. These settings apply globally to the platform and are persisted in Supabase.</p>\r\n        \r\n        ${taskTypes.map(task => {\r\n          const taskConfig = getConfigValue('llm', task + '_provider', { provider: '', model: '' }) as { provider: string; model: string };\r\n          const icons: Record<string, string> = { text: '', vision: '', embeddings: '' };\r\n          const labels: Record<string, string> = { text: 'Text / Chat', vision: 'Vision / Images', embeddings: 'Embeddings' };\r\n          const descs: Record<string, string> = { \r\n            text: 'Document analysis, chat, briefings, Q&A, extraction',\r\n            vision: 'Image analysis, scanned documents, diagrams, charts',\r\n            embeddings: 'Semantic search, similarity matching, RAG'\r\n          };\r\n          const icon = icons[task] || '';\r\n          const label = labels[task] || task;\r\n          const desc = descs[task] || '';\r\n          const providerOpts = ['openai', 'anthropic', 'google', 'deepseek', 'grok', 'kimi', 'minimax', 'ollama'];\r\n          const providerNames: Record<string, string> = {\r\n            openai: 'OpenAI', anthropic: 'Anthropic (Claude)', google: 'Google AI (Gemini)',\r\n            deepseek: 'DeepSeek', grok: 'xAI (Grok)', kimi: 'Kimi (Moonshot)', \r\n            minimax: 'MiniMax', ollama: 'Ollama (Local)'\r\n          };\r\n          \r\n          return '<div class=\"task-config-row\" style=\"margin-bottom: 20px; padding: 16px; background: var(--bg-secondary); border-radius: 12px;\" data-task-row=\"' + task + '\">' +\r\n            '<div class=\"task-label\" style=\"margin-bottom: 12px;\">' +\r\n              '<span style=\"font-size: 20px; margin-right: 8px;\">' + icon + '</span>' +\r\n              '<strong style=\"font-size: 16px;\">' + label + '</strong>' +\r\n              '<span class=\"text-muted\" style=\"display: block; margin-top: 4px; margin-left: 32px; font-size: 13px;\">' + desc + '</span>' +\r\n            '</div>' +\r\n            '<div class=\"task-selects\" style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-left: 32px;\">' +\r\n              '<div>' +\r\n                '<label style=\"font-size: 12px; color: var(--text-tertiary); margin-bottom: 4px; display: block;\">Provider</label>' +\r\n                '<select class=\"form-select provider-select\" data-task=\"' + task + '\" data-field=\"provider\" style=\"width: 100%;\">' +\r\n                  '<option value=\"\"' + (!taskConfig.provider ? ' selected' : '') + '>-- Select Provider --</option>' +\r\n                  providerOpts.map(p => '<option value=\"' + p + '\"' + (taskConfig.provider === p ? ' selected' : '') + '>' + providerNames[p] + '</option>').join('') +\r\n                '</select>' +\r\n              '</div>' +\r\n              '<div>' +\r\n                '<label style=\"font-size: 12px; color: var(--text-tertiary); margin-bottom: 4px; display: block;\">Model</label>' +\r\n                '<select class=\"form-select model-select\" data-task=\"' + task + '\" data-field=\"model\" style=\"width: 100%;\">' +\r\n                  '<option value=\"\">-- Select Provider First --</option>' +\r\n                  (taskConfig.model ? '<option value=\"' + taskConfig.model + '\" selected>' + taskConfig.model + '</option>' : '') +\r\n                '</select>' +\r\n                '<span class=\"model-loading\" data-task=\"' + task + '\" style=\"display: none; font-size: 11px; color: var(--primary); margin-top: 4px;\">Loading models...</span>' +\r\n              '</div>' +\r\n            '</div>' +\r\n            '<div class=\"model-status\" data-task=\"' + task + '\" style=\"margin-top: 8px; margin-left: 32px; font-size: 11px; color: var(--text-tertiary);\"></div>' +\r\n          '</div>';\r\n        }).join('')}\r\n        \r\n        <div style=\"display: flex; gap: 12px; align-items: center; margin-top: 20px;\">\r\n          <button class=\"btn-primary\" id=\"save-llm-config\">Save LLM Configuration</button>\r\n          <span class=\"text-muted\" style=\"font-size: 12px;\"> Changes apply immediately to all AI processing</span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- API Keys - LLM Providers -->\r\n      <div class=\"admin-card\">\r\n        <h4>LLM API Keys</h4>\r\n        <p class=\"text-muted\">System-level API keys (stored encrypted in Supabase)</p>\r\n        \r\n        <div class=\"api-keys-grid\" id=\"api-keys-container\">\r\n          <div class=\"form-group\" data-secret-name=\"OPENAI_API_KEY\">\r\n            <label>OpenAI <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\r\n            <div class=\"input-group\">\r\n              <input type=\"text\" id=\"openai-key\" name=\"llm_key_openai_${Date.now()}\" placeholder=\"sk-proj-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\r\n              <button class=\"btn-icon\" data-toggle-visibility=\"openai-key\">Show</button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"form-group\" data-secret-name=\"CLAUDE_API_KEY\">\r\n            <label>Anthropic (Claude) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\r\n            <div class=\"input-group\">\r\n              <input type=\"text\" id=\"anthropic-key\" name=\"llm_key_claude_${Date.now()}\" placeholder=\"sk-ant-api03-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\r\n              <button class=\"btn-icon\" data-toggle-visibility=\"anthropic-key\">Show</button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"form-group\" data-secret-name=\"GOOGLE_API_KEY\">\r\n            <label>Google AI (Gemini) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\r\n            <div class=\"input-group\">\r\n              <input type=\"text\" id=\"google-key\" name=\"llm_key_google_${Date.now()}\" placeholder=\"AIza...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\r\n              <button class=\"btn-icon\" data-toggle-visibility=\"google-key\">Show</button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"form-group\" data-secret-name=\"XAI_API_KEY\">\r\n            <label>xAI (Grok) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\r\n            <div class=\"input-group\">\r\n              <input type=\"text\" id=\"xai-key\" name=\"llm_key_xai_${Date.now()}\" placeholder=\"xai-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\r\n              <button class=\"btn-icon\" data-toggle-visibility=\"xai-key\">Show</button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"form-group\" data-secret-name=\"DEEPSEEK_API_KEY\">\r\n            <label>DeepSeek <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\r\n            <div class=\"input-group\">\r\n              <input type=\"text\" id=\"deepseek-key\" name=\"llm_key_deepseek_${Date.now()}\" placeholder=\"sk-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\r\n              <button class=\"btn-icon\" data-toggle-visibility=\"deepseek-key\">Show</button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"form-group\" data-secret-name=\"KIMI_API_KEY\">\r\n            <label>Kimi (Moonshot) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\r\n            <div class=\"input-group\">\r\n              <input type=\"text\" id=\"kimi-key\" name=\"llm_key_kimi_${Date.now()}\" placeholder=\"sk-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\r\n              <button class=\"btn-icon\" data-toggle-visibility=\"kimi-key\">Show</button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"form-group\" data-secret-name=\"MINIMAX_API_KEY\">\r\n            <label>MiniMax <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\r\n            <div class=\"input-group\">\r\n              <input type=\"text\" id=\"minimax-key\" name=\"llm_key_minimax_${Date.now()}\" placeholder=\"MINIMAX-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\r\n              <button class=\"btn-icon\" data-toggle-visibility=\"minimax-key\">Show</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div id=\"api-keys-loading\" style=\"text-align: center; padding: 10px; color: var(--text-tertiary);\">Loading configured keys...</div>\r\n        <button class=\"btn-primary mt-4\" id=\"save-api-keys\">Save LLM API Keys</button>\r\n      </div>\r\n\r\n      <!-- Service API Keys -->\r\n      <div class=\"admin-card\">\r\n        <h4>Service API Keys</h4>\r\n        <p class=\"text-muted\">Keys for email, notifications and other services</p>\r\n        \r\n        <div class=\"form-group\" data-secret-name=\"RESEND_API_KEY\">\r\n          <label>Resend API Key (Email Service) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\r\n          <div class=\"input-group\">\r\n            <input type=\"text\" id=\"resend-key\" name=\"service_key_resend_${Date.now()}\" placeholder=\"re_...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\r\n            <button class=\"btn-icon\" data-toggle-visibility=\"resend-key\">Show</button>\r\n          </div>\r\n        </div>\r\n        \r\n        <button class=\"btn-primary mt-4\" id=\"save-service-keys\">Save Service Keys</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render Graph section (Supabase Graph)\r\n */\r\nfunction renderGraphSection(): string {\r\n  const graphConfig = {\r\n    enabled: getConfigValue('graph', 'enabled', false) as boolean,\r\n    graphName: getConfigValue('graph', 'graphName', 'godmode') as string,\r\n  };\r\n\r\n  return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>Graph Database Configuration</h3>\r\n        <p>Supabase Graph for knowledge graph and GraphRAG</p>\r\n      </div>\r\n\r\n      <div class=\"admin-card\">\r\n        <div class=\"form-group\">\r\n          <label class=\"toggle-label\">\r\n            <input type=\"checkbox\" id=\"graph-enabled\" ${graphConfig.enabled ? 'checked' : ''}>\r\n            <span>Enable Graph Database</span>\r\n          </label>\r\n        </div>\r\n\r\n        <div class=\"form-group\" style=\"background: var(--bg-tertiary); padding: 12px; border-radius: 8px; margin: 16px 0;\">\r\n          <p style=\"margin: 0; color: var(--text-secondary);\">\r\n            <strong>Provider:</strong> Supabase Graph (PostgreSQL-based)\r\n          </p>\r\n          <p style=\"margin: 8px 0 0; font-size: 13px; color: var(--text-muted);\">\r\n            Uses your existing Supabase connection. No additional configuration needed.\r\n          </p>\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n          <label>Graph Name</label>\r\n          <input type=\"text\" id=\"graph-name\" value=\"${graphConfig.graphName}\" class=\"form-input\" placeholder=\"godmode\">\r\n        </div>\r\n\r\n        <div class=\"btn-group mt-4\">\r\n          <button class=\"btn-primary\" id=\"save-graph-config\">Save Configuration</button>\r\n          <button class=\"btn-secondary\" id=\"test-graph-connection\">Test Connection</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"admin-card\" id=\"graph-overview-card\">\r\n        <h4>Graph overview</h4>\r\n        <p class=\"text-muted\">Current graph status. Enable and save configuration above first.</p>\r\n        <div id=\"graph-overview-content\">\r\n          ${graphOverviewLoading ? '<p class=\"text-muted\">Loading...</p>' : !graphOverviewLoaded ? '<button class=\"btn-secondary\" id=\"load-graph-overview\">Load overview</button>' : (graphList.length === 0 && !graphStatus?.enabled ? '<p class=\"text-muted\">Graph not enabled or not connected. Enable and save configuration.</p><button class=\"btn-secondary mt-4\" id=\"refresh-graph-overview\">Refresh</button>' : `\r\n            ${graphStatus?.enabled && (graphStatus.stats != null || graphStatus.graphName) ? `\r\n              <div class=\"graph-status-row\" style=\"margin-bottom: 12px;\">\r\n                <strong>Current graph:</strong> ${graphStatus.graphName ?? ''}\r\n                ${graphStatus.stats?.nodes !== undefined ? `  Nodes: ${graphStatus.stats.nodes}` : ''}\r\n                ${graphStatus.stats?.relationships !== undefined ? `  Edges: ${graphStatus.stats.relationships}` : ''}\r\n              </div>\r\n            ` : ''}\r\n            ${graphList.length > 0 ? `\r\n              <table class=\"admin-table\" style=\"width: 100%; margin-top: 8px;\">\r\n                <thead><tr><th>Graph name</th><th>Project</th></tr></thead>\r\n                <tbody>\r\n                  ${graphList.map(g => `<tr><td><code>${g.graphName}</code></td><td>${g.projectName ?? ''}</td></tr>`).join('')}\r\n                </tbody>\r\n              </table>\r\n            ` : ''}\r\n            <div class=\"btn-group mt-4\">\r\n              <button class=\"btn-secondary\" id=\"open-graph-tab\">Open in Graph tab</button>\r\n              <button class=\"btn-secondary\" id=\"refresh-graph-overview\">Refresh</button>\r\n            </div>\r\n          `)}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render Ontology section\r\n */\r\nfunction renderOntologySection(): string {\r\n  if (ontologyLoading || !ontologyLoaded) {\r\n    return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>Ontology</h3>\r\n        <p>Entity types and relation types used by extraction and GraphRAG</p>\r\n      </div>\r\n      <div class=\"admin-card\">\r\n        <p class=\"text-muted\">${ontologyLoading ? 'Loading ontology...' : 'Click Load to fetch entity and relation types from the API.'}</p>\r\n        ${!ontologyLoading ? '<button class=\"btn-primary\" id=\"load-ontology\">Load ontology</button>' : ''}\r\n      </div>\r\n    </div>\r\n    `;\r\n  }\r\n  return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>Ontology</h3>\r\n        <p>Entity types and relation types used by extraction and GraphRAG</p>\r\n      </div>\r\n\r\n      <div class=\"admin-card\">\r\n        <h4>Entity types</h4>\r\n        <p class=\"text-muted\">Types of entities that can be extracted and stored in the graph.</p>\r\n        ${ontologyEntities.length === 0 ? '<p class=\"text-muted\">No entity types returned.</p>' : `\r\n          <ul class=\"ontology-list\">\r\n            ${ontologyEntities.map(e => `\r\n              <li><code>${e.name}</code>\r\n                ${e.sharedEntity ? ' <span class=\"badge badge-info\">shared</span>' : ''}\r\n                ${e.properties?.length ? `  properties: ${e.properties.join(', ')}` : ''}\r\n              </li>\r\n            `).join('')}\r\n          </ul>\r\n        `}\r\n      </div>\r\n\r\n      <div class=\"admin-card\">\r\n        <h4>Relation types</h4>\r\n        <p class=\"text-muted\">Allowed relationships between entity types.</p>\r\n        ${ontologyRelations.length === 0 ? '<p class=\"text-muted\">No relation types returned.</p>' : `\r\n          <ul class=\"ontology-list\">\r\n            ${ontologyRelations.map(r => `\r\n              <li><code>${r.name}</code>\r\n                ${(r as { sourceType?: string; targetType?: string }).sourceType ? ` (${(r as { sourceType?: string; targetType?: string }).sourceType}  ${(r as { sourceType?: string; targetType?: string }).targetType})` : ''}\r\n              </li>\r\n            `).join('')}\r\n          </ul>\r\n        `}\r\n      </div>\r\n\r\n      <div class=\"btn-group mt-4\">\r\n        <button class=\"btn-secondary\" id=\"reload-ontology\">Reload ontology</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render Prompts section\r\n */\r\nfunction renderPromptsSection(): string {\r\n  // Group prompts by category\r\n  const extractionPrompts = systemPrompts.filter(p => p.category === 'extraction');\r\n  const analysisPrompts = systemPrompts.filter(p => p.category === 'analysis');\r\n  const templatePrompts = systemPrompts.filter(p => p.category === 'template');\r\n\r\n  const renderPromptCard = (p: SystemPrompt) => `\r\n    <div class=\"admin-card prompt-card\" data-prompt-id=\"${p.id}\">\r\n      <div class=\"prompt-header\">\r\n        <div>\r\n          <h4>${p.name}</h4>\r\n          <p class=\"text-muted\">${p.description}</p>\r\n        </div>\r\n        <div class=\"prompt-badges\">\r\n          ${p.uses_ontology ? '<span class=\"badge badge-info\">Ontology-Aware</span>' : ''}\r\n          <span class=\"badge badge-secondary\">${p.key}</span>\r\n        </div>\r\n      </div>\r\n      <textarea class=\"form-textarea prompt-editor\" data-prompt-key=\"${p.key}\" rows=\"12\" \r\n                placeholder=\"Enter prompt template...\r\n\r\nAvailable placeholders:\r\n{{CONTENT}} - The document/transcript content\r\n{{FILENAME}} - The file/document name\r\n{{TODAY}} - Current date\r\n{{ONTOLOGY_SECTION}} - Ontology context (if uses_ontology=true)\r\n{{ROLE_CONTEXT}} - User role context\r\n{{PROJECT_CONTEXT}} - Project context\">${p.prompt_template || ''}</textarea>\r\n      <div class=\"prompt-actions\">\r\n        <button class=\"btn-sm btn-secondary\" data-view-versions=\"${p.key}\">\r\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n            <polyline points=\"12,6 12,12 16,14\"/>\r\n          </svg>\r\n          Version History\r\n        </button>\r\n        <span class=\"prompt-status\" id=\"status-${p.key}\"></span>\r\n      </div>\r\n      <div class=\"version-history hidden\" id=\"versions-${p.key}\">\r\n        <div class=\"version-list\"></div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>AI Prompts Configuration</h3>\r\n        <p>Customize ontology-aware prompts for AI extraction. All prompts support template variables.</p>\r\n      </div>\r\n\r\n      <div class=\"prompt-info admin-card\">\r\n        <h4>Template Variables</h4>\r\n        <div class=\"variables-grid\">\r\n          <code>{{CONTENT}}</code> <span>Document/transcript content</span>\r\n          <code>{{FILENAME}}</code> <span>File or document name</span>\r\n          <code>{{TODAY}}</code> <span>Current date (YYYY-MM-DD)</span>\r\n          <code>{{ONTOLOGY_SECTION}}</code> <span>Injected ontology context</span>\r\n          <code>{{ROLE_CONTEXT}}</code> <span>User role context line</span>\r\n          <code>{{PROJECT_CONTEXT}}</code> <span>Project context line</span>\r\n          <code>{{CONTENT_LENGTH}}</code> <span>Content length in characters</span>\r\n        </div>\r\n      </div>\r\n\r\n      <h4 class=\"section-subtitle\">Extraction Prompts</h4>\r\n      ${extractionPrompts.length > 0 ? extractionPrompts.map(renderPromptCard).join('') : '<p class=\"text-muted\">Run migration 031 to create default prompts</p>'}\r\n\r\n      ${analysisPrompts.length > 0 ? `\r\n        <h4 class=\"section-subtitle\">Analysis Prompts</h4>\r\n        ${analysisPrompts.map(renderPromptCard).join('')}\r\n      ` : ''}\r\n\r\n      ${templatePrompts.length > 0 ? `\r\n        <h4 class=\"section-subtitle\">Template Sections</h4>\r\n        ${templatePrompts.map(renderPromptCard).join('')}\r\n      ` : ''}\r\n\r\n      <div class=\"btn-group mt-4\">\r\n        <button class=\"btn-primary\" id=\"save-prompts\">Save All Prompts</button>\r\n        <button class=\"btn-secondary\" id=\"reload-prompts\">Reload from Database</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render Processing section\r\n */\r\nfunction renderProcessingSection(): string {\r\n  const processing = {\r\n    chunkSize: getConfigValue('processing', 'chunk_size', 1000) as number,\r\n    chunkOverlap: getConfigValue('processing', 'chunk_overlap', 200) as number,\r\n    maxTokens: getConfigValue('processing', 'max_tokens', 4096) as number,\r\n    temperature: getConfigValue('processing', 'temperature', 0.7) as number,\r\n    autoProcess: getConfigValue('processing', 'auto_process', true) as boolean,\r\n    parallelJobs: getConfigValue('processing', 'parallel_jobs', 3) as number,\r\n  };\r\n\r\n  return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>Document Processing Settings</h3>\r\n        <p>Configure how documents are processed and analyzed</p>\r\n      </div>\r\n\r\n      <div class=\"admin-card\">\r\n        <h4>Chunking Settings</h4>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label>Chunk Size (tokens)</label>\r\n            <input type=\"number\" id=\"proc-chunk-size\" value=\"${processing.chunkSize}\" class=\"form-input\" min=\"100\" max=\"8000\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label>Chunk Overlap (tokens)</label>\r\n            <input type=\"number\" id=\"proc-chunk-overlap\" value=\"${processing.chunkOverlap}\" class=\"form-input\" min=\"0\" max=\"1000\">\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"admin-card\">\r\n        <h4>Generation Settings</h4>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label>Max Tokens</label>\r\n            <input type=\"number\" id=\"proc-max-tokens\" value=\"${processing.maxTokens}\" class=\"form-input\" min=\"256\" max=\"32000\">\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label>Temperature</label>\r\n            <input type=\"number\" id=\"proc-temperature\" value=\"${processing.temperature}\" class=\"form-input\" min=\"0\" max=\"2\" step=\"0.1\">\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"admin-card\">\r\n        <h4>Job Settings</h4>\r\n        \r\n        <div class=\"form-group\">\r\n          <label class=\"toggle-label\">\r\n            <input type=\"checkbox\" id=\"proc-auto-process\" ${processing.autoProcess ? 'checked' : ''}>\r\n            <span>Auto-process uploaded documents</span>\r\n          </label>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Parallel Jobs</label>\r\n          <input type=\"number\" id=\"proc-parallel-jobs\" value=\"${processing.parallelJobs}\" class=\"form-input\" min=\"1\" max=\"10\">\r\n        </div>\r\n      </div>\r\n\r\n      <button class=\"btn-primary\" id=\"save-processing\">Save Processing Settings</button>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Load Team Analysis settings for current project\r\n */\r\nasync function loadTeamAnalysisSettings(): Promise<void> {\r\n  const state = appStore.getState();\r\n  const projectId = state.currentProject?.id;\r\n  \r\n  if (!projectId) {\r\n    teamAnalysisSettings = { enabled: true, access: 'admin_only' };\r\n    teamAnalysisLoaded = true;\r\n    return;\r\n  }\r\n  \r\n  teamAnalysisLoading = true;\r\n  \r\n  try {\r\n    const response = await http.get<{ ok: boolean; config: { enabled: boolean; access: string } }>('/api/team-analysis/config');\r\n    teamAnalysisSettings = {\r\n      enabled: response?.config?.enabled ?? true,\r\n      access: (response?.config?.access as 'admin_only' | 'all') ?? 'admin_only'\r\n    };\r\n    teamAnalysisLoaded = true;\r\n  } catch (error) {\r\n    console.error('[AdminPanel] Error loading team analysis settings:', error);\r\n    teamAnalysisSettings = { enabled: true, access: 'admin_only' };\r\n    teamAnalysisLoaded = true;\r\n  } finally {\r\n    teamAnalysisLoading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Save Team Analysis settings\r\n */\r\nasync function saveTeamAnalysisSettings(enabled: boolean, access: string): Promise<void> {\r\n  const state = appStore.getState();\r\n  const projectId = state.currentProject?.id;\r\n  \r\n  if (!projectId) {\r\n    toast.error('No project selected');\r\n    return;\r\n  }\r\n  \r\n  try {\r\n    await http.put('/api/team-analysis/config', {\r\n      enabled,\r\n      access\r\n    });\r\n    \r\n    teamAnalysisSettings = { enabled, access: access as 'admin_only' | 'all' };\r\n    toast.success('Team Analysis settings saved');\r\n  } catch (error) {\r\n    console.error('[AdminPanel] Error saving team analysis settings:', error);\r\n    toast.error('Failed to save settings');\r\n  }\r\n}\r\n\r\n/**\r\n * Render Team Analysis section\r\n */\r\nfunction renderTeamAnalysisSection(): string {\r\n  const state = appStore.getState();\r\n  const projectId = state.currentProject?.id;\r\n  const projectName = state.currentProject?.name || 'Unknown';\r\n  \r\n  if (!projectId) {\r\n    return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>Team Analysis Settings</h3>\r\n        <p>Configure access control for behavioral analysis features</p>\r\n      </div>\r\n      \r\n      <div class=\"admin-card\">\r\n        <div style=\"text-align: center; padding: 40px; color: var(--text-tertiary);\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"48\" height=\"48\" style=\"margin: 0 auto 16px; opacity: 0.5;\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\r\n          </svg>\r\n          <p>Please select a project to configure Team Analysis settings.</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    `;\r\n  }\r\n  \r\n  if (teamAnalysisLoading || !teamAnalysisLoaded) {\r\n    // Trigger load and show loading state\r\n    if (!teamAnalysisLoading && !teamAnalysisLoaded) {\r\n      loadTeamAnalysisSettings();\r\n    }\r\n    \r\n    return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>Team Analysis Settings</h3>\r\n        <p>Configure access control for behavioral analysis features</p>\r\n      </div>\r\n      \r\n      <div class=\"admin-card\">\r\n        <div style=\"text-align: center; padding: 40px; color: var(--text-tertiary);\">\r\n          <div class=\"loading-spinner\" style=\"margin: 0 auto 16px;\"></div>\r\n          <p>Loading settings...</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    `;\r\n  }\r\n  \r\n  return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>Team Analysis Settings</h3>\r\n        <p>Configure access control for behavioral analysis features</p>\r\n      </div>\r\n\r\n      <!-- Current Project Info -->\r\n      <div class=\"admin-card\">\r\n        <h4>Current Project</h4>\r\n        <div style=\"display: flex; align-items: center; gap: 12px; margin-top: 12px;\">\r\n          <div style=\"width: 40px; height: 40px; background: var(--primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;\">\r\n            ${projectName.charAt(0).toUpperCase()}\r\n          </div>\r\n          <div>\r\n            <div style=\"font-weight: 500;\">${projectName}</div>\r\n            <div style=\"font-size: 12px; color: var(--text-tertiary);\">ID: ${projectId}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Feature Toggle -->\r\n      <div class=\"admin-card\">\r\n        <h4>Feature Status</h4>\r\n        <p class=\"text-muted\" style=\"margin-bottom: 16px;\">Enable or disable Team Analysis for this project</p>\r\n        \r\n        <div class=\"form-group\">\r\n          <label class=\"toggle-label\" style=\"display: flex; align-items: center; gap: 12px; cursor: pointer;\">\r\n            <input type=\"checkbox\" id=\"team-analysis-enabled\" ${teamAnalysisSettings.enabled ? 'checked' : ''} style=\"width: 20px; height: 20px;\">\r\n            <div>\r\n              <span style=\"font-weight: 500;\">Enable Team Analysis</span>\r\n              <p style=\"font-size: 12px; color: var(--text-tertiary); margin: 4px 0 0 0;\">When enabled, users with access can analyze team member behavior from meeting transcripts</p>\r\n            </div>\r\n          </label>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Access Control -->\r\n      <div class=\"admin-card\">\r\n        <h4>Access Control</h4>\r\n        <p class=\"text-muted\" style=\"margin-bottom: 16px;\">Define who can access Team Analysis features</p>\r\n        \r\n        <div class=\"form-group\">\r\n          <label style=\"font-weight: 500; display: block; margin-bottom: 8px;\">Access Level</label>\r\n          <select id=\"team-analysis-access\" class=\"form-input\" style=\"width: 100%; max-width: 400px;\">\r\n            <option value=\"admin_only\" ${teamAnalysisSettings.access === 'admin_only' ? 'selected' : ''}>Admins Only - Only project owner and admins can access</option>\r\n            <option value=\"all\" ${teamAnalysisSettings.access === 'all' ? 'selected' : ''}>All Members - All project members can access</option>\r\n          </select>\r\n          <p style=\"font-size: 12px; color: var(--text-tertiary); margin-top: 8px;\">\r\n            <strong>Admins Only:</strong> Restricts access to sensitive behavioral analysis to project owner and administrators.<br>\r\n            <strong>All Members:</strong> Allows all project collaborators to view and run team analysis.\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Analysis Scope Info -->\r\n      <div class=\"admin-card\">\r\n        <h4>How It Works</h4>\r\n        <div style=\"display: grid; gap: 16px; margin-top: 12px;\">\r\n          <div style=\"display: flex; gap: 12px; align-items: start;\">\r\n            <div style=\"min-width: 32px; height: 32px; background: var(--info); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;\">1</div>\r\n            <div>\r\n              <div style=\"font-weight: 500;\">Contact-Based Analysis</div>\r\n              <div style=\"font-size: 13px; color: var(--text-secondary);\">Analysis is performed on contacts defined in the project. Contacts can have aliases to match different name variations in transcripts.</div>\r\n            </div>\r\n          </div>\r\n          <div style=\"display: flex; gap: 12px; align-items: start;\">\r\n            <div style=\"min-width: 32px; height: 32px; background: var(--info); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;\">2</div>\r\n            <div>\r\n              <div style=\"font-weight: 500;\">Incremental Learning</div>\r\n              <div style=\"font-size: 13px; color: var(--text-secondary);\">Profiles are refined iteratively as more transcripts are processed, building evidence over time.</div>\r\n            </div>\r\n          </div>\r\n          <div style=\"display: flex; gap: 12px; align-items: start;\">\r\n            <div style=\"min-width: 32px; height: 32px; background: var(--info); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;\">3</div>\r\n            <div>\r\n              <div style=\"font-weight: 500;\">Privacy Consideration</div>\r\n              <div style=\"font-size: 13px; color: var(--text-secondary);\">Behavioral analysis may contain sensitive insights. Configure access carefully.</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <button class=\"btn-primary\" id=\"save-team-analysis\" style=\"margin-top: 8px;\">Save Team Analysis Settings</button>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render LLM Queue section\r\n */\r\nfunction renderQueueSection(): string {\r\n  return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>LLM Processing Queue</h3>\r\n        <p>Monitor and control AI request processing - All requests are persisted in database</p>\r\n      </div>\r\n\r\n      <!-- Queue Status -->\r\n      <div class=\"admin-card\" id=\"queue-status-card\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\r\n          <h4>Queue Status</h4>\r\n          <div style=\"display: flex; gap: 8px;\">\r\n            <span id=\"db-status-badge\" class=\"badge\" style=\"font-size: 11px;\">DB: Checking...</span>\r\n            <button class=\"btn-sm\" id=\"refresh-queue-status\"> Refresh</button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div id=\"queue-status-content\" style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\r\n          Loading queue status...\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Queue Controls -->\r\n      <div class=\"admin-card\">\r\n        <h4>Queue Controls</h4>\r\n        <p class=\"text-muted\">Control queue processing behavior</p>\r\n        \r\n        <div style=\"display: flex; gap: 12px; flex-wrap: wrap; margin-top: 16px;\">\r\n          <button class=\"btn-primary\" id=\"queue-pause-btn\"> Pause Queue</button>\r\n          <button class=\"btn-primary\" id=\"queue-resume-btn\"> Resume Queue</button>\r\n          <button class=\"btn-secondary\" id=\"queue-clear-btn\" style=\"background: var(--warning); color: white;\"> Clear Queue</button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Statistics -->\r\n      <div class=\"admin-card\">\r\n        <h4>Queue Statistics (Today)</h4>\r\n        <div id=\"queue-stats-content\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-top: 16px;\">\r\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\r\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--primary);\" id=\"stat-pending\">-</div>\r\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Pending</div>\r\n          </div>\r\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\r\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--info);\" id=\"stat-processing\">-</div>\r\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Processing</div>\r\n          </div>\r\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\r\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--success);\" id=\"stat-success\">-</div>\r\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Completed</div>\r\n          </div>\r\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\r\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--error);\" id=\"stat-failed\">-</div>\r\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Failed</div>\r\n          </div>\r\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\r\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--warning);\" id=\"stat-retry\">-</div>\r\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Retry Pending</div>\r\n          </div>\r\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\r\n            <div style=\"font-size: 20px; font-weight: bold;\" id=\"stat-avg-time\">-</div>\r\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Avg Time (ms)</div>\r\n          </div>\r\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\r\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--success);\" id=\"stat-cost\">$-</div>\r\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Cost Today</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Queue Items -->\r\n      <div class=\"admin-card\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\r\n          <h4>Pending Items</h4>\r\n          <span id=\"pending-count\" class=\"text-muted\">0 items</span>\r\n        </div>\r\n        \r\n        <div id=\"queue-items-content\" style=\"max-height: 300px; overflow-y: auto;\">\r\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\r\n            No items in queue\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Failed Items (Retryable) -->\r\n      <div class=\"admin-card\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\r\n          <h4>Failed Items</h4>\r\n          <div style=\"display: flex; gap: 8px;\">\r\n            <button class=\"btn-sm btn-primary\" id=\"retry-all-btn\"> Retry All</button>\r\n            <button class=\"btn-sm\" id=\"refresh-failed-btn\"> Refresh</button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div id=\"failed-items-content\" style=\"max-height: 300px; overflow-y: auto;\">\r\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\r\n            No failed items\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Recent History -->\r\n      <div class=\"admin-card\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\r\n          <h4>Recent Processing History</h4>\r\n          <button class=\"btn-sm\" id=\"refresh-queue-history\"> Refresh</button>\r\n        </div>\r\n        \r\n        <div id=\"queue-history-content\" style=\"max-height: 400px; overflow-y: auto;\">\r\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\r\n            Loading history...\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render Audit Log section\r\n */\r\nfunction renderAuditSection(): string {\r\n  return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>Configuration Audit Log</h3>\r\n        <p>Track all configuration changes</p>\r\n      </div>\r\n\r\n      <div class=\"admin-card\">\r\n        <div class=\"audit-filters\">\r\n          <select id=\"audit-filter-table\" class=\"form-select\">\r\n            <option value=\"\">All Tables</option>\r\n            <option value=\"system_config\">System Config</option>\r\n            <option value=\"project_config\">Project Config</option>\r\n            <option value=\"secrets\">Secrets</option>\r\n          </select>\r\n          <button class=\"btn-secondary\" id=\"refresh-audit\">Refresh</button>\r\n        </div>\r\n\r\n        <div class=\"audit-log-list\">\r\n          ${auditLogs.length === 0 ? `\r\n            <div class=\"empty-state\">\r\n              <p>No audit logs found</p>\r\n            </div>\r\n          ` : auditLogs.map(log => `\r\n            <div class=\"audit-log-item\">\r\n              <div class=\"audit-log-header\">\r\n                <span class=\"audit-operation ${log.operation.toLowerCase()}\">${log.operation}</span>\r\n                <span class=\"audit-table\">${log.table_name}</span>\r\n                <span class=\"audit-time\">${new Date(log.changed_at).toLocaleString()}</span>\r\n              </div>\r\n              <div class=\"audit-log-details\">\r\n                <span class=\"audit-user\">${log.changed_by_email || 'System'}</span>\r\n                ${log.new_values ? `<pre class=\"audit-values\">${JSON.stringify(log.new_values, null, 2)}</pre>` : ''}\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render Model Metadata section\r\n */\r\nfunction renderModelsSection(): string {\r\n  return `\r\n    <div class=\"admin-section\">\r\n      <div class=\"admin-section-header\">\r\n        <h3>LLM Model Metadata</h3>\r\n        <p>Manage model information, pricing, and capabilities from database</p>\r\n      </div>\r\n      \r\n      <!-- Sync Controls -->\r\n      <div class=\"admin-card\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\r\n          <h4>Sync Model Metadata</h4>\r\n          <button class=\"btn btn-primary\" id=\"sync-all-metadata-btn\">\r\n             Sync All Providers\r\n          </button>\r\n        </div>\r\n        <p style=\"font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;\">\r\n          Fetch the latest model list from each configured provider API and update the database with current models and capabilities.\r\n          Pricing information is updated from known sources.\r\n        </p>\r\n        \r\n        <div id=\"metadata-sync-status\" style=\"margin-bottom: 16px;\">\r\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\r\n            Loading sync status...\r\n          </div>\r\n        </div>\r\n        \r\n        <div id=\"metadata-sync-result\" style=\"display: none;\"></div>\r\n      </div>\r\n      \r\n      <!-- Provider Status -->\r\n      <div class=\"admin-card\">\r\n        <h4 style=\"margin-bottom: 16px;\">Provider Model Count</h4>\r\n        <div id=\"provider-model-counts\">\r\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\r\n            Loading...\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Model Browser -->\r\n      <div class=\"admin-card\">\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\r\n          <h4>Browse Models</h4>\r\n          <div style=\"display: flex; gap: 8px;\">\r\n            <select id=\"browse-provider-select\" class=\"form-select\" style=\"min-width: 150px;\">\r\n              <option value=\"\">Select Provider</option>\r\n              <option value=\"openai\">OpenAI</option>\r\n              <option value=\"anthropic\">Anthropic</option>\r\n              <option value=\"google\">Google</option>\r\n              <option value=\"grok\">Grok (xAI)</option>\r\n              <option value=\"deepseek\">DeepSeek</option>\r\n            </select>\r\n            <button class=\"btn btn-secondary\" id=\"browse-models-btn\">Load Models</button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div id=\"models-browser-content\">\r\n          <div style=\"text-align: center; padding: 40px; color: var(--text-tertiary);\">\r\n            Select a provider to browse available models\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render current section content\r\n */\r\nfunction renderSectionContent(): string {\r\n  switch (currentSection) {\r\n    case 'llm':\r\n      return renderLLMSection();\r\n    case 'models':\r\n      return renderModelsSection();\r\n    case 'graph':\r\n      return renderGraphSection();\r\n    case 'ontology':\r\n      return renderOntologySection();\r\n    case 'queue':\r\n      return renderQueueSection();\r\n    case 'prompts':\r\n      return renderPromptsSection();\r\n    case 'processing':\r\n      return renderProcessingSection();\r\n    case 'team-analysis':\r\n      return renderTeamAnalysisSection();\r\n    case 'audit':\r\n      return renderAuditSection();\r\n    default:\r\n      return renderLLMSection();\r\n  }\r\n}\r\n\r\n/**\r\n * Bind section-specific events\r\n */\r\nfunction bindSectionEvents(container: HTMLElement): void {\r\n  // Nav buttons\r\n  container.querySelectorAll('.admin-nav-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const newSection = btn.getAttribute('data-section') || 'llm';\r\n      currentSection = newSection;\r\n      \r\n      // Load Team Analysis settings when switching to that section\r\n      if (newSection === 'team-analysis') {\r\n        teamAnalysisLoaded = false; // Force reload\r\n        teamAnalysisLoading = false;\r\n        renderAdminPanel(container);\r\n        await loadTeamAnalysisSettings();\r\n        renderAdminPanel(container);\r\n      } else {\r\n        renderAdminPanel(container);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Toggle visibility buttons\r\n  container.querySelectorAll('[data-toggle-visibility]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const inputId = btn.getAttribute('data-toggle-visibility');\r\n      if (inputId) {\r\n        const input = container.querySelector(`#${inputId}`) as HTMLInputElement;\r\n        if (input) {\r\n          input.type = input.type === 'password' ? 'text' : 'password';\r\n          (btn as HTMLElement).textContent = input.type === 'password' ? 'Show' : 'Hide';\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  // Test provider buttons\r\n  container.querySelectorAll('[data-test-provider]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const providerId = btn.getAttribute('data-test-provider');\r\n      if (providerId) {\r\n        (btn as HTMLElement).textContent = 'Testing...';\r\n        await testProvider(providerId);\r\n        (btn as HTMLElement).textContent = 'Test';\r\n      }\r\n    });\r\n  });\r\n\r\n  // Cache for loaded models by provider\r\n  const modelsCache: Record<string, { textModels: string[]; visionModels: string[]; embeddingModels: string[] }> = {};\r\n  \r\n  // Load models for a provider\r\n  async function loadModelsForProvider(providerId: string, taskType: string): Promise<void> {\r\n    const modelSelect = container.querySelector(`select.model-select[data-task=\"${taskType}\"]`) as HTMLSelectElement;\r\n    const loadingSpan = container.querySelector(`.model-loading[data-task=\"${taskType}\"]`) as HTMLElement;\r\n    const statusDiv = container.querySelector(`.model-status[data-task=\"${taskType}\"]`) as HTMLElement;\r\n    \r\n    if (!modelSelect || !providerId) {\r\n      if (modelSelect) {\r\n        modelSelect.innerHTML = '<option value=\"\">-- Select Provider First --</option>';\r\n      }\r\n      return;\r\n    }\r\n    \r\n    // Show loading state\r\n    if (loadingSpan) loadingSpan.style.display = 'inline';\r\n    modelSelect.disabled = true;\r\n    \r\n    try {\r\n      // Check cache first\r\n      if (!modelsCache[providerId]) {\r\n        const response = await http.get<{ textModels: Array<{id: string; name?: string}>; visionModels: Array<{id: string; name?: string}>; embeddingModels: Array<{id: string; name?: string}> }>(`/api/llm/models?provider=${providerId}`);\r\n        modelsCache[providerId] = {\r\n          textModels: (response.data.textModels || []).map(m => m.id || m.name || '').filter(Boolean),\r\n          visionModels: (response.data.visionModels || []).map(m => m.id || m.name || '').filter(Boolean),\r\n          embeddingModels: (response.data.embeddingModels || []).map(m => m.id || m.name || '').filter(Boolean)\r\n        };\r\n      }\r\n      \r\n      // Determine which models to show based on task type\r\n      let models: string[] = [];\r\n      if (taskType === 'text') models = modelsCache[providerId].textModels;\r\n      else if (taskType === 'vision') models = modelsCache[providerId].visionModels;\r\n      else if (taskType === 'embeddings') models = modelsCache[providerId].embeddingModels;\r\n      \r\n      // Get current selected value\r\n      const currentValue = modelSelect.value;\r\n      \r\n      // Populate dropdown\r\n      modelSelect.innerHTML = '<option value=\"\">-- Select Model --</option>' +\r\n        models.map(m => `<option value=\"${m}\"${m === currentValue ? ' selected' : ''}>${m}</option>`).join('');\r\n      \r\n      // Update status\r\n      if (statusDiv) {\r\n        statusDiv.textContent = models.length > 0 \r\n          ? `${models.length} model(s) available` \r\n          : 'No models found for this task type. Check provider configuration.';\r\n        statusDiv.style.color = models.length > 0 ? 'var(--success)' : 'var(--warning)';\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error(`Failed to load models for ${providerId}:`, error);\r\n      modelSelect.innerHTML = '<option value=\"\">Error loading models</option>';\r\n      if (statusDiv) {\r\n        statusDiv.textContent = 'Failed to load models. Check API key configuration.';\r\n        statusDiv.style.color = 'var(--error)';\r\n      }\r\n    } finally {\r\n      if (loadingSpan) loadingSpan.style.display = 'none';\r\n      modelSelect.disabled = false;\r\n    }\r\n  }\r\n  \r\n  // Provider change handler - load models dynamically\r\n  container.querySelectorAll('select.provider-select').forEach(select => {\r\n    on(select as HTMLElement, 'change', async () => {\r\n      const task = select.getAttribute('data-task');\r\n      const provider = (select as HTMLSelectElement).value;\r\n      if (task) {\r\n        await loadModelsForProvider(provider, task);\r\n      }\r\n    });\r\n    \r\n    // Initial load if provider is already selected\r\n    const task = select.getAttribute('data-task');\r\n    const provider = (select as HTMLSelectElement).value;\r\n    if (task && provider) {\r\n      loadModelsForProvider(provider, task);\r\n    }\r\n  });\r\n\r\n  // Save LLM config\r\n  const saveLLMBtn = container.querySelector('#save-llm-config');\r\n  if (saveLLMBtn) {\r\n    on(saveLLMBtn as HTMLElement, 'click', async () => {\r\n      const taskConfigs: Record<string, { provider: string; model: string }> = {};\r\n      \r\n      container.querySelectorAll('select[data-task]').forEach(el => {\r\n        const task = el.getAttribute('data-task')!;\r\n        const field = el.getAttribute('data-field')!;\r\n        \r\n        if (!taskConfigs[task]) {\r\n          taskConfigs[task] = { provider: '', model: '' };\r\n        }\r\n        \r\n        taskConfigs[task][field as 'provider' | 'model'] = (el as HTMLSelectElement).value;\r\n      });\r\n\r\n      try {\r\n        for (const [task, config] of Object.entries(taskConfigs)) {\r\n          if (config.provider) {\r\n            await saveConfig(`${task}_provider`, config, 'llm');\r\n          }\r\n        }\r\n        toast.success('LLM configuration saved to Supabase');\r\n      } catch (error) {\r\n        toast.error('Failed to save LLM configuration');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Load existing API keys status\r\n  async function loadApiKeysStatus(): Promise<void> {\r\n    const loadingEl = container.querySelector('#api-keys-loading') as HTMLElement;\r\n    try {\r\n      const response = await http.get<{ success: boolean; secrets: Array<{ name: string; masked_value: string; is_valid: boolean }> }>('/api/secrets');\r\n      if (response.data?.success && response.data.secrets) {\r\n        for (const secret of response.data.secrets) {\r\n          const formGroup = container.querySelector(`[data-secret-name=\"${secret.name}\"]`);\r\n          if (formGroup) {\r\n            const statusSpan = formGroup.querySelector('.key-status') as HTMLElement;\r\n            const input = formGroup.querySelector('input') as HTMLInputElement;\r\n            if (statusSpan) {\r\n              if (secret.masked_value) {\r\n                statusSpan.textContent = ' Configured';\r\n                statusSpan.style.color = 'var(--success)';\r\n                if (input) {\r\n                  input.placeholder = secret.masked_value;\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to load API keys status:', error);\r\n    } finally {\r\n      if (loadingEl) loadingEl.style.display = 'none';\r\n    }\r\n  }\r\n  \r\n  // Load API keys status on render\r\n  loadApiKeysStatus();\r\n\r\n  // Save LLM API keys\r\n  const saveKeysBtn = container.querySelector('#save-api-keys');\r\n  if (saveKeysBtn) {\r\n    on(saveKeysBtn as HTMLElement, 'click', async () => {\r\n      const keys = [\r\n        { id: 'openai-key', name: 'OPENAI_API_KEY' },\r\n        { id: 'anthropic-key', name: 'CLAUDE_API_KEY' },\r\n        { id: 'google-key', name: 'GOOGLE_API_KEY' },\r\n        { id: 'xai-key', name: 'XAI_API_KEY' },\r\n        { id: 'deepseek-key', name: 'DEEPSEEK_API_KEY' },\r\n        { id: 'kimi-key', name: 'KIMI_API_KEY' },\r\n        { id: 'minimax-key', name: 'MINIMAX_API_KEY' },\r\n      ];\r\n\r\n      try {\r\n        let savedCount = 0;\r\n        for (const key of keys) {\r\n          const value = (container.querySelector(`#${key.id}`) as HTMLInputElement)?.value;\r\n          if (value && value.trim()) {\r\n            await http.post('/api/secrets', { name: key.name, value: value.trim(), scope: 'system' });\r\n            savedCount++;\r\n          }\r\n        }\r\n        if (savedCount > 0) {\r\n          toast.success(`${savedCount} API key(s) saved securely`);\r\n        } else {\r\n          toast.info('No API keys to save');\r\n        }\r\n      } catch (error) {\r\n        toast.error('Failed to save API keys');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Save service API keys\r\n  const saveServiceKeysBtn = container.querySelector('#save-service-keys');\r\n  if (saveServiceKeysBtn) {\r\n    on(saveServiceKeysBtn as HTMLElement, 'click', async () => {\r\n      const resendKey = (container.querySelector('#resend-key') as HTMLInputElement)?.value;\r\n\r\n      try {\r\n        if (resendKey && resendKey.trim()) {\r\n          await http.post('/api/secrets', { name: 'RESEND_API_KEY', value: resendKey.trim(), scope: 'system' });\r\n          toast.success('Service API key saved securely');\r\n        } else {\r\n          toast.info('No service keys to save');\r\n        }\r\n      } catch (error) {\r\n        toast.error('Failed to save service keys');\r\n      }\r\n    });\r\n  }\r\n\r\n  // ============ Queue Section Handlers ============\r\n  \r\n  // Load queue status\r\n  // Interface for queue data\r\n  interface QueueStatusData {\r\n    isProcessing: boolean;\r\n    isPaused: boolean;\r\n    queueLength: number;\r\n    currentRequest: { id: string; context: string; priority: string; startedAt: string } | null;\r\n    stats: { total: number; successful: number; failed: number; avgProcessingTime: number };\r\n    pendingItems: Array<{ id: string; context: string; priority: string; queuedAt: string }>;\r\n    database?: {\r\n      pendingCount: number;\r\n      processingCount: number;\r\n      retryPendingCount: number;\r\n      completedToday: number;\r\n      failedToday: number;\r\n      avgProcessingTimeMs: number;\r\n      totalCostTodayUsd: number;\r\n    };\r\n  }\r\n\r\n  async function loadQueueStatus(): Promise<void> {\r\n    const statusContent = container.querySelector('#queue-status-content');\r\n    const itemsContent = container.querySelector('#queue-items-content');\r\n    const pendingCount = container.querySelector('#pending-count');\r\n    const dbStatusBadge = container.querySelector('#db-status-badge');\r\n    \r\n    try {\r\n      const response = await http.get<QueueStatusData>('/api/llm/queue/status');\r\n      const data = response.data;\r\n      \r\n      // Update DB status badge\r\n      if (dbStatusBadge) {\r\n        if (data.database) {\r\n          dbStatusBadge.className = 'badge badge-success';\r\n          dbStatusBadge.textContent = 'DB: Connected';\r\n        } else {\r\n          dbStatusBadge.className = 'badge badge-warning';\r\n          dbStatusBadge.textContent = 'DB: Memory Only';\r\n        }\r\n      }\r\n      \r\n      // Update status\r\n      if (statusContent) {\r\n        const statusColor = data.isPaused ? 'var(--warning)' : (data.isProcessing ? 'var(--success)' : 'var(--text-tertiary)');\r\n        const statusText = data.isPaused ? ' PAUSED' : (data.isProcessing ? ' PROCESSING' : ' IDLE');\r\n        \r\n        statusContent.innerHTML = `\r\n          <div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;\">\r\n            <div>\r\n              <div style=\"font-size: 28px; font-weight: bold; color: ${statusColor};\">${statusText}</div>\r\n              <div style=\"font-size: 12px; color: var(--text-tertiary); margin-top: 4px;\">Queue Status</div>\r\n            </div>\r\n            <div>\r\n              <div style=\"font-size: 28px; font-weight: bold;\">${data.queueLength}</div>\r\n              <div style=\"font-size: 12px; color: var(--text-tertiary); margin-top: 4px;\">Items in Queue</div>\r\n            </div>\r\n            <div>\r\n              <div style=\"font-size: 28px; font-weight: bold; color: var(--primary);\">${data.isProcessing ? '1' : '0'}</div>\r\n              <div style=\"font-size: 12px; color: var(--text-tertiary); margin-top: 4px;\">Processing Now</div>\r\n            </div>\r\n          </div>\r\n          ${data.currentRequest ? `\r\n            <div style=\"margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px; text-align: left;\">\r\n              <strong>Currently Processing:</strong> ${data.currentRequest.context || 'Unknown'} \r\n              <span style=\"color: var(--text-tertiary);\">(Priority: ${data.currentRequest.priority})</span>\r\n              <span style=\"color: var(--text-tertiary); font-size: 11px; margin-left: 8px;\">Started: ${new Date(data.currentRequest.startedAt).toLocaleTimeString()}</span>\r\n            </div>\r\n          ` : ''}\r\n        `;\r\n      }\r\n      \r\n      // Update pending items\r\n      if (itemsContent && pendingCount) {\r\n        const pendingLen = data.pendingItems?.length || 0;\r\n        pendingCount.textContent = `${pendingLen} items`;\r\n        \r\n        if (pendingLen > 0) {\r\n          itemsContent.innerHTML = `\r\n            <table style=\"width: 100%; font-size: 13px;\">\r\n              <thead>\r\n                <tr style=\"text-align: left; color: var(--text-tertiary); border-bottom: 1px solid var(--border);\">\r\n                  <th style=\"padding: 8px;\">Context</th>\r\n                  <th style=\"padding: 8px;\">Priority</th>\r\n                  <th style=\"padding: 8px;\">Queued</th>\r\n                  <th style=\"padding: 8px;\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                ${data.pendingItems.map(item => `\r\n                  <tr style=\"border-bottom: 1px solid var(--border-light);\">\r\n                    <td style=\"padding: 8px;\">${item.context || 'Unknown'}</td>\r\n                    <td style=\"padding: 8px;\"><span class=\"badge badge-${item.priority}\">${item.priority}</span></td>\r\n                    <td style=\"padding: 8px;\">${new Date(item.queuedAt).toLocaleTimeString()}</td>\r\n                    <td style=\"padding: 8px;\"><button class=\"btn-sm btn-danger\" data-cancel-item=\"${item.id}\">Cancel</button></td>\r\n                  </tr>\r\n                `).join('')}\r\n              </tbody>\r\n            </table>\r\n          `;\r\n        } else {\r\n          itemsContent.innerHTML = '<div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">No items in queue</div>';\r\n        }\r\n      }\r\n      \r\n      // Update stats\r\n      const db = data.database;\r\n      const statPending = container.querySelector('#stat-pending');\r\n      const statProcessing = container.querySelector('#stat-processing');\r\n      const statSuccess = container.querySelector('#stat-success');\r\n      const statFailed = container.querySelector('#stat-failed');\r\n      const statRetry = container.querySelector('#stat-retry');\r\n      const statAvgTime = container.querySelector('#stat-avg-time');\r\n      const statCost = container.querySelector('#stat-cost');\r\n      \r\n      if (statPending) statPending.textContent = String(db?.pendingCount || data.queueLength || 0);\r\n      if (statProcessing) statProcessing.textContent = String(db?.processingCount || (data.isProcessing ? 1 : 0));\r\n      if (statSuccess) statSuccess.textContent = String(db?.completedToday || data.stats?.successful || 0);\r\n      if (statFailed) statFailed.textContent = String(db?.failedToday || data.stats?.failed || 0);\r\n      if (statRetry) statRetry.textContent = String(db?.retryPendingCount || 0);\r\n      if (statAvgTime) statAvgTime.textContent = String(Math.round(db?.avgProcessingTimeMs || data.stats?.avgProcessingTime || 0));\r\n      if (statCost) statCost.textContent = `$${(db?.totalCostTodayUsd || 0).toFixed(4)}`;\r\n      \r\n    } catch (error) {\r\n      console.error('Failed to load queue status:', error);\r\n      if (statusContent) {\r\n        statusContent.innerHTML = '<div style=\"color: var(--error);\">Failed to load queue status</div>';\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Load queue history\r\n  async function loadQueueHistory(): Promise<void> {\r\n    const historyContent = container.querySelector('#queue-history-content');\r\n    \r\n    try {\r\n      const response = await http.get<{\r\n        history: Array<{\r\n          id: string;\r\n          context: string;\r\n          priority: string;\r\n          status: string;\r\n          processingTime: number;\r\n          completedAt: string;\r\n          provider?: string;\r\n          model?: string;\r\n          inputTokens?: number;\r\n          outputTokens?: number;\r\n          estimatedCost?: number;\r\n          error?: string;\r\n        }>;\r\n      }>('/api/llm/queue/history?limit=50');\r\n      \r\n      const history = response.data?.history || [];\r\n      \r\n      if (historyContent) {\r\n        if (history.length > 0) {\r\n          historyContent.innerHTML = `\r\n            <table style=\"width: 100%; font-size: 12px;\">\r\n              <thead>\r\n                <tr style=\"text-align: left; color: var(--text-tertiary); border-bottom: 1px solid var(--border);\">\r\n                  <th style=\"padding: 6px;\">Context</th>\r\n                  <th style=\"padding: 6px;\">Provider/Model</th>\r\n                  <th style=\"padding: 6px;\">Status</th>\r\n                  <th style=\"padding: 6px;\">Tokens</th>\r\n                  <th style=\"padding: 6px;\">Time</th>\r\n                  <th style=\"padding: 6px;\">Completed</th>\r\n                  <th style=\"padding: 6px;\">Details</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                ${history.map(item => `\r\n                  <tr style=\"border-bottom: 1px solid var(--border-light);\">\r\n                    <td style=\"padding: 6px; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\" title=\"${item.context || ''}\">${item.context || 'Unknown'}</td>\r\n                    <td style=\"padding: 6px; font-size: 11px; color: var(--text-secondary);\">${item.provider || '-'}/${item.model || '-'}</td>\r\n                    <td style=\"padding: 6px;\">\r\n                      <span style=\"color: ${item.status === 'completed' ? 'var(--success)' : 'var(--error)'};\">\r\n                        ${item.status === 'completed' ? '' : ''}\r\n                      </span>\r\n                      ${item.error ? `<span style=\"font-size: 10px; color: var(--error);\" title=\"${item.error}\">Error</span>` : ''}\r\n                    </td>\r\n                    <td style=\"padding: 6px; font-size: 11px;\">${item.inputTokens || '-'}/${item.outputTokens || '-'}</td>\r\n                    <td style=\"padding: 6px;\">${item.processingTime || '-'}ms</td>\r\n                    <td style=\"padding: 6px; font-size: 11px;\">${item.completedAt ? new Date(item.completedAt).toLocaleString() : '-'}</td>\r\n                    <td style=\"padding: 6px;\"><button class=\"btn-sm\" data-view-request=\"${item.id}\">View</button></td>\r\n                  </tr>\r\n                `).join('')}\r\n              </tbody>\r\n            </table>\r\n          `;\r\n        } else {\r\n          historyContent.innerHTML = '<div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">No processing history yet</div>';\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load queue history:', error);\r\n      if (historyContent) {\r\n        historyContent.innerHTML = '<div style=\"color: var(--error);\">Failed to load history</div>';\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Show request details modal\r\n  async function showRequestDetails(requestId: string): Promise<void> {\r\n    try {\r\n      const response = await http.get<{\r\n        success: boolean;\r\n        request: {\r\n          id: string;\r\n          context: string;\r\n          request_type: string;\r\n          provider: string;\r\n          model: string;\r\n          status: string;\r\n          priority: string;\r\n          input_data: Record<string, unknown>;\r\n          output_data: Record<string, unknown> | null;\r\n          output_text: string | null;\r\n          input_tokens: number | null;\r\n          output_tokens: number | null;\r\n          total_tokens: number | null;\r\n          estimated_cost_usd: number | null;\r\n          processing_time_ms: number | null;\r\n          attempt_count: number;\r\n          max_attempts: number;\r\n          last_error: string | null;\r\n          error_details: Record<string, unknown> | null;\r\n          queued_at: string;\r\n          started_at: string | null;\r\n          completed_at: string | null;\r\n        };\r\n      }>(`/api/llm/queue/${requestId}`);\r\n      \r\n      if (!response.data.success || !response.data.request) {\r\n        toast.error('Request not found');\r\n        return;\r\n      }\r\n      \r\n      const req = response.data.request;\r\n      \r\n      // Escape HTML in strings to prevent XSS and template breaking\r\n      const escapeHtml = (str: string | null | undefined): string => {\r\n        if (!str) return '';\r\n        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\r\n      };\r\n      \r\n      // Format JSON with syntax highlighting\r\n      const formatJsonHtml = (obj: unknown): string => {\r\n        const json = JSON.stringify(obj, null, 2);\r\n        return escapeHtml(json)\r\n          .replace(/\"([^\"]+)\":/g, '<span style=\"color: #0550ae;\">\"$1\"</span>:')\r\n          .replace(/: \"([^\"]*)\"/g, ': <span style=\"color: #0a3069;\">\"$1\"</span>')\r\n          .replace(/: (\\d+)/g, ': <span style=\"color: #0550ae;\">$1</span>')\r\n          .replace(/: (true|false|null)/g, ': <span style=\"color: #cf222e;\">$1</span>');\r\n      };\r\n      \r\n      // Format prompt text for readability\r\n      const formatPromptText = (text: string | null | undefined): string => {\r\n        if (!text) return '<span style=\"color: var(--text-tertiary);\">(No content)</span>';\r\n        return escapeHtml(text)\r\n          .replace(/\\\\n/g, '\\n')\r\n          .replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>')\r\n          .replace(/^(#{1,3})\\s*(.+)$/gm, '<span style=\"color: var(--accent); font-weight: 600;\">$2</span>')\r\n          .replace(/^[-]\\s*(.+)$/gm, '   $1')\r\n          .replace(/---+/g, '<hr style=\"border: none; border-top: 1px solid var(--border); margin: 8px 0;\">');\r\n      };\r\n      \r\n      // Get status color and icon\r\n      const getStatusInfo = (status: string) => {\r\n        const statusMap: Record<string, { color: string; icon: string; bg: string }> = {\r\n          completed: { color: 'var(--success)', icon: '', bg: 'rgba(34, 197, 94, 0.1)' },\r\n          failed: { color: 'var(--error)', icon: '', bg: 'rgba(239, 68, 68, 0.1)' },\r\n          processing: { color: 'var(--warning)', icon: '', bg: 'rgba(234, 179, 8, 0.1)' },\r\n          pending: { color: 'var(--text-secondary)', icon: '', bg: 'var(--bg-tertiary)' },\r\n          retry_pending: { color: 'var(--warning)', icon: '', bg: 'rgba(234, 179, 8, 0.1)' },\r\n          cancelled: { color: 'var(--text-tertiary)', icon: '', bg: 'var(--bg-tertiary)' }\r\n        };\r\n        return statusMap[status] || { color: 'var(--text-primary)', icon: '?', bg: 'var(--bg-secondary)' };\r\n      };\r\n      \r\n      const statusInfo = getStatusInfo(req.status);\r\n      const inputData = (req.input_data || {}) as Record<string, unknown>;\r\n      const messages = inputData.messages as Array<{ content?: string }> | undefined;\r\n      const promptText = (inputData.prompt as string) || messages?.[0]?.content || '';\r\n      \r\n      // Create modal - using unique ID to avoid duplicates\r\n      const existingModal = document.getElementById('llm-request-details-modal');\r\n      if (existingModal) {\r\n        existingModal.remove();\r\n      }\r\n      \r\n      const modal = document.createElement('div');\r\n      modal.id = 'llm-request-details-modal';\r\n      modal.className = 'modal open';\r\n      modal.style.cssText = 'display: flex !important; z-index: 999999 !important;';\r\n      modal.innerHTML = `\r\n        <div class=\"modal-content\" style=\"max-width: 900px; width: 95%;\">\r\n          <div class=\"modal-header\">\r\n            <div style=\"display: flex; align-items: center; gap: 12px;\">\r\n              <span style=\"font-size: 24px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: ${statusInfo.bg}; border-radius: 8px; color: ${statusInfo.color};\">${statusInfo.icon}</span>\r\n              <div>\r\n                <h3 style=\"margin: 0;\">LLM Request Details</h3>\r\n                <span style=\"font-size: 12px; color: var(--text-tertiary);\">ID: ${req.id}</span>\r\n              </div>\r\n            </div>\r\n            <button class=\"modal-close\">&times;</button>\r\n          </div>\r\n          \r\n          <div class=\"modal-body\" style=\"max-height: 70vh; overflow-y: auto;\">\r\n            <!-- Status Bar -->\r\n            <div style=\"display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 24px; padding: 16px; background: var(--bg-tertiary); border-radius: 12px;\">\r\n              <div style=\"flex: 1; min-width: 120px;\">\r\n                <div style=\"font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Context</div>\r\n                <div style=\"font-weight: 600; font-size: 16px; color: var(--accent);\">${req.context || 'Unknown'}</div>\r\n              </div>\r\n              <div style=\"flex: 1; min-width: 120px;\">\r\n                <div style=\"font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Provider</div>\r\n                <div style=\"font-weight: 600; font-size: 16px;\">${req.provider || '-'}</div>\r\n              </div>\r\n              <div style=\"flex: 1; min-width: 120px;\">\r\n                <div style=\"font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Model</div>\r\n                <div style=\"font-weight: 600; font-size: 14px; font-family: monospace;\">${req.model || '-'}</div>\r\n              </div>\r\n              <div style=\"flex: 1; min-width: 100px;\">\r\n                <div style=\"font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Status</div>\r\n                <div style=\"display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; background: ${statusInfo.bg}; border-radius: 12px; color: ${statusInfo.color}; font-weight: 600; font-size: 13px;\">\r\n                  ${statusInfo.icon} ${req.status}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- Metrics -->\r\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 24px;\">\r\n              <div style=\"text-align: center; padding: 16px; background: var(--bg-secondary); border-radius: 8px;\">\r\n                <div style=\"font-size: 24px; font-weight: 700; color: var(--text-primary);\">${req.input_tokens?.toLocaleString() || '-'}</div>\r\n                <div style=\"font-size: 11px; color: var(--text-tertiary);\">Input Tokens</div>\r\n              </div>\r\n              <div style=\"text-align: center; padding: 16px; background: var(--bg-secondary); border-radius: 8px;\">\r\n                <div style=\"font-size: 24px; font-weight: 700; color: var(--text-primary);\">${req.output_tokens?.toLocaleString() || '-'}</div>\r\n                <div style=\"font-size: 11px; color: var(--text-tertiary);\">Output Tokens</div>\r\n              </div>\r\n              <div style=\"text-align: center; padding: 16px; background: var(--bg-secondary); border-radius: 8px;\">\r\n                <div style=\"font-size: 24px; font-weight: 700; color: var(--text-primary);\">${req.processing_time_ms ? `${(req.processing_time_ms / 1000).toFixed(1)}s` : '-'}</div>\r\n                <div style=\"font-size: 11px; color: var(--text-tertiary);\">Duration</div>\r\n              </div>\r\n              <div style=\"text-align: center; padding: 16px; background: var(--bg-secondary); border-radius: 8px;\">\r\n                <div style=\"font-size: 24px; font-weight: 700; color: ${req.estimated_cost_usd ? 'var(--success)' : 'var(--text-tertiary)'};\">$${req.estimated_cost_usd?.toFixed(4) || '-'}</div>\r\n                <div style=\"font-size: 11px; color: var(--text-tertiary);\">Est. Cost</div>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- Timeline -->\r\n            <div style=\"display: flex; gap: 24px; margin-bottom: 24px; padding: 12px 16px; background: var(--bg-secondary); border-radius: 8px; font-size: 12px; flex-wrap: wrap;\">\r\n              <div><strong style=\"color: var(--text-tertiary);\">Queued:</strong> ${req.queued_at ? new Date(req.queued_at).toLocaleString() : '-'}</div>\r\n              <div><strong style=\"color: var(--text-tertiary);\">Started:</strong> ${req.started_at ? new Date(req.started_at).toLocaleString() : '-'}</div>\r\n              <div><strong style=\"color: var(--text-tertiary);\">Completed:</strong> ${req.completed_at ? new Date(req.completed_at).toLocaleString() : '-'}</div>\r\n            </div>\r\n            \r\n            ${req.last_error ? `\r\n              <div style=\"background: rgba(239, 68, 68, 0.1); border: 1px solid var(--error); border-radius: 8px; padding: 16px; margin-bottom: 24px;\">\r\n                <div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 8px;\">\r\n                  <span style=\"color: var(--error); font-size: 18px;\"></span>\r\n                  <strong style=\"color: var(--error);\">Error</strong>\r\n                  <span style=\"font-size: 12px; color: var(--text-tertiary);\">(Attempt ${req.attempt_count}/${req.max_attempts})</span>\r\n                </div>\r\n                <div style=\"font-size: 13px; color: var(--error); font-family: monospace; white-space: pre-wrap;\">${escapeHtml(req.last_error)}</div>\r\n              </div>\r\n            ` : ''}\r\n            \r\n            <!-- Prompt / Input -->\r\n            <div style=\"margin-bottom: 24px;\">\r\n              <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;\">\r\n                <h4 style=\"margin: 0; display: flex; align-items: center; gap: 8px;\">\r\n                  <span style=\"font-size: 16px;\"></span> Prompt / Input\r\n                </h4>\r\n                <button class=\"btn btn-sm btn-secondary\" id=\"copy-input-btn\">Copy</button>\r\n              </div>\r\n              <div style=\"background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; max-height: 250px; overflow-y: auto; font-size: 13px; line-height: 1.6; white-space: pre-wrap; font-family: inherit;\" id=\"input-display\">${formatPromptText(promptText as string)}</div>\r\n            </div>\r\n            \r\n            <!-- Output -->\r\n            <div style=\"margin-bottom: 24px;\">\r\n              <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;\">\r\n                <h4 style=\"margin: 0; display: flex; align-items: center; gap: 8px;\">\r\n                  <span style=\"font-size: 16px;\"></span> Response\r\n                </h4>\r\n                <button class=\"btn btn-sm btn-secondary\" id=\"copy-output-btn\">Copy</button>\r\n              </div>\r\n              <div style=\"background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; max-height: 350px; overflow-y: auto; font-size: 13px; line-height: 1.6; white-space: pre-wrap;\" id=\"output-display\">${formatPromptText(req.output_text)}</div>\r\n            </div>\r\n            \r\n            <!-- Raw Data Toggle -->\r\n            <details style=\"margin-bottom: 16px;\">\r\n              <summary style=\"cursor: pointer; font-weight: 600; padding: 12px; background: var(--bg-secondary); border-radius: 8px; user-select: none;\">\r\n                <span style=\"margin-left: 8px;\"> Raw Data (JSON)</span>\r\n              </summary>\r\n              <div style=\"margin-top: 12px;\">\r\n                <div style=\"margin-bottom: 16px;\">\r\n                  <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\r\n                    <span style=\"font-size: 12px; font-weight: 600; color: var(--text-secondary);\">Input Data</span>\r\n                    <button class=\"btn btn-xs btn-secondary\" id=\"copy-input-json-btn\">Copy JSON</button>\r\n                  </div>\r\n                  <pre style=\"background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; overflow-x: auto; font-size: 11px; max-height: 200px; overflow-y: auto; margin: 0;\">${formatJsonHtml(req.input_data)}</pre>\r\n                </div>\r\n                ${req.output_data ? `\r\n                  <div>\r\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\r\n                      <span style=\"font-size: 12px; font-weight: 600; color: var(--text-secondary);\">Output Data</span>\r\n                      <button class=\"btn btn-xs btn-secondary\" id=\"copy-output-json-btn\">Copy JSON</button>\r\n                    </div>\r\n                    <pre style=\"background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; overflow-x: auto; font-size: 11px; max-height: 200px; overflow-y: auto; margin: 0;\">${formatJsonHtml(req.output_data)}</pre>\r\n                  </div>\r\n                ` : ''}\r\n              </div>\r\n            </details>\r\n          </div>\r\n          \r\n          <div class=\"modal-footer\">\r\n            <button class=\"btn btn-secondary modal-close-btn\">Close</button>\r\n          </div>\r\n        </div>\r\n      `;\r\n      \r\n      document.body.appendChild(modal);\r\n      \r\n      // Close handlers\r\n      modal.querySelector('.modal-close')?.addEventListener('click', () => modal.remove());\r\n      modal.querySelector('.modal-close-btn')?.addEventListener('click', () => modal.remove());\r\n      modal.addEventListener('click', (e) => {\r\n        if (e.target === modal) modal.remove();\r\n      });\r\n      \r\n      // ESC key to close\r\n      const handleEsc = (e: KeyboardEvent) => {\r\n        if (e.key === 'Escape') {\r\n          modal.remove();\r\n          document.removeEventListener('keydown', handleEsc);\r\n        }\r\n      };\r\n      document.addEventListener('keydown', handleEsc);\r\n      \r\n      // Copy handlers\r\n      modal.querySelector('#copy-input-btn')?.addEventListener('click', () => {\r\n        const text = promptText || JSON.stringify(req.input_data, null, 2);\r\n        navigator.clipboard.writeText(text as string);\r\n        toast.success('Input copied to clipboard');\r\n      });\r\n      modal.querySelector('#copy-output-btn')?.addEventListener('click', () => {\r\n        navigator.clipboard.writeText(req.output_text || '');\r\n        toast.success('Response copied to clipboard');\r\n      });\r\n      modal.querySelector('#copy-input-json-btn')?.addEventListener('click', () => {\r\n        navigator.clipboard.writeText(JSON.stringify(req.input_data, null, 2));\r\n        toast.success('Input JSON copied to clipboard');\r\n      });\r\n      modal.querySelector('#copy-output-json-btn')?.addEventListener('click', () => {\r\n        navigator.clipboard.writeText(JSON.stringify(req.output_data, null, 2));\r\n        toast.success('Output JSON copied to clipboard');\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error('Failed to load request details:', error);\r\n      toast.error('Failed to load request details');\r\n    }\r\n  }\r\n  \r\n  // Load failed items\r\n  async function loadFailedItems(): Promise<void> {\r\n    const failedContent = container.querySelector('#failed-items-content');\r\n    \r\n    try {\r\n      const response = await http.get<{\r\n        items: Array<{\r\n          id: string;\r\n          context: string;\r\n          priority: string;\r\n          provider?: string;\r\n          model?: string;\r\n          attemptCount: number;\r\n          maxAttempts: number;\r\n          canRetry: boolean;\r\n          error?: string;\r\n          completedAt?: string;\r\n        }>;\r\n      }>('/api/llm/queue/retryable?limit=20');\r\n      \r\n      const items = response.data?.items || [];\r\n      \r\n      if (failedContent) {\r\n        if (items.length > 0) {\r\n          failedContent.innerHTML = `\r\n            <table style=\"width: 100%; font-size: 12px;\">\r\n              <thead>\r\n                <tr style=\"text-align: left; color: var(--text-tertiary); border-bottom: 1px solid var(--border);\">\r\n                  <th style=\"padding: 6px;\">Context</th>\r\n                  <th style=\"padding: 6px;\">Provider</th>\r\n                  <th style=\"padding: 6px;\">Attempts</th>\r\n                  <th style=\"padding: 6px;\">Error</th>\r\n                  <th style=\"padding: 6px;\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                ${items.map(item => `\r\n                  <tr style=\"border-bottom: 1px solid var(--border-light);\">\r\n                    <td style=\"padding: 6px;\">${item.context || 'Unknown'}</td>\r\n                    <td style=\"padding: 6px; font-size: 11px;\">${item.provider || '-'}</td>\r\n                    <td style=\"padding: 6px;\">${item.attemptCount}/${item.maxAttempts}</td>\r\n                    <td style=\"padding: 6px; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--error);\" title=\"${item.error || ''}\">${item.error || '-'}</td>\r\n                    <td style=\"padding: 6px;\">\r\n                      <button class=\"btn-sm btn-primary\" data-retry-item=\"${item.id}\" ${!item.canRetry ? 'disabled' : ''}> Retry</button>\r\n                      <button class=\"btn-sm\" data-retry-reset-item=\"${item.id}\" style=\"margin-left: 4px;\">Reset & Retry</button>\r\n                    </td>\r\n                  </tr>\r\n                `).join('')}\r\n              </tbody>\r\n            </table>\r\n          `;\r\n        } else {\r\n          failedContent.innerHTML = '<div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">No failed items</div>';\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load failed items:', error);\r\n      if (failedContent) {\r\n        failedContent.innerHTML = '<div style=\"color: var(--error);\">Failed to load failed items</div>';\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Refresh queue status button\r\n  const refreshStatusBtn = container.querySelector('#refresh-queue-status');\r\n  if (refreshStatusBtn) {\r\n    on(refreshStatusBtn as HTMLElement, 'click', loadQueueStatus);\r\n  }\r\n  \r\n  // Refresh history button\r\n  const refreshHistoryBtn = container.querySelector('#refresh-queue-history');\r\n  if (refreshHistoryBtn) {\r\n    on(refreshHistoryBtn as HTMLElement, 'click', loadQueueHistory);\r\n  }\r\n  \r\n  // Refresh failed button\r\n  const refreshFailedBtn = container.querySelector('#refresh-failed-btn');\r\n  if (refreshFailedBtn) {\r\n    on(refreshFailedBtn as HTMLElement, 'click', loadFailedItems);\r\n  }\r\n  \r\n  // Retry all failed items\r\n  const retryAllBtn = container.querySelector('#retry-all-btn');\r\n  if (retryAllBtn) {\r\n    on(retryAllBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        // Get all retryable items and retry them\r\n        const response = await http.get<{ items: Array<{ id: string; canRetry: boolean }> }>('/api/llm/queue/retryable?limit=50');\r\n        const items = (response.data?.items || []).filter(i => i.canRetry);\r\n        \r\n        let successCount = 0;\r\n        for (const item of items) {\r\n          try {\r\n            await http.post(`/api/llm/queue/${item.id}/retry`, { resetAttempts: false });\r\n            successCount++;\r\n          } catch {\r\n            // Continue with others\r\n          }\r\n        }\r\n        \r\n        toast.success(`Queued ${successCount} items for retry`);\r\n        loadQueueStatus();\r\n        loadFailedItems();\r\n      } catch (error) {\r\n        toast.error('Failed to retry items');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Pause queue button\r\n  const pauseBtn = container.querySelector('#queue-pause-btn');\r\n  if (pauseBtn) {\r\n    on(pauseBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        await http.post('/api/llm/queue/pause');\r\n        toast.success('Queue paused');\r\n        loadQueueStatus();\r\n      } catch (error) {\r\n        toast.error('Failed to pause queue');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Resume queue button\r\n  const resumeBtn = container.querySelector('#queue-resume-btn');\r\n  if (resumeBtn) {\r\n    on(resumeBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        await http.post('/api/llm/queue/resume');\r\n        toast.success('Queue resumed');\r\n        loadQueueStatus();\r\n      } catch (error) {\r\n        toast.error('Failed to resume queue');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Clear queue button\r\n  const clearBtn = container.querySelector('#queue-clear-btn');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', async () => {\r\n      if (confirm('Are you sure you want to clear all pending items from the queue?')) {\r\n        try {\r\n          await http.post('/api/llm/queue/clear');\r\n          toast.success('Queue cleared');\r\n          loadQueueStatus();\r\n        } catch (error) {\r\n          toast.error('Failed to clear queue');\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Cancel individual item, retry handlers, and view details\r\n  container.addEventListener('click', async (e) => {\r\n    const target = e.target as HTMLElement;\r\n    \r\n    // View request details - use closest to handle click on button or its content\r\n    const viewBtn = target.closest('[data-view-request]') as HTMLElement | null;\r\n    if (viewBtn) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      const viewId = viewBtn.getAttribute('data-view-request');\r\n      if (viewId) {\r\n        showRequestDetails(viewId);\r\n      }\r\n      return;\r\n    }\r\n    \r\n    // Cancel pending item\r\n    const cancelBtn = target.closest('[data-cancel-item]') as HTMLElement | null;\r\n    if (cancelBtn) {\r\n      const cancelId = cancelBtn.getAttribute('data-cancel-item');\r\n      if (cancelId) {\r\n        try {\r\n          await http.delete(`/api/llm/queue/${cancelId}`);\r\n          toast.success('Item cancelled');\r\n          loadQueueStatus();\r\n        } catch (error) {\r\n          toast.error('Failed to cancel item');\r\n        }\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // Retry failed item\r\n    const retryBtn = target.closest('[data-retry-item]') as HTMLElement | null;\r\n    if (retryBtn) {\r\n      const retryId = retryBtn.getAttribute('data-retry-item');\r\n      if (retryId) {\r\n        try {\r\n          await http.post(`/api/llm/queue/${retryId}/retry`, { resetAttempts: false });\r\n          toast.success('Item queued for retry');\r\n          loadQueueStatus();\r\n          loadFailedItems();\r\n        } catch (error) {\r\n          toast.error('Failed to retry item');\r\n        }\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // Retry with reset\r\n    const retryResetBtn = target.closest('[data-retry-reset-item]') as HTMLElement | null;\r\n    if (retryResetBtn) {\r\n      const retryResetId = retryResetBtn.getAttribute('data-retry-reset-item');\r\n      if (retryResetId) {\r\n        try {\r\n          await http.post(`/api/llm/queue/${retryResetId}/retry`, { resetAttempts: true });\r\n          toast.success('Item queued for retry (attempts reset)');\r\n          loadQueueStatus();\r\n          loadFailedItems();\r\n        } catch (error) {\r\n          toast.error('Failed to retry item');\r\n        }\r\n        return;\r\n      }\r\n    }\r\n  });\r\n  \r\n  // ============ Models Section Handlers ============\r\n  \r\n  // Load metadata sync status\r\n  async function loadMetadataSyncStatus(): Promise<void> {\r\n    const statusDiv = container.querySelector('#metadata-sync-status');\r\n    const countsDiv = container.querySelector('#provider-model-counts');\r\n    \r\n    try {\r\n      const response = await http.get<{\r\n        success: boolean;\r\n        providers: Array<{\r\n          provider: string;\r\n          active_models: number;\r\n          text_models: number;\r\n          embedding_models: number;\r\n          vision_models: number;\r\n          last_synced: string | null;\r\n        }>;\r\n      }>('/api/llm/metadata/status');\r\n      \r\n      const providers = response.data?.providers || [];\r\n      \r\n      if (statusDiv) {\r\n        if (providers.length > 0) {\r\n          statusDiv.innerHTML = `\r\n            <table style=\"width: 100%; font-size: 13px;\">\r\n              <thead>\r\n                <tr style=\"text-align: left; color: var(--text-tertiary); border-bottom: 1px solid var(--border);\">\r\n                  <th style=\"padding: 8px;\">Provider</th>\r\n                  <th style=\"padding: 8px;\">Text</th>\r\n                  <th style=\"padding: 8px;\">Vision</th>\r\n                  <th style=\"padding: 8px;\">Embeddings</th>\r\n                  <th style=\"padding: 8px;\">Total</th>\r\n                  <th style=\"padding: 8px;\">Last Synced</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                ${providers.map(p => `\r\n                  <tr style=\"border-bottom: 1px solid var(--border-light);\">\r\n                    <td style=\"padding: 8px; font-weight: 600; text-transform: capitalize;\">${p.provider}</td>\r\n                    <td style=\"padding: 8px;\">${p.text_models || 0}</td>\r\n                    <td style=\"padding: 8px;\">${p.vision_models || 0}</td>\r\n                    <td style=\"padding: 8px;\">${p.embedding_models || 0}</td>\r\n                    <td style=\"padding: 8px; font-weight: 600;\">${p.active_models || 0}</td>\r\n                    <td style=\"padding: 8px; font-size: 11px; color: var(--text-tertiary);\">${p.last_synced ? new Date(p.last_synced).toLocaleString() : 'Never'}</td>\r\n                  </tr>\r\n                `).join('')}\r\n              </tbody>\r\n            </table>\r\n          `;\r\n        } else {\r\n          statusDiv.innerHTML = '<div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">No metadata found. Click \"Sync All Providers\" to fetch model data.</div>';\r\n        }\r\n      }\r\n      \r\n      // Update counts display\r\n      if (countsDiv && providers.length > 0) {\r\n        const total = providers.reduce((sum, p) => sum + (p.active_models || 0), 0);\r\n        countsDiv.innerHTML = `\r\n          <div style=\"display: flex; flex-wrap: wrap; gap: 12px;\">\r\n            ${providers.map(p => `\r\n              <div style=\"flex: 1; min-width: 120px; text-align: center; padding: 16px; background: var(--bg-tertiary); border-radius: 8px;\">\r\n                <div style=\"font-size: 24px; font-weight: 700;\">${p.active_models || 0}</div>\r\n                <div style=\"font-size: 12px; color: var(--text-tertiary); text-transform: capitalize;\">${p.provider}</div>\r\n              </div>\r\n            `).join('')}\r\n            <div style=\"flex: 1; min-width: 120px; text-align: center; padding: 16px; background: var(--accent); border-radius: 8px; color: white;\">\r\n              <div style=\"font-size: 24px; font-weight: 700;\">${total}</div>\r\n              <div style=\"font-size: 12px; opacity: 0.9;\">Total Models</div>\r\n            </div>\r\n          </div>\r\n        `;\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load metadata status:', error);\r\n      if (statusDiv) {\r\n        statusDiv.innerHTML = '<div style=\"color: var(--error);\">Failed to load metadata status</div>';\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Sync all metadata\r\n  const syncAllBtn = container.querySelector('#sync-all-metadata-btn');\r\n  if (syncAllBtn) {\r\n    on(syncAllBtn as HTMLElement, 'click', async () => {\r\n      const resultDiv = container.querySelector('#metadata-sync-result');\r\n      (syncAllBtn as HTMLButtonElement).disabled = true;\r\n      (syncAllBtn as HTMLButtonElement).textContent = 'Syncing...';\r\n      \r\n      try {\r\n        const response = await http.post<{\r\n          success: boolean;\r\n          providers: Record<string, { status: string; models?: number; synced?: number; error?: string; reason?: string }>;\r\n          totalModels: number;\r\n          errors: Array<{ provider: string; error: string }>;\r\n        }>('/api/llm/metadata/sync', {});\r\n        \r\n        if (resultDiv) {\r\n          (resultDiv as HTMLElement).style.display = 'block';\r\n          const providers = response.data?.providers || {};\r\n          const entries = Object.entries(providers);\r\n          \r\n          resultDiv.innerHTML = `\r\n            <div style=\"padding: 16px; background: var(--bg-tertiary); border-radius: 8px;\">\r\n              <div style=\"font-weight: 600; margin-bottom: 12px;\">Sync Results</div>\r\n              <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\r\n                ${entries.map(([provider, result]) => `\r\n                  <div style=\"padding: 8px 12px; background: ${result.status === 'success' ? 'rgba(34, 197, 94, 0.1)' : result.status === 'skipped' ? 'var(--bg-secondary)' : 'rgba(239, 68, 68, 0.1)'}; border-radius: 6px; font-size: 12px;\">\r\n                    <span style=\"font-weight: 600; text-transform: capitalize;\">${provider}</span>\r\n                    ${result.status === 'success' ? `<span style=\"color: var(--success);\">  ${result.synced} models</span>` : ''}\r\n                    ${result.status === 'skipped' ? `<span style=\"color: var(--text-tertiary);\"> - ${result.reason}</span>` : ''}\r\n                    ${result.status === 'error' ? `<span style=\"color: var(--error);\">  ${result.error}</span>` : ''}\r\n                  </div>\r\n                `).join('')}\r\n              </div>\r\n              <div style=\"margin-top: 12px; font-size: 13px; color: var(--success);\">\r\n                Total: ${response.data?.totalModels || 0} models synced\r\n              </div>\r\n            </div>\r\n          `;\r\n        }\r\n        \r\n        toast.success(`Synced ${response.data?.totalModels || 0} models`);\r\n        loadMetadataSyncStatus();\r\n        \r\n      } catch (error) {\r\n        toast.error('Failed to sync metadata');\r\n        if (resultDiv) {\r\n          (resultDiv as HTMLElement).style.display = 'block';\r\n          resultDiv.innerHTML = '<div style=\"color: var(--error);\">Sync failed. Check console for details.</div>';\r\n        }\r\n      } finally {\r\n        (syncAllBtn as HTMLButtonElement).disabled = false;\r\n        (syncAllBtn as HTMLButtonElement).textContent = ' Sync All Providers';\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Browse models by provider\r\n  const browseModelsBtn = container.querySelector('#browse-models-btn');\r\n  if (browseModelsBtn) {\r\n    on(browseModelsBtn as HTMLElement, 'click', async () => {\r\n      const providerSelect = container.querySelector('#browse-provider-select') as HTMLSelectElement;\r\n      const contentDiv = container.querySelector('#models-browser-content');\r\n      const provider = providerSelect?.value;\r\n      \r\n      if (!provider) {\r\n        toast.info('Please select a provider');\r\n        return;\r\n      }\r\n      \r\n      if (contentDiv) {\r\n        contentDiv.innerHTML = '<div style=\"text-align: center; padding: 20px;\">Loading models...</div>';\r\n      }\r\n      \r\n      try {\r\n        const response = await http.get<{\r\n          success: boolean;\r\n          textModels: Array<{ model_id: string; display_name: string; context_tokens: number; price_input: number; price_output: number }>;\r\n          visionModels: Array<{ model_id: string; display_name: string }>;\r\n          embeddingModels: Array<{ model_id: string; display_name: string }>;\r\n        }>(`/api/llm/metadata/${provider}`);\r\n        \r\n        const { textModels = [], visionModels = [], embeddingModels = [] } = response.data || {};\r\n        \r\n        if (contentDiv) {\r\n          if (textModels.length === 0 && embeddingModels.length === 0) {\r\n            contentDiv.innerHTML = '<div style=\"text-align: center; padding: 40px; color: var(--text-tertiary);\">No models found for this provider. Try syncing first.</div>';\r\n          } else {\r\n            contentDiv.innerHTML = `\r\n              <div style=\"display: grid; gap: 16px;\">\r\n                ${textModels.length > 0 ? `\r\n                  <div>\r\n                    <h5 style=\"margin-bottom: 8px; color: var(--text-secondary);\">Text Models (${textModels.length})</h5>\r\n                    <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 8px;\">\r\n                      ${textModels.map(m => `\r\n                        <div style=\"padding: 12px; background: var(--bg-tertiary); border-radius: 8px; font-size: 12px;\">\r\n                          <div style=\"font-weight: 600; margin-bottom: 4px;\">${m.display_name || m.model_id}</div>\r\n                          <div style=\"color: var(--text-tertiary); font-family: monospace; font-size: 11px;\">${m.model_id}</div>\r\n                          <div style=\"margin-top: 8px; display: flex; gap: 12px; color: var(--text-secondary);\">\r\n                            <span title=\"Context Window\"> ${m.context_tokens ? (m.context_tokens / 1000).toFixed(0) + 'K' : '-'}</span>\r\n                            <span title=\"Input Price\"> $${m.price_input?.toFixed(2) || '-'}/1M</span>\r\n                            <span title=\"Output Price\"> $${m.price_output?.toFixed(2) || '-'}/1M</span>\r\n                          </div>\r\n                        </div>\r\n                      `).join('')}\r\n                    </div>\r\n                  </div>\r\n                ` : ''}\r\n                ${embeddingModels.length > 0 ? `\r\n                  <div>\r\n                    <h5 style=\"margin-bottom: 8px; color: var(--text-secondary);\">Embedding Models (${embeddingModels.length})</h5>\r\n                    <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\r\n                      ${embeddingModels.map(m => `\r\n                        <div style=\"padding: 8px 12px; background: var(--bg-tertiary); border-radius: 6px; font-size: 12px;\">\r\n                          ${m.display_name || m.model_id}\r\n                        </div>\r\n                      `).join('')}\r\n                    </div>\r\n                  </div>\r\n                ` : ''}\r\n              </div>\r\n            `;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        if (contentDiv) {\r\n          contentDiv.innerHTML = '<div style=\"color: var(--error);\">Failed to load models</div>';\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Auto-load metadata status if on models section\r\n  if (currentSection === 'models') {\r\n    loadMetadataSyncStatus();\r\n  }\r\n  \r\n  // Auto-load queue data if on queue section\r\n  if (currentSection === 'queue') {\r\n    loadQueueStatus();\r\n    loadQueueHistory();\r\n    loadFailedItems();\r\n  }\r\n\r\n  // Save graph config (Supabase Graph)\r\n  const saveGraphBtn = container.querySelector('#save-graph-config');\r\n  if (saveGraphBtn) {\r\n    on(saveGraphBtn as HTMLElement, 'click', async () => {\r\n      // Build the graph config object for Supabase Graph\r\n      const graphConfigValue = {\r\n        enabled: (container.querySelector('#graph-enabled') as HTMLInputElement)?.checked ?? true,\r\n        provider: 'supabase', // Always use Supabase graph\r\n        graphName: (container.querySelector('#graph-name') as HTMLInputElement)?.value || 'godmode',\r\n      };\r\n\r\n      try {\r\n        // Save as a single 'graph' key with the config object\r\n        await saveConfig('graph', graphConfigValue, 'graph');\r\n        \r\n        toast.success('Graph configuration saved!');\r\n        console.log('[AdminPanel] Saved graph config:', graphConfigValue);\r\n      } catch (error) {\r\n        console.error('[AdminPanel] Error saving graph config:', error);\r\n        toast.error('Failed to save graph configuration');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Test graph connection (Supabase Graph)\r\n  const testGraphBtn = container.querySelector('#test-graph-connection');\r\n  if (testGraphBtn) {\r\n    on(testGraphBtn as HTMLElement, 'click', async () => {\r\n      (testGraphBtn as HTMLElement).textContent = 'Testing...';\r\n      try {\r\n        // Supabase graph uses existing Supabase connection\r\n        const testConfig = {\r\n          provider: 'supabase',\r\n          graphName: (container.querySelector('#graph-name') as HTMLInputElement)?.value || 'godmode',\r\n        };\r\n        \r\n        console.log('[AdminPanel] Testing Supabase graph connection');\r\n        \r\n        const response = await http.post<{ success: boolean; ok?: boolean; message?: string; error?: string }>('/api/graph/test', testConfig);\r\n        if (response.data.success || response.data.ok) {\r\n          toast.success('Supabase graph connection successful!');\r\n        } else {\r\n          toast.error(response.data.message || response.data.error || 'Connection failed');\r\n        }\r\n      } catch (error) {\r\n        console.error('[AdminPanel] Graph test error:', error);\r\n        toast.error('Graph connection test failed');\r\n      }\r\n      (testGraphBtn as HTMLElement).textContent = 'Test Connection';\r\n    });\r\n  }\r\n\r\n  // Load graph overview\r\n  const loadGraphOverviewBtn = container.querySelector('#load-graph-overview');\r\n  if (loadGraphOverviewBtn) {\r\n    on(loadGraphOverviewBtn as HTMLElement, 'click', async () => {\r\n      await loadGraphOverview();\r\n      renderAdminPanel(container);\r\n    });\r\n  }\r\n  const refreshGraphOverviewBtn = container.querySelector('#refresh-graph-overview');\r\n  if (refreshGraphOverviewBtn) {\r\n    on(refreshGraphOverviewBtn as HTMLElement, 'click', async () => {\r\n      await loadGraphOverview();\r\n      renderAdminPanel(container);\r\n      toast.info('Graph overview refreshed');\r\n    });\r\n  }\r\n  const openGraphTabBtn = container.querySelector('#open-graph-tab');\r\n  if (openGraphTabBtn) {\r\n    on(openGraphTabBtn as HTMLElement, 'click', () => {\r\n      document.querySelector('.nav-item[data-tab=\"graph\"]')?.dispatchEvent(new MouseEvent('click', { bubbles: true }));\r\n    });\r\n  }\r\n\r\n  // Load ontology\r\n  const loadOntologyBtn = container.querySelector('#load-ontology');\r\n  if (loadOntologyBtn) {\r\n    on(loadOntologyBtn as HTMLElement, 'click', async () => {\r\n      await loadOntologyData();\r\n      renderAdminPanel(container);\r\n    });\r\n  }\r\n  const reloadOntologyBtn = container.querySelector('#reload-ontology');\r\n  if (reloadOntologyBtn) {\r\n    on(reloadOntologyBtn as HTMLElement, 'click', async () => {\r\n      ontologyLoaded = false;\r\n      await loadOntologyData();\r\n      renderAdminPanel(container);\r\n      toast.info('Ontology reloaded');\r\n    });\r\n  }\r\n\r\n  // Save prompts\r\n  const savePromptsBtn = container.querySelector('#save-prompts');\r\n  if (savePromptsBtn) {\r\n    on(savePromptsBtn as HTMLElement, 'click', async () => {\r\n      const promptElements = container.querySelectorAll('[data-prompt-key]');\r\n      let savedCount = 0;\r\n      \r\n      for (const textarea of promptElements) {\r\n        const key = textarea.getAttribute('data-prompt-key')!;\r\n        const value = (textarea as HTMLTextAreaElement).value;\r\n        \r\n        if (value && value.trim()) {\r\n          try {\r\n            await http.put(`/api/system/prompts/${key}`, { prompt_template: value.trim() });\r\n            savedCount++;\r\n            \r\n            // Update status indicator\r\n            const statusEl = container.querySelector(`#status-${key}`);\r\n            if (statusEl) {\r\n              statusEl.textContent = ' Saved';\r\n              statusEl.className = 'prompt-status saved';\r\n            }\r\n          } catch (error) {\r\n            console.warn(`Failed to save prompt ${key}:`, error);\r\n            const statusEl = container.querySelector(`#status-${key}`);\r\n            if (statusEl) {\r\n              statusEl.textContent = ' Error';\r\n              statusEl.className = 'prompt-status error';\r\n            }\r\n          }\r\n        }\r\n      }\r\n      \r\n      if (savedCount > 0) {\r\n        toast.success(`${savedCount} prompt(s) saved successfully`);\r\n      } else {\r\n        toast.info('No prompts to save');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Reload prompts\r\n  const reloadPromptsBtn = container.querySelector('#reload-prompts');\r\n  if (reloadPromptsBtn) {\r\n    on(reloadPromptsBtn as HTMLElement, 'click', async () => {\r\n      await loadSystemPrompts();\r\n      renderAdminPanel(container);\r\n      toast.info('Prompts reloaded from database');\r\n    });\r\n  }\r\n\r\n  // View version history\r\n  container.querySelectorAll('[data-view-versions]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const key = btn.getAttribute('data-view-versions')!;\r\n      const historyDiv = container.querySelector(`#versions-${key}`) as HTMLElement;\r\n      const listDiv = historyDiv?.querySelector('.version-list') as HTMLElement;\r\n      \r\n      if (!historyDiv || !listDiv) return;\r\n      \r\n      // Toggle visibility\r\n      if (!historyDiv.classList.contains('hidden')) {\r\n        historyDiv.classList.add('hidden');\r\n        return;\r\n      }\r\n      \r\n      // Load versions\r\n      listDiv.innerHTML = '<p class=\"text-muted\">Loading versions...</p>';\r\n      historyDiv.classList.remove('hidden');\r\n      \r\n      try {\r\n        const response = await http.get<{ current_version: number; versions: Array<{ id: string; version: number; created_at: string }> }>(`/api/system/prompts/${key}/versions`);\r\n        const versions = response.data?.versions || [];\r\n        const currentVersion = response.data?.current_version || 1;\r\n        \r\n        if (versions.length === 0) {\r\n          listDiv.innerHTML = `\r\n            <p class=\"text-muted\">No previous versions. Current version: ${currentVersion}</p>\r\n            <p class=\"text-sm text-muted\">Versions are saved automatically when you edit a prompt.</p>\r\n          `;\r\n          return;\r\n        }\r\n        \r\n        listDiv.innerHTML = `\r\n          <p class=\"text-sm\"><strong>Current version:</strong> ${currentVersion}</p>\r\n          <div class=\"version-items\">\r\n            ${versions.map(v => `\r\n              <div class=\"version-item\">\r\n                <div class=\"version-info\">\r\n                  <span class=\"version-number\">v${v.version}</span>\r\n                  <span class=\"version-date\">${new Date(v.created_at).toLocaleString()}</span>\r\n                </div>\r\n                <div class=\"version-actions\">\r\n                  <button class=\"btn-sm\" data-preview-version=\"${key}:${v.version}\">Preview</button>\r\n                  <button class=\"btn-sm btn-primary\" data-restore-version=\"${key}:${v.version}\">Restore</button>\r\n                </div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        `;\r\n        \r\n        // Bind restore buttons\r\n        listDiv.querySelectorAll('[data-restore-version]').forEach(restoreBtn => {\r\n          on(restoreBtn as HTMLElement, 'click', async () => {\r\n            const [promptKey, versionStr] = restoreBtn.getAttribute('data-restore-version')!.split(':');\r\n            const version = parseInt(versionStr, 10);\r\n            \r\n            if (!confirm(`Restore prompt \"${promptKey}\" to version ${version}? The current version will be saved in history.`)) {\r\n              return;\r\n            }\r\n            \r\n            try {\r\n              await http.post(`/api/system/prompts/${promptKey}/restore`, { version });\r\n              toast.success(`Restored to version ${version}`);\r\n              await loadSystemPrompts();\r\n              renderAdminPanel(container);\r\n            } catch (error) {\r\n              toast.error('Failed to restore version');\r\n            }\r\n          });\r\n        });\r\n        \r\n        // Bind preview buttons\r\n        listDiv.querySelectorAll('[data-preview-version]').forEach(previewBtn => {\r\n          on(previewBtn as HTMLElement, 'click', async () => {\r\n            const [promptKey, versionStr] = previewBtn.getAttribute('data-preview-version')!.split(':');\r\n            const version = parseInt(versionStr, 10);\r\n            \r\n            try {\r\n              const response = await http.get<{ version: { prompt_template: string } }>(`/api/system/prompts/${promptKey}/versions/${version}`);\r\n              const template = response.data?.version?.prompt_template || '';\r\n              \r\n              // Show in a modal or alert for now\r\n              const previewModal = document.createElement('div');\r\n              previewModal.className = 'modal-overlay';\r\n              previewModal.innerHTML = `\r\n                <div class=\"modal-content\" style=\"max-width: 800px; max-height: 80vh; overflow: auto;\">\r\n                  <div class=\"modal-header\">\r\n                    <h3>Version ${version} Preview</h3>\r\n                    <button class=\"modal-close\">&times;</button>\r\n                  </div>\r\n                  <div class=\"modal-body\">\r\n                    <pre style=\"white-space: pre-wrap; font-size: 12px; background: var(--bg-tertiary); padding: 1rem; border-radius: 8px;\">${template.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>\r\n                  </div>\r\n                </div>\r\n              `;\r\n              document.body.appendChild(previewModal);\r\n              \r\n              previewModal.querySelector('.modal-close')?.addEventListener('click', () => {\r\n                previewModal.remove();\r\n              });\r\n              previewModal.addEventListener('click', (e) => {\r\n                if (e.target === previewModal) previewModal.remove();\r\n              });\r\n            } catch (error) {\r\n              toast.error('Failed to load version preview');\r\n            }\r\n          });\r\n        });\r\n        \r\n      } catch (error) {\r\n        listDiv.innerHTML = '<p class=\"text-error\">Failed to load version history</p>';\r\n      }\r\n    });\r\n  });\r\n\r\n  // Save processing\r\n  const saveProcBtn = container.querySelector('#save-processing');\r\n  if (saveProcBtn) {\r\n    on(saveProcBtn as HTMLElement, 'click', async () => {\r\n      await saveConfig('chunk_size', parseInt((container.querySelector('#proc-chunk-size') as HTMLInputElement)?.value || '1000'), 'processing');\r\n      await saveConfig('chunk_overlap', parseInt((container.querySelector('#proc-chunk-overlap') as HTMLInputElement)?.value || '200'), 'processing');\r\n      await saveConfig('max_tokens', parseInt((container.querySelector('#proc-max-tokens') as HTMLInputElement)?.value || '4096'), 'processing');\r\n      await saveConfig('temperature', parseFloat((container.querySelector('#proc-temperature') as HTMLInputElement)?.value || '0.7'), 'processing');\r\n      await saveConfig('auto_process', (container.querySelector('#proc-auto-process') as HTMLInputElement)?.checked, 'processing');\r\n      await saveConfig('parallel_jobs', parseInt((container.querySelector('#proc-parallel-jobs') as HTMLInputElement)?.value || '3'), 'processing');\r\n    });\r\n  }\r\n\r\n  // Save Team Analysis settings\r\n  const saveTeamAnalysisBtn = container.querySelector('#save-team-analysis');\r\n  if (saveTeamAnalysisBtn) {\r\n    on(saveTeamAnalysisBtn as HTMLElement, 'click', async () => {\r\n      const enabled = (container.querySelector('#team-analysis-enabled') as HTMLInputElement)?.checked ?? true;\r\n      const access = (container.querySelector('#team-analysis-access') as HTMLSelectElement)?.value || 'admin_only';\r\n      await saveTeamAnalysisSettings(enabled, access);\r\n      renderAdminPanel(container);\r\n    });\r\n  }\r\n\r\n  // Refresh audit\r\n  const refreshAuditBtn = container.querySelector('#refresh-audit');\r\n  if (refreshAuditBtn) {\r\n    on(refreshAuditBtn as HTMLElement, 'click', async () => {\r\n      await loadAuditLogs();\r\n      renderAdminPanel(container);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Render admin panel\r\n */\r\nfunction renderAdminPanel(container: HTMLElement): void {\r\n  container.innerHTML = `\r\n    <div class=\"admin-panel\">\r\n      <div class=\"admin-header\">\r\n        <div class=\"admin-header-content\">\r\n          <div class=\"admin-icon\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"32\" height=\"32\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/>\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n            </svg>\r\n          </div>\r\n          <div class=\"admin-title\">\r\n            <h2>Platform Administration</h2>\r\n            <p>System configuration for superadmins</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"admin-body\">\r\n        <nav class=\"admin-nav\">\r\n          ${renderNav()}\r\n        </nav>\r\n\r\n        <main class=\"admin-content\">\r\n          ${isLoading ? '<div class=\"loading-spinner\">Loading...</div>' : renderSectionContent()}\r\n        </main>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  bindSectionEvents(container);\r\n}\r\n\r\n/**\r\n * Initialize and mount admin panel\r\n */\r\nexport async function initAdminPanel(container: HTMLElement): Promise<void> {\r\n  // Check if user is superadmin\r\n  const state = appStore.getState();\r\n  if (state.currentUser?.role !== 'superadmin') {\r\n    container.innerHTML = `\r\n      <div class=\"admin-panel\">\r\n        <div class=\"admin-header\">\r\n          <h2>Access Denied</h2>\r\n          <p>You need superadmin privileges to access this section.</p>\r\n        </div>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  isLoading = true;\r\n  renderAdminPanel(container);\r\n\r\n  // Load data\r\n  await Promise.all([\r\n    loadSystemConfig(),\r\n    loadProviders(),\r\n    loadAuditLogs(),\r\n    loadSystemPrompts(),\r\n    loadSecrets(),\r\n  ]);\r\n\r\n  isLoading = false;\r\n  renderAdminPanel(container);\r\n}\r\n\r\nexport default initAdminPanel;\r\n","/**\r\n * History Panel Component\r\n * Display processing history timeline\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { formatRelativeTime, formatDate } from '../utils/format';\r\nimport { toast } from '../services/toast';\r\n\r\nexport interface HistoryEntry {\r\n  id: string;\r\n  action: 'create' | 'update' | 'delete' | 'restore' | 'process' | 'upload';\r\n  entityType: string;\r\n  entityId: string;\r\n  entityName?: string;\r\n  changes?: Record<string, { old: unknown; new: unknown }>;\r\n  actor: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n  };\r\n  timestamp: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface HistoryPanelProps {\r\n  onRestore?: (entry: HistoryEntry) => void;\r\n  onExport?: () => void;\r\n}\r\n\r\nlet entries: HistoryEntry[] = [];\r\nlet page = 1;\r\nlet hasMore = true;\r\nlet loading = false;\r\nlet currentFilters = {\r\n  action: '' as string,\r\n  entityType: '' as string,\r\n  dateFrom: '' as string,\r\n  dateTo: '' as string,\r\n};\r\n\r\n/**\r\n * Create history panel\r\n */\r\nexport function createHistoryPanel(props: HistoryPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'history-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"history-filters\">\r\n      <select id=\"history-action-filter\" class=\"filter-select\">\r\n        <option value=\"\">All Actions</option>\r\n        <option value=\"create\">Created</option>\r\n        <option value=\"update\">Updated</option>\r\n        <option value=\"delete\">Deleted</option>\r\n        <option value=\"restore\">Restored</option>\r\n        <option value=\"process\">Processed</option>\r\n        <option value=\"upload\">Uploaded</option>\r\n      </select>\r\n      <select id=\"history-entity-filter\" class=\"filter-select\">\r\n        <option value=\"\">All Types</option>\r\n        <option value=\"document\">Documents</option>\r\n        <option value=\"fact\">Facts</option>\r\n        <option value=\"question\">Questions</option>\r\n        <option value=\"risk\">Risks</option>\r\n        <option value=\"action\">Actions</option>\r\n        <option value=\"decision\">Decisions</option>\r\n        <option value=\"contact\">Contacts</option>\r\n        <option value=\"email\">Emails</option>\r\n      </select>\r\n      <input type=\"date\" id=\"history-date-from\" class=\"filter-date\" placeholder=\"From\">\r\n      <input type=\"date\" id=\"history-date-to\" class=\"filter-date\" placeholder=\"To\">\r\n      <button class=\"btn btn-sm\" id=\"history-clear-filters\">Clear</button>\r\n    </div>\r\n    <div class=\"history-content\" id=\"history-content\">\r\n      <div class=\"loading\">Loading history...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind filter events\r\n  bindFilters(panel, props);\r\n\r\n  // Initial load\r\n  loadHistory(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Bind filter event handlers\r\n */\r\nfunction bindFilters(panel: HTMLElement, props: HistoryPanelProps): void {\r\n  const actionFilter = panel.querySelector('#history-action-filter') as HTMLSelectElement;\r\n  const entityFilter = panel.querySelector('#history-entity-filter') as HTMLSelectElement;\r\n  const dateFromInput = panel.querySelector('#history-date-from') as HTMLInputElement;\r\n  const dateToInput = panel.querySelector('#history-date-to') as HTMLInputElement;\r\n  const clearBtn = panel.querySelector('#history-clear-filters') as HTMLButtonElement;\r\n\r\n  const applyFilters = () => {\r\n    currentFilters = {\r\n      action: actionFilter.value,\r\n      entityType: entityFilter.value,\r\n      dateFrom: dateFromInput.value,\r\n      dateTo: dateToInput.value,\r\n    };\r\n    entries = [];\r\n    page = 1;\r\n    hasMore = true;\r\n    loadHistory(panel, props);\r\n  };\r\n\r\n  on(actionFilter, 'change', applyFilters);\r\n  on(entityFilter, 'change', applyFilters);\r\n  on(dateFromInput, 'change', applyFilters);\r\n  on(dateToInput, 'change', applyFilters);\r\n\r\n  on(clearBtn, 'click', () => {\r\n    actionFilter.value = '';\r\n    entityFilter.value = '';\r\n    dateFromInput.value = '';\r\n    dateToInput.value = '';\r\n    applyFilters();\r\n  });\r\n}\r\n\r\n/**\r\n * Load history entries\r\n */\r\nasync function loadHistory(panel: HTMLElement, props: HistoryPanelProps): Promise<void> {\r\n  if (loading) return;\r\n\r\n  const content = panel.querySelector('#history-content') as HTMLElement;\r\n  \r\n  if (page === 1) {\r\n    content.innerHTML = '<div class=\"loading\">Loading history...</div>';\r\n  }\r\n\r\n  loading = true;\r\n\r\n  try {\r\n    const params = new URLSearchParams({ page: String(page), limit: '30' });\r\n    if (currentFilters.action) params.set('action', currentFilters.action);\r\n    if (currentFilters.entityType) params.set('entityType', currentFilters.entityType);\r\n    if (currentFilters.dateFrom) params.set('dateFrom', currentFilters.dateFrom);\r\n    if (currentFilters.dateTo) params.set('dateTo', currentFilters.dateTo);\r\n\r\n    const response = await http.get<{ entries: HistoryEntry[]; hasMore: boolean }>(\r\n      `/api/history?${params}`\r\n    );\r\n\r\n    entries = page === 1 ? response.data.entries : [...entries, ...response.data.entries];\r\n    hasMore = response.data.hasMore;\r\n    page++;\r\n\r\n    renderHistory(content, props);\r\n  } catch {\r\n    if (page === 1) {\r\n      content.innerHTML = '<div class=\"error\">Failed to load history</div>';\r\n    }\r\n  } finally {\r\n    loading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Render history timeline\r\n */\r\nfunction renderHistory(container: HTMLElement, props: HistoryPanelProps): void {\r\n  if (entries.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <span class=\"empty-icon\"></span>\r\n        <p>No history entries found</p>\r\n        <span class=\"empty-hint\">Processing and editing activity will appear here</span>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  // Group by date\r\n  const grouped = groupByDate(entries);\r\n\r\n  container.innerHTML = `\r\n    <div class=\"history-timeline\">\r\n      ${Object.entries(grouped).map(([date, items]) => `\r\n        <div class=\"history-date-group\">\r\n          <div class=\"history-date-header\">${date}</div>\r\n          <div class=\"history-items\">\r\n            ${items.map(entry => renderEntry(entry, props)).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    ${hasMore ? `\r\n      <div class=\"history-load-more\">\r\n        <button class=\"btn btn-secondary\" id=\"load-more-history\">Load More</button>\r\n      </div>\r\n    ` : `\r\n      <div class=\"history-end\">\r\n        <span>End of history</span>\r\n      </div>\r\n    `}\r\n  `;\r\n\r\n  // Bind load more\r\n  const loadMoreBtn = container.querySelector('#load-more-history');\r\n  if (loadMoreBtn) {\r\n    on(loadMoreBtn as HTMLElement, 'click', async () => {\r\n      const panel = container.closest('.history-panel') as HTMLElement;\r\n      await loadHistory(panel, props);\r\n    });\r\n  }\r\n\r\n  // Bind expand buttons\r\n  container.querySelectorAll('[data-action=\"expand\"]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const changesEl = btn.closest('.history-entry')?.querySelector('.history-changes');\r\n      if (changesEl) {\r\n        changesEl.classList.toggle('expanded');\r\n        btn.textContent = changesEl.classList.contains('expanded') ? 'Hide details' : 'Show details';\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bind restore buttons\r\n  if (props.onRestore) {\r\n    container.querySelectorAll('[data-action=\"restore\"]').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => {\r\n        const entryId = btn.getAttribute('data-entry-id');\r\n        const entry = entries.find(e => e.id === entryId);\r\n        if (entry && props.onRestore) {\r\n          props.onRestore(entry);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Render single entry\r\n */\r\nfunction renderEntry(entry: HistoryEntry, props: HistoryPanelProps): string {\r\n  const actionIcons: Record<string, string> = {\r\n    create: '',\r\n    update: '',\r\n    delete: '',\r\n    restore: '',\r\n    process: '',\r\n    upload: '',\r\n  };\r\n\r\n  const actionColors: Record<string, string> = {\r\n    create: 'success',\r\n    update: 'info',\r\n    delete: 'danger',\r\n    restore: 'warning',\r\n    process: 'info',\r\n    upload: 'success',\r\n  };\r\n\r\n  const hasChanges = entry.changes && Object.keys(entry.changes).length > 0;\r\n\r\n  return `\r\n    <div class=\"history-entry ${actionColors[entry.action] || 'info'}\" data-entry-id=\"${entry.id}\">\r\n      <div class=\"history-icon\">${actionIcons[entry.action] || ''}</div>\r\n      <div class=\"history-content\">\r\n        <div class=\"history-summary\">\r\n          <strong>${escapeHtml(entry.actor.name)}</strong>\r\n          ${getActionVerb(entry.action)}\r\n          <span class=\"entity-type\">${entry.entityType}</span>\r\n          ${entry.entityName ? `\"${escapeHtml(entry.entityName)}\"` : ''}\r\n        </div>\r\n        <div class=\"history-time\">${formatRelativeTime(entry.timestamp)}</div>\r\n        \r\n        ${hasChanges ? `\r\n          <div class=\"history-changes\">\r\n            ${Object.entries(entry.changes!).slice(0, 5).map(([field, change]) => `\r\n              <div class=\"change-item\">\r\n                <span class=\"change-field\">${formatFieldName(field)}:</span>\r\n                <span class=\"change-old\">${formatValue(change.old)}</span>\r\n                <span class=\"change-arrow\"></span>\r\n                <span class=\"change-new\">${formatValue(change.new)}</span>\r\n              </div>\r\n            `).join('')}\r\n            ${Object.keys(entry.changes!).length > 5 ? `<div class=\"change-more\">+${Object.keys(entry.changes!).length - 5} more changes</div>` : ''}\r\n          </div>\r\n          <button class=\"btn-link\" data-action=\"expand\">Show details</button>\r\n        ` : ''}\r\n        \r\n        ${entry.action === 'delete' && props.onRestore ? `\r\n          <button class=\"btn btn-sm btn-secondary\" data-action=\"restore\" data-entry-id=\"${entry.id}\">\r\n            Restore\r\n          </button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get action verb\r\n */\r\nfunction getActionVerb(action: string): string {\r\n  const verbs: Record<string, string> = {\r\n    create: 'created',\r\n    update: 'updated',\r\n    delete: 'deleted',\r\n    restore: 'restored',\r\n    process: 'processed',\r\n    upload: 'uploaded',\r\n  };\r\n  return verbs[action] || action;\r\n}\r\n\r\n/**\r\n * Group entries by date\r\n */\r\nfunction groupByDate(items: HistoryEntry[]): Record<string, HistoryEntry[]> {\r\n  const groups: Record<string, HistoryEntry[]> = {};\r\n  const today = new Date().toDateString();\r\n  const yesterday = new Date(Date.now() - 86400000).toDateString();\r\n\r\n  items.forEach(item => {\r\n    const itemDate = new Date(item.timestamp);\r\n    let dateLabel: string;\r\n    \r\n    if (itemDate.toDateString() === today) {\r\n      dateLabel = 'Today';\r\n    } else if (itemDate.toDateString() === yesterday) {\r\n      dateLabel = 'Yesterday';\r\n    } else {\r\n      dateLabel = itemDate.toLocaleDateString(undefined, { \r\n        weekday: 'long', \r\n        month: 'long', \r\n        day: 'numeric' \r\n      });\r\n    }\r\n\r\n    if (!groups[dateLabel]) {\r\n      groups[dateLabel] = [];\r\n    }\r\n    groups[dateLabel].push(item);\r\n  });\r\n\r\n  return groups;\r\n}\r\n\r\n/**\r\n * Format field name\r\n */\r\nfunction formatFieldName(field: string): string {\r\n  return field\r\n    .replace(/_/g, ' ')\r\n    .replace(/([A-Z])/g, ' $1')\r\n    .replace(/^./, str => str.toUpperCase());\r\n}\r\n\r\n/**\r\n * Format value for display\r\n */\r\nfunction formatValue(value: unknown): string {\r\n  if (value === null || value === undefined) return '(empty)';\r\n  if (typeof value === 'boolean') return value ? 'Yes' : 'No';\r\n  if (typeof value === 'object') {\r\n    const str = JSON.stringify(value);\r\n    return str.length > 50 ? str.substring(0, 47) + '...' : str;\r\n  }\r\n  const str = String(value);\r\n  return str.length > 50 ? str.substring(0, 47) + '...' : str;\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Export history\r\n */\r\nexport async function exportHistory(format: 'json' | 'csv' = 'json'): Promise<void> {\r\n  try {\r\n    const params = new URLSearchParams({ format, limit: '1000' });\r\n    if (currentFilters.action) params.set('action', currentFilters.action);\r\n    if (currentFilters.entityType) params.set('entityType', currentFilters.entityType);\r\n    if (currentFilters.dateFrom) params.set('dateFrom', currentFilters.dateFrom);\r\n    if (currentFilters.dateTo) params.set('dateTo', currentFilters.dateTo);\r\n\r\n    const response = await fetch(`/api/history/export?${params}`);\r\n    const blob = await response.blob();\r\n    \r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `history-export.${format}`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n    \r\n    toast.success('History exported successfully');\r\n  } catch {\r\n    toast.error('Failed to export history');\r\n  }\r\n}\r\n\r\nexport default createHistoryPanel;\r\n","/**\r\n * Legacy Bridge\r\n * Provides compatibility layer for legacy index.html code\r\n * \r\n * This module exposes the new modular services and stores as global\r\n * variables that match the original monolithic code's expectations.\r\n */\r\n\r\nimport { appStore, Project, User } from '../stores/app';\r\nimport { uiStore } from '../stores/ui';\r\nimport { dataStore, Question, Risk, Action, Decision, Contact } from '../stores/data';\r\nimport { chartsStore } from '../stores/charts';\r\nimport { http, api } from '../services/api';\r\nimport type { ChatMessage } from '../stores/data';\r\nimport type { MainTab } from '../stores/ui';\r\nimport { toast } from '../services/toast';\r\nimport { theme } from '../services/theme';\r\nimport { storage } from '../services/storage';\r\nimport { shortcuts } from '../services/shortcuts';\r\nimport { undoManager } from '../services/undo';\r\n\r\n// ============================================================================\r\n// Global Variable Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy global variable getters/setters\r\n * These provide compatibility with code that expects global variables\r\n */\r\n\r\n// Current project (was: currentProject)\r\nObject.defineProperty(window, 'currentProject', {\r\n  get: () => appStore.getState().currentProject,\r\n  set: (value: Project | null) => appStore.setCurrentProject(value),\r\n  configurable: true,\r\n});\r\n\r\n// Current project ID (was: currentProjectId)\r\nObject.defineProperty(window, 'currentProjectId', {\r\n  get: () => appStore.getState().currentProjectId,\r\n  set: (value: string | null) => appStore.setCurrentProjectId(value),\r\n  configurable: true,\r\n});\r\n\r\n// Current user (was: currentUser)\r\nObject.defineProperty(window, 'currentUser', {\r\n  get: () => appStore.getState().currentUser,\r\n  set: (value: User | null) => appStore.setCurrentUser(value),\r\n  configurable: true,\r\n});\r\n\r\n// Auth configured (was: authConfigured)\r\nObject.defineProperty(window, 'authConfigured', {\r\n  get: () => appStore.getState().authConfigured,\r\n  set: (value: boolean) => appStore.setAuthConfigured(value),\r\n  configurable: true,\r\n});\r\n\r\n// Current tab (was: currentTab)\r\nObject.defineProperty(window, 'currentTab', {\r\n  get: () => uiStore.getState().currentTab,\r\n  set: (value: MainTab) => uiStore.setTab(value),\r\n  configurable: true,\r\n});\r\n\r\n// Questions (was: questions)\r\nObject.defineProperty(window, 'questions', {\r\n  get: () => dataStore.getState().questions,\r\n  set: (value: Question[]) => dataStore.setQuestions(value),\r\n  configurable: true,\r\n});\r\n\r\n// Risks (was: risks)\r\nObject.defineProperty(window, 'risks', {\r\n  get: () => dataStore.getState().risks,\r\n  set: (value: Risk[]) => dataStore.setRisks(value),\r\n  configurable: true,\r\n});\r\n\r\n// Actions (was: actions)\r\nObject.defineProperty(window, 'actions', {\r\n  get: () => dataStore.getState().actions,\r\n  set: (value: Action[]) => dataStore.setActions(value),\r\n  configurable: true,\r\n});\r\n\r\n// Decisions (was: decisions)\r\nObject.defineProperty(window, 'decisions', {\r\n  get: () => dataStore.getState().decisions,\r\n  set: (value: Decision[]) => dataStore.setDecisions(value),\r\n  configurable: true,\r\n});\r\n\r\n// Contacts (was: contacts)\r\nObject.defineProperty(window, 'contacts', {\r\n  get: () => dataStore.getState().contacts,\r\n  set: (value: Contact[]) => dataStore.setContacts(value),\r\n  configurable: true,\r\n});\r\n\r\n// Chat history (was: chatHistory)\r\nObject.defineProperty(window, 'chatHistory', {\r\n  get: () => dataStore.getState().chatHistory,\r\n  set: (value: ChatMessage[]) => dataStore.setChatHistory(value),\r\n  configurable: true,\r\n});\r\n\r\n// ============================================================================\r\n// Legacy Function Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy API function\r\n * Maps to new http service\r\n */\r\n(window as unknown as Record<string, unknown>).api = async function legacyApi(\r\n  endpoint: string,\r\n  method = 'GET',\r\n  body?: unknown\r\n): Promise<unknown> {\r\n  try {\r\n    let response;\r\n    switch (method.toUpperCase()) {\r\n      case 'GET':\r\n        response = await http.get(endpoint);\r\n        break;\r\n      case 'POST':\r\n        response = await http.post(endpoint, body);\r\n        break;\r\n      case 'PUT':\r\n        response = await http.put(endpoint, body);\r\n        break;\r\n      case 'PATCH':\r\n        response = await http.patch(endpoint, body);\r\n        break;\r\n      case 'DELETE':\r\n        response = await http.delete(endpoint);\r\n        break;\r\n      default:\r\n        response = await api(endpoint, { method, body: body ? JSON.stringify(body) : undefined });\r\n    }\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error('API Error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Legacy showToast function\r\n */\r\n(window as unknown as Record<string, unknown>).showToast = function legacyShowToast(\r\n  message: string,\r\n  type: 'success' | 'error' | 'warning' | 'info' = 'info'\r\n): void {\r\n  toast[type](message);\r\n};\r\n\r\n/**\r\n * Legacy setTheme function\r\n */\r\n(window as unknown as Record<string, unknown>).setTheme = function legacySetTheme(\r\n  newTheme: 'light' | 'dark' | 'system'\r\n): void {\r\n  theme.set(newTheme);\r\n};\r\n\r\n/**\r\n * Legacy toggleTheme function\r\n */\r\n(window as unknown as Record<string, unknown>).toggleTheme = function legacyToggleTheme(): void {\r\n  theme.toggle();\r\n};\r\n\r\n/**\r\n * Legacy localStorage wrappers\r\n */\r\n(window as unknown as Record<string, unknown>).getStorageItem = function legacyGetItem(\r\n  key: string,\r\n  defaultValue: unknown = null\r\n): unknown {\r\n  return storage.get(key, defaultValue);\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).setStorageItem = function legacySetItem(\r\n  key: string,\r\n  value: unknown\r\n): void {\r\n  storage.set(key, value);\r\n};\r\n\r\n/**\r\n * Legacy switchTab function\r\n */\r\n(window as unknown as Record<string, unknown>).switchTab = function legacySwitchTab(\r\n  tabName: MainTab\r\n): void {\r\n  uiStore.setTab(tabName);\r\n};\r\n\r\n/**\r\n * Legacy refreshData function\r\n */\r\n(window as unknown as Record<string, unknown>).refreshData = async function legacyRefreshData(): Promise<void> {\r\n  const projectId = appStore.getState().currentProjectId;\r\n  if (!projectId) return;\r\n\r\n  try {\r\n    const [questionsRes, risksRes, actionsRes, decisionsRes, contactsRes] = await Promise.all([\r\n      http.get<Question[]>(`/api/projects/${projectId}/questions`),\r\n      http.get<Risk[]>(`/api/projects/${projectId}/risks`),\r\n      http.get<Action[]>(`/api/projects/${projectId}/actions`),\r\n      http.get<Decision[]>(`/api/projects/${projectId}/decisions`),\r\n      http.get<Contact[]>(`/api/projects/${projectId}/contacts`),\r\n    ]);\r\n\r\n    dataStore.setQuestions(questionsRes.data);\r\n    dataStore.setRisks(risksRes.data);\r\n    dataStore.setActions(actionsRes.data);\r\n    dataStore.setDecisions(decisionsRes.data);\r\n    dataStore.setContacts(contactsRes.data);\r\n  } catch (error) {\r\n    console.error('Failed to refresh data:', error);\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// Chart Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy chart management\r\n */\r\n(window as unknown as Record<string, unknown>).registerChart = function(\r\n  id: string,\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  chart: any,\r\n  selector: string,\r\n  type: 'bar' | 'line' | 'pie' | 'doughnut' | 'radar' = 'bar'\r\n): void {\r\n  chartsStore.registerChart(id, chart, selector, type);\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).destroyChart = function(id: string): void {\r\n  chartsStore.destroyChart(id);\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).getChart = function(id: string): unknown {\r\n  return chartsStore.getChart(id);\r\n};\r\n\r\n// ============================================================================\r\n// Keyboard Shortcuts Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy keyboard shortcut registration\r\n */\r\n(window as unknown as Record<string, unknown>).registerShortcut = function(\r\n  key: string,\r\n  callback: () => void,\r\n  options: { ctrl?: boolean; shift?: boolean; alt?: boolean; description?: string } = {}\r\n): void {\r\n  shortcuts.register({\r\n    key,\r\n    ctrl: options.ctrl,\r\n    shift: options.shift,\r\n    alt: options.alt,\r\n    handler: callback,\r\n    description: options.description || 'Custom shortcut',\r\n  });\r\n};\r\n\r\n// ============================================================================\r\n// Undo/Redo Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy undo/redo\r\n */\r\n(window as unknown as Record<string, unknown>).pushUndoAction = function(\r\n  description: string,\r\n  undo: () => void | Promise<void>,\r\n  redo: () => void | Promise<void>\r\n): void {\r\n  undoManager.push({\r\n    id: `undo-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\r\n    description,\r\n    undo,\r\n    redo,\r\n  });\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).undoLastAction = function(): Promise<boolean> {\r\n  return undoManager.undo();\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).redoLastAction = function(): Promise<boolean> {\r\n  return undoManager.redo();\r\n};\r\n\r\n// ============================================================================\r\n// Export for direct imports\r\n// ============================================================================\r\n\r\nexport function initLegacyBridge(): void {\r\n  console.log('[GodMode] Legacy bridge initialized');\r\n  \r\n  // Initialize app store listeners\r\n  appStore.init();\r\n  \r\n  // Log compatibility mode\r\n  if (process.env.NODE_ENV === 'development') {\r\n    console.log('[GodMode] Running in compatibility mode for legacy code');\r\n  }\r\n}\r\n\r\nexport default initLegacyBridge;\r\n","/**\r\n * GodMode Frontend - Main Entry Point\r\n * \r\n * This file initializes the application and loads all necessary modules.\r\n * Currently in transition phase - gradually migrating from monolithic\r\n * index.html to modular TypeScript structure.\r\n */\r\n\r\n// Import styles\r\nimport './styles/main.css';\r\nimport './styles/graph.css';\r\n\r\n// Import services\r\nimport {\r\n  theme, toast, shortcuts, undoManager, storage, http, api, configureApi, auth, projects,\r\n  addRequestInterceptor,\r\n  dashboardService, questionsService, risksService, actionsService, decisionsService,\r\n  chatService, contactsService, teamsService, documentsService, knowledgeService,\r\n  emailsService, graphService, timelineService, costsService, notificationsService,\r\n  commentsService, membersService, profileService, userSettingsService, projectSettingsService,\r\n  apiKeysService, webhooksService, auditService, factsService\r\n} from './services';\r\n\r\n// Import components\r\nimport { initGlobalSearch, initNotificationsDropdown, showProfileModal } from './components';\r\nimport * as components from './components';\r\nimport { createQuestionDetailView } from './components/questions/QuestionDetailView';\r\nimport { createQuestionsPanel, createFactsPanel, createDecisionsPanel, createRisksPanel, createActionsPanel } from './components/sot';\r\n\r\n// Import stores\r\nimport { appStore, uiStore, dataStore, chartsStore } from './stores';\r\nimport type { Question } from './stores/data';\r\n\r\n// Import legacy bridge for backwards compatibility\r\nimport { initLegacyBridge } from './utils/legacy-bridge';\r\n\r\n// Make services and stores available globally for gradual migration\r\ndeclare global {\r\n  interface Window {\r\n    godmode: {\r\n      // Core Services\r\n      theme: typeof theme;\r\n      toast: typeof toast;\r\n      shortcuts: typeof shortcuts;\r\n      undo: typeof undoManager;\r\n      storage: typeof storage;\r\n      http: typeof http;\r\n      api: typeof api;\r\n      configureApi: typeof configureApi;\r\n      auth: typeof auth;\r\n      projects: typeof projects;\r\n      // Domain Services\r\n      dashboard: typeof dashboardService;\r\n      questions: typeof questionsService;\r\n      risks: typeof risksService;\r\n      actions: typeof actionsService;\r\n      decisions: typeof decisionsService;\r\n      chat: typeof chatService;\r\n      contacts: typeof contactsService;\r\n      teams: typeof teamsService;\r\n      documents: typeof documentsService;\r\n      knowledge: typeof knowledgeService;\r\n      emails: typeof emailsService;\r\n      graph: typeof graphService;\r\n      timeline: typeof timelineService;\r\n      costs: typeof costsService;\r\n      notifications: typeof notificationsService;\r\n      comments: typeof commentsService;\r\n      members: typeof membersService;\r\n      profile: typeof profileService;\r\n      userSettings: typeof userSettingsService;\r\n      projectSettings: typeof projectSettingsService;\r\n      apiKeys: typeof apiKeysService;\r\n      webhooks: typeof webhooksService;\r\n      audit: typeof auditService;\r\n      facts: typeof factsService;\r\n      // Stores\r\n      appStore: typeof appStore;\r\n      uiStore: typeof uiStore;\r\n      dataStore: typeof dataStore;\r\n      chartsStore: typeof chartsStore;\r\n      // Version\r\n      version: string;\r\n    };\r\n  }\r\n}\r\n\r\nwindow.godmode = {\r\n  // Core Services\r\n  theme,\r\n  toast,\r\n  shortcuts,\r\n  undo: undoManager,\r\n  storage,\r\n  http,\r\n  api,\r\n  configureApi,\r\n  auth,\r\n  projects,\r\n  // Domain Services\r\n  dashboard: dashboardService,\r\n  questions: questionsService,\r\n  risks: risksService,\r\n  actions: actionsService,\r\n  decisions: decisionsService,\r\n  chat: chatService,\r\n  contacts: contactsService,\r\n  teams: teamsService,\r\n  documents: documentsService,\r\n  knowledge: knowledgeService,\r\n  emails: emailsService,\r\n  graph: graphService,\r\n  timeline: timelineService,\r\n  costs: costsService,\r\n  notifications: notificationsService,\r\n  comments: commentsService,\r\n  members: membersService,\r\n  profile: profileService,\r\n  userSettings: userSettingsService,\r\n  projectSettings: projectSettingsService,\r\n  apiKeys: apiKeysService,\r\n  webhooks: webhooksService,\r\n  audit: auditService,\r\n  facts: factsService,\r\n  // Stores\r\n  appStore,\r\n  uiStore,\r\n  dataStore,\r\n  chartsStore,\r\n  // Version\r\n  version: '2.0.0',\r\n};\r\n\r\n// Ensure API requests include current project ID for project-scoped endpoints (e.g. costs)\r\naddRequestInterceptor((opts) => {\r\n  const projectId = appStore.getState().currentProjectId;\r\n  if (projectId && opts.headers) {\r\n    (opts.headers as Record<string, string>)['X-Project-Id'] = projectId;\r\n  }\r\n  return opts;\r\n});\r\n\r\n/**\r\n * Register default keyboard shortcuts\r\n */\r\nfunction registerShortcuts(): void {\r\n  // Undo: Ctrl+Z\r\n  shortcuts.register({\r\n    key: 'z',\r\n    ctrl: true,\r\n    description: 'Undo last action',\r\n    handler: async () => {\r\n      if (undoManager.canUndo()) {\r\n        await undoManager.undo();\r\n        toast.info('Undo: ' + (undoManager.getRedoDescription() || 'Action undone'));\r\n      }\r\n    },\r\n  });\r\n\r\n  // Redo: Ctrl+Shift+Z or Ctrl+Y\r\n  shortcuts.register({\r\n    key: 'z',\r\n    ctrl: true,\r\n    shift: true,\r\n    description: 'Redo last action',\r\n    handler: async () => {\r\n      if (undoManager.canRedo()) {\r\n        await undoManager.redo();\r\n        toast.info('Redo: ' + (undoManager.getUndoDescription() || 'Action redone'));\r\n      }\r\n    },\r\n  });\r\n\r\n  // Theme toggle: Ctrl+Shift+T\r\n  shortcuts.register({\r\n    key: 't',\r\n    ctrl: true,\r\n    shift: true,\r\n    description: 'Cycle theme (light/dark/system)',\r\n    handler: () => {\r\n      const newMode = theme.cycle();\r\n      toast.info(`Theme: ${theme.getLabel()}`);\r\n    },\r\n  });\r\n\r\n  // Help: ?\r\n  shortcuts.register({\r\n    key: '?',\r\n    description: 'Show keyboard shortcuts',\r\n    handler: () => {\r\n      shortcuts.showHelp();\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Configure API client\r\n */\r\nfunction configureApiClient(): void {\r\n  // Setup 401 handler for auth redirect\r\n  configureApi({\r\n    onUnauthorized: () => {\r\n      appStore.setCurrentUser(null);\r\n      toast.error('Session expired. Please log in again.');\r\n      // Trigger auth modal via event\r\n      window.dispatchEvent(new CustomEvent('godmode:auth-required'));\r\n    },\r\n    onForbidden: () => {\r\n      toast.error('You do not have permission to perform this action.');\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Initialize UI event handlers\r\n */\r\nfunction initializeUI(): void {\r\n  // Theme toggle button\r\n  const themeToggle = document.getElementById('theme-toggle');\r\n  if (themeToggle) {\r\n    themeToggle.addEventListener('click', () => {\r\n      theme.cycle();\r\n      updateThemeButton();\r\n      toast.info(`Theme: ${theme.getLabel()}`);\r\n    });\r\n    updateThemeButton();\r\n  }\r\n\r\n  // User menu dropdown\r\n  const userAvatar = document.getElementById('user-avatar');\r\n  const userDropdown = document.getElementById('user-dropdown');\r\n  if (userAvatar && userDropdown) {\r\n    userAvatar.addEventListener('click', (e) => {\r\n      e.stopPropagation();\r\n      userDropdown.classList.toggle('hidden');\r\n    });\r\n    document.addEventListener('click', () => {\r\n      userDropdown.classList.add('hidden');\r\n    });\r\n  }\r\n\r\n  // Login button\r\n  const loginBtn = document.getElementById('login-btn');\r\n  if (loginBtn) {\r\n    loginBtn.addEventListener('click', () => {\r\n      components.showAuthModal({\r\n        onSuccess: () => {\r\n          updateAuthUI();\r\n          refreshData();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // Logout button\r\n  const logoutBtn = document.getElementById('logout-btn');\r\n  if (logoutBtn) {\r\n    logoutBtn.addEventListener('click', async () => {\r\n      await auth.logout();\r\n      \r\n      // Clear all data\r\n      dataStore.setQuestions([]);\r\n      dataStore.setRisks([]);\r\n      dataStore.setActions([]);\r\n      dataStore.setDecisions([]);\r\n      dataStore.setContacts([]);\r\n      dataStore.setProjects([]);\r\n      appStore.setCurrentProject(null);\r\n      appStore.setCurrentProjectId(null);\r\n      \r\n      // Update UI\r\n      updateAuthUI();\r\n      updateDashboard();\r\n      \r\n      // Show login screen if auth is configured\r\n      if (appStore.getState().authConfigured) {\r\n        showAuthRequiredMessage();\r\n        toast.info('Signed out successfully');\r\n      } else {\r\n        toast.info('Signed out');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Settings button\r\n  const settingsBtn = document.getElementById('settings-btn');\r\n  if (settingsBtn) {\r\n    settingsBtn.addEventListener('click', () => {\r\n      components.showSettingsModal();\r\n    });\r\n  }\r\n\r\n  // Shortcuts button\r\n  const shortcutsBtn = document.getElementById('shortcuts-btn');\r\n  if (shortcutsBtn) {\r\n    shortcutsBtn.addEventListener('click', () => {\r\n      components.showShortcutsModal();\r\n    });\r\n  }\r\n\r\n  // Dev tools button\r\n  const devToolsBtn = document.getElementById('dev-tools-btn');\r\n  if (devToolsBtn) {\r\n    devToolsBtn.addEventListener('click', () => {\r\n      components.showDeveloperModal();\r\n    });\r\n  }\r\n\r\n  // Profile button\r\n  const profileBtn = document.getElementById('profile-btn');\r\n  if (profileBtn) {\r\n    profileBtn.addEventListener('click', () => {\r\n      showProfileModal();\r\n    });\r\n  }\r\n\r\n  // Initialize notifications dropdown in header\r\n  const notificationsContainer = document.getElementById('notifications-container');\r\n  if (notificationsContainer) {\r\n    initNotificationsDropdown(notificationsContainer, {\r\n      onNotificationClick: (notification) => {\r\n        console.log('Notification clicked:', notification);\r\n        // Navigate based on notification type\r\n        if (notification.entity_type && notification.entity_id) {\r\n          window.dispatchEvent(new CustomEvent('godmode:navigate', { \r\n            detail: { type: notification.entity_type, id: notification.entity_id }\r\n          }));\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // Sidebar navigation\r\n  const navItems = document.querySelectorAll('.nav-item[data-tab]');\r\n  navItems.forEach(item => {\r\n    item.addEventListener('click', () => {\r\n      const tab = item.getAttribute('data-tab');\r\n      if (tab) {\r\n        switchTab(tab);\r\n      }\r\n    });\r\n  });\r\n\r\n  // SOT tabs\r\n  const sotTabs = document.querySelectorAll('.sot-tab');\r\n  sotTabs.forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      const view = tab.getAttribute('data-view');\r\n      if (view) {\r\n        sotTabs.forEach(t => t.classList.remove('active'));\r\n        tab.classList.add('active');\r\n        uiStore.setSotView(view as 'questions' | 'facts' | 'risks' | 'actions' | 'decisions');\r\n        loadSotContent(view);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Mobile menu toggle\r\n  const menuToggle = document.getElementById('menu-toggle');\r\n  const sidebar = document.getElementById('app-sidebar');\r\n  if (menuToggle && sidebar) {\r\n    menuToggle.addEventListener('click', () => {\r\n      sidebar.classList.toggle('open');\r\n    });\r\n  }\r\n\r\n  // Chat panel is mounted in initializePanels\r\n\r\n  // New contact button\r\n  const newContactBtn = document.getElementById('new-contact-btn');\r\n  if (newContactBtn) {\r\n    newContactBtn.addEventListener('click', () => {\r\n      components.showContactModal({ mode: 'create' });\r\n    });\r\n  }\r\n\r\n  // Upload buttons\r\n  const uploadBtns = document.querySelectorAll('#new-upload-btn, #upload-files-btn');\r\n  uploadBtns.forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      components.showFileUploadModal();\r\n    });\r\n  });\r\n\r\n  // Initialize sidebar action buttons\r\n  initializeSidebarActions();\r\n\r\n  // Project selector\r\n  const projectSelector = document.getElementById('project-selector') as HTMLSelectElement;\r\n  const newProjectBtn = document.getElementById('new-project-btn');\r\n  const editProjectBtn = document.getElementById('edit-project-btn');\r\n  \r\n  if (projectSelector) {\r\n    projectSelector.addEventListener('change', async () => {\r\n      const projectId = projectSelector.value;\r\n      console.log(' Project selector changed, value:', projectId);\r\n      \r\n      if (projectId) {\r\n        await selectProject(projectId);\r\n        if (editProjectBtn) editProjectBtn.classList.remove('hidden');\r\n      } else {\r\n        console.log(' Clearing project - starting...');\r\n        \r\n        // No project selected - clear everything IMMEDIATELY\r\n        if (editProjectBtn) editProjectBtn.classList.add('hidden');\r\n        \r\n        // Clear current project in store\r\n        appStore.setCurrentProject(null);\r\n        appStore.setCurrentProjectId(null);\r\n        console.log(' Store cleared');\r\n        \r\n        // Clear all data\r\n        dataStore.setQuestions([]);\r\n        dataStore.setRisks([]);\r\n        dataStore.setActions([]);\r\n        dataStore.setDecisions([]);\r\n        dataStore.setContacts([]);\r\n        console.log(' Data store cleared');\r\n        \r\n        // IMMEDIATELY show empty state (no async import needed)\r\n        console.log(' Calling showNoProjectState...');\r\n        showNoProjectState();\r\n        console.log(' showNoProjectState called');\r\n        \r\n        // Switch to Dashboard tab so user sees the empty state\r\n        switchTab('dashboard');\r\n        \r\n        loadSotContent(uiStore.getState().sotCurrentView);\r\n        \r\n        // Also deactivate on server side (fire and forget)\r\n        http.post('/api/projects/deactivate').catch(() => {});\r\n        \r\n        console.log(' Project deselected - ALL DONE');\r\n      }\r\n    });\r\n    loadProjects();\r\n  }\r\n\r\n  // New project button\r\n  if (newProjectBtn) {\r\n    newProjectBtn.addEventListener('click', () => {\r\n      components.showProjectModal({\r\n        mode: 'create',\r\n        onSave: async (project) => {\r\n          await loadProjects();\r\n          if (project.id && projectSelector) {\r\n            projectSelector.value = project.id;\r\n            if (editProjectBtn) editProjectBtn.classList.remove('hidden');\r\n          }\r\n          await refreshData();\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  // Edit project button\r\n  if (editProjectBtn) {\r\n    editProjectBtn.addEventListener('click', () => {\r\n      const currentProject = appStore.getState().currentProject;\r\n      if (currentProject) {\r\n        components.showProjectModal({\r\n          mode: 'edit',\r\n          project: currentProject,\r\n          onSave: async () => {\r\n            await loadProjects();\r\n          },\r\n          onDelete: async () => {\r\n            await loadProjects();\r\n            if (editProjectBtn) editProjectBtn.classList.add('hidden');\r\n            dataStore.setQuestions([]);\r\n            dataStore.setRisks([]);\r\n            dataStore.setActions([]);\r\n            dataStore.setDecisions([]);\r\n            updateDashboard();\r\n          },\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  // Contacts subtabs\r\n  const contactsSubtabs = document.querySelectorAll('#contacts-subtabs .subtab');\r\n  contactsSubtabs.forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      contactsSubtabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      const subtab = tab.getAttribute('data-subtab');\r\n      document.querySelectorAll('[id^=\"contacts-subtab-\"]').forEach(content => {\r\n        content.classList.toggle('hidden', content.id !== `contacts-subtab-${subtab}`);\r\n      });\r\n    });\r\n  });\r\n\r\n  // Refresh dashboard button\r\n  const refreshDashboardBtn = document.getElementById('refresh-dashboard-btn');\r\n  if (refreshDashboardBtn) {\r\n    refreshDashboardBtn.addEventListener('click', () => {\r\n      initializePanels();\r\n      toast.info('Dashboard refreshed');\r\n    });\r\n  }\r\n\r\n  // Mount panels on tab switch\r\n  initializePanels();\r\n  \r\n  // Initialize drop zones\r\n  initializeDropZones();\r\n}\r\n\r\n/**\r\n * Show \"No Project Selected\" state immediately (sync, no imports)\r\n */\r\nfunction showNoProjectState(): void {\r\n  console.log(' showNoProjectState() called');\r\n  const dashboardContainer = document.getElementById('dashboard-container');\r\n  console.log(' dashboardContainer:', dashboardContainer ? 'FOUND' : 'NOT FOUND');\r\n  if (!dashboardContainer) return;\r\n  \r\n  console.log(' Setting innerHTML NOW...');\r\n  \r\n  dashboardContainer.innerHTML = `\r\n    <div class=\"dashboard\" style=\"padding: 20px;\">\r\n      <div class=\"no-project-state\" style=\"\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 80px 24px;\r\n        text-align: center;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\r\n        border-radius: 20px;\r\n        border: 2px dashed rgba(225,29,72,0.2);\r\n        min-height: 400px;\r\n      \">\r\n        <svg width=\"96\" height=\"96\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" style=\"color: #e11d48; margin-bottom: 24px; opacity: 0.5;\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\r\n        </svg>\r\n        <h2 style=\"margin: 0 0 12px 0; font-size: 28px; font-weight: 700; color: var(--text-primary);\">No Project Selected</h2>\r\n        <p style=\"margin: 0 0 28px 0; font-size: 16px; color: var(--text-secondary); max-width: 480px; line-height: 1.6;\">\r\n          Select a project from the dropdown above, or create a new one to get started with your data management.\r\n        </p>\r\n        <button id=\"create-project-empty-cta\" class=\"btn btn-primary\" style=\"\r\n          padding: 14px 32px;\r\n          font-size: 15px;\r\n          font-weight: 600;\r\n          display: inline-flex;\r\n          align-items: center;\r\n          gap: 10px;\r\n          border-radius: 12px;\r\n        \">\r\n          <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Create New Project\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n  \r\n  console.log(' innerHTML SET! Container visible:', dashboardContainer.offsetParent !== null);\r\n  console.log(' Container display:', window.getComputedStyle(dashboardContainer).display);\r\n  \r\n  // Bind create project button\r\n  const createBtn = document.getElementById('create-project-empty-cta');\r\n  if (createBtn) {\r\n    createBtn.addEventListener('click', () => {\r\n      components.showProjectModal({\r\n        mode: 'create',\r\n        onSave: async (project) => {\r\n          await loadProjects();\r\n          const projectSelector = document.getElementById('project-selector') as HTMLSelectElement;\r\n          if (project.id && projectSelector) {\r\n            projectSelector.value = project.id;\r\n          }\r\n          await refreshData();\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Refresh/recreate the dashboard\r\n */\r\nasync function refreshDashboardPanel(): Promise<void> {\r\n  const dashboardContainer = document.getElementById('dashboard-container');\r\n  if (!dashboardContainer) return;\r\n  \r\n  // Check if project is selected - if not, show empty state immediately\r\n  const currentProject = appStore.getState().currentProject;\r\n  const currentProjectId = appStore.getState().currentProjectId;\r\n  \r\n  if (!currentProject && !currentProjectId) {\r\n    showNoProjectState();\r\n    return;\r\n  }\r\n  \r\n  // Clear and recreate with loading state\r\n  dashboardContainer.innerHTML = '<div class=\"loading-placeholder\" style=\"padding: 40px; text-align: center;\">Loading dashboard...</div>';\r\n  \r\n  try {\r\n    const { createDashboard } = await import('./components/Dashboard');\r\n    dashboardContainer.innerHTML = '';\r\n    const dashboard = createDashboard({\r\n      onStatClick: (statId) => {\r\n        console.log('Stat clicked:', statId);\r\n        // Navigate to appropriate view\r\n        if (statId === 'questions') switchTab('sot');\r\n        else if (statId === 'facts') {\r\n          switchTab('sot');\r\n          uiStore.setSotView('facts');\r\n          document.querySelectorAll('.sot-tab').forEach(t => {\r\n            t.classList.toggle('active', t.getAttribute('data-view') === 'facts');\r\n          });\r\n          loadSotContent('facts');\r\n        }\r\n        else if (statId === 'risks') { switchTab('sot'); uiStore.setSotView('risks'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'risks'); }); loadSotContent('risks'); }\r\n        else if (statId === 'actions') { switchTab('sot'); uiStore.setSotView('actions'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'actions'); }); loadSotContent('actions'); }\r\n        else if (statId === 'decisions') { switchTab('sot'); uiStore.setSotView('decisions'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'decisions'); }); loadSotContent('decisions'); }\r\n        else if (statId === 'contacts') switchTab('contacts');\r\n      }\r\n    });\r\n    dashboardContainer.appendChild(dashboard);\r\n  } catch (err) {\r\n    console.error('Failed to load Dashboard:', err);\r\n    dashboardContainer.innerHTML = '<div class=\"error\">Failed to load dashboard</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize and mount panels\r\n */\r\nfunction initializePanels(): void {\r\n  // Dashboard - Main dashboard with all widgets\r\n  refreshDashboardPanel();\r\n\r\n  // Chat panel (sessions, contact pills, RAG)\r\n  const chatContainer = document.getElementById('chat-panel-container');\r\n  if (chatContainer && chatContainer.children.length === 0) {\r\n    import('./components/Chat').then(({ createChat }) => {\r\n      const panel = createChat({ showSources: true, showSessions: true });\r\n      chatContainer.appendChild(panel);\r\n    }).catch((err) => {\r\n      console.error('[Chat] Failed to load Chat:', err);\r\n      chatContainer.innerHTML = '<div style=\"padding: 24px; color: var(--text-secondary);\">Failed to load chat</div>';\r\n    });\r\n  }\r\n\r\n  // EmailsPanel\r\n  const emailsContainer = document.getElementById('emails-panel-container');\r\n  if (emailsContainer && emailsContainer.children.length === 0) {\r\n    import('./components/EmailsPanel').then(({ createEmailsPanel }) => {\r\n      const panel = createEmailsPanel();\r\n      emailsContainer.appendChild(panel);\r\n    });\r\n  }\r\n\r\n  // ContactsPanel\r\n  const contactsContainer = document.getElementById('contacts-panel-container');\r\n  if (contactsContainer && contactsContainer.querySelectorAll('.contacts-panel-sota').length === 0) {\r\n    import('./components/ContactsPanel').then(({ createContactsPanel }) => {\r\n      contactsContainer.innerHTML = ''; // Clear comments and whitespace\r\n      const panel = createContactsPanel();\r\n      contactsContainer.appendChild(panel);\r\n    });\r\n  }\r\n\r\n  // TeamsPanel\r\n  const teamsContainer = document.getElementById('teams-panel-container');\r\n  if (teamsContainer && teamsContainer.children.length === 0) {\r\n    import('./components/TeamsPanel').then(({ createTeamsPanel }) => {\r\n      const panel = createTeamsPanel();\r\n      teamsContainer.appendChild(panel);\r\n    });\r\n  }\r\n\r\n  // RolesPanel\r\n  const rolesContainer = document.getElementById('roles-panel-container');\r\n  if (rolesContainer && rolesContainer.children.length === 0) {\r\n    import('./components/RolesPanel').then(({ renderRolesPanel }) => {\r\n      renderRolesPanel(rolesContainer);\r\n    });\r\n  }\r\n\r\n  // FilesPanel (DocumentsPanel)\r\n  const filesContainer = document.getElementById('files-panel-container');\r\n  if (filesContainer && filesContainer.querySelectorAll('.documents-panel-minimal').length === 0) {\r\n    filesContainer.innerHTML = ''; // Clear comments and whitespace\r\n    import('./components/DocumentsPanel').then(({ default: createDocumentsPanel }) => {\r\n      const panel = createDocumentsPanel({\r\n        onDocumentClick: async (doc) => {\r\n          // Open document preview modal\r\n          const { showDocumentPreviewModal } = await import('./components/modals/DocumentPreviewModal');\r\n          showDocumentPreviewModal({ document: doc });\r\n        }\r\n      });\r\n      filesContainer.appendChild(panel);\r\n    }).catch(err => {\r\n      console.error('[FilesPanel] Failed to load DocumentsPanel:', err);\r\n      filesContainer.innerHTML = '<div style=\"padding: 24px; color: var(--text-secondary);\">Failed to load files panel</div>';\r\n    });\r\n  }\r\n\r\n  // OrgChart\r\n  const orgChartContainer = document.getElementById('org-chart-container');\r\n  if (orgChartContainer && orgChartContainer.children.length === 0) {\r\n    import('./components/OrgChart').then(({ createOrgChart }) => {\r\n      const panel = createOrgChart();\r\n      orgChartContainer.appendChild(panel);\r\n    });\r\n  }\r\n\r\n  // CostsDashboard (mount if no element children; container may have comment nodes)\r\n  const costsContainer = document.getElementById('costs-container');\r\n  if (costsContainer && costsContainer.children.length === 0) {\r\n    import('./components/CostsDashboard').then(({ createCostsDashboard }) => {\r\n      const panel = createCostsDashboard();\r\n      costsContainer.appendChild(panel);\r\n    });\r\n  }\r\n\r\n  // HistoryPanel\r\n  const historyContainer = document.getElementById('history-container');\r\n  if (historyContainer && historyContainer.children.length === 0) {\r\n    import('./components/HistoryPanel').then(({ createHistoryPanel, exportHistory }) => {\r\n      const panel = createHistoryPanel({\r\n        onRestore: (entry) => {\r\n          toast.info(`Restoring ${entry.entityType} \"${entry.entityName || entry.entityId}\"`);\r\n          // Trigger restore via API\r\n        }\r\n      });\r\n      historyContainer.appendChild(panel);\r\n\r\n      // Bind export button\r\n      const exportBtn = document.getElementById('export-history-btn');\r\n      if (exportBtn) {\r\n        exportBtn.addEventListener('click', () => exportHistory('json'));\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize sidebar drop zones\r\n */\r\nfunction initializeDropZones(): void {\r\n  const dropzones = document.querySelectorAll('.dropzone-card[data-type]');\r\n  console.log('[DropZones] Found', dropzones.length, 'dropzones');\r\n  \r\n  dropzones.forEach(zone => {\r\n    const type = zone.getAttribute('data-type');\r\n    console.log('[DropZones] Adding click handler for:', type);\r\n    \r\n    // Click handler - open appropriate modal or file picker\r\n    zone.addEventListener('click', async (e) => {\r\n      console.log('[DropZones] Click on:', type);\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      \r\n      try {\r\n        switch (type) {\r\n          case 'emails':\r\n            // Open EmailComposer modal\r\n            console.log('[DropZones] Opening EmailComposer...');\r\n            const { showEmailComposer } = await import('./components/EmailComposer');\r\n            showEmailComposer({\r\n              onSave: () => {\r\n                toast.success('Email imported');\r\n              }\r\n            });\r\n            return;\r\n            \r\n          case 'conversations':\r\n            // Open ConversationComposer modal\r\n            console.log('[DropZones] Opening ConversationComposer...');\r\n            const { showConversationComposer } = await import('./components/ConversationComposer');\r\n            showConversationComposer({\r\n              onImport: () => {\r\n                toast.success('Conversation imported');\r\n              }\r\n            });\r\n            return;\r\n            \r\n          case 'transcripts':\r\n            // Open TranscriptComposer modal\r\n            console.log('[DropZones] Opening TranscriptComposer...');\r\n            const { showTranscriptComposer } = await import('./components/TranscriptComposer');\r\n            showTranscriptComposer({\r\n              onImport: () => {\r\n                toast.success('Transcript imported');\r\n              }\r\n            });\r\n            return;\r\n            \r\n          case 'documents':\r\n          default:\r\n            // Open file picker for documents\r\n            console.log('[DropZones] Opening file picker for documents...');\r\n            const input = document.createElement('input');\r\n            input.type = 'file';\r\n            input.multiple = true;\r\n            input.accept = '.pdf,.doc,.docx,.txt,.md,.rtf,.odt,.xls,.xlsx,.ppt,.pptx,.csv,.json';\r\n            \r\n            input.onchange = () => {\r\n              if (input.files && input.files.length > 0) {\r\n                handleDroppedFiles(Array.from(input.files), 'documents');\r\n              }\r\n            };\r\n            \r\n            input.click();\r\n            return;\r\n        }\r\n      } catch (err) {\r\n        console.error('[DropZones] Error:', err);\r\n        toast.error('Failed to open import dialog');\r\n      }\r\n    });\r\n    \r\n    // Drag and drop handlers\r\n    zone.addEventListener('dragover', (e) => {\r\n      e.preventDefault();\r\n      zone.classList.add('drag-over');\r\n    });\r\n    \r\n    zone.addEventListener('dragleave', () => {\r\n      zone.classList.remove('drag-over');\r\n    });\r\n    \r\n    zone.addEventListener('drop', (e) => {\r\n      e.preventDefault();\r\n      zone.classList.remove('drag-over');\r\n      \r\n      const dataTransfer = (e as DragEvent).dataTransfer;\r\n      if (dataTransfer?.files && dataTransfer.files.length > 0) {\r\n        handleDroppedFiles(Array.from(dataTransfer.files), type || 'documents');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Handle dropped or selected files\r\n */\r\nasync function handleDroppedFiles(files: File[], type: string): Promise<void> {\r\n  // Add files to pending list\r\n  addPendingFiles(files);\r\n  \r\n  const fileNames = files.map(f => f.name).join(', ');\r\n  toast.info(`Added ${files.length} ${type} to queue: ${fileNames.substring(0, 50)}${fileNames.length > 50 ? '...' : ''}`);\r\n}\r\n\r\n/**\r\n * Update theme button icon\r\n */\r\nfunction updateThemeButton(): void {\r\n  const themeToggle = document.getElementById('theme-toggle');\r\n  if (themeToggle) {\r\n    themeToggle.textContent = theme.getIcon();\r\n    themeToggle.title = `Theme: ${theme.getLabel()}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Switch to a tab\r\n */\r\nfunction switchTab(tabName: string): void {\r\n  // Update sidebar nav items\r\n  document.querySelectorAll('.nav-item[data-tab]').forEach(item => {\r\n    item.classList.toggle('active', item.getAttribute('data-tab') === tabName);\r\n  });\r\n\r\n  // Update tab content\r\n  document.querySelectorAll('.tab-content').forEach(tab => {\r\n    tab.classList.toggle('active', tab.id === `tab-${tabName}`);\r\n    tab.classList.toggle('hidden', tab.id !== `tab-${tabName}`);\r\n  });\r\n\r\n  // Close mobile sidebar\r\n  const sidebar = document.getElementById('app-sidebar');\r\n  if (sidebar) {\r\n    sidebar.classList.remove('open');\r\n  }\r\n\r\n  // Update store\r\n  uiStore.setTab(tabName as 'dashboard' | 'chat' | 'sot' | 'timeline' | 'contacts' | 'team-analysis' | 'files' | 'graph' | 'emails' | 'costs' | 'history' | 'roles' | 'admin' | 'org');\r\n  \r\n  // Load admin panel when switching to admin tab\r\n  if (tabName === 'admin') {\r\n    const adminContainer = document.getElementById('tab-admin');\r\n    if (adminContainer) {\r\n      import('./components/AdminPanel').then(({ initAdminPanel }) => {\r\n        initAdminPanel(adminContainer);\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Load Graph Explorer when switching to graph tab\r\n  if (tabName === 'graph') {\r\n    const graphContainer = document.getElementById('graph-container');\r\n    // Check for actual element children, not just comments or text nodes\r\n    const hasContent = graphContainer?.querySelector('.graph-explorer');\r\n    if (graphContainer && !hasContent) {\r\n      console.log('[Graph] Loading GraphExplorer...');\r\n      import('./components/graph/GraphExplorer').then(({ createGraphExplorer }) => {\r\n        graphContainer.innerHTML = ''; // Clear any placeholder\r\n        const explorer = createGraphExplorer({\r\n          onNodeSelect: (node) => {\r\n            console.log('Graph node selected:', node);\r\n          },\r\n          onQueryExecute: (cypher) => {\r\n            console.log('Query executed:', cypher);\r\n          },\r\n        });\r\n        graphContainer.appendChild(explorer);\r\n        console.log('[Graph] GraphExplorer loaded successfully');\r\n      }).catch(err => {\r\n        console.error('[Graph] Failed to load GraphExplorer:', err);\r\n        graphContainer.innerHTML = '<div style=\"padding: 24px; text-align: center; color: var(--text-secondary);\">Failed to load Graph Explorer</div>';\r\n      });\r\n    }\r\n  }\r\n\r\n  // Load Timeline Panel when switching to timeline tab\r\n  if (tabName === 'timeline') {\r\n    const timelineContainer = document.getElementById('timeline-content');\r\n    const hasContent = timelineContainer?.querySelector('.timeline-panel');\r\n    if (timelineContainer && !hasContent) {\r\n      console.log('[Timeline] Loading TimelinePanel...');\r\n      import('./components/TimelinePanel').then(({ createTimelinePanel }) => {\r\n        timelineContainer.innerHTML = ''; // Clear any placeholder\r\n        const panel = createTimelinePanel({\r\n          onEventClick: (event) => {\r\n            console.log('Timeline event clicked:', event);\r\n            // Navigate to entity if possible\r\n            if (event.entity_type && event.entity_id) {\r\n              const entityType = event.entity_type;\r\n              if (entityType === 'question') {\r\n                import('./components/questions/QuestionDetailView').then(({ createQuestionDetailView }) => {\r\n                  const container = document.getElementById('timeline-content');\r\n                  if (container) {\r\n                    container.innerHTML = '';\r\n                    const detailView = createQuestionDetailView({\r\n                      questionId: event.entity_id!,\r\n                      onBack: () => switchTab('timeline'),\r\n                    });\r\n                    container.appendChild(detailView);\r\n                  }\r\n                });\r\n              } else if (entityType === 'decision') {\r\n                import('./components/decisions/DecisionDetailView').then(({ createDecisionDetailView }) => {\r\n                  const container = document.getElementById('timeline-content');\r\n                  if (container) {\r\n                    container.innerHTML = '';\r\n                    const detailView = createDecisionDetailView({\r\n                      decisionId: event.entity_id!,\r\n                      onBack: () => switchTab('timeline'),\r\n                    });\r\n                    container.appendChild(detailView);\r\n                  }\r\n                });\r\n              } else if (entityType === 'fact') {\r\n                import('./components/facts/FactDetailView').then(({ createFactDetailView }) => {\r\n                  const container = document.getElementById('timeline-content');\r\n                  if (container) {\r\n                    container.innerHTML = '';\r\n                    const detailView = createFactDetailView({\r\n                      factId: event.entity_id!,\r\n                      onBack: () => switchTab('timeline'),\r\n                    });\r\n                    container.appendChild(detailView);\r\n                  }\r\n                });\r\n              } else if (entityType === 'risk') {\r\n                import('./components/risks/RiskDetailView').then(({ createRiskDetailView }) => {\r\n                  const container = document.getElementById('timeline-content');\r\n                  if (container) {\r\n                    container.innerHTML = '';\r\n                    const detailView = createRiskDetailView({\r\n                      riskId: event.entity_id!,\r\n                      onBack: () => switchTab('timeline'),\r\n                    });\r\n                    container.appendChild(detailView);\r\n                  }\r\n                });\r\n              } else if (entityType === 'action') {\r\n                import('./components/actions/ActionDetailView').then(({ createActionDetailView }) => {\r\n                  const container = document.getElementById('timeline-content');\r\n                  if (container) {\r\n                    container.innerHTML = '';\r\n                    const detailView = createActionDetailView({\r\n                      actionId: event.entity_id!,\r\n                      onBack: () => switchTab('timeline'),\r\n                    });\r\n                    container.appendChild(detailView);\r\n                  }\r\n                });\r\n              } else {\r\n                toast.info(`Event: ${event.title}`);\r\n              }\r\n            }\r\n          },\r\n        });\r\n        timelineContainer.appendChild(panel);\r\n        console.log('[Timeline] TimelinePanel loaded successfully');\r\n      }).catch(err => {\r\n        console.error('[Timeline] Failed to load TimelinePanel:', err);\r\n        timelineContainer.innerHTML = '<div style=\"padding: 24px; text-align: center; color: var(--text-secondary);\">Failed to load Timeline</div>';\r\n      });\r\n    }\r\n  }\r\n\r\n  // Load Team Analysis when switching to team-analysis tab\r\n  if (tabName === 'team-analysis') {\r\n    const teamAnalysisContainer = document.getElementById('team-analysis-container');\r\n    const hasContent = teamAnalysisContainer?.querySelector('.team-analysis-panel');\r\n    if (teamAnalysisContainer && !hasContent) {\r\n      console.log('[TeamAnalysis] Loading TeamAnalysis component...');\r\n      import('./components/TeamAnalysis').then(({ createTeamAnalysis }) => {\r\n        teamAnalysisContainer.innerHTML = ''; // Clear any placeholder\r\n        const panel = createTeamAnalysis();\r\n        teamAnalysisContainer.appendChild(panel);\r\n        console.log('[TeamAnalysis] TeamAnalysis loaded successfully');\r\n        \r\n        // Setup subtab switching after component is loaded\r\n        setupTeamAnalysisSubtabs();\r\n      }).catch(err => {\r\n        console.error('[TeamAnalysis] Failed to load TeamAnalysis:', err);\r\n        teamAnalysisContainer.innerHTML = '<div style=\"padding: 24px; text-align: center; color: var(--text-secondary);\">Failed to load Team Analysis</div>';\r\n      });\r\n    } else {\r\n      // Component already loaded, just setup subtabs\r\n      setupTeamAnalysisSubtabs();\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Setup Team Analysis subtab switching\r\n */\r\nfunction setupTeamAnalysisSubtabs(): void {\r\n  // Import the store to control subtab switching\r\n  import('./stores/teamAnalysis').then(({ teamAnalysisStore }) => {\r\n    document.querySelectorAll('#team-analysis-subtabs .subtab').forEach(btn => {\r\n      // Remove existing listeners to prevent duplicates\r\n      const newBtn = btn.cloneNode(true);\r\n      btn.parentNode?.replaceChild(newBtn, btn);\r\n      \r\n      newBtn.addEventListener('click', (e) => {\r\n        const subtab = (e.target as HTMLElement).dataset.subtab as 'profiles' | 'team' | 'graph';\r\n        if (subtab) {\r\n          console.log('[TeamAnalysis] Switching to subtab:', subtab);\r\n          // Update active state in UI\r\n          document.querySelectorAll('#team-analysis-subtabs .subtab').forEach(b => {\r\n            b.classList.toggle('active', b.getAttribute('data-subtab') === subtab);\r\n          });\r\n          // Update the store which triggers re-render\r\n          teamAnalysisStore.setSubtab(subtab);\r\n        }\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Load projects\r\n */\r\nasync function loadProjects(): Promise<void> {\r\n  const selector = document.getElementById('project-selector') as HTMLSelectElement;\r\n  if (!selector) return;\r\n\r\n  try {\r\n    const projectList = await projects.getAll();\r\n\r\n    selector.innerHTML = '<option value=\"\">Select Project...</option>';\r\n    projectList.forEach(project => {\r\n      const option = document.createElement('option');\r\n      option.value = project.id;\r\n      option.textContent = project.name + (project.isDefault ? ' (default)' : '');\r\n      selector.appendChild(option);\r\n    });\r\n\r\n    // Select current project if any; when none persisted (e.g. storage blocked), auto-select first or default\r\n    const currentProjectId = appStore.getState().currentProjectId;\r\n    const editProjectBtn = document.getElementById('edit-project-btn');\r\n\r\n    if (currentProjectId) {\r\n      selector.value = currentProjectId;\r\n      if (editProjectBtn) editProjectBtn.classList.remove('hidden');\r\n    } else if (projectList.length > 0) {\r\n      const firstOrDefault = projectList.find((p: { isDefault?: boolean }) => p.isDefault) || projectList[0];\r\n      selector.value = firstOrDefault.id;\r\n      appStore.setCurrentProject(firstOrDefault);\r\n      appStore.setCurrentProjectId(firstOrDefault.id);\r\n      if (editProjectBtn) editProjectBtn.classList.remove('hidden');\r\n    } else {\r\n      if (editProjectBtn) editProjectBtn.classList.add('hidden');\r\n    }\r\n  } catch (error) {\r\n    // Projects API may not be available yet\r\n    console.warn('Projects not available:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Select a project\r\n */\r\nasync function selectProject(projectId: string): Promise<void> {\r\n  try {\r\n    const project = await projects.activate(projectId);\r\n    \r\n    if (project) {\r\n      toast.success(`Switched to: ${project.name}`);\r\n      await refreshData();\r\n    }\r\n  } catch {\r\n    toast.error('Failed to load project');\r\n  }\r\n}\r\n\r\n/**\r\n * Refresh all data for current project\r\n */\r\nasync function refreshData(): Promise<void> {\r\n  try {\r\n    // First, reload projects list (may auto-select first/default if store was empty)\r\n    await loadProjects();\r\n\r\n    let currentProject = appStore.getState().currentProject;\r\n    let currentProjectId = appStore.getState().currentProjectId;\r\n\r\n    // If store still empty but selector has a value (e.g. user picked one), sync store from selector\r\n    if (!currentProject && !currentProjectId) {\r\n      const selector = document.getElementById('project-selector') as HTMLSelectElement;\r\n      if (selector?.value) {\r\n        try {\r\n          const project = await projects.activate(selector.value);\r\n          if (project) {\r\n            appStore.setCurrentProject(project);\r\n            appStore.setCurrentProjectId(project.id);\r\n            currentProject = project;\r\n            currentProjectId = project.id;\r\n          }\r\n        } catch {\r\n          // ignore\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!currentProject && !currentProjectId) {\r\n      // No project selected - show empty state and ensure dashboard tab is visible\r\n      console.log(' No project selected - showing empty state');\r\n      switchTab('dashboard');\r\n      dataStore.setQuestions([]);\r\n      dataStore.setRisks([]);\r\n      dataStore.setActions([]);\r\n      dataStore.setDecisions([]);\r\n      dataStore.setContacts([]);\r\n      await refreshDashboardPanel();\r\n      loadSotContent(uiStore.getState().sotCurrentView);\r\n      return;\r\n    }\r\n    \r\n    // API endpoints don't use projectId in path - project context is server-side\r\n    const [questionsRes, risksRes, actionsRes, decisionsRes, contactsRes] = await Promise.all([\r\n      http.get<{ questions: unknown[] }>('/api/questions').catch(() => ({ data: { questions: [] } })),\r\n      http.get<{ risks: unknown[] }>('/api/risks').catch(() => ({ data: { risks: [] } })),\r\n      http.get<{ actions: unknown[] }>('/api/actions').catch(() => ({ data: { actions: [] } })),\r\n      http.get<{ decisions: unknown[] }>('/api/decisions').catch(() => ({ data: { decisions: [] } })),\r\n      http.get<{ contacts: unknown[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\r\n    ]);\r\n\r\n    dataStore.setQuestions((questionsRes.data.questions || []) as []);\r\n    dataStore.setRisks((risksRes.data.risks || []) as []);\r\n    dataStore.setActions((actionsRes.data.actions || []) as []);\r\n    dataStore.setDecisions((decisionsRes.data.decisions || []) as []);\r\n    dataStore.setContacts((contactsRes.data.contacts || []) as []);\r\n\r\n    // Re-render dashboard with new data\r\n    await refreshDashboardPanel();\r\n    loadSotContent(uiStore.getState().sotCurrentView);\r\n  } catch {\r\n    console.error('Failed to refresh data');\r\n  }\r\n}\r\n\r\n/**\r\n * Update dashboard stats\r\n */\r\nfunction updateDashboard(): void {\r\n  const statsGrid = document.getElementById('dashboard-stats');\r\n  const dashboardContent = document.getElementById('dashboard-content');\r\n  if (!statsGrid) return;\r\n\r\n  // Check if project is selected\r\n  const currentProject = appStore.getState().currentProject;\r\n  const currentProjectId = appStore.getState().currentProjectId;\r\n  \r\n  if (!currentProject && !currentProjectId) {\r\n    // No project selected - show empty state\r\n    statsGrid.innerHTML = `\r\n      <div class=\"no-project-message\" style=\"\r\n        grid-column: 1 / -1;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 48px 24px;\r\n        text-align: center;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\r\n        border-radius: 16px;\r\n        border: 2px dashed rgba(225,29,72,0.2);\r\n      \">\r\n        <svg width=\"64\" height=\"64\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" style=\"color: #e11d48; margin-bottom: 16px; opacity: 0.7;\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\r\n        </svg>\r\n        <h3 style=\"margin: 0 0 8px 0; font-size: 20px; font-weight: 600; color: var(--text-primary);\">No Project Selected</h3>\r\n        <p style=\"margin: 0 0 20px 0; font-size: 14px; color: var(--text-secondary); max-width: 400px;\">\r\n          Select an existing project from the dropdown above or create a new one to start managing your data.\r\n        </p>\r\n        <button id=\"create-project-cta\" class=\"btn btn-primary\" style=\"\r\n          padding: 12px 24px;\r\n          font-size: 14px;\r\n          font-weight: 600;\r\n          display: inline-flex;\r\n          align-items: center;\r\n          gap: 8px;\r\n        \">\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Create New Project\r\n        </button>\r\n      </div>\r\n    `;\r\n    \r\n    // Hide dashboard content sections\r\n    if (dashboardContent) {\r\n      dashboardContent.style.display = 'none';\r\n    }\r\n    \r\n    // Bind create project button\r\n    const createBtn = document.getElementById('create-project-cta');\r\n    if (createBtn) {\r\n      createBtn.addEventListener('click', () => {\r\n        components.showProjectModal({\r\n          mode: 'create',\r\n          onSave: async (project) => {\r\n            await loadProjects();\r\n            await refreshData();\r\n          }\r\n        });\r\n      });\r\n    }\r\n    \r\n    return;\r\n  }\r\n\r\n  // Show dashboard content if hidden\r\n  if (dashboardContent) {\r\n    dashboardContent.style.display = '';\r\n  }\r\n\r\n  const state = dataStore.getState();\r\n  \r\n  // Count only active questions (exclude dismissed/resolved/answered)\r\n  const activeQuestions = state.questions.filter(q => \r\n    q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'answered'\r\n  );\r\n  \r\n  statsGrid.innerHTML = `\r\n    <div class=\"stat-card\">\r\n      <div class=\"stat-value\">${activeQuestions.length}</div>\r\n      <div class=\"stat-label\">Questions</div>\r\n    </div>\r\n    <div class=\"stat-card\">\r\n      <div class=\"stat-value\">${state.risks.length}</div>\r\n      <div class=\"stat-label\">Risks</div>\r\n    </div>\r\n    <div class=\"stat-card\">\r\n      <div class=\"stat-value\">${state.actions.length}</div>\r\n      <div class=\"stat-label\">Actions</div>\r\n    </div>\r\n    <div class=\"stat-card\">\r\n      <div class=\"stat-value\">${state.decisions.length}</div>\r\n      <div class=\"stat-label\">Decisions</div>\r\n    </div>\r\n    <div class=\"stat-card\">\r\n      <div class=\"stat-value\">${state.contacts.length}</div>\r\n      <div class=\"stat-label\">Contacts</div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Load SOT content\r\n */\r\nfunction loadSotContent(view: string): void {\r\n  const container = document.getElementById('sot-content');\r\n  if (!container) return;\r\n\r\n  const state = dataStore.getState();\r\n  let items: Array<{ id: string; [key: string]: unknown }> = [];\r\n  let template: (item: { id: string; [key: string]: unknown }) => string;\r\n\r\n  switch (view) {\r\n    case 'questions':\r\n      // Use the full QuestionsPanel with Generate button, filters and detail view\r\n      container.innerHTML = '';\r\n      const questionsPanel = createQuestionsPanel({\r\n        useDetailView: true,\r\n        containerElement: container\r\n      });\r\n      container.appendChild(questionsPanel);\r\n      return; // Exit early since we're using the full component\r\n    case 'facts':\r\n      container.innerHTML = '';\r\n      const factsPanel = createFactsPanel({\r\n        useDetailView: true,\r\n        containerElement: container\r\n      });\r\n      container.appendChild(factsPanel);\r\n      return;\r\n    case 'decisions':\r\n      container.innerHTML = '';\r\n      const decisionsPanel = createDecisionsPanel({\r\n        useDetailView: true,\r\n        containerElement: container\r\n      });\r\n      container.appendChild(decisionsPanel);\r\n      return;\r\n    case 'risks':\r\n      container.innerHTML = '';\r\n      const risksPanel = createRisksPanel({\r\n        useDetailView: true,\r\n        containerElement: container\r\n      });\r\n      container.appendChild(risksPanel);\r\n      return;\r\n    case 'actions':\r\n      container.innerHTML = '';\r\n      const actionsPanel = createActionsPanel({\r\n        useDetailView: true,\r\n        containerElement: container\r\n      });\r\n      container.appendChild(actionsPanel);\r\n      return;\r\n    default:\r\n      container.innerHTML = '<p class=\"text-muted\">Select a view</p>';\r\n      return;\r\n  }\r\n}\r\n\r\n/**\r\n * Show question detail view\r\n */\r\nfunction showQuestionDetail(question: Question, container: HTMLElement): void {\r\n  // Store original content for restoration\r\n  const originalContent = container.innerHTML;\r\n  \r\n  // Transform question to match the expected interface\r\n  const questionData = {\r\n    id: question.id,\r\n    content: String(question.content || question.question || ''),\r\n    context: question.context as string | undefined,\r\n    priority: (question.priority || 'medium') as 'low' | 'medium' | 'high' | 'critical',\r\n    status: (question.status || 'pending') as 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed',\r\n    assigned_to: question.assigned_to as string | undefined,\r\n    answer: question.answer as string | undefined,\r\n    answer_source: question.answer_source as 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai' | undefined,\r\n    category: question.category as string | undefined,\r\n    source_file: question.source_file as string | undefined,\r\n    created_at: String(question.created_at || question.createdAt || new Date().toISOString()),\r\n    updated_at: question.updated_at as string | undefined,\r\n    follow_up_to: question.follow_up_to as string | undefined,\r\n    answered_by_contact_id: question.answered_by_contact_id as string | undefined,\r\n    answered_by_name: question.answered_by_name as string | undefined,\r\n    sla_hours: question.sla_hours as number | undefined,\r\n    sla_breached: question.sla_breached as boolean | undefined,\r\n    extracted_entities: question.extracted_entities as Array<{ type: string; name: string }> | undefined,\r\n    extracted_topics: question.extracted_topics as Array<{ name: string }> | undefined,\r\n  };\r\n  \r\n  // Create detail view\r\n  const detailView = createQuestionDetailView({\r\n    question: questionData,\r\n    onClose: () => {\r\n      // Restore original content\r\n      container.innerHTML = originalContent;\r\n      // Re-bind click handlers\r\n      loadSotContent('questions');\r\n    },\r\n    onUpdate: (updatedQuestion) => {\r\n      // Update question in data store\r\n      const state = dataStore.getState();\r\n      const updatedQuestions = state.questions.map((q) => \r\n        q.id === updatedQuestion.id ? { ...q, ...updatedQuestion } as Question : q\r\n      );\r\n      dataStore.setQuestions(updatedQuestions);\r\n    },\r\n    onNavigateToQuestion: (questionId) => {\r\n      // Find and show the target question\r\n      const state = dataStore.getState();\r\n      const targetQuestion = state.questions.find((q) => q.id === questionId);\r\n      if (targetQuestion) {\r\n        showQuestionDetail(targetQuestion, container);\r\n      }\r\n    }\r\n  });\r\n  \r\n  // Replace content with detail view\r\n  container.innerHTML = '';\r\n  container.appendChild(detailView);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Format markdown (basic)\r\n */\r\nfunction formatMarkdown(text: string): string {\r\n  return escapeHtml(text)\r\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\r\n    .replace(/`(.*?)`/g, '<code>$1</code>')\r\n    .replace(/\\n/g, '<br>');\r\n}\r\n\r\n/**\r\n * Pending files manager\r\n */\r\nconst pendingFiles: File[] = [];\r\n\r\nfunction updatePendingFilesUI(): void {\r\n  const countEl = document.getElementById('pending-count');\r\n  const listEl = document.getElementById('pending-files-list');\r\n  \r\n  if (countEl) {\r\n    countEl.textContent = `${pendingFiles.length} file${pendingFiles.length !== 1 ? 's' : ''}`;\r\n  }\r\n  \r\n  if (listEl) {\r\n    if (pendingFiles.length === 0) {\r\n      listEl.innerHTML = '<div class=\"empty-hint\">No files pending</div>';\r\n    } else {\r\n      listEl.innerHTML = pendingFiles.map((file, index) => `\r\n        <div class=\"pending-file-item\" data-index=\"${index}\">\r\n          <div class=\"pending-file-info\">\r\n            <div class=\"pending-file-name\" title=\"${escapeHtml(file.name)}\">${escapeHtml(file.name)}</div>\r\n            <div class=\"pending-file-size\">${formatFileSize(file.size)}</div>\r\n          </div>\r\n          <button class=\"pending-file-remove\" data-index=\"${index}\" title=\"Remove\"></button>\r\n        </div>\r\n      `).join('');\r\n      \r\n      // Bind remove buttons\r\n      listEl.querySelectorAll('.pending-file-remove').forEach(btn => {\r\n        btn.addEventListener('click', (e) => {\r\n          e.stopPropagation();\r\n          const idx = parseInt((btn as HTMLElement).dataset.index || '0');\r\n          pendingFiles.splice(idx, 1);\r\n          updatePendingFilesUI();\r\n        });\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction formatFileSize(bytes: number): string {\r\n  if (bytes < 1024) return bytes + ' B';\r\n  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\r\n  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\r\n}\r\n\r\nfunction addPendingFiles(files: FileList | File[]): void {\r\n  Array.from(files).forEach(file => {\r\n    if (!pendingFiles.some(f => f.name === file.name && f.size === file.size)) {\r\n      pendingFiles.push(file);\r\n    }\r\n  });\r\n  updatePendingFilesUI();\r\n}\r\n\r\n/**\r\n * Initialize sidebar action buttons\r\n */\r\nfunction initializeSidebarActions(): void {\r\n  // Process Files button\r\n  const processBtn = document.getElementById('process-files-btn');\r\n  if (processBtn) {\r\n    processBtn.addEventListener('click', async () => {\r\n      if (pendingFiles.length === 0) {\r\n        toast.warning('No files to process. Add files first.');\r\n        return;\r\n      }\r\n      \r\n      processBtn.setAttribute('disabled', 'true');\r\n      processBtn.innerHTML = '<span class=\"btn-icon\"></span> Processing...';\r\n      \r\n      try {\r\n        const result = await documentsService.upload(pendingFiles);\r\n        if (result.success) {\r\n          toast.success(`Processed ${result.files.length} files successfully`);\r\n          pendingFiles.length = 0; // Clear array\r\n          updatePendingFilesUI();\r\n          refreshData();\r\n        }\r\n      } catch (error) {\r\n        toast.error('Failed to process files');\r\n        console.error('Process error:', error);\r\n      } finally {\r\n        processBtn.removeAttribute('disabled');\r\n        processBtn.innerHTML = '<span class=\"btn-icon\"></span> Process Files';\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Export Knowledge button\r\n  const exportKnowledgeBtn = document.getElementById('export-knowledge-btn');\r\n  if (exportKnowledgeBtn) {\r\n    exportKnowledgeBtn.addEventListener('click', async () => {\r\n      try {\r\n        const data = dataStore.getState();\r\n        const knowledge = {\r\n          facts: data.facts || [],\r\n          decisions: data.decisions || [],\r\n          exportedAt: new Date().toISOString()\r\n        };\r\n        \r\n        const blob = new Blob([JSON.stringify(knowledge, null, 2)], { type: 'application/json' });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = 'godmode-knowledge-export.json';\r\n        a.click();\r\n        URL.revokeObjectURL(url);\r\n        \r\n        toast.success('Knowledge exported');\r\n      } catch (error) {\r\n        toast.error('Export failed');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Export Knowledge to clipboard\r\n  const exportKnowledgeClipboard = document.getElementById('export-knowledge-clipboard');\r\n  if (exportKnowledgeClipboard) {\r\n    exportKnowledgeClipboard.addEventListener('click', async () => {\r\n      try {\r\n        const data = dataStore.getState();\r\n        const knowledge = {\r\n          facts: data.facts || [],\r\n          decisions: data.decisions || []\r\n        };\r\n        await navigator.clipboard.writeText(JSON.stringify(knowledge, null, 2));\r\n        toast.success('Copied to clipboard');\r\n      } catch (error) {\r\n        toast.error('Copy failed');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Export Questions button\r\n  const exportQuestionsBtn = document.getElementById('export-questions-btn');\r\n  if (exportQuestionsBtn) {\r\n    exportQuestionsBtn.addEventListener('click', async () => {\r\n      try {\r\n        const data = dataStore.getState();\r\n        const questions = data.questions || [];\r\n        \r\n        const blob = new Blob([JSON.stringify(questions, null, 2)], { type: 'application/json' });\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = 'godmode-questions-export.json';\r\n        a.click();\r\n        URL.revokeObjectURL(url);\r\n        \r\n        toast.success('Questions exported');\r\n      } catch (error) {\r\n        toast.error('Export failed');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Export Questions to clipboard\r\n  const exportQuestionsClipboard = document.getElementById('export-questions-clipboard');\r\n  if (exportQuestionsClipboard) {\r\n    exportQuestionsClipboard.addEventListener('click', async () => {\r\n      try {\r\n        const data = dataStore.getState();\r\n        const questions = data.questions || [];\r\n        await navigator.clipboard.writeText(JSON.stringify(questions, null, 2));\r\n        toast.success('Copied to clipboard');\r\n      } catch (error) {\r\n        toast.error('Copy failed');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Copy Overdue Items button\r\n  const copyOverdueBtn = document.getElementById('copy-overdue-btn');\r\n  if (copyOverdueBtn) {\r\n    copyOverdueBtn.addEventListener('click', async () => {\r\n      try {\r\n        const data = dataStore.getState();\r\n        const now = new Date();\r\n        \r\n        const overdueActions = (data.actions || []).filter(a => {\r\n          if (a.status === 'completed') return false;\r\n          const dueDate = a.dueDate;\r\n          if (!dueDate) return false;\r\n          return new Date(dueDate) < now;\r\n        });\r\n        \r\n        const overdueQuestions = (data.questions || []).filter(q => {\r\n          if (q.status === 'resolved') return false;\r\n          const createdAt = q.created_at || q.createdAt;\r\n          if (!createdAt) return false;\r\n          const created = new Date(createdAt);\r\n          const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n          return created < sevenDaysAgo;\r\n        });\r\n        \r\n        const overdue = {\r\n          actions: overdueActions,\r\n          questions: overdueQuestions,\r\n          exportedAt: now.toISOString()\r\n        };\r\n        \r\n        await navigator.clipboard.writeText(JSON.stringify(overdue, null, 2));\r\n        toast.success(`Copied ${overdueActions.length} actions and ${overdueQuestions.length} questions`);\r\n      } catch (error) {\r\n        toast.error('Copy failed');\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Clean Orphan Data button\r\n  const cleanOrphanBtn = document.getElementById('clean-orphan-btn');\r\n  if (cleanOrphanBtn) {\r\n    cleanOrphanBtn.addEventListener('click', async () => {\r\n      const confirmed = await components.confirm(\r\n        'This will remove orphaned data entries that are not linked to any documents. Continue?',\r\n        { title: 'Clean Orphan Data', confirmText: 'Clean', confirmClass: 'btn-warning' }\r\n      );\r\n      \r\n      if (confirmed) {\r\n        try {\r\n          const response = await http.post('/api/cleanup/orphans');\r\n          toast.success('Orphan data cleaned');\r\n          refreshData();\r\n        } catch (error) {\r\n          toast.error('Cleanup failed');\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Reset Data button (clears knowledge; keeps team, contacts, cost)\r\n  const resetDataBtn = document.getElementById('reset-data-btn');\r\n  if (resetDataBtn) {\r\n    resetDataBtn.addEventListener('click', async () => {\r\n      const confirmed = await components.confirm(\r\n        'This will clear all knowledge data (facts, decisions, questions, risks, actions, documents, etc.) for the current project. Team, contacts, and cost data will be kept. Continue?',\r\n        { title: 'Reset Project Data', confirmText: 'Reset Knowledge Data', confirmClass: 'btn-danger' }\r\n      );\r\n\r\n      if (confirmed) {\r\n        try {\r\n          await http.post('/api/reset');\r\n          toast.success('Project data reset; team, contacts and cost preserved.');\r\n          refreshData();\r\n        } catch (error) {\r\n          toast.error('Reset failed');\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Initialize pending files UI\r\n  updatePendingFilesUI();\r\n}\r\n\r\n/**\r\n * Initialize the application\r\n */\r\nasync function init(): Promise<void> {\r\n  console.log(' GodMode Frontend initializing...');\r\n  \r\n  // Initialize legacy bridge for backwards compatibility\r\n  initLegacyBridge();\r\n  console.log(' Legacy bridge initialized');\r\n  \r\n  // Configure API client\r\n  configureApiClient();\r\n  console.log(' API client configured');\r\n  \r\n  // Initialize authentication\r\n  await initAuth();\r\n  console.log(' Auth initialized');\r\n  \r\n  // Theme is already initialized via its constructor\r\n  console.log(` Theme: ${theme.getMode()} (effective: ${theme.getEffective()})`);\r\n  \r\n  // Register keyboard shortcuts\r\n  registerShortcuts();\r\n  console.log(' Keyboard shortcuts registered');\r\n  \r\n  // Initialize global search (Cmd+K / Ctrl+K)\r\n  initGlobalSearch({\r\n    onResultClick: (result) => {\r\n      console.log('Search result clicked:', result);\r\n      // Navigate to the result based on type\r\n      window.dispatchEvent(new CustomEvent('godmode:navigate', { detail: result }));\r\n    }\r\n  });\r\n  console.log(' Global search initialized');\r\n\r\n  // Listen for godmode:navigate (e.g. \"View source document\" from Fact/Decision/Risk detail)\r\n  window.addEventListener('godmode:navigate', async (e: Event) => {\r\n    const d = (e as CustomEvent).detail;\r\n    if (!d || d.tab !== 'files' || !d.documentId) return;\r\n    switchTab('files');\r\n    await new Promise(r => setTimeout(r, 400)); // allow Files panel to mount\r\n    const doc = await documentsService.get(d.documentId);\r\n    if (doc) {\r\n      const { showDocumentPreviewModal } = await import('./components/modals/DocumentPreviewModal');\r\n      showDocumentPreviewModal({ document: doc });\r\n    }\r\n  });\r\n\r\n  // Initialize UI\r\n  initializeUI();\r\n  console.log(' UI initialized');\r\n\r\n  // Load initial data (only if authenticated or auth not required)\r\n  if (auth.isAuthenticated()) {\r\n    refreshData();\r\n    console.log(' Data loading started');\r\n  } else if (appStore.getState().authConfigured) {\r\n    // Auth required but not logged in - show integrated login screen\r\n    console.log(' Authentication required - showing login');\r\n    showAuthRequiredMessage();\r\n  } else {\r\n    // Auth not configured - guest mode\r\n    console.log(' Guest mode - loading data');\r\n    refreshData();\r\n  }\r\n  \r\n  // Hide loading state with animation\r\n  const loading = document.getElementById('app-loading');\r\n  if (loading) {\r\n    loading.classList.add('fade-out');\r\n    setTimeout(() => {\r\n      loading.style.display = 'none';\r\n    }, 300);\r\n  }\r\n  \r\n  // Log successful initialization\r\n  console.log(' GodMode Frontend ready');\r\n  console.log(` Version: ${window.godmode.version}`);\r\n  console.log(' Press ? for keyboard shortcuts');\r\n}\r\n\r\n/**\r\n * Initialize authentication\r\n */\r\nasync function initAuth(): Promise<void> {\r\n  // Check auth status and session\r\n  const isAuthenticated = await auth.init();\r\n  \r\n  // Update UI based on auth state\r\n  updateAuthUI();\r\n  \r\n  // Listen for auth required events (e.g., 401 from API)\r\n  auth.onAuthRequired(() => {\r\n    components.showAuthModal({\r\n      required: true, // Session expired, must re-authenticate\r\n      onSuccess: () => {\r\n        updateAuthUI();\r\n        refreshData();\r\n        toast.success('Session restored! Refreshing data...');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Listen for auth success to refresh data\r\n  window.addEventListener('godmode:auth-success', () => {\r\n    updateAuthUI();\r\n    refreshData();\r\n  });\r\n}\r\n\r\n/**\r\n * Show full-screen authentication blocker with integrated login form\r\n * Completely blocks access to the app until login\r\n */\r\nfunction showAuthRequiredMessage(): void {\r\n  // Remove any existing overlay\r\n  const existing = document.getElementById('auth-blocker-overlay');\r\n  if (existing) existing.remove();\r\n  \r\n  // Create full-screen blocker overlay\r\n  const authBlocker = document.createElement('div');\r\n  authBlocker.id = 'auth-blocker-overlay';\r\n  authBlocker.innerHTML = `\r\n    <style>\r\n      #auth-blocker-overlay {\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        width: 100vw;\r\n        height: 100vh;\r\n        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 999999;\r\n        overflow: auto;\r\n        font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\r\n      }\r\n      .auth-card {\r\n        width: 100%;\r\n        max-width: 420px;\r\n        background: rgba(255, 255, 255, 0.03);\r\n        border-radius: 20px;\r\n        backdrop-filter: blur(20px);\r\n        border: 1px solid rgba(255, 255, 255, 0.08);\r\n        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\r\n        padding: 2.5rem;\r\n        margin: 1rem;\r\n      }\r\n      .auth-logo {\r\n        width: 64px;\r\n        height: 64px;\r\n        margin: 0 auto 1.25rem;\r\n        background: linear-gradient(135deg, #e94560, #ff6b6b);\r\n        border-radius: 16px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);\r\n      }\r\n      .auth-title {\r\n        color: white;\r\n        font-size: 1.5rem;\r\n        font-weight: 700;\r\n        text-align: center;\r\n        margin-bottom: 0.5rem;\r\n        letter-spacing: -0.02em;\r\n      }\r\n      .auth-subtitle {\r\n        color: rgba(255, 255, 255, 0.6);\r\n        font-size: 0.9rem;\r\n        text-align: center;\r\n        margin-bottom: 2rem;\r\n      }\r\n      .auth-tabs {\r\n        display: flex;\r\n        gap: 0.5rem;\r\n        margin-bottom: 1.5rem;\r\n        background: rgba(255, 255, 255, 0.05);\r\n        border-radius: 10px;\r\n        padding: 4px;\r\n      }\r\n      .auth-tab {\r\n        flex: 1;\r\n        padding: 0.625rem 1rem;\r\n        border: none;\r\n        background: transparent;\r\n        color: rgba(255, 255, 255, 0.6);\r\n        font-size: 0.875rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        border-radius: 8px;\r\n        transition: all 0.2s;\r\n      }\r\n      .auth-tab:hover {\r\n        color: rgba(255, 255, 255, 0.9);\r\n      }\r\n      .auth-tab.active {\r\n        background: rgba(233, 69, 96, 0.2);\r\n        color: #ff6b6b;\r\n      }\r\n      .auth-form {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 1rem;\r\n      }\r\n      .auth-form.hidden {\r\n        display: none;\r\n      }\r\n      .form-group {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 0.375rem;\r\n      }\r\n      .form-label {\r\n        color: rgba(255, 255, 255, 0.8);\r\n        font-size: 0.8125rem;\r\n        font-weight: 500;\r\n      }\r\n      .form-input {\r\n        width: 100%;\r\n        padding: 0.75rem 1rem;\r\n        background: rgba(255, 255, 255, 0.06);\r\n        border: 1px solid rgba(255, 255, 255, 0.1);\r\n        border-radius: 10px;\r\n        color: white;\r\n        font-size: 0.9375rem;\r\n        transition: all 0.2s;\r\n        box-sizing: border-box;\r\n      }\r\n      .form-input::placeholder {\r\n        color: rgba(255, 255, 255, 0.35);\r\n      }\r\n      .form-input:focus {\r\n        outline: none;\r\n        border-color: #e94560;\r\n        background: rgba(255, 255, 255, 0.08);\r\n        box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.15);\r\n      }\r\n      .form-hint {\r\n        color: rgba(255, 255, 255, 0.4);\r\n        font-size: 0.75rem;\r\n      }\r\n      .form-error {\r\n        color: #ff6b6b;\r\n        font-size: 0.8125rem;\r\n        padding: 0.75rem;\r\n        background: rgba(255, 107, 107, 0.1);\r\n        border-radius: 8px;\r\n        display: none;\r\n      }\r\n      .form-error.visible {\r\n        display: block;\r\n      }\r\n      .auth-submit {\r\n        width: 100%;\r\n        padding: 0.875rem;\r\n        background: linear-gradient(135deg, #e94560, #ff6b6b);\r\n        border: none;\r\n        border-radius: 10px;\r\n        color: white;\r\n        font-size: 0.9375rem;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        margin-top: 0.5rem;\r\n      }\r\n      .auth-submit:hover:not(:disabled) {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 8px 25px rgba(233, 69, 96, 0.4);\r\n      }\r\n      .auth-submit:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n      }\r\n      .auth-link {\r\n        color: #ff6b6b;\r\n        background: none;\r\n        border: none;\r\n        font-size: 0.8125rem;\r\n        cursor: pointer;\r\n        padding: 0;\r\n        text-decoration: underline;\r\n        text-underline-offset: 2px;\r\n      }\r\n      .auth-link:hover {\r\n        color: #e94560;\r\n      }\r\n      .auth-footer {\r\n        text-align: center;\r\n        margin-top: 1.5rem;\r\n        color: rgba(255, 255, 255, 0.5);\r\n        font-size: 0.8125rem;\r\n      }\r\n      .password-toggle {\r\n        position: absolute;\r\n        right: 12px;\r\n        top: 50%;\r\n        transform: translateY(-50%);\r\n        background: none;\r\n        border: none;\r\n        color: rgba(255, 255, 255, 0.4);\r\n        cursor: pointer;\r\n        padding: 4px;\r\n      }\r\n      .password-toggle:hover {\r\n        color: rgba(255, 255, 255, 0.7);\r\n      }\r\n      .input-wrapper {\r\n        position: relative;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"auth-card\">\r\n      <div class=\"auth-logo\">\r\n        <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n          <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\r\n          <path d=\"M2 17l10 5 10-5\"/>\r\n          <path d=\"M2 12l10 5 10-5\"/>\r\n        </svg>\r\n      </div>\r\n      <h1 class=\"auth-title\">Welcome to GodMode</h1>\r\n      <p class=\"auth-subtitle\">Your AI-powered knowledge management platform</p>\r\n      \r\n      <div class=\"auth-tabs\">\r\n        <button class=\"auth-tab active\" data-tab=\"login\">Sign In</button>\r\n        <button class=\"auth-tab\" data-tab=\"register\">Create Account</button>\r\n      </div>\r\n      \r\n      <!-- Login Form -->\r\n      <form id=\"login-form\" class=\"auth-form\">\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Email</label>\r\n          <input type=\"email\" class=\"form-input\" id=\"login-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Password</label>\r\n          <div class=\"input-wrapper\">\r\n            <input type=\"password\" class=\"form-input\" id=\"login-password\" placeholder=\"Enter your password\" required autocomplete=\"current-password\">\r\n          </div>\r\n        </div>\r\n        <div class=\"form-error\" id=\"login-error\"></div>\r\n        <button type=\"submit\" class=\"auth-submit\" id=\"login-submit\">Sign In</button>\r\n        <div class=\"auth-footer\">\r\n          <button type=\"button\" class=\"auth-link\" id=\"forgot-link\">Forgot your password?</button>\r\n        </div>\r\n      </form>\r\n      \r\n      <!-- Register Form -->\r\n      <form id=\"register-form\" class=\"auth-form hidden\">\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Email *</label>\r\n          <input type=\"email\" class=\"form-input\" id=\"register-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Display Name</label>\r\n          <input type=\"text\" class=\"form-input\" id=\"register-name\" placeholder=\"Your name (optional)\" autocomplete=\"name\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Password *</label>\r\n          <input type=\"password\" class=\"form-input\" id=\"register-password\" placeholder=\"Min. 12 characters\" required minlength=\"12\" autocomplete=\"new-password\">\r\n          <span class=\"form-hint\">Use at least 12 characters with mixed case, numbers, and symbols</span>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Confirm Password *</label>\r\n          <input type=\"password\" class=\"form-input\" id=\"register-confirm\" placeholder=\"Confirm your password\" required autocomplete=\"new-password\">\r\n        </div>\r\n        <div class=\"form-error\" id=\"register-error\"></div>\r\n        <button type=\"submit\" class=\"auth-submit\" id=\"register-submit\">Create Account</button>\r\n      </form>\r\n      \r\n      <!-- Forgot Password Form -->\r\n      <form id=\"forgot-form\" class=\"auth-form hidden\">\r\n        <p style=\"color: rgba(255,255,255,0.7); font-size: 0.875rem; margin-bottom: 1rem;\">\r\n          Enter your email and we'll send you a link to reset your password.\r\n        </p>\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Email</label>\r\n          <input type=\"email\" class=\"form-input\" id=\"forgot-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\r\n        </div>\r\n        <div class=\"form-error\" id=\"forgot-error\"></div>\r\n        <button type=\"submit\" class=\"auth-submit\">Send Reset Link</button>\r\n        <div class=\"auth-footer\">\r\n          <button type=\"button\" class=\"auth-link\" id=\"back-to-login\">Back to Sign In</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  `;\r\n  \r\n  document.body.appendChild(authBlocker);\r\n  \r\n  // Tab switching\r\n  const tabs = authBlocker.querySelectorAll('.auth-tab');\r\n  const loginForm = authBlocker.querySelector('#login-form') as HTMLFormElement;\r\n  const registerForm = authBlocker.querySelector('#register-form') as HTMLFormElement;\r\n  const forgotForm = authBlocker.querySelector('#forgot-form') as HTMLFormElement;\r\n  \r\n  tabs.forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      \r\n      const tabId = tab.getAttribute('data-tab');\r\n      loginForm.classList.toggle('hidden', tabId !== 'login');\r\n      registerForm.classList.toggle('hidden', tabId !== 'register');\r\n      forgotForm.classList.add('hidden');\r\n    });\r\n  });\r\n  \r\n  // Forgot password link\r\n  const forgotLink = authBlocker.querySelector('#forgot-link');\r\n  forgotLink?.addEventListener('click', () => {\r\n    loginForm.classList.add('hidden');\r\n    registerForm.classList.add('hidden');\r\n    forgotForm.classList.remove('hidden');\r\n    tabs.forEach(t => t.classList.remove('active'));\r\n  });\r\n  \r\n  // Back to login\r\n  const backToLogin = authBlocker.querySelector('#back-to-login');\r\n  backToLogin?.addEventListener('click', () => {\r\n    forgotForm.classList.add('hidden');\r\n    loginForm.classList.remove('hidden');\r\n    tabs[0].classList.add('active');\r\n  });\r\n  \r\n  // Handle Login\r\n  loginForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    const email = (authBlocker.querySelector('#login-email') as HTMLInputElement).value;\r\n    const password = (authBlocker.querySelector('#login-password') as HTMLInputElement).value;\r\n    const errorEl = authBlocker.querySelector('#login-error') as HTMLElement;\r\n    const submitBtn = authBlocker.querySelector('#login-submit') as HTMLButtonElement;\r\n    \r\n    submitBtn.disabled = true;\r\n    submitBtn.textContent = 'Signing in...';\r\n    errorEl.classList.remove('visible');\r\n    \r\n    try {\r\n      await auth.login({ email, password });\r\n      authBlocker.remove();\r\n      updateAuthUI();\r\n      refreshData();\r\n      toast.success('Welcome back!');\r\n    } catch (err) {\r\n      errorEl.textContent = err instanceof Error ? err.message : 'Login failed. Please try again.';\r\n      errorEl.classList.add('visible');\r\n    } finally {\r\n      submitBtn.disabled = false;\r\n      submitBtn.textContent = 'Sign In';\r\n    }\r\n  });\r\n  \r\n  // Handle Register\r\n  registerForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    const email = (authBlocker.querySelector('#register-email') as HTMLInputElement).value;\r\n    const name = (authBlocker.querySelector('#register-name') as HTMLInputElement).value;\r\n    const password = (authBlocker.querySelector('#register-password') as HTMLInputElement).value;\r\n    const confirm = (authBlocker.querySelector('#register-confirm') as HTMLInputElement).value;\r\n    const errorEl = authBlocker.querySelector('#register-error') as HTMLElement;\r\n    const submitBtn = authBlocker.querySelector('#register-submit') as HTMLButtonElement;\r\n    \r\n    if (password !== confirm) {\r\n      errorEl.textContent = 'Passwords do not match';\r\n      errorEl.classList.add('visible');\r\n      return;\r\n    }\r\n    \r\n    if (password.length < 12) {\r\n      errorEl.textContent = 'Password must be at least 12 characters';\r\n      errorEl.classList.add('visible');\r\n      return;\r\n    }\r\n    \r\n    submitBtn.disabled = true;\r\n    submitBtn.textContent = 'Creating account...';\r\n    errorEl.classList.remove('visible');\r\n    \r\n    try {\r\n      const result = await auth.register({ email, password, display_name: name || undefined });\r\n      \r\n      if (result.needsEmailVerification) {\r\n        toast.success('Account created! Check your email to verify.');\r\n        // Switch to login tab\r\n        tabs.forEach(t => t.classList.remove('active'));\r\n        tabs[0].classList.add('active');\r\n        registerForm.classList.add('hidden');\r\n        loginForm.classList.remove('hidden');\r\n      } else {\r\n        authBlocker.remove();\r\n        updateAuthUI();\r\n        refreshData();\r\n        toast.success('Account created! Welcome to GodMode.');\r\n      }\r\n    } catch (err) {\r\n      errorEl.textContent = err instanceof Error ? err.message : 'Registration failed. Please try again.';\r\n      errorEl.classList.add('visible');\r\n    } finally {\r\n      submitBtn.disabled = false;\r\n      submitBtn.textContent = 'Create Account';\r\n    }\r\n  });\r\n  \r\n  // Handle Forgot Password\r\n  forgotForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    const email = (authBlocker.querySelector('#forgot-email') as HTMLInputElement).value;\r\n    const submitBtn = forgotForm.querySelector('.auth-submit') as HTMLButtonElement;\r\n    \r\n    submitBtn.disabled = true;\r\n    submitBtn.textContent = 'Sending...';\r\n    \r\n    try {\r\n      await auth.forgotPassword(email);\r\n      toast.success('If an account exists, you will receive a reset link.');\r\n      // Go back to login\r\n      forgotForm.classList.add('hidden');\r\n      loginForm.classList.remove('hidden');\r\n      tabs[0].classList.add('active');\r\n    } catch {\r\n      toast.success('If an account exists, you will receive a reset link.');\r\n    } finally {\r\n      submitBtn.disabled = false;\r\n      submitBtn.textContent = 'Send Reset Link';\r\n    }\r\n  });\r\n  \r\n  // Focus email input\r\n  setTimeout(() => {\r\n    const emailInput = authBlocker.querySelector('#login-email') as HTMLInputElement;\r\n    emailInput?.focus();\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Update UI based on auth state\r\n */\r\nfunction updateAuthUI(): void {\r\n  const user = auth.getCurrentUser();\r\n  const userAvatar = document.getElementById('user-avatar');\r\n  const userDropdown = document.getElementById('user-dropdown');\r\n  const loginBtn = document.getElementById('login-btn');\r\n  \r\n  // Remove auth blocker if it exists\r\n  const authBlocker = document.getElementById('auth-blocker-overlay');\r\n  if (authBlocker && user) {\r\n    authBlocker.remove();\r\n  }\r\n  \r\n  // Admin nav button - only visible for superadmin\r\n  const adminNavBtn = document.getElementById('nav-admin-btn');\r\n  \r\n  if (user) {\r\n    // Show user info\r\n    if (userAvatar) {\r\n      const displayName = user.name || user.email.split('@')[0] || 'User';\r\n      const initials = (user.name?.[0] || user.email[0]).toUpperCase();\r\n      \r\n      // Generate fallback avatar URL using UI Avatars\r\n      const fallbackAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=e11d48&color=fff&size=80&font-size=0.4&bold=true`;\r\n      const avatarUrl = user.avatar || fallbackAvatar;\r\n      \r\n      // Use image for avatar\r\n      userAvatar.innerHTML = `<img src=\"${avatarUrl}\" alt=\"${initials}\" style=\"width:100%;height:100%;border-radius:50%;object-fit:cover;\" onerror=\"this.style.display='none';this.parentElement.textContent='${initials}';\">`;\r\n      userAvatar.title = user.name || user.email;\r\n      userAvatar.classList.remove('hidden');\r\n    }\r\n    if (loginBtn) {\r\n      loginBtn.classList.add('hidden');\r\n    }\r\n    // Update dropdown content\r\n    if (userDropdown) {\r\n      const userName = userDropdown.querySelector('.user-name');\r\n      const userEmail = userDropdown.querySelector('.user-email');\r\n      if (userName) userName.textContent = user.name || 'User';\r\n      if (userEmail) userEmail.textContent = user.email;\r\n    }\r\n    \r\n    // Show/hide Admin nav based on role\r\n    if (adminNavBtn) {\r\n      if (user.role === 'superadmin') {\r\n        adminNavBtn.classList.remove('hidden');\r\n        console.log(' Admin nav enabled for superadmin:', user.email);\r\n      } else {\r\n        adminNavBtn.classList.add('hidden');\r\n      }\r\n    }\r\n  } else {\r\n    // Show login button\r\n    if (userAvatar) {\r\n      userAvatar.classList.add('hidden');\r\n    }\r\n    if (loginBtn) {\r\n      loginBtn.classList.remove('hidden');\r\n    }\r\n    // Hide admin nav when logged out\r\n    if (adminNavBtn) {\r\n      adminNavBtn.classList.add('hidden');\r\n    }\r\n  }\r\n}\r\n\r\n// Initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', init);\r\n} else {\r\n  init();\r\n}\r\n\r\n// Add components to global\r\nObject.assign(window.godmode, { components });\r\n\r\n// Export for potential use in other modules\r\nexport { \r\n  theme, toast, shortcuts, undoManager, storage, http, api, configureApi, auth, projects,\r\n  dashboardService, questionsService, risksService, actionsService, decisionsService,\r\n  chatService, contactsService, teamsService, documentsService, knowledgeService,\r\n  emailsService, graphService, timelineService, costsService, notificationsService,\r\n  commentsService, membersService, profileService, userSettingsService, projectSettingsService,\r\n  apiKeysService, webhooksService, auditService\r\n};\r\nexport { appStore, uiStore, dataStore, chartsStore };\r\nexport { components };\r\n"],"file":"index-B9P9I_3p.js"}