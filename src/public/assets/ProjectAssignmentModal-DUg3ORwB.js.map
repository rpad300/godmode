{"version":3,"file":"ProjectAssignmentModal-DUg3ORwB.js","sources":["../../frontend/components/modals/ProjectAssignmentModal.ts"],"sourcesContent":["/**\r\n * Project Assignment Modal\r\n * Assign a Krisp transcript to a project manually\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { toast } from '../../services/toast';\r\nimport { http } from '../../services/api';\r\nimport * as krispService from '../../services/krisp';\r\nimport type { KrispTranscript, ProjectCandidate, TranscriptSummary } from '../../services/krisp';\r\n\r\nconst MODAL_ID = 'project-assignment-modal';\r\n\r\ninterface Project {\r\n  id: string;\r\n  name: string;\r\n  project_number?: string;\r\n}\r\n\r\nexport interface ProjectAssignmentModalProps {\r\n  transcript: KrispTranscript;\r\n  onAssign?: () => void;\r\n  onClose?: () => void;\r\n}\r\n\r\nlet currentProps: ProjectAssignmentModalProps | null = null;\r\nlet userProjects: Project[] = [];\r\n\r\n/**\r\n * Show project assignment modal\r\n */\r\nexport async function showProjectAssignmentModal(props: ProjectAssignmentModalProps): Promise<void> {\r\n  currentProps = props;\r\n  const { transcript } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'project-assignment' });\r\n\r\n  content.innerHTML = `\r\n    <style>\r\n      .project-assignment {\r\n        padding: 16px 0;\r\n      }\r\n      .assignment-info {\r\n        margin-bottom: 24px;\r\n        padding: 16px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-radius: 8px;\r\n      }\r\n      .assignment-title {\r\n        font-weight: 600;\r\n        margin-bottom: 8px;\r\n        color: var(--text-primary, #1e293b);\r\n      }\r\n      .assignment-reason {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        color: #f59e0b;\r\n        font-size: 14px;\r\n        margin-bottom: 12px;\r\n      }\r\n      .assignment-reason svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        flex-shrink: 0;\r\n      }\r\n      .speakers-list {\r\n        font-size: 13px;\r\n        color: var(--text-secondary, #64748b);\r\n      }\r\n      .speakers-list strong {\r\n        color: var(--text-primary, #1e293b);\r\n      }\r\n      .candidates-section {\r\n        margin-bottom: 24px;\r\n      }\r\n      .candidates-section h4 {\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        margin-bottom: 12px;\r\n        color: var(--text-secondary, #64748b);\r\n      }\r\n      .candidate-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 8px;\r\n      }\r\n      .candidate-item {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 12px 16px;\r\n        border: 2px solid var(--border-color, #e2e8f0);\r\n        border-radius: 8px;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n      .candidate-item:hover {\r\n        border-color: var(--primary-light, #fda4af);\r\n        background: var(--bg-secondary, #f8fafc);\r\n      }\r\n      .candidate-item.selected {\r\n        border-color: var(--primary, #e11d48);\r\n        background: #fef2f2;\r\n      }\r\n      .candidate-radio {\r\n        width: 20px;\r\n        height: 20px;\r\n        border: 2px solid var(--border-color, #e2e8f0);\r\n        border-radius: 50%;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        flex-shrink: 0;\r\n      }\r\n      .candidate-item.selected .candidate-radio {\r\n        border-color: var(--primary, #e11d48);\r\n      }\r\n      .candidate-item.selected .candidate-radio::after {\r\n        content: '';\r\n        width: 10px;\r\n        height: 10px;\r\n        background: var(--primary, #e11d48);\r\n        border-radius: 50%;\r\n      }\r\n      .candidate-info {\r\n        flex: 1;\r\n      }\r\n      .candidate-name {\r\n        font-weight: 500;\r\n        color: var(--text-primary, #1e293b);\r\n      }\r\n      .candidate-code {\r\n        font-size: 12px;\r\n        color: var(--text-secondary, #64748b);\r\n      }\r\n      .candidate-confidence {\r\n        font-size: 13px;\r\n        padding: 4px 10px;\r\n        background: var(--bg-tertiary, #f1f5f9);\r\n        border-radius: 12px;\r\n        color: var(--text-secondary, #64748b);\r\n      }\r\n      .project-select-section {\r\n        margin-bottom: 24px;\r\n      }\r\n      .project-select-section h4 {\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        margin-bottom: 12px;\r\n        color: var(--text-secondary, #64748b);\r\n      }\r\n      .project-select {\r\n        width: 100%;\r\n        padding: 12px;\r\n        border: 1px solid var(--border-color, #e2e8f0);\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        background: white;\r\n      }\r\n      .action-buttons {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 12px;\r\n        padding-top: 16px;\r\n        border-top: 1px solid var(--border-color, #e2e8f0);\r\n      }\r\n      .btn {\r\n        padding: 10px 20px;\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n      .btn-secondary {\r\n        background: var(--bg-secondary, #f1f5f9);\r\n        color: var(--text-primary, #1e293b);\r\n      }\r\n      .btn-secondary:hover {\r\n        background: var(--bg-tertiary, #e2e8f0);\r\n      }\r\n      .btn-primary {\r\n        background: var(--primary, #e11d48);\r\n        color: white;\r\n      }\r\n      .btn-primary:hover {\r\n        opacity: 0.9;\r\n      }\r\n      .btn-primary:disabled {\r\n        opacity: 0.5;\r\n        cursor: not-allowed;\r\n      }\r\n      .btn-danger {\r\n        background: transparent;\r\n        color: #dc2626;\r\n        border: 1px solid #dc2626;\r\n      }\r\n      .btn-danger:hover {\r\n        background: #fef2f2;\r\n      }\r\n      [data-theme=\"dark\"] .assignment-info {\r\n        background: rgba(30,41,59,0.5);\r\n      }\r\n      [data-theme=\"dark\"] .candidate-item.selected {\r\n        background: rgba(225,29,72,0.1);\r\n      }\r\n      [data-theme=\"dark\"] .project-select {\r\n        background: rgba(30,41,59,0.8);\r\n        color: white;\r\n      }\r\n      \r\n      /* Meeting Summary Styles */\r\n      .meeting-summary {\r\n        margin-bottom: 24px;\r\n        padding: 16px;\r\n        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\r\n        border-radius: 12px;\r\n        border: 1px solid #bae6fd;\r\n      }\r\n      [data-theme=\"dark\"] .meeting-summary {\r\n        background: linear-gradient(135deg, rgba(14,165,233,0.1) 0%, rgba(56,189,248,0.05) 100%);\r\n        border-color: rgba(56,189,248,0.2);\r\n      }\r\n      .summary-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        margin-bottom: 12px;\r\n        font-weight: 600;\r\n        color: #0369a1;\r\n      }\r\n      [data-theme=\"dark\"] .summary-header {\r\n        color: #38bdf8;\r\n      }\r\n      .summary-header svg {\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n      .summary-topic {\r\n        font-size: 15px;\r\n        color: var(--text-primary, #1e293b);\r\n        margin-bottom: 12px;\r\n        line-height: 1.5;\r\n      }\r\n      .summary-section {\r\n        margin-bottom: 12px;\r\n      }\r\n      .summary-section:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      .summary-section-title {\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n        text-transform: uppercase;\r\n        color: #0369a1;\r\n        margin-bottom: 6px;\r\n        letter-spacing: 0.5px;\r\n      }\r\n      [data-theme=\"dark\"] .summary-section-title {\r\n        color: #7dd3fc;\r\n      }\r\n      .summary-list {\r\n        list-style: none;\r\n        padding: 0;\r\n        margin: 0;\r\n      }\r\n      .summary-list li {\r\n        position: relative;\r\n        padding-left: 16px;\r\n        font-size: 13px;\r\n        color: var(--text-secondary, #475569);\r\n        margin-bottom: 4px;\r\n        line-height: 1.4;\r\n      }\r\n      .summary-list li::before {\r\n        content: 'â€¢';\r\n        position: absolute;\r\n        left: 0;\r\n        color: #0ea5e9;\r\n      }\r\n      .summary-loading {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        color: var(--text-secondary, #64748b);\r\n        font-size: 14px;\r\n      }\r\n      .summary-loading .spinner {\r\n        width: 20px;\r\n        height: 20px;\r\n        border: 2px solid #e2e8f0;\r\n        border-top-color: #0ea5e9;\r\n        border-radius: 50%;\r\n        animation: spin 1s linear infinite;\r\n      }\r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n      .refresh-summary-btn {\r\n        background: transparent;\r\n        border: none;\r\n        padding: 4px;\r\n        cursor: pointer;\r\n        color: #0369a1;\r\n        border-radius: 4px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        transition: all 0.2s;\r\n      }\r\n      .refresh-summary-btn:hover {\r\n        background: rgba(3, 105, 161, 0.1);\r\n      }\r\n      [data-theme=\"dark\"] .refresh-summary-btn {\r\n        color: #38bdf8;\r\n      }\r\n      [data-theme=\"dark\"] .refresh-summary-btn:hover {\r\n        background: rgba(56, 189, 248, 0.1);\r\n      }\r\n      .summary-source {\r\n        font-size: 11px;\r\n        color: var(--text-tertiary, #94a3b8);\r\n        text-align: right;\r\n        margin-top: 8px;\r\n      }\r\n    </style>\r\n    \r\n    <!-- Meeting Summary Section -->\r\n    <div class=\"meeting-summary\" id=\"meeting-summary\">\r\n      <div class=\"summary-loading\">\r\n        <div class=\"spinner\"></div>\r\n        <span>Generating meeting summary...</span>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"assignment-info\">\r\n      <div class=\"assignment-title\">${escapeHtml(transcript.krisp_title || 'Untitled Meeting')}</div>\r\n      ${transcript.status_reason ? `\r\n        <div class=\"assignment-reason\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\r\n          </svg>\r\n          ${escapeHtml(transcript.status_reason)}\r\n        </div>\r\n      ` : ''}\r\n      <div class=\"speakers-list\">\r\n        <strong>Speakers:</strong> ${transcript.speakers?.join(', ') || 'None identified'}\r\n      </div>\r\n    </div>\r\n    \r\n    <div id=\"assignment-content\">\r\n      <div class=\"loading-spinner\"></div>\r\n    </div>\r\n    \r\n    <div class=\"action-buttons\">\r\n      <button type=\"button\" class=\"btn btn-danger\" id=\"skip-btn\">Skip Transcript</button>\r\n      <div style=\"flex: 1;\"></div>\r\n      <button type=\"button\" class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\r\n      <button type=\"button\" class=\"btn btn-primary\" id=\"assign-btn\" disabled>Assign to Project</button>\r\n    </div>\r\n  `;\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Assign to Project',\r\n    content,\r\n    size: 'md',\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Bind button events\r\n  bindButtonEvents(content);\r\n\r\n  // Load summary and projects in parallel\r\n  loadMeetingSummary(content, transcript);\r\n  await loadProjectOptions(content, transcript);\r\n}\r\n\r\n/**\r\n * Bind button events\r\n */\r\nfunction bindButtonEvents(container: HTMLElement): void {\r\n  const cancelBtn = container.querySelector('#cancel-btn');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      currentProps?.onClose?.();\r\n    });\r\n  }\r\n\r\n  const skipBtn = container.querySelector('#skip-btn');\r\n  if (skipBtn) {\r\n    on(skipBtn as HTMLElement, 'click', async () => {\r\n      if (!currentProps?.transcript) return;\r\n      \r\n      if (!confirm('Are you sure you want to skip this transcript? It will not be processed.')) return;\r\n\r\n      const success = await krispService.skipTranscript(currentProps.transcript.id, 'Manually skipped');\r\n      \r\n      if (success) {\r\n        toast.success('Transcript skipped');\r\n        closeModal(MODAL_ID);\r\n        currentProps?.onAssign?.();\r\n      } else {\r\n        toast.error('Failed to skip transcript');\r\n      }\r\n    });\r\n  }\r\n\r\n  const assignBtn = container.querySelector('#assign-btn');\r\n  if (assignBtn) {\r\n    on(assignBtn as HTMLElement, 'click', async () => {\r\n      const selected = container.querySelector('.candidate-item.selected, .project-select') as HTMLElement;\r\n      let projectId: string | null = null;\r\n\r\n      // Check if a candidate is selected\r\n      const selectedCandidate = container.querySelector('.candidate-item.selected');\r\n      if (selectedCandidate) {\r\n        projectId = selectedCandidate.getAttribute('data-project-id');\r\n      } else {\r\n        // Check the dropdown\r\n        const selectEl = container.querySelector('.project-select') as HTMLSelectElement;\r\n        if (selectEl?.value) {\r\n          projectId = selectEl.value;\r\n        }\r\n      }\r\n\r\n      if (!projectId || !currentProps?.transcript) {\r\n        toast.error('Please select a project');\r\n        return;\r\n      }\r\n\r\n      (assignBtn as HTMLButtonElement).disabled = true;\r\n      assignBtn.textContent = 'Assigning...';\r\n\r\n      const success = await krispService.assignProject(currentProps.transcript.id, projectId);\r\n\r\n      if (success) {\r\n        toast.success('Transcript assigned to project');\r\n        closeModal(MODAL_ID);\r\n        currentProps?.onAssign?.();\r\n      } else {\r\n        toast.error('Failed to assign project');\r\n        (assignBtn as HTMLButtonElement).disabled = false;\r\n        assignBtn.textContent = 'Assign to Project';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Load project options\r\n */\r\nasync function loadProjectOptions(container: HTMLElement, transcript: KrispTranscript): Promise<void> {\r\n  const contentEl = container.querySelector('#assignment-content');\r\n  if (!contentEl) return;\r\n\r\n  try {\r\n    // Load user's projects\r\n    const response = await http.get<{ projects: Project[] }>('/api/projects');\r\n    userProjects = response.data.projects || [];\r\n\r\n    // Get candidates from transcript\r\n    const candidates = transcript.project_candidates || [];\r\n\r\n    let html = '';\r\n\r\n    // Show candidates if available\r\n    if (candidates.length > 0) {\r\n      html += `\r\n        <div class=\"candidates-section\">\r\n          <h4>Suggested Projects (based on speakers)</h4>\r\n          <div class=\"candidate-list\">\r\n            ${candidates.map((c: ProjectCandidate) => `\r\n              <div class=\"candidate-item\" data-project-id=\"${c.projectId}\">\r\n                <div class=\"candidate-radio\"></div>\r\n                <div class=\"candidate-info\">\r\n                  <div class=\"candidate-name\">${escapeHtml(c.projectName || 'Unknown')}</div>\r\n                  <div class=\"candidate-code\">${escapeHtml(c.projectNumber || '')}</div>\r\n                </div>\r\n                <div class=\"candidate-confidence\">${Math.round(c.percentage * 100)}% match</div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    // Show project dropdown for other projects\r\n    html += `\r\n      <div class=\"project-select-section\">\r\n        <h4>${candidates.length > 0 ? 'Or select another project' : 'Select a project'}</h4>\r\n        <select class=\"project-select\">\r\n          <option value=\"\">Choose a project...</option>\r\n          ${userProjects.map(p => `\r\n            <option value=\"${p.id}\">${p.project_number ? `${p.project_number} - ` : ''}${escapeHtml(p.name)}</option>\r\n          `).join('')}\r\n        </select>\r\n      </div>\r\n    `;\r\n\r\n    contentEl.innerHTML = html;\r\n\r\n    // Bind candidate selection\r\n    contentEl.querySelectorAll('.candidate-item').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        // Deselect all\r\n        contentEl.querySelectorAll('.candidate-item').forEach(i => i.classList.remove('selected'));\r\n        // Select this one\r\n        item.classList.add('selected');\r\n        // Clear dropdown\r\n        const select = contentEl.querySelector('.project-select') as HTMLSelectElement;\r\n        if (select) select.value = '';\r\n        // Enable assign button\r\n        const assignBtn = container.querySelector('#assign-btn') as HTMLButtonElement;\r\n        if (assignBtn) assignBtn.disabled = false;\r\n      });\r\n    });\r\n\r\n    // Bind dropdown change\r\n    const select = contentEl.querySelector('.project-select');\r\n    if (select) {\r\n      on(select as HTMLElement, 'change', () => {\r\n        // Deselect candidates\r\n        contentEl.querySelectorAll('.candidate-item').forEach(i => i.classList.remove('selected'));\r\n        // Enable/disable assign button\r\n        const assignBtn = container.querySelector('#assign-btn') as HTMLButtonElement;\r\n        if (assignBtn) {\r\n          assignBtn.disabled = !(select as HTMLSelectElement).value;\r\n        }\r\n      });\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('[ProjectAssignmentModal] Error loading projects:', error);\r\n    contentEl.innerHTML = '<p style=\"color: #dc2626;\">Failed to load projects. Please try again.</p>';\r\n  }\r\n}\r\n\r\n/**\r\n * Load and display meeting summary\r\n */\r\nasync function loadMeetingSummary(\r\n  container: HTMLElement, \r\n  transcript: KrispTranscript,\r\n  forceRegenerate = false\r\n): Promise<void> {\r\n  const summaryEl = container.querySelector('#meeting-summary');\r\n  if (!summaryEl) return;\r\n\r\n  // Show loading state\r\n  if (forceRegenerate) {\r\n    summaryEl.innerHTML = `\r\n      <div class=\"summary-loading\">\r\n        <div class=\"spinner\"></div>\r\n        <span>Regenerating summary...</span>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  try {\r\n    const summary = await krispService.generateSummary(transcript.id, { forceRegenerate });\r\n\r\n    if (!summary) {\r\n      summaryEl.innerHTML = `\r\n        <div class=\"summary-header\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"/>\r\n          </svg>\r\n          Meeting Summary\r\n          <button class=\"refresh-summary-btn\" title=\"Regenerate summary\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"16\" height=\"16\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <p style=\"color: var(--text-secondary); font-size: 13px;\">Unable to generate summary.</p>\r\n      `;\r\n      bindRefreshButton(container, transcript);\r\n      return;\r\n    }\r\n\r\n    // Build summary HTML with refresh button\r\n    let html = `\r\n      <div class=\"summary-header\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"/>\r\n        </svg>\r\n        <span style=\"flex: 1;\">Meeting Summary</span>\r\n        <button class=\"refresh-summary-btn\" title=\"Regenerate summary\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"16\" height=\"16\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n    // Topic/main subject\r\n    if (summary.topic) {\r\n      html += `<div class=\"summary-topic\">${escapeHtml(summary.topic)}</div>`;\r\n    } else if (summary.notes) {\r\n      html += `<div class=\"summary-topic\">${escapeHtml(summary.notes)}</div>`;\r\n    }\r\n\r\n    // Key Points\r\n    if (summary.keyPoints && summary.keyPoints.length > 0) {\r\n      html += `\r\n        <div class=\"summary-section\">\r\n          <div class=\"summary-section-title\">Key Points</div>\r\n          <ul class=\"summary-list\">\r\n            ${summary.keyPoints.slice(0, 5).map(point => `<li>${escapeHtml(String(point))}</li>`).join('')}\r\n          </ul>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    // Action Items\r\n    if (summary.actionItems && summary.actionItems.length > 0) {\r\n      html += `\r\n        <div class=\"summary-section\">\r\n          <div class=\"summary-section-title\">Action Items</div>\r\n          <ul class=\"summary-list\">\r\n            ${summary.actionItems.slice(0, 5).map(item => `<li>${escapeHtml(String(item))}</li>`).join('')}\r\n          </ul>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    // Decisions\r\n    if (summary.decisions && summary.decisions.length > 0) {\r\n      html += `\r\n        <div class=\"summary-section\">\r\n          <div class=\"summary-section-title\">Decisions</div>\r\n          <ul class=\"summary-list\">\r\n            ${summary.decisions.slice(0, 3).map(dec => `<li>${escapeHtml(String(dec))}</li>`).join('')}\r\n          </ul>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    // Next Steps\r\n    if (summary.nextSteps) {\r\n      html += `\r\n        <div class=\"summary-section\">\r\n          <div class=\"summary-section-title\">Next Steps</div>\r\n          <p style=\"font-size: 13px; color: var(--text-secondary); margin: 0;\">${escapeHtml(summary.nextSteps)}</p>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    // Source indicator\r\n    const sourceLabels: Record<string, string> = {\r\n      'krisp_metadata': 'From Krisp',\r\n      'ai_generated': 'AI Generated',\r\n      'excerpt_fallback': 'Excerpt',\r\n      'no_content': ''\r\n    };\r\n    if (summary.source && sourceLabels[summary.source]) {\r\n      html += `<div class=\"summary-source\">${sourceLabels[summary.source]}</div>`;\r\n    }\r\n\r\n    summaryEl.innerHTML = html;\r\n    \r\n    // Bind refresh button\r\n    bindRefreshButton(container, transcript);\r\n\r\n  } catch (error) {\r\n    console.error('[ProjectAssignmentModal] Summary error:', error);\r\n    summaryEl.innerHTML = `\r\n      <div class=\"summary-header\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"/>\r\n        </svg>\r\n        <span style=\"flex: 1;\">Meeting Summary</span>\r\n        <button class=\"refresh-summary-btn\" title=\"Regenerate summary\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"16\" height=\"16\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      <p style=\"color: var(--text-secondary); font-size: 13px;\">Could not load summary.</p>\r\n    `;\r\n    bindRefreshButton(container, transcript);\r\n  }\r\n}\r\n\r\n/**\r\n * Bind refresh summary button\r\n */\r\nfunction bindRefreshButton(container: HTMLElement, transcript: KrispTranscript): void {\r\n  const btn = container.querySelector('.refresh-summary-btn');\r\n  if (btn) {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      await loadMeetingSummary(container, transcript, true);\r\n      toast.success('Summary regenerated');\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Close the modal\r\n */\r\nexport function closeProjectAssignmentModal(): void {\r\n  closeModal(MODAL_ID);\r\n}\r\n"],"names":["MODAL_ID","currentProps","userProjects","showProjectAssignmentModal","props","transcript","existing","content","createElement","escapeHtml","modal","createModal","openModal","bindButtonEvents","loadMeetingSummary","loadProjectOptions","container","cancelBtn","on","closeModal","skipBtn","krispService.skipTranscript","toast","assignBtn","projectId","selectedCandidate","selectEl","krispService.assignProject","contentEl","http","candidates","html","c","p","item","i","select","error","forceRegenerate","summaryEl","summary","krispService.generateSummary","bindRefreshButton","point","dec","sourceLabels","btn","e","text","div"],"mappings":"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"}