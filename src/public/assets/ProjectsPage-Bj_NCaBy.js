import{c as ge,cx as Fe,r,fR as Oe,fS as Ke,fT as Ue,fU as ze,j as e,N as F,b8 as qe,ar as le,aq as B,a as _,H as ce,b6 as D,U as Q,P as _e,O as o,an as pe,ba as ae,bb as se,bc as re,bd as ie,be as W,al as oe,T as Be,ak as Z,ao as H,g as de,fV as be,fW as fe,fX as Ve,fY as Ge,fZ as Je,f_ as He,f$ as Ye,a1 as We,C as Xe,g0 as Qe,g1 as Ze,g2 as et,g3 as tt,g4 as at,g5 as st,a4 as xe,cE as rt,dq as it,g6 as nt,ds as lt,g7 as ct,g8 as ot,g9 as dt,ga as mt,br as he,bs as ve,gb as ue,bt as ye,b as Ne}from"./main-BKbBKYvC.js";import{I as z}from"./input-DsK7IqD2.js";import{A as Pe,a as Ae,b as De,c as Te,d as Ie,e as Me,f as Re,g as Ee}from"./alert-dialog-BuwvV1Iy.js";import{U as we}from"./upload-BtADKM1s.js";import{P as ne}from"./plus-BG5YpVIb.js";import{S as Ce}from"./star-_8XYD7us.js";import{P as xt}from"./play-BOQB2G_-.js";import{P as je}from"./pen-BADy_74g.js";import{A as gt}from"./arrow-left-ZBUT7vL6.js";import{U as me}from"./user-plus-DXXcvBw_.js";import{U as pt}from"./users-round-CN2BgtyY.js";import{K as Le}from"./key-Cfbr9NfN.js";import{G as ke}from"./grip-vertical--qLQuYrG.js";import{L as ht}from"./link-2-CWyrMbe7.js";import{S as vt}from"./square-check-big-B5vwT1uX.js";import{T as ut}from"./test-tube-C0Ew-oTr.js";import{S as yt}from"./sparkles-BJxATUBg.js";import"./index-CKDzCnkP.js";const jt=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],bt=ge("settings-2",jt);const ft=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],te=ge("shield-check",ft);const Nt=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],$e=ge("sliders-horizontal",Nt),Se=[{id:"1",name:"Project Manager",description:"Oversees project execution and delivery",active:!0},{id:"2",name:"Tech Lead",description:"Technical leadership and architecture decisions",active:!0},{id:"3",name:"Product Owner",description:"Defines product vision and priorities",active:!0},{id:"4",name:"Designer",description:"UI/UX design and prototyping",active:!1},{id:"5",name:"QA Lead",description:"Quality assurance and testing strategy",active:!1},{id:"6",name:"DevOps",description:"Infrastructure and deployment automation",active:!1}],O="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",G="w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] transition-all duration-150",L="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",K="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",wt="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50",X="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",$="text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-1 flex items-center gap-1.5",Ct=[{id:"general",label:"General",icon:bt},{id:"members",label:"Members",icon:Q,count:0},{id:"invites",label:"Invites",icon:me},{id:"teams",label:"Teams",icon:pt},{id:"roles",label:"Roles",icon:te},{id:"categories",label:"Categories",icon:$e},{id:"providers",label:"AI Providers",icon:Le},{id:"activity",label:"Activity",icon:_e}],aa=()=>{const{projects:s,refreshProjects:l,currentProjectId:N}=Fe(),[m,p]=r.useState(null),d=Oe(),b=Ke(),u=Ue(),v=ze(),[n,y]=r.useState(!1),[c,C]=r.useState(""),[i,x]=r.useState(""),T=s.find(h=>h.id===m)||null,[A,a]=r.useState(!1),[S,I]=r.useState(""),[k,U]=r.useState(""),[V,q]=r.useState([]),[j,f]=r.useState(""),[t,g]=r.useState(!1),P=h=>{d.mutate(h,{onSuccess:()=>{o.success("Project activated"),l()},onError:()=>o.error("Failed to activate project")})},R=h=>{b.mutate(h,{onSuccess:()=>{o.success("Default project set"),l()},onError:()=>o.error("Failed to set default")})},w=()=>{u.mutate(void 0,{onSuccess:h=>{const E=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),Y=URL.createObjectURL(E),ee=document.createElement("a");ee.href=Y,ee.download=`project-export-${Date.now()}.json`,ee.click(),URL.revokeObjectURL(Y),o.success("Project exported")},onError:()=>o.error("Export failed")})},J=()=>{try{const h=JSON.parse(c);v.mutate({data:h,name:i||void 0},{onSuccess:()=>{o.success("Project imported"),y(!1),C(""),x(""),l()},onError:()=>o.error("Import failed")})}catch{o.error("Invalid JSON data")}};r.useEffect(()=>{(async()=>{try{const E=await D.get("/api/companies");E.companies&&(q(E.companies),E.companies.length>0&&f(E.companies[0].id))}catch(E){console.error("Failed to fetch companies:",E)}})()},[]);const M=async()=>{if(!S.trim()||!j){o.error("Please enter a project name and select a company.");return}try{g(!0),await D.post("/api/projects",{name:S,description:k,company_id:j}),U(""),a(!1),l(),o.success("Project created successfully")}catch(h){console.error("Failed to create project:",h),o.error(h instanceof Error?h.message:"Failed to create project")}finally{g(!1)}};return m&&T?e.jsx(kt,{project:T,onBack:()=>p(null),onUpdate:l}):(m&&!T&&p(null),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("h1",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:"Projects"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:w,disabled:u.isPending,className:K,children:[u.isPending?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(qe,{className:"w-3.5 h-3.5"})," Export"]}),e.jsxs("button",{onClick:()=>y(!n),className:K,children:[e.jsx(we,{className:"w-3.5 h-3.5"})," Import"]}),e.jsxs("button",{onClick:()=>a(!A),className:L,children:[e.jsx(ne,{className:"w-3.5 h-3.5"})," New Project"]})]})]}),e.jsx(le,{children:n&&e.jsxs(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:_(O,"p-5"),children:[e.jsx("h3",{className:X,children:"Import Project"}),e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Project Name (optional)"}),e.jsx("input",{value:i,onChange:h=>x(h.target.value),placeholder:"Project name...",className:G})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"JSON Data"}),e.jsx("textarea",{value:c,onChange:h=>C(h.target.value),placeholder:"Paste exported JSON data here...",rows:5,className:_(G,"resize-none font-mono")})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>y(!1),className:K,children:"Cancel"}),e.jsxs("button",{onClick:J,disabled:v.isPending||!c.trim(),className:L,children:[v.isPending?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(we,{className:"w-3.5 h-3.5"})," Import"]})]})]})]})}),e.jsx(le,{children:A&&e.jsxs(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:_(O,"p-5"),children:[e.jsx("h3",{className:X,children:"Create New Project"}),e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Project Name *"}),e.jsx("input",{value:S,onChange:h=>I(h.target.value),placeholder:"Project name...",className:G})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Description"}),e.jsx("textarea",{value:k,onChange:h=>U(h.target.value),placeholder:"Description...",rows:2,className:_(G,"resize-none")})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Company"}),e.jsxs("select",{value:j,onChange:h=>f(h.target.value),className:G,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a company"}),V.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-2",children:[e.jsx("button",{onClick:()=>a(!1),className:K,children:"Cancel"}),e.jsxs("button",{onClick:M,disabled:t,className:L,children:[t?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ne,{className:"w-3.5 h-3.5"}),t?"Creating...":"Create"]})]})]})]})}),e.jsx("div",{className:"space-y-3",children:s.map((h,E)=>{const Y=N===h.id,ee=h.is_default===!0;return e.jsx(B.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{delay:E*.06},className:_(O,"p-5",Y&&"border-[var(--gm-accent-primary)]/40 ring-1 ring-[var(--gm-accent-primary)]/20"),children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:_("w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",Y?"bg-[var(--gm-interactive-primary)]/10":"bg-[var(--gm-bg-tertiary)]"),children:e.jsx(ce,{className:_("w-5 h-5",Y?"text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)]")})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:h.name||"(unnamed project)"}),Y&&e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)]",children:"Active"}),ee&&e.jsxs("span",{className:"text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-500 flex items-center gap-0.5",children:[e.jsx(Ce,{className:"w-2.5 h-2.5"})," Default"]})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono",children:h.id}),h.description&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate max-w-md",children:h.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[!Y&&e.jsxs("button",{onClick:()=>P(h.id),disabled:d.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-lg bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)] text-[10px] font-medium hover:bg-[var(--gm-interactive-primary)]/20 transition-colors",children:[e.jsx(xt,{className:"w-3 h-3"})," Switch"]}),!ee&&e.jsx("button",{onClick:()=>R(h.id),disabled:b.isPending,className:K,title:"Set as default project",children:e.jsx(Ce,{className:"w-3 h-3"})}),e.jsxs("button",{onClick:()=>p(h.id),className:K,children:[e.jsx(je,{className:"w-3 h-3"})," Edit"]})]})]})},h.id)})})]}))};function kt({project:s,onBack:l,onUpdate:N}){const[m,p]=r.useState("general"),[d,b]=r.useState([]),[u,v]=r.useState(!1),n=async()=>{try{v(!0);const c=await D.get(`/api/projects/${s.id}/members`);c.members&&b(c.members)}catch(c){console.error("Failed to fetch members:",c)}finally{v(!1)}},y=()=>{N(),m==="members"&&n()};return r.useEffect(()=>{n()},[s.id]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:l,className:"flex items-center gap-1.5 text-xs text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors mb-2",children:[e.jsx(gt,{className:"w-3.5 h-3.5"})," Back to Projects"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[var(--gm-interactive-primary)]/10 flex items-center justify-center",children:e.jsx(ce,{className:"w-6 h-6 text-[var(--gm-accent-primary)]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:s.name||"(unnamed project)"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:s.description||"No description"})]})]}),e.jsx("div",{className:"flex border-b border-[var(--gm-border-primary)] overflow-x-auto",children:Ct.map(c=>e.jsxs("button",{onClick:()=>p(c.id),className:`flex items-center gap-1.5 px-3 py-2.5 text-xs font-medium transition-colors border-b-2 whitespace-nowrap ${m===c.id?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent hover:text-[var(--gm-text-primary)]"}`,children:[e.jsx(c.icon,{className:"w-4 h-4"}),c.label,(c.id==="members"?d.length:c.count)!==void 0&&e.jsx("span",{className:"text-[10px] bg-[var(--gm-bg-tertiary)] px-1.5 py-0.5 rounded-full",children:c.id==="members"?d.length:c.count})]},c.id))}),e.jsxs("div",{children:[m==="general"&&e.jsx(_t,{project:s,onUpdate:N,onBack:l}),m==="members"&&e.jsx(Pt,{project:s,members:d,loading:u,onUpdate:n}),m==="roles"&&e.jsx(Dt,{project:s,onUpdate:y}),m==="categories"&&e.jsx(It,{project:s,members:d,onUpdate:N}),m==="invites"&&e.jsx(Rt,{projectId:s.id}),m==="teams"&&e.jsx(Et,{}),m==="providers"&&e.jsx(Lt,{projectId:s.id}),m==="activity"&&e.jsx($t,{projectId:s.id})]})]})}function St({projectId:s}){const{data:l,isLoading:N}=mt(s);if(N||!l)return null;const p=Object.entries(l).filter(([,d])=>typeof d=="number").slice(0,8);return p.length===0?null:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4",children:p.map(([d,b])=>e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg px-3 py-2 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:String(b)}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:d.replace(/[_-]/g," ")})]},d))})}function _t({project:s,onUpdate:l,onBack:N}){const[m,p]=r.useState(s.name),[d,b]=r.useState(s.description),[u,v]=r.useState(s.role||""),[n,y]=r.useState(s.rolePrompt||""),[c,C]=r.useState(s.company_id||s.company?.id||""),[i,x]=r.useState(!1),[T,A]=r.useState(!1),[a,S]=r.useState(!1),[I,k]=r.useState([]),[U,V]=r.useState([]);r.useEffect(()=>{D.get("/api/role-templates").then(f=>k(f.roles||[])).catch(()=>{}),D.get("/api/companies").then(f=>{f.companies&&V(f.companies)}).catch(()=>{})},[]);const q=async()=>{if(!m.trim()){o.error("Project name is required");return}x(!0);try{await D.put(`/api/projects/${s.id}`,{name:m,description:d,role:u,rolePrompt:n,company_id:c}),o.success("Project updated"),l()}catch(f){o.error(f.message||"Failed to update project")}finally{x(!1)}},j=async()=>{A(!0);try{await D.delete(`/api/projects/${s.id}`),o.success("Project deleted"),l(),N()}catch(f){o.error(f.message||"Failed to delete project")}finally{A(!1),S(!1)}};return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx(St,{projectId:s.id}),e.jsxs("div",{className:_(O,"p-5 space-y-5"),children:[e.jsxs("div",{children:[e.jsxs("label",{className:$,children:[e.jsx(ce,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})," Project Name *"]}),e.jsx(z,{value:m,onChange:f=>p(f.target.value),className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"â‰¡ Description"}),e.jsx("textarea",{value:d,onChange:f=>b(f.target.value),placeholder:"Brief description of the project",rows:4,className:_(G,"resize-y")})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:$,children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})," Your Role"]}),e.jsxs(ae,{value:u,onValueChange:v,children:[e.jsx(se,{className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm",children:e.jsx(re,{placeholder:"Select role..."})}),e.jsx(ie,{children:I.filter(f=>f.name||f.display_name).map(f=>e.jsx(W,{value:f.display_name||f.name,children:f.display_name||f.name},f.id||f.name))})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Your role in this project (used for AI context)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"ðŸ’¬ Role Prompt"}),e.jsx(z,{value:n,onChange:f=>y(f.target.value),className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Brief description of your responsibilities"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:$,children:[e.jsx(ce,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})," Company"]}),e.jsxs(ae,{value:c,onValueChange:C,children:[e.jsx(se,{className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm",children:e.jsx(re,{placeholder:"Select company..."})}),e.jsx(ie,{children:U.map(f=>e.jsx(W,{value:f.id,children:f.name},f.id))})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Templates and branding from this company will be used in reports"})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{onClick:q,disabled:i,className:L,children:[i?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(oe,{className:"w-4 h-4"}),i?"Saving...":"Save Changes"]})})]}),e.jsxs("div",{className:"border border-[var(--color-danger-500)]/30 bg-[var(--color-danger-500)]/5 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--color-danger-500)] mb-1 flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"})," Danger Zone"]}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-3",children:"Deleting a project will permanently remove all associated data including questions, decisions, risks, and contacts."}),a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:j,disabled:T,className:wt,children:[T?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(Z,{className:"w-4 h-4"}),T?"Deleting...":"Confirm Delete"]}),e.jsx("button",{onClick:()=>S(!1),className:K,children:"Cancel"})]}):e.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-[var(--color-danger-500)]/30 text-[var(--color-danger-500)] text-sm font-medium hover:bg-[var(--color-danger-500)]/10 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"})," Delete Project"]})]})]})}function Pt({project:s,members:l,loading:N,onUpdate:m}){const[p,d]=r.useState(!1),[b,u]=r.useState(null),[v,n]=r.useState(null),[y,c]=r.useState("list"),[C,i]=r.useState([]),[x,T]=r.useState(!1);r.useEffect(()=>{A()},[s.id]);const A=async()=>{try{T(!0);const t=await D.get(`/api/projects/${s.id}/categories`);i(t)}catch(t){console.error("Failed to fetch categories:",t)}finally{T(!1)}},a=async()=>{if(v)try{u(v.user_id),await D.delete(`/api/projects/${s.id}/members/${v.user_id}`),m()}catch(t){console.error("Failed to remove member:",t),o.error("Failed to remove member")}finally{u(null),n(null)}},S=async(t,g)=>{try{await D.put(`/api/projects/${s.id}/members/${t}`,{user_role:g}),m()}catch(P){console.error("Failed to update member role:",P)}},I=t=>l.filter(g=>{const P=g.user_role||g.role;return s.settings?.roles?.find(J=>J.name===P)?.category===t.id}),k=(t,g)=>{t.dataTransfer.setData("text/plain",g),t.dataTransfer.effectAllowed="move"},U=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},V=async(t,g)=>{t.preventDefault();const P=t.dataTransfer.getData("text/plain");if(!P)return;const R=l.find(M=>M.user_id===P);if(!R)return;let w="";if(g){const M=s.settings?.roles?.filter(h=>h.category===g)||[];M.length>0?w=M[0].name:w=(M.find(E=>E.name==="Member")||M[0])?.name||"Member"}else w="";const J=R.user_role||R.role;w!==J&&await S(P,w)},q=()=>l.filter(t=>{const g=t.user_role||t.role,P=s.settings?.roles?.find(w=>w.name===g),R=!P||!P.category||!C.find(w=>w.id===P.category);return R&&t.display_name==="RPAD"&&console.log("Unassigned Debug (RPAD):",{memberRole:g,roleFound:!!P,roleCategory:P?.category,catExists:!!C.find(w=>w.id===P?.category)}),R}),j=async(t,g)=>{try{const P={...s.settings,category_leads:{...s.settings?.category_leads,[t]:g}};await D.put(`/api/projects/${s.id}`,{settings:P}),m()}catch(P){console.error("Failed to set lead:",P),o.error("Failed to set team lead")}},f=l.map(t=>t.linked_contact?.id).filter(t=>!!t);return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:_(O,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"})," TEAM MEMBERS (",l.length,")"]}),e.jsxs("div",{className:"flex bg-[var(--gm-bg-tertiary)] rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>c("list"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${y==="list"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"}`,children:"List"}),e.jsx("button",{onClick:()=>c("teams"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${y==="teams"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"}`,children:"Teams"})]})]}),e.jsxs("button",{onClick:()=>d(!0),className:L,children:[e.jsx(Q,{className:"w-4 h-4"})," Invite"]})]}),N||x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--gm-accent-primary)] border-t-transparent rounded-full animate-spin"})}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center mb-3",children:e.jsx(Q,{className:"w-8 h-8 text-[var(--gm-text-tertiary)]"})}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] mb-4",children:"No team members yet"}),e.jsx("button",{onClick:()=>d(!0),className:L,children:"Invite Member"})]}):y==="list"?e.jsx("div",{className:"grid gap-3",children:l.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)]/20 hover:bg-[var(--gm-bg-tertiary)]/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[H(t.avatar_url)||H(t.linked_contact?.avatar_url)?e.jsx("img",{src:H(t.avatar_url)?t.avatar_url:t.linked_contact?.avatar_url,alt:t.display_name||t.linked_contact?.name||"Member",className:"w-10 h-10 rounded-full object-cover bg-[var(--gm-bg-tertiary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-interactive-primary)]/10 flex items-center justify-center text-[var(--gm-accent-primary)] font-bold",children:de(t.display_name||t.username||t.linked_contact?.name)}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:t.display_name||t.linked_contact?.name||t.username||"Unknown User"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[var(--gm-text-tertiary)]",children:[e.jsx("span",{children:t.user_role||t.role}),t.linked_contact?.organization&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:t.linked_contact.organization})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-right text-[var(--gm-text-tertiary)]",children:e.jsxs("p",{children:["Joined ",t.joined_at?new Date(t.joined_at).toLocaleDateString():"â€”"]})}),e.jsx("button",{onClick:()=>n(t),disabled:b===t.user_id,className:"p-2 text-[var(--gm-text-tertiary)] hover:text-[var(--color-danger-500)] transition-colors disabled:opacity-50",children:b===t.user_id?e.jsx("div",{className:"w-4 h-4 border-2 border-[var(--color-danger-500)] border-t-transparent rounded-full animate-spin"}):e.jsx(Z,{className:"w-4 h-4"})})]})]},t.user_id))}):e.jsxs("div",{className:"space-y-4",children:[C.map(t=>{const g=I(t),P=s.settings?.category_leads?.[t.id],R=l.find(w=>w.user_id===P);return e.jsxs(B.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},className:_(O,"p-5"),onDragOver:U,onDrop:w=>V(w,t.id),children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${t.color||"blue"}-500/10 text-${t.color||"blue"}-500`,children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[t.display_name,e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:g.length})]}),R&&e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)] flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3 text-amber-500"}),"Lead: ",e.jsx("span",{className:"font-medium text-[var(--gm-text-primary)]",children:R.display_name})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[g.map(w=>{const J=P===w.user_id;return e.jsxs("div",{className:`flex items-center gap-4 p-3 rounded-xl border transition-all cursor-grab active:cursor-grabbing group relative ${J?"bg-amber-500/5 border-amber-500/20":"bg-[var(--gm-bg-primary)] border-[var(--gm-border-primary)] hover:border-[var(--gm-accent-primary)]/30"}`,draggable:!0,onDragStart:M=>k(M,w.user_id),children:[e.jsxs("div",{className:"relative",children:[H(w.avatar_url)||H(w.linked_contact?.avatar_url)?e.jsx("img",{src:H(w.avatar_url)?w.avatar_url:w.linked_contact?.avatar_url,alt:w.display_name,className:"w-10 h-10 rounded-full object-cover border border-[var(--gm-border-primary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center text-sm font-bold text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:de(w.display_name)}),J&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-amber-500 text-white rounded-full p-0.5 border-2 border-[var(--gm-bg-primary)]",children:e.jsx(te,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate",children:w.display_name}),w.linked_contact?.organization&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] truncate max-w-[100px]",children:w.linked_contact.organization})]}),e.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:e.jsxs(ae,{value:w.user_role||w.role||"",onValueChange:M=>S(w.user_id,M==="no-role"?"":M),children:[e.jsx(se,{className:"h-5 text-[11px] bg-transparent border-none p-0 text-[var(--gm-text-tertiary)] focus:ring-0 shadow-none w-auto gap-1 hover:text-[var(--gm-text-primary)]",children:e.jsx(re,{placeholder:"No Role"})}),e.jsxs(ie,{children:[e.jsx(W,{value:"no-role",children:"No Role"}),C.map(M=>{const h=s.settings?.roles?.filter(E=>E.category===M.id)||[];return h.length===0?null:e.jsxs(be,{children:[e.jsx(fe,{className:"text-[10px] font-bold text-[var(--gm-text-tertiary)] px-2 py-1.5",children:M.display_name}),h.map(E=>e.jsx(W,{value:E.name,className:"text-[10px]",children:E.name},E.id))]},M.id)})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:M=>{M.preventDefault(),M.stopPropagation(),j(t.id,w.user_id)},className:`p-2 rounded-lg transition-colors ${J?"text-amber-500 bg-amber-500/10 hover:bg-amber-500/20":"text-[var(--gm-text-tertiary)] hover:text-amber-500 hover:bg-amber-500/10"}`,title:J?"Current Team Lead":"Make Team Lead",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-4 bg-[var(--gm-border-primary)] mx-1"}),e.jsx("div",{className:"p-2 text-[var(--gm-text-tertiary)] cursor-grab active:cursor-grabbing",children:e.jsx(ke,{className:"w-4 h-4"})})]})]},w.user_id)}),g.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center border border-dashed border-[var(--gm-border-primary)]/50 rounded-xl bg-[var(--gm-bg-tertiary)]/5",children:[e.jsx(Q,{className:"w-8 h-8 text-[var(--gm-text-tertiary)]/30 mb-2"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["Drag members here to assign them to ",t.display_name]})]})]})]},t.id)}),q().length>0&&e.jsxs(B.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] border-dashed rounded-xl p-5",onDragOver:U,onDrop:t=>V(t,null),children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500 animate-pulse"}),"Unassigned Members",e.jsx("span",{className:"text-[10px] bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] px-2 py-0.5 rounded-full",children:q().length})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:q().map(t=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-bg-tertiary)]/10 border border-[var(--gm-border-primary)]/50 hover:border-amber-500/50 rounded-xl p-3 cursor-grab active:cursor-grabbing group relative transition-colors",draggable:!0,onDragStart:g=>k(g,t.user_id),children:[e.jsxs("div",{className:"relative",children:[H(t.avatar_url)||H(t.linked_contact?.avatar_url)?e.jsx("img",{src:H(t.avatar_url)?t.avatar_url:t.linked_contact?.avatar_url,alt:t.display_name,className:"w-10 h-10 rounded-full object-cover border border-[var(--gm-border-primary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center text-sm font-bold text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:(t.display_name?.[0]||"?").toUpperCase()}),e.jsx("div",{className:"absolute -top-1 -right-1 bg-amber-500 text-white rounded-full p-0.5 w-4 h-4 flex items-center justify-center text-[10px]",children:"!"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate",children:t.display_name})}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsxs(ae,{value:t.user_role||t.role||"",onValueChange:g=>S(t.user_id,g),children:[e.jsx(se,{className:"h-6 text-[11px] bg-[var(--gm-bg-primary)] border-[var(--gm-border-primary)] w-full",children:e.jsx(re,{placeholder:"Select Role..."})}),e.jsxs(ie,{children:[e.jsx(W,{value:"no-role",children:"No Role"}),C.map(g=>{const P=s.settings?.roles?.filter(R=>R.category===g.id)||[];return P.length===0?null:e.jsxs(be,{children:[e.jsx(fe,{className:"text-[10px] font-bold text-[var(--gm-text-tertiary)] px-2 py-1.5",children:g.display_name}),P.map(R=>e.jsx(W,{value:R.name,className:"text-[10px]",children:R.name},R.id))]},g.id)})]})]})})]}),e.jsx("div",{className:"text-[var(--gm-text-tertiary)] opacity-50 group-hover:opacity-100",children:e.jsx(ke,{className:"w-4 h-4"})})]},t.user_id))})]})]})]}),e.jsx(At,{open:p,onClose:()=>d(!1),projectId:s.id,onMemberAdded:m,existingContactIds:f}),e.jsx(Pe,{open:!!v,onOpenChange:t=>!t&&n(null),children:e.jsxs(Ae,{children:[e.jsxs(De,{children:[e.jsx(Te,{children:"Remove Team Member"}),e.jsxs(Ie,{children:["Are you sure you want to remove ",e.jsx("strong",{children:v?.display_name||v?.linked_contact?.name||"this member"})," from the project? This action cannot be undone."]})]}),e.jsxs(Me,{children:[e.jsx(Re,{children:"Cancel"}),e.jsx(Ee,{onClick:a,className:"bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)]",children:"Remove Member"})]})]})})]})}function At({open:s,onClose:l,projectId:N,onMemberAdded:m,existingContactIds:p=[]}){const[d,b]=r.useState("contacts"),[u,v]=r.useState(""),[n,y]=r.useState(""),[c,C]=r.useState(null),[i,x]=r.useState([]),[T,A]=r.useState(!1),[a,S]=r.useState(!1),[I,k]=r.useState(!1);r.useEffect(()=>{s&&d==="contacts"&&U()},[s,d]);const U=async()=>{try{A(!0);const j=await D.get("/api/contacts");if(j.contacts){const f=j.contacts.filter(t=>!p.includes(t.id));x(f)}}catch(j){console.error("Failed to fetch contacts:",j)}finally{A(!1)}},V=async()=>{if(!u.trim()){o.error("Please enter an email address");return}k(!0);try{await D.post(`/api/projects/${N}/members/invite`,{email:u.trim(),message:n.trim()||void 0}),o.success("Invitation sent"),v(""),y(""),m(),l()}catch(j){o.error(j.message||"Failed to send invitation")}finally{k(!1)}},q=async()=>{if(c)try{S(!0),await D.post(`/api/projects/${N}/members/add-contact`,{contact_id:c}),m(),l()}catch(j){console.error("Failed to add contact:",j),o.error("Failed to add contact to team")}finally{S(!1)}};return e.jsx(he,{open:s,onOpenChange:l,children:e.jsxs(ve,{className:"sm:max-w-[500px] bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsx(ue,{children:e.jsx(ye,{className:"text-[var(--gm-text-primary)]",children:"Invite Team Member"})}),e.jsxs("div",{className:"flex border-b border-[var(--gm-border-primary)] mb-4",children:[e.jsx("button",{onClick:()=>b("email"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="email"?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent"}`,children:"New Email"}),e.jsx("button",{onClick:()=>b("contacts"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="contacts"?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent"}`,children:"Existing Contacts"})]}),d==="email"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Email Address *"}),e.jsx(z,{value:u,onChange:j=>v(j.target.value),placeholder:"colleague@example.com",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"They will receive an email invitation to join this project"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Access Level"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:"Member - Can view and edit data"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"You can assign a project role after they join."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Personal Message (optional)"}),e.jsx("textarea",{value:n,onChange:j=>y(j.target.value),placeholder:"Add a personal note to the invitation...",rows:3,className:_(G,"resize-none")})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:l,className:K,children:"Cancel"}),e.jsx("button",{onClick:V,disabled:I||!u.trim(),className:L,children:I?"Sending...":"Send Invitation"})]})]}):e.jsxs("div",{className:"space-y-3",children:[T?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--gm-accent-primary)] border-t-transparent rounded-full animate-spin"})}):i.length===0?e.jsx("div",{className:"text-center py-8 text-[var(--gm-text-tertiary)] text-sm",children:"No contacts found."}):e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto scrollbar-thin pr-1",children:i.map(j=>e.jsxs("div",{onClick:()=>C(j.id),className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer border transition-all ${c===j.id?"bg-[var(--gm-interactive-primary)]/10 border-[var(--gm-accent-primary)] shadow-[var(--shadow-sm)]":"bg-[var(--gm-surface-primary)] hover:bg-[var(--gm-surface-hover)] border-[var(--gm-border-primary)] hover:border-[var(--gm-border-primary)]/80"}`,children:[e.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center transition-colors ${c===j.id?"border-[var(--gm-accent-primary)] bg-[var(--gm-interactive-primary)]":"border-[var(--gm-text-tertiary)]"}`,children:c===j.id&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[var(--gm-text-on-brand)]"})}),Ne(j)?e.jsx("img",{src:Ne(j),alt:j.name,className:"w-10 h-10 rounded-full object-cover bg-[var(--gm-bg-tertiary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-interactive-primary)]/10 flex items-center justify-center text-[var(--gm-accent-primary)] font-bold text-sm",children:de(j.name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${c===j.id?"text-[var(--gm-accent-primary)]":"text-[var(--gm-text-primary)]"}`,children:j.name||"(unnamed)"}),e.jsxs("div",{className:"flex flex-col gap-0.5",children:[j.organization&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-medium",children:j.organization}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] truncate",children:j.email||"No email"})]})]}),j.role&&e.jsx("div",{className:"text-[10px] px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]",children:j.role})]},j.id))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Access Level"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:"Member - Can view and edit data"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:q,disabled:!c||a,className:_(L,"disabled:cursor-not-allowed"),children:[a?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(Q,{className:"w-4 h-4"}),"Add to Team"]})}),e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] space-y-0.5",children:e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-[var(--gm-accent-primary)]",children:"Add to Team:"})," Adds contact as team member directly."]})})]})]})})}function Dt({project:s,onUpdate:l}){const[N,m]=r.useState(!1),[p,d]=r.useState(null),[b,u]=r.useState([]);r.useEffect(()=>{v()},[s.id]);const v=async()=>{try{const i=await D.get(`/api/projects/${s.id}/categories`);u(i)}catch(i){console.error("Failed to fetch categories:",i)}},n=s.settings?.roles||[];[...Se].map(i=>(n.find(x=>x.name===i.name),i));const c=[...n];Se.forEach(i=>{c.find(x=>x.name===i.name)||c.push({...i,active:!1,id:`template-${i.id}`})});const C=async i=>{try{if(d(i.id),i.id.toString().startsWith("template-")){const x={name:i.name,description:i.description,active:!0};await D.post(`/api/projects/${s.id}/roles`,x)}else await D.put(`/api/projects/${s.id}/roles/${i.id}`,{active:!i.active});l()}catch(x){console.error("Error toggling role:",x),o.error("Failed to update role")}finally{d(null)}};return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:_(O,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"})," PROJECT ROLES"]}),e.jsxs("button",{onClick:()=>m(!0),className:L,children:[e.jsx(ne,{className:"w-4 h-4"})," Add Role"]})]}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-4",children:"Define roles and responsibilities for this project."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:c.map(i=>e.jsxs("div",{className:`p-4 rounded-xl border transition-colors ${i.active===!0?"border-[var(--gm-accent-primary)]/30 bg-[var(--gm-interactive-primary)]/5":"border-[var(--gm-border-primary)]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0 ${i.active===!0?"bg-[var(--gm-interactive-primary)]/10":"bg-[var(--gm-bg-tertiary)]"}`,children:e.jsx(pe,{className:`w-4 h-4 ${i.active===!0?"text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)]"}`})}),e.jsx("h4",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:i.name||"(unnamed role)"})]}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-3",children:i.description||"â€”"}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.active===!0,onChange:()=>C(i),disabled:!!p,className:"accent-[var(--gm-accent-primary)] w-4 h-4"}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:p===i.id?"Updating...":i.active===!0?"Active":"Inactive"})]}),i.active&&e.jsxs("select",{className:"max-w-[120px] text-[10px] bg-[var(--gm-bg-tertiary)]/50 border-none rounded px-2 py-1 text-[var(--gm-text-primary)] focus:ring-0",value:i.category||"",onChange:async x=>{const T=x.target.value;try{i.id.toString().startsWith("template-")||(await D.put(`/api/projects/${s.id}/roles/${i.id}`,{category:T}),l())}catch(A){console.error("Failed to update role category",A)}},children:[e.jsx("option",{value:"",children:"No Category"}),b.map(x=>e.jsx("option",{value:x.id,children:x.display_name},x.id))]})]})]},i.id))})]}),e.jsx(Tt,{open:N,onClose:()=>m(!1),projectId:s.id,onRoleAdded:l})]})}function Tt({open:s,onClose:l,projectId:N,onRoleAdded:m}){const[p,d]=r.useState(""),[b,u]=r.useState(""),[v,n]=r.useState([]),[y,c]=r.useState(!1),[C,i]=r.useState(""),[x,T]=r.useState(""),[A,a]=r.useState(!1);r.useEffect(()=>{s&&S()},[s]);const S=async()=>{try{c(!0);const k=await D.get(`/api/projects/${N}/categories`);n(k),k.length>0&&!b&&u(k[0].id)}catch(k){console.error("Failed to fetch categories:",k)}finally{c(!1)}},I=async()=>{if(p.trim())try{a(!0),await D.post(`/api/projects/${N}/roles`,{name:p,category:b,description:C,role_context:x,active:!0}),m(),l(),d(""),i(""),T(""),v.length>0&&u(v[0].id)}catch(k){console.error("Error creating role:",k),o.error("Failed to create role")}finally{a(!1)}};return e.jsx(he,{open:s,onOpenChange:l,children:e.jsxs(ve,{className:"sm:max-w-[450px] bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsx(ue,{children:e.jsx(ye,{className:"text-[var(--gm-text-primary)]",children:"Add New Role"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Role Name *"}),e.jsx(z,{value:p,onChange:k=>d(k.target.value),placeholder:"e.g., Senior Developer, Tech Lead",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Category"}),e.jsx("select",{value:b,onChange:k=>u(k.target.value),disabled:y,className:G,children:y?e.jsx("option",{children:"Loading categories..."}):v.map(k=>e.jsx("option",{value:k.id,children:k.display_name},k.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Description"}),e.jsx(z,{value:C,onChange:k=>i(k.target.value),placeholder:"Brief description of this role",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Role Context (for AI)"}),e.jsx("textarea",{value:x,onChange:k=>T(k.target.value),placeholder:"Describe this role's responsibilities, priorities, and how the AI should adapt responses...",rows:4,className:_(G,"resize-y")})]}),e.jsxs("button",{onClick:()=>o.info("AI enhancement will use the project context to suggest role descriptions"),className:"flex items-center gap-2 text-sm text-[var(--gm-accent-primary)] font-medium hover:text-[var(--gm-accent-primary)]/80 transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"})," Enhance with AI"]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:l,className:K,children:"Cancel"}),e.jsx("button",{onClick:I,disabled:A||!p.trim(),className:L,children:A?"Creating...":"Create Role"})]})]})})}function It({project:s,members:l,onUpdate:N}){const[m,p]=r.useState([]),[d,b]=r.useState(!1),[u,v]=r.useState(!1),[n,y]=r.useState(null),[c,C]=r.useState(null),i=async()=>{try{b(!0);const a=await D.get(`/api/projects/${s.id}/categories`);p(a)}catch(a){console.error("Failed to fetch categories:",a)}finally{b(!1)}};r.useEffect(()=>{i()},[s.id]);const x=a=>{C(a)},T=async()=>{if(c)try{await D.delete(`/api/projects/${s.id}/categories/${c.id}`),i()}catch(a){console.error("Failed to delete category:",a),o.error("Failed to delete category")}finally{C(null)}},A=async(a,S)=>{try{const I=s.settings?.category_leads||{},k={...s.settings,category_leads:{...I,[a]:S}};await D.put(`/api/projects/${s.id}`,{settings:k}),N()}catch(I){console.error("Failed to set lead:",I),o.error("Failed to set team lead")}};return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:_(O,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"})," PROJECT CATEGORIES"]}),e.jsxs("button",{onClick:()=>{y(null),v(!0)},className:L,children:[e.jsx(ne,{className:"w-4 h-4"})," Add Category"]})]}),d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--gm-accent-primary)] border-t-transparent rounded-full animate-spin"})}):m.length===0?e.jsx("div",{className:"text-center py-8 text-[var(--gm-text-tertiary)] text-sm",children:"No categories found."}):e.jsx("div",{className:"grid gap-3",children:m.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)]/20 hover:bg-[var(--gm-bg-tertiary)]/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold bg-${a.color||"blue"}-500/10 text-${a.color||"blue"}-500`,children:de(a.display_name)}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:a.display_name}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:a.description||"No description"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] mb-0.5",children:"Team Lead"}),e.jsxs(ae,{value:s.settings?.category_leads?.[a.id]||"",onValueChange:S=>A(a.id,S),children:[e.jsx(se,{className:"h-6 text-[10px] bg-[var(--gm-bg-primary)] border-[var(--gm-border-primary)] w-[140px]",children:e.jsx(re,{placeholder:"No Lead"})}),e.jsxs(ie,{children:[e.jsx(W,{value:"no-lead",children:"No Lead Assigned"}),l.map(S=>e.jsx(W,{value:S.user_id,className:"text-[10px]",children:S.display_name},S.user_id))]})]})]}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full ${a.project_id?"bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]"}`,children:a.project_id?"Project":"Global"}),a.project_id&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{y(a),v(!0)},className:"p-1.5 text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:e.jsx(je,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>x(a),className:"p-1.5 text-[var(--gm-text-tertiary)] hover:text-[var(--color-danger-500)] transition-colors",children:e.jsx(Z,{className:"w-3.5 h-3.5"})})]})]})]},a.id))})]}),e.jsx(Mt,{open:u,onClose:()=>v(!1),projectId:s.id,onSuccess:i,initialData:n}),e.jsx(Pe,{open:!!c,onOpenChange:a=>!a&&C(null),children:e.jsxs(Ae,{children:[e.jsxs(De,{children:[e.jsx(Te,{children:"Delete Category"}),e.jsxs(Ie,{children:["Are you sure you want to delete the category ",e.jsx("strong",{children:c?.display_name}),"? This action cannot be undone."]})]}),e.jsxs(Me,{children:[e.jsx(Re,{children:"Cancel"}),e.jsx(Ee,{onClick:T,className:"bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)]",children:"Delete"})]})]})})]})}function Mt({open:s,onClose:l,projectId:N,onSuccess:m,initialData:p}){const[d,b]=r.useState(""),[u,v]=r.useState(""),[n,y]=r.useState(""),[c,C]=r.useState(!1);r.useEffect(()=>{s&&(p?(b(p.name),v(p.display_name),y(p.description||"")):(b(""),v(""),y("")))},[s,p]);const i=async()=>{if(!(!d.trim()||!u.trim()))try{C(!0);const x={name:d.toLowerCase().replace(/\s+/g,"_"),display_name:u,description:n,color:"blue"};p?await D.put(`/api/projects/${N}/categories/${p.id}`,x):await D.post(`/api/projects/${N}/categories`,x),m(),l()}catch(x){console.error("Failed to save category:",x),o.error("Failed to save category")}finally{C(!1)}};return e.jsx(he,{open:s,onOpenChange:l,children:e.jsxs(ve,{className:"sm:max-w-[450px] bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsx(ue,{children:e.jsx(ye,{className:"text-[var(--gm-text-primary)]",children:p?"Edit Category":"Add New Category"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Display Name *"}),e.jsx(z,{value:u,onChange:x=>{v(x.target.value),!p&&(!d||d===u.toLowerCase().replace(/\s+/g,"_").slice(0,-1))&&b(x.target.value.toLowerCase().replace(/\s+/g,"_"))},placeholder:"e.g. Frontend Team",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Internal Name (Slug) *"}),e.jsx(z,{value:d,onChange:x=>b(x.target.value),placeholder:"e.g. frontend_team",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm font-mono"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Unique identifier used in system."})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Description"}),e.jsx(z,{value:n,onChange:x=>y(x.target.value),placeholder:"Description...",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:l,className:K,children:"Cancel"}),e.jsx("button",{onClick:i,disabled:c,className:L,children:c?"Saving...":p?"Update":"Create"})]})]})]})})}function Rt({projectId:s}){const[l,N]=r.useState(""),[m,p]=r.useState("member"),[d,b]=r.useState(""),{data:u,isLoading:v}=Ve(s),n=Ge(),y=Je(),c=He(),C=Ye(),i=u?.invites??[],x=async()=>{if(!l.trim()){o.error("Email is required");return}try{const a=await n.mutateAsync({projectId:s,email:l.trim(),role:m});a.invite_url?(await navigator.clipboard.writeText(a.invite_url),o.success(`Invite sent! Link copied to clipboard.${a.email_sent?" Email sent.":""}`)):o.success("Invite created"),N("")}catch{o.error("Failed to create invite")}},T=async()=>{try{const a=await y.mutateAsync(s);a.link&&(await navigator.clipboard.writeText(a.link),o.success("Invite link copied to clipboard"))}catch{o.error("Failed to generate link")}},A=async()=>{if(!d.trim()){o.error("Token is required");return}try{await C.mutateAsync(d.trim()),o.success("Invite accepted! You have joined the project."),b("")}catch{o.error("Failed to accept invite â€” token may be invalid or expired")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:_(O,"p-5 space-y-4"),children:[e.jsx("h3",{className:X,children:"Invite Members"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{value:l,onChange:a=>N(a.target.value),placeholder:"Email address...",className:"flex-1",onKeyDown:a=>a.key==="Enter"&&x()}),e.jsxs("select",{value:m,onChange:a=>p(a.target.value),className:G,children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"read",children:"Read Only"})]}),e.jsxs("button",{onClick:x,disabled:n.isPending,className:L,children:[n.isPending?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(We,{className:"w-4 h-4"})," Invite"]})]}),e.jsxs("button",{onClick:T,disabled:y.isPending,className:_(K,"disabled:opacity-50"),children:[y.isPending?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(ht,{className:"w-4 h-4"})," Generate Shareable Link"]})]}),e.jsxs("div",{className:_(O,"p-5 space-y-3"),children:[e.jsx("h3",{className:X,children:"Accept an Invite"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Paste an invite token to join a project you've been invited to."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{value:d,onChange:a=>b(a.target.value),placeholder:"Paste invite token...",className:"flex-1",onKeyDown:a=>a.key==="Enter"&&A()}),e.jsxs("button",{onClick:A,disabled:C.isPending||!d.trim(),className:L,children:[C.isPending?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(vt,{className:"w-4 h-4"})," Accept"]})]})]}),e.jsxs("div",{className:_(O,"p-5"),children:[e.jsx("h3",{className:_(X,"mb-3"),children:"Pending Invites"}),v?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):i.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-6",children:"No pending invites"}):e.jsx("div",{className:"space-y-2",children:i.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--gm-border-primary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:a.email||"Link invite"}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx("span",{className:"capitalize",children:a.role}),a.expires_at&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(Xe,{className:"w-3 h-3"})," Expires ",new Date(a.expires_at).toLocaleDateString()]})]})]})]}),e.jsx("button",{onClick:()=>c.mutate(a.id),disabled:c.isPending,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:text-red-400 hover:bg-red-500/10 transition-colors",children:e.jsx(Z,{className:"w-4 h-4"})})]},a.id))})]})]})}function Et(){const[s,l]=r.useState(!1),[N,m]=r.useState(""),[p,d]=r.useState("#3b82f6"),[b,u]=r.useState(null),[v,n]=r.useState(""),[y,c]=r.useState(null),[C,i]=r.useState(""),{data:x,isLoading:T}=Qe(),A=Ze(),a=et(),S=tt(),I=at(),k=st(),U=x?.teams??[],V=async()=>{if(!N.trim()){o.error("Team name is required");return}try{await A.mutateAsync({name:N.trim(),color:p}),o.success("Team created"),m(""),l(!1)}catch{o.error("Failed to create team")}},q=async t=>{if(!v.trim()){o.error("Team name is required");return}try{await S.mutateAsync({id:t,name:v.trim()}),o.success("Team renamed"),u(null)}catch{o.error("Failed to rename team")}},j=async t=>{if(!C.trim()){o.error("Contact ID is required");return}try{await I.mutateAsync({teamId:t,contactId:C.trim()}),o.success("Member added"),i(""),c(null)}catch{o.error("Failed to add member")}},f=async(t,g)=>{try{await k.mutateAsync({teamId:t,contactId:g}),o.success("Member removed")}catch{o.error("Failed to remove member")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:X,children:["Teams (",U.length,")"]}),e.jsxs("button",{onClick:()=>l(!s),className:L,children:[e.jsx(ne,{className:"w-3.5 h-3.5"})," New Team"]})]}),e.jsx(le,{children:s&&e.jsx(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:_(O,"p-4 space-y-3"),children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{value:N,onChange:t=>m(t.target.value),placeholder:"Team name...",className:"flex-1",onKeyDown:t=>t.key==="Enter"&&V()}),e.jsx("input",{type:"color",value:p,onChange:t=>d(t.target.value),className:"w-10 h-10 rounded-lg border border-[var(--gm-border-primary)] cursor-pointer"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:V,disabled:A.isPending,className:L,children:[A.isPending?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(oe,{className:"w-4 h-4"})," Create"]}),e.jsx("button",{onClick:()=>l(!1),className:K,children:"Cancel"})]})]})})}),T?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):U.length===0?e.jsx("div",{className:"text-center py-8 text-sm text-[var(--gm-text-tertiary)]",children:"No teams yet. Create one to get started."}):e.jsx("div",{className:"space-y-2",children:U.map(t=>e.jsxs(B.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:_(O,"p-4 hover:border-[var(--gm-accent-primary)]/20"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color||"#3b82f6"}}),b===t.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{value:v,onChange:g=>n(g.target.value),className:"h-7 text-sm w-48",onKeyDown:g=>{g.key==="Enter"&&q(t.id),g.key==="Escape"&&u(null)},autoFocus:!0}),e.jsx("button",{onClick:()=>q(t.id),disabled:S.isPending,className:"p-1 rounded text-[var(--gm-accent-primary)] hover:bg-[var(--gm-interactive-primary)]/10 transition-colors",children:S.isPending?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(oe,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>u(null),className:"p-1 rounded text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:e.jsx(xe,{className:"w-3.5 h-3.5"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:t.name}),t.description&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:t.description})]}),e.jsx("button",{onClick:()=>{u(t.id),n(t.name)},className:"p-1 rounded text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)] transition-colors",title:"Rename team",children:e.jsx(je,{className:"w-3 h-3"})})]}),e.jsxs(rt,{variant:"secondary",className:"text-[10px]",children:[t.memberCount??0," members"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>c(y===t.id?null:t.id),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:text-[var(--gm-accent-primary)] hover:bg-[var(--gm-interactive-primary)]/10 transition-colors",title:"Add member",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>a.mutate(t.id),disabled:a.isPending,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:text-red-400 hover:bg-red-500/10 transition-colors",children:e.jsx(Z,{className:"w-4 h-4"})})]})]}),e.jsx(le,{children:y===t.id&&e.jsx(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-[var(--gm-border-primary)]",children:[e.jsx(z,{value:C,onChange:g=>i(g.target.value),placeholder:"Contact ID...",className:"flex-1 h-8 text-sm",onKeyDown:g=>g.key==="Enter"&&j(t.id)}),e.jsxs("button",{onClick:()=>j(t.id),disabled:I.isPending||!C.trim(),className:L,children:[I.isPending?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(me,{className:"w-3.5 h-3.5"})," Add"]}),e.jsx("button",{onClick:()=>c(null),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]",children:e.jsx(xe,{className:"w-3.5 h-3.5"})})]})})}),t.memberDetails&&t.memberDetails.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1.5",children:t.memberDetails.map((g,P)=>e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[10px] text-[var(--gm-text-primary)] group/member",children:[e.jsx(pe,{className:"w-3 h-3"})," ",g.name||g.contactId,g.isLead&&e.jsx("span",{className:"text-amber-400",children:"â˜…"}),g.role&&e.jsxs("span",{className:"text-[var(--gm-text-tertiary)]",children:["(",g.role,")"]}),e.jsx("button",{onClick:()=>f(t.id,g.contactId),disabled:k.isPending,className:"ml-0.5 p-0.5 rounded-full text-[var(--gm-text-tertiary)] hover:text-red-400 hover:bg-red-500/10 opacity-0 group-hover/member:opacity-100 transition-all",title:"Remove member",children:e.jsx(xe,{className:"w-2.5 h-2.5"})})]},P))})]},t.id))})]})}function Lt({projectId:s}){const{data:l,isLoading:N,refetch:m}=it(s),p=nt(),d=lt(),b=ct(),[u,v]=r.useState(null),[n,y]=r.useState(""),c=l?.providers??[],C=a=>{n.trim()&&p.mutate({projectId:s,provider:a,apiKey:n.trim()},{onSuccess:()=>{o.success(`${a} key saved`),v(null),y(""),m()},onError:()=>o.error("Failed to save key")})},i=a=>{d.mutate({projectId:s,provider:a},{onSuccess:()=>{o.success(`${a} key removed`),m()},onError:()=>o.error("Failed to remove key")})},x=a=>{b.mutate({projectId:s,provider:a},{onSuccess:()=>o.success(`${a} key is valid`),onError:()=>o.error(`${a} key validation failed`)})},A=["openai","anthropic","google","groq","deepseek","ollama"].map(a=>{const S=c.find(I=>I.provider===a||I.name===a);return{name:a,hasKey:!!S?.has_key,...S||{}}});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:X,children:"AI Provider Keys (BYOK)"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Bring your own API keys for each provider"})]}),N?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):e.jsx("div",{className:"space-y-2",children:A.map(a=>e.jsxs("div",{className:_(O,"p-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:_("w-8 h-8 rounded-lg flex items-center justify-center",a.hasKey?"bg-green-500/10":"bg-[var(--gm-bg-tertiary)]"),children:e.jsx(Le,{className:_("w-4 h-4",a.hasKey?"text-green-500":"text-[var(--gm-text-tertiary)]")})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)] capitalize",children:a.name}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:a.hasKey?"Key configured":"No key set â€” uses system default"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[a.hasKey&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>x(a.name),disabled:b.isPending,className:K,children:[e.jsx(ut,{className:"w-3 h-3"})," Test"]}),e.jsxs("button",{onClick:()=>i(a.name),disabled:d.isPending,className:"inline-flex items-center gap-1 px-2 py-1 rounded-md text-[10px] text-[var(--gm-text-tertiary)] hover:text-[var(--color-danger-500)] transition-colors",children:[e.jsx(Z,{className:"w-3 h-3"})," Remove"]})]}),e.jsx("button",{onClick:()=>{v(u===a.name?null:a.name),y("")},className:K,children:u===a.name?"Cancel":a.hasKey?"Update":"Set Key"})]})]}),u===a.name&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{value:n,onChange:S=>y(S.target.value),type:"password",placeholder:`Enter ${a.name} API key...`,className:G}),e.jsxs("button",{onClick:()=>C(a.name),disabled:p.isPending||!n.trim(),className:L,children:[p.isPending?e.jsx(F,{className:"w-3 h-3 animate-spin"}):e.jsx(oe,{className:"w-3 h-3"})," Save"]})]})]},a.name))})]})}function $t({projectId:s}){const[l,N]=r.useState("activity"),{data:m,isLoading:p}=ot(s,{limit:50}),{data:d,isLoading:b}=dt(s,{limit:50}),u=m?.activities??[],v=d?.entries??[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:X,children:l==="activity"?`Recent Activity (${m?.total??0})`:`Audit Log (${d?.total??0})`}),e.jsxs("div",{className:"flex bg-[var(--gm-bg-tertiary)] rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>N("activity"),className:_("px-3 py-1.5 rounded-md text-xs font-medium transition-colors",l==="activity"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"),children:"Activity"}),e.jsx("button",{onClick:()=>N("audit"),className:_("px-3 py-1.5 rounded-md text-xs font-medium transition-colors",l==="audit"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"),children:"Audit Log"})]})]}),l==="activity"?e.jsx(e.Fragment,{children:p?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):u.length===0?e.jsx("div",{className:"text-center py-8 text-xs text-[var(--gm-text-tertiary)]",children:"No activity recorded yet."}):e.jsx("div",{className:"space-y-1",children:u.map((n,y)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx(_e,{className:"w-3.5 h-3.5 text-[var(--gm-accent-primary)] flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"text-xs text-[var(--gm-text-primary)]",children:[n.actor_name&&e.jsxs("span",{className:"font-medium",children:[n.actor_name," "]}),n.action?.replace(/[._]/g," "),n.target_type&&e.jsxs("span",{className:"text-[var(--gm-text-tertiary)]",children:[" on ",n.target_type]})]})}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] flex-shrink-0",children:new Date(n.created_at).toLocaleString()})]},n.id||y))})}):e.jsx(e.Fragment,{children:b?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):v.length===0?e.jsx("div",{className:"text-center py-8 text-xs text-[var(--gm-text-tertiary)]",children:"No audit entries yet."}):e.jsx("div",{className:"space-y-1",children:v.map((n,y)=>e.jsxs("div",{className:_(O,"flex items-center gap-3 p-3"),children:[e.jsx(te,{className:"w-3.5 h-3.5 text-amber-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs text-[var(--gm-text-primary)]",children:[n.actor_name&&e.jsxs("span",{className:"font-medium",children:[n.actor_name," "]}),e.jsx("span",{children:(n.action||"").replace(/[._]/g," ")}),n.target_type&&e.jsxs("span",{className:"text-[var(--gm-text-tertiary)]",children:[" on ",n.target_type]})]}),n.details&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate max-w-md",children:typeof n.details=="string"?n.details:JSON.stringify(n.details)})]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] flex-shrink-0",children:n.created_at?new Date(n.created_at).toLocaleString():"â€”"})]},n.id||y))})})]})}export{aa as default};
//# sourceMappingURL=ProjectsPage-Bj_NCaBy.js.map
