import{c as T,r as l,b7 as te,j as e,a as m,b8 as re,Y as se,a5 as ae,a4 as F,L as ne,a0 as oe,K as le,a1 as ie,a3 as _,U as ce,b9 as de,C as z,av as me}from"./main-BKbBKYvC.js";import{E as xe}from"./ErrorState-BgEaU0QT.js";import{S as y}from"./skeleton-WOBeWWkL.js";import{L as pe}from"./layout-grid-BBa61xmh.js";import{F as ge}from"./funnel-IG8tO05b.js";import{L as be}from"./lightbulb-CVgMn_Uk.js";import{G as ue}from"./git-commit-horizontal-Bul5w5sk.js";import{S as ye}from"./square-check-big-B5vwT1uX.js";const he=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],fe=T("arrow-up",he);const je=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],ve=T("layout-list",je);const we=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M21 9H3",key:"1338ky"}],["path",{d:"M21 15H3",key:"9uk58r"}]],Ne=T("rows-3",we),Y=[{key:"question",icon:ne,color:"text-blue-500",bg:"bg-blue-500/10",border:"border-blue-500/30",label:"Questions"},{key:"fact",icon:be,color:"text-amber-500",bg:"bg-amber-500/10",border:"border-amber-500/30",label:"Facts"},{key:"decision",icon:ue,color:"text-purple-500",bg:"bg-purple-500/10",border:"border-purple-500/30",label:"Decisions"},{key:"risk",icon:oe,color:"text-red-500",bg:"bg-red-500/10",border:"border-red-500/30",label:"Risks"},{key:"action",icon:ye,color:"text-green-500",bg:"bg-green-500/10",border:"border-green-500/30",label:"Actions"},{key:"document",icon:le,color:"text-cyan-500",bg:"bg-cyan-500/10",border:"border-cyan-500/30",label:"Documents"},{key:"email",icon:ie,color:"text-orange-500",bg:"bg-orange-500/10",border:"border-orange-500/30",label:"Emails"},{key:"conversation",icon:_,color:"text-teal-500",bg:"bg-teal-500/10",border:"border-teal-500/30",label:"Conversations"},{key:"contact",icon:ce,color:"text-pink-500",bg:"bg-pink-500/10",border:"border-pink-500/30",label:"Contacts"},{key:"transcript",icon:de,color:"text-indigo-500",bg:"bg-indigo-500/10",border:"border-indigo-500/30",label:"Transcripts"},{key:"chat_session",icon:_,color:"text-violet-500",bg:"bg-violet-500/10",border:"border-violet-500/30",label:"Chat"},{key:"deadline",icon:z,color:"text-rose-500",bg:"bg-rose-500/10",border:"border-rose-500/30",label:"Deadlines"}],ke=Object.fromEntries(Y.map(s=>[s.key,s]));function Se(s){const c=new Date(s),i=new Date,d=new Date(i.getFullYear(),i.getMonth(),i.getDate()),p=new Date(c.getFullYear(),c.getMonth(),c.getDate()),f=Math.floor((d.getTime()-p.getTime())/864e5);return f===0?"Today":f===1?"Yesterday":f<7?c.toLocaleDateString("en-US",{weekday:"long"}):c.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:c.getFullYear()!==i.getFullYear()?"numeric":void 0})}function Ce(s){const c=Date.now()-new Date(s).getTime(),i=Math.floor(c/6e4);if(i<1)return"just now";if(i<60)return`${i}m ago`;const d=Math.floor(i/60);if(d<24)return`${d}h ago`;const p=Math.floor(d/24);return p<7?`${p}d ago`:new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function De(s){return s?s.split(/[\s@]+/).filter(Boolean).slice(0,2).map(c=>c[0].toUpperCase()).join(""):"?"}function Ee(s){if(!s)return null;const c=String(s).toLowerCase(),d={pending:{label:"Pending",cls:"bg-yellow-500/10 text-yellow-500 border-yellow-500/20"},in_progress:{label:"In Progress",cls:"bg-blue-500/10 text-blue-500 border-blue-500/20"},active:{label:"Active",cls:"bg-blue-500/10 text-blue-500 border-blue-500/20"},completed:{label:"Completed",cls:"bg-green-500/10 text-green-500 border-green-500/20"},approved:{label:"Approved",cls:"bg-green-500/10 text-green-500 border-green-500/20"},rejected:{label:"Rejected",cls:"bg-red-500/10 text-red-500 border-red-500/20"},overdue:{label:"Overdue",cls:"bg-red-500/10 text-red-500 border-red-500/20"},mitigated:{label:"Mitigated",cls:"bg-emerald-500/10 text-emerald-500 border-emerald-500/20"}}[c];return d?e.jsx("span",{className:m("text-[9px] font-medium px-1.5 py-0.5 rounded-full border",d.cls),children:d.label}):null}function Te(){return e.jsxs("div",{className:"p-5 space-y-5 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"h-6 w-32 bg-gm-surface-secondary"}),e.jsx(y,{className:"h-8 w-48 rounded-lg bg-gm-surface-secondary"})]}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5,6].map(s=>e.jsx(y,{className:"h-7 w-20 rounded-lg bg-gm-surface-secondary"},s))}),[1,2,3].map(s=>e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{className:"h-4 w-40 bg-gm-surface-secondary"}),[1,2,3].map(c=>e.jsxs("div",{className:"flex items-start gap-3 ml-4 pl-4",children:[e.jsx(y,{className:"h-9 w-9 rounded-lg shrink-0 bg-gm-surface-secondary"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(y,{className:"h-3 w-2/3 bg-gm-surface-secondary"}),e.jsx(y,{className:"h-2.5 w-1/3 bg-gm-surface-secondary"})]})]},c))]},s))]})}function Fe(){const[s,c]=l.useState(new Set),[i,d]=l.useState(""),[p,f]=l.useState(""),[h,M]=l.useState("30"),[b,B]=l.useState("comfortable"),[N,L]=l.useState(!1),[k,q]=l.useState(200),[H,S]=l.useState(-1),P=l.useRef(null),$=l.useRef(null);l.useEffect(()=>{const t=setTimeout(()=>f(i),200);return()=>clearTimeout(t)},[i]);const G=l.useMemo(()=>{if(h==="all")return;const t=new Date;return t.setDate(t.getDate()-Number(h)),t.toISOString().split("T")[0]},[h]),J=s.size>0?Array.from(s).join(","):void 0,{data:I,isLoading:V,isError:K,refetch:Q}=te({types:J,startDate:G,limit:k}),j=I?.events??[],w=I?.totalEvents??0,u=l.useMemo(()=>{if(!p)return j;const t=p.toLowerCase();return j.filter(r=>[r.title,r.content,r.description,r.owner,r.type].filter(Boolean).join(" ").toLowerCase().includes(t))},[j,p]),X=l.useMemo(()=>{const t={};return j.forEach(r=>{const a=r.type||"unknown";t[a]=(t[a]||0)+1}),t},[j]),C=l.useMemo(()=>{const t=[],r=new Map,a=[];u.forEach(n=>{const g=n.date||"",o=g?new Date(g).toISOString().split("T")[0]:"unknown";r.has(o)||(r.set(o,[]),a.push(o)),r.get(o).push(n)});const x=new Date().toISOString().split("T")[0];return a.forEach(n=>{t.push({dateKey:n,label:n==="unknown"?"Unknown Date":Se(n),isToday:n===x,events:r.get(n)})}),t},[u]),R=l.useMemo(()=>C.flatMap(t=>t.events),[C]),W=l.useCallback(t=>{c(r=>{const a=new Set(r);return a.has(t)?a.delete(t):a.add(t),a})},[]),O=l.useCallback(()=>{c(new Set),d(""),M("30")},[]),U=l.useCallback(t=>{L(!1);const r=u.map(o=>({type:o.type,date:o.date,title:o.title||o.content||o.description||"",owner:o.owner||"",status:o.status||"",operation:o.operation||""}));let a,x;if(t==="json")a=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),x=`timeline-${new Date().toISOString().split("T")[0]}.json`;else{const o=Object.keys(r[0]||{}),D=[o.join(","),...r.map(v=>o.map(E=>`"${String(v[E]||"").replace(/"/g,'""')}"`).join(","))];a=new Blob([D.join(`
`)],{type:"text/csv"}),x=`timeline-${new Date().toISOString().split("T")[0]}.csv`}const n=URL.createObjectURL(a),g=document.createElement("a");g.href=n,g.download=x,g.click(),URL.revokeObjectURL(n)},[u]);l.useEffect(()=>{const t=r=>{if(r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement){r.key==="Escape"&&(r.target.blur(),d(""));return}r.key==="/"&&(r.preventDefault(),$.current?.focus()),(r.key==="j"||r.key==="ArrowDown")&&(r.preventDefault(),S(a=>Math.min(a+1,R.length-1))),(r.key==="k"||r.key==="ArrowUp")&&(r.preventDefault(),S(a=>Math.max(a-1,0))),r.key==="Escape"&&S(-1)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[R.length]);const Z=b==="compact"?"py-2 px-3 gap-2":b==="spacious"?"py-5 px-5 gap-4":"py-3.5 px-4 gap-3",ee=b==="compact"?"h-7 w-7":b==="spacious"?"h-10 w-10":"h-8 w-8";if(V)return e.jsx(Te,{});if(K)return e.jsx("div",{className:"p-5",children:e.jsx(xe,{message:"Failed to load timeline data.",onRetry:()=>Q()})});let A=-1;return e.jsxs("div",{ref:P,className:"flex flex-col h-[calc(100vh-4rem)]",tabIndex:-1,children:[e.jsx("div",{className:"shrink-0 border-b border-gm-border-primary bg-gm-surface-primary sticky top-0 z-20",children:e.jsxs("div",{className:"px-5 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-base font-bold text-gm-text-primary",children:"Timeline"}),e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary bg-gm-surface-secondary px-2 py-0.5 rounded-full",children:[u.length,w>u.length?` / ${w}`:""," events"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center border border-gm-border-primary rounded-lg overflow-hidden",children:[["compact",ve],["comfortable",Ne],["spacious",pe]].map(([t,r])=>e.jsx("button",{onClick:()=>B(t),"aria-label":`${t} density`,"aria-pressed":b===t,className:m("p-1.5 transition-colors",b===t?"bg-blue-600/10 text-gm-interactive-primary":"text-gm-text-tertiary hover:text-gm-text-primary"),children:e.jsx(r,{className:"w-3.5 h-3.5"})},t))}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>L(!N),"aria-expanded":N,"aria-label":"Export timeline",className:"px-2.5 py-1.5 rounded-lg border border-gm-border-primary text-gm-text-tertiary hover:text-gm-text-primary hover:bg-gm-surface-secondary text-xs flex items-center gap-1.5 transition-colors",children:[e.jsx(re,{className:"w-3.5 h-3.5"})," Export ",e.jsx(se,{className:"w-3 h-3"})]}),N&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-gm-surface-primary border border-gm-border-primary rounded-lg shadow-lg z-30 min-w-[120px]",children:[e.jsx("button",{onClick:()=>U("csv"),className:"w-full text-left px-3 py-2 text-xs text-gm-text-primary hover:bg-gm-surface-secondary transition-colors",children:"Export CSV"}),e.jsx("button",{onClick:()=>U("json"),className:"w-full text-left px-3 py-2 text-xs text-gm-text-primary hover:bg-gm-surface-secondary transition-colors",children:"Export JSON"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-sm",children:[e.jsx(ae,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gm-text-tertiary"}),e.jsx("input",{ref:$,value:i,onChange:t=>d(t.target.value),placeholder:"Search events... (press / to focus)","aria-label":"Search timeline events",className:"w-full pl-8 pr-8 py-1.5 rounded-lg bg-gm-bg-tertiary border border-gm-border-primary text-xs text-gm-text-primary placeholder:text-gm-text-placeholder focus:outline-none focus:border-gm-border-focus transition-colors"}),i&&e.jsx("button",{onClick:()=>d(""),"aria-label":"Clear search",className:"absolute right-2 top-1/2 -translate-y-1/2 text-gm-text-tertiary hover:text-gm-text-primary",children:e.jsx(F,{className:"w-3.5 h-3.5"})})]}),e.jsx("div",{className:"flex items-center border border-gm-border-primary rounded-lg overflow-hidden",children:[["7","7d"],["14","14d"],["30","30d"],["90","90d"],["all","All"]].map(([t,r])=>e.jsx("button",{onClick:()=>M(t),"aria-pressed":h===t,className:m("px-2.5 py-1.5 text-[10px] font-medium transition-colors",h===t?"bg-blue-600/10 text-gm-interactive-primary":"text-gm-text-tertiary hover:text-gm-text-primary"),children:r},t))})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",role:"toolbar","aria-label":"Filter by event type",children:[e.jsx(ge,{className:"w-3 h-3 text-gm-text-tertiary mr-0.5"}),Y.map(t=>{const r=X[t.key]||0,a=s.has(t.key),x=t.icon;return e.jsxs("button",{onClick:()=>W(t.key),"aria-pressed":a,className:m("px-2 py-1 rounded-md text-[10px] font-medium transition-all border flex items-center gap-1",a?`${t.bg} ${t.border} ${t.color}`:"bg-gm-surface-secondary border-transparent text-gm-text-tertiary hover:text-gm-text-primary hover:border-gm-border-primary"),children:[e.jsx(x,{className:"w-3 h-3"})," ",t.label,r>0&&e.jsx("span",{className:"text-[9px] opacity-70",children:r})]},t.key)}),(s.size>0||i||h!=="30")&&e.jsxs("button",{onClick:O,className:"px-2 py-1 rounded-md text-[10px] font-medium text-gm-text-tertiary hover:text-gm-status-danger transition-colors flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"})," Clear"]})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-5",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gm-surface-secondary flex items-center justify-center mb-4",children:e.jsx(z,{className:"w-10 h-10 text-gray-600"})}),e.jsx("p",{className:"text-sm font-medium text-gm-text-secondary mb-1",children:"No events found"}),e.jsx("p",{className:"text-xs text-gray-400 max-w-sm mb-4",children:i?`No events matching "${i}"`:s.size>0?"No events for the selected types":"No timeline events in this period"}),(i||s.size>0)&&e.jsx("button",{onClick:O,className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover transition-colors",children:"Clear Filters"})]}):e.jsxs("div",{className:"px-5 py-4",children:[C.map(t=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center gap-3 py-2 bg-gm-bg-primary backdrop-blur-sm",children:[e.jsx("div",{className:m("w-2.5 h-2.5 rounded-full shrink-0",t.isToday?"bg-gm-interactive-primary ring-2 ring-blue-600/30":"bg-gray-500")}),e.jsx("span",{className:m("text-[11px] font-semibold uppercase tracking-wider",t.isToday?"text-gm-interactive-primary":"text-gm-text-tertiary"),children:t.label}),e.jsx("span",{className:"text-[10px] text-gray-500",children:t.events.length}),e.jsx("div",{className:"flex-1 h-px bg-gm-border-primary"}),t.isToday&&e.jsx("span",{className:"text-[9px] font-medium text-gm-interactive-primary bg-blue-600/10 px-2 py-0.5 rounded-full",children:"TODAY"})]}),t.isToday&&e.jsxs("div",{className:"flex items-center gap-2 ml-[5px] my-1",children:[e.jsx("div",{className:"w-px h-3 bg-gm-interactive-primary"}),e.jsx("div",{className:"flex-1 h-px bg-blue-600/30"})]}),e.jsx("div",{className:"ml-[5px] border-l-2 border-gm-border-primary space-y-1.5 pl-5",children:t.events.map((r,a)=>{A++;const x=A,n=ke[r.type]||{icon:me,color:"text-gm-text-tertiary",bg:"bg-gm-surface-secondary",border:"border-gm-border-primary",label:r.type||"Event"},g=n.icon,o=r.owner||r.changed_by_email||"",D=r.title||r.content||r.description||r.filename||`${n.label} event`,v=r.date||"",E=x===H;return e.jsxs("div",{className:m("rounded-xl border bg-gm-surface-primary transition-all duration-150 flex items-start",Z,E?"border-gm-interactive-primary ring-1 ring-blue-600/20 shadow-sm":"border-gm-border-primary hover:border-blue-600/20 hover:shadow-sm"),children:[e.jsx("div",{className:"relative -ml-[29px] mr-2 mt-1 shrink-0",children:e.jsx("div",{className:m("w-2.5 h-2.5 rounded-full border-2 border-gm-surface-primary",n.bg.replace("/10","")),style:{backgroundColor:`var(--tw-${n.color.replace("text-","")}, currentColor)`},children:e.jsx("div",{className:m("w-full h-full rounded-full",n.bg)})})}),e.jsx("div",{className:m("rounded-lg flex items-center justify-center shrink-0",n.bg,ee),children:e.jsx(g,{className:m("w-4 h-4",n.color)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:m("text-[10px] font-medium px-1.5 py-0.5 rounded border",n.bg,n.border,n.color),children:n.label}),r.operation&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary capitalize",children:r.operation}),Ee(r.status)]}),e.jsx("p",{className:m("text-gm-text-primary mt-1 leading-snug",b==="compact"?"text-xs":"text-sm"),children:String(D)}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[o&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-gm-surface-secondary flex items-center justify-center",children:e.jsx("span",{className:"text-[7px] font-bold text-gm-text-tertiary",children:De(o)})}),e.jsx("span",{className:"text-[10px] text-gm-text-tertiary",children:o})]}),v&&e.jsx("span",{className:"text-[10px] text-gray-400",title:new Date(v).toLocaleString(),children:Ce(v)})]})]})]},`${t.dateKey}-${a}`)})})]},t.dateKey)),w>k&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("button",{onClick:()=>q(t=>t+200),className:"px-4 py-2 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-xs font-medium text-gm-text-primary hover:bg-gm-surface-hover transition-colors flex items-center gap-1.5",children:[e.jsx(fe,{className:"w-3.5 h-3.5 rotate-180"})," Load more (",w-k," remaining)"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 py-3 text-[9px] text-gray-500",children:[e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1 py-0.5 rounded bg-gm-surface-secondary border border-gm-border-primary text-[8px]",children:"J"}),"/",e.jsx("kbd",{className:"px-1 py-0.5 rounded bg-gm-surface-secondary border border-gm-border-primary text-[8px]",children:"K"})," navigate"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1 py-0.5 rounded bg-gm-surface-secondary border border-gm-border-primary text-[8px]",children:"/"})," search"]}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1 py-0.5 rounded bg-gm-surface-secondary border border-gm-border-primary text-[8px]",children:"Esc"})," clear"]})]})]})})]})}export{Fe as default};
//# sourceMappingURL=TimelinePage-BDkhsUnu.js.map
