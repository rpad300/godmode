{"version":3,"file":"OntologyViewer-B92izhkw.js","sources":["../../frontend/components/graph/OntologyViewer.ts"],"sourcesContent":["/**\n * OntologyViewer - Visual schema explorer and editor\n * \n * SOTA v2.0 Features:\n * - Entity type visualization with colors and icons\n * - Relationship type explorer\n * - AI suggestions panel with auto-approve\n * - Schema statistics with usage counts\n * - Interactive hierarchy view\n * - Sync status indicator (Supabase Graph)\n * - LLM Analysis integration\n * - Audit trail / change history\n * \n * SOTA v2.1 Features:\n * - Background jobs monitoring and control\n * - Continuous optimization status\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { \n  graphService, \n  OntologySchema, \n  OntologyEntityType, \n  OntologyRelationType, \n  OntologySuggestion,\n  OntologyTypeStats,\n  OntologySyncStatus,\n  OntologyChange,\n  BackgroundWorkerStatus,\n  BackgroundWorkerStats,\n  OntologyJob,\n  BackgroundJobExecution\n} from '../../services/graph';\nimport { toast } from '../../services/toast';\n\nexport interface OntologyViewerProps {\n  onEntitySelect?: (entity: OntologyEntityType) => void;\n  onRelationSelect?: (relation: OntologyRelationType) => void;\n}\n\ninterface ViewerState {\n  schema: OntologySchema | null;\n  suggestions: OntologySuggestion[];\n  typeStats: OntologyTypeStats | null;\n  syncStatus: OntologySyncStatus | null;\n  changes: OntologyChange[];\n  workerStatus: BackgroundWorkerStatus | null;\n  workerStats: BackgroundWorkerStats | null;\n  jobs: OntologyJob[];\n  jobLog: BackgroundJobExecution[];\n  compliance: { valid: boolean; score: number; issues: Array<{ type: string; severity: string; message: string; count?: number }> } | null;\n  falkorBrowserInfo: { browserUrl: string; isCloud: boolean; note: string } | null;\n  unusedTypes: { entities: string[]; relations: string[] } | null;\n  activeTab: 'entities' | 'relations' | 'graph' | 'suggestions' | 'analytics' | 'history' | 'jobs' | 'tools';\n  searchQuery: string;\n  isLoading: boolean;\n  isAnalyzing: boolean;\n  isSyncing: boolean;\n}\n\n/**\n * Create the ontology viewer component\n */\nexport function createOntologyViewer(props: OntologyViewerProps = {}): HTMLElement {\n  const state: ViewerState = {\n    schema: null,\n    suggestions: [],\n    typeStats: null,\n    syncStatus: null,\n    changes: [],\n    workerStatus: null,\n    workerStats: null,\n    jobs: [],\n    jobLog: [],\n    compliance: null,\n    falkorBrowserInfo: null,\n    unusedTypes: null,\n    activeTab: 'entities',\n    searchQuery: '',\n    isLoading: true,\n    isAnalyzing: false,\n    isSyncing: false,\n  };\n\n  const container = createElement('div', { className: 'ontology-viewer' });\n  \n  container.innerHTML = `\n    <div class=\"ontology-header\">\n      <div class=\"ontology-tabs\">\n        <button class=\"ontology-tab active\" data-tab=\"entities\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/>\n            <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/>\n            <path d=\"M20.4 14.5L16 10l-5.5 5.5\"/>\n            <path d=\"M14 14.5L10.5 11 7 14.5\"/>\n          </svg>\n          Entities\n        </button>\n        <button class=\"ontology-tab\" data-tab=\"relations\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6\"/>\n            <polyline points=\"15 3 21 3 21 9\"/>\n            <line x1=\"10\" y1=\"14\" x2=\"21\" y2=\"3\"/>\n          </svg>\n          Relations\n        </button>\n        <button class=\"ontology-tab\" data-tab=\"graph\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <circle cx=\"6\" cy=\"6\" r=\"3\"/>\n            <circle cx=\"18\" cy=\"6\" r=\"3\"/>\n            <circle cx=\"6\" cy=\"18\" r=\"3\"/>\n            <circle cx=\"18\" cy=\"18\" r=\"3\"/>\n            <line x1=\"9\" y1=\"6\" x2=\"15\" y2=\"6\"/>\n            <line x1=\"6\" y1=\"9\" x2=\"6\" y2=\"15\"/>\n            <line x1=\"18\" y1=\"9\" x2=\"18\" y2=\"15\"/>\n            <line x1=\"9\" y1=\"18\" x2=\"15\" y2=\"18\"/>\n          </svg>\n          Graph\n        </button>\n        <button class=\"ontology-tab\" data-tab=\"analytics\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <line x1=\"18\" y1=\"20\" x2=\"18\" y2=\"10\"/>\n            <line x1=\"12\" y1=\"20\" x2=\"12\" y2=\"4\"/>\n            <line x1=\"6\" y1=\"20\" x2=\"6\" y2=\"14\"/>\n          </svg>\n          Analytics\n        </button>\n        <button class=\"ontology-tab\" data-tab=\"suggestions\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\n            <path d=\"M2 17l10 5 10-5\"/>\n            <path d=\"M2 12l10 5 10-5\"/>\n          </svg>\n          AI\n          <span class=\"badge\" id=\"suggestions-badge\" style=\"display: none\">0</span>\n        </button>\n        <button class=\"ontology-tab\" data-tab=\"history\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n            <polyline points=\"12 6 12 12 16 14\"/>\n          </svg>\n          History\n        </button>\n        <button class=\"ontology-tab\" data-tab=\"jobs\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <rect x=\"2\" y=\"7\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/>\n            <path d=\"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16\"/>\n          </svg>\n          Jobs\n          <span class=\"badge job-status-badge\" id=\"jobs-badge\" style=\"display: none\"></span>\n        </button>\n        <button class=\"ontology-tab\" data-tab=\"tools\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z\"/>\n          </svg>\n          Tools\n        </button>\n      </div>\n      <div class=\"ontology-actions\">\n        <button class=\"btn btn-sm btn-ghost\" id=\"btn-sync\" title=\"Sync to graph\">\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <polyline points=\"23 4 23 10 17 10\"/>\n            <polyline points=\"1 20 1 14 7 14\"/>\n            <path d=\"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15\"/>\n          </svg>\n        </button>\n        <div class=\"sync-indicator\" id=\"sync-indicator\" title=\"Sync status\">\n          <span class=\"sync-dot\"></span>\n        </div>\n      </div>\n      <div class=\"ontology-search\">\n        <input type=\"text\" id=\"ontology-search\" placeholder=\"Search...\" class=\"search-input\">\n        <svg class=\"search-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <circle cx=\"11\" cy=\"11\" r=\"8\"/>\n          <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\n        </svg>\n      </div>\n    </div>\n    \n    <div class=\"ontology-content\" id=\"ontology-content\">\n      <div class=\"loading-state\">\n        <div class=\"loading-spinner\"></div>\n        <p>Loading ontology schema...</p>\n      </div>\n    </div>\n    \n    <div class=\"ontology-footer\">\n      <div class=\"ontology-stats\" id=\"ontology-stats\">\n        <!-- Stats will be rendered here -->\n      </div>\n      <div class=\"ontology-source\" id=\"ontology-source\">\n        <!-- Source info -->\n      </div>\n      <div class=\"ontology-version\" id=\"ontology-version\">\n        <!-- Version info -->\n      </div>\n    </div>\n  `;\n\n  // Initialize\n  initOntologyViewer(container, state, props);\n\n  return container;\n}\n\n/**\n * Initialize the viewer\n */\nasync function initOntologyViewer(\n  container: HTMLElement,\n  state: ViewerState,\n  props: OntologyViewerProps\n): Promise<void> {\n  // Bind tabs\n  const tabs = container.querySelectorAll('.ontology-tab');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      const tabId = tab.getAttribute('data-tab') as ViewerState['activeTab'];\n      if (tabId) {\n        switchTab(container, state, tabId, props);\n      }\n    });\n  });\n\n  // Bind search\n  const searchInput = container.querySelector('#ontology-search') as HTMLInputElement;\n  if (searchInput) {\n    on(searchInput, 'input', () => {\n      state.searchQuery = searchInput.value.toLowerCase();\n      renderCurrentTab(container, state, props);\n    });\n  }\n\n  // Bind sync button\n  const syncBtn = container.querySelector('#btn-sync');\n  if (syncBtn) {\n    on(syncBtn as HTMLElement, 'click', async () => {\n      if (state.isSyncing) return;\n      state.isSyncing = true;\n      syncBtn.classList.add('syncing');\n      toast.info('Syncing ontology to graph...');\n      \n      const result = await graphService.forceOntologySync();\n      \n      state.isSyncing = false;\n      syncBtn.classList.remove('syncing');\n      \n      if (result.ok) {\n        toast.success('Ontology synced to graph');\n        await loadOntologyData(container, state, props);\n      } else {\n        toast.error(`Sync failed: ${result.error}`);\n      }\n    });\n  }\n\n  // Load data\n  await loadOntologyData(container, state, props);\n}\n\n/**\n * Load ontology data\n */\nasync function loadOntologyData(\n  container: HTMLElement,\n  state: ViewerState,\n  props: OntologyViewerProps\n): Promise<void> {\n  try {\n    const [schema, suggestions, typeStats, syncStatus, changes, workerData, jobs, jobLog, falkorBrowserInfo] = await Promise.all([\n      graphService.getOntologySchema(),\n      graphService.getOntologySuggestions(),\n      graphService.getOntologyTypeStats(),\n      graphService.getOntologySyncStatus(),\n      graphService.getOntologyChanges({ limit: 20 }),\n      graphService.getBackgroundWorkerStatus(),\n      graphService.getOntologyJobs(),\n      graphService.getBackgroundWorkerLog({ limit: 10 }),\n      graphService.getFalkorDBBrowserInfo(),\n    ]);\n\n    state.schema = schema;\n    state.suggestions = suggestions.filter(s => s.status === 'pending');\n    state.typeStats = typeStats;\n    state.syncStatus = syncStatus;\n    state.changes = changes;\n    state.workerStatus = workerData?.status || null;\n    state.workerStats = workerData?.stats || null;\n    state.jobs = jobs;\n    state.jobLog = jobLog;\n    state.falkorBrowserInfo = falkorBrowserInfo;\n    state.isLoading = false;\n\n    // Update suggestions badge\n    const badge = container.querySelector('#suggestions-badge') as HTMLElement;\n    if (badge) {\n      if (state.suggestions.length > 0) {\n        badge.textContent = String(state.suggestions.length);\n        badge.style.display = '';\n      } else {\n        badge.style.display = 'none';\n      }\n    }\n\n    // Update jobs badge\n    updateJobsBadge(container, state);\n\n    // Update sync indicator\n    updateSyncIndicator(container, state);\n\n    // Update stats\n    updateStats(container, state);\n\n    // Render initial tab\n    renderCurrentTab(container, state, props);\n\n  } catch (error) {\n    console.error('[OntologyViewer] Failed to load:', error);\n    const content = container.querySelector('#ontology-content');\n    if (content) {\n      content.innerHTML = `\n        <div class=\"error-state\">\n          <p>Failed to load ontology schema</p>\n          <button class=\"btn btn-sm\" onclick=\"location.reload()\">Retry</button>\n        </div>\n      `;\n    }\n  }\n}\n\n/**\n * Update sync status indicator\n */\nfunction updateSyncIndicator(container: HTMLElement, state: ViewerState): void {\n  const indicator = container.querySelector('#sync-indicator') as HTMLElement;\n  if (!indicator) return;\n\n  const dot = indicator.querySelector('.sync-dot') as HTMLElement;\n  if (!dot) return;\n\n  if (state.syncStatus) {\n    if (state.syncStatus.syncInProgress) {\n      dot.className = 'sync-dot syncing';\n      indicator.title = 'Syncing...';\n    } else if (state.syncStatus.isListening && state.syncStatus.graphConnected) {\n      dot.className = 'sync-dot connected';\n      indicator.title = `Connected - Last sync: ${state.syncStatus.lastSyncAt ? new Date(state.syncStatus.lastSyncAt).toLocaleTimeString() : 'never'}`;\n    } else if (state.syncStatus.graphConnected) {\n      dot.className = 'sync-dot partial';\n      indicator.title = 'Connected (realtime sync disabled)';\n    } else {\n      dot.className = 'sync-dot disconnected';\n      indicator.title = 'Graph not connected';\n    }\n  } else {\n    dot.className = 'sync-dot unknown';\n    indicator.title = 'Status unknown';\n  }\n\n  // Update source info\n  const sourceEl = container.querySelector('#ontology-source');\n  if (sourceEl && state.syncStatus?.ontologySource) {\n    sourceEl.textContent = `Source: ${state.syncStatus.ontologySource}`;\n  }\n}\n\n/**\n * Switch tab\n */\nfunction switchTab(\n  container: HTMLElement,\n  state: ViewerState,\n  tabId: ViewerState['activeTab'],\n  props: OntologyViewerProps\n): void {\n  state.activeTab = tabId;\n\n  // Update tab buttons\n  const tabs = container.querySelectorAll('.ontology-tab');\n  tabs.forEach(tab => {\n    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);\n  });\n\n  // Render content\n  renderCurrentTab(container, state, props);\n}\n\n/**\n * Render current tab\n */\nfunction renderCurrentTab(\n  container: HTMLElement,\n  state: ViewerState,\n  props: OntologyViewerProps\n): void {\n  const content = container.querySelector('#ontology-content') as HTMLElement;\n  if (!content || !state.schema) return;\n\n  switch (state.activeTab) {\n    case 'entities':\n      renderEntitiesTab(content, state, props);\n      break;\n    case 'relations':\n      renderRelationsTab(content, state, props);\n      break;\n    case 'graph':\n      renderGraphTab(content, state, props);\n      break;\n    case 'analytics':\n      renderAnalyticsTab(content, state, container);\n      break;\n    case 'suggestions':\n      renderSuggestionsTab(content, state, container);\n      break;\n    case 'history':\n      renderHistoryTab(content, state);\n      break;\n    case 'jobs':\n      renderJobsTab(content, state, container);\n      break;\n    case 'tools':\n      renderToolsTab(content, state, container);\n      break;\n  }\n}\n\n/**\n * Render entities tab\n */\nfunction renderEntitiesTab(\n  container: HTMLElement,\n  state: ViewerState,\n  props: OntologyViewerProps\n): void {\n  if (!state.schema || !state.schema.entityTypes) {\n    container.innerHTML = `<div class=\"empty-state\"><p>No entity types defined in schema</p></div>`;\n    return;\n  }\n\n  const entities = Object.entries(state.schema.entityTypes)\n    .filter(([name, entity]) => {\n      if (!state.searchQuery) return true;\n      return name.toLowerCase().includes(state.searchQuery) ||\n             (entity.label || '').toLowerCase().includes(state.searchQuery) ||\n             (entity.description || '').toLowerCase().includes(state.searchQuery);\n    })\n    .sort((a, b) => a[0].localeCompare(b[0]));\n\n  if (entities.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No entity types found${state.searchQuery ? ' matching \"' + escapeHtml(state.searchQuery) + '\"' : ''}</p>\n      </div>\n    `;\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"ontology-layout\">\n      <div class=\"entity-list\">\n        ${entities.map(([name, entity]) => {\n          const propEntries = Object.entries(entity.properties || {});\n          const hasMoreProps = propEntries.length > 5;\n          return `\n            <div class=\"entity-card\" data-entity=\"${name}\">\n              <div class=\"entity-header\">\n                <div class=\"entity-icon-wrapper\" style=\"background: ${entity.color || '#6366f1'}\">\n                  <span class=\"entity-icon-letter\">${(entity.label || name).charAt(0).toUpperCase()}</span>\n                </div>\n                <div class=\"entity-info\">\n                  <h4 class=\"entity-name\">${escapeHtml(entity.label || name)}</h4>\n                  <span class=\"entity-key\">${escapeHtml(name)}</span>\n                </div>\n                ${entity.sharedEntity ? '<span class=\"shared-badge\">Shared</span>' : ''}\n              </div>\n              ${entity.description ? `<p class=\"entity-description\">${escapeHtml(entity.description)}</p>` : ''}\n              <div class=\"entity-properties\">\n                <h5>PROPERTIES (${propEntries.length})</h5>\n                <div class=\"properties-list\" data-entity=\"${name}\" data-expanded=\"false\">\n                  ${propEntries.slice(0, 5).map(([propName, prop]) => `\n                    <div class=\"property-row\">\n                      <span class=\"property-name ${(prop as Record<string, unknown>).required ? 'required' : ''}\">${escapeHtml(propName)}</span>\n                      <span class=\"property-type\">${(prop as Record<string, unknown>).type || 'string'}</span>\n                    </div>\n                  `).join('')}\n                  ${hasMoreProps ? `\n                    <button class=\"btn-expand-props\" data-entity=\"${name}\">+${propEntries.length - 5} more</button>\n                    <div class=\"properties-hidden\" style=\"display: none;\">\n                      ${propEntries.slice(5).map(([propName, prop]) => `\n                        <div class=\"property-row\">\n                          <span class=\"property-name ${(prop as Record<string, unknown>).required ? 'required' : ''}\">${escapeHtml(propName)}</span>\n                          <span class=\"property-type\">${(prop as Record<string, unknown>).type || 'string'}</span>\n                        </div>\n                      `).join('')}\n                    </div>\n                  ` : ''}\n                </div>\n              </div>\n            </div>\n          `;\n        }).join('')}\n      </div>\n      <div class=\"entity-detail-panel\" id=\"entity-detail-panel\">\n        <div class=\"detail-placeholder\">\n          <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" opacity=\"0.3\">\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\"/>\n            <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"/>\n            <path d=\"M20.4 14.5L16 10l-5.5 5.5\"/>\n          </svg>\n          <p>Select an entity type to view details</p>\n        </div>\n      </div>\n    </div>\n  `;\n\n  // Bind card click events\n  container.querySelectorAll('.entity-card').forEach(card => {\n    on(card as HTMLElement, 'click', (e) => {\n      // Don't trigger if clicking expand button\n      if ((e.target as HTMLElement).classList.contains('btn-expand-props')) return;\n      \n      const name = card.getAttribute('data-entity');\n      if (name && state.schema?.entityTypes[name]) {\n        // Highlight selected card\n        container.querySelectorAll('.entity-card').forEach(c => c.classList.remove('selected'));\n        card.classList.add('selected');\n        \n        // Show details and position panel next to the clicked card\n        showEntityDetails(container, name, state.schema.entityTypes[name]);\n        \n        // Position the detail panel to align with the clicked card\n        const entityList = container.querySelector('.entity-list');\n        const detailPanel = container.querySelector('#entity-detail-panel') as HTMLElement;\n        if (entityList && detailPanel) {\n          const listRect = entityList.getBoundingClientRect();\n          const cardRect = (card as HTMLElement).getBoundingClientRect();\n          const offsetTop = cardRect.top - listRect.top;\n          detailPanel.style.marginTop = `${Math.max(0, offsetTop)}px`;\n        }\n        \n        props.onEntitySelect?.(state.schema.entityTypes[name]);\n      }\n    });\n  });\n\n  // Bind expand buttons\n  container.querySelectorAll('.btn-expand-props').forEach(btn => {\n    on(btn as HTMLElement, 'click', (e) => {\n      e.stopPropagation();\n      const entityName = btn.getAttribute('data-entity');\n      const propsList = container.querySelector(`.properties-list[data-entity=\"${entityName}\"]`);\n      const hiddenProps = propsList?.querySelector('.properties-hidden') as HTMLElement;\n      \n      if (hiddenProps) {\n        const isExpanded = propsList?.getAttribute('data-expanded') === 'true';\n        if (isExpanded) {\n          hiddenProps.style.display = 'none';\n          btn.textContent = `+${hiddenProps.querySelectorAll('.property-row').length} more`;\n          propsList?.setAttribute('data-expanded', 'false');\n        } else {\n          hiddenProps.style.display = 'block';\n          btn.textContent = 'Show less';\n          propsList?.setAttribute('data-expanded', 'true');\n        }\n      }\n    });\n  });\n}\n\n/**\n * Show entity details in the detail panel\n */\nfunction showEntityDetails(container: HTMLElement, name: string, entity: OntologyEntityType): void {\n  const panel = container.querySelector('#entity-detail-panel');\n  if (!panel) return;\n\n  const propEntries = Object.entries(entity.properties || {});\n  \n  panel.innerHTML = `\n    <div class=\"detail-header\" style=\"border-left: 4px solid ${entity.color || '#6366f1'};\">\n      <h3>${escapeHtml(entity.label || name)}</h3>\n      <span class=\"detail-key\">${escapeHtml(name)}</span>\n      ${entity.sharedEntity ? '<span class=\"shared-badge\">Shared across projects</span>' : ''}\n    </div>\n    ${entity.description ? `<p class=\"detail-description\">${escapeHtml(entity.description)}</p>` : ''}\n    \n    <div class=\"detail-section\">\n      <h4>Properties (${propEntries.length})</h4>\n      <table class=\"properties-table\">\n        <thead>\n          <tr>\n            <th>Name</th>\n            <th>Type</th>\n            <th>Required</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${propEntries.map(([propName, prop]) => {\n            const p = prop as Record<string, unknown>;\n            return `\n              <tr>\n                <td><code>${escapeHtml(propName)}</code></td>\n                <td><span class=\"type-badge\">${p.type || 'string'}</span></td>\n                <td>${p.required ? '<span class=\"required-badge\">Required</span>' : '<span class=\"optional-badge\">Optional</span>'}</td>\n              </tr>\n            `;\n          }).join('')}\n        </tbody>\n      </table>\n    </div>\n    \n    ${entity.examples && entity.examples.length > 0 ? `\n      <div class=\"detail-section\">\n        <h4>Examples</h4>\n        <ul class=\"examples-list\">\n          ${entity.examples.map(ex => `<li>${escapeHtml(String(ex))}</li>`).join('')}\n        </ul>\n      </div>\n    ` : ''}\n  `;\n}\n\n/**\n * Render relations tab\n */\nfunction renderRelationsTab(\n  container: HTMLElement,\n  state: ViewerState,\n  props: OntologyViewerProps\n): void {\n  if (!state.schema || !state.schema.relationTypes) {\n    container.innerHTML = `<div class=\"empty-state\"><p>No relation types defined in schema</p></div>`;\n    return;\n  }\n\n  const relations = Object.entries(state.schema.relationTypes)\n    .filter(([name, relation]) => {\n      if (!state.searchQuery) return true;\n      return name.toLowerCase().includes(state.searchQuery) ||\n             (relation.label || '').toLowerCase().includes(state.searchQuery) ||\n             (relation.description || '').toLowerCase().includes(state.searchQuery);\n    })\n    .sort((a, b) => a[0].localeCompare(b[0]));\n\n  if (relations.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No relation types found${state.searchQuery ? ' matching \"' + escapeHtml(state.searchQuery) + '\"' : ''}</p>\n      </div>\n    `;\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"relation-list\">\n      ${relations.map(([name, relation]) => `\n        <div class=\"relation-card\" data-relation=\"${name}\">\n          <div class=\"relation-header\">\n            <div class=\"relation-icon\">\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <path d=\"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6\"/>\n                <polyline points=\"15 3 21 3 21 9\"/>\n                <line x1=\"10\" y1=\"14\" x2=\"21\" y2=\"3\"/>\n              </svg>\n            </div>\n            <div class=\"relation-info\">\n              <h4 class=\"relation-name\">${escapeHtml(relation.label || name)}</h4>\n              <span class=\"relation-key\">${escapeHtml(name)}</span>\n            </div>\n          </div>\n          ${relation.description ? `<p class=\"relation-description\">${escapeHtml(relation.description)}</p>` : ''}\n          <div class=\"relation-types\">\n            <div class=\"from-types\">\n              <span class=\"types-label\">From:</span>\n              ${(relation.fromTypes || []).map(t => `<span class=\"type-chip\">${escapeHtml(t)}</span>`).join('')}\n            </div>\n            <div class=\"to-types\">\n              <span class=\"types-label\">To:</span>\n              ${(relation.toTypes || []).map(t => `<span class=\"type-chip\">${escapeHtml(t)}</span>`).join('')}\n            </div>\n          </div>\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind click events\n  container.querySelectorAll('.relation-card').forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const name = card.getAttribute('data-relation');\n      if (name && state.schema?.relationTypes[name]) {\n        props.onRelationSelect?.(state.schema.relationTypes[name]);\n      }\n    });\n  });\n}\n\n/**\n * Render graph visualization tab\n */\nfunction renderGraphTab(\n  container: HTMLElement,\n  state: ViewerState,\n  props: OntologyViewerProps\n): void {\n  if (!state.schema?.entityTypes || !state.schema?.relationTypes) {\n    container.innerHTML = `<div class=\"empty-state\"><p>No schema available for graph visualization</p></div>`;\n    return;\n  }\n\n  // Create graph container\n  container.innerHTML = `\n    <div class=\"ontology-graph-container\" style=\"height: 400px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary);\">\n      <div id=\"ontology-graph-canvas\" style=\"width: 100%; height: 100%;\"></div>\n    </div>\n    <div class=\"ontology-graph-legend\" style=\"margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;\">\n      <h5 style=\"margin: 0 0 8px 0; font-size: 12px; color: var(--text-muted);\">Legend</h5>\n      <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\n        ${Object.entries(state.schema.entityTypes).map(([name, entity]) => `\n          <span style=\"display: inline-flex; align-items: center; gap: 4px; font-size: 11px;\">\n            <span style=\"width: 12px; height: 12px; border-radius: 50%; background: ${(entity as Record<string, unknown>).color || '#6366f1'}\"></span>\n            ${escapeHtml(name)}\n          </span>\n        `).join('')}\n      </div>\n    </div>\n  `;\n\n  // Initialize vis.js network after DOM is ready\n  setTimeout(() => {\n    const canvas = container.querySelector('#ontology-graph-canvas') as HTMLElement;\n    if (!canvas) return;\n\n    // Get vis.js library\n    const vis = (window as unknown as Record<string, unknown>).vis as {\n      Network: new (container: HTMLElement, data: unknown, options: unknown) => unknown;\n      DataSet: new <T = unknown>(data?: T[]) => { add: (items: T | T[]) => void };\n    };\n    \n    if (!vis) {\n      canvas.innerHTML = '<p style=\"padding: 20px; text-align: center; color: var(--text-muted);\">vis.js not loaded</p>';\n      return;\n    }\n\n    // Create nodes from entity types\n    const nodes: Array<{ id: string; label: string; color: string; shape: string; font: { color: string } }> = [];\n    const entityColors: Record<string, string> = {};\n    \n    Object.entries(state.schema!.entityTypes).forEach(([name, entity]) => {\n      const color = (entity as Record<string, unknown>).color as string || '#6366f1';\n      entityColors[name] = color;\n      nodes.push({\n        id: name,\n        label: name,\n        color: color,\n        shape: 'dot',\n        font: { color: getTextColor() }\n      });\n    });\n\n    // Create edges from relation types\n    const edges: Array<{ from: string; to: string; label: string; arrows: string; color: { color: string } }> = [];\n    \n    Object.entries(state.schema!.relationTypes).forEach(([name, relation]) => {\n      const rel = relation as Record<string, unknown>;\n      const fromTypes = (rel.fromTypes || []) as string[];\n      const toTypes = (rel.toTypes || []) as string[];\n      \n      // Create edges for each valid from->to combination\n      fromTypes.forEach(from => {\n        toTypes.forEach(to => {\n          if (state.schema!.entityTypes[from] && state.schema!.entityTypes[to]) {\n            edges.push({\n              from,\n              to,\n              label: name,\n              arrows: 'to',\n              color: { color: 'rgba(156, 163, 175, 0.6)' }\n            });\n          }\n        });\n      });\n    });\n\n    // Create network\n    const data = {\n      nodes: new vis.DataSet(nodes),\n      edges: new vis.DataSet(edges)\n    };\n\n    const options = {\n      nodes: {\n        size: 30,\n        borderWidth: 3,\n        font: { \n          size: 14, \n          face: 'Inter, system-ui, sans-serif',\n          strokeWidth: 3,\n          strokeColor: 'rgba(255,255,255,0.8)'\n        },\n        shadow: {\n          enabled: true,\n          size: 10,\n          color: 'rgba(0,0,0,0.2)'\n        }\n      },\n      edges: {\n        font: { size: 9, align: 'top', color: 'rgba(100,100,100,0.7)' },\n        smooth: { \n          type: 'curvedCW',\n          roundness: 0.2\n        },\n        width: 1.5,\n        selectionWidth: 3,\n        hoverWidth: 2\n      },\n      physics: {\n        enabled: true,\n        solver: 'barnesHut',\n        barnesHut: {\n          gravitationalConstant: -3000,\n          centralGravity: 0.1,\n          springLength: 250,\n          springConstant: 0.02,\n          damping: 0.3,\n          avoidOverlap: 1\n        },\n        stabilization: { \n          enabled: true,\n          iterations: 200,\n          fit: true\n        }\n      },\n      interaction: {\n        hover: true,\n        tooltipDelay: 200,\n        zoomView: true,\n        dragView: true\n      },\n      layout: {\n        improvedLayout: true,\n        randomSeed: 42\n      }\n    };\n\n    const network = new vis.Network(canvas, data, options);\n    \n    // Fit to view after stabilization\n    (network as { once: (event: string, cb: () => void) => void }).once('stabilizationIterationsDone', () => {\n      (network as { fit: () => void }).fit();\n    });\n  }, 100);\n}\n\n/**\n * Get text color based on theme\n */\nfunction getTextColor(): string {\n  return document.documentElement.getAttribute('data-theme') === 'dark' ? '#e5e7eb' : '#1f2937';\n}\n\n/**\n * Render suggestions tab\n */\nfunction renderSuggestionsTab(\n  container: HTMLElement,\n  state: ViewerState,\n  parentContainer: HTMLElement\n): void {\n  if (state.suggestions.length === 0) {\n    const hasGaps = state.typeStats?.notInOntology?.entities?.length || \n                    state.typeStats?.notInOntology?.relations?.length;\n    const hasUnused = state.typeStats?.unused?.entities?.length ||\n                      state.typeStats?.unused?.relations?.length;\n    \n    container.innerHTML = `\n      <div class=\"ai-suggestions-empty\">\n        <div class=\"ai-status-card\">\n          <div class=\"ai-status-icon ${hasGaps ? 'warning' : 'success'}\">\n            <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              ${hasGaps ? \n                '<circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"/><line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"/>' : \n                '<path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/><polyline points=\"22 4 12 14.01 9 11.01\"/>'}\n            </svg>\n          </div>\n          <div class=\"ai-status-text\">\n            <h3>${hasGaps ? 'Schema gaps detected' : 'Ontology is in sync'}</h3>\n            <p>${hasGaps ? \n              'Some types in your graph are not defined in the ontology schema.' : \n              'All entity and relation types in your graph are defined in the ontology.'}</p>\n          </div>\n        </div>\n        \n        <div class=\"ai-insights-grid\">\n          <div class=\"ai-insight-card\">\n            <div class=\"insight-value\">${Object.keys(state.typeStats?.entities || {}).length}</div>\n            <div class=\"insight-label\">Entity Types in Graph</div>\n          </div>\n          <div class=\"ai-insight-card\">\n            <div class=\"insight-value\">${Object.keys(state.typeStats?.relations || {}).length}</div>\n            <div class=\"insight-label\">Relation Types in Graph</div>\n          </div>\n          <div class=\"ai-insight-card ${hasGaps ? 'warning' : ''}\">\n            <div class=\"insight-value\">${(state.typeStats?.notInOntology?.entities?.length || 0) + (state.typeStats?.notInOntology?.relations?.length || 0)}</div>\n            <div class=\"insight-label\">Not in Schema</div>\n          </div>\n          <div class=\"ai-insight-card ${hasUnused ? 'muted' : ''}\">\n            <div class=\"insight-value\">${(state.typeStats?.unused?.entities?.length || 0) + (state.typeStats?.unused?.relations?.length || 0)}</div>\n            <div class=\"insight-label\">Unused Types</div>\n          </div>\n        </div>\n        \n        <div class=\"ai-actions\">\n          <button class=\"btn btn-primary\" id=\"btn-run-ai-analysis\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\n              <path d=\"M2 17l10 5 10-5\"/>\n              <path d=\"M2 12l10 5 10-5\"/>\n            </svg>\n            Run AI Analysis\n          </button>\n          <button class=\"btn btn-ghost\" id=\"btn-check-gaps\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <circle cx=\"11\" cy=\"11\" r=\"8\"/>\n              <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\n            </svg>\n            Check for Gaps\n          </button>\n        </div>\n        \n        ${hasGaps ? `\n          <div class=\"ai-gaps-preview\">\n            <h4>Detected Gaps</h4>\n            <div class=\"gaps-list\">\n              ${state.typeStats?.notInOntology?.entities?.map(name => `\n                <span class=\"gap-chip entity\">${escapeHtml(name)}</span>\n              `).join('') || ''}\n              ${state.typeStats?.notInOntology?.relations?.map(name => `\n                <span class=\"gap-chip relation\">${escapeHtml(name)}</span>\n              `).join('') || ''}\n            </div>\n            <p class=\"text-muted\">Click \"Check for Gaps\" to generate suggestions for these types.</p>\n          </div>\n        ` : ''}\n      </div>\n    `;\n    \n    // Bind AI analysis button\n    const analyzeBtn = container.querySelector('#btn-run-ai-analysis');\n    if (analyzeBtn) {\n      on(analyzeBtn as HTMLElement, 'click', async () => {\n        toast.info('Running AI analysis...');\n        analyzeBtn.classList.add('loading');\n        (analyzeBtn as HTMLButtonElement).disabled = true;\n        \n        const result = await graphService.runLLMAnalysis();\n        \n        analyzeBtn.classList.remove('loading');\n        (analyzeBtn as HTMLButtonElement).disabled = false;\n        \n        if (result) {\n          toast.success(`Analysis complete: ${result.suggestions?.length || 0} suggestions`);\n          const suggestions = await graphService.getOntologySuggestions();\n          state.suggestions = suggestions.filter(s => s.status === 'pending');\n          renderSuggestionsTab(container, state, parentContainer);\n          updateSuggestionsBadge(parentContainer, state);\n        } else {\n          toast.error('Analysis failed');\n        }\n      });\n    }\n    \n    // Bind check gaps button\n    const checkGapsBtn = container.querySelector('#btn-check-gaps');\n    if (checkGapsBtn) {\n      on(checkGapsBtn as HTMLElement, 'click', async () => {\n        toast.info('Checking for gaps...');\n        checkGapsBtn.classList.add('loading');\n        (checkGapsBtn as HTMLButtonElement).disabled = true;\n        \n        const result = await graphService.triggerBackgroundAnalysis('gaps');\n        \n        checkGapsBtn.classList.remove('loading');\n        (checkGapsBtn as HTMLButtonElement).disabled = false;\n        \n        if (result) {\n          toast.success('Gap check complete');\n          const suggestions = await graphService.getOntologySuggestions();\n          state.suggestions = suggestions.filter(s => s.status === 'pending');\n          renderSuggestionsTab(container, state, parentContainer);\n          updateSuggestionsBadge(parentContainer, state);\n        } else {\n          toast.error('Gap check failed');\n        }\n      });\n    }\n    \n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"suggestions-list\">\n      ${state.suggestions.map(suggestion => `\n        <div class=\"suggestion-card\" data-id=\"${suggestion.id}\">\n          <div class=\"suggestion-header\">\n            <span class=\"suggestion-type\">${suggestion.type}</span>\n            <span class=\"suggestion-name\">${escapeHtml(suggestion.name)}</span>\n          </div>\n          ${suggestion.description ? `<p class=\"suggestion-description\">${escapeHtml(suggestion.description)}</p>` : ''}\n          ${suggestion.example ? `<div class=\"suggestion-example\"><strong>Example:</strong> ${escapeHtml(suggestion.example)}</div>` : ''}\n          ${suggestion.source ? `<div class=\"suggestion-source\">Source: ${escapeHtml(suggestion.source)}</div>` : ''}\n          <div class=\"suggestion-actions\">\n            <button class=\"btn btn-sm btn-primary btn-approve\" data-id=\"${suggestion.id}\">\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <polyline points=\"20 6 9 17 4 12\"/>\n              </svg>\n              Approve\n            </button>\n            <button class=\"btn btn-sm btn-ghost btn-reject\" data-id=\"${suggestion.id}\">\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/>\n                <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\n              </svg>\n              Reject\n            </button>\n          </div>\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind approve/reject\n  container.querySelectorAll('.btn-approve').forEach(btn => {\n    on(btn as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const id = btn.getAttribute('data-id');\n      if (id) {\n        const success = await graphService.approveOntologySuggestion(id);\n        if (success) {\n          toast.success('Suggestion approved');\n          state.suggestions = state.suggestions.filter(s => s.id !== id);\n          renderSuggestionsTab(container, state, parentContainer);\n          updateSuggestionsBadge(parentContainer, state);\n        } else {\n          toast.error('Failed to approve suggestion');\n        }\n      }\n    });\n  });\n\n  container.querySelectorAll('.btn-reject').forEach(btn => {\n    on(btn as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const id = btn.getAttribute('data-id');\n      if (id) {\n        const success = await graphService.rejectOntologySuggestion(id);\n        if (success) {\n          toast.info('Suggestion rejected');\n          state.suggestions = state.suggestions.filter(s => s.id !== id);\n          renderSuggestionsTab(container, state, parentContainer);\n          updateSuggestionsBadge(parentContainer, state);\n        } else {\n          toast.error('Failed to reject suggestion');\n        }\n      }\n    });\n  });\n}\n\n/**\n * Render analytics tab - SOTA v2.0\n */\nfunction renderAnalyticsTab(\n  container: HTMLElement,\n  state: ViewerState,\n  parentContainer: HTMLElement\n): void {\n  const stats = state.typeStats;\n  const compliance = (stats as unknown as { compliance?: { total: number; valid: number; invalid: number; unchecked: number; percentage: number } })?.compliance;\n  \n  container.innerHTML = `\n    <div class=\"analytics-container\">\n      ${compliance ? `\n        <div class=\"compliance-overview\">\n          <div class=\"compliance-score ${compliance.percentage >= 90 ? 'excellent' : compliance.percentage >= 70 ? 'good' : 'warning'}\">\n            <div class=\"compliance-value\">${compliance.percentage}%</div>\n            <div class=\"compliance-label\">Ontology Compliance</div>\n          </div>\n          <div class=\"compliance-details\">\n            <div class=\"compliance-stat\">\n              <span class=\"stat-value success\">${compliance.valid}</span>\n              <span class=\"stat-label\">Valid Nodes</span>\n            </div>\n            <div class=\"compliance-stat\">\n              <span class=\"stat-value ${compliance.invalid > 0 ? 'error' : ''}\">${compliance.invalid}</span>\n              <span class=\"stat-label\">Invalid Nodes</span>\n            </div>\n            <div class=\"compliance-stat\">\n              <span class=\"stat-value muted\">${compliance.unchecked}</span>\n              <span class=\"stat-label\">Unchecked</span>\n            </div>\n            <div class=\"compliance-stat\">\n              <span class=\"stat-value\">${compliance.total}</span>\n              <span class=\"stat-label\">Total Nodes</span>\n            </div>\n          </div>\n        </div>\n      ` : ''}\n      \n      <div class=\"analytics-header\">\n        <h3>Ontology Analytics</h3>\n        <div class=\"analytics-actions\">\n          <button class=\"btn btn-sm btn-primary\" id=\"btn-analyze\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\n              <path d=\"M2 17l10 5 10-5\"/>\n              <path d=\"M2 12l10 5 10-5\"/>\n            </svg>\n            Run LLM Analysis\n          </button>\n          <button class=\"btn btn-sm btn-ghost\" id=\"btn-auto-approve\" title=\"Auto-approve high confidence suggestions\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <polyline points=\"20 6 9 17 4 12\"/>\n            </svg>\n            Auto-Approve\n          </button>\n        </div>\n      </div>\n      \n      ${stats ? `\n        <div class=\"analytics-grid\">\n          <div class=\"analytics-card\">\n            <h4>Entity Type Usage</h4>\n            <div class=\"usage-list\">\n              ${Object.entries(stats.entities || {})\n                .sort((a, b) => (b[1].count || 0) - (a[1].count || 0))\n                .slice(0, 10)\n                .map(([name, data]) => `\n                  <div class=\"usage-row ${!data.inOntology ? 'not-in-ontology' : ''}\">\n                    <span class=\"usage-name\">${escapeHtml(name)}</span>\n                    <span class=\"usage-count\">${data.count}</span>\n                    ${!data.inOntology ? '<span class=\"warning-badge\">Not in schema</span>' : ''}\n                  </div>\n                `).join('')}\n            </div>\n          </div>\n          \n          <div class=\"analytics-card\">\n            <h4>Relation Type Usage</h4>\n            <div class=\"usage-list\">\n              ${Object.entries(stats.relations || {})\n                .sort((a, b) => (b[1].count || 0) - (a[1].count || 0))\n                .slice(0, 10)\n                .map(([name, data]) => `\n                  <div class=\"usage-row ${!data.inOntology ? 'not-in-ontology' : ''}\">\n                    <span class=\"usage-name\">${escapeHtml(name)}</span>\n                    <span class=\"usage-count\">${data.count}</span>\n                    ${!data.inOntology ? '<span class=\"warning-badge\">Not in schema</span>' : ''}\n                  </div>\n                `).join('')}\n            </div>\n          </div>\n          \n          ${(stats.unused?.entities?.length || stats.unused?.relations?.length) ? `\n            <div class=\"analytics-card warning\">\n              <h4>Unused in Schema</h4>\n              <p class=\"text-muted\">These types are defined in the schema but have no instances in the graph.</p>\n              ${stats.unused.entities?.length ? `\n                <div class=\"unused-section\">\n                  <strong>Entities:</strong>\n                  <div class=\"unused-list\">\n                    ${stats.unused.entities.map(name => `<span class=\"unused-chip\">${escapeHtml(name)}</span>`).join('')}\n                  </div>\n                </div>\n              ` : ''}\n              ${stats.unused.relations?.length ? `\n                <div class=\"unused-section\">\n                  <strong>Relations:</strong>\n                  <div class=\"unused-list\">\n                    ${stats.unused.relations.map(name => `<span class=\"unused-chip\">${escapeHtml(name)}</span>`).join('')}\n                  </div>\n                </div>\n              ` : ''}\n            </div>\n          ` : ''}\n          \n          ${(stats.notInOntology?.entities?.length || stats.notInOntology?.relations?.length) ? `\n            <div class=\"analytics-card error\">\n              <h4>Not in Schema</h4>\n              <p class=\"text-muted\">These types exist in the graph but are not defined in the schema.</p>\n              ${stats.notInOntology.entities?.length ? `\n                <div class=\"not-in-ontology-section\">\n                  <strong>Entities:</strong>\n                  <div class=\"not-in-ontology-list\">\n                    ${stats.notInOntology.entities.map(name => `<span class=\"error-chip\">${escapeHtml(name)}</span>`).join('')}\n                  </div>\n                </div>\n              ` : ''}\n              ${stats.notInOntology.relations?.length ? `\n                <div class=\"not-in-ontology-section\">\n                  <strong>Relations:</strong>\n                  <div class=\"not-in-ontology-list\">\n                    ${stats.notInOntology.relations.map(name => `<span class=\"error-chip\">${escapeHtml(name)}</span>`).join('')}\n                  </div>\n                </div>\n              ` : ''}\n            </div>\n          ` : ''}\n        </div>\n      ` : `\n        <div class=\"empty-state\">\n          <p>No analytics data available. Make sure the graph is connected.</p>\n        </div>\n      `}\n      \n      <div id=\"analysis-results\" style=\"display: none;\">\n        <!-- LLM analysis results will be rendered here -->\n      </div>\n    </div>\n  `;\n\n  // Bind LLM Analysis button\n  const analyzeBtn = container.querySelector('#btn-analyze');\n  if (analyzeBtn) {\n    on(analyzeBtn as HTMLElement, 'click', async () => {\n      if (state.isAnalyzing) return;\n      state.isAnalyzing = true;\n      analyzeBtn.classList.add('loading');\n      (analyzeBtn as HTMLButtonElement).disabled = true;\n      toast.info('Running LLM analysis... This may take a moment.');\n      \n      const result = await graphService.runLLMAnalysis();\n      \n      state.isAnalyzing = false;\n      analyzeBtn.classList.remove('loading');\n      (analyzeBtn as HTMLButtonElement).disabled = false;\n      \n      if (result) {\n        toast.success(`Analysis complete: ${result.suggestions?.length || 0} new suggestions`);\n        \n        // Show results\n        const resultsEl = container.querySelector('#analysis-results') as HTMLElement;\n        if (resultsEl) {\n          resultsEl.style.display = 'block';\n          resultsEl.innerHTML = `\n            <div class=\"analysis-results\">\n              <h4>LLM Analysis Results</h4>\n              <p class=\"analysis-summary\">${escapeHtml(result.summary || result.analysis?.summary || '')}</p>\n              ${result.suggestions?.length ? `\n                <p class=\"text-success\">${result.suggestions.length} suggestions were added. Check the AI tab to review them.</p>\n              ` : ''}\n            </div>\n          `;\n        }\n        \n        // Refresh suggestions\n        const suggestions = await graphService.getOntologySuggestions();\n        state.suggestions = suggestions.filter(s => s.status === 'pending');\n        updateSuggestionsBadge(parentContainer, state);\n      } else {\n        toast.error('Analysis failed. Check console for details.');\n      }\n    });\n  }\n\n  // Bind auto-approve button\n  const autoApproveBtn = container.querySelector('#btn-auto-approve');\n  if (autoApproveBtn) {\n    on(autoApproveBtn as HTMLElement, 'click', async () => {\n      if (!state.suggestions.length) {\n        toast.info('No pending suggestions to approve');\n        return;\n      }\n      \n      const result = await graphService.autoApproveHighConfidence(0.85);\n      \n      if (result.approved > 0) {\n        toast.success(`Auto-approved ${result.approved} high-confidence suggestions`);\n        // Refresh suggestions\n        const suggestions = await graphService.getOntologySuggestions();\n        state.suggestions = suggestions.filter(s => s.status === 'pending');\n        updateSuggestionsBadge(parentContainer, state);\n      } else {\n        toast.info('No suggestions met the confidence threshold');\n      }\n    });\n  }\n}\n\n/**\n * Render history tab - SOTA v2.0\n */\nfunction renderHistoryTab(\n  container: HTMLElement,\n  state: ViewerState\n): void {\n  if (!state.changes || state.changes.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" opacity=\"0.4\">\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n          <polyline points=\"12 6 12 12 16 14\"/>\n        </svg>\n        <h3>No change history</h3>\n        <p>Changes to the ontology schema will be logged here.</p>\n      </div>\n    `;\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"history-container\">\n      <h3>Ontology Change History</h3>\n      <div class=\"history-list\">\n        ${state.changes.map(change => {\n          const icon = getChangeIcon(change.change_type);\n          const color = getChangeColor(change.change_type);\n          return `\n            <div class=\"history-item\">\n              <div class=\"history-icon\" style=\"color: ${color}\">\n                ${icon}\n              </div>\n              <div class=\"history-content\">\n                <div class=\"history-header\">\n                  <span class=\"history-type\" style=\"color: ${color}\">${formatChangeType(change.change_type)}</span>\n                  <span class=\"history-target\">${escapeHtml(change.target_type || '')}/${escapeHtml(change.target_name || '')}</span>\n                </div>\n                ${change.reason ? `<p class=\"history-reason\">${escapeHtml(change.reason)}</p>` : ''}\n                <div class=\"history-meta\">\n                  <span class=\"history-source\">${escapeHtml(change.source || 'manual')}</span>\n                  <span class=\"history-date\">${new Date(change.changed_at).toLocaleString()}</span>\n                </div>\n                ${change.diff ? `\n                  <details class=\"history-diff\">\n                    <summary>View changes</summary>\n                    <pre>${escapeHtml(JSON.stringify(change.diff, null, 2))}</pre>\n                  </details>\n                ` : ''}\n              </div>\n            </div>\n          `;\n        }).join('')}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Get icon for change type\n */\nfunction getChangeIcon(changeType: string): string {\n  if (changeType.includes('added')) {\n    return '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/></svg>';\n  }\n  if (changeType.includes('removed')) {\n    return '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/></svg>';\n  }\n  if (changeType.includes('modified')) {\n    return '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"/><path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"/></svg>';\n  }\n  return '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"/><line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"/></svg>';\n}\n\n/**\n * Get color for change type\n */\nfunction getChangeColor(changeType: string): string {\n  if (changeType.includes('added')) return 'var(--color-success, #10b981)';\n  if (changeType.includes('removed')) return 'var(--color-error, #ef4444)';\n  if (changeType.includes('modified')) return 'var(--color-warning, #f59e0b)';\n  return 'var(--color-info, #3b82f6)';\n}\n\n/**\n * Format change type for display\n */\nfunction formatChangeType(changeType: string): string {\n  return changeType\n    .replace(/_/g, ' ')\n    .replace(/\\b\\w/g, c => c.toUpperCase());\n}\n\n/**\n * Render jobs tab - SOTA v2.1 Background Worker\n */\nfunction renderJobsTab(\n  container: HTMLElement,\n  state: ViewerState,\n  parentContainer: HTMLElement\n): void {\n  const { workerStatus, workerStats, jobs, jobLog } = state;\n  \n  container.innerHTML = `\n    <div class=\"jobs-container\">\n      <div class=\"jobs-header\">\n        <h3>Background Optimization Jobs</h3>\n        <div class=\"worker-status ${workerStatus?.isRunning ? 'running' : ''}\">\n          <span class=\"status-dot ${workerStatus?.isRunning ? 'active' : 'idle'}\"></span>\n          <span>${workerStatus?.isRunning ? 'Running' : 'Idle'}</span>\n          ${workerStatus?.hasPendingAnalysis ? '<span class=\"pending-badge\">Analysis Pending</span>' : ''}\n        </div>\n      </div>\n      \n      ${workerStats ? `\n        <div class=\"worker-stats\">\n          <div class=\"stat-card\">\n            <span class=\"stat-value\">${workerStats.totalExecutions}</span>\n            <span class=\"stat-label\">Total Executions</span>\n          </div>\n          <div class=\"stat-card success\">\n            <span class=\"stat-value\">${workerStats.byStatus?.completed || 0}</span>\n            <span class=\"stat-label\">Completed</span>\n          </div>\n          <div class=\"stat-card error\">\n            <span class=\"stat-value\">${workerStats.byStatus?.failed || 0}</span>\n            <span class=\"stat-label\">Failed</span>\n          </div>\n          <div class=\"stat-card\">\n            <span class=\"stat-value\">${workerStats.avgDuration ? (workerStats.avgDuration / 1000).toFixed(1) + 's' : '-'}</span>\n            <span class=\"stat-label\">Avg Duration</span>\n          </div>\n        </div>\n      ` : ''}\n      \n      <div class=\"jobs-section\">\n        <h4>Scheduled Jobs</h4>\n        <div class=\"jobs-list\">\n          ${jobs.length > 0 ? jobs.map(job => `\n            <div class=\"job-card ${job.enabled ? 'enabled' : 'disabled'}\">\n              <div class=\"job-info\">\n                <div class=\"job-name\">${escapeHtml(job.name)}</div>\n                <div class=\"job-meta\">\n                  <span class=\"job-schedule\">${escapeHtml(job.schedule)}</span>\n                  <span class=\"job-run-count\">${job.runCount} runs</span>\n                </div>\n                ${job.lastRun ? `<div class=\"job-last-run\">Last: ${new Date(job.lastRun).toLocaleString()}</div>` : ''}\n                ${job.nextRun ? `<div class=\"job-next-run\">Next: ${new Date(job.nextRun).toLocaleString()}</div>` : ''}\n              </div>\n              <div class=\"job-actions\">\n                <button class=\"btn btn-sm ${job.enabled ? 'btn-warning' : 'btn-success'} btn-toggle-job\" data-job-id=\"${job.id}\" data-enabled=\"${job.enabled}\">\n                  ${job.enabled ? 'Disable' : 'Enable'}\n                </button>\n                <button class=\"btn btn-sm btn-primary btn-run-job\" data-job-type=\"${job.type.replace('ontology_', '')}\">\n                  Run Now\n                </button>\n              </div>\n            </div>\n          `).join('') : '<p class=\"text-muted\">No scheduled jobs found.</p>'}\n        </div>\n      </div>\n      \n      <div class=\"jobs-section\">\n        <h4>Quick Actions</h4>\n        <div class=\"quick-actions\">\n          <button class=\"btn btn-sm btn-outline\" id=\"btn-run-full\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\n              <path d=\"M2 17l10 5 10-5\"/>\n            </svg>\n            Full Analysis\n          </button>\n          <button class=\"btn btn-sm btn-outline\" id=\"btn-run-inference\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n              <polyline points=\"12 6 12 12 16 14\"/>\n            </svg>\n            Run Inference\n          </button>\n          <button class=\"btn btn-sm btn-outline\" id=\"btn-run-dedup\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"/>\n              <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"/>\n            </svg>\n            Check Duplicates\n          </button>\n          <button class=\"btn btn-sm btn-outline\" id=\"btn-run-gaps\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <circle cx=\"11\" cy=\"11\" r=\"8\"/>\n              <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\n            </svg>\n            Check Gaps\n          </button>\n        </div>\n      </div>\n      \n      <div class=\"jobs-section\">\n        <h4>Recent Executions</h4>\n        <div class=\"execution-log\">\n          ${jobLog.length > 0 ? jobLog.map(exec => `\n            <div class=\"execution-item ${exec.status}\">\n              <div class=\"execution-type\">${formatJobType(exec.type)}</div>\n              <div class=\"execution-status\">${exec.status}</div>\n              <div class=\"execution-time\">${exec.startedAt ? new Date(exec.startedAt).toLocaleString() : ''}</div>\n              <div class=\"execution-duration\">${exec.duration ? (exec.duration / 1000).toFixed(1) + 's' : '-'}</div>\n              ${exec.error ? `<div class=\"execution-error\">${escapeHtml(exec.error)}</div>` : ''}\n            </div>\n          `).join('') : '<p class=\"text-muted\">No recent executions.</p>'}\n        </div>\n      </div>\n    </div>\n  `;\n\n  // Bind toggle job buttons\n  container.querySelectorAll('.btn-toggle-job').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const jobId = btn.getAttribute('data-job-id');\n      const currentlyEnabled = btn.getAttribute('data-enabled') === 'true';\n      if (jobId) {\n        const result = await graphService.toggleOntologyJob(jobId, !currentlyEnabled);\n        if (result) {\n          toast.success(`Job ${result.enabled ? 'enabled' : 'disabled'}`);\n          // Reload jobs\n          state.jobs = await graphService.getOntologyJobs();\n          renderJobsTab(container, state, parentContainer);\n        } else {\n          toast.error('Failed to toggle job');\n        }\n      }\n    });\n  });\n\n  // Bind run job buttons\n  container.querySelectorAll('.btn-run-job').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const jobType = btn.getAttribute('data-job-type') as 'full' | 'inference' | 'dedup' | 'auto_approve' | 'gaps';\n      if (jobType) {\n        toast.info(`Running ${jobType}...`);\n        const result = await graphService.triggerBackgroundAnalysis(jobType);\n        if (result && result.status === 'completed') {\n          toast.success(`${jobType} completed`);\n        } else if (result?.error) {\n          toast.error(`Error: ${result.error}`);\n        }\n        // Reload log\n        state.jobLog = await graphService.getBackgroundWorkerLog({ limit: 10 });\n        renderJobsTab(container, state, parentContainer);\n      }\n    });\n  });\n\n  // Bind quick action buttons\n  const quickActions = [\n    { id: 'btn-run-full', type: 'full' as const },\n    { id: 'btn-run-inference', type: 'inference' as const },\n    { id: 'btn-run-dedup', type: 'dedup' as const },\n    { id: 'btn-run-gaps', type: 'gaps' as const }\n  ];\n\n  quickActions.forEach(({ id, type }) => {\n    const btn = container.querySelector(`#${id}`);\n    if (btn) {\n      on(btn as HTMLElement, 'click', async () => {\n        toast.info(`Running ${type} analysis...`);\n        btn.classList.add('loading');\n        (btn as HTMLButtonElement).disabled = true;\n        \n        const result = await graphService.triggerBackgroundAnalysis(type);\n        \n        btn.classList.remove('loading');\n        (btn as HTMLButtonElement).disabled = false;\n        \n        if (result && result.status === 'completed') {\n          toast.success(`${type} analysis completed`);\n        } else if (result?.error) {\n          toast.error(`Error: ${result.error}`);\n        }\n        \n        // Reload worker status and log\n        const workerData = await graphService.getBackgroundWorkerStatus();\n        state.workerStatus = workerData?.status || null;\n        state.workerStats = workerData?.stats || null;\n        state.jobLog = await graphService.getBackgroundWorkerLog({ limit: 10 });\n        renderJobsTab(container, state, parentContainer);\n      });\n    }\n  });\n}\n\n/**\n * Render tools tab - SOTA v2.1 Advanced Ontology Tools\n */\nfunction renderToolsTab(\n  container: HTMLElement,\n  state: ViewerState,\n  parentContainer: HTMLElement\n): void {\n  const { compliance } = state;\n  \n  container.innerHTML = `\n    <div class=\"tools-container\">\n      <div class=\"tools-section graph-status\">\n        <h4>Graph Database</h4>\n        <p class=\"text-muted\">Supabase PostgreSQL graph storage - fully managed, zero configuration.</p>\n        <div class=\"graph-status-card\">\n          <div class=\"status-indicator active\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\n              <polyline points=\"22 4 12 14.01 9 11.01\"/>\n            </svg>\n            <span>Connected to Supabase Graph</span>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"tools-section\">\n        <h4>Ontology Compliance</h4>\n        <p class=\"text-muted\">Validate that your graph data conforms to the ontology schema.</p>\n        \n        ${compliance ? `\n          <div class=\"compliance-card ${compliance.valid ? 'valid' : 'invalid'}\">\n            <div class=\"compliance-header\">\n              <div class=\"compliance-score-large ${compliance.score >= 90 ? 'excellent' : compliance.score >= 70 ? 'good' : 'warning'}\">\n                <span class=\"score-value\">${compliance.score}%</span>\n                <span class=\"score-label\">Compliance</span>\n              </div>\n              <div class=\"compliance-status\">\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                  ${compliance.valid ? \n                    '<path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/><polyline points=\"22 4 12 14.01 9 11.01\"/>' : \n                    '<circle cx=\"12\" cy=\"12\" r=\"10\"/><line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"/><line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"/>'}\n                </svg>\n                <span>${compliance.valid ? 'Compliant' : 'Issues Found'}</span>\n              </div>\n            </div>\n            \n            ${compliance.issues.length > 0 ? `\n              <div class=\"compliance-issues\">\n                <h5>Issues (${compliance.issues.length})</h5>\n                <div class=\"issues-list\">\n                  ${compliance.issues.slice(0, 10).map(issue => `\n                    <div class=\"issue-item ${issue.severity}\">\n                      <span class=\"issue-type\">${issue.type.replace(/_/g, ' ')}</span>\n                      <span class=\"issue-message\">${escapeHtml(issue.message)}</span>\n                      ${issue.count ? `<span class=\"issue-count\">${issue.count}</span>` : ''}\n                    </div>\n                  `).join('')}\n                  ${compliance.issues.length > 10 ? `<p class=\"text-muted\">...and ${compliance.issues.length - 10} more</p>` : ''}\n                </div>\n              </div>\n            ` : ''}\n            \n            <div class=\"compliance-actions\">\n              <button class=\"btn btn-outline btn-sm\" id=\"btn-recheck-compliance\">\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                  <polyline points=\"23 4 23 10 17 10\"/>\n                  <path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n                </svg>\n                Re-check Compliance\n              </button>\n              <button class=\"btn btn-ghost btn-sm\" id=\"btn-clear-compliance\">Clear</button>\n            </div>\n          </div>\n        ` : `\n          <button class=\"btn btn-outline\" id=\"btn-validate-compliance\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M9 11l3 3L22 4\"/>\n              <path d=\"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11\"/>\n            </svg>\n            Run Compliance Check\n          </button>\n        `}\n      </div>\n      \n      <div class=\"tools-section\">\n        <h4>Ontology Extraction</h4>\n        <p class=\"text-muted\">Extract ontology schema directly from your graph data.</p>\n        <div class=\"tools-grid\">\n          <button class=\"btn btn-outline tool-btn\" id=\"btn-extract-ontology\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\n              <polyline points=\"7 10 12 15 17 10\"/>\n              <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>\n            </svg>\n            <span>Extract from Graph</span>\n            <small>Auto-detect entity & relation types</small>\n          </button>\n          \n          <button class=\"btn btn-outline tool-btn\" id=\"btn-diff-ontology\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"23\"/>\n              <path d=\"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\"/>\n            </svg>\n            <span>Compare with Graph</span>\n            <small>See what's different</small>\n          </button>\n          \n          <button class=\"btn btn-outline tool-btn\" id=\"btn-merge-ontology\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <circle cx=\"18\" cy=\"5\" r=\"3\"/>\n              <circle cx=\"6\" cy=\"12\" r=\"3\"/>\n              <circle cx=\"18\" cy=\"19\" r=\"3\"/>\n              <line x1=\"8.59\" y1=\"13.51\" x2=\"15.42\" y2=\"17.49\"/>\n              <line x1=\"15.41\" y1=\"6.51\" x2=\"8.59\" y2=\"10.49\"/>\n            </svg>\n            <span>Merge & Update</span>\n            <small>Add discovered types to schema</small>\n          </button>\n          \n          <button class=\"btn btn-outline tool-btn\" id=\"btn-find-unused\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <circle cx=\"11\" cy=\"11\" r=\"8\"/>\n              <line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\n              <line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\"/>\n            </svg>\n            <span>Find Unused Types</span>\n            <small>Types in schema but not in graph</small>\n          </button>\n        </div>\n      </div>\n      \n      ${state.unusedTypes ? `\n        <div class=\"tools-section unused-types-section\">\n          <h4>Unused Types Found</h4>\n          <p class=\"text-muted\">These types are defined in the schema but have no instances in the graph.</p>\n          \n          ${state.unusedTypes.entities.length > 0 ? `\n            <div class=\"unused-group\">\n              <h5>Unused Entities (${state.unusedTypes.entities.length})</h5>\n              <div class=\"unused-chips\">\n                ${state.unusedTypes.entities.map(e => `<span class=\"unused-chip entity\">${escapeHtml(e)}</span>`).join('')}\n              </div>\n            </div>\n          ` : ''}\n          \n          ${state.unusedTypes.relations.length > 0 ? `\n            <div class=\"unused-group\">\n              <h5>Unused Relations (${state.unusedTypes.relations.length})</h5>\n              <div class=\"unused-chips\">\n                ${state.unusedTypes.relations.map(r => `<span class=\"unused-chip relation\">${escapeHtml(r)}</span>`).join('')}\n              </div>\n            </div>\n          ` : ''}\n          \n          <div class=\"unused-actions\">\n            <button class=\"btn btn-warning btn-sm\" id=\"btn-remove-unused\">\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <polyline points=\"3 6 5 6 21 6\"/>\n                <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/>\n              </svg>\n              Remove All Unused Types\n            </button>\n            <button class=\"btn btn-ghost btn-sm\" id=\"btn-clear-unused\">Clear</button>\n          </div>\n        </div>\n      ` : ''}\n      \n      <div class=\"tools-section\">\n        <h4>Cleanup</h4>\n        <p class=\"text-muted\">Remove orphan types from the ontology schema.</p>\n        <div class=\"cleanup-buttons\">\n          <button class=\"btn btn-ghost btn-sm\" id=\"btn-cleanup-entities\">\n            Remove Entities Without Relations\n          </button>\n          <button class=\"btn btn-ghost btn-sm\" id=\"btn-cleanup-relations\">\n            Remove Relations Without Entities\n          </button>\n        </div>\n      </div>\n      \n    </div>\n  `;\n\n  // Bind event handlers\n  \n  // Validate compliance (initial and re-check)\n  const validateBtn = container.querySelector('#btn-validate-compliance') || container.querySelector('#btn-recheck-compliance');\n  if (validateBtn) {\n    on(validateBtn as HTMLElement, 'click', async () => {\n      toast.info('Validating compliance...');\n      validateBtn.classList.add('loading');\n      (validateBtn as HTMLButtonElement).disabled = true;\n      \n      const result = await graphService.validateOntologyCompliance();\n      \n      validateBtn.classList.remove('loading');\n      (validateBtn as HTMLButtonElement).disabled = false;\n      \n      if (result) {\n        state.compliance = result;\n        toast.success(`Compliance: ${result.score}% - ${result.issues.length} issues found`);\n        renderToolsTab(container, state, parentContainer);\n      } else {\n        toast.error('Failed to validate compliance');\n      }\n    });\n  }\n  \n  // Clear compliance results\n  const clearComplianceBtn = container.querySelector('#btn-clear-compliance');\n  if (clearComplianceBtn) {\n    on(clearComplianceBtn as HTMLElement, 'click', () => {\n      state.compliance = null;\n      renderToolsTab(container, state, parentContainer);\n    });\n  }\n  \n  // Extract from graph\n  const extractBtn = container.querySelector('#btn-extract-ontology');\n  if (extractBtn) {\n    on(extractBtn as HTMLElement, 'click', async () => {\n      toast.info('Extracting ontology from graph...');\n      extractBtn.classList.add('loading');\n      \n      const result = await graphService.extractOntologyFromGraph();\n      \n      extractBtn.classList.remove('loading');\n      \n      if (result.ok && result.ontology) {\n        const entityCount = Object.keys(result.ontology.entityTypes).length;\n        const relCount = Object.keys(result.ontology.relationTypes).length;\n        toast.success(`Extracted: ${entityCount} entities, ${relCount} relations`);\n      } else {\n        toast.error(result.error || 'Failed to extract ontology');\n      }\n    });\n  }\n  \n  // Diff ontology\n  const diffBtn = container.querySelector('#btn-diff-ontology');\n  if (diffBtn) {\n    on(diffBtn as HTMLElement, 'click', async () => {\n      toast.info('Comparing ontology with graph...');\n      diffBtn.classList.add('loading');\n      \n      const result = await graphService.getOntologyDiff();\n      \n      diffBtn.classList.remove('loading');\n      \n      if (result) {\n        const { diff } = result;\n        const inSchemaOnly = diff.entitiesOnlyInA.length + diff.relationsOnlyInA.length;\n        const inGraphOnly = diff.entitiesOnlyInB.length + diff.relationsOnlyInB.length;\n        \n        if (inSchemaOnly === 0 && inGraphOnly === 0) {\n          toast.success('Schema and graph are in sync!');\n        } else {\n          toast.info(`Diff: ${inSchemaOnly} only in schema, ${inGraphOnly} only in graph`);\n        }\n      } else {\n        toast.error('Failed to compare ontology');\n      }\n    });\n  }\n  \n  // Merge ontology\n  const mergeBtn = container.querySelector('#btn-merge-ontology');\n  if (mergeBtn) {\n    on(mergeBtn as HTMLElement, 'click', async () => {\n      toast.info('Merging ontology...');\n      mergeBtn.classList.add('loading');\n      \n      const result = await graphService.mergeOntology({ \n        mergeProperties: true, \n        mergeEndpoints: true, \n        save: true \n      });\n      \n      mergeBtn.classList.remove('loading');\n      \n      if (result.ok) {\n        const changeCount = result.changes?.length || 0;\n        if (changeCount > 0) {\n          toast.success(`Merged: ${changeCount} changes applied`);\n        } else {\n          toast.info('No new types to merge');\n        }\n      } else {\n        toast.error('Failed to merge ontology');\n      }\n    });\n  }\n  \n  // Find unused\n  const unusedBtn = container.querySelector('#btn-find-unused');\n  if (unusedBtn) {\n    on(unusedBtn as HTMLElement, 'click', async () => {\n      toast.info('Finding unused types...');\n      unusedBtn.classList.add('loading');\n      \n      const unused = await graphService.findUnusedOntologyTypes();\n      \n      unusedBtn.classList.remove('loading');\n      \n      state.unusedTypes = unused;\n      const total = unused.entities.length + unused.relations.length;\n      if (total === 0) {\n        toast.success('All types are in use!');\n      } else {\n        toast.info(`Found ${unused.entities.length} unused entities, ${unused.relations.length} unused relations`);\n      }\n      renderToolsTab(container, state, parentContainer);\n    });\n  }\n  \n  // Remove unused types\n  const removeUnusedBtn = container.querySelector('#btn-remove-unused');\n  if (removeUnusedBtn) {\n    on(removeUnusedBtn as HTMLElement, 'click', async () => {\n      if (!state.unusedTypes) return;\n      \n      toast.info('Removing unused types...');\n      removeUnusedBtn.classList.add('loading');\n      (removeUnusedBtn as HTMLButtonElement).disabled = true;\n      \n      // Remove entities and relations\n      const result = await graphService.cleanupOntology({\n        discardEntitiesWithoutRelations: true,\n        discardRelationsWithoutEntities: true,\n        save: true\n      });\n      \n      removeUnusedBtn.classList.remove('loading');\n      (removeUnusedBtn as HTMLButtonElement).disabled = false;\n      \n      if (result.ok) {\n        const removedCount = (result.discardedEntities?.length || 0) + (result.discardedRelations?.length || 0);\n        toast.success(`Removed ${removedCount} unused types`);\n        state.unusedTypes = null;\n        renderToolsTab(container, state, parentContainer);\n      } else {\n        toast.error('Failed to remove unused types');\n      }\n    });\n  }\n  \n  // Clear unused types display\n  const clearUnusedBtn = container.querySelector('#btn-clear-unused');\n  if (clearUnusedBtn) {\n    on(clearUnusedBtn as HTMLElement, 'click', () => {\n      state.unusedTypes = null;\n      renderToolsTab(container, state, parentContainer);\n    });\n  }\n  \n  // Cleanup entities\n  const cleanupEntitiesBtn = container.querySelector('#btn-cleanup-entities');\n  if (cleanupEntitiesBtn) {\n    on(cleanupEntitiesBtn as HTMLElement, 'click', async () => {\n      const result = await graphService.cleanupOntology({ \n        discardEntitiesWithoutRelations: true, \n        save: true \n      });\n      if (result.ok) {\n        toast.success(`Removed ${result.discardedEntities?.length || 0} orphan entities`);\n      }\n    });\n  }\n  \n  // Cleanup relations\n  const cleanupRelationsBtn = container.querySelector('#btn-cleanup-relations');\n  if (cleanupRelationsBtn) {\n    on(cleanupRelationsBtn as HTMLElement, 'click', async () => {\n      const result = await graphService.cleanupOntology({ \n        discardRelationsWithoutEntities: true, \n        save: true \n      });\n      if (result.ok) {\n        toast.success(`Removed ${result.discardedRelations?.length || 0} orphan relations`);\n      }\n    });\n  }\n  \n}\n\n/**\n * Format job type for display\n */\nfunction formatJobType(type: string): string {\n  return type\n    .replace('ontology_', '')\n    .replace(/_/g, ' ')\n    .replace(/\\b\\w/g, c => c.toUpperCase());\n}\n\n/**\n * Update jobs badge\n */\nfunction updateJobsBadge(container: HTMLElement, state: ViewerState): void {\n  const badge = container.querySelector('#jobs-badge') as HTMLElement;\n  if (!badge) return;\n\n  if (state.workerStatus?.isRunning) {\n    badge.textContent = '';\n    badge.className = 'badge job-status-badge running';\n    badge.style.display = '';\n    badge.title = 'Job running';\n  } else if (state.workerStatus?.hasPendingAnalysis) {\n    badge.textContent = '';\n    badge.className = 'badge job-status-badge pending';\n    badge.style.display = '';\n    badge.title = 'Analysis pending';\n  } else {\n    badge.style.display = 'none';\n  }\n}\n\n/**\n * Update stats\n */\nfunction updateStats(container: HTMLElement, state: ViewerState): void {\n  const statsEl = container.querySelector('#ontology-stats');\n  const versionEl = container.querySelector('#ontology-version');\n\n  if (statsEl && state.schema) {\n    const entityCount = Object.keys(state.schema.entityTypes || {}).length;\n    const relationCount = Object.keys(state.schema.relationTypes || {}).length;\n    const queryCount = Object.keys(state.schema.queryPatterns || {}).length;\n\n    statsEl.innerHTML = `\n      <span class=\"stat\">${entityCount} entities</span>\n      <span class=\"stat\">${relationCount} relations</span>\n      <span class=\"stat\">${queryCount} patterns</span>\n    `;\n  }\n\n  if (versionEl && state.schema) {\n    versionEl.innerHTML = `Schema v${state.schema.version}`;\n  }\n}\n\n/**\n * Update suggestions badge\n */\nfunction updateSuggestionsBadge(container: HTMLElement, state: ViewerState): void {\n  const badge = container.querySelector('#suggestions-badge') as HTMLElement;\n  if (badge) {\n    if (state.suggestions.length > 0) {\n      badge.textContent = String(state.suggestions.length);\n      badge.style.display = '';\n    } else {\n      badge.style.display = 'none';\n    }\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createOntologyViewer;\n"],"names":["createOntologyViewer","props","state","container","createElement","initOntologyViewer","tab","on","tabId","switchTab","searchInput","renderCurrentTab","syncBtn","toast","result","graphService","loadOntologyData","schema","suggestions","typeStats","syncStatus","changes","workerData","jobs","jobLog","falkorBrowserInfo","s","badge","updateJobsBadge","updateSyncIndicator","updateStats","error","content","indicator","dot","sourceEl","renderEntitiesTab","renderRelationsTab","renderGraphTab","renderAnalyticsTab","renderSuggestionsTab","renderHistoryTab","renderJobsTab","renderToolsTab","entities","name","entity","a","b","escapeHtml","propEntries","hasMoreProps","propName","prop","card","e","c","showEntityDetails","entityList","detailPanel","listRect","offsetTop","btn","entityName","propsList","hiddenProps","panel","p","ex","relations","relation","t","canvas","vis","nodes","color","getTextColor","edges","rel","fromTypes","toTypes","from","to","data","options","network","parentContainer","hasGaps","hasUnused","analyzeBtn","updateSuggestionsBadge","checkGapsBtn","suggestion","id","stats","compliance","resultsEl","autoApproveBtn","change","icon","getChangeIcon","getChangeColor","formatChangeType","changeType","workerStatus","workerStats","job","exec","formatJobType","jobId","currentlyEnabled","jobType","type","issue","r","validateBtn","clearComplianceBtn","extractBtn","entityCount","relCount","diffBtn","diff","inSchemaOnly","inGraphOnly","mergeBtn","changeCount","unusedBtn","unused","removeUnusedBtn","removedCount","clearUnusedBtn","cleanupEntitiesBtn","cleanupRelationsBtn","statsEl","versionEl","relationCount","queryCount","text","div"],"mappings":"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"}