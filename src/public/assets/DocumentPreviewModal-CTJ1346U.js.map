{"version":3,"file":"DocumentPreviewModal-CTJ1346U.js","sources":["../../frontend/components/modals/DocumentPreviewModal.ts"],"sourcesContent":["/**\r\n * Document Preview Modal - SOTA\r\n * Full document preview with AI analysis, versions, activity, sharing\r\n */\r\n\r\nimport { Document, documentsService } from '../../services/documents';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatFileSize, formatDateTime } from '../../utils/format';\r\n\r\nexport interface DocumentPreviewProps {\r\n  document: Document;\r\n  onClose?: () => void;\r\n  onUpdate?: () => void;\r\n}\r\n\r\ninterface DocumentVersion {\r\n  id: string;\r\n  version_number: number;\r\n  is_current: boolean;\r\n  filename: string;\r\n  file_size: number;\r\n  change_notes?: string;\r\n  ai_change_summary?: string;\r\n  uploaded_by?: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface DocumentActivity {\r\n  id: string;\r\n  action: string;\r\n  user_id?: string;\r\n  user_name?: string;\r\n  user_avatar?: string;\r\n  details?: Record<string, unknown>;\r\n  created_at: string;\r\n}\r\n\r\ninterface AIAnalysis {\r\n  id: string;\r\n  document_id: string;\r\n  analysis_type: string;\r\n  provider: string;\r\n  model: string;\r\n  status: string;\r\n  entities_extracted?: number;\r\n  input_tokens?: number;\r\n  output_tokens?: number;\r\n  cost?: number;\r\n  latency_ms?: number;\r\n  result?: Record<string, unknown>;\r\n  created_at: string;\r\n}\r\n\r\n// State\r\nlet currentTab = 'preview';\r\nlet isFavorite = false;\r\nlet activeReprocessInterval: ReturnType<typeof setInterval> | null = null;\r\n\r\n/**\r\n * Show document preview modal\r\n */\r\nexport function showDocumentPreviewModal(props: DocumentPreviewProps): void {\r\n  const { document: doc } = props;\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'document-preview-modal';\r\n  content.innerHTML = `\r\n    <style>\r\n      .document-preview-modal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 80vh;\r\n        max-height: 800px;\r\n        width: 900px;\r\n        max-width: 95vw;\r\n      }\r\n      .preview-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n      }\r\n      .preview-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n      }\r\n      .preview-title-section {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .preview-title {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin: 0 0 4px 0;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n      .preview-meta {\r\n        display: flex;\r\n        gap: 12px;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .preview-meta span {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n      }\r\n      .preview-actions {\r\n        display: flex;\r\n        gap: 8px;\r\n      }\r\n      .preview-actions .btn {\r\n        padding: 8px 12px;\r\n        font-size: 13px;\r\n        border-radius: 8px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n      .btn-favorite {\r\n        background: transparent;\r\n        border: 1px solid var(--border-color);\r\n        color: var(--text-secondary);\r\n      }\r\n      .btn-favorite.active {\r\n        background: rgba(255, 193, 7, 0.1);\r\n        border-color: #ffc107;\r\n        color: #ffc107;\r\n      }\r\n      .preview-tabs {\r\n        display: flex;\r\n        gap: 0;\r\n        padding: 0 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      .preview-tab {\r\n        padding: 12px 20px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        color: var(--text-secondary);\r\n        background: transparent;\r\n        border: none;\r\n        cursor: pointer;\r\n        position: relative;\r\n        transition: all 0.2s;\r\n      }\r\n      .preview-tab:hover {\r\n        color: var(--text-primary);\r\n        background: rgba(var(--primary-rgb), 0.05);\r\n      }\r\n      .preview-tab.active {\r\n        color: var(--primary);\r\n      }\r\n      .preview-tab.active::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: -1px;\r\n        left: 0;\r\n        right: 0;\r\n        height: 2px;\r\n        background: var(--primary);\r\n        border-radius: 2px 2px 0 0;\r\n      }\r\n      .preview-tab-badge {\r\n        margin-left: 6px;\r\n        padding: 2px 6px;\r\n        font-size: 11px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 10px;\r\n        color: var(--primary);\r\n      }\r\n      .preview-content {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 24px;\r\n      }\r\n      .preview-section {\r\n        display: none;\r\n      }\r\n      .preview-section.active {\r\n        display: block;\r\n      }\r\n      \r\n      /* Content Preview */\r\n      .content-preview {\r\n        background: var(--bg-secondary);\r\n        border-radius: 12px;\r\n        padding: 20px;\r\n        font-family: var(--font-mono, monospace);\r\n        font-size: 13px;\r\n        line-height: 1.6;\r\n        white-space: pre-wrap;\r\n        max-height: 500px;\r\n        overflow-y: auto;\r\n      }\r\n      .content-empty, .content-loading {\r\n        text-align: center;\r\n        padding: 60px 20px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .content-loading::after {\r\n        content: '';\r\n        display: inline-block;\r\n        width: 16px;\r\n        height: 16px;\r\n        border: 2px solid var(--border-color);\r\n        border-top-color: var(--primary);\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n        margin-left: 8px;\r\n        vertical-align: middle;\r\n      }\r\n      .content-empty svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        opacity: 0.5;\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      /* Summary Section */\r\n      .summary-card {\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), rgba(var(--primary-rgb), 0.02));\r\n        border: 1px solid rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n        padding: 20px;\r\n        margin-bottom: 20px;\r\n      }\r\n      .summary-card h4 {\r\n        margin: 0 0 12px 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      .summary-card p {\r\n        margin: 0;\r\n        font-size: 14px;\r\n        line-height: 1.6;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      /* Entities Grid */\r\n      .entities-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\r\n        gap: 12px;\r\n        margin-top: 20px;\r\n      }\r\n      .entity-card {\r\n        background: var(--bg-secondary);\r\n        border-radius: 10px;\r\n        padding: 16px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        transition: background 0.3s ease, transform 0.2s ease;\r\n      }\r\n      .entity-card.updated {\r\n        animation: pulse-highlight 1.5s ease;\r\n      }\r\n      @keyframes pulse-highlight {\r\n        0% { background: rgba(var(--primary-rgb), 0.3); transform: scale(1.02); }\r\n        50% { background: rgba(var(--primary-rgb), 0.15); }\r\n        100% { background: var(--bg-secondary); transform: scale(1); }\r\n      }\r\n      .entity-icon {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 10px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 18px;\r\n      }\r\n      .entity-icon.facts { background: rgba(59, 130, 246, 0.1); }\r\n      .entity-icon.decisions { background: rgba(16, 185, 129, 0.1); }\r\n      .entity-icon.risks { background: rgba(239, 68, 68, 0.1); }\r\n      .entity-icon.actions { background: rgba(245, 158, 11, 0.1); }\r\n      .entity-icon.questions { background: rgba(139, 92, 246, 0.1); }\r\n      .entity-icon.people { background: rgba(6, 182, 212, 0.1); }\r\n      .entity-info h5 {\r\n        margin: 0 0 2px 0;\r\n        font-size: 20px;\r\n        font-weight: 600;\r\n      }\r\n      .entity-info span {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      /* Analysis List */\r\n      .analysis-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      .analysis-item {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 10px;\r\n        transition: all 0.2s;\r\n      }\r\n      .analysis-item:hover {\r\n        background: rgba(var(--primary-rgb), 0.05);\r\n      }\r\n      .analysis-version {\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 8px;\r\n        background: var(--primary);\r\n        color: white;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-weight: 600;\r\n        font-size: 14px;\r\n      }\r\n      .analysis-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .analysis-title {\r\n        font-weight: 500;\r\n        margin-bottom: 4px;\r\n      }\r\n      .analysis-meta {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n        display: flex;\r\n        gap: 12px;\r\n      }\r\n      .analysis-actions {\r\n        display: flex;\r\n        gap: 8px;\r\n      }\r\n      \r\n      /* Activity Timeline */\r\n      .activity-timeline {\r\n        position: relative;\r\n        padding-left: 24px;\r\n      }\r\n      .activity-timeline::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: 8px;\r\n        top: 0;\r\n        bottom: 0;\r\n        width: 2px;\r\n        background: var(--border-color);\r\n      }\r\n      .activity-item {\r\n        position: relative;\r\n        padding: 12px 0 12px 20px;\r\n      }\r\n      .activity-item::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: -20px;\r\n        top: 18px;\r\n        width: 10px;\r\n        height: 10px;\r\n        border-radius: 50%;\r\n        background: var(--primary);\r\n        border: 2px solid var(--bg-primary);\r\n      }\r\n      .activity-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n      .activity-avatar {\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 50%;\r\n        background: var(--bg-secondary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 12px;\r\n      }\r\n      .activity-text {\r\n        flex: 1;\r\n      }\r\n      .activity-text strong {\r\n        font-weight: 500;\r\n      }\r\n      .activity-time {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      /* Versions List */\r\n      .versions-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      .version-item {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 16px;\r\n        padding: 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 10px;\r\n        border: 1px solid transparent;\r\n      }\r\n      .version-item.current {\r\n        border-color: var(--primary);\r\n        background: rgba(var(--primary-rgb), 0.05);\r\n      }\r\n      .version-badge {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 8px;\r\n        background: var(--bg-tertiary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-weight: 600;\r\n        font-size: 14px;\r\n      }\r\n      .version-item.current .version-badge {\r\n        background: var(--primary);\r\n        color: white;\r\n      }\r\n      .version-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .version-title {\r\n        font-weight: 500;\r\n        margin-bottom: 4px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      .version-title .current-tag {\r\n        font-size: 10px;\r\n        padding: 2px 6px;\r\n        background: var(--primary);\r\n        color: white;\r\n        border-radius: 4px;\r\n        text-transform: uppercase;\r\n      }\r\n      .version-notes {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .version-meta {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      .version-ai-summary {\r\n        margin-top: 8px;\r\n        padding: 10px;\r\n        background: rgba(var(--primary-rgb), 0.05);\r\n        border-radius: 6px;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .version-ai-summary strong {\r\n        color: var(--primary);\r\n      }\r\n      \r\n      /* Tags Section */\r\n      .tags-section {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 8px;\r\n        margin-top: 16px;\r\n      }\r\n      .doc-tag {\r\n        padding: 4px 10px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n        font-size: 12px;\r\n        color: var(--primary);\r\n      }\r\n      \r\n      /* Share Panel */\r\n      .share-panel {\r\n        background: var(--bg-secondary);\r\n        border-radius: 12px;\r\n        padding: 20px;\r\n      }\r\n      .share-link-container {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-bottom: 16px;\r\n      }\r\n      .share-link-input {\r\n        flex: 1;\r\n        padding: 10px 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 8px;\r\n        font-size: 13px;\r\n        background: var(--bg-primary);\r\n      }\r\n      .share-options {\r\n        display: grid;\r\n        grid-template-columns: 1fr 1fr;\r\n        gap: 12px;\r\n      }\r\n      .share-option {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 4px;\r\n      }\r\n      .share-option label {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .share-option input, .share-option select {\r\n        padding: 8px 10px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 6px;\r\n        font-size: 13px;\r\n        background: var(--bg-primary);\r\n      }\r\n      \r\n      /* Empty State */\r\n      .empty-section {\r\n        text-align: center;\r\n        padding: 40px 20px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .empty-section svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        opacity: 0.4;\r\n        margin-bottom: 12px;\r\n      }\r\n      \r\n      /* Spinner for button loading state */\r\n      .spinner {\r\n        display: inline-block;\r\n        width: 14px;\r\n        height: 14px;\r\n        border: 2px solid rgba(255,255,255,0.3);\r\n        border-top-color: white;\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n        margin-right: 6px;\r\n        vertical-align: middle;\r\n      }\r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n      #reprocess-btn:disabled {\r\n        opacity: 0.7;\r\n        cursor: wait;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"preview-header\">\r\n      <div class=\"preview-icon\">${getDocIcon(doc.filename || '')}</div>\r\n      <div class=\"preview-title-section\">\r\n        <h3 class=\"preview-title\">${escapeHtml(doc.filename || doc.originalName || 'Untitled')}</h3>\r\n        <div class=\"preview-meta\">\r\n          <span>${formatFileSize(doc.size || 0)}</span>\r\n          <span>${formatRelativeTime(doc.created_at)}</span>\r\n          <span class=\"status-badge status-${doc.status}\">${doc.status}</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"preview-actions\">\r\n        <button class=\"btn btn-favorite ${isFavorite ? 'active' : ''}\" id=\"favorite-btn\" title=\"Favorite\">\r\n          ${isFavorite ? '‚òÖ' : '‚òÜ'}\r\n        </button>\r\n        <button class=\"btn btn-secondary\" id=\"share-btn\">\r\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8\"/>\r\n            <polyline points=\"16 6 12 2 8 6\"/>\r\n            <line x1=\"12\" y1=\"2\" x2=\"12\" y2=\"15\"/>\r\n          </svg>\r\n          Share\r\n        </button>\r\n        <button class=\"btn btn-secondary\" id=\"download-btn\">\r\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n            <polyline points=\"7 10 12 15 17 10\"/>\r\n            <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>\r\n          </svg>\r\n          Download\r\n        </button>\r\n        <button class=\"btn btn-primary\" id=\"reprocess-btn\">\r\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <polyline points=\"23 4 23 10 17 10\"/>\r\n            <path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\r\n          </svg>\r\n          Reprocess\r\n        </button>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"preview-tabs\">\r\n      <button class=\"preview-tab active\" data-tab=\"preview\">Preview</button>\r\n      <button class=\"preview-tab\" data-tab=\"entities\" id=\"entities-tab\" style=\"display:none\">\r\n        Entities\r\n        <span class=\"preview-tab-badge\" id=\"entities-count\">0</span>\r\n      </button>\r\n      <button class=\"preview-tab\" data-tab=\"analysis\">\r\n        AI Analysis\r\n        <span class=\"preview-tab-badge\" id=\"analysis-count\">0</span>\r\n      </button>\r\n      <button class=\"preview-tab\" data-tab=\"notes\" id=\"notes-tab\" style=\"display:none\">\r\n        Meeting Notes\r\n      </button>\r\n      <button class=\"preview-tab\" data-tab=\"versions\">\r\n        Versions\r\n        <span class=\"preview-tab-badge\" id=\"versions-count\">1</span>\r\n      </button>\r\n      <button class=\"preview-tab\" data-tab=\"activity\">Activity</button>\r\n      <button class=\"preview-tab\" data-tab=\"share\">Share</button>\r\n    </div>\r\n    \r\n    <div class=\"preview-content\">\r\n      <!-- Preview Tab -->\r\n      <div class=\"preview-section active\" data-section=\"preview\">\r\n        <div class=\"summary-card\" id=\"summary-card\" style=\"${doc.summary ? '' : 'display:none'}\">\r\n            <h4>\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\"/>\r\n                <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\r\n              </svg>\r\n              AI Summary\r\n            </h4>\r\n            <p id=\"doc-summary\">${doc.summary ? escapeHtml(doc.summary) : ''}</p>\r\n          </div>\r\n        \r\n        <div class=\"entities-grid\" id=\"entities-grid\">\r\n          <div class=\"entity-card\" data-entity=\"facts\">\r\n            <div class=\"entity-icon facts\">üìã</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${doc.facts_count || 0}</h5>\r\n              <span>Facts</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"entity-card\" data-entity=\"decisions\">\r\n            <div class=\"entity-icon decisions\">‚úì</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${(doc as any).decisions_count || 0}</h5>\r\n              <span>Decisions</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"entity-card\" data-entity=\"risks\">\r\n            <div class=\"entity-icon risks\">‚ö†Ô∏è</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${(doc as any).risks_count || 0}</h5>\r\n              <span>Risks</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"entity-card\" data-entity=\"actions\">\r\n            <div class=\"entity-icon actions\">üìå</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${(doc as any).actions_count || 0}</h5>\r\n              <span>Actions</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"entity-card\" data-entity=\"questions\">\r\n            <div class=\"entity-icon questions\">‚ùì</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\">${doc.questions_count || 0}</h5>\r\n              <span>Questions</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"entity-card\" data-entity=\"people\">\r\n            <div class=\"entity-icon people\">üë•</div>\r\n            <div class=\"entity-info\">\r\n              <h5 class=\"entity-count\" id=\"people-count\">${(doc as any).people_count || 0}</h5>\r\n              <span>People</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        ${(doc as any).tags?.length ? `\r\n          <div class=\"tags-section\">\r\n            ${((doc as any).tags as string[]).map(tag => `<span class=\"doc-tag\">#${escapeHtml(tag)}</span>`).join('')}\r\n          </div>\r\n        ` : ''}\r\n        \r\n        <h4 style=\"margin: 24px 0 12px 0; font-size: 14px;\">Content Preview</h4>\r\n        <div class=\"content-preview\" id=\"content-preview\">\r\n          <div class=\"content-loading\">Loading content...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Entities Tab (full extraction results) -->\r\n      <div class=\"preview-section\" data-section=\"entities\">\r\n        <div class=\"entities-full-list\" id=\"entities-full-list\">\r\n          <div class=\"empty-section\">Loading entities...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- AI Analysis Tab -->\r\n      <div class=\"preview-section\" data-section=\"analysis\">\r\n        <div class=\"analysis-list\" id=\"analysis-list\">\r\n          <div class=\"empty-section\">Loading analysis history...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Versions Tab -->\r\n      <div class=\"preview-section\" data-section=\"versions\">\r\n        <div style=\"display: flex; justify-content: flex-end; margin-bottom: 16px;\">\r\n          <button class=\"btn btn-primary\" id=\"upload-version-btn\">\r\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n              <polyline points=\"17 8 12 3 7 8\"/>\r\n              <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\r\n            </svg>\r\n            Upload New Version\r\n          </button>\r\n        </div>\r\n        <div class=\"versions-list\" id=\"versions-list\">\r\n          <div class=\"empty-section\">Loading versions...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Meeting Notes Tab -->\r\n      <div class=\"preview-section\" data-section=\"notes\">\r\n        <div class=\"notes-container\" id=\"notes-container\">\r\n          <div class=\"empty-section\">No meeting notes available</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Activity Tab -->\r\n      <div class=\"preview-section\" data-section=\"activity\">\r\n        <div class=\"activity-timeline\" id=\"activity-timeline\">\r\n          <div class=\"empty-section\">Loading activity...</div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Share Tab -->\r\n      <div class=\"preview-section\" data-section=\"share\">\r\n        <div class=\"share-panel\">\r\n          <h4 style=\"margin: 0 0 16px 0;\">Create Share Link</h4>\r\n          <div class=\"share-link-container\">\r\n            <input type=\"text\" class=\"share-link-input\" id=\"share-link-input\" placeholder=\"Generate a link to share...\" readonly>\r\n            <button class=\"btn btn-primary\" id=\"generate-link-btn\">Generate</button>\r\n            <button class=\"btn btn-secondary\" id=\"copy-link-btn\" style=\"display: none;\">Copy</button>\r\n          </div>\r\n          <div class=\"share-options\">\r\n            <div class=\"share-option\">\r\n              <label>Expires</label>\r\n              <select id=\"share-expires\">\r\n                <option value=\"1d\">1 day</option>\r\n                <option value=\"7d\" selected>7 days</option>\r\n                <option value=\"30d\">30 days</option>\r\n                <option value=\"never\">Never</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"share-option\">\r\n              <label>Max Views</label>\r\n              <input type=\"number\" id=\"share-max-views\" placeholder=\"Unlimited\" min=\"1\">\r\n            </div>\r\n            <div class=\"share-option\">\r\n              <label>Password (optional)</label>\r\n              <input type=\"password\" id=\"share-password\" placeholder=\"No password\">\r\n            </div>\r\n            <div class=\"share-option\">\r\n              <label>Permissions</label>\r\n              <select id=\"share-permissions\">\r\n                <option value=\"view\">View only</option>\r\n                <option value=\"download\">View & Download</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div id=\"active-shares\" style=\"margin-top: 20px;\"></div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind tab events\r\n  content.querySelectorAll('.preview-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      const tabName = tab.getAttribute('data-tab')!;\r\n      switchTab(content, tabName);\r\n    });\r\n  });\r\n\r\n  // Bind action buttons\r\n  content.querySelector('#favorite-btn')?.addEventListener('click', () => toggleFavorite(content, doc));\r\n  content.querySelector('#share-btn')?.addEventListener('click', () => switchTab(content, 'share'));\r\n  content.querySelector('#download-btn')?.addEventListener('click', () => downloadDocument(doc));\r\n  content.querySelector('#reprocess-btn')?.addEventListener('click', () => reprocessDocument(doc, props.onUpdate));\r\n  content.querySelector('#upload-version-btn')?.addEventListener('click', () => uploadNewVersion(doc, content, props.onUpdate));\r\n  content.querySelector('#generate-link-btn')?.addEventListener('click', () => generateShareLink(content, doc));\r\n  content.querySelector('#copy-link-btn')?.addEventListener('click', () => copyShareLink(content));\r\n\r\n  // Load data\r\n  loadContentPreview(content, doc.id);\r\n  loadEntities(content, doc.id);\r\n  loadAnalysisHistory(content, doc.id);\r\n  loadVersions(content, doc.id);\r\n  loadActivity(content, doc.id);\r\n  loadMeetingNotes(content, doc.id);\r\n  checkFavoriteStatus(doc.id).then(fav => {\r\n    isFavorite = fav;\r\n    updateFavoriteButton(content);\r\n  });\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'modal-overlay document-preview-overlay';\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.6);\r\n    backdrop-filter: blur(4px);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 1000;\r\n    animation: fadeIn 0.2s ease-out;\r\n  `;\r\n\r\n  // Create modal container\r\n  const modalContainer = document.createElement('div');\r\n  modalContainer.className = 'modal-container';\r\n  modalContainer.style.cssText = `\r\n    background: var(--bg-primary);\r\n    border-radius: 16px;\r\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\r\n    max-height: 90vh;\r\n    overflow: hidden;\r\n    animation: slideUp 0.3s ease-out;\r\n  `;\r\n\r\n  // Add close button\r\n  const closeBtn = document.createElement('button');\r\n  closeBtn.innerHTML = '√ó';\r\n  closeBtn.style.cssText = `\r\n    position: absolute;\r\n    top: 16px;\r\n    right: 16px;\r\n    width: 32px;\r\n    height: 32px;\r\n    border: none;\r\n    background: rgba(0, 0, 0, 0.1);\r\n    border-radius: 50%;\r\n    font-size: 20px;\r\n    cursor: pointer;\r\n    z-index: 10;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  `;\r\n  closeBtn.onclick = () => closePreviewModal(overlay, props.onClose);\r\n  \r\n  content.style.position = 'relative';\r\n  content.appendChild(closeBtn);\r\n  modalContainer.appendChild(content);\r\n  overlay.appendChild(modalContainer);\r\n\r\n  // Close on backdrop click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      closePreviewModal(overlay, props.onClose);\r\n    }\r\n  });\r\n\r\n  // Close on Escape\r\n  const handleEscape = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      closePreviewModal(overlay, props.onClose);\r\n      document.removeEventListener('keydown', handleEscape);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', handleEscape);\r\n\r\n  document.body.appendChild(overlay);\r\n}\r\n\r\nfunction closePreviewModal(overlay: HTMLElement, onClose?: () => void): void {\r\n  // Clear any active reprocess polling interval\r\n  if (activeReprocessInterval) {\r\n    clearInterval(activeReprocessInterval);\r\n    activeReprocessInterval = null;\r\n  }\r\n  \r\n  overlay.style.animation = 'fadeOut 0.2s ease-out';\r\n  setTimeout(() => {\r\n    overlay.remove();\r\n    onClose?.();\r\n  }, 200);\r\n}\r\n\r\nfunction switchTab(container: HTMLElement, tabName: string): void {\r\n  currentTab = tabName;\r\n  \r\n  container.querySelectorAll('.preview-tab').forEach(t => {\r\n    t.classList.toggle('active', t.getAttribute('data-tab') === tabName);\r\n  });\r\n  \r\n  container.querySelectorAll('.preview-section').forEach(s => {\r\n    s.classList.toggle('active', s.getAttribute('data-section') === tabName);\r\n  });\r\n}\r\n\r\n/**\r\n * Load document content preview\r\n */\r\nasync function loadContentPreview(container: HTMLElement, docId: string): Promise<void> {\r\n  const contentEl = container.querySelector('#content-preview') as HTMLElement;\r\n  \r\n  try {\r\n    // Fetch full document with content\r\n    const response = await http.get<{ document?: { content?: string } } | { content?: string }>(`/api/documents/${docId}`);\r\n    const doc = (response.data as { document?: { content?: string } }).document || response.data;\r\n    const content = doc?.content;\r\n    \r\n    if (content) {\r\n      const truncated = content.length > 5000;\r\n      contentEl.innerHTML = `<pre style=\"white-space: pre-wrap; font-family: inherit; margin: 0;\">${escapeHtml(content.substring(0, 5000))}${truncated ? '\\n\\n... (truncated)' : ''}</pre>`;\r\n    } else {\r\n      contentEl.innerHTML = '<div class=\"content-empty\">No content extracted</div>';\r\n    }\r\n  } catch (err) {\r\n    console.error('[Preview] Failed to load content:', err);\r\n    contentEl.innerHTML = '<div class=\"content-empty\">Failed to load content</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Load full entities from extraction_result\r\n */\r\nasync function loadEntities(container: HTMLElement, docId: string): Promise<void> {\r\n  const listEl = container.querySelector('#entities-full-list') as HTMLElement;\r\n  const entitiesTab = container.querySelector('#entities-tab') as HTMLElement;\r\n  const entitiesCount = container.querySelector('#entities-count') as HTMLElement;\r\n  const peopleCountEl = container.querySelector('#people-count') as HTMLElement;\r\n  \r\n  try {\r\n    const response = await http.get<{ extraction?: { \r\n      entities?: Array<{ id: string; type: string; name: string; confidence?: number }>;\r\n      facts?: Array<{ id: string; content: string; category?: string; confidence?: number }>;\r\n      decisions?: Array<{ id: string; content: string }>;\r\n      action_items?: Array<{ id: string; task: string; owner?: string; status?: string }>;\r\n      questions?: Array<{ id: string; content: string }>;\r\n      risks?: Array<{ id: string; content: string; severity?: string }>;\r\n      participants?: Array<{ name: string; role?: string; organization?: string; contact_id?: string; contact_name?: string }>;\r\n    } }>(`/api/documents/${docId}/extraction`);\r\n    \r\n    const extraction = response.data.extraction;\r\n    if (!extraction) {\r\n      listEl.innerHTML = '<div class=\"empty-section\">No extraction data available</div>';\r\n      return;\r\n    }\r\n    \r\n    const entities = extraction.entities || [];\r\n    const facts = extraction.facts || [];\r\n    const decisions = extraction.decisions || [];\r\n    const actions = extraction.action_items || [];\r\n    const questions = extraction.questions || [];\r\n    const risks = extraction.risks || [];\r\n    const participants = extraction.participants || [];\r\n    \r\n    // Also get Person entities from graph entities\r\n    const personEntities = entities.filter(e => e.type?.toLowerCase() === 'person');\r\n    \r\n    // Merge participants and person entities (deduplicated by name)\r\n    const allPeople = [...participants];\r\n    for (const pe of personEntities) {\r\n      if (!allPeople.some(p => p.name?.toLowerCase() === pe.name?.toLowerCase())) {\r\n        allPeople.push({ name: pe.name, role: undefined, organization: undefined });\r\n      }\r\n    }\r\n    \r\n    // Update people count in the grid\r\n    if (peopleCountEl) {\r\n      peopleCountEl.textContent = String(allPeople.length);\r\n    }\r\n    \r\n    const totalItems = entities.length + facts.length + decisions.length + actions.length + questions.length + risks.length + allPeople.length;\r\n    \r\n    if (totalItems === 0) {\r\n      listEl.innerHTML = '<div class=\"empty-section\">No entities extracted</div>';\r\n      return;\r\n    }\r\n    \r\n    // Show tab\r\n    if (entitiesTab) entitiesTab.style.display = '';\r\n    if (entitiesCount) entitiesCount.textContent = String(totalItems);\r\n    \r\n    // Build HTML\r\n    let html = `<style>\r\n      .entity-section { margin-bottom: 24px; }\r\n      .entity-section-title { \r\n        font-size: 14px; \r\n        font-weight: 600; \r\n        color: var(--text-secondary); \r\n        margin-bottom: 12px; \r\n        text-transform: uppercase;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      .entity-section-count {\r\n        font-size: 11px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        color: var(--primary);\r\n      }\r\n      .entity-item {\r\n        padding: 12px 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .entity-item-type {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-tertiary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .entity-item-content {\r\n        color: var(--text-primary);\r\n      }\r\n      .entity-item-meta {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n        margin-top: 4px;\r\n      }\r\n    </style>`;\r\n    \r\n    // Graph entities\r\n    if (entities.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          üîó Graph Entities\r\n          <span class=\"entity-section-count\">${entities.length}</span>\r\n        </div>\r\n        ${entities.map(e => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-type\">${escapeHtml(e.type)}</div>\r\n            <div class=\"entity-item-content\">${escapeHtml(e.name)}</div>\r\n            ${e.confidence ? `<div class=\"entity-item-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Facts\r\n    if (facts.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          üìã Facts\r\n          <span class=\"entity-section-count\">${facts.length}</span>\r\n        </div>\r\n        ${facts.map(f => `\r\n          <div class=\"entity-item\">\r\n            ${f.category ? `<div class=\"entity-item-type\">${escapeHtml(f.category)}</div>` : ''}\r\n            <div class=\"entity-item-content\">${escapeHtml(f.content)}</div>\r\n            ${f.confidence ? `<div class=\"entity-item-meta\">Confidence: ${Math.round(f.confidence * 100)}%</div>` : ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Decisions\r\n    if (decisions.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          ‚úì Decisions\r\n          <span class=\"entity-section-count\">${decisions.length}</span>\r\n        </div>\r\n        ${decisions.map(d => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-content\">${escapeHtml(d.content)}</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Action Items\r\n    if (actions.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          üìå Action Items\r\n          <span class=\"entity-section-count\">${actions.length}</span>\r\n        </div>\r\n        ${actions.map(a => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-content\">‚òê ${escapeHtml(a.task)}</div>\r\n            ${a.owner ? `<div class=\"entity-item-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\r\n            ${a.status ? `<div class=\"entity-item-meta\">Status: ${escapeHtml(a.status)}</div>` : ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Questions\r\n    if (questions.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          ‚ùì Questions\r\n          <span class=\"entity-section-count\">${questions.length}</span>\r\n        </div>\r\n        ${questions.map(q => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-content\">${escapeHtml(q.content)}</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // Risks\r\n    if (risks.length > 0) {\r\n      html += `<div class=\"entity-section\">\r\n        <div class=\"entity-section-title\">\r\n          ‚ö†Ô∏è Risks\r\n          <span class=\"entity-section-count\">${risks.length}</span>\r\n        </div>\r\n        ${risks.map(r => `\r\n          <div class=\"entity-item\">\r\n            <div class=\"entity-item-content\">${escapeHtml(r.content)}</div>\r\n            ${r.severity ? `<div class=\"entity-item-meta\">Severity: ${escapeHtml(r.severity)}</div>` : ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    // People/Participants\r\n    if (allPeople.length > 0) {\r\n      html += `<div class=\"entity-section\" id=\"people-section\">\r\n        <div class=\"entity-section-title\">\r\n          üë• People\r\n          <span class=\"entity-section-count\">${allPeople.length}</span>\r\n        </div>\r\n        <style>\r\n          .person-item {\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: space-between;\r\n            padding: 12px 16px;\r\n            background: var(--bg-secondary);\r\n            border-radius: 8px;\r\n            margin-bottom: 8px;\r\n            gap: 12px;\r\n          }\r\n          .person-info {\r\n            flex: 1;\r\n            min-width: 0;\r\n          }\r\n          .person-name {\r\n            font-weight: 500;\r\n            color: var(--text-primary);\r\n          }\r\n          .person-role {\r\n            font-size: 12px;\r\n            color: var(--text-tertiary);\r\n            margin-top: 2px;\r\n          }\r\n          .person-linked {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 6px;\r\n            font-size: 12px;\r\n            color: var(--success);\r\n          }\r\n          .person-linked svg {\r\n            width: 14px;\r\n            height: 14px;\r\n          }\r\n          .person-unlinked {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 6px;\r\n          }\r\n          .person-link-btn {\r\n            font-size: 12px;\r\n            padding: 4px 10px;\r\n            border-radius: 4px;\r\n            border: 1px solid var(--border-color);\r\n            background: var(--bg-primary);\r\n            color: var(--text-secondary);\r\n            cursor: pointer;\r\n            transition: all 0.15s ease;\r\n          }\r\n          .person-link-btn:hover {\r\n            border-color: var(--primary);\r\n            color: var(--primary);\r\n            background: rgba(var(--primary-rgb), 0.05);\r\n          }\r\n          .person-create-btn {\r\n            font-size: 12px;\r\n            padding: 4px 10px;\r\n            border-radius: 4px;\r\n            border: none;\r\n            background: var(--primary);\r\n            color: white;\r\n            cursor: pointer;\r\n            transition: all 0.15s ease;\r\n          }\r\n          .person-create-btn:hover {\r\n            opacity: 0.9;\r\n          }\r\n        </style>\r\n        ${allPeople.map((p, idx) => `\r\n          <div class=\"person-item\" data-person-index=\"${idx}\" data-person-name=\"${escapeHtml(p.name || '')}\">\r\n            <div class=\"person-info\">\r\n              <div class=\"person-name\">${escapeHtml(p.name || 'Unknown')}</div>\r\n              ${p.role || p.organization ? `\r\n                <div class=\"person-role\">\r\n                  ${p.role ? escapeHtml(p.role) : ''}${p.role && p.organization ? ' at ' : ''}${p.organization ? escapeHtml(p.organization) : ''}\r\n                </div>\r\n              ` : ''}\r\n            </div>\r\n            ${p.contact_id ? `\r\n              <div class=\"person-linked\">\r\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\r\n                  <polyline points=\"22 4 12 14.01 9 11.01\"/>\r\n                </svg>\r\n                Linked to ${escapeHtml(p.contact_name || 'contact')}\r\n              </div>\r\n            ` : `\r\n              <div class=\"person-unlinked\">\r\n                <button class=\"person-link-btn\" data-action=\"link\" data-name=\"${escapeHtml(p.name || '')}\">\r\n                  Link to Contact\r\n                </button>\r\n                <button class=\"person-create-btn\" data-action=\"create\" data-name=\"${escapeHtml(p.name || '')}\" data-role=\"${escapeHtml(p.role || '')}\" data-org=\"${escapeHtml(p.organization || '')}\">\r\n                  + Create Contact\r\n                </button>\r\n              </div>\r\n            `}\r\n          </div>\r\n        `).join('')}\r\n      </div>`;\r\n    }\r\n    \r\n    listEl.innerHTML = html;\r\n    \r\n    // Setup people link handlers\r\n    setupPeopleLinkHandlers(container, docId);\r\n  } catch (err) {\r\n    listEl.innerHTML = '<div class=\"empty-section\">Failed to load entities</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Setup event handlers for linking people to contacts\r\n */\r\nfunction setupPeopleLinkHandlers(container: HTMLElement, docId: string): void {\r\n  const peopleSection = container.querySelector('#people-section');\r\n  if (!peopleSection) return;\r\n  \r\n  // Get project ID from URL or data attribute\r\n  const projectId = (window as any).currentProjectId || \r\n    document.body.dataset.projectId || \r\n    container.closest('[data-project-id]')?.getAttribute('data-project-id') ||\r\n    '';\r\n  \r\n  // Handle Link to Contact buttons\r\n  peopleSection.querySelectorAll('.person-link-btn').forEach(btn => {\r\n    btn.addEventListener('click', async (e) => {\r\n      e.stopPropagation();\r\n      const personName = (btn as HTMLElement).dataset.name || '';\r\n      await showContactLinkDropdown(btn as HTMLElement, personName, projectId, container, docId);\r\n    });\r\n  });\r\n  \r\n  // Handle Create Contact buttons\r\n  peopleSection.querySelectorAll('.person-create-btn').forEach(btn => {\r\n    btn.addEventListener('click', async (e) => {\r\n      e.stopPropagation();\r\n      const personName = (btn as HTMLElement).dataset.name || '';\r\n      const personRole = (btn as HTMLElement).dataset.role || '';\r\n      const personOrg = (btn as HTMLElement).dataset.org || '';\r\n      \r\n      await createContactFromPerson(personName, personRole, personOrg, projectId, btn as HTMLElement, container, docId);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show dropdown to select existing contact for linking\r\n */\r\nasync function showContactLinkDropdown(\r\n  btnEl: HTMLElement, \r\n  personName: string, \r\n  projectId: string, \r\n  container: HTMLElement, \r\n  docId: string\r\n): Promise<void> {\r\n  // Remove any existing dropdown\r\n  document.querySelectorAll('.contact-link-dropdown').forEach(d => d.remove());\r\n  \r\n  // Create dropdown\r\n  const dropdown = document.createElement('div');\r\n  dropdown.className = 'contact-link-dropdown';\r\n  dropdown.innerHTML = `\r\n    <style>\r\n      .contact-link-dropdown {\r\n        position: absolute;\r\n        z-index: 10000;\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 8px;\r\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\r\n        min-width: 280px;\r\n        max-height: 300px;\r\n        overflow: hidden;\r\n        display: flex;\r\n        flex-direction: column;\r\n      }\r\n      .contact-link-search {\r\n        padding: 12px;\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      .contact-link-search input {\r\n        width: 100%;\r\n        padding: 8px 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 6px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        font-size: 13px;\r\n      }\r\n      .contact-link-search input:focus {\r\n        outline: none;\r\n        border-color: var(--primary);\r\n      }\r\n      .contact-link-list {\r\n        overflow-y: auto;\r\n        max-height: 220px;\r\n        padding: 8px;\r\n      }\r\n      .contact-link-item {\r\n        padding: 10px 12px;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n      }\r\n      .contact-link-item:hover {\r\n        background: var(--bg-secondary);\r\n      }\r\n      .contact-link-avatar {\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, var(--primary), var(--primary-dark, var(--primary)));\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        font-size: 13px;\r\n        font-weight: 500;\r\n      }\r\n      .contact-link-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .contact-link-name {\r\n        font-weight: 500;\r\n        color: var(--text-primary);\r\n        font-size: 13px;\r\n      }\r\n      .contact-link-email {\r\n        font-size: 11px;\r\n        color: var(--text-tertiary);\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n      .contact-link-empty {\r\n        padding: 20px;\r\n        text-align: center;\r\n        color: var(--text-tertiary);\r\n        font-size: 13px;\r\n      }\r\n      .contact-link-loading {\r\n        padding: 20px;\r\n        text-align: center;\r\n        color: var(--text-tertiary);\r\n      }\r\n    </style>\r\n    <div class=\"contact-link-search\">\r\n      <input type=\"text\" placeholder=\"Search contacts...\" autofocus>\r\n    </div>\r\n    <div class=\"contact-link-list\">\r\n      <div class=\"contact-link-loading\">Loading contacts...</div>\r\n    </div>\r\n  `;\r\n  \r\n  // Position dropdown near button\r\n  const rect = btnEl.getBoundingClientRect();\r\n  dropdown.style.position = 'fixed';\r\n  dropdown.style.top = `${rect.bottom + 4}px`;\r\n  dropdown.style.left = `${Math.max(10, rect.left - 100)}px`;\r\n  \r\n  document.body.appendChild(dropdown);\r\n  \r\n  // Focus search input\r\n  const searchInput = dropdown.querySelector('input') as HTMLInputElement;\r\n  searchInput?.focus();\r\n  \r\n  // Load contacts\r\n  try {\r\n    const response = await http.get<{ contacts: Array<{ id: string; name: string; email?: string }> }>(\r\n      `/api/contacts?project_id=${projectId}&limit=100`\r\n    );\r\n    const contacts = response.data.contacts || [];\r\n    \r\n    const listEl = dropdown.querySelector('.contact-link-list') as HTMLElement;\r\n    \r\n    if (contacts.length === 0) {\r\n      listEl.innerHTML = '<div class=\"contact-link-empty\">No contacts found</div>';\r\n    } else {\r\n      renderContactList(listEl, contacts, personName, projectId, container, docId, dropdown);\r\n    }\r\n    \r\n    // Setup search filter\r\n    searchInput?.addEventListener('input', () => {\r\n      const query = searchInput.value.toLowerCase();\r\n      const filtered = contacts.filter(c => \r\n        c.name?.toLowerCase().includes(query) || \r\n        c.email?.toLowerCase().includes(query)\r\n      );\r\n      renderContactList(listEl, filtered, personName, projectId, container, docId, dropdown);\r\n    });\r\n    \r\n  } catch (err) {\r\n    console.error('[People] Failed to load contacts:', err);\r\n    const listEl = dropdown.querySelector('.contact-link-list') as HTMLElement;\r\n    listEl.innerHTML = '<div class=\"contact-link-empty\">Failed to load contacts</div>';\r\n  }\r\n  \r\n  // Close on click outside\r\n  const closeHandler = (e: MouseEvent) => {\r\n    if (!dropdown.contains(e.target as Node) && e.target !== btnEl) {\r\n      dropdown.remove();\r\n      document.removeEventListener('click', closeHandler);\r\n    }\r\n  };\r\n  setTimeout(() => document.addEventListener('click', closeHandler), 100);\r\n  \r\n  // Close on Escape\r\n  const escHandler = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      dropdown.remove();\r\n      document.removeEventListener('keydown', escHandler);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', escHandler);\r\n}\r\n\r\n/**\r\n * Render list of contacts in dropdown\r\n */\r\nfunction renderContactList(\r\n  listEl: HTMLElement,\r\n  contacts: Array<{ id: string; name: string; email?: string }>,\r\n  personName: string,\r\n  projectId: string,\r\n  container: HTMLElement,\r\n  docId: string,\r\n  dropdown: HTMLElement\r\n): void {\r\n  if (contacts.length === 0) {\r\n    listEl.innerHTML = '<div class=\"contact-link-empty\">No matching contacts</div>';\r\n    return;\r\n  }\r\n  \r\n  listEl.innerHTML = contacts.map(c => {\r\n    const initials = (c.name || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();\r\n    return `\r\n      <div class=\"contact-link-item\" data-contact-id=\"${c.id}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n        <div class=\"contact-link-avatar\">${initials}</div>\r\n        <div class=\"contact-link-info\">\r\n          <div class=\"contact-link-name\">${escapeHtml(c.name || 'Unknown')}</div>\r\n          ${c.email ? `<div class=\"contact-link-email\">${escapeHtml(c.email)}</div>` : ''}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }).join('');\r\n  \r\n  // Add click handlers\r\n  listEl.querySelectorAll('.contact-link-item').forEach(item => {\r\n    item.addEventListener('click', async () => {\r\n      const contactId = (item as HTMLElement).dataset.contactId || '';\r\n      const contactName = (item as HTMLElement).dataset.contactName || '';\r\n      \r\n      try {\r\n        await http.post('/api/contacts/link-participant', {\r\n          projectId,\r\n          participantName: personName,\r\n          contactId\r\n        });\r\n        \r\n        toast.success(`Linked \"${personName}\" to ${contactName}`);\r\n        dropdown.remove();\r\n        \r\n        // Reload entities to show updated status\r\n        loadEntities(container, docId);\r\n      } catch (err) {\r\n        console.error('[People] Failed to link:', err);\r\n        toast.error('Failed to link contact');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Create a new contact from a person detected in document\r\n */\r\nasync function createContactFromPerson(\r\n  name: string,\r\n  role: string,\r\n  organization: string,\r\n  projectId: string,\r\n  btnEl: HTMLElement,\r\n  container: HTMLElement,\r\n  docId: string\r\n): Promise<void> {\r\n  const originalText = btnEl.textContent;\r\n  btnEl.textContent = 'Creating...';\r\n  (btnEl as HTMLButtonElement).disabled = true;\r\n  \r\n  try {\r\n    const response = await http.post<{ ok: boolean; contact?: { id: string; name: string }; error?: string }>(\r\n      '/api/contacts',\r\n      {\r\n        project_id: projectId,\r\n        name,\r\n        role: role || undefined,\r\n        organization: organization || undefined,\r\n        source: 'document_extraction'\r\n      }\r\n    );\r\n    \r\n    if (response.data.ok && response.data.contact) {\r\n      toast.success(`Created contact: ${response.data.contact.name}`);\r\n      \r\n      // Reload entities to show updated status\r\n      loadEntities(container, docId);\r\n    } else {\r\n      toast.error(response.data.error || 'Failed to create contact');\r\n      btnEl.textContent = originalText;\r\n      (btnEl as HTMLButtonElement).disabled = false;\r\n    }\r\n  } catch (err) {\r\n    console.error('[People] Failed to create contact:', err);\r\n    toast.error('Failed to create contact');\r\n    btnEl.textContent = originalText;\r\n    (btnEl as HTMLButtonElement).disabled = false;\r\n  }\r\n}\r\n\r\nasync function loadAnalysisHistory(container: HTMLElement, docId: string): Promise<void> {\r\n  const listEl = container.querySelector('#analysis-list') as HTMLElement;\r\n  \r\n  try {\r\n    const response = await http.get<{ analyses: AIAnalysis[] }>(`/api/documents/${docId}/analysis`);\r\n    const analyses = response.data.analyses || [];\r\n    \r\n    container.querySelector('#analysis-count')!.textContent = String(analyses.length);\r\n    \r\n    if (analyses.length === 0) {\r\n      listEl.innerHTML = `\r\n        <div class=\"empty-section\">\r\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n            <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\"/>\r\n            <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\r\n          </svg>\r\n          <p>No AI analyses yet</p>\r\n          <button class=\"btn btn-primary btn-sm\" id=\"run-analysis-btn\">Run Analysis</button>\r\n        </div>\r\n      `;\r\n      \r\n      // Add click handler for Run Analysis button\r\n      const runAnalysisBtn = listEl.querySelector('#run-analysis-btn');\r\n      if (runAnalysisBtn) {\r\n        runAnalysisBtn.addEventListener('click', async () => {\r\n          const btn = runAnalysisBtn as HTMLButtonElement;\r\n          const originalText = btn.textContent;\r\n          btn.disabled = true;\r\n          btn.textContent = 'Analyzing...';\r\n          \r\n          try {\r\n            // Trigger reprocess via API\r\n            const response = await http.post(`/api/documents/${docId}/reprocess`, {});\r\n            if (response.data.success) {\r\n              toast.success('Analysis started');\r\n              // Poll for completion and reload\r\n              setTimeout(() => loadAnalysisHistory(container, docId), 3000);\r\n            } else {\r\n              toast.error(response.data.error || 'Failed to start analysis');\r\n              btn.disabled = false;\r\n              btn.textContent = originalText;\r\n            }\r\n          } catch (err: any) {\r\n            toast.error(err.message || 'Failed to run analysis');\r\n            btn.disabled = false;\r\n            btn.textContent = originalText;\r\n          }\r\n        });\r\n      }\r\n      return;\r\n    }\r\n    \r\n    listEl.innerHTML = analyses.map((a, i) => `\r\n      <div class=\"analysis-item\" data-id=\"${a.id}\">\r\n        <div class=\"analysis-version\">v${analyses.length - i}</div>\r\n        <div class=\"analysis-info\">\r\n          <div class=\"analysis-title\">${capitalizeFirst(a.analysis_type)}</div>\r\n          <div class=\"analysis-meta\">\r\n            <span>${a.provider}/${a.model}</span>\r\n            <span>${a.entities_extracted || 0} entities</span>\r\n            <span>${(a.input_tokens || 0) + (a.output_tokens || 0)} tokens</span>\r\n            ${a.cost ? `<span>$${a.cost.toFixed(4)}</span>` : ''}\r\n          </div>\r\n          <div class=\"analysis-timestamp\" style=\"font-size: 12px; color: var(--text-tertiary, #666); margin-top: 4px;\">\r\n            ${formatDateTime(a.created_at)} (${formatRelativeTime(a.created_at)})\r\n          </div>\r\n        </div>\r\n        <div class=\"analysis-actions\">\r\n          <button class=\"btn btn-sm view-analysis-btn\">View</button>\r\n          <button class=\"btn btn-sm compare-analysis-btn\">Compare</button>\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n    \r\n    // Add click handlers for View buttons\r\n    listEl.querySelectorAll('.view-analysis-btn').forEach((btn, idx) => {\r\n      btn.addEventListener('click', () => {\r\n        const analysis = analyses[idx];\r\n        showAnalysisDetail(container, analysis);\r\n      });\r\n    });\r\n    \r\n    // Add click handlers for Compare buttons\r\n    listEl.querySelectorAll('.compare-analysis-btn').forEach((btn, idx) => {\r\n      btn.addEventListener('click', () => {\r\n        if (analyses.length < 2) {\r\n          toast.info('Need at least 2 analyses to compare');\r\n          return;\r\n        }\r\n        toast.info('Compare feature coming soon');\r\n      });\r\n    });\r\n  } catch {\r\n    listEl.innerHTML = '<div class=\"empty-section\">No analysis history available</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Show analysis detail in a modal overlay\r\n * Fetches extraction_result from the document if not available in analysis\r\n * Uses /extraction endpoint to get enriched participant data with contact linking\r\n */\r\nasync function showAnalysisDetail(container: HTMLElement, analysis: AIAnalysis): Promise<void> {\r\n  // Try to get the full result with enriched participants\r\n  let fullResult = analysis.result;\r\n  if (analysis.document_id) {\r\n    try {\r\n      // Use /extraction endpoint which enriches participants with contact info\r\n      const extractionResponse = await http.get<{ extraction?: Record<string, unknown> }>(`/api/documents/${analysis.document_id}/extraction`);\r\n      if (extractionResponse.data.extraction) {\r\n        fullResult = extractionResponse.data.extraction;\r\n        console.log('[Analysis] Loaded enriched extraction from /extraction endpoint');\r\n      }\r\n    } catch (err) {\r\n      console.warn('[Analysis] Could not load extraction:', err);\r\n      // Fallback to document API\r\n      if (!fullResult) {\r\n        try {\r\n          const docResponse = await http.get<{ document?: { extraction_result?: Record<string, unknown> }, extraction_result?: Record<string, unknown> }>(`/api/documents/${analysis.document_id}`);\r\n          fullResult = docResponse.data.document?.extraction_result || docResponse.data.extraction_result;\r\n        } catch {\r\n          // ignore\r\n        }\r\n      }\r\n    }\r\n  }\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'analysis-detail-overlay';\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.7);\r\n    z-index: 10001;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding: 20px;\r\n  `;\r\n  \r\n  // Format the result JSON nicely\r\n  const resultJson = fullResult \r\n    ? JSON.stringify(fullResult, null, 2) \r\n    : 'No detailed result available';\r\n  \r\n  // Build summary from result if available\r\n  let summary = '';\r\n  let peopleDetected: Array<{\r\n    name: string; \r\n    role?: string; \r\n    organization?: string;\r\n    contact_id?: string;\r\n    contact_name?: string;\r\n    contact_email?: string;\r\n    contact_avatar?: string;\r\n    contact_role?: string;\r\n  }> = [];\r\n  if (fullResult) {\r\n    const r = fullResult as any;\r\n    if (r.summary) summary = r.summary;\r\n    else if (r.meeting?.title) summary = `Meeting: ${r.meeting.title}`;\r\n    \r\n    // Extract people from participants and entities\r\n    const participants = r.participants || [];\r\n    const entities = r.entities || [];\r\n    const personEntities = entities.filter((e: any) => e.type?.toLowerCase() === 'person');\r\n    \r\n    // Merge and deduplicate\r\n    const peopleNames = new Set<string>();\r\n    for (const p of participants) {\r\n      if (p.name && !peopleNames.has(p.name.toLowerCase())) {\r\n        peopleNames.add(p.name.toLowerCase());\r\n        peopleDetected.push({ \r\n          name: p.name, \r\n          role: p.role, \r\n          organization: p.organization,\r\n          contact_id: p.contact_id,\r\n          contact_name: p.contact_name,\r\n          contact_email: p.contact_email,\r\n          contact_avatar: p.contact_avatar,\r\n          contact_role: p.contact_role\r\n        });\r\n      }\r\n    }\r\n    for (const pe of personEntities) {\r\n      if (pe.name && !peopleNames.has(pe.name.toLowerCase())) {\r\n        peopleNames.add(pe.name.toLowerCase());\r\n        peopleDetected.push({ \r\n          name: pe.name,\r\n          contact_id: pe.contact_id,\r\n          contact_name: pe.contact_name,\r\n          contact_email: pe.contact_email,\r\n          contact_avatar: pe.contact_avatar,\r\n          contact_role: pe.contact_role\r\n        });\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Separate linked and unlinked people\r\n  const linkedPeople = peopleDetected.filter(p => p.contact_id);\r\n  const unlinkedPeople = peopleDetected.filter(p => !p.contact_id);\r\n  \r\n  // Build people section HTML with separate linked and unlinked sections\r\n  const peopleSectionHtml = peopleDetected.length > 0 ? `\r\n    <div style=\"margin-bottom: 20px;\">\r\n      <h4 style=\"color: var(--text-primary, #fff); margin: 0 0 12px 0; font-size: 14px; display: flex; align-items: center; gap: 8px;\">\r\n        <span style=\"font-size: 16px;\">üë•</span> People Detected\r\n        <span style=\"font-size: 11px; background: rgba(99, 102, 241, 0.2); color: var(--accent-color, #6366f1); padding: 2px 8px; border-radius: 10px;\">${peopleDetected.length}</span>\r\n        ${linkedPeople.length > 0 ? `<span style=\"font-size: 11px; background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 2px 8px; border-radius: 10px;\">‚úì ${linkedPeople.length} linked</span>` : ''}\r\n      </h4>\r\n      \r\n      ${linkedPeople.length > 0 ? `\r\n        <div style=\"margin-bottom: 16px;\">\r\n          <div style=\"font-size: 11px; color: var(--text-tertiary, #666); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">Linked to Contacts</div>\r\n          <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\r\n            ${linkedPeople.map(p => `\r\n              <div class=\"person-chip linked\" data-name=\"${escapeHtml(p.name)}\" data-contact-id=\"${escapeHtml(p.contact_id || '')}\" data-contact-name=\"${escapeHtml(p.contact_name || '')}\" style=\"\r\n                display: flex;\r\n                align-items: center;\r\n                gap: 10px;\r\n                padding: 8px 14px;\r\n                background: rgba(16, 185, 129, 0.1);\r\n                border: 1px solid rgba(16, 185, 129, 0.3);\r\n                border-radius: 20px;\r\n                cursor: pointer;\r\n                transition: all 0.15s ease;\r\n              \">\r\n                ${p.contact_avatar ? `\r\n                  <img src=\"${escapeHtml(p.contact_avatar)}\" alt=\"\" style=\"width: 32px; height: 32px; border-radius: 50%; object-fit: cover;\">\r\n                ` : `\r\n                  <div style=\"\r\n                    width: 32px;\r\n                    height: 32px;\r\n                    border-radius: 50%;\r\n                    background: linear-gradient(135deg, #10b981, #059669);\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: center;\r\n                    color: white;\r\n                    font-size: 12px;\r\n                    font-weight: 600;\r\n                  \">${(p.contact_name || p.name || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase()}</div>\r\n                `}\r\n                <div style=\"flex: 1; min-width: 0;\">\r\n                  <div style=\"color: var(--text-primary, #fff); font-size: 13px; font-weight: 500; display: flex; align-items: center; gap: 6px;\">\r\n                    ${escapeHtml(p.name)}\r\n                    <svg style=\"width: 14px; height: 14px; color: #10b981; flex-shrink: 0;\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\">\r\n                      <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\r\n                      <polyline points=\"22 4 12 14.01 9 11.01\"/>\r\n                    </svg>\r\n                  </div>\r\n                  <div style=\"color: var(--text-tertiary, #666); font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">\r\n                    ‚Üí ${escapeHtml(p.contact_name || 'Contact')}${p.contact_role ? ` ‚Ä¢ ${escapeHtml(p.contact_role)}` : ''}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      ` : ''}\r\n      \r\n      ${unlinkedPeople.length > 0 ? `\r\n        <div>\r\n          <div style=\"font-size: 11px; color: var(--text-tertiary, #666); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;\">\r\n            ${linkedPeople.length > 0 ? 'Not Yet Linked' : 'Click to Link or Create Contact'}\r\n          </div>\r\n          <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\r\n            ${unlinkedPeople.map(p => `\r\n              <div class=\"person-chip unlinked\" data-name=\"${escapeHtml(p.name)}\" data-role=\"${escapeHtml(p.role || '')}\" data-org=\"${escapeHtml(p.organization || '')}\" style=\"\r\n                display: flex;\r\n                align-items: center;\r\n                gap: 8px;\r\n                padding: 8px 12px;\r\n                background: var(--bg-secondary, #252542);\r\n                border: 1px dashed var(--border-color, #444);\r\n                border-radius: 20px;\r\n                cursor: pointer;\r\n                transition: all 0.15s ease;\r\n              \">\r\n                <div style=\"\r\n                  width: 28px;\r\n                  height: 28px;\r\n                  border-radius: 50%;\r\n                  background: linear-gradient(135deg, var(--accent-color, #6366f1), #8b5cf6);\r\n                  display: flex;\r\n                  align-items: center;\r\n                  justify-content: center;\r\n                  color: white;\r\n                  font-size: 11px;\r\n                  font-weight: 600;\r\n                \">${(p.name || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase()}</div>\r\n                <div>\r\n                  <div style=\"color: var(--text-primary, #fff); font-size: 13px; font-weight: 500;\">${escapeHtml(p.name)}</div>\r\n                  ${p.role || p.organization ? `<div style=\"color: var(--text-tertiary, #666); font-size: 11px;\">${p.role || ''}${p.role && p.organization ? ' ‚Ä¢ ' : ''}${p.organization || ''}</div>` : ''}\r\n                </div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      ` : ''}\r\n      \r\n      <p style=\"color: var(--text-tertiary, #666); font-size: 12px; margin: 12px 0 0 0;\">\r\n        üí° Click on any person to ${linkedPeople.length > 0 ? 'view/change the link' : 'link them to a contact or create a new one'}\r\n      </p>\r\n    </div>\r\n  ` : '';\r\n  \r\n  const content = document.createElement('div');\r\n  content.className = 'analysis-detail-content';\r\n  content.style.cssText = `\r\n    background: var(--bg-primary, #1a1a2e);\r\n    border-radius: 12px;\r\n    max-width: 900px;\r\n    width: 100%;\r\n    max-height: 80vh;\r\n    overflow: hidden;\r\n    display: flex;\r\n    flex-direction: column;\r\n  `;\r\n  \r\n  content.innerHTML = `\r\n    <div style=\"padding: 20px; border-bottom: 1px solid var(--border-color, #333); display: flex; justify-content: space-between; align-items: center;\">\r\n      <div>\r\n        <h3 style=\"margin: 0; color: var(--text-primary, #fff);\">${capitalizeFirst(analysis.analysis_type)} Analysis</h3>\r\n        <p style=\"margin: 4px 0 0; color: var(--text-secondary, #888); font-size: 13px;\">\r\n          ${analysis.provider}/${analysis.model} ‚Ä¢ ${analysis.entities_extracted || 0} entities ‚Ä¢ ${formatRelativeTime(analysis.created_at)}\r\n        </p>\r\n      </div>\r\n      <button class=\"close-analysis-btn\" style=\"background: none; border: none; color: var(--text-secondary, #888); cursor: pointer; font-size: 24px;\">&times;</button>\r\n    </div>\r\n    ${summary ? `\r\n      <div style=\"padding: 16px 20px; background: var(--bg-secondary, #252542); border-bottom: 1px solid var(--border-color, #333);\">\r\n        <strong style=\"color: var(--text-primary, #fff);\">Summary:</strong>\r\n        <p style=\"margin: 8px 0 0; color: var(--text-secondary, #ccc);\">${escapeHtml(summary)}</p>\r\n      </div>\r\n    ` : ''}\r\n    <div style=\"padding: 20px; overflow-y: auto; flex: 1;\">\r\n      <div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;\">\r\n        <div style=\"background: var(--bg-secondary, #252542); padding: 12px; border-radius: 8px; text-align: center;\">\r\n          <div style=\"font-size: 24px; font-weight: bold; color: var(--accent-color, #6366f1);\">${analysis.entities_extracted || 0}</div>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary, #888);\">Entities</div>\r\n        </div>\r\n        <div style=\"background: var(--bg-secondary, #252542); padding: 12px; border-radius: 8px; text-align: center;\">\r\n          <div style=\"font-size: 24px; font-weight: bold; color: var(--accent-color, #6366f1);\">${analysis.input_tokens || 0}</div>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary, #888);\">Input Tokens</div>\r\n        </div>\r\n        <div style=\"background: var(--bg-secondary, #252542); padding: 12px; border-radius: 8px; text-align: center;\">\r\n          <div style=\"font-size: 24px; font-weight: bold; color: var(--accent-color, #6366f1);\">${analysis.output_tokens || 0}</div>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary, #888);\">Output Tokens</div>\r\n        </div>\r\n        <div style=\"background: var(--bg-secondary, #252542); padding: 12px; border-radius: 8px; text-align: center;\">\r\n          <div style=\"font-size: 24px; font-weight: bold; color: var(--accent-color, #6366f1);\">${analysis.latency_ms ? `${(analysis.latency_ms / 1000).toFixed(1)}s` : '-'}</div>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary, #888);\">Latency</div>\r\n        </div>\r\n      </div>\r\n      ${peopleSectionHtml}\r\n      <details style=\"margin-top: 16px;\">\r\n        <summary style=\"cursor: pointer; color: var(--text-primary, #fff); font-weight: 500; padding: 8px 0;\">Raw Result JSON</summary>\r\n        <pre style=\"background: var(--bg-tertiary, #1e1e3f); padding: 16px; border-radius: 8px; overflow-x: auto; font-size: 12px; color: var(--text-secondary, #ccc); max-height: 400px; overflow-y: auto;\">${escapeHtml(resultJson)}</pre>\r\n      </details>\r\n    </div>\r\n  `;\r\n  \r\n  overlay.appendChild(content);\r\n  document.body.appendChild(overlay);\r\n  \r\n  // Close handlers\r\n  const closeBtn = content.querySelector('.close-analysis-btn');\r\n  closeBtn?.addEventListener('click', () => overlay.remove());\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n  \r\n  // Person chip click handlers\r\n  const projectId = (window as any).currentProjectId || \r\n    document.body.dataset.projectId || \r\n    container.closest('[data-project-id]')?.getAttribute('data-project-id') ||\r\n    '';\r\n  \r\n  content.querySelectorAll('.person-chip').forEach(chip => {\r\n    const el = chip as HTMLElement;\r\n    const isLinked = el.classList.contains('linked');\r\n    \r\n    chip.addEventListener('click', async (e) => {\r\n      e.stopPropagation();\r\n      const personName = el.dataset.name || '';\r\n      const personRole = el.dataset.role || '';\r\n      const personOrg = el.dataset.org || '';\r\n      const currentContactId = el.dataset.contactId || '';\r\n      const currentContactName = el.dataset.contactName || '';\r\n      \r\n      await showPersonLinkMenu(el, personName, personRole, personOrg, projectId, currentContactId, currentContactName);\r\n    });\r\n    \r\n    // Hover effect - different for linked/unlinked\r\n    el.addEventListener('mouseenter', () => {\r\n      if (isLinked) {\r\n        el.style.background = 'rgba(16, 185, 129, 0.2)';\r\n        el.style.borderColor = 'rgba(16, 185, 129, 0.5)';\r\n      } else {\r\n        el.style.background = 'var(--bg-tertiary, #1e1e3f)';\r\n        el.style.borderColor = 'var(--accent-color, #6366f1)';\r\n      }\r\n      el.style.transform = 'translateY(-1px)';\r\n    });\r\n    el.addEventListener('mouseleave', () => {\r\n      if (isLinked) {\r\n        el.style.background = 'rgba(16, 185, 129, 0.1)';\r\n        el.style.borderColor = 'rgba(16, 185, 129, 0.3)';\r\n      } else {\r\n        el.style.background = 'var(--bg-secondary, #252542)';\r\n        el.style.borderColor = 'var(--border-color, #444)';\r\n      }\r\n      el.style.transform = 'translateY(0)';\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show menu to link a person to contact or create new\r\n */\r\nasync function showPersonLinkMenu(\r\n  chipEl: HTMLElement,\r\n  personName: string,\r\n  personRole: string,\r\n  personOrg: string,\r\n  projectId: string,\r\n  currentContactId: string = '',\r\n  currentContactName: string = ''\r\n): Promise<void> {\r\n  // Remove any existing menu\r\n  document.querySelectorAll('.person-link-menu').forEach(m => m.remove());\r\n  \r\n  const isLinked = !!currentContactId;\r\n  \r\n  const menu = document.createElement('div');\r\n  menu.className = 'person-link-menu';\r\n  menu.innerHTML = `\r\n    <style>\r\n      .person-link-menu {\r\n        position: fixed;\r\n        z-index: 10002;\r\n        background: var(--bg-primary, #1a1a2e);\r\n        border: 1px solid var(--border-color, #333);\r\n        border-radius: 12px;\r\n        box-shadow: 0 8px 24px rgba(0,0,0,0.3);\r\n        min-width: 320px;\r\n        max-height: 450px;\r\n        overflow: hidden;\r\n        display: flex;\r\n        flex-direction: column;\r\n      }\r\n      .person-link-menu-header {\r\n        padding: 16px;\r\n        border-bottom: 1px solid var(--border-color, #333);\r\n      }\r\n      .person-link-menu-header h4 {\r\n        margin: 0 0 4px 0;\r\n        color: var(--text-primary, #fff);\r\n        font-size: 14px;\r\n      }\r\n      .person-link-menu-header p {\r\n        margin: 0;\r\n        color: var(--text-tertiary, #666);\r\n        font-size: 12px;\r\n      }\r\n      .person-link-menu-current {\r\n        padding: 12px 16px;\r\n        background: rgba(16, 185, 129, 0.1);\r\n        border-bottom: 1px solid var(--border-color, #333);\r\n      }\r\n      .person-link-menu-current-label {\r\n        font-size: 11px;\r\n        color: #10b981;\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .person-link-menu-current-contact {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n        padding: 8px 12px;\r\n        background: var(--bg-secondary, #252542);\r\n        border-radius: 8px;\r\n      }\r\n      .person-link-menu-current-avatar {\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #10b981, #059669);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n      }\r\n      .person-link-menu-current-info {\r\n        flex: 1;\r\n      }\r\n      .person-link-menu-current-name {\r\n        font-weight: 500;\r\n        font-size: 14px;\r\n        color: var(--text-primary, #fff);\r\n      }\r\n      .person-link-menu-current-badge {\r\n        font-size: 11px;\r\n        color: #10b981;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n      }\r\n      .person-link-menu-unlink-btn {\r\n        padding: 6px 12px;\r\n        font-size: 12px;\r\n        background: rgba(239, 68, 68, 0.1);\r\n        color: #ef4444;\r\n        border: 1px solid rgba(239, 68, 68, 0.3);\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .person-link-menu-unlink-btn:hover {\r\n        background: rgba(239, 68, 68, 0.2);\r\n        border-color: rgba(239, 68, 68, 0.5);\r\n      }\r\n      .person-link-menu-divider {\r\n        padding: 8px 16px;\r\n        font-size: 11px;\r\n        color: var(--text-tertiary, #666);\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n        border-bottom: 1px solid var(--border-color, #333);\r\n      }\r\n      .person-link-menu-search {\r\n        padding: 12px 16px;\r\n        border-bottom: 1px solid var(--border-color, #333);\r\n      }\r\n      .person-link-menu-search input {\r\n        width: 100%;\r\n        padding: 10px 12px;\r\n        border: 1px solid var(--border-color, #333);\r\n        border-radius: 8px;\r\n        background: var(--bg-secondary, #252542);\r\n        color: var(--text-primary, #fff);\r\n        font-size: 13px;\r\n      }\r\n      .person-link-menu-search input:focus {\r\n        outline: none;\r\n        border-color: var(--accent-color, #6366f1);\r\n      }\r\n      .person-link-menu-list {\r\n        overflow-y: auto;\r\n        max-height: 180px;\r\n        padding: 8px;\r\n      }\r\n      .person-link-menu-item {\r\n        padding: 10px 12px;\r\n        border-radius: 8px;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n        color: var(--text-primary, #fff);\r\n      }\r\n      .person-link-menu-item:hover {\r\n        background: var(--bg-secondary, #252542);\r\n      }\r\n      .person-link-menu-item.selected {\r\n        background: rgba(16, 185, 129, 0.1);\r\n        border: 1px solid rgba(16, 185, 129, 0.3);\r\n      }\r\n      .person-link-menu-avatar {\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, var(--accent-color, #6366f1), #8b5cf6);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n      }\r\n      .person-link-menu-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .person-link-menu-name {\r\n        font-weight: 500;\r\n        font-size: 13px;\r\n      }\r\n      .person-link-menu-email {\r\n        font-size: 11px;\r\n        color: var(--text-tertiary, #666);\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n      .person-link-menu-actions {\r\n        padding: 12px 16px;\r\n        border-top: 1px solid var(--border-color, #333);\r\n        display: flex;\r\n        gap: 8px;\r\n      }\r\n      .person-link-menu-btn {\r\n        flex: 1;\r\n        padding: 10px;\r\n        border-radius: 8px;\r\n        font-size: 13px;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .person-link-menu-btn.primary {\r\n        background: var(--accent-color, #6366f1);\r\n        color: white;\r\n        border: none;\r\n      }\r\n      .person-link-menu-btn.primary:hover {\r\n        opacity: 0.9;\r\n      }\r\n      .person-link-menu-btn.secondary {\r\n        background: transparent;\r\n        color: var(--text-secondary, #888);\r\n        border: 1px solid var(--border-color, #333);\r\n      }\r\n      .person-link-menu-btn.secondary:hover {\r\n        border-color: var(--text-secondary, #888);\r\n      }\r\n      .person-link-menu-empty {\r\n        padding: 20px;\r\n        text-align: center;\r\n        color: var(--text-tertiary, #666);\r\n        font-size: 13px;\r\n      }\r\n      .person-link-menu-loading {\r\n        padding: 20px;\r\n        text-align: center;\r\n        color: var(--text-tertiary, #666);\r\n      }\r\n    </style>\r\n    <div class=\"person-link-menu-header\">\r\n      <h4>${isLinked ? 'Change Link' : 'Link'} \"${escapeHtml(personName)}\"</h4>\r\n      <p>${isLinked ? 'Change the linked contact or unlink' : 'Select an existing contact or create a new one'}</p>\r\n    </div>\r\n    ${isLinked ? `\r\n      <div class=\"person-link-menu-current\">\r\n        <div class=\"person-link-menu-current-label\">Currently Linked To</div>\r\n        <div class=\"person-link-menu-current-contact\">\r\n          <div class=\"person-link-menu-current-avatar\">${(currentContactName || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase()}</div>\r\n          <div class=\"person-link-menu-current-info\">\r\n            <div class=\"person-link-menu-current-name\">${escapeHtml(currentContactName)}</div>\r\n            <div class=\"person-link-menu-current-badge\">\r\n              <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\">\r\n                <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\r\n                <polyline points=\"22 4 12 14.01 9 11.01\"/>\r\n              </svg>\r\n              Linked\r\n            </div>\r\n          </div>\r\n          <button class=\"person-link-menu-unlink-btn unlink-btn\">Unlink</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"person-link-menu-divider\">Or change to another contact</div>\r\n    ` : ''}\r\n    <div class=\"person-link-menu-search\">\r\n      <input type=\"text\" placeholder=\"Search contacts...\" autofocus>\r\n    </div>\r\n    <div class=\"person-link-menu-list\">\r\n      <div class=\"person-link-menu-loading\">Loading contacts...</div>\r\n    </div>\r\n    <div class=\"person-link-menu-actions\">\r\n      <button class=\"person-link-menu-btn secondary cancel-btn\">Cancel</button>\r\n      <button class=\"person-link-menu-btn primary create-btn\">+ Create New Contact</button>\r\n    </div>\r\n  `;\r\n  \r\n  // Position menu near chip\r\n  const rect = chipEl.getBoundingClientRect();\r\n  menu.style.position = 'fixed';\r\n  menu.style.top = `${Math.min(rect.bottom + 8, window.innerHeight - 420)}px`;\r\n  menu.style.left = `${Math.min(rect.left, window.innerWidth - 320)}px`;\r\n  \r\n  document.body.appendChild(menu);\r\n  \r\n  // Focus search input\r\n  const searchInput = menu.querySelector('input') as HTMLInputElement;\r\n  searchInput?.focus();\r\n  \r\n  // Load contacts\r\n  try {\r\n    const response = await http.get<{ contacts: Array<{ id: string; name: string; email?: string }> }>(\r\n      `/api/contacts?project_id=${projectId}&limit=100`\r\n    );\r\n    const contacts = response.data.contacts || [];\r\n    \r\n    const listEl = menu.querySelector('.person-link-menu-list') as HTMLElement;\r\n    \r\n    const renderContacts = (filtered: typeof contacts) => {\r\n      if (filtered.length === 0) {\r\n        listEl.innerHTML = '<div class=\"person-link-menu-empty\">No matching contacts</div>';\r\n        return;\r\n      }\r\n      \r\n      listEl.innerHTML = filtered.map(c => {\r\n        const initials = (c.name || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();\r\n        const avatar = (c as any).avatar_url || (c as any).photo_url || '';\r\n        const role = (c as any).role || '';\r\n        return `\r\n          <div class=\"person-link-menu-item\" \r\n               data-contact-id=\"${c.id}\" \r\n               data-contact-name=\"${escapeHtml(c.name || '')}\"\r\n               data-contact-email=\"${escapeHtml(c.email || '')}\"\r\n               data-contact-avatar=\"${escapeHtml(avatar)}\"\r\n               data-contact-role=\"${escapeHtml(role)}\">\r\n            ${avatar ? `\r\n              <img src=\"${escapeHtml(avatar)}\" alt=\"\" class=\"person-link-menu-avatar\" style=\"width: 32px; height: 32px; border-radius: 50%; object-fit: cover;\">\r\n            ` : `\r\n              <div class=\"person-link-menu-avatar\">${initials}</div>\r\n            `}\r\n            <div class=\"person-link-menu-info\">\r\n              <div class=\"person-link-menu-name\">${escapeHtml(c.name || 'Unknown')}</div>\r\n              ${role ? `<div class=\"person-link-menu-email\">${escapeHtml(role)}</div>` : ''}\r\n              ${c.email ? `<div class=\"person-link-menu-email\">${escapeHtml(c.email)}</div>` : ''}\r\n            </div>\r\n          </div>\r\n        `;\r\n      }).join('');\r\n      \r\n      // Add click handlers\r\n      listEl.querySelectorAll('.person-link-menu-item').forEach(item => {\r\n        item.addEventListener('click', async () => {\r\n          const contactId = (item as HTMLElement).dataset.contactId || '';\r\n          const contactName = (item as HTMLElement).dataset.contactName || '';\r\n          const contactEmail = (item as HTMLElement).dataset.contactEmail || '';\r\n          const contactAvatar = (item as HTMLElement).dataset.contactAvatar || '';\r\n          const contactRole = (item as HTMLElement).dataset.contactRole || '';\r\n          \r\n          try {\r\n            await http.post('/api/contacts/link-participant', {\r\n              projectId,\r\n              participantName: personName,\r\n              contactId\r\n            });\r\n            \r\n            toast.success(`Linked \"${personName}\" to ${contactName}`);\r\n            menu.remove();\r\n            \r\n            // Transform chip to show linked status with contact info\r\n            updateChipToLinked(chipEl, personName, contactId, contactName, contactEmail, contactAvatar, contactRole);\r\n          } catch (err) {\r\n            console.error('[People] Failed to link:', err);\r\n            toast.error('Failed to link contact');\r\n          }\r\n        });\r\n      });\r\n    };\r\n    \r\n    renderContacts(contacts);\r\n    \r\n    // Search filter\r\n    searchInput?.addEventListener('input', () => {\r\n      const query = searchInput.value.toLowerCase();\r\n      const filtered = contacts.filter(c => \r\n        c.name?.toLowerCase().includes(query) || \r\n        c.email?.toLowerCase().includes(query)\r\n      );\r\n      renderContacts(filtered);\r\n    });\r\n    \r\n  } catch (err) {\r\n    console.error('[People] Failed to load contacts:', err);\r\n    const listEl = menu.querySelector('.person-link-menu-list') as HTMLElement;\r\n    listEl.innerHTML = '<div class=\"person-link-menu-empty\">Failed to load contacts</div>';\r\n  }\r\n  \r\n  // Cancel button\r\n  menu.querySelector('.cancel-btn')?.addEventListener('click', () => menu.remove());\r\n  \r\n  // Unlink button (only if currently linked)\r\n  menu.querySelector('.unlink-btn')?.addEventListener('click', async () => {\r\n    try {\r\n      await http.post('/api/contacts/unlink-participant', {\r\n        projectId,\r\n        participantName: personName\r\n      });\r\n      \r\n      toast.success(`Unlinked \"${personName}\"`);\r\n      menu.remove();\r\n      \r\n      // Transform chip back to unlinked state\r\n      updateChipToUnlinked(chipEl, personName, personRole, personOrg);\r\n    } catch (err) {\r\n      console.error('[People] Failed to unlink:', err);\r\n      toast.error('Failed to unlink contact');\r\n    }\r\n  });\r\n  \r\n  // Create new contact button\r\n  menu.querySelector('.create-btn')?.addEventListener('click', async () => {\r\n    try {\r\n      const response = await http.post<{ ok: boolean; contact?: { id: string; name: string; role?: string; avatar_url?: string }; error?: string }>(\r\n        '/api/contacts',\r\n        {\r\n          project_id: projectId,\r\n          name: personName,\r\n          role: personRole || undefined,\r\n          organization: personOrg || undefined,\r\n          source: 'document_extraction'\r\n        }\r\n      );\r\n      \r\n      if (response.data.ok && response.data.contact) {\r\n        toast.success(`Created contact: ${response.data.contact.name}`);\r\n        menu.remove();\r\n        \r\n        // Transform chip to show linked status\r\n        updateChipToLinked(\r\n          chipEl, \r\n          personName, \r\n          response.data.contact.id, \r\n          response.data.contact.name,\r\n          '',\r\n          response.data.contact.avatar_url || '',\r\n          response.data.contact.role || personRole\r\n        );\r\n      } else {\r\n        toast.error(response.data.error || 'Failed to create contact');\r\n      }\r\n    } catch (err) {\r\n      console.error('[People] Failed to create contact:', err);\r\n      toast.error('Failed to create contact');\r\n    }\r\n  });\r\n  \r\n  // Close on click outside\r\n  const closeHandler = (e: MouseEvent) => {\r\n    if (!menu.contains(e.target as Node) && e.target !== chipEl) {\r\n      menu.remove();\r\n      document.removeEventListener('click', closeHandler);\r\n    }\r\n  };\r\n  setTimeout(() => document.addEventListener('click', closeHandler), 100);\r\n  \r\n  // Close on Escape\r\n  const escHandler = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      menu.remove();\r\n      document.removeEventListener('keydown', escHandler);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', escHandler);\r\n}\r\n\r\n/**\r\n * Update a person chip to show unlinked status\r\n */\r\nfunction updateChipToUnlinked(\r\n  chipEl: HTMLElement,\r\n  personName: string,\r\n  personRole: string,\r\n  personOrg: string\r\n): void {\r\n  const initials = (personName || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();\r\n  \r\n  chipEl.classList.remove('linked');\r\n  chipEl.classList.add('unlinked');\r\n  delete chipEl.dataset.contactId;\r\n  delete chipEl.dataset.contactName;\r\n  \r\n  chipEl.style.cssText = `\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n    padding: 8px 12px;\r\n    background: var(--bg-secondary, #252542);\r\n    border: 1px dashed var(--border-color, #444);\r\n    border-radius: 20px;\r\n    cursor: pointer;\r\n    transition: all 0.15s ease;\r\n  `;\r\n  \r\n  chipEl.innerHTML = `\r\n    <div style=\"\r\n      width: 28px;\r\n      height: 28px;\r\n      border-radius: 50%;\r\n      background: linear-gradient(135deg, var(--accent-color, #6366f1), #8b5cf6);\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      color: white;\r\n      font-size: 11px;\r\n      font-weight: 600;\r\n    \">${initials}</div>\r\n    <div>\r\n      <div style=\"color: var(--text-primary, #fff); font-size: 13px; font-weight: 500;\">${escapeHtml(personName)}</div>\r\n      ${personRole || personOrg ? `<div style=\"color: var(--text-tertiary, #666); font-size: 11px;\">${personRole || ''}${personRole && personOrg ? ' ‚Ä¢ ' : ''}${personOrg || ''}</div>` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Update a person chip to show linked status with contact info\r\n */\r\nfunction updateChipToLinked(\r\n  chipEl: HTMLElement,\r\n  personName: string,\r\n  contactId: string,\r\n  contactName: string,\r\n  contactEmail: string,\r\n  contactAvatar: string,\r\n  contactRole: string\r\n): void {\r\n  const initials = (contactName || personName || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();\r\n  \r\n  chipEl.classList.remove('unlinked');\r\n  chipEl.classList.add('linked');\r\n  chipEl.dataset.contactId = contactId;\r\n  chipEl.dataset.contactName = contactName;\r\n  \r\n  chipEl.style.cssText = `\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 10px;\r\n    padding: 8px 14px;\r\n    background: rgba(16, 185, 129, 0.1);\r\n    border: 1px solid rgba(16, 185, 129, 0.3);\r\n    border-radius: 20px;\r\n    cursor: pointer;\r\n    transition: all 0.15s ease;\r\n  `;\r\n  \r\n  chipEl.innerHTML = `\r\n    ${contactAvatar ? `\r\n      <img src=\"${escapeHtml(contactAvatar)}\" alt=\"\" style=\"width: 32px; height: 32px; border-radius: 50%; object-fit: cover;\">\r\n    ` : `\r\n      <div style=\"\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #10b981, #059669);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n      \">${initials}</div>\r\n    `}\r\n    <div style=\"flex: 1; min-width: 0;\">\r\n      <div style=\"color: var(--text-primary, #fff); font-size: 13px; font-weight: 500; display: flex; align-items: center; gap: 6px;\">\r\n        ${escapeHtml(personName)}\r\n        <svg style=\"width: 14px; height: 14px; color: #10b981; flex-shrink: 0;\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\">\r\n          <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\r\n          <polyline points=\"22 4 12 14.01 9 11.01\"/>\r\n        </svg>\r\n      </div>\r\n      <div style=\"color: var(--text-tertiary, #666); font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">\r\n        ‚Üí ${escapeHtml(contactName)}${contactRole ? ` ‚Ä¢ ${escapeHtml(contactRole)}` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nasync function loadVersions(container: HTMLElement, docId: string): Promise<void> {\r\n  const listEl = container.querySelector('#versions-list') as HTMLElement;\r\n  \r\n  try {\r\n    const response = await http.get<{ versions: DocumentVersion[] }>(`/api/documents/${docId}/versions`);\r\n    const versions = response.data.versions || [];\r\n    \r\n    container.querySelector('#versions-count')!.textContent = String(versions.length || 1);\r\n    \r\n    if (versions.length === 0) {\r\n      listEl.innerHTML = `\r\n        <div class=\"version-item current\">\r\n          <div class=\"version-badge\">v1</div>\r\n          <div class=\"version-info\">\r\n            <div class=\"version-title\">Current Version <span class=\"current-tag\">Current</span></div>\r\n            <div class=\"version-notes\">Initial upload</div>\r\n          </div>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n    \r\n    listEl.innerHTML = versions.map(v => `\r\n      <div class=\"version-item ${v.is_current ? 'current' : ''}\" data-id=\"${v.id}\">\r\n        <div class=\"version-badge\">v${v.version_number}</div>\r\n        <div class=\"version-info\">\r\n          <div class=\"version-title\">\r\n            ${escapeHtml(v.filename)}\r\n            ${v.is_current ? '<span class=\"current-tag\">Current</span>' : ''}\r\n          </div>\r\n          ${v.change_notes ? `<div class=\"version-notes\">\"${escapeHtml(v.change_notes)}\"</div>` : ''}\r\n          <div class=\"version-meta\">\r\n            ${formatFileSize(v.file_size)} ‚Ä¢ ${formatRelativeTime(v.created_at)}\r\n          </div>\r\n          ${v.ai_change_summary ? `\r\n            <div class=\"version-ai-summary\">\r\n              <strong>AI:</strong> ${escapeHtml(v.ai_change_summary)}\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n        <div class=\"version-actions\" style=\"display: flex; gap: 8px;\">\r\n          <button class=\"btn btn-sm view-version-btn\">View</button>\r\n          ${!v.is_current ? '<button class=\"btn btn-sm restore-version-btn\">Restore</button>' : ''}\r\n          ${v.version_number > 1 ? '<button class=\"btn btn-sm diff-version-btn\">Diff</button>' : ''}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } catch {\r\n    listEl.innerHTML = '<div class=\"empty-section\">Version history not available</div>';\r\n  }\r\n}\r\n\r\nasync function loadActivity(container: HTMLElement, docId: string): Promise<void> {\r\n  const timelineEl = container.querySelector('#activity-timeline') as HTMLElement;\r\n  \r\n  try {\r\n    const response = await http.get<{ activities: DocumentActivity[] }>(`/api/documents/${docId}/activity`);\r\n    const activities = response.data.activities || [];\r\n    \r\n    if (activities.length === 0) {\r\n      timelineEl.innerHTML = '<div class=\"empty-section\">No activity recorded</div>';\r\n      return;\r\n    }\r\n    \r\n    timelineEl.innerHTML = activities.map(a => `\r\n      <div class=\"activity-item\">\r\n        <div class=\"activity-content\">\r\n          <div class=\"activity-avatar\">\r\n            ${a.user_avatar ? `<img src=\"${a.user_avatar}\" alt=\"\">` : getInitials(a.user_name || 'System')}\r\n          </div>\r\n          <div class=\"activity-text\">\r\n            <strong>${escapeHtml(a.user_name || 'System')}</strong> ${getActionText(a.action)}\r\n          </div>\r\n          <div class=\"activity-time\">${formatRelativeTime(a.created_at)}</div>\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } catch {\r\n    timelineEl.innerHTML = '<div class=\"empty-section\">Activity not available</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Load meeting notes (v1.6 notes_rendered_text from extraction)\r\n */\r\nasync function loadMeetingNotes(container: HTMLElement, docId: string): Promise<void> {\r\n  const notesContainer = container.querySelector('#notes-container') as HTMLElement;\r\n  const notesTab = container.querySelector('#notes-tab') as HTMLElement;\r\n  \r\n  try {\r\n    // Fetch extraction data to get notes_rendered_text\r\n    const response = await http.get<{ extraction?: { notes_rendered_text?: string; notes?: { key_points?: unknown[]; outline?: unknown[] } } }>(`/api/documents/${docId}/extraction`);\r\n    const extraction = response.data.extraction;\r\n    \r\n    // Check if notes exist\r\n    const hasNotes = extraction?.notes_rendered_text || (extraction?.notes?.key_points?.length || 0) > 0;\r\n    \r\n    if (!hasNotes) {\r\n      // Hide notes tab if no notes\r\n      if (notesTab) notesTab.style.display = 'none';\r\n      return;\r\n    }\r\n    \r\n    // Show notes tab\r\n    if (notesTab) notesTab.style.display = '';\r\n    \r\n    // Render notes\r\n    const notesText = extraction?.notes_rendered_text || '';\r\n    const notes = extraction?.notes;\r\n    \r\n    if (notesText) {\r\n      // Render with rich formatting\r\n      notesContainer.innerHTML = `\r\n        <style>\r\n          .notes-rendered {\r\n            padding: 20px;\r\n            background: var(--bg-secondary);\r\n            border-radius: 12px;\r\n            line-height: 1.7;\r\n          }\r\n          .notes-header {\r\n            font-size: 18px;\r\n            font-weight: 600;\r\n            margin-bottom: 4px;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 8px;\r\n          }\r\n          .notes-meta {\r\n            font-size: 13px;\r\n            color: var(--text-secondary);\r\n            margin-bottom: 20px;\r\n            padding-bottom: 16px;\r\n            border-bottom: 1px solid var(--border-color);\r\n          }\r\n          .notes-topic {\r\n            margin-bottom: 20px;\r\n          }\r\n          .notes-topic-title {\r\n            font-size: 15px;\r\n            font-weight: 600;\r\n            color: var(--text-primary);\r\n            margin-bottom: 10px;\r\n            padding-left: 8px;\r\n            border-left: 3px solid var(--primary);\r\n          }\r\n          .notes-bullet {\r\n            padding: 10px 12px;\r\n            background: var(--bg-primary);\r\n            border-radius: 8px;\r\n            margin-bottom: 8px;\r\n            font-size: 14px;\r\n            color: var(--text-primary);\r\n            line-height: 1.6;\r\n          }\r\n          .notes-bullet:last-child {\r\n            margin-bottom: 0;\r\n          }\r\n          .notes-actions {\r\n            margin-top: 20px;\r\n            padding-top: 16px;\r\n            border-top: 1px solid var(--border-color);\r\n            display: flex;\r\n            gap: 8px;\r\n          }\r\n        </style>\r\n        <div class=\"notes-rendered\">\r\n          ${renderNotesAsHtml(notesText)}\r\n          <div class=\"notes-actions\">\r\n            <button class=\"btn btn-secondary btn-sm\" id=\"copy-notes-btn\">\r\n              üìã Copy Notes\r\n            </button>\r\n          </div>\r\n        </div>\r\n      `;\r\n      \r\n      // Add copy handler\r\n      container.querySelector('#copy-notes-btn')?.addEventListener('click', () => {\r\n        navigator.clipboard.writeText(notesText);\r\n        toast.success('Notes copied to clipboard');\r\n      });\r\n    } else if (notes) {\r\n      // Fallback: render from structured notes\r\n      const keyPoints = (notes.key_points as Array<{ text: string }>)?.map(kp => `‚Ä¢ ${kp.text}`).join('\\n') || '';\r\n      const outline = (notes.outline as Array<{ topic: string; bullets: Array<{ text: string }> }>)?.map(\r\n        o => `**${o.topic}**\\n${o.bullets?.map(b => `  ‚Ä¢ ${b.text}`).join('\\n') || ''}`\r\n      ).join('\\n\\n') || '';\r\n      \r\n      notesContainer.innerHTML = `\r\n        <div class=\"notes-structured\">\r\n          ${keyPoints ? `<div class=\"notes-section\"><h4>Key Points</h4><pre style=\"white-space: pre-wrap;\">${escapeHtml(keyPoints)}</pre></div>` : ''}\r\n          ${outline ? `<div class=\"notes-section\"><h4>Outline</h4><pre style=\"white-space: pre-wrap;\">${escapeHtml(outline)}</pre></div>` : ''}\r\n        </div>\r\n      `;\r\n    }\r\n  } catch {\r\n    notesContainer.innerHTML = '<div class=\"empty-section\">Meeting notes not available</div>';\r\n    if (notesTab) notesTab.style.display = 'none';\r\n  }\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Render notes_rendered_text as styled HTML\r\n * Parses the text format:\r\n * - üìù GodMode Notes (header)\r\n * - üïû Started at... (meta)\r\n * - Topic Name (topic titles - lines without leading -)\r\n * - - Bullet text (bullets - lines starting with -)\r\n */\r\nfunction renderNotesAsHtml(text: string): string {\r\n  const lines = text.split('\\n');\r\n  let html = '';\r\n  let currentTopic = '';\r\n  let bulletsHtml = '';\r\n  let headerDone = false;\r\n  let metaDone = false;\r\n  \r\n  const flushTopic = () => {\r\n    if (currentTopic && bulletsHtml) {\r\n      html += `\r\n        <div class=\"notes-topic\">\r\n          <div class=\"notes-topic-title\">${escapeHtml(currentTopic)}</div>\r\n          ${bulletsHtml}\r\n        </div>\r\n      `;\r\n    }\r\n    currentTopic = '';\r\n    bulletsHtml = '';\r\n  };\r\n  \r\n  for (const line of lines) {\r\n    const trimmed = line.trim();\r\n    if (!trimmed) continue;\r\n    \r\n    // Header line (üìù GodMode Notes)\r\n    if (!headerDone && trimmed.startsWith('üìù')) {\r\n      html += `<div class=\"notes-header\">${escapeHtml(trimmed)}</div>`;\r\n      headerDone = true;\r\n      continue;\r\n    }\r\n    \r\n    // Meta line (üïû Started at...)\r\n    if (!metaDone && trimmed.startsWith('üïû')) {\r\n      html += `<div class=\"notes-meta\">${escapeHtml(trimmed)}</div>`;\r\n      metaDone = true;\r\n      continue;\r\n    }\r\n    \r\n    // Bullet line (starts with -)\r\n    if (trimmed.startsWith('-')) {\r\n      const bulletText = trimmed.substring(1).trim();\r\n      bulletsHtml += `<div class=\"notes-bullet\">${escapeHtml(bulletText)}</div>`;\r\n      continue;\r\n    }\r\n    \r\n    // Topic title (any other non-empty line)\r\n    flushTopic();\r\n    currentTopic = trimmed;\r\n  }\r\n  \r\n  // Flush last topic\r\n  flushTopic();\r\n  \r\n  // If no structured content found, fallback to pre\r\n  if (!html.includes('notes-topic')) {\r\n    return `<pre style=\"white-space: pre-wrap; font-family: inherit; margin: 0; line-height: 1.6;\">${escapeHtml(text)}</pre>`;\r\n  }\r\n  \r\n  return html;\r\n}\r\n\r\nasync function checkFavoriteStatus(docId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.get<{ is_favorite: boolean }>(`/api/documents/${docId}/favorite`);\r\n    return response.data.is_favorite || false;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction updateFavoriteButton(container: HTMLElement): void {\r\n  const btn = container.querySelector('#favorite-btn') as HTMLButtonElement;\r\n  if (btn) {\r\n    btn.classList.toggle('active', isFavorite);\r\n    btn.innerHTML = isFavorite ? '‚òÖ' : '‚òÜ';\r\n  }\r\n}\r\n\r\nasync function toggleFavorite(container: HTMLElement, doc: Document): Promise<void> {\r\n  try {\r\n    await http.post(`/api/documents/${doc.id}/favorite`);\r\n    isFavorite = !isFavorite;\r\n    updateFavoriteButton(container);\r\n    toast.success(isFavorite ? 'Added to favorites' : 'Removed from favorites');\r\n  } catch {\r\n    toast.error('Failed to update favorite');\r\n  }\r\n}\r\n\r\nfunction downloadDocument(doc: Document): void {\r\n  window.open(`/api/documents/${doc.id}/download`, '_blank');\r\n}\r\n\r\n/**\r\n * Refresh modal content after reprocessing\r\n * Updates counters, summary, content preview and reloads AI Analysis tab\r\n */\r\nasync function refreshModalContent(container: HTMLElement, docId: string): Promise<void> {\r\n  try {\r\n    // 1. Fetch updated document data\r\n    const response = await http.get<Document>(`/api/documents/${docId}`);\r\n    const updatedDoc = response.data;\r\n    \r\n    // 2. Update entity counters\r\n    const entityTypes = ['facts', 'decisions', 'risks', 'actions', 'questions'];\r\n    for (const type of entityTypes) {\r\n      const card = container.querySelector(`[data-entity=\"${type}\"]`);\r\n      if (card) {\r\n        const countEl = card.querySelector('.entity-count');\r\n        if (countEl) {\r\n          const count = (updatedDoc as any)[`${type}_count`] || 0;\r\n          countEl.textContent = String(count);\r\n          \r\n          // Add highlight animation\r\n          card.classList.add('updated');\r\n          setTimeout(() => card.classList.remove('updated'), 1500);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // 3. Update summary\r\n    const summaryCard = container.querySelector('#summary-card') as HTMLElement;\r\n    const summaryEl = container.querySelector('#doc-summary');\r\n    if (summaryCard && summaryEl) {\r\n      if (updatedDoc.summary) {\r\n        summaryCard.style.display = '';\r\n        summaryEl.textContent = updatedDoc.summary;\r\n      } else {\r\n        summaryCard.style.display = 'none';\r\n      }\r\n    }\r\n    \r\n    // 4. Update content preview\r\n    const contentPreview = container.querySelector('#content-preview');\r\n    if (contentPreview && updatedDoc.content) {\r\n      const truncated = updatedDoc.content.length > 5000;\r\n      contentPreview.innerHTML = escapeHtml(updatedDoc.content.substring(0, 5000)) + \r\n        (truncated ? '\\n\\n... (truncated)' : '');\r\n    }\r\n    \r\n    // 5. Update status badge in header\r\n    const statusBadge = container.querySelector('.status-chip');\r\n    if (statusBadge) {\r\n      statusBadge.className = `status-chip ${updatedDoc.status}`;\r\n      statusBadge.textContent = capitalizeFirst(updatedDoc.status);\r\n    }\r\n    \r\n    // 6. Reload AI Analysis tab\r\n    loadAnalysisHistory(container, docId);\r\n    \r\n    // 7. Reload Activity tab\r\n    loadActivity(container, docId);\r\n    \r\n    console.log('[Modal] Refreshed content for document:', docId);\r\n  } catch (err) {\r\n    console.error('[Modal] Failed to refresh content:', err);\r\n  }\r\n}\r\n\r\nasync function reprocessDocument(doc: Document, onUpdate?: () => void): Promise<void> {\r\n  const reprocessBtn = document.querySelector('#reprocess-btn') as HTMLButtonElement;\r\n  const modalContainer = document.querySelector('.document-preview-modal') as HTMLElement;\r\n  const originalBtnContent = reprocessBtn?.innerHTML || '';\r\n  \r\n  try {\r\n    // Step 1: Check hash and existing entities\r\n    if (reprocessBtn) {\r\n      reprocessBtn.disabled = true;\r\n      reprocessBtn.innerHTML = `<span class=\"spinner\"></span> Checking...`;\r\n    }\r\n    \r\n    const checkResponse = await http.get<{\r\n      hash_match: boolean;\r\n      existing_entities: Record<string, number>;\r\n      total_entities: number;\r\n      current_hash: string;\r\n      has_content: boolean;\r\n    }>(`/api/documents/${doc.id}/reprocess/check`);\r\n    \r\n    const check = checkResponse.data;\r\n    \r\n    if (!check.has_content) {\r\n      toast.error('No content available for reprocessing');\r\n      return;\r\n    }\r\n    \r\n    // Step 2: Confirm if hash matches or has existing entities\r\n    let shouldProceed = true;\r\n    \r\n    if (check.hash_match || check.total_entities > 0) {\r\n      const hashMsg = check.hash_match ? 'Content has not changed since last processing.\\n' : '';\r\n      const entitiesMsg = check.total_entities > 0 \r\n        ? `There are ${check.total_entities} extracted entities that will be replaced.\\n` \r\n        : '';\r\n      \r\n      shouldProceed = confirm(\r\n        `${hashMsg}${entitiesMsg}\\nAre you sure you want to reprocess?\\n\\nThis will:\\n- Remove all existing entities from this document\\n- Create new entities with AI analysis\\n- Use AI tokens`\r\n      );\r\n    }\r\n    \r\n    if (!shouldProceed) {\r\n      toast.info('Reprocessing cancelled');\r\n      return;\r\n    }\r\n    \r\n    // Step 3: Start reprocessing with progress feedback\r\n    if (reprocessBtn) {\r\n      reprocessBtn.innerHTML = `<span class=\"spinner\"></span> Processing...`;\r\n    }\r\n    toast.info('Reprocessing started...');\r\n    \r\n    await http.post(`/api/documents/${doc.id}/reprocess`, { force: true });\r\n    \r\n    // Step 4: Poll for completion\r\n    let attempts = 0;\r\n    const maxAttempts = 60; // 2 minutes max\r\n    \r\n    const pollStatus = async () => {\r\n      attempts++;\r\n      \r\n      try {\r\n        const statusResponse = await http.get<{ status: string }>(`/api/documents/${doc.id}`);\r\n        const status = statusResponse.data.status;\r\n        \r\n        if (status === 'processed') {\r\n          toast.success('Document reprocessed successfully!');\r\n          // Refresh modal content with updated data\r\n          if (modalContainer) {\r\n            await refreshModalContent(modalContainer, doc.id);\r\n          }\r\n          onUpdate?.();\r\n          return true;\r\n        } else if (status === 'failed') {\r\n          toast.error('Reprocessing failed');\r\n          return true;\r\n        } else if (attempts >= maxAttempts) {\r\n          toast.warning('Reprocessing still in progress. Check back later.');\r\n          return true;\r\n        }\r\n        \r\n        // Update button with progress\r\n        if (reprocessBtn) {\r\n          reprocessBtn.innerHTML = `<span class=\"spinner\"></span> Processing... (${attempts}s)`;\r\n        }\r\n        \r\n        return false;\r\n      } catch {\r\n        return attempts >= maxAttempts;\r\n      }\r\n    };\r\n    \r\n    // Poll every 2 seconds (track interval for cleanup)\r\n    activeReprocessInterval = setInterval(async () => {\r\n      const done = await pollStatus();\r\n      if (done) {\r\n        if (activeReprocessInterval) {\r\n          clearInterval(activeReprocessInterval);\r\n          activeReprocessInterval = null;\r\n        }\r\n        if (reprocessBtn) {\r\n          reprocessBtn.disabled = false;\r\n          reprocessBtn.innerHTML = originalBtnContent;\r\n        }\r\n      }\r\n    }, 2000);\r\n    \r\n  } catch (err) {\r\n    console.error('[Reprocess] Error:', err);\r\n    toast.error('Failed to reprocess document');\r\n  } finally {\r\n    if (reprocessBtn) {\r\n      reprocessBtn.disabled = false;\r\n      reprocessBtn.innerHTML = originalBtnContent;\r\n    }\r\n  }\r\n}\r\n\r\nasync function uploadNewVersion(doc: Document, container: HTMLElement, onUpdate?: () => void): Promise<void> {\r\n  const input = document.createElement('input');\r\n  input.type = 'file';\r\n  input.accept = '.pdf,.doc,.docx,.txt,.md';\r\n  \r\n  input.onchange = async () => {\r\n    const file = input.files?.[0];\r\n    if (!file) return;\r\n    \r\n    const notes = prompt('Change notes (optional):');\r\n    \r\n    const formData = new FormData();\r\n    formData.append('file', file);\r\n    if (notes) formData.append('change_notes', notes);\r\n    \r\n    try {\r\n      toast.info('Uploading new version...');\r\n      await fetch(`/api/documents/${doc.id}/versions`, {\r\n        method: 'POST',\r\n        body: formData,\r\n        credentials: 'include'\r\n      });\r\n      toast.success('New version uploaded');\r\n      loadVersions(container, doc.id);\r\n      onUpdate?.();\r\n    } catch {\r\n      toast.error('Failed to upload new version');\r\n    }\r\n  };\r\n  \r\n  input.click();\r\n}\r\n\r\nasync function generateShareLink(container: HTMLElement, doc: Document): Promise<void> {\r\n  const expires = (container.querySelector('#share-expires') as HTMLSelectElement).value;\r\n  const maxViews = (container.querySelector('#share-max-views') as HTMLInputElement).value;\r\n  const password = (container.querySelector('#share-password') as HTMLInputElement).value;\r\n  const permissions = (container.querySelector('#share-permissions') as HTMLSelectElement).value;\r\n  \r\n  try {\r\n    const response = await http.post<{ url: string; token: string }>(`/api/documents/${doc.id}/share`, {\r\n      expires,\r\n      max_views: maxViews ? parseInt(maxViews) : null,\r\n      password: password || null,\r\n      permissions: [permissions === 'download' ? 'view' : permissions, ...(permissions === 'download' ? ['download'] : [])]\r\n    });\r\n    \r\n    const input = container.querySelector('#share-link-input') as HTMLInputElement;\r\n    input.value = response.data.url;\r\n    \r\n    (container.querySelector('#generate-link-btn') as HTMLElement).style.display = 'none';\r\n    (container.querySelector('#copy-link-btn') as HTMLElement).style.display = 'block';\r\n    \r\n    toast.success('Share link generated');\r\n  } catch {\r\n    toast.error('Failed to generate share link');\r\n  }\r\n}\r\n\r\nfunction copyShareLink(container: HTMLElement): void {\r\n  const input = container.querySelector('#share-link-input') as HTMLInputElement;\r\n  navigator.clipboard.writeText(input.value);\r\n  toast.success('Link copied to clipboard');\r\n}\r\n\r\nfunction getDocIcon(filename: string): string {\r\n  const ext = filename.split('.').pop()?.toLowerCase();\r\n  switch (ext) {\r\n    case 'pdf': return 'üìÑ';\r\n    case 'doc':\r\n    case 'docx': return 'üìù';\r\n    case 'xls':\r\n    case 'xlsx': return 'üìä';\r\n    case 'ppt':\r\n    case 'pptx': return 'üìΩÔ∏è';\r\n    case 'txt':\r\n    case 'md': return 'üìÉ';\r\n    case 'jpg':\r\n    case 'jpeg':\r\n    case 'png':\r\n    case 'gif': return 'üñºÔ∏è';\r\n    default: return 'üìÅ';\r\n  }\r\n}\r\n\r\nfunction getActionText(action: string): string {\r\n  const actions: Record<string, string> = {\r\n    created: 'uploaded this document',\r\n    viewed: 'viewed this document',\r\n    downloaded: 'downloaded this document',\r\n    updated: 'updated this document',\r\n    version_uploaded: 'uploaded a new version',\r\n    analyzed: 'ran AI analysis',\r\n    reprocessed: 'reprocessed this document',\r\n    shared: 'shared this document',\r\n    unshared: 'removed share link',\r\n    deleted: 'deleted this document',\r\n    restored: 'restored this document',\r\n    tagged: 'added tags',\r\n    favorited: 'added to favorites',\r\n    unfavorited: 'removed from favorites',\r\n    commented: 'commented on this document'\r\n  };\r\n  return actions[action] || action;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n}\r\n\r\nfunction capitalizeFirst(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n"],"names":["isFavorite","activeReprocessInterval","showDocumentPreviewModal","props","doc","content","getDocIcon","escapeHtml","formatFileSize","formatRelativeTime","tag","tab","tabName","switchTab","toggleFavorite","downloadDocument","reprocessDocument","uploadNewVersion","generateShareLink","copyShareLink","loadContentPreview","loadEntities","loadAnalysisHistory","loadVersions","loadActivity","loadMeetingNotes","checkFavoriteStatus","fav","updateFavoriteButton","overlay","modalContainer","closeBtn","closePreviewModal","e","handleEscape","onClose","container","t","s","docId","contentEl","response","http","truncated","err","listEl","entitiesTab","entitiesCount","peopleCountEl","extraction","entities","facts","decisions","actions","questions","risks","participants","personEntities","allPeople","pe","p","totalItems","html","f","d","a","q","r","idx","setupPeopleLinkHandlers","peopleSection","projectId","btn","personName","showContactLinkDropdown","personRole","personOrg","createContactFromPerson","btnEl","dropdown","rect","searchInput","contacts","renderContactList","query","filtered","c","closeHandler","escHandler","initials","n","item","contactId","contactName","toast","name","role","organization","originalText","analyses","runAnalysisBtn","i","capitalizeFirst","formatDateTime","analysis","showAnalysisDetail","fullResult","extractionResponse","docResponse","resultJson","summary","peopleDetected","peopleNames","linkedPeople","unlinkedPeople","peopleSectionHtml","chip","el","isLinked","currentContactId","currentContactName","showPersonLinkMenu","chipEl","m","menu","renderContacts","avatar","contactEmail","contactAvatar","contactRole","updateChipToLinked","updateChipToUnlinked","versions","v","timelineEl","activities","getInitials","getActionText","notesContainer","notesTab","notesText","notes","renderNotesAsHtml","keyPoints","kp","outline","o","b","text","div","lines","currentTopic","bulletsHtml","headerDone","metaDone","flushTopic","line","trimmed","bulletText","refreshModalContent","updatedDoc","entityTypes","type","card","countEl","count","summaryCard","summaryEl","contentPreview","statusBadge","onUpdate","reprocessBtn","originalBtnContent","check","shouldProceed","hashMsg","entitiesMsg","attempts","maxAttempts","pollStatus","status","input","file","formData","expires","maxViews","password","permissions","filename","action","str"],"mappings":"gHAwDA,IAAIA,EAAa,GACbC,EAAiE,KAK9D,SAASC,GAAyBC,EAAmC,CAC1E,KAAM,CAAE,SAAUC,CAAA,EAAQD,EAEpBE,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,yBACpBA,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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"}