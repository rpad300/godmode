import{j as e,r as P}from"./vendor-react-CZ-WyKWZ.js";import{L as $,T as se,c as s,a6 as De,U as be,A as Se,bn as ke,cD as Ie,w as ve,ab as Oe,d5 as Pe,d6 as $e,d7 as Fe,d8 as Ue,d9 as ze,P as je,a9 as ue,a8 as he,cO as Ge,da as Be,db as Ke,dc as Ve,cP as He,dd as Qe,de as Je,df as We,R as re,dg as Ye,dh as Ze,di as Xe,dj as qe,dk as es,cp as ss,cq as ts,ck as as,cs as rs,ct as ns,cr as is,cv as ls,dl as cs,cx as os,cz as ds,cA as xs,cB as ms,cy as ps,cC as us,ci as hs,dm as gs,Z as le,dn as vs,dp as js,dq as ys,dr as bs,ds as Ns,bF as fs,bE as ws,bH as Cs,dt as Ss,du as ks,dv as Ps,bh as As,bi as Ls,bj as Ms,dw as Es,bl as _s,bg as Rs,bm as Ts,dx as Ds,dy as Is,dz as Os,dA as $s,dB as Fs,dC as Us,dD as zs,dE as Gs,dF as Bs,dG as Ks,dH as Vs,dI as Hs,dJ as Qs,dK as Js,d4 as Ws,X as ge,dL as Ys,dM as Zs,dN as Xs,bo as qs,bp as et,dO as st,dP as tt,dQ as at,dR as rt,dS as nt}from"./main-B3DZn5B_.js";import{t as c}from"./vendor-ui-BS9QKitv.js";import{P as it,f as lt}from"./GraphOntology-DgitACNp.js";import{K as ct}from"./key-DhTDYaIg.js";import{C as ot}from"./cpu-DUHk4ipN.js";import{L as dt}from"./list-Bt3ZTO_1.js";import{L as Ae}from"./layers-Bgf9ppPM.js";import{c as ie}from"./vendor-markdown-Cu8AM8lU.js";import{E as Le}from"./eye-RsgK9PvA.js";import{R as ce}from"./rotate-cw-wbVSlX31.js";import{C as oe}from"./circle-check-big-Do7NRW-9.js";import{S as q}from"./save-Dic_e7Eu.js";import{P as xt}from"./play-BMZi0w5i.js";import{H as mt}from"./history-CfQJo6RW.js";import{P as pt}from"./pen-line-VNeSLMlJ.js";import{L as ut}from"./link-2-CvGSt01y.js";import{F as ht}from"./file-braces-CKRIsa3C.js";import{U as gt}from"./upload-C00nhlDV.js";import{E as vt}from"./eye-off-Co-RWywx.js";import{D as jt}from"./database-DDPnWHnY.js";import"./vendor-query-DSf7I7Ei.js";import"./vendor-supabase-Bpw_79gH.js";import"./vendor-router-D_XeKoA_.js";import"./sparkles-D3iJUPqd.js";import"./chart-column-BRODuIXF.js";import"./brain-BD_Z4K1O.js";import"./wand-sparkles-GsBQJb1C.js";import"./circle-x-qKfRTqT4.js";import"./merge-13AMIUb7.js";const yt=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Me=ie("ban",yt);const bt=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Nt=ie("credit-card",bt);const ft=[["path",{d:"M9 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v.5",key:"1dkoa9"}],["path",{d:"M12 10v4h4",key:"1czhmt"}],["path",{d:"m12 14 1.535-1.605a5 5 0 0 1 8 1.5",key:"lvuxfi"}],["path",{d:"M22 22v-4h-4",key:"1ewp4q"}],["path",{d:"m22 18-1.535 1.605a5 5 0 0 1-8-1.5",key:"14ync0"}]],Ee=ie("folder-sync",ft);const wt=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],Ne=ie("folder-tree",wt);const Ct=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],St=ie("gauge",Ct);const kt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],_e=ie("terminal",kt),X=t=>({width:t,height:t,viewBox:"0 0 24 24"});function Pt({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"none",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M22.28 9.37a5.93 5.93 0 0 0-.51-4.89A6.01 6.01 0 0 0 15.3 1.5a5.97 5.97 0 0 0-4.52 2.07A5.93 5.93 0 0 0 6.82 2.2a6.01 6.01 0 0 0-4.01 2.92 5.97 5.97 0 0 0 .74 7.01 5.93 5.93 0 0 0 .51 4.89A6.01 6.01 0 0 0 10.53 20a5.98 5.98 0 0 0 .69 2.5 6.01 6.01 0 0 0 6.47 2.98 5.97 5.97 0 0 0 4.52-2.07 5.93 5.93 0 0 0 3.96 1.37 6.01 6.01 0 0 0 4.01-2.92 5.97 5.97 0 0 0-.74-7.01",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",transform:"scale(0.75) translate(4, 4)"})})}function fe({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M13.83 3h-3.16L5 21h3.16l1.41-4.51h5.36L16.34 21h3.16L13.83 3Zm-3.16 10.96L12.25 8.6l1.58 5.36h-3.16Z"})})}function pe({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"none",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M21.81 10.26H12.18v3.72h5.51a4.77 4.77 0 0 1-2.05 3.08 6.14 6.14 0 0 1-3.46.96 6.36 6.36 0 0 1-6-4.14 6.29 6.29 0 0 1 0-3.76 6.36 6.36 0 0 1 6-4.14c1.56 0 2.97.56 4.08 1.49l2.79-2.79A10.53 10.53 0 0 0 12.18 2a10.26 10.26 0 0 0-9.19 5.66 10.06 10.06 0 0 0 0 8.68A10.26 10.26 0 0 0 12.18 22c5.2 0 9.87-3.46 9.87-10.26 0-.65-.08-1.31-.24-1.48Z",fill:"currentColor"})})}function At({size:t=20,...d}){return e.jsxs("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:[e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),e.jsx("text",{x:"12",y:"16",textAnchor:"middle",fontSize:"10",fontWeight:"bold",fill:"currentColor",children:"G"})]})}function Lt({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 2c1.85 0 3.55.63 4.9 1.69L7.69 16.9A7.96 7.96 0 0 1 4 12c0-4.42 3.58-8 8-8zm0 16c-1.85 0-3.55-.63-4.9-1.69L16.31 7.1A7.96 7.96 0 0 1 20 12c0 4.42-3.58 8-8 8z"})})}function Mt({size:t=20,...d}){return e.jsxs("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:[e.jsx("path",{d:"M12 3a7 7 0 0 0-7 7v3.5c0 1.93 1.57 3.5 3.5 3.5h1a1.5 1.5 0 0 0 0-3H8.5a.5.5 0 0 1-.5-.5V10a4 4 0 0 1 8 0v3.5a.5.5 0 0 1-.5.5H14.5a1.5 1.5 0 0 0 0 3h1c1.93 0 3.5-1.57 3.5-3.5V10a7 7 0 0 0-7-7z"}),e.jsx("circle",{cx:"9.5",cy:"10.5",r:"1"}),e.jsx("circle",{cx:"14.5",cy:"10.5",r:"1"})]})}function we({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M3 3l7.07 10.61L3 21h1.59l6.19-6.47L15.61 21H21l-7.46-11.18L20.1 3h-1.59l-5.76 6.02L8.39 3H3zm2.29 1.25h2.54l10.88 15.5h-2.54L5.29 4.25z"})})}function Et({size:t=20,...d}){return e.jsxs("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:[e.jsx("rect",{x:"3",y:"8",width:"4",height:"8",rx:"1"}),e.jsx("rect",{x:"10",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"17",y:"8",width:"4",height:"8",rx:"1"})]})}function _t({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14.5v-9l7 4.5-7 4.5z"})})}function Rt({size:t=20,...d}){return e.jsxs("svg",{...X(t),fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",xmlns:"http://www.w3.org/2000/svg",...d,children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"3"}),e.jsx("path",{d:"M9 9h6M9 12h6M9 15h4"})]})}const Re={openai:"#10a37f",anthropic:"#d97757",claude:"#d97757",google:"#4285f4",gemini:"#4285f4",google_gemini:"#4285f4",groq:"#f55036",deepseek:"#4d6bfe",ollama:"#ffffff",grok:"#1d9bf0",xai:"#1d9bf0",minimax:"#6c5ce7",kimi:"#615eff"},Tt={openai:Pt,anthropic:fe,claude:fe,google:pe,gemini:pe,google_gemini:pe,groq:At,deepseek:Lt,ollama:Mt,grok:we,xai:we,minimax:Et,kimi:_t};function de({provider:t,size:d=20,className:m}){const _=(t||"").toLowerCase().replace(/[\s-]/g,"_"),u=Tt[_]||Rt,N=Re[_]||"currentColor";return e.jsx(u,{size:d,className:m,style:{color:N}})}function Dt(t){const d=(t||"").toLowerCase().replace(/[\s-]/g,"_");return Re[d]||"var(--gm-accent-primary)"}const C="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",F="bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] transition-all duration-150",K="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",G="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",Ce="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50",T="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",O="text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider";function Z(){return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx($,{className:"h-6 w-6 animate-spin text-[var(--gm-accent-primary)]"})})}function ye({msg:t}){return e.jsxs("div",{className:s(C,"p-10 text-center flex flex-col items-center gap-3"),children:[e.jsx(se,{className:"w-5 h-5 text-[var(--color-warning-500)]"}),e.jsx("span",{className:"text-sm text-[var(--gm-text-secondary)]",children:t})]})}function ne({msg:t}){return e.jsx("div",{className:s(C,"p-10 text-center text-[var(--gm-text-tertiary)] text-sm"),children:t})}function Y({title:t,subtitle:d}){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:t}),d&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5",children:d})]})}function V({label:t,value:d,color:m}){return e.jsxs("div",{className:s(C,"p-4 text-center"),children:[e.jsx("div",{className:"text-2xl font-bold tabular-nums",style:m?{color:m}:void 0,children:d}),e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mt-1",children:t})]})}function xe({checked:t,onChange:d,disabled:m}){return e.jsx("button",{onClick:()=>!m&&d(!t),disabled:m,className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer rounded-full border border-[var(--gm-border-primary)] transition-colors duration-200 disabled:opacity-50",style:{backgroundColor:t?"var(--color-brand-500)":"var(--gm-bg-tertiary)"},children:e.jsx("span",{className:s("pointer-events-none inline-block h-4 w-4 rounded-full bg-white shadow-sm transition-transform duration-200",t?"translate-x-4":"translate-x-0")})})}const D=t=>t??{},It=[{key:"users",label:"Users",icon:be},{key:"system",label:"System",icon:Se},{key:"llm-providers",label:"LLM Providers",icon:ct},{key:"model-metadata",label:"Model Metadata",icon:ot},{key:"llm-queue",label:"LLM Queue",icon:dt},{key:"graph",label:"Graph",icon:ke},{key:"ontology",label:"Ontology",icon:Ae},{key:"prompts",label:"Prompts",icon:_e},{key:"processing",label:"Processing",icon:Ie},{key:"team-analysis",label:"Team Analysis",icon:be},{key:"google-drive",label:"Google Drive",icon:Ee},{key:"billing",label:"Billing",icon:Nt},{key:"audit-log",label:"Audit Log",icon:ve}];function Ot(){const{data:t}=Pe(),d=t,m=[];return d&&(typeof d.disk=="number"&&d.disk>75&&m.push({msg:`Disk usage at ${d.disk.toFixed(1)}% — consider cleanup of old embeddings`,severity:"warning"}),typeof d.cpu=="number"&&d.cpu>90&&m.push({msg:`CPU usage critical at ${d.cpu.toFixed(1)}%`,severity:"danger"}),typeof d.ram=="number"&&d.ram>85&&m.push({msg:`RAM usage high at ${d.ram.toFixed(1)}%`,severity:"warning"}),typeof d.latency=="number"&&d.latency>200&&m.push({msg:`High latency: ${d.latency.toFixed(0)}ms`,severity:"warning"})),m.length===0?null:e.jsx("div",{className:"space-y-1.5 mb-4",children:m.map((_,u)=>e.jsxs("div",{className:s("flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-medium",_.severity==="danger"?"bg-red-500/10 text-red-400":_.severity==="warning"?"bg-amber-500/10 text-amber-400":"bg-blue-500/10 text-blue-400"),children:[e.jsx(se,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"flex-1",children:_.msg})]},u))})}function $t(){const{data:t,isLoading:d,error:m}=$e(),_=Fe(),u=Ue(),N=ze(),[g,S]=P.useState(!1),[M,v]=P.useState(""),[w,j]=P.useState("all"),[E,x]=P.useState({email:"",name:"",password:"",role:"user"}),[p,A]=P.useState(null),L=D(t),r=L.users??[],i=D(L.stats),l=P.useMemo(()=>r.filter(o=>{if(w!=="all"&&o.role!==w)return!1;if(M){const I=M.toLowerCase();if(!o.name?.toLowerCase().includes(I)&&!o.email?.toLowerCase().includes(I))return!1}return!0}),[r,w,M]),b=P.useCallback(()=>{if(!E.email){c.error("Email is required");return}_.mutate(E,{onSuccess:()=>{c.success("User created"),S(!1),x({email:"",name:"",password:"",role:"user"})},onError:o=>c.error(o.message)})},[E,_]);return d?e.jsx(Z,{}):m?e.jsx(ye,{msg:"Unable to load users."}):e.jsxs("div",{className:"space-y-5",children:[e.jsx(Y,{title:"User Management"}),i.totalUsers!=null&&e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsx(V,{label:"Total Users",value:i.totalUsers}),e.jsx(V,{label:"Active",value:i.activeUsers,color:"var(--color-success-500)"}),e.jsx(V,{label:"Pending",value:i.pendingInvitations,color:"var(--color-warning-500)"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[e.jsx(je,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{placeholder:"Search users...",value:M,onChange:o=>v(o.target.value),className:s(F,"flex-1")})]}),e.jsxs("select",{value:w,onChange:o=>j(o.target.value),className:s(F,"w-32"),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"Superadmin"})]}),e.jsxs("button",{onClick:()=>S(!g),className:K,children:[e.jsx(ue,{className:"w-3 h-3"})," Add User"]})]}),g&&e.jsxs("div",{className:s(C,"p-4 space-y-3"),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{placeholder:"Email",value:E.email,onChange:o=>x(I=>({...I,email:o.target.value})),className:F}),e.jsx("input",{placeholder:"Display Name",value:E.name,onChange:o=>x(I=>({...I,name:o.target.value})),className:F}),e.jsx("input",{placeholder:"Password",type:"password",value:E.password,onChange:o=>x(I=>({...I,password:o.target.value})),className:F}),e.jsxs("select",{value:E.role,onChange:o=>x(I=>({...I,role:o.target.value})),className:F,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"Superadmin"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:b,disabled:_.isPending,className:K,children:[_.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ue,{className:"w-3 h-3"})," Create"]}),e.jsx("button",{onClick:()=>S(!1),className:G,children:"Cancel"})]})]}),e.jsxs("div",{className:s(C,"overflow-hidden"),children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["USER","EMAIL","ROLE","STATUS","LAST LOGIN","ACTIONS"].map(o=>e.jsx("th",{className:s(O,"px-4 py-3 text-left"),children:o},o))})}),e.jsx("tbody",{children:l.map(o=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[var(--gm-interactive-primary)]/15 text-[var(--gm-accent-primary)] font-bold flex items-center justify-center shrink-0 text-xs",children:(o.name||o.email||"?").substring(0,2).toUpperCase()}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:o.name||"—"})]})}),e.jsx("td",{className:"px-4 py-3 text-xs text-[var(--gm-text-tertiary)]",children:o.email}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:o.role,onChange:I=>u.mutate({id:o.id,role:I.target.value},{onSuccess:()=>c.success("Role updated"),onError:H=>c.error(H.message)}),className:s("text-[10px] px-2 py-0.5 rounded-full font-medium border-0",o.role==="superadmin"?"bg-red-500 text-white":o.role==="admin"?"bg-blue-500 text-white":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]"),children:[e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"superadmin",children:"superadmin"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",o.status==="active"?"bg-green-500/15 text-green-400":o.status==="banned"?"bg-red-500/15 text-red-400":"bg-amber-500/15 text-amber-400"),children:o.status})}),e.jsx("td",{className:"px-4 py-3 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o.lastActive?new Date(o.lastActive).toLocaleString():"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>u.mutate({id:o.id,status:o.status==="banned"?"active":"banned"},{onSuccess:()=>c.success(o.status==="banned"?"User unbanned":"User banned"),onError:I=>c.error(I.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:o.status==="banned"?"Unban":"Ban",children:o.status==="banned"?e.jsx(Le,{className:"w-3.5 h-3.5 text-green-400"}):e.jsx(Me,{className:"w-3.5 h-3.5 text-amber-400"})}),p===o.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N.mutate(o.id,{onSuccess:()=>{c.success("User deleted"),A(null)},onError:I=>c.error(I.message)}),className:"px-2 py-0.5 rounded bg-red-500 text-white text-[10px]",children:"Confirm"}),e.jsx("button",{onClick:()=>A(null),className:"px-2 py-0.5 rounded text-[10px] text-[var(--gm-text-tertiary)]",children:"Cancel"})]}):e.jsx("button",{onClick:()=>A(o.id),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",children:e.jsx(he,{className:"w-3.5 h-3.5 text-red-400"})})]})})]},o.id))})]}),l.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No users found."})]}),e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] text-center",children:["Showing ",l.length," of ",r.length," users"]})]})}function Ft(){const{data:t,isLoading:d,error:m,refetch:_}=Pe(),u=t;if(d)return e.jsx(Z,{});if(m||!u)return e.jsx(ye,{msg:"Unable to load system stats."});const N=u.server||{},g=u.memory||{},S=u.process||{},M=u.database||"unknown",v=x=>{const p=Math.floor(x/86400),A=Math.floor(x%86400/3600),L=Math.floor(x%3600/60);return[p&&`${p}d`,A&&`${A}h`,`${L}m`].filter(Boolean).join(" ")},w=x=>x>=1024?`${(x/1024).toFixed(1)} GB`:`${x} MB`,j=(x,p,A)=>x>A?"#ef4444":x>p?"#f59e0b":"#22c55e",E=[{label:"CPU",val:u.cpu,unit:"%",color:j(u.cpu,60,80)},{label:"RAM",val:u.ram,unit:"%",color:j(u.ram,60,80)},{label:"Disk",val:u.disk,unit:"%",color:j(u.disk,70,90)},{label:"Event Loop",val:u.latency,unit:"ms",color:j(u.latency,50,200)}];return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Y,{title:"System Health",subtitle:u.timestamp?`Last updated: ${new Date(u.timestamp).toLocaleString()}`:"Real-time system monitoring"}),e.jsxs("button",{onClick:()=>_(),className:G,children:[e.jsx(ce,{className:"w-3 h-3"})," Refresh"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:E.map(x=>e.jsxs("div",{className:s(C,"p-4 text-center"),children:[e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:x.label}),e.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-2",children:[e.jsxs("svg",{viewBox:"0 0 36 36",className:"w-full h-full -rotate-90",children:[e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:"var(--gm-bg-tertiary)",strokeWidth:"3"}),e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:x.color,strokeWidth:"3",strokeDasharray:`${Math.min((typeof x.val=="number"?x.val:0)/(x.unit==="ms"?500:100)*97.4,97.4)} 97.4`,strokeLinecap:"round",className:"transition-all duration-700"})]}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:typeof x.val=="number"?x.unit==="ms"?x.val:x.val.toFixed(0):x.val})]}),e.jsx("div",{className:"text-[9px] font-medium tabular-nums",style:{color:x.color},children:x.unit})]},x.label))}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(C,"p-4 space-y-2.5"),children:[e.jsx("h3",{className:T,children:"Server"}),[["Node",String(N.nodeVersion||"—")],["Platform",`${N.platform||"—"} / ${N.arch||"—"}`],["Hostname",String(u.hostname||"—")],["PID",String(N.pid||"—")],["Uptime",typeof N.uptime=="number"?v(N.uptime):"—"],["CPU Cores",String(u.cpuCores||"—")]].map(([x,p])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:x}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono tabular-nums",children:p})]},x))]}),e.jsxs("div",{className:s(C,"p-4 space-y-2.5"),children:[e.jsx("h3",{className:T,children:"Runtime"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Database"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",M==="connected"?"bg-green-500/10 text-green-400":M==="error"?"bg-red-500/10 text-red-400":"bg-amber-500/10 text-amber-400"),children:M})]}),[["Heap Used",`${S.heapUsedMB||0} MB`],["Heap Total",`${S.heapTotalMB||0} MB`],["Heap %",`${S.heapPercent||0}%`],["RSS",`${S.rssMB||0} MB`],["System RAM",g.totalMB?`${w(g.usedMB||0)} / ${w(g.totalMB)}`:"—"]].map(([x,p])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:x}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono tabular-nums",children:p})]},x)),S.heapPercent>0&&e.jsx("div",{className:"h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${S.heapPercent}%`,backgroundColor:j(S.heapPercent,60,85)}})})]})]}),u.storageBreakdown&&u.storageBreakdown.length>0&&e.jsxs("div",{className:s(C,"p-5"),children:[e.jsx("h3",{className:s(T,"mb-4"),children:"Storage"}),e.jsx("div",{className:"space-y-4",children:u.storageBreakdown.map((x,p)=>{const A=Number(x.size||0),L=Number(x.free||0),r=A-L,i=A>0?Math.round(r/A*100):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:String(x.category)}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums font-mono",children:[w(r)," / ",w(A)," (",i,"%)"]})]}),e.jsx("div",{className:"h-2.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${i}%`,backgroundColor:j(i,70,90)}})}),e.jsx("div",{className:"flex justify-between mt-1",children:e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:[w(L)," free"]})})]},p)})})]})]})}function Ut({task:t,taskLabel:d,currentProvider:m,currentModel:_,providerList:u,onProviderChange:N,onModelChange:g}){const{data:S,isLoading:M,isError:v}=Ws(m||null),[w,j]=P.useState(!1),E=P.useMemo(()=>{if(!S)return[];const p=S,A=p.textModels??[],L=p.visionModels??[],r=p.embeddingModels??[];return t==="vision"?L:t==="embeddings"?r:A},[S,t]),x=E.length>0;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)] capitalize",children:d}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"PROVIDER"}),e.jsxs("select",{value:m,onChange:p=>{N(p.target.value),j(!1)},className:s(F,"w-full text-xs"),children:[e.jsx("option",{value:"",children:"Select..."}),u.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-accent-primary)] mt-0.5 block",children:[u.length," provider(s) available"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"MODEL"}),M&&m?e.jsxs("div",{className:s(F,"w-full text-xs flex items-center gap-2"),children:[e.jsx($,{className:"w-3 h-3 animate-spin text-blue-400"}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Loading models..."})]}):x&&!w?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:_,onChange:p=>g(p.target.value),className:s(F,"w-full text-xs"),children:[e.jsx("option",{value:"",children:"Select model..."}),E.map(p=>e.jsxs("option",{value:p.id,children:[p.name||p.id,p.contextTokens?` (${Math.round(Number(p.contextTokens)/1e3)}K ctx)`:""]},p.id))]}),e.jsx("button",{onClick:()=>j(!0),className:"text-[10px] text-blue-400 hover:text-blue-300 mt-0.5 block",children:"or type manually"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{value:_,onChange:p=>g(p.target.value),className:s(F,"w-full text-xs"),placeholder:m?"e.g. gpt-4o":"Select a provider first"}),x&&w&&e.jsx("button",{onClick:()=>j(!1),className:"text-[10px] text-blue-400 hover:text-blue-300 mt-0.5 block",children:"back to dropdown"}),v&&m&&e.jsx("span",{className:"text-[10px] text-amber-400 mt-0.5 block",children:"Could not load models — type manually"})]})]})]})]})}function zt(){const{data:t,isLoading:d}=Ge(),{data:m}=Be(),{data:_,isLoading:u}=Ke(),N=Ve(),g=He(),[S,M]=P.useState({}),[v,w]=P.useState({}),[j,E]=P.useState({}),x=D(t),p=D(x.llm),A=D(p.providers),L=D(p.perTask);D(m).providers;const i=D(_),l=i.providers??[],b=P.useCallback(f=>l.find(k=>k.id===f||k.aliases&&k.aliases.includes(f)),[l]),o=P.useMemo(()=>{const f=new Set,k=Object.entries(A).map(([a,h])=>{const R=b(a),n=R?.id||a;return f.add(n),f.add(a),{id:n,name:R?.name||h.name||a,apiKeyMasked:R?.masked||h.apiKeyMasked||null,isConfigured:R?.configured||!!h.isConfigured,keySource:R?.source||null}});return l.forEach(a=>{f.has(a.id)||(f.add(a.id),k.push({id:a.id,name:a.name||(a.id||"unknown").charAt(0).toUpperCase()+(a.id||"unknown").slice(1),apiKeyMasked:a.masked,isConfigured:a.configured,keySource:a.source}))}),k},[A,l,b]),I=P.useCallback(()=>{const f=Object.entries(v).filter(([,h])=>h.trim().length>0);if(f.length===0){c.info("No changes to save");return}let k=0;const a=f.length;for(const[h,R]of f)N.mutate({provider:h,apiKey:R},{onSuccess:()=>{k++,k===a&&(c.success(`${a} API key${a>1?"s":""} saved to encrypted vault`),w({}))},onError:n=>c.error(`Failed to save ${h}: ${n.message}`)})},[v,N]),H=P.useCallback(()=>{if(Object.keys(j).length===0){c.info("No changes to save");return}g.mutate({llm:{perTask:j}},{onSuccess:()=>{c.success("LLM configuration saved"),E({})},onError:f=>c.error(f.message)})},[j,g]);if(d||u)return e.jsx(Z,{});const z=Object.values(v).some(f=>f.trim().length>0);return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Y,{title:"LLM Providers",subtitle:"System-level API keys stored encrypted in Supabase vault"}),e.jsxs("div",{className:s(C,"p-4 border-l-2 border-[var(--gm-accent-primary)]"),children:[e.jsx("h4",{className:"text-xs font-semibold text-[var(--gm-accent-primary)] mb-2",children:"Key Resolution & Billing"}),e.jsxs("div",{className:"text-[11px] text-[var(--gm-text-secondary)] space-y-1",children:[e.jsxs("p",{children:["The LLM service resolves API keys in this order: ",e.jsx("strong",{children:"Project key"})," (Supabase secrets, project scope) then ",e.jsx("strong",{children:"System key"})," (Supabase secrets, system scope) then ",e.jsx("strong",{children:"Config file"})," (fallback)."]}),e.jsxs("p",{children:["When a project uses its ",e.jsx("strong",{children:"own API key"})," (BYOK), billing is ",e.jsx("span",{className:"text-green-400 font-medium",children:"skipped"})," — the project pays the provider directly."]}),e.jsxs("p",{children:["When using ",e.jsx("strong",{children:"system keys"}),", the project balance is ",e.jsx("span",{className:"text-amber-400 font-medium",children:"debited"})," with the configured markup."]})]})]}),e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:T,children:"System LLM API Keys"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[o.filter(f=>f.isConfigured).length,"/",o.length," configured"]})]}),o.map(f=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:f.name||"(unnamed)"}),f.isConfigured?e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Configured"]}):e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"}),f.keySource&&e.jsxs("span",{className:s("text-[10px] px-1.5 py-0.5 rounded",f.keySource==="system"?"bg-blue-500/20 text-blue-300":"bg-purple-500/20 text-purple-300"),children:[f.keySource," scope"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:S[f.id]?"text":"password",value:v[f.id]??"",onChange:k=>w(a=>({...a,[f.id]:k.target.value})),placeholder:f.apiKeyMasked||`Enter ${f.name} API key...`,className:s(F,"flex-1 font-mono text-xs")}),e.jsx("button",{onClick:()=>M(k=>({...k,[f.id]:!k[f.id]})),className:G,children:S[f.id]?"Hide":"Show"})]}),f.apiKeyMasked&&!v[f.id]&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono pl-1",children:["Current: ",f.apiKeyMasked]})]},f.id)),e.jsxs("button",{onClick:I,disabled:N.isPending||!z,className:K,children:[N.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save to Encrypted Vault"]})]}),e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsx("h3",{className:T,children:"Service API Keys"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Keys for email, notifications and other services (stored encrypted in Supabase)"}),(()=>{const f=i.services??[],k={resend:{link:"https://resend.com/api-keys"},brave:{link:"https://brave.com/search/api/"}};return f.length>0?f.map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:a.name||"(unnamed)"}),a.configured?e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Configured"]}):e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:S[a.id]?"text":"password",value:v[a.id]??"",onChange:h=>w(R=>({...R,[a.id]:h.target.value})),placeholder:a.masked||`Enter ${a.name} key...`,className:s(F,"flex-1 font-mono text-xs")}),e.jsx("button",{onClick:()=>M(h=>({...h,[a.id]:!h[a.id]})),className:G,children:S[a.id]?"Hide":"Show"}),e.jsxs("button",{onClick:()=>{const h=v[a.id]?.trim();if(!h){c.info("Enter a key first");return}N.mutate({provider:a.id,apiKey:h},{onSuccess:()=>{c.success(`${a.name} key saved`),w(R=>{const n={...R};return delete n[a.id],n})},onError:R=>c.error(R.message)})},disabled:N.isPending||!v[a.id]?.trim(),className:K,children:[e.jsx(q,{className:"w-3 h-3"})," Save"]})]}),a.masked&&!v[a.id]&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono pl-1",children:["Current: ",a.masked]}),k[a.id]?.link&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Get key at ",e.jsx("a",{href:k[a.id].link,target:"_blank",rel:"noreferrer",className:"text-[var(--gm-accent-primary)] underline",children:k[a.id].link})]})]},a.id)):["resend","brave"].map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:a==="resend"?"Resend (Email)":"Brave Search"}),e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:v[a]??"",onChange:h=>w(R=>({...R,[a]:h.target.value})),placeholder:`Enter ${a} API key...`,className:s(F,"flex-1 font-mono text-xs")}),e.jsxs("button",{onClick:()=>{const h=v[a]?.trim();h&&N.mutate({provider:a,apiKey:h},{onSuccess:()=>{c.success(`${a} key saved`),w(R=>{const n={...R};return delete n[a],n})},onError:R=>c.error(R.message)})},disabled:N.isPending||!v[a]?.trim(),className:K,children:[e.jsx(q,{className:"w-3 h-3"})," Save"]})]})]},a))})()]}),e.jsxs("div",{className:s(C,"p-5 space-y-5"),children:[e.jsxs("div",{children:[e.jsx("h3",{className:T,children:"Task-Specific AI Configuration"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-1",children:"Configure which provider and model to use for each AI task. These settings apply globally to the platform."})]}),Object.entries(L).map(([f,k])=>{const a=f.replace(/_/g," ").replace(/([A-Z])/g," $1"),h=j[f]?.provider??k?.provider??"",R=j[f]?.model??k?.model??"";return e.jsx(Ut,{task:f,taskLabel:a,currentProvider:h,currentModel:R,providerList:o.filter(n=>n.isConfigured),onProviderChange:n=>E(U=>({...U,[f]:{provider:n,model:""}})),onModelChange:n=>E(U=>({...U,[f]:{provider:U[f]?.provider??k?.provider??"",model:n}}))},f)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:H,disabled:g.isPending||Object.keys(j).length===0,className:K,children:[g.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save LLM Configuration"]}),e.jsxs("span",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Changes apply immediately to all AI processing"]})]})]})]})}function Gt(){const{data:t,isLoading:d,refetch:m}=Qe(),{data:_,refetch:u}=Je(),N=We(),[g,S]=P.useState("all"),[M,v]=P.useState("all"),[w,j]=P.useState("");if(d)return e.jsx(Z,{});const x=D(t).models??[],p=D(_).providers??[],A=D(N.data),L=x.map(a=>({...a,_type:a.model_type||"text",_provider:a.provider||"unknown"})),r=L.reduce((a,h)=>(a[h._provider]||(a[h._provider]=[]),a[h._provider].push(h),a),{}),i=Object.keys(r).sort(),l=i.length,b=a=>{const h=Number(a);return!h||isNaN(h)?"—":h>=1e6?`${(h/1e6).toFixed(1)}M`:h>=1e3?`${Math.round(h/1e3)}K`:String(h)},o=a=>{const h=Number(a);return!h||isNaN(h)?"—":`$${h.toFixed(2)}`},I=L.filter(a=>{if(g!=="all"&&a._provider!==g||M!=="all"&&a._type!==M)return!1;if(w){const h=w.toLowerCase(),R=String(a.display_name||a.model_id||"").toLowerCase(),n=String(a.model_id||"").toLowerCase();if(!R.includes(h)&&!n.includes(h))return!1}return!0}),H=I.filter(a=>a._type==="text"),z=I.filter(a=>a._type==="embedding"),f=async()=>{try{const a=await N.mutateAsync();await m(),await u();const h=D(a);c.success(`Models synced — ${h.totalSynced??0} updated across all providers`)}catch(a){c.error(a.message||"Sync failed")}},k=L.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{title:"Model Metadata",subtitle:k?`${L.length} models across ${l} provider(s)`:"No models synced yet — click Sync to populate"}),e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:T,children:"Provider Sync"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Fetches models from each provider API and persists to the database."})]}),e.jsxs("button",{onClick:f,disabled:N.isPending,className:K,children:[N.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"}),N.isPending?"Syncing...":"Sync All Providers"]})]}),A.results&&e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(A.results).map(([a,h])=>e.jsxs("span",{className:s("inline-flex items-center gap-1.5 text-[10px] px-2.5 py-1 rounded-lg font-medium border",h.status==="success"?"bg-green-500/10 border-green-500/30 text-green-400":h.status==="skipped"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-red-500/10 border-red-500/30 text-red-400"),children:[e.jsx(de,{provider:a,size:12}),e.jsx("span",{className:"font-semibold",children:a}),h.status==="success"&&e.jsxs(e.Fragment,{children:[" — ",h.synced," synced"]}),h.status==="skipped"&&e.jsxs(e.Fragment,{children:[" — ",h.reason]}),h.status==="error"&&e.jsx(e.Fragment,{children:" — error"})]},a))}),(p.length>0||i.length>0)&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:(p.length>0?p:i.map(a=>({provider:a}))).map((a,h)=>{const R=a.provider||"",n=a.active_models??a.activeModels??r[R]?.length??0,U=a.last_synced,Q=g===R;return e.jsxs("button",{onClick:()=>S(Q?"all":R),className:s("flex items-center gap-2.5 px-3 py-2.5 rounded-lg border transition-all text-left","bg-[var(--gm-bg-secondary)] border-[var(--gm-border-primary)] hover:border-[var(--gm-border-secondary)]",Q&&"ring-1 ring-[var(--gm-accent-primary)]/50 border-[var(--gm-accent-primary)]/40"),children:[e.jsx(de,{provider:R,size:18}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-[11px] font-semibold text-[var(--gm-text-primary)] truncate capitalize",children:R}),e.jsxs("div",{className:"text-[10px] tabular-nums",style:{color:Dt(R)},children:[n," models"]}),U&&e.jsx("div",{className:"text-[8px] text-[var(--gm-text-tertiary)] truncate",children:new Date(U).toLocaleDateString()})]})]},h)})})]}),e.jsxs("div",{className:s(C,"p-3 flex items-center gap-3 flex-wrap"),children:[e.jsxs("select",{value:g,onChange:a=>S(a.target.value),className:s(F,"w-auto max-w-[180px]"),children:[e.jsx("option",{value:"all",children:"All Providers"}),i.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{value:M,onChange:a=>v(a.target.value),className:s(F,"w-auto max-w-[140px]"),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"embedding",children:"Embedding"})]}),e.jsx("input",{value:w,onChange:a=>j(a.target.value),placeholder:"Search models...",className:s(F,"w-auto max-w-[220px]")}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] ml-auto tabular-nums",children:[I.length," of ",L.length]})]}),H.length>0&&e.jsxs("div",{className:s(C,"overflow-hidden"),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:T,children:"Text & Vision Models"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[H.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Model","Provider","Type","Context","$/1M In","$/1M Out"].map(a=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:a},a))})}),e.jsx("tbody",{children:H.map((a,h)=>{const R=a.display_name||"",n=a.model_id||"—",U=a._provider,Q=!!a.supports_vision;return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[R&&e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:R}),e.jsx("div",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)]",children:n})]}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(de,{provider:U,size:14}),e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] capitalize",children:U})]})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)]",children:"text"}),Q&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-purple-500/15 text-purple-400",children:"vision"})]})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-primary)] tabular-nums font-semibold",children:b(a.context_tokens)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_input)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_output)})]},h)})})]})})]}),z.length>0&&e.jsxs("div",{className:s(C,"overflow-hidden"),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:T,children:"Embedding Models"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[z.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Model","Provider","Context","$/1M In"].map(a=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:a},a))})}),e.jsx("tbody",{children:z.map((a,h)=>{const R=a.display_name||"",n=a.model_id||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[R&&e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:R}),e.jsx("div",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)]",children:n})]}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(de,{provider:a.provider||"",size:14}),e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] capitalize",children:a.provider||""})]})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-primary)] tabular-nums font-semibold",children:b(a.context_tokens)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_input)})]},h)})})]})})]}),!k&&e.jsx(ne,{msg:"No models in database yet. Click 'Sync All Providers' to fetch from APIs."}),k&&I.length===0&&e.jsx(ne,{msg:"No models match the current filters."})]})}function Bt(){const{data:t,isLoading:d,refetch:m}=Ye(),{data:_}=Ze(),{data:u}=Xe(),{data:N}=qe(),g=es(),[S,M]=P.useState(null);if(d)return e.jsx(Z,{});const v=D(t),w=D(v.stats),j=D(v.database),E=D(_).items??v.pendingItems??[],x=D(u).items??[],p=D(N).items??D(N).history??[],A=j.totalCostTodayUsd??w.totalCost??w.costToday,L=()=>{confirm("Clear all pending items from the queue? This cannot be undone.")&&g.mutate({action:"clear"},{onSuccess:()=>{c.success("Queue cleared"),m()},onError:r=>c.error(r.message)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{title:"LLM Processing Queue",subtitle:"Monitor and control AI request processing — All requests are persisted in database"}),e.jsxs("div",{className:s(C,"p-5 space-y-3"),children:[e.jsx("h3",{className:T,children:"Queue Status"}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[v.database!=null&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-semibold bg-green-500/15 text-green-400",children:"DB: Connected"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",v.isPaused?"bg-amber-500/15 text-amber-400":v.isProcessing?"bg-blue-500/15 text-blue-400":"bg-green-500/15 text-green-400"),children:v.isPaused?"PAUSED":v.isProcessing?"PROCESSING":"IDLE"}),e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] tabular-nums",children:["Queue: ",v.queueLength??0]}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:["Processing: ",v.isProcessing?1:0]}),e.jsxs("button",{onClick:()=>m(),className:G,children:[e.jsx(re,{className:"w-3 h-3"})," Refresh"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g.mutate({action:"pause"},{onSuccess:()=>{c.success("Queue paused"),m()},onError:r=>c.error(r.message)}),disabled:g.isPending,className:Ce,children:[e.jsx(it,{className:"w-3 h-3"})," Pause"]}),e.jsxs("button",{onClick:()=>g.mutate({action:"resume"},{onSuccess:()=>{c.success("Queue resumed"),m()},onError:r=>c.error(r.message)}),disabled:g.isPending,className:K,children:[e.jsx(xt,{className:"w-3 h-3"})," Resume"]}),e.jsx("button",{onClick:L,disabled:g.isPending,className:G,children:"Clear Queue"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-7 gap-3",children:[e.jsx(V,{label:"Pending",value:j.pendingCount??v.queueLength??E.length??0}),e.jsx(V,{label:"Processing",value:j.processingCount??(v.isProcessing?1:0)}),e.jsx(V,{label:"Completed",value:j.completedToday??w.successful??w.completed??0,color:"var(--color-brand-500)"}),e.jsx(V,{label:"Failed",value:j.failedToday??w.failed??0,color:"var(--color-danger-500)"}),e.jsx(V,{label:"Retry Pending",value:j.retryPendingCount??x.length}),e.jsx(V,{label:"Avg Time (ms)",value:j.avgProcessingTimeMs??w.avgProcessingTime?Number(j.avgProcessingTimeMs??w.avgProcessingTime).toLocaleString():"0"}),e.jsx(V,{label:"Cost Today",value:A!=null?`$${Number(A).toFixed(4)}`:"$0",color:"var(--color-brand-500)"})]}),v.currentRequest&&e.jsxs("div",{className:s(C,"p-4"),children:[e.jsx("h3",{className:s(T,"mb-2"),children:"Currently Processing"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-4 h-4 animate-spin text-blue-400 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-[var(--gm-text-primary)]",children:v.currentRequest.context||v.currentRequest.id}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[v.currentRequest.priority&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Priority: ",v.currentRequest.priority]}),v.currentRequest.startedAt&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Started: ",new Date(v.currentRequest.startedAt).toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:s(C,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:T,children:"Pending Items"}),e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] tabular-nums",children:[E.length," items"]})]}),E.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No items in queue"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Priority"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Queued"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Action"})]})}),e.jsx("tbody",{children:E.slice(0,20).map((r,i)=>e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[300px]",children:r.context||r.type||r.task||r.id||"Unknown"}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:s("text-[10px] px-1.5 py-0.5 rounded font-medium",r.priority==="high"?"bg-amber-500/15 text-amber-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"),children:r.priority||"normal"})}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:r.queuedAt?new Date(r.queuedAt).toLocaleTimeString():"—"}),e.jsx("td",{className:"text-right py-1.5 px-2",children:e.jsx("button",{onClick:()=>g.mutate({action:"cancel",id:r.id},{onSuccess:()=>{c.success("Cancelled"),m()}}),className:"text-[10px] text-red-400 hover:underline",children:"Cancel"})})]},i))})]})]}),e.jsxs("div",{className:s(C,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:T,children:"Failed Items"}),x.length>0&&e.jsxs("button",{onClick:()=>g.mutate({action:"retry-all"},{onSuccess:()=>{c.success("Retrying all"),m()}}),disabled:g.isPending,className:Ce,children:[e.jsx(ce,{className:"w-3 h-3"})," Retry All"]})]}),x.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No failed items"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Provider"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Attempts"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Error"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Actions"})]})}),e.jsx("tbody",{children:x.slice(0,20).map((r,i)=>e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[200px]",children:r.context||r.type||"Unknown"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:r.provider||"—"}),e.jsxs("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 tabular-nums",children:[r.attempts??r.attemptCount??"?","/",r.maxAttempts??r.maxRetries??"3"]}),e.jsx("td",{className:"text-[10px] text-red-400 py-1.5 px-2 truncate max-w-[200px]",children:r.error||r.errorMessage||"Error"}),e.jsxs("td",{className:"text-right py-1.5 px-2 whitespace-nowrap",children:[e.jsx("button",{onClick:()=>g.mutate({action:"retry",id:r.id},{onSuccess:()=>{c.success("Retrying"),m()}}),className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline mr-2",children:"Retry"}),e.jsx("button",{onClick:()=>g.mutate({action:"retry",id:r.id+"?reset=true"},{onSuccess:()=>{c.success("Reset & Retrying"),m()}}),className:"text-[10px] text-amber-400 hover:underline",children:"Reset & Retry"})]})]},i))})]})]}),e.jsxs("div",{className:s(C,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:T,children:"Recent Processing History"}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:[p.length," items"]})]}),p.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No processing history yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Provider / Model"}),e.jsx("th",{className:s(O,"text-center py-2 px-2"),children:"Status"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Tokens"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Time (ms)"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Completed"}),e.jsx("th",{className:s(O,"text-center py-2 px-2")})]})}),e.jsx("tbody",{children:p.slice(0,50).map((r,i)=>{const l=r.status==="completed"||r.status==="success",b=r.inputTokens||r.tokensIn||0,o=r.outputTokens||r.tokensOut||0;return e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors cursor-pointer",onClick:()=>M(r),children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[200px]",children:r.context||r.type||r.task||r.id||"—"}),e.jsxs("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:[r.provider||"—",r.model?` / ${r.model}`:""]}),e.jsx("td",{className:"text-center py-1.5 px-2",children:e.jsx("span",{className:s("inline-block w-2 h-2 rounded-full",l?"bg-green-400":"bg-red-400")})}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right tabular-nums",children:b>0?`${b}→${o}`:"—"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right tabular-nums",children:r.processingTime??r.durationMs??"—"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right",children:r.completedAt?new Date(r.completedAt).toLocaleTimeString():"—"}),e.jsx("td",{className:"text-center py-1.5 px-2",children:e.jsx("button",{className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline",children:"View"})})]},i)})})]})})]}),S&&e.jsx(Kt,{request:S,onClose:()=>M(null)})]})}function Kt({request:t,onClose:d}){const m=t.status==="completed"||t.status==="success",_=t.inputTokens||t.tokensIn||0,u=t.outputTokens||t.tokensOut||0,N=t.processingTime||t.durationMs||0,g=t.estimatedCost||t.cost||0,S=M=>{navigator.clipboard.writeText(M),c.success("Copied to clipboard")};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:d,children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm"}),e.jsxs("div",{className:s(C,"relative w-[900px] max-w-[90vw] max-h-[85vh] flex flex-col"),onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:s("w-10 h-10 rounded-lg flex items-center justify-center",m?"bg-green-500/15":"bg-red-500/15"),children:m?e.jsx(oe,{className:"w-5 h-5 text-green-400"}):e.jsx(se,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:"LLM Request Details"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono",children:t.id||"—"})]})]}),e.jsx("button",{onClick:d,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-5",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Context:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.context||t.type||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Provider:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.provider||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Model:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.model||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Status:"})," ",e.jsx("span",{className:s("font-semibold ml-1",m?"text-green-400":"text-red-400"),children:t.status||"—"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx(V,{label:"Input Tokens",value:_.toLocaleString()}),e.jsx(V,{label:"Output Tokens",value:u.toLocaleString()}),e.jsx(V,{label:"Duration (ms)",value:Number(N).toLocaleString()}),e.jsx(V,{label:"Est. Cost",value:g?`$${Number(g).toFixed(6)}`:"—"})]}),e.jsxs("div",{className:s(C,"p-4"),children:[e.jsx("h4",{className:s(T,"mb-2"),children:"Timeline"}),e.jsxs("div",{className:"flex flex-wrap gap-6 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Queued:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.queuedAt?new Date(t.queuedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Started:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.startedAt?new Date(t.startedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Completed:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.completedAt?new Date(t.completedAt).toLocaleString():"—"})]})]})]}),(t.error||t.errorMessage)&&e.jsxs("div",{className:"rounded-lg border border-red-500/30 bg-red-500/5 p-4",children:[e.jsxs("h4",{className:"text-xs font-bold text-red-400 mb-1 flex items-center gap-1.5",children:[e.jsx(se,{className:"w-3.5 h-3.5"})," Error"]}),e.jsx("p",{className:"text-[10px] text-red-300 font-mono whitespace-pre-wrap",children:t.error||t.errorMessage}),t.attempts&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-2",children:["Attempt ",t.attempts,"/",t.maxAttempts||t.maxRetries||3]})]}),(t.prompt||t.input)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:T,children:"Prompt / Input"}),e.jsx("button",{onClick:()=>S(String(t.prompt||t.input)),className:G,children:"Copy"})]}),e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:String(t.prompt||t.input)})]}),(t.response||t.output||t.result)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:T,children:"Response / Output"}),e.jsx("button",{onClick:()=>S(String(t.response||t.output||t.result)),className:G,children:"Copy"})]}),e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:String(t.response||t.output||t.result)})]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer text-[10px] text-[var(--gm-accent-primary)] hover:underline",children:"Show Raw JSON Data"}),e.jsx("pre",{className:"mt-2 text-[10px] text-[var(--gm-text-tertiary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:JSON.stringify(t,null,2)})]})]})]})]})}function Vt(){const{data:t,isLoading:d}=ss(),{data:m,refetch:_}=ts(),{data:u}=as(),{data:N}=rs(),{data:g}=ns(),{data:S}=is();ls();const M=cs(),v=os(),w=ds(),j=xs(),E=ms(),x=ps(),p=us(),A=hs(),L=gs(),[r,i]=P.useState("status"),[l,b]=P.useState(""),[o,I]=P.useState(null);if(d)return e.jsx(Z,{});const H=D(t),z=D(H.config),f=D(m),k=D(u),a=D(N).graphs??[],h=D(g),R=D(S).providers??[],n=f.nodeCount??f.nodes??0,U=f.edgeCount??f.relationships??0,Q=!!f.connected,ee=D(k.metrics??k),te=k.recommendations??[];return e.jsxs("div",{className:"space-y-5",children:[e.jsx(Y,{title:"Knowledge Graph",subtitle:`${z.provider||"—"} · ${Q?`${n} nodes · ${U} edges`:"Not connected"}`}),e.jsx("div",{className:s(C,"p-1 flex gap-1"),children:["status","operations","graphs","query"].map(y=>e.jsx("button",{onClick:()=>i(y),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",r===y?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:y==="status"?"Status & Config":y==="operations"?"Sync & Maintenance":y==="graphs"?`Graphs (${a.length})`:"Query"},y))}),r==="status"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(C,"p-4 space-y-3"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:T,children:"Connection"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",Q?"bg-green-500/15 text-green-400":"bg-red-500/15 text-red-400"),children:Q?"Connected":"Disconnected"})]}),[["Provider",z.provider],["Graph Name",z.graphName],["Enabled",z.enabled?"Yes":"No"],["Auto Connect",z.autoConnect?"Yes":"No"],["Config Source",H.source]].map(([y,B])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:y}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono",children:String(B??"—")})]},y)),f.message&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:f.message}),e.jsxs("button",{onClick:()=>_(),className:s(G,"w-full justify-center"),children:[e.jsx(ce,{className:"w-3 h-3"})," Refresh Status"]})]}),e.jsxs("div",{className:s(C,"p-4 space-y-3"),children:[e.jsx("h3",{className:T,children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(V,{label:"Nodes",value:n,color:"var(--gm-accent-primary)"}),e.jsx(V,{label:"Edges",value:U,color:"var(--gm-accent-primary)"})]}),(()=>{const y=D(f.stats);return Object.keys(y).length>0?e.jsx("div",{className:"space-y-1.5",children:Object.entries(y).map(([B,W])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:B}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] tabular-nums",children:String(W)})]},B))}):null})()]})]}),(Object.keys(ee).length>0||te.length>0)&&e.jsxs("div",{className:s(C,"p-5 space-y-3"),children:[e.jsx("h3",{className:T,children:"Graph Insights"}),Object.keys(ee).length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(ee).map(([y,B])=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase mb-1",children:y.replace(/([A-Z])/g," $1").replace(/_/g," ")}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:typeof B=="number"?B<1?B.toFixed(3):B.toFixed(1):String(B)})]},y))}),te.length>0&&e.jsxs("div",{className:"space-y-1.5 mt-2",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Recommendations"}),te.map((y,B)=>e.jsxs("div",{className:"flex items-start gap-2 text-[10px]",children:[e.jsx("span",{className:s("shrink-0 mt-0.5",y.priority==="high"?"text-red-400":y.priority==="medium"?"text-amber-400":"text-blue-400"),children:"●"}),e.jsx("span",{className:"text-[var(--gm-text-secondary)]",children:y.message||y.text||y.description})]},B))]})]}),Object.keys(h).length>0&&h.ok!==void 0&&e.jsxs("div",{className:s(C,"p-4 space-y-2"),children:[e.jsx("h3",{className:T,children:"Sync Status"}),[["Status",h.status??h.syncStatus??"—"],["Last Sync",h.lastSyncAt?new Date(h.lastSyncAt).toLocaleString():"—"],["Pending",h.pending??"—"]].map(([y,B])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:y}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:String(B)})]},y))]}),R.length>0&&e.jsxs("div",{className:s(C,"p-4"),children:[e.jsx("h3",{className:s(T,"mb-2"),children:"Available Providers"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map((y,B)=>e.jsx("span",{className:s("text-[10px] px-2.5 py-1 rounded-lg border font-medium",(y.id||y.name)===z.provider?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:y.name||y.id||"?"},B))})]})]}),r==="operations"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsx("h3",{className:T,children:"Sync"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>M.mutate(void 0,{onSuccess:()=>c.success("Sync complete"),onError:y=>c.error(y.message)}),disabled:M.isPending,className:K,children:[M.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"})," Quick Sync"]}),e.jsxs("button",{onClick:()=>v.mutate(void 0,{onSuccess:()=>c.success("Full sync complete"),onError:y=>c.error(y.message)}),disabled:v.isPending,className:K,children:[v.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ce,{className:"w-3.5 h-3.5"})," Full Sync"]}),e.jsxs("button",{onClick:()=>L.mutate(void 0,{onSuccess:()=>c.success("All projects synced"),onError:y=>c.error(y.message)}),disabled:L.isPending,className:G,children:[L.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ee,{className:"w-3.5 h-3.5"})," Sync All Projects"]})]})]}),e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsx("h3",{className:T,children:"Indexes & Optimization"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsxs("button",{onClick:()=>w.mutate(void 0,{onSuccess:()=>c.success("Indexes created"),onError:y=>c.error(y.message)}),disabled:w.isPending,className:G,children:[w.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ae,{className:"w-3.5 h-3.5"})," Create Indexes"]})})]}),e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsx("h3",{className:T,children:"Cleanup"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Remove orphaned graphs, duplicate nodes, and stale relationships"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>j.mutate(void 0,{onSuccess:y=>c.success(`Cleaned ${y?.deleted??"?"} orphans`),onError:y=>c.error(y.message)}),disabled:j.isPending,className:G,children:[j.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(he,{className:"w-3.5 h-3.5"})," Cleanup Orphan Graphs"]}),e.jsxs("button",{onClick:()=>E.mutate(void 0,{onSuccess:()=>c.success("Duplicates cleaned"),onError:y=>c.error(y.message)}),disabled:E.isPending,className:G,children:[E.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Me,{className:"w-3.5 h-3.5"})," Cleanup Duplicates"]}),e.jsxs("button",{onClick:()=>x.mutate(void 0,{onSuccess:()=>c.success("Sync cleanup done"),onError:y=>c.error(y.message)}),disabled:x.isPending,className:G,children:[x.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(he,{className:"w-3.5 h-3.5"})," Sync Cleanup"]})]})]})]}),r==="graphs"&&e.jsx("div",{className:"space-y-5",children:a.length>0?e.jsxs("div",{className:s(C,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:T,children:"All Graphs"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Graph","Project","Nodes","Edges","Status",""].map(y=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:y},y))})}),e.jsx("tbody",{children:a.map((y,B)=>{const W=y.name||y.graphName||"—",ae=W===z.graphName;return e.jsxs("tr",{className:s("border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",ae&&"bg-[var(--gm-accent-primary)]/5"),children:[e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:W}),ae&&e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded-full bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)] font-bold",children:"ACTIVE"})]})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)]",children:y.projectName||y.projectId||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-primary)] tabular-nums",children:y.nodeCount??y.nodes??"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-primary)] tabular-nums",children:y.edgeCount??y.edges??"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-1.5 py-0.5 rounded-full font-medium",y.orphan?"bg-amber-500/10 text-amber-400":"bg-green-500/10 text-green-400"),children:y.orphan?"Orphan":"Active"})}),e.jsx("td",{className:"px-4 py-2.5",children:!ae&&e.jsx("button",{onClick:()=>{confirm(`Delete graph "${W}"?`)&&p.mutate(W,{onSuccess:()=>c.success(`Deleted ${W}`),onError:J=>c.error(J.message)})},disabled:p.isPending,className:"text-[9px] text-red-400 hover:underline font-medium",children:"Delete"})})]},B)})})]})})]}):e.jsx(ne,{msg:"No graphs found. Connect to a graph provider first."})}),r==="query"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(C,"p-5 space-y-3"),children:[e.jsx("h3",{className:T,children:"Cypher Query"}),e.jsx("textarea",{value:l,onChange:y=>b(y.target.value),placeholder:"MATCH (n) RETURN n LIMIT 10",rows:4,className:s(F,"w-full font-mono text-xs resize-y")}),e.jsxs("button",{onClick:()=>A.mutate({query:l},{onSuccess:y=>{I(y),c.success("Query executed")},onError:y=>c.error(y.message)}),disabled:A.isPending||!l.trim(),className:K,children:[A.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(le,{className:"w-3.5 h-3.5"})," Execute"]})]}),o&&e.jsxs("div",{className:s(C,"p-5 space-y-3"),children:[e.jsx("h3",{className:T,children:"Result"}),(()=>{const y=D(o),B=y.nodes??[],W=y.edges??y.relationships??[],ae=y.rows??y.data??[];return e.jsxs("div",{className:"space-y-3",children:[B.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:["Nodes (",B.length,")"]}),e.jsx("div",{className:"mt-1 max-h-48 overflow-y-auto",children:B.slice(0,50).map((J,me)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-accent-primary)] font-medium",children:J.label||J.labels?.[0]||J.type||"?"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] truncate flex-1",children:J.name||J.title||J.id||JSON.stringify(J.properties||J).substring(0,80)})]},me))})]}),W.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:["Relationships (",W.length,")"]}),e.jsx("div",{className:"mt-1 max-h-48 overflow-y-auto",children:W.slice(0,50).map((J,me)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:J.source||J.from||"?"}),e.jsxs("span",{className:"text-[var(--gm-accent-primary)] font-medium",children:["→ ",J.type||J.label||"?"," →"]}),e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:J.target||J.to||"?"})]},me))})]}),ae.length>0&&B.length===0&&W.length===0&&e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] font-mono bg-[var(--gm-bg-tertiary)] p-3 rounded-lg overflow-auto max-h-64",children:JSON.stringify(ae,null,2)}),B.length===0&&W.length===0&&ae.length===0&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No results returned."})]})})()]})]})]})}function Ht(){return e.jsxs("div",{className:"space-y-5",children:[e.jsx(Y,{title:"Ontology",subtitle:"Full ontology management — entities, relations, AI, tools, inference, embeddings, and more"}),e.jsx("div",{className:s(C,"overflow-hidden"),style:{height:"calc(100vh - 220px)",minHeight:500},children:e.jsx(lt,{})})]})}const Te={extraction:"bg-blue-500/15 text-blue-400 border-blue-500/30",analysis:"bg-purple-500/15 text-purple-400 border-purple-500/30",template:"bg-amber-500/15 text-amber-400 border-amber-500/30",sprint:"bg-green-500/15 text-green-400 border-green-500/30",report:"bg-rose-500/15 text-rose-400 border-rose-500/30"};function Qt(){const{data:t,isLoading:d,error:m}=vs(),_=js(),u=ys(),[N,g]=P.useState("all"),[S,M]=P.useState(""),[v,w]=P.useState(null),[j,E]=P.useState(null),x=t?.templates??[];if(d)return e.jsx(Z,{});if(m)return e.jsx(ye,{msg:"Unable to load prompts."});const p=["all",...Array.from(new Set(x.map(i=>i.category))).sort()],A=x.filter(i=>{if(N!=="all"&&i.category!==N)return!1;if(S){const l=S.toLowerCase();return i.name.toLowerCase().includes(l)||i.id.toLowerCase().includes(l)||(i.description||"").toLowerCase().includes(l)}return!0}),L=x.reduce((i,l)=>(i[l.category]=(i[l.category]||0)+1,i),{}),r=i=>{_.mutate({key:i.id,is_active:!i.isActive},{onSuccess:()=>c.success(`${i.name} ${i.isActive?"deactivated":"activated"}`),onError:l=>c.error(l.message)})};return e.jsxs("div",{className:"space-y-5",children:[e.jsx(Y,{title:"Prompt Templates",subtitle:`${x.length} templates with auto-versioning across ${Object.keys(L).length} categories`}),e.jsxs("div",{className:s(C,"p-3 flex items-center gap-2 flex-wrap"),children:[p.map(i=>e.jsx("button",{onClick:()=>g(i),className:s("px-3 py-1.5 text-[11px] font-medium rounded-lg border transition-all capitalize",N===i?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-transparent text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:i==="all"?`All (${x.length})`:`${i} (${L[i]||0})`},i)),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{value:S,onChange:i=>M(i.target.value),placeholder:"Search prompts...",className:s(F,"w-48 pl-7 py-1.5 text-xs")})]})})]}),e.jsx("div",{className:"space-y-3",children:A.map(i=>e.jsxs("div",{className:s(C,"overflow-hidden group",!i.isActive&&"opacity-60"),children:[e.jsxs("div",{className:"px-5 py-3 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:i.name||"(unnamed)"}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",Te[i.category]||"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border-[var(--gm-border-primary)]"),children:i.category}),e.jsx("button",{onClick:()=>r(i),className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border cursor-pointer transition-colors",i.isActive?"bg-green-500/10 border-green-500/30 text-green-400 hover:bg-green-500/20":"bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20"),children:i.isActive?"Active":"Inactive"})]}),i.description&&e.jsx("p",{className:"text-[11px] text-[var(--gm-text-tertiary)] mt-1 line-clamp-1",children:i.description}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 flex-wrap",children:[e.jsx("span",{className:"text-[9px] font-mono text-[var(--gm-text-tertiary)]",children:i.id}),e.jsx("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:"·"}),e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:i.lastModified}),e.jsx("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:"·"}),i.variables?.slice(0,5).map(l=>e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] font-mono border border-[var(--gm-border-primary)]",children:`{{${l}}}`},l)),(i.variables?.length||0)>5&&e.jsxs("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:["+",i.variables.length-5," more"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[e.jsx("button",{onClick:()=>E(j===i.id?null:i.id),title:"Version History",className:"p-1.5 rounded-lg hover:bg-[var(--gm-surface-hover)] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:e.jsx(mt,{className:"w-3.5 h-3.5"})}),e.jsxs("button",{onClick:()=>w(i),className:K,children:[e.jsx(pt,{className:"w-3 h-3"})," Edit"]})]})]}),e.jsx("div",{className:"px-5 pb-3",children:e.jsxs("pre",{className:"text-[10px] text-[var(--gm-text-tertiary)]/70 max-h-12 overflow-hidden whitespace-pre-wrap font-mono leading-relaxed",children:[i.prompt.substring(0,300),i.prompt.length>300?"…":""]})}),j===i.id&&e.jsx(Wt,{promptKey:i.id,currentPrompt:i.prompt,onRestore:l=>u.mutate({key:i.id,version:l},{onSuccess:()=>{c.success(`Restored v${l}`),E(null)},onError:b=>c.error(b.message)})})]},i.id))}),A.length===0&&e.jsx(ne,{msg:S?"No prompts match your search.":"No prompt templates found."}),v&&e.jsx(Jt,{prompt:v,onClose:()=>w(null),onSave:(i,l,b)=>{const o={key:v.id};i!==v.prompt&&(o.prompt=i,l&&(o.change_reason=l)),b!==void 0&&b!==v.description&&(o.description=b),_.mutate(o,{onSuccess:()=>{c.success("Prompt saved"),w(null)},onError:I=>c.error(I.message)})},isSaving:_.isPending})]})}function Jt({prompt:t,onClose:d,onSave:m,isSaving:_}){const[u,N]=P.useState(t.prompt),[g,S]=P.useState(t.description||""),[M,v]=P.useState(""),[w,j]=P.useState("edit"),E=P.useRef(null),x=["document","transcript","conversation","vision","email"].includes(t.id)?t.id:null,{data:p}=Xs(w==="preview"&&x?x:null),A=D(p),L=l=>{const b=E.current;if(!b)return;const o=b.selectionStart,I=b.selectionEnd,H=`{{${l}}}`,z=u.substring(0,o)+H+u.substring(I);N(z),requestAnimationFrame(()=>{b.focus(),b.setSelectionRange(o+H.length,o+H.length)})},r=u!==t.prompt||g!==(t.description||""),i=u.split(`
`).length;return e.jsx(qs,{open:!0,onClose:d,children:e.jsxs(et,{className:"!max-w-5xl !max-h-[95vh] !p-0 flex flex-col bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-[var(--gm-border-primary)] flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}),e.jsx("h2",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:t.name||"(unnamed)"}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",Te[t.category]||"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border-[var(--gm-border-primary)]"),children:t.category}),e.jsx("span",{className:"text-[9px] font-mono text-[var(--gm-text-tertiary)]",children:t.id})]}),e.jsx("input",{value:g,onChange:l=>S(l.target.value),placeholder:"Add a description...",className:"mt-1.5 w-full text-[11px] text-[var(--gm-text-secondary)] bg-transparent border-0 outline-none placeholder:text-[var(--gm-text-placeholder)]"})]}),e.jsx("button",{onClick:d,className:"p-1.5 rounded-lg hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ge,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsxs("div",{className:"px-6 pt-2 flex items-center gap-1 border-b border-[var(--gm-border-primary)] shrink-0",children:[["edit","preview"].map(l=>e.jsx("button",{onClick:()=>j(l),className:s("px-3 py-2 text-[11px] font-medium capitalize border-b-2 -mb-px transition-colors",w===l?"border-[var(--gm-accent-primary)] text-[var(--gm-accent-primary)]":"border-transparent text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:l==="edit"?"Editor":"Preview"},l)),e.jsxs("span",{className:"ml-auto text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[i," lines · ",u.length," chars"]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden flex",children:w==="edit"?e.jsxs("div",{className:"flex flex-1 min-h-0",children:[e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx("textarea",{ref:E,value:u,onChange:l=>N(l.target.value),className:"w-full h-full min-h-[400px] bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 font-mono text-xs text-[var(--gm-text-primary)] resize-none outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] leading-relaxed",spellCheck:!1})}),e.jsxs("div",{className:"w-56 border-l border-[var(--gm-border-primary)] overflow-y-auto p-3 shrink-0 bg-[var(--gm-bg-secondary)]",children:[e.jsx("div",{className:s(T,"mb-2"),children:"Variables"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mb-3",children:"Click to insert at cursor position"}),e.jsx("div",{className:"space-y-1",children:t.variables.map(l=>e.jsx("button",{onClick:()=>L(l),className:"w-full text-left px-2 py-1.5 rounded-lg text-[10px] font-mono bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] hover:bg-[var(--gm-accent-primary)]/10 border border-[var(--gm-border-primary)] transition-colors truncate",children:`{{${l}}}`},l))}),t.variables.length===0&&e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] italic",children:"No variables detected"}),e.jsx("div",{className:s(T,"mt-4 mb-2"),children:"Common Variables"}),e.jsx("div",{className:"space-y-1",children:["CONTENT","FILENAME","ONTOLOGY_CONTEXT","CONTACTS_INDEX","ORG_INDEX","PROJECT_INDEX"].filter(l=>!t.variables.includes(l)).map(l=>e.jsx("button",{onClick:()=>L(l),className:"w-full text-left px-2 py-1.5 rounded-lg text-[10px] font-mono bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-accent-primary)]/10 border border-[var(--gm-border-primary)] transition-colors truncate",children:`{{${l}}}`},l))})]})]}):e.jsx("div",{className:"flex-1 overflow-auto p-6",children:x?A.prompt?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:s(T),children:["Rendered Prompt (",x,")"]}),e.jsx("pre",{className:"text-[11px] font-mono text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 max-h-[60vh] overflow-auto",children:typeof A.prompt=="string"?A.prompt:typeof A.prompt=="object"&&A.prompt!==null?JSON.stringify(A.prompt,null,2):String(A.prompt)}),A.ontologyContext&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s(T,"mt-4"),children:"Ontology Context"}),e.jsx("pre",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)] whitespace-pre-wrap bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-3 max-h-40 overflow-auto",children:JSON.stringify(A.ontologyContext,null,2)})]})]}):e.jsx("div",{className:"text-xs text-[var(--gm-text-tertiary)] py-8 text-center",children:"Loading preview..."}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:s(T),children:"Current Template"}),e.jsx("pre",{className:"text-[11px] font-mono text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 max-h-[60vh] overflow-auto",children:u}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Live preview is available for: document, transcript, conversation, vision, email prompts."})]})})}),e.jsxs("div",{className:"px-6 py-3 border-t border-[var(--gm-border-primary)] flex items-center gap-3 shrink-0 bg-[var(--gm-bg-secondary)]",children:[e.jsx("input",{value:M,onChange:l=>v(l.target.value),placeholder:"Change reason (optional)...",className:s(F,"flex-1 py-1.5 text-xs")}),e.jsxs("button",{onClick:d,className:G,children:[e.jsx(ge,{className:"w-3 h-3"})," Cancel"]}),e.jsxs("button",{onClick:()=>m(u,M,g),disabled:_||!r,className:K,children:[_?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"}),_?"Saving...":"Save Changes"]})]})]})})}function Wt({promptKey:t,currentPrompt:d,onRestore:m}){const{data:_,isLoading:u}=Ys(t),[N,g]=P.useState(null),{data:S}=Zs(t,N),M=D(_),v=M.versions??[],j=D(S).version??{};return u?e.jsxs("div",{className:"px-5 pb-3 text-xs text-[var(--gm-text-tertiary)]",children:[e.jsx($,{className:"w-3 h-3 animate-spin inline mr-1"}),"Loading versions..."]}):v.length===0?e.jsx("div",{className:"px-5 pb-3 text-xs text-[var(--gm-text-tertiary)] italic",children:"No previous versions."}):e.jsxs("div",{className:"border-t border-[var(--gm-border-primary)] bg-[var(--gm-bg-secondary)]",children:[e.jsxs("div",{className:"px-5 pt-3 pb-2 flex items-center justify-between",children:[e.jsx("span",{className:T,children:"Version History"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:["Current: v",M.current_version??"?"," · ",v.length," previous"]})]}),e.jsx("div",{className:"px-5 pb-3 space-y-1",children:v.map(E=>{const x=E.version,p=N===x;return e.jsxs("div",{children:[e.jsxs("div",{className:s("flex items-center gap-3 text-xs py-1.5 px-2.5 rounded-lg transition-colors",p?"bg-[var(--gm-accent-primary)]/10":"hover:bg-[var(--gm-surface-hover)]"),children:[e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] font-mono font-bold tabular-nums",children:["v",x]}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)] tabular-nums text-[10px]",children:E.created_at?new Date(E.created_at).toLocaleString():"—"}),E.change_reason&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-secondary)] italic truncate max-w-[200px]",children:E.change_reason}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("button",{onClick:()=>g(p?null:x),className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline font-medium",children:p?"Hide":"View"}),e.jsx("button",{onClick:()=>m(x),className:"text-[10px] text-amber-400 hover:underline font-medium",children:"Restore"})]})]}),p&&j.prompt_template&&e.jsx("div",{className:"mt-1 mb-2 mx-2",children:e.jsx("pre",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)] whitespace-pre-wrap bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-3 max-h-48 overflow-auto leading-relaxed",children:j.prompt_template})})]},E.id)})})]})}function Yt(){const{data:t}=st(),d=tt(),m=at(),_=rt(),u=nt(),N=t??{};return e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:T,children:"Knowledge Pipeline"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Embeddings: ",typeof N.embeddingsCount=="number"?N.embeddingsCount:"—"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:()=>d.mutate(void 0,{onSuccess:()=>c.success("Knowledge synthesis complete"),onError:g=>c.error(g.message)}),disabled:d.isPending,className:K,children:[d.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(le,{className:"w-3.5 h-3.5"}),"Synthesize"]}),e.jsxs("button",{onClick:()=>m.mutate(void 0,{onSuccess:()=>c.success("Embeddings generated"),onError:g=>c.error(g.message)}),disabled:m.isPending,className:K,children:[m.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(jt,{className:"w-3.5 h-3.5"}),"Generate Embeddings"]}),e.jsxs("button",{onClick:()=>u.mutate(void 0,{onSuccess:()=>c.success("Resynthesis complete"),onError:g=>c.error(g.message)}),disabled:u.isPending,className:G,children:[u.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ce,{className:"w-3.5 h-3.5"}),"Resynthesis"]}),e.jsxs("button",{onClick:()=>_.mutate(void 0,{onSuccess:()=>c.success("SOT regenerated"),onError:g=>c.error(g.message)}),disabled:_.isPending,className:G,children:[_.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ve,{className:"w-3.5 h-3.5"}),"Regenerate SOT"]})]})]})}function Zt(){const{data:t,isLoading:d}=bs(),m=Ns(),{data:_}=fs(),{data:u}=ws(),N=Cs(),[g,S]=P.useState({}),M=P.useRef(!1),v=D(t),w=D(v.processing),j=_??{},E=u??[];P.useEffect(()=>{!M.current&&Object.keys(w).length>0&&(S({chunkSize:w.chunkSize??4e3,chunkOverlap:w.chunkOverlap??200,similarityThreshold:w.similarityThreshold??.9,pdfToImages:w.pdfToImages??!0,autoProcess:w.autoProcess??!0,temperature:w.temperature??.7}),M.current=!0)},[w]);const x=P.useCallback(()=>{m.mutate({key:"processing",value:g,category:"processing"},{onSuccess:()=>c.success("Processing settings saved"),onError:b=>c.error(b.message)})},[g,m]),p=()=>{N.mutate(void 0,{onSuccess:()=>c.success("Processing started"),onError:b=>c.error(b.message)})};if(d)return e.jsx(Z,{});const A=j.status==="processing"||j.status==="running",L=Number(j.progress??0),r=j.currentFile||"",i=Number(j.totalFiles??0),l=Number(j.processedFiles??0);return e.jsxs("div",{className:"space-y-5",children:[e.jsx(Y,{title:"Document Processing",subtitle:"Pipeline status, controls, and configuration"}),e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:T,children:"Pipeline Status"}),e.jsxs("button",{onClick:p,disabled:N.isPending||A,className:K,children:[N.isPending||A?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(le,{className:"w-3.5 h-3.5"}),A?"Processing...":"Process All Pending"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:s(C,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("div",{className:s("w-2 h-2 rounded-full",A?"bg-green-400 animate-pulse":j.status==="error"?"bg-red-400":"bg-[var(--gm-text-tertiary)]")}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Status"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] capitalize",children:j.status||"idle"})]}),e.jsxs("div",{className:s(C,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(Ss,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Pending"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-accent-primary)]",children:E.length})]}),e.jsxs("div",{className:s(C,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(St,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Progress"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:i>0?`${l}/${i}`:"—"})]}),e.jsxs("div",{className:s(C,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(Se,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Completion"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:L>0?`${Math.round(L)}%`:"—"})]})]}),A&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full h-2 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)] transition-all duration-500 ease-out",style:{width:`${Math.max(L,2)}%`}})}),r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-3 h-3 animate-spin text-[var(--gm-accent-primary)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono truncate",children:r})]})]}),j.errors&&Array.isArray(j.errors)&&j.errors.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:s(T,"text-red-400"),children:"Errors"}),j.errors.slice(0,5).map((b,o)=>e.jsx("div",{className:"text-[10px] text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg px-3 py-1.5 font-mono",children:b.file||b.message||JSON.stringify(b)},o))]})]}),e.jsx(Yt,{}),E.length>0&&e.jsxs("div",{className:s(C,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:T,children:"Pending Files"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[E.length," files waiting"]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:E.map((b,o)=>e.jsxs("div",{className:"px-5 py-2 flex items-center gap-3 border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx(ve,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)] shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-[var(--gm-text-primary)] truncate",children:b.name||b.filename||b.file||"—"}),b.type&&e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:b.type})]}),b.size&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums shrink-0",children:[(Number(b.size)/1024).toFixed(1)," KB"]})]},o))})]}),e.jsxs("div",{className:s(C,"p-5 space-y-5"),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:T,children:"Chunking & Extraction"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Chunk Size (tokens)"}),e.jsx("input",{type:"number",value:g.chunkSize??"",onChange:b=>S(o=>({...o,chunkSize:Number(b.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Size of each text chunk for LLM processing"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Chunk Overlap (tokens)"}),e.jsx("input",{type:"number",value:g.chunkOverlap??"",onChange:b=>S(o=>({...o,chunkOverlap:Number(b.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Overlap between chunks to preserve context"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Similarity Threshold"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"1",value:g.similarityThreshold??"",onChange:b=>S(o=>({...o,similarityThreshold:Number(b.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Cosine similarity for dedup (0.0 – 1.0)"})]})]})]}),e.jsxs("div",{className:s(C,"p-5 space-y-5"),children:[e.jsx("h3",{className:T,children:"LLM & Generation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Temperature"}),e.jsx("input",{type:"number",step:"0.1",min:"0",max:"2",value:g.temperature??"",onChange:b=>S(o=>({...o,temperature:Number(b.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"LLM creativity (0 = deterministic, 1+ = creative)"})]}),e.jsx("div",{className:"flex flex-col justify-center",children:e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-medium",children:"PDF to Images"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Convert PDFs to images for vision model processing"})]}),e.jsx(xe,{checked:!!g.pdfToImages,onChange:b=>S(o=>({...o,pdfToImages:b}))})]})})]})]}),e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsx("h3",{className:T,children:"Automation"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-medium",children:"Auto-Process on Upload"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Automatically process documents when uploaded"})]}),e.jsx(xe,{checked:!!g.autoProcess,onChange:b=>S(o=>({...o,autoProcess:b}))})]})]}),e.jsxs("button",{onClick:x,disabled:m.isPending,className:K,children:[m.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save Processing Settings"]})]})}function Xt(){const{data:t,isLoading:d}=ks(),m=Ps(),{data:_}=As(),{data:u}=Ls(),{data:N}=Ms(),{data:g}=Es(),S=_s(),M=Rs(),v=Ts(),w=Ds(),[j,E]=P.useState({}),x=P.useRef(!1),[p,A]=P.useState("overview"),L=D(t),r=D(L.config),i=D(_).profiles??[],l=D(D(u).analysis),b=D(N).relationships??[],o=D(g).projects??[];P.useEffect(()=>{!x.current&&Object.keys(r).length>0&&(E({...r}),x.current=!0)},[r]);const I=P.useCallback(()=>{m.mutate(j,{onSuccess:()=>c.success("Configuration saved"),onError:n=>c.error(n.message)})},[j,m]),H=()=>{S.mutate({forceReanalysis:!1},{onSuccess:()=>c.success("Team analysis completed"),onError:n=>c.error(n.message)})};if(d)return e.jsx(Z,{});const z=Number(l.cohesion_score??0),f=l.tension_level||"—",k=l.alliances??[],a=l.tensions??[],h=[{key:"includePersonality",label:"Personality Analysis",desc:"Behavioral profiling and communication identity"},{key:"includeSentiment",label:"Sentiment Tracking",desc:"Emotional tone and sentiment trends"},{key:"includeCommunication",label:"Communication Patterns",desc:"Speaking style, directness, verbosity"},{key:"includeCollaboration",label:"Collaboration Metrics",desc:"Teamwork, alignment, and cooperation signals"}],R=i.reduce((n,U)=>{const Q=U.confidence_level||"low";return n[Q]=(n[Q]||0)+1,n},{});return e.jsxs("div",{className:"space-y-5",children:[e.jsx(Y,{title:"Team Behavioral Analysis",subtitle:`${i.length} profiles · ${b.length} relationships · Cohesion ${z||"—"}%`}),e.jsx("div",{className:s(C,"p-1 flex gap-1"),children:["overview","config","projects"].map(n=>e.jsx("button",{onClick:()=>A(n),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",p===n?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:n==="overview"?"Overview & Analysis":n==="config"?"Configuration":"Projects"},n))}),p==="overview"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(C,"p-4 flex items-center gap-3 flex-wrap"),children:[e.jsxs("button",{onClick:H,disabled:S.isPending,className:K,children:[S.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(le,{className:"w-3.5 h-3.5"}),S.isPending?"Analyzing...":"Run Team Analysis"]}),e.jsxs("button",{onClick:()=>v.mutate(void 0,{onSuccess:()=>c.success("Graph synced"),onError:n=>c.error(n.message)}),disabled:v.isPending,className:G,children:[v.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ke,{className:"w-3.5 h-3.5"}),"Sync to Graph"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(V,{label:"Profiles",value:i.length,color:"var(--gm-accent-primary)"}),e.jsx(V,{label:"Relationships",value:b.length,color:"var(--gm-accent-primary)"}),e.jsx(V,{label:"Cohesion",value:z>0?`${z}%`:"—",color:z>=70?"#22c55e":z>=40?"#f59e0b":"#ef4444"}),e.jsx(V,{label:"Alliances",value:k.length,color:"#22c55e"}),e.jsx(V,{label:"Tensions",value:a.length,color:"#ef4444"})]}),l.analysis_data&&e.jsxs("div",{className:s(C,"p-5 space-y-3"),children:[e.jsx("h3",{className:T,children:"Team Dynamics"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Tension Level"}),e.jsx("div",{className:s("text-sm font-bold capitalize",f==="high"?"text-red-400":f==="medium"?"text-amber-400":"text-green-400"),children:f})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Team Size"}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:l.team_size||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Communication"}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] truncate",children:l.dominant_communication_pattern||"—"})]})]})]}),i.length>0&&e.jsxs("div",{className:s(C,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:T,children:"Behavioral Profiles"}),e.jsx("div",{className:"flex gap-1.5",children:Object.entries(R).map(([n,U])=>e.jsxs("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",n==="very_high"||n==="high"?"bg-green-500/10 border-green-500/30 text-green-400":n==="medium"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:[U," ",n.replace("_"," ")]},n))})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Person","Style","Motivation","Risk","Influence","Confidence","Transcripts",""].map(n=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:n},n))})}),e.jsx("tbody",{children:i.map((n,U)=>{const Q=D(n.contact),ee=Q.full_name||Q.name||n.contact_id||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:ee}),Q.role&&e.jsx("div",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:Q.role})]}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-secondary)] capitalize",children:n.communication_style||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-secondary)] capitalize",children:n.dominant_motivation||"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize",n.risk_tolerance==="high"?"bg-red-500/10 text-red-400":n.risk_tolerance==="medium"?"bg-amber-500/10 text-amber-400":"bg-green-500/10 text-green-400"),children:n.risk_tolerance||"—"})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-12 h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)]",style:{width:`${Number(n.influence_score??0)}%`}})}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-primary)] tabular-nums font-semibold",children:n.influence_score??0})]})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize",n.confidence_level==="high"||n.confidence_level==="very_high"?"bg-green-500/10 text-green-400":n.confidence_level==="medium"?"bg-amber-500/10 text-amber-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"),children:(n.confidence_level||"—").replace("_"," ")})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:n.transcript_count??0}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("button",{onClick:()=>M.mutate({personId:n.contact_id||n.id,forceReanalysis:!0},{onSuccess:()=>c.success(`Re-analyzed ${ee}`),onError:te=>c.error(te.message)}),disabled:M.isPending,className:"text-[9px] text-[var(--gm-accent-primary)] hover:underline font-medium",children:"Re-analyze"})})]},U)})})]})})]}),b.length>0&&e.jsxs("div",{className:s(C,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:T,children:"Behavioral Relationships"})}),e.jsx("div",{className:"overflow-x-auto max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)] sticky top-0 bg-[var(--gm-surface-primary)]",children:["From","To","Type","Strength","Confidence"].map(n=>e.jsx("th",{className:s(O,"px-4 py-2 text-left"),children:n},n))})}),e.jsx("tbody",{children:b.map((n,U)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2 text-xs text-[var(--gm-text-primary)]",children:n.from_name||n.from_contact_id||"—"}),e.jsx("td",{className:"px-4 py-2 text-xs text-[var(--gm-text-primary)]",children:n.to_name||n.to_contact_id||"—"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize border",n.relationship_type==="tension_with"||n.relationship_type==="competes_with"?"bg-red-500/10 border-red-500/30 text-red-400":n.relationship_type==="aligned_with"||n.relationship_type==="supports"||n.relationship_type==="mentors"?"bg-green-500/10 border-green-500/30 text-green-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:(n.relationship_type||"—").replace(/_/g," ")})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-10 h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)]",style:{width:`${Math.round(Number(n.strength??0)*100)}%`}})}),e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[(Number(n.strength??0)*100).toFixed(0),"%"]})]})}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:n.confidence||"—"})]},U))})]})})]}),i.length===0&&e.jsx(ne,{msg:"No behavioral profiles yet. Run Team Analysis to start profiling."})]}),p==="config"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(C,"p-5 space-y-5"),children:[e.jsx("h3",{className:T,children:"Analysis Parameters"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Frequency"}),e.jsxs("select",{value:j.analysisFrequency||"weekly",onChange:n=>E(U=>({...U,analysisFrequency:n.target.value})),className:s(F,"w-full"),children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"How often to auto-run analysis"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Min Meetings"}),e.jsx("input",{type:"number",min:"1",value:j.minMeetingsForAnalysis??3,onChange:n=>E(U=>({...U,minMeetingsForAnalysis:Number(n.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Minimum transcripts before profiling"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Sentiment Threshold"}),e.jsx("input",{type:"number",step:"0.1",min:"-1",max:"0",value:j.sentimentThreshold??-.3,onChange:n=>E(U=>({...U,sentimentThreshold:Number(n.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Alert below this score (-1 to 0)"})]})]})]}),e.jsxs("div",{className:s(C,"p-5 space-y-3"),children:[e.jsx("h3",{className:T,children:"Analysis Modules"}),h.map(({key:n,label:U,desc:Q})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:U}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:Q})]}),e.jsx(xe,{checked:j[n]!==!1,onChange:ee=>E(te=>({...te,[n]:ee}))})]},n))]}),e.jsxs("button",{onClick:I,disabled:m.isPending,className:K,children:[m.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save Configuration"]})]}),p==="projects"&&e.jsx("div",{className:"space-y-5",children:o.length>0?e.jsxs("div",{className:s(C,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:T,children:"All Projects — Analysis Status"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Project","Enabled","Last Analysis",""].map(n=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:n},n))})}),e.jsx("tbody",{children:o.map((n,U)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs font-medium text-[var(--gm-text-primary)]",children:n.name||n.id||"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium",n.isEnabled?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"),children:n.isEnabled?"Enabled":"Disabled"})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:n.lastAnalysisAt?new Date(n.lastAnalysisAt).toLocaleString():"Never"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("button",{onClick:()=>w.mutate({projectId:n.id},{onSuccess:()=>c.success(`Analysis triggered for ${n.name}`),onError:Q=>c.error(Q.message)}),disabled:w.isPending,className:K,children:[w.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(le,{className:"w-3 h-3"})," Analyze"]})})]},U))})]})})]}):e.jsx(ne,{msg:"No projects found or admin endpoint not available."})})]})}function qt(){const{data:t,isLoading:d}=Is(),m=Os(),_=$s(),u=Fs(),[N,g]=P.useState(""),[S,M]=P.useState(""),[v,w]=P.useState(!1),[j,E]=P.useState(""),[x,p]=P.useState(!1),A=P.useRef(null),L=D(t),r=!!L.enabled,i=!!L.hasSystemCredentials,l=L.rootFolderId??"",b=L.bootstrappedAt,o=L.pendingProjects??[],I=L.configuredProjects??[];P.useEffect(()=>{!d&&t&&g(l)},[d,t,l]);const H=P.useCallback(k=>{const a=k.target.files?.[0];if(!a)return;E(a.name);const h=new FileReader;h.onload=R=>{const n=R.target?.result;try{JSON.parse(n),M(n),p(!0),c.success("Service account JSON loaded")}catch{c.error("Invalid JSON file")}},h.readAsText(a),A.current&&(A.current.value="")},[]),z=P.useCallback(()=>{const k={enabled:r,rootFolderId:N.trim()};S&&(k.serviceAccountJson=S),m.mutate(k,{onSuccess:()=>{c.success("Configuration saved to Supabase vault"),M(""),E(""),p(!1)},onError:a=>c.error(a.message)})},[r,N,S,m]);if(d)return e.jsx(Z,{});const f=x||N!==l;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{title:"Google Drive Integration",subtitle:"Credentials stored encrypted in Supabase vault — never in .env"}),e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4"})," Connection Status"]}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",i&&r?"bg-green-500/15 text-green-400":"bg-red-500/15 text-red-400"),children:i&&r?"Connected":i?"Disabled":"Not Configured"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Service Account"}),e.jsx("span",{className:s("font-medium",i?"text-green-400":"text-red-400"),children:i?"Uploaded (encrypted)":"Not uploaded"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Root Folder"}),e.jsx("span",{className:s("font-mono text-[11px]",l?"text-[var(--gm-text-primary)]":"text-red-400"),children:l||"Not set"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Integration"}),e.jsx("span",{className:s("font-medium",r?"text-green-400":"text-[var(--gm-text-tertiary)]"),children:r?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Last Bootstrap"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] tabular-nums",children:b?new Date(b).toLocaleString():"Never"})]})]})]}),e.jsxs("div",{className:s(C,"p-5 space-y-5"),children:[e.jsx("h3",{className:s(T),children:"Configuration"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[var(--gm-text-primary)] font-medium",children:"Enable Integration"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5",children:"Activate Google Drive sync for all projects"})]}),e.jsx(xe,{checked:r,onChange:k=>m.mutate({enabled:k,rootFolderId:N||l},{onSuccess:()=>c.success(k?"Integration enabled":"Integration disabled"),onError:a=>c.error(a.message)}),disabled:m.isPending})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] flex items-center gap-1.5",children:[e.jsx(Ne,{className:"w-3 h-3"})," Root Folder ID"]}),e.jsx("input",{type:"text",value:N,onChange:k=>{g(k.target.value),p(!0)},placeholder:"e.g. 1ABC2DEF3GHI4JKL5MNO6PQR...",className:s(F,"w-full font-mono text-[11px]")}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"The Google Drive folder ID where all project folders will be created. Find it in the Drive folder URL after /folders/."})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] flex items-center gap-1.5",children:[e.jsx(ht,{className:"w-3 h-3"})," Service Account JSON"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>A.current?.click(),className:G,children:[e.jsx(gt,{className:"w-3 h-3"})," Upload JSON File"]}),e.jsx("input",{ref:A,type:"file",accept:".json,application/json",onChange:H,className:"hidden"}),j&&e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," ",j]}),!j&&i&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Credentials already stored (encrypted in Supabase vault)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:S,onChange:k=>{M(k.target.value),p(!0)},placeholder:"Or paste the service account JSON here...",rows:4,className:s(F,"w-full font-mono text-[10px] leading-relaxed resize-none",!v&&S?"text-transparent":"")}),S&&e.jsx("button",{onClick:()=>w(!v),className:"absolute top-2 right-2 p-1 rounded hover:bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:v?e.jsx(vt,{className:"w-3 h-3"}):e.jsx(Le,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Download from Google Cloud Console > IAM > Service Accounts > Keys. The JSON is encrypted at rest via pgcrypto."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-[var(--gm-border-primary)]",children:[e.jsxs("button",{onClick:z,disabled:m.isPending||!f,className:K,children:[m.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"}),"Save Configuration"]}),f&&e.jsxs("span",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Unsaved changes"]})]})]}),e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsx("h3",{className:s(T),children:"Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>u.mutate(void 0,{onSuccess:k=>{const a=D(k);c.success(a.message||"Bootstrap complete")},onError:k=>c.error(k.message)}),disabled:u.isPending||!i||!r,className:K,children:[u.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(Ne,{className:"w-3 h-3"}),"Bootstrap All Projects"]}),e.jsxs("button",{onClick:()=>_.mutate(void 0,{onSuccess:()=>c.success("Sync started"),onError:k=>c.error(k.message)}),disabled:_.isPending||!i||!r,className:G,children:[_.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(re,{className:"w-3 h-3"}),"Sync Now"]})]}),!i&&e.jsxs("p",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Upload service account credentials to enable actions"]}),i&&!r&&e.jsxs("p",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Enable the integration to use these actions"]})]}),I.length>0&&e.jsxs("div",{className:s(C,"p-5"),children:[e.jsxs("h3",{className:s(T,"mb-3"),children:["Configured Projects (",I.length,")"]}),e.jsx("div",{className:"space-y-0",children:I.map((k,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 text-xs border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium",children:k.name}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)] font-mono text-[10px]",children:k.folderId})]},a))})]}),o.length>0&&e.jsxs("div",{className:s(C,"p-5"),children:[e.jsxs("h3",{className:s(T,"mb-3"),children:["Pending Projects (",o.length,")"]}),e.jsx("div",{className:"space-y-0",children:o.map((k,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 text-xs border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:k.name}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-amber-500/15 text-amber-400",children:"Pending"})]},a))})]})]})}function ea(){const{data:t}=Us(),{data:d}=zs(),{data:m,isLoading:_,refetch:u}=Gs(),N=Bs(),g=Ks(),S=Vs(),M=Hs(),[v,w]=P.useState({}),j=P.useRef(!1),[E,x]=P.useState(null),[p,A]=P.useState(50),L=D(t),r=D(D(d).config),i=D(m).projects??[];return P.useEffect(()=>{!j.current&&Object.keys(r).length>0&&(w({...r}),j.current=!0)},[r]),_?e.jsx(Z,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(Y,{title:"Billing & Cost Control",subtitle:"Manage project balances, pricing, and cost limits"}),e.jsxs("div",{className:s(C,"p-5 space-y-3"),children:[e.jsx("h3",{className:T,children:"Exchange Rate (USD to EUR)"}),L.auto!=null&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-3 h-3 text-[var(--gm-accent-primary)]"}),e.jsx("span",{className:"text-xs text-[var(--gm-accent-primary)]",children:L.auto?"Automatic rate from API":"Manual rate"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-[var(--gm-accent-primary)]",children:"Current Rate: "}),e.jsx("span",{className:"text-lg font-bold text-[var(--gm-text-primary)] tabular-nums",children:String(L.currentRate??L.rate??"—")})]}),e.jsxs("div",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Source: ",String(L.source??"api")," · Updated: ",L.lastUpdated||L.updatedAt?new Date(L.lastUpdated||L.updatedAt).toLocaleString():"—"]}),!L.auto&&e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"Manual Rate"}),e.jsx("input",{type:"number",step:"0.0001",min:"0",defaultValue:Number(L.manualRate??L.currentRate??.92),onBlur:l=>S.mutate({auto:!1,manualRate:Number(l.target.value)},{onSuccess:()=>c.success("Manual rate saved"),onError:b=>c.error(b.message)}),className:s(F,"w-40")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N.mutate(void 0,{onSuccess:()=>c.success("Rate refreshed"),onError:l=>c.error(l.message)}),disabled:N.isPending,className:G,children:[N.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(re,{className:"w-3 h-3"})," Refresh Rate"]}),e.jsxs("button",{onClick:()=>S.mutate({auto:!(L.auto??!0)},{onSuccess:()=>c.success("Exchange rate mode updated"),onError:l=>c.error(l.message)}),disabled:S.isPending,className:G,children:["Switch to ",L.auto?"Manual":"Automatic"]})]})]}),e.jsxs("div",{className:s(C,"p-5 space-y-3"),children:[e.jsx("h3",{className:T,children:"Global Pricing Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"Fixed Markup (%)"}),e.jsx("input",{type:"number",value:v.fixed_markup_percent??0,onChange:l=>w(b=>({...b,fixed_markup_percent:Number(l.target.value)})),className:s(F,"w-full")})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"Period Type"}),e.jsxs("select",{value:v.period_type??"monthly",onChange:l=>w(b=>({...b,period_type:l.target.value})),className:s(F,"w-full"),children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"weekly",children:"Weekly"})]})]})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Applied when no tier matches"}),e.jsxs("button",{onClick:()=>g.mutate(v,{onSuccess:()=>c.success("Global pricing saved"),onError:l=>c.error(l.message)}),disabled:g.isPending,className:K,children:[g.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save Global Pricing"]})]}),i.map((l,b)=>{const o=l.project_id||l.id,I=l.key_sources??{},H=!!l.all_own_keys,z=!!l.uses_own_keys,f=Object.entries(I),k=!!(l.is_blocked||l.status==="blocked"),a=!!l.unlimited_balance,h=Number(l.balance_eur??l.balance??0);return e.jsxs("div",{className:s(C,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:l.name||l.project_name||o}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[k?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-semibold bg-red-500/15 text-red-400",children:"BLOCKED"}):a?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-semibold bg-green-500/15 text-green-400",children:"UNLIMITED"}):h<=0?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-semibold bg-amber-500/15 text-amber-400",children:"NO BALANCE"}):e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-semibold bg-blue-500/15 text-blue-400",children:"ACTIVE"}),f.length>0&&(H?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-purple-500/15 text-purple-400 font-semibold",children:"BYOK"}):z?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-amber-500/15 text-amber-400 font-semibold",children:"MIXED"}):e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-500/15 text-blue-400 font-semibold",children:"SYSTEM"})),f.map(([R,n])=>e.jsxs("span",{className:s("text-[9px] px-1 py-px rounded",n==="project"?"bg-purple-500/10 text-purple-300":"bg-blue-500/10 text-blue-300"),children:[R,":",n[0]?.toUpperCase()]},R))]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-[var(--gm-text-primary)] tabular-nums",children:a?"∞":`${h.toFixed(2)} €`}),e.jsxs("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[l.tokens_this_period!=null?`${(Number(l.tokens_this_period)/1e3).toFixed(1)}K tokens`:"—"," · ",l.billable_cost_this_period!=null?`${Number(l.billable_cost_this_period).toFixed(2)} € spent`:"—"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 pt-2 border-t border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-2 rounded-lg bg-[var(--gm-surface-secondary)]",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-[var(--gm-text-primary)]",children:"Active"}),e.jsx("div",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:k?"Blocked by admin":"Accepting requests"})]}),e.jsx("button",{onClick:()=>{M.mutate({projectId:o,action:"block",data:{blocked:!k}},{onSuccess:()=>{c.success(k?"Project unblocked":"Project blocked"),u()},onError:R=>c.error(`Failed: ${R.message}`)})},disabled:M.isPending,className:s("relative inline-flex h-5 w-9 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 focus:outline-none",k?"bg-red-500/60":"bg-green-500"),children:e.jsx("span",{className:s("pointer-events-none inline-block h-4 w-4 rounded-full bg-white shadow-lg transform transition-transform duration-200",k?"translate-x-0":"translate-x-4")})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-2 rounded-lg bg-[var(--gm-surface-secondary)]",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-[var(--gm-text-primary)]",children:"Unlimited"}),e.jsx("div",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:a?"No balance limits":"Uses balance"})]}),e.jsx("button",{onClick:()=>{M.mutate({projectId:o,action:"unlimited",data:{unlimited:!a}},{onSuccess:()=>{c.success(a?"Unlimited removed":"Set to unlimited"),u()},onError:R=>c.error(`Failed: ${R.message}`)})},disabled:M.isPending,className:s("relative inline-flex h-5 w-9 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 focus:outline-none",a?"bg-green-500":"bg-[var(--gm-border-primary)]"),children:e.jsx("span",{className:s("pointer-events-none inline-block h-4 w-4 rounded-full bg-white shadow-lg transform transition-transform duration-200",a?"translate-x-4":"translate-x-0")})})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-[var(--gm-surface-secondary)]",children:[e.jsx("div",{className:"text-[11px] font-semibold text-[var(--gm-text-primary)] whitespace-nowrap",children:"Add Credit"}),e.jsx("input",{type:"number",min:1,step:10,value:p,onChange:R=>A(Number(R.target.value)),className:s(F,"w-20 text-xs py-1")}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"EUR"}),e.jsx("button",{onClick:()=>{M.mutate({projectId:o,action:"balance",data:{amount:p,description:"Admin credit"}},{onSuccess:()=>{c.success(`Added ${p} EUR credit`),u()},onError:R=>c.error(`Credit failed: ${R.message}`)})},disabled:M.isPending||p<=0,className:s(K,"text-[10px] py-1 px-3"),children:M.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ue,{className:"w-3 h-3"})})]})]})]},b)}),i.length===0&&e.jsx("div",{className:s(C,"p-8 text-center text-sm text-[var(--gm-text-tertiary)]"),children:"No projects found."}),e.jsxs("button",{onClick:()=>u(),className:G,children:[e.jsx(re,{className:"w-3 h-3"})," Refresh Projects"]})]})}function sa(){const[t,d]=P.useState(""),[m,_]=P.useState(""),[u,N]=P.useState(1),g=50,{data:S,isLoading:M}=Qs({page:u,limit:g,search:t||void 0,filter:m||void 0}),{data:v}=Js(),w=D(S),j=w.logs??[],x=D(v).logs??[],p=P.useMemo(()=>{const r=[...j,...x];return r.sort((i,l)=>{const b=new Date(i.changed_at||i.timestamp||i.created_at||"1970-01-01").getTime()||0;return(new Date(l.changed_at||l.timestamp||l.created_at||"1970-01-01").getTime()||0)-b}),r},[j,x]),A=w.total??p.length;if(M)return e.jsx(Z,{});const L=r=>r==="critical"||r==="error"?"bg-red-500/15 text-red-400":r==="warning"?"bg-amber-500/15 text-amber-400":"bg-blue-500/15 text-blue-400";return e.jsxs("div",{className:"space-y-5",children:[e.jsx(Y,{title:"Audit Log"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(je,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{placeholder:"Search...",value:t,onChange:r=>{d(r.target.value),N(1)},className:s(F,"flex-1")})]}),e.jsxs("select",{value:m,onChange:r=>{_(r.target.value),N(1)},className:s(F,"w-28"),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{className:s(C,"overflow-hidden"),children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["TIMESTAMP","USER","ACTION","DETAILS","SEVERITY","IP"].map(r=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:r},r))})}),e.jsx("tbody",{children:p.map((r,i)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums whitespace-nowrap",children:r.changed_at||r.timestamp||r.created_at?new Date(r.changed_at||r.timestamp||r.created_at).toLocaleString():"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs font-medium text-[var(--gm-text-primary)]",children:r.changed_by_email||r.user||r.actor||"System"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-secondary)]",children:r.action||r.operation||r.event_type||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] max-w-[200px] truncate",children:r.details||r.config_key||r.table_name||r.description||""}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",L(r.severity||r.level||"info")),children:r.severity||r.level||"info"})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] font-mono",children:r.ip||r.ip_address||""})]},i))})]}),p.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No audit log entries."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[A," entries"]}),A>g&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(r=>Math.max(1,r-1)),disabled:u<=1,className:G,children:"Previous"}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] self-center",children:["Page ",u]}),e.jsx("button",{onClick:()=>N(r=>r+1),disabled:p.length<g,className:G,children:"Next"})]})]})]})}function _a(){const[t,d]=P.useState("users");return e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-48 shrink-0 border-r border-[var(--gm-border-primary)] bg-[var(--gm-bg-primary)] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-4 border-b border-[var(--gm-border-primary)]",children:[e.jsx(De,{className:"w-4 h-4 text-[var(--gm-accent-primary)]",style:{filter:"drop-shadow(0 0 6px var(--gm-accent-primary))"}}),e.jsx("span",{className:"text-sm font-bold text-[var(--gm-accent-primary)]",children:"Admin"})]}),e.jsx("nav",{className:"py-2",children:It.map(m=>{const _=m.icon,u=t===m.key;return e.jsxs("button",{onClick:()=>d(m.key),className:s("w-full flex items-center gap-2.5 px-4 py-2 text-xs transition-colors",u?"text-[var(--gm-accent-primary)] bg-[var(--gm-surface-hover)] font-semibold":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)]"),children:[e.jsx(_,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"flex-1 text-left",children:m.label}),u&&e.jsx(Oe,{className:"w-3 h-3 shrink-0"})]},m.key)})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx(Ot,{}),t==="users"&&e.jsx($t,{}),t==="system"&&e.jsx(Ft,{}),t==="llm-providers"&&e.jsx(zt,{}),t==="model-metadata"&&e.jsx(Gt,{}),t==="llm-queue"&&e.jsx(Bt,{}),t==="graph"&&e.jsx(Vt,{}),t==="ontology"&&e.jsx(Ht,{}),t==="prompts"&&e.jsx(Qt,{}),t==="processing"&&e.jsx(Zt,{}),t==="team-analysis"&&e.jsx(Xt,{}),t==="google-drive"&&e.jsx(qt,{}),t==="billing"&&e.jsx(ea,{}),t==="audit-log"&&e.jsx(sa,{})]})]})}export{_a as default};
//# sourceMappingURL=AdminPage-Dr4jEMnq.js.map
