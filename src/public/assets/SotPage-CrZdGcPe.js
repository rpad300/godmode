import{o as st,j as e,a as E,g as rt,af as Ae,r as l,ag as pe,a2 as ie,a3 as pt,a5 as G,ah as ut,N as _,O as j,ai as $,ad as de,aa as gt,aj as X,ak as ht,K as ze,C as be,T as vt,ab as bt,al as yt,am as ft,an as at,Y as De,ae as Se,ao as jt,ap as Nt,aq as wt,ar as kt,as as St,at as Ct,au as At,l as Dt,s as It,av as Mt,aw as Lt,ax as Et,ay as $t,az as Rt,n as Ft,aA as _t,aB as Pt,aC as Ot,aD as zt,aE as Tt,aF as Ut,aG as Qt,aH as Ht,aI as Vt,aJ as Bt,aK as Gt,aL as Wt,aM as Jt,aN as Zt,aO as Kt,aP as Xt,aQ as Yt,aR as qt,aS as es,aT as ts,aU as ss,aV as rs,aW as as,aX as is,aY as ns,aZ as ls,a_ as cs,a$ as os,Z as ds,b0 as ms}from"./main-DPJZnN-g.js";import{E as xs}from"./ErrorState-CGhToI5I.js";import{S as ps}from"./PageSkeleton-nlA0KD6o.js";import{C as xe}from"./chevron-down-DvtyaUz8.js";import{W as ae}from"./wand-sparkles--tVzPohn.js";import{S as H}from"./sparkles-B7v1H-ZZ.js";import{P as ue}from"./plus-D_qMNj9L.js";import{A as ye}from"./arrow-left-zNkLqbte.js";import{P as ge}from"./pen-EvlKYdM2.js";import{B as Ie}from"./book-open-CIned7ko.js";import{L as us}from"./list-DzBFMrVB.js";import{L as gs}from"./layers-mGPxOuwI.js";import{G as hs}from"./globe-pZEYczaD.js";import{F as vs}from"./file-braces-AIP1E2es.js";import{H as bs}from"./heart-7uhrLbZu.js";import{H as Xe}from"./history-DfLE_9c9.js";import{A as ys}from"./arrow-up-right-Cs2Wa6lF.js";import{A as fs}from"./arrow-down-right-DlIlW09r.js";import{M as js}from"./minus-DYGGLN5b.js";import{L as Ns}from"./lightbulb-BXp-zQLH.js";import{C as ws}from"./chevron-up-CuIutfHG.js";import{R as Ce}from"./rotate-cw-CScwxFr9.js";import"./skeleton-Cz6AWlMP.js";const Ye=["from-blue-500 to-cyan-400","from-purple-500 to-pink-400","from-amber-500 to-orange-400","from-emerald-500 to-teal-400","from-rose-500 to-red-400","from-indigo-500 to-violet-400"];function ks(t){let o=0;for(let m=0;m<t.length;m++)o=(o<<5)-o+t.charCodeAt(m)|0;return Ye[Math.abs(o)%Ye.length]}function Ss(t){return Ae(t.avatarUrl)||Ae(t.avatar)||Ae(t.photo_url)}function Cs(t,o){const m=o.toLowerCase().trim(),r=[];for(const n of t){const g=n.name?.toLowerCase()??"",s=n.email?.toLowerCase()??"",a=(n.aliases??[]).map(p=>p.toLowerCase());if(g===m||s===m){r.push(n);continue}if(a.includes(m)){r.push(n);continue}if(g.startsWith(m+" ")||m.startsWith(g+" ")){r.push(n);continue}const b=g.split(" ")[0];if(b&&b.length>=3&&m===b){r.push(n);continue}if(a.some(p=>p.length>=3&&(m.includes(p)||p.includes(m)))){r.push(n);continue}}if(r.length!==0)return r.find(Ss)??r[0]}const ne=({name:t,role:o,size:m="sm"})=>{const{data:r}=st(),n=r?.contacts??[],g=Cs(n,t),s=g?.name||t,a=g?.avatarUrl||g?.avatar||g?.photo_url,b=typeof a=="string"&&a.length>0&&a!=="undefined"&&a!=="null"?a:void 0,p=g?.cargo||g?.role||o||"",w=g?.empresa||g?.organization||"",h=[p,w].filter(Boolean).join(" · "),c=m==="sm"?"w-7 h-7":"w-9 h-9",d=m==="sm"?"text-[9px]":"text-[11px]",k=m==="sm"?"text-[11px]":"text-xs",f=m==="sm"?"text-[9px]":"text-[10px]";return e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[b?e.jsx("img",{src:b,alt:s,className:E(c,"rounded-full object-cover shrink-0")}):e.jsx("div",{className:E(c,"rounded-full bg-gradient-to-br flex items-center justify-center shrink-0",ks(s)),children:e.jsx("span",{className:E(d,"font-bold text-white"),children:rt(s)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:E("font-medium text-[var(--gm-text-primary)] truncate",k),children:s}),h&&e.jsx("p",{className:E("text-[var(--gm-text-tertiary)] truncate",f),children:h})]})]})},qe=["from-blue-500 to-cyan-400","from-purple-500 to-pink-400","from-amber-500 to-orange-400","from-emerald-500 to-teal-400","from-rose-500 to-red-400","from-indigo-500 to-violet-400"];function As(t){let o=0;for(let m=0;m<t.length;m++)o=(o<<5)-o+t.charCodeAt(m)|0;return qe[Math.abs(o)%qe.length]}function Ds({contact:t,size:o="sm"}){const m=o==="sm"?"w-7 h-7":"w-9 h-9",r=o==="sm"?"text-[9px]":"text-[11px]",n=t.avatarUrl||t.avatar||t.photo_url,g=Ae(n)?n:null;return g?e.jsx("img",{src:g,alt:t.name,className:E(m,"rounded-full object-cover")}):e.jsx("div",{className:E(m,"rounded-full bg-gradient-to-br flex items-center justify-center shrink-0",As(t.name)),children:e.jsx("span",{className:E(r,"font-bold text-white"),children:rt(t.name||"?")})})}function et({contact:t,size:o="sm"}){const m=t.cargo||t.role||"",r=t.empresa||t.organization||"";return e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Ds,{contact:t,size:o}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:E("font-medium truncate text-[var(--gm-text-primary)]",o==="sm"?"text-[11px]":"text-xs"),children:t.name}),(m||r)&&e.jsx("div",{className:E("truncate text-[var(--gm-text-tertiary)]",o==="sm"?"text-[9px]":"text-[10px]"),children:[m,r].filter(Boolean).join(" · ")})]})]})}function Le({value:t,onChange:o,placeholder:m="Select owner...",label:r,className:n}){const[g,s]=l.useState(!1),[a,b]=l.useState(""),p=l.useRef(null),w=l.useRef(null),{data:h}=st(),c=h?.contacts??[],d=c.filter(f=>{if(!a)return!0;const D=a.toLowerCase();return f.name?.toLowerCase().includes(D)||(f.role||f.cargo||"")?.toLowerCase().includes(D)||(f.organization||f.empresa||"")?.toLowerCase().includes(D)||f.email?.toLowerCase().includes(D)}),k=c.find(f=>f.name===t||f.id===t);return l.useEffect(()=>{function f(D){p.current&&!p.current.contains(D.target)&&s(!1)}return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),l.useEffect(()=>{g&&w.current&&w.current.focus()},[g]),e.jsxs("div",{ref:p,className:E("relative",n),children:[r&&e.jsx("label",{className:"block text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-1.5",children:r}),e.jsxs("button",{type:"button",onClick:()=>s(!g),className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] text-left hover:border-[var(--gm-accent-primary)]/50 transition-colors",children:[k?e.jsx(et,{contact:k,size:"sm"}):t?e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center shrink-0",children:e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})}),e.jsx("span",{className:"text-[11px] text-[var(--gm-text-secondary)] truncate",children:t})]}):e.jsx("span",{className:"text-[11px] text-[var(--gm-text-tertiary)] flex-1",children:m}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[t&&e.jsx("span",{onClick:f=>{f.stopPropagation(),o("")},className:"p-0.5 hover:bg-[var(--gm-bg-tertiary)] rounded cursor-pointer",children:e.jsx(ie,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"})}),e.jsx(xe,{className:E("w-3.5 h-3.5 text-[var(--gm-text-tertiary)] transition-transform",g&&"rotate-180")})]})]}),g&&e.jsxs("div",{className:"absolute z-50 mt-1 w-full rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-xl overflow-hidden",children:[e.jsx("div",{className:"p-2 border-b border-[var(--gm-border-primary)]",children:e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)]",children:[e.jsx(pt,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{ref:w,type:"text",value:a,onChange:f=>b(f.target.value),placeholder:"Search contacts...",className:"flex-1 bg-transparent text-xs text-[var(--gm-text-primary)] outline-none placeholder:text-[var(--gm-text-tertiary)]"})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto p-1",children:d.length>0?d.map(f=>e.jsx("button",{type:"button",onClick:()=>{o(f.name),s(!1),b("")},className:E("w-full px-2 py-2 rounded-lg flex items-center gap-2 hover:bg-[var(--gm-surface-hover)] transition-colors",(f.name===t||f.id===t)&&"bg-[var(--gm-accent-primary)]/10"),children:e.jsx(et,{contact:f,size:"sm"})},f.id)):e.jsxs("div",{className:"px-3 py-4 text-center",children:[e.jsx(pe,{className:"w-5 h-5 text-[var(--gm-text-tertiary)] mx-auto mb-1"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No contacts found"})]})})]})]})}const it=t=>t==="answered"?"bg-green-500/10 text-green-400":t==="dismissed"?"bg-white/5 text-slate-400":"bg-blue-500/10 text-blue-400",nt=t=>t==="high"?"bg-red-500/10 text-red-400":t==="medium"?"bg-yellow-500/10 text-yellow-400":"bg-white/5 text-slate-400",Is=({open:t,onClose:o,onSave:m,question:r,mode:n})=>{const g={content:"",priority:"medium",status:"open",source:"",assignee:""},[s,a]=l.useState(g),[b,p]=l.useState(null),w=G();l.useEffect(()=>{if(r&&n==="edit"){const{id:d,...k}=r;a(k)}else a(g)},[r,n,t]);const h=async()=>{p("suggest"),w.mutate({message:"Suggest one important question that should be asked about this project. Return only the question text, no explanation."},{onSuccess:d=>{const k=d?.response;k&&a(f=>({...f,content:k.replace(/^["']|["']$/g,"").trim()})),p(null),j.success("AI suggestion applied")},onError:()=>{p(null),j.error("AI suggestion failed")}})},c=async()=>{if(!s.content){j.error("Add a question first");return}p("answer"),w.mutate({message:`Answer this question based on the project knowledge: "${s.content}". Be concise and factual.`},{onSuccess:d=>{const k=d?.response;k&&a(f=>({...f,answer:k,status:"answered"})),p(null),j.success("AI generated answer")},onError:()=>{p(null),j.error("AI answer failed")}})};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:o}),e.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:n==="create"?"New Question":"Edit Question"}),e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg hover:bg-[var(--gm-surface-hover)] flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsxs("div",{className:"px-5 pt-4 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:h,disabled:!!b,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 disabled:opacity-50",children:[b==="suggest"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Suggest Question"]}),e.jsxs("button",{type:"button",onClick:c,disabled:!!b,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[b==="answer"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ae,{className:"w-3.5 h-3.5"})," AI Answer"]})]}),e.jsxs("form",{onSubmit:d=>{d.preventDefault(),s.content.trim()&&(m({id:r?.id||String(Date.now()),...s}),o())},className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Question *"}),e.jsx("textarea",{value:s.content,onChange:d=>a({...s,content:d.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[80px] resize-y",placeholder:"Type your question...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Priority"}),e.jsxs("select",{value:s.priority,onChange:d=>a({...s,priority:d.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Status"}),e.jsxs("select",{value:s.status,onChange:d=>a({...s,status:d.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"answered",children:"Answered"}),e.jsx("option",{value:"dismissed",children:"Dismissed"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Le,{value:s.assignee||"",onChange:d=>a({...s,assignee:d}),label:"Assignee",placeholder:"Select assignee..."}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Source"}),e.jsx("input",{value:s.source,onChange:d=>a({...s,source:d.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Where did this come from?"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Answer"}),e.jsx("textarea",{value:s.answer||"",onChange:d=>a({...s,answer:d.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[60px] resize-y",placeholder:"Answer (if known)..."})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:n==="create"?"Create":"Save"})]})]})]})})]})})},Ms=({question:t,onBack:o,onEdit:m,onDelete:r})=>{const[n,g]=l.useState(null),[s,a]=l.useState([]),b=G(),p=async()=>{g("analyze"),b.mutate({message:`Analyze this project question and provide 3 actionable insights:
Question: "${t.content}"
Status: ${t.status}
Priority: ${t.priority}
Assignee: ${t.assignee||"none"}
Source: ${t.source||"unknown"}`},{onSuccess:w=>{const h=w?.response;h&&a(h.split(`
`).filter(c=>c.trim())),g(null),j.success("AI analysis complete")},onError:()=>{g(null),j.error("AI analysis failed")}})};return e.jsxs($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:"Question Detail"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["#",t.id]})]}),e.jsxs("button",{onClick:p,disabled:!!n,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[n==="analyze"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Analyze"]}),e.jsxs("button",{onClick:()=>m(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Edit"]}),r&&e.jsxs("button",{onClick:()=>{r(t.id),o()},className:"px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs hover:bg-red-500/20 flex items-center gap-1.5",children:[e.jsx(de,{className:"w-3.5 h-3.5"})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${it(t.status)}`,children:t.status||"—"}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${nt(t.priority)}`,children:t.priority||"—"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Question"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.content||"(no content)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Assignee"})]}),t.assignee?e.jsx(ne,{name:t.assignee,size:"md"}):e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Unassigned"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gt,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Source"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.source||"—"})]})]}),t.answer&&e.jsxs("div",{className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2",children:"Answer"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.answer})]}),s.length>0&&e.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Insights"]}),e.jsx("ul",{className:"space-y-1.5",children:s.map((w,h)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:w},h))})]})]})},Ls=({initialData:t=[],onSave:o,onDelete:m})=>{const[r,n]=l.useState(t),g=G(),s=ut();l.useEffect(()=>{t&&n(t)},[t]);const[a,b]=l.useState("all"),[p,w]=l.useState("all"),[h,c]=l.useState(!1),[d,k]=l.useState("create"),[f,D]=l.useState(null),[N,M]=l.useState(null),[A,S]=l.useState(!1),F=l.useMemo(()=>{let u=r;return a!=="all"&&(u=u.filter(L=>L.status===a)),p!=="all"&&(u=u.filter(L=>L.priority===p)),u},[r,a,p]),z=l.useMemo(()=>({total:r.length,open:r.filter(u=>u.status==="open").length,answered:r.filter(u=>u.status==="answered").length,dismissed:r.filter(u=>u.status==="dismissed").length}),[r]),x=u=>{n(L=>{const T=L.findIndex(Q=>Q.id===u.id);if(T>=0){const Q=[...L];return Q[T]=u,Q}return[...L,u]}),o?.(u)},I=u=>{n(L=>L.filter(T=>T.id!==u)),m?.(u),j.success("Question deleted")},y=async()=>{S(!0),g.mutate({message:"Based on the current project knowledge, suggest one new important question that should be raised. Return the question text only, and a suggested priority (high/medium/low) on a second line."},{onSuccess:u=>{const L=u?.response;if(L){const Q=L.split(`
`).filter(B=>B.trim())[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||L.trim(),V=L.toLowerCase().match(/(high|medium|low)/),W={id:`ai-${Date.now()}`,content:Q,priority:V?.[1]||"medium",status:"open",source:"AI Analysis"};n(B=>[...B,W]),o?.(W)}S(!1),j.success("AI suggested a new question")},onError:()=>{S(!1),j.error("AI suggestion failed")}})};return N?e.jsx(Ms,{question:N,onBack:()=>M(null),onEdit:u=>{M(null),D(u),k("edit"),c(!0)},onDelete:I}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Total",value:z.total,color:"text-[var(--gm-text-primary)]"},{label:"Open",value:z.open,color:"text-primary"},{label:"Answered",value:z.answered,color:"text-green-400"},{label:"Dismissed",value:z.dismissed,color:"text-[var(--gm-text-tertiary)]"}].map(u=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${u.color}`,children:u.value}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:u.label})]},u.label))}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{value:a,onChange:u=>b(u.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"answered",children:"Answered"}),e.jsx("option",{value:"dismissed",children:"Dismissed"})]}),e.jsxs("select",{value:p,onChange:u=>w(u.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>s.mutate(void 0,{onSuccess:u=>j.success(`Enriched ${u?.enriched??0} questions with AI-assigned people`)}),disabled:s.isPending,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[s.isPending?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ae,{className:"w-3.5 h-3.5"})," AI Enrich"]}),e.jsxs("button",{onClick:y,disabled:A,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[A?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," AI Suggest"]}),e.jsxs("button",{onClick:()=>{D(null),k("create"),c(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Add Question"]})]}),e.jsx("div",{className:"space-y-2",children:F.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No questions match the current filter"}):F.map(u=>e.jsxs($.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>M(u),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] group-hover:text-blue-400 transition-colors flex-1",children:u.content||"(no content)"}),e.jsxs("div",{className:"flex gap-1.5 flex-shrink-0",children:[e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${nt(u.priority)}`,children:u.priority||"—"}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${it(u.status)}`,children:u.status||"—"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2.5",children:[u.assignee?e.jsx(ne,{name:u.assignee,size:"sm"}):e.jsx("span",{className:"text-[11px] text-[var(--gm-text-tertiary)]",children:"Unassigned"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:u.source||""})]}),u.answer&&e.jsx("p",{className:"text-xs text-purple-400 mt-2 line-clamp-1",children:u.answer})]},u.id))}),e.jsx(Is,{open:h,onClose:()=>c(!1),onSave:x,question:f,mode:d})]})},Te=t=>t==="technical"?"bg-blue-500/10 text-blue-400":t==="process"?"bg-purple-500/10 text-purple-400":t==="policy"?"bg-yellow-500/10 text-yellow-400":t==="people"?"bg-red-500/10 text-red-400":"bg-white/5 text-slate-400",lt=t=>t>=.9?"text-green-400":t>=.7?"text-yellow-400":"text-red-400",Es=({open:t,onClose:o,onSave:m,fact:r,mode:n})=>{const g={content:"",category:"technical",source:"",confidence:.8,createdAt:new Date().toISOString().split("T")[0]},[s,a]=l.useState(g),[b,p]=l.useState(null),w=G();l.useEffect(()=>{if(r&&n==="edit"){const{id:c,...d}=r;a(d)}else a(g)},[r,n,t]);const h=async()=>{if(!s.content){j.error("Add content first");return}p("refine"),w.mutate({message:`Refine and verify this fact against project knowledge. Rewrite it more precisely if needed and estimate confidence (0.0-1.0):
"${s.content}"`},{onSuccess:c=>{const d=c?.response;if(d){const k=d.match(/(\d\.\d+)/);a(f=>({...f,content:d.replace(/confidence[:\s]*\d\.\d+/i,"").trim(),confidence:Math.min(k?parseFloat(k[1]):f.confidence+.05,1)}))}p(null),j.success("Fact refined with AI")},onError:()=>{p(null),j.error("AI refinement failed")}})};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:o}),e.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:n==="create"?"New Fact":"Edit Fact"}),e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg hover:bg-[var(--gm-surface-hover)] flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsx("div",{className:"px-5 pt-4 flex gap-2",children:e.jsxs("button",{type:"button",onClick:h,disabled:!!b,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[b==="refine"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ae,{className:"w-3.5 h-3.5"})," Refine with AI"]})}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),s.content.trim()&&(m({id:r?.id||String(Date.now()),...s}),o())},className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Content *"}),e.jsx("textarea",{value:s.content,onChange:c=>a({...s,content:c.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[80px] resize-y",placeholder:"State the fact...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Category"}),e.jsxs("select",{value:s.category,onChange:c=>a({...s,category:c.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"technical",children:"Technical"}),e.jsx("option",{value:"process",children:"Process"}),e.jsx("option",{value:"policy",children:"Policy"}),e.jsx("option",{value:"people",children:"People"}),e.jsx("option",{value:"timeline",children:"Timeline"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Confidence"}),e.jsx("input",{type:"number",min:0,max:1,step:.05,value:s.confidence,onChange:c=>a({...s,confidence:parseFloat(c.target.value)}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Source"}),e.jsx("input",{value:s.source,onChange:c=>a({...s,source:c.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Document or meeting source..."})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:n==="create"?"Create":"Save"})]})]})]})})]})})},$s=({fact:t,onBack:o,onEdit:m,onDelete:r})=>{const[n,g]=l.useState(!1),[s,a]=l.useState([]),b=G(),p=ht(t.id),w=async()=>{g(!0),b.mutate({message:`Verify this fact against the project knowledge base. Check accuracy, find related/conflicting facts, and assess confidence:
Fact: "${t.content}"
Category: ${t.category}
Current confidence: ${Math.round(t.confidence*100)}%
Source: ${t.source}`},{onSuccess:h=>{const c=h?.response;c&&a(c.split(`
`).filter(d=>d.trim())),g(!1),j.success("AI verification complete")},onError:()=>{g(!1),j.error("AI verification failed")}})};return e.jsxs($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:"Fact Detail"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["#",t.id]})]}),e.jsxs("button",{onClick:w,disabled:n,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[n?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Verify"]}),e.jsxs("button",{onClick:()=>m(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Edit"]}),r&&e.jsxs("button",{onClick:()=>{r(t.id),o()},className:"px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs hover:bg-red-500/20 flex items-center gap-1.5",children:[e.jsx(de,{className:"w-3.5 h-3.5"})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${Te(t.category)}`,children:t.category||"—"}),e.jsxs("span",{className:`text-xs px-3 py-1 rounded-full font-medium bg-[var(--gm-interactive-secondary)] ${lt(t.confidence)}`,children:[Math.round(t.confidence*100),"% confidence"]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Content"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.content||"(no content)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ze,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Source"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.source||"—"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(be,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Extracted"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.createdAt||"—"})]})]}),s.length>0&&e.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Verification"]}),e.jsx("ul",{className:"space-y-1.5",children:s.map((h,c)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:h},c))})]}),p.data&&p.data.length>0&&e.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," Similar Facts"]}),e.jsx("ul",{className:"space-y-2",children:p.data.map((h,c)=>e.jsxs("li",{className:"text-sm text-[var(--gm-text-primary)] bg-[var(--gm-surface-primary)] rounded-lg p-3 border border-[var(--gm-border-primary)]",children:[e.jsx("p",{children:h.content??"—"}),h.similarity!=null&&e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] mt-1 inline-block",children:[Math.round(Number(h.similarity)*100),"% match"]})]},c))})]}),p.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[var(--gm-text-tertiary)]",children:[e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"})," Loading similar facts..."]})]})},Rs=({initialData:t=[],onSave:o,onDelete:m})=>{const[r,n]=l.useState(t),g=G();l.useEffect(()=>{t&&n(t)},[t]);const[s,a]=l.useState("all"),[b,p]=l.useState(!1),[w,h]=l.useState("create"),[c,d]=l.useState(null),[k,f]=l.useState(null),[D,N]=l.useState(!1),M=l.useMemo(()=>s==="all"?r:r.filter(x=>x.category===s),[r,s]),A=l.useMemo(()=>{const x={};return r.forEach(I=>{x[I.category]=(x[I.category]||0)+1}),{total:r.length,categories:x,avgConfidence:r.length?r.reduce((I,y)=>I+y.confidence,0)/r.length:0}},[r]),S=x=>{n(I=>{const y=I.findIndex(u=>u.id===x.id);if(y>=0){const u=[...I];return u[y]=x,u}return[...I,x]}),o?.(x)},F=x=>{n(I=>I.filter(y=>y.id!==x)),m?.(x),j.success("Fact deleted")},z=async()=>{N(!0),g.mutate({message:"Based on the project knowledge, extract one important fact that is not yet documented. Return on line 1: the fact text. Line 2: category (technical/process/policy/people/timeline). Line 3: confidence (0.0-1.0)."},{onSuccess:x=>{const I=x?.response;if(I){const u=I.split(`
`).filter(V=>V.trim())[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||I.trim(),L=I.toLowerCase().match(/(technical|process|policy|people|timeline)/),T=I.match(/(\d\.\d+)/),Q={id:`ai-${Date.now()}`,content:u,category:L?.[1]||"technical",source:"AI Analysis",confidence:T?parseFloat(T[1]):.8,createdAt:new Date().toISOString().split("T")[0]};n(V=>[...V,Q]),o?.(Q)}N(!1),j.success("AI extracted a new fact")},onError:()=>{N(!1),j.error("AI extraction failed")}})};return k?e.jsx($s,{fact:k,onBack:()=>f(null),onEdit:x=>{f(null),d(x),h("edit"),p(!0)},onDelete:F}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:A.total}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Total"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-purple-400",children:[Math.round(A.avgConfidence*100),"%"]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Avg Confidence"})]}),Object.entries(A.categories).map(([x,I])=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${Te(x).split(" ")[1]}`,children:I}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:x})]},x))]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{value:s,onChange:x=>a(x.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All categories"}),e.jsx("option",{value:"technical",children:"Technical"}),e.jsx("option",{value:"process",children:"Process"}),e.jsx("option",{value:"policy",children:"Policy"}),e.jsx("option",{value:"people",children:"People"}),e.jsx("option",{value:"timeline",children:"Timeline"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:z,disabled:D,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[D?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," AI Extract"]}),e.jsxs("button",{onClick:()=>{d(null),h("create"),p(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Add Fact"]})]}),e.jsx("div",{className:"space-y-2",children:M.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No facts match the current filter"}):M.map(x=>e.jsxs($.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>f(x),children:[e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)] group-hover:text-blue-400 transition-colors",children:x.content||"(no content)"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2.5",children:[e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Te(x.category)}`,children:x.category||"—"}),e.jsxs("span",{className:`text-[10px] ${lt(x.confidence)}`,children:[Math.round(x.confidence*100),"%"]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["· ",x.source||"—"]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] ml-auto",children:x.createdAt||"—"})]})]},x.id))}),e.jsx(Es,{open:b,onClose:()=>p(!1),onSave:S,fact:c,mode:w})]})},ct=t=>t==="mitigated"?"bg-green-500/10 text-green-400":t==="accepted"?"bg-yellow-500/10 text-yellow-400":"bg-red-500/10 text-red-400",Me=t=>t==="high"?"bg-red-500/10 text-red-400":t==="medium"?"bg-yellow-500/10 text-yellow-400":"bg-white/5 text-slate-400",Fs=({open:t,onClose:o,onSave:m,risk:r,mode:n})=>{const g={content:"",impact:"medium",likelihood:"medium",status:"open",owner:"",mitigation:""},[s,a]=l.useState(g),[b,p]=l.useState(null),w=yt();l.useEffect(()=>{if(r&&n==="edit"){const{id:c,...d}=r;a(d)}else a(g)},[r,n,t]);const h=async()=>{if(!s.content){j.error("Add a description first");return}p("mitigate"),w.mutate({content:s.content,impact:s.impact,likelihood:s.likelihood},{onSuccess:c=>{c.suggested_mitigation&&a(d=>({...d,mitigation:c.suggested_mitigation})),c.suggested_owner&&!s.owner&&a(d=>({...d,owner:c.suggested_owner})),p(null),j.success("AI suggested mitigation strategy")},onError:()=>{p(null),j.error("AI mitigation failed")}})};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:o}),e.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:n==="create"?"New Risk":"Edit Risk"}),e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg hover:bg-[var(--gm-surface-hover)] flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsx("div",{className:"px-5 pt-4 flex gap-2",children:e.jsxs("button",{type:"button",onClick:h,disabled:!!b,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[b==="mitigate"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ae,{className:"w-3.5 h-3.5"})," AI Mitigation"]})}),e.jsxs("form",{onSubmit:c=>{c.preventDefault(),s.content.trim()&&(m({id:r?.id||String(Date.now()),...s}),o())},className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Risk *"}),e.jsx("input",{value:s.content,onChange:c=>a({...s,content:c.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Risk title...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Mitigation Plan"}),e.jsx("textarea",{value:s.mitigation||"",onChange:c=>a({...s,mitigation:c.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[60px] resize-y",placeholder:"Describe the risk..."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Impact"}),e.jsxs("select",{value:s.impact,onChange:c=>a({...s,impact:c.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Likelihood"}),e.jsxs("select",{value:s.likelihood,onChange:c=>a({...s,likelihood:c.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Status"}),e.jsxs("select",{value:s.status,onChange:c=>a({...s,status:c.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"mitigated",children:"Mitigated"}),e.jsx("option",{value:"accepted",children:"Accepted"})]})]})]}),e.jsx(Le,{value:s.owner||"",onChange:c=>a({...s,owner:c}),label:"Owner",placeholder:"Select risk owner..."}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Mitigation"}),e.jsx("textarea",{value:s.mitigation||"",onChange:c=>a({...s,mitigation:c.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[60px] resize-y",placeholder:"Mitigation strategy..."})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:n==="create"?"Create":"Save"})]})]})]})})]})})},_s=({risk:t,onBack:o,onEdit:m,onDelete:r})=>{const[n,g]=l.useState(!1),[s,a]=l.useState([]),b=G(),p=t.impact==="high"&&t.likelihood==="high"?"Critical":t.impact==="high"||t.likelihood==="high"?"High":t.impact==="medium"&&t.likelihood==="medium"?"Medium":"Low",w=async()=>{g(!0),b.mutate({message:`Analyze this project risk and provide insights:
Risk: "${t.content}"
Impact: ${t.impact}, Likelihood: ${t.likelihood}, Status: ${t.status}
Owner: ${t.owner||"none"}
Mitigation: ${t.mitigation||"none"}
Provide: risk assessment, related risks, and recommendations.`},{onSuccess:h=>{const c=h?.response;c&&a(c.split(`
`).filter(d=>d.trim())),g(!1),j.success("AI risk analysis complete")},onError:()=>{g(!1),j.error("AI analysis failed")}})};return e.jsxs($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:t.content||t.description||"(untitled risk)"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["Risk #",t.id?.substring(0,8)]})]}),e.jsxs("button",{onClick:w,disabled:n,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[n?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Analyze"]}),e.jsxs("button",{onClick:()=>m(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Edit"]}),r&&e.jsxs("button",{onClick:()=>{r(t.id),o()},className:"px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs hover:bg-red-500/20 flex items-center gap-1.5",children:[e.jsx(de,{className:"w-3.5 h-3.5"})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${ct(t.status)}`,children:t.status||"—"}),e.jsxs("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${Me(t.impact)}`,children:["Impact: ",t.impact||"—"]}),e.jsxs("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${Me(t.likelihood)}`,children:["Likelihood: ",t.likelihood||"—"]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.mitigation||"No mitigation plan defined"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Owner"})]}),t.owner?e.jsx(ne,{name:t.owner,size:"md"}):e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Unassigned"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(vt,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Risk Score"})]}),e.jsx("p",{className:`text-sm font-semibold ${p==="Critical"?"text-red-400":p==="High"?"text-yellow-400":"text-[var(--gm-text-primary)]"}`,children:p})]})]}),t.mitigation&&e.jsxs("div",{className:"bg-green-500/5 border border-green-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-green-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(bt,{className:"w-3.5 h-3.5"})," Mitigation"]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.mitigation})]}),s.length>0&&e.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Analysis"]}),e.jsx("ul",{className:"space-y-1.5",children:s.map((h,c)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:h},c))})]})]})},Ps=({initialData:t=[],onSave:o,onDelete:m})=>{const[r,n]=l.useState(t),g=G();l.useEffect(()=>{t&&n(t)},[t]);const[s,a]=l.useState("all"),[b,p]=l.useState("all"),[w,h]=l.useState(!1),[c,d]=l.useState("create"),[k,f]=l.useState(null),[D,N]=l.useState(null),[M,A]=l.useState(!1),S=l.useMemo(()=>{let y=r;return s!=="all"&&(y=y.filter(u=>u.status===s)),b!=="all"&&(y=y.filter(u=>u.impact===b)),y},[r,s,b]),F=l.useMemo(()=>({total:r.length,open:r.filter(y=>y.status==="open").length,mitigated:r.filter(y=>y.status==="mitigated").length,critical:r.filter(y=>y.impact==="high"&&y.likelihood==="high").length}),[r]),z=y=>{n(u=>{const L=u.findIndex(T=>T.id===y.id);if(L>=0){const T=[...u];return T[L]=y,T}return[...u,y]}),o?.(y)},x=y=>{n(u=>u.filter(L=>L.id!==y)),m?.(y),j.success("Risk deleted")},I=async()=>{A(!0),g.mutate({message:"Scan the project for potential risks not yet identified. Return on line 1: risk title. Line 2: brief description. Line 3: impact (high/medium/low). Line 4: likelihood (high/medium/low)."},{onSuccess:y=>{const u=y?.response;if(u){const L=u.split(`
`).filter(le=>le.trim()),T=L[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||u.trim(),Q=L[1]?.replace(/^["'\-*\d.]+\s*/,"").trim()||"",V=u.toLowerCase().match(/impact[:\s]*(high|medium|low)/),W=u.toLowerCase().match(/likelihood[:\s]*(high|medium|low)/),B={id:`ai-${Date.now()}`,content:T,mitigation:Q,impact:V?.[1]||"medium",likelihood:W?.[1]||"medium",status:"open",owner:""};n(le=>[...le,B]),o?.(B)}A(!1),j.success("AI identified a new risk")},onError:()=>{A(!1),j.error("AI risk scan failed")}})};return D?e.jsx(_s,{risk:D,onBack:()=>N(null),onEdit:y=>{N(null),f(y),d("edit"),h(!0)},onDelete:x}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Total",value:F.total,color:"text-[var(--gm-text-primary)]"},{label:"Open",value:F.open,color:"text-red-400"},{label:"Mitigated",value:F.mitigated,color:"text-green-400"},{label:"Critical",value:F.critical,color:"text-red-400"}].map(y=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${y.color}`,children:y.value}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:y.label})]},y.label))}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{value:s,onChange:y=>a(y.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"mitigated",children:"Mitigated"}),e.jsx("option",{value:"accepted",children:"Accepted"})]}),e.jsxs("select",{value:b,onChange:y=>p(y.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All impacts"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:I,disabled:M,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[M?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," AI Risk Scan"]}),e.jsxs("button",{onClick:()=>{f(null),d("create"),h(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Add Risk"]})]}),e.jsx("div",{className:"space-y-2",children:S.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No risks match the current filter"}):S.map(y=>e.jsxs($.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>N(y),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate group-hover:text-blue-400 transition-colors",children:y.content||y.description||"(untitled risk)"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5 line-clamp-1",children:y.mitigation||""})]}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${ct(y.status)}`,children:y.status||"—"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2.5",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Me(y.impact)}`,children:["Impact: ",y.impact||"—"]}),e.jsxs("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Me(y.likelihood)}`,children:["Likelihood: ",y.likelihood||"—"]})]}),y.owner?e.jsx(ne,{name:y.owner,size:"sm"}):e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No owner"})]}),y.mitigation&&e.jsx("p",{className:"text-xs text-green-400 mt-2 line-clamp-1",children:y.mitigation})]},y.id))}),e.jsx(Fs,{open:w,onClose:()=>h(!1),onSave:z,risk:k,mode:c})]})},tt={task:"",description:"",owner:"",deadline:"",status:"pending",priority:"medium",sprint_id:"",parent_story_id:""},Os=({open:t,onClose:o,onSave:m,action:r,mode:n,sprints:g=[],userStories:s=[]})=>{const[a,b]=l.useState(tt),[p,w]=l.useState(null),h=ft(),c=G();l.useEffect(()=>{if(r&&n==="edit"){const{id:N,...M}=r;b(M)}else b(tt)},[r,n,t]);const d=s.filter(N=>N.sprintId===a.sprintId),k=async N=>{if(w(N),N==="title")c.mutate({message:"Suggest one concise action item title for this project. Return only the title text."},{onSuccess:M=>{const A=M?.response;A&&b(S=>({...S,title:A.replace(/^["'\-*\d.]+\s*/,"").trim()})),w(null),j.success("AI suggestion applied to title")},onError:()=>{w(null),j.error("AI suggestion failed")}});else{const M=a.task||"a new project task";h.mutate({user_input:M},{onSuccess:A=>{const S=[];A.description&&S.push(A.description),A.definition_of_done&&S.push(`Definition of Done: ${A.definition_of_done}`),A.acceptance_criteria&&S.push(`Acceptance Criteria: ${A.acceptance_criteria}`),A.size_estimate&&S.push(`Estimate: ${A.size_estimate}`);const F=S.join(`

`);b(z=>({...z,description:z.description?`${z.description}

${F}`:F})),A.task&&!a.task&&b(z=>({...z,task:A.task})),w(null),j.success("AI suggestion applied to description")},onError:()=>{w(null),j.error("AI suggestion failed")}})}},f=async()=>{if(!a.task&&!a.description){j.error("Add a title or description first");return}w("refine"),c.mutate({message:`Refine this action item. Clarify scope, add measurable outcomes, identify blockers:
Task: "${a.task}"
Description: "${a.description}"`},{onSuccess:N=>{const M=N?.response;M&&b(A=>({...A,description:A.description?`${A.description}

${M}`:M})),w(null),j.success("Action refined with AI")},onError:()=>{w(null),j.error("AI refinement failed")}})},D=N=>{N.preventDefault(),a.title.trim()&&(m({id:r?.id||String(Date.now()),...a,createdAt:r?.createdAt||new Date().toISOString().split("T")[0],updatedAt:new Date().toISOString().split("T")[0]}),o())};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:o}),e.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",style:{background:"linear-gradient(to right, rgba(37,99,235,0.18), rgba(37,99,235,0.05))"},children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:n==="create"?"New Action":"Edit Action"}),e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-slate-400"})})]}),e.jsxs("div",{className:"px-5 pt-4 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>k("title"),disabled:!!p,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[p==="title"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Suggest Title"]}),e.jsxs("button",{type:"button",onClick:()=>k("description"),disabled:!!p,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[p==="description"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Suggest Description"]}),e.jsxs("button",{type:"button",onClick:f,disabled:!!p,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[p==="refine"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ae,{className:"w-3.5 h-3.5"})," Refine with AI"]})]}),e.jsxs("form",{onSubmit:D,className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Title *"}),e.jsx("input",{value:a.title,onChange:N=>b({...a,title:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Action title...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:N=>b({...a,description:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[80px] resize-y",placeholder:"Describe the action..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(Le,{value:a.owner||"",onChange:N=>b({...a,owner:N}),label:"Owner",placeholder:"Select assignee..."}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Deadline"}),e.jsx("input",{type:"date",value:a.deadline||"",onChange:N=>b({...a,deadline:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Status"}),e.jsxs("select",{value:a.status,onChange:N=>b({...a,status:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Priority"}),e.jsxs("select",{value:a.priority,onChange:N=>b({...a,priority:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Sprint"}),e.jsxs("select",{value:a.sprintId||"",onChange:N=>b({...a,sprintId:N.target.value,storyId:""}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"",children:"No sprint"}),g.map(N=>e.jsx("option",{value:N.id,children:N.name||"(unnamed)"},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"User Story"}),e.jsxs("select",{value:a.storyId||"",onChange:N=>b({...a,storyId:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",disabled:!a.sprintId,children:[e.jsx("option",{value:"",children:"No story"}),d.map(N=>e.jsx("option",{value:N.id,children:N.title||"(untitled)"},N.id))]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:n==="create"?"Create Action":"Save Changes"})]})]})]})})]})})},zs=t=>t==="completed"?"bg-success/10 text-success":t==="overdue"?"bg-destructive/10 text-destructive":t==="in_progress"?"bg-primary/10 text-primary":"bg-muted text-[var(--gm-text-tertiary)]",Ts=t=>t==="high"?"bg-destructive/10 text-destructive":t==="medium"?"bg-warning/10 text-warning":"bg-muted text-[var(--gm-text-tertiary)]",Us=({action:t,onBack:o,onEdit:m,onDelete:r})=>{const[n,g]=l.useState(null),[s,a]=l.useState([]),b=G(),p=async()=>{g("analyze"),b.mutate({message:`Analyze this action item and provide insights on urgency, dependencies, and risks:
Title: "${t.title}"
Description: "${t.description}"
Status: ${t.status}
Priority: ${t.priority}
Owner: ${t.owner||"unassigned"}
Deadline: ${t.deadline||"none"}
Sprint: ${t.sprintId||"none"}`},{onSuccess:h=>{const c=h?.response;c&&a(c.split(`
`).filter(d=>d.trim())),g(null),j.success("AI analysis complete")},onError:()=>{g(null),j.error("AI analysis failed")}})},w=async()=>{g("steps"),b.mutate({message:`Suggest 3 concrete next steps for this action:
Title: "${t.title}"
Description: "${t.description}"
Status: ${t.status}
Return each step on a new line.`},{onSuccess:h=>{const c=h?.response;c&&a(d=>[...d,...c.split(`
`).filter(k=>k.trim())]),g(null),j.success("AI suggested next steps")},onError:()=>{g(null),j.error("AI suggestion failed")}})};return e.jsxs($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:t.title||t.task||t.content||"(untitled action)"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["Action #",t.id]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:p,disabled:!!n,className:"px-3 py-1.5 rounded-lg bg-accent/10 text-accent text-xs font-medium hover:bg-accent/20 flex items-center gap-1.5 disabled:opacity-50",children:[n==="analyze"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Analyze"]}),e.jsxs("button",{onClick:w,disabled:!!n,className:"px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs font-medium hover:bg-primary/20 flex items-center gap-1.5 disabled:opacity-50",children:[n==="steps"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ae,{className:"w-3.5 h-3.5"})," Suggest Steps"]}),e.jsxs("button",{onClick:()=>m(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-secondary-foreground text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Edit"]}),r&&e.jsxs("button",{onClick:()=>{r(t.id),o()},className:"px-3 py-1.5 rounded-lg bg-destructive/10 text-destructive text-xs hover:bg-destructive/20 flex items-center gap-1.5",children:[e.jsx(de,{className:"w-3.5 h-3.5"})," Delete"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${zs(t.status)}`,children:(t.status||"").replace("_"," ")}),e.jsxs("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${Ts(t.priority)}`,children:[t.priority," priority"]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)] whitespace-pre-wrap",children:t.description||"—"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Owner"})]}),t.owner?e.jsx(ne,{name:t.owner,size:"md"}):e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Unassigned"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(at,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Deadline"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.deadline||"No deadline"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(De,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Sprint"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.sprintId||"No sprint"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"User Story"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.storyId||"No story"})]})]}),s.length>0&&e.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-accent/5 border border-accent/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-accent uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Insights"]}),e.jsx("ul",{className:"space-y-1.5",children:s.map((h,c)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:h},c))})]}),e.jsxs("div",{className:"flex gap-4 text-[10px] text-[var(--gm-text-tertiary)]",children:[t.createdAt&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"})," Created: ",t.createdAt]}),t.updatedAt&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"})," Updated: ",t.updatedAt]})]})]})},Qs=({open:t,onClose:o,onSave:m})=>{const[r,n]=l.useState({name:"",startDate:"",endDate:"",context:""}),g=s=>{s.preventDefault(),r.name.trim()&&(m({id:`sp-${Date.now()}`,name:r.name,startDate:r.startDate,endDate:r.endDate,context:r.context,status:"planning"}),n({name:"",startDate:"",endDate:"",context:""}),o())};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:o}),e.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-md",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",style:{background:"linear-gradient(to right, rgba(37,99,235,0.18), rgba(37,99,235,0.05))"},children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Create Sprint"}),e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center transition-colors",children:e.jsx(ie,{className:"w-4 h-4 text-slate-400"})})]}),e.jsxs("form",{onSubmit:g,className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Sprint Name *"}),e.jsx("input",{value:r.name,onChange:s=>n({...r,name:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"e.g. Sprint 4 — Analytics",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Start Date"}),e.jsx("input",{type:"date",value:r.startDate,onChange:s=>n({...r,startDate:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"End Date"}),e.jsx("input",{type:"date",value:r.endDate,onChange:s=>n({...r,endDate:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Context / Goals"}),e.jsx("textarea",{value:r.context,onChange:s=>n({...r,context:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[60px] resize-y",placeholder:"Sprint goals and context..."})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)] transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 transition-colors",children:"Create Sprint"})]})]})]})})]})})},Hs=t=>t==="completed"?"bg-green-500/10 text-green-400":t==="overdue"?"bg-red-500/10 text-red-400":t==="in_progress"?"bg-blue-500/10 text-blue-400":"bg-white/5 text-slate-400",Vs=t=>t==="high"?"bg-red-500/10 text-red-400":t==="medium"?"bg-yellow-500/10 text-yellow-400":"bg-white/5 text-slate-400",Bs=t=>t==="active"?"bg-green-500/10 text-green-400":t==="completed"?"bg-white/5 text-slate-400":"bg-blue-500/10 text-blue-400",Gs=({initialData:t=[],initialSprints:o=[],onSave:m,onDelete:r})=>{const[n,g]=l.useState(t),[s,a]=l.useState(o),b=G();l.useEffect(()=>{t&&g(t),o&&a(o)},[t,o]);const[p,w]=l.useState("by_sprint"),[h,c]=l.useState("all"),[d,k]=l.useState(""),[f,D]=l.useState(new Set(["sp-2","sp-1","sp-3","no-sprint"])),[N,M]=l.useState(!1),[A,S]=l.useState("create"),[F,z]=l.useState(null),[x,I]=l.useState(!1),[y,u]=l.useState(null),[L,T]=l.useState(!1),Q=async()=>{T(!0),b.mutate({message:"Based on the project state, suggest one important action item. Return on line 1: the action title. Line 2: description. Line 3: priority (high/medium/low)."},{onSuccess:v=>{const R=v?.response;if(R){const C=R.split(`
`).filter(q=>q.trim()),U=C[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||R.trim(),J=C[1]?.replace(/^["'\-*\d.]+\s*/,"").trim()||"",Z=R.toLowerCase().match(/(high|medium|low)/),te={id:`ai-${Date.now()}`,title:U,description:J,status:"pending",priority:Z?.[1]||"medium",owner:"",deadline:new Date(Date.now()+7*864e5).toISOString().split("T")[0],sprintId:s.find(q=>q.status==="active")?.id,createdAt:new Date().toISOString().split("T")[0]};g(q=>[...q,te]),m?.(te)}T(!1),j.success("AI suggested a new action")},onError:()=>{T(!1),j.error("AI suggestion failed")}})},V=l.useMemo(()=>{let v=n;return h!=="all"&&(v=v.filter(R=>R.status===h)),d&&(v=v.filter(R=>R.sprintId===d)),v},[n,h,d]),W=l.useMemo(()=>({total:n.length,pending:n.filter(v=>v.status==="pending").length,inProgress:n.filter(v=>v.status==="in_progress").length,completed:n.filter(v=>v.status==="completed").length,overdue:n.filter(v=>v.status==="overdue").length}),[n]),B=v=>{D(R=>{const C=new Set(R);return C.has(v)?C.delete(v):C.add(v),C})},le=v=>{g(R=>{const C=R.findIndex(U=>U.id===v.id);if(C>=0){const U=[...R];return U[C]=v,U}return[...R,v]}),m?.(v)},Ee=v=>{g(R=>R.filter(C=>C.id!==v)),r?.(v),j.success("Action deleted")},fe=v=>{a(R=>[...R,v]),D(R=>new Set([...R,v.id]))},$e=v=>{z(v),S("edit"),M(!0)};if(y)return e.jsx(Us,{action:y,onBack:()=>u(null),onEdit:v=>{u(null),$e(v)},onDelete:Ee});const ee=({action:v})=>e.jsxs($.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>u(v),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate group-hover:text-blue-400 transition-colors",children:v.task||v.title||v.content||"(no title)"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5 line-clamp-1",children:v.description||""})]}),e.jsxs("div",{className:"flex gap-1.5 flex-shrink-0",children:[v.priority&&e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Vs(v.priority)}`,children:v.priority}),v.status&&e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Hs(v.status)}`,children:v.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2.5",children:[v.owner?e.jsx(ne,{name:v.owner,size:"sm"}):e.jsx("span",{className:"text-[11px] text-[var(--gm-text-tertiary)]",children:"Unassigned"}),v.deadline&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["📅 ",v.deadline]})]})]}),Re=()=>{const v=s.map(C=>({sprint:C,actions:V.filter(U=>U.sprintId===C.id)})),R=V.filter(C=>!C.sprintId);return e.jsxs("div",{className:"space-y-3",children:[v.map(({sprint:C,actions:U})=>e.jsxs("div",{className:"bg-[var(--gm-interactive-secondary)]/30 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>B(C.id),className:"w-full flex items-center gap-2 px-4 py-3 hover:bg-[var(--gm-interactive-secondary)]/50 transition-colors text-left",children:[f.has(C.id)?e.jsx(xe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}):e.jsx(Se,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx(De,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)] flex-1",children:C.name||"(unnamed sprint)"}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Bs(C.status)}`,children:C.status||"—"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[U.length," actions"]})]}),e.jsx(X,{children:f.has(C.id)&&e.jsxs($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:[C.context&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] px-4 pb-2",children:C.context}),e.jsx("div",{className:"px-3 pb-3 space-y-2",children:U.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] text-center py-4",children:"No actions in this sprint"}):U.map(J=>e.jsx(ee,{action:J},J.id))})]})})]},C.id)),R.length>0&&e.jsxs("div",{className:"bg-[var(--gm-interactive-secondary)]/30 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>B("no-sprint"),className:"w-full flex items-center gap-2 px-4 py-3 hover:bg-[var(--gm-interactive-secondary)]/50 transition-colors text-left",children:[f.has("no-sprint")?e.jsx(xe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}):e.jsx(Se,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-tertiary)] flex-1",children:"No Sprint"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[R.length," actions"]})]}),e.jsx(X,{children:f.has("no-sprint")&&e.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden px-3 pb-3 space-y-2",children:R.map(C=>e.jsx(ee,{action:C},C.id))})})]})]})},je=[],Fe=()=>{const v=je.map(C=>({story:C,actions:V.filter(U=>U.storyId===C.id)})).filter(C=>C.actions.length>0),R=V.filter(C=>!C.storyId);return e.jsxs("div",{className:"space-y-3",children:[v.map(({story:C,actions:U})=>{const J=s.find(Z=>Z.id===C.sprintId);return e.jsxs("div",{className:"bg-[var(--gm-interactive-secondary)]/30 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>B(C.id),className:"w-full flex items-center gap-2 px-4 py-3 hover:bg-[var(--gm-interactive-secondary)]/50 transition-colors text-left",children:[f.has(C.id)?e.jsx(xe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}):e.jsx(Se,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx(Ie,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)] flex-1 truncate",children:C.title||"(untitled story)"}),J&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:J.name||"—"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:U.length})]}),e.jsx(X,{children:f.has(C.id)&&e.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden px-3 pb-3 space-y-2",children:U.map(Z=>e.jsx(ee,{action:Z},Z.id))})})]},C.id)}),R.length>0&&e.jsxs("div",{className:"bg-[var(--gm-interactive-secondary)]/30 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>B("no-story"),className:"w-full flex items-center gap-2 px-4 py-3 hover:bg-[var(--gm-interactive-secondary)]/50 transition-colors text-left",children:[f.has("no-story")?e.jsx(xe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}):e.jsx(Se,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-tertiary)] flex-1",children:"No Story"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:R.length})]}),e.jsx(X,{children:f.has("no-story")&&e.jsx($.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden px-3 pb-3 space-y-2",children:R.map(C=>e.jsx(ee,{action:C},C.id))})})]})]})},Ne=()=>e.jsx("div",{className:"space-y-2",children:V.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No actions match the current filter"}):V.map(v=>e.jsx(ee,{action:v},v.id))});return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Total",value:W.total,color:"text-[var(--gm-text-primary)]"},{label:"Pending",value:W.pending,color:"text-[var(--gm-text-tertiary)]"},{label:"In Progress",value:W.inProgress,color:"text-primary"},{label:"Completed",value:W.completed,color:"text-success"},{label:"Overdue",value:W.overdue,color:"text-destructive"}].map(v=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${v.color}`,children:v.value}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:v.label})]},v.label))}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"flex bg-[var(--gm-interactive-secondary)] rounded-lg p-0.5",children:[{id:"list",icon:us,label:"List"},{id:"by_sprint",icon:gs,label:"Sprints"},{id:"by_story",icon:Ie,label:"Stories"}].map(v=>e.jsxs("button",{onClick:()=>w(v.id),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${p===v.id?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-sm":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"}`,children:[e.jsx(v.icon,{className:"w-3.5 h-3.5"}),v.label]},v.id))}),p==="list"&&e.jsxs("select",{value:d,onChange:v=>k(v.target.value),className:"bg-[var(--gm-interactive-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"",children:"All sprints"}),s.map(v=>e.jsx("option",{value:v.id,children:v.name||"(unnamed)"},v.id))]}),e.jsxs("select",{value:h,onChange:v=>c(v.target.value),className:"bg-[var(--gm-interactive-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"overdue",children:"Overdue"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>I(!0),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-slate-300 text-xs font-medium hover:bg-[var(--gm-surface-hover)] transition-colors flex items-center gap-1.5",children:[e.jsx(De,{className:"w-3.5 h-3.5"})," Sprint"]}),e.jsxs("button",{onClick:Q,disabled:L,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 transition-colors flex items-center gap-1.5 disabled:opacity-50",children:[L?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"}),"AI Suggest"]}),e.jsxs("button",{onClick:()=>{z(null),S("create"),M(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 transition-colors flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Add Action"]})]}),e.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},children:[p==="list"&&Ne(),p==="by_sprint"&&Re(),p==="by_story"&&Fe()]},p),e.jsx(Os,{open:N,onClose:()=>M(!1),onSave:le,action:F,mode:A}),e.jsx(Qs,{open:x,onClose:()=>I(!1),onSave:fe})]})},ot=t=>t==="approved"?"bg-green-500/10 text-green-400":t==="rejected"?"bg-red-500/10 text-red-400":"bg-blue-500/10 text-blue-400",Ws=({open:t,onClose:o,onSave:m,decision:r,mode:n})=>{const g={content:"",rationale:"",owner:"",decision_date:new Date().toISOString().split("T")[0],status:"pending"},[s,a]=l.useState(g),[b,p]=l.useState(null),w=jt(),h=Nt();l.useEffect(()=>{if(r&&n==="edit"){const{id:d,...k}=r;a(k)}else a(g)},[r,n,t]);const c=async()=>{if(!s.content){j.error("Add a title first");return}p("impact"),w.mutate({content:s.content,rationale:s.rationale},{onSuccess:d=>{const k=[];if(d.impact_summary&&k.push(d.impact_summary),d.rationale&&s.rationale!==d.rationale&&k.push(d.rationale),d.summary&&k.push(d.summary),k.length>0){const f=k.join(`

`);a(D=>({...D,rationale:D.rationale?`${D.rationale}

${f}`:f}))}p(null),j.success("AI impact analysis added")},onError:()=>{p(null),j.error("AI impact analysis failed")}})};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:o}),e.jsx($.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:n==="create"?"New Decision":"Edit Decision"}),e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg hover:bg-[var(--gm-surface-hover)] flex items-center justify-center",children:e.jsx(ie,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsxs("div",{className:"px-5 pt-4 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:c,disabled:!!b,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[b==="impact"?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ae,{className:"w-3.5 h-3.5"})," AI Impact Analysis"]}),e.jsxs("button",{type:"button",disabled:h.isPending||!s.content.trim(),onClick:()=>h.mutate({content:s.content,rationale:s.rationale},{onSuccess:d=>{const k=d?.suggested_owners;k?.[0]&&(a(f=>({...f,owner:String(k[0].name||k[0].id||"")})),j.success("Owner suggested by AI"))},onError:()=>j.error("Owner suggestion failed")}),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 disabled:opacity-50",children:[h.isPending?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ae,{className:"w-3.5 h-3.5"})," AI Suggest Owner"]})]}),e.jsxs("form",{onSubmit:d=>{d.preventDefault(),s.content.trim()&&(m({id:r?.id||String(Date.now()),...s}),o())},className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Title *"}),e.jsx("input",{value:s.content,onChange:d=>a({...s,content:d.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Decision title...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Rationale / Description"}),e.jsx("textarea",{value:s.rationale||"",onChange:d=>a({...s,rationale:d.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[80px] resize-y",placeholder:"Describe the decision and rationale..."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(Le,{value:s.owner||"",onChange:d=>a({...s,owner:d}),label:"Owner",placeholder:"Decision maker..."}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Date"}),e.jsx("input",{type:"date",value:s.decision_date||"",onChange:d=>a({...s,decision_date:d.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Status"}),e.jsxs("select",{value:s.status,onChange:d=>a({...s,status:d.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:n==="create"?"Create":"Save"})]})]})]})})]})})},Js=({decision:t,onBack:o,onEdit:m,onDelete:r})=>{const[n,g]=l.useState(!1),[s,a]=l.useState([]),b=G(),p=async()=>{g(!0),b.mutate({message:`Analyze this project decision and provide insights:
Title: "${t.content}"
Rationale: "${t.rationale||""}"
Owner: ${t.owner||"unknown"}
Date: ${t.decision_date||""}
Status: ${t.status}
Provide: impact assessment, related actions/risks, and recommendations.`},{onSuccess:w=>{const h=w?.response;h&&a(h.split(`
`).filter(c=>c.trim())),g(!1),j.success("AI analysis complete")},onError:()=>{g(!1),j.error("AI analysis failed")}})};return e.jsxs($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:t.content||t.decision||t.summary||"(untitled decision)"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["Decision #",t.id?.substring(0,8)]})]}),e.jsxs("button",{onClick:p,disabled:n,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[n?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Analyze"]}),e.jsxs("button",{onClick:()=>m(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Edit"]}),r&&e.jsxs("button",{onClick:()=>{r(t.id),o()},className:"px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs hover:bg-red-500/20 flex items-center gap-1.5",children:[e.jsx(de,{className:"w-3.5 h-3.5"})," Delete"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${ot(t.status)}`,children:t.status||"—"})}),t.rationale&&e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Rationale"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)] whitespace-pre-wrap",children:t.rationale})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Decision Maker"})]}),t.owner?e.jsx(ne,{name:t.owner,size:"md"}):e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Unknown"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(at,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Date"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.decision_date||"—"})]})]}),s.length>0&&e.jsxs($.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Insights"]}),e.jsx("ul",{className:"space-y-1.5",children:s.map((w,h)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:w},h))})]})]})},Zs=({initialData:t=[],onSave:o,onDelete:m})=>{const[r,n]=l.useState(t),g=G();l.useEffect(()=>{t&&n(t)},[t]);const[s,a]=l.useState("all"),[b,p]=l.useState(!1),[w,h]=l.useState("create"),[c,d]=l.useState(null),[k,f]=l.useState(null),[D,N]=l.useState(!1),M=l.useMemo(()=>s==="all"?r:r.filter(x=>x.status===s),[r,s]),A=l.useMemo(()=>({total:r.length,approved:r.filter(x=>x.status==="approved").length,pending:r.filter(x=>x.status==="pending").length,active:r.filter(x=>x.status==="active").length,rejected:r.filter(x=>x.status==="rejected").length}),[r]),S=x=>{n(I=>{const y=I.findIndex(u=>u.id===x.id);if(y>=0){const u=[...I];return u[y]=x,u}return[...I,x]}),o?.(x)},F=x=>{n(I=>I.filter(y=>y.id!==x)),m?.(x),j.success("Decision deleted")},z=async()=>{N(!0),g.mutate({message:"Based on the current project state, suggest one important decision that should be made. Return on line 1: the decision title. Line 2: brief rationale."},{onSuccess:x=>{const I=x?.response;if(I){const y=I.split(`
`).filter(Q=>Q.trim()),u=y[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||I.trim(),L=y.slice(1).join(`
`).trim(),T={id:`ai-${Date.now()}`,content:u,rationale:L,owner:"",decision_date:new Date().toISOString().split("T")[0],status:"pending"};n(Q=>[...Q,T]),o?.(T)}N(!1),j.success("AI suggested a new decision")},onError:()=>{N(!1),j.error("AI suggestion failed")}})};return k?e.jsx(Js,{decision:k,onBack:()=>f(null),onEdit:x=>{f(null),d(x),h("edit"),p(!0)},onDelete:F}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Total",value:A.total,color:"text-[var(--gm-text-primary)]"},{label:"Approved",value:A.approved,color:"text-green-400"},{label:"Pending",value:A.pending,color:"text-primary"},{label:"Active",value:A.active,color:"text-purple-400"},{label:"Rejected",value:A.rejected,color:"text-red-400"}].map(x=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${x.color}`,children:x.value}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:x.label})]},x.label))}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{value:s,onChange:x=>a(x.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:z,disabled:D,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[D?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," AI Suggest"]}),e.jsxs("button",{onClick:()=>{d(null),h("create"),p(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Add Decision"]})]}),e.jsx("div",{className:"space-y-2",children:M.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No decisions match the current filter"}):M.map(x=>e.jsxs($.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>f(x),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate group-hover:text-blue-400 transition-colors",children:x.content||x.decision||x.summary||x.context||"(no title)"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5 line-clamp-1",children:x.rationale||x.context||""})]}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${ot(x.status)}`,children:x.status||"—"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2.5",children:[x.owner?e.jsx(ne,{name:x.owner,size:"sm"}):e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No owner"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:x.decision_date||""})]})]},x.id))}),e.jsx(Ws,{open:b,onClose:()=>p(!1),onSave:S,decision:c,mode:w})]})},Ks=t=>t==="done"?"bg-green-500/10 text-green-400":t==="in_progress"?"bg-blue-500/10 text-blue-400":t==="cancelled"?"bg-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]":"bg-amber-500/10 text-amber-400",Xs=t=>t==="high"?"bg-red-500/10 text-red-400":t==="medium"?"bg-amber-500/10 text-amber-400":"bg-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]",Ys=({open:t,onClose:o,story:m,mode:r})=>{const n=St(),g=Ct(),s={title:"",description:"",acceptance_criteria:"",priority:"medium",status:"backlog"},[a,b]=l.useState(s);l.useEffect(()=>{b(m&&r==="edit"?{title:m.title||"",description:m.description||"",acceptance_criteria:m.acceptance_criteria||"",priority:m.priority||"medium",status:m.status||"backlog"}:s)},[m,r,t]);const p=()=>{if(!a.title.trim()){j.error("Title is required");return}r==="edit"&&m?g.mutate({id:m.id,...a},{onSuccess:()=>{j.success("Story updated"),o()},onError:()=>j.error("Failed to update")}):n.mutate(a,{onSuccess:()=>{j.success("Story created"),o()},onError:()=>j.error("Failed to create")})},w=n.isPending||g.isPending;return t?e.jsx(X,{children:e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center",onClick:o,children:e.jsxs($.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl w-full max-w-lg p-5 shadow-2xl",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:r==="create"?"New User Story":"Edit User Story"}),e.jsx("button",{onClick:o,className:"p-1 rounded text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(ie,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Title *"}),e.jsx("input",{value:a.title,onChange:h=>b(c=>({...c,title:h.target.value})),className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)]",placeholder:"As a user, I want to..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:h=>b(c=>({...c,description:h.target.value})),rows:3,className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] resize-y",placeholder:"Detailed description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Acceptance Criteria"}),e.jsx("textarea",{value:a.acceptance_criteria,onChange:h=>b(c=>({...c,acceptance_criteria:h.target.value})),rows:3,className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] resize-y font-mono text-xs",placeholder:"Given... When... Then..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Priority"}),e.jsxs("select",{value:a.priority,onChange:h=>b(c=>({...c,priority:h.target.value})),className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Status"}),e.jsxs("select",{value:a.status,onChange:h=>b(c=>({...c,status:h.target.value})),className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"backlog",children:"Backlog"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-5 pt-4 border-t border-[var(--gm-border-primary)]",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 rounded-lg text-sm text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-secondary)]",children:"Cancel"}),e.jsxs("button",{onClick:p,disabled:w,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-[var(--gm-accent-primary)] text-white text-sm font-medium hover:opacity-90 disabled:opacity-50",children:[w?e.jsx(_,{className:"w-4 h-4 animate-spin"}):e.jsx(At,{className:"w-4 h-4"}),w?"Saving...":"Save"]})]})]})})}):null};function qs(){const{data:t,isLoading:o}=wt(),m=kt(),[r,n]=l.useState(!1),[g,s]=l.useState("create"),[a,b]=l.useState(null),[p,w]=l.useState(""),[h,c]=l.useState("all"),[d,k]=l.useState("all"),f=t?.stories??[],D=l.useMemo(()=>{let S=f;if(h!=="all"&&(S=S.filter(F=>F.status===h)),d!=="all"&&(S=S.filter(F=>F.priority===d)),p){const F=p.toLowerCase();S=S.filter(z=>z.title.toLowerCase().includes(F)||z.description?.toLowerCase().includes(F))}return S},[f,h,d,p]),N=S=>{b(S),s("edit"),n(!0)},M=()=>{b(null),s("create"),n(!0)},A=S=>{confirm("Delete this user story?")&&m.mutate(S,{onSuccess:()=>j.success("Story deleted")})};return o?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(_,{className:"w-6 h-6 animate-spin text-[var(--gm-accent-primary)]"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ys,{open:r,onClose:()=>n(!1),story:a,mode:g}),e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:p,onChange:S=>w(S.target.value),placeholder:"Search stories...",className:"bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] w-48"}),e.jsxs("select",{value:h,onChange:S=>c(S.target.value),className:"bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-2 py-1.5 text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"backlog",children:"Backlog"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs("select",{value:d,onChange:S=>k(S.target.value),className:"bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-2 py-1.5 text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"all",children:"All priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("button",{onClick:M,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-[var(--gm-accent-primary)] text-white text-sm font-medium hover:opacity-90 transition-opacity",children:[e.jsx(ue,{className:"w-4 h-4"})," New Story"]})]}),D.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"w-10 h-10 mx-auto text-[var(--gm-text-tertiary)] opacity-40 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:f.length===0?"No user stories yet. Create one above.":"No stories match your filters."})]}):e.jsx("div",{className:"space-y-2",children:D.map((S,F)=>e.jsx($.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:F*.03},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4 hover:border-[var(--gm-accent-primary)]/20 transition-colors group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0",children:e.jsx(De,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:S.title}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Ks(S.status)}`,children:(S.status||"backlog").replace("_"," ")}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Xs(S.priority)}`,children:S.priority||"medium"})]}),S.description&&e.jsx("p",{className:"text-xs text-[var(--gm-text-secondary)] line-clamp-2 mb-1",children:S.description}),S.acceptance_criteria&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono line-clamp-1 mt-1",children:["AC: ",S.acceptance_criteria]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:[e.jsx("button",{onClick:()=>N(S),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-secondary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(ge,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>A(S.id),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-red-500/10 hover:text-red-400",children:e.jsx(de,{className:"w-3.5 h-3.5"})})]})]})},S.id))})]})}const Y="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)]",me="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]";function oe(t){return t&&typeof t=="object"?t:{}}function wr(){const[t,o]=l.useState("overview"),[m,r]=l.useState("questions"),[n,g]=l.useState(""),[s,a]=l.useState(""),[b,p]=l.useState(!0),{data:w}=Dt(),{data:h}=It(),{data:c}=Mt(),{data:d}=Lt(),k=Et(),f=$t(),D=Rt(),N=Ft(),M=_t(),A=Pt(),S=Ot(),F=zt(),z=Tt(),x=Ut(),I=Qt(),y=Ht(),u=Vt(),L=Bt(),T=Gt(),Q=Wt(),V=Jt(),W=Zt(),B=Kt(),le=Xt(),Ee=Yt(),fe=qt(),$e=es(),ee=ts(),Re=ss(),je=rs(),Fe=as(),Ne=is(),{data:v,isLoading:R}=ns(100),{data:C}=ls(),U=cs(n,s),J=os(),Z=oe(w),te=oe(h).alerts??[],q=oe(c).insights??[],we=oe(d),Ue=we.changes??[],_e=oe(v).timeline??[],ke=oe(C).versions??[],Qe=oe(U.data),he=Number(Z.score??0),He=he>=70?"#22c55e":he>=40?"#f59e0b":"#ef4444",Ve=Ee.data?.facts??[],Be=$e.data?.decisions??[],Ge=Re.data?.risks??[],We=Fe.data?.actions??[],Pe=Ve.length+Be.length+Ge.length+We.length,Je=[{key:"questions",label:"Questions",count:k.data?.length??0},{key:"facts",label:"Facts",count:f.data?.length??0},{key:"risks",label:"Risks",count:D.data?.length??0},{key:"actions",label:"Actions",count:N.data?.length??0},{key:"decisions",label:"Decisions",count:M.data?.length??0},{key:"stories",label:"User Stories",count:0},{key:"trash",label:"Trash",count:Pe}],Ze=Je.reduce((i,P)=>i+P.count,0),dt=k.isLoading||f.isLoading||D.isLoading||N.isLoading||M.isLoading,mt=k.isError||f.isError||D.isError||N.isError||M.isError,xt=()=>{k.refetch(),f.refetch(),D.refetch(),N.refetch(),M.refetch()};function ve(i,P,O){return K=>{if(i?.some(ce=>ce.id===K.id))O.mutate(K);else{const{id:ce,...re}=K;P.mutate(re)}}}const Oe=async i=>{try{const P=await ms.get(`/api/sot/export/${i}`),O=typeof P=="string"?P:JSON.stringify(P,null,2),K=i==="json"?"application/json":"text/plain",se=new Blob([O],{type:K}),ce=URL.createObjectURL(se),re=document.createElement("a");re.href=ce,re.download=`sot-export.${i==="markdown"?"md":i}`,re.click(),URL.revokeObjectURL(ce),j.success(`Exported as ${i.toUpperCase()}`)}catch{j.error("Export failed")}};te.filter(i=>i.severity==="critical"||i.severity==="high");const Ke=l.useMemo(()=>{const i={};for(const P of _e){const O=P.date||P.created_at||P.timestamp,K=O?new Date(O).toLocaleDateString():"Unknown";i[K]||(i[K]=[]),i[K].push(P)}return Object.entries(i)},[_e]);return e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-[var(--gm-text-primary)]",children:"Source of Truth"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:[Ze," entities · ",te.length," alerts · Score ",he,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Oe("markdown"),"aria-label":"Export as Markdown",className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)]",children:[e.jsx(ze,{className:"w-3 h-3"})," MD"]}),e.jsxs("button",{onClick:()=>Oe("html"),"aria-label":"Export as HTML",className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)]",children:[e.jsx(hs,{className:"w-3 h-3"})," HTML"]}),e.jsxs("button",{onClick:()=>Oe("json"),"aria-label":"Export as JSON",className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)]",children:[e.jsx(vs,{className:"w-3 h-3"})," JSON"]})]})]}),e.jsx("div",{className:E(Y,"p-1 flex gap-1"),role:"tablist",children:[{key:"overview",label:"Overview",icon:bs},{key:"entities",label:`Entities (${Ze})`,icon:ze},{key:"timeline",label:`Timeline (${_e.length})`,icon:be},{key:"history",label:`History (${ke.length})`,icon:Xe}].map(i=>e.jsxs("button",{onClick:()=>o(i.key),role:"tab","aria-selected":t===i.key,className:E("flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-[11px] font-medium rounded-lg transition-colors",t===i.key?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:[e.jsx(i.icon,{className:"w-3.5 h-3.5"})," ",i.label]},i.key))}),t==="overview"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:E(Y,"p-5 flex items-center gap-5"),children:[e.jsxs("div",{className:"relative w-20 h-20 shrink-0",children:[e.jsxs("svg",{viewBox:"0 0 36 36",className:"w-full h-full -rotate-90",children:[e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:"var(--gm-bg-tertiary)",strokeWidth:"3"}),e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:He,strokeWidth:"3",strokeDasharray:`${he/100*97.4} 97.4`,strokeLinecap:"round",className:"transition-all duration-700"})]}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-lg font-bold tabular-nums",style:{color:He},children:he})]}),e.jsxs("div",{children:[e.jsx("div",{className:me,children:"Health Score"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-secondary)] mt-1 capitalize",children:Z.status||"—"}),Array.isArray(Z.factors)&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Z.factors.slice(0,3).map((i,P)=>e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:i.name||i.label||i.factor},P))})]})]}),e.jsxs("div",{className:E(Y,"p-5"),children:[e.jsx("div",{className:me,children:"Changes Since Last View"}),we.isFirstView?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-2",children:"First view — no prior snapshot"}):Ue.length>0?e.jsx("div",{className:"mt-2 space-y-1.5",children:Ue.map((i,P)=>{const O=Number(i.change??0);return e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-[var(--gm-text-secondary)] capitalize",children:i.metric||"—"}),e.jsxs("span",{className:E("flex items-center gap-1 font-medium tabular-nums",O>0?"text-green-400":O<0?"text-red-400":"text-[var(--gm-text-tertiary)]"),children:[O>0?e.jsx(ys,{className:"w-3 h-3"}):O<0?e.jsx(fs,{className:"w-3 h-3"}):e.jsx(js,{className:"w-3 h-3"}),O>0?"+":"",O]})]},P)})}):e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-2",children:"No changes since last view"}),we.summary&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-2",children:we.summary})]}),e.jsxs("div",{className:E(Y,"p-5"),children:[e.jsxs("div",{className:me,children:["Alerts (",te.length,")"]}),te.length>0?e.jsx("div",{className:"mt-2 space-y-2 max-h-40 overflow-y-auto",children:te.slice(0,8).map((i,P)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:E("w-1.5 h-1.5 rounded-full mt-1.5 shrink-0",i.severity==="critical"?"bg-red-500":i.severity==="high"?"bg-orange-500":i.severity==="medium"?"bg-amber-500":"bg-blue-500")}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-primary)] block truncate",children:i.title||i.message||"—"}),i.message&&i.title&&e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] block truncate",children:i.message})]})]},P))}):e.jsx("p",{className:"text-xs text-green-400 mt-2",children:"No active alerts"})]})]}),q.length>0&&e.jsxs("div",{className:E(Y,"overflow-hidden"),children:[e.jsxs("button",{onClick:()=>p(!b),className:"w-full px-5 py-3 flex items-center justify-between border-b border-[var(--gm-border-primary)] hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"w-3.5 h-3.5 text-[var(--gm-accent-primary)]"}),e.jsxs("span",{className:me,children:["Insights (",q.length,")"]})]}),b?e.jsx(ws,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}):e.jsx(xe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})]}),b&&e.jsx("div",{className:"divide-y divide-[var(--gm-border-primary)]",children:q.map((i,P)=>e.jsxs("div",{className:"px-5 py-3 flex items-start gap-3 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("span",{className:"text-lg shrink-0",children:i.icon||"💡"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-[var(--gm-text-primary)]",children:i.title||"—"}),i.category&&e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] capitalize",children:i.category})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-secondary)] mt-0.5",children:i.message||"—"}),i.suggestion&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-accent-primary)] mt-1",children:["→ ",i.suggestion]})]})]},P))})]}),e.jsxs("div",{className:E(Y,"p-4 flex items-center gap-3"),children:[e.jsxs("button",{onClick:()=>J.mutate(void 0,{onSuccess:i=>{i?.content||i?.summary?j.success("Executive summary generated"):j.info("No summary content returned")},onError:i=>j.error(i.message)}),disabled:J.isPending,className:"inline-flex items-center gap-1.5 px-4 py-2 text-xs font-medium rounded-lg bg-[var(--gm-accent-primary)] text-white hover:opacity-90 transition-opacity",children:[J.isPending?e.jsx(_,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ds,{className:"w-3.5 h-3.5"}),"Generate Executive Summary"]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"AI-generated summary of health, risks, and key decisions"})]})]}),t==="entities"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1 bg-[var(--gm-bg-tertiary)] rounded-xl p-1",role:"tablist",children:Je.map(i=>e.jsxs("button",{onClick:()=>r(i.key),role:"tab","aria-selected":m===i.key,className:E("flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors relative",m===i.key?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-sm":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:[i.label,e.jsx("span",{className:"ml-1.5 text-[10px] opacity-60",children:i.count})]},i.key))}),mt?e.jsx(xs,{message:"Failed to load Source of Truth data.",onRetry:xt}):dt?e.jsx(ps,{}):e.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},children:[m==="questions"&&e.jsx(Ls,{initialData:k.data??[],onSave:ve(k.data,A,S),onDelete:i=>F.mutate(i)}),m==="facts"&&e.jsx(Rs,{initialData:f.data??[],onSave:ve(f.data,z,x),onDelete:i=>I.mutate(i)}),m==="risks"&&e.jsx(Ps,{initialData:D.data??[],onSave:ve(D.data,y,u),onDelete:i=>L.mutate(i)}),m==="actions"&&e.jsx(Gs,{initialData:N.data??[],onSave:ve(N.data,T,Q),onDelete:i=>V.mutate(i)}),m==="decisions"&&e.jsx(Zs,{initialData:M.data??[],onSave:ve(M.data,W,B),onDelete:i=>le.mutate(i)}),m==="stories"&&e.jsx(qs,{}),m==="trash"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[var(--gm-text-tertiary)]",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Deleted entities (",Pe,")"]})]}),Pe===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-12",children:"Trash is empty"}):e.jsxs("div",{className:"space-y-2",children:[Ve.map(i=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3",children:[e.jsx("span",{className:"text-[9px] font-medium px-2 py-0.5 rounded-full bg-blue-500/10 text-blue-400",children:"fact"}),e.jsx("span",{className:"flex-1 text-sm text-[var(--gm-text-secondary)] truncate",children:i.content||"—"}),e.jsxs("button",{onClick:()=>{fe.mutate(String(i.id)),j.success("Fact restored")},disabled:fe.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 text-[10px] font-medium rounded-lg bg-green-500/10 text-green-400 hover:bg-green-500/20",children:[e.jsx(Ce,{className:"w-3 h-3"})," Restore"]})]},String(i.id))),Be.map(i=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3",children:[e.jsx("span",{className:"text-[9px] font-medium px-2 py-0.5 rounded-full bg-purple-500/10 text-purple-400",children:"decision"}),e.jsx("span",{className:"flex-1 text-sm text-[var(--gm-text-secondary)] truncate",children:i.content||"—"}),e.jsxs("button",{onClick:()=>{ee.mutate(String(i.id)),j.success("Decision restored")},disabled:ee.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 text-[10px] font-medium rounded-lg bg-green-500/10 text-green-400 hover:bg-green-500/20",children:[e.jsx(Ce,{className:"w-3 h-3"})," Restore"]})]},String(i.id))),Ge.map(i=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3",children:[e.jsx("span",{className:"text-[9px] font-medium px-2 py-0.5 rounded-full bg-red-500/10 text-red-400",children:"risk"}),e.jsx("span",{className:"flex-1 text-sm text-[var(--gm-text-secondary)] truncate",children:i.content||"—"}),e.jsxs("button",{onClick:()=>{je.mutate(String(i.id)),j.success("Risk restored")},disabled:je.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 text-[10px] font-medium rounded-lg bg-green-500/10 text-green-400 hover:bg-green-500/20",children:[e.jsx(Ce,{className:"w-3 h-3"})," Restore"]})]},String(i.id))),We.map(i=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3",children:[e.jsx("span",{className:"text-[9px] font-medium px-2 py-0.5 rounded-full bg-amber-500/10 text-amber-400",children:"action"}),e.jsx("span",{className:"flex-1 text-sm text-[var(--gm-text-secondary)] truncate",children:i.task||i.content||"—"}),e.jsxs("button",{onClick:()=>{Ne.mutate(String(i.id)),j.success("Action restored")},disabled:Ne.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 text-[10px] font-medium rounded-lg bg-green-500/10 text-green-400 hover:bg-green-500/20",children:[e.jsx(Ce,{className:"w-3 h-3"})," Restore"]})]},String(i.id)))]})]})]},m)]}),t==="timeline"&&e.jsx("div",{className:"space-y-4",children:R?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-[var(--gm-accent-primary)]"})}):Ke.length>0?e.jsx("div",{className:"space-y-6",children:Ke.map(([i,P])=>e.jsxs("div",{children:[e.jsx("div",{className:"sticky top-0 z-10 py-1.5 px-3 bg-[var(--gm-bg-primary)]",children:e.jsx("span",{className:"text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-wider",children:i})}),e.jsx("div",{className:"relative ml-4 border-l-2 border-[var(--gm-border-primary)] space-y-0",children:P.map((O,K)=>{const se=O.type||O.entity_type||"event",ce={decision:"bg-purple-500",risk:"bg-red-500",action:"bg-amber-500",fact:"bg-blue-500",question:"bg-cyan-500",document:"bg-green-500",email:"bg-pink-500",conversation:"bg-indigo-500"},re=O.date||O.created_at||O.timestamp;return e.jsxs("div",{className:"relative pl-6 py-2.5 hover:bg-[var(--gm-surface-hover)] transition-colors rounded-r-lg",children:[e.jsx("span",{className:E("absolute left-[-5px] top-3.5 w-2.5 h-2.5 rounded-full border-2 border-[var(--gm-bg-primary)]",ce[se]||"bg-gray-500")}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:E("text-[8px] px-1.5 py-0.5 rounded-full font-medium capitalize border",se==="risk"?"bg-red-500/10 border-red-500/30 text-red-400":se==="decision"?"bg-purple-500/10 border-purple-500/30 text-purple-400":se==="action"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:se}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)] truncate",children:O.title||O.content||O.name||"—"})]}),O.description&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate",children:O.description||O.content})]}),e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums shrink-0 mt-0.5",children:re?new Date(re).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]})]},K)})})]},i))}):e.jsxs("div",{className:E(Y,"p-8 text-center"),children:[e.jsx(be,{className:"w-8 h-8 text-[var(--gm-text-tertiary)] mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"No timeline events yet"})]})}),t==="history"&&e.jsxs("div",{className:"space-y-5",children:[ke.length>0?e.jsxs("div",{className:E(Y,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("span",{className:me,children:"Version History"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[ke.length," snapshots"]})]}),e.jsx("div",{className:"max-h-72 overflow-y-auto divide-y divide-[var(--gm-border-primary)]",children:ke.map((i,P)=>e.jsxs("div",{className:"px-5 py-3 flex items-center hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-bold text-[var(--gm-accent-primary)] tabular-nums",children:["v",i.version_number||P+1]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:i.created_at?new Date(i.created_at).toLocaleString():"—"})]}),e.jsxs("div",{className:"flex gap-3 mt-1 text-[9px] text-[var(--gm-text-tertiary)]",children:[i.facts_count!=null&&e.jsxs("span",{children:[i.facts_count," facts"]}),i.decisions_count!=null&&e.jsxs("span",{children:[i.decisions_count," decisions"]}),i.risks_count!=null&&e.jsxs("span",{children:[i.risks_count," risks"]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>g(String(i.version_number??i.id)),className:E("text-[9px] px-2 py-1 rounded border",n===String(i.version_number??i.id)?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:"V1"}),e.jsx("button",{onClick:()=>a(String(i.version_number??i.id)),className:E("text-[9px] px-2 py-1 rounded border",s===String(i.version_number??i.id)?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:"V2"})]})]},P))})]}):e.jsxs("div",{className:E(Y,"p-8 text-center"),children:[e.jsx(Xe,{className:"w-8 h-8 text-[var(--gm-text-tertiary)] mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"No version history yet"})]}),n&&s&&e.jsxs("div",{className:E(Y,"p-5 space-y-3"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:me,children:["Compare v",n," ↔ v",s]}),U.isFetching&&e.jsx(_,{className:"w-3.5 h-3.5 animate-spin text-[var(--gm-accent-primary)]"})]}),Qe.ok?e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] font-mono bg-[var(--gm-bg-tertiary)] p-3 rounded-lg overflow-auto max-h-64 whitespace-pre-wrap",children:JSON.stringify(Qe,null,2)}):U.isError?e.jsx("p",{className:"text-xs text-red-400",children:"Failed to compare versions"}):U.isFetching?null:e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Select V1 and V2 to compare"})]})]})]})}export{wr as default};
//# sourceMappingURL=SotPage-CrZdGcPe.js.map
