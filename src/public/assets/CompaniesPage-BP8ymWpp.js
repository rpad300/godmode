import{r as l,eT as B,j as e,eU as F,eV as V,eW as z,ai as T,a as c,N as w,K as R,Z as $,ad as _,J as O,ae as W,eX as M,dd as I,O as n,b0 as P}from"./main-DPJZnN-g.js";import{I as k}from"./input-CbHr_mul.js";import{E as q}from"./ErrorState-CGhToI5I.js";import{A as K,a as X,b as Y,c as Z,d as H,e as J,f as Q,g as ee}from"./alert-dialog-BmnPb2NC.js";import{P as te}from"./plus-D_qMNj9L.js";import{E as ae}from"./eye-Bsxv-RpG.js";import{P as se}from"./pen-EvlKYdM2.js";import{A as E}from"./arrow-left-zNkLqbte.js";import{G as re}from"./globe-pZEYczaD.js";import{E as ie,C as ne,P as le}from"./palette-CHxTQ3Bk.js";import"./index-Cd-aIfCY.js";import"./index-D4HbvI6D.js";const D="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",f="w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] transition-all duration-150",S="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",A="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",ce="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50",G="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",C="text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-1 flex items-center gap-1.5",L=["Ficha de Identidade","Visão Geral e Posicionamento","Produtos e Serviços","Público-Alvo e Clientes","Equipa e Liderança","Presença Digital e Marketing","Análise Competitiva","Indicadores de Crescimento","Análise SWOT","Conclusões e Insights"],ke=()=>{const[a,d]=l.useState("list"),[i,o]=l.useState(null),p=B(),m=(s,h)=>{o(s),d(h)},x=()=>{d("list"),o(null)};return e.jsxs("div",{className:"p-6 space-y-4",children:[a==="list"&&(p.isError?e.jsx(q,{message:"Failed to load companies",onRetry:()=>p.refetch()}):e.jsx(oe,{companies:p.data?.companies||[],loading:p.isLoading,onView:s=>m(s,"view"),onEdit:s=>m(s,"edit"),onTemplates:s=>m(s,"templates")})),a==="view"&&i&&e.jsx(me,{company:i,onBack:x,onEdit:()=>d("edit")}),a==="edit"&&i&&e.jsx(de,{company:i,onBack:x,onTemplates:()=>d("templates")}),a==="templates"&&i&&e.jsx(xe,{company:i,onBack:()=>d("edit")})]})};function oe({companies:a,loading:d,onView:i,onEdit:o,onTemplates:p}){const[m,x]=l.useState(""),[s,h]=l.useState(null),g=F(),j=V(),v=z(),y=async()=>{if(!m.trim()){n.error("Company name is required");return}try{await g.mutateAsync({name:m.trim()}),n.success("Company created"),x("")}catch(t){n.error(t.message||"Failed to create company")}},u=async t=>{n.info(`Analyzing ${t.name}...`);try{await v.mutateAsync(t.id),n.success(`${t.name} analysis started`)}catch(N){n.error(N.message||"Analysis failed")}},b=async()=>{if(s)try{await j.mutateAsync(s.id),n.success("Company deleted")}catch(t){n.error(t.message||"Failed to delete")}finally{h(null)}};return e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx(K,{open:!!s,onOpenChange:t=>{t||h(null)},children:e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsxs(Z,{children:["Delete ",s?.name||"this item","?"]}),e.jsx(H,{children:"This action cannot be undone. The company and all its data will be permanently removed."})]}),e.jsxs(J,{children:[e.jsx(Q,{children:"Cancel"}),e.jsx(ee,{onClick:b,className:ce,children:"Delete"})]})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:"Companies"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Manage company profiles and assets"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{value:m,onChange:t=>x(t.target.value),placeholder:"New company name...",className:c(f,"max-w-xs"),onKeyDown:t=>{t.key==="Enter"&&y()}}),e.jsxs("button",{onClick:y,disabled:g.isPending,className:c(S,"px-4 py-2 text-sm"),children:[g.isPending?e.jsx(w,{className:"w-4 h-4 animate-spin"}):e.jsx(te,{className:"w-4 h-4"})," New company"]})]}),d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(w,{className:"w-6 h-6 animate-spin text-[var(--gm-accent-primary)]"})}):a.length===0?e.jsx("div",{className:"text-center py-12 text-[var(--gm-text-tertiary)] text-sm",children:"No companies yet. Create one above."}):e.jsx("div",{className:"space-y-3",children:a.map((t,N)=>e.jsx(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:N*.05},className:c(D,"p-4 hover:border-[var(--gm-accent-primary)]/20"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-[var(--gm-bg-tertiary)] flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:(t.name||"???").substring(0,3).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:t.name}),(t.colors||[]).length>0&&e.jsx("div",{className:"flex gap-0.5",children:(t.colors||[]).map((r,U)=>e.jsx("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:r}},U))}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${t.status==="analyzed"?"bg-[var(--gm-accent-primary)]/10 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"}`,children:t.status==="analyzed"?"Analyzed":"Not analyzed"})]}),t.website&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:t.website})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 flex-wrap",children:[e.jsxs("button",{onClick:()=>i(t),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx(ae,{className:"w-3.5 h-3.5"})," View"]}),e.jsxs("button",{onClick:()=>o(t),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx(se,{className:"w-3.5 h-3.5"})," Edit"]}),e.jsxs("button",{onClick:()=>p(t),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx(R,{className:"w-3.5 h-3.5"})," Templates"]}),e.jsxs("button",{onClick:()=>u(t),className:"flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx($,{className:"w-3.5 h-3.5"})," ",t.status==="analyzed"?"Re-analyze":"Analyze"]}),e.jsx("button",{onClick:()=>h(t),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--color-danger-500)]/10 hover:text-[var(--color-danger-500)] transition-colors",children:e.jsx(_,{className:"w-3.5 h-3.5"})})]})]})},t.id))})]})}function me({company:a,onBack:d,onEdit:i}){const[o,p]=l.useState(L[0]),m=z(),x=async()=>{try{await m.mutateAsync(a.id),n.success("Analysis started")}catch(s){n.error(s.message||"Analysis failed")}};return e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("button",{onClick:d,className:"flex items-center gap-1.5 text-sm text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:[e.jsx(E,{className:"w-4 h-4"})," Back to Companies"]}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-[var(--gm-bg-tertiary)] flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:(a.name||"???").substring(0,3).toUpperCase()})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:a.name})}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[a.website&&e.jsxs("a",{href:a.website,target:"_blank",rel:"noreferrer",className:"text-xs text-[var(--gm-accent-primary)] flex items-center gap-1 hover:underline",children:[e.jsx(re,{className:"w-3 h-3"})," ",a.website]}),a.linkedin&&e.jsxs("a",{href:a.linkedin,target:"_blank",rel:"noreferrer",className:"text-xs text-[var(--gm-accent-primary)] flex items-center gap-1 hover:underline",children:[e.jsx(ie,{className:"w-3 h-3"})," LinkedIn"]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:x,disabled:m.isPending,className:c(S,"px-4 py-2 text-sm"),children:[m.isPending?e.jsx(w,{className:"w-4 h-4 animate-spin"}):e.jsx(O,{className:"w-4 h-4"})," Re-analyze"]}),e.jsx("button",{onClick:i,className:"text-sm text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:"Edit"})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-56 flex-shrink-0",children:[e.jsx("h4",{className:"text-xs font-semibold text-[var(--gm-text-primary)] mb-2",children:"Report Sections"}),e.jsx("div",{className:"space-y-0.5",children:L.map(s=>e.jsxs("button",{onClick:()=>p(s),className:`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center justify-between ${o===s?"bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)] font-medium":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[s,o===s&&e.jsx(W,{className:"w-3.5 h-3.5"})]},s))})]}),e.jsxs("div",{className:c(D,"flex-1 p-6"),children:[e.jsx("h3",{className:"text-lg font-bold text-[var(--gm-text-primary)] mb-4",children:o}),e.jsx("div",{className:"text-sm text-[var(--gm-text-tertiary)] whitespace-pre-line leading-relaxed",children:a.report?.[o]||`Content for "${o}" — run analysis to populate.`})]})]})]})}function de({company:a,onBack:d,onTemplates:i}){const[o,p]=l.useState(a.name),[m,x]=l.useState(a.description||""),[s,h]=l.useState(a.logo_url||""),[g,j]=l.useState(a.website||""),[v,y]=l.useState(a.linkedin||""),u=M(),b=async()=>{if(!o.trim()){n.error("Name is required");return}const t=/^https?:\/\//;if(g.trim()&&!t.test(g.trim())){n.error("Website must start with http:// or https://");return}if(v.trim()&&!t.test(v.trim())){n.error("LinkedIn URL must start with http:// or https://");return}try{await u.mutateAsync({id:a.id,name:o,description:m,logo_url:s,website:g,linkedin:v}),n.success("Company updated"),d()}catch(N){n.error(N.message||"Failed to save")}};return e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("button",{onClick:d,className:"flex items-center gap-1.5 text-sm text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:[e.jsx(E,{className:"w-4 h-4"})," Back to Companies"]}),e.jsxs("div",{className:c(D,"p-5"),children:[e.jsxs("h2",{className:"text-lg font-bold text-[var(--gm-text-primary)] mb-5",children:["Edit ",a.name]}),e.jsxs("div",{className:"max-w-lg space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:C,children:"Name *"}),e.jsx(k,{value:o,onChange:t=>p(t.target.value),className:f})]}),e.jsxs("div",{children:[e.jsx("label",{className:C,children:"Description"}),e.jsx("textarea",{value:m,onChange:t=>x(t.target.value),rows:4,className:c(f,"resize-y")})]}),e.jsxs("div",{children:[e.jsx("label",{className:C,children:"Logo URL"}),e.jsx(k,{value:s,onChange:t=>h(t.target.value),placeholder:"https://...",className:c(f,"font-mono text-xs")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:C,children:"Website"}),e.jsx(k,{value:g,onChange:t=>j(t.target.value),className:f})]}),e.jsxs("div",{children:[e.jsx("label",{className:C,children:"LinkedIn"}),e.jsx(k,{value:v,onChange:t=>y(t.target.value),className:f})]})]}),e.jsxs("div",{className:"border-t border-[var(--gm-border-primary)] pt-4 flex justify-center gap-2",children:[e.jsxs("button",{onClick:b,disabled:u.isPending,className:c(S,"px-5 py-2.5 text-sm"),children:[u.isPending?e.jsx(w,{className:"w-4 h-4 animate-spin"}):e.jsx(I,{className:"w-4 h-4"}),u.isPending?"Saving...":"Save"]}),e.jsx("button",{onClick:d,className:c(A,"px-5 py-2.5 text-sm"),children:"Cancel"})]})]}),e.jsxs("div",{className:"mt-8 pt-5 border-t border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:c(G,"text-sm mb-3"),children:"Documents"}),e.jsxs("button",{onClick:i,className:c(A,"px-4 py-2 text-sm"),children:[e.jsx(R,{className:"w-4 h-4"})," Templates (A4 / PPT)"]})]})]})]})}function xe({company:a,onBack:d}){const[i,o]=l.useState("a4"),[p,m]=l.useState("code"),[x,s]=l.useState(""),[h,g]=l.useState(!1),[j,v]=l.useState(!1),[y,u]=l.useState(!1),b=async()=>{g(!0);try{const r=await P.get(`/api/companies/${a.id}/templates/${i}`);s(r.template?.content||`<!-- No ${i} template yet -->`),n.success("Template loaded")}catch{s(`<!-- No ${i} template found -->`)}finally{g(!1)}},t=async()=>{v(!0);try{const r=await P.post(`/api/companies/${a.id}/templates/generate`,{type:i});s(r.template?.content||x),n.success("Template generated")}catch(r){n.error(r.message||"Generation failed")}finally{v(!1)}},N=async()=>{u(!0);try{await P.put(`/api/companies/${a.id}/templates/${i}`,{content:x}),n.success("Template saved")}catch(r){n.error(r.message||"Failed to save")}finally{u(!1)}};return l.useEffect(()=>{b()},[i]),e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("button",{onClick:d,className:"flex items-center gap-1.5 text-sm text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:[e.jsx(E,{className:"w-4 h-4"})," Back to Edit"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:[a.name," – Templates"]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Manage document templates for this company."})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex gap-1",children:["a4","ppt"].map(r=>e.jsx("button",{onClick:()=>o(r),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i===r?"bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"}`,children:r==="a4"?"A4 document":"Presentation"},r))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,disabled:h,className:c(A,"px-4 py-2 text-sm disabled:opacity-50"),children:h?"Loading...":"Load current"}),e.jsxs("button",{onClick:t,disabled:j,className:c(S,"px-4 py-2 text-sm"),children:[j?e.jsx(w,{className:"w-4 h-4 animate-spin"}):e.jsx($,{className:"w-4 h-4"}),j?"Generating...":"Generate with AI"]}),e.jsxs("button",{onClick:N,disabled:y,className:c(A,"px-4 py-2 text-sm disabled:opacity-50"),children:[y?e.jsx(w,{className:"w-4 h-4 animate-spin"}):e.jsx(I,{className:"w-4 h-4"}),y?"Saving...":"Save template"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex border-b border-[var(--gm-border-primary)] mb-2",children:["code","theme"].map(r=>e.jsxs("button",{onClick:()=>m(r),className:`flex items-center gap-1.5 px-3 py-2 text-sm border-b-2 transition-colors ${p===r?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent"}`,children:[r==="code"?e.jsx(ne,{className:"w-3.5 h-3.5"}):e.jsx(le,{className:"w-3.5 h-3.5"}),r==="code"?"Code":"Theme"]},r))}),e.jsx("textarea",{value:x,onChange:r=>s(r.target.value),className:c(f,"p-4 font-mono text-xs h-[500px] scrollbar-thin resize-none")})]}),e.jsxs("div",{className:"w-[320px] flex-shrink-0",children:[e.jsx("p",{className:c(G,"mb-2"),children:"Preview"}),e.jsxs("div",{className:"bg-white border border-[var(--gm-border-primary)] rounded-lg overflow-hidden h-[500px]",children:[e.jsx("div",{className:"h-1.5 bg-[var(--color-danger-500)]"}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[e.jsx("div",{className:"w-8 h-8 bg-[var(--gm-bg-tertiary)] rounded flex items-center justify-center",children:e.jsx("span",{className:"text-[8px] font-bold text-[var(--gm-text-tertiary)]",children:(a.name||"???").substring(0,3)})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-[var(--gm-text-primary)]",children:a.name}),e.jsxs("p",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:[i==="a4"?"Document":"Presentation"," Template"]})]})]}),e.jsxs("div",{className:"text-[9px] text-[var(--gm-text-tertiary)] whitespace-pre-wrap font-mono max-h-[400px] overflow-auto",children:[x.substring(0,500),x.length>500&&"..."]})]})]})]})]})]})}export{ke as default};
//# sourceMappingURL=CompaniesPage-BP8ymWpp.js.map
