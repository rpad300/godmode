import{r as p,j as e}from"./vendor-react-CZ-WyKWZ.js";import{t as b}from"./vendor-ui-BS9QKitv.js";import{h as ie,cE as le,cF as oe,cG as ce,cH as de,cI as me,c as h,J as O,cD as xe,aX as ge,L as $,T as pe,I as ue,Z as _,w as he,C as be,G as H,H as G,P as fe,R as ye,aV as je,cJ as ve,bo as V,bp as Z,bq as K}from"./main-B3DZn5B_.js";import{E as Ne}from"./ErrorState-to3SSPKs.js";import{C as I}from"./chart-column-BRODuIXF.js";import{A as we}from"./arrow-up-right-Bo3g-__Q.js";import{A as Ce}from"./arrow-down-right-B0obbrFU.js";import{M as ke}from"./minus-Dq-7J-8u.js";import{T as Se}from"./trending-up-CGQOSwHs.js";import{L as Te}from"./layers-Bgf9ppPM.js";import{C as q}from"./cpu-DUHk4ipN.js";import"./vendor-supabase-Bpw_79gH.js";import"./vendor-query-DSf7I7Ei.js";import"./vendor-router-D_XeKoA_.js";import"./vendor-markdown-Cu8AM8lU.js";const J=[{value:"day",label:"Today",short:"24h"},{value:"week",label:"This Week",short:"7d"},{value:"month",label:"This Month",short:"30d"},{value:"all",label:"All Time",short:"All"}];function He(){const[s,g]=p.useState("month"),[o,i]=p.useState(!1),[m,x]=p.useState(!1),[c,r]=p.useState(!1),[n,f]=p.useState(""),[a,C]=p.useState("model"),k=ie(s),R=le(50);oe();const D=ce(),W=de(s==="day"||s==="all"?"month":s),F=me(),l=k.data,y=Number(l?.total??0),X=l?.byProvider||{},U=l?.byModel||{},Q=l?.byOperation||{},Y=l?.byContext||{},j=l?.dailyBreakdown||[],ee=Number(l?.totalInputTokens??0),te=Number(l?.totalOutputTokens??0);l?.previousPeriodCost;const d=l?.percentChange,v=l?.budgetLimit,S=l?.budgetUsedPercent,E=!!l?.budgetAlertTriggered,T=l?.period,se=W.data?.budget,L=p.useMemo(()=>{const t=R.data?.requests||[];if(!n.trim())return t;const u=n.toLowerCase();return t.filter(N=>JSON.stringify(N).toLowerCase().includes(u))},[R.data,n]),re=Math.max(...j.map(t=>t.cost),.001),A=async t=>{try{const u=await je.get(`/api/costs/export?period=${s}&format=${t}`),N=typeof u=="string"?u:JSON.stringify(u,null,2),B=t==="csv"?"text/csv":"application/json",ne=new Blob([N],{type:B}),M=document.createElement("a");M.href=URL.createObjectURL(ne),M.download=`llm-costs-${s}-${new Date().toISOString().split("T")[0]}.${t}`,M.click(),URL.revokeObjectURL(M.href),b.success(`Exported as ${t.toUpperCase()}`)}catch{b.error("Export failed")}},ae=()=>{confirm("Reset in-memory cost tracking? This does not affect persisted data.")&&F.mutate(void 0,{onSuccess:()=>b.success("Cost tracking reset"),onError:()=>b.error("Failed to reset")})};return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gm-text-primary",children:"LLM Costs"}),e.jsx("p",{className:"text-xs text-gm-text-tertiary mt-0.5",children:T?.start&&T?.end?`${T.start.split("T")[0]} → ${T.end.split("T")[0]}`:J.find(t=>t.value===s)?.label})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex bg-gm-surface-secondary rounded-lg border border-gm-border-primary overflow-hidden",children:J.map(t=>e.jsx("button",{onClick:()=>g(t.value),className:h("px-3 py-1.5 text-xs font-medium transition-colors",s===t.value?"bg-gm-interactive-primary text-gm-text-on-brand":"text-gm-text-tertiary hover:text-gm-text-primary"),children:t.short},t.value))}),e.jsxs("button",{onClick:()=>i(!0),className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-xs text-gm-text-primary hover:bg-gm-surface-hover flex items-center gap-1.5 transition-colors",children:[e.jsx(O,{className:"w-3.5 h-3.5"})," Budget"]}),e.jsxs("button",{onClick:()=>x(!0),className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-xs text-gm-text-primary hover:bg-gm-surface-hover flex items-center gap-1.5 transition-colors",children:[e.jsx(xe,{className:"w-3.5 h-3.5"})," Pricing"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover flex items-center gap-1.5 transition-colors",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Export"]}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-gm-surface-primary border border-gm-border-primary rounded-lg shadow-lg z-10 hidden group-hover:block",children:[e.jsx("button",{onClick:()=>A("json"),className:"block w-full px-4 py-2 text-xs text-gm-text-primary hover:bg-gm-surface-hover text-left",children:"JSON"}),e.jsx("button",{onClick:()=>A("csv"),className:"block w-full px-4 py-2 text-xs text-gm-text-primary hover:bg-gm-surface-hover text-left",children:"CSV"})]})]})]})]}),k.error?e.jsx(Ne,{message:"Failed to load cost data.",onRetry:()=>k.refetch()}):k.isLoading?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($,{className:"h-8 w-8 animate-spin text-gm-interactive-primary"})}):e.jsxs(e.Fragment,{children:[v&&v>0&&e.jsxs("div",{className:h("rounded-xl p-4 border",E?"bg-gm-status-danger-bg border-red-500/20":"bg-gm-surface-secondary border-gm-border-primary"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-semibold text-gm-text-primary flex items-center gap-1.5",children:[e.jsx(O,{className:"w-3.5 h-3.5 text-gm-interactive-primary"})," Budget"]}),e.jsxs("span",{className:"text-xs text-gm-text-tertiary",children:["$",y.toFixed(2)," / $",v.toFixed(2)," USD"]})]}),e.jsx("div",{className:"w-full h-2.5 bg-gm-surface-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:h("h-full rounded-full transition-all",(S??0)>90?"bg-gm-status-danger":(S??0)>70?"bg-gm-status-warning":"bg-gm-interactive-primary"),style:{width:`${Math.min(S??0,100)}%`}})}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary",children:[(S??0).toFixed(1),"% used"]}),E&&e.jsxs("span",{className:"text-[10px] text-gm-status-danger flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"})," Budget alert triggered"]})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[e.jsx(w,{icon:ue,label:"Total Cost",value:`$${y.toFixed(4)}`,color:"text-green-500",bgColor:"bg-green-500/10"}),e.jsx(w,{icon:_,label:"Input Tokens",value:z(ee),color:"text-gm-interactive-primary",bgColor:"bg-blue-600/10"}),e.jsx(w,{icon:_,label:"Output Tokens",value:z(te),color:"text-purple-500",bgColor:"bg-purple-500/10"}),e.jsx(w,{icon:I,label:"Models Used",value:String(Object.keys(U).length),color:"text-orange-500",bgColor:"bg-orange-500/10"}),e.jsx(w,{icon:Se,label:"vs Previous",value:d!=null?`${d>0?"+":""}${d.toFixed(1)}%`:"N/A",color:d!=null?d>0?"text-gm-status-danger":d<0?"text-gm-status-success":"text-gm-text-tertiary":"text-gm-text-tertiary",bgColor:d!=null&&d>0?"bg-red-500/10":d!=null&&d<0?"bg-green-500/10":"bg-gm-surface-secondary",subIcon:d!=null?d>0?we:d<0?Ce:ke:void 0})]}),j.length>0&&e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-5",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-text-tertiary uppercase tracking-wider mb-4 flex items-center gap-1.5",children:[e.jsx(I,{className:"w-3.5 h-3.5"})," Daily Cost Trend"]}),e.jsx("div",{className:"flex items-end gap-[2px] h-32",children:j.map((t,u)=>{const N=Math.max(t.cost/re*100,2),B=t.date.split("-").slice(1).join("/");return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsxs("div",{className:"absolute bottom-full mb-1 bg-gm-surface-primary border border-gm-border-primary rounded-lg shadow-lg p-2 text-[10px] hidden group-hover:block z-10 whitespace-nowrap",children:[e.jsx("p",{className:"font-semibold text-gm-text-primary",children:t.date}),e.jsxs("p",{className:"text-green-500",children:["$",t.cost.toFixed(4)]}),e.jsxs("p",{className:"text-gm-text-tertiary",children:[t.calls," calls"]})]}),e.jsx("div",{className:h("w-full rounded-t transition-all hover:opacity-80",t.cost>(v?v/(j.length||30):1/0)?"bg-gm-status-warning":"bg-gm-interactive-primary"),style:{height:`${N}%`,minHeight:"2px"}}),j.length<=14&&e.jsx("span",{className:"text-[8px] text-gm-text-tertiary mt-1 -rotate-45 origin-top-left",children:B})]},u)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(P,{title:"By Provider",icon:Te,data:X,expanded:a==="provider",onToggle:()=>C(a==="provider"?null:"provider"),totalCost:y}),e.jsx(P,{title:"By Model",icon:q,data:U,expanded:a==="model",onToggle:()=>C(a==="model"?null:"model"),totalCost:y}),e.jsx(P,{title:"By Operation",icon:_,data:Q,expanded:a==="operation",onToggle:()=>C(a==="operation"?null:"operation"),totalCost:y}),e.jsx(P,{title:"By Context",icon:he,data:Y,expanded:a==="context",onToggle:()=>C(a==="context"?null:"context"),totalCost:y})]}),e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl",children:[e.jsxs("button",{onClick:()=>r(!c),className:"w-full flex items-center justify-between p-4 text-left",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-text-tertiary uppercase tracking-wider flex items-center gap-1.5",children:[e.jsx(be,{className:"w-3.5 h-3.5"})," Recent LLM Requests",L.length>0&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-gm-surface-secondary",children:L.length})]}),c?e.jsx(H,{className:"w-4 h-4 text-gm-text-tertiary"}):e.jsx(G,{className:"w-4 h-4 text-gm-text-tertiary"})]}),c&&e.jsxs("div",{className:"px-4 pb-4 space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gm-text-tertiary"}),e.jsx("input",{value:n,onChange:t=>f(t.target.value),placeholder:"Search requests...",className:"w-full pl-9 pr-3 py-1.5 bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),R.isLoading?e.jsx($,{className:"w-5 h-5 animate-spin text-gm-interactive-primary mx-auto my-4"}):L.length===0?e.jsx("p",{className:"text-xs text-gm-text-tertiary text-center py-4",children:"No recent requests."}):e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-1",children:L.map((t,u)=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-hover)] rounded-lg p-2.5 group hover:bg-gm-surface-secondary transition-colors",children:[e.jsx(q,{className:"w-3.5 h-3.5 text-gm-text-tertiary shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gm-text-primary truncate",children:String(t.model||t.llm_model||"—")}),e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary capitalize",children:String(t.operation||t.context||"—")})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 text-[10px] text-gm-text-tertiary",children:[e.jsx("span",{children:String(t.provider||t.llm_provider||"—")}),t.input_tokens&&e.jsxs("span",{children:[Number(t.input_tokens).toLocaleString()," in"]}),t.output_tokens&&e.jsxs("span",{children:[Number(t.output_tokens).toLocaleString()," out"]}),t.latency_ms&&e.jsxs("span",{children:[Number(t.latency_ms),"ms"]})]})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsxs("span",{className:"text-xs font-mono font-medium text-green-500",children:["$",Number(t.cost_usd||t.cost||0).toFixed(4)]}),t.created_at&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:new Date(String(t.created_at)).toLocaleTimeString()})]})]},u))})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:ae,disabled:F.isPending,className:"px-3 py-1.5 rounded-lg text-xs text-gm-text-tertiary hover:text-gm-status-danger flex items-center gap-1.5 transition-colors",children:[e.jsx(ye,{className:h("w-3.5 h-3.5",F.isPending&&"animate-spin")})," Reset Tracking"]})})]}),e.jsx(Le,{open:o,onClose:()=>i(!1),currentBudget:se,period:s==="day"||s==="all"?"month":s}),e.jsx(Me,{open:m,onClose:()=>x(!1),pricing:D.data?.pricing||[],isLoading:D.isLoading})]})}function w({icon:s,label:g,value:o,color:i,bgColor:m,subIcon:x}){return e.jsx("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:h("w-8 h-8 rounded-lg flex items-center justify-center",m),children:e.jsx(s,{className:h("w-4 h-4",i)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:h("text-lg font-bold",i),children:o}),x&&e.jsx(x,{className:h("w-3.5 h-3.5",i)})]}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider",children:g})]})]})})}function P({title:s,icon:g,data:o,expanded:i,onToggle:m,totalCost:x}){const c=Object.entries(o).sort(([,r],[,n])=>n-r);return c.length===0?null:e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:m,className:"w-full flex items-center justify-between p-4 text-left hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-text-tertiary uppercase tracking-wider flex items-center gap-1.5",children:[e.jsx(g,{className:"w-3.5 h-3.5"})," ",s,e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-gm-surface-secondary",children:c.length})]}),i?e.jsx(H,{className:"w-4 h-4 text-gm-text-tertiary"}):e.jsx(G,{className:"w-4 h-4 text-gm-text-tertiary"})]}),i&&e.jsx("div",{className:"px-4 pb-4 space-y-2",children:c.map(([r,n])=>{const f=x>0?n/x*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gm-text-primary truncate mr-2",children:r}),e.jsxs("span",{className:"font-mono text-green-500 shrink-0",children:["$",n.toFixed(4)]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gm-surface-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gm-interactive-primary rounded-full transition-all",style:{width:`${Math.max(f,1)}%`}})}),e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary",children:[f.toFixed(1),"%"]})]},r)})})]})}function Le({open:s,onClose:g,currentBudget:o,period:i}){const[m,x]=p.useState(String(o?.limit_usd||"")),[c,r]=p.useState(String(o?.alert_threshold_percent||"80")),n=ve(),f=()=>{const a=parseFloat(m);if(!a||a<=0){b.error("Enter a valid budget limit");return}n.mutate({period:i,limit_usd:a,alert_threshold_percent:parseInt(c)||80},{onSuccess:()=>{b.success("Budget updated"),g()},onError:()=>b.error("Failed to update budget")})};return e.jsx(V,{open:s,onOpenChange:a=>!a&&g(),children:e.jsxs(Z,{className:"max-w-sm",children:[e.jsx(K,{className:"text-base font-semibold text-gm-text-primary",children:"Set Budget"}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider",children:"Period"}),e.jsx("p",{className:"text-sm text-gm-text-primary capitalize mt-1",children:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider",children:"Budget Limit (USD)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:m,onChange:a=>x(a.target.value),placeholder:"e.g. 50.00",className:"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider",children:"Alert Threshold (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:c,onChange:a=>r(a.target.value),placeholder:"80",className:"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"}),e.jsx("p",{className:"text-[10px] text-gm-text-tertiary mt-1",children:"Alert triggers when spend exceeds this % of the limit"})]}),o&&e.jsx("div",{className:"bg-gm-surface-secondary rounded-lg p-3",children:e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:["Current budget: $",Number(o.limit_usd||0).toFixed(2)," USD (",o.alert_threshold_percent||80,"% alert)"]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 rounded-lg bg-gm-surface-secondary text-gm-text-primary text-sm hover:bg-gm-surface-hover border border-gm-border-primary transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:f,disabled:n.isPending,className:"px-4 py-2 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-sm font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[n.isPending?e.jsx($,{className:"w-4 h-4 animate-spin"}):e.jsx(O,{className:"w-4 h-4"})," Save Budget"]})]})]})]})})}function Me({open:s,onClose:g,pricing:o,isLoading:i}){const[m,x]=p.useState(""),c=o.filter(r=>!m||String(r.model||"").toLowerCase().includes(m.toLowerCase()));return e.jsx(V,{open:s,onOpenChange:r=>!r&&g(),children:e.jsxs(Z,{className:"max-w-xl p-0 overflow-hidden max-h-[80vh] flex flex-col",children:[e.jsx(K,{className:"text-base font-semibold text-gm-text-primary p-5 pb-0",children:"Model Pricing"}),e.jsx("div",{className:"px-5 pt-3 pb-2",children:e.jsx("input",{value:m,onChange:r=>x(r.target.value),placeholder:"Search models...",className:"w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-5 pb-5",children:i?e.jsx($,{className:"w-6 h-6 animate-spin text-gm-interactive-primary mx-auto my-8"}):c.length===0?e.jsx("p",{className:"text-xs text-gm-text-tertiary text-center py-8",children:"No pricing data available."}):e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gm-border-primary text-gm-text-tertiary",children:[e.jsx("th",{className:"py-2 text-left font-medium",children:"Model"}),e.jsx("th",{className:"py-2 text-right font-medium",children:"Input / 1M tokens"}),e.jsx("th",{className:"py-2 text-right font-medium",children:"Output / 1M tokens"})]})}),e.jsx("tbody",{children:c.map((r,n)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"py-2 font-medium text-gm-text-primary",children:String(r.model)}),e.jsxs("td",{className:"py-2 text-right font-mono text-gm-text-secondary",children:["$",Number(r.inputPer1M||0).toFixed(2)]}),e.jsxs("td",{className:"py-2 text-right font-mono text-gm-text-secondary",children:["$",Number(r.outputPer1M||0).toFixed(2)]})]},n))})]})})]})})}function z(s){return s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:String(s)}export{He as default};
//# sourceMappingURL=CostsPage-CVXcg9Q4.js.map
