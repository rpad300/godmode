{"version":3,"mappings":"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","names":["TYPE_COLORS","originalNodes","originalEdges","createGraphCanvas","props","container","createElement","initCanvas","__vitePreload","e","toast","canvasEl","loadingEl","legendEl","avatarOverlay","wrapper","width","height","isDark","bgColor","fgColor","node","event","originalNode","showNodeTooltipInternal","hideNodeTooltipInternal","link","originalEdge","data","graphService","syncBtn","on","canvasData","transformData","updateLegend","renderAvatarOverlays","error","zoomInBtn","zoomOutBtn","fitBtn","refreshBtn","currentZoom","nodes","edges","seenNodeIds","canvasNodes","nodeName","displayName","nodeType","role","org","content","nodeSize","seenEdgeIds","canvasLinks","edge","edgeId","types","type","overlayEl","_canvasEl","style","tooltip","acc","x","y","isContact","initials","n","avatarHtml","contentHtml","padding","viewportWidth","viewportHeight","tooltipRect","left","top"],"ignoreList":[],"sources":["../../frontend/components/graph/GraphCanvas.ts"],"sourcesContent":["/**\n * GraphCanvas - Graph visualization component using @falkordb/canvas\n * \n * High-performance graph visualization with support for:\n * - Contact avatars\n * - Rich tooltips\n * - Custom node styling\n * \n * Data source: Supabase (graph_nodes, graph_relationships tables)\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { graphService, GraphNode, GraphEdge } from '../../services/graph';\nimport { toast } from '../../services/toast';\n\n// Type definitions for canvas nodes\ninterface CanvasNode {\n  id: string | number;\n  labels: string[];\n  color: string;\n  visible: boolean;\n  size?: number;\n  caption?: string;\n  image?: string; // Avatar URL for contacts\n  data: Record<string, unknown>;\n}\n\ninterface CanvasLink {\n  id: string | number;\n  relationship: string;\n  color: string;\n  source: string | number;\n  target: string | number;\n  visible: boolean;\n  data: Record<string, unknown>;\n}\n\ninterface CanvasData {\n  nodes: CanvasNode[];\n  links: CanvasLink[];\n}\n\ninterface CanvasElement extends HTMLElement {\n  setData: (data: CanvasData) => void;\n  getData: () => CanvasData;\n  setConfig: (config: Record<string, unknown>) => void;\n  setWidth: (width: number) => void;\n  setHeight: (height: number) => void;\n  setBackgroundColor: (color: string) => void;\n  setForegroundColor: (color: string) => void;\n  setIsLoading: (loading: boolean) => void;\n  zoomToFit: (padding?: number) => void;\n  getZoom: () => number;\n  zoom: (level: number) => void;\n}\n\nexport interface GraphCanvasProps {\n  onNodeClick?: (node: GraphNode) => void;\n  onNodeRightClick?: (node: GraphNode) => void;\n  onLinkClick?: (edge: GraphEdge) => void;\n  onDataLoaded?: (stats: { nodeCount: number; edgeCount: number }) => void;\n  height?: number;\n}\n\n// Alias for backward compatibility\nexport type FalkorDBCanvasProps = GraphCanvasProps;\n\n// Color mapping for node types\nconst TYPE_COLORS: Record<string, string> = {\n  Person: '#6366f1',      // Indigo\n  Organization: '#8b5cf6', // Purple\n  Project: '#10b981',     // Emerald\n  Meeting: '#f59e0b',     // Amber\n  Document: '#3b82f6',    // Blue\n  Fact: '#22c55e',        // Green\n  Decision: '#06b6d4',    // Cyan\n  Risk: '#ef4444',        // Red\n  Task: '#14b8a6',        // Teal\n  Question: '#f97316',    // Orange\n  Technology: '#eab308',  // Yellow\n  Client: '#ec4899',      // Pink\n  Team: '#84cc16',        // Lime\n  Regulation: '#a3a3a3',  // Gray\n  Answer: '#22d3ee',      // Light cyan\n  Email: '#60a5fa',       // Light blue\n  Conversation: '#c084fc', // Light purple\n  Action: '#4ade80',      // Light green\n  Briefing: '#fbbf24',    // Light amber\n};\n\n// Store original nodes for click callbacks\nlet originalNodes: Map<string, GraphNode> = new Map();\nlet originalEdges: Map<string, GraphEdge> = new Map();\n\n/**\n * Create the Graph Canvas component\n */\nexport function createGraphCanvas(props: GraphCanvasProps = {}): HTMLElement {\n  const container = createElement('div', { className: 'graph-canvas-container' });\n  \n  container.innerHTML = `\n    <div class=\"graph-canvas-wrapper\" style=\"position: relative; width: 100%; height: ${props.height || 500}px;\">\n      <div class=\"graph-canvas-loading\" style=\"position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; gap: 8px;\">\n        <div class=\"loading-spinner\"></div>\n        <p style=\"color: var(--text-muted); font-size: 14px;\">Loading graph data...</p>\n      </div>\n      <falkordb-canvas id=\"graph-canvas\" style=\"width: 100%; height: 100%;\"></falkordb-canvas>\n      <div class=\"graph-avatar-overlay\" id=\"avatar-overlay\"></div>\n    </div>\n    <div class=\"graph-canvas-controls\" style=\"display: flex; gap: 8px; margin-top: 12px; justify-content: center;\">\n      <button class=\"btn btn-sm\" id=\"gc-zoom-in\" title=\"Zoom In\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <circle cx=\"11\" cy=\"11\" r=\"8\"/><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\n          <line x1=\"11\" y1=\"8\" x2=\"11\" y2=\"14\"/><line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\"/>\n        </svg>\n      </button>\n      <button class=\"btn btn-sm\" id=\"gc-zoom-out\" title=\"Zoom Out\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <circle cx=\"11\" cy=\"11\" r=\"8\"/><line x1=\"21\" y1=\"21\" x2=\"16.65\" y2=\"16.65\"/>\n          <line x1=\"8\" y1=\"11\" x2=\"14\" y2=\"11\"/>\n        </svg>\n      </button>\n      <button class=\"btn btn-sm\" id=\"gc-fit\" title=\"Fit to View\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3\"/>\n        </svg>\n      </button>\n      <button class=\"btn btn-sm\" id=\"gc-refresh\" title=\"Refresh Data\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16\"/>\n        </svg>\n      </button>\n    </div>\n    <div class=\"graph-canvas-legend\" style=\"margin-top: 12px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;\">\n      <h5 style=\"margin: 0 0 8px 0; font-size: 12px; color: var(--text-muted);\">Legend</h5>\n      <div id=\"gc-legend\" style=\"display: flex; flex-wrap: wrap; gap: 8px; font-size: 11px;\">\n        <!-- Legend items will be added dynamically -->\n      </div>\n    </div>\n  `;\n\n  // Initialize after DOM is ready\n  setTimeout(() => initCanvas(container, props), 100);\n\n  return container;\n}\n\n/**\n * Initialize the canvas\n */\nasync function initCanvas(container: HTMLElement, props: GraphCanvasProps): Promise<void> {\n  // Import the web component\n  try {\n    await import('@falkordb/canvas');\n  } catch (e) {\n    console.error('[GraphCanvas] Failed to load @falkordb/canvas:', e);\n    toast.error('Failed to load graph visualization library');\n    return;\n  }\n\n  const canvasEl = container.querySelector('#graph-canvas') as CanvasElement;\n  const loadingEl = container.querySelector('.graph-canvas-loading') as HTMLElement;\n  const legendEl = container.querySelector('#gc-legend') as HTMLElement;\n  const avatarOverlay = container.querySelector('#avatar-overlay') as HTMLElement;\n  \n  if (!canvasEl) {\n    console.error('[GraphCanvas] Canvas element not found');\n    return;\n  }\n\n  // Get container dimensions\n  const wrapper = container.querySelector('.graph-canvas-wrapper') as HTMLElement;\n  const width = wrapper.clientWidth || 800;\n  const height = wrapper.clientHeight || 500;\n\n  // Determine theme colors\n  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';\n  const bgColor = isDark ? '#1a1a2e' : '#ffffff';\n  const fgColor = isDark ? '#e5e7eb' : '#1f2937';\n\n  // Configure canvas\n  canvasEl.setWidth(width);\n  canvasEl.setHeight(height);\n  canvasEl.setBackgroundColor(bgColor);\n  canvasEl.setForegroundColor(fgColor);\n  canvasEl.setIsLoading(true);\n\n  // Set up callbacks\n  canvasEl.setConfig({\n    onNodeClick: (node: { id: string | number; data: Record<string, unknown> }, event: MouseEvent) => {\n      const originalNode = originalNodes.get(String(node.id));\n      if (originalNode) {\n        // Show tooltip with avatar\n        showNodeTooltipInternal(originalNode, event.clientX, event.clientY, avatarOverlay);\n        \n        if (props.onNodeClick) {\n          props.onNodeClick(originalNode);\n        }\n      }\n    },\n    onNodeHover: (node: { id: string | number; data: Record<string, unknown> } | null, event?: MouseEvent) => {\n      if (node && event?.clientX !== undefined && event?.clientY !== undefined) {\n        const originalNode = originalNodes.get(String(node.id));\n        if (originalNode) {\n          showNodeTooltipInternal(originalNode, event.clientX, event.clientY, avatarOverlay);\n        }\n      } else if (!node) {\n        hideNodeTooltipInternal(avatarOverlay);\n      }\n    },\n    onNodeRightClick: (node: { id: string | number; data: Record<string, unknown> }, event: MouseEvent) => {\n      event.preventDefault();\n      const originalNode = originalNodes.get(String(node.id));\n      if (originalNode && props.onNodeRightClick) {\n        props.onNodeRightClick(originalNode);\n      }\n    },\n    onLinkClick: (link: { id: string | number; data: Record<string, unknown> }) => {\n      const originalEdge = originalEdges.get(String(link.id));\n      if (originalEdge && props.onLinkClick) {\n        props.onLinkClick(originalEdge);\n      }\n    },\n    onEngineStop: () => {\n      // Layout simulation stopped (can fire multiple times during stabilization)\n    }\n  });\n\n  // Load data\n  try {\n    const data = await graphService.getVisualizationData({ limit: 500 });\n    \n    if (data.nodes.length === 0) {\n      loadingEl.innerHTML = `\n        <div style=\"text-align: center;\">\n          <p style=\"color: var(--text-muted);\">No graph data available</p>\n          <button class=\"btn btn-primary btn-sm\" id=\"gc-sync\">Sync Data</button>\n        </div>\n      `;\n      canvasEl.setIsLoading(false);\n      \n      const syncBtn = loadingEl.querySelector('#gc-sync');\n      if (syncBtn) {\n        on(syncBtn as HTMLElement, 'click', async () => {\n          toast.info('Syncing data...');\n          await fetch('/api/graph/sync', { method: 'POST' });\n          toast.success('Sync complete. Reloading...');\n          initCanvas(container, props);\n        });\n      }\n      return;\n    }\n\n    // Transform data to canvas format\n    const canvasData = transformData(data.nodes, data.edges);\n    \n    // Update legend\n    updateLegend(legendEl, data.nodes);\n    \n    // Set data\n    canvasEl.setData(canvasData);\n    canvasEl.setIsLoading(false);\n    loadingEl.style.display = 'none';\n    \n    // Render avatar overlays for Contact nodes\n    renderAvatarOverlays(avatarOverlay, data.nodes, canvasEl);\n    \n    // Fit to view after layout settles\n    setTimeout(() => canvasEl.zoomToFit(1.2), 1000);\n    \n    console.log(`[GraphCanvas] Loaded ${data.nodes.length} nodes and ${data.edges.length} edges`);\n    \n    // Notify parent of loaded data stats\n    props.onDataLoaded?.({ nodeCount: data.nodes.length, edgeCount: data.edges.length });\n    \n  } catch (error) {\n    console.error('[GraphCanvas] Error loading data:', error);\n    loadingEl.innerHTML = `<p style=\"color: var(--error);\">Failed to load graph data</p>`;\n    canvasEl.setIsLoading(false);\n  }\n\n  // Bind control buttons\n  const zoomInBtn = container.querySelector('#gc-zoom-in');\n  const zoomOutBtn = container.querySelector('#gc-zoom-out');\n  const fitBtn = container.querySelector('#gc-fit');\n  const refreshBtn = container.querySelector('#gc-refresh');\n\n  if (zoomInBtn) {\n    on(zoomInBtn as HTMLElement, 'click', () => {\n      const currentZoom = canvasEl.getZoom?.() || 1;\n      canvasEl.zoom?.(currentZoom * 1.2);\n    });\n  }\n\n  if (zoomOutBtn) {\n    on(zoomOutBtn as HTMLElement, 'click', () => {\n      const currentZoom = canvasEl.getZoom?.() || 1;\n      canvasEl.zoom?.(currentZoom / 1.2);\n    });\n  }\n\n  if (fitBtn) {\n    on(fitBtn as HTMLElement, 'click', () => {\n      canvasEl.zoomToFit?.(1.2);\n    });\n  }\n\n  if (refreshBtn) {\n    on(refreshBtn as HTMLElement, 'click', async () => {\n      toast.info('Refreshing graph...');\n      loadingEl.style.display = 'flex';\n      canvasEl.setIsLoading(true);\n      await initCanvas(container, props);\n      toast.success('Graph refreshed');\n    });\n  }\n}\n\n/**\n * Transform GodMode data to canvas format\n */\nfunction transformData(nodes: GraphNode[], edges: GraphEdge[]): CanvasData {\n  // Clear and rebuild maps\n  originalNodes.clear();\n  originalEdges.clear();\n\n  // Deduplicate nodes\n  const seenNodeIds = new Set<string>();\n  const uniqueNodes = nodes.filter(node => {\n    if (seenNodeIds.has(node.id)) return false;\n    seenNodeIds.add(node.id);\n    return true;\n  });\n\n  // Transform nodes\n  const canvasNodes: CanvasNode[] = uniqueNodes.map(node => {\n    originalNodes.set(node.id, node);\n    \n    const props = (node.properties || {}) as Record<string, unknown>;\n    const nodeName = node.name || props.name || props.title || \n      (props.content ? String(props.content).substring(0, 30) : null) || \n      node.label || node.id;\n    \n    // Build display name based on node type\n    let displayName = String(nodeName);\n    const nodeType = node.type || node.label || 'Unknown';\n    \n    // For Contacts, show name + role/organization\n    if (nodeType === 'Contact' || nodeType === 'Person') {\n      const role = props.role || node.role;\n      const org = props.organization || node.organization;\n      if (role) {\n        displayName = `${nodeName}\\n(${role})`;\n      } else if (org) {\n        displayName = `${nodeName}\\n(${org})`;\n      }\n    }\n    \n    // For Decisions/Risks, truncate long content\n    if ((nodeType === 'Decision' || nodeType === 'Risk') && displayName.length > 40) {\n      displayName = displayName.substring(0, 37) + '...';\n    }\n    \n    // For Facts, show truncated content\n    if (nodeType === 'Fact') {\n      const content = props.content || props.text;\n      if (content) {\n        displayName = String(content).substring(0, 35) + (String(content).length > 35 ? '...' : '');\n      }\n    }\n    \n    // Determine node size based on importance\n    let nodeSize = 6;\n    if (nodeType === 'Contact' || nodeType === 'Person') nodeSize = 10;\n    else if (nodeType === 'Team') nodeSize = 9;\n    else if (nodeType === 'Meeting') nodeSize = 8;\n    else if (nodeType === 'Decision') nodeSize = 7;\n    else if (nodeType === 'Risk') nodeSize = 7;\n    \n    return {\n      id: node.id,\n      labels: [nodeType],\n      color: TYPE_COLORS[nodeType] || '#6b7280',\n      visible: true,\n      size: nodeSize,\n      caption: 'name',\n      data: {\n        name: displayName,\n        type: nodeType,\n        originalName: String(nodeName),\n        role: props.role || node.role,\n        organization: props.organization || node.organization,\n        email: props.email || node.email,\n        avatarUrl: props.avatarUrl || props.avatar_url || node.avatarUrl,\n        ...props\n      }\n    };\n  });\n\n  // Deduplicate and transform edges\n  const seenEdgeIds = new Set<string>();\n  const canvasLinks: CanvasLink[] = [];\n  \n  for (const edge of edges) {\n    const edgeId = edge.id || `${edge.source}-${edge.target}-${edge.type}`;\n    if (seenEdgeIds.has(edgeId)) continue;\n    seenEdgeIds.add(edgeId);\n    \n    // Only include edges where both nodes exist\n    if (seenNodeIds.has(edge.source) && seenNodeIds.has(edge.target)) {\n      originalEdges.set(edgeId, edge);\n      \n      canvasLinks.push({\n        id: edgeId,\n        relationship: edge.type || edge.label || 'RELATED',\n        color: '#9ca3af',\n        source: edge.source,\n        target: edge.target,\n        visible: true,\n        data: {}\n      });\n    }\n  }\n\n  return { nodes: canvasNodes, links: canvasLinks };\n}\n\n/**\n * Update legend with node types\n */\nfunction updateLegend(legendEl: HTMLElement, nodes: GraphNode[]): void {\n  const types = new Set<string>();\n  nodes.forEach(node => types.add(node.type || 'Unknown'));\n  \n  legendEl.innerHTML = Array.from(types).sort().map(type => `\n    <span style=\"display: inline-flex; align-items: center; gap: 4px;\">\n      <span style=\"width: 12px; height: 12px; border-radius: 50%; background: ${TYPE_COLORS[type] || '#6b7280'}\"></span>\n      ${type}\n    </span>\n  `).join('');\n}\n\n/**\n * Render avatar overlays for Contact nodes\n * Since the canvas library doesn't support images natively, we overlay avatar images\n */\nfunction renderAvatarOverlays(overlayEl: HTMLElement, nodes: GraphNode[], _canvasEl: CanvasElement): void {\n  if (!overlayEl) return;\n  \n  // Clear existing overlays\n  overlayEl.innerHTML = '';\n  \n  // Add CSS for avatar overlay\n  overlayEl.style.cssText = `\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    overflow: visible;\n  `;\n  \n  // Add a style for the tooltip that shows avatars\n  const style = document.createElement('style');\n  style.textContent = `\n    .graph-node-tooltip {\n      position: fixed;\n      background: var(--bg-primary, #ffffff);\n      border: 1px solid var(--border-color, #e5e7eb);\n      border-radius: 12px;\n      padding: 12px;\n      box-shadow: 0 4px 20px rgba(0,0,0,0.2);\n      z-index: 10000;\n      pointer-events: none;\n      min-width: 220px;\n      max-width: 300px;\n      opacity: 0;\n      transform: translateY(5px);\n      transition: opacity 0.15s ease, transform 0.15s ease;\n    }\n    .graph-node-tooltip.visible {\n      opacity: 1;\n      transform: translateY(0);\n    }\n    .graph-node-tooltip .tooltip-content {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n    }\n    .graph-node-tooltip .avatar {\n      width: 56px;\n      height: 56px;\n      border-radius: 50%;\n      object-fit: cover;\n      border: 2px solid var(--border-color, #e5e7eb);\n      flex-shrink: 0;\n    }\n    .graph-node-tooltip .avatar-placeholder {\n      width: 56px;\n      height: 56px;\n      border-radius: 50%;\n      background: var(--primary, #6366f1);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      font-weight: 600;\n      font-size: 18px;\n      flex-shrink: 0;\n    }\n    .graph-node-tooltip .info {\n      display: flex;\n      flex-direction: column;\n      gap: 2px;\n      min-width: 0;\n    }\n    .graph-node-tooltip .name {\n      font-weight: 600;\n      font-size: 14px;\n      color: var(--text-primary, #1f2937);\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    .graph-node-tooltip .role {\n      font-size: 12px;\n      color: var(--text-muted, #6b7280);\n    }\n    .graph-node-tooltip .org {\n      font-size: 11px;\n      color: var(--text-tertiary, #9ca3af);\n    }\n    .graph-node-tooltip .email {\n      font-size: 11px;\n      color: var(--primary, #6366f1);\n      margin-top: 4px;\n    }\n    .graph-node-tooltip .node-type {\n      position: absolute;\n      top: 8px;\n      right: 8px;\n      font-size: 10px;\n      padding: 2px 6px;\n      border-radius: 4px;\n      background: var(--bg-secondary, #f3f4f6);\n      color: var(--text-muted, #6b7280);\n      text-transform: uppercase;\n    }\n  `;\n  overlayEl.appendChild(style);\n  \n  // Create tooltip element\n  const tooltip = document.createElement('div');\n  tooltip.className = 'graph-node-tooltip';\n  tooltip.id = 'graph-tooltip';\n  overlayEl.appendChild(tooltip);\n  \n  // Store all node data for tooltip display\n  (window as unknown as Record<string, unknown>).__graphNodeData = nodes.reduce((acc, node) => {\n    acc[node.id] = {\n      id: node.id,\n      name: node.name || node.properties?.name || node.properties?.title || node.properties?.content?.substring(0, 50),\n      type: node.type || node.label,\n      avatarUrl: node.avatarUrl || node.properties?.avatar_url || node.properties?.avatarUrl,\n      role: node.role || node.properties?.role,\n      organization: node.organization || node.properties?.organization,\n      email: node.email || node.properties?.email,\n      content: node.properties?.content,\n      status: node.properties?.status,\n      severity: node.properties?.severity\n    };\n    return acc;\n  }, {} as Record<string, unknown>);\n}\n\n/**\n * Show tooltip for a node (internal function)\n */\nfunction showNodeTooltipInternal(node: GraphNode, x: number, y: number, overlayEl: HTMLElement): void {\n  const tooltip = overlayEl?.querySelector('#graph-tooltip') as HTMLElement;\n  if (!tooltip) return;\n  \n  const nodeData = (window as unknown as Record<string, Record<string, Record<string, string>>>).__graphNodeData;\n  const data = nodeData?.[node.id] || {\n    name: node.name || node.properties?.name,\n    type: node.type || node.label,\n    avatarUrl: node.avatarUrl || node.properties?.avatar_url,\n    role: node.role || node.properties?.role,\n    organization: node.organization || node.properties?.organization,\n    email: node.email || node.properties?.email\n  };\n  \n  const nodeType = data.type || 'Unknown';\n  const isContact = nodeType === 'Contact' || nodeType === 'Person';\n  const initials = (data.name || '?').split(' ').map((n: string) => n[0]).join('').substring(0, 2).toUpperCase();\n  \n  let avatarHtml = '';\n  if (isContact) {\n    if (data.avatarUrl) {\n      avatarHtml = `<img class=\"avatar\" src=\"${data.avatarUrl}\" alt=\"${data.name}\" onerror=\"this.outerHTML='<div class=\\\\'avatar-placeholder\\\\'>${initials}</div>'\"/>`;\n    } else {\n      avatarHtml = `<div class=\"avatar-placeholder\">${initials}</div>`;\n    }\n  }\n  \n  let contentHtml = '';\n  if (isContact) {\n    contentHtml = `\n      ${avatarHtml}\n      <div class=\"info\">\n        <span class=\"name\">${data.name || 'Unknown'}</span>\n        ${data.role ? `<span class=\"role\">${data.role}</span>` : ''}\n        ${data.organization ? `<span class=\"org\">${data.organization}</span>` : ''}\n        ${data.email ? `<span class=\"email\">${data.email}</span>` : ''}\n      </div>\n    `;\n  } else {\n    // For non-contact nodes, show relevant info\n    const displayName = data.name || data.content?.substring(0, 100) || data.id;\n    contentHtml = `\n      <div class=\"info\" style=\"width: 100%;\">\n        <span class=\"name\">${displayName}</span>\n        ${data.status ? `<span class=\"role\">Status: ${data.status}</span>` : ''}\n        ${data.severity ? `<span class=\"role\">Severity: ${data.severity}</span>` : ''}\n      </div>\n    `;\n  }\n  \n  tooltip.innerHTML = `\n    <span class=\"node-type\">${nodeType}</span>\n    <div class=\"tooltip-content\">\n      ${contentHtml}\n    </div>\n  `;\n  \n  // Position tooltip\n  const padding = 15;\n  const viewportWidth = window.innerWidth;\n  const viewportHeight = window.innerHeight;\n  \n  // Show tooltip first to get dimensions\n  tooltip.style.left = '-9999px';\n  tooltip.classList.add('visible');\n  const tooltipRect = tooltip.getBoundingClientRect();\n  \n  // Calculate position\n  let left = x + padding;\n  let top = y - tooltipRect.height / 2;\n  \n  // Adjust if going off-screen\n  if (left + tooltipRect.width > viewportWidth - padding) {\n    left = x - tooltipRect.width - padding;\n  }\n  if (top < padding) {\n    top = padding;\n  }\n  if (top + tooltipRect.height > viewportHeight - padding) {\n    top = viewportHeight - tooltipRect.height - padding;\n  }\n  \n  tooltip.style.left = `${left}px`;\n  tooltip.style.top = `${top}px`;\n}\n\n/**\n * Hide node tooltip (internal function)\n */\nfunction hideNodeTooltipInternal(overlayEl: HTMLElement): void {\n  const tooltip = overlayEl?.querySelector('#graph-tooltip') as HTMLElement;\n  if (tooltip) {\n    tooltip.classList.remove('visible');\n  }\n}\n\n/**\n * Show tooltip for a node (public API)\n */\nexport function showNodeTooltip(nodeId: string, x: number, y: number): void {\n  const overlay = document.getElementById('avatar-overlay');\n  const nodeData = (window as unknown as Record<string, Record<string, Record<string, string>>>).__graphNodeData;\n  \n  if (!overlay || !nodeData || !nodeData[nodeId]) return;\n  \n  const fakeNode = { id: nodeId, ...nodeData[nodeId] } as unknown as GraphNode;\n  showNodeTooltipInternal(fakeNode, x, y, overlay);\n}\n\n/**\n * Hide node tooltip (public API)\n */\nexport function hideNodeTooltip(): void {\n  const overlay = document.getElementById('avatar-overlay');\n  if (overlay) {\n    hideNodeTooltipInternal(overlay);\n  }\n}\n\n// Backward compatibility alias\nexport const createFalkorDBCanvas = createGraphCanvas;\n\nexport default { createGraphCanvas, createFalkorDBCanvas, showNodeTooltip, hideNodeTooltip };\n"],"file":"GraphCanvas-Dcmobt8x.js"}