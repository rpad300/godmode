import{r as h,f1 as w,f2 as k,j as e,ac as p,an as R,N as c,J as C,b2 as S,ai as O,T as E,O as m}from"./main-DPJZnN-g.js";import{E as L}from"./ErrorState-CGhToI5I.js";import{s as P}from"./sanitize-Ba_a80Lt.js";import{S as g}from"./sparkles-B7v1H-ZZ.js";import{T as u}from"./trending-up-BdSFupFA.js";import{C as U}from"./chevron-up-CuIutfHG.js";import{C as _}from"./chevron-down-DvtyaUz8.js";function F({label:n,value:d,icon:o}){return e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(o,{className:"w-4 h-4 text-[hsl(var(--primary))]"}),e.jsx("span",{className:"text-xs text-[hsl(var(--muted-foreground))]",children:n})]}),e.jsx("p",{className:"text-lg font-bold text-[hsl(var(--foreground))]",children:d})]})}const J=()=>{const[n,d]=h.useState(""),o=w(n||void 0),{data:v,isLoading:b,refetch:x}=o,t=k(),[f,j]=h.useState({}),s=v?.report,i=async(r=!1)=>{try{await t.mutateAsync({week:n||void 0,regenerate:r}),m.success(r?"Report regenerated":"Report generated"),x()}catch{m.error("Failed to generate report")}},N=r=>{j(a=>({...a,[r]:!a[r]}))},y=()=>{if(!s)return;const r=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(r),l=document.createElement("a");l.href=a,l.download=`weekly-report-${s.period||"current"}.json`,l.click(),URL.revokeObjectURL(a),m.success("Report exported")};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-[hsl(var(--foreground))] flex items-center gap-2",children:[e.jsx(p,{className:"w-6 h-6 text-[hsl(var(--primary))]"})," Weekly Reports"]}),e.jsx("p",{className:"text-sm text-[hsl(var(--muted-foreground))]",children:"AI-generated weekly status reports with highlights, risks, and KPIs"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-[hsl(var(--muted-foreground))]"}),e.jsx("input",{type:"week",value:n,onChange:r=>d(r.target.value),className:"bg-[hsl(var(--background))] border border-[hsl(var(--border))] rounded-lg px-3 py-1.5 text-sm text-[hsl(var(--foreground))]"})]}),e.jsxs("button",{onClick:()=>i(!1),disabled:t.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-[hsl(var(--primary))] text-[hsl(var(--primary-foreground))] text-sm font-medium hover:opacity-90 transition-opacity disabled:opacity-50",children:[t.isPending?e.jsx(c,{className:"w-4 h-4 animate-spin"}):e.jsx(g,{className:"w-4 h-4"}),"Generate"]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>i(!0),disabled:t.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-[hsl(var(--border))] text-sm text-[hsl(var(--muted-foreground))] hover:bg-[hsl(var(--secondary))] transition-colors disabled:opacity-50",children:[e.jsx(C,{className:"w-4 h-4"})," Regenerate"]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-[hsl(var(--border))] text-sm text-[hsl(var(--muted-foreground))] hover:bg-[hsl(var(--secondary))] transition-colors",children:[e.jsx(S,{className:"w-4 h-4"})," Export"]})]})]})]}),o.error?e.jsx(L,{message:"Failed to load report.",onRetry:()=>x()}):b?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(c,{className:"w-8 h-8 animate-spin text-[hsl(var(--primary))]"})}):s?e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-[hsl(var(--muted-foreground))]",children:[e.jsxs("span",{children:["Period: ",e.jsx("strong",{className:"text-[hsl(var(--foreground))]",children:s.period})]}),s.generated_at&&e.jsxs("span",{children:["Generated: ",new Date(s.generated_at).toLocaleString()]})]}),e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-[hsl(var(--foreground))] mb-3",children:"Summary"}),e.jsx("p",{className:"text-sm text-[hsl(var(--muted-foreground))] whitespace-pre-line leading-relaxed",children:s.summary||"No summary available."})]}),s.kpis&&Object.keys(s.kpis).length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-semibold text-[hsl(var(--foreground))] mb-3 uppercase tracking-wider",children:"Key Metrics"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(s.kpis).map(([r,a])=>e.jsx(F,{label:r.replace(/_/g," "),value:String(a),icon:u},r))})]}),s.highlights&&s.highlights.length>0&&e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-[hsl(var(--foreground))] mb-3 flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-green-500"})," Highlights"]}),e.jsx("ul",{className:"space-y-2",children:s.highlights.map((r,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-[hsl(var(--muted-foreground))]",children:[e.jsx("span",{className:"text-green-500 mt-0.5",children:"•"})," ",r]},a))})]}),s.risks&&s.risks.length>0&&e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-5",children:[e.jsxs("h2",{className:"text-lg font-semibold text-[hsl(var(--foreground))] mb-3 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-amber-500"})," Risks & Concerns"]}),e.jsx("ul",{className:"space-y-2",children:s.risks.map((r,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-[hsl(var(--muted-foreground))]",children:[e.jsx("span",{className:"text-amber-500 mt-0.5",children:"•"})," ",r]},a))})]}),s.sections&&Object.keys(s.sections).length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h2",{className:"text-sm font-semibold text-[hsl(var(--foreground))] uppercase tracking-wider",children:"Detailed Sections"}),Object.entries(s.sections).map(([r,a])=>{const l=f[r]??!1;return e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>N(r),className:"w-full flex items-center justify-between px-5 py-3 hover:bg-[hsl(var(--secondary))] transition-colors",children:[e.jsx("span",{className:"text-sm font-medium text-[hsl(var(--foreground))]",children:r.replace(/_/g," ")}),l?e.jsx(U,{className:"w-4 h-4 text-[hsl(var(--muted-foreground))]"}):e.jsx(_,{className:"w-4 h-4 text-[hsl(var(--muted-foreground))]"})]}),l&&e.jsx("div",{className:"px-5 pb-4 text-sm text-[hsl(var(--muted-foreground))] whitespace-pre-line leading-relaxed border-t border-[hsl(var(--border))]",children:typeof a=="string"?a:JSON.stringify(a,null,2)})]},r)})]}),s.html&&e.jsxs("div",{className:"bg-[hsl(var(--card))] border border-[hsl(var(--border))] rounded-xl p-5",children:[e.jsx("h2",{className:"text-lg font-semibold text-[hsl(var(--foreground))] mb-3",children:"Formatted Report"}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:P(s.html)}})]})]}):e.jsxs("div",{className:"text-center py-20 space-y-4",children:[e.jsx(p,{className:"w-12 h-12 mx-auto text-[hsl(var(--muted-foreground))] opacity-40"}),e.jsx("p",{className:"text-[hsl(var(--muted-foreground))]",children:"No report for this period yet."}),e.jsxs("button",{onClick:()=>i(!1),disabled:t.isPending,className:"inline-flex items-center gap-2 px-5 py-2.5 rounded-lg bg-[hsl(var(--primary))] text-[hsl(var(--primary-foreground))] text-sm font-medium hover:opacity-90 disabled:opacity-50",children:[t.isPending?e.jsx(c,{className:"w-4 h-4 animate-spin"}):e.jsx(g,{className:"w-4 h-4"}),"Generate Weekly Report"]})]})]})};export{J as default};
//# sourceMappingURL=ReportsPage-6w8Z2vP9.js.map
