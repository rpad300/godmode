import{c as re,j as e,N as $,T as se,a as s,r as A,ai as De,U as be,P as ke,bL as Pe,c_ as Ie,K as ge,am as Oe,du as Ae,dv as $e,dw as Fe,dx as Ue,dy as ze,O as c,a5 as ve,ak as he,da as Ge,dz as Be,dA as Ke,dB as Ve,db as He,dC as Qe,dD as Je,dE as Ye,J as ne,dF as We,dG as Ze,dH as Xe,dI as qe,dJ as es,cM as ss,cN as ts,cH as as,cP as rs,cQ as ns,cO as ls,cS as is,dK as cs,cU as os,cW as ds,cX as xs,cY as ms,cV as ps,cZ as hs,cF as us,dL as gs,Z as ie,dM as vs,dN as js,dO as ys,dP as bs,dQ as Ns,bY as fs,bX as ws,b_ as Ss,dR as Cs,dS as ks,dT as Ps,bF as As,bG as Ls,bH as Ms,dU as _s,bJ as Es,bE as Rs,bK as Ts,dV as Ds,dW as Is,dX as Os,dY as $s,dZ as Fs,d_ as Us,d$ as zs,e0 as Gs,e1 as Bs,e2 as Ks,e3 as Vs,e4 as Hs,e5 as Qs,e6 as Js,dt as Ys,a4 as ue,e7 as Ws,e8 as Zs,e9 as Xs,br as qs,bs as et,ea as st,eb as tt,ec as at,ed as rt,ee as nt}from"./main-BKbBKYvC.js";import{a as lt}from"./GraphOntology-C2zQ-xzI.js";import{K as it}from"./key-Cfbr9NfN.js";import{C as ct}from"./cpu-Cc2IQ2ui.js";import{L as ot}from"./list-DtABesIA.js";import{L as Le}from"./layers-B7MeRGrx.js";import{P as Ne}from"./plus-BG5YpVIb.js";import{E as Me}from"./eye-DDSd_vfm.js";import{R as ce}from"./rotate-cw-DMgodGxB.js";import{C as oe}from"./circle-check-big-BfAZDzfZ.js";import{S as q}from"./save-CuHcaXm4.js";import{P as dt}from"./play-BOQB2G_-.js";import{H as xt}from"./history-fSYOK_lq.js";import{P as mt}from"./pen-line-jZzzWq6p.js";import{L as pt}from"./link-2-CWyrMbe7.js";import{F as ht}from"./file-braces-BJW8PMcW.js";import{U as ut}from"./upload-BtADKM1s.js";import{E as gt}from"./eye-off-D520ZGvK.js";import{D as vt}from"./database-DxvMfDyL.js";import"./sparkles-BJxATUBg.js";import"./chart-column-WCU8uNwR.js";import"./brain-t58eVqGu.js";import"./wand-sparkles-BjYP3KTS.js";import"./circle-x-DCC498lp.js";import"./merge-CIQSa7s7.js";const jt=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],je=re("ban",jt);const yt=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],bt=re("credit-card",yt);const Nt=[["path",{d:"M9 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v.5",key:"1dkoa9"}],["path",{d:"M12 10v4h4",key:"1czhmt"}],["path",{d:"m12 14 1.535-1.605a5 5 0 0 1 8 1.5",key:"lvuxfi"}],["path",{d:"M22 22v-4h-4",key:"1ewp4q"}],["path",{d:"m22 18-1.535 1.605a5 5 0 0 1-8-1.5",key:"14ync0"}]],_e=re("folder-sync",Nt);const ft=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],fe=re("folder-tree",ft);const wt=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],St=re("gauge",wt);const Ct=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],kt=re("pause",Ct);const Pt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Ee=re("terminal",Pt),X=t=>({width:t,height:t,viewBox:"0 0 24 24"});function At({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"none",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M22.28 9.37a5.93 5.93 0 0 0-.51-4.89A6.01 6.01 0 0 0 15.3 1.5a5.97 5.97 0 0 0-4.52 2.07A5.93 5.93 0 0 0 6.82 2.2a6.01 6.01 0 0 0-4.01 2.92 5.97 5.97 0 0 0 .74 7.01 5.93 5.93 0 0 0 .51 4.89A6.01 6.01 0 0 0 10.53 20a5.98 5.98 0 0 0 .69 2.5 6.01 6.01 0 0 0 6.47 2.98 5.97 5.97 0 0 0 4.52-2.07 5.93 5.93 0 0 0 3.96 1.37 6.01 6.01 0 0 0 4.01-2.92 5.97 5.97 0 0 0-.74-7.01",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",transform:"scale(0.75) translate(4, 4)"})})}function we({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M13.83 3h-3.16L5 21h3.16l1.41-4.51h5.36L16.34 21h3.16L13.83 3Zm-3.16 10.96L12.25 8.6l1.58 5.36h-3.16Z"})})}function pe({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"none",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M21.81 10.26H12.18v3.72h5.51a4.77 4.77 0 0 1-2.05 3.08 6.14 6.14 0 0 1-3.46.96 6.36 6.36 0 0 1-6-4.14 6.29 6.29 0 0 1 0-3.76 6.36 6.36 0 0 1 6-4.14c1.56 0 2.97.56 4.08 1.49l2.79-2.79A10.53 10.53 0 0 0 12.18 2a10.26 10.26 0 0 0-9.19 5.66 10.06 10.06 0 0 0 0 8.68A10.26 10.26 0 0 0 12.18 22c5.2 0 9.87-3.46 9.87-10.26 0-.65-.08-1.31-.24-1.48Z",fill:"currentColor"})})}function Lt({size:t=20,...d}){return e.jsxs("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:[e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),e.jsx("text",{x:"12",y:"16",textAnchor:"middle",fontSize:"10",fontWeight:"bold",fill:"currentColor",children:"G"})]})}function Mt({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 2c1.85 0 3.55.63 4.9 1.69L7.69 16.9A7.96 7.96 0 0 1 4 12c0-4.42 3.58-8 8-8zm0 16c-1.85 0-3.55-.63-4.9-1.69L16.31 7.1A7.96 7.96 0 0 1 20 12c0 4.42-3.58 8-8 8z"})})}function _t({size:t=20,...d}){return e.jsxs("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:[e.jsx("path",{d:"M12 3a7 7 0 0 0-7 7v3.5c0 1.93 1.57 3.5 3.5 3.5h1a1.5 1.5 0 0 0 0-3H8.5a.5.5 0 0 1-.5-.5V10a4 4 0 0 1 8 0v3.5a.5.5 0 0 1-.5.5H14.5a1.5 1.5 0 0 0 0 3h1c1.93 0 3.5-1.57 3.5-3.5V10a7 7 0 0 0-7-7z"}),e.jsx("circle",{cx:"9.5",cy:"10.5",r:"1"}),e.jsx("circle",{cx:"14.5",cy:"10.5",r:"1"})]})}function Se({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M3 3l7.07 10.61L3 21h1.59l6.19-6.47L15.61 21H21l-7.46-11.18L20.1 3h-1.59l-5.76 6.02L8.39 3H3zm2.29 1.25h2.54l10.88 15.5h-2.54L5.29 4.25z"})})}function Et({size:t=20,...d}){return e.jsxs("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:[e.jsx("rect",{x:"3",y:"8",width:"4",height:"8",rx:"1"}),e.jsx("rect",{x:"10",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"17",y:"8",width:"4",height:"8",rx:"1"})]})}function Rt({size:t=20,...d}){return e.jsx("svg",{...X(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...d,children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14.5v-9l7 4.5-7 4.5z"})})}function Tt({size:t=20,...d}){return e.jsxs("svg",{...X(t),fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",xmlns:"http://www.w3.org/2000/svg",...d,children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"3"}),e.jsx("path",{d:"M9 9h6M9 12h6M9 15h4"})]})}const Re={openai:"#10a37f",anthropic:"#d97757",claude:"#d97757",google:"#4285f4",gemini:"#4285f4",google_gemini:"#4285f4",groq:"#f55036",deepseek:"#4d6bfe",ollama:"#ffffff",grok:"#1d9bf0",xai:"#1d9bf0",minimax:"#6c5ce7",kimi:"#615eff"},Dt={openai:At,anthropic:we,claude:we,google:pe,gemini:pe,google_gemini:pe,groq:Lt,deepseek:Mt,ollama:_t,grok:Se,xai:Se,minimax:Et,kimi:Rt};function de({provider:t,size:d=20,className:m}){const M=(t||"").toLowerCase().replace(/[\s-]/g,"_"),u=Dt[M]||Tt,f=Re[M]||"currentColor";return e.jsx(u,{size:d,className:m,style:{color:f}})}function It(t){const d=(t||"").toLowerCase().replace(/[\s-]/g,"_");return Re[d]||"var(--gm-accent-primary)"}const k="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",F="bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] transition-all duration-150",K="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",z="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",Ce="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50",_="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",O="text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider";function Z(){return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx($,{className:"h-6 w-6 animate-spin text-[var(--gm-accent-primary)]"})})}function ye({msg:t}){return e.jsxs("div",{className:s(k,"p-10 text-center flex flex-col items-center gap-3"),children:[e.jsx(se,{className:"w-5 h-5 text-[var(--color-warning-500)]"}),e.jsx("span",{className:"text-sm text-[var(--gm-text-secondary)]",children:t})]})}function le({msg:t}){return e.jsx("div",{className:s(k,"p-10 text-center text-[var(--gm-text-tertiary)] text-sm"),children:t})}function W({title:t,subtitle:d}){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:t}),d&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5",children:d})]})}function V({label:t,value:d,color:m}){return e.jsxs("div",{className:s(k,"p-4 text-center"),children:[e.jsx("div",{className:"text-2xl font-bold tabular-nums",style:m?{color:m}:void 0,children:d}),e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mt-1",children:t})]})}function xe({checked:t,onChange:d,disabled:m}){return e.jsx("button",{onClick:()=>!m&&d(!t),disabled:m,className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer rounded-full border border-[var(--gm-border-primary)] transition-colors duration-200 disabled:opacity-50",style:{backgroundColor:t?"var(--color-brand-500)":"var(--gm-bg-tertiary)"},children:e.jsx("span",{className:s("pointer-events-none inline-block h-4 w-4 rounded-full bg-white shadow-sm transition-transform duration-200",t?"translate-x-4":"translate-x-0")})})}const T=t=>t??{},Ot=[{key:"users",label:"Users",icon:be},{key:"system",label:"System",icon:ke},{key:"llm-providers",label:"LLM Providers",icon:it},{key:"model-metadata",label:"Model Metadata",icon:ct},{key:"llm-queue",label:"LLM Queue",icon:ot},{key:"graph",label:"Graph",icon:Pe},{key:"ontology",label:"Ontology",icon:Le},{key:"prompts",label:"Prompts",icon:Ee},{key:"processing",label:"Processing",icon:Ie},{key:"team-analysis",label:"Team Analysis",icon:be},{key:"google-drive",label:"Google Drive",icon:_e},{key:"billing",label:"Billing",icon:bt},{key:"audit-log",label:"Audit Log",icon:ge}];function $t(){const{data:t}=Ae(),d=t,m=[];return d&&(typeof d.disk=="number"&&d.disk>75&&m.push({msg:`Disk usage at ${d.disk.toFixed(1)}% — consider cleanup of old embeddings`,severity:"warning"}),typeof d.cpu=="number"&&d.cpu>90&&m.push({msg:`CPU usage critical at ${d.cpu.toFixed(1)}%`,severity:"danger"}),typeof d.ram=="number"&&d.ram>85&&m.push({msg:`RAM usage high at ${d.ram.toFixed(1)}%`,severity:"warning"}),typeof d.latency=="number"&&d.latency>200&&m.push({msg:`High latency: ${d.latency.toFixed(0)}ms`,severity:"warning"})),m.length===0?null:e.jsx("div",{className:"space-y-1.5 mb-4",children:m.map((M,u)=>e.jsxs("div",{className:s("flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-medium",M.severity==="danger"?"bg-red-500/10 text-red-400":M.severity==="warning"?"bg-amber-500/10 text-amber-400":"bg-blue-500/10 text-blue-400"),children:[e.jsx(se,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"flex-1",children:M.msg})]},u))})}function Ft(){const{data:t,isLoading:d,error:m}=$e(),M=Fe(),u=Ue(),f=ze(),[g,S]=A.useState(!1),[R,v]=A.useState(""),[w,j]=A.useState("all"),[N,x]=A.useState({email:"",name:"",password:"",role:"user"}),[h,i]=A.useState(null),E=T(t),r=E.users??[],l=T(E.stats),p=A.useMemo(()=>r.filter(o=>{if(w!=="all"&&o.role!==w)return!1;if(R){const I=R.toLowerCase();if(!o.name?.toLowerCase().includes(I)&&!o.email?.toLowerCase().includes(I))return!1}return!0}),[r,w,R]),C=A.useCallback(()=>{if(!N.email){c.error("Email is required");return}M.mutate(N,{onSuccess:()=>{c.success("User created"),S(!1),x({email:"",name:"",password:"",role:"user"})},onError:o=>c.error(o.message)})},[N,M]);return d?e.jsx(Z,{}):m?e.jsx(ye,{msg:"Unable to load users."}):e.jsxs("div",{className:"space-y-5",children:[e.jsx(W,{title:"User Management"}),l.totalUsers!=null&&e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsx(V,{label:"Total Users",value:l.totalUsers}),e.jsx(V,{label:"Active",value:l.activeUsers,color:"var(--color-success-500)"}),e.jsx(V,{label:"Pending",value:l.pendingInvitations,color:"var(--color-warning-500)"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[e.jsx(ve,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{placeholder:"Search users...",value:R,onChange:o=>v(o.target.value),className:s(F,"flex-1")})]}),e.jsxs("select",{value:w,onChange:o=>j(o.target.value),className:s(F,"w-32"),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"Superadmin"})]}),e.jsxs("button",{onClick:()=>S(!g),className:K,children:[e.jsx(Ne,{className:"w-3 h-3"})," Add User"]})]}),g&&e.jsxs("div",{className:s(k,"p-4 space-y-3"),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{placeholder:"Email",value:N.email,onChange:o=>x(I=>({...I,email:o.target.value})),className:F}),e.jsx("input",{placeholder:"Display Name",value:N.name,onChange:o=>x(I=>({...I,name:o.target.value})),className:F}),e.jsx("input",{placeholder:"Password",type:"password",value:N.password,onChange:o=>x(I=>({...I,password:o.target.value})),className:F}),e.jsxs("select",{value:N.role,onChange:o=>x(I=>({...I,role:o.target.value})),className:F,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"Superadmin"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:C,disabled:M.isPending,className:K,children:[M.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(Ne,{className:"w-3 h-3"})," Create"]}),e.jsx("button",{onClick:()=>S(!1),className:z,children:"Cancel"})]})]}),e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["USER","EMAIL","ROLE","STATUS","LAST LOGIN","ACTIONS"].map(o=>e.jsx("th",{className:s(O,"px-4 py-3 text-left"),children:o},o))})}),e.jsx("tbody",{children:p.map(o=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[var(--gm-interactive-primary)]/15 text-[var(--gm-accent-primary)] font-bold flex items-center justify-center shrink-0 text-xs",children:(o.name||o.email||"?").substring(0,2).toUpperCase()}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:o.name||"—"})]})}),e.jsx("td",{className:"px-4 py-3 text-xs text-[var(--gm-text-tertiary)]",children:o.email}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:o.role,onChange:I=>u.mutate({id:o.id,role:I.target.value},{onSuccess:()=>c.success("Role updated"),onError:Q=>c.error(Q.message)}),className:s("text-[10px] px-2 py-0.5 rounded-full font-medium border-0",o.role==="superadmin"?"bg-red-500/20 text-red-400":o.role==="admin"?"bg-blue-500/20 text-blue-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]"),children:[e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"superadmin",children:"superadmin"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",o.status==="active"?"bg-green-500/15 text-green-400":o.status==="banned"?"bg-red-500/15 text-red-400":"bg-amber-500/15 text-amber-400"),children:o.status})}),e.jsx("td",{className:"px-4 py-3 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o.lastActive?new Date(o.lastActive).toLocaleString():"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>u.mutate({id:o.id,status:o.status==="banned"?"active":"banned"},{onSuccess:()=>c.success(o.status==="banned"?"User unbanned":"User banned"),onError:I=>c.error(I.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:o.status==="banned"?"Unban":"Ban",children:o.status==="banned"?e.jsx(Me,{className:"w-3.5 h-3.5 text-green-400"}):e.jsx(je,{className:"w-3.5 h-3.5 text-amber-400"})}),h===o.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>f.mutate(o.id,{onSuccess:()=>{c.success("User deleted"),i(null)},onError:I=>c.error(I.message)}),className:"px-2 py-0.5 rounded bg-red-500 text-white text-[10px]",children:"Confirm"}),e.jsx("button",{onClick:()=>i(null),className:"px-2 py-0.5 rounded text-[10px] text-[var(--gm-text-tertiary)]",children:"Cancel"})]}):e.jsx("button",{onClick:()=>i(o.id),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",children:e.jsx(he,{className:"w-3.5 h-3.5 text-red-400"})})]})})]},o.id))})]}),p.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No users found."})]}),e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] text-center",children:["Showing ",p.length," of ",r.length," users"]})]})}function Ut(){const{data:t,isLoading:d,error:m,refetch:M}=Ae(),u=t;if(d)return e.jsx(Z,{});if(m||!u)return e.jsx(ye,{msg:"Unable to load system stats."});const f=u.server||{},g=u.memory||{},S=u.process||{},R=u.database||"unknown",v=x=>{const h=Math.floor(x/86400),i=Math.floor(x%86400/3600),E=Math.floor(x%3600/60);return[h&&`${h}d`,i&&`${i}h`,`${E}m`].filter(Boolean).join(" ")},w=x=>x>=1024?`${(x/1024).toFixed(1)} GB`:`${x} MB`,j=(x,h,i)=>x>i?"#ef4444":x>h?"#f59e0b":"#22c55e",N=[{label:"CPU",val:u.cpu,unit:"%",color:j(u.cpu,60,80)},{label:"RAM",val:u.ram,unit:"%",color:j(u.ram,60,80)},{label:"Disk",val:u.disk,unit:"%",color:j(u.disk,70,90)},{label:"Event Loop",val:u.latency,unit:"ms",color:j(u.latency,50,200)}];return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{title:"System Health",subtitle:u.timestamp?`Last updated: ${new Date(u.timestamp).toLocaleString()}`:"Real-time system monitoring"}),e.jsxs("button",{onClick:()=>M(),className:z,children:[e.jsx(ce,{className:"w-3 h-3"})," Refresh"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:N.map(x=>e.jsxs("div",{className:s(k,"p-4 text-center"),children:[e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:x.label}),e.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-2",children:[e.jsxs("svg",{viewBox:"0 0 36 36",className:"w-full h-full -rotate-90",children:[e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:"var(--gm-bg-tertiary)",strokeWidth:"3"}),e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:x.color,strokeWidth:"3",strokeDasharray:`${Math.min((typeof x.val=="number"?x.val:0)/(x.unit==="ms"?500:100)*97.4,97.4)} 97.4`,strokeLinecap:"round",className:"transition-all duration-700"})]}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:typeof x.val=="number"?x.unit==="ms"?x.val:x.val.toFixed(0):x.val})]}),e.jsx("div",{className:"text-[9px] font-medium tabular-nums",style:{color:x.color},children:x.unit})]},x.label))}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(k,"p-4 space-y-2.5"),children:[e.jsx("h3",{className:_,children:"Server"}),[["Node",String(f.nodeVersion||"—")],["Platform",`${f.platform||"—"} / ${f.arch||"—"}`],["Hostname",String(u.hostname||"—")],["PID",String(f.pid||"—")],["Uptime",typeof f.uptime=="number"?v(f.uptime):"—"],["CPU Cores",String(u.cpuCores||"—")]].map(([x,h])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:x}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono tabular-nums",children:h})]},x))]}),e.jsxs("div",{className:s(k,"p-4 space-y-2.5"),children:[e.jsx("h3",{className:_,children:"Runtime"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Database"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",R==="connected"?"bg-green-500/10 text-green-400":R==="error"?"bg-red-500/10 text-red-400":"bg-amber-500/10 text-amber-400"),children:R})]}),[["Heap Used",`${S.heapUsedMB||0} MB`],["Heap Total",`${S.heapTotalMB||0} MB`],["Heap %",`${S.heapPercent||0}%`],["RSS",`${S.rssMB||0} MB`],["System RAM",g.totalMB?`${w(g.usedMB||0)} / ${w(g.totalMB)}`:"—"]].map(([x,h])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:x}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono tabular-nums",children:h})]},x)),S.heapPercent>0&&e.jsx("div",{className:"h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${S.heapPercent}%`,backgroundColor:j(S.heapPercent,60,85)}})})]})]}),u.storageBreakdown&&u.storageBreakdown.length>0&&e.jsxs("div",{className:s(k,"p-5"),children:[e.jsx("h3",{className:s(_,"mb-4"),children:"Storage"}),e.jsx("div",{className:"space-y-4",children:u.storageBreakdown.map((x,h)=>{const i=Number(x.size||0),E=Number(x.free||0),r=i-E,l=i>0?Math.round(r/i*100):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:String(x.category)}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums font-mono",children:[w(r)," / ",w(i)," (",l,"%)"]})]}),e.jsx("div",{className:"h-2.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${l}%`,backgroundColor:j(l,70,90)}})}),e.jsx("div",{className:"flex justify-between mt-1",children:e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:[w(E)," free"]})})]},h)})})]})]})}function zt({task:t,taskLabel:d,currentProvider:m,currentModel:M,providerList:u,onProviderChange:f,onModelChange:g}){const{data:S,isLoading:R,isError:v}=Ys(m||null),[w,j]=A.useState(!1),N=A.useMemo(()=>{if(!S)return[];const h=S,i=h.textModels??[],E=h.visionModels??[],r=h.embeddingModels??[];return t==="vision"?E:t==="embeddings"?r:i},[S,t]),x=N.length>0;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)] capitalize",children:d}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"PROVIDER"}),e.jsxs("select",{value:m,onChange:h=>{f(h.target.value),j(!1)},className:s(F,"w-full text-xs"),children:[e.jsx("option",{value:"",children:"Select..."}),u.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-accent-primary)] mt-0.5 block",children:[u.length," provider(s) available"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"MODEL"}),R&&m?e.jsxs("div",{className:s(F,"w-full text-xs flex items-center gap-2"),children:[e.jsx($,{className:"w-3 h-3 animate-spin text-blue-400"}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Loading models..."})]}):x&&!w?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:M,onChange:h=>g(h.target.value),className:s(F,"w-full text-xs"),children:[e.jsx("option",{value:"",children:"Select model..."}),N.map(h=>e.jsxs("option",{value:h.id,children:[h.name||h.id,h.contextTokens?` (${Math.round(Number(h.contextTokens)/1e3)}K ctx)`:""]},h.id))]}),e.jsx("button",{onClick:()=>j(!0),className:"text-[10px] text-blue-400 hover:text-blue-300 mt-0.5 block",children:"or type manually"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{value:M,onChange:h=>g(h.target.value),className:s(F,"w-full text-xs"),placeholder:m?"e.g. gpt-4o":"Select a provider first"}),x&&w&&e.jsx("button",{onClick:()=>j(!1),className:"text-[10px] text-blue-400 hover:text-blue-300 mt-0.5 block",children:"back to dropdown"}),v&&m&&e.jsx("span",{className:"text-[10px] text-amber-400 mt-0.5 block",children:"Could not load models — type manually"})]})]})]})]})}function Gt(){const{data:t,isLoading:d}=Ge(),{data:m}=Be(),{data:M,isLoading:u}=Ke(),f=Ve(),g=He(),[S,R]=A.useState({}),[v,w]=A.useState({}),[j,N]=A.useState({}),x=T(t),h=T(x.llm),i=T(h.providers),E=T(h.perTask);T(m).providers;const l=T(M),p=l.providers??[],C=A.useCallback(P=>p.find(L=>L.id===P||L.aliases&&L.aliases.includes(P)),[p]),o=A.useMemo(()=>{const P=new Set,L=Object.entries(i).map(([a,y])=>{const D=C(a),n=D?.id||a;return P.add(n),P.add(a),{id:n,name:D?.name||y.name||a,apiKeyMasked:D?.masked||y.apiKeyMasked||null,isConfigured:D?.configured||!!y.isConfigured,keySource:D?.source||null}});return p.forEach(a=>{P.has(a.id)||(P.add(a.id),L.push({id:a.id,name:a.name||(a.id||"unknown").charAt(0).toUpperCase()+(a.id||"unknown").slice(1),apiKeyMasked:a.masked,isConfigured:a.configured,keySource:a.source}))}),L},[i,p,C]),I=A.useCallback(()=>{const P=Object.entries(v).filter(([,y])=>y.trim().length>0);if(P.length===0){c.info("No changes to save");return}let L=0;const a=P.length;for(const[y,D]of P)f.mutate({provider:y,apiKey:D},{onSuccess:()=>{L++,L===a&&(c.success(`${a} API key${a>1?"s":""} saved to encrypted vault`),w({}))},onError:n=>c.error(`Failed to save ${y}: ${n.message}`)})},[v,f]),Q=A.useCallback(()=>{if(Object.keys(j).length===0){c.info("No changes to save");return}g.mutate({llm:{perTask:j}},{onSuccess:()=>{c.success("LLM configuration saved"),N({})},onError:P=>c.error(P.message)})},[j,g]);if(d||u)return e.jsx(Z,{});const B=Object.values(v).some(P=>P.trim().length>0);return e.jsxs("div",{className:"space-y-8",children:[e.jsx(W,{title:"LLM Providers",subtitle:"System-level API keys stored encrypted in Supabase vault"}),e.jsxs("div",{className:s(k,"p-4 border-l-2 border-[var(--gm-accent-primary)]"),children:[e.jsx("h4",{className:"text-xs font-semibold text-[var(--gm-accent-primary)] mb-2",children:"Key Resolution & Billing"}),e.jsxs("div",{className:"text-[11px] text-[var(--gm-text-secondary)] space-y-1",children:[e.jsxs("p",{children:["The LLM service resolves API keys in this order: ",e.jsx("strong",{children:"Project key"})," (Supabase secrets, project scope) then ",e.jsx("strong",{children:"System key"})," (Supabase secrets, system scope) then ",e.jsx("strong",{children:"Config file"})," (fallback)."]}),e.jsxs("p",{children:["When a project uses its ",e.jsx("strong",{children:"own API key"})," (BYOK), billing is ",e.jsx("span",{className:"text-green-400 font-medium",children:"skipped"})," — the project pays the provider directly."]}),e.jsxs("p",{children:["When using ",e.jsx("strong",{children:"system keys"}),", the project balance is ",e.jsx("span",{className:"text-amber-400 font-medium",children:"debited"})," with the configured markup."]})]})]}),e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:_,children:"System LLM API Keys"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[o.filter(P=>P.isConfigured).length,"/",o.length," configured"]})]}),o.map(P=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:P.name||"(unnamed)"}),P.isConfigured?e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Configured"]}):e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"}),P.keySource&&e.jsxs("span",{className:s("text-[10px] px-1.5 py-0.5 rounded",P.keySource==="system"?"bg-blue-500/20 text-blue-300":"bg-purple-500/20 text-purple-300"),children:[P.keySource," scope"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:S[P.id]?"text":"password",value:v[P.id]??"",onChange:L=>w(a=>({...a,[P.id]:L.target.value})),placeholder:P.apiKeyMasked||`Enter ${P.name} API key...`,className:s(F,"flex-1 font-mono text-xs")}),e.jsx("button",{onClick:()=>R(L=>({...L,[P.id]:!L[P.id]})),className:z,children:S[P.id]?"Hide":"Show"})]}),P.apiKeyMasked&&!v[P.id]&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono pl-1",children:["Current: ",P.apiKeyMasked]})]},P.id)),e.jsxs("button",{onClick:I,disabled:f.isPending||!B,className:K,children:[f.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save to Encrypted Vault"]})]}),e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsx("h3",{className:_,children:"Service API Keys"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Keys for email, notifications and other services (stored encrypted in Supabase)"}),(()=>{const P=l.services??[],L={resend:{link:"https://resend.com/api-keys"},brave:{link:"https://brave.com/search/api/"}};return P.length>0?P.map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:a.name||"(unnamed)"}),a.configured?e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Configured"]}):e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:S[a.id]?"text":"password",value:v[a.id]??"",onChange:y=>w(D=>({...D,[a.id]:y.target.value})),placeholder:a.masked||`Enter ${a.name} key...`,className:s(F,"flex-1 font-mono text-xs")}),e.jsx("button",{onClick:()=>R(y=>({...y,[a.id]:!y[a.id]})),className:z,children:S[a.id]?"Hide":"Show"}),e.jsxs("button",{onClick:()=>{const y=v[a.id]?.trim();if(!y){c.info("Enter a key first");return}f.mutate({provider:a.id,apiKey:y},{onSuccess:()=>{c.success(`${a.name} key saved`),w(D=>{const n={...D};return delete n[a.id],n})},onError:D=>c.error(D.message)})},disabled:f.isPending||!v[a.id]?.trim(),className:K,children:[e.jsx(q,{className:"w-3 h-3"})," Save"]})]}),a.masked&&!v[a.id]&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono pl-1",children:["Current: ",a.masked]}),L[a.id]?.link&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Get key at ",e.jsx("a",{href:L[a.id].link,target:"_blank",rel:"noreferrer",className:"text-[var(--gm-accent-primary)] underline",children:L[a.id].link})]})]},a.id)):["resend","brave"].map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:a==="resend"?"Resend (Email)":"Brave Search"}),e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:v[a]??"",onChange:y=>w(D=>({...D,[a]:y.target.value})),placeholder:`Enter ${a} API key...`,className:s(F,"flex-1 font-mono text-xs")}),e.jsxs("button",{onClick:()=>{const y=v[a]?.trim();y&&f.mutate({provider:a,apiKey:y},{onSuccess:()=>{c.success(`${a} key saved`),w(D=>{const n={...D};return delete n[a],n})},onError:D=>c.error(D.message)})},disabled:f.isPending||!v[a]?.trim(),className:K,children:[e.jsx(q,{className:"w-3 h-3"})," Save"]})]})]},a))})()]}),e.jsxs("div",{className:s(k,"p-5 space-y-5"),children:[e.jsxs("div",{children:[e.jsx("h3",{className:_,children:"Task-Specific AI Configuration"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-1",children:"Configure which provider and model to use for each AI task. These settings apply globally to the platform."})]}),Object.entries(E).map(([P,L])=>{const a=P.replace(/_/g," ").replace(/([A-Z])/g," $1"),y=j[P]?.provider??L?.provider??"",D=j[P]?.model??L?.model??"";return e.jsx(zt,{task:P,taskLabel:a,currentProvider:y,currentModel:D,providerList:o.filter(n=>n.isConfigured),onProviderChange:n=>N(U=>({...U,[P]:{provider:n,model:""}})),onModelChange:n=>N(U=>({...U,[P]:{provider:U[P]?.provider??L?.provider??"",model:n}}))},P)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Q,disabled:g.isPending||Object.keys(j).length===0,className:K,children:[g.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save LLM Configuration"]}),e.jsxs("span",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Changes apply immediately to all AI processing"]})]})]})]})}function Bt(){const{data:t,isLoading:d,refetch:m}=Qe(),{data:M,refetch:u}=Je(),f=Ye(),[g,S]=A.useState("all"),[R,v]=A.useState("all"),[w,j]=A.useState("");if(d)return e.jsx(Z,{});const x=T(t).models??[],h=T(M).providers??[],i=T(f.data),E=x.map(a=>({...a,_type:a.model_type||"text",_provider:a.provider||"unknown"})),r=E.reduce((a,y)=>(a[y._provider]||(a[y._provider]=[]),a[y._provider].push(y),a),{}),l=Object.keys(r).sort(),p=l.length,C=a=>{const y=Number(a);return!y||isNaN(y)?"—":y>=1e6?`${(y/1e6).toFixed(1)}M`:y>=1e3?`${Math.round(y/1e3)}K`:String(y)},o=a=>{const y=Number(a);return!y||isNaN(y)?"—":`$${y.toFixed(2)}`},I=E.filter(a=>{if(g!=="all"&&a._provider!==g||R!=="all"&&a._type!==R)return!1;if(w){const y=w.toLowerCase(),D=String(a.display_name||a.model_id||"").toLowerCase(),n=String(a.model_id||"").toLowerCase();if(!D.includes(y)&&!n.includes(y))return!1}return!0}),Q=I.filter(a=>a._type==="text"),B=I.filter(a=>a._type==="embedding"),P=async()=>{try{const a=await f.mutateAsync();await m(),await u();const y=T(a);c.success(`Models synced — ${y.totalSynced??0} updated across all providers`)}catch(a){c.error(a.message||"Sync failed")}},L=E.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{title:"Model Metadata",subtitle:L?`${E.length} models across ${p} provider(s)`:"No models synced yet — click Sync to populate"}),e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:_,children:"Provider Sync"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Fetches models from each provider API and persists to the database."})]}),e.jsxs("button",{onClick:P,disabled:f.isPending,className:K,children:[f.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ne,{className:"w-3.5 h-3.5"}),f.isPending?"Syncing...":"Sync All Providers"]})]}),i.results&&e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(i.results).map(([a,y])=>e.jsxs("span",{className:s("inline-flex items-center gap-1.5 text-[10px] px-2.5 py-1 rounded-lg font-medium border",y.status==="success"?"bg-green-500/10 border-green-500/30 text-green-400":y.status==="skipped"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-red-500/10 border-red-500/30 text-red-400"),children:[e.jsx(de,{provider:a,size:12}),e.jsx("span",{className:"font-semibold",children:a}),y.status==="success"&&e.jsxs(e.Fragment,{children:[" — ",y.synced," synced"]}),y.status==="skipped"&&e.jsxs(e.Fragment,{children:[" — ",y.reason]}),y.status==="error"&&e.jsx(e.Fragment,{children:" — error"})]},a))}),(h.length>0||l.length>0)&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:(h.length>0?h:l.map(a=>({provider:a}))).map((a,y)=>{const D=a.provider||"",n=a.active_models??a.activeModels??r[D]?.length??0,U=a.last_synced,H=g===D;return e.jsxs("button",{onClick:()=>S(H?"all":D),className:s("flex items-center gap-2.5 px-3 py-2.5 rounded-lg border transition-all text-left","bg-[var(--gm-bg-secondary)] border-[var(--gm-border-primary)] hover:border-[var(--gm-border-secondary)]",H&&"ring-1 ring-[var(--gm-accent-primary)]/50 border-[var(--gm-accent-primary)]/40"),children:[e.jsx(de,{provider:D,size:18}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-[11px] font-semibold text-[var(--gm-text-primary)] truncate capitalize",children:D}),e.jsxs("div",{className:"text-[10px] tabular-nums",style:{color:It(D)},children:[n," models"]}),U&&e.jsx("div",{className:"text-[8px] text-[var(--gm-text-tertiary)] truncate",children:new Date(U).toLocaleDateString()})]})]},y)})})]}),e.jsxs("div",{className:s(k,"p-3 flex items-center gap-3 flex-wrap"),children:[e.jsxs("select",{value:g,onChange:a=>S(a.target.value),className:s(F,"w-auto max-w-[180px]"),children:[e.jsx("option",{value:"all",children:"All Providers"}),l.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{value:R,onChange:a=>v(a.target.value),className:s(F,"w-auto max-w-[140px]"),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"embedding",children:"Embedding"})]}),e.jsx("input",{value:w,onChange:a=>j(a.target.value),placeholder:"Search models...",className:s(F,"w-auto max-w-[220px]")}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] ml-auto tabular-nums",children:[I.length," of ",E.length]})]}),Q.length>0&&e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:_,children:"Text & Vision Models"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[Q.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Model","Provider","Type","Context","$/1M In","$/1M Out"].map(a=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:a},a))})}),e.jsx("tbody",{children:Q.map((a,y)=>{const D=a.display_name||"",n=a.model_id||"—",U=a._provider,H=!!a.supports_vision;return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[D&&e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:D}),e.jsx("div",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)]",children:n})]}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(de,{provider:U,size:14}),e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] capitalize",children:U})]})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)]",children:"text"}),H&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-purple-500/15 text-purple-400",children:"vision"})]})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-primary)] tabular-nums font-semibold",children:C(a.context_tokens)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_input)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_output)})]},y)})})]})})]}),B.length>0&&e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:_,children:"Embedding Models"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[B.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Model","Provider","Context","$/1M In"].map(a=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:a},a))})}),e.jsx("tbody",{children:B.map((a,y)=>{const D=a.display_name||"",n=a.model_id||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[D&&e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:D}),e.jsx("div",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)]",children:n})]}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(de,{provider:a.provider||"",size:14}),e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] capitalize",children:a.provider||""})]})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-primary)] tabular-nums font-semibold",children:C(a.context_tokens)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_input)})]},y)})})]})})]}),!L&&e.jsx(le,{msg:"No models in database yet. Click 'Sync All Providers' to fetch from APIs."}),L&&I.length===0&&e.jsx(le,{msg:"No models match the current filters."})]})}function Kt(){const{data:t,isLoading:d,refetch:m}=We(),{data:M}=Ze(),{data:u}=Xe(),{data:f}=qe(),g=es(),[S,R]=A.useState(null);if(d)return e.jsx(Z,{});const v=T(t),w=T(v.stats),j=T(v.database),N=T(M).items??v.pendingItems??[],x=T(u).items??[],h=T(f).items??T(f).history??[],i=j.totalCostTodayUsd??w.totalCost??w.costToday,E=()=>{confirm("Clear all pending items from the queue? This cannot be undone.")&&g.mutate({action:"clear"},{onSuccess:()=>{c.success("Queue cleared"),m()},onError:r=>c.error(r.message)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{title:"LLM Processing Queue",subtitle:"Monitor and control AI request processing — All requests are persisted in database"}),e.jsxs("div",{className:s(k,"p-5 space-y-3"),children:[e.jsx("h3",{className:_,children:"Queue Status"}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[v.database!=null&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-semibold bg-green-500/15 text-green-400",children:"DB: Connected"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",v.isPaused?"bg-amber-500/15 text-amber-400":v.isProcessing?"bg-blue-500/15 text-blue-400":"bg-green-500/15 text-green-400"),children:v.isPaused?"PAUSED":v.isProcessing?"PROCESSING":"IDLE"}),e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] tabular-nums",children:["Queue: ",v.queueLength??0]}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:["Processing: ",v.isProcessing?1:0]}),e.jsxs("button",{onClick:()=>m(),className:z,children:[e.jsx(ne,{className:"w-3 h-3"})," Refresh"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g.mutate({action:"pause"},{onSuccess:()=>{c.success("Queue paused"),m()},onError:r=>c.error(r.message)}),disabled:g.isPending,className:Ce,children:[e.jsx(kt,{className:"w-3 h-3"})," Pause"]}),e.jsxs("button",{onClick:()=>g.mutate({action:"resume"},{onSuccess:()=>{c.success("Queue resumed"),m()},onError:r=>c.error(r.message)}),disabled:g.isPending,className:K,children:[e.jsx(dt,{className:"w-3 h-3"})," Resume"]}),e.jsx("button",{onClick:E,disabled:g.isPending,className:z,children:"Clear Queue"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-7 gap-3",children:[e.jsx(V,{label:"Pending",value:j.pendingCount??v.queueLength??N.length??0}),e.jsx(V,{label:"Processing",value:j.processingCount??(v.isProcessing?1:0)}),e.jsx(V,{label:"Completed",value:j.completedToday??w.successful??w.completed??0,color:"var(--color-brand-500)"}),e.jsx(V,{label:"Failed",value:j.failedToday??w.failed??0,color:"var(--color-danger-500)"}),e.jsx(V,{label:"Retry Pending",value:j.retryPendingCount??x.length}),e.jsx(V,{label:"Avg Time (ms)",value:j.avgProcessingTimeMs??w.avgProcessingTime?Number(j.avgProcessingTimeMs??w.avgProcessingTime).toLocaleString():"0"}),e.jsx(V,{label:"Cost Today",value:i!=null?`$${Number(i).toFixed(4)}`:"$0",color:"var(--color-brand-500)"})]}),v.currentRequest&&e.jsxs("div",{className:s(k,"p-4"),children:[e.jsx("h3",{className:s(_,"mb-2"),children:"Currently Processing"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-4 h-4 animate-spin text-blue-400 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-[var(--gm-text-primary)]",children:v.currentRequest.context||v.currentRequest.id}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[v.currentRequest.priority&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Priority: ",v.currentRequest.priority]}),v.currentRequest.startedAt&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Started: ",new Date(v.currentRequest.startedAt).toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:s(k,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:_,children:"Pending Items"}),e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] tabular-nums",children:[N.length," items"]})]}),N.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No items in queue"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Priority"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Queued"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Action"})]})}),e.jsx("tbody",{children:N.slice(0,20).map((r,l)=>e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[300px]",children:r.context||r.type||r.task||r.id||"Unknown"}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:s("text-[10px] px-1.5 py-0.5 rounded font-medium",r.priority==="high"?"bg-amber-500/15 text-amber-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"),children:r.priority||"normal"})}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:r.queuedAt?new Date(r.queuedAt).toLocaleTimeString():"—"}),e.jsx("td",{className:"text-right py-1.5 px-2",children:e.jsx("button",{onClick:()=>g.mutate({action:"cancel",id:r.id},{onSuccess:()=>{c.success("Cancelled"),m()}}),className:"text-[10px] text-red-400 hover:underline",children:"Cancel"})})]},l))})]})]}),e.jsxs("div",{className:s(k,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:_,children:"Failed Items"}),x.length>0&&e.jsxs("button",{onClick:()=>g.mutate({action:"retry-all"},{onSuccess:()=>{c.success("Retrying all"),m()}}),disabled:g.isPending,className:Ce,children:[e.jsx(ce,{className:"w-3 h-3"})," Retry All"]})]}),x.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No failed items"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Provider"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Attempts"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Error"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Actions"})]})}),e.jsx("tbody",{children:x.slice(0,20).map((r,l)=>e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[200px]",children:r.context||r.type||"Unknown"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:r.provider||"—"}),e.jsxs("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 tabular-nums",children:[r.attempts??r.attemptCount??"?","/",r.maxAttempts??r.maxRetries??"3"]}),e.jsx("td",{className:"text-[10px] text-red-400 py-1.5 px-2 truncate max-w-[200px]",children:r.error||r.errorMessage||"Error"}),e.jsxs("td",{className:"text-right py-1.5 px-2 whitespace-nowrap",children:[e.jsx("button",{onClick:()=>g.mutate({action:"retry",id:r.id},{onSuccess:()=>{c.success("Retrying"),m()}}),className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline mr-2",children:"Retry"}),e.jsx("button",{onClick:()=>g.mutate({action:"retry",id:r.id+"?reset=true"},{onSuccess:()=>{c.success("Reset & Retrying"),m()}}),className:"text-[10px] text-amber-400 hover:underline",children:"Reset & Retry"})]})]},l))})]})]}),e.jsxs("div",{className:s(k,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:_,children:"Recent Processing History"}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:[h.length," items"]})]}),h.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No processing history yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(O,"text-left py-2 px-2"),children:"Provider / Model"}),e.jsx("th",{className:s(O,"text-center py-2 px-2"),children:"Status"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Tokens"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Time (ms)"}),e.jsx("th",{className:s(O,"text-right py-2 px-2"),children:"Completed"}),e.jsx("th",{className:s(O,"text-center py-2 px-2")})]})}),e.jsx("tbody",{children:h.slice(0,50).map((r,l)=>{const p=r.status==="completed"||r.status==="success",C=r.inputTokens||r.tokensIn||0,o=r.outputTokens||r.tokensOut||0;return e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors cursor-pointer",onClick:()=>R(r),children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[200px]",children:r.context||r.type||r.task||r.id||"—"}),e.jsxs("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:[r.provider||"—",r.model?` / ${r.model}`:""]}),e.jsx("td",{className:"text-center py-1.5 px-2",children:e.jsx("span",{className:s("inline-block w-2 h-2 rounded-full",p?"bg-green-400":"bg-red-400")})}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right tabular-nums",children:C>0?`${C}→${o}`:"—"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right tabular-nums",children:r.processingTime??r.durationMs??"—"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right",children:r.completedAt?new Date(r.completedAt).toLocaleTimeString():"—"}),e.jsx("td",{className:"text-center py-1.5 px-2",children:e.jsx("button",{className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline",children:"View"})})]},l)})})]})})]}),S&&e.jsx(Vt,{request:S,onClose:()=>R(null)})]})}function Vt({request:t,onClose:d}){const m=t.status==="completed"||t.status==="success",M=t.inputTokens||t.tokensIn||0,u=t.outputTokens||t.tokensOut||0,f=t.processingTime||t.durationMs||0,g=t.estimatedCost||t.cost||0,S=R=>{navigator.clipboard.writeText(R),c.success("Copied to clipboard")};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:d,children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm"}),e.jsxs("div",{className:s(k,"relative w-[900px] max-w-[90vw] max-h-[85vh] flex flex-col"),onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:s("w-10 h-10 rounded-lg flex items-center justify-center",m?"bg-green-500/15":"bg-red-500/15"),children:m?e.jsx(oe,{className:"w-5 h-5 text-green-400"}):e.jsx(se,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:"LLM Request Details"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono",children:t.id||"—"})]})]}),e.jsx("button",{onClick:d,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ue,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-5",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Context:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.context||t.type||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Provider:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.provider||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Model:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.model||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Status:"})," ",e.jsx("span",{className:s("font-semibold ml-1",m?"text-green-400":"text-red-400"),children:t.status||"—"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx(V,{label:"Input Tokens",value:M.toLocaleString()}),e.jsx(V,{label:"Output Tokens",value:u.toLocaleString()}),e.jsx(V,{label:"Duration (ms)",value:Number(f).toLocaleString()}),e.jsx(V,{label:"Est. Cost",value:g?`$${Number(g).toFixed(6)}`:"—"})]}),e.jsxs("div",{className:s(k,"p-4"),children:[e.jsx("h4",{className:s(_,"mb-2"),children:"Timeline"}),e.jsxs("div",{className:"flex flex-wrap gap-6 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Queued:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.queuedAt?new Date(t.queuedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Started:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.startedAt?new Date(t.startedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Completed:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.completedAt?new Date(t.completedAt).toLocaleString():"—"})]})]})]}),(t.error||t.errorMessage)&&e.jsxs("div",{className:"rounded-lg border border-red-500/30 bg-red-500/5 p-4",children:[e.jsxs("h4",{className:"text-xs font-bold text-red-400 mb-1 flex items-center gap-1.5",children:[e.jsx(se,{className:"w-3.5 h-3.5"})," Error"]}),e.jsx("p",{className:"text-[10px] text-red-300 font-mono whitespace-pre-wrap",children:t.error||t.errorMessage}),t.attempts&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-2",children:["Attempt ",t.attempts,"/",t.maxAttempts||t.maxRetries||3]})]}),(t.prompt||t.input)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:_,children:"Prompt / Input"}),e.jsx("button",{onClick:()=>S(String(t.prompt||t.input)),className:z,children:"Copy"})]}),e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:String(t.prompt||t.input)})]}),(t.response||t.output||t.result)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:_,children:"Response / Output"}),e.jsx("button",{onClick:()=>S(String(t.response||t.output||t.result)),className:z,children:"Copy"})]}),e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:String(t.response||t.output||t.result)})]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer text-[10px] text-[var(--gm-accent-primary)] hover:underline",children:"Show Raw JSON Data"}),e.jsx("pre",{className:"mt-2 text-[10px] text-[var(--gm-text-tertiary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:JSON.stringify(t,null,2)})]})]})]})]})}function Ht(){const{data:t,isLoading:d}=ss(),{data:m,refetch:M}=ts(),{data:u}=as(),{data:f}=rs(),{data:g}=ns(),{data:S}=ls();is();const R=cs(),v=os(),w=ds(),j=xs(),N=ms(),x=ps(),h=hs(),i=us(),E=gs(),[r,l]=A.useState("status"),[p,C]=A.useState(""),[o,I]=A.useState(null);if(d)return e.jsx(Z,{});const Q=T(t),B=T(Q.config),P=T(m),L=T(u),a=T(f).graphs??[],y=T(g),D=T(S).providers??[],n=P.nodeCount??P.nodes??0,U=P.edgeCount??P.relationships??0,H=!!P.connected,ee=T(L.metrics??L),te=L.recommendations??[];return e.jsxs("div",{className:"space-y-5",children:[e.jsx(W,{title:"Knowledge Graph",subtitle:`${B.provider||"—"} · ${H?`${n} nodes · ${U} edges`:"Not connected"}`}),e.jsx("div",{className:s(k,"p-1 flex gap-1"),children:["status","operations","graphs","query"].map(b=>e.jsx("button",{onClick:()=>l(b),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",r===b?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:b==="status"?"Status & Config":b==="operations"?"Sync & Maintenance":b==="graphs"?`Graphs (${a.length})`:"Query"},b))}),r==="status"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(k,"p-4 space-y-3"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:_,children:"Connection"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",H?"bg-green-500/15 text-green-400":"bg-red-500/15 text-red-400"),children:H?"Connected":"Disconnected"})]}),[["Provider",B.provider],["Graph Name",B.graphName],["Enabled",B.enabled?"Yes":"No"],["Auto Connect",B.autoConnect?"Yes":"No"],["Config Source",Q.source]].map(([b,G])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:b}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono",children:String(G??"—")})]},b)),P.message&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:P.message}),e.jsxs("button",{onClick:()=>M(),className:s(z,"w-full justify-center"),children:[e.jsx(ce,{className:"w-3 h-3"})," Refresh Status"]})]}),e.jsxs("div",{className:s(k,"p-4 space-y-3"),children:[e.jsx("h3",{className:_,children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(V,{label:"Nodes",value:n,color:"var(--gm-accent-primary)"}),e.jsx(V,{label:"Edges",value:U,color:"var(--gm-accent-primary)"})]}),(()=>{const b=T(P.stats);return Object.keys(b).length>0?e.jsx("div",{className:"space-y-1.5",children:Object.entries(b).map(([G,Y])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:G}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] tabular-nums",children:String(Y)})]},G))}):null})()]})]}),(Object.keys(ee).length>0||te.length>0)&&e.jsxs("div",{className:s(k,"p-5 space-y-3"),children:[e.jsx("h3",{className:_,children:"Graph Insights"}),Object.keys(ee).length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(ee).map(([b,G])=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase mb-1",children:b.replace(/([A-Z])/g," $1").replace(/_/g," ")}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:typeof G=="number"?G<1?G.toFixed(3):G.toFixed(1):String(G)})]},b))}),te.length>0&&e.jsxs("div",{className:"space-y-1.5 mt-2",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Recommendations"}),te.map((b,G)=>e.jsxs("div",{className:"flex items-start gap-2 text-[10px]",children:[e.jsx("span",{className:s("shrink-0 mt-0.5",b.priority==="high"?"text-red-400":b.priority==="medium"?"text-amber-400":"text-blue-400"),children:"●"}),e.jsx("span",{className:"text-[var(--gm-text-secondary)]",children:b.message||b.text||b.description})]},G))]})]}),Object.keys(y).length>0&&y.ok!==void 0&&e.jsxs("div",{className:s(k,"p-4 space-y-2"),children:[e.jsx("h3",{className:_,children:"Sync Status"}),[["Status",y.status??y.syncStatus??"—"],["Last Sync",y.lastSyncAt?new Date(y.lastSyncAt).toLocaleString():"—"],["Pending",y.pending??"—"]].map(([b,G])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:b}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:String(G)})]},b))]}),D.length>0&&e.jsxs("div",{className:s(k,"p-4"),children:[e.jsx("h3",{className:s(_,"mb-2"),children:"Available Providers"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map((b,G)=>e.jsx("span",{className:s("text-[10px] px-2.5 py-1 rounded-lg border font-medium",(b.id||b.name)===B.provider?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:b.name||b.id||"?"},G))})]})]}),r==="operations"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsx("h3",{className:_,children:"Sync"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>R.mutate(void 0,{onSuccess:()=>c.success("Sync complete"),onError:b=>c.error(b.message)}),disabled:R.isPending,className:K,children:[R.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ne,{className:"w-3.5 h-3.5"})," Quick Sync"]}),e.jsxs("button",{onClick:()=>v.mutate(void 0,{onSuccess:()=>c.success("Full sync complete"),onError:b=>c.error(b.message)}),disabled:v.isPending,className:K,children:[v.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ce,{className:"w-3.5 h-3.5"})," Full Sync"]}),e.jsxs("button",{onClick:()=>E.mutate(void 0,{onSuccess:()=>c.success("All projects synced"),onError:b=>c.error(b.message)}),disabled:E.isPending,className:z,children:[E.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(_e,{className:"w-3.5 h-3.5"})," Sync All Projects"]})]})]}),e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsx("h3",{className:_,children:"Indexes & Optimization"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsxs("button",{onClick:()=>w.mutate(void 0,{onSuccess:()=>c.success("Indexes created"),onError:b=>c.error(b.message)}),disabled:w.isPending,className:z,children:[w.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Le,{className:"w-3.5 h-3.5"})," Create Indexes"]})})]}),e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsx("h3",{className:_,children:"Cleanup"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Remove orphaned graphs, duplicate nodes, and stale relationships"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>j.mutate(void 0,{onSuccess:b=>c.success(`Cleaned ${b?.deleted??"?"} orphans`),onError:b=>c.error(b.message)}),disabled:j.isPending,className:z,children:[j.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(he,{className:"w-3.5 h-3.5"})," Cleanup Orphan Graphs"]}),e.jsxs("button",{onClick:()=>N.mutate(void 0,{onSuccess:()=>c.success("Duplicates cleaned"),onError:b=>c.error(b.message)}),disabled:N.isPending,className:z,children:[N.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(je,{className:"w-3.5 h-3.5"})," Cleanup Duplicates"]}),e.jsxs("button",{onClick:()=>x.mutate(void 0,{onSuccess:()=>c.success("Sync cleanup done"),onError:b=>c.error(b.message)}),disabled:x.isPending,className:z,children:[x.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(he,{className:"w-3.5 h-3.5"})," Sync Cleanup"]})]})]})]}),r==="graphs"&&e.jsx("div",{className:"space-y-5",children:a.length>0?e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:_,children:"All Graphs"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Graph","Project","Nodes","Edges","Status",""].map(b=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:b},b))})}),e.jsx("tbody",{children:a.map((b,G)=>{const Y=b.name||b.graphName||"—",ae=Y===B.graphName;return e.jsxs("tr",{className:s("border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",ae&&"bg-[var(--gm-accent-primary)]/5"),children:[e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:Y}),ae&&e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded-full bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)] font-bold",children:"ACTIVE"})]})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)]",children:b.projectName||b.projectId||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-primary)] tabular-nums",children:b.nodeCount??b.nodes??"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-primary)] tabular-nums",children:b.edgeCount??b.edges??"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-1.5 py-0.5 rounded-full font-medium",b.orphan?"bg-amber-500/10 text-amber-400":"bg-green-500/10 text-green-400"),children:b.orphan?"Orphan":"Active"})}),e.jsx("td",{className:"px-4 py-2.5",children:!ae&&e.jsx("button",{onClick:()=>{confirm(`Delete graph "${Y}"?`)&&h.mutate(Y,{onSuccess:()=>c.success(`Deleted ${Y}`),onError:J=>c.error(J.message)})},disabled:h.isPending,className:"text-[9px] text-red-400 hover:underline font-medium",children:"Delete"})})]},G)})})]})})]}):e.jsx(le,{msg:"No graphs found. Connect to a graph provider first."})}),r==="query"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(k,"p-5 space-y-3"),children:[e.jsx("h3",{className:_,children:"Cypher Query"}),e.jsx("textarea",{value:p,onChange:b=>C(b.target.value),placeholder:"MATCH (n) RETURN n LIMIT 10",rows:4,className:s(F,"w-full font-mono text-xs resize-y")}),e.jsxs("button",{onClick:()=>i.mutate({query:p},{onSuccess:b=>{I(b),c.success("Query executed")},onError:b=>c.error(b.message)}),disabled:i.isPending||!p.trim(),className:K,children:[i.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"})," Execute"]})]}),o&&e.jsxs("div",{className:s(k,"p-5 space-y-3"),children:[e.jsx("h3",{className:_,children:"Result"}),(()=>{const b=T(o),G=b.nodes??[],Y=b.edges??b.relationships??[],ae=b.rows??b.data??[];return e.jsxs("div",{className:"space-y-3",children:[G.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:["Nodes (",G.length,")"]}),e.jsx("div",{className:"mt-1 max-h-48 overflow-y-auto",children:G.slice(0,50).map((J,me)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-accent-primary)] font-medium",children:J.label||J.labels?.[0]||J.type||"?"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] truncate flex-1",children:J.name||J.title||J.id||JSON.stringify(J.properties||J).substring(0,80)})]},me))})]}),Y.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:["Relationships (",Y.length,")"]}),e.jsx("div",{className:"mt-1 max-h-48 overflow-y-auto",children:Y.slice(0,50).map((J,me)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:J.source||J.from||"?"}),e.jsxs("span",{className:"text-[var(--gm-accent-primary)] font-medium",children:["→ ",J.type||J.label||"?"," →"]}),e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:J.target||J.to||"?"})]},me))})]}),ae.length>0&&G.length===0&&Y.length===0&&e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] font-mono bg-[var(--gm-bg-tertiary)] p-3 rounded-lg overflow-auto max-h-64",children:JSON.stringify(ae,null,2)}),G.length===0&&Y.length===0&&ae.length===0&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No results returned."})]})})()]})]})]})}function Qt(){return e.jsxs("div",{className:"space-y-5",children:[e.jsx(W,{title:"Ontology",subtitle:"Full ontology management — entities, relations, AI, tools, inference, embeddings, and more"}),e.jsx("div",{className:s(k,"overflow-hidden"),style:{height:"calc(100vh - 220px)",minHeight:500},children:e.jsx(lt,{})})]})}const Te={extraction:"bg-blue-500/15 text-blue-400 border-blue-500/30",analysis:"bg-purple-500/15 text-purple-400 border-purple-500/30",template:"bg-amber-500/15 text-amber-400 border-amber-500/30",sprint:"bg-green-500/15 text-green-400 border-green-500/30",report:"bg-rose-500/15 text-rose-400 border-rose-500/30"};function Jt(){const{data:t,isLoading:d,error:m}=vs(),M=js(),u=ys(),[f,g]=A.useState("all"),[S,R]=A.useState(""),[v,w]=A.useState(null),[j,N]=A.useState(null),x=t?.templates??[];if(d)return e.jsx(Z,{});if(m)return e.jsx(ye,{msg:"Unable to load prompts."});const h=["all",...Array.from(new Set(x.map(l=>l.category))).sort()],i=x.filter(l=>{if(f!=="all"&&l.category!==f)return!1;if(S){const p=S.toLowerCase();return l.name.toLowerCase().includes(p)||l.id.toLowerCase().includes(p)||(l.description||"").toLowerCase().includes(p)}return!0}),E=x.reduce((l,p)=>(l[p.category]=(l[p.category]||0)+1,l),{}),r=l=>{M.mutate({key:l.id,is_active:!l.isActive},{onSuccess:()=>c.success(`${l.name} ${l.isActive?"deactivated":"activated"}`),onError:p=>c.error(p.message)})};return e.jsxs("div",{className:"space-y-5",children:[e.jsx(W,{title:"Prompt Templates",subtitle:`${x.length} templates with auto-versioning across ${Object.keys(E).length} categories`}),e.jsxs("div",{className:s(k,"p-3 flex items-center gap-2 flex-wrap"),children:[h.map(l=>e.jsx("button",{onClick:()=>g(l),className:s("px-3 py-1.5 text-[11px] font-medium rounded-lg border transition-all capitalize",f===l?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-transparent text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:l==="all"?`All (${x.length})`:`${l} (${E[l]||0})`},l)),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{value:S,onChange:l=>R(l.target.value),placeholder:"Search prompts...",className:s(F,"w-48 pl-7 py-1.5 text-xs")})]})})]}),e.jsx("div",{className:"space-y-3",children:i.map(l=>e.jsxs("div",{className:s(k,"overflow-hidden group",!l.isActive&&"opacity-60"),children:[e.jsxs("div",{className:"px-5 py-3 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:l.name||"(unnamed)"}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",Te[l.category]||"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border-[var(--gm-border-primary)]"),children:l.category}),e.jsx("button",{onClick:()=>r(l),className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border cursor-pointer transition-colors",l.isActive?"bg-green-500/10 border-green-500/30 text-green-400 hover:bg-green-500/20":"bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20"),children:l.isActive?"Active":"Inactive"})]}),l.description&&e.jsx("p",{className:"text-[11px] text-[var(--gm-text-tertiary)] mt-1 line-clamp-1",children:l.description}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 flex-wrap",children:[e.jsx("span",{className:"text-[9px] font-mono text-[var(--gm-text-tertiary)]",children:l.id}),e.jsx("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:"·"}),e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:l.lastModified}),e.jsx("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:"·"}),l.variables?.slice(0,5).map(p=>e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] font-mono border border-[var(--gm-border-primary)]",children:`{{${p}}}`},p)),(l.variables?.length||0)>5&&e.jsxs("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:["+",l.variables.length-5," more"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[e.jsx("button",{onClick:()=>N(j===l.id?null:l.id),title:"Version History",className:"p-1.5 rounded-lg hover:bg-[var(--gm-surface-hover)] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:e.jsx(xt,{className:"w-3.5 h-3.5"})}),e.jsxs("button",{onClick:()=>w(l),className:K,children:[e.jsx(mt,{className:"w-3 h-3"})," Edit"]})]})]}),e.jsx("div",{className:"px-5 pb-3",children:e.jsxs("pre",{className:"text-[10px] text-[var(--gm-text-tertiary)]/70 max-h-12 overflow-hidden whitespace-pre-wrap font-mono leading-relaxed",children:[l.prompt.substring(0,300),l.prompt.length>300?"…":""]})}),j===l.id&&e.jsx(Wt,{promptKey:l.id,currentPrompt:l.prompt,onRestore:p=>u.mutate({key:l.id,version:p},{onSuccess:()=>{c.success(`Restored v${p}`),N(null)},onError:C=>c.error(C.message)})})]},l.id))}),i.length===0&&e.jsx(le,{msg:S?"No prompts match your search.":"No prompt templates found."}),v&&e.jsx(Yt,{prompt:v,onClose:()=>w(null),onSave:(l,p,C)=>{const o={key:v.id};l!==v.prompt&&(o.prompt=l,p&&(o.change_reason=p)),C!==void 0&&C!==v.description&&(o.description=C),M.mutate(o,{onSuccess:()=>{c.success("Prompt saved"),w(null)},onError:I=>c.error(I.message)})},isSaving:M.isPending})]})}function Yt({prompt:t,onClose:d,onSave:m,isSaving:M}){const[u,f]=A.useState(t.prompt),[g,S]=A.useState(t.description||""),[R,v]=A.useState(""),[w,j]=A.useState("edit"),N=A.useRef(null),x=["document","transcript","conversation","vision","email"].includes(t.id)?t.id:null,{data:h}=Xs(w==="preview"&&x?x:null),i=T(h),E=p=>{const C=N.current;if(!C)return;const o=C.selectionStart,I=C.selectionEnd,Q=`{{${p}}}`,B=u.substring(0,o)+Q+u.substring(I);f(B),requestAnimationFrame(()=>{C.focus(),C.setSelectionRange(o+Q.length,o+Q.length)})},r=u!==t.prompt||g!==(t.description||""),l=u.split(`
`).length;return e.jsx(qs,{open:!0,onClose:d,children:e.jsxs(et,{className:"!max-w-5xl !max-h-[95vh] !p-0 flex flex-col bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-[var(--gm-border-primary)] flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}),e.jsx("h2",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:t.name||"(unnamed)"}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",Te[t.category]||"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border-[var(--gm-border-primary)]"),children:t.category}),e.jsx("span",{className:"text-[9px] font-mono text-[var(--gm-text-tertiary)]",children:t.id})]}),e.jsx("input",{value:g,onChange:p=>S(p.target.value),placeholder:"Add a description...",className:"mt-1.5 w-full text-[11px] text-[var(--gm-text-secondary)] bg-transparent border-0 outline-none placeholder:text-[var(--gm-text-placeholder)]"})]}),e.jsx("button",{onClick:d,className:"p-1.5 rounded-lg hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ue,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsxs("div",{className:"px-6 pt-2 flex items-center gap-1 border-b border-[var(--gm-border-primary)] shrink-0",children:[["edit","preview"].map(p=>e.jsx("button",{onClick:()=>j(p),className:s("px-3 py-2 text-[11px] font-medium capitalize border-b-2 -mb-px transition-colors",w===p?"border-[var(--gm-accent-primary)] text-[var(--gm-accent-primary)]":"border-transparent text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:p==="edit"?"Editor":"Preview"},p)),e.jsxs("span",{className:"ml-auto text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[l," lines · ",u.length," chars"]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden flex",children:w==="edit"?e.jsxs("div",{className:"flex flex-1 min-h-0",children:[e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx("textarea",{ref:N,value:u,onChange:p=>f(p.target.value),className:"w-full h-full min-h-[400px] bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 font-mono text-xs text-[var(--gm-text-primary)] resize-none outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] leading-relaxed",spellCheck:!1})}),e.jsxs("div",{className:"w-56 border-l border-[var(--gm-border-primary)] overflow-y-auto p-3 shrink-0 bg-[var(--gm-bg-secondary)]",children:[e.jsx("div",{className:s(_,"mb-2"),children:"Variables"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mb-3",children:"Click to insert at cursor position"}),e.jsx("div",{className:"space-y-1",children:t.variables.map(p=>e.jsx("button",{onClick:()=>E(p),className:"w-full text-left px-2 py-1.5 rounded-lg text-[10px] font-mono bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] hover:bg-[var(--gm-accent-primary)]/10 border border-[var(--gm-border-primary)] transition-colors truncate",children:`{{${p}}}`},p))}),t.variables.length===0&&e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] italic",children:"No variables detected"}),e.jsx("div",{className:s(_,"mt-4 mb-2"),children:"Common Variables"}),e.jsx("div",{className:"space-y-1",children:["CONTENT","FILENAME","ONTOLOGY_CONTEXT","CONTACTS_INDEX","ORG_INDEX","PROJECT_INDEX"].filter(p=>!t.variables.includes(p)).map(p=>e.jsx("button",{onClick:()=>E(p),className:"w-full text-left px-2 py-1.5 rounded-lg text-[10px] font-mono bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-accent-primary)]/10 border border-[var(--gm-border-primary)] transition-colors truncate",children:`{{${p}}}`},p))})]})]}):e.jsx("div",{className:"flex-1 overflow-auto p-6",children:x?i.prompt?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:s(_),children:["Rendered Prompt (",x,")"]}),e.jsx("pre",{className:"text-[11px] font-mono text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 max-h-[60vh] overflow-auto",children:typeof i.prompt=="string"?i.prompt:typeof i.prompt=="object"&&i.prompt!==null?JSON.stringify(i.prompt,null,2):String(i.prompt)}),i.ontologyContext&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s(_,"mt-4"),children:"Ontology Context"}),e.jsx("pre",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)] whitespace-pre-wrap bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-3 max-h-40 overflow-auto",children:JSON.stringify(i.ontologyContext,null,2)})]})]}):e.jsx("div",{className:"text-xs text-[var(--gm-text-tertiary)] py-8 text-center",children:"Loading preview..."}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:s(_),children:"Current Template"}),e.jsx("pre",{className:"text-[11px] font-mono text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 max-h-[60vh] overflow-auto",children:u}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Live preview is available for: document, transcript, conversation, vision, email prompts."})]})})}),e.jsxs("div",{className:"px-6 py-3 border-t border-[var(--gm-border-primary)] flex items-center gap-3 shrink-0 bg-[var(--gm-bg-secondary)]",children:[e.jsx("input",{value:R,onChange:p=>v(p.target.value),placeholder:"Change reason (optional)...",className:s(F,"flex-1 py-1.5 text-xs")}),e.jsxs("button",{onClick:d,className:z,children:[e.jsx(ue,{className:"w-3 h-3"})," Cancel"]}),e.jsxs("button",{onClick:()=>m(u,R,g),disabled:M||!r,className:K,children:[M?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"}),M?"Saving...":"Save Changes"]})]})]})})}function Wt({promptKey:t,currentPrompt:d,onRestore:m}){const{data:M,isLoading:u}=Ws(t),[f,g]=A.useState(null),{data:S}=Zs(t,f),R=T(M),v=R.versions??[],j=T(S).version??{};return u?e.jsxs("div",{className:"px-5 pb-3 text-xs text-[var(--gm-text-tertiary)]",children:[e.jsx($,{className:"w-3 h-3 animate-spin inline mr-1"}),"Loading versions..."]}):v.length===0?e.jsx("div",{className:"px-5 pb-3 text-xs text-[var(--gm-text-tertiary)] italic",children:"No previous versions."}):e.jsxs("div",{className:"border-t border-[var(--gm-border-primary)] bg-[var(--gm-bg-secondary)]",children:[e.jsxs("div",{className:"px-5 pt-3 pb-2 flex items-center justify-between",children:[e.jsx("span",{className:_,children:"Version History"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:["Current: v",R.current_version??"?"," · ",v.length," previous"]})]}),e.jsx("div",{className:"px-5 pb-3 space-y-1",children:v.map(N=>{const x=N.version,h=f===x;return e.jsxs("div",{children:[e.jsxs("div",{className:s("flex items-center gap-3 text-xs py-1.5 px-2.5 rounded-lg transition-colors",h?"bg-[var(--gm-accent-primary)]/10":"hover:bg-[var(--gm-surface-hover)]"),children:[e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] font-mono font-bold tabular-nums",children:["v",x]}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)] tabular-nums text-[10px]",children:N.created_at?new Date(N.created_at).toLocaleString():"—"}),N.change_reason&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-secondary)] italic truncate max-w-[200px]",children:N.change_reason}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("button",{onClick:()=>g(h?null:x),className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline font-medium",children:h?"Hide":"View"}),e.jsx("button",{onClick:()=>m(x),className:"text-[10px] text-amber-400 hover:underline font-medium",children:"Restore"})]})]}),h&&j.prompt_template&&e.jsx("div",{className:"mt-1 mb-2 mx-2",children:e.jsx("pre",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)] whitespace-pre-wrap bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-3 max-h-48 overflow-auto leading-relaxed",children:j.prompt_template})})]},N.id)})})]})}function Zt(){const{data:t}=st(),d=tt(),m=at(),M=rt(),u=nt(),f=t??{};return e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:_,children:"Knowledge Pipeline"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Embeddings: ",typeof f.embeddingsCount=="number"?f.embeddingsCount:"—"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:()=>d.mutate(void 0,{onSuccess:()=>c.success("Knowledge synthesis complete"),onError:g=>c.error(g.message)}),disabled:d.isPending,className:K,children:[d.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"}),"Synthesize"]}),e.jsxs("button",{onClick:()=>m.mutate(void 0,{onSuccess:()=>c.success("Embeddings generated"),onError:g=>c.error(g.message)}),disabled:m.isPending,className:K,children:[m.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(vt,{className:"w-3.5 h-3.5"}),"Generate Embeddings"]}),e.jsxs("button",{onClick:()=>u.mutate(void 0,{onSuccess:()=>c.success("Resynthesis complete"),onError:g=>c.error(g.message)}),disabled:u.isPending,className:z,children:[u.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ce,{className:"w-3.5 h-3.5"}),"Resynthesis"]}),e.jsxs("button",{onClick:()=>M.mutate(void 0,{onSuccess:()=>c.success("SOT regenerated"),onError:g=>c.error(g.message)}),disabled:M.isPending,className:z,children:[M.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ge,{className:"w-3.5 h-3.5"}),"Regenerate SOT"]})]})]})}function Xt(){const{data:t,isLoading:d}=bs(),m=Ns(),{data:M}=fs(),{data:u}=ws(),f=Ss(),[g,S]=A.useState({}),R=A.useRef(!1),v=T(t),w=T(v.processing),j=M??{},N=u??[];A.useEffect(()=>{!R.current&&Object.keys(w).length>0&&(S({chunkSize:w.chunkSize??4e3,chunkOverlap:w.chunkOverlap??200,similarityThreshold:w.similarityThreshold??.9,pdfToImages:w.pdfToImages??!0,autoProcess:w.autoProcess??!0,temperature:w.temperature??.7}),R.current=!0)},[w]);const x=A.useCallback(()=>{m.mutate({key:"processing",value:g,category:"processing"},{onSuccess:()=>c.success("Processing settings saved"),onError:C=>c.error(C.message)})},[g,m]),h=()=>{f.mutate(void 0,{onSuccess:()=>c.success("Processing started"),onError:C=>c.error(C.message)})};if(d)return e.jsx(Z,{});const i=j.status==="processing"||j.status==="running",E=Number(j.progress??0),r=j.currentFile||"",l=Number(j.totalFiles??0),p=Number(j.processedFiles??0);return e.jsxs("div",{className:"space-y-5",children:[e.jsx(W,{title:"Document Processing",subtitle:"Pipeline status, controls, and configuration"}),e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:_,children:"Pipeline Status"}),e.jsxs("button",{onClick:h,disabled:f.isPending||i,className:K,children:[f.isPending||i?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"}),i?"Processing...":"Process All Pending"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:s(k,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("div",{className:s("w-2 h-2 rounded-full",i?"bg-green-400 animate-pulse":j.status==="error"?"bg-red-400":"bg-[var(--gm-text-tertiary)]")}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Status"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] capitalize",children:j.status||"idle"})]}),e.jsxs("div",{className:s(k,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(Cs,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Pending"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-accent-primary)]",children:N.length})]}),e.jsxs("div",{className:s(k,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(St,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Progress"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:l>0?`${p}/${l}`:"—"})]}),e.jsxs("div",{className:s(k,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(ke,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Completion"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:E>0?`${Math.round(E)}%`:"—"})]})]}),i&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full h-2 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)] transition-all duration-500 ease-out",style:{width:`${Math.max(E,2)}%`}})}),r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-3 h-3 animate-spin text-[var(--gm-accent-primary)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono truncate",children:r})]})]}),j.errors&&Array.isArray(j.errors)&&j.errors.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:s(_,"text-red-400"),children:"Errors"}),j.errors.slice(0,5).map((C,o)=>e.jsx("div",{className:"text-[10px] text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg px-3 py-1.5 font-mono",children:C.file||C.message||JSON.stringify(C)},o))]})]}),e.jsx(Zt,{}),N.length>0&&e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:_,children:"Pending Files"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[N.length," files waiting"]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:N.map((C,o)=>e.jsxs("div",{className:"px-5 py-2 flex items-center gap-3 border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx(ge,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)] shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-[var(--gm-text-primary)] truncate",children:C.name||C.filename||C.file||"—"}),C.type&&e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:C.type})]}),C.size&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums shrink-0",children:[(Number(C.size)/1024).toFixed(1)," KB"]})]},o))})]}),e.jsxs("div",{className:s(k,"p-5 space-y-5"),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:_,children:"Chunking & Extraction"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Chunk Size (tokens)"}),e.jsx("input",{type:"number",value:g.chunkSize??"",onChange:C=>S(o=>({...o,chunkSize:Number(C.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Size of each text chunk for LLM processing"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Chunk Overlap (tokens)"}),e.jsx("input",{type:"number",value:g.chunkOverlap??"",onChange:C=>S(o=>({...o,chunkOverlap:Number(C.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Overlap between chunks to preserve context"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Similarity Threshold"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"1",value:g.similarityThreshold??"",onChange:C=>S(o=>({...o,similarityThreshold:Number(C.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Cosine similarity for dedup (0.0 – 1.0)"})]})]})]}),e.jsxs("div",{className:s(k,"p-5 space-y-5"),children:[e.jsx("h3",{className:_,children:"LLM & Generation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Temperature"}),e.jsx("input",{type:"number",step:"0.1",min:"0",max:"2",value:g.temperature??"",onChange:C=>S(o=>({...o,temperature:Number(C.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"LLM creativity (0 = deterministic, 1+ = creative)"})]}),e.jsx("div",{className:"flex flex-col justify-center",children:e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-medium",children:"PDF to Images"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Convert PDFs to images for vision model processing"})]}),e.jsx(xe,{checked:!!g.pdfToImages,onChange:C=>S(o=>({...o,pdfToImages:C}))})]})})]})]}),e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsx("h3",{className:_,children:"Automation"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-medium",children:"Auto-Process on Upload"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Automatically process documents when uploaded"})]}),e.jsx(xe,{checked:!!g.autoProcess,onChange:C=>S(o=>({...o,autoProcess:C}))})]})]}),e.jsxs("button",{onClick:x,disabled:m.isPending,className:K,children:[m.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save Processing Settings"]})]})}function qt(){const{data:t,isLoading:d}=ks(),m=Ps(),{data:M}=As(),{data:u}=Ls(),{data:f}=Ms(),{data:g}=_s(),S=Es(),R=Rs(),v=Ts(),w=Ds(),[j,N]=A.useState({}),x=A.useRef(!1),[h,i]=A.useState("overview"),E=T(t),r=T(E.config),l=T(M).profiles??[],p=T(T(u).analysis),C=T(f).relationships??[],o=T(g).projects??[];A.useEffect(()=>{!x.current&&Object.keys(r).length>0&&(N({...r}),x.current=!0)},[r]);const I=A.useCallback(()=>{m.mutate(j,{onSuccess:()=>c.success("Configuration saved"),onError:n=>c.error(n.message)})},[j,m]),Q=()=>{S.mutate({forceReanalysis:!1},{onSuccess:()=>c.success("Team analysis completed"),onError:n=>c.error(n.message)})};if(d)return e.jsx(Z,{});const B=Number(p.cohesion_score??0),P=p.tension_level||"—",L=p.alliances??[],a=p.tensions??[],y=[{key:"includePersonality",label:"Personality Analysis",desc:"Behavioral profiling and communication identity"},{key:"includeSentiment",label:"Sentiment Tracking",desc:"Emotional tone and sentiment trends"},{key:"includeCommunication",label:"Communication Patterns",desc:"Speaking style, directness, verbosity"},{key:"includeCollaboration",label:"Collaboration Metrics",desc:"Teamwork, alignment, and cooperation signals"}],D=l.reduce((n,U)=>{const H=U.confidence_level||"low";return n[H]=(n[H]||0)+1,n},{});return e.jsxs("div",{className:"space-y-5",children:[e.jsx(W,{title:"Team Behavioral Analysis",subtitle:`${l.length} profiles · ${C.length} relationships · Cohesion ${B||"—"}%`}),e.jsx("div",{className:s(k,"p-1 flex gap-1"),children:["overview","config","projects"].map(n=>e.jsx("button",{onClick:()=>i(n),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",h===n?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:n==="overview"?"Overview & Analysis":n==="config"?"Configuration":"Projects"},n))}),h==="overview"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(k,"p-4 flex items-center gap-3 flex-wrap"),children:[e.jsxs("button",{onClick:Q,disabled:S.isPending,className:K,children:[S.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"}),S.isPending?"Analyzing...":"Run Team Analysis"]}),e.jsxs("button",{onClick:()=>v.mutate(void 0,{onSuccess:()=>c.success("Graph synced"),onError:n=>c.error(n.message)}),disabled:v.isPending,className:z,children:[v.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Pe,{className:"w-3.5 h-3.5"}),"Sync to Graph"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(V,{label:"Profiles",value:l.length,color:"var(--gm-accent-primary)"}),e.jsx(V,{label:"Relationships",value:C.length,color:"var(--gm-accent-primary)"}),e.jsx(V,{label:"Cohesion",value:B>0?`${B}%`:"—",color:B>=70?"#22c55e":B>=40?"#f59e0b":"#ef4444"}),e.jsx(V,{label:"Alliances",value:L.length,color:"#22c55e"}),e.jsx(V,{label:"Tensions",value:a.length,color:"#ef4444"})]}),p.analysis_data&&e.jsxs("div",{className:s(k,"p-5 space-y-3"),children:[e.jsx("h3",{className:_,children:"Team Dynamics"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Tension Level"}),e.jsx("div",{className:s("text-sm font-bold capitalize",P==="high"?"text-red-400":P==="medium"?"text-amber-400":"text-green-400"),children:P})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Team Size"}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:p.team_size||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Communication"}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] truncate",children:p.dominant_communication_pattern||"—"})]})]})]}),l.length>0&&e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:_,children:"Behavioral Profiles"}),e.jsx("div",{className:"flex gap-1.5",children:Object.entries(D).map(([n,U])=>e.jsxs("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",n==="very_high"||n==="high"?"bg-green-500/10 border-green-500/30 text-green-400":n==="medium"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:[U," ",n.replace("_"," ")]},n))})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Person","Style","Motivation","Risk","Influence","Confidence","Transcripts",""].map(n=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:n},n))})}),e.jsx("tbody",{children:l.map((n,U)=>{const H=T(n.contact),ee=H.full_name||H.name||n.contact_id||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:ee}),H.role&&e.jsx("div",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:H.role})]}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-secondary)] capitalize",children:n.communication_style||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-secondary)] capitalize",children:n.dominant_motivation||"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize",n.risk_tolerance==="high"?"bg-red-500/10 text-red-400":n.risk_tolerance==="medium"?"bg-amber-500/10 text-amber-400":"bg-green-500/10 text-green-400"),children:n.risk_tolerance||"—"})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-12 h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)]",style:{width:`${Number(n.influence_score??0)}%`}})}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-primary)] tabular-nums font-semibold",children:n.influence_score??0})]})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize",n.confidence_level==="high"||n.confidence_level==="very_high"?"bg-green-500/10 text-green-400":n.confidence_level==="medium"?"bg-amber-500/10 text-amber-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"),children:(n.confidence_level||"—").replace("_"," ")})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:n.transcript_count??0}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("button",{onClick:()=>R.mutate({personId:n.contact_id||n.id,forceReanalysis:!0},{onSuccess:()=>c.success(`Re-analyzed ${ee}`),onError:te=>c.error(te.message)}),disabled:R.isPending,className:"text-[9px] text-[var(--gm-accent-primary)] hover:underline font-medium",children:"Re-analyze"})})]},U)})})]})})]}),C.length>0&&e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:_,children:"Behavioral Relationships"})}),e.jsx("div",{className:"overflow-x-auto max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)] sticky top-0 bg-[var(--gm-surface-primary)]",children:["From","To","Type","Strength","Confidence"].map(n=>e.jsx("th",{className:s(O,"px-4 py-2 text-left"),children:n},n))})}),e.jsx("tbody",{children:C.map((n,U)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2 text-xs text-[var(--gm-text-primary)]",children:n.from_name||n.from_contact_id||"—"}),e.jsx("td",{className:"px-4 py-2 text-xs text-[var(--gm-text-primary)]",children:n.to_name||n.to_contact_id||"—"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize border",n.relationship_type==="tension_with"||n.relationship_type==="competes_with"?"bg-red-500/10 border-red-500/30 text-red-400":n.relationship_type==="aligned_with"||n.relationship_type==="supports"||n.relationship_type==="mentors"?"bg-green-500/10 border-green-500/30 text-green-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:(n.relationship_type||"—").replace(/_/g," ")})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-10 h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)]",style:{width:`${Math.round(Number(n.strength??0)*100)}%`}})}),e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[(Number(n.strength??0)*100).toFixed(0),"%"]})]})}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:n.confidence||"—"})]},U))})]})})]}),l.length===0&&e.jsx(le,{msg:"No behavioral profiles yet. Run Team Analysis to start profiling."})]}),h==="config"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(k,"p-5 space-y-5"),children:[e.jsx("h3",{className:_,children:"Analysis Parameters"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Frequency"}),e.jsxs("select",{value:j.analysisFrequency||"weekly",onChange:n=>N(U=>({...U,analysisFrequency:n.target.value})),className:s(F,"w-full"),children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"How often to auto-run analysis"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Min Meetings"}),e.jsx("input",{type:"number",min:"1",value:j.minMeetingsForAnalysis??3,onChange:n=>N(U=>({...U,minMeetingsForAnalysis:Number(n.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Minimum transcripts before profiling"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1.5"),children:"Sentiment Threshold"}),e.jsx("input",{type:"number",step:"0.1",min:"-1",max:"0",value:j.sentimentThreshold??-.3,onChange:n=>N(U=>({...U,sentimentThreshold:Number(n.target.value)})),className:s(F,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Alert below this score (-1 to 0)"})]})]})]}),e.jsxs("div",{className:s(k,"p-5 space-y-3"),children:[e.jsx("h3",{className:_,children:"Analysis Modules"}),y.map(({key:n,label:U,desc:H})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:U}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:H})]}),e.jsx(xe,{checked:j[n]!==!1,onChange:ee=>N(te=>({...te,[n]:ee}))})]},n))]}),e.jsxs("button",{onClick:I,disabled:m.isPending,className:K,children:[m.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save Configuration"]})]}),h==="projects"&&e.jsx("div",{className:"space-y-5",children:o.length>0?e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:_,children:"All Projects — Analysis Status"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Project","Enabled","Last Analysis",""].map(n=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:n},n))})}),e.jsx("tbody",{children:o.map((n,U)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs font-medium text-[var(--gm-text-primary)]",children:n.name||n.id||"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium",n.isEnabled?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"),children:n.isEnabled?"Enabled":"Disabled"})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:n.lastAnalysisAt?new Date(n.lastAnalysisAt).toLocaleString():"Never"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("button",{onClick:()=>w.mutate({projectId:n.id},{onSuccess:()=>c.success(`Analysis triggered for ${n.name}`),onError:H=>c.error(H.message)}),disabled:w.isPending,className:K,children:[w.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"})," Analyze"]})})]},U))})]})})]}):e.jsx(le,{msg:"No projects found or admin endpoint not available."})})]})}function ea(){const{data:t,isLoading:d}=Is(),m=Os(),M=$s(),u=Fs(),[f,g]=A.useState(""),[S,R]=A.useState(""),[v,w]=A.useState(!1),[j,N]=A.useState(""),[x,h]=A.useState(!1),i=A.useRef(null),E=T(t),r=!!E.enabled,l=!!E.hasSystemCredentials,p=E.rootFolderId??"",C=E.bootstrappedAt,o=E.pendingProjects??[],I=E.configuredProjects??[];A.useEffect(()=>{!d&&t&&g(p)},[d,t,p]);const Q=A.useCallback(L=>{const a=L.target.files?.[0];if(!a)return;N(a.name);const y=new FileReader;y.onload=D=>{const n=D.target?.result;try{JSON.parse(n),R(n),h(!0),c.success("Service account JSON loaded")}catch{c.error("Invalid JSON file")}},y.readAsText(a),i.current&&(i.current.value="")},[]),B=A.useCallback(()=>{const L={enabled:r,rootFolderId:f.trim()};S&&(L.serviceAccountJson=S),m.mutate(L,{onSuccess:()=>{c.success("Configuration saved to Supabase vault"),R(""),N(""),h(!1)},onError:a=>c.error(a.message)})},[r,f,S,m]);if(d)return e.jsx(Z,{});const P=x||f!==p;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{title:"Google Drive Integration",subtitle:"Credentials stored encrypted in Supabase vault — never in .env"}),e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4"})," Connection Status"]}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",l&&r?"bg-green-500/15 text-green-400":"bg-red-500/15 text-red-400"),children:l&&r?"Connected":l?"Disabled":"Not Configured"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Service Account"}),e.jsx("span",{className:s("font-medium",l?"text-green-400":"text-red-400"),children:l?"Uploaded (encrypted)":"Not uploaded"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Root Folder"}),e.jsx("span",{className:s("font-mono text-[11px]",p?"text-[var(--gm-text-primary)]":"text-red-400"),children:p||"Not set"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Integration"}),e.jsx("span",{className:s("font-medium",r?"text-green-400":"text-[var(--gm-text-tertiary)]"),children:r?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Last Bootstrap"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] tabular-nums",children:C?new Date(C).toLocaleString():"Never"})]})]})]}),e.jsxs("div",{className:s(k,"p-5 space-y-5"),children:[e.jsx("h3",{className:s(_),children:"Configuration"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[var(--gm-text-primary)] font-medium",children:"Enable Integration"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5",children:"Activate Google Drive sync for all projects"})]}),e.jsx(xe,{checked:r,onChange:L=>m.mutate({enabled:L,rootFolderId:f||p},{onSuccess:()=>c.success(L?"Integration enabled":"Integration disabled"),onError:a=>c.error(a.message)}),disabled:m.isPending})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] flex items-center gap-1.5",children:[e.jsx(fe,{className:"w-3 h-3"})," Root Folder ID"]}),e.jsx("input",{type:"text",value:f,onChange:L=>{g(L.target.value),h(!0)},placeholder:"e.g. 1ABC2DEF3GHI4JKL5MNO6PQR...",className:s(F,"w-full font-mono text-[11px]")}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"The Google Drive folder ID where all project folders will be created. Find it in the Drive folder URL after /folders/."})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] flex items-center gap-1.5",children:[e.jsx(ht,{className:"w-3 h-3"})," Service Account JSON"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>i.current?.click(),className:z,children:[e.jsx(ut,{className:"w-3 h-3"})," Upload JSON File"]}),e.jsx("input",{ref:i,type:"file",accept:".json,application/json",onChange:Q,className:"hidden"}),j&&e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," ",j]}),!j&&l&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Credentials already stored (encrypted in Supabase vault)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:S,onChange:L=>{R(L.target.value),h(!0)},placeholder:"Or paste the service account JSON here...",rows:4,className:s(F,"w-full font-mono text-[10px] leading-relaxed resize-none",!v&&S?"text-transparent":"")}),S&&e.jsx("button",{onClick:()=>w(!v),className:"absolute top-2 right-2 p-1 rounded hover:bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:v?e.jsx(gt,{className:"w-3 h-3"}):e.jsx(Me,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Download from Google Cloud Console > IAM > Service Accounts > Keys. The JSON is encrypted at rest via pgcrypto."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-[var(--gm-border-primary)]",children:[e.jsxs("button",{onClick:B,disabled:m.isPending||!P,className:K,children:[m.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"}),"Save Configuration"]}),P&&e.jsxs("span",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Unsaved changes"]})]})]}),e.jsxs("div",{className:s(k,"p-5 space-y-4"),children:[e.jsx("h3",{className:s(_),children:"Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>u.mutate(void 0,{onSuccess:L=>{const a=T(L);c.success(a.message||"Bootstrap complete")},onError:L=>c.error(L.message)}),disabled:u.isPending||!l||!r,className:K,children:[u.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(fe,{className:"w-3 h-3"}),"Bootstrap All Projects"]}),e.jsxs("button",{onClick:()=>M.mutate(void 0,{onSuccess:()=>c.success("Sync started"),onError:L=>c.error(L.message)}),disabled:M.isPending||!l||!r,className:z,children:[M.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ne,{className:"w-3 h-3"}),"Sync Now"]})]}),!l&&e.jsxs("p",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Upload service account credentials to enable actions"]}),l&&!r&&e.jsxs("p",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Enable the integration to use these actions"]})]}),I.length>0&&e.jsxs("div",{className:s(k,"p-5"),children:[e.jsxs("h3",{className:s(_,"mb-3"),children:["Configured Projects (",I.length,")"]}),e.jsx("div",{className:"space-y-0",children:I.map((L,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 text-xs border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium",children:L.name}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)] font-mono text-[10px]",children:L.folderId})]},a))})]}),o.length>0&&e.jsxs("div",{className:s(k,"p-5"),children:[e.jsxs("h3",{className:s(_,"mb-3"),children:["Pending Projects (",o.length,")"]}),e.jsx("div",{className:"space-y-0",children:o.map((L,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 text-xs border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:L.name}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-amber-500/15 text-amber-400",children:"Pending"})]},a))})]})]})}function sa(){const{data:t}=Us(),{data:d}=zs(),{data:m,isLoading:M,refetch:u}=Gs(),f=Bs(),g=Ks(),S=Vs(),R=Hs(),[v,w]=A.useState({}),j=A.useRef(!1),N=T(t),x=T(T(d).config),h=T(m).projects??[];return A.useEffect(()=>{!j.current&&Object.keys(x).length>0&&(w({...x}),j.current=!0)},[x]),M?e.jsx(Z,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(W,{title:"Billing & Cost Control",subtitle:"Manage project balances, pricing, and cost limits"}),e.jsxs("div",{className:s(k,"p-5 space-y-3"),children:[e.jsx("h3",{className:_,children:"Exchange Rate (USD to EUR)"}),N.auto!=null&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-3 h-3 text-[var(--gm-accent-primary)]"}),e.jsx("span",{className:"text-xs text-[var(--gm-accent-primary)]",children:N.auto?"Automatic rate from API":"Manual rate"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-[var(--gm-accent-primary)]",children:"Current Rate: "}),e.jsx("span",{className:"text-lg font-bold text-[var(--gm-text-primary)] tabular-nums",children:String(N.currentRate??N.rate??"—")})]}),e.jsxs("div",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Source: ",String(N.source??"api")," · Updated: ",N.lastUpdated||N.updatedAt?new Date(N.lastUpdated||N.updatedAt).toLocaleString():"—"]}),!N.auto&&e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"Manual Rate"}),e.jsx("input",{type:"number",step:"0.0001",min:"0",defaultValue:Number(N.manualRate??N.currentRate??.92),onBlur:i=>S.mutate({auto:!1,manualRate:Number(i.target.value)},{onSuccess:()=>c.success("Manual rate saved"),onError:E=>c.error(E.message)}),className:s(F,"w-40")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>f.mutate(void 0,{onSuccess:()=>c.success("Rate refreshed"),onError:i=>c.error(i.message)}),disabled:f.isPending,className:z,children:[f.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ne,{className:"w-3 h-3"})," Refresh Rate"]}),e.jsxs("button",{onClick:()=>S.mutate({auto:!(N.auto??!0)},{onSuccess:()=>c.success("Exchange rate mode updated"),onError:i=>c.error(i.message)}),disabled:S.isPending,className:z,children:["Switch to ",N.auto?"Manual":"Automatic"]})]})]}),e.jsxs("div",{className:s(k,"p-5 space-y-3"),children:[e.jsx("h3",{className:_,children:"Global Pricing Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"Fixed Markup (%)"}),e.jsx("input",{type:"number",value:v.fixed_markup_percent??0,onChange:i=>w(E=>({...E,fixed_markup_percent:Number(i.target.value)})),className:s(F,"w-full")})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(O,"block mb-1"),children:"Period Type"}),e.jsxs("select",{value:v.period_type??"monthly",onChange:i=>w(E=>({...E,period_type:i.target.value})),className:s(F,"w-full"),children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"weekly",children:"Weekly"})]})]})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Applied when no tier matches"}),e.jsxs("button",{onClick:()=>g.mutate(v,{onSuccess:()=>c.success("Global pricing saved"),onError:i=>c.error(i.message)}),disabled:g.isPending,className:K,children:[g.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(q,{className:"w-3 h-3"})," Save Global Pricing"]})]}),e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:"Projects Billing"}),e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[h.length," projects · ",h.filter(i=>i.blocked).length," blocked · ",h.filter(i=>i.unlimited).length," unlimited"]})]}),e.jsxs("button",{onClick:()=>u(),className:z,children:[e.jsx(ne,{className:"w-3 h-3"})," Refresh"]})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["PROJECT","BALANCE","STATUS","KEY SOURCE","TOKENS (PERIOD)","COST (PERIOD)","ACTIONS"].map(i=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:i},i))})}),e.jsx("tbody",{children:h.map((i,E)=>{const r=i.key_sources??{},l=!!i.uses_own_keys,p=!!i.all_own_keys,C=Object.entries(r);return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs font-semibold text-[var(--gm-text-primary)]",children:i.name||i.project_name||i.project_id}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-secondary)] tabular-nums",children:i.unlimited_balance?"∞ Unlimited":`${i.balance_eur??i.balance??0} €`}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",i.is_blocked?"bg-red-500/15 text-red-400":i.unlimited_balance?"bg-green-500/15 text-green-400":"bg-blue-500/15 text-blue-400"),children:i.is_blocked?"BLOCKED":i.unlimited_balance?"UNLIMITED":"ACTIVE"})}),e.jsxs("td",{className:"px-4 py-2.5",children:[C.length===0?e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No keys"}):p?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-purple-500/15 text-purple-400 font-semibold",title:"BYOK: billing skipped",children:"BYOK"}):l?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-amber-500/15 text-amber-400 font-semibold",title:"Mixed: some own keys, some system keys",children:"MIXED"}):e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-500/15 text-blue-400 font-semibold",title:"Using system keys: billing active",children:"SYSTEM"}),C.length>0&&e.jsx("div",{className:"mt-0.5 flex flex-wrap gap-1",children:C.map(([o,I])=>e.jsxs("span",{className:s("text-[9px] px-1 py-px rounded",I==="project"?"bg-purple-500/10 text-purple-300":"bg-blue-500/10 text-blue-300"),children:[o,":",I[0]?.toUpperCase()]},o))})]}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:i.tokens_this_period!=null?`${(Number(i.tokens_this_period)/1e3).toFixed(1)}K`:"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:i.billable_cost_this_period!=null?`${Number(i.billable_cost_this_period).toFixed(2)} €`:"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>R.mutate({projectId:i.project_id||i.id,action:"block",data:{blocked:!i.is_blocked}},{onSuccess:()=>{c.success(i.is_blocked?"Unblocked":"Blocked"),u()},onError:o=>c.error(o.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:i.is_blocked?"Unblock":"Block",children:e.jsx(je,{className:"w-3.5 h-3.5 text-amber-400"})}),e.jsx("button",{onClick:()=>R.mutate({projectId:i.project_id||i.id,action:"unlimited",data:{unlimited:!i.unlimited_balance}},{onSuccess:()=>{c.success(i.unlimited_balance?"Limited":"Set unlimited"),u()},onError:o=>c.error(o.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:i.unlimited_balance?"Remove unlimited":"Set unlimited",children:e.jsx("span",{className:"text-[10px]",children:i.unlimited_balance?"∞":"$"})})]})})]},E)})})]}),h.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No projects found."})]})]})}function ta(){const[t,d]=A.useState(""),[m,M]=A.useState(""),[u,f]=A.useState(1),g=50,{data:S,isLoading:R}=Qs({page:u,limit:g,search:t||void 0,filter:m||void 0}),{data:v}=Js(),w=T(S),j=w.logs??[],x=T(v).logs??[],h=A.useMemo(()=>{const r=[...j,...x];return r.sort((l,p)=>{const C=new Date(l.changed_at||l.timestamp||l.created_at||"1970-01-01").getTime()||0;return(new Date(p.changed_at||p.timestamp||p.created_at||"1970-01-01").getTime()||0)-C}),r},[j,x]),i=w.total??h.length;if(R)return e.jsx(Z,{});const E=r=>r==="critical"||r==="error"?"bg-red-500/15 text-red-400":r==="warning"?"bg-amber-500/15 text-amber-400":"bg-blue-500/15 text-blue-400";return e.jsxs("div",{className:"space-y-5",children:[e.jsx(W,{title:"Audit Log"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(ve,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{placeholder:"Search...",value:t,onChange:r=>{d(r.target.value),f(1)},className:s(F,"flex-1")})]}),e.jsxs("select",{value:m,onChange:r=>{M(r.target.value),f(1)},className:s(F,"w-28"),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{className:s(k,"overflow-hidden"),children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["TIMESTAMP","USER","ACTION","DETAILS","SEVERITY","IP"].map(r=>e.jsx("th",{className:s(O,"px-4 py-2.5 text-left"),children:r},r))})}),e.jsx("tbody",{children:h.map((r,l)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums whitespace-nowrap",children:r.changed_at||r.timestamp||r.created_at?new Date(r.changed_at||r.timestamp||r.created_at).toLocaleString():"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs font-medium text-[var(--gm-text-primary)]",children:r.changed_by_email||r.user||r.actor||"System"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-secondary)]",children:r.action||r.operation||r.event_type||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] max-w-[200px] truncate",children:r.details||r.config_key||r.table_name||r.description||""}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",E(r.severity||r.level||"info")),children:r.severity||r.level||"info"})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] font-mono",children:r.ip||r.ip_address||""})]},l))})]}),h.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No audit log entries."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[i," entries"]}),i>g&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(r=>Math.max(1,r-1)),disabled:u<=1,className:z,children:"Previous"}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] self-center",children:["Page ",u]}),e.jsx("button",{onClick:()=>f(r=>r+1),disabled:h.length<g,className:z,children:"Next"})]})]})]})}function Aa(){const[t,d]=A.useState("users");return e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-48 shrink-0 border-r border-[var(--gm-border-primary)] bg-[var(--gm-bg-primary)] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-4 border-b border-[var(--gm-border-primary)]",children:[e.jsx(De,{className:"w-4 h-4 text-[var(--gm-accent-primary)]",style:{filter:"drop-shadow(0 0 6px var(--gm-accent-primary))"}}),e.jsx("span",{className:"text-sm font-bold text-[var(--gm-accent-primary)]",children:"Admin"})]}),e.jsx("nav",{className:"py-2",children:Ot.map(m=>{const M=m.icon,u=t===m.key;return e.jsxs("button",{onClick:()=>d(m.key),className:s("w-full flex items-center gap-2.5 px-4 py-2 text-xs transition-colors",u?"text-[var(--gm-accent-primary)] bg-[var(--gm-surface-hover)] font-semibold":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)]"),children:[e.jsx(M,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"flex-1 text-left",children:m.label}),u&&e.jsx(Oe,{className:"w-3 h-3 shrink-0"})]},m.key)})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx($t,{}),t==="users"&&e.jsx(Ft,{}),t==="system"&&e.jsx(Ut,{}),t==="llm-providers"&&e.jsx(Gt,{}),t==="model-metadata"&&e.jsx(Bt,{}),t==="llm-queue"&&e.jsx(Kt,{}),t==="graph"&&e.jsx(Ht,{}),t==="ontology"&&e.jsx(Qt,{}),t==="prompts"&&e.jsx(Jt,{}),t==="processing"&&e.jsx(Xt,{}),t==="team-analysis"&&e.jsx(qt,{}),t==="google-drive"&&e.jsx(ea,{}),t==="billing"&&e.jsx(sa,{}),t==="audit-log"&&e.jsx(ta,{})]})]})}export{Aa as default};
//# sourceMappingURL=AdminPage-0s-HPztV.js.map
