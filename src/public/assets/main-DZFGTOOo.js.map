{"version":3,"mappings":"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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCA4bc2mB,IAAe,UAAY,SAAW,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAOxCA,IAAe,OAAS,SAAW,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCAWpCA,IAAe,UAAY,SAAW,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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AA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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A;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UA2QZ82C,EAAgB,S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,OAAAggB,EAAM,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AA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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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","names":["ThemeService","saved","effective","fn","mode","modes","nextIndex","newTheme","callback","theme","defaultOptions","typeColors","showToast","message","type","options","opts","toast","success","error","warning","info","config","requestInterceptors","responseInterceptors","addRequestInterceptor","interceptor","index","api","path","attempt","url","finalOptions","timeoutMs","controller","timeoutId","response","data","retryAfter","sleep","errorMessage","extractErrorMessage","ApiError","result","fallback","obj","ms","resolve","status","details","http","body","configureApi","newConfig","getItem","key","defaultValue","item","setItem","value","removeItem","clear","hasItem","getKeys","storage","ShortcutService","shortcutStr","handler","description","parts","syntheticEvent","shortcut","event","target","shortcutOrKey","enabled","shortcuts","s","UndoService","action","undoManager","isUuid","v","persistedProjectId","persistedProject","validProjectId","validProject","initialState","state","listeners","notify","getState","subscribe","setCurrentProjectId","projectId","setCurrentProject","project","setCurrentUser","user","setAuthConfigured","configured","setConfig","setLoading","isLoading","setError","setOnline","online","reset","initAppStore","appStore","isInitialized","authCheckPromise","checkAuthStatus","checkSession","authUser","mapAuthUserToUser","initAuth","login","credentials","register","logout","forgotPassword","email","resetPassword","password","accessToken","refreshSession","requestLoginCode","verifyLoginCode","code","getOTPConfig","confirmEmail","resendConfirmation","profile","metadata","isAuthenticated","isAuthInitialized","getCurrentUser","onAuthRequired","triggerAuthRequired","auth","setQuestions","questions","setRisks","risks","setActions","actions","setDecisions","decisions","setFacts","facts","setContacts","contacts","setChatHistory","chatHistory","addChatMessage","setProjects","projects","clearChatHistory","dataStore","getProjects","getCurrentProject","createProject","updateProject","id","currentProject","deleteProject","activateProject","setDefaultProject","getProjectStats","exportProject","importProject","file","formData","initProjects","defaultProject","p","getDashboard","getStats","getTrends","days","getHealth","getInsights","getAlerts","loadDashboardData","dashboard","health","insights","alerts","dashboardService","getQuestions","filters","params","query","createQuestion","updateQuestion","deleteQuestion","reason","answerQuestion","getQuestionsByPerson","getQuestionsByTeam","suggestAssignee","reopenQuestion","dismissQuestion","deferQuestion","until","submitAnswerFeedback","wasUseful","feedback","getQuestionStats","now","sevenDaysAgo","q","questionsService","getRisks","getRisk","getDeletedRisks","restoreRisk","getRiskEvents","getRisksByCategory","createRisk","updateRisk","deleteRisk","calculateRiskScore","impact","likelihood","impactScores","likelihoodScores","suggestRisk","owners","getRiskMatrixData","matrix","r","risk","risksService","normalizeAction","row","getActions","createAction","payload","raw","updateAction","deleteAction","suggestAssignees","getActionEvents","isOverdue","getActionStats","a","actionsService","getDecisions","getDecision","getDeletedDecisions","restoreDecision","getDecisionEvents","decisionId","getSimilarDecisions","limit","runDecisionCheck","detectConflicts","suggest","content","rationale","suggestOwner","createDecision","updateDecision","deleteDecision","approveDecision","approvedBy","rejectDecision","decisionsService","sendMessage","request","m","userMessage","assistantMessage","ask","sotChat","getBriefing","refresh","getBriefingHistory","getWeeklyReport","generateExecutiveSummary","getChatHistory","addToHistory","chatService","getContacts","c","getContact","createContact","updateContact","deleteContact","getContactStats","findContactByName","name","getDuplicates","mergeContacts","contactIds","enrichContact","exportContacts","format","blob","getContactWithAssociations","addContactToProject","contactId","removeContactFromProject","getContactProjects","getTeams","getTeam","createTeam","updateTeam","deleteTeam","addTeamMember","teamId","role","isLead","removeTeamMember","contactsService","teamsService","uploadFiles","files","onProgress","xhr","reject","e","uploadWithExtraction","getProcessingStatus","getDocuments","statusOrOptions","queryString","getDocument","deleteDocument","restoreDocument","reprocessDocument","getDocumentSummary","getKnowledgeBase","category","addKnowledgeItem","searchKnowledge","getConversations","getConversation","parseConversationPreview","text","importConversation","deleteConversation","reembedConversation","bulkDeleteDocuments","ids","bulkReprocessDocuments","bulkExportDocuments","downloadBulkExport","documentsService","getKnowledgeStatus","exportKnowledgeMarkdown","exportKnowledgeJson","regenerateKnowledge","synthesizeKnowledge","topic","knowledgeService","conversationsService","getEmails","getEmail","getEmailThread","threadId","markAsRead","markAsUnread","starEmail","unstarEmail","archiveEmail","deleteEmail","sendEmail","draft","saveDraft","generateAIResponse","emailId","tone","generateSummary","categorizeEmail","getEmailStats","syncEmails","getById","getNeedingResponse","markResponded","generateResponse","emailsService","getVisualizationData","nodesResponse","edgesResponse","nodes","edges","getGraph","getEntityGraph","entityId","depth","getRelatedEntities","getOntologySchema","getOntologyEntities","getOntologyRelations","getOntologySuggestions","approveOntologySuggestion","suggestionId","rejectOntologySuggestion","getOntologyTypeStats","getOntologySyncStatus","forceOntologySync","runLLMAnalysis","autoApproveHighConfidence","threshold","getOntologyChanges","migrateOntologyToSupabase","getBackgroundWorkerStatus","triggerBackgroundAnalysis","getBackgroundWorkerLog","getOntologyJobs","toggleOntologyJob","jobId","extractOntologyFromGraph","validateOntologyCompliance","getOntologyDiff","findUnusedOntologyTypes","mergeOntology","cleanupOntology","getFalkorDBBrowserInfo","listAllFalkorDBGraphs","syncFalkorDBGraphs","dryRun","deleteFalkorDBGraph","graphName","getCommunities","getCentrality","getBridges","graphRAGQuery","streamGraphRAGQuery","onChunk","onComplete","onError","reader","decoder","fullResponse","done","lines","line","parsed","multiHopQuery","explainConnection","nodeId1","nodeId2","summarizeSelection","nodeIds","naturalLanguageFilter","filterText","suggestRelated","nodeId","executeCypher","cypher","getQueryTemplates","schema","pattern","getProjectGraphs","getCrossProjectEntities","entityType","saveQueryHistory","getQueryHistory","toggleQueryFavorite","queryId","deleteQueryHistory","saveView","view","getSavedViews","updateView","viewId","updates","deleteView","addBookmark","bookmark","getBookmarks","updateBookmark","bookmarkId","removeBookmark","createAnnotation","annotation","getAnnotations","updateAnnotation","annotationId","deleteAnnotation","saveChatMessage","getChatSessions","sessionId","toggleChatPin","messageId","createSnapshot","snapshot","getSnapshots","getSnapshot","snapshotId","compareSnapshots","snapshotId1","snapshotId2","deleteSnapshot","getTimeline","events","getEntityTimeline","getCosts","getCostSummary","period","normalized","d","getRecentCostRequests","getCostsPricing","getCostsBudget","limitUsd","alertThresholdPercent","setCostsBudget","getLLMConfig","graphService","timelineService","costsService","getNotifications","getUnreadCount","markAllAsRead","deleteNotification","getComments","addComment","parentId","updateComment","commentId","deleteComment","addReaction","emoji","removeReaction","createComment","resolveComment","getProjectMembers","inviteMember","updateMemberRole","memberId","removeMember","notificationsService","commentsService","getInvites","membersService","getUserSettings","updateUserSettings","settings","getProjectSettings","updateProjectSettings","getAPIKeys","createAPIKey","permissions","revokeAPIKey","getWebhooks","createWebhook","webhook","updateWebhook","deleteWebhook","testWebhook","getAuditLogs","exportAuditLogs","userSettingsService","projectSettingsService","apiKeysService","webhooksService","auditService","getProfile","updateProfile","currentUser","uploadAvatar","removeAvatar","changePassword","deleteAccount","getActivity","getSessions","revokeSession","revokeAllSessions","profileService","getFacts","getFact","createFact","updateFact","deleteFact","getDeletedFacts","restoreFact","verifyFact","runFactCheck","getFactsByCategory","grouped","fact","getFactsBySource","source","getFactsByDocument","documentId","getFactEvents","factId","getSimilarFacts","searchFacts","getFactStats","stats","f","factsService","getWebhook","regenerateWebhook","toggleWebhook","isActive","getTranscripts","getTranscriptsSummary","assignProject","transcriptId","skipTranscript","retryTranscript","processTranscript","getMappings","deleteMapping","mappingId","getQuarantinedTranscripts","getAvailableMeetings","importAvailableMeetings","meetingIds","generateAvailableMeetingSummary","meetingId","formatStatus","formatDuration","minutes","hours","mins","createElement","tag","attributes","children","el","on","element","addClass","classes","removeClass","createThemeToggle","container","button","updateButton","getThemeIcon","mountThemeToggle","selector","setTab","tab","setDevTab","setSotView","setSelectedPerson","person","toggleSidebar","setSidebarOpen","open","openModal","modalId","closeModal","setSearchQuery","toggleFilter","uiStore","createHeader","props","header","logoSection","actionsSection","projectSelector","createProjectSelector","themeToggle","userMenu","createUserMenu","mobileMenuBtn","onProjectChange","dropdown","projectName","isOpen","initials","n","updateDropdown","settingsBtn","shortcutsBtn","logoutBtn","closeDropdown","mountHeader","defaultTabs","adminTab","getTabsForUser","createTabButton","rebuildNavigation","nav","tabs","currentTab","createSidebar","sidebar","closeBtn","btn","initialActiveBtn","updateTabBadge","tabId","count","badge","mountSidebar","containerInstance","getToastContainer","position","positionStyles","createToastElement","duration","icons","colors","dismissToast","showToastInContainer","activeModals","createModal","title","size","closable","onClose","onOpen","footer","modal","modalContent","footerEl","closeAllModals","_","isModalOpen","updateModalContent","updateModalTitle","titleEl","confirm","confirmText","cancelText","confirmClass","cancelBtn","confirmBtn","alert","okBtn","prompt","placeholder","MODAL_ID","PERMISSION_CATEGORIES","ROLE_DEFAULTS","showMemberPermissionsModal","userId","userName","userEmail","avatarUrl","currentRole","onSave","selectedPermissions","existing","getInitials","escapeHtml","cat","roleSelect","defaults","updateCheckboxes","checkbox","updateItemStyles","checkboxes","allChecked","cb","input","saveBtn","selected","div","currentProps","projectMembers","projectRoles","projectConfig","projectContacts","showProjectModal","createModalContent","modalHeader","loadProjectData","renderCreateForm","card","projectRes","membersRes","rolesRes","configRes","contactsRes","contactsData","renderEditForm","bindCreateEvents","renderMembersList","renderRolesList","getConfigValue","bindEditEvents","member","isOwner","part","form","projectData","submitBtn","loadProjects","t","section","projectForm","descEl","deleteBtn","inviteBtn","inviteFirstBtn","showInviteModal","addRoleBtn","showAddRoleDialog","select","newRole","membersList","bindMemberEvents","gdriveTestBtn","gdriveBootstrapBtn","getProjectId","loadGoogleDriveSettings","res","enabledEl","rootFolderEl","configForm","showEditUserRoleDialog","existingDialog","dialog","closeDialog","enhanceBtn","nameInput","contextInput","descInput","roleName","roleContext","loadProjectRoles","rolesGrid","overlay","customInput","promptTextarea","selectedOption","isCustom","roleSelectValue","userRole","userRolePrompt","linkedContactId","memberIndex","contact","handleEscape","showInvite","__vitePreload","InviteModal","initProjectSelector","newBtn","editBtn","loadProjectsIntoSelector","selectProject","updateSelectorOptions","projectList","currentProjectId","currentValue","option","onChange","wrapper","defaultOption","formatNumber","locale","formatDate","date","formatDateTime","formatRelativeTime","diffMs","diffSec","diffMin","diffHour","diffDay","futureDays","yesterday","isSameDay","startOfWeek","getStartOfWeek","startOfLastWeek","d1","d2","day","formatFileSize","bytes","units","i","formatCurrency","currency","createDashboard","loadFullDashboard","healthSection","briefingSection","statsGrid","overdueSection","alertsSection","insightsSection","riskSummaryContainer","goldenHoursSection","createBtn","ProjectModal","createBriefingPanel","BriefingPanel","briefingPanel","err","renderHealthIndicator","renderStatsGrid","renderOverdueActionsAlert","renderAlerts","renderInsights","renderQuestionsPriorityChart","renderFactsChart","renderWeeklyTrendsChart","renderRiskSummary","loadGoldenHours","statusClass","score","color","factors","onClick","qPriority","rImpact","factsVerified","stat","statId","getAlertIcon","onAction","insight","getSeverity","impactLevel","likelihoodLevel","activeRisks","counts","severity","total","mitigated","getPercent","conicStops","currentDeg","level","degrees","byCat","categories","sum","pct","critical","high","medium","resolved","trendsData","history","trends","entry","maxValue","overdueCount","viewBtn","getLocalTimeInfo","timezone","localTime","localHour","isOnline","findBestMeetingTimes","entries","suggestions","hour","available","totalScore","formatter","utcHour","offset","theirHour","b","members","linkedContactIds","memberEntries","linkedContact","tz","timeInfo","contactEntries","memberGolden","calculateGoldenHours","contactGolden","deduplicatedContactEntries","allEntries","allGolden","meetingSuggestions","onlineMembers","onlineContacts","onlineDeduplicatedContacts","onlineAll","escapeHtmlSimple","renderTimezoneChart","renderGoldenSummary","teamSuggestions","contactSuggestions","uniqueTimezones","offsets","overlapStart","overlapEnd","workStartUtc","workEndUtc","firstOffset","golden","tzCounts","uniqueTzs","h","workStart","workEnd","workLeft","workWidth","displayTz","formatHour","maxAvatars","showEntries","moreCount","str","mountDashboard","createChat","showSessions","chat","currentSessionId","sessions","newChatBtn","newChatContextWrap","newChatContextLabel","newChatContextSelect","sessionsList","mainArea","chatContainer","chatHeader","contextLabel","contextSelect","loadContacts","renderContextSelect","currentContextId","renderNewChatContextSelect","onContextChange","idx","messagesContainer","inputContainer","sendBtn","handleSend","loadSessions","renderSessionsList","selectSession","loadMessages","msgs","msg","renderMessage","createNewSession","contextContactId","session","loadingEl","scrollToBottom","quickPrompts","showSources","msgEl","metaEl","confidenceClass","metaHtml","methodLabel","totalSources","sourcesEl","sources","contactSources","topSources","pillsEl","mountChat","currentQuestion","createQuestionDetailView","question","onUpdate","onNavigateToQuestion","renderEntities","renderExistingAnswer","bindEvents","loadChain","loadSimilar","loadTimeline","entities","topics","getScoreColor","renderProvenance","provenance","backLink","aiSuggestBtn","loadAISuggestions","checkAnswersBtn","checkPotentialAnswers","saveAnswerBtn","saveAnswer","reopenBtn","dismissBtn","dismissMenu","reasonLinks","link","dismissQuestionWithReason","deferBtn","showDeferDialog","undeferBtn","feedbackYes","feedbackNo","submitFeedback","toggleEditMode","assigneeSelect","answeredBySelect","contactList","contactSearch","otherOption","renderContactGrid","filtered","updateAssignedDisplay","bindPickerButtons","setupAnswererPicker","setupSourceOptions","showBtn","answererList","answererSearch","answererOtherInput","renderAnswererList","filter","photoUrl","contactName","selectAnswerer","clearBtn","display","opt","contactsToRender","isCurrentAssignee","picker","showPickerBtn","changeBtn","searchInput","questionId","onNavigate","chainContent","parent","html","child","similarContent","similar","timelineContent","icon","getEventIcon","getEventDescription","eventType","panel","showAllBtn","roleDisplay","scoreColor","selectBtn","suggestion","hideBtn","timeoutMessage","retryBtn","answersDiv","potentialAnswers","answerInput","sourceSelect","followupInput","answer","answeredByContactId","followupQuestions","answeredByName","updated","untilInput","reasonInput","feedbackBtns","currentSuggestions","showQuestionModal","onDismiss","renderQuestionView","createFooterButtons","getModalTitle","onDelete","handleCreate","handleEdit","handleDismiss","handleAnswer","answerBtn","handleReopen","suggestBtn","loadAssigneeSuggestions","showAnswerField","suggestionsContainer","assigneeInput","getValue","newQuestion","Modal","currentFilter","currentView","createQuestionsPanel","filterSelect","loadQuestions","viewTabs","addBtn","generateBtn","showGenerateForTeamDialog","updateCount","renderByStatus","renderGrouped","slaHours","created","deadline","createQuestionCard","bindCardEvents","groups","groupName","allQuestions","qs","priorityClass","slaBreached","autoDetected","hasAnswer","hasRequesterRole","getPhotoUrl","renderAvatar","cssClass","requesterName","requesterRole","requesterContactId","requesterPhotoUrl","assigneePhotoUrl","showQuestionDetailView","containerEl","panelContent","detailView","updatedQuestion","targetQuestion","currentSource","selectedRole","allRoles","questionCount","configSection","selectedBadge","genOverlay","genContent","getRoleIcon","loadRoles","roles","roleMap","showConfig","generateQuestions","countVal","countEl","createSourceOfTruth","panels","questionsPanel","createFullQuestionsPanel","risksPanel","createRisksPanel","actionsPanel","createActionsPanel","decisionsPanel","createDecisionsPanel","questionsBadge","risksBadge","actionsBadge","decisionsBadge","renderQuestions","renderRisks","renderActions","renderDecisions","initialView","initialTab","initialPanel","list","showQuestionDetail","originalContent","propsOrCallback","decision","mountSourceOfTruth","sot","showRiskModal","isEdit","isView","riskDesc","riskProb","riskCreated","riskOwner","impactEl","probEl","contentText","ownerEl","mitigationEl","desc","owner","riskData","iso","getRiskEventIcon","getRiskEventDescription","ev","actor","changes","toStr","fromStr","createRiskDetailView","viewContent","editForm","cancelEditBtn","contentEl","likelihoodEl","statusEl","deleteInEditBtn","ownerPickerTrigger","ownerPickerDropdown","ownerPickerValue","ownerHiddenInput","ownerPickerList","ownerPickerSearch","editFormContacts","renderOwnerPickerList","editAiSuggestBtn","editSuggestionsPanel","mitigation","roleOrReason","assignBtn","applyMitigationBtn","lastMitigation","suggestionsPanel","docLink","timelineEl","viewContacts","riskContactPicker","riskContactList","riskContactSearch","renderRiskContactGrid","getContactPhotoUrl","showRiskPicker","changeOwnerBtn","findContactByOwner","byExact","byPartial","byAlias","aLower","u","roleEl","avatarEl","img","riskDetailProps","updatedRisk","currentSearch","showMatrix","lastLoadedRisks","loadRisks","searchTimeout","matrixBtn","matrixContainer","risksToShow","renderRiskMatrix","refreshRemovedSection","deleted","truncate","restoreBtn","len","filterRisksBySearch","lower","renderRisksBySource","byStatus","statuses","createRiskCard","bindRiskCards","bySource","src","IMPACT_BAR_COLOR","barColor","ownerChipHtml","sourceChip","taskText","dueDateText","createdText","showActionModal","due","completeBtn","getActionEventIcon","getActionEventDescription","createActionDetailView","task","assignee","assigneePickerTrigger","assigneePickerDropdown","assigneePickerValue","assigneeHiddenInput","assigneePickerList","assigneePickerSearch","renderAssigneePickerList","editAssigneeHiddenInput","editAssigneePickerValue","suggested_assignees","findContactByAssignee","taskEl","priorityEl","assigneeEl","dueEl","doDelete","docId","actionContactPicker","actionContactList","actionContactSearch","renderActionContactGrid","showActionPicker","actionDetailProps","updatedAction","loadActions","priorityBarColor","priority","assigneeChipHtml","dueChip","viewLink","showDecisionModal","viewImpact","viewSummary","modalContacts","renderMadeByDisplay","madeBy","madeByDisplay","madeByInput","chooseBtn","showModalPicker","modalPicker","renderModalContactGrid","modalContactSearch","modalContactList","currentMadeBy","decisionContent","decisionImpact","decisionSummary","hintEl","getVal","approveBtn","rejectBtn","updateStatus","decisionData","apiPayload","createDecisionDetailView","onDecisionClick","renderEditFormOwnerDisplay","currentOwnerName","rationaleEl","summaryEl","madeByEl","viewContentText","viewRationale","statusBadge","badges","impactPill","oldPill","currentOwnerEl","chBtn","showOwnerPicker","ownerPicker","ownerList","ownerSearch","renderOwnerContactGrid","currentEl","showOwnerPickerBtn","editOwnerDisplay","editMadeByInput","editContactPicker","editContactList","editContactSearch","showEditOwnerPicker","renderEditFormContactGrid","ownerAiSuggestBtn","ownerSuggestionsPanel","suggested_owners","rationaleAiSuggestBtn","applyBtn","labels","actorLabel","similarEl","decisionDetailProps","clickedDecision","loadDecisions","checkConflictsBtn","checkConflicts","conflicts","createConflictCard","bindConflictCards","keepId","discardId","filterDecisionsBySearch","renderDecisionsBySource","createDecisionCard","bindDecisionCards","STATUS_BAR_COLOR","createFactDetailView","onFactClick","verifyFactBtn","verifyBtn","showFactModal","FactModal","CATEGORIES","factDetailProps","createFactsPanel","clickedFact","loadFacts","conflictsBtn","showAddFactModal","categoryFilter","rawFacts","renderFactsBySource","renderFacts","refreshRemovedFactsSection","conflictsContainer","emptyAddBtn","factsByCategory","catFacts","createFactCard","newPanel","CATEGORY_BAR_COLOR","categoryClass","confidencePct","renderConflicts","conflict","keepLeftBtn","keepRightBtn","resolveConflict","keep","toDelete","toKeep","max","createStatsCard","trendHtml","getTrendArrow","direction","updateStatsCard","subValue","valueEl","subEl","createStatsGrid","grid","createHealthIndicator","showFactors","indicator","createHealthBadge","getHealthColor","getHealthStatus","METRIC_COLORS","createTrendChart","metrics","height","canvas","initChart","renderFallbackChart","Chart","datasets","metric","capitalize","dateStr","IMPACTS","LIKELIHOODS","CELL_COLORS","createRiskMatrix","onCellClick","groupRisksByCell","l","cellRisks","cell","createRiskSummary","summary","bySeverity","fileQueue","createFileUploader","allowedTypes","maxFileSize","multiple","uploader","dropzone","fileInput","queueContainer","actionsContainer","statusContainer","addFilesToQueue","updateQueueUI","uploadBtn","checkProcessingStatus","maxSize","qf","getFileIcon","pendingFiles","progress","pollProcessingStatus","renderProcessingStatus","pollingInterval","mimeType","NODE_COLORS","createKnowledgeGraph","initGraph","graphContainer","statsContainer","loadStats","network","createVisNetwork","bindToolbarEvents","visNodes","getNodeSize","visEdges","node","showNodeDetails","connections","matchingNode","refreshBtn","fitBtn","detailsContainer","renderStats","createTimeline","daysSelect","filterBtns","filterEvents","renderTimeline","groupByDate","dayEvents","formatTime","visibleEvents","EVENT_TYPES","DAY_PERIODS","currentDays","currentDensity","currentTypeFilters","allEvents","focusedEventIndex","createTimelinePanel","renderSkeletons","periodSelect","densityBtns","updateDensity","renderFilteredEvents","exportBtn","showExportMenu","navigateEvents","selectFocusedEvent","clearEventFocus","endDate","startDate","updateTypeCounts","renderError","renderEmptyState","today","formatDateLabel","renderEventCard","bindEventCardClicks","time","relativeTime","fullDateTime","typesWithEvents","chips","chip","allChip","cards","targetCard","menu","exportTimeline","closeHandler","filename","headers","rows","thisWeekStart","todayStr","yesterdayStr","maxLength","getAllProjectsBilling","getGlobalPricingConfig","setGlobalPricingConfig","getGlobalPricingTiers","setGlobalPricingTiers","tiers","getProjectBillingSummaryAdmin","getProjectBalance","creditProjectBalance","amount","setProjectUnlimited","unlimited","getBalanceTransactions","getProjectPricingOverride","setProjectPricingOverride","deleteProjectPricingOverride","getProjectBillingSummary","formatEur","formatTokens","getTierDisplayInfo","tier","prevLimit","getExchangeRateConfig","setExchangeRateMode","auto","manualRate","refreshExchangeRate","billingService","billingSummary","BUDGET_MODAL_ID","createCostsDashboard","loadCosts","handleExport","pricingBtn","pricingPanel","togglePricingPanel","budgetBtn","showBudgetModal","recentRequests","billing","renderCosts","periodRangeEl","formatPeriod","dailyBreakdown","byProvider","byModel","totalCalls","avgPerCall","byProviderArray","provider","cost","byModelArray","model","byOperationMap","op","byOperationArray","operation","byContextArray","ctx","totalInput","totalOutput","hasNoData","periodChangeHtml","budgetHtml","emptyStateHtml","billingBannerHtml","balanceDisplay","renderDailyChart","o","renderRecentRequests","requests","formatRequestTime","ext","pricing","renderPricingTable","budgetPeriod","currentLimit","currentThreshold","budget","limitEl","thresholdEl","thresholdRaw","skeletonDailyForPeriod","daily","chartDaily","maxCost","isPlaceholder","formatDateShort","start","end","currentQuery","selectedIndex","results","TYPE_ICONS","initGlobalSearch","createSearchModal","toggleSearch","backdrop","resultsContainer","closeSearch","debounceSearch","handleKeydown","openSearch","updateSelection","selectResult","performSearch","renderResults","performLocalSearch","groupByType","items","navigateToResult","selectedIds","createBulkActionsBar","bar","getActionsForType","clearSelection","updateBar","bindActionButtons","common","performBulkAction","endpoint","toggleSelection","selectItem","deselectItem","getSelectedIds","isSelected","createBulkCheckbox","createSyncStatus","isVisible","loadSyncDetails","checkSyncStatus","updateIndicator","infoContainer","deadLettersContainer","deadLetters","dl","createSyncIndicator","checkMiniStatus","dot","showSettingsModal","currentTheme","modalOverlay","bindSettingsEvents","targetSection","themeSelect","currentSteps","cancelCallback","showProcessingModal","steps","onCancel","allowCancel","renderContent","createFooter","step","renderStep","calculateOverallProgress","statusIcon","completed","running","runningProgress","closeProcessingModal","updateProcessingStep","stepId","stepIndex","addProcessingStep","setProcessingSteps","isProcessingModalOpen","currentMode","otpEmail","resendCooldown","resendTimer","showAuthModal","renderAuthContent","getTitle","firstInput","renderLoginForm","renderRegisterForm","renderForgotForm","renderResetForm","renderOTPRequestForm","renderOTPVerifyForm","renderEmailConfirmForm","handleLogin","bindModeLinks","passwordInput","updatePasswordStrength","handleRegister","handleForgot","handleReset","handleOTPRequest","maskedEmail","inputs","hiddenInput","resendBtn","setupOTPInputs","startResendCooldown","handleResendCode","handleOTPVerify","handleEmailConfirm","updateHiddenValue","digits","inp","digit","errorEl","setFormLoading","hideError","showError","responseData","username","displayName","loading","btnText","btnLoading","elementId","strengthEl","strength","calculatePasswordStrength","closeAuthModal","currentContact","contactProjects","contactRelations","contactActivity","allProjects","roleTemplates","showContactModal","loadContactData","loadRoleTemplates","loadAllProjects","loadTimezones","hasPhoto","projectsRes","relationsRes","activityRes","allProjectsRes","timezonesRes","timezones","renderTimezoneDropdown","renderRoleDropdown","renderProjectsList","renderRelationsList","renderActivityTimeline","updateTabCounts","tzSelect","currentTz","region","sortedRegions","isCustomRole","listContainer","associatedIds","relation","formatRelationType","timeline","activity","projectsCount","relationsCount","customRoleInput","tagsInput","tags","aliasesInput","aliases","contactData","selectedProjects","savedContactId","enrichBtn","addRelationBtn","showAddRelationDialog","orgInput","headerName","headerOrg","avatar","span","avatarUrlInput","avatarContainer","currentName","parentContainer","availableContacts","contactSelect","typeSelect","toContactId","relationType","diffDays","currentMembers","showTeamModal","onInvite","onRemove","onRoleChange","renderMembers","renderMemberCard","removeBtn","isSuperadmin","cachedMembers","onInviteSent","activeTab","selectedContact","btnAddDirect","btnSendInvite","generateInviteLink","tabBtns","copyBtn","linkInput","loadProjectMembers","onSelect","listEl","hasEmail","subtitle","defaultPermissions","showRoleModal","availablePermissions","formatPermission","rolePermissions","selectAll","selectNone","roleData","permission","word","showExportModal","defaultFormat","defaultScope","group","radio","scope","performExport","getContentType","createBlob","getExtension","uploadQueue","isUploading","showFileUploadModal","accept","onUpload","render","renderFileItem","bindDropZone","bindFileItems","dropZone","addFiles","dt","fileId","rerender","showDeveloperModal","renderTabContent","bindActions","renderInfoTab","renderLogsTab","renderCacheTab","renderApiTab","appState","dataState","uiState","getMemoryUsage","keys","totalSize","acc","formatBytes","testApi","method","bodyText","responseEl","elapsed","perf","k","sizes","shortcutGroups","showShortcutsModal","registeredShortcuts","notifications","showNotificationsModal","markAllBtn","unreadCount","renderNotification","notification","getNotificationIcon","showEmailModal","onSend","isReply","replyTo","replySubject","zone","preview","replyBtn","forwardBtn","to","cc","subject","emailData","registerChart","chart","getChart","destroyChart","instance","updateChartData","registerNetwork","getNetwork","destroyNetwork","setActiveChart","getChartIds","getNetworkIds","destroyAll","chartsStore","showGraphModal","onNodeClick","onEdgeClick","getUniqueTypes","getTypeColor","initializeGraph","bindControls","vis","edge","types","page","hasMore","showHistoryModal","onRestore","loadHistory","renderEntry","loadMoreBtn","entryId","changesEl","actionIcons","actionColors","hasChanges","field","change","formatValue","comments","showCommentModal","entityName","onCommentAdded","renderComment","bindCommentActions","comment","isAuthor","findComment","replyContainer","replyInput","textarea","originalText","newText","removeComment","found","currentProfile","cachedTimezones","showProfileModal","loadProfile","apiProfile","renderProfile","generateFallbackAvatar","generateTimezoneOptions","loadKrispIntegration","avatarInput","avatarDisplay","profileForm","passwordForm","currentPassword","newPassword","confirmPassword","deleteAccountBtn","revokeAllBtn","regionOrder","aIdx","bIdx","label","diff","isSuperAdmin","krispService.getWebhook","krispService.getTranscriptsSummary","enableBtn","toggleSecretBtn","secretInput","mcpImportBtn","showKrispManager","toggleBtn","newState","krispService.toggleWebhook","regenerateBtn","krispService.regenerateWebhook","viewTranscriptsBtn","closeProfileModal","isViewMode","savedFact","verifiedFact","closeFactModal","showConversationPreviewModal","conversation","tabName","loadExtractionData","handleEsc","meta","extraction","entitiesContainer","entitiesCount","extractionContainer","extractionCount","totalItems","notesContainer","notesTab","notesText","renderNotesAsHtml","outline","currentTopic","bulletsHtml","headerDone","metaDone","flushTopic","trimmed","bulletText","showEmailPreviewModal","hasExtraction","getSentimentEmoji","sentiment","currentBriefing","showHistory","loadBriefing","historyBtn","historyContainer","briefing","renderBriefing","renderMarkdown","historyItem","showHistoryDetail","backBtn","currentReport","currentType","createReportsPanel","loadReport","exportMdBtn","exportReport","exportPdfBtn","report","renderReport","markdown","downloadFile","exportToPdf","html2pdf","tempDiv","allContacts","selectedContactIds","createContactsPanel","checkDuplicates","orgFilter","tagFilter","favoritesChip","importBtn","filteredContacts","renderContacts","renderFavorites","updateFilters","createContactCard","bindContactCardEvents","updateSelectionBar","toggleFavorite","existingBar","mergeBtn","selectedContacts","showMergeConfirmModal","detail","close","newValue","svg","favorites","alertsContainer","duplicates","reviewBtn","showDuplicatesReviewModal","duplicateGroups","groupIndex","alias","closeOverlay","closeReviewBtn","primaryId","orderedIds","groupEl","orgs","currentOrg","org","allTags","uniqueTags","currentTag","createTeamsPanel","loadTeams","teams","renderTeams","team","createTeamCard","memberCount","leadMember","getVisOrgChart","createOrgChart","loadOrgChart","chartContainer","buildOrgData","renderVisNetwork","levels","reportsTo","managerLevel","rel","byOrg","currentStatus","currentSort","currentViewMode","selectedDocuments","allDocuments","createDocumentsPanel","bindPanelEvents","loadDocuments","FileUploadModal","newSearch","renderFilteredDocuments","bulkDelete","bulkExport","bulkReprocess","renderDocumentsGrid","documents","doc","createDocumentCard","currentIndex","iconClass","getIconClass","getDocumentIcon","factsCount","decisionsCount","risksCount","entitiesLabel","showLoadingOverlay","spinner","hideLoadingOverlay","setBulkButtonsDisabled","disabled","createKnowledgePanel","exportKnowledge","exportJsonBtn","synthesizeBtn","synthesizeFacts","loadStatus","renderStatus","showConversationComposer","createConversationComposer","closeConversationComposer","renderPasteMode","renderMode","handlePreview","handleImport","bindPasteMode","renderUploadMode","previewBtn","hasContent","bindUploadMode","selectedFile","selectFile","getContent","previewArea","formatSelect","createConversationsPanel","showImportDialog","loadConversations","conversations","renderConversations","conv","createConversationCard","fullConv","reembedBtn","currentDirection","showNeedsResponse","createEmailsPanel","directionFilter","loadEmails","needsResponseFilter","createEmailComposer","showEmailComposer","EmailComposer","emails","renderEmails","createEmailCard","fullEmail","respondedBtn","directionIcon","needsResponse","getPreview","cleaned","closeEmailComposer","saveEmail","renderManualMode","bindManualMode","handleFileSelect","checkValidity","from","fileToBase64","base64","createNotificationsDropdown","trigger","toggleDropdown","loadNotifications","updateBadge","loadUnreadCount","renderNotifications","getIcon","initNotificationsDropdown","createCommentsThread","submitComment","loadComments","renderComments","thread","topLevel","replies","repliesByParent","bindCommentEvents","isOwn","replyForm","createMembersPanel","loadMembers","loadPendingInvites","invites","invite","createApiKeysPanel","showCreateKeyModal","loadApiKeys","renderApiKeys","expirySelect","scopeCheckboxes","scopes","showNewKeyModal","AVAILABLE_EVENTS","createWebhooksPanel","showWebhookModal","loadWebhooks","renderWebhooks","webhooks","w","urlInput","activeCheckbox","eventCheckboxes","currentFilters","currentPage","PAGE_SIZE","createAuditPanel","filterBtn","loadAuditLogs","showExportWizard","renderAuditLogs","renderPagination","logs","log","getActionClass","showDetailsModal","totalPages","prevBtn","nextBtn","fromDate","toDate","includeCheckboxes","include","ROLE_CATEGORIES","currentRoles","editingRole","renderRolesPanel","showRoleEditor","categoryMap","roleId","editorEl","isNew","bindEditorEvents","aiBtn","isTemplate","ontologyEntities","ontologyRelations","ontologyLoaded","ontologyLoading","graphList","graphStatus","graphOverviewLoaded","graphOverviewLoading","graphPasswordSet","currentSection","systemConfig","providers","auditLogs","systemPrompts","teamAnalysisSettings","teamAnalysisLoaded","teamAnalysisLoading","billingProjects","globalPricingConfig","globalPricingTiers","exchangeRateConfig","billingLoaded","billingLoading","loadSystemConfig","perTask","loadSecrets","loadProviders","defaultProviders","apiProviders","defaultsById","base","loadSystemPrompts","loadOntologyData","entitiesRes","loadGraphOverview","listRes","statusRes","saveConfig","testProvider","providerId","models","configs","graphConfigEntry","renderNav","renderLLMSection","taskTypes","taskConfig","descs","providerOpts","providerNames","renderGraphSection","graphConfig","g","renderOntologySection","renderPromptsSection","extractionPrompts","analysisPrompts","templatePrompts","renderPromptCard","renderStorageSection","rootFolderId","renderProcessingSection","processing","loadTeamAnalysisSettings","saveTeamAnalysisSettings","access","renderTeamAnalysisSection","renderQueueSection","loadBillingData","tiersData","exchangeRate","renderBillingSection","renderAuditSection","renderModelsSection","renderSectionContent","bindSectionEvents","newSection","renderAdminPanel","inputId","modelsCache","loadModelsForProvider","taskType","modelSelect","loadingSpan","statusDiv","saveLLMBtn","taskConfigs","loadApiKeysStatus","secret","formGroup","statusSpan","saveKeysBtn","savedCount","saveServiceKeysBtn","resendKey","gdriveEnabledBtn","next","loadGoogleDrivePlatformStatus","rootEl","enabledBtn","statusBox","projList","projBox","gdriveJsonFile","gdriveSaveBtn","jsonTxt","gdriveBootstrapAllBtn","loadQueueStatus","statusContent","itemsContent","pendingCount","dbStatusBadge","statusColor","statusText","pendingLen","db","statPending","statProcessing","statSuccess","statFailed","statRetry","statAvgTime","statCost","loadQueueHistory","historyContent","showRequestDetails","requestId","req","formatJsonHtml","json","formatPromptText","statusInfo","inputData","messages","promptText","existingModal","loadFailedItems","failedContent","refreshStatusBtn","refreshHistoryBtn","refreshFailedBtn","retryAllBtn","successCount","pauseBtn","resumeBtn","cancelId","retryId","retryResetBtn","retryResetId","loadMetadataSyncStatus","countsDiv","syncAllBtn","resultDiv","browseModelsBtn","providerSelect","contentDiv","textModels","visionModels","embeddingModels","saveGraphBtn","graphConfigValue","testGraphBtn","testConfig","loadGraphOverviewBtn","refreshGraphOverviewBtn","openGraphTabBtn","loadOntologyBtn","reloadOntologyBtn","savePromptsBtn","promptElements","reloadPromptsBtn","historyDiv","listDiv","versions","currentVersion","promptKey","versionStr","version","template","previewModal","saveProcBtn","saveTeamAnalysisBtn","exchangeRateAutoCheckbox","isAuto","manualGroup","refreshRateBtn","rateDisplay","sourceDisplay","saveExchangeRateBtn","saveGlobalPricingBtn","fixedMarkup","periodType","addTierBtn","limitInput","saveTiersBtn","limitValue","markup","refreshBillingBtn","isUnlimited","refreshAuditBtn","initAdminPanel","createHistoryPanel","bindFilters","actionFilter","entityFilter","dateFromInput","dateToInput","applyFilters","renderHistory","getActionVerb","formatFieldName","itemDate","dateLabel","exportHistory","questionsRes","risksRes","actionsRes","decisionsRes","undo","redo","initLegacyBridge","registerShortcuts","configureApiClient","initializeUI","updateThemeButton","userAvatar","userDropdown","loginBtn","components.showAuthModal","updateAuthUI","refreshData","updateDashboard","components.showSettingsModal","components.showShortcutsModal","devToolsBtn","components.showDeveloperModal","profileBtn","notificationsContainer","switchTab","sotTabs","loadSotContent","menuToggle","newContactBtn","components.showContactModal","components.showFileUploadModal","initializeSidebarActions","newProjectBtn","editProjectBtn","showNoProjectState","components.showProjectModal","contactsSubtabs","subtab","refreshDashboardBtn","initializePanels","initializeDropZones","dashboardContainer","refreshDashboardPanel","Dashboard","Chat","emailsContainer","EmailsPanel","contactsContainer","ContactsPanel","teamsContainer","TeamsPanel","rolesContainer","RolesPanel","filesContainer","DocumentsPanel","showDocumentPreviewModal","orgChartContainer","OrgChart","costsContainer","CostsDashboard","HistoryPanel","dropzones","ConversationComposer","showTranscriptComposer","handleDroppedFiles","dataTransfer","addPendingFiles","fileNames","VALID_TABS","getTabFromUrl","match","updateUrlForTab","replace","newPath","initRouting","updateUrl","adminContainer","AdminPanel","createGraphExplorer","explorer","timelineContainer","TimelinePanel","createQuestionDetailView2","QuestionDetailView","DecisionDetailView","FactDetailView","RiskDetailView","ActionDetailView","teamAnalysisContainer","createTeamAnalysis","setupTeamAnalysisSubtabs","teamAnalysisStore","firstOrDefault","dashboardContent","activeQuestions","factsPanel","updatePendingFilesUI","processBtn","exportKnowledgeBtn","knowledge","exportKnowledgeClipboard","exportQuestionsBtn","exportQuestionsClipboard","copyOverdueBtn","overdueActions","dueDate","overdueQuestions","createdAt","overdue","cleanOrphanBtn","components.confirm","resetDataBtn","init","authBlocker","adminNavBtn","fallbackAvatar","components"],"ignoreList":[],"sources":["../../frontend/services/theme.ts","../../frontend/services/toast.ts","../../frontend/services/api.ts","../../frontend/services/storage.ts","../../frontend/services/shortcuts.ts","../../frontend/services/undo.ts","../../frontend/stores/app.ts","../../frontend/services/auth.ts","../../frontend/stores/data.ts","../../frontend/services/projects.ts","../../frontend/services/dashboard.ts","../../frontend/services/questions.ts","../../frontend/services/risks.ts","../../frontend/services/actions.ts","../../frontend/services/decisions.ts","../../frontend/services/chat.ts","../../frontend/services/contacts.ts","../../frontend/services/documents.ts","../../frontend/services/emails.ts","../../frontend/services/graph.ts","../../frontend/services/notifications.ts","../../frontend/services/settings.ts","../../frontend/services/profile.ts","../../frontend/services/facts.ts","../../frontend/services/krisp.ts","../../frontend/utils/dom.ts","../../frontend/components/ThemeToggle.ts","../../frontend/stores/ui.ts","../../frontend/components/Header.ts","../../frontend/components/Sidebar.ts","../../frontend/components/Toast.ts","../../frontend/components/Modal.ts","../../frontend/components/modals/MemberPermissionsModal.ts","../../frontend/components/modals/ProjectModal.ts","../../frontend/components/ProjectSelector.ts","../../frontend/utils/format.ts","../../frontend/components/Dashboard.ts","../../frontend/components/Chat.ts","../../frontend/components/questions/QuestionDetailView.ts","../../frontend/components/modals/QuestionModal.ts","../../frontend/components/sot/QuestionsPanel.ts","../../frontend/components/SourceOfTruth.ts","../../frontend/components/modals/RiskModal.ts","../../frontend/components/risks/RiskDetailView.ts","../../frontend/components/sot/RisksPanel.ts","../../frontend/components/modals/ActionModal.ts","../../frontend/components/actions/ActionDetailView.ts","../../frontend/components/sot/ActionsPanel.ts","../../frontend/components/modals/DecisionModal.ts","../../frontend/components/decisions/DecisionDetailView.ts","../../frontend/components/sot/DecisionsPanel.ts","../../frontend/components/facts/FactDetailView.ts","../../frontend/components/sot/FactsPanel.ts","../../frontend/components/widgets/StatsCard.ts","../../frontend/components/widgets/HealthIndicator.ts","../../frontend/components/widgets/TrendChart.ts","../../frontend/components/widgets/RiskMatrix.ts","../../frontend/components/FileUploader.ts","../../frontend/components/KnowledgeGraph.ts","../../frontend/components/Timeline.ts","../../frontend/components/TimelinePanel.ts","../../frontend/services/billing.ts","../../frontend/components/CostsDashboard.ts","../../frontend/components/GlobalSearch.ts","../../frontend/components/BulkActions.ts","../../frontend/components/SyncStatus.ts","../../frontend/components/modals/SettingsModal.ts","../../frontend/components/modals/ProcessingModal.ts","../../frontend/components/modals/AuthModal.ts","../../frontend/components/modals/ContactModal.ts","../../frontend/components/modals/TeamModal.ts","../../frontend/components/modals/InviteModal.ts","../../frontend/components/modals/RoleModal.ts","../../frontend/components/modals/ExportModal.ts","../../frontend/components/modals/FileUploadModal.ts","../../frontend/components/modals/DeveloperModal.ts","../../frontend/components/modals/ShortcutsModal.ts","../../frontend/components/modals/NotificationsModal.ts","../../frontend/components/modals/EmailModal.ts","../../frontend/stores/charts.ts","../../frontend/components/modals/GraphModal.ts","../../frontend/components/modals/HistoryModal.ts","../../frontend/components/modals/CommentModal.ts","../../frontend/components/modals/ProfileModal.ts","../../frontend/components/modals/FactModal.ts","../../frontend/components/modals/ConversationPreviewModal.ts","../../frontend/components/modals/EmailPreviewModal.ts","../../frontend/components/BriefingPanel.ts","../../frontend/components/ReportsPanel.ts","../../frontend/components/ContactsPanel.ts","../../frontend/components/TeamsPanel.ts","../../frontend/components/OrgChart.ts","../../frontend/components/DocumentsPanel.ts","../../frontend/components/KnowledgePanel.ts","../../frontend/components/ConversationComposer.ts","../../frontend/components/ConversationsPanel.ts","../../frontend/components/EmailsPanel.ts","../../frontend/components/EmailComposer.ts","../../frontend/components/NotificationsDropdown.ts","../../frontend/components/CommentsThread.ts","../../frontend/components/MembersPanel.ts","../../frontend/components/ApiKeysPanel.ts","../../frontend/components/WebhooksPanel.ts","../../frontend/components/AuditPanel.ts","../../frontend/components/RolesPanel.ts","../../frontend/components/AdminPanel.ts","../../frontend/components/HistoryPanel.ts","../../frontend/utils/legacy-bridge.ts","../../frontend/main.ts"],"sourcesContent":["/**\n * Theme Service\n * Manages dark/light/system theme with auto-detection\n */\n\nexport type ThemeMode = 'light' | 'dark' | 'system';\nexport type EffectiveTheme = 'light' | 'dark';\n\nclass ThemeService {\n  private mode: ThemeMode;\n  private listeners: Set<(theme: EffectiveTheme) => void> = new Set();\n  private mediaQuery: MediaQueryList;\n\n  constructor() {\n    this.mode = this.getSavedTheme();\n    this.mediaQuery = window.matchMedia('(prefers-color-scheme: light)');\n    this.apply();\n    this.watchSystemChanges();\n  }\n\n  /**\n   * Get saved theme from localStorage or default to 'system'\n   */\n  private getSavedTheme(): ThemeMode {\n    const saved = localStorage.getItem('theme');\n    if (saved === 'light' || saved === 'dark' || saved === 'system') {\n      return saved;\n    }\n    return 'system';\n  }\n\n  /**\n   * Get the system's preferred color scheme\n   */\n  private getSystemTheme(): EffectiveTheme {\n    return this.mediaQuery.matches ? 'light' : 'dark';\n  }\n\n  /**\n   * Watch for system theme changes\n   */\n  private watchSystemChanges(): void {\n    this.mediaQuery.addEventListener('change', () => {\n      if (this.mode === 'system') {\n        this.apply();\n      }\n    });\n  }\n\n  /**\n   * Get the effective theme (resolving 'system' to actual theme)\n   */\n  getEffective(): EffectiveTheme {\n    if (this.mode === 'system') {\n      return this.getSystemTheme();\n    }\n    return this.mode;\n  }\n\n  /**\n   * Get the current mode setting\n   */\n  getMode(): ThemeMode {\n    return this.mode;\n  }\n\n  /**\n   * Apply the current theme to the document\n   */\n  apply(): void {\n    const effective = this.getEffective();\n    document.documentElement.setAttribute('data-theme', effective);\n    \n    // Notify listeners\n    this.listeners.forEach(fn => fn(effective));\n  }\n\n  /**\n   * Set theme mode directly\n   */\n  set(mode: ThemeMode): void {\n    this.mode = mode;\n    localStorage.setItem('theme', mode);\n    this.apply();\n  }\n\n  /**\n   * Cycle through themes: light -> dark -> system -> light\n   */\n  cycle(): ThemeMode {\n    const modes: ThemeMode[] = ['light', 'dark', 'system'];\n    const currentIndex = modes.indexOf(this.mode);\n    const nextIndex = (currentIndex + 1) % modes.length;\n    this.set(modes[nextIndex]);\n    return this.mode;\n  }\n\n  /**\n   * Toggle between light and dark (ignores system)\n   */\n  toggle(): EffectiveTheme {\n    const effective = this.getEffective();\n    const newTheme: EffectiveTheme = effective === 'dark' ? 'light' : 'dark';\n    this.set(newTheme);\n    return newTheme;\n  }\n\n  /**\n   * Subscribe to theme changes\n   */\n  onChange(callback: (theme: EffectiveTheme) => void): () => void {\n    this.listeners.add(callback);\n    return () => this.listeners.delete(callback);\n  }\n\n  /**\n   * Get icon for current theme mode\n   */\n  getIcon(): string {\n    switch (this.mode) {\n      case 'light': return '';\n      case 'dark': return '';\n      case 'system': return '';\n    }\n  }\n\n  /**\n   * Get label for current theme mode\n   */\n  getLabel(): string {\n    switch (this.mode) {\n      case 'light': return 'Light';\n      case 'dark': return 'Dark';\n      case 'system': return 'System';\n    }\n  }\n}\n\n// Export singleton instance\nexport const theme = new ThemeService();\n\n// Export class for testing\nexport { ThemeService };\n","/**\n * Toast Notification Service\n * Displays temporary notification messages\n */\n\nexport type ToastType = 'success' | 'error' | 'warning' | 'info';\n\ninterface ToastOptions {\n  duration?: number;\n  position?: 'top-right' | 'top-left' | 'bottom-right' | 'bottom-left';\n}\n\nconst defaultOptions: ToastOptions = {\n  duration: 3000,\n  position: 'bottom-right',\n};\n\nconst typeColors: Record<ToastType, string> = {\n  success: 'var(--success)',\n  error: 'var(--error)',\n  warning: 'var(--warning)',\n  info: 'var(--accent)',\n};\n\n/**\n * Show a toast notification\n */\nexport function showToast(\n  message: string,\n  type: ToastType = 'success',\n  options: ToastOptions = {}\n): void {\n  const opts = { ...defaultOptions, ...options };\n  \n  // Create toast element\n  const toast = document.createElement('div');\n  toast.className = 'toast fade-in';\n  toast.style.cssText = `\n    position: fixed;\n    ${opts.position?.includes('bottom') ? 'bottom' : 'top'}: 20px;\n    ${opts.position?.includes('right') ? 'right' : 'left'}: 20px;\n    background: ${typeColors[type]};\n    color: white;\n    padding: 12px 20px;\n    border-radius: 8px;\n    font-size: 14px;\n    z-index: 10000;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    max-width: 400px;\n    word-wrap: break-word;\n  `;\n  toast.textContent = message;\n  \n  // Add to DOM\n  document.body.appendChild(toast);\n  \n  // Remove after duration\n  setTimeout(() => {\n    toast.style.opacity = '0';\n    toast.style.transition = 'opacity 0.3s';\n    setTimeout(() => toast.remove(), 300);\n  }, opts.duration);\n}\n\n/**\n * Show success toast\n */\nexport function success(message: string, options?: ToastOptions): void {\n  showToast(message, 'success', options);\n}\n\n/**\n * Show error toast\n */\nexport function error(message: string, options?: ToastOptions): void {\n  showToast(message, 'error', options);\n}\n\n/**\n * Show warning toast\n */\nexport function warning(message: string, options?: ToastOptions): void {\n  showToast(message, 'warning', options);\n}\n\n/**\n * Show info toast\n */\nexport function info(message: string, options?: ToastOptions): void {\n  showToast(message, 'info', options);\n}\n\n// Export as namespace for convenience\nexport const toast = {\n  show: showToast,\n  success,\n  error,\n  warning,\n  info,\n};\n","/**\n * API Service\n * Centralized HTTP client with error handling\n */\n\nimport { toast } from './toast';\n\nexport interface ApiResponse<T = unknown> {\n  data: T;\n  ok: boolean;\n  status: number;\n  statusText: string;\n}\n\n/**\n * API client configuration\n */\ninterface ApiConfig {\n  baseUrl: string;\n  defaultHeaders: Record<string, string>;\n  showErrorToasts: boolean;\n  timeout: number;\n  retryCount: number;\n  retryDelay: number;\n  onUnauthorized?: () => void;\n  onForbidden?: () => void;\n}\n\nconst config: ApiConfig = {\n  baseUrl: '',\n  defaultHeaders: {\n    'Content-Type': 'application/json',\n  },\n  showErrorToasts: true,\n  timeout: 30000, // 30 seconds\n  retryCount: 2, // Retry failed requests up to 2 times\n  retryDelay: 1000, // Start with 1 second delay\n};\n\n// Request interceptors\ntype RequestInterceptor = (options: RequestInit) => RequestInit | Promise<RequestInit>;\ntype ResponseInterceptor = (response: ApiResponse<unknown>) => ApiResponse<unknown> | Promise<ApiResponse<unknown>>;\n\nconst requestInterceptors: RequestInterceptor[] = [];\nconst responseInterceptors: ResponseInterceptor[] = [];\n\n/**\n * Add request interceptor\n */\nexport function addRequestInterceptor(interceptor: RequestInterceptor): () => void {\n  requestInterceptors.push(interceptor);\n  return () => {\n    const index = requestInterceptors.indexOf(interceptor);\n    if (index > -1) requestInterceptors.splice(index, 1);\n  };\n}\n\n/**\n * Add response interceptor\n */\nexport function addResponseInterceptor(interceptor: ResponseInterceptor): () => void {\n  responseInterceptors.push(interceptor);\n  return () => {\n    const index = responseInterceptors.indexOf(interceptor);\n    if (index > -1) responseInterceptors.splice(index, 1);\n  };\n}\n\n/**\n * Make an API request with proper error handling\n */\nexport async function api<T = unknown>(\n  path: string,\n  options: RequestInit = {},\n  attempt = 0\n): Promise<ApiResponse<T>> {\n  const url = `${config.baseUrl}${path}`;\n  \n  // Apply request interceptors\n  let finalOptions: RequestInit = {\n    ...options,\n    headers: {\n      ...config.defaultHeaders,\n      ...options.headers,\n    },\n  };\n\n  for (const interceptor of requestInterceptors) {\n    finalOptions = await interceptor(finalOptions);\n  }\n\n  // Per-request timeout (optional); do not pass timeout to fetch\n  const optsWithTimeout = finalOptions as RequestInit & { timeout?: number };\n  const timeoutMs = optsWithTimeout.timeout ?? config.timeout;\n  delete (finalOptions as RequestInit & { timeout?: number }).timeout;\n\n  // Create abort controller for timeout\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\n\n  try {\n    const response = await fetch(url, {\n      ...finalOptions,\n      signal: controller.signal,\n      credentials: 'include', // Include cookies for authentication\n    });\n\n    clearTimeout(timeoutId);\n\n    let data: T;\n    const contentType = response.headers.get('content-type');\n    \n    if (contentType?.includes('application/json')) {\n      data = await response.json();\n    } else {\n      data = await response.text() as unknown as T;\n    }\n\n    if (!response.ok) {\n      // Handle specific HTTP errors\n      switch (response.status) {\n        case 401:\n          if (config.onUnauthorized) {\n            config.onUnauthorized();\n          }\n          break;\n        case 403:\n          if (config.onForbidden) {\n            config.onForbidden();\n          }\n          break;\n        case 429:\n          // Rate limited - auto retry with exponential backoff\n          if (attempt < 3) {\n            const retryAfter = parseInt(response.headers.get('Retry-After') || '5', 10);\n            await sleep(retryAfter * 1000);\n            return api<T>(path, options, attempt + 1);\n          }\n          break;\n        case 503:\n        case 504:\n          // Service unavailable - retry\n          if (attempt < config.retryCount) {\n            await sleep(config.retryDelay * Math.pow(2, attempt));\n            return api<T>(path, options, attempt + 1);\n          }\n          break;\n      }\n\n      const errorMessage = extractErrorMessage(data, response.statusText);\n      \n      if (config.showErrorToasts) {\n        toast.error(errorMessage);\n      }\n      \n      throw new ApiError(errorMessage, response.status, data);\n    }\n\n    let result: ApiResponse<T> = {\n      data,\n      ok: true,\n      status: response.status,\n      statusText: response.statusText,\n    };\n\n    // Apply response interceptors\n    for (const interceptor of responseInterceptors) {\n      result = await interceptor(result) as ApiResponse<T>;\n    }\n\n    return result;\n  } catch (error) {\n    clearTimeout(timeoutId);\n\n    if (error instanceof ApiError) {\n      throw error;\n    }\n\n    // Abort error (timeout)\n    if (error instanceof DOMException && error.name === 'AbortError') {\n      const message = 'Request timed out';\n      if (config.showErrorToasts) {\n        toast.error(message);\n      }\n      throw new ApiError(message, 0);\n    }\n    \n    // Network or other error - retry if configured\n    if (attempt < config.retryCount) {\n      await sleep(config.retryDelay * Math.pow(2, attempt));\n      return api<T>(path, options, attempt + 1);\n    }\n\n    const message = error instanceof Error ? error.message : 'Network error';\n    if (config.showErrorToasts) {\n      toast.error(`Connection error: ${message}`);\n    }\n    throw new ApiError(message, 0);\n  }\n}\n\n/**\n * Extract error message from response data\n */\nfunction extractErrorMessage(data: unknown, fallback: string): string {\n  if (typeof data === 'object' && data !== null) {\n    const obj = data as Record<string, unknown>;\n    return String(obj.error || obj.message || obj.detail || fallback);\n  }\n  return fallback || 'Request failed';\n}\n\n/**\n * Sleep helper\n */\nfunction sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * Custom API Error class\n */\nclass ApiError extends Error {\n  status: number;\n  details?: unknown;\n\n  constructor(message: string, status: number, details?: unknown) {\n    super(message);\n    this.name = 'ApiError';\n    this.status = status;\n    this.details = details;\n  }\n}\n\n/**\n * Convenience methods\n */\nexport const http = {\n  get: <T = unknown>(path: string, options?: RequestInit) =>\n    api<T>(path, { ...options, method: 'GET' }),\n\n  post: <T = unknown>(path: string, body?: unknown, options?: RequestInit) =>\n    api<T>(path, {\n      ...options,\n      method: 'POST',\n      body: body ? JSON.stringify(body) : undefined,\n    }),\n\n  put: <T = unknown>(path: string, body?: unknown, options?: RequestInit) =>\n    api<T>(path, {\n      ...options,\n      method: 'PUT',\n      body: body ? JSON.stringify(body) : undefined,\n    }),\n\n  patch: <T = unknown>(path: string, body?: unknown, options?: RequestInit) =>\n    api<T>(path, {\n      ...options,\n      method: 'PATCH',\n      body: body ? JSON.stringify(body) : undefined,\n    }),\n\n  delete: <T = unknown>(path: string, options?: RequestInit) =>\n    api<T>(path, { ...options, method: 'DELETE' }),\n};\n\n/**\n * Configure API client\n */\nexport function configureApi(newConfig: Partial<ApiConfig>): void {\n  Object.assign(config, newConfig);\n}\n\nexport { ApiError };\n","/**\n * Storage Service\n * Wrapper for localStorage with type safety and JSON handling\n */\n\n/**\n * Get item from localStorage with JSON parsing.\n * Never throws: returns defaultValue if storage is blocked (e.g. Tracking Prevention) or parse fails.\n */\nexport function getItem<T>(key: string, defaultValue: T): T {\n  try {\n    const item = localStorage.getItem(key);\n    if (item === null) {\n      return defaultValue;\n    }\n    return JSON.parse(item) as T;\n  } catch {\n    return defaultValue;\n  }\n}\n\n/**\n * Set item in localStorage with JSON serialization.\n * Never throws: no-op if storage is blocked (e.g. Tracking Prevention).\n */\nexport function setItem<T>(key: string, value: T): void {\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch {\n    // Storage blocked or quota exceeded - ignore\n  }\n}\n\n/**\n * Remove item from localStorage. Never throws; no-op if storage is blocked.\n */\nexport function removeItem(key: string): void {\n  try {\n    localStorage.removeItem(key);\n  } catch {\n    // ignore\n  }\n}\n\n/**\n * Clear all localStorage. Never throws; no-op if storage is blocked.\n */\nexport function clear(): void {\n  try {\n    localStorage.clear();\n  } catch {\n    // ignore\n  }\n}\n\n/**\n * Check if key exists in localStorage. Returns false if storage is blocked.\n */\nexport function hasItem(key: string): boolean {\n  try {\n    return localStorage.getItem(key) !== null;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Get all keys in localStorage. Returns [] if storage is blocked.\n */\nexport function getKeys(): string[] {\n  try {\n    return Object.keys(localStorage);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Storage namespace export\n */\nexport const storage = {\n  get: getItem,\n  set: setItem,\n  remove: removeItem,\n  clear,\n  has: hasItem,\n  keys: getKeys,\n};\n","/**\n * Keyboard Shortcuts Service\n * Manages global keyboard shortcuts\n */\n\nexport interface Shortcut {\n  key: string;\n  ctrl?: boolean;\n  shift?: boolean;\n  alt?: boolean;\n  meta?: boolean;\n  description: string;\n  handler: () => void;\n}\n\n// Type for string-based shortcut registration (e.g., 'mod+k', 'ctrl+shift+s')\nexport type ShortcutHandler = (event: KeyboardEvent) => void;\n\nclass ShortcutService {\n  private shortcuts: Map<string, Shortcut> = new Map();\n  private enabled = true;\n  private isMac = typeof navigator !== 'undefined' && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\n\n  constructor() {\n    this.handleKeydown = this.handleKeydown.bind(this);\n    document.addEventListener('keydown', this.handleKeydown);\n  }\n\n  /**\n   * Parse string shortcut to Shortcut object\n   * Supports: 'mod+k' (cmd on Mac, ctrl on others), 'ctrl+shift+s', '/', 'Escape'\n   */\n  private parseShortcut(shortcutStr: string, handler: ShortcutHandler, description = ''): Shortcut {\n    const parts = shortcutStr.toLowerCase().split('+');\n    const key = parts.pop() || shortcutStr;\n    \n    const shortcut: Shortcut = {\n      key,\n      ctrl: parts.includes('ctrl') || (parts.includes('mod') && !this.isMac),\n      shift: parts.includes('shift'),\n      alt: parts.includes('alt'),\n      meta: parts.includes('meta') || (parts.includes('mod') && this.isMac),\n      description,\n      handler: () => {\n        // Create a synthetic event for backwards compatibility\n        const syntheticEvent = new KeyboardEvent('keydown', { key });\n        handler(syntheticEvent);\n      },\n    };\n\n    return shortcut;\n  }\n\n  /**\n   * Generate unique key for shortcut\n   */\n  private getShortcutKey(shortcut: Omit<Shortcut, 'description' | 'handler'>): string {\n    const parts: string[] = [];\n    if (shortcut.ctrl) parts.push('ctrl');\n    if (shortcut.shift) parts.push('shift');\n    if (shortcut.alt) parts.push('alt');\n    if (shortcut.meta) parts.push('meta');\n    if (shortcut.key) {\n      parts.push(shortcut.key.toLowerCase());\n    }\n    return parts.join('+');\n  }\n\n  /**\n   * Handle keydown events\n   */\n  private handleKeydown(event: KeyboardEvent): void {\n    if (!this.enabled) return;\n\n    // Don't trigger shortcuts when typing in input fields\n    const target = event.target as HTMLElement;\n    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\n      // Allow Escape in input fields\n      if (event.key !== 'Escape') {\n        return;\n      }\n    }\n\n    const key = this.getShortcutKey({\n      key: event.key,\n      ctrl: event.ctrlKey,\n      shift: event.shiftKey,\n      alt: event.altKey,\n      meta: event.metaKey,\n    });\n\n    const shortcut = this.shortcuts.get(key);\n    if (shortcut) {\n      event.preventDefault();\n      shortcut.handler();\n    }\n  }\n\n  /**\n   * Register a keyboard shortcut\n   * Supports both object format and string format:\n   * - Object: { key: 'k', ctrl: true, handler: () => {}, description: 'Search' }\n   * - String: register('mod+k', (e) => {}, 'Search')\n   */\n  register(shortcutOrKey: Shortcut | string, handler?: ShortcutHandler, description?: string): () => void {\n    let shortcut: Shortcut;\n    \n    if (typeof shortcutOrKey === 'string') {\n      if (!handler) {\n        throw new Error('Handler is required when using string shortcut format');\n      }\n      shortcut = this.parseShortcut(shortcutOrKey, handler, description || '');\n    } else {\n      shortcut = shortcutOrKey;\n    }\n    \n    const key = this.getShortcutKey(shortcut);\n    this.shortcuts.set(key, shortcut);\n    \n    // Return unregister function\n    return () => this.shortcuts.delete(key);\n  }\n\n  /**\n   * Unregister a shortcut by key combination\n   */\n  unregister(shortcut: Omit<Shortcut, 'description' | 'handler'>): void {\n    const key = this.getShortcutKey(shortcut);\n    this.shortcuts.delete(key);\n  }\n\n  /**\n   * Enable/disable all shortcuts\n   */\n  setEnabled(enabled: boolean): void {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Get all registered shortcuts\n   */\n  getAll(): Shortcut[] {\n    return Array.from(this.shortcuts.values());\n  }\n\n  /**\n   * Show shortcuts help modal\n   */\n  showHelp(): void {\n    const shortcuts = this.getAll();\n    console.log('Keyboard Shortcuts:');\n    shortcuts.forEach(s => {\n      const parts: string[] = [];\n      if (s.ctrl) parts.push('Ctrl');\n      if (s.shift) parts.push('Shift');\n      if (s.alt) parts.push('Alt');\n      if (s.meta) parts.push('Cmd');\n      parts.push(s.key.toUpperCase());\n      console.log(`  ${parts.join('+')} - ${s.description}`);\n    });\n  }\n\n  /**\n   * Destroy service and remove event listener\n   */\n  destroy(): void {\n    document.removeEventListener('keydown', this.handleKeydown);\n    this.shortcuts.clear();\n  }\n}\n\n// Export singleton\nexport const shortcuts = new ShortcutService();\n\n// Export class for testing\nexport { ShortcutService };\n","/**\n * Undo Service\n * Manages undo/redo stack for operations\n */\n\nexport interface UndoAction {\n  id?: string;\n  type?: string;\n  description: string;\n  undo: () => Promise<void> | void;\n  redo?: () => Promise<void> | void;\n  timestamp: number;\n}\n\nclass UndoService {\n  private undoStack: UndoAction[] = [];\n  private redoStack: UndoAction[] = [];\n  private maxSize = 50;\n  private listeners: Set<() => void> = new Set();\n\n  /**\n   * Push a new action to the undo stack\n   */\n  push(action: Omit<UndoAction, 'timestamp'>): void {\n    this.undoStack.push({\n      ...action,\n      timestamp: Date.now(),\n    });\n\n    // Clear redo stack on new action\n    this.redoStack = [];\n\n    // Limit stack size\n    if (this.undoStack.length > this.maxSize) {\n      this.undoStack.shift();\n    }\n\n    this.notify();\n  }\n\n  /**\n   * Undo the last action\n   */\n  async undo(): Promise<boolean> {\n    const action = this.undoStack.pop();\n    if (!action) return false;\n\n    try {\n      await action.undo();\n      this.redoStack.push(action);\n      this.notify();\n      return true;\n    } catch (error) {\n      console.error('Undo failed:', error);\n      // Put action back on stack\n      this.undoStack.push(action);\n      return false;\n    }\n  }\n\n  /**\n   * Redo the last undone action\n   */\n  async redo(): Promise<boolean> {\n    const action = this.redoStack.pop();\n    if (!action || !action.redo) return false;\n\n    try {\n      await action.redo();\n      this.undoStack.push(action);\n      this.notify();\n      return true;\n    } catch (error) {\n      console.error('Redo failed:', error);\n      // Put action back on stack\n      this.redoStack.push(action);\n      return false;\n    }\n  }\n\n  /**\n   * Check if undo is available\n   */\n  canUndo(): boolean {\n    return this.undoStack.length > 0;\n  }\n\n  /**\n   * Check if redo is available\n   */\n  canRedo(): boolean {\n    return this.redoStack.length > 0;\n  }\n\n  /**\n   * Get last undoable action description\n   */\n  getUndoDescription(): string | null {\n    const action = this.undoStack[this.undoStack.length - 1];\n    return action?.description ?? null;\n  }\n\n  /**\n   * Get last redoable action description\n   */\n  getRedoDescription(): string | null {\n    const action = this.redoStack[this.redoStack.length - 1];\n    return action?.description ?? null;\n  }\n\n  /**\n   * Clear all undo/redo history\n   */\n  clear(): void {\n    this.undoStack = [];\n    this.redoStack = [];\n    this.notify();\n  }\n\n  /**\n   * Subscribe to changes\n   */\n  onChange(callback: () => void): () => void {\n    this.listeners.add(callback);\n    return () => this.listeners.delete(callback);\n  }\n\n  /**\n   * Notify listeners of changes\n   */\n  private notify(): void {\n    this.listeners.forEach(fn => fn());\n  }\n\n  /**\n   * Get stack sizes for debugging\n   */\n  getState(): { undoCount: number; redoCount: number } {\n    return {\n      undoCount: this.undoStack.length,\n      redoCount: this.redoStack.length,\n    };\n  }\n}\n\n// Export singleton\nexport const undoManager = new UndoService();\n\n// Export class for testing\nexport { UndoService };\n","/**\n * App Store\n * Core application state\n */\n\nimport { storage } from '../services/storage';\n\n// Types\nexport interface User {\n  id: string;\n  email: string;\n  role: 'superadmin' | 'admin' | 'member';\n  name?: string;\n  avatar?: string;\n}\n\nexport interface Project {\n  id: string;\n  name: string;\n  description?: string;\n  status?: 'active' | 'archived' | 'completed';\n  createdAt?: string;\n  updatedAt?: string;\n  ownerId?: string;\n  settings?: Record<string, unknown>;\n}\n\nexport interface ProjectConfig {\n  aiProvider?: string;\n  aiModel?: string;\n  language?: string;\n  timezone?: string;\n  analyticsEnabled?: boolean;\n  errorReportingEnabled?: boolean;\n  aiImprovementEnabled?: boolean;\n}\n\nexport interface AppState {\n  currentProjectId: string | null;\n  currentProject: Project | null;\n  currentUser: User | null;\n  authConfigured: boolean;\n  config: ProjectConfig;\n  isLoading: boolean;\n  error: string | null;\n  isOnline: boolean;\n  version: string;\n}\n\nfunction isUuid(v: unknown): v is string {\n  return typeof v === 'string' && /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(v);\n}\n\n// Hydrate persisted project selection, but ignore legacy/invalid ids\nconst persistedProjectId = storage.get<string | null>('currentProjectId', null);\nconst persistedProject = storage.get<Project | null>('currentProject', null);\nconst validProjectId = isUuid(persistedProjectId) ? persistedProjectId : null;\nconst validProject = persistedProject && isUuid((persistedProject as any).id) ? persistedProject : null;\n\nif (!validProjectId && persistedProjectId) {\n  storage.remove('currentProjectId');\n}\nif (!validProject && persistedProject) {\n  storage.remove('currentProject');\n}\n\n// Initial state\nconst initialState: AppState = {\n  currentProjectId: validProjectId,\n  currentProject: validProject,\n  currentUser: null,\n  authConfigured: false,\n  config: {},\n  isLoading: false,\n  error: null,\n  isOnline: navigator.onLine,\n  version: '1.0.0',\n};\n\n// State\nlet state: AppState = { ...initialState };\n\n// Listeners\nconst listeners: Set<(state: AppState) => void> = new Set();\n\n/**\n * Notify all listeners of state change\n */\nfunction notify(): void {\n  listeners.forEach(fn => fn(state));\n}\n\n/**\n * Get current state\n */\nexport function getState(): AppState {\n  return state;\n}\n\n/**\n * Subscribe to state changes\n */\nexport function subscribe(callback: (state: AppState) => void): () => void {\n  listeners.add(callback);\n  return () => listeners.delete(callback);\n}\n\n/**\n * Set current project by ID only\n */\nexport function setCurrentProjectId(projectId: string | null): void {\n  state = { ...state, currentProjectId: projectId };\n  if (projectId) {\n    storage.set('currentProjectId', projectId);\n  } else {\n    storage.remove('currentProjectId');\n    storage.remove('currentProject');\n    state = { ...state, currentProject: null };\n  }\n  notify();\n}\n\n/**\n * Set current project (full object)\n */\nexport function setCurrentProject(project: Project | null): void {\n  state = { \n    ...state, \n    currentProject: project,\n    currentProjectId: project?.id || null,\n  };\n  if (project) {\n    storage.set('currentProject', project);\n    storage.set('currentProjectId', project.id);\n  } else {\n    storage.remove('currentProject');\n    storage.remove('currentProjectId');\n  }\n  notify();\n}\n\n/**\n * Set current user\n */\nexport function setCurrentUser(user: User | null): void {\n  state = { ...state, currentUser: user };\n  notify();\n}\n\n/**\n * Set auth configured status\n */\nexport function setAuthConfigured(configured: boolean): void {\n  state = { ...state, authConfigured: configured };\n  notify();\n}\n\n/**\n * Set project config\n */\nexport function setConfig(config: Partial<ProjectConfig>): void {\n  state = { ...state, config: { ...state.config, ...config } };\n  notify();\n}\n\n/**\n * Set loading state\n */\nexport function setLoading(isLoading: boolean): void {\n  state = { ...state, isLoading };\n  notify();\n}\n\n/**\n * Set error\n */\nexport function setError(error: string | null): void {\n  state = { ...state, error };\n  notify();\n}\n\n/**\n * Set online status\n */\nexport function setOnline(online: boolean): void {\n  state = { ...state, isOnline: online };\n  notify();\n}\n\n/**\n * Reset to initial state\n */\nexport function reset(): void {\n  state = { ...initialState };\n  notify();\n}\n\n/**\n * Initialize app store\n * Sets up online/offline listeners\n */\nexport function initAppStore(): void {\n  window.addEventListener('online', () => setOnline(true));\n  window.addEventListener('offline', () => setOnline(false));\n}\n\n// Export as namespace\nexport const appStore = {\n  getState,\n  subscribe,\n  setCurrentProject,\n  setCurrentProjectId,\n  setCurrentUser,\n  setAuthConfigured,\n  setConfig,\n  setLoading,\n  setError,\n  setOnline,\n  reset,\n  init: initAppStore,\n};\n","/**\n * Auth Service\n * Handles authentication state and API calls\n */\n\nimport { http } from './api';\nimport { appStore, User } from '../stores/app';\nimport { toast } from './toast';\n\n// Types\nexport interface AuthStatus {\n  configured: boolean;\n  url?: string;\n}\n\nexport interface LoginRequest {\n  email: string;\n  password: string;\n}\n\nexport interface OTPRequestResponse {\n  success: boolean;\n  message?: string;\n  expiresInMinutes?: number;\n  config?: OTPConfig;\n  retryAfter?: number;\n}\n\nexport interface OTPVerifyResponse {\n  success: boolean;\n  user?: AuthUser;\n  redirectTo?: string;\n  error?: string;\n  attemptsRemaining?: number;\n  needsEmailVerification?: boolean;\n  fallbackToPassword?: boolean;\n}\n\nexport interface OTPConfig {\n  codeLength: number;\n  expirationMinutes: number;\n  resendCooldownSeconds: number;\n}\n\nexport interface RegisterRequest {\n  email: string;\n  password: string;\n  username?: string;\n  display_name?: string;\n}\n\nexport interface AuthUser {\n  id: string;\n  email: string;\n  email_confirmed_at?: string | null;\n  created_at: string;\n  updated_at: string;\n  user_metadata?: {\n    username?: string;\n    display_name?: string;\n  };\n  profile?: UserProfile | null;\n}\n\nexport interface UserProfile {\n  id: string;\n  username?: string;\n  display_name?: string;\n  avatar_url?: string;\n  timezone?: string;\n  preferences?: Record<string, unknown>;\n  role?: 'user' | 'admin' | 'superadmin'; // Application role from user_profiles table\n}\n\nexport interface LoginResponse {\n  success: boolean;\n  user: AuthUser;\n}\n\nexport interface RegisterResponse {\n  success: boolean;\n  user: AuthUser;\n  session?: {\n    access_token: string;\n    refresh_token: string;\n    expires_at: number;\n  };\n  needsEmailVerification: boolean;\n}\n\nexport interface MeResponse {\n  authenticated: boolean;\n  user: AuthUser | null;\n}\n\n// Auth state\nlet isInitialized = false;\nlet authCheckPromise: Promise<boolean> | null = null;\n\n/**\n * Check if authentication is configured (Supabase)\n */\nexport async function checkAuthStatus(): Promise<AuthStatus> {\n  try {\n    const response = await http.get<AuthStatus>('/api/auth/status');\n    const configured = response.data.configured;\n    appStore.setAuthConfigured(configured);\n    return response.data;\n  } catch {\n    appStore.setAuthConfigured(false);\n    return { configured: false };\n  }\n}\n\n/**\n * Check current session and get user\n */\nexport async function checkSession(): Promise<User | null> {\n  try {\n    const response = await http.get<MeResponse>('/api/auth/me');\n    \n    if (response.data.authenticated && response.data.user) {\n      const authUser = response.data.user;\n      const user = mapAuthUserToUser(authUser);\n      appStore.setCurrentUser(user);\n      return user;\n    }\n    \n    appStore.setCurrentUser(null);\n    return null;\n  } catch {\n    appStore.setCurrentUser(null);\n    return null;\n  }\n}\n\n/**\n * Initialize auth - check status and session\n * When Supabase is configured, always requires valid authentication\n */\nexport async function initAuth(): Promise<boolean> {\n  // Prevent multiple simultaneous checks\n  if (authCheckPromise) {\n    return authCheckPromise;\n  }\n\n  authCheckPromise = (async () => {\n    try {\n      // Check if auth is configured\n      const status = await checkAuthStatus();\n      \n      if (!status.configured) {\n        // Auth not configured - allow guest mode\n        isInitialized = true;\n        return false;\n      }\n\n      // Auth is configured - check current session\n      // If session is invalid, user MUST login\n      const user = await checkSession();\n      isInitialized = true;\n      \n      if (!user) {\n        // No valid session - clear any stale user data\n        appStore.setCurrentUser(null);\n        console.log(' Supabase configured but no valid session - login required');\n        return false;\n      }\n      \n      return true;\n    } catch {\n      // Auth check failed - clear user and require login\n      appStore.setCurrentUser(null);\n      isInitialized = true;\n      return false;\n    } finally {\n      authCheckPromise = null;\n    }\n  })();\n\n  return authCheckPromise;\n}\n\n/**\n * Login with email and password\n */\nexport async function login(credentials: LoginRequest): Promise<User> {\n  const response = await http.post<LoginResponse>('/api/auth/login', credentials);\n  \n  if (!response.data.success) {\n    throw new Error('Login failed');\n  }\n\n  const user = mapAuthUserToUser(response.data.user);\n  appStore.setCurrentUser(user);\n  return user;\n}\n\n/**\n * Register new account\n */\nexport async function register(data: RegisterRequest): Promise<{ user: User; needsEmailVerification: boolean }> {\n  // Validate password length (min 12 chars as per server)\n  if (data.password.length < 12) {\n    throw new Error('Password must be at least 12 characters');\n  }\n\n  // Validate username if provided\n  if (data.username && data.username.length < 3) {\n    throw new Error('Username must be at least 3 characters');\n  }\n\n  if (data.username && !/^[a-zA-Z0-9_]+$/.test(data.username)) {\n    throw new Error('Username can only contain letters, numbers, and underscores');\n  }\n\n  const response = await http.post<RegisterResponse>('/api/auth/register', data);\n  \n  if (!response.data.success) {\n    throw new Error('Registration failed');\n  }\n\n  const user = mapAuthUserToUser(response.data.user);\n  \n  // Only set user if no email verification required\n  if (!response.data.needsEmailVerification) {\n    appStore.setCurrentUser(user);\n  }\n\n  return { \n    user, \n    needsEmailVerification: response.data.needsEmailVerification \n  };\n}\n\n/**\n * Logout current user\n */\nexport async function logout(): Promise<void> {\n  try {\n    await http.post('/api/auth/logout');\n  } catch {\n    // Ignore logout errors - clear local state anyway\n  }\n  \n  appStore.setCurrentUser(null);\n  appStore.setCurrentProject(null);\n}\n\n/**\n * Request password reset\n */\nexport async function forgotPassword(email: string): Promise<void> {\n  await http.post('/api/auth/forgot-password', { email });\n  // Always succeeds - doesn't reveal if email exists\n}\n\n/**\n * Reset password with token\n */\nexport async function resetPassword(password: string, accessToken: string): Promise<void> {\n  if (password.length < 12) {\n    throw new Error('Password must be at least 12 characters');\n  }\n\n  const response = await http.post<{ success: boolean }>('/api/auth/reset-password', {\n    password,\n    access_token: accessToken,\n  });\n\n  if (!response.data.success) {\n    throw new Error('Password reset failed');\n  }\n}\n\n/**\n * Refresh session token\n */\nexport async function refreshSession(): Promise<boolean> {\n  try {\n    const response = await http.post<{ success: boolean }>('/api/auth/refresh');\n    return response.data.success;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Request OTP code for passwordless login\n */\nexport async function requestLoginCode(email: string): Promise<OTPRequestResponse> {\n  const response = await http.post<OTPRequestResponse>('/api/auth/otp/request', { email });\n  return response.data;\n}\n\n/**\n * Verify OTP code and complete login\n */\nexport async function verifyLoginCode(email: string, code: string): Promise<User> {\n  const response = await http.post<OTPVerifyResponse>('/api/auth/otp/verify', { email, code });\n  \n  if (!response.data.success) {\n    const error = new Error(response.data.error || 'Verification failed') as Error & {\n      attemptsRemaining?: number;\n      needsEmailVerification?: boolean;\n      fallbackToPassword?: boolean;\n    };\n    error.attemptsRemaining = response.data.attemptsRemaining;\n    error.needsEmailVerification = response.data.needsEmailVerification;\n    error.fallbackToPassword = response.data.fallbackToPassword;\n    throw error;\n  }\n  \n  // Handle redirect if needed (magic link flow)\n  if (response.data.redirectTo) {\n    window.location.href = response.data.redirectTo;\n    throw new Error('Redirecting...');\n  }\n  \n  if (!response.data.user) {\n    throw new Error('Login completed but no user data received');\n  }\n  \n  const user = mapAuthUserToUser(response.data.user);\n  appStore.setCurrentUser(user);\n  return user;\n}\n\n/**\n * Get OTP configuration\n */\nexport async function getOTPConfig(): Promise<OTPConfig> {\n  try {\n    const response = await http.get<OTPConfig>('/api/auth/otp/config');\n    return response.data;\n  } catch {\n    // Return defaults if API fails\n    return {\n      codeLength: 6,\n      expirationMinutes: 10,\n      resendCooldownSeconds: 60\n    };\n  }\n}\n\n/**\n * Confirm email with code\n */\nexport async function confirmEmail(email: string, code: string): Promise<void> {\n  const response = await http.post<{ success: boolean; message?: string; error?: string }>('/api/auth/confirm-email', { email, code });\n  \n  if (!response.data.success) {\n    throw new Error(response.data.error || 'Confirmation failed');\n  }\n}\n\n/**\n * Resend email confirmation code\n */\nexport async function resendConfirmation(email: string): Promise<{ expiresInMinutes?: number }> {\n  const response = await http.post<{ success: boolean; message?: string; expiresInMinutes?: number; error?: string; retryAfter?: number }>('/api/auth/resend-confirmation', { email });\n  \n  if (!response.data.success) {\n    const error = new Error(response.data.error || 'Failed to resend confirmation') as Error & { retryAfter?: number };\n    error.retryAfter = response.data.retryAfter;\n    throw error;\n  }\n  \n  return { expiresInMinutes: response.data.expiresInMinutes };\n}\n\n/**\n * Map AuthUser to app User type\n * Note: role here is the APPLICATION role (superadmin/user) from user_profiles,\n * NOT the project role (owner/admin/write/read) from project_members\n */\nfunction mapAuthUserToUser(authUser: AuthUser): User {\n  const profile = authUser.profile;\n  const metadata = authUser.user_metadata || {};\n\n  return {\n    id: authUser.id,\n    email: authUser.email,\n    name: profile?.display_name || metadata.display_name || metadata.username || authUser.email.split('@')[0],\n    avatar: profile?.avatar_url,\n    role: profile?.role === 'superadmin' ? 'superadmin' : (profile?.role === 'admin' ? 'admin' : 'member'), // Map to app roles\n  };\n}\n\n/**\n * Check if user is authenticated\n */\nexport function isAuthenticated(): boolean {\n  return appStore.getState().currentUser !== null;\n}\n\n/**\n * Check if auth is initialized\n */\nexport function isAuthInitialized(): boolean {\n  return isInitialized;\n}\n\n/**\n * Get current user\n */\nexport function getCurrentUser(): User | null {\n  return appStore.getState().currentUser;\n}\n\n/**\n * Listen for auth required events\n */\nexport function onAuthRequired(callback: () => void): () => void {\n  const handler = () => callback();\n  window.addEventListener('godmode:auth-required', handler);\n  return () => window.removeEventListener('godmode:auth-required', handler);\n}\n\n/**\n * Trigger auth required event\n */\nexport function triggerAuthRequired(): void {\n  window.dispatchEvent(new CustomEvent('godmode:auth-required'));\n}\n\n// Export as namespace\nexport const auth = {\n  checkStatus: checkAuthStatus,\n  checkSession,\n  init: initAuth,\n  login,\n  register,\n  logout,\n  forgotPassword,\n  resetPassword,\n  refreshSession,\n  isAuthenticated,\n  isInitialized: isAuthInitialized,\n  getCurrentUser,\n  onAuthRequired,\n  triggerAuthRequired,\n  // OTP / Magic Code\n  requestLoginCode,\n  verifyLoginCode,\n  getOTPConfig,\n  confirmEmail,\n  resendConfirmation,\n};\n","/**\n * Data Store\n * Application data cache\n */\n\nimport type { Fact } from '../services/facts';\n\n// Types\nexport interface Question {\n  id: string;\n  content: string;  // Primary field (API uses this)\n  question?: string;  // Legacy field for backwards compatibility\n  context?: string;\n  answer?: string;\n  answer_source?: string;\n  status: 'open' | 'answered' | 'dismissed' | 'pending' | 'assigned' | 'resolved' | 'reopened' | 'closed' | 'deferred';\n  priority: 'critical' | 'high' | 'medium' | 'low';\n  category?: string;\n  source?: string;\n  source_file?: string;\n  created_at?: string;  // API format\n  createdAt?: string;   // Legacy format\n  updated_at?: string;  // API format\n  updatedAt?: string;   // Legacy format\n  assigned_to?: string;\n  answered_by_contact_id?: string;\n  answered_by_name?: string;\n  follow_up_to?: string;\n  // SOTA fields\n  sla_hours?: number;\n  sla_breached?: boolean;\n  extracted_entities?: Array<{ type: string; name: string; entity_id?: string; confidence?: number }>;\n  extracted_topics?: Array<{ name: string; type?: string; confidence?: number }>;\n}\n\nexport interface Risk {\n  id: string | number;\n  content?: string;\n  description?: string;\n  impact: 'high' | 'medium' | 'low' | 'critical';\n  probability?: 'high' | 'medium' | 'low';\n  likelihood?: 'high' | 'medium' | 'low';\n  mitigation?: string;\n  owner?: string;\n  status: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\n  createdAt?: string;\n  created_at?: string;\n}\n\nexport interface Action {\n  id: string;\n  task: string;\n  assignee?: string;\n  dueDate?: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  priority: 'high' | 'medium' | 'low';\n  createdAt: string;\n}\n\nexport interface Decision {\n  id: string | number;\n  decision: string;\n  content?: string;\n  rationale?: string;\n  madeBy?: string;\n  made_by?: string;\n  madeAt: string;\n  decided_at?: string;\n  status: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\n  source?: string;\n  source_file?: string;\n  owner?: string;\n  [key: string]: unknown; // Allow additional properties\n}\n\nexport interface Contact {\n  id: string;\n  name: string;\n  email?: string;\n  phone?: string;\n  company?: string;\n  organization?: string;\n  role?: string;\n  rolePrompt?: string;\n  department?: string;\n  linkedin?: string;\n  timezone?: string;\n  location?: string;\n  photoUrl?: string;\n  avatarUrl?: string;\n  photo_url?: string;\n  avatar_url?: string;\n  notes?: string;\n  tags?: string[];\n  aliases?: string[];\n  isFavorite?: boolean;\n  is_favorite?: boolean;\n}\n\nexport interface ChatSource {\n  id: string;\n  type: string;\n  score: number;\n  rrfScore?: number;\n  semanticScore?: number;\n  keywordScore?: number;\n  sourceCount?: number;\n  source?: string;\n  contactName?: string;\n  contactRole?: string;\n  avatarUrl?: string;\n}\n\nexport interface ChatRAGInfo {\n  method: string;\n  vectorResults: number;\n  graphResults: number;\n  fusedResults: number;\n  usedHyDE: boolean;\n  entityFilter?: string[];\n}\n\nexport interface ChatMessage {\n  id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: string;\n  sources?: ChatSource[] | string[];\n  queryType?: string;\n  confidence?: 'high' | 'medium' | 'low';\n  contextQuality?: string;\n  rag?: ChatRAGInfo;\n}\n\nexport interface DataState {\n  questions: Question[];\n  risks: Risk[];\n  actions: Action[];\n  decisions: Decision[];\n  facts: Fact[];\n  contacts: Contact[];\n  chatHistory: ChatMessage[];\n  projects: Array<{ id: string; name: string }>;\n  lastUpdated: Record<string, number>;\n}\n\n// Initial state\nconst initialState: DataState = {\n  questions: [],\n  risks: [],\n  actions: [],\n  decisions: [],\n  facts: [],\n  contacts: [],\n  chatHistory: [],\n  projects: [],\n  lastUpdated: {},\n};\n\n// State\nlet state: DataState = { ...initialState };\n\n// Listeners\nconst listeners: Set<(state: DataState) => void> = new Set();\n\n/**\n * Notify all listeners\n */\nfunction notify(): void {\n  listeners.forEach(fn => fn(state));\n}\n\n/**\n * Get current state\n */\nexport function getState(): DataState {\n  return state;\n}\n\n/**\n * Subscribe to state changes\n */\nexport function subscribe(callback: (state: DataState) => void): () => void {\n  listeners.add(callback);\n  return () => listeners.delete(callback);\n}\n\n/**\n * Set questions\n */\nexport function setQuestions(questions: Question[]): void {\n  state = { \n    ...state, \n    questions,\n    lastUpdated: { ...state.lastUpdated, questions: Date.now() }\n  };\n  notify();\n}\n\n/**\n * Set risks\n */\nexport function setRisks(risks: Risk[]): void {\n  state = { \n    ...state, \n    risks,\n    lastUpdated: { ...state.lastUpdated, risks: Date.now() }\n  };\n  notify();\n}\n\n/**\n * Set actions\n */\nexport function setActions(actions: Action[]): void {\n  state = { \n    ...state, \n    actions,\n    lastUpdated: { ...state.lastUpdated, actions: Date.now() }\n  };\n  notify();\n}\n\n/**\n * Set decisions\n */\nexport function setDecisions(decisions: Decision[]): void {\n  state = { \n    ...state, \n    decisions,\n    lastUpdated: { ...state.lastUpdated, decisions: Date.now() }\n  };\n  notify();\n}\n\n/**\n * Set facts\n */\nexport function setFacts(facts: Fact[]): void {\n  state = { \n    ...state, \n    facts,\n    lastUpdated: { ...state.lastUpdated, facts: Date.now() }\n  };\n  notify();\n}\n\n/**\n * Set contacts\n */\nexport function setContacts(contacts: Contact[]): void {\n  state = { \n    ...state, \n    contacts,\n    lastUpdated: { ...state.lastUpdated, contacts: Date.now() }\n  };\n  notify();\n}\n\n/**\n * Set chat history\n */\nexport function setChatHistory(chatHistory: ChatMessage[]): void {\n  state = { ...state, chatHistory };\n  notify();\n}\n\n/**\n * Add chat message\n */\nexport function addChatMessage(message: ChatMessage): void {\n  state = { ...state, chatHistory: [...state.chatHistory, message] };\n  notify();\n}\n\n/**\n * Set projects\n */\nexport function setProjects(projects: Array<{ id: string; name: string }>): void {\n  state = { \n    ...state, \n    projects,\n    lastUpdated: { ...state.lastUpdated, projects: Date.now() }\n  };\n  notify();\n}\n\n/**\n * Clear chat history\n */\nexport function clearChatHistory(): void {\n  state = { ...state, chatHistory: [] };\n  notify();\n}\n\n/**\n * Reset to initial state\n */\nexport function reset(): void {\n  state = { ...initialState };\n  notify();\n}\n\n// Export as namespace\nexport const dataStore = {\n  getState,\n  subscribe,\n  setQuestions,\n  setRisks,\n  setActions,\n  setDecisions,\n  setFacts,\n  setContacts,\n  setChatHistory,\n  addChatMessage,\n  setProjects,\n  clearChatHistory,\n  reset,\n};\n","/**\n * Projects Service\n * Handles project CRUD operations and state\n */\n\nimport { http } from './api';\nimport { appStore, Project } from '../stores/app';\nimport { dataStore } from '../stores/data';\nimport { toast } from './toast';\n\n// Types\nexport interface ProjectListItem {\n  id: string;\n  name: string;\n  isDefault?: boolean;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\nexport interface CreateProjectRequest {\n  name: string;\n  description?: string;\n  userRole?: string;\n  userRolePrompt?: string;\n}\n\nexport interface UpdateProjectRequest {\n  name?: string;\n  description?: string;\n  userRole?: string;\n  userRolePrompt?: string;\n  isDefault?: boolean;\n}\n\nexport interface ProjectStats {\n  members?: number;\n  comments?: number;\n  recentActivity?: number;\n  facts?: number;\n  questions?: number;\n  documents?: number;\n  decisions?: number;\n  risks?: number;\n  actions?: number;\n  people?: number;\n}\n\n/**\n * Get all projects\n */\nexport async function getProjects(): Promise<ProjectListItem[]> {\n  try {\n    const response = await http.get<{ projects: ProjectListItem[] }>('/api/projects');\n    const projects = response.data.projects || [];\n    dataStore.setProjects(projects);\n    return projects;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get current/active project\n */\nexport async function getCurrentProject(): Promise<Project | null> {\n  try {\n    const response = await http.get<{ project: Project }>('/api/projects/current');\n    const project = response.data.project;\n    if (project) {\n      appStore.setCurrentProject(project);\n      return project;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Create a new project\n */\nexport async function createProject(data: CreateProjectRequest): Promise<Project> {\n  const response = await http.post<{ id: string; name?: string }>('/api/projects', data);\n  \n  const project: Project = {\n    id: response.data.id,\n    name: data.name,\n    description: data.description,\n  };\n\n  // Refresh projects list\n  await getProjects();\n  \n  return project;\n}\n\n/**\n * Update a project\n */\nexport async function updateProject(id: string, data: UpdateProjectRequest): Promise<void> {\n  await http.put(`/api/projects/${id}`, data);\n\n  // Update local state if it's the current project\n  const currentProject = appStore.getState().currentProject;\n  if (currentProject?.id === id) {\n    appStore.setCurrentProject({\n      ...currentProject,\n      ...data,\n    });\n  }\n\n  // Refresh projects list\n  await getProjects();\n}\n\n/**\n * Delete a project\n */\nexport async function deleteProject(id: string): Promise<void> {\n  await http.delete(`/api/projects/${id}`);\n\n  // Clear current project if it was deleted\n  if (appStore.getState().currentProjectId === id) {\n    appStore.setCurrentProject(null);\n  }\n\n  // Refresh projects list\n  await getProjects();\n}\n\n/**\n * Activate/switch to a project\n */\nexport async function activateProject(id: string): Promise<Project | null> {\n  try {\n    await http.put(`/api/projects/${id}/activate`);\n    \n    // Get the full project info\n    const project = await getCurrentProject();\n    return project;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Set a project as default\n */\nexport async function setDefaultProject(id: string): Promise<void> {\n  await http.post(`/api/projects/${id}/set-default`);\n  await getProjects();\n}\n\n/**\n * Get project statistics\n */\nexport async function getProjectStats(id: string): Promise<ProjectStats> {\n  try {\n    const response = await http.get<{ stats: ProjectStats }>(`/api/projects/${id}/stats`);\n    return response.data.stats || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Export project data\n */\nexport async function exportProject(id: string): Promise<Blob> {\n  const response = await fetch(`/api/projects/${id}/export`);\n  if (!response.ok) {\n    throw new Error('Failed to export project');\n  }\n  return response.blob();\n}\n\n/**\n * Import project data\n */\nexport async function importProject(file: File): Promise<Project> {\n  const formData = new FormData();\n  formData.append('file', file);\n\n  const response = await fetch('/api/projects/import', {\n    method: 'POST',\n    body: formData,\n  });\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => ({ error: 'Import failed' }));\n    throw new Error(error.error || 'Import failed');\n  }\n\n  const data = await response.json();\n  await getProjects();\n  \n  return data.project;\n}\n\n/**\n * Initialize projects - load list and set current\n */\nexport async function initProjects(): Promise<void> {\n  // Load all projects\n  await getProjects();\n\n  // Try to get current project from server\n  const current = await getCurrentProject();\n  \n  // If no current project, try to find default or first project\n  if (!current) {\n    const projects = dataStore.getState().projects;\n    if (projects.length > 0) {\n      const defaultProject = projects.find(p => (p as { isDefault?: boolean }).isDefault) || projects[0];\n      await activateProject(defaultProject.id);\n    }\n  }\n}\n\n// Export as namespace\nexport const projects = {\n  getAll: getProjects,\n  getCurrent: getCurrentProject,\n  create: createProject,\n  update: updateProject,\n  delete: deleteProject,\n  activate: activateProject,\n  setDefault: setDefaultProject,\n  getStats: getProjectStats,\n  export: exportProject,\n  import: importProject,\n  init: initProjects,\n};\n","/**\n * Dashboard Service\n * Fetches dashboard data, stats, trends, and health metrics\n */\n\nimport { http } from './api';\n\n// Types\nexport interface DashboardData {\n  documents: {\n    total: number;\n    processed: number;\n    pending: number;\n  };\n  totalFacts: number;\n  factsByCategory?: Record<string, number>;\n  factsVerifiedCount?: number;\n  totalQuestions: number;\n  totalDecisions: number;\n  totalRisks: number;\n  totalActions: number;\n  totalPeople: number;\n  questionsByPriority: {\n    critical: number;\n    high: number;\n    medium: number;\n    resolved: number;\n  };\n  risksByImpact: {\n    high: number;\n    medium: number;\n    low: number;\n  };\n  overdueActions: number;\n  overdueItems: Array<{\n    id: string;\n    content: string;\n    assignee?: string;\n    due_date?: string;\n  }>;\n  questionAging: {\n    fresh: number;    // 0-3 days\n    aging: number;    // 4-7 days\n    stale: number;    // 8-14 days\n    critical: number; // 14+ days\n  };\n  oldestQuestions: Array<{\n    id: string;\n    content: string;\n    created_at: string;\n    priority?: string;\n  }>;\n  trends?: TrendData;\n  trendInsights?: Record<string, unknown>;\n}\n\nexport interface TrendData {\n  hasTrends: boolean;\n  periodDays: number;\n  compareDate: string;\n  facts: TrendMetric;\n  questions: TrendMetric;\n  risks: TrendMetric;\n  actions: TrendMetric;\n  decisions: TrendMetric;\n}\n\nexport interface TrendMetric {\n  current: number;\n  previous: number;\n  delta: number;\n  direction: 'up' | 'down' | 'stable';\n  sentiment: 'positive' | 'negative' | 'neutral';\n}\n\nexport interface TrendHistory {\n  date: string;\n  facts: number;\n  questions: number;\n  risks: number;\n  actions: number;\n  decisions: number;\n  // Index signature for dynamic access\n  [key: string]: string | number;\n}\n\nexport interface HealthData {\n  score: number; // 0-100\n  status: 'Healthy' | 'Good' | 'Needs Attention' | 'At Risk' | 'Critical';\n  color: string;\n  factors: Array<{\n    type: 'positive' | 'negative';\n    factor: string;\n    impact: number;\n    detail: string;\n  }>;\n  calculatedAt: string;\n}\n\nexport interface Insight {\n  type: 'warning' | 'alert' | 'info' | 'positive';\n  icon: string;\n  title: string;\n  message: string;\n  suggestion: string;\n  category: 'workload' | 'risk' | 'timeline' | 'knowledge' | 'progress';\n}\n\nexport interface Alert {\n  severity: 'critical' | 'high' | 'warning';\n  type: 'action' | 'risk' | 'question';\n  title: string;\n  message: string;\n  owner?: string;\n  assignee?: string;\n  id: string | number;\n}\n\n/**\n * Get full dashboard data\n */\nexport async function getDashboard(): Promise<DashboardData | null> {\n  try {\n    const response = await http.get<DashboardData>('/api/dashboard');\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get basic stats\n */\nexport async function getStats(): Promise<{\n  documents: { total: number; processed: number; pending: number };\n  facts: number;\n  questions: { total: number; pending: number; resolved: number; critical: number };\n  decisions: number;\n  risks: number;\n  people: number;\n} | null> {\n  try {\n    const response = await http.get('/api/stats');\n    return response.data as {\n      documents: { total: number; processed: number; pending: number };\n      facts: number;\n      questions: { total: number; pending: number; resolved: number; critical: number };\n      decisions: number;\n      risks: number;\n      people: number;\n    };\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get trends data\n */\nexport async function getTrends(days = 7): Promise<{\n  trends: TrendData;\n  history: TrendHistory[];\n} | null> {\n  try {\n    const response = await http.get<{ trends: TrendData; history: TrendHistory[] }>(`/api/trends?days=${days}`);\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get health score\n */\nexport async function getHealth(): Promise<HealthData | null> {\n  try {\n    const response = await http.get<HealthData>('/api/sot/health');\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get insights\n */\nexport async function getInsights(): Promise<Insight[]> {\n  try {\n    const response = await http.get<{ insights: Insight[] }>('/api/sot/insights');\n    return response.data.insights || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get alerts\n */\nexport async function getAlerts(): Promise<Alert[]> {\n  try {\n    const response = await http.get<{ alerts: Alert[] }>('/api/sot/alerts');\n    return response.data.alerts || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Load all dashboard data in parallel\n */\nexport async function loadDashboardData(): Promise<{\n  dashboard: DashboardData | null;\n  health: HealthData | null;\n  insights: Insight[];\n  alerts: Alert[];\n}> {\n  const [dashboard, health, insights, alerts] = await Promise.all([\n    getDashboard(),\n    getHealth(),\n    getInsights(),\n    getAlerts(),\n  ]);\n\n  return { dashboard, health, insights, alerts };\n}\n\n// Export as namespace\nexport const dashboardService = {\n  getDashboard,\n  getStats,\n  getTrends,\n  getHealth,\n  getInsights,\n  getAlerts,\n  loadAll: loadDashboardData,\n};\n","/**\n * Questions Service\n * Handles question CRUD, answering, and AI suggestions\n */\n\nimport { http } from './api';\n\n// Types\nexport interface Question {\n  id: string | number;\n  content: string;\n  context?: string;\n  priority: 'low' | 'medium' | 'high' | 'critical';\n  status: 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed' | 'open' | 'answered' | 'closed' | 'deferred';\n  assigned_to?: string;\n  assigned_at?: string;\n  answer?: string;\n  answer_source?: 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai';\n  answered_at?: string;\n  answered_by_contact_id?: string;\n  answered_by_name?: string;\n  answer_provenance?: {\n    sources: Array<{ type: string; id?: string; content: string; confidence: number }>;\n    synthesis_method?: string;\n  };\n  category?: string;\n  source_file?: string;\n  created_at: string;\n  updated_at?: string;\n  resolved_at?: string;\n  previous_answer?: string;\n  edit_history?: Array<{\n    answer: string;\n    edited_at: string;\n  }>;\n  cached_suggestions?: AssigneeSuggestion[];\n  suggestions_generated_at?: string;\n  why?: string;\n  confidence?: number;\n  // SOTA fields\n  extracted_entities?: Array<{ type: string; name: string; entity_id?: string; confidence?: number }>;\n  extracted_topics?: Array<{ name: string; type?: string; confidence?: number }>;\n  sla_hours?: number;\n  sla_breached?: boolean;\n  sla_breached_at?: string;\n  follow_up_to?: string;\n  generation_source?: 'manual' | 'extracted' | 'template' | 'ai_generated';\n  cluster_id?: number;\n  cluster_label?: string;\n  // Dismissed tracking\n  dismissed_at?: string;\n  dismissed_by?: string;\n  dismissed_reason?: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other';\n  // Deferred tracking\n  deferred_at?: string;\n  deferred_by?: string;\n  deferred_until?: string;\n  deferred_reason?: string;\n  // Reopened tracking\n  reopened_at?: string;\n  reopened_by?: string;\n  reopened_reason?: string;\n  reopen_count?: number;\n  // Resolution type\n  resolution_type?: 'answered_manual' | 'answered_auto' | 'answered_ai' | 'dismissed' | 'merged' | 'superseded';\n  // Merged/Superseded\n  merged_into_id?: string;\n  superseded_by_id?: string;\n  // Usefulness feedback\n  was_useful?: boolean;\n  usefulness_feedback?: string;\n  // Requester role - who the question is FROM (their perspective)\n  requester_role?: string;\n  requester_role_prompt?: string;\n  requester_contact_id?: string;\n  requester_name?: string;\n}\n\nexport interface CreateQuestionRequest {\n  content: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  assigned_to?: string;\n  context?: string;\n  skipDedup?: boolean;\n}\n\nexport interface UpdateQuestionRequest {\n  content?: string;\n  context?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  status?: 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed';\n  assigned_to?: string;\n  category?: string;\n  reopen_reason?: string;\n  dismissed_reason?: string;\n}\n\nexport interface AnswerQuestionRequest {\n  answer: string;\n  source?: 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai';\n  followupQuestions?: string;\n  answeredByContactId?: string;\n  answeredByName?: string;\n  answerProvenance?: {\n    sources: Array<{ type: string; id?: string; content: string; confidence: number }>;\n    synthesis_method?: string;\n  };\n}\n\nexport interface AssigneeSuggestion {\n  person: string;\n  score: number;\n  reason: string;\n  contactId?: string;\n  role?: string;\n  organization?: string;\n  method: string;\n}\n\nexport interface CreateQuestionResponse {\n  success: boolean;\n  id?: number;\n  action?: string;\n  duplicate?: boolean;\n  existingId?: number;\n  similarity?: number;\n  message?: string;\n}\n\nexport interface AnswerQuestionResponse {\n  success: boolean;\n  question: Question;\n  followupsCreated: number;\n  message: string;\n}\n\nexport interface SuggestAssigneeResponse {\n  suggestions: AssigneeSuggestion[];\n  category: string;\n  method: string;\n  cached: boolean;\n  cachedAt?: string;\n}\n\n/**\n * Get all questions\n */\nexport async function getQuestions(filters?: {\n  status?: string;\n  priority?: string;\n}): Promise<Question[]> {\n  try {\n    const params = new URLSearchParams();\n    if (filters?.status) params.set('status', filters.status);\n    if (filters?.priority) params.set('priority', filters.priority);\n    \n    const query = params.toString();\n    const url = query ? `/api/questions?${query}` : '/api/questions';\n    \n    const response = await http.get<{ questions: Question[] }>(url);\n    return response.data.questions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Create a new question\n */\nexport async function createQuestion(data: CreateQuestionRequest): Promise<CreateQuestionResponse> {\n  const response = await http.post<CreateQuestionResponse>('/api/questions', data);\n  return response.data;\n}\n\n/**\n * Update a question\n */\nexport async function updateQuestion(id: string | number, data: UpdateQuestionRequest): Promise<Question> {\n  const response = await http.put<{ question: Question }>(`/api/questions/${id}`, data);\n  return response.data.question;\n}\n\n/**\n * Delete/dismiss a question\n */\nexport async function deleteQuestion(id: string | number, reason?: string): Promise<void> {\n  await http.delete(`/api/questions/${id}`, {\n    body: JSON.stringify({ reason }),\n  });\n}\n\n/**\n * Answer a question\n */\nexport async function answerQuestion(\n  id: string | number, \n  data: AnswerQuestionRequest\n): Promise<AnswerQuestionResponse> {\n  const response = await http.post<AnswerQuestionResponse>(`/api/questions/${id}/answer`, data);\n  return response.data;\n}\n\n/**\n * Get questions grouped by person\n */\nexport async function getQuestionsByPerson(): Promise<Record<string, Question[]>> {\n  try {\n    const response = await http.get<{ questionsByPerson: Record<string, Question[]> }>('/api/questions/by-person');\n    return response.data.questionsByPerson || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get questions grouped by team/category\n */\nexport async function getQuestionsByTeam(): Promise<Record<string, Question[]>> {\n  try {\n    const response = await http.get<{ questionsByTeam: Record<string, Question[]> }>('/api/questions/by-team');\n    return response.data.questionsByTeam || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get AI-powered assignee suggestions\n */\nexport async function suggestAssignee(options: {\n  content?: string;\n  id?: string | number;\n  useAI?: boolean;\n  refresh?: boolean;\n}): Promise<SuggestAssigneeResponse> {\n  const params = new URLSearchParams();\n  if (options.content) params.set('content', options.content);\n  if (options.id) params.set('id', String(options.id));\n  if (options.useAI === false) params.set('ai', 'false');\n  if (options.refresh) params.set('refresh', 'true');\n\n  const response = await http.get<SuggestAssigneeResponse>(\n    `/api/questions/suggest-assignee?${params.toString()}`,\n    { timeout: 90000 }\n  );\n  return response.data;\n}\n\n/**\n * Reopen a resolved question\n */\nexport async function reopenQuestion(id: string | number, reason: string): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/reopen`, { reason });\n  return response.data.question;\n}\n\n/**\n * Dismiss a question (permanently close without answer)\n */\nexport async function dismissQuestion(\n  id: string | number, \n  reason: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other',\n  details?: string\n): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/dismiss`, { \n    reason,\n    details \n  });\n  return response.data.question;\n}\n\n/**\n * Defer a question (postpone for later)\n */\nexport async function deferQuestion(\n  id: string | number, \n  until: string | Date,\n  reason?: string\n): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/defer`, { \n    until: typeof until === 'string' ? until : until.toISOString(),\n    reason \n  });\n  return response.data.question;\n}\n\n/**\n * Merge a question into another\n */\nexport async function mergeQuestion(\n  sourceId: string | number,\n  targetId: string | number\n): Promise<{ source: Question; target: Question }> {\n  const response = await http.post<{ source: Question; target: Question }>(\n    `/api/questions/${sourceId}/merge`, \n    { targetId }\n  );\n  return response.data;\n}\n\n/**\n * Submit feedback on an answer\n */\nexport async function submitAnswerFeedback(\n  id: string | number,\n  wasUseful: boolean,\n  feedback?: string\n): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/feedback`, { \n    wasUseful,\n    feedback \n  });\n  return response.data.question;\n}\n\n/**\n * Get deferred questions that are due\n */\nexport async function getDueDeferredQuestions(): Promise<Question[]> {\n  try {\n    const response = await http.get<{ questions: Question[] }>('/api/questions/deferred/due');\n    return response.data.questions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get question lifecycle stats\n */\nexport async function getLifecycleStats(): Promise<Record<string, number>> {\n  try {\n    const response = await http.get<{ stats: Record<string, number> }>('/api/questions/stats/lifecycle');\n    return response.data.stats || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get question statistics\n */\nexport function getQuestionStats(questions: Question[]): {\n  total: number;\n  pending: number;\n  assigned: number;\n  resolved: number;\n  critical: number;\n  overdue: number;\n} {\n  const now = new Date();\n  const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n  return {\n    total: questions.length,\n    pending: questions.filter(q => q.status === 'pending').length,\n    assigned: questions.filter(q => q.status === 'assigned').length,\n    resolved: questions.filter(q => q.status === 'resolved').length,\n    critical: questions.filter(q => q.priority === 'critical' && q.status !== 'resolved').length,\n    overdue: questions.filter(q => {\n      if (q.status === 'resolved') return false;\n      const created = new Date(q.created_at);\n      return created < sevenDaysAgo;\n    }).length,\n  };\n}\n\n// Export as namespace\nexport const questionsService = {\n  getAll: getQuestions,\n  create: createQuestion,\n  update: updateQuestion,\n  delete: deleteQuestion,\n  answer: answerQuestion,\n  getByPerson: getQuestionsByPerson,\n  getByTeam: getQuestionsByTeam,\n  suggestAssignee,\n  reopen: reopenQuestion,\n  getStats: getQuestionStats,\n  dismissQuestion,\n  deferQuestion,\n  submitAnswerFeedback,\n};\n","/**\n * Risks Service\n * Handles risk CRUD operations\n */\n\nimport { http } from './api';\n\nexport interface Risk {\n  id: string | number;\n  content: string;\n  title?: string;\n  description?: string;\n  impact: 'low' | 'medium' | 'high' | 'critical';\n  likelihood: 'low' | 'medium' | 'high';\n  mitigation?: string;\n  contingency?: string;\n  status: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\n  owner?: string;\n  category?: 'technical' | 'schedule' | 'budget' | 'resource' | 'scope' | 'external' | 'other';\n  source_file?: string;\n  source_document_id?: string;\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\n  created_at: string;\n  updated_at?: string;\n  deleted_at?: string | null;\n}\n\nexport interface RiskEvent {\n  id: string;\n  risk_id: string;\n  event_type: string;\n  event_data?: Record<string, unknown>;\n  actor_name?: string;\n  created_at: string;\n}\n\nexport interface CreateRiskRequest {\n  content: string;\n  title?: string;\n  impact?: 'low' | 'medium' | 'high' | 'critical';\n  likelihood?: 'low' | 'medium' | 'high';\n  mitigation?: string;\n  owner?: string;\n  category?: string;\n}\n\nexport interface UpdateRiskRequest {\n  content?: string;\n  title?: string;\n  impact?: 'low' | 'medium' | 'high' | 'critical';\n  likelihood?: 'low' | 'medium' | 'high';\n  mitigation?: string;\n  contingency?: string;\n  status?: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\n  owner?: string;\n  category?: string;\n}\n\n/**\n * Get all risks\n */\nexport async function getRisks(status?: string): Promise<Risk[]> {\n  try {\n    const url = status ? `/api/risks?status=${status}` : '/api/risks';\n    const response = await http.get<{ risks: Risk[] }>(url);\n    return response.data.risks || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get a single risk by id\n */\nexport async function getRisk(id: string | number): Promise<Risk | null> {\n  try {\n    const response = await http.get<{ risk: Risk }>(`/api/risks/${id}`);\n    return response.data.risk ?? null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get soft-deleted risks (for restore)\n */\nexport async function getDeletedRisks(): Promise<Risk[]> {\n  try {\n    const response = await http.get<{ risks: Risk[] }>('/api/risks/deleted');\n    return response.data.risks || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Restore a soft-deleted risk\n */\nexport async function restoreRisk(id: string | number): Promise<Risk> {\n  const response = await http.post<{ risk: Risk }>(`/api/risks/${id}/restore`, {});\n  return response.data.risk;\n}\n\n/**\n * Get risk timeline events\n */\nexport async function getRiskEvents(id: string | number): Promise<RiskEvent[]> {\n  try {\n    const response = await http.get<{ events: RiskEvent[] }>(`/api/risks/${id}/events`);\n    return response.data.events || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get risks grouped by category\n */\nexport async function getRisksByCategory(): Promise<Record<string, Risk[]>> {\n  try {\n    const response = await http.get<{ risksByCategory: Record<string, Risk[]> }>('/api/risks/by-category');\n    return response.data.risksByCategory || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Create a new risk\n */\nexport async function createRisk(data: CreateRiskRequest): Promise<Risk> {\n  const response = await http.post<{ risk: Risk; id: string | number }>('/api/risks', data);\n  return response.data.risk || { ...data, id: response.data.id, status: 'open', created_at: new Date().toISOString() } as Risk;\n}\n\n/**\n * Update a risk\n */\nexport async function updateRisk(id: string | number, data: UpdateRiskRequest): Promise<Risk> {\n  const response = await http.put<{ risk: Risk }>(`/api/risks/${id}`, data);\n  return response.data.risk;\n}\n\n/**\n * Delete a risk\n */\nexport async function deleteRisk(id: string | number): Promise<void> {\n  await http.delete(`/api/risks/${id}`);\n}\n\n/**\n * Calculate risk score (impact x likelihood)\n */\nexport function calculateRiskScore(impact: string, likelihood: string): number {\n  const impactScores: Record<string, number> = { low: 1, medium: 2, high: 3, critical: 4 };\n  const likelihoodScores: Record<string, number> = { low: 1, medium: 2, high: 3 };\n  return (impactScores[impact] || 2) * (likelihoodScores[likelihood] || 2);\n}\n\n/**\n * AI suggest owner and mitigation from risk content\n */\nexport interface RiskOwnerSuggestion {\n  name: string;\n  reason: string;\n  score?: number;\n}\n\nexport async function suggestRisk(options: { content: string; impact?: string; likelihood?: string; probability?: string }): Promise<{\n  suggested_owner: string;\n  suggested_mitigation: string;\n  suggested_owners: RiskOwnerSuggestion[];\n}> {\n  const response = await http.post<{\n    suggested_owner?: string;\n    suggested_mitigation?: string;\n    suggested_owners?: RiskOwnerSuggestion[];\n    error?: string;\n  }>('/api/risks/suggest', {\n    content: options.content?.trim() || '',\n    impact: options.impact || 'medium',\n    likelihood: options.likelihood ?? options.probability ?? 'medium',\n  });\n  if (response.data.error) throw new Error(response.data.error);\n  const owners = Array.isArray(response.data.suggested_owners) ? response.data.suggested_owners : [];\n  return {\n    suggested_owner: response.data.suggested_owner ?? (owners[0]?.name ?? ''),\n    suggested_mitigation: response.data.suggested_mitigation ?? '',\n    suggested_owners: owners,\n  };\n}\n\n/**\n * Get risk matrix data\n */\nexport function getRiskMatrixData(risks: Risk[]): Record<string, Risk[]> {\n  const matrix: Record<string, Risk[]> = {};\n  \n  risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed').forEach(risk => {\n    const impact = (risk.impact || '').toString().toLowerCase();\n    const likelihood = (risk.likelihood || '').toString().toLowerCase();\n    const key = `${impact}-${likelihood}`;\n    if (!matrix[key]) matrix[key] = [];\n    matrix[key].push(risk);\n  });\n  \n  return matrix;\n}\n\nexport const risksService = {\n  getAll: getRisks,\n  get: getRisk,\n  getByCategory: getRisksByCategory,\n  getDeleted: getDeletedRisks,\n  restore: restoreRisk,\n  getEvents: getRiskEvents,\n  suggest: suggestRisk,\n  create: createRisk,\n  update: updateRisk,\n  delete: deleteRisk,\n  calculateScore: calculateRiskScore,\n  getMatrixData: getRiskMatrixData,\n};\n","/**\n * Actions Service\n * Handles action item CRUD operations\n */\n\nimport { http } from './api';\n\n/** API returns task, owner, deadline (action_items table). We expose content, assignee, due_date for UI. */\nexport interface Action {\n  id: string | number;\n  /** UI: use content; API may return task */\n  content?: string;\n  task?: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  /** UI: use assignee; API may return owner */\n  assignee?: string;\n  owner?: string;\n  /** UI: use due_date; API may return deadline */\n  due_date?: string;\n  deadline?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  source_file?: string;\n  source_document_id?: string;\n  depends_on?: string[];\n  blocked_by?: string[];\n  created_at: string;\n  updated_at?: string;\n  completed_at?: string;\n}\n\nexport interface CreateActionRequest {\n  content: string;\n  status?: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  assignee?: string;\n  due_date?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n}\n\nexport interface UpdateActionRequest {\n  content?: string;\n  task?: string;\n  status?: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  assignee?: string;\n  owner?: string;\n  due_date?: string;\n  deadline?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  depends_on?: string[];\n  blocked_by?: string[];\n}\n\n/** Normalize API row (task, owner, deadline) to UI shape (content, assignee, due_date) */\nfunction normalizeAction(row: Record<string, unknown>): Action {\n  return {\n    ...row,\n    content: (row.content ?? row.task) as string,\n    assignee: (row.assignee ?? row.owner) as string | undefined,\n    due_date: (row.due_date ?? row.deadline) as string | undefined,\n  } as Action;\n}\n\n/**\n * Get all actions\n */\nexport async function getActions(status?: string): Promise<Action[]> {\n  try {\n    const url = status ? `/api/actions?status=${status}` : '/api/actions';\n    const response = await http.get<{ actions: Record<string, unknown>[] }>(url);\n    const raw = response.data.actions || [];\n    return raw.map(normalizeAction);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Create a new action\n */\nexport async function createAction(data: CreateActionRequest): Promise<Action> {\n  const payload = {\n    content: data.content,\n    task: data.content,\n    assignee: data.assignee,\n    owner: data.assignee,\n    due_date: data.due_date,\n    deadline: data.due_date,\n    status: data.status,\n    priority: data.priority,\n  };\n  const response = await http.post<{ action: Record<string, unknown>; id: string | number }>('/api/actions', payload);\n  const raw = response.data.action || { ...payload, id: response.data.id, created_at: new Date().toISOString() };\n  return normalizeAction(raw);\n}\n\n/**\n * Update an action\n */\nexport async function updateAction(id: string | number, data: UpdateActionRequest): Promise<Action> {\n  const payload = {\n    ...data,\n    task: data.content ?? data.task,\n    owner: data.assignee ?? data.owner,\n    deadline: data.due_date ?? data.deadline,\n  };\n  const response = await http.put<{ action: Record<string, unknown> }>(`/api/actions/${id}`, payload);\n  const raw = response.data.action;\n  return raw ? normalizeAction(raw) : {} as Action;\n}\n\n/**\n * Delete an action\n */\nexport async function deleteAction(id: string | number): Promise<void> {\n  await http.delete(`/api/actions/${id}`);\n}\n\nexport interface ActionEvent {\n  id: string;\n  action_id: string;\n  event_type: string;\n  event_data?: Record<string, unknown>;\n  actor_name?: string;\n  created_at: string;\n}\n\nexport interface ActionAssigneeSuggestion {\n  name: string;\n  reason?: string;\n  score?: number;\n}\n\n/**\n * Suggest assignees for an action from task content (AI + project contacts).\n */\nexport async function suggestAssignees(options: { content: string }): Promise<{ suggested_assignees: ActionAssigneeSuggestion[] }> {\n  try {\n    const response = await http.post<{ suggested_assignees: ActionAssigneeSuggestion[] }>('/api/actions/suggest', {\n      content: (options.content || '').trim(),\n    });\n    return {\n      suggested_assignees: Array.isArray(response.data.suggested_assignees) ? response.data.suggested_assignees : [],\n    };\n  } catch {\n    return { suggested_assignees: [] };\n  }\n}\n\n/**\n * Get action timeline events\n */\nexport async function getActionEvents(id: string | number): Promise<ActionEvent[]> {\n  try {\n    const response = await http.get<{ events: ActionEvent[] }>(`/api/actions/${id}/events`);\n    return response.data.events || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Check if action is overdue\n */\nexport function isOverdue(action: Action): boolean {\n  if (!action.due_date || action.status === 'completed' || action.status === 'cancelled') {\n    return false;\n  }\n  return new Date(action.due_date) < new Date();\n}\n\n/**\n * Get action statistics\n */\nexport function getActionStats(actions: Action[]): {\n  total: number;\n  pending: number;\n  inProgress: number;\n  completed: number;\n  overdue: number;\n} {\n  return {\n    total: actions.length,\n    pending: actions.filter(a => a.status === 'pending').length,\n    inProgress: actions.filter(a => a.status === 'in_progress').length,\n    completed: actions.filter(a => a.status === 'completed').length,\n    overdue: actions.filter(a => isOverdue(a)).length,\n  };\n}\n\nexport const actionsService = {\n  getAll: getActions,\n  create: createAction,\n  update: updateAction,\n  delete: deleteAction,\n  getEvents: getActionEvents,\n  suggest: suggestAssignees,\n  isOverdue,\n  getStats: getActionStats,\n};\n","/**\n * Decisions Service\n * Handles decision CRUD operations\n */\n\nimport { http } from './api';\n\nexport interface Decision {\n  id: string | number;\n  content: string;\n  status: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\n  rationale?: string;\n  made_by?: string;\n  approved_by?: string;\n  decided_at?: string;\n  impact?: 'low' | 'medium' | 'high';\n  reversible?: boolean;\n  source?: string;\n  source_file?: string;\n  source_document_id?: string;\n  owner?: string;\n  context?: string;\n  decision_date?: string;\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\n  created_at: string;\n  updated_at?: string;\n  summary?: string;\n}\n\nexport interface DecisionSuggestResponse {\n  rationale: string;\n  impact: 'high' | 'medium' | 'low';\n  impact_summary: string;\n  summary: string;\n}\n\nexport interface DecisionOwnerSuggestion {\n  name: string;\n  reason?: string;\n  score?: number;\n}\n\nexport interface DecisionEvent {\n  id: string;\n  decision_id: string;\n  event_type: string;\n  event_data?: Record<string, unknown>;\n  actor_user_id?: string;\n  actor_name?: string;\n  created_at: string;\n}\n\nexport interface DecisionConflict {\n  decisionId1: string | number;\n  decisionId2: string | number;\n  decision1: Decision;\n  decision2: Decision;\n  conflictType: string;\n  description?: string;\n  reason?: string;\n  confidence?: number;\n}\n\nexport interface SimilarDecisionItem {\n  decision: Decision;\n  similarityScore: number;\n}\n\nexport interface CreateDecisionRequest {\n  content: string;\n  status?: 'proposed' | 'approved' | 'rejected' | 'deferred';\n  rationale?: string;\n  made_by?: string;\n  impact?: 'low' | 'medium' | 'high';\n  summary?: string;\n}\n\nexport interface UpdateDecisionRequest {\n  content?: string;\n  status?: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\n  rationale?: string;\n  made_by?: string;\n  approved_by?: string;\n  decided_at?: string;\n  impact?: 'low' | 'medium' | 'high';\n  reversible?: boolean;\n  summary?: string;\n}\n\n/**\n * Get all decisions\n */\nexport async function getDecisions(status?: string): Promise<Decision[]> {\n  try {\n    const url = status ? `/api/decisions?status=${status}` : '/api/decisions';\n    const response = await http.get<{ decisions: Decision[] }>(url);\n    return response.data.decisions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get a single decision\n */\nexport async function getDecision(id: string | number): Promise<Decision | null> {\n  try {\n    const response = await http.get<{ decision: Decision }>(`/api/decisions/${id}`);\n    return response.data.decision;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * List soft-deleted decisions (for restore / undo)\n */\nexport async function getDeletedDecisions(): Promise<Decision[]> {\n  try {\n    const response = await http.get<{ decisions: Decision[] }>('/api/decisions/deleted');\n    return response.data.decisions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Restore a soft-deleted decision\n */\nexport async function restoreDecision(id: string | number): Promise<Decision> {\n  const response = await http.post<{ decision: Decision }>(`/api/decisions/${id}/restore`, {});\n  return response.data.decision;\n}\n\n/**\n * Get decision events (timeline)\n */\nexport async function getDecisionEvents(decisionId: string | number): Promise<DecisionEvent[]> {\n  try {\n    const response = await http.get<{ events: DecisionEvent[] }>(`/api/decisions/${decisionId}/events`);\n    return response.data.events || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get similar decisions\n */\nexport async function getSimilarDecisions(decisionId: string | number, limit = 10): Promise<SimilarDecisionItem[]> {\n  try {\n    const params = new URLSearchParams();\n    if (limit !== 10) params.set('limit', String(limit));\n    const query = params.toString();\n    const url = query ? `/api/decisions/${decisionId}/similar?${query}` : `/api/decisions/${decisionId}/similar`;\n    const response = await http.get<{ similar: SimilarDecisionItem[] }>(url);\n    return response.data.similar || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Run decision-check (AI conflict detection, records events)\n */\nexport async function runDecisionCheck(): Promise<{ ok: boolean; conflicts: DecisionConflict[]; analyzed_decisions: number; events_recorded: number }> {\n  const response = await http.post<{ ok: boolean; conflicts: DecisionConflict[]; analyzed_decisions: number; events_recorded: number }>('/api/decision-check/run', {});\n  return response.data;\n}\n\n/**\n * Detect conflicts between decisions (no events recorded)\n */\nexport async function detectConflicts(): Promise<DecisionConflict[]> {\n  try {\n    const response = await http.get<{ conflicts: DecisionConflict[] }>('/api/conflicts/decisions');\n    return response.data.conflicts || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * AI suggest: rationale, impact, impact_summary, one-line summary from decision content\n */\nexport async function suggest(content: string, rationale?: string): Promise<DecisionSuggestResponse> {\n  const response = await http.post<DecisionSuggestResponse>('/api/decisions/suggest', {\n    content: content.trim(),\n    rationale: rationale?.trim() || '',\n  });\n  return response.data;\n}\n\n/**\n * AI suggest owner (made_by) from decision content; backend uses project contacts only.\n */\nexport async function suggestOwner(content: string, rationale?: string): Promise<{ suggested_owners: DecisionOwnerSuggestion[] }> {\n  const response = await http.post<{ suggested_owners: DecisionOwnerSuggestion[] }>('/api/decisions/suggest-owner', {\n    content: content.trim(),\n    rationale: rationale?.trim() || '',\n  });\n  return response.data;\n}\n\n/**\n * Create a new decision\n */\nexport async function createDecision(data: CreateDecisionRequest): Promise<Decision> {\n  const response = await http.post<{ decision: Decision; id: string | number }>('/api/decisions', data);\n  return response.data.decision || { ...data, id: response.data.id, status: data.status || 'proposed', created_at: new Date().toISOString() } as Decision;\n}\n\n/**\n * Update a decision\n */\nexport async function updateDecision(id: string | number, data: UpdateDecisionRequest): Promise<Decision> {\n  const response = await http.put<{ decision: Decision }>(`/api/decisions/${id}`, data);\n  return response.data.decision;\n}\n\n/**\n * Delete a decision\n */\nexport async function deleteDecision(id: string | number): Promise<void> {\n  await http.delete(`/api/decisions/${id}`);\n}\n\n/**\n * Approve a decision\n */\nexport async function approveDecision(id: string | number, approvedBy: string): Promise<Decision> {\n  return updateDecision(id, {\n    status: 'approved',\n    approved_by: approvedBy,\n    decided_at: new Date().toISOString(),\n  });\n}\n\n/**\n * Reject a decision\n */\nexport async function rejectDecision(id: string | number, rationale?: string): Promise<Decision> {\n  return updateDecision(id, {\n    status: 'rejected',\n    rationale,\n    decided_at: new Date().toISOString(),\n  });\n}\n\nexport const decisionsService = {\n  getAll: getDecisions,\n  get: getDecision,\n  create: createDecision,\n  update: updateDecision,\n  delete: deleteDecision,\n  approve: approveDecision,\n  reject: rejectDecision,\n  getDeletedDecisions,\n  restore: restoreDecision,\n  getEvents: getDecisionEvents,\n  getSimilarDecisions,\n  runDecisionCheck,\n  detectConflicts,\n  suggest,\n  suggestOwner,\n};\n","/**\n * Chat Service\n * Handles chat and AI interactions\n */\n\nimport { http } from './api';\n\nexport interface ChatMessage {\n  id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: string;\n  sources?: ChatSource[];\n  contextQuality?: 'high' | 'medium' | 'low' | 'none';\n}\n\nexport interface ChatSource {\n  type: 'fact' | 'document' | 'question' | 'decision';\n  id: string | number;\n  title?: string;\n  excerpt?: string;\n}\n\nexport interface ChatRequest {\n  message: string;\n  context?: string;\n  history?: Array<{ role: string; content: string }>;\n  semantic?: boolean;\n  deepReasoning?: boolean;\n}\n\nexport interface ChatResponse {\n  message: string;\n  response: string;\n  sources: ChatSource[];\n  contextQuality: 'high' | 'medium' | 'low' | 'none';\n}\n\nexport interface AskRequest {\n  question: string;\n  model?: string;\n}\n\nexport interface AskResponse {\n  question: string;\n  answer: string;\n  sources: {\n    facts: number;\n    questions: number;\n    decisions: number;\n    knowledgeItems: number;\n  };\n}\n\nexport interface SotChatRequest {\n  message: string;\n  model?: string;\n}\n\nexport interface SotChatResponse {\n  response: string;\n  model: string;\n  healthScore: number;\n}\n\nexport interface BriefingResponse {\n  briefing: string;\n  analysis: string;\n  generated_at: string;\n  stats: Record<string, number>;\n  cached: boolean;\n  cacheSource?: 'supabase' | 'memory';\n}\n\nexport interface BriefingHistoryItem {\n  id: string;\n  briefing: string;\n  generated_at: string;\n}\n\n// Type alias for backwards compatibility\nexport type Briefing = BriefingResponse;\n\n// Chat history for context\nlet chatHistory: ChatMessage[] = [];\n\n/**\n * Send a chat message\n */\nexport async function sendMessage(request: ChatRequest): Promise<ChatResponse> {\n  const response = await http.post<ChatResponse>('/api/chat', {\n    message: request.message,\n    context: request.context,\n    history: request.history || chatHistory.slice(-10).map(m => ({\n      role: m.role,\n      content: m.content,\n    })),\n    semantic: request.semantic ?? true,\n    deepReasoning: request.deepReasoning ?? false,\n  });\n\n  // Add to history\n  const userMessage: ChatMessage = {\n    id: `msg-${Date.now()}-user`,\n    role: 'user',\n    content: request.message,\n    timestamp: new Date().toISOString(),\n  };\n\n  const assistantMessage: ChatMessage = {\n    id: `msg-${Date.now()}-assistant`,\n    role: 'assistant',\n    content: response.data.response,\n    timestamp: new Date().toISOString(),\n    sources: response.data.sources,\n    contextQuality: response.data.contextQuality,\n  };\n\n  chatHistory.push(userMessage, assistantMessage);\n\n  return response.data;\n}\n\n/**\n * Ask a question about the knowledge base\n */\nexport async function ask(request: AskRequest): Promise<AskResponse> {\n  const response = await http.post<AskResponse>('/api/ask', request);\n  return response.data;\n}\n\n/**\n * Chat with SOT context\n */\nexport async function sotChat(request: SotChatRequest): Promise<SotChatResponse> {\n  const response = await http.post<SotChatResponse>('/api/sot/chat', request);\n  return response.data;\n}\n\n/**\n * Get daily briefing\n */\nexport async function getBriefing(refresh = false): Promise<BriefingResponse> {\n  const url = refresh ? '/api/briefing?refresh=true' : '/api/briefing';\n  const response = await http.get<BriefingResponse>(url);\n  return response.data;\n}\n\n/**\n * Get briefing history\n */\nexport async function getBriefingHistory(limit = 30): Promise<BriefingHistoryItem[]> {\n  const response = await http.get<{ history: BriefingHistoryItem[]; total: number }>(`/api/briefing/history?limit=${limit}`);\n  return response.data.history || [];\n}\n\n/**\n * Get weekly report\n */\nexport async function getWeeklyReport(): Promise<string> {\n  const response = await http.get<string>('/api/reports/weekly');\n  return typeof response.data === 'string' ? response.data : '';\n}\n\n/**\n * Generate executive summary\n */\nexport async function generateExecutiveSummary(): Promise<string> {\n  const response = await http.post<{ summary: string }>('/api/sot/executive-summary');\n  return response.data.summary || '';\n}\n\n/**\n * Get chat history\n */\nexport function getChatHistory(): ChatMessage[] {\n  return [...chatHistory];\n}\n\n/**\n * Clear chat history\n */\nexport function clearChatHistory(): void {\n  chatHistory = [];\n}\n\n/**\n * Add message to history\n */\nexport function addToHistory(message: ChatMessage): void {\n  chatHistory.push(message);\n}\n\nexport const chatService = {\n  send: sendMessage,\n  ask,\n  sotChat,\n  getBriefing,\n  getBriefingHistory,\n  getWeeklyReport,\n  generateExecutiveSummary,\n  getHistory: getChatHistory,\n  clearHistory: clearChatHistory,\n  addToHistory,\n};\n","/**\n * Contacts Service\n * Handles contact and team CRUD operations\n */\n\nimport { http } from './api';\n\nexport interface Contact {\n  id: string;\n  name: string;\n  email?: string;\n  phone?: string;\n  organization?: string;\n  company?: string;\n  role?: string;\n  rolePrompt?: string;\n  department?: string;\n  linkedin?: string;\n  timezone?: string;\n  location?: string;\n  photoUrl?: string;\n  avatarUrl?: string;\n  photo_url?: string;\n  avatar_url?: string;\n  tags?: string[];\n  notes?: string;\n  aliases?: string[];\n  isFavorite?: boolean;\n  is_favorite?: boolean;\n  relationships?: Array<{\n    contactId: string;\n    type: 'reports_to' | 'works_with' | 'manages' | 'collaborates';\n  }>;\n  activity?: Array<{\n    type: 'conversation' | 'document' | 'transcript';\n    id: string;\n    title: string;\n    date: string;\n  }>;\n  teams?: Array<{\n    id: string;\n    name: string;\n    color: string;\n  }>;\n  created_at: string;\n  updated_at?: string;\n}\n\nexport interface Team {\n  id: string;\n  name: string;\n  description?: string;\n  color?: string;\n  team_type?: 'team' | 'department' | 'organization' | 'group';\n  memberCount?: number;\n  memberDetails?: Array<{\n    contactId: string;\n    name: string;\n    role: string;\n    isLead: boolean;\n  }>;\n  created_at: string;\n}\n\nexport interface CreateContactRequest {\n  name: string;\n  email?: string;\n  phone?: string;\n  organization?: string;\n  role?: string;\n  department?: string;\n  tags?: string[];\n  notes?: string;\n}\n\nexport interface UpdateContactRequest {\n  name?: string;\n  email?: string;\n  phone?: string;\n  organization?: string;\n  role?: string;\n  rolePrompt?: string;\n  department?: string;\n  linkedin?: string;\n  timezone?: string;\n  photoUrl?: string;\n  tags?: string[];\n  notes?: string;\n  aliases?: string[];\n}\n\nexport interface CreateTeamRequest {\n  name: string;\n  description?: string;\n  color?: string;\n  team_type?: 'team' | 'department' | 'organization' | 'group';\n}\n\n/**\n * Get all contacts\n */\nexport async function getContacts(filters?: {\n  organization?: string;\n  tag?: string;\n  search?: string;\n}): Promise<{ contacts: Contact[]; total: number }> {\n  try {\n    const params = new URLSearchParams();\n    if (filters?.organization) params.set('organization', filters.organization);\n    if (filters?.tag) params.set('tag', filters.tag);\n    if (filters?.search) params.set('search', filters.search);\n    \n    const query = params.toString();\n    const url = query ? `/api/contacts?${query}` : '/api/contacts';\n    \n    const response = await http.get<{ contacts: Contact[]; total: number }>(url);\n    const rawContacts = response.data.contacts || [];\n    \n    // Normalize field names (API uses snake_case, frontend uses camelCase)\n    const contacts = rawContacts.map(c => ({\n      ...c,\n      photoUrl: c.photo_url || c.avatar_url || c.photoUrl || c.avatarUrl,\n      avatarUrl: c.avatar_url || c.photo_url || c.avatarUrl || c.photoUrl,\n      isFavorite: c.is_favorite ?? c.isFavorite ?? false,\n      company: c.organization || c.company,\n    }));\n    \n    return { contacts, total: response.data.total || contacts.length };\n  } catch (error) {\n    console.error('[ContactsService] Failed to get contacts:', error);\n    return { contacts: [], total: 0 };\n  }\n}\n\n/**\n * Get a single contact\n */\nexport async function getContact(id: string): Promise<Contact | null> {\n  try {\n    const response = await http.get<{ contact: Contact }>(`/api/contacts/${id}`);\n    return response.data.contact;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Create a new contact\n */\nexport async function createContact(data: CreateContactRequest): Promise<Contact> {\n  const response = await http.post<{ id: string; ok: boolean }>('/api/contacts', data);\n  return { ...data, id: response.data.id, created_at: new Date().toISOString() } as Contact;\n}\n\n/**\n * Update a contact\n */\nexport async function updateContact(id: string, data: UpdateContactRequest): Promise<void> {\n  await http.put(`/api/contacts/${id}`, data);\n}\n\n/**\n * Delete a contact\n */\nexport async function deleteContact(id: string): Promise<void> {\n  await http.delete(`/api/contacts/${id}`);\n}\n\n/**\n * Get contact stats\n */\nexport async function getContactStats(): Promise<Record<string, number>> {\n  const response = await http.get<{ ok: boolean } & Record<string, number>>('/api/contacts/stats');\n  return response.data;\n}\n\n/**\n * Find contact by name\n */\nexport async function findContactByName(name: string): Promise<Contact | null> {\n  try {\n    const response = await http.get<{ found: boolean; contact: Contact | null }>(`/api/contacts/find-by-name?name=${encodeURIComponent(name)}`);\n    return response.data.found ? response.data.contact : null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get duplicate contacts\n */\nexport async function getDuplicates(): Promise<{ duplicates: Contact[][]; groups: number }> {\n  const response = await http.get<{ duplicates: Contact[][]; groups: number }>('/api/contacts/duplicates');\n  return response.data;\n}\n\n/**\n * Merge contacts\n */\nexport async function mergeContacts(contactIds: string[]): Promise<string> {\n  const response = await http.post<{ mergedId: string }>('/api/contacts/merge', { contactIds });\n  return response.data.mergedId;\n}\n\n/**\n * Enrich contact with AI\n */\nexport async function enrichContact(id: string): Promise<{\n  role?: string;\n  department?: string;\n  tags?: string[];\n  additionalNotes?: string;\n}> {\n  const response = await http.post<{ suggestions: Record<string, unknown> }>(`/api/contacts/${id}/enrich`);\n  return response.data.suggestions as {\n    role?: string;\n    department?: string;\n    tags?: string[];\n    additionalNotes?: string;\n  };\n}\n\n/**\n * Export contacts in specified format\n */\nexport async function exportContacts(format: 'json' | 'csv' = 'json'): Promise<void> {\n  try {\n    const response = await fetch(`/api/contacts/export?format=${format}`);\n    if (!response.ok) throw new Error('Export failed');\n    \n    const blob = await response.blob();\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `contacts-export.${format}`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  } catch (error) {\n    console.error('Export failed:', error);\n    throw error;\n  }\n}\n\n/**\n * Get contact with all associations (teams, projects)\n */\nexport async function getContactWithAssociations(id: string): Promise<Contact & {\n  projects?: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }>;\n} | null> {\n  try {\n    const response = await http.get<{ \n      contact: Contact & { \n        projects?: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }> \n      } \n    }>(`/api/contacts/${id}/associations`);\n    return response.data.contact;\n  } catch {\n    // Fallback to regular get if associations endpoint not available\n    return getContact(id);\n  }\n}\n\n/**\n * Add contact to a project\n */\nexport async function addContactToProject(contactId: string, projectId: string, options?: {\n  role?: string;\n  isPrimary?: boolean;\n}): Promise<void> {\n  await http.post(`/api/contacts/${contactId}/projects`, { projectId, ...options });\n}\n\n/**\n * Remove contact from a project\n */\nexport async function removeContactFromProject(contactId: string, projectId: string): Promise<void> {\n  await http.delete(`/api/contacts/${contactId}/projects/${projectId}`);\n}\n\n/**\n * Get projects a contact belongs to\n */\nexport async function getContactProjects(contactId: string): Promise<Array<{\n  id: string;\n  name: string;\n  role?: string;\n  isPrimary?: boolean;\n}>> {\n  try {\n    const response = await http.get<{ projects: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }> }>(\n      `/api/contacts/${contactId}/projects`\n    );\n    return response.data.projects || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get all teams\n */\nexport async function getTeams(): Promise<Team[]> {\n  try {\n    const response = await http.get<{ teams: Team[] }>('/api/teams');\n    return response.data.teams || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get a single team with members\n */\nexport async function getTeam(id: string): Promise<{ team: Team; members: Contact[] } | null> {\n  try {\n    const response = await http.get<{ team: Team; members: Contact[] }>(`/api/teams/${id}`);\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Create a new team\n */\nexport async function createTeam(data: CreateTeamRequest): Promise<Team> {\n  const response = await http.post<{ id: string; ok: boolean }>('/api/teams', data);\n  return { ...data, id: response.data.id, created_at: new Date().toISOString() } as Team;\n}\n\n/**\n * Update a team\n */\nexport async function updateTeam(id: string, data: Partial<CreateTeamRequest>): Promise<void> {\n  await http.put(`/api/teams/${id}`, data);\n}\n\n/**\n * Delete a team\n */\nexport async function deleteTeam(id: string): Promise<void> {\n  await http.delete(`/api/teams/${id}`);\n}\n\n/**\n * Add member to team\n */\nexport async function addTeamMember(teamId: string, contactId: string, role?: string, isLead = false): Promise<void> {\n  await http.post(`/api/teams/${teamId}/members`, { contactId, role, isLead });\n}\n\n/**\n * Remove member from team\n */\nexport async function removeTeamMember(teamId: string, contactId: string): Promise<void> {\n  await http.delete(`/api/teams/${teamId}/members/${contactId}`);\n}\n\nexport const contactsService = {\n  getAll: getContacts,\n  get: getContact,\n  create: createContact,\n  update: updateContact,\n  delete: deleteContact,\n  getStats: getContactStats,\n  findByName: findContactByName,\n  getDuplicates,\n  merge: mergeContacts,\n  mergeContacts,\n  enrich: enrichContact,\n  export: exportContacts,\n  getWithAssociations: getContactWithAssociations,\n  addToProject: addContactToProject,\n  removeFromProject: removeContactFromProject,\n  getProjects: getContactProjects,\n};\n\nexport const teamsService = {\n  getAll: getTeams,\n  get: getTeam,\n  create: createTeam,\n  update: updateTeam,\n  delete: deleteTeam,\n  addMember: addTeamMember,\n  removeMember: removeTeamMember,\n};\n","/**\n * Documents Service\n * Handles file upload, processing, and document management\n */\n\nimport { http } from './api';\nimport { toast } from './toast';\n\nexport interface Document {\n  id: string;\n  filename: string;\n  originalName: string;\n  mimeType: string;\n  size: number;\n  path?: string;\n  content?: string;\n  summary?: string;\n  metadata?: Record<string, unknown>;\n  status: 'pending' | 'processing' | 'processed' | 'failed';\n  processingError?: string;\n  facts_count?: number;\n  questions_count?: number;\n  created_at: string;\n  processed_at?: string;\n}\n\nexport interface UploadResult {\n  success: boolean;\n  files: Array<{\n    filename: string;\n    id: string;\n    size: number;\n    status: string;\n  }>;\n  totalSize: number;\n  processingStarted: boolean;\n}\n\nexport interface ProcessingStatus {\n  isProcessing: boolean;\n  queueLength: number;\n  completedCount: number;\n  errorCount: number;\n  pendingFiles: string[];\n  processingFile?: string;\n  completedFiles: string[];\n  errors: Array<{ file: string; error: string }>;\n}\n\nexport interface EmbeddingStatus {\n  total: number;\n  totalChunks?: number;\n  embedded: number;\n  pending: number;\n  failed?: number;\n  model?: string;\n  models: string[];\n  available_embedding_models?: string[];\n  lastUpdated?: string;\n}\n\nexport interface KnowledgeItem {\n  id: string;\n  content: string;\n  category?: string;\n  source?: string;\n  embedding?: number[];\n  created_at: string;\n}\n\nexport interface Conversation {\n  id: string;\n  participants: string[];\n  subject?: string;\n  summary?: string;\n  messages: Array<{\n    from: string;\n    content: string;\n    timestamp: string;\n  }>;\n  source_file?: string;\n  created_at: string;\n}\n\n/**\n * Upload files\n */\nexport async function uploadFiles(files: File[], onProgress?: (progress: number) => void): Promise<UploadResult> {\n  const formData = new FormData();\n  files.forEach(file => {\n    formData.append('files', file);\n  });\n\n  const xhr = new XMLHttpRequest();\n  \n  return new Promise((resolve, reject) => {\n    xhr.upload.addEventListener('progress', (e) => {\n      if (e.lengthComputable && onProgress) {\n        onProgress(Math.round((e.loaded / e.total) * 100));\n      }\n    });\n\n    xhr.addEventListener('load', () => {\n      if (xhr.status >= 200 && xhr.status < 300) {\n        try {\n          resolve(JSON.parse(xhr.responseText));\n        } catch {\n          reject(new Error('Invalid response'));\n        }\n      } else {\n        reject(new Error(`Upload failed: ${xhr.statusText}`));\n      }\n    });\n\n    xhr.addEventListener('error', () => {\n      reject(new Error('Upload failed'));\n    });\n\n    xhr.open('POST', '/api/upload');\n    xhr.send(formData);\n  });\n}\n\n/**\n * Upload single file with text extraction\n */\nexport async function uploadWithExtraction(file: File): Promise<{\n  id: string;\n  text: string;\n  pageCount?: number;\n}> {\n  const formData = new FormData();\n  formData.append('file', file);\n\n  const response = await fetch('/api/upload-extract', {\n    method: 'POST',\n    body: formData,\n  });\n\n  if (!response.ok) {\n    throw new Error('Upload failed');\n  }\n\n  return response.json();\n}\n\n/**\n * Get processing status\n */\nexport async function getProcessingStatus(): Promise<ProcessingStatus> {\n  const response = await http.get<ProcessingStatus>('/api/processing-status');\n  return response.data;\n}\n\nexport interface DocumentsResponse {\n  documents: Document[];\n  total: number;\n  limit?: number;\n  offset?: number;\n  hasMore?: boolean;\n  statuses: {\n    processed: number;\n    pending: number;\n    processing?: number;\n    failed: number;\n    deleted?: number;\n  };\n}\n\n/**\n * Get all documents with optional status filter\n */\nexport interface GetDocumentsOptions {\n  status?: string;\n  type?: string; // documents, transcripts, emails, images\n  search?: string;\n  sort?: 'created_at' | 'updated_at' | 'filename';\n  order?: 'asc' | 'desc';\n  limit?: number;\n  offset?: number;\n}\n\nexport async function getDocuments(statusOrOptions?: string | GetDocumentsOptions): Promise<DocumentsResponse> {\n  try {\n    // Handle both legacy (status string) and new options object\n    const options: GetDocumentsOptions = typeof statusOrOptions === 'string' \n      ? { status: statusOrOptions }\n      : statusOrOptions || {};\n    \n    const params = new URLSearchParams();\n    if (options.status && options.status !== 'all') params.set('status', options.status);\n    if (options.type && options.type !== 'all') params.set('type', options.type);\n    if (options.search) params.set('search', options.search);\n    if (options.sort) params.set('sort', options.sort);\n    if (options.order) params.set('order', options.order);\n    if (options.limit) params.set('limit', String(options.limit));\n    if (options.offset) params.set('offset', String(options.offset));\n    \n    const queryString = params.toString();\n    const url = queryString ? `/api/documents?${queryString}` : '/api/documents';\n    \n    const response = await http.get<DocumentsResponse>(url);\n    return {\n      documents: response.data.documents || [],\n      total: response.data.total || 0,\n      limit: response.data.limit,\n      offset: response.data.offset,\n      hasMore: response.data.hasMore,\n      statuses: response.data.statuses || { processed: 0, pending: 0, failed: 0, deleted: 0 }\n    };\n  } catch {\n    return { documents: [], total: 0, statuses: { processed: 0, pending: 0, failed: 0, deleted: 0 } };\n  }\n}\n\n/**\n * Get a single document\n */\nexport async function getDocument(id: string): Promise<Document | null> {\n  try {\n    const response = await http.get<{ document: Document }>(`/api/documents/${id}`);\n    return response.data.document;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Delete a document\n */\nexport async function deleteDocument(id: string, options?: { softDelete?: boolean }): Promise<void> {\n  const params = options?.softDelete ? '?soft=true' : '';\n  await http.delete(`/api/documents/${id}${params}`);\n}\n\n/**\n * Restore a soft-deleted document\n */\nexport async function restoreDocument(id: string): Promise<void> {\n  await http.post(`/api/documents/${id}/restore`);\n  toast.success('Document restored');\n}\n\n/**\n * Reprocess a document\n */\nexport async function reprocessDocument(id: string): Promise<void> {\n  await http.post(`/api/documents/${id}/reprocess`);\n  toast.info('Document queued for reprocessing');\n}\n\n/**\n * Get document summary\n */\nexport async function getDocumentSummary(id: string): Promise<string> {\n  const response = await http.get<{ summary: string }>(`/api/documents/${id}/summary`);\n  return response.data.summary || '';\n}\n\n/**\n * Get knowledge base items\n */\nexport async function getKnowledgeBase(category?: string): Promise<KnowledgeItem[]> {\n  try {\n    const url = category ? `/api/knowledge?category=${category}` : '/api/knowledge';\n    const response = await http.get<{ items: KnowledgeItem[] }>(url);\n    return response.data.items || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Add knowledge item\n */\nexport async function addKnowledgeItem(content: string, category?: string): Promise<KnowledgeItem> {\n  const response = await http.post<{ item: KnowledgeItem; id: string }>('/api/knowledge', {\n    content,\n    category,\n  });\n  return response.data.item || { id: response.data.id, content, category, created_at: new Date().toISOString() };\n}\n\n/**\n * Search knowledge base\n */\nexport async function searchKnowledge(query: string, limit = 10): Promise<KnowledgeItem[]> {\n  const response = await http.get<{ results: KnowledgeItem[] }>(`/api/knowledge/search?q=${encodeURIComponent(query)}&limit=${limit}`);\n  return response.data.results || [];\n}\n\n/**\n * Get conversations\n */\nexport async function getConversations(): Promise<Conversation[]> {\n  try {\n    const response = await http.get<{ conversations: Conversation[] }>('/api/conversations');\n    return response.data.conversations || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get a single conversation\n */\nexport async function getConversation(id: string): Promise<Conversation | null> {\n  try {\n    const response = await http.get<{ conversation: Conversation }>(`/api/conversations/${id}`);\n    return response.data.conversation;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Parse conversation preview (without saving)\n */\nexport async function parseConversationPreview(text: string): Promise<{\n  message_count: number;\n  participants: string[];\n  format: string;\n  preview: unknown[];\n}> {\n  const response = await http.post<{\n    message_count: number;\n    participants: string[];\n    format: string;\n    preview: unknown[];\n  }>('/api/conversations/parse', { text });\n  return response.data;\n}\n\n/**\n * Import a conversation\n */\nexport async function importConversation(text: string, options?: { \n  skipAI?: boolean; \n  formatHint?: string;\n  meta?: Record<string, unknown>;\n}): Promise<Conversation> {\n  const response = await http.post<{ conversation: Conversation }>('/api/conversations', { \n    text, \n    ...options \n  });\n  return response.data.conversation;\n}\n\n/**\n * Delete a conversation\n */\nexport async function deleteConversation(id: string): Promise<void> {\n  await http.delete(`/api/conversations/${id}`);\n}\n\n/**\n * Re-embed a conversation (regenerate embeddings)\n */\nexport async function reembedConversation(id: string): Promise<void> {\n  await http.post(`/api/conversations/${id}/reembed`);\n}\n\n// ==================== Bulk Operations ====================\n\n/**\n * Bulk delete documents\n */\nexport async function bulkDeleteDocuments(ids: string[]): Promise<{ deleted: number; errors: Array<{ id: string; error: string }> }> {\n  const response = await http.post<{ deleted: number; errors: Array<{ id: string; error: string }> }>('/api/documents/bulk/delete', { ids });\n  return response.data;\n}\n\n/**\n * Bulk reprocess documents\n */\nexport async function bulkReprocessDocuments(ids: string[]): Promise<{ success: boolean; message: string; ids: string[] }> {\n  const response = await http.post<{ success: boolean; message: string; ids: string[] }>('/api/documents/bulk/reprocess', { ids });\n  return response.data;\n}\n\n/**\n * Bulk export documents as ZIP\n */\nexport async function bulkExportDocuments(ids: string[], format: 'original' | 'markdown' = 'original'): Promise<Blob> {\n  const response = await fetch('/api/documents/bulk/export', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ ids, format }),\n    credentials: 'include'\n  });\n  \n  if (!response.ok) {\n    throw new Error('Failed to export documents');\n  }\n  \n  return response.blob();\n}\n\n/**\n * Download bulk export\n */\nexport async function downloadBulkExport(ids: string[], format: 'original' | 'markdown' = 'original'): Promise<void> {\n  const blob = await bulkExportDocuments(ids, format);\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `documents_export_${Date.now()}.zip`;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n}\n\nexport const documentsService = {\n  upload: uploadFiles,\n  uploadWithExtraction,\n  getProcessingStatus,\n  getAll: getDocuments,\n  get: getDocument,\n  delete: deleteDocument,\n  restore: restoreDocument,\n  reprocess: reprocessDocument,\n  getSummary: getDocumentSummary,\n  // Bulk operations\n  bulkDelete: bulkDeleteDocuments,\n  bulkReprocess: bulkReprocessDocuments,\n  bulkExport: bulkExportDocuments,\n  downloadBulkExport,\n};\n\n// Additional knowledge functions\nasync function getKnowledgeStatus(): Promise<{\n  total: number;\n  embedded: number;\n  pending: number;\n  models: string[];\n}> {\n  try {\n    const response = await http.get<{ status: { total: number; embedded: number; pending: number; models: string[] } }>('/api/knowledge/status');\n    return response.data.status;\n  } catch {\n    return { total: 0, embedded: 0, pending: 0, models: [] };\n  }\n}\n\nasync function exportKnowledgeMarkdown(): Promise<string> {\n  const response = await http.get<{ markdown: string }>('/api/knowledge/export?format=markdown');\n  return response.data.markdown || '';\n}\n\nasync function exportKnowledgeJson(): Promise<KnowledgeItem[]> {\n  const response = await http.get<{ items: KnowledgeItem[] }>('/api/knowledge/export?format=json');\n  return response.data.items || [];\n}\n\nasync function regenerateKnowledge(): Promise<{ success: boolean; processed: number }> {\n  const response = await http.post<{ success: boolean; processed: number }>('/api/knowledge/regenerate');\n  return response.data;\n}\n\nasync function synthesizeKnowledge(topic?: string): Promise<{ summary: string; sources: string[] }> {\n  const response = await http.post<{ summary: string; sources: string[] }>('/api/knowledge/synthesize', { topic });\n  return response.data;\n}\n\nexport const knowledgeService = {\n  getAll: getKnowledgeBase,\n  add: addKnowledgeItem,\n  search: searchKnowledge,\n  getStatus: getKnowledgeStatus,\n  exportMarkdown: exportKnowledgeMarkdown,\n  exportJson: exportKnowledgeJson,\n  regenerate: regenerateKnowledge,\n  synthesize: synthesizeKnowledge,\n};\n\nexport const conversationsService = {\n  getAll: getConversations,\n  get: getConversation,\n  getById: getConversation, // Alias\n  parsePreview: parseConversationPreview,\n  import: importConversation,\n  delete: deleteConversation,\n  reembed: reembedConversation,\n};\n","/**\n * Emails Service\n * Handles email management and AI responses\n */\n\nimport { http } from './api';\n\nexport interface Email {\n  id: string;\n  message_id?: string;\n  from: string;\n  from_name?: string;\n  from_email?: string;\n  to: string[];\n  cc?: string[];\n  bcc?: string[];\n  subject: string;\n  body: string;\n  body_text?: string;\n  body_html?: string;\n  date: string;\n  thread_id?: string;\n  labels?: string[];\n  is_read: boolean;\n  read?: boolean; // Alias for is_read\n  is_starred: boolean;\n  has_attachments: boolean;\n  attachments?: Array<{\n    filename: string;\n    mimeType: string;\n    size: number;\n  }>;\n  // Direction and response tracking\n  direction?: 'inbound' | 'outbound' | 'internal';\n  requires_response?: boolean;\n  response_sent?: boolean;\n  response_drafted?: boolean;\n  draft_response?: string;\n  // AI fields\n  ai_summary?: string;\n  ai_category?: string;\n  ai_sentiment?: 'positive' | 'neutral' | 'negative';\n  ai_priority?: 'low' | 'medium' | 'high' | 'urgent';\n  created_at: string;\n}\n\nexport interface EmailThread {\n  id: string;\n  subject: string;\n  participants: string[];\n  message_count: number;\n  last_message_date: string;\n  messages: Email[];\n  summary?: string;\n}\n\nexport interface DraftEmail {\n  to: string[];\n  cc?: string[];\n  bcc?: string[];\n  subject: string;\n  body: string;\n  replyTo?: string;\n  threadId?: string;\n}\n\nexport interface AIResponseSuggestion {\n  tone: 'professional' | 'friendly' | 'formal' | 'brief';\n  response: string;\n  confidence: number;\n}\n\n/**\n * Get all emails\n */\nexport async function getEmails(filters?: {\n  folder?: string;\n  label?: string;\n  unread?: boolean;\n  starred?: boolean;\n  search?: string;\n  limit?: number;\n  offset?: number;\n  direction?: 'inbound' | 'outbound' | 'internal';\n}): Promise<{ emails: Email[]; total: number }> {\n  try {\n    const params = new URLSearchParams();\n    if (filters?.folder) params.set('folder', filters.folder);\n    if (filters?.label) params.set('label', filters.label);\n    if (filters?.unread) params.set('unread', 'true');\n    if (filters?.starred) params.set('starred', 'true');\n    if (filters?.search) params.set('search', filters.search);\n    if (filters?.limit) params.set('limit', String(filters.limit));\n    if (filters?.offset) params.set('offset', String(filters.offset));\n\n    const query = params.toString();\n    const url = query ? `/api/emails?${query}` : '/api/emails';\n    \n    const response = await http.get<{ emails: Email[]; total: number }>(url);\n    return response.data;\n  } catch {\n    return { emails: [], total: 0 };\n  }\n}\n\n/**\n * Get a single email\n */\nexport async function getEmail(id: string): Promise<Email | null> {\n  try {\n    const response = await http.get<{ email: Email }>(`/api/emails/${id}`);\n    return response.data.email;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get email thread\n */\nexport async function getEmailThread(threadId: string): Promise<EmailThread | null> {\n  try {\n    const response = await http.get<{ thread: EmailThread }>(`/api/emails/thread/${threadId}`);\n    return response.data.thread;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Mark email as read\n */\nexport async function markAsRead(id: string): Promise<void> {\n  await http.put(`/api/emails/${id}/read`);\n}\n\n/**\n * Mark email as unread\n */\nexport async function markAsUnread(id: string): Promise<void> {\n  await http.put(`/api/emails/${id}/unread`);\n}\n\n/**\n * Star an email\n */\nexport async function starEmail(id: string): Promise<void> {\n  await http.put(`/api/emails/${id}/star`);\n}\n\n/**\n * Unstar an email\n */\nexport async function unstarEmail(id: string): Promise<void> {\n  await http.put(`/api/emails/${id}/unstar`);\n}\n\n/**\n * Archive an email\n */\nexport async function archiveEmail(id: string): Promise<void> {\n  await http.put(`/api/emails/${id}/archive`);\n}\n\n/**\n * Delete an email\n */\nexport async function deleteEmail(id: string): Promise<void> {\n  await http.delete(`/api/emails/${id}`);\n}\n\n/**\n * Send an email\n */\nexport async function sendEmail(draft: DraftEmail): Promise<{ success: boolean; messageId: string }> {\n  const response = await http.post<{ success: boolean; messageId: string }>('/api/emails/send', draft);\n  return response.data;\n}\n\n/**\n * Save as draft\n */\nexport async function saveDraft(draft: DraftEmail): Promise<{ id: string }> {\n  const response = await http.post<{ id: string }>('/api/emails/draft', draft);\n  return response.data;\n}\n\n/**\n * Generate AI response\n */\nexport async function generateAIResponse(emailId: string, tone?: string): Promise<AIResponseSuggestion[]> {\n  const response = await http.post<{ suggestions: AIResponseSuggestion[] }>(`/api/emails/${emailId}/ai-response`, {\n    tone,\n  });\n  return response.data.suggestions || [];\n}\n\n/**\n * Generate AI summary of email\n */\nexport async function generateSummary(emailId: string): Promise<string> {\n  const response = await http.post<{ summary: string }>(`/api/emails/${emailId}/summarize`);\n  return response.data.summary || '';\n}\n\n/**\n * Categorize email with AI\n */\nexport async function categorizeEmail(emailId: string): Promise<{\n  category: string;\n  priority: string;\n  sentiment: string;\n}> {\n  const response = await http.post<{\n    category: string;\n    priority: string;\n    sentiment: string;\n  }>(`/api/emails/${emailId}/categorize`);\n  return response.data;\n}\n\n/**\n * Get email stats\n */\nexport async function getEmailStats(): Promise<{\n  total: number;\n  unread: number;\n  starred: number;\n  today: number;\n  byCategory: Record<string, number>;\n}> {\n  const response = await http.get<{\n    total: number;\n    unread: number;\n    starred: number;\n    today: number;\n    byCategory: Record<string, number>;\n  }>('/api/emails/stats');\n  return response.data;\n}\n\n/**\n * Sync emails from provider\n */\nexport async function syncEmails(): Promise<{ synced: number; errors: number }> {\n  const response = await http.post<{ synced: number; errors: number }>('/api/emails/sync');\n  return response.data;\n}\n\n/**\n * Get email by ID (alias for get)\n */\nexport async function getById(id: string): Promise<Email | null> {\n  return getEmail(id);\n}\n\n/**\n * Get emails needing response\n */\nexport async function getNeedingResponse(): Promise<Email[]> {\n  try {\n    const response = await http.get<{ emails: Email[] }>('/api/emails?requires_response=true&response_sent=false');\n    return response.data.emails || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Mark email as responded\n */\nexport async function markResponded(id: string): Promise<void> {\n  await http.put(`/api/emails/${id}/responded`);\n}\n\n/**\n * Generate response (alias for generateAIResponse)\n */\nexport async function generateResponse(emailId: string, tone?: string): Promise<AIResponseSuggestion[]> {\n  return generateAIResponse(emailId, tone);\n}\n\nexport const emailsService = {\n  getAll: getEmails,\n  get: getEmail,\n  getById,\n  getThread: getEmailThread,\n  markAsRead,\n  markAsUnread,\n  star: starEmail,\n  unstar: unstarEmail,\n  archive: archiveEmail,\n  delete: deleteEmail,\n  send: sendEmail,\n  saveDraft,\n  generateAIResponse,\n  generateResponse,\n  generateSummary,\n  categorize: categorizeEmail,\n  getStats: getEmailStats,\n  sync: syncEmails,\n  getNeedingResponse,\n  markResponded,\n};\n","/**\n * Graph Service - SOTA Knowledge Graph UI\n * Handles knowledge graph, visualization, GraphRAG, analytics, and Supabase persistence\n */\n\nimport { http } from './api';\n\n// ============================================\n// TYPES - Graph Data\n// ============================================\n\nexport interface GraphNode {\n  id: string;\n  label: string;\n  name?: string;\n  type: string;\n  properties?: Record<string, unknown>;\n  // Avatar/visual properties\n  avatarUrl?: string;\n  photoUrl?: string;\n  role?: string;\n  organization?: string;\n  department?: string;\n  email?: string;\n  // Graph metrics\n  connections?: number;\n  centrality?: number;\n  communityId?: number;\n  // Position (for saved layouts)\n  x?: number;\n  y?: number;\n}\n\nexport interface GraphEdge {\n  id: string;\n  source: string;\n  target: string;\n  label: string;\n  type: string;\n  weight?: number;\n  properties?: Record<string, unknown>;\n}\n\nexport interface GraphData {\n  nodes: GraphNode[];\n  edges: GraphEdge[];\n  stats?: GraphStats;\n}\n\nexport interface GraphStats {\n  nodeCount: number;\n  edgeCount: number;\n  density?: number;\n  nodeTypes?: Record<string, number>;\n  edgeTypes?: Record<string, number>;\n  avgConnections?: number;\n  communities?: number;\n  graphName?: string;\n  connected?: boolean;\n}\n\n// ============================================\n// TYPES - Ontology\n// ============================================\n\nexport interface OntologyEntityType {\n  name: string;\n  label: string;\n  description?: string;\n  icon?: string;\n  color?: string;\n  sharedEntity?: boolean;\n  properties?: Array<{\n    name: string;\n    type: string;\n    required?: boolean;\n    searchable?: boolean;\n  }>;\n}\n\nexport interface OntologyRelationType {\n  name: string;\n  label?: string;\n  description?: string;\n  fromTypes: string[];\n  toTypes: string[];\n  properties?: Array<{\n    name: string;\n    type: string;\n  }>;\n}\n\nexport interface OntologySchema {\n  version: string;\n  entityTypes: Record<string, OntologyEntityType>;\n  relationTypes: Record<string, OntologyRelationType>;\n  queryPatterns?: Record<string, { cypher: string; description: string }>;\n}\n\nexport interface OntologySuggestion {\n  id: string;\n  type: 'entity' | 'relation';\n  name: string;\n  description?: string;\n  fromTypes?: string[];\n  toTypes?: string[];\n  properties?: string[];\n  source?: string;\n  example?: string;\n  status: 'pending' | 'approved' | 'rejected';\n  createdAt: string;\n}\n\n// ============================================\n// TYPES - Analytics\n// ============================================\n\nexport interface Community {\n  id: number;\n  size: number;\n  members: Array<{ id: string; name: string; type: string }>;\n  types?: Record<string, number>;\n  hub?: { id: string; name: string };\n}\n\nexport interface CentralityMetrics {\n  topNodes: Array<{\n    id: string;\n    name: string;\n    type: string;\n    connections: number;\n    centrality: number;\n    avatarUrl?: string;\n  }>;\n}\n\nexport interface BridgeNode {\n  id: string;\n  name: string;\n  org1?: string;\n  org2?: string;\n  connects: number;\n}\n\nexport interface GraphInsight {\n  type: string;\n  title: string;\n  description: string;\n  importance: 'low' | 'medium' | 'high';\n  relatedNodes?: string[];\n}\n\n// ============================================\n// TYPES - GraphRAG\n// ============================================\n\nexport interface GraphRAGResponse {\n  ok: boolean;\n  answer: string;\n  sources: Array<{\n    type: string;\n    content: string;\n    id?: string;\n  }>;\n  queryType: 'structural' | 'semantic' | 'hybrid';\n  cypherGenerated?: string;\n  reasoningChain?: Array<{\n    step: string;\n    input: string;\n    output: unknown;\n    reasoning?: string;\n  }>;\n  highlightedNodes?: string[];\n  latencyMs: number;\n  confidence?: number;\n  cached?: boolean;\n}\n\nexport interface MultiHopResult {\n  answer: string;\n  reasoningChain: Array<{\n    step: string;\n    input: string;\n    output: unknown;\n    reasoning?: string;\n  }>;\n  subQueries?: Array<{ query: string; result: unknown }>;\n  confidence: number;\n}\n\n// ============================================\n// TYPES - Query\n// ============================================\n\nexport interface CypherQueryResult {\n  ok: boolean;\n  results: Array<Record<string, unknown>>;\n  columns?: string[];\n  executionTimeMs?: number;\n  error?: string;\n}\n\n// ============================================\n// TYPES - Supabase Persistence\n// ============================================\n\nexport interface GraphQueryHistory {\n  id: string;\n  project_id: string;\n  user_id: string;\n  query_type: 'cypher' | 'natural_language' | 'visual' | 'template';\n  query_text: string;\n  query_name?: string;\n  generated_cypher?: string;\n  result_count?: number;\n  execution_time_ms?: number;\n  is_favorite: boolean;\n  tags?: string[];\n  metadata?: Record<string, unknown>;\n  created_at: string;\n}\n\nexport interface GraphSavedView {\n  id: string;\n  project_id: string;\n  user_id: string;\n  name: string;\n  description?: string;\n  view_config: {\n    filters?: {\n      entityTypes?: string[];\n      communityIds?: number[];\n      dateRange?: { start?: string; end?: string };\n    };\n    layout?: {\n      type: 'physics' | 'hierarchical' | 'manual';\n      positions?: Record<string, { x: number; y: number }>;\n    };\n    zoom?: { scale: number; position: { x: number; y: number } };\n    selectedNodes?: string[];\n    highlightedPaths?: string[][];\n    communityColors?: Record<number, string>;\n    showLabels?: boolean;\n    showEdgeLabels?: boolean;\n  };\n  thumbnail_url?: string;\n  is_default: boolean;\n  is_shared: boolean;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface GraphBookmark {\n  id: string;\n  project_id: string;\n  user_id: string;\n  node_id: string;\n  node_type: string;\n  node_label: string;\n  node_avatar_url?: string;\n  note?: string;\n  color?: string;\n  sort_order: number;\n  created_at: string;\n}\n\nexport interface GraphAnnotation {\n  id: string;\n  project_id: string;\n  user_id: string;\n  target_type: 'node' | 'edge' | 'path' | 'region';\n  target_id: string;\n  target_label?: string;\n  content: string;\n  annotation_type: 'note' | 'warning' | 'highlight' | 'question' | 'todo';\n  color?: string;\n  icon?: string;\n  is_shared: boolean;\n  is_resolved: boolean;\n  resolved_at?: string;\n  resolved_by?: string;\n  metadata?: Record<string, unknown>;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface GraphChatMessage {\n  id: string;\n  project_id: string;\n  user_id: string;\n  session_id: string;\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  metadata?: {\n    queryType?: string;\n    cypherGenerated?: string;\n    sources?: unknown[];\n    reasoningChain?: unknown[];\n    highlightedNodes?: string[];\n    executionTimeMs?: number;\n    confidence?: number;\n    isVoiceInput?: boolean;\n  };\n  is_pinned: boolean;\n  created_at: string;\n}\n\nexport interface GraphSnapshot {\n  id: string;\n  project_id: string;\n  user_id: string;\n  name: string;\n  description?: string;\n  snapshot_type: 'manual' | 'auto' | 'milestone' | 'before_change';\n  snapshot_data: {\n    nodes: GraphNode[];\n    edges: GraphEdge[];\n    stats: GraphStats;\n    communities?: Community[];\n    capturedAt: string;\n  };\n  node_count: number;\n  edge_count: number;\n  file_size_bytes?: number;\n  is_baseline: boolean;\n  tags?: string[];\n  created_at: string;\n}\n\n// ============================================\n// TYPES - Timeline & Costs (existing)\n// ============================================\n\nexport interface TimelineEvent {\n  id: string;\n  date: string;\n  title: string;\n  description?: string;\n  content?: string;\n  type: 'fact' | 'question' | 'question_answered' | 'decision' | 'risk' | 'action' | 'action_completed' | 'deadline' | 'document' | 'transcript' | 'email' | 'conversation' | 'chat_session';\n  entity_id?: string;\n  entity_type?: string;\n  metadata?: Record<string, unknown>;\n  importance?: 'low' | 'medium' | 'high';\n  user?: string;\n  actor?: string;\n  owner?: string;\n  icon?: string;\n  color?: string;\n  status?: string;\n}\n\nexport interface TimelineData {\n  events: TimelineEvent[];\n  startDate: string;\n  endDate: string;\n  totalEvents: number;\n}\n\nexport interface LLMCost {\n  id: string;\n  provider: string;\n  model: string;\n  operation: string;\n  tokens_input: number;\n  tokens_output: number;\n  cost: number;\n  timestamp: string;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface CostSummary {\n  total: number;\n  byProvider: Record<string, number>;\n  byModel: Record<string, number>;\n  byOperation: Record<string, number>;\n  byContext?: Record<string, number>;\n  period: { start: string; end: string };\n  dailyBreakdown: Array<{ date: string; cost: number; calls: number }>;\n  totalInputTokens?: number;\n  totalOutputTokens?: number;\n  previousPeriodCost?: number | null;\n  percentChange?: number | null;\n  budgetLimit?: number | null;\n  budgetUsedPercent?: number | null;\n  budgetAlertTriggered?: boolean;\n}\n\n// ============================================\n// GRAPH DATA FUNCTIONS\n// ============================================\n\n/**\n * Get visualization data for vis-network\n */\nexport async function getVisualizationData(options?: {\n  types?: string[];\n  limit?: number;\n  communityId?: number;\n}): Promise<{ nodes: GraphNode[]; edges: GraphEdge[] }> {\n  try {\n    const params = new URLSearchParams();\n    if (options?.types?.length) params.set('types', options.types.join(','));\n    if (options?.limit) params.set('limit', String(options.limit));\n    if (options?.communityId !== undefined) params.set('communityId', String(options.communityId));\n\n    // First try to get nodes\n    const nodesResponse = await http.get<{ ok: boolean; nodes?: GraphNode[]; results?: unknown[] }>(\n      `/api/graph/nodes?${params.toString()}`\n    );\n    \n    // Then get relationships\n    const edgesResponse = await http.get<{ ok: boolean; relationships?: GraphEdge[]; results?: unknown[] }>(\n      `/api/graph/relationships?${params.toString()}`\n    );\n\n    const nodes = nodesResponse.data.nodes || nodesResponse.data.results?.map((item) => {\n      const r = item as Record<string, unknown>;\n      return {\n        id: String(r.id || r.nodeId || ''),\n        label: String(r.name || r.label || r.title || (r.content as string)?.substring(0, 50) || ''),\n        name: String(r.name || ''),\n        type: String(r.type || r.label || 'Unknown'),\n        avatarUrl: (r.avatarUrl || r.avatar_url || r.photoUrl || r.photo_url) as string | undefined,\n        role: r.role as string | undefined,\n        organization: r.organization as string | undefined,\n        properties: r,\n      };\n    }) || [];\n\n    // Map relationships to expected format (from/to -> source/target)\n    const rawEdges = edgesResponse.data.relationships || edgesResponse.data.results || [];\n    const edges = rawEdges.map((item) => {\n      const r = item as Record<string, unknown>;\n      return {\n        id: String(r.id || `${r.from || r.source}-${r.to || r.target}-${r.type}`),\n        source: String(r.from || r.source || ''),\n        target: String(r.to || r.target || ''),\n        label: String(r.type || r.label || ''),\n        type: String(r.type || ''),\n      };\n    });\n\n    return { nodes: nodes as GraphNode[], edges: edges as GraphEdge[] };\n  } catch (error) {\n    console.error('[GraphService] getVisualizationData error:', error);\n    return { nodes: [], edges: [] };\n  }\n}\n\n/**\n * Get graph statistics\n */\nexport async function getStats(): Promise<GraphStats> {\n  try {\n    const response = await http.get<{ \n      ok: boolean; \n      stats?: GraphStats;\n      nodes?: number;\n      relationships?: number;\n      enabled?: boolean;\n      connected?: boolean;\n      graphName?: string;\n    }>('/api/graph/status');\n    \n    if (response.data.stats) {\n      return {\n        ...response.data.stats,\n        graphName: response.data.graphName,\n        connected: response.data.connected,\n      };\n    }\n    \n    return {\n      nodeCount: response.data.nodes || 0,\n      edgeCount: response.data.relationships || 0,\n      graphName: response.data.graphName,\n      connected: response.data.connected,\n    };\n  } catch {\n    return { nodeCount: 0, edgeCount: 0, connected: false };\n  }\n}\n\n/**\n * Get knowledge graph data (legacy)\n */\nexport async function getGraph(options?: {\n  type?: string;\n  depth?: number;\n  limit?: number;\n}): Promise<GraphData> {\n  try {\n    const params = new URLSearchParams();\n    if (options?.type) params.set('type', options.type);\n    if (options?.depth) params.set('depth', String(options.depth));\n    if (options?.limit) params.set('limit', String(options.limit));\n\n    const query = params.toString();\n    const url = query ? `/api/graph?${query}` : '/api/graph';\n\n    const response = await http.get<GraphData>(url);\n    return response.data;\n  } catch {\n    return { nodes: [], edges: [] };\n  }\n}\n\n/**\n * Get entity graph (centered on a specific entity)\n */\nexport async function getEntityGraph(entityId: string, depth = 2): Promise<GraphData> {\n  try {\n    const response = await http.get<GraphData>(`/api/graph/entity/${entityId}?depth=${depth}`);\n    return response.data;\n  } catch {\n    return { nodes: [], edges: [] };\n  }\n}\n\n/**\n * Get related entities\n */\nexport async function getRelatedEntities(entityId: string): Promise<GraphNode[]> {\n  try {\n    const response = await http.get<{ related: GraphNode[] }>(`/api/graph/related/${entityId}`);\n    return response.data.related || [];\n  } catch {\n    return [];\n  }\n}\n\n// ============================================\n// ONTOLOGY FUNCTIONS\n// ============================================\n\n/**\n * Get full ontology schema\n */\nexport async function getOntologySchema(): Promise<OntologySchema | null> {\n  try {\n    const response = await http.get<{ ok: boolean; schema: OntologySchema }>('/api/ontology/schema');\n    return response.data.schema || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get entity types\n */\nexport async function getOntologyEntities(): Promise<OntologyEntityType[]> {\n  try {\n    const response = await http.get<{ ok: boolean; entityTypes: OntologyEntityType[] }>('/api/ontology/entities');\n    return response.data.entityTypes || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get relation types\n */\nexport async function getOntologyRelations(): Promise<OntologyRelationType[]> {\n  try {\n    const response = await http.get<{ ok: boolean; relationTypes: OntologyRelationType[] }>('/api/ontology/relations');\n    return response.data.relationTypes || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get ontology suggestions\n */\nexport async function getOntologySuggestions(): Promise<OntologySuggestion[]> {\n  try {\n    const response = await http.get<{ ok: boolean; suggestions: OntologySuggestion[] }>('/api/ontology/suggestions');\n    return response.data.suggestions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Approve ontology suggestion\n */\nexport async function approveOntologySuggestion(suggestionId: string): Promise<boolean> {\n  try {\n    const response = await http.post<{ ok: boolean }>(`/api/ontology/suggestions/${suggestionId}/approve`, {});\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Reject ontology suggestion\n */\nexport async function rejectOntologySuggestion(suggestionId: string): Promise<boolean> {\n  try {\n    const response = await http.post<{ ok: boolean }>(`/api/ontology/suggestions/${suggestionId}/reject`, {});\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================\n// SOTA v2.0 - ONTOLOGY MANAGEMENT\n// ============================================\n\nexport interface OntologyTypeStats {\n  entities: Record<string, { count: number; inOntology: boolean }>;\n  relations: Record<string, { count: number; inOntology: boolean }>;\n  unused: { entities: string[]; relations: string[] };\n  notInOntology: { entities: string[]; relations: string[] };\n}\n\nexport interface OntologySyncStatus {\n  isListening: boolean;\n  syncInProgress: boolean;\n  lastSyncAt: string | null;\n  pendingChanges: number;\n  ontologySource: 'supabase' | 'file' | null;\n  graphConnected: boolean;\n}\n\nexport interface OntologyChange {\n  id: string;\n  change_type: string;\n  target_type: string;\n  target_name: string;\n  old_definition: unknown;\n  new_definition: unknown;\n  diff: { added: unknown; removed: unknown; modified: unknown } | null;\n  reason: string | null;\n  source: string;\n  changed_at: string;\n  changed_by: string | null;\n}\n\nexport interface LLMAnalysisResult {\n  analysis: {\n    missingInOntology: Array<{ name: string; type: string; count: number; description: string; confidence: number }>;\n    unusedInOntology: Array<{ name: string; type: string }>;\n    suggestedRelations: Array<{ from: string; to: string; name: string; description: string }>;\n    suggestedInferenceRules: Array<{ name: string; description: string; pattern: string }>;\n    summary: string;\n  };\n  suggestions: OntologySuggestion[];\n  summary: string;\n}\n\n/**\n * Get type usage statistics from the graph\n */\nexport async function getOntologyTypeStats(): Promise<OntologyTypeStats | null> {\n  try {\n    const response = await http.get<{ ok: boolean; stats: OntologyTypeStats }>('/api/ontology/stats');\n    return response.data.stats || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get ontology sync status (Supabase Graph)\n */\nexport async function getOntologySyncStatus(): Promise<OntologySyncStatus | null> {\n  try {\n    const response = await http.get<{ ok: boolean; status: OntologySyncStatus }>('/api/ontology/sync/status');\n    return response.data.status || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Force sync ontology to graph\n */\nexport async function forceOntologySync(): Promise<{ ok: boolean; results?: unknown; error?: string }> {\n  try {\n    const response = await http.post<{ ok: boolean; results?: unknown; error?: string }>('/api/ontology/sync/force', {});\n    return response.data;\n  } catch (e) {\n    return { ok: false, error: String(e) };\n  }\n}\n\n/**\n * Trigger LLM analysis of graph vs ontology\n */\nexport async function runLLMAnalysis(): Promise<LLMAnalysisResult | null> {\n  try {\n    const response = await http.post<{ ok: boolean } & LLMAnalysisResult>('/api/ontology/analyze', {});\n    if (response.data.ok) {\n      return response.data;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Auto-approve high confidence suggestions\n */\nexport async function autoApproveHighConfidence(threshold = 0.85): Promise<{ approved: number; skipped: number }> {\n  try {\n    const response = await http.post<{ ok: boolean; approved: number; skipped: number }>(\n      '/api/ontology/suggestions/auto-approve',\n      { threshold }\n    );\n    return { approved: response.data.approved || 0, skipped: response.data.skipped || 0 };\n  } catch {\n    return { approved: 0, skipped: 0 };\n  }\n}\n\n/**\n * Get ontology change history (audit trail)\n */\nexport async function getOntologyChanges(options: {\n  targetType?: string;\n  targetName?: string;\n  limit?: number;\n} = {}): Promise<OntologyChange[]> {\n  try {\n    const params = new URLSearchParams();\n    if (options.targetType) params.append('targetType', options.targetType);\n    if (options.targetName) params.append('targetName', options.targetName);\n    if (options.limit) params.append('limit', String(options.limit));\n    \n    const response = await http.get<{ ok: boolean; changes: OntologyChange[] }>(\n      `/api/ontology/changes?${params.toString()}`\n    );\n    return response.data.changes || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Migrate schema.json to Supabase\n */\nexport async function migrateOntologyToSupabase(): Promise<{ success: boolean; counts?: unknown; error?: string }> {\n  try {\n    const response = await http.post<{ success: boolean; counts?: unknown; error?: string }>(\n      '/api/ontology/migrate',\n      {}\n    );\n    return response.data;\n  } catch (e) {\n    return { success: false, error: String(e) };\n  }\n}\n\n// ============================================\n// SOTA v2.1 - BACKGROUND WORKER\n// ============================================\n\nexport interface BackgroundWorkerStatus {\n  isRunning: boolean;\n  hasPendingAnalysis: boolean;\n  lastRun: Record<string, string>;\n  graphConnected: boolean;\n  llmConfigured: boolean;\n  thresholds: {\n    autoApprove: number;\n    minNodesForAnalysis: number;\n    analysisDebounceMs: number;\n  };\n}\n\nexport interface BackgroundWorkerStats {\n  totalExecutions: number;\n  byType: Record<string, number>;\n  byStatus: { completed: number; failed: number };\n  avgDuration: number;\n}\n\nexport interface BackgroundJobExecution {\n  type: string;\n  startedAt: string;\n  completedAt?: string;\n  status: string;\n  duration?: number;\n  results?: unknown;\n  error?: string;\n}\n\nexport interface OntologyJob {\n  id: string;\n  name: string;\n  type: string;\n  schedule: string;\n  enabled: boolean;\n  lastRun: string | null;\n  nextRun: string | null;\n  runCount: number;\n}\n\n/**\n * Get background worker status\n */\nexport async function getBackgroundWorkerStatus(): Promise<{ status: BackgroundWorkerStatus; stats: BackgroundWorkerStats } | null> {\n  try {\n    const response = await http.get<{ ok: boolean; status: BackgroundWorkerStatus; stats: BackgroundWorkerStats }>(\n      '/api/ontology/worker/status'\n    );\n    if (response.data.ok) {\n      return { status: response.data.status, stats: response.data.stats };\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Trigger background analysis manually\n */\nexport async function triggerBackgroundAnalysis(\n  type: 'full' | 'inference' | 'dedup' | 'auto_approve' | 'gaps',\n  config: Record<string, unknown> = {}\n): Promise<BackgroundJobExecution | null> {\n  try {\n    const response = await http.post<{ ok: boolean } & BackgroundJobExecution>(\n      '/api/ontology/worker/trigger',\n      { type, config }\n    );\n    if (response.data.ok) {\n      return response.data;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get background worker execution log\n */\nexport async function getBackgroundWorkerLog(options: {\n  type?: string;\n  status?: string;\n  limit?: number;\n} = {}): Promise<BackgroundJobExecution[]> {\n  try {\n    const params = new URLSearchParams();\n    if (options.type) params.append('type', options.type);\n    if (options.status) params.append('status', options.status);\n    if (options.limit) params.append('limit', String(options.limit));\n    \n    const response = await http.get<{ ok: boolean; log: BackgroundJobExecution[] }>(\n      `/api/ontology/worker/log?${params.toString()}`\n    );\n    return response.data.log || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get ontology-related scheduled jobs\n */\nexport async function getOntologyJobs(): Promise<OntologyJob[]> {\n  try {\n    const response = await http.get<{ ok: boolean; jobs: OntologyJob[] }>('/api/ontology/jobs');\n    return response.data.jobs || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Toggle an ontology job (enable/disable)\n */\nexport async function toggleOntologyJob(jobId: string, enabled?: boolean): Promise<OntologyJob | null> {\n  try {\n    const response = await http.post<{ ok: boolean; job: OntologyJob }>(\n      `/api/ontology/jobs/${jobId}/toggle`,\n      { enabled }\n    );\n    if (response.data.ok) {\n      return response.data.job;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n// ============================================\n// ONTOLOGY EXTRACTOR (SOTA v2.1)\n// ============================================\n\nexport interface ExtractedOntology {\n  version: string;\n  extractedAt: string;\n  entityTypes: Record<string, {\n    label: string;\n    description: string;\n    properties: Record<string, { type: string; required: boolean; searchable: boolean }>;\n    nodeCount: number;\n    extractedFrom: string;\n  }>;\n  relationTypes: Record<string, {\n    label: string;\n    description: string;\n    fromTypes: string[];\n    toTypes: string[];\n    edgeCount: number;\n    extractedFrom: string;\n  }>;\n}\n\nexport interface ComplianceResult {\n  valid: boolean;\n  score: number;\n  issues: Array<{\n    type: string;\n    severity: 'error' | 'warning' | 'info';\n    message: string;\n    label?: string;\n    count?: number;\n    suggestion?: string;\n  }>;\n  stats: {\n    totalNodes: number;\n    validNodes: number;\n    invalidNodes: number;\n    unknownTypeNodes: number;\n    totalRelationships: number;\n    validRelationships: number;\n    invalidRelationships: number;\n    unknownTypeRelationships: number;\n    missingRequiredProperties: number;\n    invalidPropertyTypes: number;\n  };\n}\n\nexport interface OntologyDiff {\n  entitiesOnlyInA: string[];\n  entitiesOnlyInB: string[];\n  entitiesInBoth: string[];\n  relationsOnlyInA: string[];\n  relationsOnlyInB: string[];\n  relationsInBoth: string[];\n}\n\nexport interface GraphBrowserInfo {\n  browserUrl: string;\n  isCloud: boolean;\n  host: string;\n  note: string;\n}\n\n// Alias for backward compatibility\nexport type FalkorDBBrowserInfo = GraphBrowserInfo;\n\n/**\n * Extract ontology from graph\n */\nexport async function extractOntologyFromGraph(): Promise<{ ok: boolean; ontology?: ExtractedOntology; stats?: Record<string, number>; error?: string }> {\n  try {\n    const response = await http.get<{ ok: boolean; ontology?: ExtractedOntology; stats?: Record<string, number>; error?: string }>('/api/ontology/extract-from-graph');\n    return response.data;\n  } catch {\n    return { ok: false, error: 'Failed to extract ontology' };\n  }\n}\n\n/**\n * Validate graph compliance against ontology\n */\nexport async function validateOntologyCompliance(): Promise<ComplianceResult | null> {\n  try {\n    const response = await http.get<{ ok: boolean } & ComplianceResult>('/api/ontology/validate-compliance');\n    if (response.data.ok) {\n      return response.data;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get diff between current ontology and graph\n */\nexport async function getOntologyDiff(): Promise<{ diff: OntologyDiff; extractedOntology: ExtractedOntology } | null> {\n  try {\n    const response = await http.get<{ ok: boolean; diff: OntologyDiff; extractedOntology: ExtractedOntology }>('/api/ontology/diff');\n    if (response.data.ok) {\n      return { diff: response.data.diff, extractedOntology: response.data.extractedOntology };\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Find unused types in ontology\n */\nexport async function findUnusedOntologyTypes(): Promise<{ entities: string[]; relations: string[] }> {\n  try {\n    const response = await http.get<{ ok: boolean; unused: { entities: string[]; relations: string[] } }>('/api/ontology/unused-types');\n    return response.data.unused || { entities: [], relations: [] };\n  } catch {\n    return { entities: [], relations: [] };\n  }\n}\n\n/**\n * Merge extracted ontology with current\n */\nexport async function mergeOntology(options: { \n  ontology?: ExtractedOntology; \n  mergeProperties?: boolean; \n  mergeEndpoints?: boolean; \n  save?: boolean \n}): Promise<{ ok: boolean; changes?: Array<{ type: string; name: string }>; saved?: boolean }> {\n  try {\n    const response = await http.post<{ ok: boolean; changes: Array<{ type: string; name: string }>; saved: boolean }>('/api/ontology/merge', options);\n    return response.data;\n  } catch {\n    return { ok: false };\n  }\n}\n\n/**\n * Cleanup orphan ontology types\n */\nexport async function cleanupOntology(options: {\n  discardEntitiesWithoutRelations?: boolean;\n  discardRelationsWithoutEntities?: boolean;\n  save?: boolean;\n}): Promise<{ ok: boolean; discardedEntities?: Array<{ name: string }>; discardedRelations?: Array<{ name: string }> }> {\n  try {\n    const response = await http.post<{ ok: boolean; discardedEntities: Array<{ name: string }>; discardedRelations: Array<{ name: string }> }>('/api/ontology/cleanup', options);\n    return response.data;\n  } catch {\n    return { ok: false };\n  }\n}\n\n/**\n * Get Graph Browser URL info (legacy - kept for compatibility)\n */\nexport async function getFalkorDBBrowserInfo(): Promise<FalkorDBBrowserInfo | null> {\n  try {\n    const response = await http.get<{ ok: boolean } & FalkorDBBrowserInfo>('/api/graph/falkordb-browser');\n    if (response.data.ok) {\n      return response.data;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\nexport interface FalkorDBGraphSyncResult {\n  ok: boolean;\n  error?: string;\n  graphs: string[];\n  validGraphs: string[];\n  orphanGraphs: string[];\n  deleted: string[];\n  dryRun: boolean;\n}\n\n/**\n * List all graphs in FalkorDB\n */\nexport async function listAllFalkorDBGraphs(): Promise<{ ok: boolean; graphs: string[] }> {\n  try {\n    const response = await http.get<{ ok: boolean; graphs: string[] }>('/api/graph/list-all');\n    return response.data;\n  } catch {\n    return { ok: false, graphs: [] };\n  }\n}\n\n/**\n * Sync graphs with Supabase projects (cleanup orphans)\n * @param dryRun - If true, only report what would be deleted without actually deleting\n */\nexport async function syncFalkorDBGraphs(dryRun = false): Promise<FalkorDBGraphSyncResult> {\n  try {\n    const response = await http.post<FalkorDBGraphSyncResult>('/api/graph/sync-projects', { dryRun });\n    return response.data;\n  } catch {\n    return { ok: false, error: 'Request failed', graphs: [], validGraphs: [], orphanGraphs: [], deleted: [], dryRun };\n  }\n}\n\n/**\n * Delete a specific graph\n */\nexport async function deleteFalkorDBGraph(graphName: string): Promise<{ ok: boolean; error?: string }> {\n  try {\n    const response = await http.delete<{ ok: boolean; error?: string }>(`/api/graph/delete/${encodeURIComponent(graphName)}`);\n    return response.data;\n  } catch {\n    return { ok: false, error: 'Request failed' };\n  }\n}\n\n// ============================================\n// ANALYTICS FUNCTIONS\n// ============================================\n\n/**\n * Get detected communities\n */\nexport async function getCommunities(): Promise<Community[]> {\n  try {\n    const response = await http.get<{ ok: boolean; communities: Community[] }>('/api/graphrag/communities');\n    return response.data.communities || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get centrality metrics\n */\nexport async function getCentrality(): Promise<CentralityMetrics> {\n  try {\n    const response = await http.get<{ ok: boolean; centrality: CentralityMetrics }>('/api/graphrag/centrality');\n    return response.data.centrality || { topNodes: [] };\n  } catch {\n    return { topNodes: [] };\n  }\n}\n\n/**\n * Get bridge nodes\n */\nexport async function getBridges(): Promise<BridgeNode[]> {\n  try {\n    const response = await http.get<{ ok: boolean; bridges: BridgeNode[] }>('/api/graphrag/bridges');\n    return response.data.bridges || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get AI-generated insights\n */\nexport async function getInsights(): Promise<GraphInsight[]> {\n  try {\n    const response = await http.get<{ ok: boolean; insights: GraphInsight[] }>('/api/graph/insights');\n    return response.data.insights || [];\n  } catch {\n    return [];\n  }\n}\n\n// ============================================\n// GRAPHRAG / AI FUNCTIONS\n// ============================================\n\n/**\n * Query using GraphRAG\n */\nexport async function graphRAGQuery(query: string, options?: {\n  noCache?: boolean;\n}): Promise<GraphRAGResponse> {\n  try {\n    const response = await http.post<GraphRAGResponse>('/api/graphrag/query', {\n      query,\n      noCache: options?.noCache,\n    });\n    return response.data;\n  } catch (error) {\n    return {\n      ok: false,\n      answer: 'Failed to process query',\n      sources: [],\n      queryType: 'hybrid',\n      latencyMs: 0,\n    };\n  }\n}\n\n/**\n * Stream GraphRAG response (for AI Copilot)\n */\nexport function streamGraphRAGQuery(\n  query: string,\n  onChunk: (chunk: string) => void,\n  onComplete: (response: GraphRAGResponse) => void,\n  onError: (error: Error) => void\n): () => void {\n  const controller = new AbortController();\n  \n  fetch('/api/graphrag/stream', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ query }),\n    signal: controller.signal,\n  })\n    .then(async (response) => {\n      if (!response.ok) throw new Error('Stream request failed');\n      \n      const reader = response.body?.getReader();\n      if (!reader) throw new Error('No reader available');\n      \n      const decoder = new TextDecoder();\n      let fullResponse = '';\n      \n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n        \n        const chunk = decoder.decode(value, { stream: true });\n        const lines = chunk.split('\\n');\n        \n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            const data = line.slice(6);\n            if (data === '[DONE]') {\n              onComplete({\n                ok: true,\n                answer: fullResponse,\n                sources: [],\n                queryType: 'hybrid',\n                latencyMs: 0,\n              });\n              return;\n            }\n            try {\n              const parsed = JSON.parse(data);\n              if (parsed.content) {\n                fullResponse += parsed.content;\n                onChunk(parsed.content);\n              }\n            } catch {\n              // Not JSON, treat as raw text\n              fullResponse += data;\n              onChunk(data);\n            }\n          }\n        }\n      }\n    })\n    .catch((error) => {\n      if (error.name !== 'AbortError') {\n        onError(error);\n      }\n    });\n  \n  return () => controller.abort();\n}\n\n/**\n * Multi-hop reasoning query\n */\nexport async function multiHopQuery(query: string): Promise<MultiHopResult> {\n  try {\n    const response = await http.post<{ ok: boolean } & MultiHopResult>('/api/graphrag/multihop', { query });\n    return response.data;\n  } catch {\n    return {\n      answer: 'Failed to process multi-hop query',\n      reasoningChain: [],\n      confidence: 0,\n    };\n  }\n}\n\n/**\n * Explain connection between two nodes (LLM-powered)\n */\nexport async function explainConnection(nodeId1: string, nodeId2: string): Promise<{\n  explanation: string;\n  paths: Array<{ nodes: string[]; relationships: string[] }>;\n  facts: string[];\n}> {\n  try {\n    const response = await http.post<{\n      ok: boolean;\n      explanation: string;\n      paths: Array<{ nodes: string[]; relationships: string[] }>;\n      facts: string[];\n    }>('/api/graphrag/explain', { nodeId1, nodeId2 });\n    return response.data;\n  } catch {\n    return { explanation: 'Unable to explain connection', paths: [], facts: [] };\n  }\n}\n\n/**\n * Summarize selected nodes (LLM-powered)\n */\nexport async function summarizeSelection(nodeIds: string[]): Promise<{\n  summary: string;\n  insights: string[];\n  suggestedActions: string[];\n}> {\n  try {\n    const response = await http.post<{\n      ok: boolean;\n      summary: string;\n      insights: string[];\n      suggestedActions: string[];\n    }>('/api/graphrag/summarize', { nodeIds });\n    return response.data;\n  } catch {\n    return { summary: 'Unable to generate summary', insights: [], suggestedActions: [] };\n  }\n}\n\n/**\n * Natural language filter (LLM-powered)\n */\nexport async function naturalLanguageFilter(filterText: string): Promise<{\n  filters: {\n    entityTypes?: string[];\n    properties?: Record<string, unknown>;\n    cypher?: string;\n  };\n  explanation: string;\n}> {\n  try {\n    const response = await http.post<{\n      ok: boolean;\n      filters: {\n        entityTypes?: string[];\n        properties?: Record<string, unknown>;\n        cypher?: string;\n      };\n      explanation: string;\n    }>('/api/graphrag/filter', { filterText });\n    return response.data;\n  } catch {\n    return { filters: {}, explanation: 'Unable to parse filter' };\n  }\n}\n\n/**\n * Suggest related nodes to explore\n */\nexport async function suggestRelated(nodeId: string): Promise<Array<{\n  node: GraphNode;\n  reason: string;\n  relevance: number;\n}>> {\n  try {\n    const response = await http.post<{\n      ok: boolean;\n      suggestions: Array<{ node: GraphNode; reason: string; relevance: number }>;\n    }>('/api/graphrag/suggest-related', { nodeId });\n    return response.data.suggestions || [];\n  } catch {\n    return [];\n  }\n}\n\n// ============================================\n// CYPHER QUERY FUNCTIONS\n// ============================================\n\n/**\n * Execute raw Cypher query\n */\nexport async function executeCypher(cypher: string): Promise<CypherQueryResult> {\n  try {\n    const response = await http.post<CypherQueryResult>('/api/graph/query', { cypher });\n    return response.data;\n  } catch (error) {\n    return {\n      ok: false,\n      results: [],\n      error: error instanceof Error ? error.message : 'Query failed',\n    };\n  }\n}\n\n/**\n * Get query templates\n */\nexport async function getQueryTemplates(): Promise<Array<{\n  id: string;\n  name: string;\n  description: string;\n  cypher: string;\n  category: string;\n}>> {\n  try {\n    const schema = await getOntologySchema();\n    if (!schema?.queryPatterns) return [];\n    \n    return Object.entries(schema.queryPatterns).map(([id, pattern]) => ({\n      id,\n      name: id.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase()),\n      description: pattern.description,\n      cypher: pattern.cypher,\n      category: 'ontology',\n    }));\n  } catch {\n    return [];\n  }\n}\n\n// ============================================\n// CROSS-PROJECT FUNCTIONS\n// ============================================\n\n/**\n * Get list of project graphs\n */\nexport async function getProjectGraphs(): Promise<Array<{\n  graphName: string;\n  projectId: string;\n  projectName: string;\n  nodeCount?: number;\n  edgeCount?: number;\n}>> {\n  try {\n    const response = await http.get<{ ok: boolean; graphs: Array<{\n      graphName: string;\n      projectId: string;\n      projectName: string;\n      nodeCount?: number;\n      edgeCount?: number;\n    }> }>('/api/graph/projects');\n    return response.data.graphs || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get cross-project entity (shared entities)\n */\nexport async function getCrossProjectEntities(entityType: string): Promise<Array<{\n  entity: GraphNode;\n  projects: Array<{ id: string; name: string }>;\n}>> {\n  try {\n    const response = await http.get<{\n      ok: boolean;\n      entities: Array<{ entity: GraphNode; projects: Array<{ id: string; name: string }> }>;\n    }>(`/api/graph/cross-project/${entityType}`);\n    return response.data.entities || [];\n  } catch {\n    return [];\n  }\n}\n\n// ============================================\n// SUPABASE PERSISTENCE - Query History\n// ============================================\n\n/**\n * Save query to history\n */\nexport async function saveQueryHistory(query: Omit<GraphQueryHistory, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphQueryHistory | null> {\n  try {\n    const response = await http.post<{ ok: boolean; query: GraphQueryHistory }>('/api/graph/queries', query);\n    return response.data.query || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get query history\n */\nexport async function getQueryHistory(options?: {\n  limit?: number;\n  favoritesOnly?: boolean;\n}): Promise<GraphQueryHistory[]> {\n  try {\n    const params = new URLSearchParams();\n    if (options?.limit) params.set('limit', String(options.limit));\n    if (options?.favoritesOnly) params.set('favorites', 'true');\n    \n    const response = await http.get<{ ok: boolean; queries: GraphQueryHistory[] }>(\n      `/api/graph/queries?${params.toString()}`\n    );\n    return response.data.queries || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Toggle query favorite\n */\nexport async function toggleQueryFavorite(queryId: string): Promise<boolean> {\n  try {\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/queries/${queryId}/favorite`, {});\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Delete query from history\n */\nexport async function deleteQueryHistory(queryId: string): Promise<boolean> {\n  try {\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/queries/${queryId}`);\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================\n// SUPABASE PERSISTENCE - Saved Views\n// ============================================\n\n/**\n * Save current view\n */\nexport async function saveView(view: Omit<GraphSavedView, 'id' | 'project_id' | 'user_id' | 'created_at' | 'updated_at'>): Promise<GraphSavedView | null> {\n  try {\n    const response = await http.post<{ ok: boolean; view: GraphSavedView }>('/api/graph/views', view);\n    return response.data.view || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get saved views\n */\nexport async function getSavedViews(): Promise<GraphSavedView[]> {\n  try {\n    const response = await http.get<{ ok: boolean; views: GraphSavedView[] }>('/api/graph/views');\n    return response.data.views || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Update saved view\n */\nexport async function updateView(viewId: string, updates: Partial<GraphSavedView>): Promise<boolean> {\n  try {\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/views/${viewId}`, updates);\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Delete saved view\n */\nexport async function deleteView(viewId: string): Promise<boolean> {\n  try {\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/views/${viewId}`);\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================\n// SUPABASE PERSISTENCE - Bookmarks\n// ============================================\n\n/**\n * Add bookmark\n */\nexport async function addBookmark(bookmark: Omit<GraphBookmark, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphBookmark | null> {\n  try {\n    const response = await http.post<{ ok: boolean; bookmark: GraphBookmark }>('/api/graph/bookmarks', bookmark);\n    return response.data.bookmark || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get bookmarks\n */\nexport async function getBookmarks(): Promise<GraphBookmark[]> {\n  try {\n    const response = await http.get<{ ok: boolean; bookmarks: GraphBookmark[] }>('/api/graph/bookmarks');\n    return response.data.bookmarks || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Update bookmark\n */\nexport async function updateBookmark(bookmarkId: string, updates: Partial<GraphBookmark>): Promise<boolean> {\n  try {\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/bookmarks/${bookmarkId}`, updates);\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Remove bookmark\n */\nexport async function removeBookmark(bookmarkId: string): Promise<boolean> {\n  try {\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/bookmarks/${bookmarkId}`);\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================\n// SUPABASE PERSISTENCE - Annotations\n// ============================================\n\n/**\n * Create annotation\n */\nexport async function createAnnotation(annotation: Omit<GraphAnnotation, 'id' | 'project_id' | 'user_id' | 'created_at' | 'updated_at'>): Promise<GraphAnnotation | null> {\n  try {\n    const response = await http.post<{ ok: boolean; annotation: GraphAnnotation }>('/api/graph/annotations', annotation);\n    return response.data.annotation || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get annotations\n */\nexport async function getAnnotations(options?: {\n  targetType?: string;\n  targetId?: string;\n  includeShared?: boolean;\n}): Promise<GraphAnnotation[]> {\n  try {\n    const params = new URLSearchParams();\n    if (options?.targetType) params.set('targetType', options.targetType);\n    if (options?.targetId) params.set('targetId', options.targetId);\n    if (options?.includeShared) params.set('includeShared', 'true');\n    \n    const response = await http.get<{ ok: boolean; annotations: GraphAnnotation[] }>(\n      `/api/graph/annotations?${params.toString()}`\n    );\n    return response.data.annotations || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Update annotation\n */\nexport async function updateAnnotation(annotationId: string, updates: Partial<GraphAnnotation>): Promise<boolean> {\n  try {\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/annotations/${annotationId}`, updates);\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Delete annotation\n */\nexport async function deleteAnnotation(annotationId: string): Promise<boolean> {\n  try {\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/annotations/${annotationId}`);\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================\n// SUPABASE PERSISTENCE - Chat History\n// ============================================\n\n/**\n * Save chat message\n */\nexport async function saveChatMessage(message: Omit<GraphChatMessage, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphChatMessage | null> {\n  try {\n    const response = await http.post<{ ok: boolean; message: GraphChatMessage }>('/api/graph/chat', message);\n    return response.data.message || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get chat sessions\n */\nexport async function getChatSessions(): Promise<Array<{\n  sessionId: string;\n  firstMessage: string;\n  messageCount: number;\n  lastActivity: string;\n}>> {\n  try {\n    const response = await http.get<{\n      ok: boolean;\n      sessions: Array<{\n        sessionId: string;\n        firstMessage: string;\n        messageCount: number;\n        lastActivity: string;\n      }>;\n    }>('/api/graph/chat/sessions');\n    return response.data.sessions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get chat history for session\n */\nexport async function getChatHistory(sessionId: string): Promise<GraphChatMessage[]> {\n  try {\n    const response = await http.get<{ ok: boolean; messages: GraphChatMessage[] }>(\n      `/api/graph/chat/session/${sessionId}`\n    );\n    return response.data.messages || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Toggle message pin\n */\nexport async function toggleChatPin(messageId: string): Promise<boolean> {\n  try {\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/chat/${messageId}/pin`, {});\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================\n// SUPABASE PERSISTENCE - Snapshots\n// ============================================\n\n/**\n * Create snapshot\n */\nexport async function createSnapshot(snapshot: Omit<GraphSnapshot, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphSnapshot | null> {\n  try {\n    const response = await http.post<{ ok: boolean; snapshot: GraphSnapshot }>('/api/graph/snapshots', snapshot);\n    return response.data.snapshot || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get snapshots\n */\nexport async function getSnapshots(): Promise<GraphSnapshot[]> {\n  try {\n    const response = await http.get<{ ok: boolean; snapshots: GraphSnapshot[] }>('/api/graph/snapshots');\n    return response.data.snapshots || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get snapshot by ID\n */\nexport async function getSnapshot(snapshotId: string): Promise<GraphSnapshot | null> {\n  try {\n    const response = await http.get<{ ok: boolean; snapshot: GraphSnapshot }>(`/api/graph/snapshots/${snapshotId}`);\n    return response.data.snapshot || null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Compare snapshots\n */\nexport async function compareSnapshots(snapshotId1: string, snapshotId2: string): Promise<{\n  diff: {\n    nodesAdded: GraphNode[];\n    nodesRemoved: GraphNode[];\n    edgesAdded: GraphEdge[];\n    edgesRemoved: GraphEdge[];\n    statsComparison: {\n      nodeCountDiff: number;\n      edgeCountDiff: number;\n    };\n  };\n}> {\n  try {\n    const response = await http.get<{\n      ok: boolean;\n      diff: {\n        nodesAdded: GraphNode[];\n        nodesRemoved: GraphNode[];\n        edgesAdded: GraphEdge[];\n        edgesRemoved: GraphEdge[];\n        statsComparison: { nodeCountDiff: number; edgeCountDiff: number };\n      };\n    }>(`/api/graph/snapshots/compare?id1=${snapshotId1}&id2=${snapshotId2}`);\n    return response.data;\n  } catch {\n    return {\n      diff: {\n        nodesAdded: [],\n        nodesRemoved: [],\n        edgesAdded: [],\n        edgesRemoved: [],\n        statsComparison: { nodeCountDiff: 0, edgeCountDiff: 0 },\n      },\n    };\n  }\n}\n\n/**\n * Delete snapshot\n */\nexport async function deleteSnapshot(snapshotId: string): Promise<boolean> {\n  try {\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/snapshots/${snapshotId}`);\n    return response.data.ok;\n  } catch {\n    return false;\n  }\n}\n\n// ============================================\n// TIMELINE FUNCTIONS (existing)\n// ============================================\n\nexport async function getTimeline(options?: {\n  startDate?: string;\n  endDate?: string;\n  types?: string[];\n  limit?: number;\n}): Promise<TimelineData> {\n  try {\n    const params = new URLSearchParams();\n    if (options?.startDate) params.set('startDate', options.startDate);\n    if (options?.endDate) params.set('endDate', options.endDate);\n    if (options?.types?.length) params.set('types', options.types.join(','));\n    if (options?.limit) params.set('limit', String(options.limit));\n\n    const query = params.toString();\n    const url = query ? `/api/timeline?${query}` : '/api/timeline';\n\n    const response = await http.get<{\n      events?: Array<Record<string, unknown>>;\n      totalEvents?: number;\n      startDate?: string;\n      endDate?: string;\n    }>(url);\n\n    const raw = response.data.events || [];\n    const events: TimelineEvent[] = raw.map((e: Record<string, unknown>) => ({\n      id: String(e.id ?? ''),\n      date: String(e.date ?? ''),\n      title: String(e.title ?? ''),\n      description: e.content != null ? String(e.content) : undefined,\n      content: e.content != null ? String(e.content) : undefined,\n      type: (e.type as TimelineEvent['type']) ?? 'document',\n      entity_id: e.entity_id != null ? String(e.entity_id) : undefined,\n      entity_type: e.entity_type != null ? String(e.entity_type) : undefined,\n      metadata: (e.metadata as Record<string, unknown>) ?? undefined,\n      user: e.owner != null ? String(e.owner) : e.user as string | undefined,\n      actor: e.owner != null ? String(e.owner) : e.actor as string | undefined,\n      owner: e.owner != null ? String(e.owner) : undefined,\n      icon: e.icon as string | undefined,\n      color: e.color as string | undefined,\n      status: e.status as string | undefined,\n    }));\n\n    return {\n      events,\n      totalEvents: response.data.totalEvents ?? events.length,\n      startDate: response.data.startDate ?? '',\n      endDate: response.data.endDate ?? '',\n    };\n  } catch {\n    return { events: [], startDate: '', endDate: '', totalEvents: 0 };\n  }\n}\n\nexport async function getEntityTimeline(entityType: string, entityId: string): Promise<TimelineEvent[]> {\n  try {\n    const response = await http.get<{ events: TimelineEvent[] }>(`/api/timeline/${entityType}/${entityId}`);\n    return response.data.events || [];\n  } catch {\n    return [];\n  }\n}\n\n// ============================================\n// COST FUNCTIONS (existing)\n// ============================================\n\nexport async function getCosts(options?: {\n  startDate?: string;\n  endDate?: string;\n  provider?: string;\n  model?: string;\n}): Promise<LLMCost[]> {\n  try {\n    const params = new URLSearchParams();\n    if (options?.startDate) params.set('startDate', options.startDate);\n    if (options?.endDate) params.set('endDate', options.endDate);\n    if (options?.provider) params.set('provider', options.provider);\n    if (options?.model) params.set('model', options.model);\n\n    const query = params.toString();\n    const url = query ? `/api/costs?${query}` : '/api/costs';\n\n    const response = await http.get<{ costs: LLMCost[] }>(url);\n    return response.data.costs || [];\n  } catch {\n    return [];\n  }\n}\n\nexport async function getCostSummary(period?: 'day' | 'week' | 'month' | 'all'): Promise<CostSummary> {\n  try {\n    const url = period ? `/api/costs/summary?period=${period}` : '/api/costs/summary';\n    const response = await http.get<Record<string, unknown>>(url);\n    const raw = response.data;\n    if (!raw) {\n      return {\n        total: 0,\n        byProvider: {},\n        byModel: {},\n        byOperation: {},\n        period: { start: '', end: '' },\n        dailyBreakdown: [],\n      };\n    }\n    // Normalize snake_case from API to camelCase for frontend\n    const dailyBreakdown = (raw.dailyBreakdown ?? raw.daily_breakdown) as Array<{ date: string; cost: number; calls?: number; requests?: number }> | undefined;\n    const normalized = (dailyBreakdown ?? []).map((d) => ({\n      date: d.date,\n      cost: typeof d.cost === 'number' ? d.cost : parseFloat(String(d.cost)) || 0,\n      calls: d.calls ?? d.requests ?? 0,\n    }));\n    return {\n      total: typeof raw.total === 'number' ? raw.total : parseFloat(String(raw.total)) || 0,\n      byProvider: (raw.byProvider ?? raw.by_provider ?? {}) as Record<string, number>,\n      byModel: (raw.byModel ?? raw.by_model ?? {}) as Record<string, number>,\n      byOperation: (raw.byOperation ?? raw.by_operation ?? {}) as Record<string, number>,\n      byContext: (raw.byContext ?? raw.by_context) as Record<string, number> | undefined,\n      period: (raw.period ?? { start: '', end: '' }) as { start: string; end: string },\n      dailyBreakdown: normalized,\n      totalInputTokens: (raw.totalInputTokens ?? raw.total_input_tokens) as number | undefined,\n      totalOutputTokens: (raw.totalOutputTokens ?? raw.total_output_tokens) as number | undefined,\n      previousPeriodCost: (raw.previousPeriodCost ?? raw.previous_period_cost) as number | null | undefined,\n      percentChange: (raw.percentChange ?? raw.percent_change) as number | null | undefined,\n      budgetLimit: (raw.budgetLimit ?? raw.budget_limit) as number | null | undefined,\n      budgetUsedPercent: (raw.budgetUsedPercent ?? raw.budget_used_percent) as number | null | undefined,\n      budgetAlertTriggered: (raw.budgetAlertTriggered ?? raw.budget_alert_triggered) as boolean | undefined,\n    };\n  } catch {\n    return {\n      total: 0,\n      byProvider: {},\n      byModel: {},\n      byOperation: {},\n      period: { start: '', end: '' },\n      dailyBreakdown: [],\n    };\n  }\n}\n\nexport interface RecentCostRequest {\n  id: string;\n  timestamp: string;\n  provider: string;\n  model: string;\n  operation?: string;\n  request_type?: string | null;\n  input_tokens?: number;\n  output_tokens?: number;\n  cost?: number;\n  latency_ms?: number | null;\n  success?: boolean;\n}\n\nexport async function getRecentCostRequests(limit = 20): Promise<RecentCostRequest[]> {\n  try {\n    const response = await http.get<{ requests: RecentCostRequest[] }>(\n      `/api/costs/recent?limit=${limit}`\n    );\n    return response.data?.requests ?? [];\n  } catch {\n    return [];\n  }\n}\n\nexport interface PricingRow {\n  model: string;\n  inputPer1M: number;\n  outputPer1M: number;\n}\n\nexport async function getCostsPricing(): Promise<PricingRow[]> {\n  try {\n    const response = await http.get<{ pricing: PricingRow[] }>('/api/costs/pricing');\n    return response.data?.pricing ?? [];\n  } catch {\n    return [];\n  }\n}\n\nexport interface CostBudget {\n  period: 'week' | 'month';\n  limitUsd: number;\n  alertThresholdPercent: number;\n  notifiedAt?: string | null;\n}\n\nexport async function getCostsBudget(period: 'week' | 'month'): Promise<CostBudget | null> {\n  try {\n    const response = await http.get<{ budget: Record<string, unknown> | null }>(\n      `/api/costs/budget?period=${period}`\n    );\n    const raw = response.data?.budget;\n    if (!raw) return null;\n    const limitUsd = (raw.limitUsd ?? raw.limit_usd) as number | undefined;\n    const alertThresholdPercent = (raw.alertThresholdPercent ?? raw.alert_threshold_percent) as number | undefined;\n    if (limitUsd == null || !Number.isFinite(Number(limitUsd))) return null;\n    return {\n      period: (raw.period as 'week' | 'month') ?? period,\n      limitUsd: Number(limitUsd),\n      alertThresholdPercent: alertThresholdPercent != null ? Math.min(100, Math.max(0, Number(alertThresholdPercent))) : 80,\n      notifiedAt: (raw.notifiedAt ?? raw.notified_at) as string | null | undefined,\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport async function setCostsBudget(\n  period: 'week' | 'month',\n  limitUsd: number,\n  alertThresholdPercent: number\n): Promise<void> {\n  await http.post('/api/costs/budget', {\n    period,\n    limitUsd,\n    alertThresholdPercent,\n  });\n}\n\nexport async function getLLMConfig(): Promise<{\n  provider: string;\n  model: string;\n  available: string[];\n  limits?: Record<string, number>;\n}> {\n  try {\n    const response = await http.get<{\n      provider: string;\n      model: string;\n      available: string[];\n      limits?: Record<string, number>;\n    }>('/api/llm/config');\n    return response.data;\n  } catch {\n    return { provider: 'unknown', model: 'unknown', available: [] };\n  }\n}\n\n// ============================================\n// SERVICE EXPORTS\n// ============================================\n\nexport const graphService = {\n  // Data\n  getVisualizationData,\n  getStats,\n  getGraph,\n  getEntityGraph,\n  getRelated: getRelatedEntities,\n  \n  // Ontology\n  getOntologySchema,\n  getOntologyEntities,\n  getOntologyRelations,\n  getOntologySuggestions,\n  approveOntologySuggestion,\n  rejectOntologySuggestion,\n  \n  // Ontology SOTA v2.0\n  getOntologyTypeStats,\n  getOntologySyncStatus,\n  forceOntologySync,\n  runLLMAnalysis,\n  autoApproveHighConfidence,\n  getOntologyChanges,\n  migrateOntologyToSupabase,\n  \n  // Background Worker (SOTA v2.1)\n  getBackgroundWorkerStatus,\n  triggerBackgroundAnalysis,\n  getBackgroundWorkerLog,\n  getOntologyJobs,\n  toggleOntologyJob,\n  \n  // Ontology Extractor (SOTA v2.1)\n  extractOntologyFromGraph,\n  validateOntologyCompliance,\n  getOntologyDiff,\n  findUnusedOntologyTypes,\n  mergeOntology,\n  cleanupOntology,\n  getFalkorDBBrowserInfo,\n  \n  // Graph Management (legacy names kept for compatibility)\n  listAllFalkorDBGraphs,\n  syncFalkorDBGraphs,\n  deleteFalkorDBGraph,\n  \n  // Analytics\n  getCommunities,\n  getCentrality,\n  getBridges,\n  getInsights,\n  \n  // GraphRAG / AI\n  query: graphRAGQuery,\n  stream: streamGraphRAGQuery,\n  multiHop: multiHopQuery,\n  explainConnection,\n  summarizeSelection,\n  naturalLanguageFilter,\n  suggestRelated,\n  \n  // Cypher\n  executeCypher,\n  getQueryTemplates,\n  \n  // Cross-project\n  getProjectGraphs,\n  getCrossProjectEntities,\n  \n  // Persistence - Queries\n  saveQueryHistory,\n  getQueryHistory,\n  toggleQueryFavorite,\n  deleteQueryHistory,\n  \n  // Persistence - Views\n  saveView,\n  getSavedViews,\n  updateView,\n  deleteView,\n  \n  // Persistence - Bookmarks\n  addBookmark,\n  getBookmarks,\n  updateBookmark,\n  removeBookmark,\n  \n  // Persistence - Annotations\n  createAnnotation,\n  getAnnotations,\n  updateAnnotation,\n  deleteAnnotation,\n  \n  // Persistence - Chat\n  saveChatMessage,\n  getChatSessions,\n  getChatHistory,\n  toggleChatPin,\n  \n  // Persistence - Snapshots\n  createSnapshot,\n  getSnapshots,\n  getSnapshot,\n  compareSnapshots,\n  deleteSnapshot,\n};\n\nexport const timelineService = {\n  getAll: getTimeline,\n  getTimeline, // Direct export for backwards compatibility\n  getForEntity: getEntityTimeline,\n};\n\nexport const costsService = {\n  getAll: getCosts,\n  getSummary: getCostSummary,\n  getRecentRequests: getRecentCostRequests,\n  getPricing: getCostsPricing,\n  getBudget: getCostsBudget,\n  setBudget: setCostsBudget,\n  getLLMConfig,\n};\n","/**\n * Notifications Service\n * Handles notifications and collaboration features\n */\n\nimport { http } from './api';\n\nexport interface Notification {\n  id: string;\n  type: 'info' | 'warning' | 'success' | 'error' | 'mention' | 'assignment' | 'update' | 'reminder';\n  title: string;\n  message: string;\n  entity_type?: 'question' | 'risk' | 'action' | 'decision' | 'document' | 'contact' | 'project';\n  entity_id?: string;\n  is_read: boolean;\n  read?: boolean; // Alias for is_read\n  created_at: string;\n  read_at?: string;\n  action_url?: string;\n}\n\nexport interface Comment {\n  id: string;\n  entity_type: 'question' | 'risk' | 'action' | 'decision' | 'document' | 'contact';\n  entity_id: string;\n  content: string;\n  author: string;\n  author_id?: string;\n  user_id?: string;\n  user_name?: string;\n  mentions?: string[];\n  reactions?: Array<{\n    emoji: string;\n    users: string[];\n  }>;\n  parent_id?: string;\n  replies?: Comment[];\n  resolved?: boolean;\n  resolved_at?: string;\n  resolved_by?: string;\n  created_at: string;\n  updated_at?: string;\n  is_edited: boolean;\n}\n\nexport interface ProjectMember {\n  id: string;\n  user_id: string;\n  project_id: string;\n  role: 'owner' | 'admin' | 'editor' | 'viewer';\n  email: string;\n  name?: string;\n  avatar_url?: string;\n  joined_at: string;\n  invited_by?: string;\n  last_active?: string;\n}\n\n/**\n * Get all notifications\n */\nexport async function getNotifications(options?: {\n  unread?: boolean;\n  type?: string;\n  limit?: number;\n}): Promise<Notification[]> {\n  try {\n    const params = new URLSearchParams();\n    if (options?.unread) params.set('unread', 'true');\n    if (options?.type) params.set('type', options.type);\n    if (options?.limit) params.set('limit', String(options.limit));\n\n    const query = params.toString();\n    const url = query ? `/api/notifications?${query}` : '/api/notifications';\n\n    const response = await http.get<{ notifications: Notification[] }>(url);\n    return response.data.notifications || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get unread count\n */\nexport async function getUnreadCount(): Promise<number> {\n  try {\n    const response = await http.get<{ count: number }>('/api/notifications/count');\n    return response.data.count || 0;\n  } catch {\n    return 0;\n  }\n}\n\n/**\n * Mark notification as read\n */\nexport async function markAsRead(id: string): Promise<void> {\n  await http.post(`/api/notifications/${id}/read`);\n}\n\n/**\n * Mark all as read\n */\nexport async function markAllAsRead(): Promise<void> {\n  await http.post('/api/notifications/read-all');\n}\n\n/**\n * Delete a notification\n */\nexport async function deleteNotification(id: string): Promise<void> {\n  await http.delete(`/api/notifications/${id}`);\n}\n\n/**\n * Get comments for an entity\n */\nexport async function getComments(entityType: string, entityId: string): Promise<Comment[]> {\n  try {\n    const response = await http.get<{ comments: Comment[] }>(`/api/comments/${entityType}/${entityId}`);\n    return response.data.comments || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Add a comment\n */\nexport async function addComment(entityType: string, entityId: string, content: string, parentId?: string): Promise<Comment> {\n  const response = await http.post<{ comment: Comment; id: string }>(`/api/comments/${entityType}/${entityId}`, {\n    content,\n    parentId,\n  });\n  return response.data.comment || {\n    id: response.data.id,\n    entity_type: entityType as Comment['entity_type'],\n    entity_id: entityId,\n    content,\n    author: 'You',\n    created_at: new Date().toISOString(),\n    is_edited: false,\n  };\n}\n\n/**\n * Update a comment\n */\nexport async function updateComment(commentId: string, content: string): Promise<void> {\n  await http.put(`/api/comments/${commentId}`, { content });\n}\n\n/**\n * Delete a comment\n */\nexport async function deleteComment(commentId: string): Promise<void> {\n  await http.delete(`/api/comments/${commentId}`);\n}\n\n/**\n * Add reaction to comment\n */\nexport async function addReaction(commentId: string, emoji: string): Promise<void> {\n  await http.post(`/api/comments/${commentId}/react`, { emoji });\n}\n\n/**\n * Remove reaction from comment\n */\nexport async function removeReaction(commentId: string, emoji: string): Promise<void> {\n  await http.delete(`/api/comments/${commentId}/react/${emoji}`);\n}\n\n/**\n * Create comment (alias for addComment)\n */\nexport async function createComment(entityType: string, entityId: string, content: string, parentId?: string): Promise<Comment> {\n  return addComment(entityType, entityId, content, parentId);\n}\n\n/**\n * Resolve a comment thread\n */\nexport async function resolveComment(commentId: string): Promise<void> {\n  await http.put(`/api/comments/${commentId}/resolve`);\n}\n\n/**\n * Get project members\n */\nexport async function getProjectMembers(projectId?: string): Promise<ProjectMember[]> {\n  try {\n    const url = projectId ? `/api/projects/${projectId}/members` : '/api/project/members';\n    const response = await http.get<{ members: ProjectMember[] }>(url);\n    return response.data.members || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Invite member to project\n */\nexport async function inviteMember(email: string, role: 'admin' | 'editor' | 'viewer', projectId?: string): Promise<{ success: boolean; inviteId: string }> {\n  const url = projectId ? `/api/projects/${projectId}/members` : '/api/project/members';\n  const response = await http.post<{ success: boolean; inviteId: string }>(url, { email, role });\n  return response.data;\n}\n\n/**\n * Update member role\n */\nexport async function updateMemberRole(memberId: string, role: 'admin' | 'editor' | 'viewer', projectId?: string): Promise<void> {\n  const url = projectId ? `/api/projects/${projectId}/members/${memberId}` : `/api/project/members/${memberId}`;\n  await http.put(url, { role });\n}\n\n/**\n * Remove member from project\n */\nexport async function removeMember(memberId: string, projectId?: string): Promise<void> {\n  const url = projectId ? `/api/projects/${projectId}/members/${memberId}` : `/api/project/members/${memberId}`;\n  await http.delete(url);\n}\n\nexport const notificationsService = {\n  getAll: getNotifications,\n  getUnreadCount,\n  markAsRead,\n  markRead: markAsRead, // Alias\n  markAllAsRead,\n  markAllRead: markAllAsRead, // Alias\n  delete: deleteNotification,\n};\n\nexport const commentsService = {\n  getAll: getComments,\n  add: addComment,\n  create: createComment,\n  update: updateComment,\n  delete: deleteComment,\n  addReaction,\n  removeReaction,\n  resolve: resolveComment,\n};\n\nexport interface PendingInvite {\n  id: string;\n  email: string;\n  role: 'admin' | 'editor' | 'viewer';\n  invited_at: string;\n  created_at?: string;\n  invited_by?: string;\n  status: 'pending' | 'accepted' | 'expired';\n}\n\n/**\n * Get pending invites for a project\n */\nexport async function getInvites(projectId?: string): Promise<PendingInvite[]> {\n  try {\n    const url = projectId ? `/api/projects/${projectId}/invites` : '/api/project/invites';\n    const response = await http.get<{ invites: PendingInvite[] }>(url);\n    return response.data.invites || [];\n  } catch {\n    return [];\n  }\n}\n\nexport const membersService = {\n  getAll: getProjectMembers,\n  invite: inviteMember,\n  updateRole: updateMemberRole,\n  remove: removeMember,\n  getInvites,\n};\n","/**\n * Settings Service\n * Handles user settings, API keys, webhooks, and audit logs\n */\n\nimport { http } from './api';\n\nexport interface UserSettings {\n  theme?: 'light' | 'dark' | 'system';\n  language?: string;\n  timezone?: string;\n  notifications?: {\n    email: boolean;\n    browser: boolean;\n    mentions: boolean;\n    updates: boolean;\n  };\n  display?: {\n    density: 'compact' | 'comfortable' | 'spacious';\n    sidebarCollapsed: boolean;\n  };\n  ai?: {\n    model?: string;\n    temperature?: number;\n    autoSuggest: boolean;\n  };\n}\n\nexport interface ProjectSettings {\n  name: string;\n  description?: string;\n  userRole?: string;\n  userRolePrompt?: string;\n  llm?: {\n    provider: string;\n    model: string;\n  };\n  processing?: {\n    autoExtractFacts: boolean;\n    autoCreateQuestions: boolean;\n    deduplication: boolean;\n  };\n  notifications?: {\n    dailyBriefing: boolean;\n    overdueAlerts: boolean;\n  };\n}\n\nexport interface APIKey {\n  id: string;\n  name: string;\n  key_prefix: string;\n  permissions: string[];\n  last_used?: string;\n  expires_at?: string;\n  created_at: string;\n  is_active: boolean;\n}\n\nexport interface Webhook {\n  id: string;\n  name: string;\n  url: string;\n  events: string[];\n  secret?: string;\n  is_active: boolean;\n  last_triggered?: string;\n  failure_count: number;\n  created_at: string;\n}\n\nexport interface AuditLogEntry {\n  id: string;\n  action: string;\n  entity_type: string;\n  entity_id: string;\n  user_id?: string;\n  user_email?: string;\n  changes?: Record<string, { old: unknown; new: unknown }>;\n  metadata?: Record<string, unknown>;\n  ip_address?: string;\n  user_agent?: string;\n  timestamp: string;\n}\n\n/**\n * Get user settings\n */\nexport async function getUserSettings(): Promise<UserSettings> {\n  try {\n    const response = await http.get<UserSettings>('/api/settings');\n    return response.data;\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Update user settings\n */\nexport async function updateUserSettings(settings: Partial<UserSettings>): Promise<void> {\n  await http.put('/api/settings', settings);\n}\n\n/**\n * Get project settings\n */\nexport async function getProjectSettings(projectId?: string): Promise<ProjectSettings | null> {\n  try {\n    const url = projectId ? `/api/projects/${projectId}/settings` : '/api/project/settings';\n    const response = await http.get<{ settings: ProjectSettings }>(url);\n    return response.data.settings;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Update project settings\n */\nexport async function updateProjectSettings(settings: Partial<ProjectSettings>, projectId?: string): Promise<void> {\n  const url = projectId ? `/api/projects/${projectId}/settings` : '/api/project/settings';\n  await http.put(url, settings);\n}\n\n/**\n * Get API keys\n */\nexport async function getAPIKeys(): Promise<APIKey[]> {\n  try {\n    const response = await http.get<{ keys: APIKey[] }>('/api/api-keys');\n    return response.data.keys || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Create API key\n */\nexport async function createAPIKey(name: string, permissions: string[]): Promise<{ key: string; id: string }> {\n  const response = await http.post<{ key: string; id: string }>('/api/api-keys', { name, permissions });\n  return response.data;\n}\n\n/**\n * Revoke API key\n */\nexport async function revokeAPIKey(id: string): Promise<void> {\n  await http.delete(`/api/api-keys/${id}`);\n}\n\n/**\n * Get webhooks\n */\nexport async function getWebhooks(): Promise<Webhook[]> {\n  try {\n    const response = await http.get<{ webhooks: Webhook[] }>('/api/webhooks');\n    return response.data.webhooks || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Create webhook\n */\nexport async function createWebhook(webhook: {\n  name: string;\n  url: string;\n  events: string[];\n  secret?: string;\n}): Promise<Webhook> {\n  const response = await http.post<{ webhook: Webhook; id: string }>('/api/webhooks', webhook);\n  return response.data.webhook || { ...webhook, id: response.data.id, is_active: true, failure_count: 0, created_at: new Date().toISOString() };\n}\n\n/**\n * Update webhook\n */\nexport async function updateWebhook(id: string, updates: Partial<Webhook>): Promise<void> {\n  await http.put(`/api/webhooks/${id}`, updates);\n}\n\n/**\n * Delete webhook\n */\nexport async function deleteWebhook(id: string): Promise<void> {\n  await http.delete(`/api/webhooks/${id}`);\n}\n\n/**\n * Test webhook\n */\nexport async function testWebhook(id: string): Promise<{ success: boolean; status: number; response?: string }> {\n  const response = await http.post<{ success: boolean; status: number; response?: string }>(`/api/webhooks/${id}/test`);\n  return response.data;\n}\n\n/**\n * Get audit logs\n */\nexport async function getAuditLogs(options?: {\n  action?: string;\n  entity_type?: string;\n  user_id?: string;\n  startDate?: string;\n  endDate?: string;\n  limit?: number;\n  offset?: number;\n}): Promise<{ logs: AuditLogEntry[]; total: number }> {\n  try {\n    const params = new URLSearchParams();\n    if (options?.action) params.set('action', options.action);\n    if (options?.entity_type) params.set('entity_type', options.entity_type);\n    if (options?.user_id) params.set('user_id', options.user_id);\n    if (options?.startDate) params.set('startDate', options.startDate);\n    if (options?.endDate) params.set('endDate', options.endDate);\n    if (options?.limit) params.set('limit', String(options.limit));\n    if (options?.offset) params.set('offset', String(options.offset));\n\n    const query = params.toString();\n    const url = query ? `/api/audit?${query}` : '/api/audit';\n\n    const response = await http.get<{ logs: AuditLogEntry[]; total: number }>(url);\n    return response.data;\n  } catch {\n    return { logs: [], total: 0 };\n  }\n}\n\n/**\n * Export audit logs\n */\nexport async function exportAuditLogs(format: 'json' | 'csv', options?: {\n  startDate?: string;\n  endDate?: string;\n}): Promise<Blob> {\n  const params = new URLSearchParams();\n  params.set('format', format);\n  if (options?.startDate) params.set('startDate', options.startDate);\n  if (options?.endDate) params.set('endDate', options.endDate);\n\n  const response = await fetch(`/api/audit/export?${params.toString()}`);\n  if (!response.ok) throw new Error('Export failed');\n  return response.blob();\n}\n\nexport const userSettingsService = {\n  get: getUserSettings,\n  update: updateUserSettings,\n};\n\nexport const projectSettingsService = {\n  get: getProjectSettings,\n  update: updateProjectSettings,\n};\n\nexport const apiKeysService = {\n  getAll: getAPIKeys,\n  create: createAPIKey,\n  revoke: revokeAPIKey,\n};\n\nexport const webhooksService = {\n  getAll: getWebhooks,\n  create: createWebhook,\n  update: updateWebhook,\n  delete: deleteWebhook,\n  test: testWebhook,\n};\n\nexport const auditService = {\n  getAll: getAuditLogs,\n  export: exportAuditLogs,\n};\n","/**\n * Profile Service\n * Handles user profile management\n */\n\nimport { http } from './api';\nimport { appStore, User } from '../stores/app';\n\nexport interface UserProfile {\n  id: string;\n  email: string;\n  username?: string;\n  display_name?: string;\n  avatar_url?: string;\n  timezone?: string;\n  locale?: string;\n  bio?: string;\n  role?: 'user' | 'admin' | 'superadmin';\n  preferences?: Record<string, unknown>;\n  created_at: string;\n  updated_at?: string;\n}\n\nexport interface UpdateProfileRequest {\n  username?: string;\n  display_name?: string;\n  avatar_url?: string;\n  timezone?: string;\n  locale?: string;\n  bio?: string;\n  preferences?: Record<string, unknown>;\n}\n\nexport interface ChangePasswordRequest {\n  current_password: string;\n  new_password: string;\n}\n\n/**\n * Get current user profile\n */\nexport async function getProfile(): Promise<UserProfile | null> {\n  try {\n    const response = await http.get<{ profile: UserProfile }>('/api/profile');\n    return response.data.profile;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Update user profile\n */\nexport async function updateProfile(data: UpdateProfileRequest): Promise<UserProfile> {\n  const response = await http.put<{ profile: UserProfile }>('/api/profile', data);\n  \n  // Update app store with new user info\n  const currentUser = appStore.getState().currentUser;\n  if (currentUser) {\n    appStore.setCurrentUser({\n      ...currentUser,\n      name: data.display_name || currentUser.name,\n      avatar: data.avatar_url || currentUser.avatar,\n    });\n  }\n  \n  return response.data.profile;\n}\n\n/**\n * Upload avatar\n */\nexport async function uploadAvatar(file: File): Promise<string> {\n  const formData = new FormData();\n  formData.append('avatar', file);\n\n  const response = await fetch('/api/profile/avatar', {\n    method: 'POST',\n    body: formData,\n  });\n\n  if (!response.ok) {\n    throw new Error('Avatar upload failed');\n  }\n\n  const data = await response.json();\n  \n  // Update app store\n  const currentUser = appStore.getState().currentUser;\n  if (currentUser) {\n    appStore.setCurrentUser({\n      ...currentUser,\n      avatar: data.avatar_url,\n    });\n  }\n  \n  return data.avatar_url;\n}\n\n/**\n * Remove avatar\n */\nexport async function removeAvatar(): Promise<void> {\n  await http.delete('/api/profile/avatar');\n  \n  // Update app store\n  const currentUser = appStore.getState().currentUser;\n  if (currentUser) {\n    appStore.setCurrentUser({\n      ...currentUser,\n      avatar: undefined,\n    });\n  }\n}\n\n/**\n * Change password\n */\nexport async function changePassword(data: ChangePasswordRequest): Promise<void> {\n  if (data.new_password.length < 12) {\n    throw new Error('New password must be at least 12 characters');\n  }\n\n  await http.post('/api/profile/change-password', data);\n}\n\n/**\n * Delete account\n */\nexport async function deleteAccount(password: string): Promise<void> {\n  await http.post('/api/profile/delete', { password });\n  appStore.setCurrentUser(null);\n  appStore.setCurrentProject(null);\n}\n\n/**\n * Get user activity\n */\nexport async function getActivity(limit = 50): Promise<Array<{\n  type: string;\n  action: string;\n  entity_type: string;\n  entity_id: string;\n  timestamp: string;\n}>> {\n  try {\n    const response = await http.get<{ activities: Array<{\n      type: string;\n      action: string;\n      entity_type: string;\n      entity_id: string;\n      timestamp: string;\n    }> }>(`/api/profile/activity?limit=${limit}`);\n    return response.data.activities || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get user sessions\n */\nexport async function getSessions(): Promise<Array<{\n  id: string;\n  device: string;\n  location?: string;\n  ip_address: string;\n  last_active: string;\n  is_current: boolean;\n}>> {\n  try {\n    const response = await http.get<{ sessions: Array<{\n      id: string;\n      device: string;\n      location?: string;\n      ip_address: string;\n      last_active: string;\n      is_current: boolean;\n    }> }>('/api/profile/sessions');\n    return response.data.sessions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Revoke a session\n */\nexport async function revokeSession(sessionId: string): Promise<void> {\n  await http.delete(`/api/profile/sessions/${sessionId}`);\n}\n\n/**\n * Revoke all other sessions\n */\nexport async function revokeAllSessions(): Promise<void> {\n  await http.post('/api/profile/sessions/revoke-all');\n}\n\nexport const profileService = {\n  get: getProfile,\n  update: updateProfile,\n  uploadAvatar,\n  removeAvatar,\n  changePassword,\n  deleteAccount,\n  getActivity,\n  getSessions,\n  revokeSession,\n  revokeAllSessions,\n};\n","/**\n * Facts Service\n * Handles facts CRUD and conflict detection\n */\n\nimport { http } from './api';\n\nexport interface Fact {\n  id: string | number;\n  content: string;\n  source?: string;\n  source_file?: string;\n  source_document_id?: string;\n  category?: string;\n  confidence?: number;\n  verified?: boolean;\n  verified_by?: string;\n  verified_at?: string;\n  created_at: string;\n  updated_at?: string;\n}\n\nexport interface CreateFactRequest {\n  content: string;\n  source?: string;\n  category?: string;\n  verified?: boolean;\n}\n\nexport interface UpdateFactRequest {\n  content?: string;\n  source?: string;\n  category?: string;\n  verified?: boolean;\n}\n\nexport interface FactConflict {\n  factId1: string | number;\n  factId2: string | number;\n  fact1: Fact;\n  fact2: Fact;\n  conflictType: 'contradiction' | 'inconsistency' | 'outdated' | 'process';\n  description?: string;\n  reason?: string;\n  confidence?: number;\n}\n\n/**\n * Get all facts\n */\nexport async function getFacts(options?: {\n  limit?: number;\n  offset?: number;\n  search?: string;\n  category?: string;\n  verified?: boolean;\n}): Promise<{ facts: Fact[]; total: number }> {\n  try {\n    const params = new URLSearchParams();\n    if (options?.limit) params.set('limit', String(options.limit));\n    if (options?.offset) params.set('offset', String(options.offset));\n    if (options?.search) params.set('search', options.search);\n    if (options?.category) params.set('category', options.category);\n    if (options?.verified !== undefined) params.set('verified', String(options.verified));\n\n    const query = params.toString();\n    const url = query ? `/api/facts?${query}` : '/api/facts';\n\n    const response = await http.get<{ facts: Fact[]; total?: number }>(url);\n    return {\n      facts: response.data.facts || [],\n      total: response.data.total || response.data.facts?.length || 0,\n    };\n  } catch {\n    return { facts: [], total: 0 };\n  }\n}\n\n/**\n * Get a single fact\n */\nexport async function getFact(id: string | number): Promise<Fact | null> {\n  try {\n    const response = await http.get<{ fact: Fact }>(`/api/facts/${id}`);\n    return response.data.fact;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Create a new fact\n */\nexport async function createFact(data: CreateFactRequest): Promise<Fact> {\n  const response = await http.post<{ fact: Fact; id: string | number }>('/api/facts', data);\n  return response.data.fact || {\n    ...data,\n    id: response.data.id,\n    created_at: new Date().toISOString(),\n  } as Fact;\n}\n\n/**\n * Update a fact\n */\nexport async function updateFact(id: string | number, data: UpdateFactRequest): Promise<Fact> {\n  const response = await http.put<{ fact: Fact }>(`/api/facts/${id}`, data);\n  return response.data.fact;\n}\n\n/**\n * Delete a fact (soft delete; syncs removal to graph/FalkorDB)\n */\nexport async function deleteFact(id: string | number): Promise<void> {\n  await http.delete(`/api/facts/${id}`);\n}\n\n/**\n * List soft-deleted facts (for restore / undo)\n */\nexport async function getDeletedFacts(): Promise<Fact[]> {\n  try {\n    const response = await http.get<{ facts: Fact[] }>('/api/facts/deleted');\n    return response.data.facts || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Restore a soft-deleted fact (undo); syncs back to graph/FalkorDB\n */\nexport async function restoreFact(id: string | number): Promise<Fact> {\n  const response = await http.post<{ fact: Fact }>(`/api/facts/${id}/restore`, {});\n  return response.data.fact;\n}\n\n/**\n * Verify a fact\n */\nexport async function verifyFact(id: string | number): Promise<Fact> {\n  return updateFact(id, { verified: true });\n}\n\n/**\n * Run full fact-check (AI analysis, records conflict_detected events)\n */\nexport async function runFactCheck(): Promise<{ ok: boolean; conflicts: FactConflict[]; analyzed_facts: number; events_recorded: number }> {\n  const response = await http.post<{ ok: boolean; conflicts: FactConflict[]; analyzed_facts: number; events_recorded: number }>('/api/fact-check/run', {});\n  return response.data;\n}\n\n/**\n * Detect conflicts between facts\n */\nexport async function detectConflicts(): Promise<FactConflict[]> {\n  try {\n    const response = await http.get<{ conflicts: FactConflict[] }>('/api/conflicts');\n    return response.data.conflicts || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get facts by category\n */\nexport async function getFactsByCategory(): Promise<Record<string, Fact[]>> {\n  try {\n    const { facts } = await getFacts({ limit: 1000 });\n    const grouped: Record<string, Fact[]> = {};\n    \n    facts.forEach(fact => {\n      const category = fact.category || 'Uncategorized';\n      if (!grouped[category]) grouped[category] = [];\n      grouped[category].push(fact);\n    });\n    \n    return grouped;\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get facts grouped by source (source_file or source)\n */\nexport async function getFactsBySource(): Promise<Record<string, Fact[]>> {\n  try {\n    const { facts } = await getFacts({ limit: 1000 });\n    const grouped: Record<string, Fact[]> = {};\n    \n    facts.forEach(fact => {\n      const source = fact.source_file || fact.source || 'Unknown source';\n      if (!grouped[source]) grouped[source] = [];\n      grouped[source].push(fact);\n    });\n    \n    return grouped;\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get facts by source document id\n */\nexport async function getFactsByDocument(documentId: string): Promise<Fact[]> {\n  try {\n    const params = new URLSearchParams({ document_id: documentId });\n    const response = await http.get<{ facts: Fact[] }>(`/api/facts?${params}`);\n    return response.data.facts || [];\n  } catch {\n    return [];\n  }\n}\n\nexport interface FactEvent {\n  id: string;\n  fact_id: string;\n  event_type: string;\n  event_data?: Record<string, unknown>;\n  actor_user_id?: string;\n  actor_name?: string;\n  created_at: string;\n}\n\n/**\n * Get fact events (timeline) for a fact\n */\nexport async function getFactEvents(factId: string | number): Promise<FactEvent[]> {\n  try {\n    const response = await http.get<{ events: FactEvent[] }>(`/api/facts/${factId}/events`);\n    return response.data.events || [];\n  } catch {\n    return [];\n  }\n}\n\nexport interface SimilarFactItem {\n  fact: Fact;\n  similarityScore: number;\n}\n\n/**\n * Get similar facts (from fact_similarities cache or computed)\n */\nexport async function getSimilarFacts(factId: string | number, limit = 10): Promise<SimilarFactItem[]> {\n  try {\n    const params = new URLSearchParams();\n    if (limit !== 10) params.set('limit', String(limit));\n    const query = params.toString();\n    const url = query ? `/api/facts/${factId}/similar?${query}` : `/api/facts/${factId}/similar`;\n    const response = await http.get<{ similar: SimilarFactItem[] }>(url);\n    return response.data.similar || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Search facts\n */\nexport async function searchFacts(query: string, limit = 20): Promise<Fact[]> {\n  const { facts } = await getFacts({ search: query, limit });\n  return facts;\n}\n\n/**\n * Get fact statistics\n */\nexport function getFactStats(facts: Fact[]): {\n  total: number;\n  verified: number;\n  unverified: number;\n  byCategory: Record<string, number>;\n} {\n  const stats = {\n    total: facts.length,\n    verified: facts.filter(f => f.verified).length,\n    unverified: facts.filter(f => !f.verified).length,\n    byCategory: {} as Record<string, number>,\n  };\n\n  facts.forEach(fact => {\n    const category = fact.category || 'Uncategorized';\n    stats.byCategory[category] = (stats.byCategory[category] || 0) + 1;\n  });\n\n  return stats;\n}\n\nexport const factsService = {\n  getAll: getFacts,\n  get: getFact,\n  create: createFact,\n  update: updateFact,\n  delete: deleteFact,\n  deleteFact, // Alias for backwards compatibility\n  verify: verifyFact,\n  verifyFact, // Alias for backwards compatibility\n  detectConflicts,\n  getByCategory: getFactsByCategory,\n  getBySource: getFactsBySource,\n  getByDocument: getFactsByDocument,\n  getEvents: getFactEvents,\n  getSimilarFacts,\n  search: searchFacts,\n  getStats: getFactStats,\n  getDeletedFacts,\n  restoreFact,\n  runFactCheck,\n};\n","/**\n * Krisp Integration Service\n * Handles Krisp AI Meeting Assistant integration\n */\n\nimport { http } from './api';\n\n// ==================== Types ====================\n\nexport interface KrispWebhook {\n  id: string;\n  user_id: string;\n  webhook_token: string;\n  webhook_secret: string;\n  webhook_url: string;\n  is_active: boolean;\n  events_enabled: string[];\n  last_event_at?: string;\n  total_events_received: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface KrispTranscript {\n  id: string;\n  user_id: string;\n  krisp_meeting_id: string;\n  source: 'webhook' | 'mcp_sync';\n  event_type: string;\n  krisp_title: string;\n  display_title?: string;\n  meeting_date: string;\n  duration_minutes?: number;\n  speakers: string[];\n  has_unidentified_speakers: boolean;\n  matched_project_id?: string;\n  project_confidence?: number;\n  project_candidates?: ProjectCandidate[];\n  status_reason?: string;\n  matched_contacts?: MatchedContact[];\n  transcript_text?: string;\n  action_items?: unknown[];\n  key_points?: unknown[];\n  notes?: unknown;\n  status: 'pending' | 'quarantine' | 'ambiguous' | 'matched' | 'processed' | 'failed' | 'skipped';\n  retry_count: number;\n  processed_document_id?: string;\n  received_at: string;\n  projects?: {\n    id: string;\n    name: string;\n    project_number: string;\n  };\n}\n\nexport interface ProjectCandidate {\n  projectId: string;\n  projectName: string;\n  projectNumber: string;\n  count: number;\n  percentage: number;\n}\n\nexport interface MatchedContact {\n  speaker: string;\n  contact_id: string | null;\n  contact_name: string | null;\n  action: string;\n  confidence: number;\n}\n\nexport interface KrispSpeakerMapping {\n  id: string;\n  user_id?: string;\n  project_id: string;\n  speaker_name: string;\n  contact_id: string;\n  is_global: boolean;\n  is_active: boolean;\n  confidence: number;\n  source: string;\n  contacts?: {\n    id: string;\n    name: string;\n  };\n}\n\nexport interface TranscriptsSummary {\n  total_count: number;\n  pending_count: number;\n  quarantine_count: number;\n  ambiguous_count: number;\n  processed_count: number;\n  failed_count: number;\n}\n\nexport interface QuarantineStats {\n  total: number;\n  quarantine: number;\n  ambiguous: number;\n  maxedOut: number;\n  readyForRetry: number;\n}\n\n// ==================== Webhook Management ====================\n\n/**\n * Get or create Krisp webhook configuration\n */\nexport async function getWebhook(): Promise<KrispWebhook | null> {\n  try {\n    const response = await http.get<{ webhook: KrispWebhook }>('/api/krisp/webhook');\n    return response.data.webhook;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Regenerate webhook credentials\n */\nexport async function regenerateWebhook(): Promise<KrispWebhook | null> {\n  try {\n    const response = await http.post<{ webhook: KrispWebhook }>('/api/krisp/webhook/regenerate');\n    return response.data.webhook;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Toggle webhook active status\n */\nexport async function toggleWebhook(isActive: boolean): Promise<boolean> {\n  try {\n    await http.put('/api/krisp/webhook/toggle', { is_active: isActive });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Update enabled events\n */\nexport async function updateEnabledEvents(events: string[]): Promise<string[]> {\n  const response = await http.put<{ events: string[] }>('/api/krisp/webhook/events', { events });\n  return response.data.events;\n}\n\n// ==================== Transcript Management ====================\n\n/**\n * Get transcripts with optional filtering\n */\nexport async function getTranscripts(options: {\n  status?: string | string[];\n  projectId?: string;\n  limit?: number;\n  offset?: number;\n} = {}): Promise<KrispTranscript[]> {\n  const params = new URLSearchParams();\n  \n  if (options.status) {\n    if (Array.isArray(options.status)) {\n      params.append('status', options.status.join(','));\n    } else {\n      params.append('status', options.status);\n    }\n  }\n  if (options.projectId) params.append('project_id', options.projectId);\n  if (options.limit) params.append('limit', String(options.limit));\n  if (options.offset) params.append('offset', String(options.offset));\n\n  const url = `/api/krisp/transcripts${params.toString() ? `?${params}` : ''}`;\n  const response = await http.get<{ transcripts: KrispTranscript[] }>(url);\n  return response.data.transcripts;\n}\n\n/**\n * Get transcript by ID\n */\nexport async function getTranscript(id: string): Promise<KrispTranscript | null> {\n  try {\n    const response = await http.get<{ transcript: KrispTranscript }>(`/api/krisp/transcripts/${id}`);\n    return response.data.transcript;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get transcripts summary\n */\nexport async function getTranscriptsSummary(): Promise<TranscriptsSummary | null> {\n  try {\n    const response = await http.get<{ summary: TranscriptsSummary }>('/api/krisp/transcripts/summary');\n    return response.data.summary;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Assign transcript to a project\n */\nexport async function assignProject(transcriptId: string, projectId: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/assign`, { project_id: projectId });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Skip/discard a transcript\n */\nexport async function skipTranscript(transcriptId: string, reason?: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/skip`, { reason });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Force retry processing\n */\nexport async function retryTranscript(transcriptId: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/retry`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Process a MATCHED transcript (create document)\n */\nexport async function processTranscript(transcriptId: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/process`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==================== Speaker Mappings ====================\n\n/**\n * Get speaker mappings\n */\nexport async function getMappings(): Promise<KrispSpeakerMapping[]> {\n  try {\n    const response = await http.get<{ mappings: KrispSpeakerMapping[] }>('/api/krisp/mappings');\n    return response.data.mappings;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Create speaker mapping\n */\nexport async function createMapping(\n  speakerName: string,\n  contactId: string,\n  projectId: string,\n  isGlobal = false\n): Promise<KrispSpeakerMapping | null> {\n  try {\n    const response = await http.post<{ mapping: KrispSpeakerMapping }>('/api/krisp/mappings', {\n      speaker_name: speakerName,\n      contact_id: contactId,\n      project_id: projectId,\n      is_global: isGlobal\n    });\n    return response.data.mapping;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Delete speaker mapping\n */\nexport async function deleteMapping(mappingId: string): Promise<boolean> {\n  try {\n    await http.delete(`/api/krisp/mappings/${mappingId}`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==================== AI Summary ====================\n\nexport interface TranscriptSummary {\n  title: string;\n  date?: string;\n  duration?: number;\n  speakers: string[];\n  topic?: string;\n  keyPoints: string[];\n  actionItems: string[];\n  decisions?: string[];\n  nextSteps?: string;\n  notes?: string;\n  source: 'krisp_metadata' | 'ai_generated' | 'excerpt_fallback' | 'no_content';\n}\n\nexport interface GenerateSummaryOptions {\n  forceRegenerate?: boolean;\n}\n\n/**\n * Generate AI summary of a transcript\n */\nexport async function generateSummary(\n  transcriptId: string, \n  options: GenerateSummaryOptions = {}\n): Promise<TranscriptSummary | null> {\n  try {\n    const response = await http.post<{ summary: TranscriptSummary }>(\n      `/api/krisp/transcripts/${transcriptId}/summary`,\n      { forceRegenerate: options.forceRegenerate || false }\n    );\n    return response.data.summary;\n  } catch {\n    return null;\n  }\n}\n\n// ==================== Quarantine ====================\n\n/**\n * Get quarantine statistics\n */\nexport async function getQuarantineStats(): Promise<QuarantineStats | null> {\n  try {\n    const response = await http.get<{ stats: QuarantineStats }>('/api/krisp/quarantine/stats');\n    return response.data.stats;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get quarantined transcripts\n */\nexport async function getQuarantinedTranscripts(): Promise<KrispTranscript[]> {\n  return getTranscripts({ status: ['quarantine', 'ambiguous'] });\n}\n\n// ==================== MCP Import ====================\n\nexport interface McpMeeting {\n  meeting_id: string;\n  name: string;\n  date: string;\n  url?: string;\n  speakers?: string[];\n  attendees?: string[];\n  is_recurring?: boolean;\n  meeting_notes?: {\n    detailed_summary?: string;\n    key_points?: string[];\n    action_items?: string[];\n  };\n  transcript?: {\n    status?: string;\n    text?: string;\n  };\n}\n\nexport interface McpSearchFilters {\n  search?: string;\n  after?: string;\n  before?: string;\n  participantDomains?: string[];\n  limit?: number;\n  offset?: number;\n}\n\nexport interface ImportResult {\n  meetingId: string;\n  title?: string;\n  success: boolean;\n  transcriptId?: string;\n  error?: string;\n  duplicate?: boolean;\n}\n\nexport interface ImportResponse {\n  success: boolean;\n  results: ImportResult[];\n  imported: number;\n  skipped: number;\n  failed: number;\n}\n\nexport interface ImportHistoryItem {\n  id: string;\n  krisp_meeting_id: string;\n  krisp_title: string;\n  meeting_date: string;\n  status: string;\n  created_at: string;\n}\n\n/**\n * Check which meetings have already been imported\n */\nexport async function getImportedMeetingIds(meetingIds: string[]): Promise<string[]> {\n  if (!meetingIds.length) return [];\n  \n  try {\n    const response = await http.get<{ imported: string[] }>(\n      `/api/krisp/mcp/imported?ids=${meetingIds.join(',')}`\n    );\n    return response.data.imported;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Import meetings from MCP data\n */\nexport async function importMeetings(\n  meetings: McpMeeting[], \n  options: { forceReimport?: boolean } = {}\n): Promise<ImportResponse | null> {\n  try {\n    const response = await http.post<ImportResponse>('/api/krisp/mcp/import', {\n      meetings,\n      forceReimport: options.forceReimport\n    });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Import a single meeting\n */\nexport async function importMeeting(\n  meeting: McpMeeting,\n  options: { forceReimport?: boolean } = {}\n): Promise<ImportResult | null> {\n  const result = await importMeetings([meeting], options);\n  return result?.results[0] || null;\n}\n\n/**\n * Get import history\n */\nexport async function getImportHistory(\n  options: { limit?: number; offset?: number } = {}\n): Promise<ImportHistoryItem[]> {\n  try {\n    const params = new URLSearchParams();\n    if (options.limit) params.set('limit', String(options.limit));\n    if (options.offset) params.set('offset', String(options.offset));\n    \n    const url = `/api/krisp/mcp/history${params.toString() ? '?' + params.toString() : ''}`;\n    const response = await http.get<{ history: ImportHistoryItem[] }>(url);\n    return response.data.history;\n  } catch {\n    return [];\n  }\n}\n\n// ==================== Available Meetings (MCP Sync) ====================\n\nexport interface AvailableMeeting {\n  id: string;\n  user_id: string;\n  krisp_meeting_id: string;\n  meeting_name: string;\n  meeting_date: string;\n  meeting_url?: string;\n  is_recurring: boolean;\n  attendees: string[];\n  speakers: string[];\n  key_points: string[];\n  action_items: unknown[];\n  summary?: string;\n  is_imported: boolean;\n  imported_at?: string;\n  imported_transcript_id?: string;\n  first_seen_at: string;\n  last_synced_at: string;\n}\n\nexport interface AvailableMeetingsStats {\n  total_available: number;\n  total_imported: number;\n  total_pending: number;\n  oldest_meeting?: string;\n  newest_meeting?: string;\n  last_sync?: string;\n}\n\nexport interface AvailableMeetingsResponse {\n  meetings: AvailableMeeting[];\n  stats: AvailableMeetingsStats;\n}\n\nexport interface SyncMeetingsResponse {\n  success: boolean;\n  synced: number;\n  errors: number;\n}\n\nexport interface ImportAvailableResponse {\n  success: boolean;\n  imported: number;\n  errors: Array<{ meetingId: string; error: string }>;\n}\n\n/**\n * Get available meetings from catalog\n */\nexport async function getAvailableMeetings(options: {\n  limit?: number;\n  offset?: number;\n  showImported?: boolean;\n  startDate?: string;\n  endDate?: string;\n  search?: string;\n} = {}): Promise<AvailableMeetingsResponse | null> {\n  try {\n    const params = new URLSearchParams();\n    if (options.limit) params.set('limit', String(options.limit));\n    if (options.offset) params.set('offset', String(options.offset));\n    if (options.showImported === false) params.set('showImported', 'false');\n    if (options.startDate) params.set('startDate', options.startDate);\n    if (options.endDate) params.set('endDate', options.endDate);\n    if (options.search) params.set('search', options.search);\n    \n    const url = `/api/krisp/available${params.toString() ? '?' + params.toString() : ''}`;\n    const response = await http.get<AvailableMeetingsResponse>(url);\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Sync meetings from MCP (called by Cursor agent)\n */\nexport async function syncMeetingsFromMcp(meetings: McpMeeting[]): Promise<SyncMeetingsResponse | null> {\n  try {\n    const response = await http.post<SyncMeetingsResponse>('/api/krisp/available/sync', { meetings });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Import selected available meetings\n */\nexport async function importAvailableMeetings(meetingIds: string[], projectId?: string): Promise<ImportAvailableResponse | null> {\n  try {\n    const response = await http.post<ImportAvailableResponse>('/api/krisp/available/import', { \n      meetingIds,\n      projectId \n    });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get available meetings stats\n */\nexport async function getAvailableMeetingsStats(): Promise<AvailableMeetingsStats | null> {\n  try {\n    const response = await http.get<{ stats: AvailableMeetingsStats }>('/api/krisp/available/stats');\n    return response.data.stats;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * AI Summary result interface\n */\nexport interface MeetingSummary {\n  key_points: string[];\n  action_items: string[];\n  excerpt: string;\n  speakers?: string[];\n  attendees?: string[];\n  meeting_date?: string;\n  mentioned_people?: string[];\n}\n\nexport interface GenerateSummaryResponse {\n  success: boolean;\n  summary?: MeetingSummary;\n  error?: string;\n}\n\n/**\n * Generate AI summary for a specific available meeting\n */\nexport async function generateAvailableMeetingSummary(meetingId: string): Promise<GenerateSummaryResponse | null> {\n  try {\n    const response = await http.post<GenerateSummaryResponse>('/api/krisp/available/summary', { meetingId });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n// ==================== Helpers ====================\n\n/**\n * Format transcript status for display\n */\nexport function formatStatus(status: KrispTranscript['status']): { label: string; color: string } {\n  const statusMap: Record<string, { label: string; color: string }> = {\n    pending: { label: 'Pending', color: 'blue' },\n    quarantine: { label: 'Quarantine', color: 'yellow' },\n    ambiguous: { label: 'Ambiguous', color: 'orange' },\n    matched: { label: 'Matched', color: 'cyan' },\n    processed: { label: 'Processed', color: 'green' },\n    failed: { label: 'Failed', color: 'red' },\n    skipped: { label: 'Skipped', color: 'gray' }\n  };\n  \n  return statusMap[status] || { label: status, color: 'gray' };\n}\n\n/**\n * Format duration for display\n */\nexport function formatDuration(minutes?: number): string {\n  if (!minutes) return '-';\n  \n  const hours = Math.floor(minutes / 60);\n  const mins = minutes % 60;\n  \n  if (hours > 0) {\n    return `${hours}h ${mins}m`;\n  }\n  return `${mins}m`;\n}\n\n/**\n * Check if transcript needs action\n */\nexport function needsAction(transcript: KrispTranscript): boolean {\n  return ['quarantine', 'ambiguous', 'failed'].includes(transcript.status);\n}\n\n/**\n * Get action items count\n */\nexport function getActionItemsCount(transcript: KrispTranscript): number {\n  if (Array.isArray(transcript.action_items)) {\n    return transcript.action_items.length;\n  }\n  return 0;\n}\n","/**\n * DOM Utilities\n * Helper functions for DOM manipulation\n */\n\n/**\n * Query selector with type safety\n */\nexport function $(selector: string, parent: ParentNode = document): HTMLElement | null {\n  return parent.querySelector(selector);\n}\n\n/**\n * Query selector all with type safety\n */\nexport function $$(selector: string, parent: ParentNode = document): HTMLElement[] {\n  return Array.from(parent.querySelectorAll(selector));\n}\n\n/**\n * Get element by ID with type safety\n */\nexport function $id<T extends HTMLElement = HTMLElement>(id: string): T | null {\n  return document.getElementById(id) as T | null;\n}\n\n/**\n * Create element with attributes\n */\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\n  tag: K,\n  attributes?: Partial<HTMLElementTagNameMap[K]>,\n  children?: (Node | string)[]\n): HTMLElementTagNameMap[K] {\n  const el = document.createElement(tag);\n  \n  if (attributes) {\n    Object.entries(attributes).forEach(([key, value]) => {\n      if (key === 'className') {\n        el.className = value as string;\n      } else if (key === 'style' && typeof value === 'object') {\n        Object.assign(el.style, value);\n      } else if (key.startsWith('data')) {\n        el.setAttribute(key.replace(/([A-Z])/g, '-$1').toLowerCase(), String(value));\n      } else {\n        (el as Record<string, unknown>)[key] = value;\n      }\n    });\n  }\n  \n  if (children) {\n    children.forEach(child => {\n      if (typeof child === 'string') {\n        el.appendChild(document.createTextNode(child));\n      } else {\n        el.appendChild(child);\n      }\n    });\n  }\n  \n  return el;\n}\n\n/**\n * Add event listener with cleanup\n */\nexport function on<K extends keyof HTMLElementEventMap>(\n  element: HTMLElement | Window | Document,\n  event: K,\n  handler: (e: HTMLElementEventMap[K]) => void,\n  options?: AddEventListenerOptions\n): () => void {\n  element.addEventListener(event, handler as EventListener, options);\n  return () => element.removeEventListener(event, handler as EventListener, options);\n}\n\n/**\n * Toggle class on element\n */\nexport function toggleClass(element: HTMLElement, className: string, force?: boolean): boolean {\n  return element.classList.toggle(className, force);\n}\n\n/**\n * Add multiple classes\n */\nexport function addClass(element: HTMLElement, ...classes: string[]): void {\n  element.classList.add(...classes);\n}\n\n/**\n * Remove multiple classes\n */\nexport function removeClass(element: HTMLElement, ...classes: string[]): void {\n  element.classList.remove(...classes);\n}\n\n/**\n * Check if element has class\n */\nexport function hasClass(element: HTMLElement, className: string): boolean {\n  return element.classList.contains(className);\n}\n\n/**\n * Set multiple attributes\n */\nexport function setAttributes(element: HTMLElement, attrs: Record<string, string>): void {\n  Object.entries(attrs).forEach(([key, value]) => {\n    element.setAttribute(key, value);\n  });\n}\n\n/**\n * Remove element from DOM\n */\nexport function remove(element: HTMLElement): void {\n  element.remove();\n}\n\n/**\n * Empty element contents\n */\nexport function empty(element: HTMLElement): void {\n  element.innerHTML = '';\n}\n\n/**\n * Set inner HTML safely\n */\nexport function setHTML(element: HTMLElement, html: string): void {\n  element.innerHTML = html;\n}\n\n/**\n * Show element\n */\nexport function show(element: HTMLElement, display = 'block'): void {\n  element.style.display = display;\n}\n\n/**\n * Hide element\n */\nexport function hide(element: HTMLElement): void {\n  element.style.display = 'none';\n}\n\n/**\n * Toggle element visibility\n */\nexport function toggle(element: HTMLElement, visible?: boolean, display = 'block'): void {\n  if (visible === undefined) {\n    visible = element.style.display === 'none';\n  }\n  element.style.display = visible ? display : 'none';\n}\n\n/**\n * Scroll element into view\n */\nexport function scrollIntoView(element: HTMLElement, options?: ScrollIntoViewOptions): void {\n  element.scrollIntoView({\n    behavior: 'smooth',\n    block: 'center',\n    ...options,\n  });\n}\n\n/**\n * Focus element with optional scroll\n */\nexport function focus(element: HTMLElement, preventScroll = false): void {\n  element.focus({ preventScroll });\n}\n\n/**\n * Wait for element to appear in DOM\n */\nexport function waitForElement(selector: string, timeout = 5000): Promise<HTMLElement> {\n  return new Promise((resolve, reject) => {\n    const element = $(selector);\n    if (element) {\n      resolve(element);\n      return;\n    }\n\n    const observer = new MutationObserver(() => {\n      const element = $(selector);\n      if (element) {\n        observer.disconnect();\n        resolve(element);\n      }\n    });\n\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true,\n    });\n\n    setTimeout(() => {\n      observer.disconnect();\n      reject(new Error(`Element ${selector} not found within ${timeout}ms`));\n    }, timeout);\n  });\n}\n","/**\n * Theme Toggle Component\n * Button to cycle through theme modes (light/dark/system)\n */\n\nimport { theme } from '../services/theme';\nimport { toast } from '../services/toast';\nimport { createElement, on } from '../utils/dom';\n\n/**\n * Create theme toggle button element\n */\nexport function createThemeToggle(container?: HTMLElement): HTMLButtonElement {\n  const button = createElement('button', {\n    className: 'btn btn-ghost theme-toggle',\n    title: `Theme: ${theme.getLabel()} (Ctrl+Shift+T)`,\n  });\n\n  // Update button content\n  function updateButton(): void {\n    button.innerHTML = getThemeIcon();\n    button.title = `Theme: ${theme.getLabel()} (Ctrl+Shift+T)`;\n    button.setAttribute('data-theme-mode', theme.getMode());\n  }\n\n  // Get icon for current theme\n  function getThemeIcon(): string {\n    const mode = theme.getMode();\n    switch (mode) {\n      case 'light':\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <circle cx=\"12\" cy=\"12\" r=\"5\"/>\n          <path d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"/>\n        </svg>`;\n      case 'dark':\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"/>\n        </svg>`;\n      case 'system':\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/>\n          <line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\"/>\n          <line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\"/>\n        </svg>`;\n    }\n  }\n\n  // Handle click\n  on(button, 'click', () => {\n    theme.cycle();\n    updateButton();\n    toast.info(`Theme: ${theme.getLabel()}`);\n  });\n\n  // Subscribe to theme changes\n  theme.onChange(() => {\n    updateButton();\n  });\n\n  // Initial update\n  updateButton();\n\n  // Append to container if provided\n  if (container) {\n    container.appendChild(button);\n  }\n\n  return button;\n}\n\n/**\n * Mount theme toggle to existing element by selector\n */\nexport function mountThemeToggle(selector: string): HTMLButtonElement | null {\n  const container = document.querySelector(selector);\n  if (!container) {\n    console.warn(`ThemeToggle: Container not found: ${selector}`);\n    return null;\n  }\n  return createThemeToggle(container as HTMLElement);\n}\n\nexport default createThemeToggle;\n","/**\n * UI Store\n * User interface state\n */\n\n// Types\nexport type MainTab = 'dashboard' | 'chat' | 'sot' | 'timeline' | 'org' | 'files' | 'emails' | 'contacts' | 'team-analysis' | 'roles' | 'graph' | 'costs' | 'history' | 'admin';\nexport type SotView = 'questions' | 'facts' | 'risks' | 'actions' | 'decisions';\nexport type DevTab = 'info' | 'logs' | 'settings';\n\nexport interface SelectedPerson {\n  id: string;\n  name: string;\n  type: 'contact' | 'member';\n}\n\nexport interface UIState {\n  currentTab: MainTab;\n  currentDevTab: DevTab;\n  sotCurrentView: SotView;\n  selectedPerson: SelectedPerson | null;\n  sidebarOpen: boolean;\n  modalOpen: string | null;\n  searchQuery: string;\n  filterActive: boolean;\n}\n\n// Initial state\nconst initialState: UIState = {\n  currentTab: 'dashboard',\n  currentDevTab: 'info',\n  sotCurrentView: 'questions',\n  selectedPerson: null,\n  sidebarOpen: true,\n  modalOpen: null,\n  searchQuery: '',\n  filterActive: false,\n};\n\n// State\nlet state: UIState = { ...initialState };\n\n// Listeners\nconst listeners: Set<(state: UIState) => void> = new Set();\n\n/**\n * Notify all listeners\n */\nfunction notify(): void {\n  listeners.forEach(fn => fn(state));\n}\n\n/**\n * Get current state\n */\nexport function getState(): UIState {\n  return state;\n}\n\n/**\n * Subscribe to state changes\n */\nexport function subscribe(callback: (state: UIState) => void): () => void {\n  listeners.add(callback);\n  return () => listeners.delete(callback);\n}\n\n/**\n * Set main tab\n */\nexport function setTab(tab: MainTab): void {\n  state = { ...state, currentTab: tab };\n  notify();\n}\n\n/**\n * Set developer tab\n */\nexport function setDevTab(tab: DevTab): void {\n  state = { ...state, currentDevTab: tab };\n  notify();\n}\n\n/**\n * Set Source of Truth view\n */\nexport function setSotView(view: SotView): void {\n  state = { ...state, sotCurrentView: view };\n  notify();\n}\n\n/**\n * Set selected person\n */\nexport function setSelectedPerson(person: SelectedPerson | null): void {\n  state = { ...state, selectedPerson: person };\n  notify();\n}\n\n/**\n * Toggle sidebar\n */\nexport function toggleSidebar(): void {\n  state = { ...state, sidebarOpen: !state.sidebarOpen };\n  notify();\n}\n\n/**\n * Set sidebar open state\n */\nexport function setSidebarOpen(open: boolean): void {\n  state = { ...state, sidebarOpen: open };\n  notify();\n}\n\n/**\n * Open modal\n */\nexport function openModal(modalId: string): void {\n  state = { ...state, modalOpen: modalId };\n  notify();\n}\n\n/**\n * Close modal\n */\nexport function closeModal(): void {\n  state = { ...state, modalOpen: null };\n  notify();\n}\n\n/**\n * Set search query\n */\nexport function setSearchQuery(query: string): void {\n  state = { ...state, searchQuery: query };\n  notify();\n}\n\n/**\n * Toggle filter\n */\nexport function toggleFilter(): void {\n  state = { ...state, filterActive: !state.filterActive };\n  notify();\n}\n\n/**\n * Reset to initial state\n */\nexport function reset(): void {\n  state = { ...initialState };\n  notify();\n}\n\n// Export as namespace\nexport const uiStore = {\n  getState,\n  subscribe,\n  setTab,\n  setDevTab,\n  setSotView,\n  setSelectedPerson,\n  toggleSidebar,\n  setSidebarOpen,\n  openModal,\n  closeModal,\n  setSearchQuery,\n  toggleFilter,\n  reset,\n};\n","/**\n * Header Component\n * Main application header with project selector and user menu\n */\n\nimport { createElement, on, $, show, hide } from '../utils/dom';\nimport { appStore } from '../stores/app';\nimport { uiStore } from '../stores/ui';\nimport { theme } from '../services/theme';\nimport { createThemeToggle } from './ThemeToggle';\n\nexport interface HeaderProps {\n  onProjectChange?: (projectId: string) => void;\n  onLogout?: () => void;\n  onSettings?: () => void;\n}\n\n/**\n * Create header element\n */\nexport function createHeader(props: HeaderProps = {}): HTMLElement {\n  const header = createElement('header', { className: 'app-header' });\n\n  // Logo and title\n  const logoSection = createElement('div', { className: 'header-logo' });\n  logoSection.innerHTML = `\n    <span class=\"logo-icon\"></span>\n    <h1>GodMode</h1>\n  `;\n\n  // Actions section\n  const actionsSection = createElement('div', { className: 'header-actions' });\n\n  // Project selector\n  const projectSelector = createProjectSelector(props.onProjectChange);\n  actionsSection.appendChild(projectSelector);\n\n  // Theme toggle\n  const themeToggle = createThemeToggle();\n  actionsSection.appendChild(themeToggle);\n\n  // User menu\n  const userMenu = createUserMenu(props);\n  actionsSection.appendChild(userMenu);\n\n  // Mobile menu button\n  const mobileMenuBtn = createElement('button', {\n    className: 'mobile-menu-btn',\n    innerHTML: '',\n  });\n  on(mobileMenuBtn, 'click', () => {\n    uiStore.toggleSidebar();\n  });\n\n  header.appendChild(mobileMenuBtn);\n  header.appendChild(logoSection);\n  header.appendChild(actionsSection);\n\n  return header;\n}\n\n/**\n * Create project selector dropdown\n */\nfunction createProjectSelector(onProjectChange?: (projectId: string) => void): HTMLElement {\n  const container = createElement('div', { className: 'project-selector' });\n\n  const button = createElement('button', {\n    className: 'project-btn',\n  });\n\n  const dropdown = createElement('div', { className: 'project-dropdown' });\n\n  // Update button text\n  function updateButton(): void {\n    const state = appStore.getState();\n    const projectName = state.currentProjectId || 'Select Project';\n    button.innerHTML = `\n      <span class=\"project-name\">${projectName}</span>\n      <span class=\"dropdown-arrow\"></span>\n    `;\n  }\n\n  // Toggle dropdown\n  let isOpen = false;\n  on(button, 'click', (e) => {\n    e.stopPropagation();\n    isOpen = !isOpen;\n    dropdown.classList.toggle('show', isOpen);\n  });\n\n  // Close on outside click\n  on(document, 'click', () => {\n    isOpen = false;\n    dropdown.classList.remove('show');\n  });\n\n  // Subscribe to state changes\n  appStore.subscribe(() => {\n    updateButton();\n  });\n\n  // Initial update\n  updateButton();\n\n  container.appendChild(button);\n  container.appendChild(dropdown);\n\n  return container;\n}\n\n/**\n * Create user menu dropdown\n */\nfunction createUserMenu(props: HeaderProps): HTMLElement {\n  const container = createElement('div', { className: 'user-menu' });\n\n  const button = createElement('button', { className: 'user-menu-btn' });\n\n  const dropdown = createElement('div', { className: 'user-dropdown' });\n\n  // Update button\n  function updateButton(): void {\n    const state = appStore.getState();\n    const user = state.currentUser;\n    const initials = user?.name\n      ? user.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)\n      : user?.email?.[0]?.toUpperCase() || '?';\n\n    button.innerHTML = `\n      <div class=\"user-avatar\">${initials}</div>\n      <span class=\"user-name\">${user?.name || user?.email || 'Guest'}</span>\n    `;\n  }\n\n  // Update dropdown content\n  function updateDropdown(): void {\n    const state = appStore.getState();\n    const user = state.currentUser;\n\n    dropdown.innerHTML = `\n      <div class=\"user-dropdown-header\">\n        <strong>${user?.name || 'Guest'}</strong>\n        <span class=\"text-muted\">${user?.email || ''}</span>\n        ${user?.role ? `<span class=\"role-badge ${user.role}\">${user.role}</span>` : ''}\n      </div>\n      <div class=\"user-dropdown-items\">\n        <button data-action=\"settings\">\n          <span></span> Settings\n        </button>\n        <button data-action=\"shortcuts\">\n          <span></span> Shortcuts\n        </button>\n        <button data-action=\"logout\" class=\"text-error\">\n          <span></span> Logout\n        </button>\n      </div>\n    `;\n\n    // Bind action handlers\n    const settingsBtn = dropdown.querySelector('[data-action=\"settings\"]');\n    const shortcutsBtn = dropdown.querySelector('[data-action=\"shortcuts\"]');\n    const logoutBtn = dropdown.querySelector('[data-action=\"logout\"]');\n\n    if (settingsBtn) {\n      on(settingsBtn as HTMLElement, 'click', () => {\n        props.onSettings?.();\n        closeDropdown();\n      });\n    }\n\n    if (shortcutsBtn) {\n      on(shortcutsBtn as HTMLElement, 'click', () => {\n        // Show shortcuts modal\n        uiStore.openModal('shortcuts');\n        closeDropdown();\n      });\n    }\n\n    if (logoutBtn) {\n      on(logoutBtn as HTMLElement, 'click', () => {\n        props.onLogout?.();\n        closeDropdown();\n      });\n    }\n  }\n\n  // Toggle dropdown\n  let isOpen = false;\n  function closeDropdown(): void {\n    isOpen = false;\n    dropdown.classList.remove('show');\n  }\n\n  on(button, 'click', (e) => {\n    e.stopPropagation();\n    isOpen = !isOpen;\n    dropdown.classList.toggle('show', isOpen);\n    if (isOpen) {\n      updateDropdown();\n    }\n  });\n\n  // Close on outside click\n  on(document, 'click', closeDropdown);\n\n  // Subscribe to state changes\n  appStore.subscribe(updateButton);\n\n  // Initial update\n  updateButton();\n\n  container.appendChild(button);\n  container.appendChild(dropdown);\n\n  return container;\n}\n\n/**\n * Mount header to existing element\n */\nexport function mountHeader(selector: string, props: HeaderProps = {}): HTMLElement | null {\n  const container = document.querySelector(selector);\n  if (!container) {\n    console.warn(`Header: Container not found: ${selector}`);\n    return null;\n  }\n\n  const header = createHeader(props);\n  container.appendChild(header);\n  return header;\n}\n\nexport default createHeader;\n","/**\n * Sidebar Component\n * Navigation sidebar with tabs\n */\n\nimport { createElement, on, addClass, removeClass } from '../utils/dom';\nimport { uiStore, MainTab } from '../stores/ui';\nimport { appStore } from '../stores/app';\n\nexport interface SidebarTab {\n  id: MainTab;\n  label: string;\n  icon: string;\n  badge?: number;\n}\n\nexport interface SidebarProps {\n  tabs?: SidebarTab[];\n  onTabChange?: (tabId: MainTab) => void;\n}\n\nconst defaultTabs: SidebarTab[] = [\n  { id: 'dashboard', label: 'Dashboard', icon: '' },\n  { id: 'chat', label: 'Chat', icon: '' },\n  { id: 'sot', label: 'Source of Truth', icon: '' },\n  { id: 'timeline', label: 'Timeline', icon: '' },\n  { id: 'org', label: 'Org Chart', icon: '' },\n  { id: 'files', label: 'Files', icon: '' },\n  { id: 'emails', label: 'Emails', icon: '' },\n  { id: 'contacts', label: 'Contacts', icon: '' },\n  { id: 'roles', label: 'Roles', icon: '' },\n  { id: 'graph', label: 'Graph DB', icon: '' },\n  { id: 'costs', label: 'Costs', icon: '' },\n  { id: 'history', label: 'History', icon: '' },\n];\n\n// Admin tab - only shown for superadmin users\nconst adminTab: SidebarTab = { id: 'admin', label: 'Admin', icon: '' };\n\n/**\n * Get tabs based on user role\n */\nfunction getTabsForUser(): SidebarTab[] {\n  const state = appStore.getState();\n  const isSuperAdmin = state.currentUser?.role === 'superadmin';\n  \n  if (isSuperAdmin) {\n    return [...defaultTabs, adminTab];\n  }\n  return defaultTabs;\n}\n\n/**\n * Create a tab button element\n */\nfunction createTabButton(tab: SidebarTab, props: SidebarProps): HTMLButtonElement {\n  const button = createElement('button', {\n    className: 'sidebar-tab',\n  }) as HTMLButtonElement;\n  button.setAttribute('data-tab', tab.id);\n\n  button.innerHTML = `\n    <span class=\"tab-icon\">${tab.icon}</span>\n    <span class=\"tab-label\">${tab.label}</span>\n    ${tab.badge ? `<span class=\"tab-badge\">${tab.badge}</span>` : ''}\n  `;\n\n  on(button, 'click', () => {\n    uiStore.setTab(tab.id);\n    props.onTabChange?.(tab.id);\n\n    // Close sidebar on mobile after selection\n    if (window.innerWidth < 768) {\n      uiStore.setSidebarOpen(false);\n    }\n  });\n\n  return button;\n}\n\n/**\n * Rebuild navigation tabs based on current user\n */\nfunction rebuildNavigation(nav: HTMLElement, props: SidebarProps): void {\n  const tabs = props.tabs || getTabsForUser();\n  const currentTab = uiStore.getState().currentTab;\n  \n  // Clear existing tabs\n  nav.innerHTML = '';\n  \n  // Add tabs\n  tabs.forEach(tab => {\n    const button = createTabButton(tab, props);\n    if (tab.id === currentTab) {\n      addClass(button, 'active');\n    }\n    nav.appendChild(button);\n  });\n}\n\n/**\n * Create sidebar element\n */\nexport function createSidebar(props: SidebarProps = {}): HTMLElement {\n  const sidebar = createElement('aside', { className: 'sidebar' });\n\n  // Close button for mobile\n  const closeBtn = createElement('button', {\n    className: 'sidebar-close-btn',\n    innerHTML: '',\n  });\n  on(closeBtn, 'click', () => {\n    uiStore.setSidebarOpen(false);\n  });\n  sidebar.appendChild(closeBtn);\n\n  // Navigation\n  const nav = createElement('nav', { className: 'sidebar-nav' });\n  \n  // Initial build\n  rebuildNavigation(nav, props);\n\n  sidebar.appendChild(nav);\n  \n  // Subscribe to app store to rebuild when user changes (for admin tab visibility)\n  appStore.subscribe(() => {\n    rebuildNavigation(nav, props);\n  });\n\n  // Subscribe to UI state changes\n  uiStore.subscribe((state) => {\n    // Update active tab\n    const buttons = nav.querySelectorAll('.sidebar-tab');\n    buttons.forEach(btn => {\n      const tabId = btn.getAttribute('data-tab');\n      if (tabId === state.currentTab) {\n        addClass(btn as HTMLElement, 'active');\n      } else {\n        removeClass(btn as HTMLElement, 'active');\n      }\n    });\n\n    // Update sidebar visibility (mobile)\n    if (state.sidebarOpen) {\n      addClass(sidebar, 'mobile-open');\n    } else {\n      removeClass(sidebar, 'mobile-open');\n    }\n  });\n\n  // Set initial active state\n  const initialState = uiStore.getState();\n  const initialActiveBtn = nav.querySelector(`[data-tab=\"${initialState.currentTab}\"]`);\n  if (initialActiveBtn) {\n    addClass(initialActiveBtn as HTMLElement, 'active');\n  }\n\n  return sidebar;\n}\n\n/**\n * Update tab badge\n */\nexport function updateTabBadge(tabId: MainTab, count: number | null): void {\n  const tab = document.querySelector(`.sidebar-tab[data-tab=\"${tabId}\"]`);\n  if (!tab) return;\n\n  let badge = tab.querySelector('.tab-badge');\n\n  if (count === null || count === 0) {\n    badge?.remove();\n    return;\n  }\n\n  if (!badge) {\n    badge = createElement('span', { className: 'tab-badge' });\n    tab.appendChild(badge);\n  }\n\n  badge.textContent = count > 99 ? '99+' : String(count);\n}\n\n/**\n * Mount sidebar to existing element\n */\nexport function mountSidebar(selector: string, props: SidebarProps = {}): HTMLElement | null {\n  const container = document.querySelector(selector);\n  if (!container) {\n    console.warn(`Sidebar: Container not found: ${selector}`);\n    return null;\n  }\n\n  const sidebar = createSidebar(props);\n  container.appendChild(sidebar);\n  return sidebar;\n}\n\nexport default createSidebar;\n","/**\n * Toast Container Component\n * Visual container for toast notifications\n */\n\nimport { createElement, on } from '../utils/dom';\n\nexport type ToastPosition = 'top-right' | 'top-left' | 'bottom-right' | 'bottom-left' | 'top-center' | 'bottom-center';\n\nexport interface ToastContainerProps {\n  position?: ToastPosition;\n  maxToasts?: number;\n}\n\nlet containerInstance: HTMLElement | null = null;\n\n/**\n * Get or create toast container\n */\nexport function getToastContainer(props: ToastContainerProps = {}): HTMLElement {\n  if (containerInstance) {\n    return containerInstance;\n  }\n\n  const position = props.position || 'bottom-right';\n  const container = createElement('div', {\n    className: `toast-container toast-${position}`,\n  });\n\n  // Position styles\n  const positionStyles: Record<string, string> = {\n    'top-right': 'top: 20px; right: 20px;',\n    'top-left': 'top: 20px; left: 20px;',\n    'bottom-right': 'bottom: 20px; right: 20px;',\n    'bottom-left': 'bottom: 20px; left: 20px;',\n    'top-center': 'top: 20px; left: 50%; transform: translateX(-50%);',\n    'bottom-center': 'bottom: 20px; left: 50%; transform: translateX(-50%);',\n  };\n\n  container.style.cssText = `\n    position: fixed;\n    ${positionStyles[position]}\n    z-index: 10000;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    max-width: 400px;\n    pointer-events: none;\n  `;\n\n  document.body.appendChild(container);\n  containerInstance = container;\n\n  return container;\n}\n\n/**\n * Create a toast element\n */\nexport function createToastElement(\n  message: string,\n  type: 'success' | 'error' | 'warning' | 'info' = 'info',\n  duration = 3000\n): HTMLElement {\n  const toast = createElement('div', {\n    className: `toast toast-${type} fade-in`,\n  });\n\n  const icons: Record<string, string> = {\n    success: '',\n    error: '',\n    warning: '',\n    info: '',\n  };\n\n  const colors: Record<string, string> = {\n    success: 'var(--success)',\n    error: 'var(--error)',\n    warning: 'var(--warning)',\n    info: 'var(--accent)',\n  };\n\n  toast.style.cssText = `\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    padding: 12px 16px;\n    background: ${colors[type]};\n    color: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    font-size: 14px;\n    pointer-events: auto;\n    cursor: pointer;\n    animation: slideInRight 0.3s ease;\n  `;\n\n  toast.innerHTML = `\n    <span class=\"toast-icon\">${icons[type]}</span>\n    <span class=\"toast-message\">${message}</span>\n  `;\n\n  // Click to dismiss\n  on(toast, 'click', () => {\n    dismissToast(toast);\n  });\n\n  // Auto dismiss\n  if (duration > 0) {\n    setTimeout(() => {\n      dismissToast(toast);\n    }, duration);\n  }\n\n  return toast;\n}\n\n/**\n * Dismiss a toast with animation\n */\nfunction dismissToast(toast: HTMLElement): void {\n  toast.style.opacity = '0';\n  toast.style.transform = 'translateX(100%)';\n  toast.style.transition = 'all 0.3s ease';\n\n  setTimeout(() => {\n    toast.remove();\n  }, 300);\n}\n\n/**\n * Show a toast notification\n */\nexport function showToastInContainer(\n  message: string,\n  type: 'success' | 'error' | 'warning' | 'info' = 'info',\n  duration = 3000\n): HTMLElement {\n  const container = getToastContainer();\n  const toast = createToastElement(message, type, duration);\n  container.appendChild(toast);\n  return toast;\n}\n\nexport default getToastContainer;\n","/**\n * Modal Component\n * Reusable modal dialog\n */\n\nimport { createElement, on, addClass, removeClass, show, hide } from '../utils/dom';\nimport { uiStore } from '../stores/ui';\nimport { shortcuts } from '../services/shortcuts';\n\nexport interface ModalProps {\n  id: string;\n  title: string;\n  content?: string | HTMLElement;\n  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';\n  closable?: boolean;\n  onClose?: () => void;\n  onOpen?: () => void;\n  footer?: HTMLElement | null;\n}\n\n// Store active modals\nconst activeModals: Map<string, HTMLElement> = new Map();\n\n/**\n * Create modal element\n */\nexport function createModal(props: ModalProps): HTMLElement {\n  const {\n    id,\n    title,\n    content,\n    size = 'md',\n    closable = true,\n    onClose,\n    onOpen,\n    footer,\n  } = props;\n\n  // Backdrop\n  const modal = createElement('div', {\n    className: `modal modal-${size}`,\n  });\n  modal.setAttribute('data-modal-id', id);\n\n  // Content wrapper\n  const modalContent = createElement('div', { className: 'modal-content' });\n\n  // Header\n  const header = createElement('div', { className: 'modal-header' });\n  header.innerHTML = `<h3>${title}</h3>`;\n\n  if (closable) {\n    const closeBtn = createElement('button', {\n      className: 'modal-close',\n      innerHTML: '',\n    });\n    on(closeBtn, 'click', () => closeModal(id));\n    header.appendChild(closeBtn);\n  }\n\n  // Body\n  const body = createElement('div', { className: 'modal-body' });\n  if (typeof content === 'string') {\n    body.innerHTML = content;\n  } else if (content) {\n    body.appendChild(content);\n  }\n\n  // Footer\n  const footerEl = footer || createElement('div', { className: 'modal-footer' });\n\n  // Assemble\n  modalContent.appendChild(header);\n  modalContent.appendChild(body);\n  if (footer !== null) {\n    modalContent.appendChild(footerEl);\n  }\n  modal.appendChild(modalContent);\n\n  // Click backdrop to close\n  if (closable) {\n    on(modal, 'click', (e) => {\n      if (e.target === modal) {\n        closeModal(id);\n      }\n    });\n  }\n\n  // Store reference\n  activeModals.set(id, modal);\n\n  return modal;\n}\n\n/**\n * Open a modal by ID\n */\nexport function openModal(id: string): void {\n  const modal = activeModals.get(id) || document.querySelector(`[data-modal-id=\"${id}\"]`) as HTMLElement;\n  if (!modal) {\n    console.warn(`Modal not found: ${id}`);\n    return;\n  }\n\n  modal.style.display = 'flex';\n  addClass(modal, 'open');\n  document.body.style.overflow = 'hidden';\n\n  // Update UI store\n  uiStore.openModal(id);\n\n  // Focus first input\n  setTimeout(() => {\n    const firstInput = modal.querySelector('input, textarea, select, button') as HTMLElement;\n    firstInput?.focus();\n  }, 100);\n}\n\n/**\n * Close a modal by ID\n */\nexport function closeModal(id: string): void {\n  const modal = activeModals.get(id) || document.querySelector(`[data-modal-id=\"${id}\"]`) as HTMLElement;\n  if (!modal) return;\n\n  removeClass(modal, 'open');\n  modal.style.display = 'none';\n  document.body.style.overflow = '';\n\n  // Update UI store\n  uiStore.closeModal();\n}\n\n/**\n * Close all open modals\n */\nexport function closeAllModals(): void {\n  activeModals.forEach((_, id) => closeModal(id));\n}\n\n/**\n * Check if modal is open\n */\nexport function isModalOpen(id: string): boolean {\n  const modal = activeModals.get(id);\n  return modal?.classList.contains('open') || false;\n}\n\n/**\n * Update modal content\n */\nexport function updateModalContent(id: string, content: string | HTMLElement): void {\n  const modal = activeModals.get(id);\n  if (!modal) return;\n\n  const body = modal.querySelector('.modal-body');\n  if (!body) return;\n\n  if (typeof content === 'string') {\n    body.innerHTML = content;\n  } else {\n    body.innerHTML = '';\n    body.appendChild(content);\n  }\n}\n\n/**\n * Update modal title\n */\nexport function updateModalTitle(id: string, title: string): void {\n  const modal = activeModals.get(id);\n  if (!modal) return;\n\n  const titleEl = modal.querySelector('.modal-header h3');\n  if (titleEl) {\n    titleEl.textContent = title;\n  }\n}\n\n/**\n * Create and show a confirm dialog\n */\nexport function confirm(\n  message: string,\n  options: {\n    title?: string;\n    confirmText?: string;\n    cancelText?: string;\n    confirmClass?: string;\n  } = {}\n): Promise<boolean> {\n  return new Promise((resolve) => {\n    const {\n      title = 'Confirm',\n      confirmText = 'Confirm',\n      cancelText = 'Cancel',\n      confirmClass = 'btn-primary',\n    } = options;\n\n    const id = `confirm-${Date.now()}`;\n\n    const footer = createElement('div', { className: 'modal-footer' });\n\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: cancelText,\n    });\n\n    const confirmBtn = createElement('button', {\n      className: `btn ${confirmClass}`,\n      textContent: confirmText,\n    });\n\n    on(cancelBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(false);\n    });\n\n    on(confirmBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(true);\n    });\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(confirmBtn);\n\n    const modal = createModal({\n      id,\n      title,\n      content: `<p>${message}</p>`,\n      size: 'sm',\n      closable: true,\n      onClose: () => resolve(false),\n      footer,\n    });\n\n    document.body.appendChild(modal);\n    openModal(id);\n  });\n}\n\n/**\n * Create and show an alert dialog\n */\nexport function alert(message: string, title = 'Alert'): Promise<void> {\n  return new Promise((resolve) => {\n    const id = `alert-${Date.now()}`;\n\n    const footer = createElement('div', { className: 'modal-footer' });\n\n    const okBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'OK',\n    });\n\n    on(okBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve();\n    });\n\n    footer.appendChild(okBtn);\n\n    const modal = createModal({\n      id,\n      title,\n      content: `<p>${message}</p>`,\n      size: 'sm',\n      closable: true,\n      onClose: () => resolve(),\n      footer,\n    });\n\n    document.body.appendChild(modal);\n    openModal(id);\n  });\n}\n\n/**\n * Create and show a prompt dialog\n */\nexport function prompt(\n  message: string,\n  options: {\n    title?: string;\n    placeholder?: string;\n    defaultValue?: string;\n  } = {}\n): Promise<string | null> {\n  return new Promise((resolve) => {\n    const id = `prompt-${Date.now()}`;\n    const { title = 'Input', placeholder = '', defaultValue = '' } = options;\n\n    const content = createElement('div', { className: 'prompt-content' });\n    content.innerHTML = `\n      <p>${message}</p>\n      <input type=\"text\" class=\"prompt-input\" placeholder=\"${placeholder}\" value=\"${defaultValue}\" style=\"width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; margin-top: 8px;\">\n    `;\n\n    const footer = createElement('div', { className: 'modal-footer' });\n\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const okBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'OK',\n    });\n\n    on(cancelBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(null);\n    });\n\n    on(okBtn, 'click', () => {\n      const input = modal.querySelector('.prompt-input') as HTMLInputElement;\n      const value = input?.value || '';\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(value);\n    });\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(okBtn);\n\n    const modal = createModal({\n      id,\n      title,\n      content,\n      size: 'sm',\n      closable: true,\n      onClose: () => resolve(null),\n      footer,\n    });\n\n    document.body.appendChild(modal);\n    openModal(id);\n\n    // Focus input after modal opens\n    setTimeout(() => {\n      const input = modal.querySelector('.prompt-input') as HTMLInputElement;\n      input?.focus();\n    }, 100);\n  });\n}\n\n// Register Escape key to close modals\nshortcuts.register({\n  key: 'Escape',\n  description: 'Close modal',\n  handler: () => {\n    const state = uiStore.getState();\n    if (state.modalOpen) {\n      closeModal(state.modalOpen);\n    }\n  },\n});\n\nexport default createModal;\n","/**\n * Member Permissions Modal - SOTA Design\n * Edit granular permissions for a project member\n */\n\nimport { on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'member-permissions-modal';\n\ninterface MemberPermissionsProps {\n  projectId: string;\n  userId: string;\n  userName: string;\n  userEmail: string;\n  avatarUrl?: string;\n  currentRole: string;\n  currentPermissions?: string[];\n  onSave?: () => void;\n}\n\n// Permission definitions organized by category\nconst PERMISSION_CATEGORIES = [\n  {\n    id: 'view',\n    name: 'View',\n    icon: '',\n    color: '#3b82f6',\n    permissions: [\n      { id: 'view:dashboard', name: 'Dashboard', desc: 'View project dashboard and stats' },\n      { id: 'view:chat', name: 'AI Chat', desc: 'Use the AI assistant' },\n      { id: 'view:sot', name: 'Source of Truth', desc: 'View decisions, risks, actions, questions' },\n      { id: 'view:contacts', name: 'Contacts', desc: 'View project contacts' },\n      { id: 'view:documents', name: 'Documents', desc: 'View uploaded documents' },\n      { id: 'view:emails', name: 'Emails', desc: 'View email history' },\n      { id: 'view:team', name: 'Team', desc: 'View team members' },\n    ],\n  },\n  {\n    id: 'comment',\n    name: 'Comment',\n    icon: '',\n    color: '#8b5cf6',\n    permissions: [\n      { id: 'comment:sot', name: 'Comment on Items', desc: 'Add comments to decisions, risks, etc.' },\n      { id: 'comment:documents', name: 'Comment on Docs', desc: 'Add comments to documents' },\n    ],\n  },\n  {\n    id: 'edit',\n    name: 'Edit',\n    icon: '',\n    color: '#10b981',\n    permissions: [\n      { id: 'edit:questions', name: 'Questions', desc: 'Create and edit questions' },\n      { id: 'edit:risks', name: 'Risks', desc: 'Create and edit risks' },\n      { id: 'edit:actions', name: 'Actions', desc: 'Create and edit actions' },\n      { id: 'edit:decisions', name: 'Decisions', desc: 'Create and edit decisions' },\n      { id: 'edit:contacts', name: 'Contacts', desc: 'Create and edit contacts' },\n      { id: 'edit:documents', name: 'Documents', desc: 'Upload and edit documents' },\n    ],\n  },\n  {\n    id: 'manage',\n    name: 'Manage',\n    icon: '',\n    color: '#f59e0b',\n    permissions: [\n      { id: 'manage:team', name: 'Team', desc: 'Invite and remove team members' },\n      { id: 'manage:roles', name: 'Roles', desc: 'Create and assign roles' },\n      { id: 'manage:settings', name: 'Settings', desc: 'Change project settings' },\n      { id: 'manage:integrations', name: 'Integrations', desc: 'Configure integrations' },\n    ],\n  },\n  {\n    id: 'delete',\n    name: 'Delete',\n    icon: '',\n    color: '#ef4444',\n    permissions: [\n      { id: 'delete:data', name: 'Delete Data', desc: 'Permanently delete items' },\n      { id: 'export:data', name: 'Export Data', desc: 'Export project data' },\n    ],\n  },\n];\n\n// Default permission sets for each role\nconst ROLE_DEFAULTS: Record<string, string[]> = {\n  viewer: [\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\n  ],\n  editor: [\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\n    'comment:sot', 'comment:documents',\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\n  ],\n  admin: [\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\n    'comment:sot', 'comment:documents',\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\n    'manage:team', 'manage:roles', 'manage:settings', 'manage:integrations',\n    'delete:data', 'export:data',\n  ],\n  owner: [\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\n    'comment:sot', 'comment:documents',\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\n    'manage:team', 'manage:roles', 'manage:settings', 'manage:integrations',\n    'delete:data', 'export:data',\n  ],\n};\n\n/**\n * Show member permissions modal\n */\nexport function showMemberPermissionsModal(props: MemberPermissionsProps): void {\n  const { projectId, userId, userName, userEmail, avatarUrl, currentRole, onSave } = props;\n  \n  // Use current permissions or defaults for role\n  let selectedPermissions = new Set(props.currentPermissions || ROLE_DEFAULTS[currentRole] || []);\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = document.createElement('div');\n  content.className = 'member-permissions-content';\n  \n  content.innerHTML = `\n    <style>\n      .member-permissions-content {\n        padding: 0;\n      }\n      \n      .member-header {\n        display: flex;\n        align-items: center;\n        gap: 16px;\n        padding: 20px 24px;\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.03) 100%);\n        border-bottom: 1px solid var(--border-color);\n      }\n      \n      .member-avatar {\n        width: 56px;\n        height: 56px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-weight: 700;\n        font-size: 20px;\n        overflow: hidden;\n      }\n      \n      .member-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .member-info h4 {\n        margin: 0 0 4px;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n      \n      .member-info p {\n        margin: 0;\n        font-size: 13px;\n        color: var(--text-secondary);\n      }\n      \n      .role-selector {\n        margin-left: auto;\n        display: flex;\n        flex-direction: column;\n        align-items: flex-end;\n        gap: 4px;\n      }\n      \n      .role-selector label {\n        font-size: 11px;\n        color: var(--text-muted);\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n      \n      .role-selector select {\n        padding: 8px 32px 8px 12px;\n        border: 1px solid var(--border-color);\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 500;\n        background: var(--bg-primary);\n        color: var(--text-primary);\n        cursor: pointer;\n      }\n      \n      .permissions-body {\n        padding: 24px;\n        max-height: 400px;\n        overflow-y: auto;\n      }\n      \n      .permission-category {\n        margin-bottom: 20px;\n      }\n      \n      .permission-category:last-child {\n        margin-bottom: 0;\n      }\n      \n      .category-header {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        margin-bottom: 12px;\n        padding-bottom: 8px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      \n      .category-icon {\n        font-size: 16px;\n      }\n      \n      .category-name {\n        font-weight: 600;\n        color: var(--text-primary);\n        flex: 1;\n      }\n      \n      .category-toggle {\n        font-size: 11px;\n        padding: 4px 10px;\n        border: 1px solid var(--border-color);\n        border-radius: 6px;\n        background: transparent;\n        cursor: pointer;\n        color: var(--text-secondary);\n        transition: all 0.15s;\n      }\n      \n      .category-toggle:hover {\n        background: var(--bg-secondary);\n        border-color: #e11d48;\n        color: #e11d48;\n      }\n      \n      .permission-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\n        gap: 8px;\n      }\n      \n      .permission-item {\n        display: flex;\n        align-items: flex-start;\n        gap: 10px;\n        padding: 10px 12px;\n        background: var(--bg-secondary);\n        border-radius: 10px;\n        cursor: pointer;\n        transition: all 0.15s;\n        border: 1px solid transparent;\n      }\n      \n      .permission-item:hover {\n        background: var(--bg-tertiary);\n      }\n      \n      .permission-item.selected {\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\n        border-color: rgba(225,29,72,0.3);\n      }\n      \n      .permission-item input {\n        margin-top: 2px;\n        accent-color: #e11d48;\n        width: 16px;\n        height: 16px;\n      }\n      \n      .permission-info {\n        flex: 1;\n        min-width: 0;\n      }\n      \n      .permission-name {\n        font-size: 13px;\n        font-weight: 500;\n        color: var(--text-primary);\n      }\n      \n      .permission-desc {\n        font-size: 11px;\n        color: var(--text-muted);\n        margin-top: 2px;\n      }\n      \n      .modal-actions {\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n        padding: 16px 24px;\n        border-top: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      \n      .btn {\n        padding: 10px 20px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n      }\n      \n      .btn-secondary {\n        background: var(--bg-primary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      \n      .btn-secondary:hover {\n        background: var(--bg-tertiary);\n      }\n      \n      .btn-primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\n      }\n      \n      .btn-primary:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\n      }\n    </style>\n    \n    <div class=\"member-header\">\n      <div class=\"member-avatar\">\n        ${avatarUrl \n          ? `<img src=\"${avatarUrl}\" alt=\"\">` \n          : getInitials(userName || userEmail)}\n      </div>\n      <div class=\"member-info\">\n        <h4>${escapeHtml(userName || userEmail)}</h4>\n        <p>${escapeHtml(userEmail)}</p>\n      </div>\n      <div class=\"role-selector\">\n        <label>Base Role</label>\n        <select id=\"base-role\">\n          <option value=\"viewer\" ${currentRole === 'viewer' ? 'selected' : ''}>Viewer</option>\n          <option value=\"editor\" ${currentRole === 'editor' ? 'selected' : ''}>Editor</option>\n          <option value=\"admin\" ${currentRole === 'admin' ? 'selected' : ''}>Admin</option>\n          <option value=\"owner\" ${currentRole === 'owner' ? 'selected' : ''}>Owner</option>\n        </select>\n      </div>\n    </div>\n    \n    <div class=\"permissions-body\">\n      ${PERMISSION_CATEGORIES.map(cat => `\n        <div class=\"permission-category\" data-category=\"${cat.id}\">\n          <div class=\"category-header\">\n            <span class=\"category-icon\">${cat.icon}</span>\n            <span class=\"category-name\">${cat.name}</span>\n            <button type=\"button\" class=\"category-toggle\" data-action=\"toggle\">Toggle All</button>\n          </div>\n          <div class=\"permission-grid\">\n            ${cat.permissions.map(p => `\n              <label class=\"permission-item${selectedPermissions.has(p.id) ? ' selected' : ''}\">\n                <input type=\"checkbox\" name=\"permission\" value=\"${p.id}\" ${selectedPermissions.has(p.id) ? 'checked' : ''}>\n                <div class=\"permission-info\">\n                  <div class=\"permission-name\">${p.name}</div>\n                  <div class=\"permission-desc\">${p.desc}</div>\n                </div>\n              </label>\n            `).join('')}\n          </div>\n        </div>\n      `).join('')}\n    </div>\n    \n    <div class=\"modal-actions\">\n      <button type=\"button\" class=\"btn btn-secondary\" id=\"btn-cancel\">Cancel</button>\n      <button type=\"button\" class=\"btn btn-primary\" id=\"btn-save\">Save Permissions</button>\n    </div>\n  `;\n\n  // Bind events\n  setTimeout(() => {\n    // Base role change - apply defaults\n    const roleSelect = content.querySelector('#base-role') as HTMLSelectElement;\n    if (roleSelect) {\n      on(roleSelect, 'change', () => {\n        const role = roleSelect.value;\n        const defaults = ROLE_DEFAULTS[role] || [];\n        selectedPermissions = new Set(defaults);\n        updateCheckboxes(content, selectedPermissions);\n      });\n    }\n\n    // Permission checkbox changes\n    content.querySelectorAll('input[name=\"permission\"]').forEach(checkbox => {\n      on(checkbox as HTMLElement, 'change', () => {\n        const value = (checkbox as HTMLInputElement).value;\n        const checked = (checkbox as HTMLInputElement).checked;\n        \n        if (checked) {\n          selectedPermissions.add(value);\n        } else {\n          selectedPermissions.delete(value);\n        }\n        \n        updateItemStyles(content);\n      });\n    });\n\n    // Category toggle buttons\n    content.querySelectorAll('.category-toggle').forEach(btn => {\n      on(btn as HTMLElement, 'click', () => {\n        const category = btn.closest('.permission-category');\n        if (!category) return;\n        \n        const checkboxes = category.querySelectorAll('input[name=\"permission\"]');\n        const allChecked = Array.from(checkboxes).every(cb => (cb as HTMLInputElement).checked);\n        \n        checkboxes.forEach(cb => {\n          const input = cb as HTMLInputElement;\n          input.checked = !allChecked;\n          if (!allChecked) {\n            selectedPermissions.add(input.value);\n          } else {\n            selectedPermissions.delete(input.value);\n          }\n        });\n        \n        updateItemStyles(content);\n      });\n    });\n\n    // Cancel button\n    const cancelBtn = content.querySelector('#btn-cancel');\n    if (cancelBtn) {\n      on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\n    }\n\n    // Save button\n    const saveBtn = content.querySelector('#btn-save');\n    if (saveBtn) {\n      on(saveBtn as HTMLElement, 'click', async () => {\n        const role = roleSelect?.value || currentRole;\n        const permissions = Array.from(selectedPermissions);\n        \n        (saveBtn as HTMLButtonElement).disabled = true;\n        saveBtn.textContent = 'Saving...';\n        \n        try {\n          await http.put(`/api/projects/${projectId}/members/${userId}/permissions`, {\n            role,\n            permissions,\n          });\n          \n          toast.success('Permissions updated');\n          closeModal(MODAL_ID);\n          onSave?.();\n        } catch (error) {\n          toast.error('Failed to update permissions');\n          (saveBtn as HTMLButtonElement).disabled = false;\n          saveBtn.textContent = 'Save Permissions';\n        }\n      });\n    }\n  }, 0);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Member Permissions',\n    content,\n    size: 'lg',\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Update checkboxes from selected set\n */\nfunction updateCheckboxes(container: HTMLElement, selected: Set<string>): void {\n  container.querySelectorAll('input[name=\"permission\"]').forEach(cb => {\n    const input = cb as HTMLInputElement;\n    input.checked = selected.has(input.value);\n  });\n  updateItemStyles(container);\n}\n\n/**\n * Update item styles based on selection\n */\nfunction updateItemStyles(container: HTMLElement): void {\n  container.querySelectorAll('.permission-item').forEach(item => {\n    const checkbox = item.querySelector('input[name=\"permission\"]') as HTMLInputElement;\n    item.classList.toggle('selected', checkbox?.checked || false);\n  });\n}\n\n/**\n * Get initials\n */\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showMemberPermissionsModal;\n","/**\n * Project Modal - SOTA Design\n * Create and edit projects with modern glassmorphism design\n * Includes: General settings, Members, Roles, and Configuration tabs\n */\n\nimport { createModal, openModal, closeModal, confirm } from '../Modal';\nimport { createElement, on } from '../../utils/dom';\nimport { appStore } from '../../stores/app';\nimport { dataStore } from '../../stores/data';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { showMemberPermissionsModal } from './MemberPermissionsModal';\n\nconst MODAL_ID = 'project-modal';\n\n// ==================== Types ====================\n\nexport interface ProjectData {\n  id?: string;\n  name: string;\n  description?: string;\n  owner_id?: string;\n  settings?: ProjectSettings;\n  created_at?: string;\n  updated_at?: string;\n}\n\ninterface ProjectSettings {\n  userRole?: string;\n  userRolePrompt?: string;\n}\n\ninterface ProjectMember {\n  user_id: string;\n  email?: string;\n  display_name?: string;\n  avatar_url?: string;\n  role: 'owner' | 'admin' | 'write' | 'read';\n  user_role?: string;\n  user_role_prompt?: string;\n  linked_contact_id?: string;\n  linked_contact?: {\n    id: string;\n    name: string;\n    email?: string;\n    organization?: string;\n    role?: string;\n  };\n  joined_at: string;\n}\n\ninterface Contact {\n  id: string;\n  name: string;\n  email?: string;\n  organization?: string;\n  role?: string;\n}\n\ninterface RoleTemplate {\n  id: string;\n  name: string;\n  display_name: string;\n  description?: string;\n  icon?: string;\n  prompt_template?: string;\n  focus_areas?: string[];\n  category?: string;\n  is_builtin: boolean;\n  is_active: boolean;\n}\n\ninterface ProjectConfig {\n  id?: string;\n  project_id: string;\n  llm_config?: Record<string, unknown>;\n  ollama_config?: Record<string, unknown>;\n  prompts?: Record<string, string>;\n  processing_settings?: Record<string, unknown>;\n  ui_preferences?: Record<string, unknown>;\n}\n\nexport interface ProjectModalProps {\n  mode: 'create' | 'edit';\n  project?: ProjectData;\n  onSave?: (project: ProjectData) => void;\n  onDelete?: (projectId: string) => void;\n}\n\n// ==================== State ====================\n\nlet currentProps: ProjectModalProps = { mode: 'create' };\nlet currentProject: ProjectData | null = null;\nlet projectMembers: ProjectMember[] = [];\nlet projectRoles: RoleTemplate[] = [];\nlet projectConfig: ProjectConfig | null = null;\nlet projectContacts: Contact[] = [];\n\n// ==================== Main Functions ====================\n\n/**\n * Show project modal\n */\nexport function showProjectModal(props: ProjectModalProps): void {\n  currentProps = props;\n  currentProject = props.project || null;\n\n  const content = createModalContent(props.mode);\n  \n  const modal = createModal({\n    id: MODAL_ID,\n    title: '',\n    size: 'lg',\n    content: content,\n  });\n\n  // Remove default modal styling for custom design\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\n  if (modalContent) {\n    modalContent.style.cssText = 'background: transparent; box-shadow: none; padding: 0; max-width: 800px;';\n  }\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\n  if (modalHeader) {\n    modalHeader.style.display = 'none';\n  }\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n  \n  if (props.mode === 'edit' && props.project?.id) {\n    loadProjectData(content, props.project.id);\n  } else {\n    renderCreateForm(content);\n  }\n}\n\n/**\n * Create modal content with SOTA styling\n */\nfunction createModalContent(mode: 'create' | 'edit'): HTMLElement {\n  const container = createElement('div', { className: 'project-modal-sota' });\n\n  container.innerHTML = `\n    <style>\n      .project-modal-sota {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n      \n      .project-card {\n        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\n        backdrop-filter: blur(20px);\n        border-radius: 24px;\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\n          0 0 0 1px rgba(255, 255, 255, 0.8),\n          inset 0 1px 0 rgba(255, 255, 255, 0.9);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .project-card {\n        background: linear-gradient(135deg, rgba(30,41,59,0.95) 0%, rgba(15,23,42,0.95) 100%);\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.05);\n      }\n      \n      .project-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 32px;\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .project-header::before {\n        content: '';\n        position: absolute;\n        top: -50%;\n        right: -50%;\n        width: 100%;\n        height: 200%;\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\n        pointer-events: none;\n      }\n      \n      .project-header-content {\n        display: flex;\n        align-items: center;\n        gap: 20px;\n        position: relative;\n        z-index: 1;\n      }\n      \n      .project-icon-large {\n        width: 72px;\n        height: 72px;\n        border-radius: 18px;\n        background: rgba(255,255,255,0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border: 3px solid rgba(255,255,255,0.3);\n        flex-shrink: 0;\n      }\n      \n      .project-icon-large svg {\n        width: 36px;\n        height: 36px;\n        color: white;\n      }\n      \n      .project-title-info h2 {\n        margin: 0 0 4px 0;\n        font-size: 24px;\n        font-weight: 700;\n        color: white;\n      }\n      \n      .project-title-info p {\n        margin: 0;\n        color: rgba(255,255,255,0.8);\n        font-size: 14px;\n      }\n      \n      .project-close-btn {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n        z-index: 10;\n      }\n      \n      .project-close-btn:hover {\n        background: rgba(255,255,255,0.3);\n        transform: rotate(90deg);\n      }\n      \n      .project-close-btn svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n      \n      .project-tabs-nav {\n        display: flex;\n        gap: 0;\n        padding: 0 24px;\n        background: rgba(0,0,0,0.02);\n        border-bottom: 1px solid rgba(0,0,0,0.06);\n        overflow-x: auto;\n      }\n      \n      [data-theme=\"dark\"] .project-tabs-nav {\n        background: rgba(255,255,255,0.02);\n        border-bottom-color: rgba(255,255,255,0.06);\n      }\n      \n      .project-tab-btn {\n        padding: 16px 20px;\n        background: transparent;\n        border: none;\n        font-size: 14px;\n        font-weight: 500;\n        color: #64748b;\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n        white-space: nowrap;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .project-tab-btn:hover {\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .project-tab-btn:hover {\n        color: #e2e8f0;\n      }\n      \n      .project-tab-btn.active {\n        color: #e11d48;\n      }\n      \n      .project-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 20px;\n        right: 20px;\n        height: 2px;\n        background: #e11d48;\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .project-tab-icon {\n        width: 18px;\n        height: 18px;\n      }\n      \n      .project-body {\n        padding: 32px;\n        max-height: 60vh;\n        overflow-y: auto;\n      }\n      \n      .project-section {\n        display: none;\n      }\n      \n      .project-section.active {\n        display: block;\n      }\n      \n      .form-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 20px;\n      }\n      \n      .form-grid .full-width {\n        grid-column: 1 / -1;\n      }\n      \n      .form-field {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n      }\n      \n      .form-field label {\n        font-size: 13px;\n        font-weight: 600;\n        color: #475569;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n      \n      [data-theme=\"dark\"] .form-field label {\n        color: #94a3b8;\n      }\n      \n      .form-field input,\n      .form-field select,\n      .form-field textarea {\n        padding: 12px 16px;\n        border: 1px solid #e2e8f0;\n        border-radius: 12px;\n        font-size: 14px;\n        background: #f8fafc;\n        color: #1e293b;\n        transition: all 0.2s;\n        outline: none;\n      }\n      \n      [data-theme=\"dark\"] .form-field input,\n      [data-theme=\"dark\"] .form-field select,\n      [data-theme=\"dark\"] .form-field textarea {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .form-field input:focus,\n      .form-field select:focus,\n      .form-field textarea:focus {\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .form-field input:disabled {\n        background: #f1f5f9;\n        color: #94a3b8;\n        cursor: not-allowed;\n      }\n      \n      .form-field textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .form-hint {\n        font-size: 12px;\n        color: #94a3b8;\n      }\n      \n      .form-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        margin-top: 24px;\n        padding-top: 24px;\n        border-top: 1px solid rgba(0,0,0,0.06);\n      }\n      \n      [data-theme=\"dark\"] .form-actions {\n        border-top-color: rgba(255,255,255,0.06);\n      }\n      \n      .btn-sota {\n        padding: 12px 24px;\n        border-radius: 12px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .btn-sota.primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\n      }\n      \n      .btn-sota.primary:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\n      }\n      \n      .btn-sota.primary:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n        transform: none;\n      }\n      \n      .btn-sota.secondary {\n        background: #f1f5f9;\n        color: #475569;\n      }\n      \n      [data-theme=\"dark\"] .btn-sota.secondary {\n        background: rgba(255,255,255,0.1);\n        color: #e2e8f0;\n      }\n      \n      .btn-sota.secondary:hover {\n        background: #e2e8f0;\n      }\n      \n      .btn-sota.danger {\n        background: transparent;\n        color: #dc2626;\n        border: 1px solid #fecaca;\n      }\n      \n      .btn-sota.danger:hover {\n        background: #fef2f2;\n        border-color: #dc2626;\n      }\n      \n      .btn-sota.small {\n        padding: 8px 16px;\n        font-size: 13px;\n      }\n      \n      /* Section Headers */\n      .section-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 20px;\n      }\n      \n      .section-header h3 {\n        font-size: 16px;\n        font-weight: 600;\n        color: #1e293b;\n        margin: 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      [data-theme=\"dark\"] .section-header h3 {\n        color: #f1f5f9;\n      }\n      \n      .section-header h3 svg {\n        width: 20px;\n        height: 20px;\n        color: #e11d48;\n      }\n      \n      /* Members List */\n      .members-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      \n      .member-card {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 16px 20px;\n        background: #f8fafc;\n        border-radius: 12px;\n        border: 1px solid transparent;\n        transition: all 0.2s;\n      }\n      \n      [data-theme=\"dark\"] .member-card {\n        background: rgba(255,255,255,0.03);\n      }\n      \n      .member-card:hover {\n        border-color: #e2e8f0;\n      }\n      \n      .member-card.owner {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n      }\n      \n      .member-info {\n        display: flex;\n        align-items: center;\n        gap: 14px;\n      }\n      \n      .member-avatar {\n        width: 44px;\n        height: 44px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 16px;\n        font-weight: 600;\n        color: white;\n        flex-shrink: 0;\n        overflow: hidden;\n      }\n      \n      .member-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .member-details h4 {\n        margin: 0 0 4px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .member-details h4 {\n        color: #f1f5f9;\n      }\n      \n      .member-details p {\n        margin: 0;\n        font-size: 12px;\n        color: #64748b;\n      }\n      \n      .member-actions {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n      \n      .role-badge {\n        font-size: 11px;\n        font-weight: 600;\n        padding: 4px 10px;\n        border-radius: 20px;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n      \n      .role-badge.owner {\n        background: #e11d48;\n        color: white;\n      }\n      \n      .role-badge.admin {\n        background: #8b5cf6;\n        color: white;\n      }\n      \n      .role-badge.write {\n        background: #0ea5e9;\n        color: white;\n      }\n      \n      .role-badge.read {\n        background: #64748b;\n        color: white;\n      }\n      \n      .role-select {\n        padding: 6px 12px;\n        border: 1px solid #e2e8f0;\n        border-radius: 8px;\n        font-size: 13px;\n        background: white;\n        cursor: pointer;\n      }\n      \n      [data-theme=\"dark\"] .role-select {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      /* Role Templates List */\n      .roles-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 16px;\n      }\n      \n      .role-card {\n        padding: 20px;\n        background: #f8fafc;\n        border-radius: 16px;\n        border: 2px solid transparent;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      \n      [data-theme=\"dark\"] .role-card {\n        background: rgba(255,255,255,0.03);\n      }\n      \n      .role-card:hover {\n        border-color: #e2e8f0;\n        transform: translateY(-2px);\n      }\n      \n      .role-card.active {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n      }\n      \n      .role-card-header {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        margin-bottom: 12px;\n      }\n      \n      .role-icon {\n        width: 40px;\n        height: 40px;\n        border-radius: 10px;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      \n      .role-icon svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n      \n      .role-card h4 {\n        margin: 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .role-card h4 {\n        color: #f1f5f9;\n      }\n      \n      .role-card p {\n        margin: 0;\n        font-size: 13px;\n        color: #64748b;\n        line-height: 1.5;\n      }\n      \n      .role-card .toggle-active {\n        margin-top: 12px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        color: #64748b;\n      }\n      \n      /* Config Section */\n      .config-group {\n        margin-bottom: 32px;\n      }\n      \n      .config-group h4 {\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n        margin: 0 0 16px 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      [data-theme=\"dark\"] .config-group h4 {\n        color: #f1f5f9;\n      }\n      \n      .config-group h4 svg {\n        width: 16px;\n        height: 16px;\n        color: #e11d48;\n      }\n      \n      .api-key-field {\n        display: flex;\n        gap: 12px;\n      }\n      \n      .api-key-field input {\n        flex: 1;\n      }\n      \n      .api-key-field .btn-sota {\n        flex-shrink: 0;\n      }\n      \n      /* Danger Zone */\n      .danger-zone {\n        background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);\n        border: 1px solid #fecaca;\n        border-radius: 16px;\n        padding: 24px;\n        margin-top: 32px;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone {\n        background: linear-gradient(135deg, rgba(220,38,38,0.1) 0%, rgba(220,38,38,0.05) 100%);\n        border-color: rgba(220,38,38,0.3);\n      }\n      \n      .danger-zone h3 {\n        color: #dc2626 !important;\n        margin: 0 0 8px 0;\n        font-size: 16px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .danger-zone h3 svg {\n        width: 18px;\n        height: 18px;\n      }\n      \n      .danger-zone p {\n        color: #991b1b;\n        font-size: 14px;\n        margin: 0 0 16px 0;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone p {\n        color: #fca5a5;\n      }\n      \n      /* Empty State */\n      .empty-state {\n        text-align: center;\n        padding: 48px 24px;\n        color: #94a3b8;\n      }\n      \n      .empty-state svg {\n        width: 48px;\n        height: 48px;\n        margin-bottom: 16px;\n        opacity: 0.5;\n      }\n      \n      .empty-state p {\n        margin: 0 0 16px 0;\n      }\n      \n      /* Loading */\n      .loading-spinner {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 48px;\n      }\n      \n      .loading-spinner::after {\n        content: '';\n        width: 32px;\n        height: 32px;\n        border: 3px solid #e2e8f0;\n        border-top-color: #e11d48;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n      }\n      \n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n      \n      /* Responsive */\n      @media (max-width: 640px) {\n        .form-grid {\n          grid-template-columns: 1fr;\n        }\n        \n        .roles-grid {\n          grid-template-columns: 1fr;\n        }\n        \n        .project-tabs-nav {\n          padding: 0 16px;\n        }\n        \n        .project-tab-btn {\n          padding: 14px 16px;\n        }\n      }\n    </style>\n    \n    <div class=\"project-card\">\n      <div class=\"loading-spinner\"></div>\n    </div>\n  `;\n\n  return container;\n}\n\n/**\n * Load project data for editing\n */\nasync function loadProjectData(container: HTMLElement, projectId: string): Promise<void> {\n  const card = container.querySelector('.project-card') as HTMLElement;\n  if (!card) return;\n\n  try {\n    // Load project details, members, roles, config, and contacts in parallel\n    const [projectRes, membersRes, rolesRes, configRes, contactsRes] = await Promise.all([\n      http.get<{ project: ProjectData }>(`/api/projects/${projectId}`).catch(() => null),\n      http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`).catch(() => ({ data: { members: [] } })),\n      http.get<{ roles: RoleTemplate[] }>('/api/role-templates').catch(() => ({ data: { roles: [] } })),\n      http.get<{ config: ProjectConfig }>(`/api/projects/${projectId}/config`).catch(() => ({ data: { config: null } })),\n      http.get<{ contacts: Contact[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\n    ]);\n\n    if (projectRes?.data?.project) {\n      currentProject = projectRes.data.project;\n    }\n    projectMembers = membersRes?.data?.members || [];\n    projectRoles = rolesRes?.data?.roles || [];\n    projectConfig = configRes?.data?.config || null;\n    // Handle different response formats for contacts\n    const contactsData = contactsRes?.data;\n    projectContacts = Array.isArray(contactsData) ? contactsData : (contactsData?.contacts || []);\n\n    renderEditForm(card);\n  } catch {\n    // Use props project as fallback\n    renderEditForm(card);\n  }\n}\n\n/**\n * Render create form\n */\nfunction renderCreateForm(container: HTMLElement): void {\n  const card = container.querySelector('.project-card') as HTMLElement;\n  if (!card) return;\n\n  card.innerHTML = `\n    <!-- Header -->\n    <div class=\"project-header\">\n      <button class=\"project-close-btn\" id=\"close-project-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n      \n      <div class=\"project-header-content\">\n        <div class=\"project-icon-large\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n          </svg>\n        </div>\n        <div class=\"project-title-info\">\n          <h2>New Project</h2>\n          <p>Create a new project to organize your work</p>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Form -->\n    <div class=\"project-body\">\n      <form id=\"project-form\">\n        <div class=\"form-grid\">\n          <div class=\"form-field full-width\">\n            <label>\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n              </svg>\n              Project Name *\n            </label>\n            <input type=\"text\" name=\"name\" required placeholder=\"Enter project name\">\n          </div>\n          \n          <div class=\"form-field full-width\">\n            <label>\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\n              </svg>\n              Description\n            </label>\n            <textarea name=\"description\" placeholder=\"Brief description of the project\"></textarea>\n          </div>\n        </div>\n        \n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"cancel-btn\">Cancel</button>\n          <button type=\"submit\" class=\"btn-sota primary\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n            </svg>\n            Create Project\n          </button>\n        </div>\n      </form>\n    </div>\n  `;\n\n  bindCreateEvents(card);\n}\n\n/**\n * Render edit form with tabs\n */\nfunction renderEditForm(container: HTMLElement): void {\n  const project = currentProject || currentProps.project;\n  if (!project) return;\n\n  const settings = project.settings || {};\n\n  container.innerHTML = `\n    <!-- Header -->\n    <div class=\"project-header\">\n      <button class=\"project-close-btn\" id=\"close-project-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n      \n      <div class=\"project-header-content\">\n        <div class=\"project-icon-large\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n          </svg>\n        </div>\n        <div class=\"project-title-info\">\n          <h2>${escapeHtml(project.name)}</h2>\n          <p>${project.description ? escapeHtml(project.description) : 'No description'}</p>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Tabs Navigation -->\n    <nav class=\"project-tabs-nav\">\n      <button class=\"project-tab-btn active\" data-tab=\"general\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/>\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\n        </svg>\n        General\n      </button>\n      <button class=\"project-tab-btn\" data-tab=\"members\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\n        </svg>\n        Members\n        <span class=\"badge\">${projectMembers.length}</span>\n      </button>\n      <button class=\"project-tab-btn\" data-tab=\"roles\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\n        </svg>\n        Roles\n      </button>\n      <button class=\"project-tab-btn\" data-tab=\"config\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4\"/>\n        </svg>\n        Config\n      </button>\n    </nav>\n    \n    <!-- Tab Content -->\n    <div class=\"project-body\">\n      <!-- General Tab -->\n      <div class=\"project-section active\" id=\"section-general\">\n        <form id=\"project-form\">\n          <div class=\"form-grid\">\n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n                </svg>\n                Project Name *\n              </label>\n              <input type=\"text\" name=\"name\" required value=\"${escapeHtml(project.name)}\" placeholder=\"Enter project name\">\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\n                </svg>\n                Description\n              </label>\n              <textarea name=\"description\" placeholder=\"Brief description of the project\">${escapeHtml(project.description || '')}</textarea>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                </svg>\n                Your Role\n              </label>\n              <input type=\"text\" name=\"userRole\" value=\"${escapeHtml(settings.userRole || '')}\" placeholder=\"e.g., Project Manager, Tech Lead\">\n              <span class=\"form-hint\">Your role in this project (used for AI context)</span>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\"/>\n                </svg>\n                Role Prompt\n              </label>\n              <input type=\"text\" name=\"userRolePrompt\" value=\"${escapeHtml(settings.userRolePrompt || '')}\" placeholder=\"e.g., I manage the project timeline\">\n              <span class=\"form-hint\">Brief description of your responsibilities</span>\n            </div>\n          </div>\n          \n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-sota primary\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              Save Changes\n            </button>\n          </div>\n        </form>\n        \n        <!-- Danger Zone -->\n        <div class=\"danger-zone\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n            </svg>\n            Danger Zone\n          </h3>\n          <p>Deleting a project will permanently remove all associated data including questions, decisions, risks, and contacts.</p>\n          <button type=\"button\" class=\"btn-sota danger\" id=\"delete-project-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\n            </svg>\n            Delete Project\n          </button>\n        </div>\n      </div>\n      \n      <!-- Members Tab -->\n      <div class=\"project-section\" id=\"section-members\">\n        <div class=\"section-header\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\n            </svg>\n            Team Members\n          </h3>\n          <button class=\"btn-sota primary small\" id=\"invite-member-btn\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\n            </svg>\n            Invite\n          </button>\n        </div>\n        \n        <div class=\"members-list\" id=\"members-list\">\n          ${renderMembersList()}\n        </div>\n      </div>\n      \n      <!-- Roles Tab -->\n      <div class=\"project-section\" id=\"section-roles\">\n        <div class=\"section-header\" style=\"display: flex; justify-content: space-between; align-items: center;\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\n            </svg>\n            Available Roles\n          </h3>\n          <button class=\"btn-sota primary small\" id=\"add-role-btn\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n            </svg>\n            Add Role\n          </button>\n        </div>\n        <p style=\"color: #64748b; font-size: 14px; margin-bottom: 20px;\">\n          Select which roles are available for team members in this project.\n        </p>\n        \n        <div class=\"roles-grid\" id=\"roles-grid\">\n          ${renderRolesList()}\n        </div>\n      </div>\n      \n      <!-- Config Tab -->\n      <div class=\"project-section\" id=\"section-config\">\n        <div class=\"section-header\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4\"/>\n            </svg>\n            Project Configuration\n          </h3>\n        </div>\n        <p style=\"color: #64748b; font-size: 14px; margin-bottom: 24px;\">\n          Override system defaults with project-specific API keys. Leave empty to use system defaults.\n        </p>\n        \n        <form id=\"config-form\">\n          <!-- LLM Per-Task Configuration -->\n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z\"/>\n              </svg>\n              LLM Model Selection\n            </h4>\n            <p style=\"color: #64748b; font-size: 13px; margin-bottom: 16px;\">\n              Override system defaults for each task type. Uncheck to use platform defaults.\n            </p>\n            \n            <!-- Text -->\n            <div class=\"llm-task-override\">\n              <div class=\"task-header-inline\">\n                <label class=\"checkbox-inline\">\n                  <input type=\"checkbox\" name=\"use_system_text\" ${getConfigValue('llm_pertask.useSystemDefaults.text') !== 'false' ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Text / Chat\n                </label>\n                <span class=\"system-hint\">(Use system default)</span>\n              </div>\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.text') !== 'false' ? 'disabled' : ''}\">\n                <select name=\"text_provider\" class=\"form-control\" disabled>\n                  <option value=\"\">Loading...</option>\n                </select>\n                <select name=\"text_model\" class=\"form-control\" disabled>\n                  <option value=\"\">Select provider first</option>\n                </select>\n              </div>\n            </div>\n            \n            <!-- Vision -->\n            <div class=\"llm-task-override\">\n              <div class=\"task-header-inline\">\n                <label class=\"checkbox-inline\">\n                  <input type=\"checkbox\" name=\"use_system_vision\" ${getConfigValue('llm_pertask.useSystemDefaults.vision') !== 'false' ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Vision\n                </label>\n                <span class=\"system-hint\">(Use system default)</span>\n              </div>\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.vision') !== 'false' ? 'disabled' : ''}\">\n                <select name=\"vision_provider\" class=\"form-control\" disabled>\n                  <option value=\"\">Loading...</option>\n                </select>\n                <select name=\"vision_model\" class=\"form-control\" disabled>\n                  <option value=\"\">Select provider first</option>\n                </select>\n              </div>\n            </div>\n            \n            <!-- Embeddings -->\n            <div class=\"llm-task-override\">\n              <div class=\"task-header-inline\">\n                <label class=\"checkbox-inline\">\n                  <input type=\"checkbox\" name=\"use_system_embeddings\" ${getConfigValue('llm_pertask.useSystemDefaults.embeddings') !== 'false' ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Embeddings\n                </label>\n                <span class=\"system-hint\">(Use system default)</span>\n              </div>\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.embeddings') !== 'false' ? 'disabled' : ''}\">\n                <select name=\"embeddings_provider\" class=\"form-control\" disabled>\n                  <option value=\"\">Loading...</option>\n                </select>\n                <select name=\"embeddings_model\" class=\"form-control\" disabled>\n                  <option value=\"\">Select provider first</option>\n                </select>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\"/>\n              </svg>\n              Google Drive Storage\n            </h4>\n            <p style=\"color: #64748b; font-size: 13px; margin-bottom: 16px;\">\n              Configure per-project Google Drive storage (Service Account). This keeps files portable and avoids local filesystem paths.\n            </p>\n\n            <div class=\"llm-task-override\" style=\"padding: 16px; border: 1px solid rgba(148, 163, 184, 0.25); border-radius: 12px; background: rgba(15, 23, 42, 0.02);\">\n              <div class=\"task-header-inline\" style=\"margin-bottom: 12px;\">\n                <label class=\"checkbox-inline\" style=\"gap: 10px;\">\n                  <input type=\"checkbox\" id=\"gdrive-enabled\" ${settings.googleDrive?.enabled ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Enable Google Drive for this project\n                </label>\n              </div>\n\n              <div class=\"form-grid\" style=\"grid-template-columns: 1fr;\">\n                <div class=\"form-field full-width\">\n                  <label>Platform Google Drive</label>\n                  <div style=\"font-size: 13px; color: #64748b; line-height: 1.4;\">\n                    Google Drive is configured at platform level by a superadmin. This project can only <b>Test</b> the connection and <b>Bootstrap</b> its folder structure.\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"form-actions\" style=\"justify-content: flex-start; gap: 10px; margin-top: 8px;\">\n                <button type=\"button\" class=\"btn-sota secondary\" id=\"gdrive-test-btn\">Test</button>\n                <button type=\"button\" class=\"btn-sota secondary\" id=\"gdrive-bootstrap-btn\">Bootstrap Folders</button>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\"/>\n              </svg>\n              LLM API Keys\n            </h4>\n            <p style=\"color: #64748b; font-size: 13px; margin-bottom: 16px;\">\n              Override system API keys for this project. Leave empty to use system defaults.\n            </p>\n            \n            <div class=\"form-grid\">\n              <div class=\"form-field\">\n                <label>OpenAI API Key</label>\n                <input type=\"password\" name=\"openai_key\" placeholder=\"sk-...\" value=\"${escapeHtml(getConfigValue('llm_config.openai_key'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Anthropic API Key</label>\n                <input type=\"password\" name=\"anthropic_key\" placeholder=\"sk-ant-...\" value=\"${escapeHtml(getConfigValue('llm_config.anthropic_key'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Google AI API Key</label>\n                <input type=\"password\" name=\"google_key\" placeholder=\"AI...\" value=\"${escapeHtml(getConfigValue('llm_config.google_key'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>xAI (Grok) API Key</label>\n                <input type=\"password\" name=\"grok_key\" placeholder=\"xai-...\" value=\"${escapeHtml(getConfigValue('llm_config.grok_key'))}\">\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01\"/>\n              </svg>\n              Ollama Configuration\n            </h4>\n            \n            <div class=\"form-grid\">\n              <div class=\"form-field\">\n                <label>Ollama URL</label>\n                <input type=\"url\" name=\"ollama_url\" placeholder=\"http://localhost:11434\" value=\"${escapeHtml(getConfigValue('ollama_config.url'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Default Model</label>\n                <input type=\"text\" name=\"ollama_model\" placeholder=\"llama2, mistral, etc.\" value=\"${escapeHtml(getConfigValue('ollama_config.model'))}\">\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-sota primary\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              Save Configuration\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  `;\n\n  bindEditEvents(container);\n}\n\n// ==================== Render Helpers ====================\n\nfunction renderMembersList(): string {\n  if (projectMembers.length === 0) {\n    return `\n      <div class=\"empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\n        </svg>\n        <p>No team members yet</p>\n        <button class=\"btn-sota primary small\" id=\"invite-first-btn\">Invite Member</button>\n      </div>\n    `;\n  }\n\n  return projectMembers.map(member => {\n    const initials = getInitials(member.display_name || member.email || 'U');\n    const isOwner = member.role === 'owner';\n    \n    return `\n      <div class=\"member-card ${isOwner ? 'owner' : ''}\" data-user-id=\"${member.user_id}\">\n        <div class=\"member-info\">\n          <div class=\"member-avatar\">\n            ${member.avatar_url \n              ? `<img src=\"${member.avatar_url}\" alt=\"${escapeHtml(member.display_name || '')}\">`\n              : initials\n            }\n          </div>\n          <div class=\"member-details\">\n            <h4>${escapeHtml(member.display_name || member.email || 'Unknown')}</h4>\n            <p>\n              ${escapeHtml(member.email || '')}\n              ${member.user_role ? `  <strong>${escapeHtml(member.user_role)}</strong>` : '  <em style=\"opacity: 0.6\">No role defined</em>'}\n              ${member.linked_contact ? `  <span style=\"color: #e11d48;\" title=\"Linked to contact: ${escapeHtml(member.linked_contact.name)}\"> ${escapeHtml(member.linked_contact.name)}</span>` : ''}\n            </p>\n          </div>\n        </div>\n        <div class=\"member-actions\">\n          <button class=\"btn-sota secondary small edit-user-role-btn\" data-user-id=\"${member.user_id}\" title=\"Edit project role\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\n            </svg>\n          </button>\n          <button class=\"btn-sota secondary small permissions-btn\" data-user-id=\"${member.user_id}\" title=\"Edit permissions\" style=\"font-size: 14px;\">\n            \n          </button>\n          ${isOwner \n            ? `<span class=\"role-badge owner\">Owner</span>`\n            : `\n              <select class=\"role-select member-role-select\" data-user-id=\"${member.user_id}\" title=\"Access level\">\n                <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\n                <option value=\"write\" ${member.role === 'write' ? 'selected' : ''}>Write</option>\n                <option value=\"read\" ${member.role === 'read' ? 'selected' : ''}>Read</option>\n              </select>\n              <button class=\"btn-sota danger small remove-member-btn\" data-user-id=\"${member.user_id}\" title=\"Remove member\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n                </svg>\n              </button>\n            `\n          }\n        </div>\n      </div>\n    `;\n  }).join('');\n}\n\nfunction renderRolesList(): string {\n  if (projectRoles.length === 0) {\n    return `\n      <div class=\"empty-state\" style=\"grid-column: 1 / -1;\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\n        </svg>\n        <p>No role templates available</p>\n      </div>\n    `;\n  }\n\n  return projectRoles.map(role => `\n    <div class=\"role-card ${role.is_active ? 'active' : ''}\" data-role-id=\"${role.id}\">\n      <div class=\"role-card-header\">\n        <div class=\"role-icon\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n          </svg>\n        </div>\n        <h4>${escapeHtml(role.display_name)}</h4>\n      </div>\n      <p>${escapeHtml(role.description || 'No description')}</p>\n      <div class=\"toggle-active\">\n        <input type=\"checkbox\" id=\"role-${role.id}\" ${role.is_active ? 'checked' : ''}>\n        <label for=\"role-${role.id}\">Active in this project</label>\n      </div>\n    </div>\n  `).join('');\n}\n\nfunction getConfigValue(path: string): string {\n  if (!projectConfig) return '';\n  \n  const parts = path.split('.');\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let value: any = projectConfig;\n  \n  for (const part of parts) {\n    if (value && typeof value === 'object' && part in value) {\n      value = value[part];\n    } else {\n      return '';\n    }\n  }\n  \n  return typeof value === 'string' ? value : '';\n}\n\n// ==================== Event Binding ====================\n\nfunction bindCreateEvents(container: HTMLElement): void {\n  // Close button\n  const closeBtn = container.querySelector('#close-project-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\n  }\n\n  // Cancel button\n  const cancelBtn = container.querySelector('#cancel-btn');\n  if (cancelBtn) {\n    on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\n  }\n\n  // Form submit\n  const form = container.querySelector('#project-form') as HTMLFormElement;\n  if (form) {\n    on(form, 'submit', async (e) => {\n      e.preventDefault();\n      \n      const formData = new FormData(form);\n      const projectData: ProjectData = {\n        name: (formData.get('name') as string).trim(),\n        description: (formData.get('description') as string).trim() || undefined,\n      };\n\n      const submitBtn = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\n      submitBtn.disabled = true;\n      submitBtn.innerHTML = '<span class=\"loading-spinner\" style=\"width: 16px; height: 16px;\"></span> Creating...';\n\n      try {\n        const response = await http.post<{ id: string; project?: ProjectData }>('/api/projects', projectData);\n        projectData.id = response.data.id;\n        \n        toast.success('Project created');\n        \n        // Set as current project\n        appStore.setCurrentProject({\n          id: projectData.id,\n          name: projectData.name,\n          description: projectData.description,\n        });\n        \n        currentProps.onSave?.(projectData);\n        closeModal(MODAL_ID);\n        loadProjects();\n      } catch {\n        toast.error('Failed to create project');\n      } finally {\n        submitBtn.disabled = false;\n        submitBtn.innerHTML = `\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create Project\n        `;\n      }\n    });\n  }\n}\n\nfunction bindEditEvents(container: HTMLElement): void {\n  // Close button\n  const closeBtn = container.querySelector('#close-project-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\n  }\n\n  // Tab switching\n  const tabs = container.querySelectorAll('.project-tab-btn');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n\n      const tabId = tab.getAttribute('data-tab');\n      container.querySelectorAll('.project-section').forEach(section => {\n        section.classList.toggle('active', section.id === `section-${tabId}`);\n      });\n    });\n  });\n\n  // General form submit\n  const projectForm = container.querySelector('#project-form') as HTMLFormElement;\n  if (projectForm) {\n    on(projectForm, 'submit', async (e) => {\n      e.preventDefault();\n      \n      const formData = new FormData(projectForm);\n      const projectData = {\n        name: (formData.get('name') as string).trim(),\n        description: (formData.get('description') as string).trim() || undefined,\n        settings: {\n          userRole: (formData.get('userRole') as string).trim() || undefined,\n          userRolePrompt: (formData.get('userRolePrompt') as string).trim() || undefined,\n        },\n      };\n\n      try {\n        await http.put(`/api/projects/${currentProject?.id || currentProps.project?.id}`, projectData);\n        toast.success('Project updated');\n        currentProps.onSave?.({ ...currentProject, ...projectData } as ProjectData);\n        \n        // Update header\n        const titleEl = container.querySelector('.project-title-info h2');\n        const descEl = container.querySelector('.project-title-info p');\n        if (titleEl) titleEl.textContent = projectData.name;\n        if (descEl) descEl.textContent = projectData.description || 'No description';\n      } catch {\n        toast.error('Failed to update project');\n      }\n    });\n  }\n\n  // Delete project\n  const deleteBtn = container.querySelector('#delete-project-btn');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      const project = currentProject || currentProps.project;\n      if (!project?.id) return;\n\n      const confirmed = await confirm(\n        `Are you sure you want to delete \"${project.name}\"? This action cannot be undone.`,\n        {\n          title: 'Delete Project',\n          confirmText: 'Delete',\n          confirmClass: 'btn-danger',\n        }\n      );\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/projects/${project.id}`);\n          toast.success('Project deleted');\n          currentProps.onDelete?.(project.id);\n          closeModal(MODAL_ID);\n          \n          if (appStore.getState().currentProjectId === project.id) {\n            appStore.setCurrentProject(null);\n          }\n          \n          loadProjects();\n        } catch {\n          toast.error('Failed to delete project');\n        }\n      }\n    });\n  }\n\n  // Invite member buttons\n  const inviteBtn = container.querySelector('#invite-member-btn');\n  const inviteFirstBtn = container.querySelector('#invite-first-btn');\n  [inviteBtn, inviteFirstBtn].forEach(btn => {\n    if (btn) {\n      on(btn as HTMLElement, 'click', () => {\n        showInviteModal();\n      });\n    }\n  });\n\n  // Add role button\n  const addRoleBtn = container.querySelector('#add-role-btn');\n  if (addRoleBtn) {\n    on(addRoleBtn as HTMLElement, 'click', () => {\n      showAddRoleDialog(container);\n    });\n  }\n\n  // Member role changes\n  container.querySelectorAll('.member-role-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const userId = select.getAttribute('data-user-id');\n      const newRole = (select as HTMLSelectElement).value;\n      const projectId = currentProject?.id || currentProps.project?.id;\n      \n      if (!userId || !projectId) return;\n\n      try {\n        await http.put(`/api/projects/${projectId}/members/${userId}`, { role: newRole });\n        toast.success('Member role updated');\n      } catch {\n        toast.error('Failed to update role');\n      }\n    });\n  });\n\n  // Remove member\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const userId = btn.getAttribute('data-user-id');\n      const projectId = currentProject?.id || currentProps.project?.id;\n      \n      if (!userId || !projectId) return;\n\n      const confirmed = await confirm('Remove this member from the project?', {\n        title: 'Remove Member',\n        confirmText: 'Remove',\n        confirmClass: 'btn-danger',\n      });\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/projects/${projectId}/members/${userId}`);\n          toast.success('Member removed');\n          \n          // Remove from list\n          projectMembers = projectMembers.filter(m => m.user_id !== userId);\n          const membersList = container.querySelector('#members-list');\n          if (membersList) {\n            membersList.innerHTML = renderMembersList();\n            bindMemberEvents(container);\n          }\n        } catch {\n          toast.error('Failed to remove member');\n        }\n      }\n    });\n  });\n\n  // Google Drive (project)\n  const gdriveTestBtn = container.querySelector('#gdrive-test-btn') as HTMLButtonElement;\n  const gdriveBootstrapBtn = container.querySelector('#gdrive-bootstrap-btn') as HTMLButtonElement;\n\n  const getProjectId = () => currentProject?.id || currentProps.project?.id;\n\n  // Google Drive is configured at platform level; project modal does not save credentials.\n\n\n  async function loadGoogleDriveSettings() {\n    const projectId = getProjectId();\n    if (!projectId) return;\n\n    // Avoid overwriting user's edits if request resolves late\n    if (gdriveDirty) return;\n\n    try {\n      const res = await http.get<{ googleDrive: { enabled?: boolean; rootFolderId?: string | null } }>(\n        `/api/projects/${projectId}/google-drive`\n      );\n\n      const enabledEl = container.querySelector('#gdrive-enabled') as HTMLInputElement;\n      const rootFolderEl = container.querySelector('#gdrive-root-folder') as HTMLInputElement;\n\n      if (enabledEl) enabledEl.checked = !!res.data.googleDrive?.enabled;\n      if (rootFolderEl) rootFolderEl.value = (res.data.googleDrive?.rootFolderId as string) || '';\n    } catch {\n      // Ignore - user might not have permissions or feature not enabled\n    }\n  }\n\n  // Load persisted Drive settings (do not rely only on project.settings cache)\n  loadGoogleDriveSettings();\n\n  if (gdriveTestBtn) {\n    on(gdriveTestBtn, 'click', async () => {\n      const projectId = getProjectId();\n      if (!projectId) return;\n\n      try {\n        await http.post(`/api/projects/${projectId}/google-drive/test`, {});\n        toast.success('Google Drive connection OK');\n      } catch {\n        toast.error('Google Drive test failed');\n      }\n    });\n  }\n\n  if (gdriveBootstrapBtn) {\n    on(gdriveBootstrapBtn, 'click', async () => {\n      const projectId = getProjectId();\n      if (!projectId) return;\n\n      try {\n        gdriveDirty = false;\n        await http.post(`/api/projects/${projectId}/google-drive/bootstrap`, {});\n        toast.success('Google Drive folders created');\n        await loadGoogleDriveSettings();\n      } catch {\n        toast.error('Failed to bootstrap Google Drive folders');\n      }\n    });\n  }\n\n  // Config form submit\n  const configForm = container.querySelector('#config-form') as HTMLFormElement;\n  if (configForm) {\n    on(configForm, 'submit', async (e) => {\n      e.preventDefault();\n      \n      const formData = new FormData(configForm);\n      const config = {\n        llm_config: {\n          openai_key: formData.get('openai_key') || undefined,\n          anthropic_key: formData.get('anthropic_key') || undefined,\n          google_key: formData.get('google_key') || undefined,\n          grok_key: formData.get('grok_key') || undefined,\n        },\n        ollama_config: {\n          url: formData.get('ollama_url') || undefined,\n          model: formData.get('ollama_model') || undefined,\n        },\n      };\n\n      const projectId = getProjectId();\n      if (!projectId) return;\n\n      try {\n        await http.put(`/api/projects/${projectId}/config`, config);\n        toast.success('Configuration saved');\n      } catch {\n        toast.error('Failed to save configuration');\n      }\n    });\n  }\n\n  // Bind member-specific events (edit role buttons)\n  bindMemberEvents(container);\n}\n\nfunction bindMemberEvents(container: HTMLElement): void {\n  // Edit user role buttons\n  container.querySelectorAll('.edit-user-role-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const userId = btn.getAttribute('data-user-id');\n      if (!userId) return;\n      \n      const member = projectMembers.find(m => m.user_id === userId);\n      if (member) {\n        showEditUserRoleDialog(container, member);\n      }\n    });\n  });\n\n  // Permissions buttons\n  container.querySelectorAll('.permissions-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const userId = btn.getAttribute('data-user-id');\n      if (!userId) return;\n      \n      const member = projectMembers.find(m => m.user_id === userId);\n      const projectId = currentProject?.id || currentProps.project?.id;\n      if (!member || !projectId) return;\n\n      showMemberPermissionsModal({\n        projectId,\n        userId: member.user_id,\n        userName: member.display_name || '',\n        userEmail: member.email || '',\n        avatarUrl: member.avatar_url,\n        currentRole: member.role,\n        currentPermissions: (member as { permissions?: string[] }).permissions,\n        onSave: async () => {\n          // Reload members after permissions update\n          try {\n            const response = await http.get<{ members: typeof projectMembers }>(`/api/projects/${projectId}/members`);\n            projectMembers = response.data.members || [];\n            const membersList = container.querySelector('#members-list');\n            if (membersList) {\n              membersList.innerHTML = renderMembersList();\n              bindMemberEvents(container);\n            }\n          } catch {\n            // Ignore\n          }\n        },\n      });\n    });\n  });\n\n  // Re-bind member role changes and remove buttons after list update\n  container.querySelectorAll('.member-role-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const userId = select.getAttribute('data-user-id');\n      const newRole = (select as HTMLSelectElement).value;\n      const projectId = currentProject?.id || currentProps.project?.id;\n      \n      if (!userId || !projectId) return;\n\n      try {\n        await http.put(`/api/projects/${projectId}/members/${userId}`, { role: newRole });\n        toast.success('Access level updated');\n      } catch {\n        toast.error('Failed to update access level');\n      }\n    });\n  });\n\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const userId = btn.getAttribute('data-user-id');\n      const projectId = currentProject?.id || currentProps.project?.id;\n      \n      if (!userId || !projectId) return;\n\n      const confirmed = await confirm('Remove this member from the project?', {\n        title: 'Remove Member',\n        confirmText: 'Remove',\n        confirmClass: 'btn-danger',\n      });\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/projects/${projectId}/members/${userId}`);\n          toast.success('Member removed');\n          \n          projectMembers = projectMembers.filter(m => m.user_id !== userId);\n          const membersList = container.querySelector('#members-list');\n          if (membersList) {\n            membersList.innerHTML = renderMembersList();\n            bindMemberEvents(container);\n          }\n        } catch {\n          toast.error('Failed to remove member');\n        }\n      }\n    });\n  });\n}\n\n/**\n * Show dialog to add a new role\n */\nfunction showAddRoleDialog(container: HTMLElement): void {\n  // Check if dialog already exists\n  const existingDialog = container.querySelector('.add-role-dialog');\n  if (existingDialog) existingDialog.remove();\n\n  const projectId = currentProject?.id || currentProps.project?.id;\n  if (!projectId) return;\n\n  // Create dialog\n  const dialog = createElement('div', { className: 'add-role-dialog' });\n  dialog.innerHTML = `\n    <style>\n      .add-role-dialog {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0,0,0,0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10001;\n        backdrop-filter: blur(4px);\n      }\n      \n      .add-role-card {\n        background: white;\n        border-radius: 20px;\n        width: 100%;\n        max-width: 500px;\n        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .add-role-card {\n        background: #1e293b;\n      }\n      \n      .add-role-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 20px 24px;\n        color: white;\n      }\n      \n      .add-role-header h4 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 700;\n      }\n      \n      .add-role-body {\n        padding: 24px;\n      }\n      \n      .add-role-field {\n        margin-bottom: 20px;\n      }\n      \n      .add-role-field label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        color: #64748b;\n        margin-bottom: 8px;\n      }\n      \n      .add-role-field input,\n      .add-role-field textarea,\n      .add-role-field select {\n        width: 100%;\n        padding: 12px 16px;\n        border: 1px solid #e2e8f0;\n        border-radius: 10px;\n        font-size: 14px;\n        box-sizing: border-box;\n        background: #f8fafc;\n      }\n      \n      [data-theme=\"dark\"] .add-role-field input,\n      [data-theme=\"dark\"] .add-role-field textarea,\n      [data-theme=\"dark\"] .add-role-field select {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .add-role-field input:focus,\n      .add-role-field textarea:focus,\n      .add-role-field select:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\n      }\n      \n      .add-role-field textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .add-role-ai-btn {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        padding: 8px 14px;\n        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n        color: white;\n        border: none;\n        border-radius: 8px;\n        font-size: 12px;\n        font-weight: 600;\n        cursor: pointer;\n        margin-top: 8px;\n        transition: all 0.2s;\n      }\n      \n      .add-role-ai-btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 12px rgba(139,92,246,0.3);\n      }\n      \n      .add-role-ai-btn:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n      }\n      \n      .add-role-actions {\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n        padding-top: 16px;\n        border-top: 1px solid #e2e8f0;\n      }\n      \n      [data-theme=\"dark\"] .add-role-actions {\n        border-color: rgba(255,255,255,0.1);\n      }\n    </style>\n    \n    <div class=\"add-role-card\">\n      <div class=\"add-role-header\">\n        <h4>Add New Role</h4>\n      </div>\n      <div class=\"add-role-body\">\n        <form id=\"add-role-form\">\n          <div class=\"add-role-field\">\n            <label>Role Name *</label>\n            <input type=\"text\" id=\"new-role-name\" required placeholder=\"e.g., Senior Developer, Tech Lead\">\n          </div>\n          \n          <div class=\"add-role-field\">\n            <label>Category</label>\n            <select id=\"new-role-category\">\n              <option value=\"project\"> Project</option>\n              <option value=\"technical\"> Technical</option>\n              <option value=\"management\"> Management</option>\n              <option value=\"stakeholder\"> Stakeholder</option>\n              <option value=\"custom\"> Custom</option>\n            </select>\n          </div>\n          \n          <div class=\"add-role-field\">\n            <label>Description</label>\n            <input type=\"text\" id=\"new-role-description\" placeholder=\"Brief description of this role\">\n          </div>\n          \n          <div class=\"add-role-field\">\n            <label>Role Context (for AI)</label>\n            <textarea id=\"new-role-context\" placeholder=\"Describe this role's responsibilities, priorities, and how the AI should adapt responses...\"></textarea>\n            <button type=\"button\" class=\"add-role-ai-btn\" id=\"enhance-role-btn\">\n               Enhance with AI\n            </button>\n          </div>\n          \n          <div class=\"add-role-actions\">\n            <button type=\"button\" class=\"btn-sota secondary\" id=\"cancel-add-role\">Cancel</button>\n            <button type=\"submit\" class=\"btn-sota primary\">Create Role</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  `;\n\n  container.appendChild(dialog);\n\n  // Bind events\n  const closeDialog = () => dialog.remove();\n\n  // Cancel button\n  const cancelBtn = dialog.querySelector('#cancel-add-role');\n  if (cancelBtn) {\n    on(cancelBtn as HTMLElement, 'click', closeDialog);\n  }\n\n  // Click outside to close\n  on(dialog, 'click', (e) => {\n    if (e.target === dialog) closeDialog();\n  });\n\n  // AI enhance button\n  const enhanceBtn = dialog.querySelector('#enhance-role-btn');\n  if (enhanceBtn) {\n    on(enhanceBtn as HTMLElement, 'click', async () => {\n      const nameInput = dialog.querySelector('#new-role-name') as HTMLInputElement;\n      const contextInput = dialog.querySelector('#new-role-context') as HTMLTextAreaElement;\n      const descInput = dialog.querySelector('#new-role-description') as HTMLInputElement;\n\n      const roleName = nameInput.value.trim();\n      if (!roleName) {\n        toast.error('Please enter a role name first');\n        return;\n      }\n\n      (enhanceBtn as HTMLButtonElement).disabled = true;\n      enhanceBtn.textContent = ' Enhancing...';\n\n      try {\n        const response = await http.post<{ prompt: string; description?: string }>('/api/roles/generate', {\n          title: roleName,\n          currentContext: contextInput.value,\n        });\n\n        if (response.data.prompt) {\n          contextInput.value = response.data.prompt;\n        }\n        if (response.data.description && !descInput.value) {\n          descInput.value = response.data.description;\n        }\n        toast.success('Role context enhanced');\n      } catch {\n        toast.error('Failed to enhance with AI');\n      } finally {\n        (enhanceBtn as HTMLButtonElement).disabled = false;\n        enhanceBtn.textContent = ' Enhance with AI';\n      }\n    });\n  }\n\n  // Form submit\n  const form = dialog.querySelector('#add-role-form') as HTMLFormElement;\n  if (form) {\n    on(form, 'submit', async (e) => {\n      e.preventDefault();\n\n      const name = (dialog.querySelector('#new-role-name') as HTMLInputElement).value.trim();\n      const category = (dialog.querySelector('#new-role-category') as HTMLSelectElement).value;\n      const description = (dialog.querySelector('#new-role-description') as HTMLInputElement).value.trim();\n      const roleContext = (dialog.querySelector('#new-role-context') as HTMLTextAreaElement).value.trim();\n\n      if (!name) {\n        toast.error('Role name is required');\n        return;\n      }\n\n      try {\n        await http.post('/api/role-templates', {\n          name: name.toLowerCase().replace(/\\s+/g, '_'),\n          display_name: name,\n          description,\n          role_context: roleContext,\n          category,\n          color: '#e11d48',\n          is_template: true,\n        });\n\n        toast.success('Role created');\n        closeDialog();\n\n        // Reload roles\n        await loadProjectRoles(projectId);\n        const rolesGrid = container.querySelector('#roles-grid');\n        if (rolesGrid) {\n          rolesGrid.innerHTML = renderRolesList();\n        }\n      } catch {\n        toast.error('Failed to create role');\n      }\n    });\n  }\n\n  // Focus on name input\n  setTimeout(() => {\n    const nameInput = dialog.querySelector('#new-role-name') as HTMLInputElement;\n    if (nameInput) nameInput.focus();\n  }, 100);\n}\n\n/**\n * Show inline edit dialog for user role\n */\nfunction showEditUserRoleDialog(container: HTMLElement, member: ProjectMember): void {\n  // Check if dialog already exists\n  const existingDialog = container.querySelector('.user-role-edit-dialog');\n  if (existingDialog) existingDialog.remove();\n\n  const projectId = currentProject?.id || currentProps.project?.id;\n  if (!projectId) return;\n\n  // Create inline edit dialog\n  const dialog = createElement('div', { className: 'user-role-edit-dialog' });\n  dialog.innerHTML = `\n    <style>\n      .user-role-edit-dialog {\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: white;\n        border-radius: 16px;\n        box-shadow: 0 25px 50px rgba(0,0,0,0.25);\n        padding: 24px;\n        z-index: 10001;\n        width: 400px;\n        max-width: 90vw;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog {\n        background: #1e293b;\n      }\n      \n      .user-role-edit-dialog h3 {\n        margin: 0 0 20px 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: #1e293b;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog h3 {\n        color: #f1f5f9;\n      }\n      \n      .user-role-edit-dialog h3 svg {\n        width: 20px;\n        height: 20px;\n        color: #e11d48;\n      }\n      \n      .user-role-edit-dialog .form-field {\n        margin-bottom: 16px;\n      }\n      \n      .user-role-edit-dialog .form-field label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        color: #475569;\n        margin-bottom: 6px;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field label {\n        color: #94a3b8;\n      }\n      \n      .user-role-edit-dialog .form-field input,\n      .user-role-edit-dialog .form-field textarea,\n      .user-role-edit-dialog .form-field select {\n        width: 100%;\n        padding: 10px 14px;\n        border: 1px solid #e2e8f0;\n        border-radius: 10px;\n        font-size: 14px;\n        background: #f8fafc;\n        color: #1e293b;\n        box-sizing: border-box;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field input,\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field textarea,\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field select {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .user-role-edit-dialog .form-field input:focus,\n      .user-role-edit-dialog .form-field textarea:focus,\n      .user-role-edit-dialog .form-field select:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .user-role-edit-dialog .form-field textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .user-role-edit-dialog .form-hint {\n        font-size: 12px;\n        color: #94a3b8;\n        margin-top: 4px;\n      }\n      \n      .user-role-edit-dialog .linked-contact-info {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        padding: 10px 14px;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n        border: 1px solid rgba(225,29,72,0.2);\n        border-radius: 10px;\n        margin-top: 8px;\n      }\n      \n      .user-role-edit-dialog .linked-contact-info svg {\n        width: 16px;\n        height: 16px;\n        color: #e11d48;\n        flex-shrink: 0;\n      }\n      \n      .user-role-edit-dialog .linked-contact-info span {\n        font-size: 13px;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog .linked-contact-info span {\n        color: #f1f5f9;\n      }\n      \n      .user-role-edit-dialog .dialog-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n        margin-top: 20px;\n      }\n      \n      .user-role-edit-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,0.4);\n        z-index: 10000;\n      }\n    </style>\n    \n    <h3>\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n      </svg>\n      Edit Project Role\n    </h3>\n    <p style=\"color: #64748b; font-size: 14px; margin: 0 0 20px 0;\">\n      Define <strong>${escapeHtml(member.display_name || member.email || 'this member')}</strong>'s role in the project\n    </p>\n    \n    <div class=\"form-field\">\n      <label>Role Title</label>\n      <select id=\"edit-user-role\">\n        <option value=\"\">-- Select a role --</option>\n        ${projectRoles.filter(r => r.is_active).map(r => `\n          <option value=\"${escapeHtml(r.display_name || r.name)}\" \n                  data-prompt=\"${escapeHtml(r.prompt_template || '')}\"\n                  ${member.user_role === r.display_name || member.user_role === r.name ? 'selected' : ''}>\n            ${escapeHtml(r.display_name || r.name)}\n          </option>\n        `).join('')}\n        <option value=\"__custom__\" ${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? 'selected' : ''}>Custom role...</option>\n      </select>\n      <div class=\"form-hint\">Select a predefined role or choose \"Custom role\" for a custom title</div>\n      <input type=\"text\" id=\"edit-user-role-custom\" \n             value=\"${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? escapeHtml(member.user_role) : ''}\" \n             placeholder=\"Enter custom role title\"\n             style=\"margin-top: 8px; display: ${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? 'block' : 'none'};\">\n    </div>\n    \n    <div class=\"form-field\">\n      <label>Role Description</label>\n      <textarea id=\"edit-user-role-prompt\" placeholder=\"e.g., I manage the technical architecture and lead the development team\">${escapeHtml(member.user_role_prompt || '')}</textarea>\n      <div class=\"form-hint\">Brief description of responsibilities (used for AI context)</div>\n    </div>\n    \n    <div class=\"form-field\">\n      <label>\n        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" style=\"display: inline; vertical-align: middle; margin-right: 4px;\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n        </svg>\n        Link to Contact\n      </label>\n      <select id=\"edit-linked-contact\">\n        <option value=\"\">-- No linked contact --</option>\n        ${projectContacts.map(c => `\n          <option value=\"${c.id}\" ${member.linked_contact_id === c.id ? 'selected' : ''}>\n            ${escapeHtml(c.name)}${c.organization ? ` (${escapeHtml(c.organization)})` : ''}${c.email ? ` - ${escapeHtml(c.email)}` : ''}\n          </option>\n        `).join('')}\n      </select>\n      <div class=\"form-hint\">Associate this team member with a project contact</div>\n      ${member.linked_contact ? `\n        <div class=\"linked-contact-info\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\n          </svg>\n          <span>Currently linked to: <strong>${escapeHtml(member.linked_contact.name)}</strong></span>\n        </div>\n      ` : ''}\n    </div>\n    \n    <div class=\"dialog-actions\">\n      <button class=\"btn-sota secondary\" id=\"cancel-role-edit\">Cancel</button>\n      <button class=\"btn-sota primary\" id=\"save-role-edit\">\n        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n        </svg>\n        Save Role\n      </button>\n    </div>\n  `;\n\n  // Create overlay\n  const overlay = createElement('div', { className: 'user-role-edit-overlay' });\n  \n  document.body.appendChild(overlay);\n  document.body.appendChild(dialog);\n\n  // Focus first input\n  const roleSelect = dialog.querySelector('#edit-user-role') as HTMLSelectElement;\n  const customInput = dialog.querySelector('#edit-user-role-custom') as HTMLInputElement;\n  const promptTextarea = dialog.querySelector('#edit-user-role-prompt') as HTMLTextAreaElement;\n  setTimeout(() => roleSelect?.focus(), 100);\n\n  // Handle role selection change\n  on(roleSelect, 'change', () => {\n    const selectedOption = roleSelect.options[roleSelect.selectedIndex];\n    const isCustom = roleSelect.value === '__custom__';\n    \n    // Show/hide custom input\n    customInput.style.display = isCustom ? 'block' : 'none';\n    if (isCustom) {\n      customInput.focus();\n    }\n    \n    // Auto-fill prompt from role template (always when selecting a predefined role)\n    if (!isCustom && selectedOption.dataset.prompt) {\n      promptTextarea.value = selectedOption.dataset.prompt;\n    }\n  });\n\n  // Cancel button\n  const cancelBtn = dialog.querySelector('#cancel-role-edit');\n  const closeDialog = () => {\n    overlay.remove();\n    dialog.remove();\n  };\n\n  on(cancelBtn as HTMLElement, 'click', closeDialog);\n  on(overlay, 'click', closeDialog);\n\n  // Save button\n  const saveBtn = dialog.querySelector('#save-role-edit');\n  on(saveBtn as HTMLElement, 'click', async () => {\n    const roleSelectValue = roleSelect.value;\n    const userRole = roleSelectValue === '__custom__' ? customInput.value.trim() : roleSelectValue;\n    const userRolePrompt = (dialog.querySelector('#edit-user-role-prompt') as HTMLTextAreaElement).value.trim();\n    const linkedContactId = (dialog.querySelector('#edit-linked-contact') as HTMLSelectElement).value || null;\n\n    try {\n      await http.put(`/api/projects/${projectId}/members/${member.user_id}`, {\n        user_role: userRole,\n        user_role_prompt: userRolePrompt,\n        linked_contact_id: linkedContactId,\n      });\n\n      // Update local state\n      const memberIndex = projectMembers.findIndex(m => m.user_id === member.user_id);\n      if (memberIndex !== -1) {\n        projectMembers[memberIndex].user_role = userRole;\n        projectMembers[memberIndex].user_role_prompt = userRolePrompt;\n        projectMembers[memberIndex].linked_contact_id = linkedContactId || undefined;\n        // Find linked contact info\n        if (linkedContactId) {\n          const contact = projectContacts.find(c => c.id === linkedContactId);\n          if (contact) {\n            projectMembers[memberIndex].linked_contact = {\n              id: contact.id,\n              name: contact.name,\n              email: contact.email,\n              organization: contact.organization,\n              role: contact.role,\n            };\n          }\n        } else {\n          projectMembers[memberIndex].linked_contact = undefined;\n        }\n      }\n\n      // Refresh list\n      const membersList = container.querySelector('#members-list');\n      if (membersList) {\n        membersList.innerHTML = renderMembersList();\n        bindMemberEvents(container);\n      }\n\n      toast.success('Project role updated');\n      closeDialog();\n    } catch {\n      toast.error('Failed to update role');\n    }\n  });\n\n  // Close on Escape\n  const handleEscape = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      closeDialog();\n      document.removeEventListener('keydown', handleEscape);\n    }\n  };\n  document.addEventListener('keydown', handleEscape);\n}\n\n// ==================== Helper Functions ====================\n\nasync function showInviteModal(): Promise<void> {\n  const { showInviteModal: showInvite } = await import('./InviteModal');\n  const projectId = currentProject?.id || currentProps.project?.id;\n  if (projectId) {\n    showInvite({\n      projectId,\n      onInvite: async () => {\n        // Refresh members list\n        try {\n          const res = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\n          projectMembers = res.data.members || [];\n          const membersList = document.querySelector('#members-list');\n          if (membersList) {\n            membersList.innerHTML = renderMembersList();\n            bindMemberEvents(membersList.closest('.project-card') as HTMLElement);\n          }\n        } catch {\n          // Ignore\n        }\n      },\n    });\n  }\n}\n\nasync function loadProjects(): Promise<void> {\n  try {\n    const response = await http.get<Array<{ id: string; name: string }>>('/api/projects');\n    dataStore.setProjects(response.data);\n  } catch {\n    // Silent fail\n  }\n}\n\nasync function loadProjectRoles(projectId: string): Promise<void> {\n  try {\n    const response = await http.get<{ roles: RoleTemplate[] }>('/api/role-templates');\n    projectRoles = response.data.roles || [];\n  } catch {\n    projectRoles = [];\n  }\n}\n\nfunction getInitials(name: string): string {\n  return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport function closeProjectModal(): void {\n  closeModal(MODAL_ID);\n}\n\nexport default showProjectModal;\n","/**\n * Project Selector Component\n * Dropdown for selecting and managing projects\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { appStore } from '../stores/app';\nimport { dataStore } from '../stores/data';\nimport { projects } from '../services/projects';\nimport { toast } from '../services/toast';\nimport { showProjectModal } from './modals/ProjectModal';\n\nexport interface ProjectSelectorOptions {\n  containerId?: string;\n  onProjectChange?: (projectId: string) => void;\n}\n\n/**\n * Initialize project selector\n */\nexport function initProjectSelector(options: ProjectSelectorOptions = {}): void {\n  const container = options.containerId \n    ? document.getElementById(options.containerId)\n    : document.getElementById('project-selector-container');\n\n  if (!container) return;\n\n  // Create selector HTML\n  container.innerHTML = `\n    <div class=\"project-selector-wrapper\">\n      <select id=\"project-selector\" class=\"project-selector\">\n        <option value=\"\">Select Project...</option>\n      </select>\n      <button id=\"new-project-btn\" class=\"btn-icon\" title=\"Create new project\">+</button>\n      <button id=\"edit-project-btn\" class=\"btn-icon\" title=\"Edit project\" style=\"display: none;\"></button>\n    </div>\n  `;\n\n  const selector = container.querySelector('#project-selector') as HTMLSelectElement;\n  const newBtn = container.querySelector('#new-project-btn') as HTMLButtonElement;\n  const editBtn = container.querySelector('#edit-project-btn') as HTMLButtonElement;\n\n  // Load and populate projects\n  loadProjectsIntoSelector(selector);\n\n  // Handle selection change\n  on(selector, 'change', async () => {\n    const projectId = selector.value;\n    if (projectId) {\n      await selectProject(projectId, options.onProjectChange);\n      editBtn.style.display = '';\n    } else {\n      editBtn.style.display = 'none';\n    }\n  });\n\n  // New project button\n  on(newBtn, 'click', () => {\n    showProjectModal({\n      mode: 'create',\n      onSave: async (project) => {\n        await loadProjectsIntoSelector(selector);\n        if (project.id) {\n          selector.value = project.id;\n          editBtn.style.display = '';\n          options.onProjectChange?.(project.id);\n        }\n      },\n    });\n  });\n\n  // Edit project button\n  on(editBtn, 'click', () => {\n    const currentProject = appStore.getState().currentProject;\n    if (currentProject) {\n      showProjectModal({\n        mode: 'edit',\n        project: currentProject,\n        onSave: async () => {\n          await loadProjectsIntoSelector(selector);\n        },\n        onDelete: async () => {\n          await loadProjectsIntoSelector(selector);\n          editBtn.style.display = 'none';\n        },\n      });\n    }\n  });\n\n  // Subscribe to store changes\n  dataStore.subscribe((state) => {\n    updateSelectorOptions(selector, state.projects);\n  });\n\n  appStore.subscribe((state) => {\n    if (state.currentProjectId && selector.value !== state.currentProjectId) {\n      selector.value = state.currentProjectId;\n      editBtn.style.display = '';\n    }\n  });\n}\n\n/**\n * Load projects into selector\n */\nasync function loadProjectsIntoSelector(selector: HTMLSelectElement): Promise<void> {\n  const projectList = await projects.getAll();\n  updateSelectorOptions(selector, projectList);\n\n  // Set current project if any\n  const currentProjectId = appStore.getState().currentProjectId;\n  if (currentProjectId) {\n    selector.value = currentProjectId;\n  }\n}\n\n/**\n * Update selector options\n */\nfunction updateSelectorOptions(\n  selector: HTMLSelectElement, \n  projectList: Array<{ id: string; name: string; isDefault?: boolean }>\n): void {\n  const currentValue = selector.value;\n  \n  selector.innerHTML = '<option value=\"\">Select Project...</option>';\n  \n  projectList.forEach(project => {\n    const option = document.createElement('option');\n    option.value = project.id;\n    option.textContent = project.name + (project.isDefault ? ' (default)' : '');\n    selector.appendChild(option);\n  });\n\n  // Restore selection if possible\n  if (currentValue && projectList.some(p => p.id === currentValue)) {\n    selector.value = currentValue;\n  }\n}\n\n/**\n * Select a project\n */\nasync function selectProject(\n  projectId: string, \n  onChange?: (projectId: string) => void\n): Promise<void> {\n  try {\n    const project = await projects.activate(projectId);\n    if (project) {\n      toast.success(`Switched to: ${project.name}`);\n      onChange?.(projectId);\n    }\n  } catch {\n    toast.error('Failed to switch project');\n  }\n}\n\n/**\n * Create standalone project selector element\n */\nexport function createProjectSelector(options: ProjectSelectorOptions = {}): HTMLElement {\n  const wrapper = createElement('div', { className: 'project-selector-wrapper' });\n  \n  const selector = createElement('select', { \n    className: 'project-selector',\n    id: 'project-selector',\n  }) as HTMLSelectElement;\n  \n  const defaultOption = createElement('option', { \n    textContent: 'Select Project...',\n  }) as HTMLOptionElement;\n  defaultOption.value = '';\n  selector.appendChild(defaultOption);\n\n  const newBtn = createElement('button', {\n    className: 'btn-icon',\n    textContent: '+',\n    title: 'Create new project',\n  });\n\n  wrapper.appendChild(selector);\n  wrapper.appendChild(newBtn);\n\n  // Load projects\n  projects.getAll().then(projectList => {\n    updateSelectorOptions(selector, projectList);\n    const currentProjectId = appStore.getState().currentProjectId;\n    if (currentProjectId) {\n      selector.value = currentProjectId;\n    }\n  });\n\n  // Bind events\n  on(selector, 'change', async () => {\n    const projectId = selector.value;\n    if (projectId) {\n      await selectProject(projectId, options.onProjectChange);\n    }\n  });\n\n  on(newBtn, 'click', () => {\n    showProjectModal({\n      mode: 'create',\n      onSave: async (project) => {\n        const projectList = await projects.getAll();\n        updateSelectorOptions(selector, projectList);\n        if (project.id) {\n          selector.value = project.id;\n          options.onProjectChange?.(project.id);\n        }\n      },\n    });\n  });\n\n  return wrapper;\n}\n\nexport default initProjectSelector;\n","/**\n * Format Utilities\n * Helper functions for formatting values\n */\n\n/**\n * Format number with thousand separators\n */\nexport function formatNumber(value: number, locale = 'en-US'): string {\n  return new Intl.NumberFormat(locale).format(value);\n}\n\n/**\n * Format date to locale string\n */\nexport function formatDate(date: string | Date, options?: Intl.DateTimeFormatOptions): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  return d.toLocaleDateString(undefined, options);\n}\n\n/**\n * Format date and time\n */\nexport function formatDateTime(date: string | Date): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  return d.toLocaleString();\n}\n\n/**\n * Format relative time (e.g., \"2 hours ago\", \"yesterday\", \"this week\")\n * \n * Returns human-friendly labels:\n * - \"just now\" for < 1 minute\n * - \"X minutes ago\" for < 1 hour\n * - \"X hours ago\" for same day\n * - \"yesterday\" for previous day\n * - \"X days ago\" for < 7 days\n * - \"this week\" for same week\n * - \"last week\" for previous week\n * - Full date for older\n */\nexport function formatRelativeTime(date: string | Date): string {\n  const d = typeof date === 'string' ? new Date(date) : date;\n  const now = new Date();\n  const diffMs = now.getTime() - d.getTime();\n  const diffSec = Math.floor(diffMs / 1000);\n  const diffMin = Math.floor(diffSec / 60);\n  const diffHour = Math.floor(diffMin / 60);\n  const diffDay = Math.floor(diffHour / 24);\n\n  // Future dates\n  if (diffMs < 0) {\n    const futureDays = Math.ceil(Math.abs(diffMs) / (1000 * 60 * 60 * 24));\n    if (futureDays === 0) return 'today';\n    if (futureDays === 1) return 'tomorrow';\n    if (futureDays < 7) return `in ${futureDays} days`;\n    return formatDate(d, { month: 'short', day: 'numeric' });\n  }\n\n  // Past dates\n  if (diffSec < 60) return 'just now';\n  if (diffMin < 60) return `${diffMin} min${diffMin === 1 ? '' : 's'} ago`;\n  if (diffHour < 24) return `${diffHour} hour${diffHour === 1 ? '' : 's'} ago`;\n\n  // Check if yesterday\n  const yesterday = new Date(now);\n  yesterday.setDate(yesterday.getDate() - 1);\n  if (isSameDay(d, yesterday)) return 'yesterday';\n\n  // Check if this week (same calendar week)\n  const startOfWeek = getStartOfWeek(now);\n  if (d >= startOfWeek) return 'this week';\n\n  // Check if last week\n  const startOfLastWeek = new Date(startOfWeek);\n  startOfLastWeek.setDate(startOfLastWeek.getDate() - 7);\n  if (d >= startOfLastWeek) return 'last week';\n\n  // Within 30 days\n  if (diffDay < 30) return `${diffDay} days ago`;\n\n  // Within this year\n  if (d.getFullYear() === now.getFullYear()) {\n    return formatDate(d, { month: 'short', day: 'numeric' });\n  }\n  \n  // Older\n  return formatDate(d, { year: 'numeric', month: 'short', day: 'numeric' });\n}\n\n/**\n * Check if two dates are the same calendar day\n */\nfunction isSameDay(d1: Date, d2: Date): boolean {\n  return d1.getFullYear() === d2.getFullYear() &&\n         d1.getMonth() === d2.getMonth() &&\n         d1.getDate() === d2.getDate();\n}\n\n/**\n * Get start of week (Sunday)\n */\nfunction getStartOfWeek(date: Date): Date {\n  const d = new Date(date);\n  const day = d.getDay();\n  d.setDate(d.getDate() - day);\n  d.setHours(0, 0, 0, 0);\n  return d;\n}\n\n/**\n * Format file size\n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 B';\n  \n  const units = ['B', 'KB', 'MB', 'GB', 'TB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\n  const size = bytes / Math.pow(1024, i);\n  \n  return `${size.toFixed(i > 0 ? 1 : 0)} ${units[i]}`;\n}\n\n/**\n * Format percentage\n */\nexport function formatPercent(value: number, decimals = 0): string {\n  return `${(value * 100).toFixed(decimals)}%`;\n}\n\n/**\n * Format currency\n */\nexport function formatCurrency(value: number, currency = 'USD', locale = 'en-US'): string {\n  return new Intl.NumberFormat(locale, {\n    style: 'currency',\n    currency,\n  }).format(value);\n}\n\n/**\n * Truncate text with ellipsis\n */\nexport function truncate(text: string, maxLength: number, suffix = '...'): string {\n  if (text.length <= maxLength) return text;\n  return text.slice(0, maxLength - suffix.length) + suffix;\n}\n\n/**\n * Capitalize first letter\n */\nexport function capitalize(text: string): string {\n  return text.charAt(0).toUpperCase() + text.slice(1);\n}\n\n/**\n * Convert to title case\n */\nexport function titleCase(text: string): string {\n  return text\n    .toLowerCase()\n    .split(' ')\n    .map(word => capitalize(word))\n    .join(' ');\n}\n\n/**\n * Convert to kebab-case\n */\nexport function kebabCase(text: string): string {\n  return text\n    .replace(/([a-z])([A-Z])/g, '$1-$2')\n    .replace(/[\\s_]+/g, '-')\n    .toLowerCase();\n}\n\n/**\n * Convert to camelCase\n */\nexport function camelCase(text: string): string {\n  return text\n    .replace(/[-_\\s]+(.)?/g, (_, c) => c ? c.toUpperCase() : '')\n    .replace(/^[A-Z]/, c => c.toLowerCase());\n}\n\n/**\n * Pluralize word based on count\n */\nexport function pluralize(count: number, singular: string, plural?: string): string {\n  return count === 1 ? singular : (plural || singular + 's');\n}\n\n/**\n * Format duration in seconds to human readable\n */\nexport function formatDuration(seconds: number): string {\n  if (seconds < 60) return `${seconds}s`;\n  if (seconds < 3600) {\n    const min = Math.floor(seconds / 60);\n    const sec = seconds % 60;\n    return sec > 0 ? `${min}m ${sec}s` : `${min}m`;\n  }\n  \n  const hours = Math.floor(seconds / 3600);\n  const min = Math.floor((seconds % 3600) / 60);\n  return min > 0 ? `${hours}h ${min}m` : `${hours}h`;\n}\n","/**\n * Dashboard Component\n * Main dashboard view with stats, health, trends, insights, and alerts\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { dataStore } from '../stores/data';\nimport { appStore } from '../stores/app';\nimport { formatNumber, formatPercent, formatRelativeTime } from '../utils/format';\nimport { dashboardService, DashboardData, HealthData, Insight, Alert, TrendMetric } from '../services/dashboard';\nimport { http } from '../services/api';\nimport { risksService } from '../services/risks';\n\nexport interface DashboardStats {\n  totalQuestions: number;\n  answeredQuestions: number;\n  totalRisks: number;\n  highPriorityRisks: number;\n  totalActions: number;\n  completedActions: number;\n  totalDecisions: number;\n  totalContacts: number;\n  healthScore: number;\n}\n\nexport interface DashboardProps {\n  onStatClick?: (statId: string) => void;\n  onAlertClick?: (alert: Alert) => void;\n  onInsightAction?: (insight: Insight) => void;\n}\n\n/**\n * Create dashboard element\n */\nexport function createDashboard(props: DashboardProps = {}): HTMLElement {\n  const dashboard = createElement('div', { className: 'dashboard' });\n\n  // Layout: Stats  Insights  Briefing  Bottom Row (Health + Charts)\n  dashboard.innerHTML = `\n    <!-- Row 1: Stats Cards -->\n    <div class=\"dashboard-row\">\n      <div id=\"dashboard-stats-grid\" class=\"stats-grid\"></div>\n    </div>\n\n    <!-- Row 2: Insights (horizontal) -->\n    <div id=\"dashboard-insights\" class=\"dashboard-insights-row\"></div>\n\n    <!-- Row 3: Alerts if any -->\n    <div id=\"dashboard-overdue\" class=\"dashboard-overdue-section\"></div>\n    <div id=\"dashboard-alerts\" class=\"dashboard-alerts-section\"></div>\n\n    <!-- Row 4: Daily Briefing (full width) -->\n    <div class=\"dashboard-briefing-section\" id=\"dashboard-briefing\"></div>\n\n    <!-- Row 5: Golden Hours (includes Team info) -->\n    <div id=\"dashboard-golden-hours\" class=\"dashboard-golden-hours-section\"></div>\n\n    <!-- Row 6: Charts (Questions priority, Facts by category, Trends) -->\n    <div class=\"dashboard-charts-row\">\n      <div id=\"questions-chart\" class=\"chart-container\"></div>\n      <div id=\"facts-chart\" class=\"chart-container\"></div>\n      <div id=\"trends-chart\" class=\"chart-container\"></div>\n    </div>\n\n    <!-- Row 7: Bottom - Health + Risk Summary -->\n    <div class=\"dashboard-bottom-row\">\n      <div id=\"dashboard-health\" class=\"dashboard-health-card\"></div>\n      <div id=\"risk-summary-container\" class=\"dashboard-risk-summary-card\"></div>\n    </div>\n  `;\n\n  // Load dashboard data\n  loadFullDashboard(dashboard, props);\n\n  return dashboard;\n}\n\n/**\n * Load full dashboard data from API\n */\nasync function loadFullDashboard(dashboard: HTMLElement, props: DashboardProps): Promise<void> {\n  const healthSection = dashboard.querySelector('#dashboard-health');\n  const briefingSection = dashboard.querySelector('#dashboard-briefing');\n  const statsGrid = dashboard.querySelector('#dashboard-stats-grid');\n  const overdueSection = dashboard.querySelector('#dashboard-overdue');\n  const alertsSection = dashboard.querySelector('#dashboard-alerts');\n  const insightsSection = dashboard.querySelector('#dashboard-insights');\n  const riskSummaryContainer = dashboard.querySelector('#risk-summary-container');\n  const goldenHoursSection = dashboard.querySelector('#dashboard-golden-hours');\n\n  // Check if project is selected\n  const currentProject = appStore.getState().currentProject;\n  const currentProjectId = appStore.getState().currentProjectId;\n  \n  if (!currentProject && !currentProjectId) {\n    // No project selected - show empty state\n    if (statsGrid) {\n      statsGrid.innerHTML = `\n        <div class=\"no-project-state\" style=\"\n          grid-column: 1 / -1;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          padding: 64px 24px;\n          text-align: center;\n          background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n          border-radius: 16px;\n          border: 2px dashed rgba(225,29,72,0.2);\n          min-height: 300px;\n        \">\n          <svg width=\"80\" height=\"80\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" style=\"color: #e11d48; margin-bottom: 20px; opacity: 0.6;\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n          </svg>\n          <h2 style=\"margin: 0 0 12px 0; font-size: 24px; font-weight: 700; color: var(--text-primary);\">No Project Selected</h2>\n          <p style=\"margin: 0 0 24px 0; font-size: 15px; color: var(--text-secondary); max-width: 450px; line-height: 1.6;\">\n            Select a project from the dropdown in the header to view your dashboard, or create a new project to get started.\n          </p>\n          <div style=\"display: flex; gap: 12px;\">\n            <button class=\"btn btn-primary create-project-btn\" style=\"\n              padding: 12px 28px;\n              font-size: 14px;\n              font-weight: 600;\n              display: inline-flex;\n              align-items: center;\n              gap: 8px;\n            \">\n              <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n              </svg>\n              Create New Project\n            </button>\n          </div>\n        </div>\n      `;\n      \n      // Bind create project button\n      const createBtn = statsGrid.querySelector('.create-project-btn');\n      if (createBtn) {\n        createBtn.addEventListener('click', async () => {\n          const { showProjectModal } = await import('./modals/ProjectModal');\n          showProjectModal({\n            mode: 'create',\n            onSave: () => {\n              // Trigger refresh\n              window.dispatchEvent(new CustomEvent('godmode:project-created'));\n            }\n          });\n        });\n      }\n    }\n    \n    // Hide other sections\n    if (healthSection) (healthSection as HTMLElement).innerHTML = '';\n    if (briefingSection) (briefingSection as HTMLElement).innerHTML = '';\n    if (overdueSection) (overdueSection as HTMLElement).innerHTML = '';\n    if (alertsSection) (alertsSection as HTMLElement).innerHTML = '';\n    if (insightsSection) (insightsSection as HTMLElement).innerHTML = '';\n    if (riskSummaryContainer) (riskSummaryContainer as HTMLElement).innerHTML = '';\n    if (goldenHoursSection) (goldenHoursSection as HTMLElement).innerHTML = '';\n    \n    return;\n  }\n\n  // Show loading state\n  if (statsGrid) {\n    statsGrid.innerHTML = '<div class=\"loading-placeholder\">Loading dashboard...</div>';\n  }\n\n  // Load Briefing Panel (async)\n  if (briefingSection && !briefingSection.hasChildNodes()) {\n    import('./BriefingPanel').then(({ createBriefingPanel }) => {\n      const briefingPanel = createBriefingPanel();\n      briefingSection.appendChild(briefingPanel);\n    }).catch(err => console.error('Failed to load BriefingPanel:', err));\n  }\n\n  try {\n    const { dashboard: data, health, insights, alerts } = await dashboardService.loadAll();\n\n    // Render health indicator\n    if (healthSection && health) {\n      renderHealthIndicator(healthSection as HTMLElement, health);\n    }\n\n    // Render stats\n    if (statsGrid && data) {\n      renderStatsGrid(statsGrid as HTMLElement, data, props.onStatClick);\n    }\n\n    // Render overdue actions alert\n    if (overdueSection && data && data.overdueActions > 0) {\n      renderOverdueActionsAlert(overdueSection as HTMLElement, data.overdueActions);\n    }\n\n    // Render alerts\n    if (alertsSection && alerts.length > 0) {\n      renderAlerts(alertsSection as HTMLElement, alerts, props.onAlertClick);\n    }\n\n    // Render insights\n    if (insightsSection && insights.length > 0) {\n      renderInsights(insightsSection as HTMLElement, insights, props.onInsightAction);\n    }\n\n    // Render charts\n    if (data) {\n      renderQuestionsPriorityChart(data);\n      renderFactsChart(data);\n      // Load trends asynchronously (don't block)\n      renderWeeklyTrendsChart(data).catch(err => \n        console.error('Failed to render trends chart:', err)\n      );\n    }\n\n    // Load Risk Summary with risks data (donut, bars, and 2D matrix)\n    if (riskSummaryContainer && !riskSummaryContainer.hasChildNodes()) {\n      risksService.getAll().then(risks => {\n        renderRiskSummary(riskSummaryContainer as HTMLElement, risks);\n      }).catch(err => console.error('Failed to load Risk Summary:', err));\n    }\n\n    // Load Golden Hours section (includes Team info)\n    if (goldenHoursSection && !goldenHoursSection.hasChildNodes()) {\n      const projectId = currentProjectId || currentProject?.id;\n      if (projectId) {\n        loadGoldenHours(goldenHoursSection as HTMLElement, projectId);\n      }\n    }\n  } catch (error) {\n    console.error('Failed to load dashboard:', error);\n    if (statsGrid) {\n      statsGrid.innerHTML = '<div class=\"error-message\">Failed to load dashboard data</div>';\n    }\n  }\n}\n\n/**\n * Render health indicator\n */\nfunction renderHealthIndicator(container: HTMLElement, health: HealthData): void {\n  // Handle missing or incomplete health data\n  if (!health || typeof health.status !== 'string') {\n    container.innerHTML = `\n      <div class=\"health-indicator unknown\">\n        <div class=\"health-gauge\">\n          <span class=\"score-value\">--</span>\n          <span class=\"score-label\">Health</span>\n        </div>\n        <p class=\"health-status\">Health data unavailable</p>\n      </div>\n    `;\n    return;\n  }\n\n  const statusClass = health.status.toLowerCase().replace(/\\s+/g, '-');\n  const score = health.score ?? 0;\n  const color = health.color || '#888';\n  const factors = health.factors || [];\n  \n  container.innerHTML = `\n    <div class=\"health-indicator ${statusClass}\">\n      <div class=\"health-gauge\">\n        <div class=\"health-score\" style=\"--score: ${score}%\">\n          <span class=\"score-value\">${score}</span>\n          <span class=\"score-label\">Health</span>\n        </div>\n        <div class=\"health-bar\">\n          <div class=\"health-fill\" style=\"width: ${score}%; background: ${color}\"></div>\n        </div>\n      </div>\n      <div class=\"health-status\">\n        <span class=\"status-text\" style=\"color: ${color}\">${health.status}</span>\n      </div>\n      <div class=\"health-factors\">\n        ${factors.slice(0, 3).map(f => `\n          <div class=\"factor ${f.type}\">\n            <span class=\"factor-icon\">${f.type === 'positive' ? '' : '!'}</span>\n            <span class=\"factor-text\">${f.factor}</span>\n          </div>\n        `).join('')}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render stats grid\n */\nfunction renderStatsGrid(container: HTMLElement, data: DashboardData, onClick?: (statId: string) => void): void {\n  // Safe access to nested properties with defaults\n  const docs = data.documents || { total: 0, processed: 0, pending: 0 };\n  const qPriority = data.questionsByPriority || { critical: 0, high: 0, medium: 0, resolved: 0 };\n  const rImpact = data.risksByImpact || { high: 0, medium: 0, low: 0 };\n\n  const factsVerified = data.factsVerifiedCount ?? 0;\n  const stats = [\n    { id: 'facts', label: 'Facts', value: data.totalFacts ?? 0, sub: factsVerified > 0 ? `${factsVerified} verified` : undefined, icon: '' },\n    { id: 'questions', label: 'Questions', value: data.totalQuestions ?? 0, sub: `${qPriority.resolved} resolved`, icon: '' },\n    { id: 'decisions', label: 'Decisions', value: data.totalDecisions ?? 0, icon: '' },\n    { id: 'risks', label: 'Risks', value: data.totalRisks ?? 0, sub: `${rImpact.high} high`, icon: '' },\n    { id: 'actions', label: 'Actions', value: data.totalActions ?? 0, sub: `${data.overdueActions ?? 0} overdue`, icon: '' },\n  ];\n\n  container.innerHTML = stats.map(stat => `\n    <div class=\"stat-card\" data-stat-id=\"${stat.id}\">\n      <div class=\"stat-value\">${stat.value}</div>\n      <div class=\"stat-label\">${stat.label}</div>\n      ${stat.sub ? `<div class=\"stat-sub\">${stat.sub}</div>` : ''}\n    </div>\n  `).join('');\n\n  // Bind click events\n  if (onClick) {\n    container.querySelectorAll('.stat-card[data-stat-id]').forEach(card => {\n      card.addEventListener('click', () => {\n        const statId = card.getAttribute('data-stat-id');\n        if (statId) onClick(statId);\n      });\n    });\n  }\n}\n\n/**\n * Render alerts\n */\nfunction renderAlerts(container: HTMLElement, alerts: Alert[], onClick?: (alert: Alert) => void): void {\n  container.innerHTML = `\n    <div class=\"alerts-header\">\n      <h3>Alerts</h3>\n      <span class=\"alerts-count\">${alerts.length}</span>\n    </div>\n    <div class=\"alerts-list\">\n      ${alerts.slice(0, 5).map((alert, i) => `\n        <div class=\"alert-item ${alert.severity}\" data-alert-index=\"${i}\">\n          <span class=\"alert-icon\">${getAlertIcon(alert.severity)}</span>\n          <div class=\"alert-content\">\n            <div class=\"alert-title\">${alert.title}</div>\n            <div class=\"alert-message\">${alert.message}</div>\n          </div>\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind click events\n  if (onClick) {\n    container.querySelectorAll('.alert-item').forEach(item => {\n      item.addEventListener('click', () => {\n        const index = parseInt(item.getAttribute('data-alert-index') || '0', 10);\n        onClick(alerts[index]);\n      });\n    });\n  }\n}\n\n/**\n * Render insights\n */\nfunction renderInsights(container: HTMLElement, insights: Insight[], onAction?: (insight: Insight) => void): void {\n  // Render insights directly as horizontal cards\n  container.innerHTML = insights.slice(0, 4).map((insight, i) => `\n    <div class=\"insight-item ${insight.type}\" data-insight-index=\"${i}\">\n      <span class=\"insight-icon\">${insight.icon}</span>\n      <div class=\"insight-content\">\n        <div class=\"insight-title\">${insight.title}</div>\n        <div class=\"insight-message\">${insight.message}</div>\n      </div>\n    </div>\n  `).join('');\n}\n\n/**\n * Render Risk Summary Chart (compact donut + bars)\n */\nfunction renderRiskSummary(container: HTMLElement, risks: Array<{ impact?: string; likelihood?: string; status?: string }>): void {\n  // Count risks by severity\n  const getSeverity = (impact?: string, likelihood?: string): string => {\n    const impactLevel = ['low', 'medium', 'high', 'critical'].indexOf(impact?.toLowerCase() || 'low');\n    const likelihoodLevel = ['low', 'medium', 'high'].indexOf(likelihood?.toLowerCase() || 'low');\n    const score = impactLevel + likelihoodLevel;\n    if (score >= 4) return 'critical';\n    if (score >= 3) return 'high';\n    if (score >= 2) return 'medium';\n    return 'low';\n  };\n\n  const activeRisks = risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed');\n  const counts = { critical: 0, high: 0, medium: 0, low: 0 };\n  \n  activeRisks.forEach(risk => {\n    const severity = getSeverity(risk.impact, risk.likelihood);\n    counts[severity as keyof typeof counts]++;\n  });\n\n  const total = activeRisks.length;\n  const mitigated = risks.length - activeRisks.length;\n\n  // Calculate percentages for donut\n  const getPercent = (count: number) => total > 0 ? Math.round((count / total) * 100) : 0;\n  \n  // Create conic gradient for donut\n  let conicStops = '';\n  let currentDeg = 0;\n  \n  const colors = {\n    critical: '#ef4444',\n    high: '#f97316', \n    medium: '#eab308',\n    low: '#22c55e'\n  };\n\n  (['critical', 'high', 'medium', 'low'] as const).forEach(level => {\n    const percent = getPercent(counts[level]);\n    const degrees = (percent / 100) * 360;\n    if (degrees > 0) {\n      conicStops += `${colors[level]} ${currentDeg}deg ${currentDeg + degrees}deg, `;\n      currentDeg += degrees;\n    }\n  });\n\n  // Default to gray if no risks\n  if (!conicStops) {\n    conicStops = 'var(--color-border) 0deg 360deg';\n  } else {\n    conicStops = conicStops.slice(0, -2); // Remove trailing comma\n  }\n\n  container.innerHTML = `\n    <div class=\"risk-summary\">\n      <div class=\"risk-summary-header\">\n        <h4>Risk Overview</h4>\n        <span class=\"risk-total\">${total} active</span>\n      </div>\n      \n      <div class=\"risk-summary-content\">\n        <div class=\"risk-donut-container\">\n          <div class=\"risk-donut\" style=\"background: conic-gradient(${conicStops})\">\n            <div class=\"risk-donut-center\">\n              <span class=\"donut-value\">${total}</span>\n              <span class=\"donut-label\">Risks</span>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"risk-bars\">\n          <div class=\"risk-bar-item critical\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">Critical</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.critical)}%\"></div></div>\n            <span class=\"bar-count\">${counts.critical}</span>\n          </div>\n          <div class=\"risk-bar-item high\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">High</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.high)}%\"></div></div>\n            <span class=\"bar-count\">${counts.high}</span>\n          </div>\n          <div class=\"risk-bar-item medium\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">Medium</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.medium)}%\"></div></div>\n            <span class=\"bar-count\">${counts.medium}</span>\n          </div>\n          <div class=\"risk-bar-item low\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">Low</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.low)}%\"></div></div>\n            <span class=\"bar-count\">${counts.low}</span>\n          </div>\n        </div>\n      </div>\n      \n      ${mitigated > 0 ? `\n        <div class=\"risk-mitigated\">\n          <span class=\"mitigated-icon\"></span>\n          <span>${mitigated} risk${mitigated > 1 ? 's' : ''} mitigated</span>\n        </div>\n      ` : ''}\n    </div>\n  `;\n}\n\n/**\n * Render facts by category chart\n */\nfunction renderFactsChart(data: DashboardData): void {\n  const container = document.getElementById('facts-chart');\n  if (!container) return;\n\n  const byCat = data.factsByCategory || {};\n  const categories = ['technical', 'process', 'policy', 'people', 'timeline', 'general'] as const;\n  const total = categories.reduce((sum, c) => sum + (byCat[c] ?? 0), 0);\n\n  if (total === 0) {\n    container.innerHTML = '<div class=\"empty-chart\">No facts yet</div>';\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"facts-chart-title\">Facts by category</div>\n    <div class=\"priority-bars\">\n      ${categories.map(cat => {\n        const count = byCat[cat] ?? 0;\n        const pct = total > 0 ? (count / total) * 100 : 0;\n        return `\n        <div class=\"priority-bar\">\n          <div class=\"bar-label\">${cat}</div>\n          <div class=\"bar-track\">\n            <div class=\"bar-fill\" style=\"width: ${pct}%\"></div>\n          </div>\n          <div class=\"bar-value\">${count}</div>\n        </div>`;\n      }).join('')}\n    </div>\n  `;\n}\n\n/**\n * Render questions by priority chart\n */\nfunction renderQuestionsPriorityChart(data: DashboardData): void {\n  const container = document.getElementById('questions-chart');\n  if (!container) return;\n\n  const { critical, high, medium, resolved } = data.questionsByPriority;\n  const total = critical + high + medium + resolved;\n  \n  if (total === 0) {\n    container.innerHTML = '<div class=\"empty-chart\">No questions yet</div>';\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"priority-bars\">\n      <div class=\"priority-bar\">\n        <div class=\"bar-label\">Critical</div>\n        <div class=\"bar-track\">\n          <div class=\"bar-fill critical\" style=\"width: ${(critical / total) * 100}%\"></div>\n        </div>\n        <div class=\"bar-value\">${critical}</div>\n      </div>\n      <div class=\"priority-bar\">\n        <div class=\"bar-label\">High</div>\n        <div class=\"bar-track\">\n          <div class=\"bar-fill high\" style=\"width: ${(high / total) * 100}%\"></div>\n        </div>\n        <div class=\"bar-value\">${high}</div>\n      </div>\n      <div class=\"priority-bar\">\n        <div class=\"bar-label\">Medium</div>\n        <div class=\"bar-track\">\n          <div class=\"bar-fill medium\" style=\"width: ${(medium / total) * 100}%\"></div>\n        </div>\n        <div class=\"bar-value\">${medium}</div>\n      </div>\n      <div class=\"priority-bar\">\n        <div class=\"bar-label\">Resolved</div>\n        <div class=\"bar-track\">\n          <div class=\"bar-fill resolved\" style=\"width: ${(resolved / total) * 100}%\"></div>\n        </div>\n        <div class=\"bar-value\">${resolved}</div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render weekly trends chart with real API data\n */\nasync function renderWeeklyTrendsChart(data: DashboardData): Promise<void> {\n  const container = document.getElementById('trends-chart');\n  if (!container) return;\n\n  // Show loading state\n  container.innerHTML = '<div class=\"loading\">Loading trends...</div>';\n\n  try {\n    // Fetch real trends data from API\n    const trendsData = await dashboardService.getTrends(7);\n    \n    if (!trendsData || !trendsData.history || trendsData.history.length === 0) {\n      container.innerHTML = '<div class=\"empty-chart\">No trend data available yet</div>';\n      return;\n    }\n\n    // Use real history data\n    const history = trendsData.history;\n    \n    // Build arrays from history\n    const days: string[] = [];\n    const trends = {\n      facts: [] as number[],\n      questions: [] as number[],\n      risks: [] as number[],\n      actions: [] as number[],\n    };\n\n    history.forEach(entry => {\n      const d = new Date(entry.date);\n      days.push(d.toLocaleDateString(undefined, { weekday: 'short' }));\n      trends.facts.push(entry.facts || 0);\n      trends.questions.push(entry.questions || 0);\n      trends.risks.push(entry.risks || 0);\n      trends.actions.push(entry.actions || 0);\n    });\n\n    const maxValue = Math.max(\n      ...trends.facts, \n      ...trends.questions, \n      ...trends.risks, \n      ...trends.actions, \n      1\n    );\n\n    container.innerHTML = `\n      <div class=\"trends-chart\">\n        <div class=\"trends-legend\">\n          <span class=\"legend-item\"><span class=\"legend-dot facts\"></span>Facts</span>\n          <span class=\"legend-item\"><span class=\"legend-dot questions\"></span>Questions</span>\n          <span class=\"legend-item\"><span class=\"legend-dot risks\"></span>Risks</span>\n          <span class=\"legend-item\"><span class=\"legend-dot actions\"></span>Actions</span>\n        </div>\n        <div class=\"trends-bars\">\n          ${days.map((day, i) => `\n            <div class=\"trend-column\">\n              <div class=\"trend-bars-group\">\n                <div class=\"trend-bar facts\" style=\"height: ${(trends.facts[i] / maxValue) * 100}%\" title=\"Facts: ${trends.facts[i]}\"></div>\n                <div class=\"trend-bar questions\" style=\"height: ${(trends.questions[i] / maxValue) * 100}%\" title=\"Questions: ${trends.questions[i]}\"></div>\n                <div class=\"trend-bar risks\" style=\"height: ${(trends.risks[i] / maxValue) * 100}%\" title=\"Risks: ${trends.risks[i]}\"></div>\n                <div class=\"trend-bar actions\" style=\"height: ${(trends.actions[i] / maxValue) * 100}%\" title=\"Actions: ${trends.actions[i]}\"></div>\n              </div>\n              <div class=\"trend-label\">${day}</div>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    `;\n  } catch (error) {\n    console.error('Failed to load trends:', error);\n    container.innerHTML = '<div class=\"error\">Failed to load trend data</div>';\n  }\n}\n\n/**\n * Render overdue actions alert\n */\nfunction renderOverdueActionsAlert(container: HTMLElement, overdueCount: number): void {\n  if (overdueCount === 0) {\n    container.innerHTML = '';\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"overdue-alert\">\n      <div class=\"overdue-icon\"></div>\n      <div class=\"overdue-content\">\n        <strong>${overdueCount} Overdue Action${overdueCount !== 1 ? 's' : ''}</strong>\n        <span>Action items past their due date require immediate attention</span>\n      </div>\n      <button class=\"btn btn-sm btn-warning\" id=\"view-overdue-btn\">View Actions</button>\n    </div>\n  `;\n\n  // Bind view button\n  const viewBtn = container.querySelector('#view-overdue-btn');\n  if (viewBtn) {\n    viewBtn.addEventListener('click', () => {\n      // Navigate to actions tab with overdue filter\n      window.dispatchEvent(new CustomEvent('godmode:navigate', { \n        detail: { tab: 'sot', view: 'actions', filter: 'overdue' }\n      }));\n    });\n  }\n}\n\n/**\n * Get alert icon based on severity\n */\nfunction getAlertIcon(severity: string): string {\n  switch (severity) {\n    case 'critical': return '';\n    case 'high': return '';\n    case 'warning': return '';\n    default: return '';\n  }\n}\n\n/**\n * Create a stat card element\n */\nfunction createStatCard(\n  config: {\n    id: string;\n    label: string;\n    icon: string;\n    getValue: (s: DashboardStats) => string | number;\n    subValue?: (s: DashboardStats) => string;\n    isScore?: boolean;\n  },\n  onClick?: (statId: string) => void\n): HTMLElement {\n  const card = createElement('div', {\n    className: `stat-item ${onClick ? 'clickable' : ''}`,\n  });\n  card.setAttribute('data-stat-id', config.id);\n\n  if (onClick) {\n    on(card, 'click', () => onClick(config.id));\n  }\n\n  card.innerHTML = `\n    <div class=\"stat-icon\">${config.icon}</div>\n    <div class=\"value\" data-value>-</div>\n    <div class=\"label\">${config.label}</div>\n    ${config.subValue ? '<div class=\"sub-value\" data-sub-value></div>' : ''}\n  `;\n\n  return card;\n}\n\n/**\n * Update dashboard with current data\n */\nfunction updateDashboard(\n  statsGrid: HTMLElement,\n  statConfigs: Array<{\n    id: string;\n    getValue: (s: DashboardStats) => string | number;\n    subValue?: (s: DashboardStats) => string;\n    isScore?: boolean;\n  }>\n): void {\n  const data = dataStore.getState();\n\n  // Only count active questions (not dismissed/resolved/closed)\n  const activeQuestions = data.questions.filter(q => \n    q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'closed' && q.status !== 'answered'\n  );\n  \n  const stats: DashboardStats = {\n    totalQuestions: activeQuestions.length,\n    answeredQuestions: data.questions.filter(q => q.status === 'answered' || q.status === 'resolved').length,\n    totalRisks: data.risks.length,\n    highPriorityRisks: data.risks.filter(r => r.impact === 'high').length,\n    totalActions: data.actions.length,\n    completedActions: data.actions.filter(a => a.status === 'completed').length,\n    totalDecisions: data.decisions.length,\n    totalContacts: data.contacts.length,\n    healthScore: calculateHealthScore(data),\n  };\n\n  statConfigs.forEach(config => {\n    const card = statsGrid.querySelector(`[data-stat-id=\"${config.id}\"]`);\n    if (!card) return;\n\n    const valueEl = card.querySelector('[data-value]');\n    const subValueEl = card.querySelector('[data-sub-value]');\n\n    if (valueEl) {\n      const value = config.getValue(stats);\n      valueEl.textContent = typeof value === 'number' ? formatNumber(value) : value;\n\n      // Add color for health score\n      if (config.isScore && typeof value === 'number') {\n        valueEl.className = 'value ' + getHealthClass(value);\n      }\n    }\n\n    if (subValueEl && config.subValue) {\n      subValueEl.textContent = config.subValue(stats);\n    }\n  });\n}\n\n/**\n * Calculate health score from data\n */\nfunction calculateHealthScore(data: ReturnType<typeof dataStore.getState>): number {\n  const weights = {\n    questionsAnswered: 25,\n    risksManaged: 25,\n    actionsCompleted: 25,\n    decisionsProgress: 25,\n  };\n\n  let score = 0;\n\n  // Questions answered\n  if (data.questions.length > 0) {\n    const answered = data.questions.filter(q => q.status === 'answered').length;\n    score += (answered / data.questions.length) * weights.questionsAnswered;\n  } else {\n    score += weights.questionsAnswered;\n  }\n\n  // Risks managed\n  if (data.risks.length > 0) {\n    const managed = data.risks.filter(r => r.status !== 'open').length;\n    score += (managed / data.risks.length) * weights.risksManaged;\n  } else {\n    score += weights.risksManaged;\n  }\n\n  // Actions completed\n  if (data.actions.length > 0) {\n    const completed = data.actions.filter(a => a.status === 'completed').length;\n    score += (completed / data.actions.length) * weights.actionsCompleted;\n  } else {\n    score += weights.actionsCompleted;\n  }\n\n  // Decisions made\n  if (data.decisions.length > 0) {\n    const approved = data.decisions.filter(d => d.status === 'approved').length;\n    score += (approved / data.decisions.length) * weights.decisionsProgress;\n  } else {\n    score += weights.decisionsProgress;\n  }\n\n  return Math.round(score);\n}\n\n/**\n * Get CSS class for health score\n */\nfunction getHealthClass(score: number): string {\n  if (score >= 80) return 'excellent';\n  if (score >= 60) return 'good';\n  if (score >= 40) return 'warning';\n  return 'critical';\n}\n\n/**\n * Load and render project team section\n */\nasync function loadProjectTeam(container: HTMLElement, projectId: string): Promise<void> {\n  try {\n    const response = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\n    const members = response.data?.members || [];\n    \n    if (members.length === 0) {\n      container.innerHTML = '';\n      return;\n    }\n\n    container.innerHTML = `\n      <style>\n        .team-section {\n          background: var(--bg-primary);\n          border-radius: 16px;\n          padding: 24px;\n          border: 1px solid var(--border-color);\n        }\n        \n        .team-section-header {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          margin-bottom: 20px;\n        }\n        \n        .team-section-header h3 {\n          margin: 0;\n          font-size: 18px;\n          font-weight: 600;\n          color: var(--text-primary);\n          display: flex;\n          align-items: center;\n          gap: 10px;\n        }\n        \n        .team-section-header h3 svg {\n          color: #e11d48;\n        }\n        \n        .team-section-header .member-count {\n          background: linear-gradient(135deg, #e11d48, #be123c);\n          color: white;\n          padding: 4px 10px;\n          border-radius: 20px;\n          font-size: 12px;\n          font-weight: 600;\n        }\n        \n        .team-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n          gap: 16px;\n        }\n        \n        .team-member-card {\n          background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.4) 100%);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          padding: 16px;\n          display: flex;\n          align-items: center;\n          gap: 14px;\n          transition: all 0.2s ease;\n        }\n        \n        [data-theme=\"dark\"] .team-member-card {\n          background: linear-gradient(135deg, rgba(30,41,59,0.8) 0%, rgba(30,41,59,0.4) 100%);\n        }\n        \n        .team-member-card:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 8px 24px rgba(0,0,0,0.08);\n          border-color: rgba(225,29,72,0.3);\n        }\n        \n        .team-member-avatar {\n          width: 52px;\n          height: 52px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #e11d48, #be123c);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-weight: 600;\n          font-size: 18px;\n          color: white;\n          flex-shrink: 0;\n          overflow: hidden;\n        }\n        \n        .team-member-avatar img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        }\n        \n        .team-member-avatar.owner {\n          background: linear-gradient(135deg, #f59e0b, #d97706);\n        }\n        \n        .team-member-info {\n          flex: 1;\n          min-width: 0;\n        }\n        \n        .team-member-info h4 {\n          margin: 0 0 4px 0;\n          font-size: 15px;\n          font-weight: 600;\n          color: var(--text-primary);\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .team-member-info .role-badge {\n          display: inline-flex;\n          align-items: center;\n          gap: 4px;\n          padding: 3px 8px;\n          border-radius: 6px;\n          font-size: 11px;\n          font-weight: 600;\n          background: rgba(225,29,72,0.1);\n          color: #e11d48;\n          margin-bottom: 4px;\n        }\n        \n        .team-member-info .role-badge.owner {\n          background: rgba(245,158,11,0.15);\n          color: #d97706;\n        }\n        \n        .team-member-info .role-badge.admin {\n          background: rgba(59,130,246,0.1);\n          color: #3b82f6;\n        }\n        \n        .team-member-info .user-role {\n          font-size: 13px;\n          color: var(--text-secondary);\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .team-member-info .linked-contact {\n          font-size: 11px;\n          color: #e11d48;\n          display: flex;\n          align-items: center;\n          gap: 4px;\n          margin-top: 4px;\n        }\n        \n        .team-member-info .linked-contact svg {\n          width: 12px;\n          height: 12px;\n        }\n      </style>\n      \n      <div class=\"team-section\">\n        <div class=\"team-section-header\">\n          <h3>\n            <svg width=\"22\" height=\"22\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n            </svg>\n            Project Team\n          </h3>\n          <span class=\"member-count\">${members.length} member${members.length !== 1 ? 's' : ''}</span>\n        </div>\n        \n        <div class=\"team-grid\">\n          ${members.map(member => {\n            const isOwner = member.role === 'owner';\n            const isAdmin = member.role === 'admin';\n            const initials = getInitials(member.display_name || member.username || member.email || '?');\n            // Use linked contact avatar if member doesn't have one\n            const avatarUrl = member.avatar_url || member.linked_contact?.avatar_url || member.linked_contact?.photo_url;\n            \n            return `\n              <div class=\"team-member-card\">\n                <div class=\"team-member-avatar ${isOwner ? 'owner' : ''}\">\n                  ${avatarUrl \n                    ? `<img src=\"${escapeHtml(avatarUrl)}\" alt=\"${escapeHtml(member.display_name || '')}\">`\n                    : initials\n                  }\n                </div>\n                <div class=\"team-member-info\">\n                  <h4>${escapeHtml(member.display_name || member.username || member.email || 'Unknown')}</h4>\n                  <span class=\"role-badge ${isOwner ? 'owner' : isAdmin ? 'admin' : ''}\">\n                    ${isOwner ? ' Owner' : isAdmin ? 'Admin' : member.role === 'write' ? 'Write' : 'Read'}\n                  </span>\n                  ${member.user_role ? `<div class=\"user-role\">${escapeHtml(member.user_role)}</div>` : ''}\n                  ${member.linked_contact ? `\n                    <div class=\"linked-contact\">\n                      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\n                      </svg>\n                      ${escapeHtml(member.linked_contact.name)}\n                    </div>\n                  ` : ''}\n                </div>\n              </div>\n            `;\n          }).join('')}\n        </div>\n      </div>\n    `;\n  } catch (error) {\n    console.error('Failed to load project team:', error);\n  }\n}\n\n// Types for team section\ninterface ProjectMember {\n  user_id: string;\n  role: string;\n  user_role?: string;\n  user_role_prompt?: string;\n  linked_contact_id?: string;\n  linked_contact?: {\n    id: string;\n    name: string;\n    email?: string;\n    organization?: string;\n    avatar_url?: string;\n    photo_url?: string;\n    timezone?: string;\n  };\n  username?: string;\n  display_name?: string;\n  avatar_url?: string;\n  email?: string;\n  timezone?: string;\n}\n\ninterface TimezoneEntry {\n  name: string;\n  timezone: string;\n  type: 'member' | 'contact';\n  avatarUrl?: string;\n  localTime?: string;\n  localHour?: number;\n  isOnline?: boolean;\n  role?: string;\n  linkedContactId?: string; // For deduplication\n  contactId?: string; // For contacts\n}\n\n/**\n * Get local time info for a timezone\n */\nfunction getLocalTimeInfo(timezone: string): { localTime: string; localHour: number; isOnline: boolean } {\n  try {\n    const now = new Date();\n    const formatter = new Intl.DateTimeFormat('en-GB', {\n      timeZone: timezone,\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false,\n    });\n    const localTime = formatter.format(now);\n    const localHour = parseInt(localTime.split(':')[0], 10);\n    // Consider online if between 8:00 and 18:00\n    const isOnline = localHour >= 8 && localHour < 18;\n    return { localTime, localHour, isOnline };\n  } catch {\n    return { localTime: '--:--', localHour: 12, isOnline: false };\n  }\n}\n\n/**\n * Find best meeting times for all participants\n */\nfunction findBestMeetingTimes(entries: TimezoneEntry[]): { time: string; score: number; available: number }[] {\n  if (entries.length === 0) return [];\n\n  const suggestions: { time: string; score: number; available: number }[] = [];\n  const now = new Date();\n\n  // Check each hour of the day\n  for (let hour = 0; hour < 24; hour++) {\n    let available = 0;\n    let totalScore = 0;\n\n    for (const entry of entries) {\n      try {\n        const formatter = new Intl.DateTimeFormat('en-US', {\n          timeZone: entry.timezone,\n          hour: 'numeric',\n          hour12: false,\n        });\n        const localHour = parseInt(formatter.format(now), 10);\n        const utcHour = now.getUTCHours();\n        let offset = localHour - utcHour;\n        if (offset > 12) offset -= 24;\n        if (offset < -12) offset += 24;\n\n        // What hour would it be for this person?\n        const theirHour = (hour + offset + 24) % 24;\n\n        // Score based on how \"comfortable\" the hour is\n        if (theirHour >= 9 && theirHour <= 17) {\n          available++;\n          // Peak hours (10-12, 14-16) get higher score\n          if (theirHour >= 10 && theirHour <= 12) totalScore += 10;\n          else if (theirHour >= 14 && theirHour <= 16) totalScore += 10;\n          else totalScore += 7;\n        } else if (theirHour >= 8 && theirHour <= 18) {\n          available++;\n          totalScore += 4;\n        }\n      } catch { /* ignore */ }\n    }\n\n    if (available > 0) {\n      suggestions.push({\n        time: `${hour.toString().padStart(2, '0')}:00 UTC`,\n        score: totalScore,\n        available,\n      });\n    }\n  }\n\n  // Sort by number available (desc), then by score (desc)\n  suggestions.sort((a, b) => {\n    if (b.available !== a.available) return b.available - a.available;\n    return b.score - a.score;\n  });\n\n  return suggestions.slice(0, 3); // Top 3 suggestions\n}\n\n/**\n * Load Golden Hours section\n * Shows working hours overlap for team members and contacts\n */\nasync function loadGoldenHours(container: HTMLElement, projectId: string): Promise<void> {\n  try {\n    // Fetch team members and contacts in parallel\n    const [membersRes, contactsRes] = await Promise.all([\n      http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`).catch(() => ({ data: { members: [] } })),\n      http.get<{ contacts: { name: string; timezone?: string; avatarUrl?: string; photoUrl?: string; photo_url?: string; avatar_url?: string }[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\n    ]);\n\n    const members = membersRes.data?.members || [];\n    const contacts = contactsRes.data?.contacts || [];\n\n    // Extract timezone entries - use linked contact data if member doesn't have one\n    // Also track linked_contact_id for deduplication\n    const linkedContactIds = new Set<string>();\n    \n    const memberEntries = members\n      .map(m => {\n        // Check if member has linked contact with timezone and role\n        const linkedContact = m.linked_contact as { id?: string; timezone?: string; avatar_url?: string; photo_url?: string; role?: string } | undefined;\n        const tz = m.timezone || linkedContact?.timezone;\n        if (!tz) return null;\n        \n        const timeInfo = getLocalTimeInfo(tz);\n        // Use linked contact avatar if member doesn't have one\n        const avatarUrl = m.avatar_url || linkedContact?.avatar_url || linkedContact?.photo_url;\n        // Use user_role or linked contact role\n        const role = m.user_role || linkedContact?.role || (m.role === 'owner' ? 'Owner' : m.role === 'admin' ? 'Admin' : undefined);\n        \n        // Track linked contact id for deduplication\n        const linkedContactId = m.linked_contact_id || linkedContact?.id;\n        if (linkedContactId) {\n          linkedContactIds.add(linkedContactId);\n        }\n        \n        return {\n          name: m.display_name || m.username || m.email || 'Unknown',\n          timezone: tz,\n          type: 'member' as const,\n          avatarUrl,\n          role,\n          linkedContactId,\n          ...timeInfo,\n        } as TimezoneEntry;\n      })\n      .filter((m): m is TimezoneEntry => m !== null);\n\n    const contactEntries: TimezoneEntry[] = contacts\n      .filter(c => c.timezone)\n      .map(c => {\n        const timeInfo = getLocalTimeInfo(c.timezone || 'UTC');\n        const contactId = (c as { id?: string }).id;\n        return {\n          name: c.name,\n          timezone: c.timezone || 'UTC',\n          type: 'contact' as const,\n          avatarUrl: c.avatarUrl || c.photoUrl || c.photo_url || c.avatar_url,\n          role: (c as { role?: string }).role,\n          contactId,\n          ...timeInfo,\n        };\n      });\n\n    // If no timezone data, don't show the section\n    if (memberEntries.length === 0 && contactEntries.length === 0) {\n      container.innerHTML = '';\n      return;\n    }\n\n    // Calculate golden hours for each group\n    const memberGolden = calculateGoldenHours(memberEntries);\n    const contactGolden = calculateGoldenHours(contactEntries);\n    \n    // For combined view, deduplicate: remove contacts that are already represented by team members\n    const deduplicatedContactEntries = contactEntries.filter(c => !c.contactId || !linkedContactIds.has(c.contactId));\n    const allEntries = [...memberEntries, ...deduplicatedContactEntries];\n    const allGolden = calculateGoldenHours(allEntries);\n    \n    // Find best meeting times\n    const meetingSuggestions = findBestMeetingTimes(allEntries);\n    \n    // Count online people\n    const onlineMembers = memberEntries.filter(m => m.isOnline).length;\n    const onlineContacts = contactEntries.filter(c => c.isOnline).length;\n    const onlineDeduplicatedContacts = deduplicatedContactEntries.filter(c => c.isOnline).length;\n    const onlineAll = onlineMembers + onlineDeduplicatedContacts;\n\n    container.innerHTML = `\n      <style>\n        .golden-hours-section {\n          background: var(--bg-primary);\n          border-radius: 16px;\n          padding: 24px;\n          border: 1px solid var(--border-color);\n          margin-bottom: 24px;\n        }\n        \n        .golden-hours-header {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          margin-bottom: 24px;\n        }\n        \n        .golden-hours-header h3 {\n          margin: 0;\n          font-size: 18px;\n          font-weight: 600;\n          color: var(--text-primary);\n          display: flex;\n          align-items: center;\n          gap: 10px;\n        }\n        \n        .golden-hours-header h3 svg {\n          color: #f59e0b;\n        }\n        \n        .golden-hours-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));\n          gap: 20px;\n        }\n        \n        .golden-card {\n          background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,250,252,0.9) 100%);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          padding: 20px;\n        }\n        \n        [data-theme=\"dark\"] .golden-card {\n          background: linear-gradient(135deg, rgba(30,41,59,0.9) 0%, rgba(30,41,59,0.6) 100%);\n        }\n        \n        .golden-card h4 {\n          margin: 0 0 16px 0;\n          font-size: 14px;\n          font-weight: 600;\n          color: var(--text-secondary);\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .golden-card h4 .count {\n          background: var(--bg-secondary);\n          padding: 2px 8px;\n          border-radius: 10px;\n          font-size: 12px;\n        }\n        \n        .timezone-bars {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n          margin-bottom: 16px;\n        }\n        \n        .timezone-row {\n          display: flex;\n          align-items: center;\n          gap: 10px;\n        }\n        \n        .tz-name {\n          width: 100px;\n          font-size: 12px;\n          color: var(--text-secondary);\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .tz-bar-container {\n          flex: 1;\n          height: 24px;\n          background: var(--bg-secondary);\n          border-radius: 4px;\n          position: relative;\n          overflow: hidden;\n        }\n        \n        .tz-bar {\n          position: absolute;\n          height: 100%;\n          border-radius: 2px;\n        }\n        \n        .tz-bar.work-hours {\n          background: linear-gradient(90deg, #10b981, #34d399);\n          opacity: 0.6;\n        }\n        \n        .tz-bar.golden {\n          background: linear-gradient(90deg, #f59e0b, #fbbf24);\n          opacity: 0.9;\n        }\n        \n        .hour-labels {\n          display: flex;\n          justify-content: space-between;\n          padding: 0 110px 0 0;\n          margin-bottom: 4px;\n        }\n        \n        .hour-label {\n          font-size: 10px;\n          color: var(--text-muted);\n          width: 20px;\n          text-align: center;\n        }\n        \n        .golden-summary {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 12px;\n          background: linear-gradient(135deg, rgba(245,158,11,0.1) 0%, rgba(251,191,36,0.05) 100%);\n          border-radius: 8px;\n          border: 1px solid rgba(245,158,11,0.2);\n        }\n        \n        .golden-icon {\n          width: 40px;\n          height: 40px;\n          background: linear-gradient(135deg, #f59e0b, #d97706);\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-size: 18px;\n        }\n        \n        .golden-text {\n          flex: 1;\n        }\n        \n        .golden-text .label {\n          font-size: 12px;\n          color: var(--text-secondary);\n        }\n        \n        .golden-text .hours {\n          font-size: 16px;\n          font-weight: 700;\n          color: #d97706;\n        }\n        \n        .no-overlap {\n          color: var(--text-muted);\n          font-size: 13px;\n          font-style: italic;\n        }\n        \n        .participants-row {\n          display: flex;\n          align-items: center;\n          gap: 4px;\n          margin-top: 12px;\n        }\n        \n        .participant-avatar {\n          width: 24px;\n          height: 24px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #667eea, #764ba2);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-size: 10px;\n          font-weight: 600;\n          border: 2px solid var(--bg-primary);\n          margin-left: -8px;\n        }\n        \n        .participant-avatar:first-child {\n          margin-left: 0;\n        }\n        \n        .participant-avatar img {\n          width: 100%;\n          height: 100%;\n          border-radius: 50%;\n          object-fit: cover;\n        }\n        \n        .participant-avatar.more {\n          background: var(--bg-secondary);\n          color: var(--text-secondary);\n        }\n        \n        .online-status-bar {\n          display: flex;\n          align-items: center;\n          gap: 16px;\n          padding: 16px;\n          background: linear-gradient(135deg, rgba(16,185,129,0.1) 0%, rgba(52,211,153,0.05) 100%);\n          border-radius: 12px;\n          border: 1px solid rgba(16,185,129,0.2);\n          margin-bottom: 20px;\n        }\n        \n        .online-indicator {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .online-dot {\n          width: 10px;\n          height: 10px;\n          border-radius: 50%;\n          background: #10b981;\n          box-shadow: 0 0 8px rgba(16,185,129,0.6);\n          animation: pulse 2s infinite;\n        }\n        \n        @keyframes pulse {\n          0%, 100% { transform: scale(1); opacity: 1; }\n          50% { transform: scale(1.2); opacity: 0.7; }\n        }\n        \n        .online-count {\n          font-size: 14px;\n          font-weight: 600;\n          color: #059669;\n        }\n        \n        .people-list {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 12px;\n          margin-top: 16px;\n        }\n        \n        .person-chip {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 8px 12px;\n          background: var(--bg-secondary);\n          border-radius: 20px;\n          border: 1px solid var(--border-color);\n          transition: all 0.2s ease;\n        }\n        \n        .person-chip.online {\n          background: linear-gradient(135deg, rgba(16,185,129,0.1) 0%, rgba(16,185,129,0.05) 100%);\n          border-color: rgba(16,185,129,0.3);\n        }\n        \n        .person-chip.offline {\n          opacity: 0.6;\n        }\n        \n        .person-avatar-small {\n          width: 28px;\n          height: 28px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #667eea, #764ba2);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-size: 11px;\n          font-weight: 600;\n          position: relative;\n        }\n        \n        .person-avatar-small img {\n          width: 100%;\n          height: 100%;\n          border-radius: 50%;\n          object-fit: cover;\n        }\n        \n        .person-avatar-small .status-dot {\n          position: absolute;\n          bottom: -2px;\n          right: -2px;\n          width: 10px;\n          height: 10px;\n          border-radius: 50%;\n          border: 2px solid var(--bg-primary);\n        }\n        \n        .person-avatar-small .status-dot.online {\n          background: #10b981;\n        }\n        \n        .person-avatar-small .status-dot.offline {\n          background: #9ca3af;\n        }\n        \n        .person-info {\n          display: flex;\n          flex-direction: column;\n        }\n        \n        .person-name {\n          font-size: 13px;\n          font-weight: 500;\n          color: var(--text-primary);\n        }\n        \n        .person-time {\n          font-size: 11px;\n          color: var(--text-secondary);\n        }\n        \n        .person-role {\n          font-size: 10px;\n          color: #e11d48;\n          font-weight: 500;\n          margin-top: 2px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          max-width: 120px;\n        }\n        \n        .meeting-suggestions {\n          margin-top: 20px;\n          padding: 16px;\n          background: linear-gradient(135deg, rgba(99,102,241,0.1) 0%, rgba(139,92,246,0.05) 100%);\n          border-radius: 12px;\n          border: 1px solid rgba(99,102,241,0.2);\n        }\n        \n        .meeting-suggestions h5 {\n          margin: 0 0 12px 0;\n          font-size: 14px;\n          font-weight: 600;\n          color: var(--text-primary);\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .meeting-suggestions h5 svg {\n          color: #6366f1;\n        }\n        \n        .suggestion-list {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 10px;\n        }\n        \n        .suggestion-pill {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 8px 14px;\n          background: white;\n          border-radius: 20px;\n          border: 1px solid rgba(99,102,241,0.3);\n          font-size: 13px;\n          cursor: pointer;\n          transition: all 0.2s ease;\n        }\n        \n        [data-theme=\"dark\"] .suggestion-pill {\n          background: rgba(30,41,59,0.8);\n        }\n        \n        .suggestion-pill:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(99,102,241,0.2);\n        }\n        \n        .suggestion-pill .time {\n          font-weight: 600;\n          color: #6366f1;\n        }\n        \n        .suggestion-pill .availability {\n          font-size: 11px;\n          color: var(--text-secondary);\n          padding: 2px 6px;\n          background: rgba(16,185,129,0.1);\n          border-radius: 8px;\n          color: #059669;\n        }\n      </style>\n      \n      <div class=\"golden-hours-section\">\n        <div class=\"golden-hours-header\">\n          <h3>\n            <svg width=\"24\" height=\"24\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\"/>\n            </svg>\n            Golden Hours\n          </h3>\n          <span style=\"font-size: 13px; color: var(--text-secondary);\">\n            ${new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })} your time\n          </span>\n        </div>\n        \n        <div class=\"golden-hours-grid\">\n          <!-- Team Members Section -->\n          ${memberEntries.length > 0 ? `\n            <div class=\"golden-card\">\n              <h4>\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                </svg>\n                Team Members\n                <span class=\"count\">${memberEntries.length}</span>\n                ${onlineMembers > 0 ? `<span style=\"margin-left: auto; font-size: 11px; color: #10b981;\"> ${onlineMembers} online</span>` : ''}\n              </h4>\n              \n              <!-- Team People List -->\n              <div class=\"people-list\" style=\"margin-bottom: 16px;\">\n                ${memberEntries.map(e => {\n                  const initials = e.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n                  return `\n                    <div class=\"person-chip ${e.isOnline ? 'online' : 'offline'}\">\n                      <div class=\"person-avatar-small\">\n                        ${e.avatarUrl ? `<img src=\"${escapeHtmlSimple(e.avatarUrl)}\" alt=\"${escapeHtmlSimple(e.name)}\">` : initials}\n                        <span class=\"status-dot ${e.isOnline ? 'online' : 'offline'}\"></span>\n                      </div>\n                      <div class=\"person-info\">\n                        <span class=\"person-name\">${escapeHtmlSimple(e.name)}</span>\n                        ${e.role ? `<span class=\"person-role\">${escapeHtmlSimple(e.role)}</span>` : ''}\n                        <span class=\"person-time\">${e.localTime || '--:--'} ${e.timezone.split('/').pop()?.replace(/_/g, ' ') || ''}</span>\n                      </div>\n                    </div>\n                  `;\n                }).join('')}\n              </div>\n              \n              ${renderTimezoneChart(memberEntries, memberGolden)}\n              ${renderGoldenSummary(memberGolden, memberEntries)}\n              \n              <!-- Team Meeting Suggestions -->\n              ${(() => {\n                const teamSuggestions = findBestMeetingTimes(memberEntries);\n                return teamSuggestions.length > 0 ? `\n                  <div class=\"meeting-suggestions\" style=\"margin-top: 16px;\">\n                    <h5>\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                      </svg>\n                      Best Times for Team\n                    </h5>\n                    <div class=\"suggestion-list\">\n                      ${teamSuggestions.map((s, i) => `\n                        <div class=\"suggestion-pill\">\n                          <span style=\"color: ${i === 0 ? '#f59e0b' : 'var(--text-muted)'};\">${i === 0 ? '' : ''}</span>\n                          <span class=\"time\">${s.time}</span>\n                          <span class=\"availability\">${s.available}/${memberEntries.length}</span>\n                        </div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : '';\n              })()}\n            </div>\n          ` : ''}\n          \n          <!-- Contacts Section -->\n          ${contactEntries.length > 0 ? `\n            <div class=\"golden-card\">\n              <h4>\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\"/>\n                </svg>\n                Contacts\n                <span class=\"count\">${contactEntries.length}</span>\n                ${onlineContacts > 0 ? `<span style=\"margin-left: auto; font-size: 11px; color: #10b981;\"> ${onlineContacts} online</span>` : ''}\n              </h4>\n              \n              <!-- Contacts People List -->\n              <div class=\"people-list\" style=\"margin-bottom: 16px;\">\n                ${contactEntries.map(e => {\n                  const initials = e.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n                  return `\n                    <div class=\"person-chip ${e.isOnline ? 'online' : 'offline'}\">\n                      <div class=\"person-avatar-small\">\n                        ${e.avatarUrl ? `<img src=\"${escapeHtmlSimple(e.avatarUrl)}\" alt=\"${escapeHtmlSimple(e.name)}\">` : initials}\n                        <span class=\"status-dot ${e.isOnline ? 'online' : 'offline'}\"></span>\n                      </div>\n                      <div class=\"person-info\">\n                        <span class=\"person-name\">${escapeHtmlSimple(e.name)}</span>\n                        ${e.role ? `<span class=\"person-role\">${escapeHtmlSimple(e.role)}</span>` : ''}\n                        <span class=\"person-time\">${e.localTime || '--:--'} ${e.timezone.split('/').pop()?.replace(/_/g, ' ') || ''}</span>\n                      </div>\n                    </div>\n                  `;\n                }).join('')}\n              </div>\n              \n              ${renderTimezoneChart(contactEntries, contactGolden)}\n              ${renderGoldenSummary(contactGolden, contactEntries)}\n              \n              <!-- Contacts Meeting Suggestions -->\n              ${(() => {\n                const contactSuggestions = findBestMeetingTimes(contactEntries);\n                return contactSuggestions.length > 0 ? `\n                  <div class=\"meeting-suggestions\" style=\"margin-top: 16px;\">\n                    <h5>\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                      </svg>\n                      Best Times for Contacts\n                    </h5>\n                    <div class=\"suggestion-list\">\n                      ${contactSuggestions.map((s, i) => `\n                        <div class=\"suggestion-pill\">\n                          <span style=\"color: ${i === 0 ? '#f59e0b' : 'var(--text-muted)'};\">${i === 0 ? '' : ''}</span>\n                          <span class=\"time\">${s.time}</span>\n                          <span class=\"availability\">${s.available}/${contactEntries.length}</span>\n                        </div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : '';\n              })()}\n            </div>\n          ` : ''}\n        </div>\n        \n        <!-- Combined Section (only if both exist) -->\n        ${memberEntries.length > 0 && contactEntries.length > 0 ? `\n          <div class=\"golden-card\" style=\"margin-top: 20px;\">\n            <h4>\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n              </svg>\n              Combined: Team + Contacts\n              <span class=\"count\">${allEntries.length}</span>\n              <span style=\"margin-left: auto; font-size: 11px; color: #10b981;\"> ${onlineAll} online</span>\n            </h4>\n            ${renderGoldenSummary(allGolden, allEntries)}\n            \n            <!-- Combined Meeting Suggestions -->\n            ${meetingSuggestions.length > 0 ? `\n              <div class=\"meeting-suggestions\" style=\"margin-top: 16px;\">\n                <h5>\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                  </svg>\n                  Best Times for Everyone\n                </h5>\n                <div class=\"suggestion-list\">\n                  ${meetingSuggestions.map((s, i) => `\n                    <div class=\"suggestion-pill\">\n                      <span style=\"color: ${i === 0 ? '#f59e0b' : 'var(--text-muted)'};\">${i === 0 ? '' : ''}</span>\n                      <span class=\"time\">${s.time}</span>\n                      <span class=\"availability\">${s.available}/${allEntries.length}</span>\n                    </div>\n                  `).join('')}\n                </div>\n              </div>\n            ` : ''}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  } catch (error) {\n    console.error('Failed to load golden hours:', error);\n  }\n}\n\n/**\n * Calculate golden hours (9-18 work hours overlap) for a set of timezone entries\n */\nfunction calculateGoldenHours(entries: TimezoneEntry[]): { start: number; end: number } | null {\n  if (entries.length === 0) return null;\n\n  // Get unique timezones\n  const uniqueTimezones = [...new Set(entries.map(e => e.timezone))];\n  \n  if (uniqueTimezones.length === 1) {\n    // All same timezone - work hours are 8-18\n    return { start: 8, end: 18 };\n  }\n\n  // Calculate UTC offsets for each timezone\n  const now = new Date();\n  const offsets: number[] = [];\n\n  for (const tz of uniqueTimezones) {\n    try {\n      const formatter = new Intl.DateTimeFormat('en-US', {\n        timeZone: tz,\n        hour: 'numeric',\n        hour12: false,\n      });\n      const localHour = parseInt(formatter.format(now), 10);\n      const utcHour = now.getUTCHours();\n      let offset = localHour - utcHour;\n      if (offset > 12) offset -= 24;\n      if (offset < -12) offset += 24;\n      offsets.push(offset);\n    } catch {\n      offsets.push(0); // Default to UTC if timezone is invalid\n    }\n  }\n\n  // Find overlap of 8-18 work hours across all timezones\n  // Convert each timezone's work hours to UTC, then find intersection\n  let overlapStart = 0;\n  let overlapEnd = 24;\n\n  for (const offset of offsets) {\n    // Work hours in UTC for this timezone\n    const workStartUtc = (8 - offset + 24) % 24;\n    const workEndUtc = (18 - offset + 24) % 24;\n\n    // Handle wraparound\n    if (workStartUtc < workEndUtc) {\n      overlapStart = Math.max(overlapStart, workStartUtc);\n      overlapEnd = Math.min(overlapEnd, workEndUtc);\n    }\n  }\n\n  if (overlapStart >= overlapEnd) {\n    return null; // No overlap\n  }\n\n  // Convert back to first timezone for display\n  const firstOffset = offsets[0];\n  return {\n    start: (overlapStart + firstOffset + 24) % 24,\n    end: (overlapEnd + firstOffset + 24) % 24,\n  };\n}\n\n/**\n * Render timezone chart showing work hours for each participant\n */\nfunction renderTimezoneChart(entries: TimezoneEntry[], golden: { start: number; end: number } | null): string {\n  // Get unique timezones with count\n  const tzCounts = new Map<string, number>();\n  for (const e of entries) {\n    tzCounts.set(e.timezone, (tzCounts.get(e.timezone) || 0) + 1);\n  }\n\n  const uniqueTzs = [...tzCounts.keys()].slice(0, 5); // Max 5 timezones\n\n  if (uniqueTzs.length === 0) {\n    return '<div class=\"no-overlap\">No timezone data available</div>';\n  }\n\n  const now = new Date();\n\n  return `\n    <div class=\"hour-labels\">\n      ${[0, 6, 12, 18, 24].map(h => `<span class=\"hour-label\">${h}</span>`).join('')}\n    </div>\n    <div class=\"timezone-bars\">\n      ${uniqueTzs.map(tz => {\n        // Calculate work hours position (9-18)\n        let offset = 0;\n        try {\n          const formatter = new Intl.DateTimeFormat('en-US', {\n            timeZone: tz,\n            hour: 'numeric',\n            hour12: false,\n          });\n          const localHour = parseInt(formatter.format(now), 10);\n          const utcHour = now.getUTCHours();\n          offset = localHour - utcHour;\n          if (offset > 12) offset -= 24;\n          if (offset < -12) offset += 24;\n        } catch { /* ignore */ }\n\n        // Work hours 9-18 in this timezone\n        const workStart = 9;\n        const workEnd = 18;\n        const workLeft = ((workStart) / 24) * 100;\n        const workWidth = ((workEnd - workStart) / 24) * 100;\n\n        // Display name\n        const displayTz = tz.split('/').pop()?.replace(/_/g, ' ') || tz;\n        const count = tzCounts.get(tz) || 1;\n\n        return `\n          <div class=\"timezone-row\">\n            <span class=\"tz-name\" title=\"${tz}\">${displayTz} ${count > 1 ? `(${count})` : ''}</span>\n            <div class=\"tz-bar-container\">\n              <div class=\"tz-bar work-hours\" style=\"left: ${workLeft}%; width: ${workWidth}%;\"></div>\n              ${golden ? `<div class=\"tz-bar golden\" style=\"left: ${(golden.start / 24) * 100}%; width: ${((golden.end - golden.start) / 24) * 100}%;\"></div>` : ''}\n            </div>\n          </div>\n        `;\n      }).join('')}\n    </div>\n  `;\n}\n\n/**\n * Render golden hours summary\n */\nfunction renderGoldenSummary(golden: { start: number; end: number } | null, entries: TimezoneEntry[]): string {\n  if (!golden) {\n    return `\n      <div class=\"golden-summary\" style=\"background: linear-gradient(135deg, rgba(239,68,68,0.1) 0%, rgba(239,68,68,0.05) 100%); border-color: rgba(239,68,68,0.2);\">\n        <div class=\"golden-icon\" style=\"background: linear-gradient(135deg, #ef4444, #dc2626);\"></div>\n        <div class=\"golden-text\">\n          <div class=\"label\">No overlap found</div>\n          <div class=\"hours\" style=\"color: #dc2626;\">Timezones too far apart</div>\n        </div>\n      </div>\n    `;\n  }\n\n  const formatHour = (h: number) => `${h.toString().padStart(2, '0')}:00`;\n  const duration = golden.end - golden.start;\n\n  // Show participant avatars\n  const maxAvatars = 5;\n  const showEntries = entries.slice(0, maxAvatars);\n  const moreCount = entries.length - maxAvatars;\n\n  return `\n    <div class=\"golden-summary\">\n      <div class=\"golden-icon\"></div>\n      <div class=\"golden-text\">\n        <div class=\"label\">Golden Hours</div>\n        <div class=\"hours\">${formatHour(golden.start)} - ${formatHour(golden.end)} (${duration}h overlap)</div>\n      </div>\n    </div>\n    <div class=\"participants-row\">\n      ${showEntries.map(e => {\n        const initials = e.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n        return `\n          <div class=\"participant-avatar\" title=\"${escapeHtmlSimple(e.name)}\">\n            ${e.avatarUrl ? `<img src=\"${escapeHtmlSimple(e.avatarUrl)}\" alt=\"${escapeHtmlSimple(e.name)}\">` : initials}\n          </div>\n        `;\n      }).join('')}\n      ${moreCount > 0 ? `<div class=\"participant-avatar more\">+${moreCount}</div>` : ''}\n    </div>\n  `;\n}\n\nfunction escapeHtmlSimple(str: string): string {\n  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n// Helper functions\nfunction getInitials(name: string): string {\n  return name\n    .split(/\\s+/)\n    .map(part => part[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2) || '?';\n}\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\n/**\n * Mount dashboard to container\n */\nexport function mountDashboard(selector: string, props: DashboardProps = {}): HTMLElement | null {\n  const container = document.querySelector(selector);\n  if (!container) {\n    console.warn(`Dashboard: Container not found: ${selector}`);\n    return null;\n  }\n\n  const dashboard = createDashboard(props);\n  container.appendChild(dashboard);\n  return dashboard;\n}\n\nexport default createDashboard;\n","/**\n * Chat Component\n * AI chat interface with multiple sessions, persistence, and contact pills\n */\n\nimport { createElement, on, scrollIntoView } from '../utils/dom';\nimport { dataStore, ChatMessage, ChatSource, ChatRAGInfo } from '../stores/data';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\ninterface ChatSession {\n  id: string;\n  title: string;\n  context_contact_id?: string | null;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface ContactOption {\n  id: string;\n  name: string;\n  role?: string;\n  organization?: string;\n}\n\ninterface ChatAPIResponse {\n  success: boolean;\n  response: string;\n  sessionId?: string;\n  model?: string;\n  provider?: string;\n  confidence?: 'high' | 'medium' | 'low';\n  contextQuality?: string;\n  queryType?: string;\n  sources?: ChatSource[];\n  rag?: ChatRAGInfo;\n}\n\nexport interface ChatProps {\n  onSend?: (message: string) => Promise<void>;\n  placeholder?: string;\n  showSources?: boolean;\n  showSessions?: boolean; // Show sidebar with multiple conversations\n}\n\n/**\n * Create chat component\n */\nexport function createChat(props: ChatProps = {}): HTMLElement {\n  const showSessions = props.showSessions !== false;\n  \n  const chat = createElement('div', { className: 'chat-layout' });\n\n  // State for multiple sessions\n  let currentSessionId: string | null = null;\n  let sessions: ChatSession[] = [];\n  let contacts: ContactOption[] = [];\n\n  // Sidebar (sessions list)\n  const sidebar = createElement('div', { className: 'chat-sidebar' });\n  const newChatBtn = createElement('button', { \n    className: 'chat-new-conversation',\n    innerHTML: `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/></svg> Nova conversa`\n  });\n  const newChatContextWrap = createElement('div', { className: 'chat-new-context-wrap' });\n  const newChatContextLabel = createElement('span', { className: 'chat-new-context-label', textContent: 'Como quem?' });\n  const newChatContextSelect = createElement('select', { className: 'chat-new-context-select' }) as HTMLSelectElement;\n  newChatContextWrap.appendChild(newChatContextLabel);\n  newChatContextWrap.appendChild(newChatContextSelect);\n  const sessionsList = createElement('div', { className: 'chat-sessions-list' });\n  sidebar.appendChild(newChatBtn);\n  sidebar.appendChild(newChatContextWrap);\n  sidebar.appendChild(sessionsList);\n\n  // Main area\n  const mainArea = createElement('div', { className: 'chat-main' });\n  const chatContainer = createElement('div', { className: 'chat-container' });\n\n  // Chat header: \"Como quem?\" context selector\n  const chatHeader = createElement('div', { className: 'chat-header' });\n  const contextLabel = createElement('label', { className: 'chat-context-label', textContent: 'Como quem?' });\n  const contextSelect = createElement('select', { className: 'chat-context-select' }) as HTMLSelectElement;\n  chatHeader.appendChild(contextLabel);\n  chatHeader.appendChild(contextSelect);\n\n  async function loadContacts(): Promise<void> {\n    try {\n      const res = await http.get<{ contacts?: Array<{ id: string; name: string; role?: string; organization?: string }> }>('/api/contacts');\n      contacts = res.data?.contacts || [];\n      renderContextSelect();\n    } catch {\n      contacts = [];\n    }\n  }\n\n  function renderContextSelect(): void {\n    const currentSession = sessions.find(s => s.id === currentSessionId);\n    const currentContextId = currentSession?.context_contact_id || null;\n    contextSelect.innerHTML = `<option value=\"\">Sem contexto</option>${contacts.map(c => `<option value=\"${c.id}\" ${c.id === currentContextId ? 'selected' : ''}>${escapeHtml(c.name)}${c.role ? ` - ${c.role}` : ''}${c.organization ? ` (${c.organization})` : ''}</option>`).join('')}`;\n    contextSelect.disabled = !currentSessionId;\n  }\n\n  function renderNewChatContextSelect(): void {\n    newChatContextSelect.innerHTML = `<option value=\"\">Sem contexto</option>${contacts.map(c => `<option value=\"${c.id}\">${escapeHtml(c.name)}${c.role ? ` - ${c.role}` : ''}${c.organization ? ` (${c.organization})` : ''}</option>`).join('')}`;\n  }\n\n  async function onContextChange(): Promise<void> {\n    if (!currentSessionId) return;\n    const contactId = contextSelect.value || null;\n    try {\n      await http.put(`/api/chat/sessions/${currentSessionId}`, { contextContactId: contactId });\n      const idx = sessions.findIndex(s => s.id === currentSessionId);\n      if (idx !== -1) sessions[idx] = { ...sessions[idx], context_contact_id: contactId };\n      toast.success('Contexto actualizado');\n    } catch (e) {\n      toast.error('Falha ao actualizar contexto');\n      console.error('[Chat] Update context error:', e);\n      renderContextSelect();\n    }\n  }\n\n  // Messages container\n  const messagesContainer = createElement('div', { className: 'chat-messages' });\n\n  // Input container\n  const inputContainer = createElement('div', { className: 'chat-input-container' });\n\n  const input = createElement('textarea', {\n    className: 'chat-input',\n    placeholder: props.placeholder || 'Ask a question about your project...',\n  }) as HTMLTextAreaElement;\n\n  const sendBtn = createElement('button', {\n    className: 'chat-send-btn',\n    innerHTML: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n      <path d=\"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z\"/>\n    </svg>`,\n  });\n\n  // Auto-resize textarea\n  on(input, 'input', () => {\n    input.style.height = 'auto';\n    input.style.height = Math.min(input.scrollHeight, 120) + 'px';\n  });\n\n  // Send on Enter (Shift+Enter for new line)\n  on(input, 'keydown', (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  });\n\n  // Send button click\n  on(sendBtn, 'click', handleSend);\n\n  let isLoading = false;\n\n  async function loadSessions(): Promise<void> {\n    try {\n      const res = await http.get<{ ok: boolean; sessions?: ChatSession[] }>('/api/chat/sessions');\n      sessions = res.data?.sessions || [];\n      renderSessionsList();\n    } catch {\n      sessions = [];\n    }\n  }\n\n  function renderSessionsList(): void {\n    sessionsList.innerHTML = sessions.map(s => `\n      <button class=\"chat-session-item ${s.id === currentSessionId ? 'active' : ''}\" data-session-id=\"${s.id}\">\n        <span class=\"session-title\">${escapeHtml(s.title.length > 40 ? s.title.substring(0, 37) + '...' : s.title)}</span>\n        <span class=\"session-date\">${formatRelativeTime(s.updated_at)}</span>\n      </button>\n    `).join('');\n    sessionsList.querySelectorAll('.chat-session-item').forEach(btn => {\n      on(btn as HTMLElement, 'click', () => selectSession((btn as HTMLElement).getAttribute('data-session-id')!));\n    });\n  }\n\n  async function loadMessages(sessionId: string): Promise<void> {\n    try {\n      const res = await http.get<{ ok: boolean; messages?: Array<{ id: string; role: string; content: string; sources?: ChatSource[]; metadata?: Record<string, unknown>; created_at: string }> }>(`/api/chat/sessions/${sessionId}/messages`);\n      const msgs = res.data?.messages || [];\n      dataStore.setChatHistory(msgs.map(m => ({\n        id: m.id,\n        role: m.role as 'user' | 'assistant' | 'system',\n        content: m.content,\n        timestamp: m.created_at,\n        sources: m.sources,\n        ...(m.metadata?.queryType && { queryType: m.metadata.queryType as string }),\n        ...(m.metadata?.confidence && { confidence: m.metadata.confidence as 'high' | 'medium' | 'low' })\n      })));\n    } catch {\n      dataStore.setChatHistory([]);\n    }\n  }\n\n  async function selectSession(sessionId: string): Promise<void> {\n    currentSessionId = sessionId;\n    renderSessionsList();\n    dataStore.clearChatHistory();\n    await loadMessages(sessionId);\n    messagesContainer.innerHTML = '';\n    dataStore.getState().chatHistory.forEach(msg => renderMessage(msg, messagesContainer, props.showSources));\n  }\n\n  async function createNewSession(contextContactId?: string | null): Promise<void> {\n    try {\n      const res = await http.post<{ ok: boolean; session?: { id: string; title?: string; context_contact_id?: string | null; created_at?: string; updated_at?: string } }>('/api/chat/sessions', { title: 'Nova conversa', contextContactId: contextContactId || null });\n      const session = res.data?.session;\n      if (session) {\n        sessions.unshift({\n          id: session.id,\n          title: session.title || 'Nova conversa',\n          context_contact_id: session.context_contact_id ?? null,\n          created_at: session.created_at || new Date().toISOString(),\n          updated_at: session.updated_at || new Date().toISOString()\n        });\n        await selectSession(session.id);\n        renderSessionsList();\n      }\n    } catch (e) {\n      toast.error('Failed to create new conversation');\n      console.error('[Chat] Create session error:', e);\n    }\n  }\n\n  async function handleSend(): Promise<void> {\n    const message = input.value.trim();\n    if (!message || isLoading) return;\n\n    input.value = '';\n    input.style.height = 'auto';\n    isLoading = true;\n    sendBtn.setAttribute('disabled', 'true');\n\n    // Add user message\n    const userMessage: ChatMessage = {\n      id: `msg-${Date.now()}`,\n      role: 'user',\n      content: message,\n      timestamp: new Date().toISOString(),\n    };\n    dataStore.addChatMessage(userMessage);\n    renderMessage(userMessage, messagesContainer);\n\n    // Show loading\n    const loadingEl = createElement('div', { className: 'chat-loading' });\n    loadingEl.innerHTML = `\n      <div class=\"chat-loading-dots\">\n        <span></span><span></span><span></span>\n      </div>\n      <span>Thinking...</span>\n    `;\n    messagesContainer.appendChild(loadingEl);\n    scrollToBottom(messagesContainer);\n\n    try {\n      if (props.onSend) {\n        await props.onSend(message);\n      } else {\n        const response = await http.post<ChatAPIResponse>('/api/chat', {\n          message,\n          history: dataStore.getState().chatHistory.slice(-10),\n          sessionId: currentSessionId,\n        });\n\n        const assistantMessage: ChatMessage = {\n          id: `msg-${Date.now()}`,\n          role: 'assistant',\n          content: response.data.response,\n          timestamp: new Date().toISOString(),\n          sources: response.data.sources,\n          queryType: response.data.queryType,\n          confidence: response.data.confidence,\n          contextQuality: response.data.contextQuality,\n          rag: response.data.rag,\n        };\n        dataStore.addChatMessage(assistantMessage);\n        renderMessage(assistantMessage, messagesContainer, props.showSources);\n\n        // Update current session if backend created one\n        if (response.data.sessionId && !currentSessionId) {\n          currentSessionId = response.data.sessionId;\n          await loadSessions();\n          renderSessionsList();\n          renderContextSelect();\n        }\n      }\n    } catch (error) {\n      const errorMessage: ChatMessage = {\n        id: `msg-${Date.now()}`,\n        role: 'system',\n        content: 'Failed to get response. Please try again.',\n        timestamp: new Date().toISOString(),\n      };\n      renderMessage(errorMessage, messagesContainer);\n    } finally {\n      loadingEl.remove();\n      isLoading = false;\n      sendBtn.removeAttribute('disabled');\n      input.focus();\n    }\n  }\n\n  inputContainer.appendChild(input);\n  inputContainer.appendChild(sendBtn);\n\n  // Quick prompts\n  const quickPrompts = createElement('div', { className: 'quick-prompts' });\n  const prompts = [\n    'Summarize key risks',\n    'List open questions',\n    'What actions are overdue?',\n    'Who are the key contacts?',\n  ];\n\n  prompts.forEach(prompt => {\n    const btn = createElement('button', {\n      className: 'quick-prompt',\n      textContent: prompt,\n    });\n    on(btn, 'click', () => {\n      input.value = prompt;\n      handleSend();\n    });\n    quickPrompts.appendChild(btn);\n  });\n\n  // Layout assembly\n  on(contextSelect, 'change', onContextChange);\n  chatContainer.appendChild(chatHeader);\n  chatContainer.appendChild(messagesContainer);\n  chatContainer.appendChild(quickPrompts);\n  chatContainer.appendChild(inputContainer);\n  mainArea.appendChild(chatContainer);\n\n  if (showSessions) {\n    chat.appendChild(sidebar);\n    on(newChatBtn as HTMLElement, 'click', createNewSession);\n    loadContacts().then(() => renderNewChatContextSelect());\n    loadSessions();\n  } else {\n    chatHeader.style.display = 'none';\n  }\n  chat.appendChild(mainArea);\n\n  // Render existing messages (from dataStore - may be empty initially)\n  const existingMessages = dataStore.getState().chatHistory;\n  existingMessages.forEach(msg => renderMessage(msg, messagesContainer, props.showSources));\n\n  return chat;\n}\n\n/**\n * Render a chat message with SOTA RAG info\n */\nfunction renderMessage(\n  message: ChatMessage,\n  container: HTMLElement,\n  showSources = true\n): HTMLElement {\n  const msgEl = createElement('div', {\n    className: `chat-message ${message.role}`,\n  });\n\n  let content = escapeHtml(message.content);\n\n  // Parse markdown-like formatting\n  content = content\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n    .replace(/`(.*?)`/g, '<code>$1</code>')\n    .replace(/\\n/g, '<br>');\n\n  msgEl.innerHTML = `<div class=\"chat-message-content\">${content}</div>`;\n\n  // Add RAG metadata badge for assistant messages\n  if (message.role === 'assistant' && (message.confidence || message.rag)) {\n    const metaEl = createElement('div', { className: 'chat-meta' });\n    const confidenceClass = message.confidence === 'high' ? 'confidence-high' : \n                            message.confidence === 'medium' ? 'confidence-medium' : 'confidence-low';\n    \n    let metaHtml = '';\n    \n    // Confidence badge\n    if (message.confidence) {\n      metaHtml += `<span class=\"chat-badge ${confidenceClass}\" title=\"Confidence level\">${message.confidence}</span>`;\n    }\n    \n    // Query type badge\n    if (message.queryType) {\n      metaHtml += `<span class=\"chat-badge query-type\" title=\"Query classification\">${message.queryType}</span>`;\n    }\n    \n    // RAG method badge\n    if (message.rag) {\n      const methodLabel = message.rag.usedHyDE ? 'HyDE+RRF' : \n                          message.rag.graphResults > 0 ? 'Graph+Vector' : 'Hybrid';\n      metaHtml += `<span class=\"chat-badge rag-method\" title=\"RAG method: ${message.rag.method}\">${methodLabel}</span>`;\n      \n      // Sources count\n      const totalSources = message.rag.fusedResults || (message.rag.vectorResults + message.rag.graphResults);\n      if (totalSources > 0) {\n        metaHtml += `<span class=\"chat-badge sources-count\" title=\"Sources found\">${totalSources} sources</span>`;\n      }\n    }\n    \n    metaEl.innerHTML = metaHtml;\n    msgEl.appendChild(metaEl);\n  }\n\n  // Add detailed sources if present\n  if (showSources && message.sources && message.sources.length > 0) {\n    const sourcesEl = createElement('div', { className: 'chat-sources' });\n    \n    // Handle both string[] (legacy) and ChatSource[] (SOTA) formats\n    if (typeof message.sources[0] === 'string') {\n      // Legacy format\n      sourcesEl.innerHTML = `\n        <span class=\"sources-label\">Sources:</span>\n        ${(message.sources as string[]).map(s => `<span class=\"source-link\">${escapeHtml(s)}</span>`).join('')}\n      `;\n    } else {\n      // SOTA format with detailed sources and contact pills\n      const sources = message.sources as ChatSource[];\n      const contactSources = sources.filter(s => s.contactName);\n      const otherSources = sources.filter(s => !s.contactName);\n      const topSources = otherSources.slice(0, 5);\n\n      // Contact pills (avatar + name + role)\n      if (contactSources.length > 0) {\n        const pillsEl = createElement('div', { className: 'chat-contact-pills' });\n        pillsEl.innerHTML = contactSources.map(s => `\n          <div class=\"contact-pill\">\n            ${s.avatarUrl ? `<img class=\"contact-pill-avatar\" src=\"${escapeHtml(s.avatarUrl)}\" alt=\"\" onerror=\"this.style.display='none'\"/>` : `<div class=\"contact-pill-avatar-placeholder\">${escapeHtml((s.contactName || s.type || '?')[0])}</div>`}\n            <div class=\"contact-pill-info\">\n              <span class=\"contact-pill-name\">${escapeHtml(s.contactName || s.type || 'Contact')}</span>\n              ${s.contactRole ? `<span class=\"contact-pill-role\">${escapeHtml(s.contactRole)}</span>` : ''}\n            </div>\n          </div>\n        `).join('');\n        msgEl.appendChild(pillsEl);\n      }\n      \n      sourcesEl.innerHTML = `\n        <details class=\"sources-details\">\n          <summary class=\"sources-label\">\n            <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <polyline points=\"9 18 15 12 9 6\"></polyline>\n            </svg>\n            ${sources.length} sources used\n          </summary>\n          <div class=\"sources-list\">\n            ${topSources.map(s => `\n              <div class=\"source-item\">\n                <span class=\"source-type\">${escapeHtml(s.type || 'unknown')}</span>\n                <span class=\"source-score\" title=\"Relevance score\">${Math.round((s.rrfScore || s.score || 0) * 100)}%</span>\n                ${s.sourceCount && s.sourceCount > 1 ? `<span class=\"source-multi\" title=\"Found in multiple searches\">x${s.sourceCount}</span>` : ''}\n                ${s.source ? `<span class=\"source-from\">${escapeHtml(s.source)}</span>` : ''}\n              </div>\n            `).join('')}\n            ${sources.length > 5 ? `<div class=\"sources-more\">+${sources.length - 5} more</div>` : ''}\n          </div>\n        </details>\n      `;\n    }\n    msgEl.appendChild(sourcesEl);\n  }\n\n  container.appendChild(msgEl);\n  scrollToBottom(container);\n\n  return msgEl;\n}\n\n/**\n * Scroll container to bottom\n */\nfunction scrollToBottom(container: HTMLElement): void {\n  container.scrollTop = container.scrollHeight;\n}\n\n/**\n * Escape HTML to prevent XSS\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Mount chat to container\n */\nexport function mountChat(selector: string, props: ChatProps = {}): HTMLElement | null {\n  const container = document.querySelector(selector);\n  if (!container) {\n    console.warn(`Chat: Container not found: ${selector}`);\n    return null;\n  }\n\n  const chat = createChat(props);\n  container.appendChild(chat);\n  return chat;\n}\n\nexport default createChat;\n","/**\n * Question Detail View\n * Full-page view for question details, replacing the panel when a card is clicked\n * Features: timeline, contact picker, answer suggestions, follow-up chain, entity display\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { Question, questionsService } from '../../services/questions';\nimport { contactsService, Contact } from '../../services/contacts';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\nimport { http } from '../../services/api';\n\nexport interface QuestionDetailViewProps {\n  question: Question;\n  onClose: () => void;\n  onUpdate?: (question: Question) => void;\n  onNavigateToQuestion?: (questionId: string) => void;\n}\n\ninterface QuestionChain {\n  parent: Question | null;\n  children: Question[];\n}\n\ninterface TimelineEvent {\n  id: string;\n  event_type: string;\n  event_data: Record<string, unknown>;\n  actor_name?: string;\n  created_at: string;\n}\n\ninterface PotentialAnswer {\n  type: 'fact' | 'decision';\n  id: string;\n  content: string;\n  confidence: number;\n  source?: string;\n}\n\ninterface SimilarQuestion {\n  id: string;\n  content: string;\n  status: string;\n  priority: string;\n  similarityScore: number;\n}\n\nlet currentQuestion: Question | null = null;\nlet contacts: Contact[] = [];\n\n/**\n * Create and show the question detail view\n */\nexport function createQuestionDetailView(props: QuestionDetailViewProps): HTMLElement {\n  const { question, onClose, onUpdate, onNavigateToQuestion } = props;\n  currentQuestion = question;\n\n  const container = createElement('div', { className: 'question-detail-view' });\n\n  container.innerHTML = `\n    <div class=\"question-detail-header\">\n      <div class=\"breadcrumb\">\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Questions</a>\n        <span class=\"breadcrumb-separator\"></span>\n        <span class=\"breadcrumb-current\">Question #${String(question.id).substring(0, 8)}</span>\n      </div>\n      <div class=\"header-actions\">\n        ${question.sla_breached ? '<span class=\"sla-badge breached\">SLA Breached</span>' : ''}\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\n      </div>\n    </div>\n\n    <div class=\"question-detail-content\">\n      <!-- Main Question Card -->\n      <section class=\"detail-section question-main\">\n        <div class=\"question-badges\">\n          <span class=\"priority-badge priority-${question.priority}\">${question.priority}</span>\n          <span class=\"status-badge status-${question.status}\">${question.status}</span>\n          ${question.requester_role ? `\n            <div class=\"requester-badge-full\" title=\"Question from the perspective of this role\">\n              <div class=\"requester-avatar-sm\">${getInitials((question as any).requester_name || question.requester_role)}</div>\n              <div class=\"requester-text\">\n                ${(question as any).requester_name ? `<span class=\"requester-name-sm\">${escapeHtml((question as any).requester_name)}</span>` : ''}\n                <span class=\"requester-role-sm\">${escapeHtml(question.requester_role)}</span>\n              </div>\n            </div>\n          ` : ''}\n          <span class=\"question-date\">Created ${formatRelativeTime(question.created_at)}</span>\n        </div>\n        <h2 class=\"question-text\">${escapeHtml(question.content)}</h2>\n        ${question.context ? `<p class=\"question-context\">${escapeHtml(question.context)}</p>` : ''}\n        ${renderEntities(question)}\n      </section>\n\n      <!-- Two-column layout -->\n      <div class=\"detail-columns\">\n        <div class=\"detail-column-left\">\n          <!-- Assignment Section - SOTA Design -->\n          <section class=\"detail-section\" id=\"assignment-section\">\n            <div class=\"section-header-sota\">\n              <h3>\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                </svg>\n                Assignment\n                <span class=\"section-subtitle\">Who should answer this question?</span>\n              </h3>\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"ai-suggest-btn\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n                </svg>\n                AI Suggest\n              </button>\n            </div>\n            \n            <!-- Current Assignment Display -->\n            <div id=\"current-assignment\" class=\"current-assignment-card\">\n              ${question.assigned_to ? `\n                <div class=\"assigned-contact-display\">\n                  <div class=\"contact-avatar-lg\" id=\"assigned-avatar\">\n                    ${getInitials(question.assigned_to)}\n                  </div>\n                  <div class=\"contact-details\">\n                    <div class=\"contact-name-lg\">${escapeHtml(question.assigned_to)}</div>\n                    <div class=\"contact-role-sm\" id=\"assigned-role\">Loading...</div>\n                  </div>\n                  <button class=\"btn-change-assignment\" id=\"change-assignee-btn\">\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/>\n                    </svg>\n                    Change\n                  </button>\n                </div>\n              ` : `\n                <div class=\"no-assignment\">\n                  <div class=\"no-assignment-icon\">\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\n                    </svg>\n                  </div>\n                  <span>No one assigned to answer</span>\n                  <p class=\"no-assignment-hint\">Use AI Suggest to find the best person</p>\n                  <button class=\"btn-assign-now\" id=\"show-picker-btn\">Choose Manually</button>\n                </div>\n              `}\n            </div>\n            \n            <!-- Contact Picker (hidden by default) -->\n            <div id=\"contact-picker\" class=\"contact-picker-sota\" style=\"display: none;\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/>\n                </svg>\n                <input type=\"text\" id=\"contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"contact-list\" class=\"contact-list-grid\">\n                <div class=\"loading\">Loading contacts...</div>\n              </div>\n            </div>\n            \n            <!-- Hidden select for form submission -->\n            <select id=\"assignee-select\" class=\"form-select\" style=\"display: none;\">\n              <option value=\"\">Select contact...</option>\n            </select>\n            \n            <!-- AI Suggestions Panel -->\n            <div id=\"suggestions-panel\" class=\"suggestions-panel-sota\" style=\"display: none;\"></div>\n          </section>\n\n          <!-- Potential Answers Section -->\n          <section class=\"detail-section\" id=\"answers-section\">\n            <div class=\"section-header\">\n              <h3>Potential Answers</h3>\n              <button class=\"btn btn-secondary btn-sm\" id=\"check-answers-btn\">\n                Check Knowledge Base\n              </button>\n            </div>\n            <div id=\"potential-answers\" class=\"potential-answers\">\n              <p class=\"empty-state\">Click \"Check Knowledge Base\" to find potential answers</p>\n            </div>\n          </section>\n\n          <!-- Answer Form Section -->\n          <section class=\"detail-section\" id=\"answer-section\">\n            <h3>${question.answer ? 'Current Answer' : 'Your Answer'}</h3>\n            ${question.answer ? renderExistingAnswer(question) : ''}\n            <div class=\"answer-form\" ${question.status === 'resolved' ? 'style=\"display:none;\"' : ''}>\n              <div class=\"form-group\">\n                <textarea id=\"answer-input\" rows=\"4\" \n                  placeholder=\"Type your answer here...\">${question.answer || ''}</textarea>\n              </div>\n              <div class=\"form-row answer-form-row\">\n                <div class=\"form-group source-group\">\n                  <label>Source</label>\n                  <div class=\"source-options\">\n                    <label class=\"source-option ${question.answer_source === 'manual' || !question.answer_source ? 'active' : ''}\">\n                      <input type=\"radio\" name=\"answer-source\" value=\"manual\" ${question.answer_source === 'manual' || !question.answer_source ? 'checked' : ''}>\n                      <span class=\"source-icon\"></span>\n                      <span class=\"source-label\">Manual</span>\n                    </label>\n                    <label class=\"source-option ${question.answer_source === 'document' ? 'active' : ''}\">\n                      <input type=\"radio\" name=\"answer-source\" value=\"document\" ${question.answer_source === 'document' ? 'checked' : ''}>\n                      <span class=\"source-icon\"></span>\n                      <span class=\"source-label\">Document</span>\n                    </label>\n                    <label class=\"source-option ${question.answer_source === 'ai' ? 'active' : ''}\">\n                      <input type=\"radio\" name=\"answer-source\" value=\"ai\" ${question.answer_source === 'ai' ? 'checked' : ''}>\n                      <span class=\"source-icon\"></span>\n                      <span class=\"source-label\">AI</span>\n                    </label>\n                  </div>\n                </div>\n                <div class=\"form-group answered-by-group\">\n                  <label>Answered By</label>\n                  <div class=\"answered-by-picker\">\n                    <div id=\"answered-by-display\" class=\"answered-by-display\">\n                      ${question.answered_by_contact_id || question.answered_by_name ? `\n                        <div class=\"answered-by-card\" id=\"current-answerer\">\n                          <div class=\"answerer-avatar\" id=\"answerer-avatar\">${getInitials(question.answered_by_name || '')}</div>\n                          <span class=\"answerer-name\">${escapeHtml(question.answered_by_name || 'Contact')}</span>\n                          <button type=\"button\" class=\"btn-clear-answerer\" id=\"clear-answerer\"></button>\n                        </div>\n                      ` : `\n                        <button type=\"button\" class=\"btn-select-answerer\" id=\"show-answerer-picker\">\n                          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                          </svg>\n                          Select who answered...\n                        </button>\n                      `}\n                    </div>\n                    <!-- Hidden select for form -->\n                    <select id=\"answered-by-contact\" class=\"form-select\" style=\"display: none;\">\n                      <option value=\"\">Select who answered...</option>\n                    </select>\n                    <!-- Contact picker dropdown -->\n                    <div id=\"answerer-picker-dropdown\" class=\"answerer-picker-dropdown\" style=\"display: none;\">\n                      <div class=\"picker-search-sm\">\n                        <input type=\"text\" id=\"answerer-search\" placeholder=\"Search contacts...\">\n                      </div>\n                      <div id=\"answerer-list\" class=\"answerer-list\"></div>\n                      <div class=\"answerer-other\">\n                        <input type=\"text\" id=\"answerer-other-name\" placeholder=\"Or type a name...\">\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"form-group\">\n                <label>Follow-up Questions (one per line)</label>\n                <textarea id=\"followup-input\" rows=\"2\" \n                  placeholder=\"Add any follow-up questions...\"></textarea>\n              </div>\n              <div class=\"form-actions\">\n                <button class=\"btn btn-primary\" id=\"save-answer-btn\">\n                  ${question.answer ? 'Update Answer' : 'Save Answer'}\n                </button>\n              </div>\n            </div>\n          </section>\n        </div>\n\n        <div class=\"detail-column-right\">\n          <!-- Follow-up Chain Section -->\n          <section class=\"detail-section\" id=\"chain-section\">\n            <h3>Follow-up Chain</h3>\n            <div id=\"chain-content\" class=\"chain-content\">\n              <div class=\"loading\">Loading...</div>\n            </div>\n          </section>\n\n          <!-- Similar Questions Section -->\n          <section class=\"detail-section\" id=\"similar-section\">\n            <h3>Similar Questions</h3>\n            <div id=\"similar-content\" class=\"similar-content\">\n              <div class=\"loading\">Loading...</div>\n            </div>\n          </section>\n\n          <!-- Timeline Section -->\n          <section class=\"detail-section\" id=\"timeline-section\">\n            <h3>Timeline</h3>\n            <div id=\"timeline-content\" class=\"timeline-content\">\n              <div class=\"loading\">Loading...</div>\n            </div>\n          </section>\n        </div>\n      </div>\n\n    </div>\n\n    <!-- Actions Bar - Outside scrollable content for proper click handling -->\n    <div class=\"detail-actions\">\n      ${question.status === 'resolved' || question.status === 'dismissed' ? `\n        <button class=\"btn btn-warning\" id=\"reopen-btn\">Reopen</button>\n      ` : ''}\n      ${question.status === 'deferred' ? `\n        <button class=\"btn btn-info\" id=\"undefer-btn\">Resume Now</button>\n      ` : `\n        <button class=\"btn btn-secondary\" id=\"defer-btn\">Defer</button>\n      `}\n      ${question.was_useful === undefined && question.answer ? `\n        <div class=\"feedback-buttons\">\n          <span class=\"feedback-label\">Was this helpful?</span>\n          <button class=\"btn btn-sm btn-success\" id=\"feedback-yes\">Yes</button>\n          <button class=\"btn btn-sm btn-secondary\" id=\"feedback-no\">No</button>\n        </div>\n      ` : ''}\n      <button class=\"btn btn-secondary\" id=\"edit-btn\">Edit</button>\n      <div class=\"dropdown dismiss-dropdown\">\n        <button class=\"btn btn-danger\" id=\"dismiss-btn\">Dismiss </button>\n        <div class=\"dropdown-menu\" id=\"dismiss-menu\">\n          <a href=\"#\" data-reason=\"duplicate\">Duplicate</a>\n          <a href=\"#\" data-reason=\"not_relevant\">Not Relevant</a>\n          <a href=\"#\" data-reason=\"out_of_scope\">Out of Scope</a>\n          <a href=\"#\" data-reason=\"answered_elsewhere\">Answered Elsewhere</a>\n          <a href=\"#\" data-reason=\"no_longer_needed\">No Longer Needed</a>\n          <a href=\"#\" data-reason=\"other\">Other...</a>\n        </div>\n      </div>\n    </div>\n  `;\n\n  // Bind events\n  bindEvents(container, props);\n\n  // Load async data\n  loadContacts(container);\n  loadChain(container, question.id, onNavigateToQuestion);\n  loadSimilar(container, question.id, onNavigateToQuestion);\n  loadTimeline(container, question.id);\n\n  return container;\n}\n\n/**\n * Render extracted entities as tags\n */\nfunction renderEntities(question: Question): string {\n  const entities = question.extracted_entities || [];\n  const topics = question.extracted_topics || [];\n  \n  if (entities.length === 0 && topics.length === 0) {\n    return '';\n  }\n\n  const tags = [\n    ...entities.map(e => `<span class=\"entity-tag entity-${e.type}\">@${e.name}</span>`),\n    ...topics.map(t => `<span class=\"entity-tag entity-topic\">#${t.name}</span>`)\n  ];\n\n  return `<div class=\"question-entities\">${tags.join('')}</div>`;\n}\n\n/**\n * Get initials from name\n */\nfunction getInitials(name: string): string {\n  if (!name) return '?';\n  const parts = name.trim().split(/\\s+/);\n  if (parts.length === 1) {\n    return parts[0].substring(0, 2).toUpperCase();\n  }\n  return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\n}\n\n/**\n * Get avatar HTML for a contact\n */\nfunction getContactAvatar(contact: { name: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string }): string {\n  const photoUrl = contact.photoUrl || contact.avatarUrl || contact.photo_url || contact.avatar_url;\n  if (photoUrl) {\n    return `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\" onerror=\"this.style.display='none'; this.nextElementSibling.style.display='flex';\">\n            <span class=\"avatar-fallback\" style=\"display:none;\">${getInitials(contact.name)}</span>`;\n  }\n  return getInitials(contact.name);\n}\n\n/**\n * Get score color based on value\n */\nfunction getScoreColor(score: number): string {\n  if (score >= 75) return '#10b981'; // green\n  if (score >= 50) return '#f59e0b'; // amber\n  return '#6b7280'; // gray\n}\n\n/**\n * Render existing answer display\n */\nfunction renderExistingAnswer(question: Question): string {\n  if (!question.answer) return '';\n\n  return `\n    <div class=\"existing-answer\">\n      <div class=\"answer-text\">${escapeHtml(question.answer)}</div>\n      <div class=\"answer-meta\">\n        <span class=\"answer-source-badge\">${question.answer_source || 'manual'}</span>\n        ${question.answered_by_name ? `<span class=\"answered-by\">by ${escapeHtml(question.answered_by_name)}</span>` : ''}\n        ${question.answered_at ? `<span class=\"answered-date\">${formatRelativeTime(question.answered_at)}</span>` : ''}\n      </div>\n      ${question.answer_provenance ? renderProvenance(question.answer_provenance) : ''}\n    </div>\n  `;\n}\n\n/**\n * Render answer provenance chain\n */\nfunction renderProvenance(provenance: { sources?: Array<{ type: string; content: string; confidence: number }> }): string {\n  if (!provenance.sources || provenance.sources.length === 0) return '';\n\n  const sources = provenance.sources.map(s => `\n    <div class=\"provenance-source\">\n      <span class=\"source-type\">${s.type}</span>\n      <span class=\"source-content\">${escapeHtml(s.content.substring(0, 100))}...</span>\n      <span class=\"source-confidence\">${Math.round(s.confidence * 100)}%</span>\n    </div>\n  `).join('');\n\n  return `\n    <div class=\"answer-provenance\">\n      <div class=\"provenance-label\">Sources:</div>\n      ${sources}\n    </div>\n  `;\n}\n\n/**\n * Bind all event handlers\n */\nfunction bindEvents(container: HTMLElement, props: QuestionDetailViewProps): void {\n  const { onClose, onUpdate } = props;\n\n  // Close button\n  const closeBtn = container.querySelector('#close-detail');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', onClose);\n  }\n\n  // Back to list link\n  const backLink = container.querySelector('#back-to-list');\n  if (backLink) {\n    on(backLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      onClose();\n    });\n  }\n\n  // AI Suggest button\n  const aiSuggestBtn = container.querySelector('#ai-suggest-btn');\n  if (aiSuggestBtn) {\n    on(aiSuggestBtn as HTMLElement, 'click', () => loadAISuggestions(container));\n  }\n\n  // Check answers button\n  const checkAnswersBtn = container.querySelector('#check-answers-btn');\n  if (checkAnswersBtn) {\n    on(checkAnswersBtn as HTMLElement, 'click', () => checkPotentialAnswers(container));\n  }\n\n  // Save answer button\n  const saveAnswerBtn = container.querySelector('#save-answer-btn');\n  if (saveAnswerBtn) {\n    on(saveAnswerBtn as HTMLElement, 'click', () => saveAnswer(container, onUpdate));\n  }\n\n  // Reopen button\n  const reopenBtn = container.querySelector('#reopen-btn');\n  if (reopenBtn) {\n    on(reopenBtn as HTMLElement, 'click', () => reopenQuestion(container, onUpdate));\n  }\n\n  // Dismiss button and dropdown\n  const dismissBtn = container.querySelector('#dismiss-btn');\n  const dismissMenu = container.querySelector('#dismiss-menu');\n  console.log('[QuestionDetail] Dismiss btn found:', !!dismissBtn, 'Menu found:', !!dismissMenu);\n  \n  if (dismissBtn && dismissMenu) {\n    on(dismissBtn as HTMLElement, 'click', (e) => {\n      console.log('[QuestionDetail] Dismiss button clicked');\n      e.stopPropagation();\n      dismissMenu.classList.toggle('show');\n    });\n    \n    // Dismiss reasons\n    const reasonLinks = dismissMenu.querySelectorAll('a[data-reason]');\n    console.log('[QuestionDetail] Dismiss reason links:', reasonLinks.length);\n    \n    reasonLinks.forEach(link => {\n      on(link as HTMLElement, 'click', async (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        const reason = link.getAttribute('data-reason') as 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other';\n        console.log('[QuestionDetail] Dismiss reason clicked:', reason);\n        dismissMenu.classList.remove('show');\n        \n        let details: string | undefined;\n        if (reason === 'other') {\n          details = prompt('Please provide a reason for dismissing this question:') || undefined;\n          if (!details) return;\n        }\n        \n        try {\n          console.log('[QuestionDetail] Calling dismissQuestionWithReason...');\n          await dismissQuestionWithReason(container, props, reason, details);\n          console.log('[QuestionDetail] Dismiss completed');\n        } catch (err) {\n          console.error('[QuestionDetail] Dismiss error:', err);\n        }\n      });\n    });\n    \n    // Close dropdown on outside click\n    document.addEventListener('click', (e) => {\n      if (!(e.target as HTMLElement).closest('.dismiss-dropdown')) {\n        dismissMenu.classList.remove('show');\n      }\n    });\n  } else {\n    console.warn('[QuestionDetail] Dismiss button or menu not found!');\n  }\n\n  // Defer button\n  const deferBtn = container.querySelector('#defer-btn');\n  if (deferBtn) {\n    on(deferBtn as HTMLElement, 'click', () => showDeferDialog(container, onUpdate));\n  }\n\n  // Undefer button\n  const undeferBtn = container.querySelector('#undefer-btn');\n  if (undeferBtn) {\n    on(undeferBtn as HTMLElement, 'click', () => reopenQuestion(container, onUpdate));\n  }\n\n  // Feedback buttons\n  const feedbackYes = container.querySelector('#feedback-yes');\n  const feedbackNo = container.querySelector('#feedback-no');\n  if (feedbackYes) {\n    on(feedbackYes as HTMLElement, 'click', () => submitFeedback(container, true, onUpdate));\n  }\n  if (feedbackNo) {\n    on(feedbackNo as HTMLElement, 'click', () => submitFeedback(container, false, onUpdate));\n  }\n\n  // Edit button\n  const editBtn = container.querySelector('#edit-btn');\n  if (editBtn) {\n    on(editBtn as HTMLElement, 'click', () => toggleEditMode(container));\n  }\n}\n\n/**\n * Load contacts for dropdowns\n */\nasync function loadContacts(container: HTMLElement): Promise<void> {\n  try {\n    const response = await contactsService.getAll();\n    contacts = response?.contacts || [];\n    \n    const assigneeSelect = container.querySelector('#assignee-select') as HTMLSelectElement;\n    const answeredBySelect = container.querySelector('#answered-by-contact') as HTMLSelectElement;\n    const contactList = container.querySelector('#contact-list') as HTMLElement;\n    const contactSearch = container.querySelector('#contact-search') as HTMLInputElement;\n\n    // Populate hidden select for form\n    if (assigneeSelect) {\n      for (const contact of contacts) {\n        const option = document.createElement('option');\n        option.value = contact.id;\n        option.textContent = `${contact.name}${contact.role ? ` (${contact.role})` : ''}`;\n        if (currentQuestion?.assigned_to === contact.name) {\n          option.selected = true;\n        }\n        assigneeSelect.appendChild(option);\n      }\n    }\n\n    // Populate answered by select\n    if (answeredBySelect) {\n      for (const contact of contacts) {\n        const option = document.createElement('option');\n        option.value = contact.id;\n        option.textContent = `${contact.name}${contact.role ? ` (${contact.role})` : ''}`;\n        if (currentQuestion?.answered_by_contact_id === contact.id) {\n          option.selected = true;\n        }\n        answeredBySelect.appendChild(option);\n      }\n      \n      // Add \"Other\" option for external\n      const otherOption = document.createElement('option');\n      otherOption.value = '__other__';\n      otherOption.textContent = '+ Other (type name)';\n      answeredBySelect.appendChild(otherOption);\n    }\n\n    // Render SOTA contact picker grid\n    if (contactList) {\n      renderContactGrid(container, contacts);\n      \n      // Bind search\n      if (contactSearch) {\n        contactSearch.addEventListener('input', () => {\n          const query = contactSearch.value.toLowerCase();\n          const filtered = contacts.filter(c => \n            c.name.toLowerCase().includes(query) ||\n            (c.role && c.role.toLowerCase().includes(query)) ||\n            (c.organization && c.organization.toLowerCase().includes(query))\n          );\n          renderContactGrid(container, filtered);\n        });\n      }\n    }\n    \n    // Update assigned contact avatar display\n    updateAssignedDisplay(container);\n    \n    // Bind picker toggle buttons\n    bindPickerButtons(container);\n    \n    // Setup answerer picker\n    setupAnswererPicker(container);\n    \n    // Setup source options\n    setupSourceOptions(container);\n    \n  } catch (e) {\n    console.error('Error loading contacts:', e);\n  }\n}\n\n/**\n * Setup the answerer picker functionality\n */\nfunction setupAnswererPicker(container: HTMLElement): void {\n  const showBtn = container.querySelector('#show-answerer-picker');\n  const dropdown = container.querySelector('#answerer-picker-dropdown') as HTMLElement;\n  const answererList = container.querySelector('#answerer-list') as HTMLElement;\n  const answererSearch = container.querySelector('#answerer-search') as HTMLInputElement;\n  const answererOtherInput = container.querySelector('#answerer-other-name') as HTMLInputElement;\n  \n  if (!dropdown || !answererList) return;\n  \n  // Render contacts in answerer list\n  const renderAnswererList = (filter = '') => {\n    const filtered = filter \n      ? contacts.filter(c => \n          c.name.toLowerCase().includes(filter.toLowerCase()) ||\n          (c.role && c.role.toLowerCase().includes(filter.toLowerCase()))\n        )\n      : contacts;\n    \n    answererList.innerHTML = filtered.map(contact => {\n      const photoUrl = contact.photoUrl || contact.avatarUrl || contact.photo_url || contact.avatar_url;\n      return `\n        <div class=\"answerer-item\" data-contact-id=\"${contact.id}\" data-contact-name=\"${escapeHtml(contact.name)}\">\n          <div class=\"answerer-avatar-sm\">\n            ${photoUrl \n              ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(contact.name)}'\">`\n              : getInitials(contact.name)\n            }\n          </div>\n          <div class=\"answerer-info\">\n            <span class=\"answerer-name\">${escapeHtml(contact.name)}</span>\n            ${contact.role ? `<span class=\"answerer-role\">${escapeHtml(contact.role)}</span>` : ''}\n          </div>\n        </div>\n      `;\n    }).join('');\n    \n    // Bind click handlers\n    answererList.querySelectorAll('.answerer-item').forEach(item => {\n      on(item as HTMLElement, 'click', () => {\n        const contactId = item.getAttribute('data-contact-id');\n        const contactName = item.getAttribute('data-contact-name');\n        selectAnswerer(container, contactId || '', contactName || '');\n        dropdown.style.display = 'none';\n      });\n    });\n  };\n  \n  // Show picker\n  if (showBtn) {\n    on(showBtn as HTMLElement, 'click', () => {\n      dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';\n      renderAnswererList();\n      if (answererSearch) answererSearch.focus();\n    });\n  }\n  \n  // Search filter\n  if (answererSearch) {\n    answererSearch.addEventListener('input', () => {\n      renderAnswererList(answererSearch.value);\n    });\n  }\n  \n  // Other name input\n  if (answererOtherInput) {\n    answererOtherInput.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') {\n        const name = answererOtherInput.value.trim();\n        if (name) {\n          selectAnswerer(container, '', name);\n          dropdown.style.display = 'none';\n        }\n      }\n    });\n  }\n  \n  // Clear button\n  const clearBtn = container.querySelector('#clear-answerer');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', () => {\n      selectAnswerer(container, '', '');\n    });\n  }\n  \n  // Close on outside click\n  document.addEventListener('click', (e) => {\n    const target = e.target as HTMLElement;\n    if (!target.closest('.answered-by-picker') && dropdown.style.display === 'block') {\n      dropdown.style.display = 'none';\n    }\n  });\n}\n\n/**\n * Select an answerer\n */\nfunction selectAnswerer(container: HTMLElement, contactId: string, contactName: string): void {\n  const display = container.querySelector('#answered-by-display') as HTMLElement;\n  const select = container.querySelector('#answered-by-contact') as HTMLSelectElement;\n  \n  if (select) {\n    select.value = contactId;\n  }\n  \n  if (display) {\n    if (contactName) {\n      const contact = contacts.find(c => c.id === contactId);\n      const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\n      \n      display.innerHTML = `\n        <div class=\"answered-by-card\" id=\"current-answerer\">\n          <div class=\"answerer-avatar\">\n            ${photoUrl \n              ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contactName)}\" onerror=\"this.parentElement.innerHTML='${getInitials(contactName)}'\">`\n              : getInitials(contactName)\n            }\n          </div>\n          <span class=\"answerer-name\">${escapeHtml(contactName)}</span>\n          <button type=\"button\" class=\"btn-clear-answerer\" id=\"clear-answerer\"></button>\n        </div>\n      `;\n      \n      // Re-bind clear button\n      const clearBtn = display.querySelector('#clear-answerer');\n      if (clearBtn) {\n        on(clearBtn as HTMLElement, 'click', (e) => {\n          e.stopPropagation();\n          selectAnswerer(container, '', '');\n        });\n      }\n    } else {\n      display.innerHTML = `\n        <button type=\"button\" class=\"btn-select-answerer\" id=\"show-answerer-picker\">\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n          </svg>\n          Select who answered...\n        </button>\n      `;\n      \n      // Re-setup picker\n      setupAnswererPicker(container);\n    }\n  }\n}\n\n/**\n * Setup source option radio buttons\n */\nfunction setupSourceOptions(container: HTMLElement): void {\n  const sourceOptions = container.querySelectorAll('.source-option input[type=\"radio\"]');\n  \n  sourceOptions.forEach(input => {\n    input.addEventListener('change', () => {\n      // Update active state\n      container.querySelectorAll('.source-option').forEach(opt => opt.classList.remove('active'));\n      (input as HTMLElement).closest('.source-option')?.classList.add('active');\n    });\n  });\n}\n\n/**\n * Render contact grid with cards\n */\nfunction renderContactGrid(container: HTMLElement, contactsToRender: typeof contacts): void {\n  const contactList = container.querySelector('#contact-list') as HTMLElement;\n  if (!contactList) return;\n  \n  if (contactsToRender.length === 0) {\n    contactList.innerHTML = '<div class=\"empty-state\">No contacts found</div>';\n    return;\n  }\n  \n  contactList.innerHTML = contactsToRender.map(contact => {\n    const photoUrl = contact.photoUrl || contact.avatarUrl || contact.photo_url || contact.avatar_url;\n    const isCurrentAssignee = currentQuestion?.assigned_to === contact.name;\n    \n    return `\n      <div class=\"contact-card-picker ${isCurrentAssignee ? 'selected' : ''}\" data-contact-id=\"${contact.id}\" data-contact-name=\"${escapeHtml(contact.name)}\">\n        <div class=\"contact-avatar-picker\">\n          ${photoUrl \n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(contact.name)}'\">`\n            : getInitials(contact.name)\n          }\n        </div>\n        <div class=\"contact-info-picker\">\n          <div class=\"contact-name-picker\">${escapeHtml(contact.name)}</div>\n          ${contact.role ? `<div class=\"contact-role-picker\">${escapeHtml(contact.role)}</div>` : ''}\n          ${contact.organization ? `<div class=\"contact-org-picker\">${escapeHtml(contact.organization)}</div>` : ''}\n        </div>\n        ${isCurrentAssignee ? '<div class=\"current-badge\">Current</div>' : ''}\n      </div>\n    `;\n  }).join('');\n  \n  // Bind click handlers\n  contactList.querySelectorAll('.contact-card-picker').forEach(card => {\n    on(card as HTMLElement, 'click', async () => {\n      const contactId = card.getAttribute('data-contact-id');\n      const contactName = card.getAttribute('data-contact-name');\n      const assigneeSelect = container.querySelector('#assignee-select') as HTMLSelectElement;\n      const picker = container.querySelector('#contact-picker') as HTMLElement;\n      \n      if (contactId && assigneeSelect && currentQuestion) {\n        assigneeSelect.value = contactId;\n        \n        // Save to server FIRST\n        try {\n          await questionsService.update(currentQuestion.id, {\n            assigned_to: contactName || undefined,\n            status: 'assigned'\n          });\n          \n          // Update current question state\n          currentQuestion.assigned_to = contactName || undefined;\n          currentQuestion.status = 'assigned';\n          \n          // Update display\n          updateAssignedDisplay(container);\n          \n          // Hide picker\n          if (picker) {\n            picker.style.display = 'none';\n          }\n          \n          toast.success(`Assigned to ${contactName}`);\n        } catch (e) {\n          console.error('[QuestionDetail] Failed to save assignment:', e);\n          toast.error('Failed to save assignment');\n        }\n      }\n    });\n  });\n}\n\n/**\n * Update assigned contact display\n */\nfunction updateAssignedDisplay(container: HTMLElement): void {\n  const display = container.querySelector('#current-assignment') as HTMLElement;\n  if (!display || !currentQuestion) return;\n  \n  if (currentQuestion.assigned_to) {\n    const contact = contacts.find(c => c.name === currentQuestion?.assigned_to);\n    const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\n    \n    display.innerHTML = `\n      <div class=\"assigned-contact-display\">\n        <div class=\"contact-avatar-lg\">\n          ${photoUrl \n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(currentQuestion.assigned_to)}\" onerror=\"this.parentElement.innerHTML='${getInitials(currentQuestion.assigned_to)}'\">`\n            : getInitials(currentQuestion.assigned_to)\n          }\n        </div>\n        <div class=\"contact-details\">\n          <div class=\"contact-name-lg\">${escapeHtml(currentQuestion.assigned_to)}</div>\n          <div class=\"contact-role-sm\">${contact?.role || 'Team Member'}</div>\n          ${contact?.organization ? `<div class=\"contact-org-sm\">${escapeHtml(contact.organization)}</div>` : ''}\n        </div>\n        <button class=\"btn-change-assignment\" id=\"change-assignee-btn\">\n          <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/>\n          </svg>\n          Change\n        </button>\n      </div>\n    `;\n  } else {\n    display.innerHTML = `\n      <div class=\"no-assignment\">\n        <div class=\"no-assignment-icon\">\n          <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\n          </svg>\n        </div>\n        <span>No one assigned yet</span>\n        <button class=\"btn-assign-now\" id=\"show-picker-btn\">Assign Someone</button>\n      </div>\n    `;\n  }\n  \n  // Re-bind picker buttons\n  bindPickerButtons(container);\n}\n\n/**\n * Bind picker toggle buttons\n */\nfunction bindPickerButtons(container: HTMLElement): void {\n  const showPickerBtn = container.querySelector('#show-picker-btn');\n  const changeBtn = container.querySelector('#change-assignee-btn');\n  const picker = container.querySelector('#contact-picker') as HTMLElement;\n  \n  if (showPickerBtn && picker) {\n    on(showPickerBtn as HTMLElement, 'click', () => {\n      picker.style.display = picker.style.display === 'none' ? 'block' : 'none';\n      const searchInput = picker.querySelector('#contact-search') as HTMLInputElement;\n      if (searchInput) {\n        searchInput.focus();\n      }\n    });\n  }\n  \n  if (changeBtn && picker) {\n    on(changeBtn as HTMLElement, 'click', () => {\n      picker.style.display = picker.style.display === 'none' ? 'block' : 'none';\n      const searchInput = picker.querySelector('#contact-search') as HTMLInputElement;\n      if (searchInput) {\n        searchInput.focus();\n      }\n    });\n  }\n}\n\n/**\n * Load question chain (parent + children)\n */\nasync function loadChain(\n  container: HTMLElement, \n  questionId: string | number,\n  onNavigate?: (id: string) => void\n): Promise<void> {\n  const chainContent = container.querySelector('#chain-content');\n  if (!chainContent) return;\n\n  try {\n    const response = await http.get<{ parent: Question | null; children: Question[] }>(\n      `/api/questions/${questionId}/chain`\n    );\n    const { parent, children } = response.data;\n\n    if (!parent && children.length === 0) {\n      chainContent.innerHTML = '<p class=\"empty-state\">No follow-up chain</p>';\n      return;\n    }\n\n    let html = '';\n\n    if (parent) {\n      html += `\n        <div class=\"chain-item chain-parent\" data-id=\"${parent.id}\">\n          <span class=\"chain-arrow\"></span>\n          <span class=\"chain-label\">Parent:</span>\n          <span class=\"chain-content\">${escapeHtml(parent.content.substring(0, 50))}...</span>\n          <span class=\"status-badge status-${parent.status}\">${parent.status}</span>\n        </div>\n      `;\n    }\n\n    html += `<div class=\"chain-item chain-current\">This question</div>`;\n\n    for (const child of children) {\n      html += `\n        <div class=\"chain-item chain-child\" data-id=\"${child.id}\">\n          <span class=\"chain-arrow\"></span>\n          <span class=\"chain-content\">${escapeHtml(child.content.substring(0, 50))}...</span>\n          <span class=\"status-badge status-${child.status}\">${child.status}</span>\n        </div>\n      `;\n    }\n\n    chainContent.innerHTML = html;\n\n    // Bind click handlers for navigation\n    chainContent.querySelectorAll('.chain-item[data-id]').forEach(item => {\n      on(item as HTMLElement, 'click', () => {\n        const id = item.getAttribute('data-id');\n        if (id && onNavigate) {\n          onNavigate(id);\n        }\n      });\n    });\n  } catch (e) {\n    chainContent.innerHTML = '<p class=\"error\">Failed to load chain</p>';\n  }\n}\n\n/**\n * Load similar questions\n */\nasync function loadSimilar(\n  container: HTMLElement, \n  questionId: string | number,\n  onNavigate?: (id: string) => void\n): Promise<void> {\n  const similarContent = container.querySelector('#similar-content');\n  if (!similarContent) return;\n\n  try {\n    const response = await http.get<{ similar: SimilarQuestion[] }>(\n      `/api/questions/${questionId}/similar?limit=5`\n    );\n    const { similar } = response.data;\n\n    if (!similar || similar.length === 0) {\n      similarContent.innerHTML = '<p class=\"empty-state\">No similar questions found</p>';\n      return;\n    }\n\n    const html = similar.map(q => `\n      <div class=\"similar-item\" data-id=\"${q.id}\">\n        <div class=\"similar-content\">${escapeHtml(q.content.substring(0, 60))}...</div>\n        <div class=\"similar-meta\">\n          <span class=\"status-badge status-${q.status}\">${q.status}</span>\n          <span class=\"similarity-score\">${Math.round(q.similarityScore * 100)}%</span>\n        </div>\n      </div>\n    `).join('');\n\n    similarContent.innerHTML = html;\n\n    // Bind click handlers\n    similarContent.querySelectorAll('.similar-item').forEach(item => {\n      on(item as HTMLElement, 'click', () => {\n        const id = item.getAttribute('data-id');\n        if (id && onNavigate) {\n          onNavigate(id);\n        }\n      });\n    });\n  } catch (e) {\n    similarContent.innerHTML = '<p class=\"error\">Failed to load similar questions</p>';\n  }\n}\n\n/**\n * Load timeline events\n */\nasync function loadTimeline(container: HTMLElement, questionId: string | number): Promise<void> {\n  const timelineContent = container.querySelector('#timeline-content');\n  if (!timelineContent) return;\n\n  try {\n    const response = await http.get<{ events: TimelineEvent[] }>(\n      `/api/questions/${questionId}/timeline`\n    );\n    const { events } = response.data;\n\n    if (!events || events.length === 0) {\n      timelineContent.innerHTML = '<p class=\"empty-state\">No events recorded</p>';\n      return;\n    }\n\n    const html = events.map(e => {\n      const icon = getEventIcon(e.event_type);\n      const description = getEventDescription(e);\n      \n      return `\n        <div class=\"timeline-item\">\n          <div class=\"timeline-icon\">${icon}</div>\n          <div class=\"timeline-content\">\n            <div class=\"timeline-title\">${description}</div>\n            <div class=\"timeline-date\">${formatDateTime(e.created_at)}</div>\n          </div>\n        </div>\n      `;\n    }).join('');\n\n    timelineContent.innerHTML = `<div class=\"timeline-list\">${html}</div>`;\n  } catch (e) {\n    timelineContent.innerHTML = '<p class=\"error\">Failed to load timeline</p>';\n  }\n}\n\n/**\n * Get icon for event type\n */\nfunction getEventIcon(eventType: string): string {\n  const icons: Record<string, string> = {\n    created: '',\n    assigned: '',\n    answered: '',\n    priority_changed: '',\n    status_changed: '',\n    reopened: '',\n    dismissed: '',\n    sla_breached: '',\n    entity_extracted: '',\n    similar_linked: ''\n  };\n  return icons[eventType] || '';\n}\n\n/**\n * Get description for event\n */\nfunction getEventDescription(event: TimelineEvent): string {\n  const data = event.event_data || {};\n  \n  switch (event.event_type) {\n    case 'created':\n      return `Created${event.actor_name ? ` by ${event.actor_name}` : ''}`;\n    case 'assigned':\n      return `Assigned to ${data.to || 'someone'}${event.actor_name ? ` by ${event.actor_name}` : ''}`;\n    case 'answered':\n      return `Answered${event.actor_name ? ` by ${event.actor_name}` : ''} (${data.source || 'manual'})`;\n    case 'priority_changed':\n      return `Priority changed: ${data.from}  ${data.to}`;\n    case 'status_changed':\n      return `Status changed: ${data.from}  ${data.to}`;\n    case 'reopened':\n      return `Reopened${event.actor_name ? ` by ${event.actor_name}` : ''}`;\n    case 'dismissed':\n      return `Dismissed${event.actor_name ? ` by ${event.actor_name}` : ''}`;\n    case 'sla_breached':\n      return 'SLA breached';\n    case 'entity_extracted':\n      return `Entities extracted: ${(data.entities as Array<{name: string}>)?.length || 0}`;\n    default:\n      return event.event_type;\n  }\n}\n\n/**\n * Load AI suggestions for assignee\n */\nasync function loadAISuggestions(container: HTMLElement): Promise<void> {\n  const panel = container.querySelector('#suggestions-panel') as HTMLElement;\n  const btn = container.querySelector('#ai-suggest-btn') as HTMLButtonElement;\n  \n  if (!panel || !currentQuestion) return;\n\n  btn.disabled = true;\n  btn.innerHTML = `\n    <svg class=\"spin\" width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\n    </svg>\n    Analyzing...\n  `;\n  panel.style.display = 'block';\n  panel.innerHTML = `\n    <div class=\"suggestions-loading\">\n      <div class=\"ai-thinking-animation\">\n        <span></span><span></span><span></span>\n      </div>\n      <div class=\"loading-text\">AI is analyzing question context and team expertise...</div>\n    </div>\n  `;\n\n  try {\n    const result = await questionsService.suggestAssignee({\n      id: currentQuestion.id,\n      useAI: true\n    });\n\n    if (result.suggestions.length === 0) {\n      panel.innerHTML = `\n        <div class=\"no-suggestions\">\n          <svg width=\"40\" height=\"40\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n          </svg>\n          <div class=\"no-suggestions-text\">No matching experts found</div>\n          <button class=\"btn-show-all-contacts\" id=\"show-all-btn\">Browse all contacts</button>\n        </div>\n      `;\n      \n      // Bind show all button\n      const showAllBtn = panel.querySelector('#show-all-btn');\n      if (showAllBtn) {\n        on(showAllBtn as HTMLElement, 'click', () => {\n          panel.style.display = 'none';\n          const picker = container.querySelector('#contact-picker') as HTMLElement;\n          if (picker) {\n            picker.style.display = 'block';\n          }\n        });\n      }\n    } else {\n      panel.innerHTML = `\n        <div class=\"suggestions-header-sota\">\n          <div class=\"ai-badge\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n            </svg>\n            AI Recommended\n          </div>\n          ${result.cached ? '<span class=\"cached-tag\">Cached</span>' : '<span class=\"fresh-tag\">Fresh</span>'}\n        </div>\n        <div class=\"suggestions-list-sota\">\n          ${result.suggestions.map((s, i) => {\n            const contact = contacts.find(c => (c.name || '').trim().toLowerCase() === (s.person || '').trim().toLowerCase())\n              || contacts.find(c => (c.aliases || []).some(a => String(a).trim().toLowerCase() === (s.person || '').trim().toLowerCase()));\n            const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\n            const roleDisplay = contact?.role ?? s.role ?? '';\n            const scoreColor = getScoreColor(s.score);\n            \n            return `\n              <div class=\"suggestion-card-sota\" data-index=\"${i}\">\n                <div class=\"suggestion-rank\">#${i + 1}</div>\n                <div class=\"suggestion-avatar-sota\">\n                  ${photoUrl \n                    ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(s.person)}\" onerror=\"this.parentElement.innerHTML='${getInitials(s.person)}'\">`\n                    : getInitials(s.person)\n                  }\n                </div>\n                <div class=\"suggestion-info-sota\">\n                  <div class=\"suggestion-name-sota\">${escapeHtml(s.person)}</div>\n                  ${roleDisplay ? `<div class=\"suggestion-role-sota\">${escapeHtml(roleDisplay)}</div>` : ''}\n                  <div class=\"suggestion-reason-sota\">${escapeHtml(s.reason)}</div>\n                </div>\n                <div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\">\n                  <div class=\"score-ring\">\n                    <svg viewBox=\"0 0 36 36\">\n                      <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                      <path class=\"score-fill\" stroke-dasharray=\"${s.score}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                    </svg>\n                    <div class=\"score-value\">${s.score}%</div>\n                  </div>\n                  <div class=\"score-label\">Match</div>\n                </div>\n                <button class=\"btn-select-suggestion\">\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n                  </svg>\n                  Assign\n                </button>\n              </div>\n            `;\n          }).join('')}\n        </div>\n        <div class=\"suggestions-footer\">\n          <button class=\"btn-link\" id=\"hide-suggestions-btn\">Close suggestions</button>\n        </div>\n      `;\n\n      // Bind click to select\n      panel.querySelectorAll('.suggestion-card-sota').forEach(item => {\n        const selectBtn = item.querySelector('.btn-select-suggestion');\n        if (selectBtn) {\n          on(selectBtn as HTMLElement, 'click', async (e) => {\n            e.stopPropagation();\n            const idx = parseInt(item.getAttribute('data-index') || '0');\n            const suggestion = result.suggestions[idx];\n            if (suggestion && currentQuestion) {\n              const select = container.querySelector('#assignee-select') as HTMLSelectElement;\n              const contact = contacts.find(c => c.name === suggestion.person);\n              \n              // Save to server FIRST\n              try {\n                await questionsService.update(currentQuestion.id, {\n                  assigned_to: suggestion.person,\n                  status: 'assigned'\n                });\n                \n                if (contact && select) {\n                  select.value = contact.id;\n                }\n                // Update current question state\n                currentQuestion.assigned_to = suggestion.person;\n                currentQuestion.status = 'assigned';\n                \n                // Update display\n                updateAssignedDisplay(container);\n                panel.style.display = 'none';\n                toast.success(`Assigned to ${suggestion.person}`);\n              } catch (err) {\n                console.error('[QuestionDetail] Failed to save AI suggestion assignment:', err);\n                toast.error('Failed to save assignment');\n              }\n            }\n          });\n        }\n      });\n      \n      // Bind hide button\n      const hideBtn = panel.querySelector('#hide-suggestions-btn');\n      if (hideBtn) {\n        on(hideBtn as HTMLElement, 'click', () => {\n          panel.style.display = 'none';\n        });\n      }\n    }\n  } catch (e) {\n    const isTimeout = (err: unknown) =>\n      (err as { message?: string; status?: number }).message === 'Request timed out' ||\n      (err as { status?: number }).status === 0;\n    const timeoutMessage = isTimeout(e);\n    panel.innerHTML = `\n      <div class=\"suggestions-error\">\n        <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n        </svg>\n        <div>${timeoutMessage ? 'This took longer than expected.' : 'Failed to get AI suggestions.'}</div>\n        ${timeoutMessage ? '<p class=\"suggestions-error-hint\">You can try again (suggestions may be ready) or choose someone manually.</p>' : ''}\n        <button class=\"btn-retry\" id=\"retry-suggestions-btn\">Try Again</button>\n      </div>\n    `;\n    \n    const retryBtn = panel.querySelector('#retry-suggestions-btn');\n    if (retryBtn) {\n      on(retryBtn as HTMLElement, 'click', () => loadAISuggestions(container));\n    }\n  } finally {\n    btn.disabled = false;\n    btn.innerHTML = `\n      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n      </svg>\n      AI Suggest\n    `;\n  }\n}\n\n/**\n * Check for potential answers in knowledge base\n */\nasync function checkPotentialAnswers(container: HTMLElement): Promise<void> {\n  const answersDiv = container.querySelector('#potential-answers') as HTMLElement;\n  const btn = container.querySelector('#check-answers-btn') as HTMLButtonElement;\n  \n  if (!answersDiv || !currentQuestion) return;\n\n  btn.disabled = true;\n  btn.textContent = 'Checking...';\n  answersDiv.innerHTML = '<div class=\"loading\">Searching knowledge base...</div>';\n\n  try {\n    const response = await http.post<{ potentialAnswers: PotentialAnswer[] }>(\n      `/api/questions/${currentQuestion.id}/check-answer`,\n      {}\n    );\n    const { potentialAnswers } = response.data;\n\n    if (!potentialAnswers || potentialAnswers.length === 0) {\n      answersDiv.innerHTML = '<p class=\"empty-state\">No potential answers found in knowledge base</p>';\n    } else {\n      answersDiv.innerHTML = potentialAnswers.map(a => `\n        <div class=\"potential-answer\" data-content=\"${escapeHtml(a.content)}\">\n          <div class=\"answer-header\">\n            <span class=\"answer-type\">${a.type.toUpperCase()}</span>\n            <span class=\"answer-confidence\">${Math.round(a.confidence * 100)}%</span>\n          </div>\n          <div class=\"answer-content\">${escapeHtml(a.content.substring(0, 200))}...</div>\n          ${a.source ? `<div class=\"answer-source\">Source: ${escapeHtml(a.source)}</div>` : ''}\n          <button class=\"btn btn-sm btn-secondary use-answer-btn\">Use This</button>\n        </div>\n      `).join('');\n\n      // Bind \"Use This\" buttons\n      answersDiv.querySelectorAll('.use-answer-btn').forEach(btn => {\n        on(btn as HTMLElement, 'click', (e) => {\n          e.stopPropagation();\n          const parent = (btn as HTMLElement).closest('.potential-answer');\n          const content = parent?.getAttribute('data-content');\n          if (content) {\n            const answerInput = container.querySelector('#answer-input') as HTMLTextAreaElement;\n            if (answerInput) {\n              answerInput.value = content;\n              toast.success('Answer filled from knowledge base');\n            }\n          }\n        });\n      });\n    }\n  } catch (e) {\n    answersDiv.innerHTML = '<p class=\"error\">Failed to check knowledge base</p>';\n  } finally {\n    btn.disabled = false;\n    btn.textContent = 'Check Knowledge Base';\n  }\n}\n\n/**\n * Save answer\n */\nasync function saveAnswer(\n  container: HTMLElement, \n  onUpdate?: (question: Question) => void\n): Promise<void> {\n  if (!currentQuestion) return;\n\n  const answerInput = container.querySelector('#answer-input') as HTMLTextAreaElement;\n  const sourceSelect = container.querySelector('#answer-source') as HTMLSelectElement;\n  const answeredBySelect = container.querySelector('#answered-by-contact') as HTMLSelectElement;\n  const followupInput = container.querySelector('#followup-input') as HTMLTextAreaElement;\n  const saveBtn = container.querySelector('#save-answer-btn') as HTMLButtonElement;\n\n  const answer = answerInput?.value.trim();\n  const source = sourceSelect?.value || 'manual';\n  const answeredByContactId = answeredBySelect?.value !== '__other__' ? answeredBySelect?.value : undefined;\n  const followupQuestions = followupInput?.value.trim();\n\n  if (!answer || answer.length < 3) {\n    toast.warning('Please provide an answer (at least 3 characters)');\n    return;\n  }\n\n  // Get contact name if selected\n  let answeredByName: string | undefined;\n  if (answeredByContactId) {\n    const contact = contacts.find(c => c.id === answeredByContactId);\n    answeredByName = contact?.name;\n  }\n\n  saveBtn.disabled = true;\n  saveBtn.textContent = 'Saving...';\n\n  try {\n    const result = await questionsService.answer(currentQuestion.id, {\n      answer,\n      source: source as 'manual' | 'document' | 'ai',\n      followupQuestions,\n      answeredByContactId,\n      answeredByName\n    });\n\n    toast.success(result.message);\n    \n    if (onUpdate && result.question) {\n      currentQuestion = result.question;\n      onUpdate(result.question);\n    }\n  } catch (e) {\n    toast.error('Failed to save answer');\n  } finally {\n    saveBtn.disabled = false;\n    saveBtn.textContent = 'Save Answer';\n  }\n}\n\n/**\n * Reopen question\n */\nasync function reopenQuestion(\n  container: HTMLElement,\n  onUpdate?: (question: Question) => void\n): Promise<void> {\n  if (!currentQuestion) return;\n\n  const reason = prompt('Why are you reopening this question?');\n  if (!reason) return;\n\n  try {\n    const updated = await questionsService.reopen(currentQuestion.id, reason);\n    toast.success('Question reopened');\n    currentQuestion = updated;\n    if (onUpdate) onUpdate(updated);\n  } catch (e) {\n    toast.error('Failed to reopen question');\n  }\n}\n\n/**\n * Dismiss question with reason\n */\nasync function dismissQuestionWithReason(\n  container: HTMLElement,\n  props: QuestionDetailViewProps,\n  reason: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other',\n  details?: string\n): Promise<void> {\n  console.log('[QuestionDetail] dismissQuestionWithReason called, reason:', reason);\n  \n  if (!currentQuestion) {\n    console.error('[QuestionDetail] No current question!');\n    toast.error('No question selected');\n    return;\n  }\n\n  console.log('[QuestionDetail] Dismissing question:', currentQuestion.id);\n\n  try {\n    const updated = await questionsService.dismissQuestion(currentQuestion.id, reason, details);\n    console.log('[QuestionDetail] Dismiss API response:', updated);\n    toast.success(`Question dismissed: ${reason.replace(/_/g, ' ')}`);\n    currentQuestion = updated;\n    if (props.onUpdate) props.onUpdate(updated);\n    props.onClose();\n  } catch (e) {\n    console.error('[QuestionDetail] Dismiss API error:', e);\n    toast.error('Failed to dismiss question');\n  }\n}\n\n/**\n * Show defer dialog\n */\nasync function showDeferDialog(\n  container: HTMLElement,\n  onUpdate?: (question: Question) => void\n): Promise<void> {\n  if (!currentQuestion) return;\n\n  // Create modal for defer options\n  const modal = document.createElement('div');\n  modal.className = 'modal open';\n  modal.id = 'defer-modal';\n  modal.innerHTML = `\n    <div class=\"modal-backdrop\"></div>\n    <div class=\"modal-container\" style=\"max-width: 400px;\">\n      <div class=\"modal-header\">\n        <h3>Defer Question</h3>\n        <button class=\"btn btn-icon modal-close\"></button>\n      </div>\n      <div class=\"modal-body\">\n        <div class=\"form-group\">\n          <label>Defer until</label>\n          <input type=\"datetime-local\" id=\"defer-until\" class=\"form-input\" \n            min=\"${new Date().toISOString().slice(0, 16)}\" required>\n        </div>\n        <div class=\"form-group\">\n          <label>Quick options</label>\n          <div class=\"defer-quick-options\">\n            <button class=\"btn btn-sm btn-secondary\" data-days=\"1\">Tomorrow</button>\n            <button class=\"btn btn-sm btn-secondary\" data-days=\"7\">Next Week</button>\n            <button class=\"btn btn-sm btn-secondary\" data-days=\"30\">Next Month</button>\n          </div>\n        </div>\n        <div class=\"form-group\">\n          <label>Reason (optional)</label>\n          <input type=\"text\" id=\"defer-reason\" class=\"form-input\" placeholder=\"Why are you deferring this?\">\n        </div>\n      </div>\n      <div class=\"modal-footer\">\n        <button class=\"btn btn-secondary\" id=\"cancel-defer\">Cancel</button>\n        <button class=\"btn btn-primary\" id=\"confirm-defer\">Defer</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(modal);\n\n  // Bind events\n  modal.querySelector('.modal-close')?.addEventListener('click', () => modal.remove());\n  modal.querySelector('.modal-backdrop')?.addEventListener('click', () => modal.remove());\n  modal.querySelector('#cancel-defer')?.addEventListener('click', () => modal.remove());\n\n  // Quick options\n  modal.querySelectorAll('.defer-quick-options button').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const days = parseInt(btn.getAttribute('data-days') || '1');\n      const date = new Date();\n      date.setDate(date.getDate() + days);\n      const input = modal.querySelector('#defer-until') as HTMLInputElement;\n      input.value = date.toISOString().slice(0, 16);\n    });\n  });\n\n  // Confirm\n  modal.querySelector('#confirm-defer')?.addEventListener('click', async () => {\n    const untilInput = modal.querySelector('#defer-until') as HTMLInputElement;\n    const reasonInput = modal.querySelector('#defer-reason') as HTMLInputElement;\n\n    if (!untilInput.value) {\n      toast.warning('Please select a date');\n      return;\n    }\n\n    try {\n      const updated = await questionsService.deferQuestion(\n        currentQuestion!.id,\n        new Date(untilInput.value),\n        reasonInput.value || undefined\n      );\n      toast.success('Question deferred');\n      modal.remove();\n      currentQuestion = updated;\n      if (onUpdate) onUpdate(updated);\n    } catch (e) {\n      toast.error('Failed to defer question');\n    }\n  });\n}\n\n/**\n * Submit feedback on answer\n */\nasync function submitFeedback(\n  container: HTMLElement,\n  wasUseful: boolean,\n  onUpdate?: (question: Question) => void\n): Promise<void> {\n  if (!currentQuestion) return;\n\n  let feedback: string | undefined;\n  if (!wasUseful) {\n    feedback = prompt('What could be improved about this answer?') || undefined;\n  }\n\n  try {\n    const updated = await questionsService.submitAnswerFeedback(\n      currentQuestion.id,\n      wasUseful,\n      feedback\n    );\n    toast.success('Thank you for your feedback!');\n    currentQuestion = updated;\n    if (onUpdate) onUpdate(updated);\n    \n    // Update UI to hide feedback buttons\n    const feedbackBtns = container.querySelector('.feedback-buttons');\n    if (feedbackBtns) {\n      feedbackBtns.innerHTML = `<span class=\"feedback-result\">${wasUseful ? ' Helpful' : ' Not helpful'}</span>`;\n    }\n  } catch (e) {\n    toast.error('Failed to submit feedback');\n  }\n}\n\n/**\n * Toggle edit mode\n */\nfunction toggleEditMode(container: HTMLElement): void {\n  // TODO: Implement edit mode for question content, priority, etc.\n  toast.info('Edit mode coming soon');\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createQuestionDetailView;\n","/**\n * Question Modal Component\n * View, create, edit, and answer questions with AI suggestions\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { \n  questionsService, \n  Question, \n  CreateQuestionRequest, \n  AssigneeSuggestion \n} from '../../services/questions';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nconst MODAL_ID = 'question-modal';\n\nexport interface QuestionModalProps {\n  mode: 'view' | 'answer' | 'create' | 'edit';\n  question?: Question;\n  onSave?: (question: Question) => void;\n  onDismiss?: (questionId: string | number) => void;\n  onDelete?: (questionId: string | number) => void;\n}\n\nlet currentSuggestions: AssigneeSuggestion[] = [];\n\n/**\n * Show question modal\n */\nexport function showQuestionModal(props: QuestionModalProps): void {\n  const { mode, question, onSave, onDismiss } = props;\n  currentSuggestions = [];\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'question-modal-content' });\n\n  if (mode === 'create') {\n    renderCreateForm(content);\n  } else if (mode === 'edit' && question) {\n    renderEditForm(content, question);\n  } else if (question) {\n    renderQuestionView(content, question, mode === 'answer');\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n  createFooterButtons(footer, mode, question, content, props);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: getModalTitle(mode),\n    content,\n    size: 'lg',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Get modal title based on mode\n */\nfunction getModalTitle(mode: string): string {\n  switch (mode) {\n    case 'create': return 'New Question';\n    case 'edit': return 'Edit Question';\n    case 'answer': return 'Answer Question';\n    default: return 'Question Details';\n  }\n}\n\n/**\n * Create footer buttons based on mode\n */\nfunction createFooterButtons(\n  footer: HTMLElement,\n  mode: string,\n  question: Question | undefined,\n  content: HTMLElement,\n  props: QuestionModalProps\n): void {\n  const { onSave, onDismiss, onDelete } = props;\n\n  if (mode === 'create') {\n    const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\n    const createBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Create Question' });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n    on(createBtn, 'click', () => handleCreate(content, onSave));\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(createBtn);\n  } else if (mode === 'edit' && question) {\n    const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\n    const saveBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save Changes' });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n    on(saveBtn, 'click', () => handleEdit(content, question, onSave));\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(saveBtn);\n  } else if (question) {\n    const status = question.status;\n\n    if (status !== 'resolved' && status !== 'dismissed') {\n      const dismissBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Dismiss' });\n      on(dismissBtn, 'click', () => handleDismiss(question.id, onDismiss));\n      footer.appendChild(dismissBtn);\n\n      if (mode === 'answer') {\n        const saveAnswerBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save Answer' });\n        on(saveAnswerBtn, 'click', () => handleAnswer(content, question, onSave));\n        footer.appendChild(saveAnswerBtn);\n      } else {\n        const answerBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Answer' });\n        on(answerBtn, 'click', () => {\n          closeModal(MODAL_ID);\n          showQuestionModal({ ...props, mode: 'answer' });\n        });\n        footer.appendChild(answerBtn);\n      }\n    } else if (status === 'resolved') {\n      const reopenBtn = createElement('button', { className: 'btn btn-warning', textContent: 'Reopen' });\n      on(reopenBtn, 'click', () => handleReopen(question, onSave));\n      footer.appendChild(reopenBtn);\n    }\n\n    const closeBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Close' });\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    footer.appendChild(closeBtn);\n  }\n}\n\n/**\n * Render create form\n */\nfunction renderCreateForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"question-form\" class=\"question-form\">\n      <div class=\"form-group\">\n        <label for=\"question-content\">Question <span class=\"required\">*</span></label>\n        <textarea id=\"question-content\" rows=\"3\" required minlength=\"5\"\n                  placeholder=\"What needs to be clarified? (min 5 characters)\"></textarea>\n        <div id=\"duplicate-warning\" class=\"form-warning\" style=\"display: none;\"></div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-context\">Context</label>\n        <textarea id=\"question-context\" rows=\"2\"\n                  placeholder=\"Why is this question important?\"></textarea>\n      </div>\n      \n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label for=\"question-priority\">Priority</label>\n          <select id=\"question-priority\">\n            <option value=\"low\">Low</option>\n            <option value=\"medium\" selected>Medium</option>\n            <option value=\"high\">High</option>\n            <option value=\"critical\">Critical</option>\n          </select>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"question-assignee\">Assign To</label>\n          <input type=\"text\" id=\"question-assignee\" placeholder=\"Person name\">\n          <button type=\"button\" id=\"suggest-assignee-btn\" class=\"btn btn-sm btn-secondary\">\n            AI Suggest\n          </button>\n        </div>\n      </div>\n      \n      <div id=\"suggestions-container\" class=\"suggestions-container\" style=\"display: none;\"></div>\n    </form>\n  `;\n\n  // Bind AI suggest button\n  const suggestBtn = container.querySelector('#suggest-assignee-btn');\n  if (suggestBtn) {\n    on(suggestBtn as HTMLElement, 'click', () => loadAssigneeSuggestions(container));\n  }\n}\n\n/**\n * Render edit form\n */\nfunction renderEditForm(container: HTMLElement, question: Question): void {\n  container.innerHTML = `\n    <form id=\"question-form\" class=\"question-form\">\n      <div class=\"form-group\">\n        <label for=\"question-content\">Question <span class=\"required\">*</span></label>\n        <textarea id=\"question-content\" rows=\"3\" required minlength=\"5\">${escapeHtml(question.content)}</textarea>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-context\">Context</label>\n        <textarea id=\"question-context\" rows=\"2\">${escapeHtml(question.context || '')}</textarea>\n      </div>\n      \n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label for=\"question-priority\">Priority</label>\n          <select id=\"question-priority\">\n            <option value=\"low\" ${question.priority === 'low' ? 'selected' : ''}>Low</option>\n            <option value=\"medium\" ${question.priority === 'medium' ? 'selected' : ''}>Medium</option>\n            <option value=\"high\" ${question.priority === 'high' ? 'selected' : ''}>High</option>\n            <option value=\"critical\" ${question.priority === 'critical' ? 'selected' : ''}>Critical</option>\n          </select>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"question-status\">Status</label>\n          <select id=\"question-status\">\n            <option value=\"pending\" ${question.status === 'pending' ? 'selected' : ''}>Pending</option>\n            <option value=\"assigned\" ${question.status === 'assigned' ? 'selected' : ''}>Assigned</option>\n            <option value=\"resolved\" ${question.status === 'resolved' ? 'selected' : ''}>Resolved</option>\n            <option value=\"dismissed\" ${question.status === 'dismissed' ? 'selected' : ''}>Dismissed</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-assignee\">Assigned To</label>\n        <input type=\"text\" id=\"question-assignee\" value=\"${escapeHtml(question.assigned_to || '')}\">\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-category\">Category</label>\n        <input type=\"text\" id=\"question-category\" value=\"${escapeHtml(question.category || '')}\">\n      </div>\n    </form>\n  `;\n}\n\n/**\n * Render question view\n */\nfunction renderQuestionView(container: HTMLElement, question: Question, showAnswerField: boolean): void {\n  container.innerHTML = `\n    <div class=\"question-view\">\n      <div class=\"question-meta\">\n        <span class=\"priority-badge priority-${question.priority}\">${question.priority}</span>\n        <span class=\"status-badge status-${question.status}\">${question.status}</span>\n        <span class=\"question-date\">${formatRelativeTime(question.created_at)}</span>\n        ${question.assigned_to ? `<span class=\"question-assignee\"> ${escapeHtml(question.assigned_to)}</span>` : ''}\n      </div>\n      \n      <div class=\"question-content-large\">\n        ${escapeHtml(question.content)}\n      </div>\n      \n      ${question.context ? `<div class=\"question-context\"><strong>Context:</strong> ${escapeHtml(question.context)}</div>` : ''}\n      ${question.category ? `<div class=\"question-category\"><strong>Category:</strong> ${escapeHtml(question.category)}</div>` : ''}\n      ${question.source_file ? `<div class=\"question-source\"><strong>Source:</strong> ${escapeHtml(question.source_file)}</div>` : ''}\n      \n      ${question.answer ? `\n        <div class=\"question-answer-section\">\n          <h4>Answer ${question.answer_source ? `<span class=\"answer-source\">(${question.answer_source})</span>` : ''}</h4>\n          <div class=\"answer-text\">${escapeHtml(question.answer)}</div>\n          ${question.resolved_at ? `<div class=\"answer-date\">Resolved ${formatRelativeTime(question.resolved_at)}</div>` : ''}\n        </div>\n      ` : ''}\n      \n      ${showAnswerField && question.status !== 'resolved' ? `\n        <div class=\"answer-form\">\n          <div class=\"form-group\">\n            <label for=\"question-answer\">Your Answer <span class=\"required\">*</span></label>\n            <textarea id=\"question-answer\" rows=\"4\" required minlength=\"3\"\n                      placeholder=\"Provide an answer (min 3 characters)...\"></textarea>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"answer-source\">Source</label>\n            <select id=\"answer-source\">\n              <option value=\"manual\" selected>Manual</option>\n              <option value=\"document\">From Document</option>\n              <option value=\"ai\">AI Assisted</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"followup-questions\">Follow-up Questions (one per line)</label>\n            <textarea id=\"followup-questions\" rows=\"2\"\n                      placeholder=\"Add any follow-up questions...\"></textarea>\n          </div>\n        </div>\n      ` : ''}\n      \n      ${question.reopened_reason ? `\n        <div class=\"reopen-reason\">\n          <strong>Reopen Reason:</strong> ${escapeHtml(question.reopened_reason)}\n        </div>\n      ` : ''}\n    </div>\n  `;\n}\n\n/**\n * Load AI assignee suggestions\n */\nasync function loadAssigneeSuggestions(container: HTMLElement): Promise<void> {\n  const contentInput = container.querySelector('#question-content') as HTMLTextAreaElement;\n  const content = contentInput?.value.trim();\n\n  if (!content || content.length < 5) {\n    toast.warning('Please enter at least 5 characters for the question');\n    return;\n  }\n\n  const suggestionsContainer = container.querySelector('#suggestions-container') as HTMLElement;\n  const suggestBtn = container.querySelector('#suggest-assignee-btn') as HTMLButtonElement;\n\n  suggestBtn.disabled = true;\n  suggestBtn.textContent = 'Loading...';\n  suggestionsContainer.style.display = 'block';\n  suggestionsContainer.innerHTML = '<div class=\"loading\">Getting AI suggestions...</div>';\n\n  try {\n    const result = await questionsService.suggestAssignee({ content, useAI: true });\n    currentSuggestions = result.suggestions;\n\n    if (currentSuggestions.length === 0) {\n      suggestionsContainer.innerHTML = '<div class=\"no-suggestions\">No suggestions available</div>';\n    } else {\n      suggestionsContainer.innerHTML = `\n        <h4>AI Suggestions ${result.cached ? '<span class=\"cached\">(cached)</span>' : ''}</h4>\n        <div class=\"suggestions-list\">\n          ${currentSuggestions.map((s, i) => `\n            <div class=\"suggestion-item\" data-index=\"${i}\">\n              <div class=\"suggestion-person\">${escapeHtml(s.person)}</div>\n              <div class=\"suggestion-score\">${s.score}%</div>\n              <div class=\"suggestion-reason\">${escapeHtml(s.reason)}</div>\n              ${s.role ? `<div class=\"suggestion-role\">${escapeHtml(s.role)}</div>` : ''}\n            </div>\n          `).join('')}\n        </div>\n      `;\n\n      // Bind click to select suggestion\n      suggestionsContainer.querySelectorAll('.suggestion-item').forEach(item => {\n        on(item as HTMLElement, 'click', () => {\n          const index = parseInt(item.getAttribute('data-index') || '0', 10);\n          const suggestion = currentSuggestions[index];\n          if (suggestion) {\n            const assigneeInput = container.querySelector('#question-assignee') as HTMLInputElement;\n            if (assigneeInput) {\n              assigneeInput.value = suggestion.person;\n            }\n            suggestionsContainer.style.display = 'none';\n            toast.success(`Selected: ${suggestion.person}`);\n          }\n        });\n      });\n    }\n  } catch {\n    suggestionsContainer.innerHTML = '<div class=\"error\">Failed to get suggestions</div>';\n  } finally {\n    suggestBtn.disabled = false;\n    suggestBtn.textContent = 'AI Suggest';\n  }\n}\n\n/**\n * Handle create\n */\nasync function handleCreate(\n  container: HTMLElement,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const form = container.querySelector('#question-form') as HTMLFormElement;\n  if (!form.checkValidity()) {\n    form.reportValidity();\n    return;\n  }\n\n  const getValue = (id: string) => {\n    const el = container.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n    return el?.value.trim() || '';\n  };\n\n  const data: CreateQuestionRequest = {\n    content: getValue('question-content'),\n    priority: getValue('question-priority') as 'low' | 'medium' | 'high' | 'critical',\n    assigned_to: getValue('question-assignee') || undefined,\n    context: getValue('question-context') || undefined,\n  };\n\n  try {\n    const result = await questionsService.create(data);\n\n    if (result.duplicate) {\n      const warning = container.querySelector('#duplicate-warning') as HTMLElement;\n      if (warning) {\n        warning.style.display = 'block';\n        warning.innerHTML = ` Similar question exists (${result.similarity}% match). <a href=\"#\" id=\"view-duplicate\">View existing</a>`;\n      }\n      return;\n    }\n\n    toast.success('Question created');\n    \n    const newQuestion: Question = {\n      id: result.id || Date.now(),\n      content: data.content,\n      priority: data.priority || 'medium',\n      status: data.assigned_to ? 'assigned' : 'pending',\n      assigned_to: data.assigned_to,\n      context: data.context,\n      created_at: new Date().toISOString(),\n    };\n\n    onSave?.(newQuestion);\n    closeModal(MODAL_ID);\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Handle edit\n */\nasync function handleEdit(\n  container: HTMLElement,\n  question: Question,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const getValue = (id: string) => {\n    const el = container.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n    return el?.value.trim() || '';\n  };\n\n  try {\n    const updated = await questionsService.update(question.id, {\n      content: getValue('question-content'),\n      context: getValue('question-context') || undefined,\n      priority: getValue('question-priority') as 'low' | 'medium' | 'high' | 'critical',\n      status: getValue('question-status') as 'pending' | 'assigned' | 'resolved' | 'dismissed',\n      assigned_to: getValue('question-assignee') || undefined,\n      category: getValue('question-category') || undefined,\n    });\n\n    toast.success('Question updated');\n    onSave?.(updated);\n    closeModal(MODAL_ID);\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Handle answer\n */\nasync function handleAnswer(\n  container: HTMLElement,\n  question: Question,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const answerInput = container.querySelector('#question-answer') as HTMLTextAreaElement;\n  const sourceSelect = container.querySelector('#answer-source') as HTMLSelectElement;\n  const followupInput = container.querySelector('#followup-questions') as HTMLTextAreaElement;\n\n  const answer = answerInput?.value.trim();\n  const source = sourceSelect?.value || 'manual';\n  const followupQuestions = followupInput?.value.trim();\n\n  if (!answer || answer.length < 3) {\n    toast.warning('Please provide an answer (at least 3 characters)');\n    return;\n  }\n\n  try {\n    const result = await questionsService.answer(question.id, {\n      answer,\n      source: source as 'manual' | 'document' | 'ai',\n      followupQuestions,\n    });\n\n    toast.success(result.message);\n    onSave?.(result.question);\n    closeModal(MODAL_ID);\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Handle dismiss\n */\nasync function handleDismiss(\n  questionId: string | number,\n  onDismiss?: (questionId: string | number) => void\n): Promise<void> {\n  const { confirm } = await import('../Modal');\n  const confirmed = await confirm(\n    'Are you sure you want to dismiss this question?',\n    {\n      title: 'Dismiss Question',\n      confirmText: 'Dismiss',\n    }\n  );\n\n  if (confirmed) {\n    try {\n      await questionsService.delete(questionId, 'dismissed');\n      toast.success('Question dismissed');\n      onDismiss?.(questionId);\n      closeModal(MODAL_ID);\n    } catch {\n      // Error shown by API service\n    }\n  }\n}\n\n/**\n * Handle reopen\n */\nasync function handleReopen(\n  question: Question,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const { prompt } = await import('../Modal');\n  const reason = await prompt('Why are you reopening this question?', {\n    title: 'Reopen Question',\n    placeholder: 'Enter reason...',\n  });\n\n  if (reason) {\n    try {\n      const updated = await questionsService.reopen(question.id, reason);\n      toast.success('Question reopened');\n      onSave?.(updated);\n      closeModal(MODAL_ID);\n    } catch {\n      // Error shown by API service\n    }\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showQuestionModal;\n","/**\n * Questions Panel Component\n * Displays and manages questions in the Source of Truth\n * Updated to support detail view instead of modal\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { questionsService, Question } from '../../services/questions';\nimport { dataStore } from '../../stores/data';\nimport { showQuestionModal } from '../modals/QuestionModal';\nimport { createQuestionDetailView } from '../questions/QuestionDetailView';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\nimport { http } from '../../services/api';\n\nexport interface QuestionsPanelProps {\n  onQuestionClick?: (question: Question) => void;\n  useDetailView?: boolean; // If true, replace panel with detail view instead of modal\n  containerElement?: HTMLElement; // Parent container for detail view replacement\n}\n\nlet currentFilter: string = 'all';\nlet currentView: 'status' | 'person' | 'team' = 'status';\n\n/**\n * Create questions panel\n */\nexport function createQuestionsPanel(props: QuestionsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'sot-panel questions-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Questions</h2>\n        <span class=\"panel-count\" id=\"questions-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <select id=\"questions-filter\" class=\"filter-select\">\n          <option value=\"all\">All Active</option>\n          <option value=\"pending\">Pending</option>\n          <option value=\"assigned\">Assigned</option>\n          <option value=\"critical\">Critical Priority</option>\n          <option value=\"overdue\">Overdue (SLA)</option>\n          <option value=\"resolved\"> Resolved</option>\n          <option value=\"dismissed\"> Dismissed</option>\n        </select>\n        <div class=\"view-tabs\">\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\n          <button class=\"view-tab\" data-view=\"person\">By Person</button>\n          <button class=\"view-tab\" data-view=\"team\">By Team</button>\n        </div>\n        <button class=\"btn btn-secondary btn-sm\" id=\"generate-team-btn\" title=\"Generate questions for team based on roles\"> Generate</button>\n        <button class=\"btn btn-primary btn-sm\" id=\"add-question-btn\">+ Add</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"questions-content\">\n      <div class=\"loading\">Loading questions...</div>\n    </div>\n  `;\n\n  // Bind events\n  const filterSelect = panel.querySelector('#questions-filter') as HTMLSelectElement;\n  on(filterSelect, 'change', () => {\n    currentFilter = filterSelect.value;\n    loadQuestions(panel, props);\n  });\n\n  const viewTabs = panel.querySelectorAll('.view-tab');\n  viewTabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      viewTabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentView = tab.getAttribute('data-view') as 'status' | 'person' | 'team';\n      loadQuestions(panel, props);\n    });\n  });\n\n  const addBtn = panel.querySelector('#add-question-btn');\n  if (addBtn) {\n    on(addBtn as HTMLElement, 'click', () => {\n      showQuestionModal({\n        mode: 'create',\n        onSave: () => loadQuestions(panel, props),\n      });\n    });\n  }\n\n  // Generate for team button\n  const generateBtn = panel.querySelector('#generate-team-btn');\n  if (generateBtn) {\n    on(generateBtn as HTMLElement, 'click', () => showGenerateForTeamDialog(panel, props));\n  }\n\n  // Initial load\n  loadQuestions(panel, props);\n\n  // Subscribe to data changes\n  dataStore.subscribe(() => {\n    updateCount(panel);\n  });\n\n  return panel;\n}\n\n/**\n * Load questions\n */\nasync function loadQuestions(panel: HTMLElement, props: QuestionsPanelProps): Promise<void> {\n  const content = panel.querySelector('#questions-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    let questions: Question[] = [];\n\n    if (currentView === 'status') {\n      // Handle special filters\n      if (currentFilter === 'overdue') {\n        // Get all pending/assigned questions and filter by SLA breach\n        questions = await questionsService.getAll();\n        questions = questions.filter(q => \n          q.sla_breached === true || \n          (q.status !== 'resolved' && q.status !== 'dismissed' && isOverdue(q))\n        );\n      } else if (currentFilter === 'critical') {\n        // Filter by critical priority\n        questions = await questionsService.getAll();\n        questions = questions.filter(q => q.priority === 'critical' && q.status !== 'resolved' && q.status !== 'dismissed');\n      } else if (currentFilter === 'all') {\n        // \"All\" means all ACTIVE questions - exclude dismissed/resolved\n        questions = await questionsService.getAll();\n        questions = questions.filter(q => q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'closed');\n      } else if (currentFilter === 'dismissed') {\n        // Specifically show dismissed questions\n        questions = await questionsService.getAll();\n        questions = questions.filter(q => q.status === 'dismissed');\n      } else if (currentFilter === 'resolved') {\n        // Specifically show resolved/answered questions\n        questions = await questionsService.getAll();\n        questions = questions.filter(q => q.status === 'resolved' || q.status === 'answered');\n      } else {\n        // Filter by specific status (pending, assigned, etc.)\n        questions = await questionsService.getAll();\n        questions = questions.filter(q => q.status === currentFilter);\n      }\n      renderByStatus(content, questions, props);\n    } else if (currentView === 'person') {\n      const grouped = await questionsService.getByPerson();\n      renderGrouped(content, grouped, props);\n    } else if (currentView === 'team') {\n      const grouped = await questionsService.getByTeam();\n      renderGrouped(content, grouped, props);\n    }\n\n    // Update store\n    if (currentView === 'status') {\n      dataStore.setQuestions(questions as unknown as []);\n    }\n\n    updateCount(panel);\n  } catch (error) {\n    content.innerHTML = '<div class=\"error\">Failed to load questions</div>';\n  }\n}\n\n/**\n * Check if a question is overdue based on SLA\n */\nfunction isOverdue(question: Question): boolean {\n  if (!question.created_at) return false;\n  const slaHours = question.sla_hours || 168; // 7 days default\n  const created = new Date(question.created_at);\n  const deadline = new Date(created.getTime() + slaHours * 60 * 60 * 1000);\n  return new Date() > deadline;\n}\n\n/**\n * Render questions by status\n */\nfunction renderByStatus(container: HTMLElement, questions: Question[], props: QuestionsPanelProps): void {\n  if (questions.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No questions found</p>\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Question</button>\n      </div>\n    `;\n    const addBtn = container.querySelector('#empty-add-btn');\n    if (addBtn) {\n      on(addBtn as HTMLElement, 'click', () => {\n        showQuestionModal({ mode: 'create' });\n      });\n    }\n    return;\n  }\n\n  container.innerHTML = questions.map(q => createQuestionCard(q)).join('');\n  bindCardEvents(container, questions, props);\n}\n\n/**\n * Render grouped questions\n */\nfunction renderGrouped(\n  container: HTMLElement,\n  grouped: Record<string, Question[]>,\n  props: QuestionsPanelProps\n): void {\n  const groups = Object.entries(grouped);\n  \n  if (groups.length === 0) {\n    container.innerHTML = '<div class=\"empty-state\"><p>No questions found</p></div>';\n    return;\n  }\n\n  container.innerHTML = groups.map(([groupName, questions]) => `\n    <div class=\"question-group\">\n      <div class=\"group-header\">\n        <h3>${escapeHtml(groupName)}</h3>\n        <span class=\"group-count\">${questions.length}</span>\n      </div>\n      <div class=\"group-items\">\n        ${questions.map(q => createQuestionCard(q)).join('')}\n      </div>\n    </div>\n  `).join('');\n\n  // Flatten for event binding\n  const allQuestions = groups.flatMap(([, qs]) => qs);\n  bindCardEvents(container, allQuestions, props);\n}\n\n/**\n * Create question card HTML - SOTA Design\n */\nfunction createQuestionCard(question: Question): string {\n  const priorityClass = `priority-${question.priority}`;\n  const statusClass = `status-${question.status}`;\n  const slaBreached = question.sla_breached;\n  const autoDetected = question.answer_source === 'auto-detected';\n  const hasAnswer = !!question.answer;\n  const hasRequesterRole = !!question.requester_role;\n\n  // Get initials for avatar\n  const getInitials = (name: string): string => {\n    if (!name) return '?';\n    const parts = name.trim().split(/\\s+/);\n    return parts.length === 1 \n      ? parts[0].substring(0, 2).toUpperCase() \n      : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\n  };\n\n  // Build the card HTML\n  let html = `<div class=\"question-card-sota${slaBreached ? ' sla-breached' : ''}${hasAnswer ? ' has-answer' : ''}\" data-id=\"${question.id}\">`;\n  \n  // Priority Bar\n  html += `<div class=\"card-priority-bar ${priorityClass}\"></div>`;\n  \n  // Card Body\n  html += `<div class=\"card-body\">`;\n  \n  // Top Row\n  html += `<div class=\"card-top-row\">`;\n  html += `<div class=\"card-badges\">`;\n  html += `<span class=\"priority-pill ${priorityClass}\">${question.priority}</span>`;\n  html += `<span class=\"status-pill ${statusClass}\">${question.status}</span>`;\n  if (slaBreached) html += `<span class=\"sla-pill\">SLA</span>`;\n  if (autoDetected) html += `<span class=\"auto-pill\">Answer Found</span>`;\n  if (question.follow_up_to) html += `<span class=\"followup-pill\">Follow-up</span>`;\n  html += `</div>`; // .card-badges\n  html += `<span class=\"card-timestamp\">${formatRelativeTime(question.created_at)}</span>`;\n  html += `</div>`; // .card-top-row\n  \n  // Question Text\n  html += `<div class=\"card-question-text\">${escapeHtml(question.content)}</div>`;\n  \n  // Bottom Row\n  html += `<div class=\"card-bottom-row\">`;\n  \n  // Get contacts for photo lookup\n  const contacts = dataStore.getState().contacts || [];\n  \n  // Helper to get photo URL\n  const getPhotoUrl = (name: string, contactId?: string): string | null => {\n    const contact = contactId \n      ? contacts.find((c: any) => c.id === contactId)\n      : contacts.find((c: any) => c.name === name);\n    return contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url || null;\n  };\n  \n  // Helper to render avatar (photo or initials)\n  const renderAvatar = (name: string, photoUrl: string | null, cssClass: string): string => {\n    if (photoUrl) {\n      return `<div class=\"${cssClass}\"><img src=\"${photoUrl}\" alt=\"${escapeHtml(name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\"></div>`;\n    }\n    return `<div class=\"${cssClass}\">${getInitials(name)}</div>`;\n  };\n  \n  // Left: Requester (who is asking) - shows avatar + name + role\n  html += `<div class=\"card-requester\">`;\n  if (hasRequesterRole) {\n    const requesterName = (question as any).requester_name || '';\n    const requesterRole = question.requester_role || '';\n    const requesterContactId = (question as any).requester_contact_id;\n    const requesterPhotoUrl = getPhotoUrl(requesterName, requesterContactId);\n    \n    html += `<div class=\"requester-chip\">`;\n    html += renderAvatar(requesterName || requesterRole, requesterPhotoUrl, 'requester-avatar');\n    html += `<div class=\"requester-info\">`;\n    if (requesterName) {\n      html += `<span class=\"requester-name\">${escapeHtml(requesterName)}</span>`;\n    }\n    html += `<span class=\"requester-role\">${escapeHtml(requesterRole)}</span>`;\n    html += `</div>`;\n    html += `</div>`;\n  }\n  html += `</div>`; // .card-requester\n  \n  // Right: Assignment (who should answer) - shows avatar + name\n  html += `<div class=\"card-assignment\">`;\n  if (question.assigned_to) {\n    const assigneePhotoUrl = getPhotoUrl(question.assigned_to);\n    \n    html += `<div class=\"assignee-chip\">`;\n    html += renderAvatar(question.assigned_to, assigneePhotoUrl, 'assignee-avatar');\n    html += `<div class=\"assignee-info\">`;\n    html += `<span class=\"assignee-name\">${escapeHtml(question.assigned_to)}</span>`;\n    if (hasAnswer) html += `<span class=\"answered-badge\">Answered</span>`;\n    html += `</div>`;\n    html += `</div>`;\n  } else {\n    html += `<div class=\"unassigned-chip\">`;\n    html += `<span>Unassigned</span>`;\n    html += `</div>`;\n  }\n  html += `</div>`; // .card-assignment\n  \n  html += `</div>`; // .card-bottom-row\n  html += `</div>`; // .card-body\n  html += `</div>`; // .question-card-sota\n  \n  return html;\n}\n\n/**\n * Bind card click events\n */\nfunction bindCardEvents(container: HTMLElement, questions: Question[], props: QuestionsPanelProps): void {\n  container.querySelectorAll('.question-card-sota').forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const id = card.getAttribute('data-id');\n      const question = questions.find(q => String(q.id) === id);\n      if (question) {\n        if (props.onQuestionClick) {\n          props.onQuestionClick(question);\n        } else if (props.useDetailView && props.containerElement) {\n          // Replace panel with detail view\n          showQuestionDetailView(question, props);\n        } else {\n          // Fallback to modal\n          showQuestionModal({\n            mode: 'view',\n            question,\n            onSave: () => loadQuestions(container.closest('.questions-panel') as HTMLElement, props),\n          });\n        }\n      }\n    });\n  });\n}\n\n/**\n * Show question detail view (replaces panel content)\n */\nfunction showQuestionDetailView(question: Question, props: QuestionsPanelProps): void {\n  const containerEl = props.containerElement;\n  if (!containerEl) return;\n\n  // Store current panel content for restoration\n  const panelContent = containerEl.innerHTML;\n\n  // Create detail view\n  const detailView = createQuestionDetailView({\n    question,\n    onClose: () => {\n      // Restore panel content\n      containerEl.innerHTML = panelContent;\n      // Re-initialize the panel\n      const panel = containerEl.querySelector('.questions-panel');\n      if (panel) {\n        loadQuestions(panel as HTMLElement, props);\n      }\n    },\n    onUpdate: (updatedQuestion) => {\n      // If question was dismissed/resolved, close detail view and refresh list\n      if (updatedQuestion.status === 'dismissed' || updatedQuestion.status === 'resolved' || updatedQuestion.status === 'closed') {\n        // Restore panel content and reload\n        containerEl.innerHTML = panelContent;\n        const panel = containerEl.querySelector('.questions-panel');\n        if (panel) {\n          loadQuestions(panel as HTMLElement, props);\n        }\n        toast.info('Question updated - returning to list');\n      }\n    },\n    onNavigateToQuestion: async (questionId) => {\n      // Navigate to another question\n      try {\n        const questions = await questionsService.getAll();\n        const targetQuestion = questions.find(q => String(q.id) === questionId);\n        if (targetQuestion) {\n          showQuestionDetailView(targetQuestion, props);\n        }\n      } catch (e) {\n        toast.error('Failed to load question');\n      }\n    }\n  });\n\n  // Replace content with detail view\n  containerEl.innerHTML = '';\n  containerEl.appendChild(detailView);\n}\n\n/**\n * Show AI-powered generate questions dialog (SOTA version)\n * Uses the universal modal-sota.css system\n */\nasync function showGenerateForTeamDialog(panel: HTMLElement, props: QuestionsPanelProps): Promise<void> {\n  const modal = document.createElement('div');\n  modal.className = 'modal open';\n  modal.id = 'generate-ai-modal';\n  modal.innerHTML = `\n    <div class=\"modal-backdrop\"></div>\n    <div class=\"modal-container modal-sota\" style=\"position: relative;\">\n      <!-- Header -->\n      <div class=\"sota-header header-primary\">\n        <div class=\"header-row\">\n          <div class=\"header-icon\">\n            <svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z\"/>\n              <circle cx=\"7.5\" cy=\"14.5\" r=\"1.5\"/><circle cx=\"16.5\" cy=\"14.5\" r=\"1.5\"/>\n            </svg>\n          </div>\n          <div class=\"header-text\">\n            <h2>AI Question Generator</h2>\n            <p>Generate contextual questions for your project team</p>\n          </div>\n        </div>\n        <button class=\"header-close\" id=\"close-modal\">\n          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\n          </svg>\n        </button>\n      </div>\n\n      <!-- Tabs -->\n      <div class=\"sota-tabs\">\n        <button class=\"sota-tab active\" data-source=\"team\">\n          <span class=\"tab-icon\"></span>\n          <span>Team Members</span>\n        </button>\n        <button class=\"sota-tab\" data-source=\"contacts\">\n          <span class=\"tab-icon\"></span>\n          <span>Project Contacts</span>\n        </button>\n      </div>\n\n      <!-- Body -->\n      <div class=\"sota-body\">\n        <!-- Section: Roles -->\n        <div class=\"sota-section\">\n          <div class=\"section-title\">\n            <span class=\"title-icon\"></span>\n            <span>Select a Role</span>\n          </div>\n          <div id=\"roles-grid\" class=\"sota-grid\">\n            <div class=\"sota-loading\">\n              <div class=\"spinner-ring\"></div>\n              <p>Loading roles...</p>\n            </div>\n          </div>\n        </div>\n\n        <!-- Section: Configuration (hidden until role selected) -->\n        <div class=\"sota-section\" id=\"config-section\" style=\"display: none;\">\n          <div id=\"selected-badge\"></div>\n          \n          <div class=\"config-row\">\n            <label>Questions to generate</label>\n            <div class=\"config-buttons\">\n              <button class=\"config-btn active\" data-count=\"auto\" title=\"AI determines optimal count\"> Auto</button>\n              <button class=\"config-btn\" data-count=\"3\">3</button>\n              <button class=\"config-btn\" data-count=\"5\">5</button>\n              <button class=\"config-btn\" data-count=\"8\">8</button>\n            </div>\n          </div>\n\n          <label class=\"toggle-row\">\n            <input type=\"checkbox\" id=\"use-context\" checked>\n            <span class=\"toggle-track\"><span class=\"toggle-thumb\"></span></span>\n            <span>Use project context (facts, documents)</span>\n          </label>\n          \n          <label class=\"toggle-row\">\n            <input type=\"checkbox\" id=\"skip-dupes\" checked>\n            <span class=\"toggle-track\"><span class=\"toggle-thumb\"></span></span>\n            <span>Skip duplicate questions</span>\n          </label>\n\n          <button class=\"sota-btn-primary\" id=\"btn-generate\" style=\"margin-top: 20px;\">\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <polygon points=\"13 2 3 14 12 14 11 22 21 10 12 10 13 2\"/>\n            </svg>\n            Generate Questions\n          </button>\n        </div>\n      </div>\n\n      <!-- Overlay for generation -->\n      <div class=\"sota-overlay\" id=\"gen-overlay\" style=\"display: none;\">\n        <div id=\"gen-content\">\n          <div class=\"overlay-spinner\"></div>\n          <h4 class=\"overlay-title\">Generating questions...</h4>\n          <p class=\"overlay-subtitle\">AI is analyzing your project context</p>\n        </div>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(modal);\n\n  // State\n  type RoleData = { role: string; rolePrompt?: string; members: Array<{ id: string; name: string; photoUrl?: string; email?: string }> };\n  let currentSource: 'team' | 'contacts' = 'team';\n  let selectedRole: RoleData | null = null;\n  let allRoles: RoleData[] = [];\n  let questionCount: number | 'auto' = 'auto';\n\n  // Elements\n  const rolesGrid = modal.querySelector('#roles-grid') as HTMLElement;\n  const configSection = modal.querySelector('#config-section') as HTMLElement;\n  const selectedBadge = modal.querySelector('#selected-badge') as HTMLElement;\n  const genOverlay = modal.querySelector('#gen-overlay') as HTMLElement;\n  const genContent = modal.querySelector('#gen-content') as HTMLElement;\n\n  // Helpers\n  const getInitials = (name: string) => {\n    if (!name) return '?';\n    return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n  };\n  \n  const getRoleIcon = (role: string): string => {\n    const r = role.toLowerCase();\n    if (r.includes('analyst') || r.includes('data')) return '';\n    if (r.includes('manager') || r.includes('lead')) return '';\n    if (r.includes('developer') || r.includes('engineer')) return '';\n    if (r.includes('design') || r.includes('ux')) return '';\n    if (r.includes('product') || r.includes('owner')) return '';\n    if (r.includes('qa') || r.includes('test')) return '';\n    if (r.includes('support') || r.includes('success')) return '';\n    if (r.includes('sales') || r.includes('commercial')) return '';\n    if (r.includes('marketing')) return '';\n    if (r.includes('security')) return '';\n    if (r.includes('devops') || r.includes('infra')) return '';\n    if (r.includes('legal')) return '';\n    return '';\n  };\n\n  // Load roles based on source\n  const loadRoles = async (source: 'team' | 'contacts') => {\n    rolesGrid.innerHTML = '<div class=\"sota-loading\"><div class=\"spinner-ring\"></div><p>Loading roles...</p></div>';\n    configSection.style.display = 'none';\n    selectedRole = null;\n\n    try {\n      let roles: RoleData[] = [];\n\n      if (source === 'team') {\n        const res = await http.get<{ roles: RoleData[] }>('/api/questions/team-roles');\n        roles = res.data.roles || [];\n      } else {\n        // Load from contacts\n        const res = await http.get<{ contacts: Array<{ id: string; name: string; role?: string; photo_url?: string; email?: string }> }>('/api/contacts');\n        const contacts = res.data.contacts || [];\n        \n        // Group by role\n        const roleMap: Record<string, RoleData> = {};\n        for (const c of contacts) {\n          if (!c.role) continue;\n          if (!roleMap[c.role]) {\n            roleMap[c.role] = { role: c.role, members: [] };\n          }\n          roleMap[c.role].members.push({\n            id: c.id,\n            name: c.name,\n            photoUrl: c.photo_url,\n            email: c.email\n          });\n        }\n        roles = Object.values(roleMap);\n      }\n\n      allRoles = roles;\n\n      if (roles.length === 0) {\n        rolesGrid.innerHTML = `\n          <div class=\"sota-empty\" style=\"grid-column: 1 / -1;\">\n            <div class=\"empty-icon\">${source === 'team' ? '' : ''}</div>\n            <h4>No ${source === 'team' ? 'Team Members' : 'Contacts'} with Roles</h4>\n            <p>${source === 'team' \n              ? 'Add team members with roles in Project Settings' \n              : 'Add contacts with roles to this project'}</p>\n          </div>\n        `;\n        return;\n      }\n\n      rolesGrid.innerHTML = roles.map((r, idx) => `\n        <div class=\"sota-card\" data-idx=\"${idx}\">\n          <div class=\"card-icon\">${getRoleIcon(r.role)}</div>\n          <div class=\"card-title\">${escapeHtml(r.role)}</div>\n          <div class=\"card-avatars\">\n            ${r.members.slice(0, 3).map(m => `\n              <div class=\"mini-avatar\" title=\"${escapeHtml(m.name)}\">\n                ${m.photoUrl \n                  ? `<img src=\"${m.photoUrl}\" alt=\"\" onerror=\"this.style.display='none';this.nextSibling.style.display='flex'\">`\n                  : ''}\n                <span style=\"${m.photoUrl ? 'display:none' : ''}\">${getInitials(m.name)}</span>\n              </div>\n            `).join('')}\n            ${r.members.length > 3 ? `<div class=\"mini-avatar more\">+${r.members.length - 3}</div>` : ''}\n          </div>\n          <div class=\"card-subtitle\">${r.members.map(m => m.name).slice(0, 2).join(', ')}${r.members.length > 2 ? '...' : ''}</div>\n          <div class=\"card-badge\">${r.members.length}</div>\n        </div>\n      `).join('');\n\n      // Bind clicks\n      rolesGrid.querySelectorAll('.sota-card').forEach(card => {\n        card.addEventListener('click', () => {\n          rolesGrid.querySelectorAll('.sota-card').forEach(c => c.classList.remove('selected'));\n          card.classList.add('selected');\n          \n          const idx = parseInt(card.getAttribute('data-idx') || '0', 10);\n          selectedRole = allRoles[idx];\n          showConfig();\n        });\n      });\n\n    } catch (err) {\n      rolesGrid.innerHTML = `\n        <div class=\"sota-empty\" style=\"grid-column: 1 / -1;\">\n          <div class=\"empty-icon\"></div>\n          <h4>Failed to Load</h4>\n          <p>Could not fetch roles. Please try again.</p>\n          <button class=\"sota-btn-primary\" style=\"max-width: 200px; margin: 16px auto 0;\" id=\"retry-load\">Retry</button>\n        </div>\n      `;\n      modal.querySelector('#retry-load')?.addEventListener('click', () => loadRoles(source));\n    }\n  };\n\n  // Show config panel\n  const showConfig = () => {\n    if (!selectedRole) return;\n    \n    configSection.style.display = 'block';\n    selectedBadge.innerHTML = `\n      <div class=\"selected-badge\">\n        <span class=\"badge-icon\">${getRoleIcon(selectedRole.role)}</span>\n        <div class=\"badge-info\">\n          <strong>${escapeHtml(selectedRole.role)}</strong>\n          <span>${selectedRole.members.map(m => m.name).join(', ')}</span>\n        </div>\n        <button class=\"badge-clear\" id=\"clear-selection\"></button>\n      </div>\n    `;\n\n    modal.querySelector('#clear-selection')?.addEventListener('click', () => {\n      selectedRole = null;\n      configSection.style.display = 'none';\n      rolesGrid.querySelectorAll('.sota-card').forEach(c => c.classList.remove('selected'));\n    });\n  };\n\n  // Generate questions\n  const generateQuestions = async () => {\n    if (!selectedRole) return;\n\n    genOverlay.style.display = 'flex';\n\n    try {\n      const res = await http.post<{\n        generated: number;\n        skipped: number;\n        questions: Array<{ content: string; priority: string; requester_role: string }>;\n      }>('/api/questions/generate-ai', {\n        role: selectedRole.role,\n        memberIds: selectedRole.members.map(m => m.id),\n        count: questionCount,\n        includeContext: (modal.querySelector('#use-context') as HTMLInputElement)?.checked ?? true,\n        skipDuplicates: (modal.querySelector('#skip-dupes') as HTMLInputElement)?.checked ?? true\n      });\n\n      const q = res.data.questions || [];\n\n      genContent.innerHTML = `\n        <div class=\"sota-success\">\n          <div class=\"success-icon\"></div>\n          <h4>${res.data.generated} Questions Generated</h4>\n          <p>${res.data.skipped > 0 ? `${res.data.skipped} duplicates skipped` : 'All questions created successfully'}</p>\n        </div>\n        <div class=\"results-list\">\n          ${q.slice(0, 5).map(item => `\n            <div class=\"result-row\">\n              <span class=\"result-badge ${item.priority}\">${item.priority}</span>\n              <span class=\"result-text\">${escapeHtml(item.content.length > 70 ? item.content.substring(0, 70) + '...' : item.content)}</span>\n            </div>\n          `).join('')}\n          ${q.length > 5 ? `<p style=\"text-align: center; color: var(--text-muted); margin-top: 8px; font-size: 12px;\">+ ${q.length - 5} more questions</p>` : ''}\n        </div>\n        <p style=\"text-align: center; color: var(--text-secondary); font-size: 12px; margin-top: 12px;\">\n           Questions from <strong>${selectedRole?.role}</strong> perspective<br>\n          <span style=\"color: var(--text-muted);\">Use AI Suggest on each question to find who should answer</span>\n        </p>\n        <button class=\"sota-btn-primary\" id=\"btn-done\">Done</button>\n      `;\n\n      modal.querySelector('#btn-done')?.addEventListener('click', () => {\n        modal.remove();\n        loadQuestions(panel, props);\n      });\n\n    } catch (err) {\n      genContent.innerHTML = `\n        <div class=\"sota-error\">\n          <div class=\"error-icon\"></div>\n          <h4>Generation Failed</h4>\n          <p>Something went wrong. Please try again.</p>\n          <button class=\"sota-btn-primary\" id=\"retry-gen\" style=\"max-width: 200px; margin: 20px auto 0;\">Retry</button>\n        </div>\n      `;\n      modal.querySelector('#retry-gen')?.addEventListener('click', generateQuestions);\n    }\n  };\n\n  // Bind events\n  modal.querySelector('#close-modal')?.addEventListener('click', () => modal.remove());\n  modal.querySelector('.modal-backdrop')?.addEventListener('click', () => modal.remove());\n\n  // Source tabs\n  modal.querySelectorAll('.sota-tab').forEach(tab => {\n    tab.addEventListener('click', () => {\n      modal.querySelectorAll('.sota-tab').forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentSource = (tab.getAttribute('data-source') as 'team' | 'contacts') || 'team';\n      loadRoles(currentSource);\n    });\n  });\n\n  // Count buttons\n  modal.querySelectorAll('.config-btn').forEach(btn => {\n    btn.addEventListener('click', () => {\n      modal.querySelectorAll('.config-btn').forEach(b => b.classList.remove('active'));\n      btn.classList.add('active');\n      const countVal = btn.getAttribute('data-count') || 'auto';\n      questionCount = countVal === 'auto' ? 'auto' : parseInt(countVal, 10);\n    });\n  });\n\n  // Generate button\n  modal.querySelector('#btn-generate')?.addEventListener('click', generateQuestions);\n\n  // Initial load\n  loadRoles('team');\n}\n\n/**\n * Update count badge\n */\nfunction updateCount(panel: HTMLElement): void {\n  const countEl = panel.querySelector('#questions-count');\n  if (countEl) {\n    const questions = dataStore.getState().questions;\n    countEl.textContent = String(questions.length);\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createQuestionsPanel;\n","/**\n * Source of Truth Component\n * Displays questions, risks, actions, and decisions\n */\n\nimport { createElement, on, addClass, removeClass } from '../utils/dom';\nimport { uiStore, SotView } from '../stores/ui';\nimport { dataStore, Question, Risk, Action, Decision } from '../stores/data';\nimport { formatRelativeTime } from '../utils/format';\nimport { createQuestionDetailView } from './questions/QuestionDetailView';\nimport { Question as QuestionAPI } from '../services/questions';\nimport { createQuestionsPanel as createFullQuestionsPanel } from './sot/QuestionsPanel';\n\nexport interface SourceOfTruthProps {\n  onQuestionClick?: (question: Question) => void;\n  onRiskClick?: (risk: Risk) => void;\n  onActionClick?: (action: Action) => void;\n  onDecisionClick?: (decision: Decision) => void;\n}\n\n/**\n * Create Source of Truth component\n */\nexport function createSourceOfTruth(props: SourceOfTruthProps = {}): HTMLElement {\n  const container = createElement('div', { className: 'source-of-truth' });\n\n  // Tabs\n  const tabs = createElement('div', { className: 'tabs' });\n  const tabConfigs: Array<{ id: SotView; label: string; icon: string }> = [\n    { id: 'questions', label: 'Questions', icon: '' },\n    { id: 'risks', label: 'Risks', icon: '' },\n    { id: 'actions', label: 'Actions', icon: '' },\n    { id: 'decisions', label: 'Decisions', icon: '' },\n  ];\n\n  tabConfigs.forEach(config => {\n    const tab = createElement('button', {\n      className: 'tab',\n    });\n    tab.setAttribute('data-tab', config.id);\n    tab.innerHTML = `${config.icon} ${config.label} <span class=\"badge\" data-count=\"0\">0</span>`;\n\n    on(tab, 'click', () => {\n      uiStore.setSotView(config.id);\n    });\n\n    tabs.appendChild(tab);\n  });\n\n  container.appendChild(tabs);\n\n  // Content panels\n  const panels = createElement('div', { className: 'tab-panels' });\n\n  // Use the full QuestionsPanel with Generate button and filters\n  const questionsPanel = createFullQuestionsPanel({\n    onQuestionClick: props.onQuestionClick as unknown as (q: QuestionAPI) => void,\n    useDetailView: true,\n    containerElement: container\n  });\n  questionsPanel.classList.add('tab-panel');\n  \n  const risksPanel = createRisksPanel(props.onRiskClick);\n  const actionsPanel = createActionsPanel(props.onActionClick);\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const decisionsPanel = createDecisionsPanel({\n    onDecisionClick: props.onDecisionClick as any,\n    useDetailView: true,\n    containerElement: container\n  });\n\n  questionsPanel.setAttribute('data-panel', 'questions');\n  risksPanel.setAttribute('data-panel', 'risks');\n  actionsPanel.setAttribute('data-panel', 'actions');\n  decisionsPanel.setAttribute('data-panel', 'decisions');\n\n  panels.appendChild(questionsPanel);\n  panels.appendChild(risksPanel);\n  panels.appendChild(actionsPanel);\n  panels.appendChild(decisionsPanel);\n\n  container.appendChild(panels);\n\n  // Subscribe to UI state changes\n  uiStore.subscribe((state) => {\n    // Update active tab\n    tabs.querySelectorAll('.tab').forEach(tab => {\n      const tabId = tab.getAttribute('data-tab');\n      if (tabId === state.sotCurrentView) {\n        addClass(tab as HTMLElement, 'active');\n      } else {\n        removeClass(tab as HTMLElement, 'active');\n      }\n    });\n\n    // Update active panel\n    panels.querySelectorAll('[data-panel]').forEach(panel => {\n      const panelId = panel.getAttribute('data-panel');\n      if (panelId === state.sotCurrentView) {\n        addClass(panel as HTMLElement, 'active');\n      } else {\n        removeClass(panel as HTMLElement, 'active');\n      }\n    });\n  });\n\n  // Subscribe to data changes\n  dataStore.subscribe((data) => {\n    // Update badges\n    const questionsBadge = tabs.querySelector('[data-tab=\"questions\"] .badge');\n    const risksBadge = tabs.querySelector('[data-tab=\"risks\"] .badge');\n    const actionsBadge = tabs.querySelector('[data-tab=\"actions\"] .badge');\n    const decisionsBadge = tabs.querySelector('[data-tab=\"decisions\"] .badge');\n\n    if (questionsBadge) questionsBadge.textContent = String(data.questions.length);\n    if (risksBadge) risksBadge.textContent = String(data.risks.length);\n    if (actionsBadge) actionsBadge.textContent = String(data.actions.length);\n    if (decisionsBadge) decisionsBadge.textContent = String(data.decisions.length);\n\n    // Re-render panels\n    renderQuestions(questionsPanel, data.questions, props.onQuestionClick);\n    renderRisks(risksPanel, data.risks, props.onRiskClick);\n    renderActions(actionsPanel, data.actions, props.onActionClick);\n    renderDecisions(decisionsPanel, data.decisions, props.onDecisionClick);\n  });\n\n  // Set initial active state\n  const initialView = uiStore.getState().sotCurrentView;\n  const initialTab = tabs.querySelector(`[data-tab=\"${initialView}\"]`);\n  const initialPanel = panels.querySelector(`[data-panel=\"${initialView}\"]`);\n  if (initialTab) addClass(initialTab as HTMLElement, 'active');\n  if (initialPanel) addClass(initialPanel as HTMLElement, 'active');\n\n  return container;\n}\n\n// NOTE: createQuestionsPanel is now imported from './sot/QuestionsPanel' as createFullQuestionsPanel\n// The legacy inline version has been removed in favor of the full-featured panel\n\n/**\n * Render questions list\n */\nfunction renderQuestions(panel: HTMLElement, questions: Question[], onClick?: (q: Question) => void): void {\n  const list = panel.querySelector('.questions-list');\n  if (!list) return;\n\n  if (questions.length === 0) {\n    list.innerHTML = '<div class=\"empty-state\">No questions yet</div>';\n    return;\n  }\n\n  list.innerHTML = questions.map(q => `\n    <div class=\"question-card ${q.status}\" data-id=\"${q.id}\">\n      <div class=\"question-header\">\n        <span class=\"priority-badge priority-${q.priority}\">${q.priority}</span>\n        <span class=\"status-badge ${q.status}\">${q.status}</span>\n      </div>\n      <div class=\"question-text\">${escapeHtml(q.content || q.question || '')}</div>\n      ${q.answer ? `<div class=\"question-answer\">${escapeHtml(q.answer)}</div>` : ''}\n      <div class=\"question-meta\">${formatRelativeTime(q.created_at || q.createdAt || new Date().toISOString())}</div>\n    </div>\n  `).join('');\n\n  // Always bind click to open detail view\n  list.querySelectorAll('.question-card').forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const id = card.getAttribute('data-id');\n      const question = questions.find(q => q.id === id || String(q.id) === id);\n      if (question) {\n        // Call onClick if provided (for modal fallback)\n        if (onClick) {\n          onClick(question);\n        }\n        \n        // Show the detail view\n        showQuestionDetail(panel, question as unknown as QuestionAPI, questions as unknown as QuestionAPI[]);\n      }\n    });\n  });\n}\n\n/**\n * Show question detail view (replaces the panel content)\n */\nfunction showQuestionDetail(panel: HTMLElement, question: QuestionAPI, allQuestions: QuestionAPI[]): void {\n  // Store original content\n  const originalContent = panel.innerHTML;\n  \n  // Create detail view\n  const detailView = createQuestionDetailView({\n    question,\n    onClose: () => {\n      // Restore original content\n      panel.innerHTML = originalContent;\n      // Re-render questions\n      const questions = dataStore.getState().questions;\n      renderQuestions(panel, questions);\n    },\n    onUpdate: (updatedQuestion) => {\n      // Update the question in data store\n      const questions = dataStore.getState().questions;\n      const index = questions.findIndex(q => q.id === updatedQuestion.id || String(q.id) === String(updatedQuestion.id));\n      if (index >= 0) {\n        questions[index] = updatedQuestion as unknown as Question;\n        dataStore.setQuestions(questions);\n      }\n    },\n    onNavigateToQuestion: (questionId) => {\n      // Navigate to another question\n      const targetQuestion = allQuestions.find(q => String(q.id) === questionId);\n      if (targetQuestion) {\n        showQuestionDetail(panel, targetQuestion, allQuestions);\n      }\n    }\n  });\n  \n  // Replace panel content with detail view\n  panel.innerHTML = '';\n  panel.appendChild(detailView);\n}\n\n/**\n * Create risks panel\n */\nfunction createRisksPanel(onClick?: (r: Risk) => void): HTMLElement {\n  const panel = createElement('div', { className: 'tab-panel risks-panel' });\n  panel.innerHTML = '<div class=\"risks-list\"></div>';\n  return panel;\n}\n\n/**\n * Render risks list\n */\nfunction renderRisks(panel: HTMLElement, risks: Risk[], onClick?: (r: Risk) => void): void {\n  const list = panel.querySelector('.risks-list');\n  if (!list) return;\n\n  if (risks.length === 0) {\n    list.innerHTML = '<div class=\"empty-state\">No risks identified</div>';\n    return;\n  }\n\n  list.innerHTML = risks.map(r => `\n    <div class=\"risk-card ${r.impact}-impact\" data-id=\"${r.id}\">\n      <div class=\"risk-header\">\n        <span class=\"impact-badge impact-${r.impact}\">${r.impact} impact</span>\n        <span class=\"probability-badge\">${r.probability} probability</span>\n      </div>\n      <div class=\"risk-description\">${escapeHtml(r.description || r.content || '')}</div>\n      ${r.mitigation ? `<div class=\"risk-mitigation\">Mitigation: ${escapeHtml(r.mitigation)}</div>` : ''}\n    </div>\n  `).join('');\n\n  if (onClick) {\n    list.querySelectorAll('.risk-card').forEach(card => {\n      on(card as HTMLElement, 'click', () => {\n        const id = card.getAttribute('data-id');\n        const risk = risks.find(r => r.id === id);\n        if (risk) onClick(risk);\n      });\n    });\n  }\n}\n\n/**\n * Create actions panel\n */\nfunction createActionsPanel(onClick?: (a: Action) => void): HTMLElement {\n  const panel = createElement('div', { className: 'tab-panel actions-panel' });\n  panel.innerHTML = '<div class=\"actions-list\"></div>';\n  return panel;\n}\n\n/**\n * Render actions list\n */\nfunction renderActions(panel: HTMLElement, actions: Action[], onClick?: (a: Action) => void): void {\n  const list = panel.querySelector('.actions-list');\n  if (!list) return;\n\n  if (actions.length === 0) {\n    list.innerHTML = '<div class=\"empty-state\">No actions defined</div>';\n    return;\n  }\n\n  list.innerHTML = actions.map(a => `\n    <div class=\"action-card ${a.status}\" data-id=\"${a.id}\">\n      <div class=\"action-header\">\n        <span class=\"priority-badge priority-${a.priority}\">${a.priority}</span>\n        <span class=\"status-badge ${a.status}\">${a.status.replace('_', ' ')}</span>\n      </div>\n      <div class=\"action-task\">${escapeHtml(a.task)}</div>\n      <div class=\"action-meta\">\n        ${a.assignee ? `<span>Assigned to: ${escapeHtml(a.assignee)}</span>` : ''}\n        ${a.dueDate ? `<span>Due: ${a.dueDate}</span>` : ''}\n      </div>\n    </div>\n  `).join('');\n\n  if (onClick) {\n    list.querySelectorAll('.action-card').forEach(card => {\n      on(card as HTMLElement, 'click', () => {\n        const id = card.getAttribute('data-id');\n        const action = actions.find(a => a.id === id);\n        if (action) onClick(action);\n      });\n    });\n  }\n}\n\n/**\n * Create decisions panel\n */\nfunction createDecisionsPanel(propsOrCallback?: { onDecisionClick?: (d: Decision) => void; useDetailView?: boolean; containerElement?: HTMLElement } | ((d: Decision) => void)): HTMLElement {\n  const panel = createElement('div', { className: 'tab-panel decisions-panel' });\n  panel.innerHTML = '<div class=\"decisions-list\"></div>';\n  return panel;\n}\n\n/**\n * Render decisions list\n */\nfunction renderDecisions(panel: HTMLElement, decisions: Decision[], onClick?: (d: Decision) => void): void {\n  const list = panel.querySelector('.decisions-list');\n  if (!list) return;\n\n  if (decisions.length === 0) {\n    list.innerHTML = '<div class=\"empty-state\">No decisions recorded</div>';\n    return;\n  }\n\n  list.innerHTML = decisions.map(d => `\n    <div class=\"decision-card\" data-id=\"${d.id}\">\n      <div class=\"decision-header\">\n        <span class=\"status-badge ${d.status}\">${d.status}</span>\n      </div>\n      <div class=\"decision-text\">${escapeHtml((d as any).content ?? d.decision ?? '')}</div>\n      ${d.rationale ? `<div class=\"decision-rationale\">Rationale: ${escapeHtml(d.rationale)}</div>` : ''}\n      <div class=\"decision-meta\">\n        ${((d as any).made_by ?? d.madeBy) ? `<span>By: ${escapeHtml((d as any).made_by ?? d.madeBy ?? '')}</span>` : ''}\n        <span>${formatRelativeTime((d as any).decided_at ?? (d as any).created_at ?? d.madeAt ?? '')}</span>\n      </div>\n    </div>\n  `).join('');\n\n  if (onClick) {\n    list.querySelectorAll('.decision-card').forEach(card => {\n      on(card as HTMLElement, 'click', () => {\n        const id = card.getAttribute('data-id');\n        const decision = decisions.find(d => d.id === id);\n        if (decision) onClick(decision);\n      });\n    });\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Mount to container\n */\nexport function mountSourceOfTruth(selector: string, props: SourceOfTruthProps = {}): HTMLElement | null {\n  const container = document.querySelector(selector);\n  if (!container) {\n    console.warn(`SourceOfTruth: Container not found: ${selector}`);\n    return null;\n  }\n\n  const sot = createSourceOfTruth(props);\n  container.appendChild(sot);\n  return sot;\n}\n\nexport default createSourceOfTruth;\n","/**\n * Risk Modal Component\n * Create, view and edit risks\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { Risk } from '../../stores/data';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\nimport { risksService } from '../../services/risks';\n\nconst MODAL_ID = 'risk-modal';\n\nexport interface RiskModalProps {\n  mode: 'view' | 'edit' | 'create';\n  risk?: Risk;\n  onSave?: (risk: Risk) => void;\n  onDelete?: (riskId: string) => void;\n}\n\n/**\n * Show risk modal\n */\nexport function showRiskModal(props: RiskModalProps): void {\n  const { mode, risk, onSave, onDelete } = props;\n  const isEdit = mode === 'edit' && risk?.id;\n  const isView = mode === 'view';\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'risk-modal-content' });\n\n  const riskDesc = risk?.description ?? (risk as { content?: string })?.content ?? '';\n  const riskProb = risk?.probability ?? (risk as { likelihood?: string })?.likelihood ?? 'medium';\n  const riskCreated = risk?.createdAt ?? (risk as { created_at?: string })?.created_at ?? '';\n\n  if (isView && risk) {\n    content.innerHTML = `\n      <div class=\"risk-view\">\n        <div class=\"risk-meta\">\n          <span class=\"impact-badge impact-${risk.impact}\">${risk.impact} impact</span>\n          <span class=\"probability-badge\">${riskProb} probability</span>\n          <span class=\"status-badge ${risk.status}\">${risk.status}</span>\n        </div>\n        \n        <div class=\"risk-description-large\">\n          ${escapeHtml(riskDesc)}\n        </div>\n        \n        ${risk.mitigation ? `\n          <div class=\"risk-mitigation-section\">\n            <h4>Mitigation Strategy</h4>\n            <p>${escapeHtml(risk.mitigation)}</p>\n          </div>\n        ` : ''}\n        \n        <div class=\"risk-date\">Created ${formatRelativeTime(riskCreated)}</div>\n      </div>\n    `;\n  } else {\n    const riskOwner = risk?.owner ?? '';\n    content.innerHTML = `\n      <form id=\"risk-form\" class=\"risk-form\">\n        <div class=\"form-group\" style=\"display: flex; align-items: center; gap: 12px; flex-wrap: wrap;\">\n          <label for=\"risk-description\" style=\"margin-bottom: 0;\">Risk Description *</label>\n          <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-ai-suggest-btn\" title=\"Suggest owner and mitigation from description\"> AI suggest</button>\n        </div>\n        <div class=\"form-group\">\n          <textarea id=\"risk-description\" rows=\"3\" required \n                    placeholder=\"Describe the risk...\">${riskDesc}</textarea>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"risk-impact\">Impact</label>\n            <select id=\"risk-impact\">\n              <option value=\"low\" ${risk?.impact === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${risk?.impact === 'medium' || !risk ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${risk?.impact === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n          \n          <div class=\"form-group\">\n            <label for=\"risk-probability\">Probability</label>\n            <select id=\"risk-probability\">\n              <option value=\"low\" ${riskProb === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${riskProb === 'medium' ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${riskProb === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"risk-status\">Status</label>\n          <select id=\"risk-status\">\n            <option value=\"open\" ${risk?.status === 'open' || !risk ? 'selected' : ''}>Open</option>\n            <option value=\"mitigating\" ${risk?.status === 'mitigating' ? 'selected' : ''}>Mitigating</option>\n            <option value=\"mitigated\" ${risk?.status === 'mitigated' ? 'selected' : ''}>Mitigated</option>\n            <option value=\"accepted\" ${risk?.status === 'accepted' ? 'selected' : ''}>Accepted</option>\n            <option value=\"closed\" ${risk?.status === 'closed' ? 'selected' : ''}>Closed</option>\n          </select>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"risk-owner\">Owner</label>\n          <input type=\"text\" id=\"risk-owner\" class=\"form-input\" placeholder=\"Who owns this risk?\" value=\"${escapeHtml(riskOwner)}\">\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"risk-mitigation\">Mitigation Strategy</label>\n          <textarea id=\"risk-mitigation\" rows=\"3\" \n                    placeholder=\"How will this risk be mitigated?\">${risk?.mitigation || ''}</textarea>\n        </div>\n      </form>\n    `;\n\n    const suggestBtn = content.querySelector('#risk-ai-suggest-btn');\n    if (suggestBtn) {\n      on(suggestBtn as HTMLElement, 'click', async () => {\n        const descEl = content.querySelector('#risk-description') as HTMLTextAreaElement;\n        const impactEl = content.querySelector('#risk-impact') as HTMLSelectElement;\n        const probEl = content.querySelector('#risk-probability') as HTMLSelectElement;\n        const contentText = descEl?.value?.trim() || '';\n        if (!contentText) {\n          toast.error('Enter a risk description first');\n          return;\n        }\n        (suggestBtn as HTMLButtonElement).disabled = true;\n        (suggestBtn as HTMLButtonElement).textContent = '';\n        try {\n          const result = await risksService.suggest({\n            content: contentText,\n            impact: impactEl?.value || 'medium',\n            likelihood: probEl?.value || 'medium',\n          });\n          const ownerEl = content.querySelector('#risk-owner') as HTMLInputElement;\n          const mitigationEl = content.querySelector('#risk-mitigation') as HTMLTextAreaElement;\n          if (ownerEl && result.suggested_owner) ownerEl.value = result.suggested_owner;\n          if (mitigationEl && result.suggested_mitigation) mitigationEl.value = result.suggested_mitigation;\n          toast.success('Owner and mitigation suggested');\n        } catch (e) {\n          toast.error((e as Error).message || 'AI suggest failed');\n        } finally {\n          (suggestBtn as HTMLButtonElement).disabled = false;\n          (suggestBtn as HTMLButtonElement).textContent = ' AI suggest';\n        }\n      });\n    }\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  if (isView) {\n    const editBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Edit',\n    });\n\n    const closeBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Close',\n    });\n\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    on(editBtn, 'click', () => {\n      closeModal(MODAL_ID);\n      showRiskModal({ ...props, mode: 'edit' });\n    });\n\n    footer.appendChild(closeBtn);\n    footer.appendChild(editBtn);\n  } else {\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const saveBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: isEdit ? 'Save Changes' : 'Create Risk',\n    });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n    on(saveBtn, 'click', async () => {\n      const form = content.querySelector('#risk-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\n\n      const desc = getValue('risk-description');\n      const owner = getValue('risk-owner') || undefined;\n      const riskData: Risk & { content?: string; likelihood?: string; owner?: string } = {\n        id: risk?.id || `risk-${Date.now()}`,\n        description: desc,\n        content: desc,\n        impact: getValue('risk-impact') as Risk['impact'],\n        probability: getValue('risk-probability') as Risk['probability'],\n        likelihood: getValue('risk-probability') as 'low' | 'medium' | 'high',\n        status: getValue('risk-status') as Risk['status'],\n        mitigation: getValue('risk-mitigation') || undefined,\n        owner,\n        createdAt: risk?.createdAt ?? (risk as { created_at?: string })?.created_at ?? new Date().toISOString(),\n      };\n\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Saving...';\n\n      try {\n        if (isEdit) {\n          await http.put(`/api/risks/${risk!.id}`, { content: riskData.content ?? riskData.description, impact: riskData.impact, likelihood: riskData.likelihood ?? riskData.probability, mitigation: riskData.mitigation, status: riskData.status, owner: riskData.owner });\n          toast.success('Risk updated');\n        } else {\n          const response = await http.post<{ id: string; risk: Risk }>('/api/risks', { content: riskData.content ?? riskData.description, impact: riskData.impact, likelihood: riskData.likelihood ?? riskData.probability, mitigation: riskData.mitigation, status: riskData.status, owner: riskData.owner });\n          const created = response.data.risk;\n          if (created) riskData.id = created.id as string;\n          else riskData.id = response.data.id as string;\n          toast.success('Risk created');\n        }\n\n        onSave?.({ ...riskData, description: riskData.description ?? riskData.content, content: riskData.content ?? riskData.description } as Risk);\n        closeModal(MODAL_ID);\n      } catch {\n        // Error shown by API service\n      } finally {\n        saveBtn.disabled = false;\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Risk';\n      }\n    });\n\n    if (isEdit) {\n      const deleteBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Delete',\n      });\n\n      on(deleteBtn, 'click', async () => {\n        const { confirm } = await import('../Modal');\n        const confirmed = await confirm(\n          'Are you sure you want to delete this risk?',\n          {\n            title: 'Delete Risk',\n            confirmText: 'Delete',\n            confirmClass: 'btn-danger',\n          }\n        );\n\n        if (confirmed) {\n          try {\n            await http.delete(`/api/risks/${risk!.id}`);\n            toast.success('Risk deleted');\n            onDelete?.(String(risk!.id));\n            closeModal(MODAL_ID);\n          } catch {\n            // Error shown by API service\n          }\n        }\n      });\n\n      footer.appendChild(saveBtn);\n      footer.appendChild(cancelBtn);\n      footer.appendChild(deleteBtn);\n    } else {\n      footer.appendChild(saveBtn);\n      footer.appendChild(cancelBtn);\n    }\n  }\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: isView ? 'Risk Details' : (isEdit ? 'Edit Risk' : 'New Risk'),\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showRiskModal;\n","/**\n * Risk Detail View\n * Full-page view for risk details: content, impact, likelihood, mitigation, status, owner, source, timeline\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { Risk, RiskEvent, RiskOwnerSuggestion, risksService } from '../../services/risks';\nimport { contactsService, Contact } from '../../services/contacts';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\n\nexport interface RiskDetailViewProps {\n  risk: Risk;\n  onClose: () => void;\n  onUpdate?: (risk: Risk) => void;\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nfunction formatDate(iso: string | undefined): string {\n  if (!iso) return '';\n  try {\n    return formatDateTime(iso);\n  } catch {\n    return iso;\n  }\n}\n\nfunction getScoreColor(score: number): string {\n  if (score >= 70) return 'var(--success, #4ecdc4)';\n  if (score >= 50) return 'var(--warning, #ffe66d)';\n  return 'var(--text-muted, #6a6a8a)';\n}\n\nfunction getInitials(name: string): string {\n  return name\n    .trim()\n    .split(/\\s+/)\n    .map((s) => s[0])\n    .join('')\n    .toUpperCase()\n    .substring(0, 2);\n}\n\nfunction getRiskEventIcon(eventType: string): string {\n  const icons: Record<string, string> = {\n    created: '',\n    updated: '',\n    deleted: '',\n    restored: '',\n  };\n  return icons[eventType] || '';\n}\n\nfunction getRiskEventDescription(ev: RiskEvent): string {\n  const data = ev.event_data || {};\n  const actor = ev.actor_name ? ` by ${ev.actor_name}` : '';\n\n  switch (ev.event_type) {\n    case 'created':\n      return `Created${actor}`;\n    case 'updated': {\n      const changes = (data.changes as Array<{ field: string; from: string; to: string }>) || [];\n      if (changes.length === 0) return `Updated${actor}`;\n      if (changes.length === 1) {\n        const c = changes[0];\n        const toStr = String(c.to).trim() ? c.to : '';\n        const fromStr = String(c.from).trim() ? c.from : '';\n        return `${c.field} changed: ${fromStr}  ${toStr}${actor}`;\n      }\n      return `${changes.map((c) => `${c.field}: ${c.from || ''}  ${c.to || ''}`).join('; ')}${actor}`;\n    }\n    case 'deleted':\n      return `Deleted${data.reason ? ` (${data.reason})` : ''}${actor}`;\n    case 'restored':\n      return `Restored${actor}`;\n    default:\n      return ev.event_type;\n  }\n}\n\nexport function createRiskDetailView(props: RiskDetailViewProps): HTMLElement {\n  const { risk, onClose, onUpdate } = props;\n\n  const container = createElement('div', { className: 'risk-detail-view question-detail-view' });\n\n  container.innerHTML = `\n    <div class=\"question-detail-header risk-detail-header\">\n      <div class=\"breadcrumb\">\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Risks</a>\n        <span class=\"breadcrumb-separator\"></span>\n        <span class=\"breadcrumb-current\">Risk #${String(risk.id).substring(0, 8)}</span>\n      </div>\n      <div class=\"header-actions\">\n        <span class=\"status-badge status-${(risk.status || 'open').toLowerCase()}\">${escapeHtml(String(risk.status))}</span>\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\n      </div>\n    </div>\n\n    <div class=\"question-detail-content risk-detail-content\">\n      <div id=\"risk-view-content\">\n      <section class=\"detail-section risk-main\">\n        <div class=\"question-badges risk-badges\">\n          ${risk.impact ? `<span class=\"priority-pill impact-${risk.impact}\">${escapeHtml(risk.impact)} impact</span>` : ''}\n          ${risk.likelihood ? `<span class=\"priority-pill likelihood-${risk.likelihood}\">${escapeHtml(risk.likelihood)} likelihood</span>` : ''}\n          ${risk.generation_source ? `<span class=\"status-pill\">${escapeHtml(risk.generation_source)}</span>` : ''}\n          <span class=\"question-date risk-date\">Created ${formatRelativeTime(risk.created_at)}</span>\n        </div>\n        <h2 class=\"question-text risk-content-text\">${escapeHtml(risk.content)}</h2>\n      </section>\n\n      <div class=\"detail-columns\">\n        <div class=\"detail-column-left\">\n          <!-- Assignment (Owner) Section - SOTA (aligned with Questions) -->\n          <section class=\"detail-section\" id=\"risk-assignment-section\">\n            <div class=\"section-header-sota\">\n              <h3>\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                </svg>\n                Assignment\n                <span class=\"section-subtitle\">Who should own this risk?</span>\n              </h3>\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"risk-ai-suggest-btn\" title=\"Suggest owner and mitigation from risk content\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Suggest\n              </button>\n            </div>\n\n            <!-- Current Assignment (Owner) Display -->\n            <div id=\"risk-current-assignment\" class=\"current-assignment-card\">\n              ${risk.owner ? `\n                <div class=\"assigned-contact-display\">\n                  <div class=\"contact-avatar-lg\" id=\"risk-assigned-avatar\">${getInitials(risk.owner)}</div>\n                  <div class=\"contact-details\">\n                    <div class=\"contact-name-lg\">${escapeHtml(risk.owner)}</div>\n                    <div class=\"contact-role-sm\" id=\"risk-assigned-role\"></div>\n                  </div>\n                  <button class=\"btn-change-assignment\" id=\"risk-change-owner-btn\" type=\"button\">\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                    Change\n                  </button>\n                </div>\n              ` : `\n                <div class=\"no-assignment\">\n                  <div class=\"no-assignment-icon\">\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\n                  </div>\n                  <span>No one assigned</span>\n                  <p class=\"no-assignment-hint\">Use AI Suggest or choose manually</p>\n                  <button class=\"btn-assign-now\" id=\"risk-show-picker-btn\" type=\"button\">Choose Manually</button>\n                </div>\n              `}\n            </div>\n\n            <!-- Contact Picker (hidden by default) -->\n            <div id=\"risk-contact-picker\" class=\"contact-picker-sota\" style=\"display: none;\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"risk-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"risk-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n\n            <!-- AI Suggestions Panel -->\n            <div id=\"risk-suggestions-panel\" class=\"suggestions-panel-sota risk-suggestions-panel\" style=\"display: none;\"></div>\n\n            <!-- Mitigation (below assignment) -->\n            <div class=\"risk-mitigation-block\">\n              <strong>Mitigation</strong>\n              <p id=\"risk-detail-mitigation\" class=\"risk-mitigation\">${risk.mitigation ? escapeHtml(risk.mitigation) : '<span class=\"text-muted\">No mitigation recorded</span>'}</p>\n            </div>\n          </section>\n\n          <section class=\"detail-section\">\n            <div class=\"section-header\">\n              <h3>Source</h3>\n            </div>\n            ${risk.source_file ? `<p class=\"source-file\">${escapeHtml(risk.source_file)}</p>` : ''}\n            ${risk.source_document_id ? `\n              <p class=\"source-doc\">\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(risk.source_document_id))}\">View source document</a>\n              </p>\n            ` : ''}\n            ${!risk.source_file && !risk.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\n          </section>\n        </div>\n\n        <div class=\"detail-column-right\">\n          <section class=\"detail-section metadata-section\">\n            <h3>Metadata</h3>\n            <dl class=\"metadata-list\">\n              <dt>Created</dt>\n              <dd>${formatDate(risk.created_at)}</dd>\n              ${risk.updated_at ? `<dt>Updated</dt><dd>${formatDate(risk.updated_at)}</dd>` : ''}\n            </dl>\n          </section>\n\n          <section class=\"detail-section\" id=\"risk-timeline-section\">\n            <h3>Timeline</h3>\n            <div id=\"timeline-content\" class=\"timeline-content\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n        </div>\n      </div>\n\n      <div class=\"detail-actions\">\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-risk-btn\">Edit</button>\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-risk-btn\">Delete</button>\n      </div>\n      </div>\n\n      <div id=\"risk-edit-form\" class=\"risk-detail-edit-form\" style=\"display: none;\">\n        <form id=\"risk-inline-form\" class=\"risk-form\">\n          <div class=\"form-group\">\n            <div style=\"display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px; margin-bottom: 6px;\">\n              <label for=\"risk-edit-content\" style=\"margin-bottom: 0;\">Risk description *</label>\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"risk-edit-ai-suggest-btn\" title=\"Suggest owner and mitigation from description\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI suggest\n              </button>\n            </div>\n            <textarea id=\"risk-edit-content\" rows=\"3\" required placeholder=\"Describe the risk...\">${escapeHtml(risk.content || '')}</textarea>\n          </div>\n          <div id=\"risk-edit-suggestions-panel\" class=\"suggestions-panel-sota risk-suggestions-panel\" style=\"display: none; margin-bottom: 16px;\"></div>\n          <div class=\"form-row\">\n            <div class=\"form-group\">\n              <label for=\"risk-edit-impact\">Impact</label>\n              <select id=\"risk-edit-impact\">\n                <option value=\"low\" ${risk.impact === 'low' ? 'selected' : ''}>Low</option>\n                <option value=\"medium\" ${risk.impact === 'medium' || !risk.impact ? 'selected' : ''}>Medium</option>\n                <option value=\"high\" ${risk.impact === 'high' ? 'selected' : ''}>High</option>\n              </select>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"risk-edit-likelihood\">Likelihood</label>\n              <select id=\"risk-edit-likelihood\">\n                <option value=\"low\" ${risk.likelihood === 'low' ? 'selected' : ''}>Low</option>\n                <option value=\"medium\" ${risk.likelihood === 'medium' || !risk.likelihood ? 'selected' : ''}>Medium</option>\n                <option value=\"high\" ${risk.likelihood === 'high' ? 'selected' : ''}>High</option>\n              </select>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"risk-edit-status\">Status</label>\n              <select id=\"risk-edit-status\">\n                <option value=\"open\" ${risk.status === 'open' || !risk.status ? 'selected' : ''}>Open</option>\n                <option value=\"mitigating\" ${risk.status === 'mitigating' ? 'selected' : ''}>Mitigating</option>\n                <option value=\"mitigated\" ${risk.status === 'mitigated' ? 'selected' : ''}>Mitigated</option>\n                <option value=\"accepted\" ${risk.status === 'accepted' ? 'selected' : ''}>Accepted</option>\n                <option value=\"closed\" ${risk.status === 'closed' ? 'selected' : ''}>Closed</option>\n              </select>\n            </div>\n          </div>\n          <div class=\"form-group risk-owner-picker-wrap\">\n            <label>Owner</label>\n            <input type=\"hidden\" id=\"risk-edit-owner\" value=\"${escapeHtml(risk.owner || '')}\">\n            <div class=\"risk-owner-picker-trigger\" id=\"risk-owner-picker-trigger\" title=\"Click to select from project contacts\">\n              <span class=\"risk-owner-picker-value\" id=\"risk-owner-picker-value\">${risk.owner ? escapeHtml(risk.owner) : '<span class=\"text-muted\">Select owner...</span>'}</span>\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\n            </div>\n            <div id=\"risk-owner-picker-dropdown\" class=\"risk-owner-picker-dropdown\" style=\"display: none;\">\n              <div class=\"risk-owner-picker-search\">\n                <input type=\"text\" id=\"risk-owner-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"risk-owner-picker-list\" class=\"risk-owner-picker-list\">Loading...</div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"risk-edit-mitigation\">Mitigation strategy</label>\n            <textarea id=\"risk-edit-mitigation\" rows=\"3\" placeholder=\"How will this risk be mitigated?\">${escapeHtml(risk.mitigation || '')}</textarea>\n          </div>\n        </form>\n        <div class=\"detail-actions\">\n          <button type=\"button\" class=\"btn btn-primary\" id=\"risk-save-btn\">Save</button>\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"risk-cancel-edit-btn\">Cancel</button>\n          <button type=\"button\" class=\"btn btn-danger\" id=\"risk-delete-in-edit-btn\">Delete</button>\n        </div>\n      </div>\n    </div>\n  `;\n\n  const backLink = container.querySelector('#back-to-list');\n  if (backLink) {\n    on(backLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      onClose();\n    });\n  }\n  const closeBtn = container.querySelector('#close-detail');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', onClose);\n  }\n\n  const viewContent = container.querySelector('#risk-view-content') as HTMLElement;\n  const editForm = container.querySelector('#risk-edit-form') as HTMLElement;\n\n  const editBtn = container.querySelector('#edit-risk-btn');\n  if (editBtn && viewContent && editForm) {\n    on(editBtn as HTMLElement, 'click', () => {\n      viewContent.style.display = 'none';\n      editForm.style.display = 'block';\n    });\n  }\n\n  const cancelEditBtn = container.querySelector('#risk-cancel-edit-btn');\n  if (cancelEditBtn && viewContent && editForm) {\n    on(cancelEditBtn as HTMLElement, 'click', () => {\n      editForm.style.display = 'none';\n      viewContent.style.display = '';\n    });\n  }\n\n  const saveBtn = container.querySelector('#risk-save-btn');\n  if (saveBtn && editForm && onUpdate) {\n    on(saveBtn as HTMLElement, 'click', async () => {\n      const form = container.querySelector('#risk-inline-form') as HTMLFormElement;\n      if (!form?.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n      const contentEl = container.querySelector('#risk-edit-content') as HTMLTextAreaElement;\n      const impactEl = container.querySelector('#risk-edit-impact') as HTMLSelectElement;\n      const likelihoodEl = container.querySelector('#risk-edit-likelihood') as HTMLSelectElement;\n      const statusEl = container.querySelector('#risk-edit-status') as HTMLSelectElement;\n      const ownerEl = container.querySelector('#risk-edit-owner') as HTMLInputElement;\n      const mitigationEl = container.querySelector('#risk-edit-mitigation') as HTMLTextAreaElement;\n      const content = contentEl?.value?.trim() || '';\n      if (!content) {\n        toast.error('Risk description is required');\n        return;\n      }\n      (saveBtn as HTMLButtonElement).disabled = true;\n      (saveBtn as HTMLButtonElement).textContent = 'Saving...';\n      try {\n        const updated = await risksService.update(risk.id, {\n          content,\n          impact: (impactEl?.value || 'medium') as Risk['impact'],\n          likelihood: (likelihoodEl?.value || 'medium') as Risk['likelihood'],\n          status: (statusEl?.value || 'open') as Risk['status'],\n          owner: ownerEl?.value?.trim() || undefined,\n          mitigation: mitigationEl?.value?.trim() || undefined,\n        });\n        toast.success('Risk updated');\n        onUpdate(updated);\n      } catch {\n        toast.error('Failed to save');\n      } finally {\n        (saveBtn as HTMLButtonElement).disabled = false;\n        (saveBtn as HTMLButtonElement).textContent = 'Save';\n      }\n    });\n  }\n\n  const deleteInEditBtn = container.querySelector('#risk-delete-in-edit-btn');\n  if (deleteInEditBtn) {\n    on(deleteInEditBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this risk?')) return;\n      try {\n        await risksService.delete(risk.id);\n        toast.success('Risk deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete');\n      }\n    });\n  }\n\n  // Owner contact picker in edit form (project contacts with cards)\n  const ownerPickerTrigger = container.querySelector('#risk-owner-picker-trigger');\n  const ownerPickerDropdown = container.querySelector('#risk-owner-picker-dropdown') as HTMLElement;\n  const ownerPickerValue = container.querySelector('#risk-owner-picker-value');\n  const ownerHiddenInput = container.querySelector('#risk-edit-owner') as HTMLInputElement;\n  const ownerPickerList = container.querySelector('#risk-owner-picker-list') as HTMLElement;\n  const ownerPickerSearch = container.querySelector('#risk-owner-picker-search') as HTMLInputElement;\n\n  if (ownerPickerTrigger && ownerPickerDropdown && ownerPickerList && ownerHiddenInput) {\n    let editFormContacts: Contact[] = [];\n    const renderOwnerPickerList = (filter = '') => {\n      const filtered = filter\n        ? editFormContacts.filter(\n            (c) =>\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\n          )\n        : editFormContacts;\n      if (editFormContacts.length === 0) {\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n        return;\n      }\n      if (filtered.length === 0) {\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n        return;\n      }\n      ownerPickerList.innerHTML = filtered\n        .map((c) => {\n          const photoUrl = c.photoUrl || c.avatarUrl;\n          const selected = (ownerHiddenInput?.value || '').trim() === (c.name || '').trim();\n          return `\n            <div class=\"risk-owner-card-picker ${selected ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n              <div class=\"risk-owner-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n              <div class=\"risk-owner-card-info\">\n                <div class=\"risk-owner-card-name\">${escapeHtml(c.name || '')}</div>\n                ${c.role ? `<div class=\"risk-owner-card-role\">${escapeHtml(c.role)}</div>` : ''}\n              </div>\n            </div>\n          `;\n        })\n        .join('');\n      ownerPickerList.querySelectorAll('.risk-owner-card-picker').forEach((card) => {\n        on(card as HTMLElement, 'click', () => {\n          const name = card.getAttribute('data-contact-name') || '';\n          ownerHiddenInput.value = name;\n          if (ownerPickerValue) ownerPickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select owner...</span>';\n          ownerPickerDropdown.style.display = 'none';\n        });\n      });\n    };\n    on(ownerPickerTrigger as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const isOpen = ownerPickerDropdown.style.display === 'block';\n      ownerPickerDropdown.style.display = isOpen ? 'none' : 'block';\n      if (!isOpen && editFormContacts.length === 0) {\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\n        try {\n          const res = await contactsService.getAll();\n          editFormContacts = res?.contacts || [];\n          renderOwnerPickerList(ownerPickerSearch?.value || '');\n        } catch {\n          ownerPickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n        }\n      } else if (!isOpen) renderOwnerPickerList(ownerPickerSearch?.value || '');\n    });\n    if (ownerPickerSearch) {\n      ownerPickerSearch.addEventListener('input', () => renderOwnerPickerList(ownerPickerSearch.value));\n    }\n    document.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n      if (!target.closest('.risk-owner-picker-wrap') && ownerPickerDropdown?.style.display === 'block') {\n        ownerPickerDropdown.style.display = 'none';\n      }\n    });\n  }\n\n  // AI suggest in edit form (fill owner + mitigation)\n  const editAiSuggestBtn = container.querySelector('#risk-edit-ai-suggest-btn');\n  const editSuggestionsPanel = container.querySelector('#risk-edit-suggestions-panel') as HTMLElement;\n  if (editAiSuggestBtn && editSuggestionsPanel) {\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\n      const contentEl = container.querySelector('#risk-edit-content') as HTMLTextAreaElement;\n      const content = contentEl?.value?.trim() || '';\n      if (!content) {\n        toast.error('Enter a risk description first');\n        return;\n      }\n      const btn = editAiSuggestBtn as HTMLButtonElement;\n      btn.disabled = true;\n      btn.innerHTML = '<span class=\"spin\"></span> Analyzing...';\n      editSuggestionsPanel.style.display = 'block';\n      editSuggestionsPanel.innerHTML = '<div class=\"suggestions-loading\"><div class=\"loading-text\">AI is suggesting owners and mitigation...</div></div>';\n      try {\n        const [result, contactsRes] = await Promise.all([\n          risksService.suggest({ content, impact: (container.querySelector('#risk-edit-impact') as HTMLSelectElement)?.value || 'medium', likelihood: (container.querySelector('#risk-edit-likelihood') as HTMLSelectElement)?.value || 'medium' }),\n          contactsService.getAll(),\n        ]);\n        const contacts: Contact[] = contactsRes?.contacts || [];\n        const owners: RiskOwnerSuggestion[] = result.suggested_owners?.length ? result.suggested_owners : result.suggested_owner ? [{ name: result.suggested_owner, reason: '', score: 0 }] : [];\n        const mitigation = result.suggested_mitigation || '';\n        if (owners.length === 0 && !mitigation) {\n          editSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\"><div class=\"no-suggestions-text\">No suggestions</div><button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close</button></div>';\n        } else {\n          editSuggestionsPanel.innerHTML = `\n            <div class=\"suggestions-header-sota\"><div class=\"ai-badge\"> AI Recommended</div></div>\n            ${owners.length > 0 ? `<div class=\"suggestions-list-sota\">${owners.map((s, i) => {\n              const contact = contacts.find((c) => (c.name || '').trim().toLowerCase() === (s.name || '').trim().toLowerCase());\n              const photoUrl = contact?.photoUrl || contact?.avatarUrl || (contact as { photo_url?: string })?.photo_url || (contact as { avatar_url?: string })?.avatar_url;\n              const roleOrReason = contact?.role ?? s.reason ?? '';\n              const score = s.score ?? 0;\n              const scoreColor = getScoreColor(score);\n              return `<div class=\"suggestion-card-sota risk-owner-card\" data-owner-name=\"${escapeHtml(s.name || '')}\">\n                <div class=\"suggestion-rank\">#${i + 1}</div>\n                <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\n                <div class=\"suggestion-info-sota\"><div class=\"suggestion-name-sota\">${escapeHtml(s.name || '')}</div>${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}</div>\n                ${score > 0 ? `<div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\"><div class=\"score-value\">${score}%</div></div>` : ''}\n                <button type=\"button\" class=\"btn-select-suggestion\">Assign</button>\n              </div>`;\n            }).join('')}</div>` : ''}\n            ${mitigation ? `<div class=\"risk-suggestion-card risk-mitigation-suggestion\"><strong>Suggested mitigation</strong><p class=\"risk-suggestion-mitigation\">${escapeHtml(mitigation)}</p><button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-edit-apply-mitigation-btn\">Apply mitigation</button></div>` : ''}\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close suggestions</button></div>\n          `;\n          editSuggestionsPanel.querySelectorAll('.risk-owner-card .btn-select-suggestion').forEach((assignBtn) => {\n            const card = (assignBtn as HTMLElement).closest('.risk-owner-card');\n            const name = card?.getAttribute('data-owner-name') || '';\n            if (!name) return;\n            on(assignBtn as HTMLElement, 'click', () => {\n              if (ownerHiddenInput) ownerHiddenInput.value = name;\n              if (ownerPickerValue) ownerPickerValue.innerHTML = escapeHtml(name);\n              editSuggestionsPanel.style.display = 'none';\n              toast.success(`Owner set to ${name}`);\n            });\n          });\n          const applyMitigationBtn = editSuggestionsPanel.querySelector('#risk-edit-apply-mitigation-btn');\n          if (applyMitigationBtn && mitigation) {\n            on(applyMitigationBtn as HTMLElement, 'click', () => {\n              const mitigationEl = container.querySelector('#risk-edit-mitigation') as HTMLTextAreaElement;\n              if (mitigationEl) mitigationEl.value = mitigation;\n              toast.success('Mitigation applied');\n            });\n          }\n        }\n        const hideBtn = editSuggestionsPanel.querySelector('#risk-edit-hide-suggest-btn');\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { editSuggestionsPanel.style.display = 'none'; });\n      } catch {\n        editSuggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close</button></div>';\n        const h = editSuggestionsPanel.querySelector('#risk-edit-hide-suggest-btn');\n        if (h) on(h as HTMLElement, 'click', () => { editSuggestionsPanel.style.display = 'none'; });\n      } finally {\n        btn.disabled = false;\n        btn.innerHTML = '<svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> AI suggest';\n      }\n    });\n  }\n\n  const deleteBtn = container.querySelector('#delete-risk-btn');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this risk?')) return;\n      try {\n        await risksService.delete(risk.id);\n        toast.success('Risk deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete risk');\n      }\n    });\n  }\n\n  // AI suggest owner & mitigation (same UX as Question Assignment: list of owner cards with Assign each)\n  let lastMitigation = '';\n  const aiSuggestBtn = container.querySelector('#risk-ai-suggest-btn');\n  const suggestionsPanel = container.querySelector('#risk-suggestions-panel') as HTMLElement;\n  if (aiSuggestBtn && suggestionsPanel) {\n    on(aiSuggestBtn as HTMLElement, 'click', async () => {\n      const btn = aiSuggestBtn as HTMLButtonElement;\n      btn.disabled = true;\n      btn.innerHTML = `\n        <svg class=\"spin\" width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\n        </svg>\n        Analyzing...\n      `;\n      suggestionsPanel.style.display = 'block';\n      suggestionsPanel.innerHTML = `\n        <div class=\"suggestions-loading\">\n          <div class=\"ai-thinking-animation\"><span></span><span></span><span></span></div>\n          <div class=\"loading-text\">AI is suggesting owners and mitigation...</div>\n        </div>\n      `;\n      try {\n        const [result, contactsRes] = await Promise.all([\n          risksService.suggest({\n            content: risk.content || '',\n            impact: risk.impact || 'medium',\n            likelihood: risk.likelihood || 'medium',\n          }),\n          contactsService.getAll(),\n        ]);\n        const contacts: Contact[] = contactsRes?.contacts || [];\n        lastMitigation = result.suggested_mitigation || '';\n        const owners: RiskOwnerSuggestion[] = result.suggested_owners?.length ? result.suggested_owners : (result.suggested_owner ? [{ name: result.suggested_owner, reason: '', score: 0 }] : []);\n\n        if (owners.length === 0 && !lastMitigation) {\n          suggestionsPanel.innerHTML = `\n            <div class=\"no-suggestions\">\n              <div class=\"no-suggestions-text\">No owner or mitigation suggestions</div>\n              <button type=\"button\" class=\"btn-link\" id=\"risk-hide-suggestions-btn\">Close</button>\n            </div>\n          `;\n        } else {\n          suggestionsPanel.innerHTML = `\n            <div class=\"suggestions-header-sota\">\n              <div class=\"ai-badge\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n                </svg>\n                AI Recommended\n              </div>\n            </div>\n            ${owners.length > 0 ? `\n            <div class=\"suggestions-list-sota\">\n              ${owners.map((s, i) => {\n                const score = s.score ?? 0;\n                const scoreColor = getScoreColor(score);\n                const contact = contacts.find((c) => (c.name || '').trim().toLowerCase() === (s.name || '').trim().toLowerCase());\n                const photoUrl = contact?.photoUrl || contact?.avatarUrl || (contact as { photo_url?: string })?.photo_url || (contact as { avatar_url?: string })?.avatar_url;\n                const roleOrReason = contact?.role ?? s.reason ?? '';\n                return `\n                  <div class=\"suggestion-card-sota risk-owner-card\" data-index=\"${i}\">\n                    <div class=\"suggestion-rank\">#${i + 1}</div>\n                    <div class=\"suggestion-avatar-sota\">${photoUrl\n                      ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(s.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">`\n                      : getInitials(s.name)}</div>\n                    <div class=\"suggestion-info-sota\">\n                      <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\n                      ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\n                    </div>\n                    ${score > 0 ? `\n                    <div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\">\n                      <div class=\"score-ring\">\n                        <svg viewBox=\"0 0 36 36\">\n                          <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                          <path class=\"score-fill\" stroke-dasharray=\"${score}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                        </svg>\n                        <div class=\"score-value\">${score}%</div>\n                      </div>\n                      <div class=\"score-label\">Match</div>\n                    </div>\n                    ` : ''}\n                    <button type=\"button\" class=\"btn-select-suggestion\">\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n                      </svg>\n                      Assign\n                    </button>\n                  </div>\n                `;\n              }).join('')}\n            </div>\n            ` : ''}\n            ${lastMitigation ? `\n            <div class=\"risk-suggestion-card risk-mitigation-suggestion\">\n              <strong>Suggested mitigation</strong>\n              <p class=\"risk-suggestion-mitigation\">${escapeHtml(lastMitigation)}</p>\n              <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-apply-mitigation-btn\">Apply mitigation</button>\n            </div>\n            ` : ''}\n            <div class=\"suggestions-footer\">\n              <button type=\"button\" class=\"btn-link\" id=\"risk-hide-suggestions-btn\">Close suggestions</button>\n            </div>\n          `;\n\n          // Bind Assign per owner card\n          suggestionsPanel.querySelectorAll('.risk-owner-card').forEach((item) => {\n            const selectBtn = item.querySelector('.btn-select-suggestion');\n            if (!selectBtn) return;\n            const idx = parseInt(item.getAttribute('data-index') || '0');\n            const suggestion = owners[idx];\n            if (!suggestion || !onUpdate) return;\n            on(selectBtn as HTMLElement, 'click', async (e) => {\n              e.stopPropagation();\n              try {\n                const updated = await risksService.update(risk.id, { owner: suggestion.name });\n                suggestionsPanel.style.display = 'none';\n                onUpdate(updated);\n                toast.success(`Assigned to ${suggestion.name}`);\n              } catch {\n                toast.error('Failed to save');\n              }\n            });\n          });\n\n          // Bind Apply mitigation\n          const applyMitigationBtn = suggestionsPanel.querySelector('#risk-apply-mitigation-btn');\n          if (applyMitigationBtn && lastMitigation && onUpdate) {\n            on(applyMitigationBtn as HTMLElement, 'click', async () => {\n              try {\n                const updated = await risksService.update(risk.id, { mitigation: lastMitigation });\n                const mitigationEl = container.querySelector('#risk-detail-mitigation');\n                if (mitigationEl) mitigationEl.innerHTML = escapeHtml(lastMitigation);\n                onUpdate(updated);\n                toast.success('Mitigation updated');\n              } catch {\n                toast.error('Failed to save');\n              }\n            });\n          }\n        }\n\n        const hideBtn = suggestionsPanel.querySelector('#risk-hide-suggestions-btn');\n        if (hideBtn) {\n          on(hideBtn as HTMLElement, 'click', () => {\n            suggestionsPanel.style.display = 'none';\n          });\n        }\n      } catch {\n        suggestionsPanel.innerHTML = `\n          <div class=\"suggestions-error\">\n            <div>Failed to get AI suggestions</div>\n            <button type=\"button\" class=\"btn-retry\" id=\"risk-retry-suggest-btn\">Try again</button>\n          </div>\n        `;\n        const retryBtn = suggestionsPanel.querySelector('#risk-retry-suggest-btn');\n        if (retryBtn) {\n          on(retryBtn as HTMLElement, 'click', () => (aiSuggestBtn as HTMLElement).click());\n        }\n      } finally {\n        btn.disabled = false;\n        btn.innerHTML = `\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n          </svg>\n          AI suggest\n        `;\n      }\n    });\n  }\n\n  const docLink = container.querySelector('.doc-link');\n  if (docLink && risk.source_document_id) {\n    on(docLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\n        detail: { tab: 'files', documentId: risk.source_document_id }\n      }));\n    });\n  }\n\n  const timelineEl = container.querySelector('#timeline-content');\n  if (timelineEl) {\n    risksService.getEvents(risk.id).then((events: RiskEvent[]) => {\n      if (events.length === 0) {\n        (timelineEl as HTMLElement).innerHTML = '<p class=\"empty-state\">No events recorded</p>';\n        return;\n      }\n      const html = events.map((ev) => {\n        const icon = getRiskEventIcon(ev.event_type);\n        const description = getRiskEventDescription(ev);\n        return `\n          <div class=\"timeline-item risk-event-${escapeHtml(ev.event_type)}\">\n            <div class=\"timeline-icon\">${icon}</div>\n            <div class=\"timeline-content\">\n              <div class=\"timeline-title\">${escapeHtml(description)}</div>\n              <div class=\"timeline-date\">${formatDateTime(ev.created_at)}</div>\n            </div>\n          </div>`;\n      }).join('');\n      (timelineEl as HTMLElement).innerHTML = `<div class=\"timeline-list\">${html}</div>`;\n    }).catch(() => {\n      (timelineEl as HTMLElement).innerHTML = '<p class=\"error\">Failed to load timeline</p>';\n    });\n  }\n\n  // Contact picker in view: show on Change/Choose Manually, on select update owner via API\n  let viewContacts: Contact[] = [];\n  const owner = risk.owner || '';\n  const riskContactPicker = container.querySelector('#risk-contact-picker') as HTMLElement;\n  const riskContactList = container.querySelector('#risk-contact-list') as HTMLElement;\n  const riskContactSearch = container.querySelector('#risk-contact-search') as HTMLInputElement;\n\n  const renderRiskContactGrid = (filter = '') => {\n    if (!riskContactList) return;\n    const list = filter\n      ? viewContacts.filter(\n          (c) =>\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n            (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\n            ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\n        )\n      : viewContacts;\n    if (viewContacts.length === 0) {\n      riskContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n      return;\n    }\n    if (list.length === 0) {\n      riskContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n      return;\n    }\n    riskContactList.innerHTML = list\n      .map((c) => {\n        const photoUrl = getContactPhotoUrl(c);\n        const isCurrent = (owner || '').trim() === (c.name || '').trim();\n        return `\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n            <div class=\"contact-info-picker\">\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n            </div>\n          </div>`;\n      })\n      .join('');\n    riskContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\n      on(card as HTMLElement, 'click', async () => {\n        const name = card.getAttribute('data-contact-name') || '';\n        if (!name) return;\n        try {\n          const updated = await risksService.update(risk.id, { owner: name });\n          toast.success(`Owner set to ${name}`);\n          if (riskContactPicker) riskContactPicker.style.display = 'none';\n          onUpdate?.(updated);\n        } catch {\n          toast.error('Failed to save');\n        }\n      });\n    });\n  };\n\n  const showRiskPicker = () => {\n    if (!riskContactPicker) return;\n    riskContactPicker.style.display = riskContactPicker.style.display === 'none' ? 'block' : 'none';\n    if (riskContactPicker.style.display === 'block' && viewContacts.length === 0) {\n      contactsService.getAll().then((res) => {\n        viewContacts = res?.contacts || [];\n        renderRiskContactGrid(riskContactSearch?.value || '');\n      }).catch(() => {\n        if (riskContactList) riskContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n      });\n    } else if (riskContactPicker.style.display === 'block') {\n      renderRiskContactGrid(riskContactSearch?.value || '');\n    }\n    if (riskContactSearch) riskContactSearch.focus();\n  };\n\n  const changeOwnerBtn = container.querySelector('#risk-change-owner-btn');\n  const showPickerBtn = container.querySelector('#risk-show-picker-btn');\n  if (changeOwnerBtn && riskContactPicker) on(changeOwnerBtn as HTMLElement, 'click', showRiskPicker);\n  if (showPickerBtn && riskContactPicker) on(showPickerBtn as HTMLElement, 'click', showRiskPicker);\n  if (riskContactSearch) {\n    riskContactSearch.addEventListener('input', () => renderRiskContactGrid(riskContactSearch.value));\n  }\n\n  function findContactByOwner(name: string): Contact | undefined {\n    if (!name || !viewContacts.length) return undefined;\n    const n = name.trim().toLowerCase();\n    if (!n) return undefined;\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n    if (byExact) return byExact;\n    const byPartial = viewContacts.find(\n      (c) =>\n        (c.name || '').trim().toLowerCase().includes(n) ||\n        n.includes((c.name || '').trim().toLowerCase())\n    );\n    if (byPartial) return byPartial;\n    const byAlias = viewContacts.find((c) =>\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n    );\n    if (byAlias) return byAlias;\n    return viewContacts.find((c) =>\n      (c.aliases || []).some((a) => {\n        const aLower = String(a).trim().toLowerCase();\n        return aLower.includes(n) || n.includes(aLower);\n      })\n    );\n  }\n\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\n    if (!c) return null;\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\n  }\n\n  contactsService.getAll().then((res) => {\n    viewContacts = res?.contacts || [];\n    const contact = findContactByOwner(owner);\n    const roleEl = container.querySelector('#risk-assigned-role');\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\n    const avatarEl = container.querySelector('#risk-assigned-avatar');\n    if (avatarEl && owner) {\n      const photoUrl = getContactPhotoUrl(contact);\n      if (photoUrl) {\n        avatarEl.innerHTML = '';\n        const img = document.createElement('img');\n        img.src = photoUrl;\n        img.alt = '';\n        img.onerror = () => { avatarEl.textContent = getInitials(owner); };\n        avatarEl.appendChild(img);\n      }\n    }\n  }).catch(() => {});\n\n  return container;\n}\n","/**\n * Risks Panel Component\n * Displays and manages risks with view tabs, search, grouping, detail view, and removed section (SOTA parity)\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { risksService, Risk } from '../../services/risks';\nimport { dataStore } from '../../stores/data';\nimport { showRiskModal } from '../modals/RiskModal';\nimport { createRiskDetailView, RiskDetailViewProps } from '../risks/RiskDetailView';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nfunction riskDetailProps(containerEl: HTMLElement, props: RisksPanelProps, risk: Risk): RiskDetailViewProps {\n  return {\n    risk,\n    onClose: () => {\n      containerEl.innerHTML = '';\n      containerEl.appendChild(createRisksPanel(props));\n    },\n    onUpdate: (updatedRisk?: Risk) => {\n      containerEl.innerHTML = '';\n      if (updatedRisk) {\n        containerEl.appendChild(createRiskDetailView(riskDetailProps(containerEl, props, updatedRisk)));\n      } else {\n        containerEl.appendChild(createRisksPanel(props));\n      }\n    },\n  };\n}\n\nexport interface RisksPanelProps {\n  onRiskClick?: (risk: Risk) => void;\n  useDetailView?: boolean;\n  containerElement?: HTMLElement;\n}\n\nlet currentFilter: string = 'all';\nlet currentSearch: string = '';\nlet currentView: 'status' | 'source' = 'status';\nlet showMatrix: boolean = false;\nlet lastLoadedRisks: Risk[] = [];\n\n/**\n * Create risks panel\n */\nexport function createRisksPanel(props: RisksPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'sot-panel risks-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Risks</h2>\n        <span class=\"panel-count\" id=\"risks-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <select id=\"risks-filter\" class=\"filter-select\">\n          <option value=\"all\">All</option>\n          <option value=\"open\">Open</option>\n          <option value=\"mitigating\">Mitigating</option>\n          <option value=\"mitigated\">Mitigated</option>\n          <option value=\"high\">High Impact</option>\n        </select>\n        <div class=\"view-tabs\">\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\n        </div>\n        <input type=\"search\" id=\"risks-search\" class=\"search-input\" placeholder=\"Search risks...\" title=\"Search\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"toggle-matrix-btn\">Show Matrix</button>\n        <button class=\"btn btn-primary btn-sm\" id=\"add-risk-btn\">+ Add</button>\n      </div>\n    </div>\n    <div id=\"risk-matrix-container\" class=\"risk-matrix-container\" style=\"display: none;\"></div>\n    <div class=\"panel-content\" id=\"risks-content\">\n      <div class=\"loading\">Loading risks...</div>\n    </div>\n    <div id=\"removed-risks-container\" class=\"removed-risks-container\" style=\"display: none;\"></div>\n  `;\n\n  const filterSelect = panel.querySelector('#risks-filter') as HTMLSelectElement;\n  on(filterSelect, 'change', () => {\n    currentFilter = filterSelect.value;\n    loadRisks(panel, props);\n  });\n\n  const viewTabs = panel.querySelectorAll('.view-tab');\n  viewTabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      viewTabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentView = tab.getAttribute('data-view') as 'status' | 'source';\n      loadRisks(panel, props);\n    });\n  });\n\n  const searchInput = panel.querySelector('#risks-search') as HTMLInputElement;\n  let searchTimeout: number;\n  on(searchInput, 'input', () => {\n    clearTimeout(searchTimeout);\n    searchTimeout = window.setTimeout(() => {\n      currentSearch = searchInput.value.trim();\n      loadRisks(panel, props);\n    }, 300);\n  });\n\n  const matrixBtn = panel.querySelector('#toggle-matrix-btn') as HTMLButtonElement;\n  on(matrixBtn, 'click', () => {\n    showMatrix = !showMatrix;\n    matrixBtn.textContent = showMatrix ? 'Hide Matrix' : 'Show Matrix';\n    const matrixContainer = panel.querySelector('#risk-matrix-container') as HTMLElement;\n    matrixContainer.style.display = showMatrix ? 'block' : 'none';\n    if (showMatrix) {\n      const risksToShow = lastLoadedRisks.length > 0 ? lastLoadedRisks : (dataStore.getState().risks as unknown as Risk[]) || [];\n      renderRiskMatrix(matrixContainer, Array.isArray(risksToShow) ? risksToShow : []);\n    }\n  });\n\n  const addBtn = panel.querySelector('#add-risk-btn');\n  if (addBtn) {\n    on(addBtn as HTMLElement, 'click', () => {\n      showRiskModal({\n        mode: 'create',\n        onSave: () => {\n          loadRisks(panel, props);\n          refreshRemovedSection(panel, props);\n        },\n      });\n    });\n  }\n\n  loadRisks(panel, props);\n  refreshRemovedSection(panel, props);\n\n  return panel;\n}\n\nasync function refreshRemovedSection(panel: HTMLElement, props: RisksPanelProps): Promise<void> {\n  const container = panel.querySelector('#removed-risks-container') as HTMLElement;\n  if (!container) return;\n  try {\n    const deleted = await risksService.getDeleted();\n    if (deleted.length === 0) {\n      container.style.display = 'none';\n      container.innerHTML = '';\n      return;\n    }\n    container.style.display = 'block';\n    container.innerHTML = `\n      <div class=\"removed-risks-section\">\n        <div class=\"removed-risks-header section-header-sota\">\n          <h3>Removed risks</h3>\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\n        </div>\n        <p class=\"removed-risks-hint\">Restore to bring the risk back; it will be synced to the graph.</p>\n        <div class=\"removed-risks-list\">\n          ${deleted.map((r) => `\n            <div class=\"removed-risk-item\" data-risk-id=\"${r.id}\">\n              <div class=\"removed-risk-content\">${escapeHtml(truncate(r.content ?? '', 100))}</div>\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    `;\n    container.querySelectorAll('.conflict-resolve-restore').forEach((restoreBtn) => {\n      on(restoreBtn as HTMLElement, 'click', async () => {\n        const id = (restoreBtn as HTMLElement).closest('.removed-risk-item')?.getAttribute('data-risk-id');\n        if (!id) return;\n        try {\n          await risksService.restore(id);\n          toast.success('Risk restored');\n          loadRisks(panel, props);\n          refreshRemovedSection(panel, props);\n        } catch {\n          toast.error('Failed to restore risk');\n        }\n      });\n    });\n  } catch {\n    container.style.display = 'none';\n    container.innerHTML = '';\n  }\n}\n\nfunction truncate(s: string, len: number): string {\n  if (s.length <= len) return s;\n  return s.substring(0, len) + '';\n}\n\nfunction filterRisksBySearch(risks: Risk[], q: string): Risk[] {\n  if (!q) return risks;\n  const lower = q.toLowerCase();\n  return risks.filter(\n    r =>\n      (r.content || '').toLowerCase().includes(lower) ||\n      (r.mitigation || '').toLowerCase().includes(lower) ||\n      (r.owner || '').toLowerCase().includes(lower) ||\n      (r.source_file || '').toLowerCase().includes(lower)\n  );\n}\n\nasync function loadRisks(panel: HTMLElement, props: RisksPanelProps): Promise<void> {\n  const content = panel.querySelector('#risks-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const status = currentFilter === 'all' || currentFilter === 'high' ? undefined : currentFilter;\n    let risks = await risksService.getAll(status);\n    if (currentFilter === 'high') {\n      risks = risks.filter(r => r.impact === 'high' || r.impact === 'critical');\n    }\n    risks = filterRisksBySearch(risks, currentSearch);\n\n    if (currentView === 'source') {\n      renderRisksBySource(content, risks, props);\n    } else {\n      renderRisks(content, risks, props);\n    }\n    lastLoadedRisks = risks;\n    dataStore.setRisks(risks as unknown as []);\n    updateCount(panel, risks.length);\n\n    if (showMatrix) {\n      const matrixContainer = panel.querySelector('#risk-matrix-container') as HTMLElement;\n      renderRiskMatrix(matrixContainer, risks);\n    }\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load risks</div>';\n  }\n}\n\nfunction renderRisks(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\n  if (risks.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>${currentSearch ? 'No risks match your search' : 'No risks found'}</p>\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Risk</button>\n      </div>\n    `;\n    const addBtn = container.querySelector('#empty-add-btn');\n    if (addBtn) {\n      on(addBtn as HTMLElement, 'click', () => {\n        showRiskModal({ mode: 'create', onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props) });\n      });\n    }\n    return;\n  }\n\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\n  const byStatus: Record<string, Risk[]> = {};\n  risks.forEach(r => {\n    const s = (r.status || 'open').toLowerCase();\n    if (!byStatus[s]) byStatus[s] = [];\n    byStatus[s].push(r);\n  });\n  const statuses = Object.keys(byStatus);\n\n  if (statuses.length > 1) {\n    container.innerHTML = statuses.map(status => `\n      <div class=\"question-group\">\n        <div class=\"group-header\">\n          <h3>${escapeHtml(status)}</h3>\n          <span class=\"group-count\">${byStatus[status].length}</span>\n        </div>\n        <div class=\"group-items\">\n          ${byStatus[status].map(r => createRiskCard(r, contacts)).join('')}\n        </div>\n      </div>\n    `).join('');\n  } else {\n    container.innerHTML = risks.map(r => createRiskCard(r, contacts)).join('');\n  }\n  bindRiskCards(container, risks, props);\n}\n\nfunction renderRisksBySource(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\n  if (risks.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>${currentSearch ? 'No risks match your search' : 'No risks found'}</p>\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Risk</button>\n      </div>\n    `;\n    const addBtn = container.querySelector('#empty-add-btn');\n    if (addBtn) {\n      on(addBtn as HTMLElement, 'click', () => {\n        showRiskModal({ mode: 'create', onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props) });\n      });\n    }\n    return;\n  }\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\n  const bySource: Record<string, Risk[]> = {};\n  risks.forEach(r => {\n    const src = r.source_file || 'Unknown source';\n    if (!bySource[src]) bySource[src] = [];\n    bySource[src].push(r);\n  });\n  container.innerHTML = Object.entries(bySource).map(([source, list]) => `\n    <div class=\"question-group\">\n      <div class=\"group-header\">\n        <h3>${escapeHtml(source)}</h3>\n        <span class=\"group-count\">${list.length}</span>\n      </div>\n      <div class=\"group-items\">\n        ${list.map(r => createRiskCard(r, contacts)).join('')}\n      </div>\n    </div>\n  `).join('');\n  bindRiskCards(container, risks, props);\n}\n\nconst IMPACT_BAR_COLOR: Record<string, string> = {\n  critical: '#dc2626',\n  high: '#ea580c',\n  medium: '#ca8a04',\n  low: '#16a34a',\n};\n\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\n\nfunction findContactByOwner(contacts: ContactLike[], name: string): ContactLike | undefined {\n  if (!name || !contacts.length) return undefined;\n  const n = name.trim().toLowerCase();\n  if (!n) return undefined;\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n  if (byExact) return byExact;\n  const byPartial = contacts.find(\n    (c) =>\n      (c.name || '').trim().toLowerCase().includes(n) ||\n      n.includes((c.name || '').trim().toLowerCase())\n  );\n  if (byPartial) return byPartial;\n  const byAlias = contacts.find((c) =>\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n  );\n  return byAlias || contacts.find((c) =>\n    (c.aliases || []).some((a) => {\n      const aLower = String(a).trim().toLowerCase();\n      return aLower.includes(n) || n.includes(aLower);\n    })\n  );\n}\n\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\n  if (!c) return null;\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\n}\n\nfunction getInitials(name: string): string {\n  if (!name) return '?';\n  const parts = name.trim().split(/\\s+/);\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\n}\n\nfunction createRiskCard(risk: Risk, contacts: ContactLike[]): string {\n  const impact = (risk.impact || 'medium').toLowerCase();\n  const barColor = IMPACT_BAR_COLOR[impact] ?? IMPACT_BAR_COLOR.medium;\n  const content = risk.content || '';\n  const source = risk.source_file || '';\n  const owner = risk.owner || '';\n  const contact = owner ? findContactByOwner(contacts, owner) : undefined;\n  const photoUrl = getContactPhotoUrl(contact);\n  const ownerChipHtml = owner\n    ? `\n        <div class=\"assignee-chip\">\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(owner)}\" onerror=\"this.parentElement.innerHTML='${getInitials(owner)}'\">` : getInitials(owner)}</div>\n          <div class=\"assignee-info\">\n            <span class=\"assignee-name\">${escapeHtml(owner)}</span>\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\n          </div>\n        </div>\n      `\n    : '<span class=\"card-owner-placeholder text-muted\">No owner</span>';\n  const sourceChip = source ? `<span class=\"card-source-chip\">${escapeHtml(truncate(source, 40))}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>';\n\n  return `\n    <div class=\"risk-card-sota question-card-sota\" data-id=\"${risk.id}\" style=\"--risk-impact-bar: ${barColor}\">\n      <div class=\"card-priority-bar risk-impact-bar\" style=\"background: ${barColor}\"></div>\n      <div class=\"card-body\">\n        <div class=\"card-top-row\">\n          <div class=\"card-badges\">\n            <span class=\"priority-pill impact-${impact}\">${escapeHtml(risk.impact || 'medium')}</span>\n            <span class=\"status-pill\">L: ${escapeHtml(risk.likelihood || 'medium')}</span>\n            <span class=\"status-pill status-${(risk.status || 'open').toLowerCase()}\">${escapeHtml(risk.status || 'open')}</span>\n          </div>\n          <span class=\"card-timestamp\">${formatRelativeTime(risk.created_at)}</span>\n        </div>\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\n        ${risk.mitigation ? `<div class=\"card-mitigation text-muted\">${escapeHtml(truncate(risk.mitigation, 120))}</div>` : ''}\n        <div class=\"card-bottom-row\">\n          <div class=\"card-requester\">\n            ${sourceChip}\n            ${ownerChipHtml}\n          </div>\n          <div class=\"card-assignment\">\n            <button type=\"button\" class=\"btn-link risk-view-link\">View</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction bindRiskCards(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\n  container.querySelectorAll('.risk-card-sota').forEach((card) => {\n    on(card as HTMLElement, 'click', (e) => {\n      if ((e.target as HTMLElement).closest('.card-actions')) return;\n      const id = card.getAttribute('data-id');\n      const risk = risks.find(r => String(r.id) === id);\n      if (!risk) return;\n      if (props.useDetailView && props.containerElement) {\n        const containerEl = props.containerElement;\n        containerEl.innerHTML = '';\n        containerEl.appendChild(createRiskDetailView(riskDetailProps(containerEl, props, risk)));\n      } else if (props.onRiskClick) {\n        props.onRiskClick(risk);\n      } else {\n        showRiskModal({\n          mode: 'edit',\n          risk: { ...risk },\n          onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props),\n        });\n      }\n    });\n  });\n}\n\nfunction renderRiskMatrix(container: HTMLElement, risks: Risk[]): void {\n  const activeRisks = risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed');\n  const getSeverity = (impact?: string, likelihood?: string): string => {\n    const impactLevel = ['low', 'medium', 'high', 'critical'].indexOf((impact || '').toString().toLowerCase() || 'low');\n    const likelihoodLevel = ['low', 'medium', 'high'].indexOf((likelihood || '').toString().toLowerCase() || 'low');\n    const score = impactLevel + likelihoodLevel;\n    if (score >= 4) return 'critical';\n    if (score >= 3) return 'high';\n    if (score >= 2) return 'medium';\n    return 'low';\n  };\n  const counts = { critical: 0, high: 0, medium: 0, low: 0 };\n  activeRisks.forEach(risk => {\n    const severity = getSeverity(risk.impact, risk.likelihood);\n    counts[severity as keyof typeof counts]++;\n  });\n  const total = activeRisks.length;\n  const mitigated = risks.length - activeRisks.length;\n  const getPercent = (count: number) => total > 0 ? Math.round((count / total) * 100) : 0;\n  let conicStops = '';\n  let currentDeg = 0;\n  const colors = { critical: '#ef4444', high: '#f97316', medium: '#eab308', low: '#22c55e' };\n  (['critical', 'high', 'medium', 'low'] as const).forEach(level => {\n    const percent = getPercent(counts[level]);\n    const degrees = (percent / 100) * 360;\n    if (degrees > 0) {\n      conicStops += `${colors[level]} ${currentDeg}deg ${currentDeg + degrees}deg, `;\n      currentDeg += degrees;\n    }\n  });\n  if (!conicStops) conicStops = 'var(--color-border) 0deg 360deg';\n  else conicStops = conicStops.slice(0, -2);\n\n  container.innerHTML = `\n    <div class=\"risk-summary\">\n      <div class=\"risk-summary-header\">\n        <h4>Risk Overview</h4>\n        <span class=\"risk-total\">${total} active</span>\n      </div>\n      <div class=\"risk-summary-content\">\n        <div class=\"risk-donut-container\">\n          <div class=\"risk-donut\" style=\"background: conic-gradient(${conicStops})\">\n            <div class=\"risk-donut-center\">\n              <span class=\"donut-value\">${total}</span>\n              <span class=\"donut-label\">Risks</span>\n            </div>\n          </div>\n        </div>\n        <div class=\"risk-bars\">\n          <div class=\"risk-bar-item critical\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">Critical</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.critical)}%\"></div></div>\n            <span class=\"bar-count\">${counts.critical}</span>\n          </div>\n          <div class=\"risk-bar-item high\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">High</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.high)}%\"></div></div>\n            <span class=\"bar-count\">${counts.high}</span>\n          </div>\n          <div class=\"risk-bar-item medium\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">Medium</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.medium)}%\"></div></div>\n            <span class=\"bar-count\">${counts.medium}</span>\n          </div>\n          <div class=\"risk-bar-item low\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">Low</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"width: ${getPercent(counts.low)}%\"></div></div>\n            <span class=\"bar-count\">${counts.low}</span>\n          </div>\n        </div>\n      </div>\n      ${mitigated > 0 ? `<div class=\"risk-mitigated\"><span class=\"mitigated-icon\"></span><span>${mitigated} risk${mitigated > 1 ? 's' : ''} mitigated</span></div>` : ''}\n    </div>\n  `;\n}\n\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#risks-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createRisksPanel;\n","/**\n * Action Modal Component\n * Create, view and edit actions/tasks\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { Action } from '../../services/actions';\nimport { actionsService } from '../../services/actions';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nconst MODAL_ID = 'action-modal';\n\nexport interface ActionModalProps {\n  mode: 'view' | 'edit' | 'create';\n  action?: Action;\n  onSave?: (action: Action) => void;\n  onDelete?: (actionId: string) => void;\n}\n\nfunction taskText(a: Action | undefined): string {\n  return (a?.content ?? a?.task ?? '') as string;\n}\nfunction dueDateText(a: Action | undefined): string {\n  return (a?.due_date ?? (a as { dueDate?: string })?.dueDate ?? '') as string;\n}\nfunction createdText(a: Action | undefined): string {\n  return (a?.created_at ?? (a as { createdAt?: string })?.createdAt ?? '') as string;\n}\n\n/**\n * Show action modal\n */\nexport function showActionModal(props: ActionModalProps): void {\n  const { mode, action, onSave, onDelete } = props;\n  const isEdit = mode === 'edit' && action?.id;\n  const isView = mode === 'view';\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'action-modal-content' });\n\n  if (isView && action) {\n    const due = dueDateText(action);\n    const isOverdue = due && new Date(due) < new Date() && action.status !== 'completed';\n\n    content.innerHTML = `\n      <div class=\"action-view\">\n        <div class=\"action-meta\">\n          <span class=\"priority-badge priority-${action.priority || 'medium'}\">${action.priority || 'medium'}</span>\n          <span class=\"status-badge ${action.status}\">${action.status.replace('_', ' ')}</span>\n          ${isOverdue ? '<span class=\"status-badge overdue\">Overdue</span>' : ''}\n        </div>\n        \n        <div class=\"action-task-large ${action.status === 'completed' ? 'completed' : ''}\">\n          ${escapeHtml(taskText(action))}\n        </div>\n        \n        <div class=\"action-details\">\n          ${action.assignee ? `<div class=\"detail-item\"><strong>Assignee:</strong> ${escapeHtml(action.assignee)}</div>` : ''}\n          ${due ? `<div class=\"detail-item\"><strong>Due Date:</strong> ${due}</div>` : ''}\n          <div class=\"detail-item\"><strong>Created:</strong> ${formatRelativeTime(createdText(action))}</div>\n        </div>\n      </div>\n    `;\n  } else {\n    content.innerHTML = `\n      <form id=\"action-form\" class=\"action-form\">\n        <div class=\"form-group\">\n          <label for=\"action-task\">Task *</label>\n          <textarea id=\"action-task\" rows=\"2\" required \n                    placeholder=\"What needs to be done?\">${escapeHtml(taskText(action))}</textarea>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"action-priority\">Priority</label>\n            <select id=\"action-priority\">\n              <option value=\"low\" ${action?.priority === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${action?.priority === 'medium' || !action ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${action?.priority === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n          \n          <div class=\"form-group\">\n            <label for=\"action-status\">Status</label>\n            <select id=\"action-status\">\n              <option value=\"pending\" ${action?.status === 'pending' || !action ? 'selected' : ''}>Pending</option>\n              <option value=\"in_progress\" ${action?.status === 'in_progress' ? 'selected' : ''}>In Progress</option>\n              <option value=\"completed\" ${action?.status === 'completed' ? 'selected' : ''}>Completed</option>\n              <option value=\"cancelled\" ${action?.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>\n            </select>\n          </div>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"action-assignee\">Assignee</label>\n            <input type=\"text\" id=\"action-assignee\" \n                   value=\"${escapeHtml(action?.assignee ?? action?.owner ?? '')}\" \n                   placeholder=\"Who is responsible?\">\n          </div>\n          \n          <div class=\"form-group\">\n            <label for=\"action-due\">Due Date</label>\n            <input type=\"date\" id=\"action-due\" \n                   value=\"${dueDateText(action)}\">\n          </div>\n        </div>\n      </form>\n    `;\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  if (isView && action) {\n    const editBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Edit',\n    });\n\n    const closeBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Close',\n    });\n\n    // Quick complete button if not completed\n    if (action.status !== 'completed') {\n      const completeBtn = createElement('button', {\n        className: 'btn btn-success',\n        textContent: 'Mark Complete',\n      });\n\n      on(completeBtn, 'click', async () => {\n        try {\n          const updated = await actionsService.update(action.id, { status: 'completed' });\n          toast.success('Action completed');\n          onSave?.(updated);\n          closeModal(MODAL_ID);\n        } catch {\n          // Error shown by API service\n        }\n      });\n\n      footer.appendChild(completeBtn);\n    }\n\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    on(editBtn, 'click', () => {\n      closeModal(MODAL_ID);\n      showActionModal({ ...props, mode: 'edit' });\n    });\n\n    footer.appendChild(closeBtn);\n    footer.appendChild(editBtn);\n  } else {\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const saveBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: isEdit ? 'Save Changes' : 'Create Action',\n    });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n    on(saveBtn, 'click', async () => {\n      const form = content.querySelector('#action-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\n\n      const contentVal = getValue('action-task');\n      const payload = {\n        content: contentVal,\n        status: getValue('action-status') as Action['status'],\n        priority: getValue('action-priority') as Action['priority'],\n        assignee: getValue('action-assignee') || undefined,\n        due_date: getValue('action-due') || undefined,\n      };\n\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Saving...';\n\n      try {\n        if (isEdit) {\n          const updated = await actionsService.update(action!.id, payload);\n          toast.success('Action updated');\n          onSave?.(updated);\n        } else {\n          const created = await actionsService.create(payload);\n          toast.success('Action created');\n          onSave?.(created);\n        }\n\n        closeModal(MODAL_ID);\n      } catch {\n        // Error shown by API service\n      } finally {\n        saveBtn.disabled = false;\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Action';\n      }\n    });\n\n    if (isEdit) {\n      const deleteBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Delete',\n      });\n\n      on(deleteBtn, 'click', async () => {\n        const { confirm } = await import('../Modal');\n        const confirmed = await confirm(\n          'Are you sure you want to delete this action?',\n          {\n            title: 'Delete Action',\n            confirmText: 'Delete',\n            confirmClass: 'btn-danger',\n          }\n        );\n\n        if (confirmed) {\n          try {\n            await actionsService.delete(action!.id);\n            toast.success('Action deleted');\n            onDelete?.(String(action!.id));\n            closeModal(MODAL_ID);\n          } catch {\n            // Error shown by API service\n          }\n        }\n      });\n\n      footer.appendChild(deleteBtn);\n    }\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(saveBtn);\n  }\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: isView ? 'Action Details' : (isEdit ? 'Edit Action' : 'New Action'),\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showActionModal;\n","/**\n * Action Detail View\n * Full-page view for action details: task, status, priority, assignee, due date, source, timeline\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { Action, ActionEvent, ActionAssigneeSuggestion, actionsService } from '../../services/actions';\nimport { contactsService, Contact } from '../../services/contacts';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\n\nfunction getInitials(name: string): string {\n  return name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\n}\n\nexport interface ActionDetailViewProps {\n  action: Action;\n  onClose: () => void;\n  onUpdate?: (action: Action) => void;\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nfunction formatDate(iso: string | undefined): string {\n  if (!iso) return '';\n  try {\n    return formatDateTime(iso);\n  } catch {\n    return iso;\n  }\n}\n\nfunction taskText(a: Action): string {\n  return (a.content ?? a.task ?? '') as string;\n}\n\nfunction getActionEventIcon(eventType: string): string {\n  const icons: Record<string, string> = {\n    created: '',\n    updated: '',\n    deleted: '',\n    restored: '',\n  };\n  return icons[eventType] || '';\n}\n\nfunction getActionEventDescription(ev: ActionEvent): string {\n  const data = ev.event_data || {};\n  const actor = ev.actor_name ? ` by ${ev.actor_name}` : '';\n\n  switch (ev.event_type) {\n    case 'created':\n      return `Created${actor}`;\n    case 'updated': {\n      const changes = (data.changes as Array<{ field: string; from: string; to: string }>) || [];\n      if (changes.length === 0) return `Updated${actor}`;\n      if (changes.length === 1) {\n        const c = changes[0];\n        const toStr = String(c.to).trim() ? c.to : '';\n        const fromStr = String(c.from).trim() ? c.from : '';\n        return `${c.field} changed: ${fromStr}  ${toStr}${actor}`;\n      }\n      return `${changes.map((c) => `${c.field}: ${c.from || ''}  ${c.to || ''}`).join('; ')}${actor}`;\n    }\n    case 'deleted':\n      return `Deleted${data.reason ? ` (${data.reason})` : ''}${actor}`;\n    case 'restored':\n      return `Restored${actor}`;\n    default:\n      return ev.event_type;\n  }\n}\n\nexport function createActionDetailView(props: ActionDetailViewProps): HTMLElement {\n  const { action, onClose, onUpdate } = props;\n\n  const container = createElement('div', { className: 'action-detail-view question-detail-view' });\n\n  const task = taskText(action);\n  const due = action.due_date ?? (action as { deadline?: string }).deadline ?? '';\n  const assignee = action.assignee ?? action.owner ?? '';\n\n  container.innerHTML = `\n    <div class=\"question-detail-header action-detail-header\">\n      <div class=\"breadcrumb\">\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Actions</a>\n        <span class=\"breadcrumb-separator\"></span>\n        <span class=\"breadcrumb-current\">Action #${String(action.id).substring(0, 8)}</span>\n      </div>\n      <div class=\"header-actions\">\n        <span class=\"status-badge status-${(action.status || 'pending').toLowerCase()}\">${escapeHtml(String(action.status).replace('_', ' '))}</span>\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\n      </div>\n    </div>\n\n    <div class=\"question-detail-content action-detail-content\">\n      <div id=\"action-view-content\">\n        <section class=\"detail-section action-main\">\n          <div class=\"question-badges action-badges\">\n            ${action.priority ? `<span class=\"priority-pill priority-${action.priority}\">${escapeHtml(action.priority)}</span>` : ''}\n            <span class=\"question-date action-date\">Created ${formatRelativeTime(action.created_at)}</span>\n          </div>\n          <h2 class=\"question-text action-task-text\">${escapeHtml(task)}</h2>\n        </section>\n\n        <div class=\"detail-columns\">\n          <div class=\"detail-column-left\">\n            <!-- Assignment Section - SOTA (aligned with Questions) -->\n            <section class=\"detail-section\" id=\"action-assignment-section\">\n              <div class=\"section-header-sota\">\n                <h3>\n                  <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                  </svg>\n                  Assignment\n                  <span class=\"section-subtitle\">Who should do this?</span>\n                </h3>\n                <button type=\"button\" class=\"btn-ai-suggest\" id=\"action-ai-suggest-btn\" title=\"Suggest assignee from task content\">\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                  AI Suggest\n                </button>\n              </div>\n\n              <!-- Current Assignment Display -->\n              <div id=\"action-current-assignment\" class=\"current-assignment-card\">\n                ${assignee ? `\n                  <div class=\"assigned-contact-display\">\n                    <div class=\"contact-avatar-lg\" id=\"action-assigned-avatar\">${getInitials(assignee)}</div>\n                    <div class=\"contact-details\">\n                      <div class=\"contact-name-lg\">${escapeHtml(assignee)}</div>\n                      <div class=\"contact-role-sm\" id=\"action-assigned-role\"></div>\n                    </div>\n                    <button class=\"btn-change-assignment\" id=\"action-change-assignee-btn\" type=\"button\">\n                      <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                      Change\n                    </button>\n                  </div>\n                ` : `\n                  <div class=\"no-assignment\">\n                    <div class=\"no-assignment-icon\">\n                      <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\n                    </div>\n                    <span>No one assigned</span>\n                    <p class=\"no-assignment-hint\">Use AI Suggest or choose manually</p>\n                    <button class=\"btn-assign-now\" id=\"action-show-picker-btn\" type=\"button\">Choose Manually</button>\n                  </div>\n                `}\n              </div>\n\n              <!-- Contact Picker (hidden by default) -->\n              <div id=\"action-contact-picker\" class=\"contact-picker-sota\" style=\"display: none;\">\n                <div class=\"picker-search\">\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                  <input type=\"text\" id=\"action-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n                </div>\n                <div id=\"action-contact-list\" class=\"contact-list-grid\">Loading...</div>\n              </div>\n\n              <!-- AI Suggestions Panel -->\n              <div id=\"action-suggestions-panel\" class=\"suggestions-panel-sota action-suggestions-panel\" style=\"display: none; margin-bottom: 12px;\"></div>\n\n              <!-- Due date & Status (details) -->\n              <dl class=\"metadata-list action-meta-inline\">\n                <dt>Due date</dt>\n                <dd>${due ? formatDate(due) : ''}</dd>\n                <dt>Status</dt>\n                <dd>${escapeHtml(String(action.status).replace('_', ' '))}</dd>\n              </dl>\n            </section>\n\n            <section class=\"detail-section\">\n              <div class=\"section-header\"><h3>Source</h3></div>\n              ${action.source_file ? `<p class=\"source-file\">${escapeHtml(action.source_file)}</p>` : ''}\n              ${action.source_document_id ? `\n                <p class=\"source-doc\">\n                  <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(action.source_document_id))}\">View source document</a>\n                </p>\n              ` : ''}\n              ${!action.source_file && !action.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\n            </section>\n          </div>\n\n          <div class=\"detail-column-right\">\n            <section class=\"detail-section metadata-section\">\n              <h3>Metadata</h3>\n              <dl class=\"metadata-list\">\n                <dt>Created</dt>\n                <dd>${formatDate(action.created_at)}</dd>\n                ${action.updated_at ? `<dt>Updated</dt><dd>${formatDate(action.updated_at)}</dd>` : ''}\n              </dl>\n            </section>\n\n            <section class=\"detail-section\" id=\"action-timeline-section\">\n              <h3>Timeline</h3>\n              <div id=\"timeline-content\" class=\"timeline-content\">\n                <span class=\"text-muted\">Loading</span>\n              </div>\n            </section>\n          </div>\n        </div>\n\n        <div class=\"detail-actions\">\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-action-btn\">Edit</button>\n          <button type=\"button\" class=\"btn btn-danger\" id=\"delete-action-btn\">Delete</button>\n        </div>\n      </div>\n\n      <div id=\"action-edit-form\" class=\"action-detail-edit-form\" style=\"display: none;\">\n        <form id=\"action-inline-form\" class=\"action-form\">\n          <div class=\"form-group\">\n            <div style=\"display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px; margin-bottom: 6px;\">\n              <label for=\"action-edit-task\" style=\"margin-bottom: 0;\">Task *</label>\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"action-edit-ai-suggest-btn\" title=\"Suggest assignee from task content\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI suggest\n              </button>\n            </div>\n            <textarea id=\"action-edit-task\" rows=\"3\" required placeholder=\"What needs to be done?\">${escapeHtml(task)}</textarea>\n          </div>\n          <div id=\"action-edit-suggestions-panel\" class=\"suggestions-panel-sota action-suggestions-panel\" style=\"display: none; margin-bottom: 16px;\"></div>\n          <div class=\"form-row\">\n            <div class=\"form-group\">\n              <label for=\"action-edit-status\">Status</label>\n              <select id=\"action-edit-status\">\n                <option value=\"pending\" ${action.status === 'pending' ? 'selected' : ''}>Pending</option>\n                <option value=\"in_progress\" ${action.status === 'in_progress' ? 'selected' : ''}>In Progress</option>\n                <option value=\"completed\" ${action.status === 'completed' ? 'selected' : ''}>Completed</option>\n                <option value=\"cancelled\" ${action.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>\n              </select>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"action-edit-priority\">Priority</label>\n              <select id=\"action-edit-priority\">\n                <option value=\"low\" ${action.priority === 'low' ? 'selected' : ''}>Low</option>\n                <option value=\"medium\" ${action.priority === 'medium' || !action.priority ? 'selected' : ''}>Medium</option>\n                <option value=\"high\" ${action.priority === 'high' ? 'selected' : ''}>High</option>\n              </select>\n            </div>\n          </div>\n          <div class=\"form-row\">\n            <div class=\"form-group action-assignee-picker-wrap\">\n              <label>Assignee</label>\n              <input type=\"hidden\" id=\"action-edit-assignee\" value=\"${escapeHtml(assignee)}\">\n              <div class=\"action-assignee-picker-trigger\" id=\"action-assignee-picker-trigger\" title=\"Click to select from project contacts\">\n                <span class=\"action-assignee-picker-value\" id=\"action-assignee-picker-value\">${assignee ? escapeHtml(assignee) : '<span class=\"text-muted\">Select assignee...</span>'}</span>\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\n              </div>\n              <div id=\"action-assignee-picker-dropdown\" class=\"action-assignee-picker-dropdown\" style=\"display: none;\">\n                <div class=\"action-assignee-picker-search\">\n                  <input type=\"text\" id=\"action-assignee-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n                </div>\n                <div id=\"action-assignee-picker-list\" class=\"action-assignee-picker-list\">Loading...</div>\n              </div>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"action-edit-due\">Due date</label>\n              <input type=\"date\" id=\"action-edit-due\" value=\"${due ? due.split('T')[0] : ''}\">\n            </div>\n          </div>\n        </form>\n        <div class=\"detail-actions\">\n          <button type=\"button\" class=\"btn btn-primary\" id=\"action-save-btn\">Save</button>\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"action-cancel-edit-btn\">Cancel</button>\n          <button type=\"button\" class=\"btn btn-danger\" id=\"action-delete-in-edit-btn\">Delete</button>\n        </div>\n      </div>\n    </div>\n  `;\n\n  const backLink = container.querySelector('#back-to-list');\n  if (backLink) {\n    on(backLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      onClose();\n    });\n  }\n  const closeBtn = container.querySelector('#close-detail');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', onClose);\n  }\n\n  const viewContent = container.querySelector('#action-view-content') as HTMLElement;\n  const editForm = container.querySelector('#action-edit-form') as HTMLElement;\n\n  const editBtn = container.querySelector('#edit-action-btn');\n  if (editBtn) {\n    on(editBtn as HTMLElement, 'click', () => {\n      viewContent.style.display = 'none';\n      editForm.style.display = 'block';\n    });\n  }\n\n  const cancelEditBtn = container.querySelector('#action-cancel-edit-btn');\n  if (cancelEditBtn) {\n    on(cancelEditBtn as HTMLElement, 'click', () => {\n      editForm.style.display = 'none';\n      viewContent.style.display = 'block';\n    });\n  }\n\n  const assigneePickerTrigger = container.querySelector('#action-assignee-picker-trigger');\n  const assigneePickerDropdown = container.querySelector('#action-assignee-picker-dropdown') as HTMLElement;\n  const assigneePickerValue = container.querySelector('#action-assignee-picker-value');\n  const assigneeHiddenInput = container.querySelector('#action-edit-assignee') as HTMLInputElement;\n  const assigneePickerList = container.querySelector('#action-assignee-picker-list') as HTMLElement;\n  const assigneePickerSearch = container.querySelector('#action-assignee-picker-search') as HTMLInputElement;\n  if (assigneePickerTrigger && assigneePickerDropdown && assigneePickerList && assigneeHiddenInput) {\n    let editFormContacts: Contact[] = [];\n    const renderAssigneePickerList = (filter = '') => {\n      const filtered = filter\n        ? editFormContacts.filter(\n            (c) =>\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\n          )\n        : editFormContacts;\n      if (editFormContacts.length === 0) {\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n        return;\n      }\n      if (filtered.length === 0) {\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n        return;\n      }\n      assigneePickerList.innerHTML = filtered\n        .map((c) => {\n          const photoUrl = (c as { photoUrl?: string }).photoUrl || (c as { avatarUrl?: string }).avatarUrl;\n          const selected = (assigneeHiddenInput?.value || '').trim() === (c.name || '').trim();\n          return `\n            <div class=\"action-assignee-card-picker ${selected ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n              <div class=\"action-assignee-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n              <div class=\"action-assignee-card-info\">\n                <div class=\"action-assignee-card-name\">${escapeHtml(c.name || '')}</div>\n                ${c.role ? `<div class=\"action-assignee-card-role\">${escapeHtml(c.role)}</div>` : ''}\n              </div>\n            </div>\n          `;\n        })\n        .join('');\n      assigneePickerList.querySelectorAll('.action-assignee-card-picker').forEach((card) => {\n        on(card as HTMLElement, 'click', () => {\n          const name = card.getAttribute('data-contact-name') || '';\n          assigneeHiddenInput.value = name;\n          if (assigneePickerValue) assigneePickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select assignee...</span>';\n          assigneePickerDropdown.style.display = 'none';\n        });\n      });\n    };\n    on(assigneePickerTrigger as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const isOpen = assigneePickerDropdown.style.display === 'block';\n      assigneePickerDropdown.style.display = isOpen ? 'none' : 'block';\n      if (!isOpen && editFormContacts.length === 0) {\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\n        try {\n          const res = await contactsService.getAll();\n          editFormContacts = res?.contacts || [];\n          renderAssigneePickerList(assigneePickerSearch?.value || '');\n        } catch {\n          assigneePickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n        }\n      } else if (!isOpen) renderAssigneePickerList(assigneePickerSearch?.value || '');\n    });\n    if (assigneePickerSearch) {\n      assigneePickerSearch.addEventListener('input', () => renderAssigneePickerList(assigneePickerSearch.value));\n    }\n    document.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n      if (!target.closest('.action-assignee-picker-wrap') && assigneePickerDropdown?.style.display === 'block') {\n        assigneePickerDropdown.style.display = 'none';\n      }\n    });\n  }\n\n  // AI suggest in edit form (suggest assignee from task; fill picker only, user clicks Save)\n  const editAiSuggestBtn = container.querySelector('#action-edit-ai-suggest-btn');\n  const editSuggestionsPanel = container.querySelector('#action-edit-suggestions-panel') as HTMLElement;\n  const editAssigneeHiddenInput = container.querySelector('#action-edit-assignee') as HTMLInputElement;\n  const editAssigneePickerValue = container.querySelector('#action-assignee-picker-value');\n  if (editAiSuggestBtn && editSuggestionsPanel) {\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\n      const taskEl = container.querySelector('#action-edit-task') as HTMLTextAreaElement;\n      const content = taskEl?.value?.trim() || '';\n      if (!content) {\n        toast.warning('Enter task content first');\n        return;\n      }\n      const btn = editAiSuggestBtn as HTMLButtonElement;\n      btn.disabled = true;\n      btn.innerHTML = '<span class=\"spin\"></span> Analyzing...';\n      editSuggestionsPanel.style.display = 'block';\n      editSuggestionsPanel.innerHTML = '<div class=\"suggestions-loading\"><div class=\"loading-text\">AI is suggesting assignees...</div></div>';\n      try {\n        if (viewContacts.length === 0) {\n          const res = await contactsService.getAll();\n          viewContacts = res?.contacts || [];\n        }\n        const { suggested_assignees } = await actionsService.suggest({ content });\n        if (!suggested_assignees?.length) {\n          editSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\"><div class=\"no-suggestions-text\">No suggestions</div><button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close</button></div>';\n        } else {\n          editSuggestionsPanel.innerHTML = `\n            <div class=\"suggestions-header-sota\"><div class=\"ai-badge\"> AI Recommended</div></div>\n            <div class=\"suggestions-list-sota\">\n              ${suggested_assignees.map((s: ActionAssigneeSuggestion) => {\n                const contact = findContactByAssignee(s.name);\n                const photoUrl = getContactPhotoUrl(contact);\n                const roleOrReason = contact?.role ?? s.reason ?? '';\n                return `\n                <div class=\"action-suggestion-card suggestion-card-sota\">\n                  <div class=\"suggestion-card-left\">\n                    <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\n                    <div class=\"suggestion-score-ring\" style=\"--score-color: ${(s.score ?? 0) >= 70 ? 'var(--success)' : (s.score ?? 0) >= 50 ? 'var(--warning)' : 'var(--text-muted)'}\">${s.score ?? 0}</div>\n                    <div>\n                      <div class=\"suggestion-name\">${escapeHtml(s.name)}</div>\n                      ${roleOrReason ? `<div class=\"suggestion-reason\">${escapeHtml(roleOrReason)}</div>` : ''}\n                    </div>\n                  </div>\n                  <button type=\"button\" class=\"btn-select-suggestion\" data-assignee-name=\"${escapeHtml(s.name)}\">Assign</button>\n                </div>\n              `;\n              }).join('')}\n            </div>\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close suggestions</button></div>\n          `;\n          editSuggestionsPanel.querySelectorAll('.btn-select-suggestion').forEach((assignBtn) => {\n            const name = (assignBtn as HTMLElement).getAttribute('data-assignee-name') || '';\n            if (!name) return;\n            on(assignBtn as HTMLElement, 'click', () => {\n              if (editAssigneeHiddenInput) editAssigneeHiddenInput.value = name;\n              if (editAssigneePickerValue) editAssigneePickerValue.innerHTML = escapeHtml(name);\n              editSuggestionsPanel.style.display = 'none';\n              toast.success(`Assignee set to ${name}`);\n            });\n          });\n        }\n        const hideBtn = editSuggestionsPanel.querySelector('#action-edit-hide-suggest-btn');\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { editSuggestionsPanel.style.display = 'none'; });\n      } catch {\n        editSuggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close</button></div>';\n        const h = editSuggestionsPanel.querySelector('#action-edit-hide-suggest-btn');\n        if (h) on(h as HTMLElement, 'click', () => { editSuggestionsPanel.style.display = 'none'; });\n      } finally {\n        btn.disabled = false;\n        btn.innerHTML = '<svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> AI suggest';\n      }\n    });\n  }\n\n  const saveBtn = container.querySelector('#action-save-btn');\n  if (saveBtn) {\n    on(saveBtn as HTMLElement, 'click', async () => {\n      const taskEl = container.querySelector('#action-edit-task') as HTMLTextAreaElement;\n      const statusEl = container.querySelector('#action-edit-status') as HTMLSelectElement;\n      const priorityEl = container.querySelector('#action-edit-priority') as HTMLSelectElement;\n      const assigneeEl = container.querySelector('#action-edit-assignee') as HTMLInputElement;\n      const dueEl = container.querySelector('#action-edit-due') as HTMLInputElement;\n      if (!taskEl?.value.trim()) {\n        toast.warning('Task is required');\n        return;\n      }\n      try {\n        const updated = await actionsService.update(action.id, {\n          content: taskEl.value.trim(),\n          status: statusEl?.value as Action['status'],\n          priority: priorityEl?.value as Action['priority'],\n          assignee: assigneeEl?.value.trim() || undefined,\n          due_date: dueEl?.value || undefined,\n        });\n        toast.success('Action updated');\n        onUpdate?.(updated);\n      } catch {\n        toast.error('Failed to update action');\n      }\n    });\n  }\n\n  const deleteBtn = container.querySelector('#delete-action-btn');\n  const deleteInEditBtn = container.querySelector('#action-delete-in-edit-btn');\n  const doDelete = async () => {\n    const { confirm } = await import('../Modal');\n    const confirmed = await confirm('Are you sure you want to delete this action?', {\n      title: 'Delete Action',\n      confirmText: 'Delete',\n      confirmClass: 'btn-danger',\n    });\n    if (confirmed) {\n      try {\n        await actionsService.delete(action.id);\n        toast.success('Action deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete action');\n      }\n    }\n  };\n  if (deleteBtn) on(deleteBtn as HTMLElement, 'click', doDelete);\n  if (deleteInEditBtn) on(deleteInEditBtn as HTMLElement, 'click', doDelete);\n\n  const docLink = container.querySelector('.doc-link[data-document-id]');\n  if (docLink) {\n    on(docLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      const docId = (docLink as HTMLElement).getAttribute('data-document-id');\n      if (docId) {\n        window.dispatchEvent(new CustomEvent('godmode:navigate', {\n          detail: { tab: 'files', documentId: docId }\n        }));\n      }\n    });\n  }\n\n  const aiSuggestBtn = container.querySelector('#action-ai-suggest-btn');\n  const suggestionsPanel = container.querySelector('#action-suggestions-panel') as HTMLElement;\n  if (aiSuggestBtn && suggestionsPanel) {\n    on(aiSuggestBtn as HTMLElement, 'click', async () => {\n      (aiSuggestBtn as HTMLButtonElement).disabled = true;\n      suggestionsPanel.style.display = 'block';\n      suggestionsPanel.innerHTML = '<div class=\"suggestions-loading\">Loading suggestions...</div>';\n      try {\n        const task = taskText(action);\n        if (viewContacts.length === 0) {\n          const res = await contactsService.getAll();\n          viewContacts = res?.contacts || [];\n        }\n        const { suggested_assignees } = await actionsService.suggest({ content: task });\n        if (!suggested_assignees?.length) {\n          suggestionsPanel.innerHTML = '<div class=\"no-suggestions\">No suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close suggestions</button></div>';\n        } else {\n          suggestionsPanel.innerHTML = `\n            <div class=\"suggestions-header-sota\">\n              <div class=\"ai-badge\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Recommended\n              </div>\n            </div>\n            <div class=\"suggestions-list-sota\">\n              ${suggested_assignees.map((s: ActionAssigneeSuggestion, i: number) => {\n                const contact = findContactByAssignee(s.name);\n                const photoUrl = getContactPhotoUrl(contact);\n                const roleOrReason = contact?.role ?? s.reason ?? '';\n                return `\n                <div class=\"suggestion-card-sota\" data-index=\"${i}\">\n                  <div class=\"suggestion-rank\">#${i + 1}</div>\n                  <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\n                  <div class=\"suggestion-info-sota\">\n                    <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\n                    ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\n                  </div>\n                  <div class=\"suggestion-score-sota\" style=\"--score-color: ${(s.score ?? 0) >= 70 ? 'var(--success)' : (s.score ?? 0) >= 50 ? 'var(--warning)' : 'var(--text-muted)'}\">\n                    <div class=\"score-ring\">\n                      <svg viewBox=\"0 0 36 36\">\n                        <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                        <path class=\"score-fill\" stroke-dasharray=\"${s.score ?? 0}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\n                      </svg>\n                      <div class=\"score-value\">${s.score ?? 0}%</div>\n                    </div>\n                    <div class=\"score-label\">Match</div>\n                  </div>\n                  <button type=\"button\" class=\"btn-select-suggestion\" data-assignee-name=\"${escapeHtml(s.name)}\">\n                    <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>\n                    Assign\n                  </button>\n                </div>\n              `;\n              }).join('')}\n            </div>\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close suggestions</button></div>\n          `;\n          suggestionsPanel.querySelectorAll('.btn-select-suggestion').forEach((btn) => {\n            on(btn as HTMLElement, 'click', async () => {\n              const name = (btn as HTMLElement).getAttribute('data-assignee-name') || '';\n              if (!name) return;\n              try {\n                const updated = await actionsService.update(action.id, { assignee: name });\n                toast.success(`Assigned to ${name}`);\n                onUpdate?.(updated);\n                suggestionsPanel.style.display = 'none';\n              } catch {\n                toast.error('Failed to assign');\n              }\n            });\n          });\n        }\n        const hideBtn = suggestionsPanel.querySelector('#action-hide-suggest-btn');\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { suggestionsPanel.style.display = 'none'; });\n      } catch {\n        suggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close</button></div>';\n        const h = suggestionsPanel.querySelector('#action-hide-suggest-btn');\n        if (h) on(h as HTMLElement, 'click', () => { suggestionsPanel.style.display = 'none'; });\n      } finally {\n        (aiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  const timelineEl = container.querySelector('#timeline-content');\n  if (timelineEl) {\n    actionsService.getEvents(action.id).then((events: ActionEvent[]) => {\n      if (events.length === 0) {\n        (timelineEl as HTMLElement).innerHTML = '<p class=\"empty-state\">No events recorded</p>';\n        return;\n      }\n      const html = events.map((ev) => {\n        const icon = getActionEventIcon(ev.event_type);\n        const description = getActionEventDescription(ev);\n        return `\n          <div class=\"timeline-item action-event-${escapeHtml(ev.event_type)}\">\n            <div class=\"timeline-icon\">${icon}</div>\n            <div class=\"timeline-content\">\n              <div class=\"timeline-title\">${escapeHtml(description)}</div>\n              <div class=\"timeline-date\">${formatDateTime(ev.created_at)}</div>\n            </div>\n          </div>`;\n      }).join('');\n      (timelineEl as HTMLElement).innerHTML = `<div class=\"timeline-list\">${html}</div>`;\n    }).catch(() => {\n      (timelineEl as HTMLElement).innerHTML = '<p class=\"error\">Failed to load timeline</p>';\n    });\n  }\n\n  // Contact picker in view: load contacts, show picker on Change/Choose Manually, on select update assignee via API\n  let viewContacts: Contact[] = [];\n  const actionContactPicker = container.querySelector('#action-contact-picker') as HTMLElement;\n  const actionContactList = container.querySelector('#action-contact-list') as HTMLElement;\n  const actionContactSearch = container.querySelector('#action-contact-search') as HTMLInputElement;\n\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\n    if (!c) return null;\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\n  }\n\n  const renderActionContactGrid = (filter = '') => {\n    if (!actionContactList) return;\n    const list = filter\n      ? viewContacts.filter(\n          (c) =>\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n            (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\n            ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\n        )\n      : viewContacts;\n    if (viewContacts.length === 0) {\n      actionContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n      return;\n    }\n    if (list.length === 0) {\n      actionContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n      return;\n    }\n    actionContactList.innerHTML = list\n      .map((c) => {\n        const photoUrl = getContactPhotoUrl(c);\n        const isCurrent = (assignee || '').trim() === (c.name || '').trim();\n        return `\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n            <div class=\"contact-info-picker\">\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n            </div>\n          </div>`;\n      })\n      .join('');\n    actionContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\n      on(card as HTMLElement, 'click', async () => {\n        const name = card.getAttribute('data-contact-name') || '';\n        if (!name) return;\n        try {\n          const updated = await actionsService.update(action.id, { assignee: name });\n          toast.success(`Assigned to ${name}`);\n          if (actionContactPicker) actionContactPicker.style.display = 'none';\n          onUpdate?.(updated);\n        } catch {\n          toast.error('Failed to save assignment');\n        }\n      });\n    });\n  };\n\n  const showActionPicker = () => {\n    if (!actionContactPicker) return;\n    actionContactPicker.style.display = actionContactPicker.style.display === 'none' ? 'block' : 'none';\n    if (actionContactPicker.style.display === 'block' && viewContacts.length === 0) {\n      contactsService.getAll().then((res) => {\n        viewContacts = res?.contacts || [];\n        renderActionContactGrid(actionContactSearch?.value || '');\n      }).catch(() => {\n        if (actionContactList) actionContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n      });\n    } else if (actionContactPicker.style.display === 'block') {\n      renderActionContactGrid(actionContactSearch?.value || '');\n    }\n    if (actionContactSearch) actionContactSearch.focus();\n  };\n\n  const changeBtn = container.querySelector('#action-change-assignee-btn');\n  const showPickerBtn = container.querySelector('#action-show-picker-btn');\n  if (changeBtn && actionContactPicker) on(changeBtn as HTMLElement, 'click', showActionPicker);\n  if (showPickerBtn && actionContactPicker) on(showPickerBtn as HTMLElement, 'click', showActionPicker);\n  if (actionContactSearch) {\n    actionContactSearch.addEventListener('input', () => renderActionContactGrid(actionContactSearch.value));\n  }\n\n  // Find contact by assignee name: exact name, partial name, or any alias (case-insensitive)\n  function findContactByAssignee(name: string): Contact | undefined {\n    if (!name || !viewContacts.length) return undefined;\n    const n = name.trim().toLowerCase();\n    if (!n) return undefined;\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n    if (byExact) return byExact;\n    const byPartial = viewContacts.find(\n      (c) =>\n        (c.name || '').trim().toLowerCase().includes(n) ||\n        n.includes((c.name || '').trim().toLowerCase())\n    );\n    if (byPartial) return byPartial;\n    const byAlias = viewContacts.find((c) =>\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n    );\n    if (byAlias) return byAlias;\n    return viewContacts.find((c) =>\n      (c.aliases || []).some((a) => {\n        const aLower = String(a).trim().toLowerCase();\n        return aLower.includes(n) || n.includes(aLower);\n      })\n    );\n  }\n\n  // Load contacts to show assigned role and avatar in current-assignment card\n  contactsService.getAll().then((res) => {\n    viewContacts = res?.contacts || [];\n    const contact = findContactByAssignee(assignee);\n    const roleEl = container.querySelector('#action-assigned-role');\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\n    const avatarEl = container.querySelector('#action-assigned-avatar');\n    if (avatarEl && assignee) {\n      const photoUrl = getContactPhotoUrl(contact);\n      if (photoUrl) {\n        avatarEl.innerHTML = '';\n        const img = document.createElement('img');\n        img.src = photoUrl;\n        img.alt = '';\n        img.onerror = () => { avatarEl.textContent = getInitials(assignee); };\n        avatarEl.appendChild(img);\n      }\n    }\n  }).catch(() => {});\n\n  return container;\n}\n","/**\n * Actions Panel Component\n * Displays and manages action items\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { actionsService, Action } from '../../services/actions';\nimport { dataStore } from '../../stores/data';\nimport { showActionModal } from '../modals/ActionModal';\nimport { createActionDetailView, ActionDetailViewProps } from '../actions/ActionDetailView';\nimport { formatRelativeTime, formatDate } from '../../utils/format';\n\nfunction actionDetailProps(containerEl: HTMLElement, props: ActionsPanelProps, action: Action): ActionDetailViewProps {\n  return {\n    action,\n    onClose: () => {\n      containerEl.innerHTML = '';\n      containerEl.appendChild(createActionsPanel(props));\n    },\n    onUpdate: (updatedAction?: Action) => {\n      containerEl.innerHTML = '';\n      if (updatedAction) {\n        containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, updatedAction)));\n      } else {\n        containerEl.appendChild(createActionsPanel(props));\n      }\n    },\n  };\n}\n\nexport interface ActionsPanelProps {\n  onActionClick?: (action: Action) => void;\n  useDetailView?: boolean;\n  containerElement?: HTMLElement;\n}\n\nlet currentFilter: string = 'all';\n\n/**\n * Create actions panel\n */\nexport function createActionsPanel(props: ActionsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'sot-panel actions-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Actions</h2>\n        <span class=\"panel-count\" id=\"actions-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <select id=\"actions-filter\" class=\"filter-select\">\n          <option value=\"all\">All</option>\n          <option value=\"pending\">Pending</option>\n          <option value=\"in_progress\">In Progress</option>\n          <option value=\"completed\">Completed</option>\n          <option value=\"overdue\">Overdue</option>\n        </select>\n        <button class=\"btn btn-primary btn-sm\" id=\"add-action-btn\">+ Add</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"actions-content\">\n      <div class=\"loading\">Loading actions...</div>\n    </div>\n  `;\n\n  // Bind events\n  const filterSelect = panel.querySelector('#actions-filter') as HTMLSelectElement;\n  on(filterSelect, 'change', () => {\n    currentFilter = filterSelect.value;\n    loadActions(panel, props);\n  });\n\n  const addBtn = panel.querySelector('#add-action-btn');\n  if (addBtn) {\n    on(addBtn as HTMLElement, 'click', () => {\n      showActionModal({\n        mode: 'create',\n        onSave: () => loadActions(panel, props),\n      });\n    });\n  }\n\n  // Initial load\n  loadActions(panel, props);\n\n  return panel;\n}\n\n/**\n * Load actions\n */\nasync function loadActions(panel: HTMLElement, props: ActionsPanelProps): Promise<void> {\n  const content = panel.querySelector('#actions-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const status = currentFilter === 'all' || currentFilter === 'overdue' ? undefined : currentFilter;\n    let actions = await actionsService.getAll(status);\n\n    // Filter overdue\n    if (currentFilter === 'overdue') {\n      actions = actions.filter(a => actionsService.isOverdue(a));\n    }\n\n    renderActions(content, actions, props);\n    dataStore.setActions(actions as unknown as []);\n    updateCount(panel, actions.length);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load actions</div>';\n  }\n}\n\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\n\nfunction findContactByAssignee(contacts: ContactLike[], name: string): ContactLike | undefined {\n  if (!name || !contacts.length) return undefined;\n  const n = name.trim().toLowerCase();\n  if (!n) return undefined;\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n  if (byExact) return byExact;\n  const byPartial = contacts.find(\n    (c) =>\n      (c.name || '').trim().toLowerCase().includes(n) ||\n      n.includes((c.name || '').trim().toLowerCase())\n  );\n  if (byPartial) return byPartial;\n  const byAlias = contacts.find((c) =>\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n  );\n  return byAlias || contacts.find((c) =>\n    (c.aliases || []).some((a) => {\n      const aLower = String(a).trim().toLowerCase();\n      return aLower.includes(n) || n.includes(aLower);\n    })\n  );\n}\n\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\n  if (!c) return null;\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\n}\n\nfunction getInitials(name: string): string {\n  if (!name) return '?';\n  const parts = name.trim().split(/\\s+/);\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\n}\n\n/**\n * Render actions list\n */\nfunction renderActions(container: HTMLElement, actions: Action[], props: ActionsPanelProps): void {\n  if (actions.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No actions found</p>\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Action</button>\n      </div>\n    `;\n    const addBtn = container.querySelector('#empty-add-btn');\n    if (addBtn) {\n      on(addBtn as HTMLElement, 'click', () => {\n        showActionModal({ mode: 'create' });\n      });\n    }\n    return;\n  }\n\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\n  const priorityBarColor: Record<string, string> = { high: '#ea580c', medium: '#ca8a04', low: '#16a34a' };\n\n  container.innerHTML = actions.map(action => {\n    const isOverdue = actionsService.isOverdue(action);\n    const priority = (action.priority || 'medium').toLowerCase();\n    const barColor = priorityBarColor[priority] ?? priorityBarColor.medium;\n    const content = (action.content ?? (action as { task?: string }).task ?? '').trim();\n    const assignee = action.assignee ?? (action as { owner?: string }).owner ?? '';\n    const contact = assignee ? findContactByAssignee(contacts, assignee) : undefined;\n    const photoUrl = getContactPhotoUrl(contact);\n    const assigneeChipHtml = assignee\n      ? `\n        <div class=\"assignee-chip\">\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(assignee)}\" onerror=\"this.parentElement.innerHTML='${getInitials(assignee)}'\">` : getInitials(assignee)}</div>\n          <div class=\"assignee-info\">\n            <span class=\"assignee-name\">${escapeHtml(assignee)}</span>\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\n          </div>\n        </div>\n      `\n      : '';\n    const dueChip = action.due_date ? `<span class=\"card-source-chip\">Due: ${formatDate(action.due_date)}</span>` : '<span class=\"card-source-chip text-muted\">No due date</span>';\n    return `\n      <div class=\"action-card-sota question-card-sota ${isOverdue ? 'overdue' : ''}\" data-id=\"${action.id}\" style=\"--action-priority-bar: ${barColor}\">\n        <div class=\"card-priority-bar action-priority-bar\" style=\"background: ${barColor}\"></div>\n        <div class=\"card-body\">\n          <div class=\"card-top-row\">\n            <div class=\"card-badges\">\n              <span class=\"status-pill status-${(action.status || 'pending').toLowerCase()}\">${escapeHtml(String(action.status).replace('_', ' '))}</span>\n              ${action.priority ? `<span class=\"priority-pill priority-${action.priority}\">${escapeHtml(action.priority)}</span>` : ''}\n              ${isOverdue ? '<span class=\"status-pill overdue\">OVERDUE</span>' : ''}\n            </div>\n            <span class=\"card-timestamp\">${formatRelativeTime(action.created_at)}</span>\n          </div>\n          <div class=\"card-question-text\">${escapeHtml(content)}</div>\n          <div class=\"card-bottom-row\">\n            <div class=\"card-requester\">\n              ${assigneeChipHtml}\n              ${dueChip}\n            </div>\n            <div class=\"card-assignment\">\n              <button type=\"button\" class=\"btn-link action-view-link\">View</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }).join('');\n\n  // Bind click events\n  container.querySelectorAll('.action-card-sota').forEach(card => {\n    on(card as HTMLElement, 'click', (e) => {\n      if ((e.target as HTMLElement).closest('.card-assignment')) return;\n      const id = card.getAttribute('data-id');\n      const action = actions.find(a => String(a.id) === id);\n      if (!action) return;\n      if (props.useDetailView && props.containerElement) {\n        const containerEl = props.containerElement;\n        containerEl.innerHTML = '';\n        containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, action)));\n      } else if (props.onActionClick) {\n        props.onActionClick(action);\n      } else {\n        showActionModal({\n          mode: 'edit',\n          action,\n          onSave: () => loadActions(container.closest('.actions-panel') as HTMLElement, props),\n        });\n      }\n    });\n    const viewLink = card.querySelector('.action-view-link');\n    if (viewLink) {\n      on(viewLink as HTMLElement, 'click', (e) => {\n        e.stopPropagation();\n        const id = card.getAttribute('data-id');\n        const action = actions.find(a => String(a.id) === id);\n        if (!action) return;\n        if (props.useDetailView && props.containerElement) {\n          const containerEl = props.containerElement;\n          containerEl.innerHTML = '';\n          containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, action)));\n        } else if (props.onActionClick) {\n          props.onActionClick(action);\n        } else {\n          showActionModal({\n            mode: 'edit',\n            action,\n            onSave: () => loadActions(container.closest('.actions-panel') as HTMLElement, props),\n          });\n        }\n      });\n    }\n  });\n}\n\n/**\n * Update count badge\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#actions-count');\n  if (countEl) {\n    countEl.textContent = String(count);\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createActionsPanel;\n","/**\n * Decision Modal Component\n * Create, view and edit decisions\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { Decision } from '../../stores/data';\nimport { http } from '../../services/api';\nimport { decisionsService } from '../../services/decisions';\nimport { contactsService, Contact } from '../../services/contacts';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nfunction getInitials(name: string): string {\n  if (!name) return '?';\n  const parts = name.trim().split(/\\s+/);\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\n}\n\nfunction getContactPhotoUrl(c: Contact | undefined): string | null {\n  if (!c) return null;\n  const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\n  return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\n}\n\nconst MODAL_ID = 'decision-modal';\n\nexport interface DecisionModalProps {\n  mode: 'view' | 'edit' | 'create';\n  decision?: Decision;\n  onSave?: (decision: Decision) => void;\n  onDelete?: (decisionId: string) => void;\n}\n\n/**\n * Show decision modal\n */\nexport function showDecisionModal(props: DecisionModalProps): void {\n  const { mode, decision, onSave, onDelete } = props;\n  const isEdit = mode === 'edit' && decision?.id;\n  const isView = mode === 'view';\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'decision-modal-content' });\n\n  if (isView && decision) {\n    const viewContent = (decision as any).content ?? decision.decision;\n    const viewImpact = (decision as any).impact;\n    const viewSummary = (decision as any).summary;\n    content.innerHTML = `\n      <div class=\"decision-view\">\n        <div class=\"decision-meta\">\n          <span class=\"status-badge ${decision.status}\">${decision.status}</span>\n          ${viewImpact ? `<span class=\"impact-badge impact-${viewImpact}\">${escapeHtml(viewImpact)} impact</span>` : ''}\n          <span class=\"decision-date\">${formatRelativeTime(decision.madeAt)}</span>\n        </div>\n        \n        <div class=\"decision-text-large\">\n          ${escapeHtml(viewContent)}\n        </div>\n        \n        ${viewSummary ? `\n          <div class=\"decision-section decision-summary\">\n            <h4>Summary</h4>\n            <p>${escapeHtml(viewSummary)}</p>\n          </div>\n        ` : ''}\n        \n        ${decision.rationale ? `\n          <div class=\"decision-section\">\n            <h4>Rationale</h4>\n            <p>${escapeHtml(decision.rationale)}</p>\n          </div>\n        ` : ''}\n        \n        ${decision.madeBy ? `\n          <div class=\"decision-made-by\">\n            <strong>Decision made by:</strong> ${escapeHtml(decision.madeBy)}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  } else {\n    const decisionContent = (decision as any)?.content ?? decision?.decision ?? '';\n    const decisionImpact = (decision as any)?.impact ?? '';\n    const decisionSummary = (decision as any)?.summary ?? '';\n    content.innerHTML = `\n      <form id=\"decision-form\" class=\"decision-form\">\n        <div class=\"form-group\">\n          <label for=\"decision-text\">Decision *</label>\n          <textarea id=\"decision-text\" rows=\"3\" required \n                    placeholder=\"What was decided?\">${escapeHtml(decisionContent)}</textarea>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"decision-rationale\">Rationale</label>\n          <div class=\"form-group-with-action\">\n            <textarea id=\"decision-rationale\" rows=\"2\" \n                      placeholder=\"Why was this decision made?\">${escapeHtml(decision?.rationale || '')}</textarea>\n          </div>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"decision-impact\">Impact</label>\n            <select id=\"decision-impact\">\n              <option value=\"\"></option>\n              <option value=\"low\" ${decisionImpact === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${decisionImpact === 'medium' || !decisionImpact ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${decisionImpact === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"decision-summary\">Summary (one line)</label>\n            <input type=\"text\" id=\"decision-summary\" \n                   value=\"${escapeHtml(decisionSummary)}\" \n                   placeholder=\"One-line summary for lists/reports\">\n          </div>\n        </div>\n        \n        <div class=\"form-row form-row-actions\">\n          <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"decision-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n            AI suggest\n          </button>\n          <span class=\"form-hint\" id=\"decision-suggest-hint\"></span>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"decision-status\">Status</label>\n            <select id=\"decision-status\">\n              <option value=\"proposed\" ${decision?.status === 'proposed' || !decision ? 'selected' : ''}>Proposed</option>\n              <option value=\"approved\" ${decision?.status === 'approved' ? 'selected' : ''}>Approved</option>\n              <option value=\"rejected\" ${decision?.status === 'rejected' ? 'selected' : ''}>Rejected</option>\n            </select>\n          </div>\n          \n          <div class=\"form-group\">\n            <label>Made By</label>\n            <input type=\"hidden\" id=\"decision-by\" value=\"${escapeHtml(decision?.madeBy || '')}\">\n            <div id=\"decision-made-by-display\" class=\"current-assignment-card decision-modal-owner-card\"></div>\n            <div id=\"decision-modal-contact-picker\" class=\"contact-picker-sota\" style=\"display: none; margin-top: 8px;\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"decision-modal-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"decision-modal-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n          </div>\n        </div>\n      </form>\n    `;\n\n    const suggestBtn = content.querySelector('#decision-ai-suggest-btn');\n    const hintEl = content.querySelector('#decision-suggest-hint');\n    if (suggestBtn) {\n      on(suggestBtn as HTMLElement, 'click', async () => {\n        const getVal = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value?.trim() || '';\n        const text = getVal('decision-text');\n        if (!text) {\n          toast.warning('Enter decision text first');\n          return;\n        }\n        (suggestBtn as HTMLButtonElement).disabled = true;\n        if (hintEl) hintEl.textContent = 'Asking AI';\n        try {\n          const result = await decisionsService.suggest(text, getVal('decision-rationale'));\n          (content.querySelector('#decision-rationale') as HTMLTextAreaElement).value = result.rationale || '';\n          (content.querySelector('#decision-impact') as HTMLSelectElement).value = result.impact || 'medium';\n          (content.querySelector('#decision-summary') as HTMLInputElement).value = result.summary || '';\n          if (hintEl) hintEl.textContent = result.impact_summary ? `Impact: ${result.impact_summary}` : 'Done';\n        } catch {\n          if (hintEl) hintEl.textContent = '';\n          toast.error('AI suggest failed');\n        } finally {\n          (suggestBtn as HTMLButtonElement).disabled = false;\n        }\n      });\n    }\n\n    // Made By: contact picker + current-assignment display\n    let modalContacts: Contact[] = [];\n    const madeByDisplay = content.querySelector('#decision-made-by-display') as HTMLElement;\n    const madeByInput = content.querySelector('#decision-by') as HTMLInputElement;\n    const modalPicker = content.querySelector('#decision-modal-contact-picker') as HTMLElement;\n    const modalContactList = content.querySelector('#decision-modal-contact-list') as HTMLElement;\n    const modalContactSearch = content.querySelector('#decision-modal-contact-search') as HTMLInputElement;\n\n    function findContactByName(name: string): Contact | undefined {\n      if (!name || !modalContacts.length) return undefined;\n      const n = name.trim().toLowerCase();\n      if (!n) return undefined;\n      const byExact = modalContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n      if (byExact) return byExact;\n      const byAlias = modalContacts.find((c) =>\n        (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n      );\n      return byAlias;\n    }\n\n    function renderMadeByDisplay(madeBy: string) {\n      if (!madeByDisplay || !madeByInput) return;\n      madeByInput.value = madeBy;\n      if (madeBy) {\n        const contact = findContactByName(madeBy);\n        const photoUrl = getContactPhotoUrl(contact);\n        madeByDisplay.innerHTML = `\n          <div class=\"assigned-contact-display\">\n            <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(madeBy)}'\">` : getInitials(madeBy)}</div>\n            <div class=\"contact-details\">\n              <div class=\"contact-name-lg\">${escapeHtml(madeBy)}</div>\n              ${contact?.role ? `<div class=\"contact-role-sm\">${escapeHtml(contact.role)}</div>` : ''}\n            </div>\n            <button type=\"button\" class=\"btn-change-assignment\" id=\"decision-modal-change-owner-btn\">\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n              Change\n            </button>\n          </div>`;\n      } else {\n        madeByDisplay.innerHTML = `\n          <div class=\"no-assignment\">\n            <span>No owner</span>\n            <button type=\"button\" class=\"btn-assign-now\" id=\"decision-modal-choose-owner-btn\">Choose</button>\n          </div>`;\n      }\n      const changeBtn = madeByDisplay.querySelector('#decision-modal-change-owner-btn');\n      const chooseBtn = madeByDisplay.querySelector('#decision-modal-choose-owner-btn');\n      if (changeBtn) on(changeBtn as HTMLElement, 'click', showModalPicker);\n      if (chooseBtn) on(chooseBtn as HTMLElement, 'click', showModalPicker);\n    }\n\n    function showModalPicker() {\n      if (!modalPicker) return;\n      modalPicker.style.display = modalPicker.style.display === 'none' ? 'block' : 'none';\n      if (modalPicker.style.display === 'block' && modalContacts.length === 0) {\n        contactsService.getAll().then((res) => {\n          modalContacts = res?.contacts || [];\n          renderModalContactGrid(modalContactSearch?.value || '');\n        }).catch(() => {\n          if (modalContactList) modalContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n        });\n      } else if (modalPicker.style.display === 'block') {\n        renderModalContactGrid(modalContactSearch?.value || '');\n      }\n      if (modalContactSearch) modalContactSearch.focus();\n    }\n\n    function renderModalContactGrid(filter: string) {\n      if (!modalContactList) return;\n      const list = filter\n        ? modalContacts.filter(\n            (c) =>\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\n          )\n        : modalContacts;\n      if (modalContacts.length === 0) {\n        modalContactList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\n        return;\n      }\n      if (list.length === 0) {\n        modalContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n        return;\n      }\n      const currentMadeBy = (madeByInput?.value || '').trim();\n      modalContactList.innerHTML = list\n        .map((c) => {\n          const photoUrl = getContactPhotoUrl(c);\n          const isCurrent = currentMadeBy === (c.name || '').trim();\n          return `\n            <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n              <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n              <div class=\"contact-info-picker\">\n                <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n                ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n              </div>\n            </div>`;\n        })\n        .join('');\n      modalContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\n        on(card as HTMLElement, 'click', () => {\n          const name = card.getAttribute('data-contact-name') || '';\n          if (name) {\n            renderMadeByDisplay(name);\n            if (modalPicker) modalPicker.style.display = 'none';\n          }\n        });\n      });\n    }\n\n    contactsService.getAll().then((res) => {\n      modalContacts = res?.contacts || [];\n      renderMadeByDisplay(decision?.madeBy || '');\n    }).catch(() => {\n      renderMadeByDisplay(decision?.madeBy || '');\n    });\n\n    if (modalContactSearch) {\n      modalContactSearch.addEventListener('input', () => renderModalContactGrid(modalContactSearch.value));\n    }\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  if (isView && decision) {\n    // Quick status change buttons for proposed decisions\n    if (decision.status === 'proposed') {\n      const approveBtn = createElement('button', {\n        className: 'btn btn-success',\n        textContent: 'Approve',\n      });\n\n      const rejectBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Reject',\n      });\n\n      on(approveBtn, 'click', () => updateStatus(String(decision.id), 'approved', onSave));\n      on(rejectBtn, 'click', () => updateStatus(String(decision.id), 'rejected', onSave));\n\n      footer.appendChild(rejectBtn);\n      footer.appendChild(approveBtn);\n    }\n\n    const editBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Edit',\n    });\n\n    const closeBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Close',\n    });\n\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    on(editBtn, 'click', () => {\n      closeModal(MODAL_ID);\n      showDecisionModal({ ...props, mode: 'edit' });\n    });\n\n    footer.appendChild(closeBtn);\n    footer.appendChild(editBtn);\n  } else {\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const saveBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: isEdit ? 'Save Changes' : 'Create Decision',\n    });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n    on(saveBtn, 'click', async () => {\n      const form = content.querySelector('#decision-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\n\n      const decisionData: Decision & { impact?: string; summary?: string } = {\n        id: decision?.id || `dec-${Date.now()}`,\n        decision: getValue('decision-text'),\n        rationale: getValue('decision-rationale') || undefined,\n        status: getValue('decision-status') as Decision['status'],\n        madeBy: getValue('decision-by') || undefined,\n        madeAt: decision?.madeAt || new Date().toISOString(),\n        impact: getValue('decision-impact') as 'low' | 'medium' | 'high' || undefined,\n        summary: getValue('decision-summary') || undefined,\n      };\n\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Saving...';\n\n      const apiPayload = {\n        content: decisionData.decision,\n        decision: decisionData.decision,\n        rationale: decisionData.rationale,\n        status: decisionData.status,\n        made_by: decisionData.madeBy,\n        impact: decisionData.impact,\n        summary: decisionData.summary,\n      };\n      try {\n        if (isEdit) {\n          await http.put(`/api/decisions/${decision!.id}`, apiPayload);\n          toast.success('Decision updated');\n        } else {\n          const response = await http.post<{ id: string }>('/api/decisions', apiPayload);\n          decisionData.id = response.data.id;\n          toast.success('Decision recorded');\n        }\n\n        onSave?.(decisionData);\n        closeModal(MODAL_ID);\n      } catch {\n        // Error shown by API service\n      } finally {\n        saveBtn.disabled = false;\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Decision';\n      }\n    });\n\n    if (isEdit) {\n      const deleteBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Delete',\n      });\n\n      on(deleteBtn, 'click', async () => {\n        const { confirm } = await import('../Modal');\n        const confirmed = await confirm(\n          'Are you sure you want to delete this decision?',\n          {\n            title: 'Delete Decision',\n            confirmText: 'Delete',\n            confirmClass: 'btn-danger',\n          }\n        );\n\n        if (confirmed) {\n          try {\n            await http.delete(`/api/decisions/${decision!.id}`);\n            toast.success('Decision deleted');\n            onDelete?.(String(decision!.id));\n            closeModal(MODAL_ID);\n          } catch {\n            // Error shown by API service\n          }\n        }\n      });\n\n      footer.appendChild(deleteBtn);\n    }\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(saveBtn);\n  }\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: isView ? 'Decision Details' : (isEdit ? 'Edit Decision' : 'Record Decision'),\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Update decision status\n */\nasync function updateStatus(\n  decisionId: string,\n  status: Decision['status'],\n  onSave?: (decision: Decision) => void\n): Promise<void> {\n  try {\n    await http.patch(`/api/decisions/${decisionId}`, { status });\n    toast.success(`Decision ${status}`);\n    closeModal(MODAL_ID);\n    // Note: In a real app, we'd update the local state here\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showDecisionModal;\n","/**\n * Decision Detail View\n * Full-page view for decision details: content, status, rationale, owner, source, timeline, similar decisions\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { Decision, decisionsService } from '../../services/decisions';\nimport { contactsService, Contact } from '../../services/contacts';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\n\nfunction getInitials(name: string): string {\n  return name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\n}\n\nexport interface DecisionDetailViewProps {\n  decision: Decision;\n  onClose: () => void;\n  onUpdate?: (decision: Decision) => void;\n  onDecisionClick?: (decision: Decision) => void;\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nfunction formatDate(iso: string | undefined): string {\n  if (!iso) return '';\n  try {\n    return formatDateTime(iso);\n  } catch {\n    return iso;\n  }\n}\n\nexport function createDecisionDetailView(props: DecisionDetailViewProps): HTMLElement {\n  const { decision, onClose, onUpdate, onDecisionClick } = props;\n\n  const container = createElement('div', { className: 'decision-detail-view question-detail-view' });\n\n  container.innerHTML = `\n    <div class=\"question-detail-header decision-detail-header\">\n      <div class=\"breadcrumb\">\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Decisions</a>\n        <span class=\"breadcrumb-separator\"></span>\n        <span class=\"breadcrumb-current\">Decision #${String(decision.id).substring(0, 8)}</span>\n      </div>\n      <div class=\"header-actions\">\n        <span class=\"status-badge status-${(decision.status || 'active').toLowerCase()}\">${escapeHtml(String(decision.status))}</span>\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\n      </div>\n    </div>\n\n    <div class=\"question-detail-content decision-detail-content\">\n      <div id=\"decision-view-content\">\n      <section class=\"detail-section decision-main\">\n        <div class=\"question-badges decision-badges\">\n          ${decision.impact ? `<span class=\"priority-pill impact-${decision.impact}\">${escapeHtml(decision.impact)} impact</span>` : ''}\n          ${decision.generation_source ? `<span class=\"status-pill\">${escapeHtml(decision.generation_source)}</span>` : ''}\n          <span class=\"question-date decision-date\">Created ${formatRelativeTime(decision.created_at)}</span>\n        </div>\n        <h2 class=\"question-text decision-content-text\" id=\"decision-view-content-text\">${escapeHtml(decision.content)}</h2>\n      </section>\n\n      <div class=\"detail-columns\">\n        <div class=\"detail-column-left\">\n          <section class=\"detail-section\">\n            <div class=\"section-header-sota\">\n              <h3>Rationale / Context</h3>\n              <span class=\"section-subtitle\">Why was this decision made?</span>\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"decision-rationale-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Suggest\n              </button>\n            </div>\n            <div id=\"decision-view-rationale\">${(decision.rationale || decision.context) ? `<p class=\"decision-rationale\">${escapeHtml(decision.rationale || decision.context || '')}</p>` : '<p class=\"text-muted\">No rationale recorded</p>'}</div>\n            <div id=\"decision-suggestions-panel\" class=\"suggestions-panel-sota decision-suggestions-panel\" style=\"display: none; margin-top: 8px;\"></div>\n          </section>\n\n          <section class=\"detail-section\" id=\"decision-owner-section\">\n            <div class=\"section-header-sota\">\n              <h3>\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                </svg>\n                Owner / Made by\n                <span class=\"section-subtitle\">Who made this decision?</span>\n              </h3>\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"decision-owner-ai-suggest-btn\" title=\"Suggest owner from decision content\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Suggest\n              </button>\n            </div>\n\n            <div id=\"decision-current-owner\" class=\"current-assignment-card\">\n              ${(decision.made_by || decision.owner) ? `\n                <div class=\"assigned-contact-display\">\n                  <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${getInitials(decision.made_by || decision.owner || '')}</div>\n                  <div class=\"contact-details\">\n                    <div class=\"contact-name-lg\">${escapeHtml(decision.made_by || decision.owner || '')}</div>\n                    <div class=\"contact-role-sm\" id=\"decision-owner-role\"></div>\n                  </div>\n                  <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                    Change\n                  </button>\n                </div>\n              ` : `\n                <div class=\"no-assignment\">\n                  <div class=\"no-assignment-icon\">\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\n                  </div>\n                  <span>No owner</span>\n                  <p class=\"no-assignment-hint\">Choose from contacts</p>\n                  <button class=\"btn-assign-now\" id=\"decision-show-owner-picker-btn\" type=\"button\">Choose</button>\n                </div>\n              `}\n            </div>\n\n            <div id=\"decision-contact-picker\" class=\"contact-picker-sota\" style=\"display: none;\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"decision-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"decision-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n\n            <div id=\"decision-owner-suggestions-panel\" class=\"suggestions-panel-sota decision-owner-suggestions-panel\" style=\"display: none; margin-top: 8px;\"></div>\n\n            ${decision.approved_by ? `<p class=\"text-muted\" style=\"margin-top: 8px;\">Approved by: ${escapeHtml(decision.approved_by)}</p>` : ''}\n            ${decision.decided_at ? `<p class=\"text-muted\">Decided: ${formatDate(decision.decided_at)}</p>` : ''}\n          </section>\n\n          <section class=\"detail-section\">\n            <div class=\"section-header\">\n              <h3>Source</h3>\n            </div>\n            ${decision.source_file ? `<p class=\"source-file\">${escapeHtml(decision.source_file)}</p>` : ''}\n            ${decision.source_document_id ? `\n              <p class=\"source-doc\">\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(decision.source_document_id))}\">View source document</a>\n              </p>\n            ` : ''}\n            ${!decision.source_file && !decision.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\n          </section>\n        </div>\n\n        <div class=\"detail-column-right\">\n          <section class=\"detail-section metadata-section\">\n            <div class=\"section-header\">\n              <h3>Metadata</h3>\n            </div>\n            <dl class=\"metadata-list\">\n              <dt>Created</dt>\n              <dd>${formatDate(decision.created_at)}</dd>\n              ${decision.updated_at ? `<dt>Updated</dt><dd>${formatDate(decision.updated_at)}</dd>` : ''}\n            </dl>\n          </section>\n\n          <section class=\"detail-section decision-timeline-section\">\n            <div class=\"section-header\">\n              <h3>Timeline</h3>\n            </div>\n            <div id=\"decision-timeline-list\" class=\"decision-timeline-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n\n          <section class=\"detail-section decision-similar-section\">\n            <div class=\"section-header\">\n              <h3>Similar decisions</h3>\n            </div>\n            <div id=\"decision-similar-list\" class=\"decision-similar-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n        </div>\n      </div>\n\n      <div class=\"detail-actions\">\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-decision-btn\">Edit</button>\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-decision-btn\">Delete</button>\n      </div>\n      </div>\n\n      <div id=\"decision-edit-form\" class=\"decision-detail-edit-form\" style=\"display: none;\">\n        <form id=\"decision-inline-form\" class=\"decision-form\">\n          <div class=\"form-group\">\n            <label for=\"decision-edit-content\">Decision *</label>\n            <textarea id=\"decision-edit-content\" rows=\"3\" required placeholder=\"What was decided?\">${escapeHtml(decision.content || '')}</textarea>\n          </div>\n          <div class=\"form-group\">\n            <div style=\"display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px; margin-bottom: 6px;\">\n              <label for=\"decision-edit-rationale\" style=\"margin-bottom: 0;\">Rationale</label>\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"decision-edit-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI suggest\n              </button>\n            </div>\n            <textarea id=\"decision-edit-rationale\" rows=\"2\" placeholder=\"Why was this decision made?\">${escapeHtml(decision.rationale || decision.context || '')}</textarea>\n          </div>\n          <div id=\"decision-edit-suggestions-panel\" class=\"suggestions-panel-sota\" style=\"display: none; margin-bottom: 12px;\"></div>\n          <div class=\"form-row\">\n            <div class=\"form-group\">\n              <label for=\"decision-edit-impact\">Impact</label>\n              <select id=\"decision-edit-impact\">\n                <option value=\"low\" ${decision.impact === 'low' ? 'selected' : ''}>Low</option>\n                <option value=\"medium\" ${decision.impact === 'medium' || !decision.impact ? 'selected' : ''}>Medium</option>\n                <option value=\"high\" ${decision.impact === 'high' ? 'selected' : ''}>High</option>\n              </select>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"decision-edit-summary\">Summary (one line)</label>\n              <input type=\"text\" id=\"decision-edit-summary\" value=\"${escapeHtml((decision as { summary?: string }).summary || '')}\" placeholder=\"One-line summary for lists/reports\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"decision-edit-status\">Status</label>\n              <select id=\"decision-edit-status\">\n                <option value=\"proposed\" ${decision.status === 'proposed' || !decision.status ? 'selected' : ''}>Proposed</option>\n                <option value=\"approved\" ${decision.status === 'approved' ? 'selected' : ''}>Approved</option>\n                <option value=\"rejected\" ${decision.status === 'rejected' ? 'selected' : ''}>Rejected</option>\n                <option value=\"deferred\" ${decision.status === 'deferred' ? 'selected' : ''}>Deferred</option>\n                <option value=\"active\" ${decision.status === 'active' ? 'selected' : ''}>Active</option>\n                <option value=\"superseded\" ${decision.status === 'superseded' ? 'selected' : ''}>Superseded</option>\n                <option value=\"revoked\" ${decision.status === 'revoked' ? 'selected' : ''}>Revoked</option>\n              </select>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label>Made by</label>\n            <input type=\"hidden\" id=\"decision-edit-made-by\" value=\"${escapeHtml(decision.made_by || (decision as { owner?: string }).owner || '')}\">\n            <div id=\"decision-edit-owner-display\" class=\"current-assignment-card decision-edit-owner-card\"></div>\n            <div id=\"decision-edit-contact-picker\" class=\"contact-picker-sota\" style=\"display: none; margin-top: 8px;\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"decision-edit-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"decision-edit-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n          </div>\n        </form>\n        <div class=\"detail-actions\">\n          <button type=\"button\" class=\"btn btn-primary\" id=\"decision-save-btn\">Save</button>\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"decision-cancel-edit-btn\">Cancel</button>\n          <button type=\"button\" class=\"btn btn-danger\" id=\"decision-delete-in-edit-btn\">Delete</button>\n        </div>\n      </div>\n    </div>\n  `;\n\n  const backLink = container.querySelector('#back-to-list');\n  if (backLink) {\n    on(backLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      onClose();\n    });\n  }\n  const closeBtn = container.querySelector('#close-detail');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', onClose);\n  }\n\n  const viewContent = container.querySelector('#decision-view-content') as HTMLElement;\n  const editForm = container.querySelector('#decision-edit-form') as HTMLElement;\n\n  const editBtn = container.querySelector('#edit-decision-btn');\n  if (editBtn && viewContent && editForm) {\n    on(editBtn as HTMLElement, 'click', () => {\n      viewContent.style.display = 'none';\n      editForm.style.display = 'block';\n      // Sync edit form owner (in case owner was changed in view)\n      renderEditFormOwnerDisplay(currentOwnerName);\n    });\n  }\n\n  const cancelEditBtn = container.querySelector('#decision-cancel-edit-btn');\n  if (cancelEditBtn && viewContent && editForm) {\n    on(cancelEditBtn as HTMLElement, 'click', () => {\n      editForm.style.display = 'none';\n      viewContent.style.display = '';\n    });\n  }\n\n  const saveBtn = container.querySelector('#decision-save-btn');\n  if (saveBtn && editForm && onUpdate) {\n    on(saveBtn as HTMLElement, 'click', async () => {\n      const form = container.querySelector('#decision-inline-form') as HTMLFormElement;\n      if (!form?.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n      const contentEl = container.querySelector('#decision-edit-content') as HTMLTextAreaElement;\n      const rationaleEl = container.querySelector('#decision-edit-rationale') as HTMLTextAreaElement;\n      const impactEl = container.querySelector('#decision-edit-impact') as HTMLSelectElement;\n      const summaryEl = container.querySelector('#decision-edit-summary') as HTMLInputElement;\n      const statusEl = container.querySelector('#decision-edit-status') as HTMLSelectElement;\n      const madeByEl = container.querySelector('#decision-edit-made-by') as HTMLInputElement;\n      const content = contentEl?.value?.trim() || '';\n      if (!content) {\n        toast.error('Decision text is required');\n        return;\n      }\n      (saveBtn as HTMLButtonElement).disabled = true;\n      (saveBtn as HTMLButtonElement).textContent = 'Saving...';\n      try {\n        const updated = await decisionsService.update(decision.id, {\n          content,\n          rationale: rationaleEl?.value?.trim() || undefined,\n          impact: (impactEl?.value || undefined) as Decision['impact'],\n          summary: (summaryEl?.value?.trim() || undefined) as string | undefined,\n          status: (statusEl?.value || 'active') as Decision['status'],\n          made_by: madeByEl?.value?.trim() || undefined,\n        });\n        toast.success('Decision updated');\n        // Update view DOM from response\n        const viewContentText = container.querySelector('#decision-view-content-text');\n        if (viewContentText) viewContentText.textContent = updated.content || content;\n        const viewRationale = container.querySelector('#decision-view-rationale');\n        if (viewRationale) {\n          viewRationale.innerHTML = (updated.rationale || updated.context)\n            ? `<p class=\"decision-rationale\">${escapeHtml(updated.rationale || updated.context || '')}</p>`\n            : '<p class=\"text-muted\">No rationale recorded</p>';\n        }\n        const statusBadge = container.querySelector('.decision-detail-header .status-badge');\n        if (statusBadge) {\n          statusBadge.textContent = String(updated.status || 'active');\n          statusBadge.className = `status-badge status-${(updated.status || 'active').toLowerCase()}`;\n        }\n        const badges = container.querySelector('.decision-badges');\n        if (badges) {\n          const impactPill = (updated as Decision).impact\n            ? `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span>`\n            : '';\n          const existing = badges.innerHTML;\n          if (impactPill && !existing.includes('impact-')) {\n            badges.insertAdjacentHTML('afterbegin', impactPill + ' ');\n          } else if (impactPill) {\n            const oldPill = badges.querySelector('.priority-pill.impact-');\n            if (oldPill) oldPill.outerHTML = impactPill;\n          }\n        }\n        currentOwnerName = updated.made_by || (updated as { owner?: string }).owner || '';\n        // Refresh owner display in view\n        const currentOwnerEl = container.querySelector('#decision-current-owner');\n        if (currentOwnerEl && currentOwnerName) {\n          const contact = findContactByOwner(currentOwnerName);\n          const photoUrl = getContactPhotoUrl(contact);\n          currentOwnerEl.innerHTML = `\n            <div class=\"assigned-contact-display\">\n              <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(currentOwnerName)}'\">` : getInitials(currentOwnerName)}</div>\n              <div class=\"contact-details\">\n                <div class=\"contact-name-lg\">${escapeHtml(currentOwnerName)}</div>\n                <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\n              </div>\n              <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                Change\n              </button>\n            </div>`;\n          const chBtn = currentOwnerEl.querySelector('#decision-change-owner-btn');\n          if (chBtn) on(chBtn as HTMLElement, 'click', showOwnerPicker);\n        } else if (currentOwnerEl && !currentOwnerName) {\n          currentOwnerEl.innerHTML = `\n            <div class=\"no-assignment\">\n              <div class=\"no-assignment-icon\">\n                <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\n              </div>\n              <span>No owner</span>\n              <p class=\"no-assignment-hint\">Choose from contacts</p>\n              <button class=\"btn-assign-now\" id=\"decision-show-owner-picker-btn\" type=\"button\">Choose</button>\n            </div>`;\n          const showBtn = currentOwnerEl.querySelector('#decision-show-owner-picker-btn');\n          if (showBtn) on(showBtn as HTMLElement, 'click', showOwnerPicker);\n        }\n        onUpdate(updated);\n        editForm.style.display = 'none';\n        viewContent.style.display = '';\n      } catch {\n        toast.error('Failed to save decision');\n      } finally {\n        (saveBtn as HTMLButtonElement).disabled = false;\n        (saveBtn as HTMLButtonElement).textContent = 'Save';\n      }\n    });\n  }\n\n  const deleteInEditBtn = container.querySelector('#decision-delete-in-edit-btn');\n  if (deleteInEditBtn) {\n    on(deleteInEditBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this decision?')) return;\n      try {\n        await decisionsService.delete(decision.id);\n        toast.success('Decision deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete decision');\n      }\n    });\n  }\n\n  const deleteBtn = container.querySelector('#delete-decision-btn');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this decision?')) return;\n      try {\n        await decisionsService.delete(decision.id);\n        toast.success('Decision deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete decision');\n      }\n    });\n  }\n\n  const docLink = container.querySelector('.doc-link');\n  if (docLink && decision.source_document_id) {\n    on(docLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\n        detail: { tab: 'files', documentId: decision.source_document_id }\n      }));\n    });\n  }\n\n  // Owner section: load contacts, show avatar/role, contact picker\n  let viewContacts: Contact[] = [];\n  let currentOwnerName = decision.made_by || (decision as { owner?: string }).owner || '';\n  const ownerPicker = container.querySelector('#decision-contact-picker') as HTMLElement;\n  const ownerList = container.querySelector('#decision-contact-list') as HTMLElement;\n  const ownerSearch = container.querySelector('#decision-contact-search') as HTMLInputElement;\n\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\n    if (!c) return null;\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\n  }\n\n  function findContactByOwner(name: string): Contact | undefined {\n    if (!name || !viewContacts.length) return undefined;\n    const n = name.trim().toLowerCase();\n    if (!n) return undefined;\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n    if (byExact) return byExact;\n    const byPartial = viewContacts.find(\n      (c) =>\n        (c.name || '').trim().toLowerCase().includes(n) ||\n        n.includes((c.name || '').trim().toLowerCase())\n    );\n    if (byPartial) return byPartial;\n    const byAlias = viewContacts.find((c) =>\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n    );\n    return byAlias || viewContacts.find((c) =>\n      (c.aliases || []).some((a) => {\n        const aLower = String(a).trim().toLowerCase();\n        return aLower.includes(n) || n.includes(aLower);\n      })\n    );\n  }\n\n  const renderOwnerContactGrid = (filter = '') => {\n    if (!ownerList) return;\n    const list = filter\n      ? viewContacts.filter(\n          (c) =>\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n            (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\n            ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\n        )\n      : viewContacts;\n    if (viewContacts.length === 0) {\n      ownerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n      return;\n    }\n    if (list.length === 0) {\n      ownerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n      return;\n    }\n    ownerList.innerHTML = list\n      .map((c) => {\n        const photoUrl = getContactPhotoUrl(c);\n        const isCurrent = (currentOwnerName || '').trim() === (c.name || '').trim();\n        return `\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n            <div class=\"contact-info-picker\">\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n            </div>\n          </div>`;\n      })\n      .join('');\n    ownerList.querySelectorAll('.contact-card-picker').forEach((card) => {\n      on(card as HTMLElement, 'click', async () => {\n        const name = card.getAttribute('data-contact-name') || '';\n        if (!name) return;\n        try {\n          const updated = await decisionsService.update(decision.id, { made_by: name });\n          currentOwnerName = name;\n          toast.success(`Owner set to ${name}`);\n          if (ownerPicker) ownerPicker.style.display = 'none';\n          if (onUpdate) onUpdate({ ...decision, made_by: name, ...updated });\n          // Refresh displayed owner in current-assignment card\n          const currentEl = container.querySelector('#decision-current-owner');\n          if (currentEl) {\n            const contact = findContactByOwner(name);\n            const photoUrl = getContactPhotoUrl(contact);\n            currentEl.innerHTML = `\n              <div class=\"assigned-contact-display\">\n                <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\">` : getInitials(name)}</div>\n                <div class=\"contact-details\">\n                  <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\n                  <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\n                </div>\n                <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                  <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                  Change\n                </button>\n              </div>`;\n            const changeBtn = currentEl.querySelector('#decision-change-owner-btn');\n            if (changeBtn) on(changeBtn as HTMLElement, 'click', showOwnerPicker);\n          }\n        } catch {\n          toast.error('Failed to save owner');\n        }\n      });\n    });\n  };\n\n  const showOwnerPicker = () => {\n    if (!ownerPicker) return;\n    ownerPicker.style.display = ownerPicker.style.display === 'none' ? 'block' : 'none';\n    if (ownerPicker.style.display === 'block' && viewContacts.length === 0) {\n      contactsService.getAll().then((res) => {\n        viewContacts = res?.contacts || [];\n        renderOwnerContactGrid(ownerSearch?.value || '');\n      }).catch(() => {\n        if (ownerList) ownerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n      });\n    } else if (ownerPicker.style.display === 'block') {\n      renderOwnerContactGrid(ownerSearch?.value || '');\n    }\n    if (ownerSearch) ownerSearch.focus();\n  };\n\n  const changeOwnerBtn = container.querySelector('#decision-change-owner-btn');\n  const showOwnerPickerBtn = container.querySelector('#decision-show-owner-picker-btn');\n  if (changeOwnerBtn && ownerPicker) on(changeOwnerBtn as HTMLElement, 'click', showOwnerPicker);\n  if (showOwnerPickerBtn && ownerPicker) on(showOwnerPickerBtn as HTMLElement, 'click', showOwnerPicker);\n  if (ownerSearch) {\n    ownerSearch.addEventListener('input', () => renderOwnerContactGrid(ownerSearch.value));\n  }\n\n  contactsService.getAll().then((res) => {\n    viewContacts = res?.contacts || [];\n    const contact = findContactByOwner(currentOwnerName);\n    const roleEl = container.querySelector('#decision-owner-role');\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\n    const avatarEl = container.querySelector('#decision-owner-avatar');\n    if (avatarEl && currentOwnerName) {\n      const photoUrl = getContactPhotoUrl(contact);\n      if (photoUrl) {\n        avatarEl.innerHTML = '';\n        const img = document.createElement('img');\n        img.src = photoUrl;\n        img.alt = '';\n        img.onerror = () => { avatarEl.textContent = getInitials(currentOwnerName); };\n        avatarEl.appendChild(img);\n      }\n    }\n  }).catch(() => {});\n\n  // Edit form: owner display and contact picker (reuse viewContacts)\n  const editOwnerDisplay = container.querySelector('#decision-edit-owner-display') as HTMLElement;\n  const editMadeByInput = container.querySelector('#decision-edit-made-by') as HTMLInputElement;\n  const editContactPicker = container.querySelector('#decision-edit-contact-picker') as HTMLElement;\n  const editContactList = container.querySelector('#decision-edit-contact-list') as HTMLElement;\n  const editContactSearch = container.querySelector('#decision-edit-contact-search') as HTMLInputElement;\n\n  function renderEditFormOwnerDisplay(madeBy: string) {\n    if (!editOwnerDisplay || !editMadeByInput) return;\n    editMadeByInput.value = madeBy;\n    if (madeBy) {\n      const contact = findContactByOwner(madeBy);\n      const photoUrl = getContactPhotoUrl(contact);\n      editOwnerDisplay.innerHTML = `\n        <div class=\"assigned-contact-display\">\n          <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(madeBy)}'\">` : getInitials(madeBy)}</div>\n          <div class=\"contact-details\">\n            <div class=\"contact-name-lg\">${escapeHtml(madeBy)}</div>\n            ${contact?.role ? `<div class=\"contact-role-sm\">${escapeHtml(contact.role)}</div>` : ''}\n          </div>\n          <button type=\"button\" class=\"btn-change-assignment\" id=\"decision-edit-change-owner-btn\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n            Change\n          </button>\n        </div>`;\n    } else {\n      editOwnerDisplay.innerHTML = `\n        <div class=\"no-assignment\">\n          <span>No owner</span>\n          <button type=\"button\" class=\"btn-assign-now\" id=\"decision-edit-choose-owner-btn\">Choose</button>\n        </div>`;\n    }\n    const chBtn = editOwnerDisplay.querySelector('#decision-edit-change-owner-btn');\n    const chooseBtn = editOwnerDisplay.querySelector('#decision-edit-choose-owner-btn');\n    if (chBtn) on(chBtn as HTMLElement, 'click', showEditOwnerPicker);\n    if (chooseBtn) on(chooseBtn as HTMLElement, 'click', showEditOwnerPicker);\n  }\n\n  function renderEditFormContactGrid(filter = '') {\n    if (!editContactList) return;\n    const list = filter\n      ? viewContacts.filter(\n          (c) =>\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n            (c.role || '').toLowerCase().includes(filter.toLowerCase())\n        )\n      : viewContacts;\n    if (viewContacts.length === 0) {\n      editContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n      return;\n    }\n    if (list.length === 0) {\n      editContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n      return;\n    }\n    const currentMadeBy = (editMadeByInput?.value || '').trim();\n    editContactList.innerHTML = list\n      .map((c) => {\n        const photoUrl = getContactPhotoUrl(c);\n        const isCurrent = currentMadeBy === (c.name || '').trim();\n        return `\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n            <div class=\"contact-info-picker\">\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n            </div>\n          </div>`;\n      })\n      .join('');\n    editContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\n      on(card as HTMLElement, 'click', () => {\n        const name = card.getAttribute('data-contact-name') || '';\n        if (name) {\n          renderEditFormOwnerDisplay(name);\n          if (editContactPicker) editContactPicker.style.display = 'none';\n        }\n      });\n    });\n  }\n\n  function showEditOwnerPicker() {\n    if (!editContactPicker) return;\n    editContactPicker.style.display = editContactPicker.style.display === 'none' ? 'block' : 'none';\n    if (editContactPicker.style.display === 'block') {\n      if (viewContacts.length === 0) {\n        contactsService.getAll().then((res) => {\n          viewContacts = res?.contacts || [];\n          renderEditFormContactGrid(editContactSearch?.value || '');\n        }).catch(() => {\n          if (editContactList) editContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n        });\n      } else {\n        renderEditFormContactGrid(editContactSearch?.value || '');\n      }\n    }\n    if (editContactSearch) editContactSearch.focus();\n  }\n\n  if (editContactSearch) {\n    editContactSearch.addEventListener('input', () => renderEditFormContactGrid(editContactSearch.value));\n  }\n\n  // Initial edit form owner display (when user opens edit, we call renderEditFormOwnerDisplay in edit button handler)\n  renderEditFormOwnerDisplay(decision.made_by || (decision as { owner?: string }).owner || '');\n\n  // AI Suggest (view mode): Owner section  suggest owner from decision content (project contacts only)\n  const ownerAiSuggestBtn = container.querySelector('#decision-owner-ai-suggest-btn');\n  const ownerSuggestionsPanel = container.querySelector('#decision-owner-suggestions-panel') as HTMLElement;\n  if (ownerAiSuggestBtn && ownerSuggestionsPanel) {\n    on(ownerAiSuggestBtn as HTMLElement, 'click', async () => {\n      (ownerAiSuggestBtn as HTMLButtonElement).disabled = true;\n      ownerSuggestionsPanel.style.display = 'block';\n      ownerSuggestionsPanel.innerHTML = '<div class=\"loading\">Asking AI</div>';\n      try {\n        if (viewContacts.length === 0) {\n          const res = await contactsService.getAll();\n          viewContacts = res?.contacts || [];\n        }\n        const { suggested_owners } = await decisionsService.suggestOwner(decision.content || '', decision.rationale || decision.context || '');\n        if (!suggested_owners?.length) {\n          ownerSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\">No owner suggestions. <button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>';\n        } else {\n          ownerSuggestionsPanel.innerHTML = `\n            <div class=\"suggestions-header-sota\">\n              <div class=\"ai-badge\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Recommended\n              </div>\n            </div>\n            <div class=\"suggestions-list-sota\">\n              ${suggested_owners.map((s, i) => {\n                const contact = findContactByOwner(s.name);\n                const photoUrl = getContactPhotoUrl(contact);\n                const roleOrReason = contact?.role ?? s.reason ?? '';\n                const score = s.score ?? 0;\n                const scoreColor = score >= 70 ? 'var(--success)' : score >= 50 ? 'var(--warning)' : 'var(--text-muted)';\n                return `\n                <div class=\"suggestion-card-sota decision-owner-card\" data-owner-name=\"${escapeHtml(s.name)}\">\n                  <div class=\"suggestion-rank\">#${i + 1}</div>\n                  <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\n                  <div class=\"suggestion-info-sota\">\n                    <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\n                    ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\n                  </div>\n                  ${score > 0 ? `<div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\"><div class=\"score-value\">${score}%</div><div class=\"score-label\">Match</div></div>` : ''}\n                  <button type=\"button\" class=\"btn-select-suggestion\">Assign</button>\n                </div>`;\n              }).join('')}\n            </div>\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>\n          `;\n          ownerSuggestionsPanel.querySelectorAll('.decision-owner-card .btn-select-suggestion').forEach((btn) => {\n            const card = (btn as HTMLElement).closest('.decision-owner-card');\n            const name = card?.getAttribute('data-owner-name') || '';\n            if (!name) return;\n            on(btn as HTMLElement, 'click', async () => {\n              try {\n                const updated = await decisionsService.update(decision.id, { made_by: name });\n                currentOwnerName = name;\n                toast.success(`Owner set to ${name}`);\n                ownerSuggestionsPanel.style.display = 'none';\n                const currentOwnerEl = container.querySelector('#decision-current-owner');\n                if (currentOwnerEl) {\n                  const contact = findContactByOwner(name);\n                  const photoUrl = getContactPhotoUrl(contact);\n                  currentOwnerEl.innerHTML = `\n                    <div class=\"assigned-contact-display\">\n                      <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\">` : getInitials(name)}</div>\n                      <div class=\"contact-details\">\n                        <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\n                        <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\n                      </div>\n                      <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                        Change\n                      </button>\n                    </div>`;\n                  const chBtn = currentOwnerEl.querySelector('#decision-change-owner-btn');\n                  if (chBtn) on(chBtn as HTMLElement, 'click', showOwnerPicker);\n                }\n                if (onUpdate) onUpdate(updated);\n              } catch {\n                toast.error('Failed to save owner');\n              }\n            });\n          });\n        }\n        const hideBtn = ownerSuggestionsPanel.querySelector('#decision-owner-hide-suggest-btn');\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { ownerSuggestionsPanel.style.display = 'none'; });\n      } catch {\n        ownerSuggestionsPanel.innerHTML = '<div class=\"error\">AI suggest failed. <button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>';\n        const h = ownerSuggestionsPanel.querySelector('#decision-owner-hide-suggest-btn');\n        if (h) on(h as HTMLElement, 'click', () => { ownerSuggestionsPanel.style.display = 'none'; });\n        toast.error('AI suggest failed');\n      } finally {\n        (ownerAiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  // AI Suggest (view mode): Rationale section  fetch suggestion, show panel, Apply updates decision\n  const rationaleAiSuggestBtn = container.querySelector('#decision-rationale-ai-suggest-btn');\n  const suggestionsPanel = container.querySelector('#decision-suggestions-panel') as HTMLElement;\n  if (rationaleAiSuggestBtn && suggestionsPanel) {\n    on(rationaleAiSuggestBtn as HTMLElement, 'click', async () => {\n      (rationaleAiSuggestBtn as HTMLButtonElement).disabled = true;\n      suggestionsPanel.style.display = 'block';\n      suggestionsPanel.innerHTML = '<div class=\"loading\">Asking AI</div>';\n      try {\n        const result = await decisionsService.suggest(decision.content || '', decision.rationale || decision.context || '');\n        suggestionsPanel.innerHTML = `\n          <div class=\"suggestion-card\">\n            <p><strong>Rationale:</strong> ${escapeHtml((result.rationale || '').substring(0, 300))}${(result.rationale || '').length > 300 ? '' : ''}</p>\n            <p><strong>Impact:</strong> ${escapeHtml(result.impact || '')} ${result.impact_summary ? ` ${escapeHtml(result.impact_summary)}` : ''}</p>\n            <p><strong>Summary:</strong> ${escapeHtml(result.summary || '')}</p>\n            <button type=\"button\" class=\"btn btn-primary btn-sm\" id=\"decision-apply-suggestion-btn\">Apply</button>\n          </div>`;\n        const applyBtn = suggestionsPanel.querySelector('#decision-apply-suggestion-btn');\n        if (applyBtn) {\n          on(applyBtn as HTMLElement, 'click', async () => {\n            try {\n              const updated = await decisionsService.update(decision.id, {\n                rationale: result.rationale,\n                impact: result.impact,\n                summary: result.summary,\n              });\n              toast.success('Suggestion applied');\n              const viewRationale = container.querySelector('#decision-view-rationale');\n              if (viewRationale) {\n                viewRationale.innerHTML = (updated.rationale || updated.context)\n                  ? `<p class=\"decision-rationale\">${escapeHtml(updated.rationale || updated.context || '')}</p>`\n                  : '<p class=\"text-muted\">No rationale recorded</p>';\n              }\n              const badges = container.querySelector('.decision-badges');\n              if (badges && (updated as Decision).impact) {\n                const impactPill = badges.querySelector('.priority-pill.impact-low, .priority-pill.impact-medium, .priority-pill.impact-high');\n                if (impactPill) impactPill.outerHTML = `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span>`;\n                else badges.insertAdjacentHTML('afterbegin', `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span> `);\n              }\n              if (onUpdate) onUpdate(updated);\n              suggestionsPanel.style.display = 'none';\n            } catch {\n              toast.error('Failed to apply');\n            }\n          });\n        }\n      } catch {\n        suggestionsPanel.innerHTML = '<div class=\"error\">AI suggest failed</div>';\n        toast.error('AI suggest failed');\n      } finally {\n        (rationaleAiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  // AI Suggest (edit form): fill rationale, impact, summary\n  const editAiSuggestBtn = container.querySelector('#decision-edit-ai-suggest-btn');\n  const editSuggestionsPanel = container.querySelector('#decision-edit-suggestions-panel') as HTMLElement;\n  if (editAiSuggestBtn) {\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\n      const contentEl = container.querySelector('#decision-edit-content') as HTMLTextAreaElement;\n      const rationaleEl = container.querySelector('#decision-edit-rationale') as HTMLTextAreaElement;\n      const impactEl = container.querySelector('#decision-edit-impact') as HTMLSelectElement;\n      const summaryEl = container.querySelector('#decision-edit-summary') as HTMLInputElement;\n      const content = contentEl?.value?.trim() || '';\n      if (!content) {\n        toast.warning('Enter decision text first');\n        return;\n      }\n      (editAiSuggestBtn as HTMLButtonElement).disabled = true;\n      if (editSuggestionsPanel) {\n        editSuggestionsPanel.style.display = 'block';\n        editSuggestionsPanel.innerHTML = '<span class=\"text-muted\">Asking AI</span>';\n      }\n      try {\n        const result = await decisionsService.suggest(content, rationaleEl?.value?.trim() || '');\n        if (rationaleEl) rationaleEl.value = result.rationale || '';\n        if (impactEl) impactEl.value = result.impact || 'medium';\n        if (summaryEl) summaryEl.value = result.summary || '';\n        if (editSuggestionsPanel) {\n          editSuggestionsPanel.style.display = 'none';\n          editSuggestionsPanel.innerHTML = '';\n        }\n        toast.success('Suggestion applied');\n      } catch {\n        if (editSuggestionsPanel) {\n          editSuggestionsPanel.innerHTML = '<span class=\"error\">AI suggest failed</span>';\n        }\n        toast.error('AI suggest failed');\n      } finally {\n        (editAiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  const timelineEl = container.querySelector('#decision-timeline-list');\n  if (timelineEl) {\n    decisionsService.getEvents(decision.id).then((events) => {\n      const labels: Record<string, string> = {\n        created: 'Created',\n        updated: 'Updated',\n        conflict_detected: 'Conflict detected',\n        deleted: 'Deleted',\n        restored: 'Restored',\n      };\n      const actorLabel = (ev: { actor_name?: string; event_data?: { trigger?: string } }) =>\n        ev.actor_name || (ev.event_data?.trigger === 'decision_check_flow' ? 'System' : null);\n      if (events.length === 0) {\n        (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No events yet</span>';\n        return;\n      }\n      (timelineEl as HTMLElement).innerHTML = events\n        .map((ev) => {\n          const actor = actorLabel(ev);\n          return `<div class=\"decision-timeline-item decision-event-${escapeHtml(ev.event_type)}\">\n            <span class=\"decision-event-type\">${escapeHtml(labels[ev.event_type] || ev.event_type)}</span>\n            ${actor ? `<span class=\"decision-event-actor\">${escapeHtml(actor)}</span>` : ''}\n            <span class=\"decision-event-date\">${formatRelativeTime(ev.created_at)}</span>\n          </div>`;\n        })\n        .join('');\n    }).catch(() => {\n      (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load timeline</span>';\n    });\n  }\n\n  const similarEl = container.querySelector('#decision-similar-list');\n  if (similarEl) {\n    decisionsService.getSimilarDecisions(decision.id, 10).then((similar) => {\n      if (similar.length === 0) {\n        (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No similar decisions</span>';\n        return;\n      }\n      (similarEl as HTMLElement).innerHTML = similar\n        .map((s) => `\n          <div class=\"decision-similar-item\" data-decision-id=\"${s.decision.id}\" role=\"${onDecisionClick ? 'button' : 'none'}\">\n            <span class=\"decision-similar-score\">${Math.round(s.similarityScore * 100)}%</span>\n            <span class=\"decision-similar-content\">${escapeHtml((s.decision.content || '').substring(0, 80))}${(s.decision.content || '').length > 80 ? '' : ''}</span>\n          </div>\n        `)\n        .join('');\n      if (onDecisionClick) {\n        (similarEl as HTMLElement).querySelectorAll('.decision-similar-item').forEach((el) => {\n          on(el as HTMLElement, 'click', () => {\n            const item = similar.find((s) => String(s.decision.id) === (el as HTMLElement).getAttribute('data-decision-id'));\n            if (item) onDecisionClick(item.decision);\n          });\n        });\n      }\n    }).catch(() => {\n      (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load similar decisions</span>';\n    });\n  }\n\n  return container;\n}\n","/**\n * Decisions Panel Component\n * Displays and manages decisions with conflict detection, filters, detail view, and removed section\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { decisionsService, Decision, DecisionConflict } from '../../services/decisions';\nimport { dataStore } from '../../stores/data';\nimport { showDecisionModal } from '../modals/DecisionModal';\nimport { createDecisionDetailView, DecisionDetailViewProps } from '../decisions/DecisionDetailView';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\n/** Build DecisionDetailView props with onDecisionClick so similar-decision clicks open that decision in the same container */\nfunction decisionDetailProps(containerEl: HTMLElement, props: DecisionsPanelProps, decision: Decision): DecisionDetailViewProps {\n  return {\n    decision,\n    onClose: () => {\n      containerEl.innerHTML = '';\n      containerEl.appendChild(createDecisionsPanel(props));\n    },\n    onUpdate: () => {\n      containerEl.innerHTML = '';\n      containerEl.appendChild(createDecisionsPanel(props));\n    },\n    onDecisionClick: (clickedDecision) => {\n      containerEl.innerHTML = '';\n      containerEl.appendChild(createDecisionDetailView(decisionDetailProps(containerEl, props, clickedDecision)));\n    },\n  };\n}\n\nexport interface DecisionsPanelProps {\n  onDecisionClick?: (decision: Decision) => void;\n  useDetailView?: boolean;\n  containerElement?: HTMLElement;\n}\n\nlet currentFilter: string = 'all';\nlet currentSearch: string = '';\nlet currentView: 'status' | 'source' = 'status';\n\n/**\n * Create decisions panel\n */\nexport function createDecisionsPanel(props: DecisionsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'sot-panel decisions-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Decisions</h2>\n        <span class=\"panel-count\" id=\"decisions-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <select id=\"decisions-filter\" class=\"filter-select\">\n          <option value=\"all\">All</option>\n          <option value=\"proposed\">Proposed</option>\n          <option value=\"approved\">Approved</option>\n          <option value=\"rejected\">Rejected</option>\n          <option value=\"deferred\">Deferred</option>\n          <option value=\"active\">Active</option>\n          <option value=\"superseded\">Superseded</option>\n          <option value=\"revoked\">Revoked</option>\n        </select>\n        <div class=\"view-tabs\">\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\n        </div>\n        <input type=\"search\" id=\"decisions-search\" class=\"search-input\" placeholder=\"Search decisions...\" title=\"Search\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"check-conflicts-btn\" title=\"Check for conflicting decisions\">Check Conflicts</button>\n        <button class=\"btn btn-primary btn-sm\" id=\"add-decision-btn\">+ Add</button>\n      </div>\n    </div>\n    <div id=\"conflicts-container\" class=\"conflicts-container\" style=\"display: none;\"></div>\n    <div class=\"panel-content\" id=\"decisions-content\">\n      <div class=\"loading\">Loading decisions...</div>\n    </div>\n    <div id=\"removed-decisions-container\" class=\"removed-decisions-container\" style=\"display: none;\"></div>\n  `;\n\n  const filterSelect = panel.querySelector('#decisions-filter') as HTMLSelectElement;\n  on(filterSelect, 'change', () => {\n    currentFilter = filterSelect.value;\n    loadDecisions(panel, props);\n  });\n\n  const viewTabs = panel.querySelectorAll('.view-tab');\n  viewTabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      viewTabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentView = tab.getAttribute('data-view') as 'status' | 'source';\n      loadDecisions(panel, props);\n    });\n  });\n\n  const searchInput = panel.querySelector('#decisions-search') as HTMLInputElement;\n  let searchTimeout: number;\n  on(searchInput, 'input', () => {\n    clearTimeout(searchTimeout);\n    searchTimeout = window.setTimeout(() => {\n      currentSearch = searchInput.value.trim();\n      loadDecisions(panel, props);\n    }, 300);\n  });\n\n  const checkConflictsBtn = panel.querySelector('#check-conflicts-btn');\n  if (checkConflictsBtn) {\n    on(checkConflictsBtn as HTMLElement, 'click', async () => {\n      const container = panel.querySelector('#conflicts-container') as HTMLElement;\n      await checkConflicts(container, panel, props);\n    });\n  }\n\n  const addBtn = panel.querySelector('#add-decision-btn');\n  if (addBtn) {\n    on(addBtn as HTMLElement, 'click', () => {\n      showDecisionModal({\n        mode: 'create',\n        onSave: () => {\n          loadDecisions(panel, props);\n          refreshRemovedSection(panel, props);\n        },\n      });\n    });\n  }\n\n  loadDecisions(panel, props);\n  refreshRemovedSection(panel, props);\n\n  return panel;\n}\n\nasync function checkConflicts(container: HTMLElement, panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\n  container.style.display = 'block';\n  container.innerHTML = '<div class=\"loading\">Checking for conflicts...</div>';\n  try {\n    const result = await decisionsService.runDecisionCheck();\n    const conflicts = result.conflicts || [];\n    if (conflicts.length === 0) {\n      container.innerHTML = `\n        <div class=\"no-conflicts\">\n          <span class=\"success-icon\"></span>\n          <p>No conflicts detected</p>\n        </div>\n      `;\n      return;\n    }\n    container.innerHTML = conflicts.map((c: DecisionConflict) => createConflictCard(c, panel, props)).join('');\n    bindConflictCards(container, panel, props);\n  } catch {\n    container.innerHTML = '<div class=\"error\">Failed to check conflicts</div>';\n  }\n}\n\nfunction createConflictCard(c: DecisionConflict, panel: HTMLElement, props: DecisionsPanelProps): string {\n  const d1 = c.decision1;\n  const d2 = c.decision2;\n  const desc = (c.description || c.reason || 'Conflict').substring(0, 200);\n  return `\n    <div class=\"conflict-card-sota\" data-decision-id1=\"${d1.id}\" data-decision-id2=\"${d2.id}\">\n      <div class=\"conflict-card-priority-bar\" style=\"background: var(--warning);\"></div>\n      <div class=\"conflict-card-body\">\n        <div class=\"conflict-card-header\">\n          <span class=\"conflict-type-badge\">Conflict</span>\n          <p class=\"conflict-description\">${escapeHtml(desc)}</p>\n        </div>\n        <div class=\"conflict-pair\">\n          <div class=\"conflict-item\">\n            <div class=\"conflict-item-content\">${escapeHtml((d1.content || '').substring(0, 120))}${(d1.content || '').length > 120 ? '' : ''}</div>\n            <button type=\"button\" class=\"btn btn-sm conflict-keep-btn\" data-keep-id=\"${d1.id}\" data-discard-id=\"${d2.id}\">Keep this</button>\n          </div>\n          <div class=\"conflict-vs\">vs</div>\n          <div class=\"conflict-item\">\n            <div class=\"conflict-item-content\">${escapeHtml((d2.content || '').substring(0, 120))}${(d2.content || '').length > 120 ? '' : ''}</div>\n            <button type=\"button\" class=\"btn btn-sm conflict-keep-btn\" data-keep-id=\"${d2.id}\" data-discard-id=\"${d1.id}\">Keep this</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction bindConflictCards(container: HTMLElement, panel: HTMLElement, props: DecisionsPanelProps): void {\n  container.querySelectorAll('.conflict-keep-btn').forEach((btn) => {\n    on(btn as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const keepId = (btn as HTMLElement).getAttribute('data-keep-id');\n      const discardId = (btn as HTMLElement).getAttribute('data-discard-id');\n      if (!keepId || !discardId) return;\n      try {\n        await decisionsService.delete(discardId);\n        await decisionsService.runDecisionCheck();\n        await decisionsService.update(keepId, { status: 'approved' as const });\n        toast.success('Conflict resolved');\n        loadDecisions(panel, props);\n        await checkConflicts(container, panel, props);\n        refreshRemovedSection(panel, props);\n      } catch {\n        toast.error('Failed to resolve conflict');\n      }\n    });\n  });\n}\n\nasync function refreshRemovedSection(panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\n  const container = panel.querySelector('#removed-decisions-container') as HTMLElement;\n  if (!container) return;\n  try {\n    const deleted = await decisionsService.getDeletedDecisions();\n    if (deleted.length === 0) {\n      container.style.display = 'none';\n      container.innerHTML = '';\n      return;\n    }\n    container.style.display = 'block';\n    container.innerHTML = `\n      <div class=\"removed-decisions-section\">\n        <div class=\"removed-decisions-header section-header-sota\">\n          <h3>Removed decisions</h3>\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\n        </div>\n        <p class=\"removed-decisions-hint\">Restore to undo a conflict resolution; decision will be synced back to the graph.</p>\n        <div class=\"removed-decisions-list\">\n          ${deleted.map((d) => `\n            <div class=\"removed-decision-item\" data-decision-id=\"${d.id}\">\n              <div class=\"removed-decision-content\">${escapeHtml(truncate(d.content ?? '', 100))}</div>\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    `;\n    container.querySelectorAll('.conflict-resolve-restore').forEach((restoreBtn) => {\n      on(restoreBtn as HTMLElement, 'click', async () => {\n        const id = (restoreBtn as HTMLElement).closest('.removed-decision-item')?.getAttribute('data-decision-id');\n        if (!id) return;\n        try {\n          await decisionsService.restore(id);\n          toast.success('Decision restored');\n          loadDecisions(panel, props);\n          refreshRemovedSection(panel, props);\n        } catch {\n          toast.error('Failed to restore decision');\n        }\n      });\n    });\n  } catch {\n    container.style.display = 'none';\n    container.innerHTML = '';\n  }\n}\n\nfunction truncate(s: string, len: number): string {\n  if (s.length <= len) return s;\n  return s.substring(0, len) + '';\n}\n\n/**\n * Filter decisions by search (client-side)\n */\nfunction filterDecisionsBySearch(decisions: Decision[], q: string): Decision[] {\n  if (!q) return decisions;\n  const lower = q.toLowerCase();\n  return decisions.filter(\n    d =>\n      (d.content || '').toLowerCase().includes(lower) ||\n      (d.rationale || '').toLowerCase().includes(lower) ||\n      (d.made_by || '').toLowerCase().includes(lower) ||\n      (d.source_file || '').toLowerCase().includes(lower)\n  );\n}\n\n/**\n * Load decisions\n */\nasync function loadDecisions(panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\n  const content = panel.querySelector('#decisions-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const status = currentFilter === 'all' ? undefined : currentFilter;\n    const raw = await decisionsService.getAll(status);\n    const decisions = filterDecisionsBySearch(raw, currentSearch);\n\n    if (currentView === 'source') {\n      renderDecisionsBySource(content, decisions, props);\n    } else {\n      renderDecisions(content, decisions, props);\n    }\n    dataStore.setDecisions(raw as unknown as []);\n    updateCount(panel, decisions.length);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load decisions</div>';\n  }\n}\n\n/**\n * Render decisions list (grouped by status when multiple statuses)\n */\nfunction renderDecisions(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\n  if (decisions.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>${currentSearch ? 'No decisions match your search' : 'No decisions found'}</p>\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Decision</button>\n      </div>\n    `;\n    const addBtn = container.querySelector('#empty-add-btn');\n    if (addBtn) {\n      on(addBtn as HTMLElement, 'click', () => {\n        showDecisionModal({ mode: 'create', onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props) });\n      });\n    }\n    return;\n  }\n\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\n  const byStatus: Record<string, Decision[]> = {};\n  decisions.forEach(d => {\n    const s = (d.status || 'active').toLowerCase();\n    if (!byStatus[s]) byStatus[s] = [];\n    byStatus[s].push(d);\n  });\n  const statuses = Object.keys(byStatus);\n\n  if (statuses.length > 1) {\n    container.innerHTML = statuses.map(status => `\n      <div class=\"question-group\">\n        <div class=\"group-header\">\n          <h3>${escapeHtml(status)}</h3>\n          <span class=\"group-count\">${byStatus[status].length}</span>\n        </div>\n        <div class=\"group-items\">\n          ${byStatus[status].map(d => createDecisionCard(d, contacts)).join('')}\n        </div>\n      </div>\n    `).join('');\n  } else {\n    container.innerHTML = decisions.map(d => createDecisionCard(d, contacts)).join('');\n  }\n\n  bindDecisionCards(container, decisions, props);\n}\n\n/**\n * Render decisions grouped by source\n */\nfunction renderDecisionsBySource(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\n  if (decisions.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>${currentSearch ? 'No decisions match your search' : 'No decisions found'}</p>\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Decision</button>\n      </div>\n    `;\n    const addBtn = container.querySelector('#empty-add-btn');\n    if (addBtn) {\n      on(addBtn as HTMLElement, 'click', () => {\n        showDecisionModal({ mode: 'create', onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props) });\n      });\n    }\n    return;\n  }\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\n  const bySource: Record<string, Decision[]> = {};\n  decisions.forEach(d => {\n    const src = d.source_file || d.source || 'Unknown source';\n    if (!bySource[src]) bySource[src] = [];\n    bySource[src].push(d);\n  });\n  container.innerHTML = Object.entries(bySource).map(([source, list]) => `\n    <div class=\"question-group\">\n      <div class=\"group-header\">\n        <h3>${escapeHtml(source)}</h3>\n        <span class=\"group-count\">${list.length}</span>\n      </div>\n      <div class=\"group-items\">\n        ${list.map(d => createDecisionCard(d, contacts)).join('')}\n      </div>\n    </div>\n  `).join('');\n\n  bindDecisionCards(container, decisions, props);\n}\n\nfunction bindDecisionCards(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\n  container.querySelectorAll('.decision-card-sota').forEach((card) => {\n    on(card as HTMLElement, 'click', (e) => {\n      if ((e.target as HTMLElement).closest('.card-actions')) return;\n      const id = card.getAttribute('data-id');\n      const decision = decisions.find((d) => String(d.id) === id);\n      if (!decision) return;\n      if (props.useDetailView && props.containerElement) {\n        const containerEl = props.containerElement;\n        containerEl.innerHTML = '';\n        containerEl.appendChild(createDecisionDetailView(decisionDetailProps(containerEl, props, decision)));\n      } else if (props.onDecisionClick) {\n        props.onDecisionClick(decision);\n      } else {\n        showDecisionModal({\n          mode: 'edit',\n          decision: { ...decision, decision: decision.content, madeBy: decision.made_by, madeAt: decision.created_at },\n          onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props),\n        });\n      }\n    });\n\n    const approveBtn = card.querySelector('.approve-btn');\n    const rejectBtn = card.querySelector('.reject-btn');\n    const id = card.getAttribute('data-id');\n\n    if (approveBtn && id) {\n      on(approveBtn as HTMLElement, 'click', async (e) => {\n        e.stopPropagation();\n        try {\n          await decisionsService.approve(id, 'Current User');\n          loadDecisions(container.closest('.decisions-panel') as HTMLElement, props);\n        } catch {\n          // no-op\n        }\n      });\n    }\n    if (rejectBtn && id) {\n      on(rejectBtn as HTMLElement, 'click', async (e) => {\n        e.stopPropagation();\n        try {\n          await decisionsService.reject(id);\n          loadDecisions(container.closest('.decisions-panel') as HTMLElement, props);\n        } catch {\n          // no-op\n        }\n      });\n    }\n  });\n}\n\n/** Status bar color (left edge) - align with fact category bar */\nconst STATUS_BAR_COLOR: Record<string, string> = {\n  proposed: '#f59e0b',\n  approved: '#10b981',\n  rejected: '#ef4444',\n  deferred: '#6b7280',\n  active: '#3b82f6',\n  superseded: '#8b5cf6',\n  revoked: '#6b7280',\n};\n\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\n\nfunction findContactByOwner(contacts: ContactLike[], name: string): ContactLike | undefined {\n  if (!name || !contacts.length) return undefined;\n  const n = name.trim().toLowerCase();\n  if (!n) return undefined;\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n  if (byExact) return byExact;\n  const byPartial = contacts.find(\n    (c) =>\n      (c.name || '').trim().toLowerCase().includes(n) ||\n      n.includes((c.name || '').trim().toLowerCase())\n  );\n  if (byPartial) return byPartial;\n  const byAlias = contacts.find((c) =>\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n  );\n  return byAlias || contacts.find((c) =>\n    (c.aliases || []).some((a) => {\n      const aLower = String(a).trim().toLowerCase();\n      return aLower.includes(n) || n.includes(aLower);\n    })\n  );\n}\n\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\n  if (!c) return null;\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\n}\n\nfunction getInitials(name: string): string {\n  if (!name) return '?';\n  const parts = name.trim().split(/\\s+/);\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\n}\n\nfunction createDecisionCard(decision: Decision, contacts: ContactLike[]): string {\n  const status = (decision.status || 'active').toLowerCase();\n  const statusClass = status.replace(/\\s+/g, '-');\n  const barColor = STATUS_BAR_COLOR[status] ?? STATUS_BAR_COLOR.active;\n  const content = decision.content || '';\n  const source = decision.source_file || decision.source || '';\n  const owner = decision.made_by || (decision as { owner?: string }).owner || '';\n  const contact = owner ? findContactByOwner(contacts, owner) : undefined;\n  const photoUrl = getContactPhotoUrl(contact);\n  const ownerChipHtml = owner\n    ? `\n        <div class=\"assignee-chip\">\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(owner)}\" onerror=\"this.parentElement.innerHTML='${getInitials(owner)}'\">` : getInitials(owner)}</div>\n          <div class=\"assignee-info\">\n            <span class=\"assignee-name\">${escapeHtml(owner)}</span>\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\n          </div>\n        </div>\n      `\n    : '<span class=\"card-owner-placeholder text-muted\">No owner</span>';\n  const sourceChip = source ? `<span class=\"card-source-chip\">${escapeHtml(source.substring(0, 40))}${source.length > 40 ? '' : ''}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>';\n\n  return `\n    <div class=\"decision-card-sota question-card-sota\" data-id=\"${decision.id}\" style=\"--decision-status-bar: ${barColor}\">\n      <div class=\"card-priority-bar decision-status-bar\" style=\"background: ${barColor}\"></div>\n      <div class=\"card-body\">\n        <div class=\"card-top-row\">\n          <div class=\"card-badges\">\n            <span class=\"priority-pill status-${statusClass}\">${escapeHtml(String(decision.status))}</span>\n            ${decision.impact ? `<span class=\"status-pill\">${escapeHtml(decision.impact)} impact</span>` : ''}\n          </div>\n          <span class=\"card-timestamp\">${formatRelativeTime(decision.decided_at || decision.created_at)}</span>\n        </div>\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\n        ${(decision as any).summary ? `<div class=\"card-summary text-muted\">${escapeHtml((decision as any).summary)}</div>` : ''}\n        ${decision.rationale ? `<div class=\"card-rationale text-muted\">${escapeHtml((decision.rationale || '').substring(0, 100))}${(decision.rationale || '').length > 100 ? '' : ''}</div>` : ''}\n        <div class=\"card-bottom-row\">\n          <div class=\"card-requester\">\n            ${sourceChip}\n            ${ownerChipHtml}\n          </div>\n          <div class=\"card-assignment\">\n            ${decision.status === 'proposed' || decision.status === 'active'\n              ? `<span class=\"card-actions\"><button type=\"button\" class=\"btn btn-sm btn-success approve-btn\">Approve</button><button type=\"button\" class=\"btn btn-sm btn-danger reject-btn\">Reject</button></span>`\n              : '<button type=\"button\" class=\"btn-link decision-view-link\">View</button>'}\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#decisions-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createDecisionsPanel;\n","/**\n * Fact Detail View\n * Full-page view for fact details: content, category, confidence, source, verified, document link\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { Fact, factsService } from '../../services/facts';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\n\nexport interface FactDetailViewProps {\n  fact: Fact;\n  onClose: () => void;\n  onUpdate?: (fact: Fact) => void;\n  /** When user clicks a similar fact, open that fact (e.g. replace view) */\n  onFactClick?: (fact: Fact) => void;\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nfunction formatDate(iso: string | undefined): string {\n  if (!iso) return '';\n  try {\n    return formatDateTime(iso);\n  } catch {\n    return iso;\n  }\n}\n\n/**\n * Create and show the fact detail view\n */\nexport function createFactDetailView(props: FactDetailViewProps): HTMLElement {\n  const { fact, onClose, onUpdate, onFactClick } = props;\n\n  const container = createElement('div', { className: 'fact-detail-view question-detail-view' });\n\n  container.innerHTML = `\n    <div class=\"question-detail-header fact-detail-header\">\n      <div class=\"breadcrumb\">\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Facts</a>\n        <span class=\"breadcrumb-separator\"></span>\n        <span class=\"breadcrumb-current\">Fact #${String(fact.id).substring(0, 8)}</span>\n      </div>\n      <div class=\"header-actions\">\n        ${fact.verified ? '<span class=\"verified-badge detail sla-badge\" style=\"background:var(--success);color:white\"> Verified</span>' : ''}\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\n      </div>\n    </div>\n\n    <div class=\"question-detail-content fact-detail-content\">\n      <section class=\"detail-section question-main fact-main\">\n        <div class=\"question-badges fact-badges\">\n          ${fact.category ? `<span class=\"priority-pill category-${(fact.category || 'general').toLowerCase().replace(/\\s+/g, '-')}\">${escapeHtml(fact.category)}</span>` : ''}\n          ${fact.confidence != null ? `<span class=\"status-pill status-pending\">${Math.round((fact.confidence ?? 0) * 100)}%</span>` : ''}\n          ${fact.verified ? '<span class=\"auto-pill\"> Verified</span>' : ''}\n          <span class=\"question-date fact-date\">Created ${formatRelativeTime(fact.created_at)}</span>\n        </div>\n        <h2 class=\"question-text fact-content-text\">${escapeHtml(fact.content)}</h2>\n      </section>\n\n      <div class=\"detail-columns\">\n        <div class=\"detail-column-left\">\n          <section class=\"detail-section\">\n            <div class=\"section-header\">\n              <h3>Source</h3>\n            </div>\n            ${fact.source_file ? `<p class=\"source-file\">${escapeHtml(fact.source_file)}</p>` : ''}\n            ${fact.source ? `<p class=\"source-ref\">${escapeHtml(fact.source)}</p>` : ''}\n            ${fact.source_document_id ? `\n              <p class=\"source-doc\">\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(fact.source_document_id))}\">View source document</a>\n              </p>\n            ` : ''}\n            ${!fact.source && !fact.source_file && !fact.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\n          </section>\n\n          <section class=\"detail-section verification-section\">\n            <div class=\"section-header\">\n              <h3>Verification</h3>\n            </div>\n            ${fact.verified\n              ? `\n              <div class=\"verified-info\">\n                <span class=\"verified-badge auto-pill\"> Verified</span>\n                ${fact.verified_at ? `<span class=\"text-muted\">on ${formatDate(fact.verified_at)}</span>` : ''}\n              </div>\n            `\n              : `\n              <div class=\"unverified-info\">\n                <p class=\"text-muted\">This fact has not been verified.</p>\n                <button type=\"button\" class=\"btn btn-success btn-sm\" id=\"verify-fact-btn\">Verify</button>\n              </div>\n            `}\n          </section>\n        </div>\n\n        <div class=\"detail-column-right\">\n          <section class=\"detail-section metadata-section\">\n            <div class=\"section-header\">\n              <h3>Metadata</h3>\n            </div>\n            <dl class=\"metadata-list\">\n              <dt>Created</dt>\n              <dd>${formatDate(fact.created_at)}</dd>\n              ${fact.updated_at ? `<dt>Updated</dt><dd>${formatDate(fact.updated_at)}</dd>` : ''}\n            </dl>\n          </section>\n\n          <section class=\"detail-section fact-timeline-section\">\n            <div class=\"section-header\">\n              <h3>Timeline</h3>\n            </div>\n            <div id=\"fact-timeline-list\" class=\"fact-timeline-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n\n          <section class=\"detail-section fact-similar-section\">\n            <div class=\"section-header\">\n              <h3>Similar facts</h3>\n            </div>\n            <div id=\"fact-similar-list\" class=\"fact-similar-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n        </div>\n      </div>\n\n      <div class=\"detail-actions\">\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-fact-btn\">Edit</button>\n        ${!fact.verified ? '<button type=\"button\" class=\"btn btn-success\" id=\"verify-btn\">Verify</button>' : ''}\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-fact-btn\">Delete</button>\n      </div>\n    </div>\n  `;\n\n  // Back / Close\n  const backLink = container.querySelector('#back-to-list');\n  if (backLink) {\n    on(backLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      onClose();\n    });\n  }\n  const closeBtn = container.querySelector('#close-detail');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', onClose);\n  }\n\n  // Verify (header or section)\n  const verifyFactBtn = container.querySelector('#verify-fact-btn');\n  if (verifyFactBtn) {\n    on(verifyFactBtn as HTMLElement, 'click', async () => {\n      try {\n        const updated = await factsService.verify(fact.id);\n        toast.success('Fact verified');\n        if (onUpdate) onUpdate(updated);\n        onClose();\n      } catch {\n        toast.error('Failed to verify fact');\n      }\n    });\n  }\n  const verifyBtn = container.querySelector('#verify-btn');\n  if (verifyBtn) {\n    on(verifyBtn as HTMLElement, 'click', async () => {\n      try {\n        const updated = await factsService.verify(fact.id);\n        toast.success('Fact verified');\n        if (onUpdate) onUpdate(updated);\n        onClose();\n      } catch {\n        toast.error('Failed to verify fact');\n      }\n    });\n  }\n\n  // Edit\n  const editBtn = container.querySelector('#edit-fact-btn');\n  if (editBtn) {\n    on(editBtn as HTMLElement, 'click', () => {\n      import('../modals/FactModal').then(({ showFactModal }) => {\n        showFactModal({\n          mode: 'edit',\n          fact,\n          onSave: (updated) => {\n            if (onUpdate) onUpdate(updated);\n            onClose();\n          },\n        });\n      });\n    });\n  }\n\n  // Delete\n  const deleteBtn = container.querySelector('#delete-fact-btn');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this fact?')) return;\n      try {\n        await factsService.delete(fact.id);\n        toast.success('Fact deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete fact');\n      }\n    });\n  }\n\n  // Document link (navigate to files / document preview if implemented)\n  const docLink = container.querySelector('.doc-link');\n  if (docLink && fact.source_document_id) {\n    on(docLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\n        detail: { tab: 'files', documentId: fact.source_document_id }\n      }));\n    });\n  }\n\n  // Load timeline (fact events)\n  const timelineEl = container.querySelector('#fact-timeline-list');\n  if (timelineEl) {\n    factsService.getEvents(fact.id).then((events) => {\n      const labels: Record<string, string> = {\n        created: 'Created',\n        verified: 'Verified',\n        updated: 'Updated',\n        conflict_detected: 'Conflict detected',\n        deleted: 'Deleted',\n        restored: 'Restored',\n      };\n      const actorLabel = (ev: { actor_name?: string; event_data?: { trigger?: string } }) =>\n        ev.actor_name || (ev.event_data?.trigger === 'fact_check_flow' ? 'System' : null);\n      if (events.length === 0) {\n        (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No events yet</span>';\n        return;\n      }\n      (timelineEl as HTMLElement).innerHTML = events\n        .map(\n          (ev) => {\n            const actor = actorLabel(ev);\n            return `<div class=\"fact-timeline-item fact-event-${escapeHtml(ev.event_type)}\">\n              <span class=\"fact-event-type\">${escapeHtml(labels[ev.event_type] || ev.event_type)}</span>\n              ${actor ? `<span class=\"fact-event-actor\">${escapeHtml(actor)}</span>` : ''}\n              <span class=\"fact-event-date\">${formatRelativeTime(ev.created_at)}</span>\n            </div>`;\n          }\n        )\n        .join('');\n    }).catch(() => {\n      (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load timeline</span>';\n    });\n  }\n\n  // Load similar facts\n  const similarEl = container.querySelector('#fact-similar-list');\n  if (similarEl) {\n    factsService.getSimilarFacts(fact.id, 10).then((similar) => {\n      if (similar.length === 0) {\n        (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No similar facts</span>';\n        return;\n      }\n      (similarEl as HTMLElement).innerHTML = similar\n        .map(\n          (s) => `\n            <div class=\"fact-similar-item\" data-fact-id=\"${s.fact.id}\" role=\"${onFactClick ? 'button' : 'none'}\">\n              <span class=\"fact-similar-score\">${Math.round(s.similarityScore * 100)}%</span>\n              <span class=\"fact-similar-content\">${escapeHtml((s.fact.content || '').substring(0, 80))}${(s.fact.content || '').length > 80 ? '' : ''}</span>\n            </div>\n          `\n        )\n        .join('');\n      if (onFactClick) {\n        (similarEl as HTMLElement).querySelectorAll('.fact-similar-item').forEach((el) => {\n          on(el as HTMLElement, 'click', () => {\n            const item = similar.find((s) => String(s.fact.id) === (el as HTMLElement).getAttribute('data-fact-id'));\n            if (item) onFactClick(item.fact);\n          });\n        });\n      }\n    }).catch(() => {\n      (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load similar facts</span>';\n    });\n  }\n\n  return container;\n}\n","/**\n * Facts Panel Component\n * Displays and manages facts with conflict detection, filters, and detail view\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { factsService, Fact, FactConflict } from '../../services/facts';\nimport { createFactDetailView, FactDetailViewProps } from '../facts/FactDetailView';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nconst CATEGORIES = ['technical', 'process', 'policy', 'people', 'timeline', 'general'] as const;\n\n/** Build FactDetailView props with onFactClick so similar-fact clicks open that fact in the same container */\nfunction factDetailProps(containerEl: HTMLElement, props: FactsPanelProps, fact: Fact): FactDetailViewProps {\n  return {\n    fact,\n    onClose: () => {\n      containerEl.innerHTML = '';\n      containerEl.appendChild(createFactsPanel(props));\n    },\n    onUpdate: () => {\n      containerEl.innerHTML = '';\n      containerEl.appendChild(createFactsPanel(props));\n    },\n    onFactClick: (clickedFact) => {\n      containerEl.innerHTML = '';\n      containerEl.appendChild(createFactDetailView(factDetailProps(containerEl, props, clickedFact)));\n    },\n  };\n}\n\nexport interface FactsPanelProps {\n  onFactClick?: (fact: Fact) => void;\n  useDetailView?: boolean;\n  containerElement?: HTMLElement;\n}\n\nlet currentSearch: string = '';\nlet currentFilter: string = 'all';\nlet currentView: 'category' | 'source' = 'category';\nlet showConflicts: boolean = false;\n\n/**\n * Create facts panel\n */\nexport function createFactsPanel(props: FactsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'sot-panel facts-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Facts</h2>\n        <span class=\"panel-count\" id=\"facts-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <select id=\"facts-filter\" class=\"filter-select\">\n          <option value=\"all\">All</option>\n          <option value=\"verified\"> Verified</option>\n          <option value=\"unverified\">Unverified</option>\n          <option value=\"technical\">Technical</option>\n          <option value=\"process\">Process</option>\n          <option value=\"policy\">Policy</option>\n          <option value=\"people\">People</option>\n          <option value=\"timeline\">Timeline</option>\n          <option value=\"general\">General</option>\n        </select>\n        <div class=\"view-tabs\">\n          <button class=\"view-tab active\" data-view=\"category\">By Category</button>\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\n        </div>\n        <input type=\"search\" id=\"facts-search\" class=\"search-input\" placeholder=\"Search facts...\" title=\"Search\">\n        <button class=\"btn btn-secondary btn-sm\" id=\"check-conflicts-btn\" title=\"Check for conflicting facts\">Check Conflicts</button>\n        <button class=\"btn btn-primary btn-sm\" id=\"add-fact-btn\">+ Add</button>\n      </div>\n    </div>\n    <div id=\"conflicts-container\" class=\"conflicts-container\" style=\"display: none;\"></div>\n    <div class=\"panel-content\" id=\"facts-content\">\n      <div class=\"loading\">Loading facts...</div>\n    </div>\n    <div id=\"removed-facts-container\" class=\"removed-facts-container\" style=\"display: none;\"></div>\n  `;\n\n  // Filter\n  const filterSelect = panel.querySelector('#facts-filter') as HTMLSelectElement;\n  if (filterSelect) {\n    on(filterSelect, 'change', () => {\n      currentFilter = filterSelect.value;\n      loadFacts(panel, props);\n    });\n  }\n\n  // View tabs\n  const viewTabs = panel.querySelectorAll('.view-tab');\n  viewTabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      viewTabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentView = tab.getAttribute('data-view') as 'category' | 'source';\n      loadFacts(panel, props);\n    });\n  });\n\n  // Search\n  const searchInput = panel.querySelector('#facts-search') as HTMLInputElement;\n  let searchTimeout: number;\n  on(searchInput, 'input', () => {\n    clearTimeout(searchTimeout);\n    searchTimeout = window.setTimeout(() => {\n      currentSearch = searchInput.value;\n      loadFacts(panel, props);\n    }, 300);\n  });\n\n  const conflictsBtn = panel.querySelector('#check-conflicts-btn');\n  if (conflictsBtn) {\n    on(conflictsBtn as HTMLElement, 'click', async () => {\n      const container = panel.querySelector('#conflicts-container') as HTMLElement;\n      await checkConflicts(container, panel, props);\n    });\n  }\n\n  const addBtn = panel.querySelector('#add-fact-btn');\n  if (addBtn) {\n    on(addBtn as HTMLElement, 'click', () => {\n      showAddFactModal(panel, props);\n    });\n  }\n\n  // Initial load (loadFacts calls refreshRemovedFactsSection at end)\n  loadFacts(panel, props);\n\n  return panel;\n}\n\n/**\n * Load facts\n */\nasync function loadFacts(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\n  const content = panel.querySelector('#facts-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const categoryFilter = CATEGORIES.includes(currentFilter as typeof CATEGORIES[number])\n      ? currentFilter\n      : undefined;\n\n    const { facts: rawFacts, total } = await factsService.getAll({\n      search: currentSearch || undefined,\n      limit: 500,\n      category: categoryFilter,\n    });\n\n    // Client-side filter for verified/unverified (API may not support these params)\n    const facts =\n      currentFilter === 'verified' ? rawFacts.filter(f => f.verified) :\n      currentFilter === 'unverified' ? rawFacts.filter(f => !f.verified) :\n      rawFacts;\n\n    if (currentView === 'source') {\n      renderFactsBySource(content, facts, props);\n    } else {\n      renderFacts(content, facts, props);\n    }\n    updateCount(panel, facts.length);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load facts</div>';\n  }\n  await refreshRemovedFactsSection(panel, props);\n}\n\n/**\n * Load and render the \"Removed facts\" section (for restore / undo). Syncs with graph/FalkorDB on restore.\n */\nasync function refreshRemovedFactsSection(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\n  const container = panel.querySelector('#removed-facts-container') as HTMLElement;\n  if (!container) return;\n  try {\n    const deleted = await factsService.getDeletedFacts();\n    if (deleted.length === 0) {\n      container.style.display = 'none';\n      container.innerHTML = '';\n      return;\n    }\n    container.style.display = 'block';\n    container.innerHTML = `\n      <div class=\"removed-facts-section\">\n        <div class=\"removed-facts-header section-header-sota\">\n          <h3>Removed facts</h3>\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\n        </div>\n        <p class=\"removed-facts-hint\">Restore to undo a conflict resolution; fact will be synced back to the graph.</p>\n        <div class=\"removed-facts-list\">\n          ${deleted.map(f => `\n            <div class=\"removed-fact-item\" data-fact-id=\"${f.id}\">\n              <div class=\"removed-fact-content\">${escapeHtml(truncate(f.content ?? '', 100))}</div>\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    `;\n    container.querySelectorAll('.conflict-resolve-restore').forEach(btn => {\n      const item = (btn as HTMLElement).closest('.removed-fact-item');\n      const id = item?.getAttribute('data-fact-id');\n      if (id) {\n        on(btn as HTMLElement, 'click', async () => {\n          try {\n            await factsService.restoreFact(id);\n            toast.success('Fact restored');\n            await loadFacts(panel, props);\n            refreshRemovedFactsSection(panel, props);\n            const conflictsContainer = panel.querySelector('#conflicts-container') as HTMLElement;\n            if (conflictsContainer?.style.display !== 'none') {\n              await checkConflicts(conflictsContainer, panel, props);\n            }\n          } catch {\n            toast.error('Failed to restore fact');\n          }\n        });\n      }\n    });\n  } catch {\n    container.style.display = 'none';\n    container.innerHTML = '';\n  }\n}\n\n/**\n * Render facts list\n */\nfunction renderFacts(container: HTMLElement, facts: Fact[], props: FactsPanelProps): void {\n  if (facts.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>${currentSearch ? 'No facts match your search' : 'No facts found'}</p>\n        <button class=\"btn btn-primary\" id=\"empty-add-fact-btn\">Add Fact</button>\n      </div>\n    `;\n    const emptyAddBtn = container.querySelector('#empty-add-fact-btn');\n    if (emptyAddBtn) {\n      on(emptyAddBtn as HTMLElement, 'click', () => {\n        const panel = container.closest('.facts-panel') as HTMLElement;\n        if (panel) showAddFactModal(panel, props);\n      });\n    }\n    return;\n  }\n\n  // Group by category (same structure as Questions: question-group, group-header, group-items)\n  const factsByCategory: Record<string, Fact[]> = {};\n  facts.forEach(fact => {\n    const cat = fact.category || 'Uncategorized';\n    if (!factsByCategory[cat]) factsByCategory[cat] = [];\n    factsByCategory[cat].push(fact);\n  });\n  const categories = Object.keys(factsByCategory);\n\n  if (categories.length > 1) {\n    container.innerHTML = Object.entries(factsByCategory).map(([category, catFacts]) => `\n      <div class=\"question-group\">\n        <div class=\"group-header\">\n          <h3>${escapeHtml(category)}</h3>\n          <span class=\"group-count\">${catFacts.length}</span>\n        </div>\n        <div class=\"group-items\">\n          ${catFacts.map(fact => createFactCard(fact)).join('')}\n        </div>\n      </div>\n    `).join('');\n  } else {\n    container.innerHTML = facts.map(fact => createFactCard(fact)).join('');\n  }\n\n  // Bind click events (cards use .fact-card-sota, same click target)\n  container.querySelectorAll('.fact-card-sota').forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const id = card.getAttribute('data-id');\n      const fact = facts.find(f => String(f.id) === id);\n      if (!fact) return;\n      if (props.useDetailView && props.containerElement) {\n        const containerEl = props.containerElement;\n        containerEl.innerHTML = '';\n        containerEl.appendChild(createFactDetailView(factDetailProps(containerEl, props, fact)));\n      } else if (props.onFactClick) {\n        props.onFactClick(fact);\n      } else {\n        import('../modals/FactModal').then(({ showFactModal }) => {\n          showFactModal({ mode: 'view', fact });\n        });\n      }\n    });\n\n    // Bind verify button\n    const verifyBtn = card.querySelector('.fact-verify-btn');\n    if (verifyBtn) {\n      on(verifyBtn as HTMLElement, 'click', async (e) => {\n        e.stopPropagation();\n        const id = card.getAttribute('data-id');\n        if (id) {\n          try {\n            await factsService.verify(id);\n            toast.success('Fact verified');\n            loadFacts(container.closest('.facts-panel') as HTMLElement, props);\n          } catch {\n            // Error handled by service\n          }\n        }\n      });\n    }\n  });\n}\n\n/**\n * Render facts grouped by source (same group structure as Questions)\n */\nfunction renderFactsBySource(container: HTMLElement, facts: Fact[], props: FactsPanelProps): void {\n  if (facts.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>${currentSearch ? 'No facts match your search' : 'No facts found'}</p>\n        <button class=\"btn btn-primary\" id=\"empty-add-fact-btn\">Add Fact</button>\n      </div>\n    `;\n    const emptyAddBtn = container.querySelector('#empty-add-fact-btn');\n    if (emptyAddBtn) {\n      on(emptyAddBtn as HTMLElement, 'click', () => {\n        const panel = container.closest('.facts-panel') as HTMLElement;\n        if (panel) showAddFactModal(panel, props);\n      });\n    }\n    return;\n  }\n  const bySource: Record<string, Fact[]> = {};\n  facts.forEach(fact => {\n    const source = fact.source_file || fact.source || 'Unknown source';\n    if (!bySource[source]) bySource[source] = [];\n    bySource[source].push(fact);\n  });\n  container.innerHTML = Object.entries(bySource).map(([source, catFacts]) => `\n    <div class=\"question-group\">\n      <div class=\"group-header\">\n        <h3>${escapeHtml(source)}</h3>\n        <span class=\"group-count\">${catFacts.length}</span>\n      </div>\n      <div class=\"group-items\">\n        ${catFacts.map(fact => createFactCard(fact)).join('')}\n      </div>\n    </div>\n  `).join('');\n\n  container.querySelectorAll('.fact-card-sota').forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const id = card.getAttribute('data-id');\n      const fact = facts.find(f => String(f.id) === id);\n      if (!fact) return;\n      if (props.useDetailView && props.containerElement) {\n        const containerEl = props.containerElement;\n        const detailView = createFactDetailView({\n          fact,\n          onClose: () => {\n            containerEl.innerHTML = '';\n            const newPanel = createFactsPanel(props);\n            containerEl.appendChild(newPanel);\n          },\n          onUpdate: () => {\n            containerEl.innerHTML = '';\n            const newPanel = createFactsPanel(props);\n            containerEl.appendChild(newPanel);\n          },\n        });\n        containerEl.innerHTML = '';\n        containerEl.appendChild(detailView);\n      } else if (props.onFactClick) {\n        props.onFactClick(fact);\n      } else {\n        import('../modals/FactModal').then(({ showFactModal }) => {\n          showFactModal({ mode: 'view', fact });\n        });\n      }\n    });\n    const verifyBtn = card.querySelector('.fact-verify-btn');\n    if (verifyBtn) {\n      on(verifyBtn as HTMLElement, 'click', async (e) => {\n        e.stopPropagation();\n        const id = card.getAttribute('data-id');\n        if (id) {\n          try {\n            await factsService.verify(id);\n            toast.success('Fact verified');\n            loadFacts(container.closest('.facts-panel') as HTMLElement, props);\n          } catch {\n            // Error handled by service\n          }\n        }\n      });\n    }\n  });\n}\n\n/** Category bar color (left edge) - align with question priority bar */\nconst CATEGORY_BAR_COLOR: Record<string, string> = {\n  technical: '#3b82f6',\n  process: '#8b5cf6',\n  policy: '#ec4899',\n  people: '#10b981',\n  timeline: '#f59e0b',\n  general: '#6b7280',\n};\n\n/**\n * Create fact card HTML - SOTA design aligned with question-card-sota\n */\nfunction createFactCard(fact: Fact): string {\n  const category = (fact.category || 'general').toLowerCase();\n  const categoryClass = category.replace(/\\s+/g, '-');\n  const barColor = CATEGORY_BAR_COLOR[category] || CATEGORY_BAR_COLOR.general;\n  const confidencePct = fact.confidence != null ? Math.round(fact.confidence * 100) : null;\n\n  return `\n    <div class=\"fact-card-sota question-card-sota ${fact.verified ? 'has-answer' : ''}\" data-id=\"${fact.id}\" style=\"--fact-category-bar: ${barColor}\">\n      <div class=\"card-priority-bar fact-category-bar\" style=\"background: ${barColor}\"></div>\n      <div class=\"card-body\">\n        <div class=\"card-top-row\">\n          <div class=\"card-badges\">\n            <span class=\"priority-pill fact-category-pill category-${categoryClass}\">${escapeHtml(fact.category || 'general')}</span>\n            ${confidencePct != null ? `<span class=\"status-pill status-pending\">${confidencePct}%</span>` : ''}\n            ${fact.verified ? '<span class=\"auto-pill\"> Verified</span>' : ''}\n          </div>\n          <span class=\"card-timestamp\">${formatRelativeTime(fact.created_at)}</span>\n        </div>\n        <div class=\"card-question-text\">${escapeHtml(fact.content)}</div>\n        <div class=\"card-bottom-row\">\n          <div class=\"card-requester\">\n            ${fact.source_file || fact.source ? `<span class=\"card-source-chip\">${escapeHtml((fact.source_file || fact.source || '').substring(0, 40))}${(fact.source_file || fact.source || '').length > 40 ? '' : ''}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>'}\n          </div>\n          <div class=\"card-assignment\">\n            ${fact.verified ? '<span class=\"answered-badge\">Verified</span>' : '<button type=\"button\" class=\"btn-link fact-verify-btn\">Verify</button>'}\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Check for conflicts\n */\nasync function checkConflicts(container: HTMLElement, panel: HTMLElement, props: FactsPanelProps): Promise<void> {\n  container.style.display = 'block';\n  container.innerHTML = '<div class=\"loading\">Checking for conflicts...</div>';\n\n  try {\n    const conflicts = await factsService.detectConflicts();\n\n    if (conflicts.length === 0) {\n      container.innerHTML = `\n        <div class=\"no-conflicts\">\n          <span class=\"success-icon\"></span>\n          <p>No conflicts detected</p>\n        </div>\n      `;\n      setTimeout(() => {\n        container.style.display = 'none';\n      }, 3000);\n    } else {\n      renderConflicts(container, conflicts, panel, props);\n    }\n  } catch {\n    container.innerHTML = '<div class=\"error\">Failed to check conflicts</div>';\n  }\n}\n\n/**\n * Render conflicts  SOTA-style cards; each card has \"Keep left\" / \"Keep right\" to resolve.\n */\nfunction renderConflicts(container: HTMLElement, conflicts: FactConflict[], panel: HTMLElement, props: FactsPanelProps): void {\n  container.innerHTML = `\n    <div class=\"conflicts-section\">\n      <div class=\"conflicts-header section-header-sota\">\n        <h3>Conflicts Detected</h3>\n        <span class=\"conflicts-count panel-count\">${conflicts.length}</span>\n        <button type=\"button\" class=\"btn-icon close-conflicts\" title=\"Close\"></button>\n      </div>\n      <div class=\"conflicts-list question-group\">\n        ${conflicts.map((conflict, index) => createConflictCard(conflict, index)).join('')}\n      </div>\n    </div>\n  `;\n\n  const closeBtn = container.querySelector('.close-conflicts');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => {\n      container.style.display = 'none';\n    });\n  }\n\n  conflicts.forEach((conflict, index) => {\n    const card = container.querySelector(`[data-conflict-index=\"${index}\"]`);\n    if (!card) return;\n    const keepLeftBtn = card.querySelector('.conflict-resolve-keep-left');\n    const keepRightBtn = card.querySelector('.conflict-resolve-keep-right');\n    if (keepLeftBtn) {\n      on(keepLeftBtn as HTMLElement, 'click', (e) => {\n        e.stopPropagation();\n        resolveConflict(conflict, 'left', panel, props, container);\n      });\n    }\n    if (keepRightBtn) {\n      on(keepRightBtn as HTMLElement, 'click', (e) => {\n        e.stopPropagation();\n        resolveConflict(conflict, 'right', panel, props, container);\n      });\n    }\n  });\n}\n\n/**\n * Resolve conflict: keep chosen fact, delete the other, refresh facts, re-run AI fact-check, optionally verify kept fact.\n */\nasync function resolveConflict(\n  conflict: FactConflict,\n  keep: 'left' | 'right',\n  panel: HTMLElement,\n  props: FactsPanelProps,\n  conflictsContainer: HTMLElement\n): Promise<void> {\n  const toDelete = keep === 'left' ? conflict.fact2 : conflict.fact1;\n  const toKeep = keep === 'left' ? conflict.fact1 : conflict.fact2;\n  if (!toDelete?.id) return;\n  try {\n    await factsService.deleteFact(toDelete.id);\n    toast.success(`Removed conflicting fact; kept: \"${truncate(toKeep?.content ?? '', 50)}\"`);\n    await loadFacts(panel, props);\n    // Re-run AI fact-check on remaining facts (automatic analysis)\n    try {\n      await factsService.runFactCheck();\n    } catch {\n      // Non-blocking\n    }\n    if (toKeep?.id) {\n      try {\n        await factsService.verifyFact(toKeep.id);\n      } catch {\n        // Non-blocking\n      }\n    }\n    await checkConflicts(conflictsContainer, panel, props);\n    const updated = await factsService.detectConflicts();\n    if (updated.length === 0) {\n      conflictsContainer.style.display = 'none';\n      conflictsContainer.innerHTML = '';\n    } else {\n      renderConflicts(conflictsContainer, updated, panel, props);\n    }\n    refreshRemovedFactsSection(panel, props);\n  } catch {\n    toast.error('Failed to resolve conflict');\n  }\n}\n\n/**\n * Create a single conflict card  isolated layout (no fact-card-sota) + Keep left / Keep right.\n */\nfunction createConflictCard(conflict: FactConflict, index: number): string {\n  const type = (conflict.conflictType || 'contradiction').toLowerCase();\n  const desc = conflict.description || conflict.reason || 'Conflict detected';\n  const barClass = type === 'contradiction' ? 'conflict-bar-contradiction' : type === 'inconsistency' ? 'conflict-bar-inconsistency' : 'conflict-bar-process';\n\n  return `\n    <div class=\"conflict-card-sota\" data-conflict-index=\"${index}\">\n      <div class=\"conflict-type-bar ${barClass}\"></div>\n      <div class=\"conflict-card-body\">\n        <div class=\"conflict-card-top\">\n          <span class=\"conflict-type-pill conflict-type-${type}\">${escapeHtml(type)}</span>\n          ${conflict.confidence != null ? `<span class=\"conflict-confidence-pill\">${Math.round(conflict.confidence * 100)}%</span>` : ''}\n        </div>\n        <div class=\"conflict-facts-row\">\n          <div class=\"conflict-fact-cell\">\n            <div class=\"conflict-fact-snippet\">${escapeHtml(truncate(conflict.fact1?.content ?? '', 120))}</div>\n            <button type=\"button\" class=\"btn btn-sm conflict-resolve-keep-left\">Keep this</button>\n          </div>\n          <span class=\"conflict-vs\">vs</span>\n          <div class=\"conflict-fact-cell\">\n            <div class=\"conflict-fact-snippet\">${escapeHtml(truncate(conflict.fact2?.content ?? '', 120))}</div>\n            <button type=\"button\" class=\"btn btn-sm conflict-resolve-keep-right\">Keep this</button>\n          </div>\n        </div>\n        <div class=\"conflict-description-row\">\n          <div class=\"conflict-description\">${escapeHtml(desc)}</div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction truncate(s: string, max: number): string {\n  if (s.length <= max) return s;\n  return s.slice(0, max).trim() + '';\n}\n\n/**\n * Show add fact modal\n */\nasync function showAddFactModal(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\n  // Dynamic import to avoid circular dependency\n  const { showFactModal } = await import('../modals/FactModal');\n  showFactModal({\n    mode: 'create',\n    onSave: () => loadFacts(panel, props),\n  });\n}\n\n/**\n * Update count badge\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#facts-count');\n  if (countEl) {\n    countEl.textContent = String(count);\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createFactsPanel;\n","/**\n * Stats Card Widget\n * Displays a single statistic with icon and optional trend\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { formatNumber } from '../../utils/format';\n\nexport interface StatsCardProps {\n  id: string;\n  label: string;\n  value: number | string;\n  icon?: string;\n  subValue?: string;\n  trend?: {\n    direction: 'up' | 'down' | 'stable';\n    value: number;\n    sentiment: 'positive' | 'negative' | 'neutral';\n  };\n  color?: string;\n  onClick?: () => void;\n}\n\n/**\n * Create stats card element\n */\nexport function createStatsCard(props: StatsCardProps): HTMLElement {\n  const card = createElement('div', {\n    className: `stats-card ${props.onClick ? 'clickable' : ''} ${props.color ? `color-${props.color}` : ''}`,\n  });\n  card.setAttribute('data-stat-id', props.id);\n\n  const trendHtml = props.trend ? `\n    <div class=\"stat-trend ${props.trend.direction} ${props.trend.sentiment}\">\n      <span class=\"trend-arrow\">${getTrendArrow(props.trend.direction)}</span>\n      <span class=\"trend-value\">${props.trend.value}%</span>\n    </div>\n  ` : '';\n\n  card.innerHTML = `\n    ${props.icon ? `<div class=\"stat-icon\">${props.icon}</div>` : ''}\n    <div class=\"stat-value\">${typeof props.value === 'number' ? formatNumber(props.value) : props.value}</div>\n    <div class=\"stat-label\">${props.label}</div>\n    ${props.subValue ? `<div class=\"stat-sub\">${props.subValue}</div>` : ''}\n    ${trendHtml}\n  `;\n\n  if (props.onClick) {\n    on(card, 'click', props.onClick);\n  }\n\n  return card;\n}\n\n/**\n * Get trend arrow character\n */\nfunction getTrendArrow(direction: 'up' | 'down' | 'stable'): string {\n  switch (direction) {\n    case 'up': return '';\n    case 'down': return '';\n    case 'stable': return '';\n  }\n}\n\n/**\n * Update stats card value\n */\nexport function updateStatsCard(card: HTMLElement, value: number | string, subValue?: string): void {\n  const valueEl = card.querySelector('.stat-value');\n  const subEl = card.querySelector('.stat-sub');\n  \n  if (valueEl) {\n    valueEl.textContent = typeof value === 'number' ? formatNumber(value) : value;\n  }\n  \n  if (subEl && subValue !== undefined) {\n    subEl.textContent = subValue;\n  }\n}\n\n/**\n * Create stats grid with multiple cards\n */\nexport function createStatsGrid(stats: StatsCardProps[]): HTMLElement {\n  const grid = createElement('div', { className: 'stats-grid' });\n  \n  stats.forEach(stat => {\n    const card = createStatsCard(stat);\n    grid.appendChild(card);\n  });\n\n  return grid;\n}\n\nexport default createStatsCard;\n","/**\n * Health Indicator Widget\n * Displays project health score with gauge and factors\n */\n\nimport { createElement } from '../../utils/dom';\nimport { HealthData } from '../../services/dashboard';\n\nexport interface HealthIndicatorProps {\n  health: HealthData;\n  showFactors?: boolean;\n  size?: 'sm' | 'md' | 'lg';\n}\n\n/**\n * Create health indicator element\n */\nexport function createHealthIndicator(props: HealthIndicatorProps): HTMLElement {\n  const { health, showFactors = true, size = 'md' } = props;\n  const statusClass = health.status.toLowerCase().replace(/\\s+/g, '-');\n\n  const indicator = createElement('div', {\n    className: `health-indicator ${statusClass} size-${size}`,\n  });\n\n  indicator.innerHTML = `\n    <div class=\"health-gauge\">\n      <svg class=\"gauge-svg\" viewBox=\"0 0 100 50\">\n        <path class=\"gauge-bg\" d=\"M 10 50 A 40 40 0 0 1 90 50\" />\n        <path class=\"gauge-fill\" d=\"M 10 50 A 40 40 0 0 1 90 50\" \n              style=\"stroke-dasharray: ${(health.score / 100) * 126} 126; stroke: ${health.color};\" />\n      </svg>\n      <div class=\"gauge-center\">\n        <span class=\"score-value\">${health.score}</span>\n        <span class=\"score-label\">Health</span>\n      </div>\n    </div>\n    <div class=\"health-status\" style=\"color: ${health.color}\">${health.status}</div>\n    ${showFactors && health.factors.length > 0 ? `\n      <div class=\"health-factors\">\n        ${health.factors.slice(0, 4).map(f => `\n          <div class=\"factor ${f.type}\">\n            <span class=\"factor-icon\">${f.type === 'positive' ? '' : '!'}</span>\n            <span class=\"factor-text\">${f.factor}</span>\n          </div>\n        `).join('')}\n      </div>\n    ` : ''}\n  `;\n\n  return indicator;\n}\n\n/**\n * Create mini health badge (for header/compact views)\n */\nexport function createHealthBadge(score: number, status: string, color: string): HTMLElement {\n  const badge = createElement('div', { className: 'health-badge' });\n  \n  badge.innerHTML = `\n    <span class=\"badge-score\" style=\"background: ${color}\">${score}</span>\n    <span class=\"badge-status\">${status}</span>\n  `;\n\n  return badge;\n}\n\n/**\n * Get health color based on score\n */\nexport function getHealthColor(score: number): string {\n  if (score >= 80) return '#22c55e'; // green\n  if (score >= 60) return '#84cc16'; // lime\n  if (score >= 40) return '#eab308'; // yellow\n  if (score >= 20) return '#f97316'; // orange\n  return '#ef4444'; // red\n}\n\n/**\n * Get health status based on score\n */\nexport function getHealthStatus(score: number): string {\n  if (score >= 80) return 'Healthy';\n  if (score >= 60) return 'Good';\n  if (score >= 40) return 'Needs Attention';\n  if (score >= 20) return 'At Risk';\n  return 'Critical';\n}\n\nexport default createHealthIndicator;\n","/**\n * Trend Chart Widget\n * Displays trends over time using Chart.js\n */\n\nimport { createElement } from '../../utils/dom';\nimport { TrendHistory } from '../../services/dashboard';\n\nexport interface TrendChartProps {\n  data: TrendHistory[];\n  metrics?: ('facts' | 'questions' | 'risks' | 'actions' | 'decisions')[];\n  height?: number;\n}\n\n// Color palette for metrics\nconst METRIC_COLORS: Record<string, { line: string; fill: string }> = {\n  facts: { line: '#6366f1', fill: 'rgba(99, 102, 241, 0.1)' },\n  questions: { line: '#f59e0b', fill: 'rgba(245, 158, 11, 0.1)' },\n  risks: { line: '#ef4444', fill: 'rgba(239, 68, 68, 0.1)' },\n  actions: { line: '#22c55e', fill: 'rgba(34, 197, 94, 0.1)' },\n  decisions: { line: '#8b5cf6', fill: 'rgba(139, 92, 246, 0.1)' },\n};\n\n/**\n * Create trend chart element\n */\nexport function createTrendChart(props: TrendChartProps): HTMLElement {\n  const { data, metrics = ['facts', 'questions', 'risks'], height = 200 } = props;\n\n  const container = createElement('div', { className: 'trend-chart-container' });\n  container.style.height = `${height}px`;\n\n  if (data.length === 0) {\n    container.innerHTML = '<div class=\"empty-chart\">No trend data available</div>';\n    return container;\n  }\n\n  // Create canvas for Chart.js\n  const canvas = createElement('canvas', { id: `trend-chart-${Date.now()}` }) as HTMLCanvasElement;\n  container.appendChild(canvas);\n\n  // Initialize chart (requires Chart.js to be loaded)\n  initChart(canvas, data, metrics);\n\n  return container;\n}\n\n/**\n * Initialize Chart.js chart\n */\nfunction initChart(\n  canvas: HTMLCanvasElement,\n  data: TrendHistory[],\n  metrics: string[]\n): void {\n  // Check if Chart.js is available\n  if (typeof (window as unknown as { Chart?: unknown }).Chart === 'undefined') {\n    console.warn('Chart.js not loaded, using fallback');\n    renderFallbackChart(canvas.parentElement as HTMLElement, data, metrics);\n    return;\n  }\n\n  const Chart = (window as unknown as { Chart: typeof import('chart.js').Chart }).Chart;\n\n  const labels = data.map(d => formatDate(d.date));\n  const datasets = metrics.map(metric => ({\n    label: capitalize(metric),\n    data: data.map(d => (d as Record<string, number>)[metric] || 0),\n    borderColor: METRIC_COLORS[metric]?.line || '#6366f1',\n    backgroundColor: METRIC_COLORS[metric]?.fill || 'rgba(99, 102, 241, 0.1)',\n    fill: true,\n    tension: 0.3,\n  }));\n\n  new Chart(canvas, {\n    type: 'line',\n    data: { labels, datasets },\n    options: {\n      responsive: true,\n      maintainAspectRatio: false,\n      plugins: {\n        legend: {\n          position: 'bottom',\n        },\n      },\n      scales: {\n        y: {\n          beginAtZero: true,\n        },\n      },\n    },\n  });\n}\n\n/**\n * Render fallback chart (pure CSS/HTML)\n */\nfunction renderFallbackChart(container: HTMLElement, data: TrendHistory[], metrics: string[]): void {\n  const maxValue = Math.max(\n    ...data.flatMap(d => metrics.map(m => (d as Record<string, number>)[m] || 0))\n  );\n\n  container.innerHTML = `\n    <div class=\"fallback-chart\">\n      <div class=\"chart-legend\">\n        ${metrics.map(m => `\n          <span class=\"legend-item\">\n            <span class=\"legend-color\" style=\"background: ${METRIC_COLORS[m]?.line || '#6366f1'}\"></span>\n            ${capitalize(m)}\n          </span>\n        `).join('')}\n      </div>\n      <div class=\"chart-bars\">\n        ${data.slice(-7).map(d => `\n          <div class=\"bar-group\">\n            ${metrics.map(m => {\n              const value = (d as Record<string, number>)[m] || 0;\n              const height = maxValue > 0 ? (value / maxValue) * 100 : 0;\n              return `<div class=\"bar\" style=\"height: ${height}%; background: ${METRIC_COLORS[m]?.line || '#6366f1'}\" title=\"${capitalize(m)}: ${value}\"></div>`;\n            }).join('')}\n            <div class=\"bar-label\">${formatDate(d.date)}</div>\n          </div>\n        `).join('')}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Format date for display\n */\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\n}\n\n/**\n * Capitalize first letter\n */\nfunction capitalize(str: string): string {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nexport default createTrendChart;\n","/**\n * Risk Matrix Widget\n * 5x4 matrix showing risks by impact and likelihood\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { Risk, risksService } from '../../services/risks';\n\nexport interface RiskMatrixProps {\n  risks: Risk[];\n  onCellClick?: (risks: Risk[], impact: string, likelihood: string) => void;\n  size?: 'sm' | 'md' | 'lg';\n}\n\nconst IMPACTS = ['critical', 'high', 'medium', 'low'];\nconst LIKELIHOODS = ['high', 'medium', 'low'];\n\n// Cell colors based on risk level\nconst CELL_COLORS: Record<string, string> = {\n  'critical-high': '#dc2626',   // dark red\n  'critical-medium': '#ef4444', // red\n  'critical-low': '#f87171',    // light red\n  'high-high': '#ef4444',       // red\n  'high-medium': '#f97316',     // orange\n  'high-low': '#fb923c',        // light orange\n  'medium-high': '#f97316',     // orange\n  'medium-medium': '#eab308',   // yellow\n  'medium-low': '#facc15',      // light yellow\n  'low-high': '#eab308',        // yellow\n  'low-medium': '#84cc16',      // lime\n  'low-low': '#22c55e',         // green\n};\n\n/**\n * Create risk matrix element\n */\nexport function createRiskMatrix(props: RiskMatrixProps): HTMLElement {\n  const { risks, onCellClick, size = 'md' } = props;\n\n  const matrix = createElement('div', { className: `risk-matrix size-${size}` });\n  \n  // Group risks by cell\n  const grouped = groupRisksByCell(risks);\n\n  matrix.innerHTML = `\n    <div class=\"matrix-container\">\n      <div class=\"matrix-y-label\">Impact</div>\n      <div class=\"matrix-grid\">\n        <div class=\"matrix-header\">\n          <div class=\"matrix-corner\"></div>\n          ${LIKELIHOODS.map(l => `<div class=\"matrix-col-header\">${capitalize(l)}</div>`).join('')}\n        </div>\n        ${IMPACTS.map(impact => `\n          <div class=\"matrix-row\">\n            <div class=\"matrix-row-header\">${capitalize(impact)}</div>\n            ${LIKELIHOODS.map(likelihood => {\n              const key = `${impact}-${likelihood}`;\n              const cellRisks = grouped[key] || [];\n              const color = CELL_COLORS[key] || '#e5e7eb';\n              const count = cellRisks.length;\n              return `\n                <div class=\"matrix-cell ${count > 0 ? 'has-risks' : ''}\" \n                     data-impact=\"${impact}\" \n                     data-likelihood=\"${likelihood}\"\n                     style=\"background-color: ${count > 0 ? color : 'var(--color-surface-hover)'}\">\n                  ${count > 0 ? `<span class=\"cell-count\">${count}</span>` : ''}\n                </div>\n              `;\n            }).join('')}\n          </div>\n        `).join('')}\n      </div>\n      <div class=\"matrix-x-label\">Likelihood</div>\n    </div>\n    <div class=\"matrix-legend\">\n      <span class=\"legend-item\"><span class=\"legend-color\" style=\"background: #22c55e\"></span> Low</span>\n      <span class=\"legend-item\"><span class=\"legend-color\" style=\"background: #eab308\"></span> Medium</span>\n      <span class=\"legend-item\"><span class=\"legend-color\" style=\"background: #f97316\"></span> High</span>\n      <span class=\"legend-item\"><span class=\"legend-color\" style=\"background: #ef4444\"></span> Critical</span>\n    </div>\n  `;\n\n  // Bind cell click events\n  if (onCellClick) {\n    matrix.querySelectorAll('.matrix-cell.has-risks').forEach(cell => {\n      on(cell as HTMLElement, 'click', () => {\n        const impact = cell.getAttribute('data-impact') || '';\n        const likelihood = cell.getAttribute('data-likelihood') || '';\n        const key = `${impact}-${likelihood}`;\n        const cellRisks = grouped[key] || [];\n        onCellClick(cellRisks, impact, likelihood);\n      });\n    });\n  }\n\n  return matrix;\n}\n\n/**\n * Group risks by matrix cell\n */\nfunction groupRisksByCell(risks: Risk[]): Record<string, Risk[]> {\n  const grouped: Record<string, Risk[]> = {};\n  \n  risks\n    .filter(r => r.status !== 'mitigated' && r.status !== 'closed')\n    .forEach(risk => {\n      const key = `${risk.impact}-${risk.likelihood}`;\n      if (!grouped[key]) grouped[key] = [];\n      grouped[key].push(risk);\n    });\n  \n  return grouped;\n}\n\n/**\n * Capitalize first letter\n */\nfunction capitalize(str: string): string {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n/**\n * Create compact risk summary (for dashboard)\n */\nexport function createRiskSummary(risks: Risk[]): HTMLElement {\n  const summary = createElement('div', { className: 'risk-summary' });\n  \n  const bySeverity = {\n    critical: risks.filter(r => r.impact === 'critical' && r.status === 'open').length,\n    high: risks.filter(r => r.impact === 'high' && r.status === 'open').length,\n    medium: risks.filter(r => r.impact === 'medium' && r.status === 'open').length,\n    low: risks.filter(r => r.impact === 'low' && r.status === 'open').length,\n  };\n\n  summary.innerHTML = `\n    <div class=\"summary-bars\">\n      ${Object.entries(bySeverity).map(([level, count]) => `\n        <div class=\"summary-bar\">\n          <span class=\"bar-label\">${capitalize(level)}</span>\n          <div class=\"bar-track\">\n            <div class=\"bar-fill impact-${level}\" style=\"width: ${Math.min(count * 20, 100)}%\"></div>\n          </div>\n          <span class=\"bar-count\">${count}</span>\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  return summary;\n}\n\nexport default createRiskMatrix;\n","/**\n * File Uploader Component\n * Drag-and-drop file upload with progress and file list\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { documentsService, UploadResult, ProcessingStatus } from '../services/documents';\nimport { toast } from '../services/toast';\nimport { formatFileSize } from '../utils/format';\n\nexport interface FileUploaderProps {\n  onUploadComplete?: (result: UploadResult) => void;\n  onProcessingStart?: () => void;\n  allowedTypes?: string[];\n  maxFileSize?: number; // in bytes\n  multiple?: boolean;\n}\n\ninterface QueuedFile {\n  file: File;\n  id: string;\n  progress: number;\n  status: 'pending' | 'uploading' | 'complete' | 'error';\n  error?: string;\n}\n\nlet fileQueue: QueuedFile[] = [];\nlet isProcessing = false;\n\n/**\n * Create file uploader component\n */\nexport function createFileUploader(props: FileUploaderProps = {}): HTMLElement {\n  const { allowedTypes, maxFileSize = 50 * 1024 * 1024, multiple = true } = props;\n\n  const uploader = createElement('div', { className: 'file-uploader' });\n\n  uploader.innerHTML = `\n    <div class=\"dropzone\" id=\"dropzone\">\n      <div class=\"dropzone-content\">\n        <div class=\"dropzone-icon\"></div>\n        <div class=\"dropzone-text\">\n          <p>Drag & drop files here</p>\n          <p class=\"dropzone-subtext\">or click to browse</p>\n        </div>\n        <input type=\"file\" id=\"file-input\" ${multiple ? 'multiple' : ''} \n               ${allowedTypes ? `accept=\"${allowedTypes.join(',')}\"` : ''} hidden>\n      </div>\n    </div>\n    <div class=\"file-queue\" id=\"file-queue\" style=\"display: none;\"></div>\n    <div class=\"upload-actions\" id=\"upload-actions\" style=\"display: none;\">\n      <button class=\"btn btn-secondary\" id=\"clear-queue-btn\">Clear</button>\n      <button class=\"btn btn-primary\" id=\"upload-btn\">Upload Files</button>\n    </div>\n    <div class=\"processing-status\" id=\"processing-status\" style=\"display: none;\"></div>\n  `;\n\n  const dropzone = uploader.querySelector('#dropzone') as HTMLElement;\n  const fileInput = uploader.querySelector('#file-input') as HTMLInputElement;\n  const queueContainer = uploader.querySelector('#file-queue') as HTMLElement;\n  const actionsContainer = uploader.querySelector('#upload-actions') as HTMLElement;\n  const statusContainer = uploader.querySelector('#processing-status') as HTMLElement;\n\n  // Click to browse\n  on(dropzone, 'click', () => fileInput.click());\n\n  // File input change\n  on(fileInput, 'change', () => {\n    if (fileInput.files) {\n      addFilesToQueue(Array.from(fileInput.files), maxFileSize);\n      updateQueueUI(queueContainer, actionsContainer);\n    }\n    fileInput.value = ''; // Reset for same file selection\n  });\n\n  // Drag events\n  on(dropzone, 'dragover', (e) => {\n    e.preventDefault();\n    dropzone.classList.add('dragover');\n  });\n\n  on(dropzone, 'dragleave', () => {\n    dropzone.classList.remove('dragover');\n  });\n\n  on(dropzone, 'drop', (e) => {\n    e.preventDefault();\n    dropzone.classList.remove('dragover');\n    const files = Array.from(e.dataTransfer?.files || []);\n    if (files.length > 0) {\n      addFilesToQueue(files, maxFileSize);\n      updateQueueUI(queueContainer, actionsContainer);\n    }\n  });\n\n  // Clear queue\n  const clearBtn = uploader.querySelector('#clear-queue-btn');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', () => {\n      fileQueue = [];\n      updateQueueUI(queueContainer, actionsContainer);\n    });\n  }\n\n  // Upload button\n  const uploadBtn = uploader.querySelector('#upload-btn');\n  if (uploadBtn) {\n    on(uploadBtn as HTMLElement, 'click', async () => {\n      await uploadFiles(queueContainer, actionsContainer, statusContainer, props);\n    });\n  }\n\n  // Check processing status on mount\n  checkProcessingStatus(statusContainer);\n\n  return uploader;\n}\n\n/**\n * Add files to queue\n */\nfunction addFilesToQueue(files: File[], maxSize: number): void {\n  files.forEach(file => {\n    // Check size\n    if (file.size > maxSize) {\n      toast.warning(`${file.name} is too large (max ${formatFileSize(maxSize)})`);\n      return;\n    }\n\n    // Check if already in queue\n    if (fileQueue.some(f => f.file.name === file.name && f.file.size === file.size)) {\n      return;\n    }\n\n    fileQueue.push({\n      file,\n      id: `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      progress: 0,\n      status: 'pending',\n    });\n  });\n}\n\n/**\n * Update queue UI\n */\nfunction updateQueueUI(container: HTMLElement, actionsContainer: HTMLElement): void {\n  if (fileQueue.length === 0) {\n    container.style.display = 'none';\n    actionsContainer.style.display = 'none';\n    return;\n  }\n\n  container.style.display = 'block';\n  actionsContainer.style.display = 'flex';\n\n  container.innerHTML = fileQueue.map(qf => `\n    <div class=\"queued-file ${qf.status}\" data-id=\"${qf.id}\">\n      <div class=\"file-info\">\n        <span class=\"file-icon\">${getFileIcon(qf.file.type)}</span>\n        <span class=\"file-name\">${escapeHtml(qf.file.name)}</span>\n        <span class=\"file-size\">${formatFileSize(qf.file.size)}</span>\n      </div>\n      <div class=\"file-status\">\n        ${qf.status === 'uploading' ? `\n          <div class=\"progress-bar\">\n            <div class=\"progress-fill\" style=\"width: ${qf.progress}%\"></div>\n          </div>\n          <span class=\"progress-text\">${qf.progress}%</span>\n        ` : qf.status === 'complete' ? `\n          <span class=\"status-icon success\"></span>\n        ` : qf.status === 'error' ? `\n          <span class=\"status-icon error\"></span>\n          <span class=\"error-text\">${escapeHtml(qf.error || 'Error')}</span>\n        ` : `\n          <button class=\"btn-icon remove-file\" data-id=\"${qf.id}\"></button>\n        `}\n      </div>\n    </div>\n  `).join('');\n\n  // Bind remove buttons\n  container.querySelectorAll('.remove-file').forEach(btn => {\n    on(btn as HTMLElement, 'click', (e) => {\n      e.stopPropagation();\n      const id = btn.getAttribute('data-id');\n      fileQueue = fileQueue.filter(f => f.id !== id);\n      updateQueueUI(container, actionsContainer);\n    });\n  });\n}\n\n/**\n * Upload files\n */\nasync function uploadFiles(\n  queueContainer: HTMLElement,\n  actionsContainer: HTMLElement,\n  statusContainer: HTMLElement,\n  props: FileUploaderProps\n): Promise<void> {\n  const pendingFiles = fileQueue.filter(f => f.status === 'pending');\n  if (pendingFiles.length === 0) return;\n\n  // Disable buttons during upload\n  const uploadBtn = actionsContainer.querySelector('#upload-btn') as HTMLButtonElement;\n  if (uploadBtn) uploadBtn.disabled = true;\n\n  try {\n    // Mark all as uploading\n    pendingFiles.forEach(f => {\n      f.status = 'uploading';\n      f.progress = 0;\n    });\n    updateQueueUI(queueContainer, actionsContainer);\n\n    // Upload files\n    const result = await documentsService.upload(\n      pendingFiles.map(f => f.file),\n      (progress) => {\n        pendingFiles.forEach(f => {\n          f.progress = progress;\n        });\n        updateQueueUI(queueContainer, actionsContainer);\n      }\n    );\n\n    // Mark as complete\n    pendingFiles.forEach(f => {\n      f.status = 'complete';\n      f.progress = 100;\n    });\n    updateQueueUI(queueContainer, actionsContainer);\n\n    toast.success(`Uploaded ${result.files.length} file(s)`);\n    props.onUploadComplete?.(result);\n\n    // Clear completed after delay\n    setTimeout(() => {\n      fileQueue = fileQueue.filter(f => f.status !== 'complete');\n      updateQueueUI(queueContainer, actionsContainer);\n    }, 2000);\n\n    // Check if processing started\n    if (result.processingStarted) {\n      props.onProcessingStart?.();\n      pollProcessingStatus(statusContainer);\n    }\n  } catch (error) {\n    pendingFiles.forEach(f => {\n      f.status = 'error';\n      f.error = error instanceof Error ? error.message : 'Upload failed';\n    });\n    updateQueueUI(queueContainer, actionsContainer);\n  } finally {\n    if (uploadBtn) uploadBtn.disabled = false;\n  }\n}\n\n/**\n * Check processing status\n */\nasync function checkProcessingStatus(container: HTMLElement): Promise<void> {\n  try {\n    const status = await documentsService.getProcessingStatus();\n    if (status.isProcessing || status.queueLength > 0) {\n      renderProcessingStatus(container, status);\n      pollProcessingStatus(container);\n    }\n  } catch {\n    // Ignore errors\n  }\n}\n\n/**\n * Poll processing status\n */\nlet pollingInterval: number | null = null;\n\nfunction pollProcessingStatus(container: HTMLElement): void {\n  if (pollingInterval) return;\n\n  pollingInterval = window.setInterval(async () => {\n    try {\n      const status = await documentsService.getProcessingStatus();\n      renderProcessingStatus(container, status);\n\n      if (!status.isProcessing && status.queueLength === 0) {\n        if (pollingInterval) {\n          clearInterval(pollingInterval);\n          pollingInterval = null;\n        }\n        setTimeout(() => {\n          container.style.display = 'none';\n        }, 3000);\n      }\n    } catch {\n      if (pollingInterval) {\n        clearInterval(pollingInterval);\n        pollingInterval = null;\n      }\n    }\n  }, 2000);\n}\n\n/**\n * Render processing status\n */\nfunction renderProcessingStatus(container: HTMLElement, status: ProcessingStatus): void {\n  container.style.display = 'block';\n\n  container.innerHTML = `\n    <div class=\"processing-header\">\n      <span class=\"processing-icon\">${status.isProcessing ? '' : ''}</span>\n      <span class=\"processing-title\">${status.isProcessing ? 'Processing...' : 'Complete'}</span>\n    </div>\n    <div class=\"processing-stats\">\n      <span>Completed: ${status.completedCount}</span>\n      <span>Pending: ${status.queueLength}</span>\n      ${status.errorCount > 0 ? `<span class=\"error\">Errors: ${status.errorCount}</span>` : ''}\n    </div>\n    ${status.processingFile ? `<div class=\"current-file\">Current: ${escapeHtml(status.processingFile)}</div>` : ''}\n    ${status.isProcessing ? `\n      <div class=\"processing-progress\">\n        <div class=\"progress-bar\">\n          <div class=\"progress-fill\" style=\"width: ${(status.completedCount / (status.completedCount + status.queueLength + 1)) * 100}%\"></div>\n        </div>\n      </div>\n    ` : ''}\n  `;\n}\n\n/**\n * Get file icon based on type\n */\nfunction getFileIcon(mimeType: string): string {\n  if (mimeType.startsWith('image/')) return '';\n  if (mimeType.startsWith('video/')) return '';\n  if (mimeType.startsWith('audio/')) return '';\n  if (mimeType === 'application/pdf') return '';\n  if (mimeType.includes('spreadsheet') || mimeType.includes('excel')) return '';\n  if (mimeType.includes('document') || mimeType.includes('word')) return '';\n  if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return '';\n  if (mimeType.includes('text')) return '';\n  return '';\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createFileUploader;\n","/**\n * Knowledge Graph Component\n * Interactive graph visualization using vis-network\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { graphService, GraphNode, GraphEdge, GraphStats } from '../services/graph';\nimport { toast } from '../services/toast';\n\nexport interface KnowledgeGraphProps {\n  onNodeClick?: (node: GraphNode) => void;\n  onEdgeClick?: (edge: GraphEdge) => void;\n  height?: number;\n}\n\ninterface VisNetwork {\n  setData: (data: { nodes: unknown[]; edges: unknown[] }) => void;\n  on: (event: string, callback: (params: unknown) => void) => void;\n  fit: () => void;\n  focus: (nodeId: string, options?: { scale?: number }) => void;\n  destroy: () => void;\n}\n\ndeclare global {\n  interface Window {\n    vis?: {\n      Network: new (container: HTMLElement, data: unknown, options: unknown) => VisNetwork;\n      DataSet: new (data: unknown[]) => unknown;\n    };\n  }\n}\n\nconst NODE_COLORS: Record<string, string> = {\n  Person: '#6366f1',\n  Document: '#22c55e',\n  Question: '#f59e0b',\n  Risk: '#ef4444',\n  Action: '#8b5cf6',\n  Decision: '#06b6d4',\n  Fact: '#84cc16',\n  Email: '#ec4899',\n  default: '#9ca3af',\n};\n\n/**\n * Create knowledge graph component\n */\nexport function createKnowledgeGraph(props: KnowledgeGraphProps = {}): HTMLElement {\n  const { height = 500 } = props;\n\n  const container = createElement('div', { className: 'knowledge-graph' });\n\n  container.innerHTML = `\n    <div class=\"graph-toolbar\">\n      <div class=\"graph-filters\">\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Person\"> People\n        </label>\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Document\"> Documents\n        </label>\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Question\"> Questions\n        </label>\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Risk\"> Risks\n        </label>\n      </div>\n      <div class=\"graph-actions\">\n        <input type=\"search\" id=\"graph-search\" class=\"search-input\" placeholder=\"Search nodes...\">\n        <button class=\"btn btn-sm\" id=\"graph-refresh\">Refresh</button>\n        <button class=\"btn btn-sm\" id=\"graph-fit\">Fit</button>\n      </div>\n    </div>\n    <div class=\"graph-container\" id=\"graph-container\" style=\"height: ${height}px;\">\n      <div class=\"graph-loading\">Loading graph...</div>\n    </div>\n    <div class=\"graph-stats\" id=\"graph-stats\"></div>\n    <div class=\"node-details\" id=\"node-details\" style=\"display: none;\"></div>\n  `;\n\n  // Initialize graph\n  initGraph(container, props);\n\n  return container;\n}\n\n/**\n * Initialize graph visualization\n */\nasync function initGraph(container: HTMLElement, props: KnowledgeGraphProps): Promise<void> {\n  const graphContainer = container.querySelector('#graph-container') as HTMLElement;\n  const statsContainer = container.querySelector('#graph-stats') as HTMLElement;\n\n  // Check if vis-network is available\n  if (!window.vis) {\n    graphContainer.innerHTML = `\n      <div class=\"graph-fallback\">\n        <p>Graph visualization requires vis-network library</p>\n        <p class=\"text-muted\">Add vis-network to enable interactive graph</p>\n      </div>\n    `;\n    await loadStats(statsContainer);\n    return;\n  }\n\n  try {\n    // Load graph data\n    const { nodes, edges } = await graphService.getVisualizationData();\n    \n    if (nodes.length === 0) {\n      graphContainer.innerHTML = `\n        <div class=\"graph-empty\">\n          <p>No graph data available</p>\n          <p class=\"text-muted\">Process some documents to populate the knowledge graph</p>\n        </div>\n      `;\n      return;\n    }\n\n    // Create vis-network\n    const network = createVisNetwork(graphContainer, nodes, edges, props);\n    \n    // Bind toolbar events\n    bindToolbarEvents(container, network, nodes, props);\n\n    // Load stats\n    await loadStats(statsContainer);\n\n  } catch (error) {\n    graphContainer.innerHTML = `\n      <div class=\"graph-error\">\n        <p>Failed to load graph</p>\n        <button class=\"btn btn-sm\" id=\"retry-graph\">Retry</button>\n      </div>\n    `;\n    const retryBtn = graphContainer.querySelector('#retry-graph');\n    if (retryBtn) {\n      on(retryBtn as HTMLElement, 'click', () => initGraph(container, props));\n    }\n  }\n}\n\n/**\n * Create vis-network instance\n */\nfunction createVisNetwork(\n  container: HTMLElement,\n  nodes: GraphNode[],\n  edges: GraphEdge[],\n  props: KnowledgeGraphProps\n): VisNetwork {\n  container.innerHTML = ''; // Clear loading\n\n  const visNodes = nodes.map(n => ({\n    id: n.id,\n    label: n.label || n.name || n.id,\n    color: NODE_COLORS[n.type] || NODE_COLORS.default,\n    title: `${n.type}: ${n.label || n.name || n.id}`,\n    shape: 'dot',\n    size: getNodeSize(n),\n  }));\n\n  const visEdges = edges.map(e => ({\n    from: e.source,\n    to: e.target,\n    label: e.type,\n    arrows: 'to',\n    color: { color: '#9ca3af', opacity: 0.6 },\n  }));\n\n  const options = {\n    nodes: {\n      borderWidth: 2,\n      shadow: true,\n      font: {\n        size: 12,\n        color: getComputedStyle(document.documentElement).getPropertyValue('--color-text').trim() || '#333',\n      },\n    },\n    edges: {\n      width: 1,\n      shadow: false,\n      smooth: {\n        type: 'continuous',\n      },\n      font: {\n        size: 10,\n        color: '#9ca3af',\n      },\n    },\n    physics: {\n      stabilization: {\n        iterations: 100,\n      },\n      barnesHut: {\n        gravitationalConstant: -5000,\n        springLength: 150,\n      },\n    },\n    interaction: {\n      hover: true,\n      tooltipDelay: 200,\n    },\n  };\n\n  const network = new window.vis!.Network(container, {\n    nodes: new window.vis!.DataSet(visNodes),\n    edges: new window.vis!.DataSet(visEdges),\n  }, options);\n\n  // Node click handler\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  network.on('click', (params: any) => {\n    if (params.nodes && params.nodes.length > 0) {\n      const nodeId = params.nodes[0];\n      const node = nodes.find(n => n.id === nodeId);\n      if (node && props.onNodeClick) {\n        props.onNodeClick(node);\n      }\n      showNodeDetails(container, node);\n    }\n  });\n\n  return network;\n}\n\n/**\n * Get node size based on connections\n */\nfunction getNodeSize(node: GraphNode): number {\n  const connections = (node as unknown as { connections?: number }).connections || 1;\n  return Math.min(10 + connections * 2, 30);\n}\n\n/**\n * Bind toolbar events\n */\nfunction bindToolbarEvents(\n  container: HTMLElement,\n  network: VisNetwork,\n  nodes: GraphNode[],\n  props: KnowledgeGraphProps\n): void {\n  // Search\n  const searchInput = container.querySelector('#graph-search') as HTMLInputElement;\n  on(searchInput, 'input', () => {\n    const query = searchInput.value.toLowerCase();\n    const matchingNode = nodes.find(n => \n      (n.label || n.name || n.id).toLowerCase().includes(query)\n    );\n    if (matchingNode) {\n      network.focus(matchingNode.id, { scale: 1.5 });\n    }\n  });\n\n  // Refresh\n  const refreshBtn = container.querySelector('#graph-refresh');\n  if (refreshBtn) {\n    on(refreshBtn as HTMLElement, 'click', () => {\n      initGraph(container, props);\n    });\n  }\n\n  // Fit\n  const fitBtn = container.querySelector('#graph-fit');\n  if (fitBtn) {\n    on(fitBtn as HTMLElement, 'click', () => {\n      network.fit();\n    });\n  }\n\n  // Filters\n  container.querySelectorAll('.filter-item input').forEach(checkbox => {\n    on(checkbox as HTMLElement, 'change', () => {\n      // TODO: Implement filtering\n      toast.info('Filtering not yet implemented');\n    });\n  });\n}\n\n/**\n * Show node details\n */\nfunction showNodeDetails(container: HTMLElement, node?: GraphNode): void {\n  const detailsContainer = container.querySelector('#node-details') as HTMLElement;\n  \n  if (!node) {\n    detailsContainer.style.display = 'none';\n    return;\n  }\n\n  detailsContainer.style.display = 'block';\n  detailsContainer.innerHTML = `\n    <div class=\"details-header\">\n      <span class=\"node-type\" style=\"background: ${NODE_COLORS[node.type] || NODE_COLORS.default}\">${node.type}</span>\n      <span class=\"node-label\">${escapeHtml(node.label || node.name || node.id)}</span>\n      <button class=\"btn-icon close-details\"></button>\n    </div>\n    ${node.properties ? `\n      <div class=\"details-properties\">\n        ${Object.entries(node.properties).map(([key, value]) => `\n          <div class=\"property\">\n            <span class=\"property-key\">${escapeHtml(key)}:</span>\n            <span class=\"property-value\">${escapeHtml(String(value))}</span>\n          </div>\n        `).join('')}\n      </div>\n    ` : ''}\n  `;\n\n  const closeBtn = detailsContainer.querySelector('.close-details');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => {\n      detailsContainer.style.display = 'none';\n    });\n  }\n}\n\n/**\n * Load graph stats\n */\nasync function loadStats(container: HTMLElement): Promise<void> {\n  try {\n    const stats = await graphService.getStats();\n    renderStats(container, stats);\n  } catch {\n    container.innerHTML = '';\n  }\n}\n\n/**\n * Render stats\n */\nfunction renderStats(container: HTMLElement, stats: GraphStats): void {\n  container.innerHTML = `\n    <div class=\"stat-item\">\n      <span class=\"stat-value\">${stats.nodeCount}</span>\n      <span class=\"stat-label\">Nodes</span>\n    </div>\n    <div class=\"stat-item\">\n      <span class=\"stat-value\">${stats.edgeCount}</span>\n      <span class=\"stat-label\">Edges</span>\n    </div>\n    ${stats.nodeTypes ? Object.entries(stats.nodeTypes).map(([type, count]) => `\n      <div class=\"stat-item type-${type.toLowerCase()}\">\n        <span class=\"stat-value\">${count}</span>\n        <span class=\"stat-label\">${type}</span>\n      </div>\n    `).join('') : ''}\n  `;\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createKnowledgeGraph;\n","/**\n * Timeline Component\n * Vertical timeline with events\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { timelineService, TimelineEvent } from '../services/graph';\nimport { formatRelativeTime, formatDate } from '../utils/format';\n\nexport interface TimelineProps {\n  days?: number;\n  onEventClick?: (event: TimelineEvent) => void;\n}\n\n/**\n * Create timeline component\n */\nexport function createTimeline(props: TimelineProps = {}): HTMLElement {\n  const { days = 30 } = props;\n\n  const container = createElement('div', { className: 'timeline-container' });\n\n  container.innerHTML = `\n    <div class=\"timeline-header\">\n      <h3>Timeline</h3>\n      <select id=\"timeline-days\" class=\"filter-select\">\n        <option value=\"7\" ${days === 7 ? 'selected' : ''}>Last 7 days</option>\n        <option value=\"14\" ${days === 14 ? 'selected' : ''}>Last 14 days</option>\n        <option value=\"30\" ${days === 30 ? 'selected' : ''}>Last 30 days</option>\n        <option value=\"90\" ${days === 90 ? 'selected' : ''}>Last 90 days</option>\n      </select>\n    </div>\n    <div class=\"timeline-filters\">\n      <button class=\"filter-btn active\" data-type=\"all\">All</button>\n      <button class=\"filter-btn\" data-type=\"document\">Documents</button>\n      <button class=\"filter-btn\" data-type=\"question\">Questions</button>\n      <button class=\"filter-btn\" data-type=\"decision\">Decisions</button>\n      <button class=\"filter-btn\" data-type=\"risk\">Risks</button>\n    </div>\n    <div class=\"timeline-content\" id=\"timeline-content\">\n      <div class=\"loading\">Loading timeline...</div>\n    </div>\n  `;\n\n  // Bind events\n  const daysSelect = container.querySelector('#timeline-days') as HTMLSelectElement;\n  on(daysSelect, 'change', () => {\n    loadTimeline(container, parseInt(daysSelect.value), props);\n  });\n\n  const filterBtns = container.querySelectorAll('.filter-btn');\n  filterBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      filterBtns.forEach(b => b.classList.remove('active'));\n      btn.classList.add('active');\n      filterEvents(container, btn.getAttribute('data-type') || 'all');\n    });\n  });\n\n  // Initial load\n  loadTimeline(container, days, props);\n\n  return container;\n}\n\n/**\n * Load timeline events\n */\nasync function loadTimeline(container: HTMLElement, days: number, props: TimelineProps): Promise<void> {\n  const content = container.querySelector('#timeline-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const data = await timelineService.getAll({ limit: days * 10 }); // Approximate events per day\n    renderTimeline(content, data.events || [], props);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load timeline</div>';\n  }\n}\n\n/**\n * Render timeline\n */\nfunction renderTimeline(container: HTMLElement, events: TimelineEvent[], props: TimelineProps): void {\n  if (events.length === 0) {\n    container.innerHTML = '<div class=\"empty-state\">No events in this period</div>';\n    return;\n  }\n\n  // Group by date\n  const grouped = groupByDate(events);\n\n  container.innerHTML = `\n    <div class=\"timeline\">\n      ${Object.entries(grouped).map(([date, dayEvents]) => `\n        <div class=\"timeline-day\">\n          <div class=\"timeline-date\">${formatDate(date)}</div>\n          ${dayEvents.map(event => `\n            <div class=\"timeline-event\" data-type=\"${event.type}\" data-id=\"${event.id}\">\n              <div class=\"event-marker ${event.type}\"></div>\n              <div class=\"event-content\">\n                <div class=\"event-header\">\n                  <span class=\"event-type\">${event.type}</span>\n                  <span class=\"event-time\">${formatTime(event.date)}</span>\n                </div>\n                <div class=\"event-title\">${escapeHtml(event.title)}</div>\n                ${event.description ? `<div class=\"event-description\">${escapeHtml(event.description)}</div>` : ''}\n                ${event.user ? `<div class=\"event-user\">by ${escapeHtml(event.user)}</div>` : ''}\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind click events\n  container.querySelectorAll('.timeline-event').forEach(el => {\n    on(el as HTMLElement, 'click', () => {\n      const id = el.getAttribute('data-id');\n      const event = events.find(e => String(e.id) === id);\n      if (event && props.onEventClick) {\n        props.onEventClick(event);\n      }\n    });\n  });\n}\n\n/**\n * Group events by date\n */\nfunction groupByDate(events: TimelineEvent[]): Record<string, TimelineEvent[]> {\n  const grouped: Record<string, TimelineEvent[]> = {};\n  \n  events.forEach(event => {\n    const date = event.date.split('T')[0];\n    if (!grouped[date]) grouped[date] = [];\n    grouped[date].push(event);\n  });\n\n  // Sort by date descending\n  return Object.fromEntries(\n    Object.entries(grouped).sort(([a], [b]) => b.localeCompare(a))\n  );\n}\n\n/**\n * Filter events by type\n */\nfunction filterEvents(container: HTMLElement, type: string): void {\n  const events = container.querySelectorAll('.timeline-event');\n  events.forEach(el => {\n    if (type === 'all' || el.getAttribute('data-type') === type) {\n      (el as HTMLElement).style.display = '';\n    } else {\n      (el as HTMLElement).style.display = 'none';\n    }\n  });\n\n  // Hide empty days\n  container.querySelectorAll('.timeline-day').forEach(day => {\n    const visibleEvents = day.querySelectorAll('.timeline-event:not([style*=\"display: none\"])');\n    (day as HTMLElement).style.display = visibleEvents.length > 0 ? '' : 'none';\n  });\n}\n\n/**\n * Format time\n */\nfunction formatTime(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createTimeline;\n","/**\n * TimelinePanel - SOTA Timeline Component\n * \n * Features:\n * - Sticky date headers\n * - \"Today\" line marker\n * - Density toggle (compact, comfortable, spacious)\n * - Rich event cards with avatars, icons, status badges\n * - Relative time formatting with tooltip\n * - In-timeline search\n * - Keyboard navigation (J/K, Enter, /, Esc)\n * - Type filters with counts\n * - Skeleton loading\n * - Empty states with illustrations\n * - Export options\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { getTimeline, TimelineEvent, TimelineData } from '../services/graph';\nimport { formatRelativeTime, formatDate, formatDateTime } from '../utils/format';\n\n// ============================================\n// TYPES\n// ============================================\n\nexport interface TimelinePanelProps {\n  onEventClick?: (event: TimelineEvent) => void;\n  containerElement?: HTMLElement;\n}\n\ninterface EventTypeConfig {\n  label: string;\n  icon: string;\n  color: string;\n}\n\ntype Density = 'compact' | 'comfortable' | 'spacious';\n\n// ============================================\n// CONSTANTS\n// ============================================\n\nconst EVENT_TYPES: Record<string, EventTypeConfig> = {\n  document: { label: 'Documents', icon: '', color: '#1abc9c' },\n  transcript: { label: 'Transcripts', icon: '', color: '#8b5cf6' },\n  email: { label: 'Emails', icon: '', color: '#6366f1' },\n  conversation: { label: 'Conversations', icon: '', color: '#ec4899' },\n  chat_session: { label: 'Chat Sessions', icon: '', color: '#0ea5e9' },\n  fact: { label: 'Facts', icon: '', color: '#3b82f6' },\n  question: { label: 'Questions', icon: '', color: '#f59e0b' },\n  question_answered: { label: 'Answered', icon: '', color: '#10b981' },\n  decision: { label: 'Decisions', icon: '', color: '#3498db' },\n  risk: { label: 'Risks', icon: '', color: '#f39c12' },\n  action: { label: 'Actions', icon: '', color: '#9b59b6' },\n  action_completed: { label: 'Completed', icon: '', color: '#2ecc71' },\n  deadline: { label: 'Deadlines', icon: '', color: '#9b59b6' },\n};\n\nconst DAY_PERIODS = [\n  { label: 'Last 7 days', days: 7 },\n  { label: 'Last 14 days', days: 14 },\n  { label: 'Last 30 days', days: 30 },\n  { label: 'Last 90 days', days: 90 },\n  { label: 'All time', days: 365 },\n];\n\n// ============================================\n// STATE\n// ============================================\n\nlet currentDays = 30;\nlet currentDensity: Density = 'comfortable';\nlet currentTypeFilters: string[] = [];\nlet currentSearch = '';\nlet allEvents: TimelineEvent[] = [];\nlet focusedEventIndex = -1;\n\n// ============================================\n// MAIN COMPONENT\n// ============================================\n\n/**\n * Create SOTA Timeline Panel\n */\nexport function createTimelinePanel(props: TimelinePanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'timeline-panel sot-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Timeline</h2>\n        <span class=\"panel-count\" id=\"timeline-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <div class=\"timeline-search-wrapper\">\n          <input type=\"text\" id=\"timeline-search\" class=\"timeline-search\" placeholder=\"Search events...\" />\n        </div>\n        <select id=\"timeline-period\" class=\"filter-select\">\n          ${DAY_PERIODS.map(p => `<option value=\"${p.days}\" ${p.days === currentDays ? 'selected' : ''}>${p.label}</option>`).join('')}\n        </select>\n        <div class=\"density-toggle\" title=\"View density\">\n          <button class=\"density-btn ${currentDensity === 'compact' ? 'active' : ''}\" data-density=\"compact\" title=\"Compact\"></button>\n          <button class=\"density-btn ${currentDensity === 'comfortable' ? 'active' : ''}\" data-density=\"comfortable\" title=\"Comfortable\"></button>\n          <button class=\"density-btn ${currentDensity === 'spacious' ? 'active' : ''}\" data-density=\"spacious\" title=\"Spacious\"></button>\n        </div>\n        <div class=\"timeline-actions-menu\">\n          <button class=\"btn btn-secondary btn-sm timeline-export-btn\" title=\"Export\"></button>\n        </div>\n      </div>\n    </div>\n    <div class=\"timeline-filters\" id=\"timeline-type-filters\">\n      <button class=\"filter-chip active\" data-type=\"\">All</button>\n    </div>\n    <div class=\"timeline-content\" id=\"timeline-content\">\n      ${renderSkeletons()}\n    </div>\n    <div class=\"timeline-footer\" id=\"timeline-footer\" style=\"display:none;\">\n      <button class=\"btn btn-secondary btn-sm\" id=\"timeline-load-more\">Load more</button>\n    </div>\n  `;\n\n  bindEvents(panel, props);\n  loadTimeline(panel, props);\n\n  return panel;\n}\n\n// ============================================\n// EVENT BINDING\n// ============================================\n\nfunction bindEvents(panel: HTMLElement, props: TimelinePanelProps): void {\n  // Period selector\n  const periodSelect = panel.querySelector('#timeline-period') as HTMLSelectElement;\n  on(periodSelect, 'change', () => {\n    currentDays = parseInt(periodSelect.value);\n    loadTimeline(panel, props);\n  });\n\n  // Density toggle\n  const densityBtns = panel.querySelectorAll('.density-btn');\n  densityBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      densityBtns.forEach(b => b.classList.remove('active'));\n      btn.classList.add('active');\n      currentDensity = btn.getAttribute('data-density') as Density;\n      updateDensity(panel);\n    });\n  });\n\n  // Search\n  const searchInput = panel.querySelector('#timeline-search') as HTMLInputElement;\n  let searchTimeout: ReturnType<typeof setTimeout>;\n  on(searchInput, 'input', () => {\n    clearTimeout(searchTimeout);\n    searchTimeout = setTimeout(() => {\n      currentSearch = searchInput.value.toLowerCase();\n      renderFilteredEvents(panel, props);\n    }, 200);\n  });\n\n  // Export\n  const exportBtn = panel.querySelector('.timeline-export-btn');\n  if (exportBtn) {\n    on(exportBtn as HTMLElement, 'click', () => showExportMenu(panel));\n  }\n\n  // Keyboard navigation\n  on(panel, 'keydown', (e: KeyboardEvent) => {\n    const content = panel.querySelector('#timeline-content');\n    if (!content) return;\n\n    if (e.key === 'j' || e.key === 'ArrowDown') {\n      e.preventDefault();\n      navigateEvents(panel, 1, props);\n    } else if (e.key === 'k' || e.key === 'ArrowUp') {\n      e.preventDefault();\n      navigateEvents(panel, -1, props);\n    } else if (e.key === 'Enter') {\n      e.preventDefault();\n      selectFocusedEvent(panel, props);\n    } else if (e.key === '/') {\n      e.preventDefault();\n      searchInput.focus();\n    } else if (e.key === 'Escape') {\n      searchInput.blur();\n      focusedEventIndex = -1;\n      clearEventFocus(panel);\n    }\n  });\n\n  // Make panel focusable for keyboard events\n  panel.setAttribute('tabindex', '0');\n}\n\n// ============================================\n// DATA LOADING\n// ============================================\n\nasync function loadTimeline(panel: HTMLElement, props: TimelinePanelProps): Promise<void> {\n  const content = panel.querySelector('#timeline-content') as HTMLElement;\n  content.innerHTML = renderSkeletons();\n\n  try {\n    const endDate = new Date();\n    const startDate = new Date();\n    startDate.setDate(startDate.getDate() - currentDays);\n\n    const data: TimelineData = await getTimeline({\n      startDate: startDate.toISOString().split('T')[0],\n      endDate: endDate.toISOString().split('T')[0],\n      limit: 500,\n    });\n\n    allEvents = data.events || [];\n    updateTypeCounts(panel, allEvents);\n    renderFilteredEvents(panel, props);\n    updateCount(panel, allEvents.length);\n  } catch (error) {\n    console.error('Failed to load timeline:', error);\n    content.innerHTML = renderError();\n  }\n}\n\n// ============================================\n// RENDERING\n// ============================================\n\nfunction renderFilteredEvents(panel: HTMLElement, props: TimelinePanelProps): void {\n  let filtered = [...allEvents];\n\n  // Apply type filter\n  if (currentTypeFilters.length > 0) {\n    filtered = filtered.filter(e => currentTypeFilters.includes(e.type));\n  }\n\n  // Apply search filter\n  if (currentSearch) {\n    filtered = filtered.filter(e => {\n      const title = (e.title || '').toLowerCase();\n      const content = (e.content || e.description || '').toLowerCase();\n      const owner = (e.owner || e.user || e.actor || '').toLowerCase();\n      return title.includes(currentSearch) || content.includes(currentSearch) || owner.includes(currentSearch);\n    });\n  }\n\n  const content = panel.querySelector('#timeline-content') as HTMLElement;\n\n  if (filtered.length === 0) {\n    content.innerHTML = renderEmptyState();\n    return;\n  }\n\n  // Group by date\n  const grouped = groupByDate(filtered);\n  const today = new Date().toISOString().split('T')[0];\n\n  content.innerHTML = `\n    <div class=\"timeline-list density-${currentDensity}\">\n      ${Object.entries(grouped).map(([date, events]) => `\n        <div class=\"timeline-day\" data-date=\"${date}\">\n          <div class=\"timeline-date-header sticky\">\n            <span class=\"date-label\">${formatDateLabel(date)}</span>\n            <span class=\"event-count\">${events.length} event${events.length === 1 ? '' : 's'}</span>\n          </div>\n          ${date === today ? '<div class=\"today-marker\"><span>Today</span></div>' : ''}\n          <div class=\"timeline-day-events\">\n            ${events.map((event, idx) => renderEventCard(event, idx)).join('')}\n          </div>\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  bindEventCardClicks(panel, filtered, props);\n  focusedEventIndex = -1;\n}\n\nfunction renderEventCard(event: TimelineEvent, index: number): string {\n  const config = EVENT_TYPES[event.type] || { label: event.type, icon: '', color: '#888' };\n  const icon = event.icon || config.icon;\n  const color = event.color || config.color;\n  const owner = event.owner || event.user || event.actor;\n  const initials = owner ? getInitials(owner) : '';\n  const statusBadge = event.status ? `<span class=\"status-badge status-${event.status}\">${event.status}</span>` : '';\n  const time = event.date ? formatTime(event.date) : '';\n  const relativeTime = event.date ? formatRelativeTime(event.date) : '';\n  const fullDateTime = event.date ? formatDateTime(event.date) : '';\n\n  return `\n    <div class=\"timeline-event\" data-id=\"${event.id}\" data-index=\"${index}\" tabindex=\"0\">\n      <div class=\"event-avatar\" style=\"background: ${color}20; color: ${color};\">\n        ${initials || icon}\n      </div>\n      <div class=\"event-body\">\n        <div class=\"event-header\">\n          <span class=\"event-type-badge\" style=\"background: ${color}20; color: ${color};\">\n            <span class=\"type-icon\">${icon}</span>\n            ${config.label}\n          </span>\n          ${statusBadge}\n          <span class=\"event-time\" title=\"${fullDateTime}\">${relativeTime}</span>\n        </div>\n        <div class=\"event-title\">${escapeHtml(event.title)}</div>\n        ${event.content || event.description ? `<div class=\"event-content\">${escapeHtml(truncate(event.content || event.description || '', 150))}</div>` : ''}\n        ${owner ? `<div class=\"event-owner\"><span class=\"owner-name\">by ${escapeHtml(owner)}</span></div>` : ''}\n      </div>\n      <div class=\"event-meta\">\n        <span class=\"meta-time\">${time}</span>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderSkeletons(): string {\n  const skeletonCount = 8;\n  return `\n    <div class=\"timeline-skeletons\">\n      ${Array(skeletonCount).fill(0).map(() => `\n        <div class=\"skeleton-event\">\n          <div class=\"skeleton-avatar shimmer\"></div>\n          <div class=\"skeleton-body\">\n            <div class=\"skeleton-line short shimmer\"></div>\n            <div class=\"skeleton-line long shimmer\"></div>\n            <div class=\"skeleton-line medium shimmer\"></div>\n          </div>\n        </div>\n      `).join('')}\n    </div>\n  `;\n}\n\nfunction renderEmptyState(): string {\n  return `\n    <div class=\"timeline-empty\">\n      <div class=\"empty-illustration\">\n        <svg width=\"120\" height=\"120\" viewBox=\"0 0 120 120\" fill=\"none\">\n          <circle cx=\"60\" cy=\"60\" r=\"50\" fill=\"var(--bg-card)\" stroke=\"var(--border)\" stroke-width=\"2\"/>\n          <path d=\"M60 30V60L80 75\" stroke=\"var(--accent)\" stroke-width=\"4\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          <circle cx=\"60\" cy=\"60\" r=\"6\" fill=\"var(--accent)\"/>\n        </svg>\n      </div>\n      <h3>No events found</h3>\n      <p>Try adjusting your filters or date range</p>\n      <div class=\"empty-actions\">\n        <button class=\"btn btn-primary btn-sm\" id=\"empty-clear-filters\">Clear Filters</button>\n      </div>\n    </div>\n  `;\n}\n\nfunction renderError(): string {\n  return `\n    <div class=\"timeline-error\">\n      <div class=\"error-icon\"></div>\n      <h3>Failed to load timeline</h3>\n      <p>Please try again later</p>\n      <button class=\"btn btn-primary btn-sm\" id=\"timeline-retry\">Retry</button>\n    </div>\n  `;\n}\n\n// ============================================\n// TYPE FILTERS\n// ============================================\n\nfunction updateTypeCounts(panel: HTMLElement, events: TimelineEvent[]): void {\n  const counts: Record<string, number> = {};\n  events.forEach(e => {\n    counts[e.type] = (counts[e.type] || 0) + 1;\n  });\n\n  const container = panel.querySelector('#timeline-type-filters') as HTMLElement;\n  const typesWithEvents = Object.keys(counts).filter(type => counts[type] > 0);\n\n  container.innerHTML = `\n    <button class=\"filter-chip ${currentTypeFilters.length === 0 ? 'active' : ''}\" data-type=\"\">All (${events.length})</button>\n    ${typesWithEvents.map(type => {\n      const config = EVENT_TYPES[type] || { label: type, icon: '', color: '#888' };\n      const isActive = currentTypeFilters.includes(type);\n      return `\n        <button class=\"filter-chip ${isActive ? 'active' : ''}\" data-type=\"${type}\" style=\"--chip-color: ${config.color}\">\n          ${config.icon} ${config.label} (${counts[type]})\n        </button>\n      `;\n    }).join('')}\n  `;\n\n  // Bind filter clicks\n  const chips = container.querySelectorAll('.filter-chip');\n  chips.forEach(chip => {\n    on(chip as HTMLElement, 'click', () => {\n      const type = chip.getAttribute('data-type') || '';\n      if (!type) {\n        currentTypeFilters = [];\n        chips.forEach(c => c.classList.remove('active'));\n        chip.classList.add('active');\n      } else {\n        const allChip = container.querySelector('[data-type=\"\"]');\n        allChip?.classList.remove('active');\n\n        if (currentTypeFilters.includes(type)) {\n          currentTypeFilters = currentTypeFilters.filter(t => t !== type);\n          chip.classList.remove('active');\n        } else {\n          currentTypeFilters.push(type);\n          chip.classList.add('active');\n        }\n\n        if (currentTypeFilters.length === 0) {\n          allChip?.classList.add('active');\n        }\n      }\n      renderFilteredEvents(panel, {});\n    });\n  });\n}\n\n// ============================================\n// NAVIGATION & INTERACTION\n// ============================================\n\nfunction bindEventCardClicks(panel: HTMLElement, events: TimelineEvent[], props: TimelinePanelProps): void {\n  const cards = panel.querySelectorAll('.timeline-event');\n  cards.forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const id = card.getAttribute('data-id');\n      const event = events.find(e => String(e.id) === id);\n      if (event && props.onEventClick) {\n        props.onEventClick(event);\n      }\n    });\n  });\n\n  // Clear filters button in empty state\n  const clearBtn = panel.querySelector('#empty-clear-filters');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', () => {\n      currentTypeFilters = [];\n      currentSearch = '';\n      const searchInput = panel.querySelector('#timeline-search') as HTMLInputElement;\n      if (searchInput) searchInput.value = '';\n      updateTypeCounts(panel, allEvents);\n      renderFilteredEvents(panel, props);\n    });\n  }\n\n  // Retry button in error state\n  const retryBtn = panel.querySelector('#timeline-retry');\n  if (retryBtn) {\n    on(retryBtn as HTMLElement, 'click', () => loadTimeline(panel, props));\n  }\n}\n\nfunction navigateEvents(panel: HTMLElement, direction: number, props: TimelinePanelProps): void {\n  const cards = panel.querySelectorAll('.timeline-event');\n  if (cards.length === 0) return;\n\n  clearEventFocus(panel);\n  focusedEventIndex = Math.max(0, Math.min(cards.length - 1, focusedEventIndex + direction));\n  \n  const targetCard = cards[focusedEventIndex] as HTMLElement;\n  if (targetCard) {\n    targetCard.classList.add('focused');\n    targetCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n    targetCard.focus();\n  }\n}\n\nfunction selectFocusedEvent(panel: HTMLElement, props: TimelinePanelProps): void {\n  const cards = panel.querySelectorAll('.timeline-event');\n  if (focusedEventIndex >= 0 && focusedEventIndex < cards.length) {\n    const card = cards[focusedEventIndex] as HTMLElement;\n    card.click();\n  }\n}\n\nfunction clearEventFocus(panel: HTMLElement): void {\n  panel.querySelectorAll('.timeline-event.focused').forEach(el => el.classList.remove('focused'));\n}\n\nfunction updateDensity(panel: HTMLElement): void {\n  const list = panel.querySelector('.timeline-list');\n  if (list) {\n    list.className = `timeline-list density-${currentDensity}`;\n  }\n}\n\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#timeline-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n// ============================================\n// EXPORT MENU\n// ============================================\n\nfunction showExportMenu(panel: HTMLElement): void {\n  const existing = panel.querySelector('.export-menu');\n  if (existing) {\n    existing.remove();\n    return;\n  }\n\n  const menu = createElement('div', { className: 'export-menu dropdown-menu' });\n  menu.innerHTML = `\n    <button class=\"dropdown-item\" data-format=\"csv\"> Export CSV</button>\n    <button class=\"dropdown-item\" data-format=\"json\"> Export JSON</button>\n  `;\n\n  const exportBtn = panel.querySelector('.timeline-export-btn');\n  if (exportBtn) {\n    exportBtn.appendChild(menu);\n  }\n\n  menu.querySelectorAll('.dropdown-item').forEach(item => {\n    on(item as HTMLElement, 'click', () => {\n      const format = item.getAttribute('data-format');\n      exportTimeline(format || 'csv');\n      menu.remove();\n    });\n  });\n\n  // Close on outside click\n  setTimeout(() => {\n    const closeHandler = (e: Event) => {\n      if (!menu.contains(e.target as Node)) {\n        menu.remove();\n        document.removeEventListener('click', closeHandler);\n      }\n    };\n    document.addEventListener('click', closeHandler);\n  }, 0);\n}\n\nfunction exportTimeline(format: string): void {\n  const data = allEvents.map(e => ({\n    date: e.date,\n    type: e.type,\n    title: e.title,\n    content: e.content || e.description,\n    owner: e.owner || e.user || e.actor,\n    status: e.status,\n  }));\n\n  let content: string;\n  let filename: string;\n  let mimeType: string;\n\n  if (format === 'csv') {\n    const headers = ['Date', 'Type', 'Title', 'Content', 'Owner', 'Status'];\n    const rows = data.map(d => [\n      d.date, d.type, `\"${(d.title || '').replace(/\"/g, '\"\"')}\"`,\n      `\"${(d.content || '').replace(/\"/g, '\"\"')}\"`,\n      `\"${(d.owner || '').replace(/\"/g, '\"\"')}\"`, d.status || ''\n    ].join(','));\n    content = [headers.join(','), ...rows].join('\\n');\n    filename = `timeline-${new Date().toISOString().split('T')[0]}.csv`;\n    mimeType = 'text/csv';\n  } else {\n    content = JSON.stringify(data, null, 2);\n    filename = `timeline-${new Date().toISOString().split('T')[0]}.json`;\n    mimeType = 'application/json';\n  }\n\n  const blob = new Blob([content], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n\n// ============================================\n// UTILITIES\n// ============================================\n\nfunction groupByDate(events: TimelineEvent[]): Record<string, TimelineEvent[]> {\n  const grouped: Record<string, TimelineEvent[]> = {};\n  \n  events.forEach(event => {\n    const date = event.date ? event.date.split('T')[0] : 'unknown';\n    if (!grouped[date]) grouped[date] = [];\n    grouped[date].push(event);\n  });\n\n  // Sort by date descending\n  return Object.fromEntries(\n    Object.entries(grouped).sort(([a], [b]) => b.localeCompare(a))\n  );\n}\n\nfunction formatDateLabel(dateStr: string): string {\n  const date = new Date(dateStr + 'T00:00:00');\n  const today = new Date();\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n  const thisWeekStart = new Date(today);\n  thisWeekStart.setDate(today.getDate() - today.getDay());\n\n  const todayStr = today.toISOString().split('T')[0];\n  const yesterdayStr = yesterday.toISOString().split('T')[0];\n\n  if (dateStr === todayStr) return 'Today';\n  if (dateStr === yesterdayStr) return 'Yesterday';\n  if (date >= thisWeekStart) return 'This week - ' + formatDate(date, { weekday: 'long' });\n\n  return formatDate(date, { weekday: 'short', month: 'short', day: 'numeric' });\n}\n\nfunction formatTime(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });\n}\n\nfunction getInitials(name: string): string {\n  return name\n    .split(/\\s+/)\n    .map(part => part.charAt(0).toUpperCase())\n    .slice(0, 2)\n    .join('');\n}\n\nfunction truncate(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text;\n  return text.slice(0, maxLength - 3) + '...';\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createTimelinePanel;\n","/**\n * Billing Service\n * API client for project billing and cost control\n */\n\nimport { http } from './api';\n\n// ============================================\n// TYPES\n// ============================================\n\nexport interface ProjectBillingSummary {\n  balance_eur: number;\n  unlimited_balance: boolean;\n  period_key: string;\n  tokens_this_period: number;\n  provider_cost_this_period: number;\n  billable_cost_this_period: number;\n  requests_this_period: number;\n  current_tier_name: string | null;\n  current_markup_percent: number;\n  balance_percent_used: number;\n}\n\nexport interface ProjectBillingOverview {\n  project_id: string;\n  project_name: string;\n  balance_eur: number;\n  unlimited_balance: boolean;\n  tokens_this_period: number;\n  billable_cost_this_period: number;\n  is_blocked: boolean;\n  current_tier_name: string | null;\n}\n\nexport interface PricingConfig {\n  id: string;\n  scope: 'global' | 'project';\n  project_id: string | null;\n  fixed_markup_percent: number;\n  period_type: 'monthly' | 'weekly';\n  usd_to_eur_rate: number;\n  is_active: boolean;\n  created_at: string;\n  updated_at: string;\n  pricing_tiers?: PricingTier[];\n}\n\nexport interface PricingTier {\n  id: string;\n  pricing_config_id: string;\n  token_limit: number | null;\n  markup_percent: number;\n  name: string | null;\n  tier_order: number;\n}\n\nexport interface BalanceTransaction {\n  id: string;\n  project_id: string;\n  transaction_type: 'credit' | 'debit' | 'adjustment' | 'refund';\n  amount_eur: number;\n  balance_before: number;\n  balance_after: number;\n  llm_request_id: string | null;\n  description: string | null;\n  performed_by: string | null;\n  created_at: string;\n}\n\nexport interface BalanceCheckResult {\n  allowed: boolean;\n  reason?: string;\n  balance_eur: number;\n  unlimited: boolean;\n  tokens_in_period: number;\n  current_tier_name?: string;\n  current_markup_percent: number;\n}\n\n// ============================================\n// ADMIN FUNCTIONS (Superadmin only)\n// ============================================\n\n/**\n * Get billing overview for all projects\n */\nexport async function getAllProjectsBilling(): Promise<ProjectBillingOverview[]> {\n  try {\n    const response = await http.get<{ success: boolean; projects: ProjectBillingOverview[] }>(\n      '/api/admin/billing/projects'\n    );\n    return response.data?.projects || [];\n  } catch (error) {\n    console.error('[Billing] Error getting all projects billing:', error);\n    return [];\n  }\n}\n\n/**\n * Get global pricing config\n */\nexport async function getGlobalPricingConfig(): Promise<PricingConfig | null> {\n  try {\n    const response = await http.get<{ success: boolean; config: PricingConfig }>(\n      '/api/admin/billing/pricing'\n    );\n    return response.data?.config || null;\n  } catch (error) {\n    console.error('[Billing] Error getting global pricing config:', error);\n    return null;\n  }\n}\n\n/**\n * Set global pricing config\n */\nexport async function setGlobalPricingConfig(config: {\n  fixed_markup_percent?: number;\n  period_type?: 'monthly' | 'weekly';\n  usd_to_eur_rate?: number;\n}): Promise<{ success: boolean; error?: string }> {\n  try {\n    const response = await http.post<{ success: boolean; error?: string }>(\n      '/api/admin/billing/pricing',\n      config\n    );\n    return response.data || { success: false };\n  } catch (error) {\n    console.error('[Billing] Error setting global pricing config:', error);\n    return { success: false, error: String(error) };\n  }\n}\n\n/**\n * Get global pricing tiers\n */\nexport async function getGlobalPricingTiers(): Promise<{ tiers: PricingTier[]; config_id: string | null }> {\n  try {\n    const response = await http.get<{ success: boolean; tiers: PricingTier[]; config_id: string }>(\n      '/api/admin/billing/pricing/tiers'\n    );\n    return { \n      tiers: response.data?.tiers || [], \n      config_id: response.data?.config_id || null \n    };\n  } catch (error) {\n    console.error('[Billing] Error getting global pricing tiers:', error);\n    return { tiers: [], config_id: null };\n  }\n}\n\n/**\n * Set global pricing tiers\n */\nexport async function setGlobalPricingTiers(tiers: Array<{\n  token_limit: number | null;\n  markup_percent: number;\n  name?: string;\n}>): Promise<{ success: boolean; error?: string }> {\n  try {\n    const response = await http.post<{ success: boolean; error?: string }>(\n      '/api/admin/billing/pricing/tiers',\n      { tiers }\n    );\n    return response.data || { success: false };\n  } catch (error) {\n    console.error('[Billing] Error setting global pricing tiers:', error);\n    return { success: false, error: String(error) };\n  }\n}\n\n/**\n * Get project billing summary (admin)\n */\nexport async function getProjectBillingSummaryAdmin(projectId: string): Promise<ProjectBillingSummary | null> {\n  try {\n    const response = await http.get<{ success: boolean; summary: ProjectBillingSummary }>(\n      `/api/admin/billing/projects/${projectId}`\n    );\n    return response.data?.summary || null;\n  } catch (error) {\n    console.error('[Billing] Error getting project billing summary:', error);\n    return null;\n  }\n}\n\n/**\n * Get project balance (admin)\n */\nexport async function getProjectBalance(projectId: string): Promise<BalanceCheckResult | null> {\n  try {\n    const response = await http.get<BalanceCheckResult & { success: boolean }>(\n      `/api/admin/billing/projects/${projectId}/balance`\n    );\n    if (response.data?.success) {\n      return response.data;\n    }\n    return null;\n  } catch (error) {\n    console.error('[Billing] Error getting project balance:', error);\n    return null;\n  }\n}\n\n/**\n * Credit project balance (admin)\n */\nexport async function creditProjectBalance(\n  projectId: string, \n  amount: number, \n  description?: string\n): Promise<{ success: boolean; new_balance?: number; error?: string }> {\n  try {\n    const response = await http.post<{ success: boolean; new_balance: number; reason?: string }>(\n      `/api/admin/billing/projects/${projectId}/balance`,\n      { amount, description }\n    );\n    return {\n      success: response.data?.success || false,\n      new_balance: response.data?.new_balance,\n      error: response.data?.reason\n    };\n  } catch (error) {\n    console.error('[Billing] Error crediting project balance:', error);\n    return { success: false, error: String(error) };\n  }\n}\n\n/**\n * Set project unlimited mode (admin)\n */\nexport async function setProjectUnlimited(\n  projectId: string, \n  unlimited: boolean\n): Promise<{ success: boolean; error?: string }> {\n  try {\n    const response = await http.post<{ success: boolean; unlimited: boolean }>(\n      `/api/admin/billing/projects/${projectId}/balance`,\n      { unlimited }\n    );\n    return { success: response.data?.success || false };\n  } catch (error) {\n    console.error('[Billing] Error setting project unlimited:', error);\n    return { success: false, error: String(error) };\n  }\n}\n\n/**\n * Get project balance transactions (admin)\n */\nexport async function getBalanceTransactions(\n  projectId: string, \n  limit = 50\n): Promise<BalanceTransaction[]> {\n  try {\n    const response = await http.get<{ success: boolean; transactions: BalanceTransaction[] }>(\n      `/api/admin/billing/projects/${projectId}/transactions?limit=${limit}`\n    );\n    return response.data?.transactions || [];\n  } catch (error) {\n    console.error('[Billing] Error getting balance transactions:', error);\n    return [];\n  }\n}\n\n/**\n * Get project pricing override (admin)\n */\nexport async function getProjectPricingOverride(projectId: string): Promise<{\n  override: PricingConfig | null;\n  using_global: boolean;\n  global_config: PricingConfig | null;\n}> {\n  try {\n    const response = await http.get<{\n      success: boolean;\n      override: PricingConfig | null;\n      using_global: boolean;\n      global_config: PricingConfig | null;\n    }>(`/api/admin/billing/projects/${projectId}/pricing`);\n    return {\n      override: response.data?.override || null,\n      using_global: response.data?.using_global ?? true,\n      global_config: response.data?.global_config || null\n    };\n  } catch (error) {\n    console.error('[Billing] Error getting project pricing override:', error);\n    return { override: null, using_global: true, global_config: null };\n  }\n}\n\n/**\n * Set project pricing override (admin)\n */\nexport async function setProjectPricingOverride(projectId: string, config: {\n  fixed_markup_percent?: number;\n  period_type?: 'monthly' | 'weekly';\n  usd_to_eur_rate?: number;\n  tiers?: Array<{\n    token_limit: number | null;\n    markup_percent: number;\n    name?: string;\n  }>;\n}): Promise<{ success: boolean; config_id?: string; error?: string }> {\n  try {\n    const response = await http.post<{ success: boolean; config_id?: string; error?: string }>(\n      `/api/admin/billing/projects/${projectId}/pricing`,\n      config\n    );\n    return response.data || { success: false };\n  } catch (error) {\n    console.error('[Billing] Error setting project pricing override:', error);\n    return { success: false, error: String(error) };\n  }\n}\n\n/**\n * Delete project pricing override (admin)\n */\nexport async function deleteProjectPricingOverride(projectId: string): Promise<boolean> {\n  try {\n    const response = await http.delete<{ success: boolean }>(\n      `/api/admin/billing/projects/${projectId}/pricing`\n    );\n    return response.data?.success || false;\n  } catch (error) {\n    console.error('[Billing] Error deleting project pricing override:', error);\n    return false;\n  }\n}\n\n// ============================================\n// PROJECT FUNCTIONS (For project members)\n// ============================================\n\n/**\n * Get billing summary for current project\n */\nexport async function getProjectBillingSummary(projectId: string): Promise<ProjectBillingSummary | null> {\n  try {\n    const response = await http.get<{ success: boolean; summary: ProjectBillingSummary }>(\n      `/api/projects/${projectId}/billing`\n    );\n    return response.data?.summary || null;\n  } catch (error) {\n    console.error('[Billing] Error getting project billing summary:', error);\n    return null;\n  }\n}\n\n// ============================================\n// UTILITIES\n// ============================================\n\n/**\n * Format currency in EUR\n */\nexport function formatEur(amount: number): string {\n  return new Intl.NumberFormat('pt-PT', {\n    style: 'currency',\n    currency: 'EUR',\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2\n  }).format(amount);\n}\n\n/**\n * Format large numbers (tokens)\n */\nexport function formatTokens(count: number): string {\n  if (count >= 1_000_000) {\n    return `${(count / 1_000_000).toFixed(1)}M`;\n  }\n  if (count >= 1_000) {\n    return `${(count / 1_000).toFixed(1)}K`;\n  }\n  return count.toString();\n}\n\n/**\n * Get tier display info\n */\nexport function getTierDisplayInfo(tiers: PricingTier[]): string {\n  if (!tiers || tiers.length === 0) {\n    return 'No tiers configured';\n  }\n  \n  return tiers.map((tier, index) => {\n    const prevLimit = index > 0 ? tiers[index - 1].token_limit : 0;\n    const fromStr = formatTokens(prevLimit || 0);\n    const toStr = tier.token_limit ? formatTokens(tier.token_limit) : '';\n    return `${fromStr}-${toStr}: +${tier.markup_percent}%`;\n  }).join(' | ');\n}\n\n// ============================================\n// SERVICE EXPORT\n// ============================================\n\n// ============================================\n// EXCHANGE RATE\n// ============================================\n\nexport interface ExchangeRateConfig {\n  auto: boolean;\n  manualRate: number;\n  currentRate: number;\n  source: string;\n  lastUpdated: string | null;\n  defaultRate: number;\n}\n\n/**\n * Get exchange rate configuration\n */\nexport async function getExchangeRateConfig(): Promise<ExchangeRateConfig | null> {\n  try {\n    const response = await http.get<{ success: boolean } & ExchangeRateConfig>(\n      '/api/admin/billing/exchange-rate'\n    );\n    if (!response.data?.success) return null;\n    return {\n      auto: response.data.auto,\n      manualRate: response.data.manualRate,\n      currentRate: response.data.currentRate,\n      source: response.data.source,\n      lastUpdated: response.data.lastUpdated,\n      defaultRate: response.data.defaultRate\n    };\n  } catch (error) {\n    console.error('[Billing] Error getting exchange rate config:', error);\n    return null;\n  }\n}\n\n/**\n * Set exchange rate mode\n */\nexport async function setExchangeRateMode(\n  auto: boolean,\n  manualRate?: number\n): Promise<{ success: boolean; error?: string }> {\n  try {\n    const response = await http.post<{ success: boolean; error?: string }>(\n      '/api/admin/billing/exchange-rate',\n      { auto, manualRate }\n    );\n    return response.data || { success: false };\n  } catch (error) {\n    console.error('[Billing] Error setting exchange rate mode:', error);\n    return { success: false, error: String(error) };\n  }\n}\n\n/**\n * Refresh exchange rate from API\n */\nexport async function refreshExchangeRate(): Promise<{ \n  success: boolean; \n  rate?: number; \n  source?: string;\n  error?: string \n}> {\n  try {\n    const response = await http.post<{ \n      success: boolean; \n      rate: number; \n      source: string;\n      error?: string \n    }>(\n      '/api/admin/billing/exchange-rate/refresh',\n      {}\n    );\n    return response.data || { success: false };\n  } catch (error) {\n    console.error('[Billing] Error refreshing exchange rate:', error);\n    return { success: false, error: String(error) };\n  }\n}\n\nexport const billingService = {\n  // Admin functions\n  getAllProjectsBilling,\n  getGlobalPricingConfig,\n  setGlobalPricingConfig,\n  getGlobalPricingTiers,\n  setGlobalPricingTiers,\n  getProjectBillingSummaryAdmin,\n  getProjectBalance,\n  creditProjectBalance,\n  setProjectUnlimited,\n  getBalanceTransactions,\n  getProjectPricingOverride,\n  setProjectPricingOverride,\n  deleteProjectPricingOverride,\n  \n  // Exchange rate\n  getExchangeRateConfig,\n  setExchangeRateMode,\n  refreshExchangeRate,\n  \n  // Project functions\n  getProjectBillingSummary,\n  \n  // Utilities\n  formatEur,\n  formatTokens,\n  getTierDisplayInfo\n};\n\nexport default billingService;\n","/**\n * Costs Dashboard Component\n * LLM costs tracking and visualization\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { createModal, openModal, closeModal } from './Modal';\nimport { costsService, CostSummary, RecentCostRequest } from '../services/graph';\nimport { formatCurrency, formatNumber } from '../utils/format';\nimport { toast } from '../services/toast';\nimport { billingService, type ProjectBillingSummary, formatEur, formatTokens } from '../services/billing';\nimport { appStore } from '../stores/app';\n\n// Billing state\nlet billingSummary: ProjectBillingSummary | null = null;\n\nconst BUDGET_MODAL_ID = 'costs-budget-modal';\n\nexport interface CostsDashboardProps {\n  period?: 'day' | 'week' | 'month' | 'all';\n}\n\n/**\n * Create costs dashboard component\n */\nexport function createCostsDashboard(props: CostsDashboardProps = {}): HTMLElement {\n  const { period = 'month' } = props;\n\n  const container = createElement('div', { className: 'costs-dashboard' });\n\n  container.innerHTML = `\n    <div class=\"costs-header\">\n      <div class=\"costs-header-title\">\n        <h3>LLM Costs</h3>\n        <span class=\"costs-period-range\" id=\"costs-period-range\" aria-live=\"polite\"></span>\n      </div>\n      <div class=\"costs-header-actions\">\n        <select id=\"costs-period\" class=\"filter-select\" aria-label=\"Time period\">\n          <option value=\"day\" ${period === 'day' ? 'selected' : ''}>Today</option>\n          <option value=\"week\" ${period === 'week' ? 'selected' : ''}>This Week</option>\n          <option value=\"month\" ${period === 'month' ? 'selected' : ''}>This Month</option>\n          <option value=\"all\" ${period === 'all' ? 'selected' : ''}>All Time</option>\n        </select>\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-export-btn\" title=\"Export CSV or JSON\">Export</button>\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-pricing-btn\" title=\"View pricing table\">Pricing</button>\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-budget-btn\" title=\"Set budget and alert\">Budget</button>\n      </div>\n    </div>\n    <div class=\"costs-content\" id=\"costs-content\">\n      <div class=\"loading\">Loading costs...</div>\n    </div>\n    <div id=\"costs-pricing-panel\" class=\"costs-pricing-panel hidden\" aria-hidden=\"true\"></div>\n  `;\n\n  // Bind events\n  const periodSelect = container.querySelector('#costs-period') as HTMLSelectElement;\n  on(periodSelect, 'change', () => {\n    loadCosts(container, periodSelect.value as 'day' | 'week' | 'month' | 'all');\n  });\n  const exportBtn = container.querySelector('#costs-export-btn');\n  if (exportBtn) {\n    on(exportBtn, 'click', () => handleExport(periodSelect.value as 'day' | 'week' | 'month' | 'all'));\n  }\n  const pricingBtn = container.querySelector('#costs-pricing-btn');\n  const pricingPanel = container.querySelector('#costs-pricing-panel') as HTMLElement;\n  if (pricingBtn && pricingPanel) {\n    on(pricingBtn, 'click', () => togglePricingPanel(pricingPanel));\n  }\n  on(container, 'click', (e: Event) => {\n    if ((e.target as HTMLElement).id === 'costs-pricing-close') {\n      pricingPanel?.classList.add('hidden');\n      pricingPanel?.setAttribute('aria-hidden', 'true');\n    }\n  });\n  const budgetBtn = container.querySelector('#costs-budget-btn');\n  if (budgetBtn) {\n    on(budgetBtn, 'click', () => showBudgetModal(container, periodSelect));\n  }\n\n  // Initial load\n  loadCosts(container, period);\n\n  return container;\n}\n\n/**\n * Load costs data\n */\nasync function loadCosts(container: HTMLElement, period: 'day' | 'week' | 'month' | 'all'): Promise<void> {\n  const content = container.querySelector('#costs-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    // Get current project ID\n    const state = appStore.getState();\n    const projectId = state.currentProject?.id;\n    \n    const [data, recentRequests, billing] = await Promise.all([\n      costsService.getSummary(period),\n      costsService.getRecentRequests(20),\n      projectId ? billingService.getProjectBillingSummary(projectId) : Promise.resolve(null)\n    ]);\n    \n    billingSummary = billing;\n    renderCosts(content, data, recentRequests);\n    const periodRangeEl = container.querySelector('#costs-period-range');\n    if (periodRangeEl) periodRangeEl.textContent = formatPeriod(data.period ?? { start: '', end: '' });\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load costs</div>';\n  }\n}\n\n/**\n * Render costs\n */\nfunction renderCosts(\n  container: HTMLElement,\n  data: CostSummary,\n  recentRequests: RecentCostRequest[] = []\n): void {\n  const dailyBreakdown = data.dailyBreakdown ?? [];\n  const byProvider = data.byProvider ?? {};\n  const byModel = data.byModel ?? {};\n  const totalCalls = dailyBreakdown.reduce((sum, d) => sum + (d.calls ?? 0), 0);\n  const avgPerCall = totalCalls > 0 ? data.total / totalCalls : 0;\n\n  // Convert records to arrays for rendering (normalize empty operation keys to \"other\")\n  const byProviderArray = Object.entries(byProvider)\n    .map(([provider, cost]) => ({ provider, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  const byModelArray = Object.entries(byModel)\n    .map(([model, cost]) => ({ model, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  const byOperationMap = new Map<string, number>();\n  for (const [op, cost] of Object.entries(data.byOperation || {})) {\n    const key = (op && String(op).trim()) ? String(op).trim() : 'other';\n    byOperationMap.set(key, (byOperationMap.get(key) ?? 0) + cost);\n  }\n  const byOperationArray = Array.from(byOperationMap.entries())\n    .map(([operation, cost]) => ({ operation, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  // By context: sort by cost desc, show \"unknown\" as \"Other\"\n  const byContextArray = Object.entries(data.byContext || {})\n    .map(([ctx, cost]) => ({ context: (ctx === 'unknown' || !ctx?.trim()) ? 'Other' : ctx, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  const totalInput = data.totalInputTokens ?? 0;\n  const totalOutput = data.totalOutputTokens ?? 0;\n  const hasNoData =\n    (data.total ?? 0) === 0 &&\n    dailyBreakdown.length === 0 &&\n    Object.keys(byProvider).length === 0 &&\n    Object.keys(byModel).length === 0;\n  const periodChangeHtml =\n    data.previousPeriodCost != null && data.percentChange != null\n      ? `<div class=\"card-sub period-change ${data.percentChange >= 0 ? 'up' : 'down'}\">vs previous period: ${data.percentChange >= 0 ? '+' : ''}${data.percentChange.toFixed(1)}%</div>`\n      : '';\n\n  const budgetHtml =\n    data.budgetLimit != null && data.budgetUsedPercent != null\n      ? `\n    <div class=\"costs-budget-bar ${data.budgetAlertTriggered ? 'alert' : ''}\">\n      <div class=\"costs-budget-bar-fill\" style=\"width: ${Math.min(100, data.budgetUsedPercent)}%\"></div>\n      <span class=\"costs-budget-label\">${formatCurrency(data.total)} / ${formatCurrency(data.budgetLimit)} (${data.budgetUsedPercent}%)</span>\n      ${data.budgetAlertTriggered ? '<span class=\"costs-budget-alert\">Alert threshold reached</span>' : ''}\n    </div>`\n      : !hasNoData\n      ? '<div class=\"costs-budget-bar costs-budget-bar-empty\"><span class=\"costs-budget-label\">No budget set</span><span class=\"costs-budget-set-hint\">Use the Budget button above to set a limit.</span></div>'\n      : '';\n\n  const emptyStateHtml =\n    hasNoData\n      ? '<div class=\"costs-empty-state\">No cost data for this period. LLM usage from Chat, document processing, and other features will appear here.</div>'\n      : '';\n\n  // Build billing banner HTML\n  let billingBannerHtml = '';\n  if (billingSummary) {\n    const balanceDisplay = billingSummary.unlimited_balance \n      ? '<span style=\"color: var(--success-color); font-weight: 600;\"> Unlimited</span>'\n      : formatEur(billingSummary.balance_eur);\n    \n    const statusBadge = billingSummary.unlimited_balance\n      ? '<span class=\"badge badge-success\" style=\"font-size: 11px;\">Unlimited</span>'\n      : billingSummary.balance_eur <= 0\n        ? '<span class=\"badge badge-danger\" style=\"font-size: 11px;\">Blocked</span>'\n        : billingSummary.balance_percent_used >= 80\n          ? '<span class=\"badge badge-warning\" style=\"font-size: 11px;\">Low Balance</span>'\n          : '<span class=\"badge badge-primary\" style=\"font-size: 11px;\">Active</span>';\n    \n    billingBannerHtml = `\n      <div class=\"billing-summary-banner\" style=\"background: var(--bg-secondary); border-radius: 8px; padding: 16px; margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;\">\n        <div style=\"display: flex; align-items: center; gap: 24px;\">\n          <div>\n            <div style=\"font-size: 12px; color: var(--text-tertiary); margin-bottom: 4px;\">Project Balance</div>\n            <div style=\"font-size: 18px; font-weight: 600;\">${balanceDisplay}</div>\n          </div>\n          <div>\n            <div style=\"font-size: 12px; color: var(--text-tertiary); margin-bottom: 4px;\">Status</div>\n            <div>${statusBadge}</div>\n          </div>\n          ${billingSummary.current_tier_name ? `\n          <div>\n            <div style=\"font-size: 12px; color: var(--text-tertiary); margin-bottom: 4px;\">Current Tier</div>\n            <div style=\"font-size: 14px;\">${billingSummary.current_tier_name} (+${billingSummary.current_markup_percent}%)</div>\n          </div>\n          ` : ''}\n        </div>\n        <div style=\"display: flex; align-items: center; gap: 24px; color: var(--text-secondary); font-size: 13px;\">\n          <div>\n            <strong>${formatTokens(billingSummary.tokens_this_period)}</strong> tokens this period\n          </div>\n          <div>\n            <strong>${formatEur(billingSummary.billable_cost_this_period)}</strong> billed (${billingSummary.period_key})\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  container.innerHTML = `\n    ${billingBannerHtml}\n    <div class=\"costs-dashboard-row\">\n      <div class=\"costs-stats-grid stats-grid\">\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-total\">\n          <div class=\"stat-value\">${formatCurrency(data.total)}</div>\n          <div class=\"stat-label\">Total Cost</div>\n          ${periodChangeHtml}\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-calls\">\n          <div class=\"stat-value\">${formatNumber(totalCalls)}</div>\n          <div class=\"stat-label\">API Calls</div>\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-avg\">\n          <div class=\"stat-value\">${formatCurrency(avgPerCall)}</div>\n          <div class=\"stat-label\">Avg per Call</div>\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-input\">\n          <div class=\"stat-value\">${formatNumber(totalInput)}</div>\n          <div class=\"stat-label\">Input Tokens</div>\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-output\">\n          <div class=\"stat-value\">${formatNumber(totalOutput)}</div>\n          <div class=\"stat-label\">Output Tokens</div>\n        </div>\n      </div>\n    </div>\n    ${budgetHtml}\n    ${emptyStateHtml}\n\n    <div class=\"costs-chart-section chart-container\">\n      <h4 class=\"costs-chart-title\">Daily Costs</h4>\n      <div class=\"costs-chart-inner\">\n        ${renderDailyChart(dailyBreakdown, data.period ?? { start: '', end: '' })}\n      </div>\n    </div>\n\n    <div class=\"costs-breakdown\">\n      <div class=\"breakdown-section\">\n        <h4>By Provider</h4>\n        <div class=\"breakdown-list\">\n          ${byProviderArray.length > 0 ? byProviderArray.map(p => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(p.provider)}</span>\n              <span class=\"item-value\">${formatCurrency(p.cost)}</span>\n            </div>\n          `).join('') : '<div class=\"empty\">No data</div>'}\n        </div>\n      </div>\n\n      <div class=\"breakdown-section\">\n        <h4>By Model</h4>\n        <div class=\"breakdown-list\">\n          ${byModelArray.length > 0 ? byModelArray.map(m => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(m.model)}</span>\n              <span class=\"item-value\">${formatCurrency(m.cost)}</span>\n            </div>\n          `).join('') : '<div class=\"empty\">No data</div>'}\n        </div>\n      </div>\n\n      <div class=\"breakdown-section\">\n        <h4>By Operation</h4>\n        <div class=\"breakdown-list\">\n          ${byOperationArray.length > 0 ? byOperationArray.map(o => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(o.operation)}</span>\n              <span class=\"item-value\">${formatCurrency(o.cost)}</span>\n            </div>\n          `).join('') : '<div class=\"empty\">No data</div>'}\n        </div>\n      </div>\n\n      ${byContextArray.length > 0 ? `\n      <div class=\"breakdown-section\">\n        <h4>By Context</h4>\n        <div class=\"breakdown-list\">\n          ${byContextArray.map(c => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(c.context)}</span>\n              <span class=\"item-value\">${formatCurrency(c.cost)}</span>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n      ` : ''}\n    </div>\n\n    <div class=\"costs-recent-section\">\n      <h4>Recent Requests <span class=\"costs-recent-caption\">(last 20, all time)</span></h4>\n      ${renderRecentRequests(recentRequests)}\n    </div>\n  `;\n}\n\n/**\n * Render recent requests table\n */\nfunction renderRecentRequests(requests: RecentCostRequest[]): string {\n  if (!requests.length) {\n    return '<div class=\"empty-recent\">No recent requests</div>';\n  }\n  return `\n    <div class=\"costs-recent-table-wrap\">\n      <table class=\"costs-recent-table\" aria-label=\"Recent LLM requests\">\n        <thead>\n          <tr>\n            <th>Time</th>\n            <th>Provider / Model</th>\n            <th>Operation</th>\n            <th>Tokens</th>\n            <th>Cost</th>\n            <th>Latency</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${requests\n            .slice(0, 20)\n            .map(\n              (r) => `\n            <tr>\n              <td>${formatRequestTime(r.timestamp)}</td>\n              <td>${escapeHtml(r.provider)} / ${escapeHtml(r.model)}</td>\n              <td>${escapeHtml(r.request_type || r.operation || '')}</td>\n              <td>${(r.input_tokens ?? 0)}+${r.output_tokens ?? 0}</td>\n              <td>${r.cost != null ? formatCurrency(r.cost) : ''}</td>\n              <td>${r.latency_ms != null ? `${r.latency_ms}ms` : ''}</td>\n            </tr>\n          `\n            )\n            .join('')}\n        </tbody>\n      </table>\n    </div>\n  `;\n}\n\nfunction formatRequestTime(iso: string): string {\n  const d = new Date(iso);\n  const now = new Date();\n  const diffMs = now.getTime() - d.getTime();\n  if (diffMs < 60000) return 'Just now';\n  if (diffMs < 3600000) return `${Math.floor(diffMs / 60000)}m ago`;\n  if (diffMs < 86400000) return `${Math.floor(diffMs / 3600000)}h ago`;\n  return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });\n}\n\n/**\n * Export costs as CSV or JSON (user chooses via prompt)\n */\nasync function handleExport(period: 'day' | 'week' | 'month' | 'all'): Promise<void> {\n  const format = window.confirm('Download as JSON?\\n\\nCancel = CSV, OK = JSON') ? 'json' : 'csv';\n  const ext = format === 'json' ? 'json' : 'csv';\n  const url = `/api/costs/export?period=${period}&format=${format}`;\n  try {\n    const res = await fetch(url, { credentials: 'include' });\n    if (!res.ok) throw new Error(res.statusText);\n    const blob = await res.blob();\n    const name = `llm-costs-${period}-${new Date().toISOString().split('T')[0]}.${ext}`;\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = name;\n    a.click();\n    URL.revokeObjectURL(a.href);\n  } catch (e) {\n    console.error('Export failed:', e);\n    alert('Export failed. Try again.');\n  }\n}\n\n/**\n * Toggle pricing panel (fetch on first open)\n */\nasync function togglePricingPanel(panel: HTMLElement): Promise<void> {\n  const isHidden = panel.classList.contains('hidden');\n  if (isHidden && !panel.innerHTML.trim()) {\n    panel.innerHTML = '<div class=\"loading\">Loading pricing...</div>';\n    panel.classList.remove('hidden');\n    panel.setAttribute('aria-hidden', 'false');\n    try {\n      const pricing = await costsService.getPricing();\n      panel.innerHTML = renderPricingTable(pricing);\n    } catch {\n      panel.innerHTML = '<div class=\"error\">Failed to load pricing</div>';\n    }\n  } else {\n    panel.classList.toggle('hidden');\n    panel.setAttribute('aria-hidden', String(panel.classList.contains('hidden')));\n  }\n}\n\nasync function showBudgetModal(container: HTMLElement, periodSelect: HTMLSelectElement): Promise<void> {\n  const period = periodSelect.value as 'day' | 'week' | 'month' | 'all';\n  const budgetPeriod: 'week' | 'month' =\n    period === 'week' ? 'week' : period === 'month' ? 'month' : 'month';\n\n  const existing = document.querySelector(`[data-modal-id=\"${BUDGET_MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  let currentLimit = 100;\n  let currentThreshold = 80;\n  try {\n    const budget = await costsService.getBudget(budgetPeriod);\n    if (budget?.limitUsd != null && budget.limitUsd > 0) currentLimit = budget.limitUsd;\n    if (budget?.alertThresholdPercent != null) currentThreshold = Math.min(100, Math.max(0, budget.alertThresholdPercent));\n  } catch {\n    // use defaults\n  }\n\n  const body = createElement('div', { className: 'costs-budget-modal-body' });\n  body.innerHTML = `\n    <p class=\"costs-budget-modal-desc\">Set a ${budgetPeriod}ly spending limit and get an alert when usage reaches a percentage of that limit.</p>\n    <div class=\"form-group\">\n      <label for=\"costs-budget-limit\">Budget limit (USD)</label>\n      <input type=\"number\" id=\"costs-budget-limit\" class=\"form-input\" min=\"1\" max=\"999999\" step=\"0.01\" value=\"${currentLimit}\" placeholder=\"e.g. 100\" aria-label=\"Budget limit in USD\">\n      <span class=\"form-hint\">Min 1 USD</span>\n    </div>\n    <div class=\"form-group\">\n      <label for=\"costs-budget-threshold\">Alert when usage reaches (%)</label>\n      <input type=\"number\" id=\"costs-budget-threshold\" class=\"form-input\" min=\"0\" max=\"100\" value=\"${currentThreshold}\" placeholder=\"e.g. 80\" aria-label=\"Alert threshold percentage\">\n      <span class=\"form-hint\">0100%</span>\n    </div>\n    <p class=\"costs-budget-modal-hint\" role=\"status\">You will be notified when LLM costs reach this percentage of your budget.</p>\n  `;\n\n  const footer = createElement('div', { className: 'modal-footer' });\n  const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\n  const saveBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save budget' });\n\n  const modal = createModal({\n    id: BUDGET_MODAL_ID,\n    title: `Set ${budgetPeriod === 'week' ? 'weekly' : 'monthly'} budget`,\n    content: body,\n    size: 'md',\n    closable: true,\n    footer,\n  });\n\n  modal.classList.add('costs-budget-modal');\n\n  const hintEl = body.querySelector('.costs-budget-modal-hint') as HTMLElement;\n\n  on(cancelBtn, 'click', () => closeModal(BUDGET_MODAL_ID));\n  on(saveBtn, 'click', async () => {\n    const limitEl = body.querySelector('#costs-budget-limit') as HTMLInputElement;\n    const thresholdEl = body.querySelector('#costs-budget-threshold') as HTMLInputElement;\n    const limitUsd = limitEl ? parseFloat(limitEl.value) : NaN;\n    const thresholdRaw = thresholdEl != null ? parseInt(thresholdEl.value, 10) : NaN;\n    const threshold = Number.isFinite(thresholdRaw) ? Math.min(100, Math.max(0, thresholdRaw)) : 80;\n\n    hintEl.textContent = 'You will be notified when LLM costs reach this percentage of your budget.';\n    if (!Number.isFinite(limitUsd) || limitUsd < 1) {\n      hintEl.textContent = 'Enter a valid budget (min 1 USD).';\n      hintEl.classList.add('costs-budget-modal-hint-error');\n      limitEl?.focus();\n      return;\n    }\n    if (!Number.isFinite(thresholdRaw) || thresholdRaw < 0 || thresholdRaw > 100) {\n      hintEl.textContent = 'Alert threshold must be between 0 and 100%.';\n      hintEl.classList.add('costs-budget-modal-hint-error');\n      thresholdEl?.focus();\n      return;\n    }\n    hintEl.classList.remove('costs-budget-modal-hint-error');\n    saveBtn.setAttribute('disabled', 'true');\n    saveBtn.textContent = 'Saving';\n    try {\n      await costsService.setBudget(budgetPeriod, limitUsd, threshold);\n      closeModal(BUDGET_MODAL_ID);\n      loadCosts(container, periodSelect.value as 'day' | 'week' | 'month' | 'all');\n      toast.success('Budget saved');\n    } catch (e) {\n      console.error('Set budget failed:', e);\n      hintEl.textContent = 'Failed to save. Please try again.';\n      hintEl.classList.add('costs-budget-modal-hint-error');\n      toast.error('Failed to save budget');\n    } finally {\n      saveBtn.removeAttribute('disabled');\n      saveBtn.textContent = 'Save budget';\n    }\n  });\n\n  footer.append(cancelBtn, saveBtn);\n  document.body.appendChild(modal);\n  openModal(BUDGET_MODAL_ID);\n}\n\nfunction renderPricingTable(rows: Array<{ model: string; inputPer1M: number; outputPer1M: number }>): string {\n  if (!rows.length) return '<div class=\"empty\">No pricing data</div>';\n  return `\n    <div class=\"costs-pricing-header\">\n      <h4>Model pricing (USD per 1M tokens)</h4>\n      <button type=\"button\" class=\"btn btn-sm\" id=\"costs-pricing-close\" aria-label=\"Close\"></button>\n    </div>\n    <div class=\"costs-pricing-table-wrap\">\n      <table class=\"costs-pricing-table\">\n        <thead>\n          <tr>\n            <th>Model</th>\n            <th>Input</th>\n            <th>Output</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${rows\n            .map(\n              (r) => `\n            <tr>\n              <td>${escapeHtml(r.model)}</td>\n              <td>$${r.inputPer1M.toFixed(2)}</td>\n              <td>$${r.outputPer1M.toFixed(2)}</td>\n            </tr>\n          `\n            )\n            .join('')}\n        </tbody>\n      </table>\n    </div>\n  `;\n}\n\n/**\n * Build skeleton daily array for period so chart always shows structure\n */\nfunction skeletonDailyForPeriod(period: { start: string; end: string }): Array<{ date: string; cost: number; calls: number }> {\n  const days = 14;\n  const result: Array<{ date: string; cost: number; calls: number }> = [];\n  const d = new Date();\n  for (let i = days - 1; i >= 0; i--) {\n    const date = new Date(d);\n    date.setDate(date.getDate() - i);\n    result.push({\n      date: date.toISOString().split('T')[0],\n      cost: 0,\n      calls: 0,\n    });\n  }\n  return result;\n}\n\n/**\n * Render daily costs chart. When no data, show skeleton bars so chart area is visible.\n */\nfunction renderDailyChart(\n  daily: Array<{ date: string; cost: number; calls: number }>,\n  period?: { start: string; end: string }\n): string {\n  const chartDaily = daily.length > 0 ? daily : skeletonDailyForPeriod(period ?? { start: '', end: '' });\n  const maxCost = Math.max(1e-9, ...chartDaily.map(d => d.cost));\n  const isPlaceholder = daily.length === 0;\n\n  return `\n    <div class=\"daily-chart\">\n      <div class=\"chart-bars\">\n        ${chartDaily.map(d => {\n          const height = maxCost > 0 ? Math.max(2, (d.cost / maxCost) * 100) : 2;\n          return `\n            <div class=\"bar-column\" title=\"${d.date}: ${formatCurrency(d.cost)} (${d.calls} calls)\">\n              <div class=\"bar ${isPlaceholder && d.cost === 0 ? 'bar-placeholder' : ''}\" style=\"height: ${height}%\"></div>\n              <div class=\"bar-label\">${formatDateShort(d.date)}</div>\n            </div>\n          `;\n        }).join('')}\n      </div>\n      ${isPlaceholder ? '<p class=\"chart-placeholder-hint\">No cost data for this period. Usage will appear here as you use LLM features.</p>' : ''}\n    </div>\n  `;\n}\n\n/**\n * Format period display\n */\nfunction formatPeriod(period: { start: string; end: string }): string {\n  if (!period.start || !period.end) return 'All time';\n  \n  const start = new Date(period.start);\n  const end = new Date(period.end);\n  \n  const formatDate = (d: Date) => d.toLocaleDateString(undefined, { \n    month: 'short', \n    day: 'numeric' \n  });\n  \n  return `${formatDate(start)} - ${formatDate(end)}`;\n}\n\n/**\n * Format date short\n */\nfunction formatDateShort(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createCostsDashboard;\n","/**\n * Global Search Component\n * Command palette style search (Cmd+K / Ctrl+K)\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { shortcuts } from '../services/shortcuts';\n\nexport interface GlobalSearchProps {\n  onResultClick?: (result: SearchResult) => void;\n}\n\nexport interface SearchResult {\n  id: string;\n  type: 'question' | 'risk' | 'action' | 'decision' | 'contact' | 'document' | 'email' | 'fact';\n  title: string;\n  subtitle?: string;\n  icon?: string;\n  url?: string;\n}\n\ninterface SearchResponse {\n  results: SearchResult[];\n  total: number;\n}\n\nlet isOpen = false;\nlet currentQuery = '';\nlet selectedIndex = 0;\nlet results: SearchResult[] = [];\n\nconst TYPE_ICONS: Record<string, string> = {\n  question: '',\n  risk: '',\n  action: '',\n  decision: '',\n  contact: '',\n  document: '',\n  email: '',\n  fact: '',\n};\n\n/**\n * Initialize global search\n */\nexport function initGlobalSearch(props: GlobalSearchProps = {}): void {\n  // Create modal if not exists\n  let modal = document.getElementById('global-search-modal');\n  if (!modal) {\n    modal = createSearchModal(props);\n    document.body.appendChild(modal);\n  }\n\n  // Register keyboard shortcut\n  shortcuts.register('mod+k', (e) => {\n    e.preventDefault();\n    toggleSearch();\n  });\n\n  // Also register / for quick search\n  shortcuts.register('/', (e) => {\n    // Only if not in an input\n    if (document.activeElement?.tagName !== 'INPUT' && \n        document.activeElement?.tagName !== 'TEXTAREA') {\n      e.preventDefault();\n      toggleSearch();\n    }\n  });\n}\n\n/**\n * Create search modal\n */\nfunction createSearchModal(props: GlobalSearchProps): HTMLElement {\n  const modal = createElement('div', {\n    id: 'global-search-modal',\n    className: 'global-search-modal',\n  });\n  modal.style.display = 'none';\n\n  modal.innerHTML = `\n    <div class=\"search-backdrop\"></div>\n    <div class=\"search-dialog\">\n      <div class=\"search-input-wrapper\">\n        <span class=\"search-icon\"></span>\n        <input type=\"text\" id=\"global-search-input\" class=\"search-input\" \n               placeholder=\"Search questions, risks, contacts...\" autocomplete=\"off\">\n        <kbd class=\"search-shortcut\">ESC</kbd>\n      </div>\n      <div class=\"search-results\" id=\"search-results\">\n        <div class=\"search-hint\">\n          <p>Start typing to search...</p>\n          <div class=\"search-tips\">\n            <span><kbd></kbd> Navigate</span>\n            <span><kbd>Enter</kbd> Select</span>\n            <span><kbd>ESC</kbd> Close</span>\n          </div>\n        </div>\n      </div>\n      <div class=\"search-footer\">\n        <span>Type to search</span>\n        <span>Press <kbd>?</kbd> for more shortcuts</span>\n      </div>\n    </div>\n  `;\n\n  const backdrop = modal.querySelector('.search-backdrop') as HTMLElement;\n  const input = modal.querySelector('#global-search-input') as HTMLInputElement;\n  const resultsContainer = modal.querySelector('#search-results') as HTMLElement;\n\n  // Close on backdrop click\n  on(backdrop, 'click', closeSearch);\n\n  // Input events\n  on(input, 'input', () => {\n    currentQuery = input.value;\n    selectedIndex = 0;\n    debounceSearch(resultsContainer, props);\n  });\n\n  on(input, 'keydown', (e) => {\n    handleKeydown(e, resultsContainer, props);\n  });\n\n  return modal;\n}\n\n/**\n * Toggle search visibility\n */\nexport function toggleSearch(): void {\n  if (isOpen) {\n    closeSearch();\n  } else {\n    openSearch();\n  }\n}\n\n/**\n * Open search\n */\nexport function openSearch(): void {\n  const modal = document.getElementById('global-search-modal');\n  if (!modal) return;\n\n  isOpen = true;\n  modal.style.display = 'block';\n  \n  const input = modal.querySelector('#global-search-input') as HTMLInputElement;\n  input.value = '';\n  input.focus();\n  \n  currentQuery = '';\n  results = [];\n  selectedIndex = 0;\n\n  // Reset results\n  const resultsContainer = modal.querySelector('#search-results') as HTMLElement;\n  resultsContainer.innerHTML = `\n    <div class=\"search-hint\">\n      <p>Start typing to search...</p>\n      <div class=\"search-tips\">\n        <span><kbd></kbd> Navigate</span>\n        <span><kbd>Enter</kbd> Select</span>\n        <span><kbd>ESC</kbd> Close</span>\n      </div>\n    </div>\n  `;\n\n  // Add escape listener\n  document.addEventListener('keydown', handleEscape);\n}\n\n/**\n * Close search\n */\nexport function closeSearch(): void {\n  const modal = document.getElementById('global-search-modal');\n  if (!modal) return;\n\n  isOpen = false;\n  modal.style.display = 'none';\n  \n  document.removeEventListener('keydown', handleEscape);\n}\n\n/**\n * Handle escape key\n */\nfunction handleEscape(e: KeyboardEvent): void {\n  if (e.key === 'Escape') {\n    closeSearch();\n  }\n}\n\n/**\n * Handle keyboard navigation\n */\nfunction handleKeydown(e: KeyboardEvent, container: HTMLElement, props: GlobalSearchProps): void {\n  switch (e.key) {\n    case 'ArrowDown':\n      e.preventDefault();\n      selectedIndex = Math.min(selectedIndex + 1, results.length - 1);\n      updateSelection(container);\n      break;\n    case 'ArrowUp':\n      e.preventDefault();\n      selectedIndex = Math.max(selectedIndex - 1, 0);\n      updateSelection(container);\n      break;\n    case 'Enter':\n      e.preventDefault();\n      const selected = results[selectedIndex];\n      if (selected) {\n        selectResult(selected, props);\n      }\n      break;\n    case 'Escape':\n      closeSearch();\n      break;\n  }\n}\n\n/**\n * Update selection highlight\n */\nfunction updateSelection(container: HTMLElement): void {\n  const items = container.querySelectorAll('.search-result');\n  items.forEach((item, i) => {\n    item.classList.toggle('selected', i === selectedIndex);\n    if (i === selectedIndex) {\n      item.scrollIntoView({ block: 'nearest' });\n    }\n  });\n}\n\n/**\n * Debounced search\n */\nlet searchTimeout: number;\nfunction debounceSearch(container: HTMLElement, props: GlobalSearchProps): void {\n  clearTimeout(searchTimeout);\n  searchTimeout = window.setTimeout(() => {\n    performSearch(container, props);\n  }, 200);\n}\n\n/**\n * Perform search\n */\nasync function performSearch(container: HTMLElement, props: GlobalSearchProps): Promise<void> {\n  if (!currentQuery.trim()) {\n    container.innerHTML = `\n      <div class=\"search-hint\">\n        <p>Start typing to search...</p>\n        <div class=\"search-tips\">\n          <span><kbd></kbd> Navigate</span>\n          <span><kbd>Enter</kbd> Select</span>\n          <span><kbd>ESC</kbd> Close</span>\n        </div>\n      </div>\n    `;\n    results = [];\n    return;\n  }\n\n  container.innerHTML = '<div class=\"search-loading\">Searching...</div>';\n\n  try {\n    const response = await http.get<SearchResponse>(\n      `/api/search?q=${encodeURIComponent(currentQuery)}&limit=10`\n    );\n    results = response.data.results || [];\n    \n    renderResults(container, results, props);\n  } catch {\n    // Fallback to local search if API fails\n    results = performLocalSearch(currentQuery);\n    renderResults(container, results, props);\n  }\n}\n\n/**\n * Local fallback search\n */\nfunction performLocalSearch(query: string): SearchResult[] {\n  // TODO: Search local stores\n  return [];\n}\n\n/**\n * Render results\n */\nfunction renderResults(container: HTMLElement, results: SearchResult[], props: GlobalSearchProps): void {\n  if (results.length === 0) {\n    container.innerHTML = `\n      <div class=\"search-empty\">\n        <p>No results found for \"${escapeHtml(currentQuery)}\"</p>\n      </div>\n    `;\n    return;\n  }\n\n  // Group by type\n  const grouped = groupByType(results);\n\n  container.innerHTML = Object.entries(grouped).map(([type, items]) => `\n    <div class=\"search-group\">\n      <div class=\"group-label\">${capitalize(type)}s</div>\n      ${items.map((result, i) => `\n        <div class=\"search-result ${i === selectedIndex ? 'selected' : ''}\" data-index=\"${results.indexOf(result)}\">\n          <span class=\"result-icon\">${TYPE_ICONS[result.type] || ''}</span>\n          <div class=\"result-content\">\n            <div class=\"result-title\">${escapeHtml(result.title)}</div>\n            ${result.subtitle ? `<div class=\"result-subtitle\">${escapeHtml(result.subtitle)}</div>` : ''}\n          </div>\n          <span class=\"result-type\">${result.type}</span>\n        </div>\n      `).join('')}\n    </div>\n  `).join('');\n\n  // Bind click events\n  container.querySelectorAll('.search-result').forEach(el => {\n    on(el as HTMLElement, 'click', () => {\n      const index = parseInt(el.getAttribute('data-index') || '0');\n      const result = results[index];\n      if (result) {\n        selectResult(result, props);\n      }\n    });\n\n    on(el as HTMLElement, 'mouseenter', () => {\n      const index = parseInt(el.getAttribute('data-index') || '0');\n      selectedIndex = index;\n      updateSelection(container);\n    });\n  });\n}\n\n/**\n * Select result\n */\nfunction selectResult(result: SearchResult, props: GlobalSearchProps): void {\n  closeSearch();\n  \n  if (props.onResultClick) {\n    props.onResultClick(result);\n  } else {\n    // Default navigation\n    navigateToResult(result);\n  }\n}\n\n/**\n * Navigate to result\n */\nfunction navigateToResult(result: SearchResult): void {\n  // Dispatch custom event for navigation\n  window.dispatchEvent(new CustomEvent('godmode:navigate', {\n    detail: { type: result.type, id: result.id }\n  }));\n}\n\n/**\n * Group results by type\n */\nfunction groupByType(results: SearchResult[]): Record<string, SearchResult[]> {\n  const grouped: Record<string, SearchResult[]> = {};\n  results.forEach(r => {\n    if (!grouped[r.type]) grouped[r.type] = [];\n    grouped[r.type].push(r);\n  });\n  return grouped;\n}\n\n/**\n * Capitalize\n */\nfunction capitalize(str: string): string {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default initGlobalSearch;\n","/**\n * Bulk Actions Component\n * Selection management and bulk operations\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { undoManager } from '../services/undo';\n\nexport interface BulkActionsProps {\n  type: 'questions' | 'risks' | 'actions' | 'decisions' | 'contacts' | 'documents';\n  onComplete?: () => void;\n}\n\ninterface BulkOperation {\n  type: string;\n  ids: string[];\n  action: string;\n  data?: Record<string, unknown>;\n}\n\nlet selectedIds: Set<string> = new Set();\n\n/**\n * Create bulk actions bar\n */\nexport function createBulkActionsBar(props: BulkActionsProps): HTMLElement {\n  const bar = createElement('div', { className: 'bulk-actions-bar' });\n  bar.style.display = 'none';\n\n  bar.innerHTML = `\n    <div class=\"bulk-info\">\n      <span class=\"bulk-count\">0</span> selected\n    </div>\n    <div class=\"bulk-buttons\">\n      ${getActionsForType(props.type)}\n      <button class=\"btn btn-sm btn-secondary\" id=\"bulk-clear\">Clear</button>\n    </div>\n  `;\n\n  // Bind clear\n  const clearBtn = bar.querySelector('#bulk-clear');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', () => {\n      clearSelection();\n      updateBar(bar);\n    });\n  }\n\n  // Bind actions\n  bindActionButtons(bar, props);\n\n  return bar;\n}\n\n/**\n * Get action buttons for type\n */\nfunction getActionsForType(type: string): string {\n  const common = `\n    <button class=\"btn btn-sm btn-danger\" id=\"bulk-delete\">Delete</button>\n  `;\n\n  switch (type) {\n    case 'questions':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"resolved\">Mark Resolved</button>\n        <button class=\"btn btn-sm\" id=\"bulk-assign\">Assign To...</button>\n        ${common}\n      `;\n    case 'actions':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"completed\">Mark Complete</button>\n        <button class=\"btn btn-sm\" id=\"bulk-assign\">Assign To...</button>\n        ${common}\n      `;\n    case 'risks':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"mitigated\">Mark Mitigated</button>\n        ${common}\n      `;\n    case 'decisions':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"approved\">Approve</button>\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"rejected\">Reject</button>\n        ${common}\n      `;\n    default:\n      return common;\n  }\n}\n\n/**\n * Bind action buttons\n */\nfunction bindActionButtons(bar: HTMLElement, props: BulkActionsProps): void {\n  // Delete\n  const deleteBtn = bar.querySelector('#bulk-delete');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm(`Delete ${selectedIds.size} items?`)) return;\n      \n      await performBulkAction({\n        type: props.type,\n        ids: Array.from(selectedIds),\n        action: 'delete',\n      }, props);\n    });\n  }\n\n  // Status change\n  const statusBtns = bar.querySelectorAll('[id^=\"bulk-status\"]');\n  statusBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const status = btn.getAttribute('data-status');\n      if (!status) return;\n\n      await performBulkAction({\n        type: props.type,\n        ids: Array.from(selectedIds),\n        action: 'status',\n        data: { status },\n      }, props);\n    });\n  });\n\n  // Assign\n  const assignBtn = bar.querySelector('#bulk-assign');\n  if (assignBtn) {\n    on(assignBtn as HTMLElement, 'click', () => {\n      const assignee = prompt('Assign to:');\n      if (!assignee) return;\n\n      performBulkAction({\n        type: props.type,\n        ids: Array.from(selectedIds),\n        action: 'assign',\n        data: { assignee },\n      }, props);\n    });\n  }\n}\n\n/**\n * Perform bulk action\n */\nasync function performBulkAction(operation: BulkOperation, props: BulkActionsProps): Promise<void> {\n  try {\n    let endpoint = '';\n    let body: Record<string, unknown> = { type: operation.type, ids: operation.ids };\n\n    switch (operation.action) {\n      case 'delete':\n        endpoint = '/api/bulk/delete';\n        break;\n      case 'status':\n        endpoint = '/api/bulk/status';\n        body = { ...body, status: operation.data?.status };\n        break;\n      case 'assign':\n        endpoint = '/api/bulk/assign';\n        body = { ...body, assignee: operation.data?.assignee };\n        break;\n    }\n\n    const response = await http.post<{ actionId?: string; affected: number }>(endpoint, body);\n    \n    // Register for undo if supported\n    if (response.data.actionId) {\n      undoManager.push({\n        type: `bulk-${operation.action}`,\n        description: `${operation.action} ${operation.ids.length} items`,\n        undo: async () => {\n          await http.post(`/api/undo/${response.data.actionId}`);\n          props.onComplete?.();\n        },\n      });\n    }\n\n    toast.success(`Updated ${response.data.affected || operation.ids.length} items`);\n    clearSelection();\n    props.onComplete?.();\n  } catch {\n    toast.error('Bulk operation failed');\n  }\n}\n\n/**\n * Toggle item selection\n */\nexport function toggleSelection(id: string, bar: HTMLElement): void {\n  if (selectedIds.has(id)) {\n    selectedIds.delete(id);\n  } else {\n    selectedIds.add(id);\n  }\n  updateBar(bar);\n}\n\n/**\n * Select item\n */\nexport function selectItem(id: string, bar: HTMLElement): void {\n  selectedIds.add(id);\n  updateBar(bar);\n}\n\n/**\n * Deselect item\n */\nexport function deselectItem(id: string, bar: HTMLElement): void {\n  selectedIds.delete(id);\n  updateBar(bar);\n}\n\n/**\n * Clear selection\n */\nexport function clearSelection(): void {\n  selectedIds.clear();\n  // Update checkboxes in DOM\n  document.querySelectorAll('.bulk-checkbox:checked').forEach(cb => {\n    (cb as HTMLInputElement).checked = false;\n  });\n}\n\n/**\n * Get selected IDs\n */\nexport function getSelectedIds(): string[] {\n  return Array.from(selectedIds);\n}\n\n/**\n * Is item selected\n */\nexport function isSelected(id: string): boolean {\n  return selectedIds.has(id);\n}\n\n/**\n * Update bar visibility and count\n */\nfunction updateBar(bar: HTMLElement): void {\n  const count = selectedIds.size;\n  \n  bar.style.display = count > 0 ? 'flex' : 'none';\n  \n  const countEl = bar.querySelector('.bulk-count');\n  if (countEl) {\n    countEl.textContent = String(count);\n  }\n}\n\n/**\n * Create checkbox for bulk selection\n */\nexport function createBulkCheckbox(id: string, bar: HTMLElement): HTMLElement {\n  const checkbox = createElement('input', {\n    type: 'checkbox',\n    className: 'bulk-checkbox',\n  }) as HTMLInputElement;\n  checkbox.setAttribute('data-id', id);\n  checkbox.checked = isSelected(id);\n\n  on(checkbox, 'change', (e) => {\n    e.stopPropagation();\n    toggleSelection(id, bar);\n    checkbox.checked = isSelected(id);\n  });\n\n  return checkbox;\n}\n\nexport default createBulkActionsBar;\n","/**\n * Sync Status Component\n * Shows synchronization status and dead letters\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface SyncStatusProps {\n  showDetails?: boolean;\n}\n\ninterface SyncState {\n  connected: boolean;\n  lastSync: string | null;\n  pendingCount: number;\n  errorCount: number;\n}\n\ninterface DeadLetter {\n  id: string;\n  type: string;\n  payload: unknown;\n  error: string;\n  failedAt: string;\n  retryCount: number;\n}\n\n/**\n * Create sync status component\n */\nexport function createSyncStatus(props: SyncStatusProps = {}): HTMLElement {\n  const container = createElement('div', { className: 'sync-status' });\n\n  container.innerHTML = `\n    <div class=\"sync-indicator\" id=\"sync-indicator\">\n      <span class=\"sync-icon\"></span>\n      <span class=\"sync-text\">Checking...</span>\n    </div>\n    ${props.showDetails ? `\n      <div class=\"sync-details\" id=\"sync-details\" style=\"display: none;\">\n        <div class=\"sync-info\"></div>\n        <div class=\"dead-letters\"></div>\n      </div>\n    ` : ''}\n  `;\n\n  const indicator = container.querySelector('#sync-indicator') as HTMLElement;\n  \n  // Toggle details on click\n  if (props.showDetails) {\n    on(indicator, 'click', () => {\n      const details = container.querySelector('#sync-details') as HTMLElement;\n      const isVisible = details.style.display !== 'none';\n      details.style.display = isVisible ? 'none' : 'block';\n      if (!isVisible) {\n        loadSyncDetails(container);\n      }\n    });\n  }\n\n  // Initial check\n  checkSyncStatus(container);\n\n  // Periodic refresh\n  setInterval(() => checkSyncStatus(container), 30000);\n\n  return container;\n}\n\n/**\n * Check sync status\n */\nasync function checkSyncStatus(container: HTMLElement): Promise<void> {\n  try {\n    const response = await http.get<SyncState>('/api/sync/status');\n    updateIndicator(container, response.data);\n  } catch {\n    updateIndicator(container, {\n      connected: false,\n      lastSync: null,\n      pendingCount: 0,\n      errorCount: 0,\n    });\n  }\n}\n\n/**\n * Update indicator\n */\nfunction updateIndicator(container: HTMLElement, state: SyncState): void {\n  const icon = container.querySelector('.sync-icon') as HTMLElement;\n  const text = container.querySelector('.sync-text') as HTMLElement;\n  const indicator = container.querySelector('.sync-indicator') as HTMLElement;\n\n  if (!state.connected) {\n    icon.textContent = '';\n    text.textContent = 'Disconnected';\n    indicator.classList.remove('synced', 'syncing');\n    indicator.classList.add('error');\n  } else if (state.pendingCount > 0) {\n    icon.textContent = '';\n    text.textContent = `Syncing (${state.pendingCount})`;\n    indicator.classList.remove('synced', 'error');\n    indicator.classList.add('syncing');\n  } else if (state.errorCount > 0) {\n    icon.textContent = '!';\n    text.textContent = `${state.errorCount} errors`;\n    indicator.classList.remove('synced', 'syncing');\n    indicator.classList.add('error');\n  } else {\n    icon.textContent = '';\n    text.textContent = state.lastSync ? formatRelativeTime(state.lastSync) : 'Synced';\n    indicator.classList.remove('syncing', 'error');\n    indicator.classList.add('synced');\n  }\n}\n\n/**\n * Load sync details\n */\nasync function loadSyncDetails(container: HTMLElement): Promise<void> {\n  const infoContainer = container.querySelector('.sync-info') as HTMLElement;\n  const deadLettersContainer = container.querySelector('.dead-letters') as HTMLElement;\n\n  infoContainer.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    // Get sync status\n    const statusResponse = await http.get<SyncState>('/api/sync/status');\n    const state = statusResponse.data;\n\n    infoContainer.innerHTML = `\n      <div class=\"info-grid\">\n        <div class=\"info-item\">\n          <span class=\"info-label\">Status</span>\n          <span class=\"info-value ${state.connected ? 'success' : 'error'}\">\n            ${state.connected ? 'Connected' : 'Disconnected'}\n          </span>\n        </div>\n        <div class=\"info-item\">\n          <span class=\"info-label\">Last Sync</span>\n          <span class=\"info-value\">${state.lastSync ? formatRelativeTime(state.lastSync) : 'Never'}</span>\n        </div>\n        <div class=\"info-item\">\n          <span class=\"info-label\">Pending</span>\n          <span class=\"info-value\">${state.pendingCount}</span>\n        </div>\n        <div class=\"info-item\">\n          <span class=\"info-label\">Errors</span>\n          <span class=\"info-value ${state.errorCount > 0 ? 'error' : ''}\">${state.errorCount}</span>\n        </div>\n      </div>\n    `;\n\n    // Get dead letters\n    const deadLettersResponse = await http.get<{ deadLetters: DeadLetter[] }>('/api/sync/dead-letters');\n    const deadLetters = deadLettersResponse.data.deadLetters || [];\n\n    if (deadLetters.length > 0) {\n      deadLettersContainer.innerHTML = `\n        <h4>Failed Operations</h4>\n        <div class=\"dead-letters-list\">\n          ${deadLetters.map(dl => `\n            <div class=\"dead-letter\" data-id=\"${dl.id}\">\n              <div class=\"dl-header\">\n                <span class=\"dl-type\">${dl.type}</span>\n                <span class=\"dl-time\">${formatRelativeTime(dl.failedAt)}</span>\n              </div>\n              <div class=\"dl-error\">${escapeHtml(dl.error)}</div>\n              <div class=\"dl-actions\">\n                <button class=\"btn btn-sm retry-btn\" data-id=\"${dl.id}\">Retry</button>\n                <span class=\"dl-retries\">${dl.retryCount} attempts</span>\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      `;\n\n      // Bind retry buttons\n      deadLettersContainer.querySelectorAll('.retry-btn').forEach(btn => {\n        on(btn as HTMLElement, 'click', async () => {\n          const id = btn.getAttribute('data-id');\n          if (!id) return;\n\n          try {\n            await http.post(`/api/sync/retry/${id}`);\n            toast.success('Retry scheduled');\n            loadSyncDetails(container);\n          } catch {\n            toast.error('Retry failed');\n          }\n        });\n      });\n    } else {\n      deadLettersContainer.innerHTML = '';\n    }\n  } catch {\n    infoContainer.innerHTML = '<div class=\"error\">Failed to load details</div>';\n  }\n}\n\n/**\n * Create mini sync indicator for header\n */\nexport function createSyncIndicator(): HTMLElement {\n  const indicator = createElement('div', { className: 'sync-indicator-mini' });\n  indicator.innerHTML = '<span class=\"sync-dot\"></span>';\n\n  // Initial check\n  checkMiniStatus(indicator);\n\n  // Periodic refresh\n  setInterval(() => checkMiniStatus(indicator), 30000);\n\n  return indicator;\n}\n\n/**\n * Check mini status\n */\nasync function checkMiniStatus(indicator: HTMLElement): Promise<void> {\n  try {\n    const response = await http.get<SyncState>('/api/sync/status');\n    const dot = indicator.querySelector('.sync-dot') as HTMLElement;\n    \n    if (!response.data.connected) {\n      dot.className = 'sync-dot error';\n      indicator.title = 'Disconnected';\n    } else if (response.data.errorCount > 0) {\n      dot.className = 'sync-dot warning';\n      indicator.title = `${response.data.errorCount} sync errors`;\n    } else {\n      dot.className = 'sync-dot success';\n      indicator.title = 'Synced';\n    }\n  } catch {\n    const dot = indicator.querySelector('.sync-dot') as HTMLElement;\n    dot.className = 'sync-dot error';\n    indicator.title = 'Connection error';\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createSyncStatus;\n","/**\n * Settings Modal Component - User Preferences\n * Simplified modal for user settings (Theme, Language, Data & Privacy)\n * Admin/LLM settings are now in the Admin panel (sidebar)\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { appStore } from '../../stores/app';\nimport { theme } from '../../services/theme';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'settings-modal';\n\nexport interface SettingsModalProps {\n  onSave?: (settings: Record<string, unknown>) => void;\n  initialTab?: 'general' | 'data';\n}\n\n/**\n * Create and show settings modal\n */\nexport function showSettingsModal(props: SettingsModalProps = {}): void {\n  // Remove existing modal if any\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const state = appStore.getState();\n  const currentTheme = theme.getMode();\n  const initialTab = props.initialTab || 'general';\n\n  // Create modal container\n  const modalOverlay = createElement('div', { className: 'settings-modal-overlay' });\n  modalOverlay.setAttribute('data-modal-id', MODAL_ID);\n  \n  const container = createElement('div', { className: 'settings-modal-container' });\n  \n  container.innerHTML = `\n    <style>\n      .settings-modal-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.5);\n        backdrop-filter: blur(4px);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 1000;\n        padding: 20px;\n      }\n      \n      .settings-modal-container {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        width: 100%;\n        max-width: 520px;\n      }\n      \n      .settings-card {\n        background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(248,250,252,0.98) 100%);\n        backdrop-filter: blur(20px);\n        border-radius: 20px;\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\n          0 0 0 1px rgba(255, 255, 255, 0.8);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .settings-card {\n        background: linear-gradient(135deg, rgba(30,41,59,0.98) 0%, rgba(15,23,42,0.98) 100%);\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\n          0 0 0 1px rgba(255, 255, 255, 0.1);\n      }\n      \n      .settings-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 24px 28px;\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .settings-header::before {\n        content: '';\n        position: absolute;\n        top: -50%;\n        right: -50%;\n        width: 100%;\n        height: 200%;\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\n        pointer-events: none;\n      }\n      \n      .settings-header-content {\n        display: flex;\n        align-items: center;\n        gap: 14px;\n        position: relative;\n        z-index: 1;\n      }\n      \n      .settings-icon {\n        width: 48px;\n        height: 48px;\n        border-radius: 12px;\n        background: rgba(255,255,255,0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border: 2px solid rgba(255,255,255,0.3);\n      }\n      \n      .settings-icon svg {\n        width: 28px;\n        height: 28px;\n        stroke: white;\n        fill: none;\n      }\n      \n      .settings-title {\n        flex: 1;\n      }\n      \n      .settings-title h2 {\n        color: white;\n        font-size: 1.4rem;\n        font-weight: 600;\n        margin: 0;\n        text-shadow: 0 1px 2px rgba(0,0,0,0.1);\n      }\n      \n      .settings-title p {\n        color: rgba(255,255,255,0.85);\n        font-size: 0.85rem;\n        margin: 4px 0 0;\n      }\n      \n      .settings-close {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: background 0.2s;\n        z-index: 2;\n      }\n      \n      .settings-close:hover {\n        background: rgba(255,255,255,0.3);\n      }\n      \n      .settings-close svg {\n        width: 18px;\n        height: 18px;\n        stroke: white;\n      }\n      \n      .settings-tabs {\n        display: flex;\n        gap: 8px;\n        padding: 16px 24px;\n        background: var(--bg-secondary, #f8fafc);\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\n      }\n      \n      [data-theme=\"dark\"] .settings-tabs {\n        background: rgba(30,41,59,0.5);\n        border-bottom-color: rgba(255,255,255,0.1);\n      }\n      \n      .settings-tab {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        padding: 10px 16px;\n        border: none;\n        background: transparent;\n        color: var(--text-secondary, #64748b);\n        font-size: 0.9rem;\n        font-weight: 500;\n        cursor: pointer;\n        border-radius: 10px;\n        transition: all 0.2s;\n      }\n      \n      .settings-tab:hover {\n        background: var(--bg-hover, rgba(0,0,0,0.05));\n        color: var(--text-primary, #1e293b);\n      }\n      \n      .settings-tab.active {\n        background: white;\n        color: #e11d48;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n      }\n      \n      [data-theme=\"dark\"] .settings-tab.active {\n        background: rgba(225,29,72,0.15);\n        color: #fb7185;\n      }\n      \n      .settings-tab svg {\n        width: 18px;\n        height: 18px;\n        stroke: currentColor;\n        fill: none;\n      }\n      \n      .settings-body {\n        padding: 24px;\n        max-height: 400px;\n        overflow-y: auto;\n      }\n      \n      .settings-section {\n        display: none;\n      }\n      \n      .settings-section.active {\n        display: block;\n      }\n      \n      .settings-section h3 {\n        font-size: 0.85rem;\n        font-weight: 600;\n        color: var(--text-secondary, #64748b);\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n        margin: 0 0 16px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .settings-section h3 svg {\n        width: 16px;\n        height: 16px;\n        stroke: currentColor;\n      }\n      \n      .form-group {\n        margin-bottom: 20px;\n      }\n      \n      .form-group:last-child {\n        margin-bottom: 0;\n      }\n      \n      .form-group label {\n        display: block;\n        font-size: 0.9rem;\n        font-weight: 500;\n        color: var(--text-primary, #1e293b);\n        margin-bottom: 8px;\n      }\n      \n      .form-group p.hint {\n        font-size: 0.8rem;\n        color: var(--text-secondary, #64748b);\n        margin: 6px 0 0;\n      }\n      \n      .form-select {\n        width: 100%;\n        padding: 12px 14px;\n        border: 1px solid var(--border-color, #e2e8f0);\n        border-radius: 10px;\n        background: var(--bg-primary, white);\n        color: var(--text-primary, #1e293b);\n        font-size: 0.9rem;\n        transition: border-color 0.2s, box-shadow 0.2s;\n        appearance: none;\n        background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2364748b' d='M2.5 4.5L6 8l3.5-3.5'/%3E%3C/svg%3E\");\n        background-repeat: no-repeat;\n        background-position: right 12px center;\n        cursor: pointer;\n      }\n      \n      .form-select:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\n      }\n      \n      [data-theme=\"dark\"] .form-select {\n        background-color: rgba(30,41,59,0.8);\n        border-color: rgba(255,255,255,0.1);\n      }\n      \n      .toggle-group {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 14px 16px;\n        background: var(--bg-secondary, #f8fafc);\n        border-radius: 10px;\n        margin-bottom: 12px;\n      }\n      \n      [data-theme=\"dark\"] .toggle-group {\n        background: rgba(30,41,59,0.5);\n      }\n      \n      .toggle-group:last-child {\n        margin-bottom: 0;\n      }\n      \n      .toggle-info {\n        flex: 1;\n      }\n      \n      .toggle-info strong {\n        display: block;\n        font-size: 0.9rem;\n        color: var(--text-primary, #1e293b);\n        margin-bottom: 2px;\n      }\n      \n      .toggle-info span {\n        font-size: 0.8rem;\n        color: var(--text-secondary, #64748b);\n      }\n      \n      .toggle-switch {\n        position: relative;\n        width: 48px;\n        height: 26px;\n        flex-shrink: 0;\n      }\n      \n      .toggle-switch input {\n        opacity: 0;\n        width: 0;\n        height: 0;\n      }\n      \n      .toggle-slider {\n        position: absolute;\n        cursor: pointer;\n        inset: 0;\n        background: var(--bg-tertiary, #cbd5e1);\n        border-radius: 26px;\n        transition: 0.3s;\n      }\n      \n      .toggle-slider::before {\n        content: '';\n        position: absolute;\n        width: 20px;\n        height: 20px;\n        left: 3px;\n        bottom: 3px;\n        background: white;\n        border-radius: 50%;\n        transition: 0.3s;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\n      }\n      \n      .toggle-switch input:checked + .toggle-slider {\n        background: #e11d48;\n      }\n      \n      .toggle-switch input:checked + .toggle-slider::before {\n        transform: translateX(22px);\n      }\n      \n      .settings-footer {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        padding: 20px 24px;\n        background: var(--bg-secondary, #f8fafc);\n        border-top: 1px solid var(--border-color, #e2e8f0);\n      }\n      \n      [data-theme=\"dark\"] .settings-footer {\n        background: rgba(30,41,59,0.5);\n        border-top-color: rgba(255,255,255,0.1);\n      }\n      \n      .btn-cancel {\n        padding: 10px 20px;\n        border: 1px solid var(--border-color, #e2e8f0);\n        border-radius: 10px;\n        background: var(--bg-primary, white);\n        color: var(--text-primary, #1e293b);\n        font-size: 0.9rem;\n        font-weight: 500;\n        cursor: pointer;\n        transition: background 0.2s;\n      }\n      \n      .btn-cancel:hover {\n        background: var(--bg-hover, #f1f5f9);\n      }\n      \n      .btn-save {\n        padding: 10px 24px;\n        border: none;\n        border-radius: 10px;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        font-size: 0.9rem;\n        font-weight: 500;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        transition: transform 0.2s, box-shadow 0.2s;\n      }\n      \n      .btn-save:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\n      }\n      \n      .btn-save svg {\n        width: 18px;\n        height: 18px;\n        stroke: white;\n      }\n      \n      .admin-notice {\n        background: linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(37,99,235,0.1) 100%);\n        border: 1px solid rgba(59,130,246,0.3);\n        border-radius: 10px;\n        padding: 14px 16px;\n        margin-top: 20px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n      \n      .admin-notice svg {\n        width: 20px;\n        height: 20px;\n        stroke: #3b82f6;\n        flex-shrink: 0;\n      }\n      \n      .admin-notice p {\n        font-size: 0.85rem;\n        color: var(--text-secondary, #64748b);\n        margin: 0;\n      }\n      \n      .admin-notice strong {\n        color: #3b82f6;\n      }\n    </style>\n    \n    <div class=\"settings-card\">\n      <!-- Header -->\n      <div class=\"settings-header\">\n        <button class=\"settings-close\" id=\"close-settings-btn\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M18 6L6 18M6 6l12 12\"/>\n          </svg>\n        </button>\n        <div class=\"settings-header-content\">\n          <div class=\"settings-icon\">\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\n              <path d=\"M12 15a3 3 0 100-6 3 3 0 000 6z\"/>\n              <path d=\"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z\"/>\n            </svg>\n          </div>\n          <div class=\"settings-title\">\n            <h2>Settings</h2>\n            <p>Your personal preferences</p>\n          </div>\n        </div>\n      </div>\n      \n      <!-- Tabs -->\n      <div class=\"settings-tabs\">\n        <button class=\"settings-tab ${initialTab === 'general' ? 'active' : ''}\" data-tab=\"general\">\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"3\"/>\n            <path d=\"M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41\"/>\n          </svg>\n          General\n        </button>\n        <button class=\"settings-tab ${initialTab === 'data' ? 'active' : ''}\" data-tab=\"data\">\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\n            <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\"/>\n          </svg>\n          Data & Privacy\n        </button>\n      </div>\n      \n      <!-- Body -->\n      <div class=\"settings-body\">\n        <!-- General Section -->\n        <div class=\"settings-section ${initialTab === 'general' ? 'active' : ''}\" id=\"section-general\">\n          <h3>\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\n              <path d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707\"/>\n            </svg>\n            Appearance\n          </h3>\n          \n          <div class=\"form-group\">\n            <label>Theme</label>\n            <select class=\"form-select\" id=\"setting-theme\">\n              <option value=\"system\" ${currentTheme === 'system' ? 'selected' : ''}>System (Auto)</option>\n              <option value=\"light\" ${currentTheme === 'light' ? 'selected' : ''}>Light</option>\n              <option value=\"dark\" ${currentTheme === 'dark' ? 'selected' : ''}>Dark</option>\n            </select>\n            <p class=\"hint\">Choose your preferred color scheme</p>\n          </div>\n          \n          <div class=\"form-group\">\n            <label>Language</label>\n            <select class=\"form-select\" id=\"setting-language\">\n              <option value=\"en\" ${state.config.language === 'en' ? 'selected' : ''}>English</option>\n              <option value=\"pt\" ${state.config.language === 'pt' ? 'selected' : ''}>Portugues</option>\n              <option value=\"es\" ${state.config.language === 'es' ? 'selected' : ''}>Espanol</option>\n            </select>\n            <p class=\"hint\">Interface language preference</p>\n          </div>\n          \n          ${state.currentUser?.role === 'superadmin' ? `\n            <div class=\"admin-notice\">\n              <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n                <path d=\"M12 16v-4M12 8h.01\"/>\n              </svg>\n              <p>For <strong>LLM configuration</strong>, <strong>Graph</strong>, and other platform settings, use the <strong>Admin</strong> section in the sidebar menu.</p>\n            </div>\n          ` : ''}\n        </div>\n        \n        <!-- Data & Privacy Section -->\n        <div class=\"settings-section ${initialTab === 'data' ? 'active' : ''}\" id=\"section-data\">\n          <h3>\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\n              <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\"/>\n            </svg>\n            Privacy Settings\n          </h3>\n          \n          <div class=\"toggle-group\">\n            <div class=\"toggle-info\">\n              <strong>Analytics</strong>\n              <span>Help improve GodMode with anonymous usage data</span>\n            </div>\n            <label class=\"toggle-switch\">\n              <input type=\"checkbox\" id=\"setting-analytics\" ${state.config.analyticsEnabled !== false ? 'checked' : ''}>\n              <span class=\"toggle-slider\"></span>\n            </label>\n          </div>\n          \n          <div class=\"toggle-group\">\n            <div class=\"toggle-info\">\n              <strong>Error Reporting</strong>\n              <span>Automatically report errors to help fix bugs</span>\n            </div>\n            <label class=\"toggle-switch\">\n              <input type=\"checkbox\" id=\"setting-error-reporting\" ${state.config.errorReportingEnabled !== false ? 'checked' : ''}>\n              <span class=\"toggle-slider\"></span>\n            </label>\n          </div>\n          \n          <div class=\"toggle-group\">\n            <div class=\"toggle-info\">\n              <strong>AI Data Improvement</strong>\n              <span>Allow anonymized data to improve AI responses</span>\n            </div>\n            <label class=\"toggle-switch\">\n              <input type=\"checkbox\" id=\"setting-ai-improvement\" ${state.config.aiImprovementEnabled === true ? 'checked' : ''}>\n              <span class=\"toggle-slider\"></span>\n            </label>\n          </div>\n        </div>\n      </div>\n      \n      <!-- Footer -->\n      <div class=\"settings-footer\">\n        <button class=\"btn-cancel\" id=\"cancel-settings-btn\">Cancel</button>\n        <button class=\"btn-save\" id=\"save-settings-btn\">\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\n            <polyline points=\"20 6 9 17 4 12\"/>\n          </svg>\n          Save Settings\n        </button>\n      </div>\n    </div>\n  `;\n  \n  modalOverlay.appendChild(container);\n  document.body.appendChild(modalOverlay);\n  \n  // Bind events\n  bindSettingsEvents(modalOverlay, props);\n}\n\n/**\n * Bind event handlers\n */\nfunction bindSettingsEvents(overlay: HTMLElement, props: SettingsModalProps): void {\n  // Close buttons\n  const closeBtn = overlay.querySelector('#close-settings-btn');\n  const cancelBtn = overlay.querySelector('#cancel-settings-btn');\n  \n  const closeModal = () => overlay.remove();\n  \n  if (closeBtn) on(closeBtn as HTMLElement, 'click', closeModal);\n  if (cancelBtn) on(cancelBtn as HTMLElement, 'click', closeModal);\n  \n  // Close on overlay click\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) closeModal();\n  });\n  \n  // Tab switching\n  const tabs = overlay.querySelectorAll('.settings-tab');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      const tabId = tab.getAttribute('data-tab');\n      \n      // Update tab buttons\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      \n      // Update sections\n      overlay.querySelectorAll('.settings-section').forEach(section => {\n        section.classList.remove('active');\n      });\n      const targetSection = overlay.querySelector(`#section-${tabId}`);\n      if (targetSection) targetSection.classList.add('active');\n    });\n  });\n  \n  // Theme change (immediate preview)\n  const themeSelect = overlay.querySelector('#setting-theme') as HTMLSelectElement;\n  if (themeSelect) {\n    on(themeSelect, 'change', () => {\n      theme.set(themeSelect.value as 'light' | 'dark' | 'system');\n    });\n  }\n  \n  // Save button\n  const saveBtn = overlay.querySelector('#save-settings-btn');\n  if (saveBtn) {\n    on(saveBtn as HTMLElement, 'click', () => {\n      const settings = {\n        theme: (overlay.querySelector('#setting-theme') as HTMLSelectElement)?.value,\n        language: (overlay.querySelector('#setting-language') as HTMLSelectElement)?.value,\n        analyticsEnabled: (overlay.querySelector('#setting-analytics') as HTMLInputElement)?.checked,\n        errorReportingEnabled: (overlay.querySelector('#setting-error-reporting') as HTMLInputElement)?.checked,\n        aiImprovementEnabled: (overlay.querySelector('#setting-ai-improvement') as HTMLInputElement)?.checked,\n      };\n      \n      // Update app state\n      appStore.setConfig({\n        ...appStore.getState().config,\n        ...settings,\n      });\n      \n      // Call onSave callback\n      props.onSave?.(settings);\n      \n      toast.success('Settings saved');\n      closeModal();\n    });\n  }\n}\n\n/**\n * Close settings modal\n */\nexport function closeSettingsModal(): void {\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (modal) modal.remove();\n}\n\nexport default showSettingsModal;\n","/**\n * Processing Modal Component\n * Shows progress for file processing operations\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal, updateModalContent } from '../Modal';\n\nconst MODAL_ID = 'processing-modal';\n\nexport interface ProcessingStep {\n  id: string;\n  label: string;\n  status: 'pending' | 'running' | 'completed' | 'error';\n  progress?: number;\n  message?: string;\n}\n\nexport interface ProcessingModalProps {\n  title?: string;\n  steps?: ProcessingStep[];\n  onCancel?: () => void;\n  allowCancel?: boolean;\n}\n\nlet currentSteps: ProcessingStep[] = [];\nlet cancelCallback: (() => void) | undefined;\n\n/**\n * Show processing modal\n */\nexport function showProcessingModal(props: ProcessingModalProps = {}): void {\n  const {\n    title = 'Processing',\n    steps = [],\n    onCancel,\n    allowCancel = true,\n  } = props;\n\n  currentSteps = steps;\n  cancelCallback = onCancel;\n\n  // Remove existing modal if any\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'processing-content' });\n  renderContent(content);\n\n  const footer = allowCancel ? createFooter() : null;\n\n  const modal = createModal({\n    id: MODAL_ID,\n    title,\n    content,\n    size: 'md',\n    closable: false,\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Render processing content\n */\nfunction renderContent(container: HTMLElement): void {\n  container.innerHTML = `\n    <div class=\"processing-steps\">\n      ${currentSteps.map(step => renderStep(step)).join('')}\n    </div>\n    <div class=\"processing-overall\">\n      <div class=\"progress-bar\">\n        <div class=\"progress-fill\" style=\"width: ${calculateOverallProgress()}%\"></div>\n      </div>\n      <div class=\"progress-text\">${calculateOverallProgress()}% complete</div>\n    </div>\n  `;\n}\n\n/**\n * Render a single step\n */\nfunction renderStep(step: ProcessingStep): string {\n  const statusIcon = {\n    pending: '',\n    running: '',\n    completed: '',\n    error: '',\n  }[step.status];\n\n  const statusClass = step.status;\n\n  return `\n    <div class=\"processing-step ${statusClass}\" data-step-id=\"${step.id}\">\n      <span class=\"step-icon\">${statusIcon}</span>\n      <div class=\"step-content\">\n        <div class=\"step-label\">${step.label}</div>\n        ${step.message ? `<div class=\"step-message\">${step.message}</div>` : ''}\n        ${step.status === 'running' && step.progress !== undefined ? `\n          <div class=\"step-progress\">\n            <div class=\"progress-bar small\">\n              <div class=\"progress-fill\" style=\"width: ${step.progress}%\"></div>\n            </div>\n          </div>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Calculate overall progress\n */\nfunction calculateOverallProgress(): number {\n  if (currentSteps.length === 0) return 0;\n\n  const completed = currentSteps.filter(s => s.status === 'completed').length;\n  const running = currentSteps.find(s => s.status === 'running');\n  const runningProgress = running?.progress || 0;\n\n  return Math.round(\n    ((completed + (running ? runningProgress / 100 : 0)) / currentSteps.length) * 100\n  );\n}\n\n/**\n * Create footer with cancel button\n */\nfunction createFooter(): HTMLElement {\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const cancelBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Cancel',\n  });\n\n  on(cancelBtn, 'click', () => {\n    cancelCallback?.();\n    closeProcessingModal();\n  });\n\n  footer.appendChild(cancelBtn);\n  return footer;\n}\n\n/**\n * Update processing step\n */\nexport function updateProcessingStep(\n  stepId: string,\n  updates: Partial<ProcessingStep>\n): void {\n  const stepIndex = currentSteps.findIndex(s => s.id === stepId);\n  if (stepIndex === -1) return;\n\n  currentSteps[stepIndex] = { ...currentSteps[stepIndex], ...updates };\n\n  // Re-render\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (modal) {\n    const content = modal.querySelector('.processing-content');\n    if (content) {\n      renderContent(content as HTMLElement);\n    }\n  }\n}\n\n/**\n * Add a new step\n */\nexport function addProcessingStep(step: ProcessingStep): void {\n  currentSteps.push(step);\n\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (modal) {\n    const content = modal.querySelector('.processing-content');\n    if (content) {\n      renderContent(content as HTMLElement);\n    }\n  }\n}\n\n/**\n * Set all steps at once\n */\nexport function setProcessingSteps(steps: ProcessingStep[]): void {\n  currentSteps = steps;\n\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (modal) {\n    const content = modal.querySelector('.processing-content');\n    if (content) {\n      renderContent(content as HTMLElement);\n    }\n  }\n}\n\n/**\n * Close processing modal\n */\nexport function closeProcessingModal(): void {\n  closeModal(MODAL_ID);\n  currentSteps = [];\n  cancelCallback = undefined;\n}\n\n/**\n * Check if processing modal is open\n */\nexport function isProcessingModalOpen(): boolean {\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  return modal?.classList.contains('open') || false;\n}\n\nexport default showProcessingModal;\n","/**\n * Auth Modal Component\n * Login, registration, and password reset dialogs\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { auth } from '../../services/auth';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'auth-modal';\n\nexport type AuthMode = 'login' | 'register' | 'forgot' | 'reset' | 'otp-request' | 'otp-verify' | 'email-confirm';\n\nexport interface AuthModalProps {\n  initialMode?: AuthMode;\n  resetToken?: string; // For password reset flow\n  email?: string; // For OTP flows\n  onSuccess?: (user: { id: string; email: string; name?: string }) => void;\n  onClose?: () => void;\n  required?: boolean; // If true, modal cannot be closed without logging in\n}\n\nlet currentMode: AuthMode = 'login';\nlet currentProps: AuthModalProps = {};\nlet otpEmail: string = '';\nlet resendCooldown: number = 0;\nlet resendTimer: NodeJS.Timeout | null = null;\n\n/**\n * Show auth modal\n */\nexport function showAuthModal(props: AuthModalProps = {}): void {\n  currentMode = props.initialMode || 'login';\n  currentProps = props;\n\n  // Remove existing modal if any\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'auth-content' });\n  renderAuthContent(content);\n\n  const modal = createModal({\n    id: MODAL_ID,\n    title: getTitle(),\n    content,\n    size: 'sm',\n    closable: !props.required, // Can't close if login is required\n    onClose: props.onClose,\n    footer: null,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Focus first input\n  setTimeout(() => {\n    const firstInput = content.querySelector('input') as HTMLInputElement;\n    if (firstInput) firstInput.focus();\n  }, 100);\n}\n\n/**\n * Get modal title based on mode\n */\nfunction getTitle(): string {\n  switch (currentMode) {\n    case 'login': return 'Sign In';\n    case 'register': return 'Create Account';\n    case 'forgot': return 'Reset Password';\n    case 'reset': return 'Set New Password';\n    case 'otp-request': return 'Sign In with Code';\n    case 'otp-verify': return 'Enter Code';\n    case 'email-confirm': return 'Confirm Email';\n  }\n}\n\n/**\n * Render auth content\n */\nfunction renderAuthContent(container: HTMLElement): void {\n  // Clear any existing timers\n  if (resendTimer) {\n    clearInterval(resendTimer);\n    resendTimer = null;\n  }\n  \n  switch (currentMode) {\n    case 'login':\n      renderLoginForm(container);\n      break;\n    case 'register':\n      renderRegisterForm(container);\n      break;\n    case 'forgot':\n      renderForgotForm(container);\n      break;\n    case 'reset':\n      renderResetForm(container);\n      break;\n    case 'otp-request':\n      renderOTPRequestForm(container);\n      break;\n    case 'otp-verify':\n      renderOTPVerifyForm(container);\n      break;\n    case 'email-confirm':\n      renderEmailConfirmForm(container);\n      break;\n  }\n}\n\n/**\n * Render login form\n */\nfunction renderLoginForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"login-form\" class=\"auth-form\">\n      <div class=\"form-group\">\n        <label for=\"login-email\">Email</label>\n        <input type=\"email\" id=\"login-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\n      </div>\n      <div class=\"form-group\">\n        <label for=\"login-password\">Password</label>\n        <input type=\"password\" id=\"login-password\" required autocomplete=\"current-password\" placeholder=\"\">\n      </div>\n      <div class=\"form-error\" id=\"login-error\" style=\"display: none;\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Sign In</span>\n          <span class=\"btn-loading\" style=\"display: none;\">Signing in...</span>\n        </button>\n      </div>\n      <div class=\"auth-divider\">\n        <span>or</span>\n      </div>\n      <div class=\"form-group\">\n        <button type=\"button\" class=\"btn btn-secondary btn-block\" data-action=\"otp-request\">\n          Sign in with email code\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"forgot\">Forgot password?</button>\n        <span class=\"separator\">|</span>\n        <button type=\"button\" class=\"btn-link\" data-action=\"register\">Create account</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#login-form') as HTMLFormElement;\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleLogin(form);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render registration form\n */\nfunction renderRegisterForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"register-form\" class=\"auth-form\">\n      <div class=\"form-group\">\n        <label for=\"register-email\">Email <span class=\"required\">*</span></label>\n        <input type=\"email\" id=\"register-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-username\">Username</label>\n        <input type=\"text\" id=\"register-username\" autocomplete=\"username\" placeholder=\"username (optional)\" \n               pattern=\"^[a-zA-Z0-9_]+$\" minlength=\"3\">\n        <small class=\"form-hint\">Letters, numbers, and underscores only. Min 3 characters.</small>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-display-name\">Display Name</label>\n        <input type=\"text\" id=\"register-display-name\" autocomplete=\"name\" placeholder=\"Your Name (optional)\">\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-password\">Password <span class=\"required\">*</span></label>\n        <input type=\"password\" id=\"register-password\" required autocomplete=\"new-password\" \n               minlength=\"12\" placeholder=\"Min. 12 characters\">\n        <div class=\"password-strength\" id=\"password-strength\"></div>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-confirm\">Confirm Password <span class=\"required\">*</span></label>\n        <input type=\"password\" id=\"register-confirm\" required autocomplete=\"new-password\" placeholder=\"\">\n      </div>\n      <div class=\"form-error\" id=\"register-error\" style=\"display: none;\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Create Account</span>\n          <span class=\"btn-loading\" style=\"display: none;\">Creating account...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Already have an account? Sign in</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#register-form') as HTMLFormElement;\n  \n  // Password strength indicator\n  const passwordInput = form.querySelector('#register-password') as HTMLInputElement;\n  on(passwordInput, 'input', () => {\n    updatePasswordStrength(passwordInput.value);\n  });\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleRegister(form);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render forgot password form\n */\nfunction renderForgotForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"forgot-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter your email address and we'll send you a link to reset your password.\n      </p>\n      <div class=\"form-group\">\n        <label for=\"forgot-email\">Email</label>\n        <input type=\"email\" id=\"forgot-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\n      </div>\n      <div class=\"form-error\" id=\"forgot-error\" style=\"display: none;\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Send Reset Link</span>\n          <span class=\"btn-loading\" style=\"display: none;\">Sending...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Back to sign in</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#forgot-form') as HTMLFormElement;\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleForgot(form);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render reset password form\n */\nfunction renderResetForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"reset-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter your new password below.\n      </p>\n      <div class=\"form-group\">\n        <label for=\"reset-password\">New Password</label>\n        <input type=\"password\" id=\"reset-password\" required autocomplete=\"new-password\" \n               minlength=\"12\" placeholder=\"Min. 12 characters\">\n        <div class=\"password-strength\" id=\"reset-password-strength\"></div>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"reset-confirm\">Confirm Password</label>\n        <input type=\"password\" id=\"reset-confirm\" required autocomplete=\"new-password\" placeholder=\"\">\n      </div>\n      <div class=\"form-error\" id=\"reset-error\" style=\"display: none;\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Reset Password</span>\n          <span class=\"btn-loading\" style=\"display: none;\">Resetting...</span>\n        </button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#reset-form') as HTMLFormElement;\n  \n  // Password strength indicator\n  const passwordInput = form.querySelector('#reset-password') as HTMLInputElement;\n  on(passwordInput, 'input', () => {\n    updatePasswordStrength(passwordInput.value, 'reset-password-strength');\n  });\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleReset(form);\n  });\n}\n\n/**\n * Render OTP request form (enter email to receive code)\n */\nfunction renderOTPRequestForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"otp-request-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter your email address and we'll send you a one-time code to sign in.\n      </p>\n      <div class=\"form-group\">\n        <label for=\"otp-email\">Email</label>\n        <input type=\"email\" id=\"otp-email\" required autocomplete=\"email\" placeholder=\"your@email.com\" value=\"${otpEmail}\">\n      </div>\n      <div class=\"form-error\" id=\"otp-request-error\" style=\"display: none;\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Send Code</span>\n          <span class=\"btn-loading\" style=\"display: none;\">Sending...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Sign in with password</button>\n        <span class=\"separator\">|</span>\n        <button type=\"button\" class=\"btn-link\" data-action=\"register\">Create account</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#otp-request-form') as HTMLFormElement;\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleOTPRequest(form, container);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render OTP verify form (enter 6-digit code)\n */\nfunction renderOTPVerifyForm(container: HTMLElement): void {\n  const maskedEmail = otpEmail ? \n    otpEmail.replace(/(.{2})(.*)(@.*)/, '$1***$3') : \n    'your email';\n  \n  container.innerHTML = `\n    <form id=\"otp-verify-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter the 6-digit code sent to <strong>${maskedEmail}</strong>\n      </p>\n      <div class=\"form-group otp-input-group\">\n        <div class=\"otp-inputs\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" autocomplete=\"one-time-code\" data-index=\"0\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"1\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"2\">\n          <span class=\"otp-separator\">-</span>\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"3\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"4\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"5\">\n        </div>\n        <input type=\"hidden\" id=\"otp-code\" name=\"code\">\n      </div>\n      <div class=\"form-error\" id=\"otp-verify-error\" style=\"display: none;\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\" id=\"otp-verify-btn\" disabled>\n          <span class=\"btn-text\">Verify Code</span>\n          <span class=\"btn-loading\" style=\"display: none;\">Verifying...</span>\n        </button>\n      </div>\n      <div class=\"otp-resend\">\n        <button type=\"button\" class=\"btn-link\" id=\"resend-code-btn\" ${resendCooldown > 0 ? 'disabled' : ''}>\n          ${resendCooldown > 0 ? `Resend code in ${resendCooldown}s` : 'Resend code'}\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"otp-request\">Use different email</button>\n        <span class=\"separator\">|</span>\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Sign in with password</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#otp-verify-form') as HTMLFormElement;\n  const inputs = container.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n  const hiddenInput = container.querySelector('#otp-code') as HTMLInputElement;\n  const verifyBtn = container.querySelector('#otp-verify-btn') as HTMLButtonElement;\n  const resendBtn = container.querySelector('#resend-code-btn') as HTMLButtonElement;\n\n  // Setup OTP input handlers\n  setupOTPInputs(inputs, hiddenInput, verifyBtn);\n\n  // Setup resend cooldown timer\n  if (resendCooldown > 0) {\n    startResendCooldown(resendBtn);\n  }\n\n  // Resend handler\n  on(resendBtn, 'click', async () => {\n    await handleResendCode(container);\n  });\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleOTPVerify(form, container);\n  });\n\n  bindModeLinks(container);\n\n  // Focus first input\n  setTimeout(() => inputs[0]?.focus(), 100);\n}\n\n/**\n * Render email confirmation form\n */\nfunction renderEmailConfirmForm(container: HTMLElement): void {\n  const email = currentProps.email || otpEmail || '';\n  \n  container.innerHTML = `\n    <form id=\"email-confirm-form\" class=\"auth-form\">\n      <div class=\"confirm-icon\"></div>\n      <p class=\"form-description\">\n        Enter the confirmation code sent to <strong>${email || 'your email'}</strong>\n      </p>\n      <div class=\"form-group otp-input-group\">\n        <div class=\"otp-inputs\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"0\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"1\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"2\">\n          <span class=\"otp-separator\">-</span>\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"3\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"4\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"5\">\n        </div>\n        <input type=\"hidden\" id=\"confirm-code\" name=\"code\">\n      </div>\n      <div class=\"form-error\" id=\"email-confirm-error\" style=\"display: none;\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\" id=\"confirm-btn\" disabled>\n          <span class=\"btn-text\">Confirm Email</span>\n          <span class=\"btn-loading\" style=\"display: none;\">Confirming...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Back to sign in</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#email-confirm-form') as HTMLFormElement;\n  const inputs = container.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n  const hiddenInput = container.querySelector('#confirm-code') as HTMLInputElement;\n  const confirmBtn = container.querySelector('#confirm-btn') as HTMLButtonElement;\n\n  setupOTPInputs(inputs, hiddenInput, confirmBtn);\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleEmailConfirm(form, container, email);\n  });\n\n  bindModeLinks(container);\n  setTimeout(() => inputs[0]?.focus(), 100);\n}\n\n/**\n * Setup OTP digit inputs with auto-advance and paste support\n */\nfunction setupOTPInputs(\n  inputs: NodeListOf<HTMLInputElement>, \n  hiddenInput: HTMLInputElement, \n  submitBtn: HTMLButtonElement\n): void {\n  const updateHiddenValue = () => {\n    const code = Array.from(inputs).map(i => i.value).join('');\n    hiddenInput.value = code;\n    submitBtn.disabled = code.length !== 6 || !/^\\d{6}$/.test(code);\n  };\n\n  inputs.forEach((input, index) => {\n    // Handle input\n    on(input, 'input', (e) => {\n      const value = (e.target as HTMLInputElement).value;\n      \n      // Only allow digits\n      if (!/^\\d*$/.test(value)) {\n        input.value = value.replace(/\\D/g, '');\n        return;\n      }\n      \n      // If multiple digits pasted, distribute them\n      if (value.length > 1) {\n        const digits = value.split('');\n        inputs.forEach((inp, i) => {\n          inp.value = digits[i] || '';\n        });\n        const nextIndex = Math.min(digits.length, 5);\n        inputs[nextIndex]?.focus();\n        updateHiddenValue();\n        return;\n      }\n      \n      // Auto-advance to next input\n      if (value && index < inputs.length - 1) {\n        inputs[index + 1].focus();\n      }\n      \n      updateHiddenValue();\n    });\n\n    // Handle keydown for backspace navigation\n    on(input, 'keydown', (e) => {\n      const key = (e as KeyboardEvent).key;\n      \n      if (key === 'Backspace' && !input.value && index > 0) {\n        inputs[index - 1].focus();\n        inputs[index - 1].value = '';\n        updateHiddenValue();\n      }\n      \n      // Arrow navigation\n      if (key === 'ArrowLeft' && index > 0) {\n        inputs[index - 1].focus();\n      }\n      if (key === 'ArrowRight' && index < inputs.length - 1) {\n        inputs[index + 1].focus();\n      }\n    });\n\n    // Handle paste\n    on(input, 'paste', (e) => {\n      e.preventDefault();\n      const pasted = (e as ClipboardEvent).clipboardData?.getData('text') || '';\n      const digits = pasted.replace(/\\D/g, '').slice(0, 6);\n      \n      if (digits) {\n        digits.split('').forEach((digit, i) => {\n          if (inputs[i]) inputs[i].value = digit;\n        });\n        const nextIndex = Math.min(digits.length, 5);\n        inputs[nextIndex]?.focus();\n        updateHiddenValue();\n      }\n    });\n\n    // Select all on focus\n    on(input, 'focus', () => input.select());\n  });\n}\n\n/**\n * Start resend cooldown timer\n */\nfunction startResendCooldown(button: HTMLButtonElement): void {\n  if (resendTimer) clearInterval(resendTimer);\n  \n  const updateButton = () => {\n    if (resendCooldown > 0) {\n      button.disabled = true;\n      button.textContent = `Resend code in ${resendCooldown}s`;\n      resendCooldown--;\n    } else {\n      button.disabled = false;\n      button.textContent = 'Resend code';\n      if (resendTimer) {\n        clearInterval(resendTimer);\n        resendTimer = null;\n      }\n    }\n  };\n  \n  updateButton();\n  resendTimer = setInterval(updateButton, 1000);\n}\n\n/**\n * Handle OTP request\n */\nasync function handleOTPRequest(form: HTMLFormElement, container: HTMLElement): Promise<void> {\n  const email = (form.querySelector('#otp-email') as HTMLInputElement).value.trim();\n  const errorEl = form.querySelector('#otp-request-error') as HTMLElement;\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const result = await auth.requestLoginCode(email);\n    \n    // Store email for verify step\n    otpEmail = email;\n    \n    // Set cooldown for resend\n    resendCooldown = 60;\n    \n    toast.success(result.message || 'Code sent! Check your email.');\n    \n    // Switch to verify mode\n    currentMode = 'otp-verify';\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n    \n  } catch (error: unknown) {\n    const err = error as { message?: string; response?: { data?: { retryAfter?: number } } };\n    const message = err.message || 'Failed to send code';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle OTP verification\n */\nasync function handleOTPVerify(form: HTMLFormElement, container: HTMLElement): Promise<void> {\n  const code = (form.querySelector('#otp-code') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#otp-verify-error') as HTMLElement;\n\n  if (!code || code.length !== 6) {\n    showError(errorEl, 'Please enter the 6-digit code');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const user = await auth.verifyLoginCode(otpEmail, code);\n    \n    toast.success('Signed in successfully');\n    currentProps.onSuccess?.(user);\n    closeModal(MODAL_ID);\n    \n    // Trigger data refresh\n    window.dispatchEvent(new CustomEvent('godmode:auth-success'));\n    \n  } catch (error: unknown) {\n    const err = error as { \n      message?: string; \n      attemptsRemaining?: number;\n      needsEmailVerification?: boolean;\n      fallbackToPassword?: boolean;\n    };\n    \n    let message = err.message || 'Verification failed';\n    \n    if (err.attemptsRemaining !== undefined && err.attemptsRemaining > 0) {\n      message += ` (${err.attemptsRemaining} attempts remaining)`;\n    }\n    \n    if (err.needsEmailVerification) {\n      message = 'Please confirm your email address first.';\n      // Could switch to email-confirm mode here\n    }\n    \n    if (err.fallbackToPassword) {\n      message = 'Please sign in with your password instead.';\n    }\n    \n    showError(errorEl, message);\n    \n    // Clear inputs on error\n    const inputs = form.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n    inputs.forEach(i => i.value = '');\n    inputs[0]?.focus();\n    \n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle resend code\n */\nasync function handleResendCode(container: HTMLElement): Promise<void> {\n  if (resendCooldown > 0) return;\n  \n  const resendBtn = container.querySelector('#resend-code-btn') as HTMLButtonElement;\n  resendBtn.disabled = true;\n  resendBtn.textContent = 'Sending...';\n  \n  try {\n    await auth.requestLoginCode(otpEmail);\n    toast.success('New code sent!');\n    resendCooldown = 60;\n    startResendCooldown(resendBtn);\n  } catch (error: unknown) {\n    const err = error as { message?: string };\n    toast.error(err.message || 'Failed to resend code');\n    resendBtn.disabled = false;\n    resendBtn.textContent = 'Resend code';\n  }\n}\n\n/**\n * Handle email confirmation\n */\nasync function handleEmailConfirm(form: HTMLFormElement, container: HTMLElement, email: string): Promise<void> {\n  const code = (form.querySelector('#confirm-code') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#email-confirm-error') as HTMLElement;\n\n  if (!code || code.length !== 6) {\n    showError(errorEl, 'Please enter the 6-digit code');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    await auth.confirmEmail(email, code);\n    \n    toast.success('Email confirmed! You can now sign in.');\n    \n    // Switch to login mode\n    currentMode = 'login';\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n    \n  } catch (error: unknown) {\n    const err = error as { message?: string };\n    showError(errorEl, err.message || 'Confirmation failed');\n    \n    // Clear inputs\n    const inputs = form.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n    inputs.forEach(i => i.value = '');\n    inputs[0]?.focus();\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Bind mode switch links\n */\nfunction bindModeLinks(container: HTMLElement): void {\n  const links = container.querySelectorAll('[data-action]');\n  links.forEach(link => {\n    on(link as HTMLElement, 'click', () => {\n      const action = link.getAttribute('data-action') as AuthMode;\n      currentMode = action;\n\n      // Update modal title\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n      if (titleEl) titleEl.textContent = getTitle();\n\n      // Re-render content\n      renderAuthContent(container);\n    });\n  });\n}\n\n/**\n * Handle login submission\n */\nasync function handleLogin(form: HTMLFormElement): Promise<void> {\n  const email = (form.querySelector('#login-email') as HTMLInputElement).value.trim();\n  const password = (form.querySelector('#login-password') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#login-error') as HTMLElement;\n  \n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const user = await auth.login({ email, password });\n    \n    toast.success('Signed in successfully');\n    currentProps.onSuccess?.(user);\n    closeModal(MODAL_ID);\n    \n    // Trigger data refresh\n    window.dispatchEvent(new CustomEvent('godmode:auth-success'));\n  } catch (error: unknown) {\n    const err = error as Error & { \n      response?: { data?: { needsEmailVerification?: boolean; email?: string } } \n    };\n    \n    // Check if email verification is needed\n    const responseData = err.response?.data;\n    if (responseData?.needsEmailVerification) {\n      // Switch to email confirmation mode\n      otpEmail = responseData.email || email;\n      currentProps.email = otpEmail;\n      resendCooldown = 60; // Just sent a new code\n      \n      toast.info('Please verify your email to continue.');\n      \n      currentMode = 'email-confirm';\n      const container = form.parentElement as HTMLElement;\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n      if (titleEl) titleEl.textContent = getTitle();\n      renderAuthContent(container);\n      return;\n    }\n    \n    const message = err.message || 'Login failed';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle registration submission\n */\nasync function handleRegister(form: HTMLFormElement): Promise<void> {\n  const email = (form.querySelector('#register-email') as HTMLInputElement).value.trim();\n  const username = (form.querySelector('#register-username') as HTMLInputElement).value.trim();\n  const displayName = (form.querySelector('#register-display-name') as HTMLInputElement).value.trim();\n  const password = (form.querySelector('#register-password') as HTMLInputElement).value;\n  const confirm = (form.querySelector('#register-confirm') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#register-error') as HTMLElement;\n\n  // Validate passwords match\n  if (password !== confirm) {\n    showError(errorEl, 'Passwords do not match');\n    return;\n  }\n\n  // Validate password length\n  if (password.length < 12) {\n    showError(errorEl, 'Password must be at least 12 characters');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const result = await auth.register({\n      email,\n      password,\n      username: username || undefined,\n      display_name: displayName || undefined,\n    });\n\n    if (result.needsEmailVerification) {\n      toast.success('Account created! Please check your email to verify.');\n      // Switch to login mode\n      currentMode = 'login';\n      const container = form.parentElement as HTMLElement;\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n      if (titleEl) titleEl.textContent = getTitle();\n      renderAuthContent(container);\n    } else {\n      toast.success('Account created successfully');\n      currentProps.onSuccess?.(result.user);\n      closeModal(MODAL_ID);\n      window.dispatchEvent(new CustomEvent('godmode:auth-success'));\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Registration failed';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle forgot password submission\n */\nasync function handleForgot(form: HTMLFormElement): Promise<void> {\n  const email = (form.querySelector('#forgot-email') as HTMLInputElement).value.trim();\n  const errorEl = form.querySelector('#forgot-error') as HTMLElement;\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    await auth.forgotPassword(email);\n    toast.success('If an account exists with this email, you will receive a reset link.');\n    \n    // Switch back to login\n    currentMode = 'login';\n    const container = form.parentElement as HTMLElement;\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n  } catch (error) {\n    // Always show success message to not reveal if email exists\n    toast.success('If an account exists with this email, you will receive a reset link.');\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle password reset submission\n */\nasync function handleReset(form: HTMLFormElement): Promise<void> {\n  const password = (form.querySelector('#reset-password') as HTMLInputElement).value;\n  const confirm = (form.querySelector('#reset-confirm') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#reset-error') as HTMLElement;\n\n  if (password !== confirm) {\n    showError(errorEl, 'Passwords do not match');\n    return;\n  }\n\n  if (password.length < 12) {\n    showError(errorEl, 'Password must be at least 12 characters');\n    return;\n  }\n\n  if (!currentProps.resetToken) {\n    showError(errorEl, 'Invalid reset token. Please request a new reset link.');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    await auth.resetPassword(password, currentProps.resetToken);\n    toast.success('Password reset successfully. You can now sign in.');\n    \n    // Switch to login\n    currentMode = 'login';\n    const container = form.parentElement as HTMLElement;\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Password reset failed';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Set form loading state\n */\nfunction setFormLoading(form: HTMLFormElement, loading: boolean): void {\n  const submitBtn = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\n  const inputs = form.querySelectorAll('input');\n  const btnText = submitBtn.querySelector('.btn-text') as HTMLElement;\n  const btnLoading = submitBtn.querySelector('.btn-loading') as HTMLElement;\n\n  submitBtn.disabled = loading;\n  inputs.forEach(input => input.disabled = loading);\n  \n  if (btnText && btnLoading) {\n    btnText.style.display = loading ? 'none' : '';\n    btnLoading.style.display = loading ? '' : 'none';\n  }\n}\n\n/**\n * Show error message\n */\nfunction showError(errorEl: HTMLElement, message: string): void {\n  errorEl.textContent = message;\n  errorEl.style.display = 'block';\n}\n\n/**\n * Hide error message\n */\nfunction hideError(errorEl: HTMLElement): void {\n  errorEl.style.display = 'none';\n  errorEl.textContent = '';\n}\n\n/**\n * Update password strength indicator\n */\nfunction updatePasswordStrength(password: string, elementId = 'password-strength'): void {\n  const strengthEl = document.getElementById(elementId);\n  if (!strengthEl) return;\n\n  const strength = calculatePasswordStrength(password);\n  \n  strengthEl.className = `password-strength strength-${strength.level}`;\n  strengthEl.innerHTML = `\n    <div class=\"strength-bar\">\n      <div class=\"strength-fill\" style=\"width: ${strength.score}%\"></div>\n    </div>\n    <span class=\"strength-label\">${strength.label}</span>\n  `;\n}\n\n/**\n * Calculate password strength\n */\nfunction calculatePasswordStrength(password: string): { level: string; score: number; label: string } {\n  let score = 0;\n\n  if (password.length >= 12) score += 25;\n  if (password.length >= 16) score += 15;\n  if (/[a-z]/.test(password)) score += 15;\n  if (/[A-Z]/.test(password)) score += 15;\n  if (/[0-9]/.test(password)) score += 15;\n  if (/[^a-zA-Z0-9]/.test(password)) score += 15;\n\n  if (score < 30) return { level: 'weak', score, label: 'Weak' };\n  if (score < 60) return { level: 'fair', score, label: 'Fair' };\n  if (score < 80) return { level: 'good', score, label: 'Good' };\n  return { level: 'strong', score: Math.min(score, 100), label: 'Strong' };\n}\n\n/**\n * Close auth modal\n */\nexport function closeAuthModal(): void {\n  closeModal(MODAL_ID);\n}\n\nexport default showAuthModal;\n","/**\n * Contact Modal Component - SOTA Design\n * Create and edit contacts with tabs for Info, Projects, Relations, Activity\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal, confirm } from '../Modal';\nimport { Contact } from '../../stores/data';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'contact-modal';\n\n// Types\ninterface RoleTemplate {\n  id: string;\n  name: string;\n  display_name: string;\n  description?: string;\n  prompt_template?: string;\n  is_active: boolean;\n}\n\ninterface ContactRelation {\n  id: string;\n  from_contact_id: string;\n  to_contact_id: string;\n  relationship_type: string;\n  to_contact?: {\n    id: string;\n    name: string;\n    role?: string;\n    organization?: string;\n    avatar_url?: string;\n  };\n}\n\ninterface ContactActivity {\n  id: string;\n  activity_type: string;\n  description: string;\n  occurred_at: string;\n  source_type?: string;\n}\n\ninterface ContactProject {\n  id: string;\n  name: string;\n  role?: string;\n  is_primary?: boolean;\n}\n\nexport interface ContactModalProps {\n  mode: 'create' | 'edit' | 'view';\n  contact?: Contact;\n  onSave?: (contact: Contact) => void;\n  onDelete?: (contactId: string) => void;\n}\n\n// State\nlet currentContact: Contact | null = null;\nlet contactProjects: ContactProject[] = [];\nlet contactRelations: ContactRelation[] = [];\nlet contactActivity: ContactActivity[] = [];\nlet allProjects: { id: string; name: string }[] = [];\nlet roleTemplates: RoleTemplate[] = [];\n\n/**\n * Show contact modal\n */\nexport function showContactModal(props: ContactModalProps): void {\n  const { mode, contact } = props;\n  currentContact = contact || null;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createModalContent(mode, contact);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: '',\n    content,\n    size: 'lg',\n  });\n\n  // Remove default modal styling for custom design\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\n  if (modalContent) {\n    modalContent.style.cssText = 'background: transparent; box-shadow: none; padding: 0; max-width: 900px;';\n  }\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\n  if (modalHeader) {\n    modalHeader.style.display = 'none';\n  }\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Load data for edit mode\n  if (mode === 'edit' && contact?.id) {\n    loadContactData(content, contact.id);\n  } else {\n    loadRoleTemplates(content);\n    loadAllProjects(content);\n    loadTimezones(content);\n  }\n\n  // Bind events\n  bindEvents(content, props);\n}\n\n/**\n * Create modal content\n */\nfunction createModalContent(mode: 'create' | 'edit' | 'view', contact?: Contact): HTMLElement {\n  const container = createElement('div', { className: 'contact-modal-sota' });\n  const isEdit = mode === 'edit';\n  const initials = contact ? getInitials(contact.name) : '?';\n  const hasPhoto = !!(contact?.photoUrl || contact?.avatarUrl);\n  const photoUrl = contact?.photoUrl || contact?.avatarUrl;\n\n  container.innerHTML = `\n    <style>\n      .contact-modal-sota {\n        background: var(--bg-primary);\n        border-radius: 20px;\n        overflow: hidden;\n        box-shadow: 0 25px 60px rgba(0,0,0,0.3);\n      }\n\n      /* Header */\n      .contact-modal-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 50%, #9f1239 100%);\n        padding: 32px 32px 24px;\n        position: relative;\n      }\n\n      .contact-modal-close {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        transition: all 0.2s;\n      }\n\n      .contact-modal-close:hover {\n        background: rgba(255,255,255,0.3);\n        transform: scale(1.1);\n      }\n\n      .contact-modal-close svg {\n        width: 20px;\n        height: 20px;\n      }\n\n      .contact-header-content {\n        display: flex;\n        align-items: center;\n        gap: 20px;\n      }\n\n      .contact-avatar-large {\n        width: 90px;\n        height: 90px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 32px;\n        font-weight: 700;\n        color: white;\n        border: 4px solid rgba(255,255,255,0.3);\n        overflow: hidden;\n        cursor: pointer;\n        transition: all 0.2s;\n        position: relative;\n      }\n\n      .contact-avatar-large:hover {\n        border-color: rgba(255,255,255,0.5);\n      }\n\n      .contact-avatar-large img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .contact-avatar-large .avatar-upload-hint {\n        position: absolute;\n        inset: 0;\n        background: rgba(0,0,0,0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        opacity: 0;\n        transition: opacity 0.2s;\n      }\n\n      .contact-avatar-large:hover .avatar-upload-hint {\n        opacity: 1;\n      }\n\n      .contact-avatar-large .avatar-upload-hint svg {\n        width: 28px;\n        height: 28px;\n        color: white;\n      }\n\n      .contact-header-info {\n        flex: 1;\n        color: white;\n      }\n\n      .contact-header-info h2 {\n        margin: 0 0 4px 0;\n        font-size: 26px;\n        font-weight: 700;\n      }\n\n      .contact-header-info p {\n        margin: 0;\n        font-size: 15px;\n        opacity: 0.85;\n      }\n\n      .contact-header-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .header-action-btn {\n        padding: 10px 16px;\n        border-radius: 10px;\n        background: rgba(255,255,255,0.15);\n        border: 1px solid rgba(255,255,255,0.2);\n        color: white;\n        font-size: 13px;\n        font-weight: 600;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        transition: all 0.2s;\n      }\n\n      .header-action-btn:hover {\n        background: rgba(255,255,255,0.25);\n      }\n\n      .header-action-btn svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* Tabs */\n      .contact-tabs {\n        display: flex;\n        border-bottom: 1px solid var(--border-color);\n        padding: 0 32px;\n        background: var(--bg-secondary);\n      }\n\n      .contact-tab-btn {\n        padding: 14px 20px;\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        background: none;\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        position: relative;\n        transition: color 0.2s;\n      }\n\n      .contact-tab-btn:hover {\n        color: var(--text-primary);\n      }\n\n      .contact-tab-btn.active {\n        color: #e11d48;\n      }\n\n      .contact-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: -1px;\n        left: 0;\n        right: 0;\n        height: 3px;\n        background: linear-gradient(90deg, #e11d48, #f59e0b);\n        border-radius: 3px 3px 0 0;\n      }\n\n      .contact-tab-btn svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      .contact-tab-btn .tab-count {\n        background: rgba(225,29,72,0.1);\n        color: #e11d48;\n        padding: 2px 8px;\n        border-radius: 10px;\n        font-size: 11px;\n      }\n\n      /* Tab Content */\n      .contact-tab-content {\n        padding: 28px 32px;\n        min-height: 400px;\n        max-height: 500px;\n        overflow-y: auto;\n      }\n\n      .contact-section {\n        display: none;\n      }\n\n      .contact-section.active {\n        display: block;\n      }\n\n      /* Form Styles */\n      .form-grid {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 20px;\n      }\n\n      .form-grid.full {\n        grid-template-columns: 1fr;\n      }\n\n      .form-field {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n      }\n\n      .form-field.full-width {\n        grid-column: 1 / -1;\n      }\n\n      .form-field label {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n\n      .form-field label svg {\n        width: 14px;\n        height: 14px;\n        color: #e11d48;\n      }\n\n      .form-field input,\n      .form-field textarea,\n      .form-field select {\n        padding: 12px 14px;\n        border: 1px solid var(--border-color);\n        border-radius: 10px;\n        font-size: 14px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        transition: all 0.2s;\n      }\n\n      .form-field input:focus,\n      .form-field textarea:focus,\n      .form-field select:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\n      }\n\n      .form-field textarea {\n        resize: vertical;\n        min-height: 100px;\n      }\n\n      .form-hint {\n        font-size: 12px;\n        color: var(--text-tertiary);\n      }\n\n      /* Projects Section */\n      .projects-list {\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n      }\n\n      .project-item {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 14px;\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        border-radius: 10px;\n        transition: all 0.2s;\n      }\n\n      .project-item:hover {\n        border-color: rgba(225,29,72,0.3);\n      }\n\n      .project-checkbox {\n        width: 20px;\n        height: 20px;\n        accent-color: #e11d48;\n      }\n\n      .project-item label {\n        flex: 1;\n        font-size: 14px;\n        color: var(--text-primary);\n        cursor: pointer;\n      }\n\n      .project-item .primary-badge {\n        padding: 3px 8px;\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        color: white;\n        border-radius: 4px;\n        font-size: 10px;\n        font-weight: 600;\n      }\n\n      /* Relations Section */\n      .relations-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .relation-card {\n        display: flex;\n        align-items: center;\n        gap: 14px;\n        padding: 14px;\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        transition: all 0.2s;\n      }\n\n      .relation-card:hover {\n        border-color: rgba(225,29,72,0.3);\n        transform: translateX(4px);\n      }\n\n      .relation-avatar {\n        width: 44px;\n        height: 44px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #6366f1, #4f46e5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 16px;\n        font-weight: 600;\n        color: white;\n        overflow: hidden;\n      }\n\n      .relation-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .relation-info {\n        flex: 1;\n      }\n\n      .relation-info h4 {\n        margin: 0 0 2px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n\n      .relation-info p {\n        margin: 0;\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n\n      .relation-type {\n        padding: 4px 10px;\n        background: rgba(99,102,241,0.1);\n        color: #6366f1;\n        border-radius: 6px;\n        font-size: 12px;\n        font-weight: 600;\n      }\n\n      .add-relation-btn {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 8px;\n        padding: 14px;\n        background: var(--bg-secondary);\n        border: 2px dashed var(--border-color);\n        border-radius: 12px;\n        color: var(--text-secondary);\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n\n      .add-relation-btn:hover {\n        border-color: #e11d48;\n        color: #e11d48;\n      }\n\n      .add-relation-btn svg {\n        width: 18px;\n        height: 18px;\n      }\n\n      /* Activity Section */\n      .activity-timeline {\n        position: relative;\n        padding-left: 28px;\n      }\n\n      .activity-timeline::before {\n        content: '';\n        position: absolute;\n        left: 8px;\n        top: 0;\n        bottom: 0;\n        width: 2px;\n        background: var(--border-color);\n      }\n\n      .activity-item {\n        position: relative;\n        padding-bottom: 20px;\n      }\n\n      .activity-item::before {\n        content: '';\n        position: absolute;\n        left: -24px;\n        top: 4px;\n        width: 12px;\n        height: 12px;\n        border-radius: 50%;\n        background: #e11d48;\n        border: 2px solid var(--bg-primary);\n      }\n\n      .activity-item.email::before { background: #3b82f6; }\n      .activity-item.meeting::before { background: #10b981; }\n      .activity-item.note::before { background: #f59e0b; }\n\n      .activity-time {\n        font-size: 11px;\n        color: var(--text-tertiary);\n        margin-bottom: 4px;\n      }\n\n      .activity-content {\n        font-size: 14px;\n        color: var(--text-primary);\n        line-height: 1.5;\n      }\n\n      .activity-empty {\n        text-align: center;\n        padding: 40px;\n        color: var(--text-secondary);\n      }\n\n      .activity-empty svg {\n        width: 48px;\n        height: 48px;\n        opacity: 0.4;\n        margin-bottom: 12px;\n      }\n\n      /* Footer */\n      .contact-modal-footer {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 20px 32px;\n        border-top: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n\n      .footer-left {\n        display: flex;\n        gap: 10px;\n      }\n\n      .footer-right {\n        display: flex;\n        gap: 10px;\n      }\n\n      .btn-sota {\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 12px 20px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n      }\n\n      .btn-sota.primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\n      }\n\n      .btn-sota.primary:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 6px 16px rgba(225,29,72,0.4);\n      }\n\n      .btn-sota.secondary {\n        background: var(--bg-primary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n\n      .btn-sota.secondary:hover {\n        background: var(--bg-tertiary);\n        border-color: #e11d48;\n      }\n\n      .btn-sota.danger {\n        background: transparent;\n        color: #dc2626;\n        border: 1px solid #dc2626;\n      }\n\n      .btn-sota.danger:hover {\n        background: #dc2626;\n        color: white;\n      }\n\n      .btn-sota svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      .btn-sota:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n      }\n\n      /* Loading */\n      .loading-spinner {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 40px;\n        color: var(--text-secondary);\n      }\n\n      .loading-spinner::after {\n        content: '';\n        width: 24px;\n        height: 24px;\n        border: 3px solid var(--border-color);\n        border-top-color: #e11d48;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n        margin-left: 12px;\n      }\n\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n    </style>\n\n    <!-- Header -->\n    <div class=\"contact-modal-header\">\n      <button class=\"contact-modal-close\" id=\"close-contact-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n\n      <div class=\"contact-header-content\">\n        <div class=\"contact-avatar-large\" id=\"contact-avatar-upload\">\n          ${hasPhoto \n            ? `<img src=\"${photoUrl}\" alt=\"\">`\n            : `<span>${initials}</span>`\n          }\n          <div class=\"avatar-upload-hint\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n            </svg>\n          </div>\n        </div>\n\n        <div class=\"contact-header-info\">\n          <h2 id=\"header-contact-name\">${isEdit ? escapeHtml(contact?.name || '') : 'New Contact'}</h2>\n          <p id=\"header-contact-org\">${isEdit && contact?.organization ? escapeHtml(contact.organization) : 'Add organization'}</p>\n        </div>\n\n        ${isEdit ? `\n          <div class=\"contact-header-actions\">\n            <button class=\"header-action-btn\" id=\"enrich-ai-btn\" title=\"Enrich with AI\">\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n              </svg>\n              Enrich with AI\n            </button>\n          </div>\n        ` : ''}\n      </div>\n    </div>\n\n    <!-- Tabs -->\n    <div class=\"contact-tabs\">\n      <button class=\"contact-tab-btn active\" data-tab=\"info\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n        </svg>\n        Info\n      </button>\n      <button class=\"contact-tab-btn\" data-tab=\"projects\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n        </svg>\n        Projects\n        <span class=\"tab-count\" id=\"projects-count\">0</span>\n      </button>\n      <button class=\"contact-tab-btn\" data-tab=\"relations\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n        </svg>\n        Relations\n        <span class=\"tab-count\" id=\"relations-count\">0</span>\n      </button>\n      <button class=\"contact-tab-btn\" data-tab=\"activity\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n        </svg>\n        Activity\n      </button>\n    </div>\n\n    <!-- Tab Content -->\n    <div class=\"contact-tab-content\">\n      <!-- Info Section -->\n      <div class=\"contact-section active\" id=\"section-info\">\n        <form id=\"contact-form\">\n          <div class=\"form-grid\">\n            <div class=\"form-field\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                </svg>\n                Name *\n              </label>\n              <input type=\"text\" id=\"contact-name\" required value=\"${escapeHtml(contact?.name || '')}\" placeholder=\"Full name\">\n            </div>\n\n            <div class=\"form-field\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n                </svg>\n                Role\n              </label>\n              <select id=\"contact-role\">\n                <option value=\"\">-- Select role --</option>\n                <option value=\"__custom__\">Custom role...</option>\n              </select>\n              <input type=\"text\" id=\"contact-role-custom\" placeholder=\"Enter custom role\" style=\"display: none; margin-top: 8px;\" value=\"${contact?.role && !roleTemplates.some(r => r.display_name === contact.role) ? escapeHtml(contact.role) : ''}\">\n            </div>\n\n            <div class=\"form-field\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n                </svg>\n                Email\n              </label>\n              <input type=\"email\" id=\"contact-email\" value=\"${escapeHtml(contact?.email || '')}\" placeholder=\"email@example.com\">\n            </div>\n\n            <div class=\"form-field\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"/>\n                </svg>\n                Phone\n              </label>\n              <input type=\"tel\" id=\"contact-phone\" value=\"${escapeHtml(contact?.phone || '')}\" placeholder=\"+1 234 567 890\">\n            </div>\n\n            <div class=\"form-field\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\n                </svg>\n                Organization\n              </label>\n              <input type=\"text\" id=\"contact-organization\" value=\"${escapeHtml(contact?.organization || contact?.company || '')}\" placeholder=\"Company name\">\n            </div>\n\n            <div class=\"form-field\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9\"/>\n                </svg>\n                LinkedIn\n              </label>\n              <input type=\"url\" id=\"contact-linkedin\" value=\"${escapeHtml(contact?.linkedin || '')}\" placeholder=\"https://linkedin.com/in/...\">\n            </div>\n\n            <div class=\"form-field full-width\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                </svg>\n                Avatar URL\n              </label>\n              <input type=\"url\" id=\"contact-avatar-url\" value=\"${escapeHtml(contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url || '')}\" placeholder=\"https://example.com/photo.jpg\">\n              <div class=\"form-hint\">Enter a URL to set the contact's profile picture</div>\n            </div>\n\n            <div class=\"form-field\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\n                </svg>\n                Department\n              </label>\n              <input type=\"text\" id=\"contact-department\" value=\"${escapeHtml(contact?.department || '')}\" placeholder=\"Engineering, Sales, etc.\">\n            </div>\n\n            <div class=\"form-field\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"/>\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                </svg>\n                Location\n              </label>\n              <input type=\"text\" id=\"contact-location\" value=\"${escapeHtml(contact?.location || '')}\" placeholder=\"City, Country\">\n            </div>\n\n            <div class=\"form-field\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                </svg>\n                Timezone\n              </label>\n              <select id=\"contact-timezone\" data-current=\"${escapeHtml(contact?.timezone || '')}\">\n                <option value=\"\">Select timezone...</option>\n              </select>\n            </div>\n\n            <div class=\"form-field full-width\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                </svg>\n                Aliases\n              </label>\n              <input type=\"text\" id=\"contact-aliases\" value=\"${contact?.aliases?.join(', ') || ''}\" placeholder=\"Alternative names (comma separated)\">\n              <div class=\"form-hint\">Names used to identify this person in documents (e.g., \"Luuc\" for \"Luuk\")</div>\n            </div>\n\n            <div class=\"form-field full-width\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\n                </svg>\n                Notes\n              </label>\n              <textarea id=\"contact-notes\" placeholder=\"Additional notes about this contact...\">${escapeHtml(contact?.notes || '')}</textarea>\n            </div>\n\n            <div class=\"form-field full-width\">\n              <label>\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\"/>\n                </svg>\n                Tags\n              </label>\n              <input type=\"text\" id=\"contact-tags\" value=\"${contact?.tags?.join(', ') || ''}\" placeholder=\"client, vip, technical (comma separated)\">\n              <div class=\"form-hint\">Separate tags with commas</div>\n            </div>\n          </div>\n        </form>\n      </div>\n\n      <!-- Projects Section -->\n      <div class=\"contact-section\" id=\"section-projects\">\n        <div class=\"projects-list\" id=\"projects-list\">\n          <div class=\"loading-spinner\">Loading projects</div>\n        </div>\n      </div>\n\n      <!-- Relations Section -->\n      <div class=\"contact-section\" id=\"section-relations\">\n        <div class=\"relations-list\" id=\"relations-list\">\n          <div class=\"loading-spinner\">Loading relations</div>\n        </div>\n        <button class=\"add-relation-btn\" id=\"add-relation-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Add Relationship\n        </button>\n      </div>\n\n      <!-- Activity Section -->\n      <div class=\"contact-section\" id=\"section-activity\">\n        <div class=\"activity-timeline\" id=\"activity-timeline\">\n          <div class=\"loading-spinner\">Loading activity</div>\n        </div>\n      </div>\n    </div>\n\n    <!-- Footer -->\n    <div class=\"contact-modal-footer\">\n      <div class=\"footer-left\">\n        ${isEdit ? `\n          <button class=\"btn-sota danger\" id=\"delete-contact-btn\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\n            </svg>\n            Delete\n          </button>\n        ` : ''}\n      </div>\n      <div class=\"footer-right\">\n        <button class=\"btn-sota secondary\" id=\"cancel-contact-btn\">Cancel</button>\n        <button class=\"btn-sota primary\" id=\"save-contact-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n          </svg>\n          ${isEdit ? 'Save Changes' : 'Create Contact'}\n        </button>\n      </div>\n    </div>\n  `;\n\n  return container;\n}\n\n/**\n * Load contact data for edit mode\n */\nasync function loadContactData(container: HTMLElement, contactId: string): Promise<void> {\n  try {\n    const [projectsRes, relationsRes, activityRes, rolesRes, allProjectsRes, timezonesRes] = await Promise.all([\n      http.get<{ projects: ContactProject[] }>(`/api/contacts/${contactId}/projects`).catch(() => ({ data: { projects: [] } })),\n      http.get<{ relationships: ContactRelation[] }>(`/api/contacts/${contactId}/relationships`).catch(() => ({ data: { relationships: [] } })),\n      http.get<{ activities: ContactActivity[] }>(`/api/contacts/${contactId}/activity`).catch(() => ({ data: { activities: [] } })),\n      http.get<{ roles: RoleTemplate[] }>('/api/role-templates').catch(() => ({ data: { roles: [] } })),\n      http.get<{ projects: { id: string; name: string }[] }>('/api/projects').catch(() => ({ data: { projects: [] } })),\n      http.get<{ timezones: { code: string; name: string; utc_offset: string }[] }>('/api/timezones').catch(() => ({ data: { timezones: [] } })),\n    ]);\n\n    contactProjects = projectsRes.data?.projects || [];\n    contactRelations = relationsRes.data?.relationships || [];\n    contactActivity = activityRes.data?.activities || [];\n    roleTemplates = rolesRes.data?.roles || [];\n    allProjects = allProjectsRes.data?.projects || [];\n    const timezones = timezonesRes.data?.timezones || [];\n\n    // Render timezone dropdown\n    renderTimezoneDropdown(container, timezones);\n\n    // Render sections\n    renderRoleDropdown(container);\n    renderProjectsList(container);\n    renderRelationsList(container);\n    renderActivityTimeline(container);\n    \n    // Update counts\n    updateTabCounts(container);\n  } catch (error) {\n    console.error('Failed to load contact data:', error);\n  }\n}\n\n/**\n * Load role templates\n */\nasync function loadRoleTemplates(container: HTMLElement): Promise<void> {\n  try {\n    const response = await http.get<{ roles: RoleTemplate[] }>('/api/role-templates');\n    roleTemplates = response.data?.roles || [];\n    renderRoleDropdown(container);\n  } catch {\n    roleTemplates = [];\n  }\n}\n\n/**\n * Load timezones for new contact\n */\nasync function loadTimezones(container: HTMLElement): Promise<void> {\n  try {\n    const response = await http.get<{ timezones: { code: string; name: string; utc_offset: string }[] }>('/api/timezones');\n    const timezones = response.data?.timezones || [];\n    renderTimezoneDropdown(container, timezones);\n  } catch {\n    // Leave empty\n  }\n}\n\n/**\n * Load all projects\n */\nasync function loadAllProjects(container: HTMLElement): Promise<void> {\n  try {\n    const response = await http.get<{ projects: { id: string; name: string }[] }>('/api/projects');\n    allProjects = response.data?.projects || [];\n    renderProjectsList(container);\n  } catch {\n    allProjects = [];\n  }\n}\n\n/**\n * Render timezone dropdown\n */\nfunction renderTimezoneDropdown(container: HTMLElement, timezones: { code: string; name: string; utc_offset: string }[]): void {\n  const tzSelect = container.querySelector('#contact-timezone') as HTMLSelectElement;\n  if (!tzSelect) return;\n\n  const currentTz = tzSelect.dataset.current || '';\n  \n  // Group timezones by region\n  const grouped: Record<string, typeof timezones> = {};\n  for (const tz of timezones) {\n    const region = tz.code.includes('/') ? tz.code.split('/')[0] : 'Other';\n    if (!grouped[region]) grouped[region] = [];\n    grouped[region].push(tz);\n  }\n\n  // Sort regions\n  const sortedRegions = Object.keys(grouped).sort();\n\n  tzSelect.innerHTML = `\n    <option value=\"\">Select timezone...</option>\n    ${sortedRegions.map(region => `\n      <optgroup label=\"${region}\">\n        ${grouped[region].map(tz => `\n          <option value=\"${escapeHtml(tz.code)}\" ${currentTz === tz.code ? 'selected' : ''}>\n            ${escapeHtml(tz.name || tz.code)} (${tz.utc_offset})\n          </option>\n        `).join('')}\n      </optgroup>\n    `).join('')}\n  `;\n}\n\n/**\n * Render role dropdown\n */\nfunction renderRoleDropdown(container: HTMLElement): void {\n  const roleSelect = container.querySelector('#contact-role') as HTMLSelectElement;\n  const customInput = container.querySelector('#contact-role-custom') as HTMLInputElement;\n  if (!roleSelect) return;\n\n  const currentRole = currentContact?.role;\n  const isCustomRole = currentRole && !roleTemplates.some(r => r.display_name === currentRole || r.name === currentRole);\n\n  roleSelect.innerHTML = `\n    <option value=\"\">-- Select role --</option>\n    ${roleTemplates.filter(r => r.is_active).map(r => `\n      <option value=\"${escapeHtml(r.display_name || r.name)}\" ${currentRole === r.display_name || currentRole === r.name ? 'selected' : ''}>\n        ${escapeHtml(r.display_name || r.name)}\n      </option>\n    `).join('')}\n    <option value=\"__custom__\" ${isCustomRole ? 'selected' : ''}>Custom role...</option>\n  `;\n\n  // Show custom input if custom is selected\n  if (isCustomRole && customInput) {\n    customInput.style.display = 'block';\n    customInput.value = currentRole;\n  }\n\n  // Handle role change\n  on(roleSelect, 'change', () => {\n    const isCustom = roleSelect.value === '__custom__';\n    customInput.style.display = isCustom ? 'block' : 'none';\n    if (isCustom) {\n      customInput.focus();\n    }\n  });\n}\n\n/**\n * Render projects list\n */\nfunction renderProjectsList(container: HTMLElement): void {\n  const listContainer = container.querySelector('#projects-list') as HTMLElement;\n  if (!listContainer) return;\n\n  if (allProjects.length === 0) {\n    listContainer.innerHTML = '<p style=\"color: var(--text-secondary); text-align: center; padding: 20px;\">No projects available</p>';\n    return;\n  }\n\n  const associatedIds = new Set(contactProjects.map(p => p.id));\n\n  listContainer.innerHTML = allProjects.map(project => `\n    <div class=\"project-item\">\n      <input type=\"checkbox\" class=\"project-checkbox\" name=\"contact-project\" value=\"${project.id}\" \n             ${associatedIds.has(project.id) ? 'checked' : ''}>\n      <label>${escapeHtml(project.name)}</label>\n      ${contactProjects.find(p => p.id === project.id)?.is_primary ? '<span class=\"primary-badge\">Primary</span>' : ''}\n    </div>\n  `).join('');\n\n  container.querySelector('#projects-count')!.textContent = String(associatedIds.size);\n}\n\n/**\n * Render relations list\n */\nfunction renderRelationsList(container: HTMLElement): void {\n  const listContainer = container.querySelector('#relations-list') as HTMLElement;\n  if (!listContainer) return;\n\n  if (contactRelations.length === 0) {\n    listContainer.innerHTML = `\n      <div class=\"activity-empty\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\n        </svg>\n        <p>No relationships yet</p>\n      </div>\n    `;\n    return;\n  }\n\n  listContainer.innerHTML = contactRelations.map(relation => {\n    const contact = relation.to_contact;\n    const initials = contact ? getInitials(contact.name) : '?';\n\n    return `\n      <div class=\"relation-card\" data-id=\"${relation.id}\">\n        <div class=\"relation-avatar\">\n          ${contact?.avatar_url \n            ? `<img src=\"${contact.avatar_url}\" alt=\"\">`\n            : initials\n          }\n        </div>\n        <div class=\"relation-info\">\n          <h4>${escapeHtml(contact?.name || 'Unknown')}</h4>\n          <p>${escapeHtml(contact?.organization || contact?.role || '')}</p>\n        </div>\n        <span class=\"relation-type\">${formatRelationType(relation.relationship_type)}</span>\n      </div>\n    `;\n  }).join('');\n\n  container.querySelector('#relations-count')!.textContent = String(contactRelations.length);\n}\n\n/**\n * Render activity timeline\n */\nfunction renderActivityTimeline(container: HTMLElement): void {\n  const timeline = container.querySelector('#activity-timeline') as HTMLElement;\n  if (!timeline) return;\n\n  if (contactActivity.length === 0) {\n    timeline.innerHTML = `\n      <div class=\"activity-empty\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n        </svg>\n        <p>No activity recorded yet</p>\n      </div>\n    `;\n    return;\n  }\n\n  timeline.innerHTML = contactActivity.map(activity => `\n    <div class=\"activity-item ${activity.activity_type}\">\n      <div class=\"activity-time\">${formatDate(activity.occurred_at)}</div>\n      <div class=\"activity-content\">${escapeHtml(activity.description)}</div>\n    </div>\n  `).join('');\n}\n\n/**\n * Update tab counts\n */\nfunction updateTabCounts(container: HTMLElement): void {\n  const projectsCount = container.querySelector('#projects-count');\n  const relationsCount = container.querySelector('#relations-count');\n\n  if (projectsCount) projectsCount.textContent = String(contactProjects.length);\n  if (relationsCount) relationsCount.textContent = String(contactRelations.length);\n}\n\n/**\n * Bind events\n */\nfunction bindEvents(container: HTMLElement, props: ContactModalProps): void {\n  const { mode, contact, onSave, onDelete } = props;\n  const isEdit = mode === 'edit';\n\n  // Close button\n  const closeBtn = container.querySelector('#close-contact-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\n  }\n\n  // Cancel button\n  const cancelBtn = container.querySelector('#cancel-contact-btn');\n  if (cancelBtn) {\n    on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\n  }\n\n  // Tab switching\n  const tabs = container.querySelectorAll('.contact-tab-btn');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n\n      const tabId = tab.getAttribute('data-tab');\n      container.querySelectorAll('.contact-section').forEach(section => {\n        section.classList.toggle('active', section.id === `section-${tabId}`);\n      });\n    });\n  });\n\n  // Save button\n  const saveBtn = container.querySelector('#save-contact-btn') as HTMLButtonElement;\n  if (saveBtn) {\n    on(saveBtn, 'click', async () => {\n      const form = container.querySelector('#contact-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const getValue = (id: string) => (container.querySelector(`#${id}`) as HTMLInputElement)?.value.trim() || '';\n      \n      // Get role value\n      const roleSelect = container.querySelector('#contact-role') as HTMLSelectElement;\n      const customRoleInput = container.querySelector('#contact-role-custom') as HTMLInputElement;\n      const role = roleSelect.value === '__custom__' ? customRoleInput.value.trim() : roleSelect.value;\n\n      const tagsInput = getValue('contact-tags');\n      const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(Boolean) : [];\n\n      // Get aliases\n      const aliasesInput = getValue('contact-aliases');\n      const aliases = aliasesInput ? aliasesInput.split(',').map(a => a.trim()).filter(Boolean) : [];\n\n      const contactData: Contact = {\n        id: contact?.id || `contact-${Date.now()}`,\n        name: getValue('contact-name'),\n        email: getValue('contact-email') || undefined,\n        phone: getValue('contact-phone') || undefined,\n        organization: getValue('contact-organization') || undefined,\n        company: getValue('contact-organization') || undefined,\n        role: role || undefined,\n        department: getValue('contact-department') || undefined,\n        linkedin: getValue('contact-linkedin') || undefined,\n        location: getValue('contact-location') || undefined,\n        timezone: getValue('contact-timezone') || undefined,\n        photoUrl: getValue('contact-avatar-url') || undefined,\n        avatarUrl: getValue('contact-avatar-url') || undefined,\n        aliases: aliases.length > 0 ? aliases : undefined,\n        notes: getValue('contact-notes') || undefined,\n        tags: tags.length > 0 ? tags : undefined,\n      };\n\n      // Get selected projects\n      const selectedProjects: string[] = [];\n      container.querySelectorAll('input[name=\"contact-project\"]:checked').forEach(input => {\n        selectedProjects.push((input as HTMLInputElement).value);\n      });\n\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Saving...';\n\n      try {\n        let savedContactId = contact?.id;\n        \n        if (isEdit) {\n          await http.put(`/api/contacts/${contact!.id}`, contactData);\n          toast.success('Contact updated');\n        } else {\n          const response = await http.post<{ id: string }>('/api/contacts', contactData);\n          contactData.id = response.data.id;\n          savedContactId = response.data.id;\n          toast.success('Contact created');\n        }\n\n        // Save project associations\n        if (savedContactId && selectedProjects.length >= 0) {\n          try {\n            await http.post(`/api/contacts/${savedContactId}/projects/sync`, {\n              projectIds: selectedProjects\n            });\n          } catch (err) {\n            console.warn('Failed to sync project associations:', err);\n          }\n        }\n\n        onSave?.(contactData);\n        closeModal(MODAL_ID);\n      } catch {\n        toast.error('Failed to save contact');\n      } finally {\n        saveBtn.disabled = false;\n        saveBtn.innerHTML = `\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n          </svg>\n          ${isEdit ? 'Save Changes' : 'Create Contact'}\n        `;\n      }\n    });\n  }\n\n  // Delete button\n  const deleteBtn = container.querySelector('#delete-contact-btn');\n  if (deleteBtn && isEdit) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      const confirmed = await confirm(\n        `Are you sure you want to delete \"${contact!.name}\"?`,\n        {\n          title: 'Delete Contact',\n          confirmText: 'Delete',\n          confirmClass: 'btn-danger',\n        }\n      );\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/contacts/${contact!.id}`);\n          toast.success('Contact deleted');\n          onDelete?.(contact!.id);\n          closeModal(MODAL_ID);\n        } catch {\n          toast.error('Failed to delete contact');\n        }\n      }\n    });\n  }\n\n  // AI Enrich button\n  const enrichBtn = container.querySelector('#enrich-ai-btn');\n  if (enrichBtn && isEdit) {\n    on(enrichBtn as HTMLElement, 'click', async () => {\n      toast.info('AI enrichment is processing...');\n      try {\n        await http.post(`/api/contacts/${contact!.id}/enrich`);\n        toast.success('Contact enriched! Refreshing...');\n        // Reload modal with updated data\n        closeModal(MODAL_ID);\n        const response = await http.get<{ contact: Contact }>(`/api/contacts/${contact!.id}`);\n        showContactModal({ ...props, contact: response.data.contact });\n      } catch {\n        toast.error('AI enrichment failed');\n      }\n    });\n  }\n\n  // Add relation button\n  const addRelationBtn = container.querySelector('#add-relation-btn');\n  if (addRelationBtn && contact?.id) {\n    on(addRelationBtn as HTMLElement, 'click', () => {\n      showAddRelationDialog(container, contact.id, props);\n    });\n  }\n\n  // Update header on name/org input change\n  const nameInput = container.querySelector('#contact-name') as HTMLInputElement;\n  const orgInput = container.querySelector('#contact-organization') as HTMLInputElement;\n  const headerName = container.querySelector('#header-contact-name');\n  const headerOrg = container.querySelector('#header-contact-org');\n\n  if (nameInput && headerName) {\n    on(nameInput, 'input', () => {\n      headerName.textContent = nameInput.value || 'New Contact';\n      // Update avatar initials\n      const avatar = container.querySelector('.contact-avatar-large');\n      if (avatar && !avatar.querySelector('img')) {\n        const span = avatar.querySelector('span');\n        if (span) span.textContent = getInitials(nameInput.value || '?');\n      }\n    });\n  }\n\n  if (orgInput && headerOrg) {\n    on(orgInput, 'input', () => {\n      headerOrg.textContent = orgInput.value || 'Add organization';\n    });\n  }\n\n  // Update avatar preview on URL input change\n  const avatarUrlInput = container.querySelector('#contact-avatar-url') as HTMLInputElement;\n  const avatarContainer = container.querySelector('.contact-avatar-large');\n  \n  if (avatarUrlInput && avatarContainer) {\n    on(avatarUrlInput, 'input', () => {\n      const url = avatarUrlInput.value.trim();\n      if (url) {\n        // Test if image loads\n        const img = new Image();\n        img.onload = () => {\n          avatarContainer.innerHTML = `\n            <img src=\"${url}\" alt=\"\">\n            <div class=\"avatar-upload-hint\">\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n              </svg>\n            </div>\n          `;\n        };\n        img.onerror = () => {\n          // Keep initials if image fails\n          const currentName = (container.querySelector('#contact-name') as HTMLInputElement)?.value || '?';\n          avatarContainer.innerHTML = `\n            <span>${getInitials(currentName)}</span>\n            <div class=\"avatar-upload-hint\">\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n              </svg>\n            </div>\n          `;\n        };\n        img.src = url;\n      } else {\n        // No URL - show initials\n        const currentName = (container.querySelector('#contact-name') as HTMLInputElement)?.value || '?';\n        avatarContainer.innerHTML = `\n          <span>${getInitials(currentName)}</span>\n          <div class=\"avatar-upload-hint\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n            </svg>\n          </div>\n        `;\n      }\n    });\n  }\n}\n\n/**\n * Show dialog to add a relationship to another contact\n */\nasync function showAddRelationDialog(parentContainer: HTMLElement, contactId: string, props: ContactModalProps): Promise<void> {\n  // Fetch all contacts for selection\n  let availableContacts: { id: string; name: string; organization?: string }[] = [];\n  try {\n    const response = await http.get<{ contacts: { id: string; name: string; organization?: string }[] }>('/api/contacts');\n    availableContacts = (response.data?.contacts || []).filter(c => c.id !== contactId);\n  } catch {\n    toast.error('Failed to load contacts');\n    return;\n  }\n\n  if (availableContacts.length === 0) {\n    toast.info('No other contacts available to create a relationship');\n    return;\n  }\n\n  // Create overlay dialog\n  const overlay = createElement('div', { className: 'relation-dialog-overlay' });\n  overlay.innerHTML = `\n    <style>\n      .relation-dialog-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        animation: fadeIn 0.2s ease;\n      }\n      \n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      \n      .relation-dialog {\n        background: var(--bg-primary);\n        border-radius: 16px;\n        padding: 24px;\n        width: 400px;\n        max-width: 90vw;\n        box-shadow: 0 25px 50px rgba(0,0,0,0.25);\n        animation: slideUp 0.2s ease;\n      }\n      \n      @keyframes slideUp {\n        from { transform: translateY(20px); opacity: 0; }\n        to { transform: translateY(0); opacity: 1; }\n      }\n      \n      .relation-dialog h3 {\n        margin: 0 0 20px 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text-primary);\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n      \n      .relation-dialog h3 svg {\n        width: 22px;\n        height: 22px;\n        color: #e11d48;\n      }\n      \n      .relation-dialog-field {\n        margin-bottom: 16px;\n      }\n      \n      .relation-dialog-field label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        margin-bottom: 6px;\n      }\n      \n      .relation-dialog-field select {\n        width: 100%;\n        padding: 12px;\n        border: 1px solid var(--border-color);\n        border-radius: 10px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-size: 14px;\n      }\n      \n      .relation-dialog-field select:focus {\n        outline: none;\n        border-color: #e11d48;\n      }\n      \n      .relation-dialog-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n        margin-top: 24px;\n      }\n      \n      .relation-dialog-actions button {\n        padding: 10px 20px;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      \n      .relation-dialog-actions .cancel-btn {\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        color: var(--text-primary);\n      }\n      \n      .relation-dialog-actions .cancel-btn:hover {\n        background: var(--bg-tertiary);\n      }\n      \n      .relation-dialog-actions .save-btn {\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        border: none;\n        color: white;\n      }\n      \n      .relation-dialog-actions .save-btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\n      }\n      \n      .relation-dialog-actions .save-btn:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n        transform: none;\n      }\n    </style>\n    \n    <div class=\"relation-dialog\">\n      <h3>\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\n        </svg>\n        Add Relationship\n      </h3>\n      \n      <div class=\"relation-dialog-field\">\n        <label>Related Contact</label>\n        <select id=\"rel-contact-select\">\n          <option value=\"\">-- Select contact --</option>\n          ${availableContacts.map(c => `\n            <option value=\"${c.id}\">${escapeHtml(c.name)}${c.organization ? ` (${escapeHtml(c.organization)})` : ''}</option>\n          `).join('')}\n        </select>\n      </div>\n      \n      <div class=\"relation-dialog-field\">\n        <label>Relationship Type</label>\n        <select id=\"rel-type-select\">\n          <option value=\"\">-- Select type --</option>\n          <option value=\"reports_to\">Reports to</option>\n          <option value=\"manages\">Manages</option>\n          <option value=\"works_with\">Works with</option>\n          <option value=\"knows\">Knows</option>\n          <option value=\"referred_by\">Referred by</option>\n        </select>\n      </div>\n      \n      <div class=\"relation-dialog-actions\">\n        <button class=\"cancel-btn\" id=\"rel-cancel-btn\">Cancel</button>\n        <button class=\"save-btn\" id=\"rel-save-btn\">Add Relationship</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  // Bind events\n  const cancelBtn = overlay.querySelector('#rel-cancel-btn');\n  const saveBtn = overlay.querySelector('#rel-save-btn') as HTMLButtonElement;\n  const contactSelect = overlay.querySelector('#rel-contact-select') as HTMLSelectElement;\n  const typeSelect = overlay.querySelector('#rel-type-select') as HTMLSelectElement;\n\n  // Close on cancel or overlay click\n  const closeDialog = () => overlay.remove();\n  \n  on(cancelBtn as HTMLElement, 'click', closeDialog);\n  on(overlay, 'click', (e: Event) => {\n    if (e.target === overlay) closeDialog();\n  });\n\n  // Save relationship\n  on(saveBtn, 'click', async () => {\n    const toContactId = contactSelect.value;\n    const relationType = typeSelect.value;\n\n    if (!toContactId || !relationType) {\n      toast.error('Please select both a contact and relationship type');\n      return;\n    }\n\n    saveBtn.disabled = true;\n    saveBtn.textContent = 'Saving...';\n\n    try {\n      await http.post(`/api/contacts/${contactId}/relationships`, {\n        toContactId,\n        type: relationType\n      });\n\n      toast.success('Relationship added');\n      closeDialog();\n\n      // Reload contact data to show new relationship\n      const relationsRes = await http.get<{ relationships: ContactRelation[] }>(`/api/contacts/${contactId}/relationships`);\n      contactRelations = relationsRes.data?.relationships || [];\n      renderRelationsList(parentContainer);\n      updateTabCounts(parentContainer);\n    } catch (error: unknown) {\n      const message = error instanceof Error ? error.message : 'Failed to add relationship';\n      toast.error(message);\n      saveBtn.disabled = false;\n      saveBtn.textContent = 'Add Relationship';\n    }\n  });\n}\n\n// Helpers\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2) || '?';\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nfunction formatRelationType(type: string): string {\n  const types: Record<string, string> = {\n    reports_to: 'Reports to',\n    manages: 'Manages',\n    works_with: 'Works with',\n    knows: 'Knows',\n    referred_by: 'Referred by',\n  };\n  return types[type] || type.replace(/_/g, ' ');\n}\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n  if (diffDays === 0) return 'Today';\n  if (diffDays === 1) return 'Yesterday';\n  if (diffDays < 7) return `${diffDays} days ago`;\n  \n  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\n}\n\nexport default showContactModal;\n","/**\n * Team Modal Component\n * Manage project team members\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'team-modal';\n\nexport interface TeamMember {\n  id: string;\n  name: string;\n  email: string;\n  role: 'superadmin' | 'admin' | 'member';\n  joinedAt: string;\n  avatarUrl?: string;\n}\n\nexport interface TeamModalProps {\n  projectId?: string;\n  mode?: 'view' | 'edit' | 'manage' | 'create';\n  team?: { id: string; name: string };\n  onInvite?: () => void;\n  onSave?: (team: { name: string; description?: string }) => void;\n  onRemove?: (memberId: string) => void;\n  onRoleChange?: (memberId: string, role: TeamMember['role']) => void;\n}\n\nlet currentMembers: TeamMember[] = [];\n\n/**\n * Show team modal\n */\nexport async function showTeamModal(props: TeamModalProps): Promise<void> {\n  const { projectId, onInvite, onRemove, onRoleChange } = props;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'team-modal-content' });\n  content.innerHTML = '<div class=\"loading\">Loading team members...</div>';\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const inviteBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Invite Member',\n  });\n\n  const closeBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Close',\n  });\n\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\n  on(inviteBtn, 'click', () => {\n    closeModal(MODAL_ID);\n    onInvite?.();\n  });\n\n  footer.appendChild(closeBtn);\n  footer.appendChild(inviteBtn);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Team Members',\n    content,\n    size: 'lg',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Load team members\n  try {\n    const response = await http.get<TeamMember[]>(`/api/projects/${projectId}/members`);\n    currentMembers = response.data;\n    renderMembers(content, props);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load team members</div>';\n  }\n}\n\n/**\n * Render team members list\n */\nfunction renderMembers(container: HTMLElement, props: TeamModalProps): void {\n  if (currentMembers.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No team members yet</p>\n        <p class=\"text-muted\">Invite members to collaborate on this project</p>\n      </div>\n    `;\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"team-list\">\n      ${currentMembers.map(member => renderMemberCard(member)).join('')}\n    </div>\n  `;\n\n  // Bind actions\n  container.querySelectorAll('.member-card').forEach(card => {\n    const memberId = card.getAttribute('data-member-id');\n    if (!memberId) return;\n\n    const member = currentMembers.find(m => m.id === memberId);\n    if (!member) return;\n\n    // Role change\n    const roleSelect = card.querySelector('.role-select') as HTMLSelectElement;\n    if (roleSelect) {\n      on(roleSelect, 'change', async () => {\n        const newRole = roleSelect.value as TeamMember['role'];\n        try {\n          await http.patch(`/api/projects/${props.projectId}/members/${memberId}`, { role: newRole });\n          member.role = newRole;\n          toast.success('Role updated');\n          props.onRoleChange?.(memberId, newRole);\n        } catch {\n          roleSelect.value = member.role;\n        }\n      });\n    }\n\n    // Remove member\n    const removeBtn = card.querySelector('.btn-remove');\n    if (removeBtn) {\n      on(removeBtn as HTMLElement, 'click', async () => {\n        const { confirm } = await import('../Modal');\n        const confirmed = await confirm(\n          `Remove ${member.name} from this project?`,\n          {\n            title: 'Remove Member',\n            confirmText: 'Remove',\n            confirmClass: 'btn-danger',\n          }\n        );\n\n        if (confirmed) {\n          try {\n            await http.delete(`/api/projects/${props.projectId}/members/${memberId}`);\n            currentMembers = currentMembers.filter(m => m.id !== memberId);\n            renderMembers(container, props);\n            toast.success('Member removed');\n            props.onRemove?.(memberId);\n          } catch {\n            // Error shown by API service\n          }\n        }\n      });\n    }\n  });\n}\n\n/**\n * Render individual member card\n */\nfunction renderMemberCard(member: TeamMember): string {\n  const initials = member.name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n\n  const isSuperadmin = member.role === 'superadmin';\n\n  return `\n    <div class=\"member-card\" data-member-id=\"${member.id}\">\n      <div class=\"member-avatar\">\n        ${member.avatarUrl \n          ? `<img src=\"${member.avatarUrl}\" alt=\"${escapeHtml(member.name)}\">`\n          : initials\n        }\n      </div>\n      <div class=\"member-info\">\n        <div class=\"member-name\">${escapeHtml(member.name)}</div>\n        <div class=\"member-email\">${escapeHtml(member.email)}</div>\n      </div>\n      <div class=\"member-role\">\n        ${isSuperadmin \n          ? `<span class=\"role-badge superadmin\">Owner</span>`\n          : `<select class=\"role-select form-control\">\n              <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\n              <option value=\"member\" ${member.role === 'member' ? 'selected' : ''}>Member</option>\n            </select>`\n        }\n      </div>\n      <div class=\"member-actions\">\n        ${!isSuperadmin \n          ? `<button class=\"btn btn-sm btn-danger btn-remove\" title=\"Remove member\"></button>`\n          : ''\n        }\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showTeamModal;\n","/**\n * Invite Modal Component\n * Invite new team members\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'invite-modal';\n\ninterface Contact {\n  id: string;\n  name: string;\n  email?: string;\n  avatar_url?: string;\n  photo_url?: string;\n  organization?: string;\n  role?: string;\n}\n\ninterface ProjectMember {\n  user_id: string;\n  linked_contact_id?: string;\n}\n\nexport interface InviteModalProps {\n  projectId: string;\n  onInvite?: () => void;\n  onInviteSent?: (email: string) => void;\n}\n\n// Cache for loaded data\nlet cachedMembers: ProjectMember[] = [];\n\n/**\n * Show invite modal\n */\nexport function showInviteModal(props: InviteModalProps): void {\n  const { projectId, onInviteSent } = props;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'invite-modal-content' });\n\n  content.innerHTML = `\n    <style>\n      .invite-tabs {\n        display: flex;\n        gap: 0;\n        margin-bottom: 20px;\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\n      }\n      \n      .invite-tab-btn {\n        flex: 1;\n        padding: 12px 16px;\n        background: transparent;\n        border: none;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-secondary, #64748b);\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n      }\n      \n      .invite-tab-btn:hover {\n        color: var(--text-primary, #1e293b);\n      }\n      \n      .invite-tab-btn.active {\n        color: #e11d48;\n      }\n      \n      .invite-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: -1px;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: #e11d48;\n      }\n      \n      .invite-tab-content {\n        display: none;\n      }\n      \n      .invite-tab-content.active {\n        display: block;\n      }\n      \n      .contacts-list {\n        max-height: 300px;\n        overflow-y: auto;\n        border: 1px solid var(--border-color, #e2e8f0);\n        border-radius: 8px;\n        margin-bottom: 16px;\n      }\n      \n      .contact-option {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 12px 16px;\n        cursor: pointer;\n        transition: background 0.2s;\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\n      }\n      \n      .contact-option:last-child {\n        border-bottom: none;\n      }\n      \n      .contact-option:hover {\n        background: var(--bg-secondary, #f8fafc);\n      }\n      \n      .contact-option.selected {\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.04) 100%);\n      }\n      \n      .contact-option input[type=\"radio\"] {\n        display: none;\n      }\n      \n      .contact-option .radio-circle {\n        width: 18px;\n        height: 18px;\n        border: 2px solid var(--border-color, #cbd5e1);\n        border-radius: 50%;\n        flex-shrink: 0;\n        position: relative;\n        transition: all 0.2s;\n      }\n      \n      .contact-option.selected .radio-circle {\n        border-color: #e11d48;\n      }\n      \n      .contact-option.selected .radio-circle::after {\n        content: '';\n        position: absolute;\n        top: 3px;\n        left: 3px;\n        width: 8px;\n        height: 8px;\n        background: #e11d48;\n        border-radius: 50%;\n      }\n      \n      .contact-avatar {\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #667eea, #764ba2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-size: 14px;\n        font-weight: 600;\n        flex-shrink: 0;\n        overflow: hidden;\n      }\n      \n      .contact-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .contact-info {\n        flex: 1;\n        min-width: 0;\n      }\n      \n      .contact-name {\n        font-weight: 500;\n        color: var(--text-primary, #1e293b);\n        margin-bottom: 2px;\n      }\n      \n      .contact-email {\n        font-size: 12px;\n        color: var(--text-secondary, #64748b);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      \n      .no-contacts-msg {\n        padding: 24px;\n        text-align: center;\n        color: var(--text-secondary, #64748b);\n      }\n      \n      .email-status {\n        margin-top: 8px;\n        padding: 8px 12px;\n        background: #f0fdf4;\n        border: 1px solid #bbf7d0;\n        border-radius: 8px;\n        font-size: 12px;\n        color: #166534;\n        display: none;\n      }\n      \n      .email-status.show {\n        display: block;\n      }\n      \n      .email-status.error {\n        background: #fef2f2;\n        border-color: #fecaca;\n        color: #991b1b;\n      }\n    </style>\n    \n    <!-- Tabs -->\n    <div class=\"invite-tabs\">\n      <button type=\"button\" class=\"invite-tab-btn active\" data-tab=\"new\">\n        New Email\n      </button>\n      <button type=\"button\" class=\"invite-tab-btn\" data-tab=\"contacts\">\n        Existing Contacts\n      </button>\n    </div>\n    \n    <!-- Tab: New Email -->\n    <div class=\"invite-tab-content active\" id=\"tab-new\">\n      <form id=\"invite-form\" class=\"invite-form\">\n        <div class=\"form-group\">\n          <label for=\"invite-email\">Email Address *</label>\n          <input type=\"email\" id=\"invite-email\" required \n                 placeholder=\"colleague@example.com\">\n          <div class=\"form-hint\">They will receive an email invitation to join this project</div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"invite-role\">Access Level</label>\n          <select id=\"invite-role\">\n            <option value=\"read\">Viewer - Can view data only</option>\n            <option value=\"write\" selected>Member - Can view and edit data</option>\n            <option value=\"admin\">Admin - Can manage team and settings</option>\n          </select>\n          <div class=\"form-hint\" style=\"margin-top: 4px;\">You can assign a project role after they join.</div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"invite-message\">Personal Message (optional)</label>\n          <textarea id=\"invite-message\" rows=\"2\" \n                    placeholder=\"Add a personal note to the invitation...\"></textarea>\n        </div>\n        \n        <div class=\"email-status\" id=\"email-status\"></div>\n      </form>\n    </div>\n    \n    <!-- Tab: Existing Contacts -->\n    <div class=\"invite-tab-content\" id=\"tab-contacts\">\n      <div id=\"contacts-list\" class=\"contacts-list\">\n        <div class=\"no-contacts-msg\">Loading contacts...</div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"invite-role-contact\">Access Level</label>\n        <select id=\"invite-role-contact\">\n          <option value=\"read\">Viewer - Can view data only</option>\n          <option value=\"write\" selected>Member - Can view and edit data</option>\n          <option value=\"admin\">Admin - Can manage team and settings</option>\n        </select>\n      </div>\n      \n      <div class=\"add-options\" style=\"display: flex; gap: 12px; margin-top: 16px;\">\n        <button type=\"button\" id=\"btn-add-direct\" class=\"btn btn-primary\" style=\"flex: 1;\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"margin-right: 6px;\">\n            <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n            <circle cx=\"8.5\" cy=\"7\" r=\"4\"/>\n            <line x1=\"20\" y1=\"8\" x2=\"20\" y2=\"14\"/>\n            <line x1=\"23\" y1=\"11\" x2=\"17\" y2=\"11\"/>\n          </svg>\n          Add to Team\n        </button>\n        <button type=\"button\" id=\"btn-send-invite\" class=\"btn btn-secondary\" style=\"flex: 1;\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"margin-right: 6px;\">\n            <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"/>\n            <polyline points=\"22,6 12,13 2,6\"/>\n          </svg>\n          Send Invitation\n        </button>\n      </div>\n      <div class=\"form-hint\" style=\"margin-top: 8px; font-size: 12px; color: var(--text-secondary);\">\n        <strong>Add to Team:</strong> Adds contact as team member directly (no email sent)<br>\n        <strong>Send Invitation:</strong> Sends an email invitation to join\n      </div>\n      \n      <div class=\"email-status\" id=\"email-status-contact\"></div>\n    </div>\n    \n    <div class=\"invite-link-section\" style=\"margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-color, #e2e8f0);\">\n      <h4 style=\"margin: 0 0 8px; font-size: 13px; color: var(--text-secondary, #64748b);\">Or share invite link</h4>\n      <div class=\"input-group\" style=\"display: flex; gap: 8px;\">\n        <input type=\"text\" id=\"invite-link\" readonly \n               value=\"Generating link...\" class=\"form-control\" style=\"flex: 1;\">\n        <button type=\"button\" id=\"btn-copy-link\" class=\"btn btn-secondary\">Copy</button>\n      </div>\n    </div>\n  `;\n\n  // State\n  let activeTab = 'new';\n  let selectedContact: Contact | null = null;\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const cancelBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Cancel',\n  });\n\n  const sendBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Send Invitation',\n  });\n\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n  // Handler for sending email invitation (New Email tab)\n  on(sendBtn, 'click', async () => {\n    if (activeTab !== 'new') return; // Only for new email tab\n    \n    const form = content.querySelector('#invite-form') as HTMLFormElement;\n    if (!form.checkValidity()) {\n      form.reportValidity();\n      return;\n    }\n    const email = (content.querySelector('#invite-email') as HTMLInputElement).value.trim();\n    const role = (content.querySelector('#invite-role') as HTMLSelectElement).value;\n    const message = (content.querySelector('#invite-message') as HTMLTextAreaElement).value.trim();\n\n    sendBtn.disabled = true;\n    sendBtn.textContent = 'Sending...';\n\n    const statusEl = content.querySelector('#email-status') as HTMLElement;\n\n    try {\n      const response = await http.post<{ success: boolean; email_sent: boolean }>(`/api/projects/${projectId}/invites`, {\n        email,\n        role,\n        message: message || undefined,\n      });\n\n      if (response.data.email_sent) {\n        statusEl.textContent = ` Invitation email sent to ${email}`;\n        statusEl.classList.remove('error');\n        statusEl.classList.add('show');\n      } else {\n        statusEl.textContent = `Invitation created, but email could not be sent. Share the link manually.`;\n        statusEl.classList.add('error', 'show');\n      }\n\n      toast.success(`Invitation sent to ${email}`);\n      onInviteSent?.(email);\n      setTimeout(() => closeModal(MODAL_ID), 1500);\n    } catch {\n      statusEl.textContent = 'Failed to create invitation';\n      statusEl.classList.add('error', 'show');\n    } finally {\n      sendBtn.disabled = false;\n      sendBtn.textContent = 'Send Invitation';\n    }\n  });\n\n  footer.appendChild(cancelBtn);\n  footer.appendChild(sendBtn);\n\n  // Bind contacts tab buttons after modal is created\n  setTimeout(() => {\n    const btnAddDirect = content.querySelector('#btn-add-direct') as HTMLButtonElement;\n    const btnSendInvite = content.querySelector('#btn-send-invite') as HTMLButtonElement;\n    const statusEl = content.querySelector('#email-status-contact') as HTMLElement;\n\n    // Add directly without email\n    if (btnAddDirect) {\n      on(btnAddDirect, 'click', async () => {\n        if (!selectedContact) {\n          toast.error('Please select a contact');\n          return;\n        }\n        \n        const role = (content.querySelector('#invite-role-contact') as HTMLSelectElement).value;\n        \n        btnAddDirect.disabled = true;\n        btnAddDirect.innerHTML = '<span class=\"spinner\"></span> Adding...';\n\n        try {\n          // Add contact as team member directly (without email)\n          await http.post(`/api/projects/${projectId}/members/add-contact`, {\n            contact_id: selectedContact.id,\n            role,\n          });\n\n          statusEl.textContent = ` ${selectedContact.name} added to team`;\n          statusEl.classList.remove('error');\n          statusEl.classList.add('show');\n\n          toast.success(`${selectedContact.name} added to team`);\n          onInviteSent?.(selectedContact.email || selectedContact.name);\n          setTimeout(() => closeModal(MODAL_ID), 1000);\n        } catch (error: any) {\n          const msg = error?.response?.data?.error || 'Failed to add member';\n          statusEl.textContent = msg;\n          statusEl.classList.add('error', 'show');\n          toast.error(msg);\n        } finally {\n          btnAddDirect.disabled = false;\n          btnAddDirect.innerHTML = `\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"margin-right: 6px;\">\n              <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n              <circle cx=\"8.5\" cy=\"7\" r=\"4\"/>\n              <line x1=\"20\" y1=\"8\" x2=\"20\" y2=\"14\"/>\n              <line x1=\"23\" y1=\"11\" x2=\"17\" y2=\"11\"/>\n            </svg>\n            Add to Team\n          `;\n        }\n      });\n    }\n\n    // Send invitation email\n    if (btnSendInvite) {\n      on(btnSendInvite, 'click', async () => {\n        if (!selectedContact || !selectedContact.email) {\n          toast.error('Please select a contact with an email address');\n          return;\n        }\n\n        const role = (content.querySelector('#invite-role-contact') as HTMLSelectElement).value;\n\n        btnSendInvite.disabled = true;\n        btnSendInvite.innerHTML = '<span class=\"spinner\"></span> Sending...';\n\n        try {\n          const response = await http.post<{ success: boolean; email_sent: boolean }>(`/api/projects/${projectId}/invites`, {\n            email: selectedContact.email,\n            role,\n          });\n\n          if (response.data.email_sent) {\n            statusEl.textContent = ` Invitation email sent to ${selectedContact.email}`;\n            statusEl.classList.remove('error');\n            statusEl.classList.add('show');\n          } else {\n            statusEl.textContent = `Invitation created, but email could not be sent.`;\n            statusEl.classList.add('error', 'show');\n          }\n\n          toast.success(`Invitation sent to ${selectedContact.name}`);\n          onInviteSent?.(selectedContact.email);\n          setTimeout(() => closeModal(MODAL_ID), 1500);\n        } catch {\n          statusEl.textContent = 'Failed to send invitation';\n          statusEl.classList.add('error', 'show');\n        } finally {\n          btnSendInvite.disabled = false;\n          btnSendInvite.innerHTML = `\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"margin-right: 6px;\">\n              <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"/>\n              <polyline points=\"22,6 12,13 2,6\"/>\n            </svg>\n            Send Invitation\n          `;\n        }\n      });\n    }\n  }, 0);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Invite Team Member',\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Generate invite link\n  generateInviteLink(content, projectId);\n\n  // Tab switching\n  const tabBtns = content.querySelectorAll('.invite-tab-btn');\n  tabBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const tabId = btn.getAttribute('data-tab') || 'new';\n      activeTab = tabId;\n      \n      tabBtns.forEach(b => b.classList.remove('active'));\n      btn.classList.add('active');\n      \n      content.querySelectorAll('.invite-tab-content').forEach(tab => {\n        tab.classList.toggle('active', tab.id === `tab-${tabId}`);\n      });\n    });\n  });\n\n  // Load contacts for the contacts tab (pass projectId to filter already-linked contacts)\n  loadContacts(content, projectId, (contact) => {\n    selectedContact = contact;\n  });\n\n  // Bind copy button\n  setTimeout(() => {\n    const copyBtn = content.querySelector('#btn-copy-link');\n    if (copyBtn) {\n      on(copyBtn as HTMLElement, 'click', () => {\n        const linkInput = content.querySelector('#invite-link') as HTMLInputElement;\n        navigator.clipboard.writeText(linkInput.value).then(() => {\n          toast.success('Link copied to clipboard');\n        }).catch(() => {\n          // Fallback\n          linkInput.select();\n          document.execCommand('copy');\n          toast.success('Link copied');\n        });\n      });\n    }\n  }, 0);\n}\n\n/**\n * Generate invite link\n */\nasync function generateInviteLink(container: HTMLElement, projectId: string): Promise<void> {\n  const linkInput = container.querySelector('#invite-link') as HTMLInputElement;\n\n  try {\n    const response = await http.get<{ link?: string; invite_url?: string }>(`/api/projects/${projectId}/invites/link`);\n    linkInput.value = response.data.link || response.data.invite_url || 'Link not available';\n  } catch {\n    // Try alternate endpoint\n    try {\n      const response = await http.post<{ invite_url?: string; token?: string }>(`/api/projects/${projectId}/invites`, {\n        email: '',\n        role: 'member',\n        generate_link_only: true,\n      });\n      if (response.data.invite_url) {\n        linkInput.value = response.data.invite_url;\n      } else {\n        linkInput.value = 'Use email invitation instead';\n      }\n    } catch {\n      linkInput.value = 'Use email invitation instead';\n    }\n  }\n}\n\n/**\n * Load project members to filter out already-linked contacts\n */\nasync function loadProjectMembers(projectId: string): Promise<void> {\n  try {\n    const response = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\n    cachedMembers = response.data.members || [];\n  } catch (error) {\n    console.warn('[InviteModal] Failed to load project members:', error);\n    cachedMembers = [];\n  }\n}\n\n/**\n * Load contacts for selection\n */\nasync function loadContacts(container: HTMLElement, projectId: string, onSelect: (contact: Contact | null) => void): Promise<void> {\n  const listEl = container.querySelector('#contacts-list') as HTMLElement;\n  if (!listEl) return;\n\n  try {\n    // Load members first to know which contacts are already linked\n    await loadProjectMembers(projectId);\n    \n    const response = await http.get<{ contacts: Contact[] }>('/api/contacts');\n    const contacts = response.data.contacts || [];\n    \n    // Get IDs of contacts already linked to project members\n    const linkedContactIds = new Set(\n      cachedMembers\n        .filter(m => m.linked_contact_id)\n        .map(m => m.linked_contact_id)\n    );\n    \n    // Filter to contacts not already linked to a member\n    // Note: For \"Add to Team\" we don't require email, only for \"Send Invitation\"\n    const availableContacts = contacts.filter(c => !linkedContactIds.has(c.id));\n\n    if (availableContacts.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"no-contacts-msg\">\n          ${linkedContactIds.size > 0 \n            ? 'All contacts are already team members.' \n            : 'No contacts found.'}\n          <br>\n          <small style=\"opacity: 0.7;\">Add contacts in the Contacts panel.</small>\n        </div>\n      `;\n      return;\n    }\n\n    listEl.innerHTML = availableContacts.map(contact => {\n      const initials = contact.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n      const avatarUrl = contact.avatar_url || contact.photo_url;\n      const hasEmail = !!contact.email;\n      const subtitle = [contact.email, contact.organization].filter(Boolean).join('  ') || contact.role || 'No email';\n      \n      return `\n        <label class=\"contact-option\" data-id=\"${contact.id}\" data-has-email=\"${hasEmail}\">\n          <input type=\"radio\" name=\"contact-select\" value=\"${contact.id}\">\n          <span class=\"radio-circle\"></span>\n          <div class=\"contact-avatar\">\n            ${avatarUrl ? `<img src=\"${avatarUrl}\" alt=\"${escapeHtml(contact.name)}\">` : initials}\n          </div>\n          <div class=\"contact-info\">\n            <div class=\"contact-name\">${escapeHtml(contact.name)}</div>\n            <div class=\"contact-email\">${escapeHtml(subtitle)}${!hasEmail ? ' <span style=\"color: #f59e0b; font-size: 10px;\">(no email)</span>' : ''}</div>\n          </div>\n        </label>\n      `;\n    }).join('');\n\n    // Bind selection events\n    const options = listEl.querySelectorAll('.contact-option');\n    options.forEach(option => {\n      on(option as HTMLElement, 'click', () => {\n        options.forEach(o => o.classList.remove('selected'));\n        option.classList.add('selected');\n        \n        const contactId = option.getAttribute('data-id');\n        const selectedContact = availableContacts.find(c => c.id === contactId) || null;\n        onSelect(selectedContact);\n      });\n    });\n  } catch (error) {\n    listEl.innerHTML = `\n      <div class=\"no-contacts-msg\">\n        Failed to load contacts\n      </div>\n    `;\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showInviteModal;\n","/**\n * Role Modal Component\n * Manage user roles and permissions\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'role-modal';\n\nexport interface Role {\n  id: string;\n  name: string;\n  description?: string;\n  permissions: string[];\n  color?: string;\n  isDefault?: boolean;\n}\n\nexport interface RoleModalProps {\n  mode: 'view' | 'edit' | 'create';\n  role?: Role;\n  availablePermissions?: string[];\n  onSave?: (role: Role) => void;\n  onDelete?: (roleId: string) => void;\n}\n\nconst defaultPermissions = [\n  'view:dashboard',\n  'view:chat',\n  'view:sot',\n  'view:contacts',\n  'edit:questions',\n  'edit:risks',\n  'edit:actions',\n  'edit:decisions',\n  'edit:contacts',\n  'manage:team',\n  'manage:settings',\n  'manage:roles',\n  'delete:data',\n  'export:data',\n];\n\n/**\n * Show role modal\n */\nexport function showRoleModal(props: RoleModalProps): void {\n  const { mode, role, availablePermissions = defaultPermissions, onSave, onDelete } = props;\n  const isEdit = mode === 'edit' && role?.id;\n  const isView = mode === 'view';\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'role-modal-content' });\n\n  if (isView && role) {\n    content.innerHTML = `\n      <div class=\"role-view\">\n        <div class=\"role-header-info\">\n          <div class=\"role-color-badge\" style=\"background: ${role.color || '#e94560'}\"></div>\n          <div>\n            <h3>${escapeHtml(role.name)}</h3>\n            ${role.description ? `<p class=\"text-muted\">${escapeHtml(role.description)}</p>` : ''}\n          </div>\n        </div>\n        \n        <div class=\"role-permissions\">\n          <h4>Permissions (${role.permissions.length})</h4>\n          <div class=\"permissions-list\">\n            ${role.permissions.map(p => `\n              <span class=\"permission-tag\">${formatPermission(p)}</span>\n            `).join('')}\n          </div>\n        </div>\n        \n        ${role.isDefault ? '<p class=\"text-muted\"><em>This is a system role and cannot be modified.</em></p>' : ''}\n      </div>\n    `;\n  } else {\n    const rolePermissions = role?.permissions || [];\n    \n    content.innerHTML = `\n      <form id=\"role-form\" class=\"role-form\">\n        <div class=\"form-row\">\n          <div class=\"form-group\" style=\"flex: 1\">\n            <label for=\"role-name\">Role Name *</label>\n            <input type=\"text\" id=\"role-name\" required \n                   value=\"${role?.name || ''}\" \n                   placeholder=\"e.g., Project Manager\">\n          </div>\n          <div class=\"form-group\" style=\"width: 80px\">\n            <label for=\"role-color\">Color</label>\n            <input type=\"color\" id=\"role-color\" \n                   value=\"${role?.color || '#e94560'}\">\n          </div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"role-description\">Description</label>\n          <textarea id=\"role-description\" rows=\"2\" \n                    placeholder=\"Brief description of this role...\">${role?.description || ''}</textarea>\n        </div>\n        \n        <div class=\"form-group\">\n          <label>Permissions</label>\n          <div class=\"permissions-grid\">\n            ${availablePermissions.map(p => `\n              <label class=\"permission-checkbox\">\n                <input type=\"checkbox\" name=\"permissions\" value=\"${p}\" \n                       ${rolePermissions.includes(p) ? 'checked' : ''}>\n                <span>${formatPermission(p)}</span>\n              </label>\n            `).join('')}\n          </div>\n        </div>\n        \n        <div class=\"form-group\">\n          <button type=\"button\" class=\"btn btn-sm btn-secondary\" data-action=\"select-all\">Select All</button>\n          <button type=\"button\" class=\"btn btn-sm btn-secondary\" data-action=\"select-none\">Select None</button>\n        </div>\n      </form>\n    `;\n\n    // Bind select all/none\n    setTimeout(() => {\n      const selectAll = content.querySelector('[data-action=\"select-all\"]');\n      const selectNone = content.querySelector('[data-action=\"select-none\"]');\n\n      if (selectAll) {\n        on(selectAll as HTMLElement, 'click', () => {\n          content.querySelectorAll('[name=\"permissions\"]').forEach(cb => {\n            (cb as HTMLInputElement).checked = true;\n          });\n        });\n      }\n\n      if (selectNone) {\n        on(selectNone as HTMLElement, 'click', () => {\n          content.querySelectorAll('[name=\"permissions\"]').forEach(cb => {\n            (cb as HTMLInputElement).checked = false;\n          });\n        });\n      }\n    }, 0);\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  if (isView) {\n    const editBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Edit',\n    });\n\n    const closeBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Close',\n    });\n\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n\n    if (!role?.isDefault) {\n      on(editBtn, 'click', () => {\n        closeModal(MODAL_ID);\n        showRoleModal({ ...props, mode: 'edit' });\n      });\n      footer.appendChild(editBtn);\n    }\n\n    footer.appendChild(closeBtn);\n  } else {\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const saveBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: isEdit ? 'Save Changes' : 'Create Role',\n    });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n    on(saveBtn, 'click', async () => {\n      const form = content.querySelector('#role-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const name = (content.querySelector('#role-name') as HTMLInputElement).value.trim();\n      const description = (content.querySelector('#role-description') as HTMLTextAreaElement).value.trim();\n      const color = (content.querySelector('#role-color') as HTMLInputElement).value;\n      \n      const permissions: string[] = [];\n      content.querySelectorAll('[name=\"permissions\"]:checked').forEach(cb => {\n        permissions.push((cb as HTMLInputElement).value);\n      });\n\n      const roleData: Role = {\n        id: role?.id || `role-${Date.now()}`,\n        name,\n        description: description || undefined,\n        color,\n        permissions,\n      };\n\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Saving...';\n\n      try {\n        if (isEdit) {\n          await http.put(`/api/roles/${role!.id}`, roleData);\n          toast.success('Role updated');\n        } else {\n          const response = await http.post<{ id: string }>('/api/roles', roleData);\n          roleData.id = response.data.id;\n          toast.success('Role created');\n        }\n\n        onSave?.(roleData);\n        closeModal(MODAL_ID);\n      } catch {\n        // Error shown by API service\n      } finally {\n        saveBtn.disabled = false;\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Role';\n      }\n    });\n\n    if (isEdit && !role?.isDefault) {\n      const deleteBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Delete',\n      });\n\n      on(deleteBtn, 'click', async () => {\n        const { confirm } = await import('../Modal');\n        const confirmed = await confirm(\n          `Are you sure you want to delete the \"${role!.name}\" role?`,\n          {\n            title: 'Delete Role',\n            confirmText: 'Delete',\n            confirmClass: 'btn-danger',\n          }\n        );\n\n        if (confirmed) {\n          try {\n            await http.delete(`/api/roles/${role!.id}`);\n            toast.success('Role deleted');\n            onDelete?.(role!.id);\n            closeModal(MODAL_ID);\n          } catch {\n            // Error shown by API service\n          }\n        }\n      });\n\n      footer.appendChild(deleteBtn);\n    }\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(saveBtn);\n  }\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: isView ? 'Role Details' : (isEdit ? 'Edit Role' : 'New Role'),\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Format permission for display\n */\nfunction formatPermission(permission: string): string {\n  return permission\n    .replace(':', ': ')\n    .split(/[_:]/)\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ');\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showRoleModal;\n","/**\n * Export Modal Component\n * Export project data in various formats\n */\n\nimport { createElement, on, addClass, removeClass } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { appStore } from '../../stores/app';\n\nconst MODAL_ID = 'export-modal';\n\nexport type ExportFormat = 'json' | 'csv' | 'pdf' | 'markdown';\nexport type ExportScope = 'all' | 'questions' | 'risks' | 'actions' | 'decisions' | 'contacts';\n\nexport interface ExportModalProps {\n  defaultFormat?: ExportFormat;\n  defaultScope?: ExportScope;\n  onExport?: (format: ExportFormat, scope: ExportScope) => void;\n}\n\n/**\n * Show export modal\n */\nexport function showExportModal(props: ExportModalProps = {}): void {\n  const { defaultFormat = 'json', defaultScope = 'all' } = props;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'export-modal-content' });\n\n  content.innerHTML = `\n    <div class=\"export-options\">\n      <div class=\"form-group\">\n        <label>What to Export</label>\n        <div class=\"scope-options\">\n          <label class=\"radio-card ${defaultScope === 'all' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-scope\" value=\"all\" ${defaultScope === 'all' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\"></span>\n              <span class=\"label\">Everything</span>\n            </div>\n          </label>\n          <label class=\"radio-card ${defaultScope === 'questions' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-scope\" value=\"questions\" ${defaultScope === 'questions' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\"></span>\n              <span class=\"label\">Questions</span>\n            </div>\n          </label>\n          <label class=\"radio-card ${defaultScope === 'risks' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-scope\" value=\"risks\" ${defaultScope === 'risks' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\"></span>\n              <span class=\"label\">Risks</span>\n            </div>\n          </label>\n          <label class=\"radio-card ${defaultScope === 'actions' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-scope\" value=\"actions\" ${defaultScope === 'actions' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\"></span>\n              <span class=\"label\">Actions</span>\n            </div>\n          </label>\n          <label class=\"radio-card ${defaultScope === 'decisions' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-scope\" value=\"decisions\" ${defaultScope === 'decisions' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\"></span>\n              <span class=\"label\">Decisions</span>\n            </div>\n          </label>\n          <label class=\"radio-card ${defaultScope === 'contacts' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-scope\" value=\"contacts\" ${defaultScope === 'contacts' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\"></span>\n              <span class=\"label\">Contacts</span>\n            </div>\n          </label>\n        </div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label>Format</label>\n        <div class=\"format-options\">\n          <label class=\"radio-card ${defaultFormat === 'json' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-format\" value=\"json\" ${defaultFormat === 'json' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\">{ }</span>\n              <span class=\"label\">JSON</span>\n              <span class=\"hint\">Full data backup</span>\n            </div>\n          </label>\n          <label class=\"radio-card ${defaultFormat === 'csv' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-format\" value=\"csv\" ${defaultFormat === 'csv' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\"></span>\n              <span class=\"label\">CSV</span>\n              <span class=\"hint\">Spreadsheet</span>\n            </div>\n          </label>\n          <label class=\"radio-card ${defaultFormat === 'markdown' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-format\" value=\"markdown\" ${defaultFormat === 'markdown' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\"></span>\n              <span class=\"label\">Markdown</span>\n              <span class=\"hint\">Documentation</span>\n            </div>\n          </label>\n          <label class=\"radio-card ${defaultFormat === 'pdf' ? 'selected' : ''}\">\n            <input type=\"radio\" name=\"export-format\" value=\"pdf\" ${defaultFormat === 'pdf' ? 'checked' : ''}>\n            <div class=\"radio-card-content\">\n              <span class=\"icon\"></span>\n              <span class=\"label\">PDF</span>\n              <span class=\"hint\">Report</span>\n            </div>\n          </label>\n        </div>\n      </div>\n    </div>\n  `;\n\n  // Handle radio card selection styling\n  content.querySelectorAll('.radio-card input').forEach(input => {\n    on(input as HTMLElement, 'change', () => {\n      const group = (input as HTMLInputElement).name;\n      content.querySelectorAll(`[name=\"${group}\"]`).forEach(radio => {\n        const card = radio.closest('.radio-card');\n        if (card) {\n          if ((radio as HTMLInputElement).checked) {\n            addClass(card as HTMLElement, 'selected');\n          } else {\n            removeClass(card as HTMLElement, 'selected');\n          }\n        }\n      });\n    });\n  });\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const cancelBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Cancel',\n  });\n\n  const exportBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Export',\n  });\n\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n  on(exportBtn, 'click', async () => {\n    const format = (content.querySelector('[name=\"export-format\"]:checked') as HTMLInputElement)?.value as ExportFormat;\n    const scope = (content.querySelector('[name=\"export-scope\"]:checked') as HTMLInputElement)?.value as ExportScope;\n\n    exportBtn.disabled = true;\n    exportBtn.textContent = 'Exporting...';\n\n    try {\n      await performExport(format, scope);\n      props.onExport?.(format, scope);\n      closeModal(MODAL_ID);\n    } catch {\n      // Error handled in performExport\n    } finally {\n      exportBtn.disabled = false;\n      exportBtn.textContent = 'Export';\n    }\n  });\n\n  footer.appendChild(cancelBtn);\n  footer.appendChild(exportBtn);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Export Data',\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Perform the export\n */\nasync function performExport(format: ExportFormat, scope: ExportScope): Promise<void> {\n  const projectId = appStore.getState().currentProjectId;\n  if (!projectId) {\n    toast.error('No project selected');\n    return;\n  }\n\n  try {\n    const response = await http.get<unknown>(`/api/projects/${projectId}/export`, {\n      headers: {\n        'Accept': getContentType(format),\n      },\n    });\n\n    // Create download\n    const blob = createBlob(response.data, format);\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `godmode-${scope}-${new Date().toISOString().split('T')[0]}.${getExtension(format)}`;\n    a.click();\n    URL.revokeObjectURL(url);\n\n    toast.success('Export completed');\n  } catch {\n    toast.error('Export failed');\n    throw new Error('Export failed');\n  }\n}\n\n/**\n * Get content type for format\n */\nfunction getContentType(format: ExportFormat): string {\n  switch (format) {\n    case 'json': return 'application/json';\n    case 'csv': return 'text/csv';\n    case 'markdown': return 'text/markdown';\n    case 'pdf': return 'application/pdf';\n  }\n}\n\n/**\n * Get file extension for format\n */\nfunction getExtension(format: ExportFormat): string {\n  switch (format) {\n    case 'json': return 'json';\n    case 'csv': return 'csv';\n    case 'markdown': return 'md';\n    case 'pdf': return 'pdf';\n  }\n}\n\n/**\n * Create blob from data\n */\nfunction createBlob(data: unknown, format: ExportFormat): Blob {\n  let content: string;\n  let type: string;\n\n  switch (format) {\n    case 'json':\n      content = JSON.stringify(data, null, 2);\n      type = 'application/json';\n      break;\n    case 'csv':\n      content = typeof data === 'string' ? data : JSON.stringify(data);\n      type = 'text/csv';\n      break;\n    case 'markdown':\n      content = typeof data === 'string' ? data : JSON.stringify(data, null, 2);\n      type = 'text/markdown';\n      break;\n    case 'pdf':\n      // PDF would need special handling\n      content = typeof data === 'string' ? data : '';\n      type = 'application/pdf';\n      break;\n  }\n\n  return new Blob([content], { type });\n}\n\nexport default showExportModal;\n","/**\n * File Upload Modal Component\n * Handle file uploads with progress\n */\n\nimport { createElement, on, addClass, removeClass } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { toast } from '../../services/toast';\nimport { formatFileSize } from '../../utils/format';\n\nconst MODAL_ID = 'file-upload-modal';\n\nexport interface UploadFile {\n  id: string;\n  file: File;\n  progress: number;\n  status: 'pending' | 'uploading' | 'completed' | 'error';\n  error?: string;\n}\n\nexport interface FileUploadModalProps {\n  accept?: string;\n  multiple?: boolean;\n  maxSize?: number; // bytes\n  onUpload?: (files: File[]) => Promise<void>;\n  onComplete?: (results: UploadFile[]) => void;\n}\n\nlet uploadQueue: UploadFile[] = [];\nlet isUploading = false;\n\n/**\n * Show file upload modal\n */\nexport function showFileUploadModal(props: FileUploadModalProps = {}): void {\n  const {\n    accept = '*/*',\n    multiple = true,\n    maxSize = 50 * 1024 * 1024, // 50MB default\n    onUpload,\n    onComplete,\n  } = props;\n\n  uploadQueue = [];\n  isUploading = false;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'file-upload-modal-content' });\n\n  function render(): void {\n    content.innerHTML = `\n      <div class=\"drop-zone\" id=\"drop-zone\">\n        <div class=\"drop-zone-icon\"></div>\n        <div class=\"drop-zone-text\">\n          <strong>Drop files here</strong> or click to browse\n        </div>\n        <div class=\"drop-zone-hint\">\n          ${multiple ? 'You can upload multiple files' : 'Single file only'}\n          ${maxSize ? `  Max ${formatFileSize(maxSize)}` : ''}\n        </div>\n        <input type=\"file\" id=\"file-input\" ${accept !== '*/*' ? `accept=\"${accept}\"` : ''} ${multiple ? 'multiple' : ''} hidden>\n      </div>\n      \n      ${uploadQueue.length > 0 ? `\n        <div class=\"upload-list\">\n          <h4>Files (${uploadQueue.length})</h4>\n          ${uploadQueue.map(f => renderFileItem(f)).join('')}\n        </div>\n      ` : ''}\n    `;\n\n    bindDropZone();\n    bindFileItems();\n  }\n\n  function bindDropZone(): void {\n    const dropZone = content.querySelector('#drop-zone') as HTMLElement;\n    const fileInput = content.querySelector('#file-input') as HTMLInputElement;\n\n    if (!dropZone || !fileInput) return;\n\n    // Click to browse\n    on(dropZone, 'click', () => fileInput.click());\n\n    // File input change\n    on(fileInput, 'change', () => {\n      if (fileInput.files) {\n        addFiles(Array.from(fileInput.files), maxSize);\n        render();\n      }\n    });\n\n    // Drag and drop\n    on(dropZone, 'dragover', (e) => {\n      e.preventDefault();\n      addClass(dropZone, 'drag-over');\n    });\n\n    on(dropZone, 'dragleave', () => {\n      removeClass(dropZone, 'drag-over');\n    });\n\n    on(dropZone, 'drop', (e) => {\n      e.preventDefault();\n      removeClass(dropZone, 'drag-over');\n      \n      const dt = (e as DragEvent).dataTransfer;\n      if (dt?.files) {\n        addFiles(Array.from(dt.files), maxSize);\n        render();\n      }\n    });\n  }\n\n  function bindFileItems(): void {\n    content.querySelectorAll('[data-action=\"remove\"]').forEach(btn => {\n      on(btn as HTMLElement, 'click', () => {\n        const fileId = btn.getAttribute('data-file-id');\n        if (fileId) {\n          uploadQueue = uploadQueue.filter(f => f.id !== fileId);\n          render();\n        }\n      });\n    });\n  }\n\n  render();\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const cancelBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Cancel',\n  });\n\n  const uploadBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Upload',\n  });\n\n  on(cancelBtn, 'click', () => {\n    if (isUploading) {\n      toast.warning('Upload in progress');\n      return;\n    }\n    closeModal(MODAL_ID);\n  });\n\n  on(uploadBtn, 'click', async () => {\n    if (uploadQueue.length === 0) {\n      toast.warning('No files selected');\n      return;\n    }\n\n    if (isUploading) return;\n\n    isUploading = true;\n    uploadBtn.disabled = true;\n    uploadBtn.textContent = 'Uploading...';\n\n    try {\n      if (onUpload) {\n        const files = uploadQueue.map(f => f.file);\n        await onUpload(files);\n        \n        // Mark all as completed\n        uploadQueue.forEach(f => {\n          f.status = 'completed';\n          f.progress = 100;\n        });\n      } else {\n        // Default upload behavior\n        await uploadFiles(uploadQueue, render);\n      }\n\n      toast.success('Upload complete');\n      onComplete?.(uploadQueue);\n      closeModal(MODAL_ID);\n    } catch (error) {\n      toast.error('Upload failed');\n    } finally {\n      isUploading = false;\n      uploadBtn.disabled = false;\n      uploadBtn.textContent = 'Upload';\n      render();\n    }\n  });\n\n  footer.appendChild(cancelBtn);\n  footer.appendChild(uploadBtn);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Upload Files',\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Add files to queue\n */\nfunction addFiles(files: File[], maxSize: number): void {\n  files.forEach(file => {\n    if (file.size > maxSize) {\n      toast.error(`${file.name} exceeds max size`);\n      return;\n    }\n\n    // Check for duplicates\n    if (uploadQueue.some(f => f.file.name === file.name && f.file.size === file.size)) {\n      return;\n    }\n\n    uploadQueue.push({\n      id: `file-${Date.now()}-${Math.random().toString(36).slice(2)}`,\n      file,\n      progress: 0,\n      status: 'pending',\n    });\n  });\n}\n\n/**\n * Render file item\n */\nfunction renderFileItem(item: UploadFile): string {\n  const icon = getFileIcon(item.file.type);\n  const statusClass = item.status;\n\n  return `\n    <div class=\"upload-item ${statusClass}\" data-file-id=\"${item.id}\">\n      <span class=\"file-icon\">${icon}</span>\n      <div class=\"file-info\">\n        <div class=\"file-name\">${escapeHtml(item.file.name)}</div>\n        <div class=\"file-size\">${formatFileSize(item.file.size)}</div>\n        ${item.status === 'uploading' ? `\n          <div class=\"progress-bar\">\n            <div class=\"progress-fill\" style=\"width: ${item.progress}%\"></div>\n          </div>\n        ` : ''}\n        ${item.error ? `<div class=\"file-error\">${escapeHtml(item.error)}</div>` : ''}\n      </div>\n      <div class=\"file-status\">\n        ${item.status === 'completed' ? '' : ''}\n        ${item.status === 'error' ? '' : ''}\n        ${item.status === 'pending' ? `\n          <button class=\"btn-sm btn-danger\" data-action=\"remove\" data-file-id=\"${item.id}\"></button>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Default upload handler\n */\nasync function uploadFiles(\n  files: UploadFile[],\n  rerender: () => void\n): Promise<void> {\n  for (const file of files) {\n    file.status = 'uploading';\n    rerender();\n\n    try {\n      const formData = new FormData();\n      formData.append('file', file.file);\n\n      const xhr = new XMLHttpRequest();\n      \n      await new Promise<void>((resolve, reject) => {\n        xhr.upload.addEventListener('progress', (e) => {\n          if (e.lengthComputable) {\n            file.progress = Math.round((e.loaded / e.total) * 100);\n            rerender();\n          }\n        });\n\n        xhr.addEventListener('load', () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            file.status = 'completed';\n            file.progress = 100;\n            resolve();\n          } else {\n            file.status = 'error';\n            file.error = 'Upload failed';\n            reject(new Error('Upload failed'));\n          }\n        });\n\n        xhr.addEventListener('error', () => {\n          file.status = 'error';\n          file.error = 'Network error';\n          reject(new Error('Network error'));\n        });\n\n        xhr.open('POST', '/api/upload');\n        xhr.send(formData);\n      });\n    } catch {\n      file.status = 'error';\n    }\n\n    rerender();\n  }\n}\n\n/**\n * Get icon for file type\n */\nfunction getFileIcon(mimeType: string): string {\n  if (mimeType.startsWith('image/')) return '';\n  if (mimeType.startsWith('video/')) return '';\n  if (mimeType.startsWith('audio/')) return '';\n  if (mimeType.includes('pdf')) return '';\n  if (mimeType.includes('word') || mimeType.includes('document')) return '';\n  if (mimeType.includes('sheet') || mimeType.includes('excel')) return '';\n  if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return '';\n  if (mimeType.includes('zip') || mimeType.includes('archive')) return '';\n  if (mimeType.includes('text')) return '';\n  return '';\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showFileUploadModal;\n","/**\n * Developer Modal Component\n * Developer tools and debugging options\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { appStore } from '../../stores/app';\nimport { dataStore } from '../../stores/data';\nimport { uiStore } from '../../stores/ui';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'developer-modal';\n\ntype DevTab = 'info' | 'logs' | 'cache' | 'api';\n\n/**\n * Show developer modal\n */\nexport function showDeveloperModal(): void {\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'developer-modal-content' });\n  \n  let currentTab: DevTab = 'info';\n\n  function render(): void {\n    content.innerHTML = `\n      <div class=\"dev-tabs\">\n        <button class=\"dev-tab ${currentTab === 'info' ? 'active' : ''}\" data-tab=\"info\">Info</button>\n        <button class=\"dev-tab ${currentTab === 'logs' ? 'active' : ''}\" data-tab=\"logs\">Logs</button>\n        <button class=\"dev-tab ${currentTab === 'cache' ? 'active' : ''}\" data-tab=\"cache\">Cache</button>\n        <button class=\"dev-tab ${currentTab === 'api' ? 'active' : ''}\" data-tab=\"api\">API Test</button>\n      </div>\n      <div class=\"dev-content\">\n        ${renderTabContent(currentTab)}\n      </div>\n    `;\n\n    // Bind tab clicks\n    content.querySelectorAll('.dev-tab').forEach(tab => {\n      on(tab as HTMLElement, 'click', () => {\n        currentTab = tab.getAttribute('data-tab') as DevTab;\n        render();\n      });\n    });\n\n    // Bind actions\n    bindActions(content);\n  }\n\n  render();\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n  const closeBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Close',\n  });\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\n  footer.appendChild(closeBtn);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Developer Tools',\n    content,\n    size: 'lg',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Render tab content\n */\nfunction renderTabContent(tab: DevTab): string {\n  switch (tab) {\n    case 'info':\n      return renderInfoTab();\n    case 'logs':\n      return renderLogsTab();\n    case 'cache':\n      return renderCacheTab();\n    case 'api':\n      return renderApiTab();\n  }\n}\n\n/**\n * Render info tab\n */\nfunction renderInfoTab(): string {\n  const appState = appStore.getState();\n  const dataState = dataStore.getState();\n  const uiState = uiStore.getState();\n\n  return `\n    <div class=\"dev-section\">\n      <h4>Application State</h4>\n      <pre class=\"code-block\">${JSON.stringify({\n        projectId: appState.currentProjectId,\n        user: appState.currentUser?.email,\n        authConfigured: appState.authConfigured,\n      }, null, 2)}</pre>\n    </div>\n    \n    <div class=\"dev-section\">\n      <h4>Data Counts</h4>\n      <table class=\"dev-table\">\n        <tr><td>Questions</td><td>${dataState.questions.length}</td></tr>\n        <tr><td>Risks</td><td>${dataState.risks.length}</td></tr>\n        <tr><td>Actions</td><td>${dataState.actions.length}</td></tr>\n        <tr><td>Decisions</td><td>${dataState.decisions.length}</td></tr>\n        <tr><td>Contacts</td><td>${dataState.contacts.length}</td></tr>\n        <tr><td>Chat Messages</td><td>${dataState.chatHistory.length}</td></tr>\n      </table>\n    </div>\n    \n    <div class=\"dev-section\">\n      <h4>UI State</h4>\n      <pre class=\"code-block\">${JSON.stringify({\n        currentTab: uiState.currentTab,\n        sotView: uiState.sotCurrentView,\n        sidebarOpen: uiState.sidebarOpen,\n        modalOpen: uiState.modalOpen,\n      }, null, 2)}</pre>\n    </div>\n    \n    <div class=\"dev-section\">\n      <h4>Environment</h4>\n      <table class=\"dev-table\">\n        <tr><td>User Agent</td><td>${navigator.userAgent.slice(0, 50)}...</td></tr>\n        <tr><td>Screen</td><td>${window.innerWidth}x${window.innerHeight}</td></tr>\n        <tr><td>Theme</td><td>${document.documentElement.getAttribute('data-theme')}</td></tr>\n      </table>\n    </div>\n  `;\n}\n\n/**\n * Render logs tab\n */\nfunction renderLogsTab(): string {\n  return `\n    <div class=\"dev-section\">\n      <h4>Console Logs</h4>\n      <p class=\"text-muted\">Open browser DevTools (F12) to view console logs.</p>\n      <div class=\"dev-actions\">\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"clear-console\">Clear Console</button>\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"log-state\">Log State</button>\n      </div>\n    </div>\n    \n    <div class=\"dev-section\">\n      <h4>Performance</h4>\n      <table class=\"dev-table\">\n        <tr><td>Page Load</td><td>${Math.round(performance.now())}ms</td></tr>\n        <tr><td>Memory</td><td>${getMemoryUsage()}</td></tr>\n      </table>\n    </div>\n  `;\n}\n\n/**\n * Render cache tab\n */\nfunction renderCacheTab(): string {\n  const keys = Object.keys(localStorage);\n  const totalSize = keys.reduce((acc, key) => acc + (localStorage.getItem(key)?.length || 0), 0);\n\n  return `\n    <div class=\"dev-section\">\n      <h4>LocalStorage</h4>\n      <p>Items: ${keys.length} | Size: ${formatBytes(totalSize * 2)}</p>\n      <div class=\"dev-actions\">\n        <button class=\"btn btn-danger btn-sm\" data-action=\"clear-storage\">Clear All Storage</button>\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"export-storage\">Export Storage</button>\n      </div>\n      <div class=\"storage-list\">\n        ${keys.map(key => `\n          <div class=\"storage-item\">\n            <span class=\"storage-key\">${key}</span>\n            <span class=\"storage-size\">${formatBytes((localStorage.getItem(key)?.length || 0) * 2)}</span>\n            <button class=\"btn-sm btn-danger\" data-action=\"delete-key\" data-key=\"${key}\"></button>\n          </div>\n        `).join('')}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render API tab\n */\nfunction renderApiTab(): string {\n  return `\n    <div class=\"dev-section\">\n      <h4>API Test</h4>\n      <div class=\"form-group\">\n        <label>Endpoint</label>\n        <div class=\"input-group\">\n          <select id=\"api-method\" class=\"form-control\" style=\"width: 100px\">\n            <option value=\"GET\">GET</option>\n            <option value=\"POST\">POST</option>\n            <option value=\"PUT\">PUT</option>\n            <option value=\"DELETE\">DELETE</option>\n          </select>\n          <input type=\"text\" id=\"api-endpoint\" class=\"form-control\" value=\"/api/health\" placeholder=\"/api/...\">\n        </div>\n      </div>\n      <div class=\"form-group\">\n        <label>Body (JSON)</label>\n        <textarea id=\"api-body\" class=\"form-control\" rows=\"3\" placeholder='{\"key\": \"value\"}'></textarea>\n      </div>\n      <button class=\"btn btn-primary\" data-action=\"test-api\">Send Request</button>\n    </div>\n    \n    <div class=\"dev-section\">\n      <h4>Response</h4>\n      <pre id=\"api-response\" class=\"code-block\">No request sent yet</pre>\n    </div>\n  `;\n}\n\n/**\n * Bind action handlers\n */\nfunction bindActions(container: HTMLElement): void {\n  container.querySelectorAll('[data-action]').forEach(el => {\n    const action = el.getAttribute('data-action');\n    \n    on(el as HTMLElement, 'click', async () => {\n      switch (action) {\n        case 'clear-console':\n          console.clear();\n          toast.success('Console cleared');\n          break;\n          \n        case 'log-state':\n          console.group('Application State');\n          console.log('App:', appStore.getState());\n          console.log('Data:', dataStore.getState());\n          console.log('UI:', uiStore.getState());\n          console.groupEnd();\n          toast.success('State logged to console');\n          break;\n          \n        case 'clear-storage':\n          localStorage.clear();\n          toast.success('Storage cleared');\n          location.reload();\n          break;\n          \n        case 'export-storage':\n          const data = { ...localStorage };\n          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = 'localstorage-backup.json';\n          a.click();\n          toast.success('Storage exported');\n          break;\n          \n        case 'delete-key':\n          const key = el.getAttribute('data-key');\n          if (key) {\n            localStorage.removeItem(key);\n            toast.success(`Removed: ${key}`);\n            showDeveloperModal(); // Refresh\n          }\n          break;\n          \n        case 'test-api':\n          await testApi(container);\n          break;\n      }\n    });\n  });\n}\n\n/**\n * Test API endpoint\n */\nasync function testApi(container: HTMLElement): Promise<void> {\n  const method = (container.querySelector('#api-method') as HTMLSelectElement).value;\n  const endpoint = (container.querySelector('#api-endpoint') as HTMLInputElement).value;\n  const bodyText = (container.querySelector('#api-body') as HTMLTextAreaElement).value;\n  const responseEl = container.querySelector('#api-response') as HTMLPreElement;\n\n  responseEl.textContent = 'Loading...';\n\n  try {\n    const options: RequestInit = { method };\n    if (bodyText && method !== 'GET') {\n      options.body = bodyText;\n      options.headers = { 'Content-Type': 'application/json' };\n    }\n\n    const start = performance.now();\n    const response = await fetch(endpoint, options);\n    const elapsed = Math.round(performance.now() - start);\n    const data = await response.json().catch(() => response.text());\n\n    responseEl.textContent = `Status: ${response.status} (${elapsed}ms)\\n\\n${JSON.stringify(data, null, 2)}`;\n  } catch (error) {\n    responseEl.textContent = `Error: ${error instanceof Error ? error.message : 'Unknown error'}`;\n  }\n}\n\n/**\n * Get memory usage\n */\nfunction getMemoryUsage(): string {\n  const perf = performance as Performance & { memory?: { usedJSHeapSize: number } };\n  if (perf.memory) {\n    return formatBytes(perf.memory.usedJSHeapSize);\n  }\n  return 'N/A';\n}\n\n/**\n * Format bytes\n */\nfunction formatBytes(bytes: number): string {\n  if (bytes === 0) return '0 B';\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\n}\n\nexport default showDeveloperModal;\n","/**\n * Shortcuts Modal Component\n * Display keyboard shortcuts reference\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { shortcuts } from '../../services/shortcuts';\n\nconst MODAL_ID = 'shortcuts-modal';\n\ninterface ShortcutGroup {\n  title: string;\n  shortcuts: Array<{\n    keys: string[];\n    description: string;\n  }>;\n}\n\nconst shortcutGroups: ShortcutGroup[] = [\n  {\n    title: 'General',\n    shortcuts: [\n      { keys: ['Ctrl', 'Z'], description: 'Undo last action' },\n      { keys: ['Ctrl', 'Shift', 'Z'], description: 'Redo' },\n      { keys: ['Ctrl', 'S'], description: 'Save current item' },\n      { keys: ['Esc'], description: 'Close modal / Cancel' },\n      { keys: ['?'], description: 'Show this help' },\n    ],\n  },\n  {\n    title: 'Navigation',\n    shortcuts: [\n      { keys: ['Ctrl', '1'], description: 'Go to Dashboard' },\n      { keys: ['Ctrl', '2'], description: 'Go to Chat' },\n      { keys: ['Ctrl', '3'], description: 'Go to Source of Truth' },\n      { keys: ['Ctrl', '4'], description: 'Go to Timeline' },\n      { keys: ['Ctrl', '5'], description: 'Go to Contacts' },\n    ],\n  },\n  {\n    title: 'Actions',\n    shortcuts: [\n      { keys: ['Ctrl', 'K'], description: 'Quick search' },\n      { keys: ['Ctrl', 'N'], description: 'New item' },\n      { keys: ['Ctrl', 'E'], description: 'Export data' },\n      { keys: ['Ctrl', 'Shift', 'T'], description: 'Toggle theme' },\n    ],\n  },\n  {\n    title: 'Chat',\n    shortcuts: [\n      { keys: ['Enter'], description: 'Send message' },\n      { keys: ['Shift', 'Enter'], description: 'New line' },\n      { keys: [''], description: 'Previous message' },\n    ],\n  },\n];\n\n/**\n * Show shortcuts modal\n */\nexport function showShortcutsModal(): void {\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'shortcuts-modal-content' });\n\n  // Get registered shortcuts from service\n  const registeredShortcuts = shortcuts.getAll();\n\n  content.innerHTML = `\n    <div class=\"shortcuts-grid\">\n      ${shortcutGroups.map(group => `\n        <div class=\"shortcut-group\">\n          <h4>${group.title}</h4>\n          <div class=\"shortcut-list\">\n            ${group.shortcuts.map(s => `\n              <div class=\"shortcut-item\">\n                <div class=\"shortcut-keys\">\n                  ${s.keys.map(k => `<kbd>${k}</kbd>`).join(' + ')}\n                </div>\n                <div class=\"shortcut-desc\">${s.description}</div>\n              </div>\n            `).join('')}\n          </div>\n        </div>\n      `).join('')}\n    </div>\n    \n    ${registeredShortcuts.length > 0 ? `\n      <div class=\"shortcuts-custom\">\n        <h4>Active Shortcuts</h4>\n        <div class=\"shortcut-list\">\n          ${registeredShortcuts.map(s => {\n            const keys: string[] = [];\n            if (s.ctrl) keys.push('Ctrl');\n            if (s.shift) keys.push('Shift');\n            if (s.alt) keys.push('Alt');\n            if (s.meta) keys.push('Cmd');\n            keys.push(s.key.toUpperCase());\n            \n            return `\n              <div class=\"shortcut-item\">\n                <div class=\"shortcut-keys\">\n                  ${keys.map(k => `<kbd>${k}</kbd>`).join(' + ')}\n                </div>\n                <div class=\"shortcut-desc\">${s.description}</div>\n              </div>\n            `;\n          }).join('')}\n        </div>\n      </div>\n    ` : ''}\n    \n    <div class=\"shortcuts-tip\">\n      <p class=\"text-muted\">\n         Tip: Most shortcuts use Ctrl on Windows/Linux or Cmd on Mac.\n      </p>\n    </div>\n  `;\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const closeBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Got it',\n  });\n\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\n  footer.appendChild(closeBtn);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Keyboard Shortcuts',\n    content,\n    size: 'lg',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\nexport default showShortcutsModal;\n","/**\n * Notifications Modal Component\n * Display and manage notifications\n */\n\nimport { createElement, on, addClass, removeClass } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nconst MODAL_ID = 'notifications-modal';\n\nexport interface Notification {\n  id: string;\n  type: 'info' | 'success' | 'warning' | 'error' | 'mention' | 'update';\n  title: string;\n  message: string;\n  read: boolean;\n  createdAt: string;\n  link?: string;\n  actor?: {\n    name: string;\n    avatar?: string;\n  };\n}\n\nexport interface NotificationsModalProps {\n  onMarkAllRead?: () => void;\n  onNotificationClick?: (notification: Notification) => void;\n}\n\nlet notifications: Notification[] = [];\nlet filter: 'all' | 'unread' = 'all';\n\n/**\n * Show notifications modal\n */\nexport async function showNotificationsModal(props: NotificationsModalProps = {}): Promise<void> {\n  filter = 'all';\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'notifications-modal-content' });\n  content.innerHTML = '<div class=\"loading\">Loading notifications...</div>';\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const markAllBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Mark All Read',\n  });\n\n  const closeBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Close',\n  });\n\n  on(markAllBtn, 'click', async () => {\n    try {\n      await http.post('/api/notifications/mark-all-read');\n      notifications.forEach(n => n.read = true);\n      render();\n      toast.success('All marked as read');\n      props.onMarkAllRead?.();\n    } catch {\n      // Error shown by API service\n    }\n  });\n\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\n\n  footer.appendChild(markAllBtn);\n  footer.appendChild(closeBtn);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Notifications',\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Load notifications\n  try {\n    const response = await http.get<Notification[]>('/api/notifications');\n    notifications = response.data;\n    render();\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load notifications</div>';\n  }\n\n  function render(): void {\n    const filtered = filter === 'unread' \n      ? notifications.filter(n => !n.read) \n      : notifications;\n\n    const unreadCount = notifications.filter(n => !n.read).length;\n\n    content.innerHTML = `\n      <div class=\"notifications-header\">\n        <div class=\"filter-tabs\">\n          <button class=\"filter-tab ${filter === 'all' ? 'active' : ''}\" data-filter=\"all\">\n            All (${notifications.length})\n          </button>\n          <button class=\"filter-tab ${filter === 'unread' ? 'active' : ''}\" data-filter=\"unread\">\n            Unread (${unreadCount})\n          </button>\n        </div>\n      </div>\n      \n      ${filtered.length === 0 ? `\n        <div class=\"empty-state\">\n          <span class=\"empty-icon\"></span>\n          <p>${filter === 'unread' ? 'No unread notifications' : 'No notifications yet'}</p>\n        </div>\n      ` : `\n        <div class=\"notifications-list\">\n          ${filtered.map(n => renderNotification(n)).join('')}\n        </div>\n      `}\n    `;\n\n    // Bind filter tabs\n    content.querySelectorAll('.filter-tab').forEach(tab => {\n      on(tab as HTMLElement, 'click', () => {\n        filter = tab.getAttribute('data-filter') as 'all' | 'unread';\n        render();\n      });\n    });\n\n    // Bind notification clicks\n    content.querySelectorAll('.notification-item').forEach(item => {\n      const id = item.getAttribute('data-notification-id');\n      const notification = notifications.find(n => n.id === id);\n      \n      if (notification) {\n        on(item as HTMLElement, 'click', async () => {\n          // Mark as read\n          if (!notification.read) {\n            try {\n              await http.patch(`/api/notifications/${id}/read`);\n              notification.read = true;\n              removeClass(item as HTMLElement, 'unread');\n            } catch {\n              // Silent fail\n            }\n          }\n\n          props.onNotificationClick?.(notification);\n\n          // Navigate if link exists\n          if (notification.link) {\n            closeModal(MODAL_ID);\n            // Handle navigation\n          }\n        });\n      }\n    });\n  }\n}\n\n/**\n * Render single notification\n */\nfunction renderNotification(notification: Notification): string {\n  const icon = getNotificationIcon(notification.type);\n\n  return `\n    <div class=\"notification-item ${notification.read ? '' : 'unread'}\" \n         data-notification-id=\"${notification.id}\">\n      <div class=\"notification-icon ${notification.type}\">${icon}</div>\n      <div class=\"notification-content\">\n        <div class=\"notification-title\">${escapeHtml(notification.title)}</div>\n        <div class=\"notification-message\">${escapeHtml(notification.message)}</div>\n        <div class=\"notification-meta\">\n          ${notification.actor ? `<span class=\"notification-actor\">${escapeHtml(notification.actor.name)}</span>  ` : ''}\n          <span class=\"notification-time\">${formatRelativeTime(notification.createdAt)}</span>\n        </div>\n      </div>\n      ${!notification.read ? '<div class=\"notification-dot\"></div>' : ''}\n    </div>\n  `;\n}\n\n/**\n * Get icon for notification type\n */\nfunction getNotificationIcon(type: Notification['type']): string {\n  switch (type) {\n    case 'info': return '';\n    case 'success': return '';\n    case 'warning': return '';\n    case 'error': return '';\n    case 'mention': return '';\n    case 'update': return '';\n    default: return '';\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showNotificationsModal;\n","/**\n * Email Modal Component\n * View and compose emails\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nconst MODAL_ID = 'email-modal';\n\nexport interface Email {\n  id: string;\n  from: { name: string; email: string };\n  to: Array<{ name: string; email: string }>;\n  cc?: Array<{ name: string; email: string }>;\n  subject: string;\n  body: string;\n  bodyHtml?: string;\n  date: string;\n  read: boolean;\n  attachments?: Array<{ name: string; size: number; type: string }>;\n  thread?: Email[];\n}\n\nexport interface EmailModalProps {\n  mode: 'view' | 'compose' | 'reply';\n  email?: Email;\n  onSend?: (email: Partial<Email>) => Promise<void>;\n}\n\n/**\n * Show email modal\n */\nexport function showEmailModal(props: EmailModalProps): void {\n  const { mode, email, onSend } = props;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'email-modal-content' });\n\n  if (mode === 'view' && email) {\n    content.innerHTML = `\n      <div class=\"email-view\">\n        <div class=\"email-header\">\n          <div class=\"email-subject\">${escapeHtml(email.subject)}</div>\n          <div class=\"email-meta\">\n            <div class=\"email-from\">\n              <strong>${escapeHtml(email.from.name)}</strong>\n              <span class=\"text-muted\">&lt;${escapeHtml(email.from.email)}&gt;</span>\n            </div>\n            <div class=\"email-to\">\n              To: ${email.to.map(r => escapeHtml(r.name || r.email)).join(', ')}\n            </div>\n            ${email.cc?.length ? `\n              <div class=\"email-cc\">\n                Cc: ${email.cc.map(r => escapeHtml(r.name || r.email)).join(', ')}\n              </div>\n            ` : ''}\n            <div class=\"email-date\">${formatRelativeTime(email.date)}</div>\n          </div>\n        </div>\n        \n        <div class=\"email-body\">\n          ${email.bodyHtml || escapeHtml(email.body).replace(/\\n/g, '<br>')}\n        </div>\n        \n        ${email.attachments?.length ? `\n          <div class=\"email-attachments\">\n            <h4>Attachments (${email.attachments.length})</h4>\n            <div class=\"attachments-list\">\n              ${email.attachments.map(a => `\n                <div class=\"attachment-item\">\n                  <span class=\"attachment-icon\"></span>\n                  <span class=\"attachment-name\">${escapeHtml(a.name)}</span>\n                  <span class=\"attachment-size\">${formatBytes(a.size)}</span>\n                </div>\n              `).join('')}\n            </div>\n          </div>\n        ` : ''}\n        \n        ${email.thread?.length ? `\n          <div class=\"email-thread\">\n            <h4>Thread (${email.thread.length} messages)</h4>\n            ${email.thread.map(t => `\n              <div class=\"thread-message\">\n                <div class=\"thread-header\">\n                  <strong>${escapeHtml(t.from.name)}</strong>\n                  <span>${formatRelativeTime(t.date)}</span>\n                </div>\n                <div class=\"thread-preview\">${escapeHtml(t.body.slice(0, 100))}...</div>\n              </div>\n            `).join('')}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  } else {\n    // Compose / Reply mode\n    const isReply = mode === 'reply' && email;\n    const replyTo = isReply ? email.from.email : '';\n    const replySubject = isReply ? `Re: ${email.subject}` : '';\n\n    content.innerHTML = `\n      <form id=\"email-form\" class=\"email-form\">\n        <div class=\"form-group\">\n          <label for=\"email-to\">To *</label>\n          <input type=\"text\" id=\"email-to\" required \n                 value=\"${replyTo}\" \n                 placeholder=\"recipient@example.com\">\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"email-cc\">Cc</label>\n          <input type=\"text\" id=\"email-cc\" \n                 placeholder=\"cc@example.com\">\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"email-subject\">Subject *</label>\n          <input type=\"text\" id=\"email-subject\" required \n                 value=\"${escapeHtml(replySubject)}\" \n                 placeholder=\"Email subject\">\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"email-body\">Message *</label>\n          <textarea id=\"email-body\" rows=\"10\" required \n                    placeholder=\"Write your message...\">${isReply ? `\\n\\n---\\nOn ${email.date}, ${email.from.name} wrote:\\n${email.body}` : ''}</textarea>\n        </div>\n        \n        <div class=\"form-group\">\n          <label>Attachments</label>\n          <div class=\"attachment-dropzone\" id=\"attachment-zone\">\n            <span>Drop files here or click to attach</span>\n            <input type=\"file\" id=\"attachment-input\" multiple hidden>\n          </div>\n          <div id=\"attachments-preview\"></div>\n        </div>\n      </form>\n    `;\n\n    // Bind attachment zone\n    setTimeout(() => {\n      const zone = content.querySelector('#attachment-zone') as HTMLElement;\n      const input = content.querySelector('#attachment-input') as HTMLInputElement;\n\n      if (zone && input) {\n        on(zone, 'click', () => input.click());\n        on(input, 'change', () => {\n          // Handle file selection\n          if (input.files) {\n            const preview = content.querySelector('#attachments-preview') as HTMLElement;\n            preview.innerHTML = Array.from(input.files)\n              .map(f => `<div class=\"attachment-item\">${escapeHtml(f.name)}</div>`)\n              .join('');\n          }\n        });\n      }\n    }, 0);\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  if (mode === 'view') {\n    const replyBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Reply',\n    });\n\n    const forwardBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Forward',\n    });\n\n    const closeBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Close',\n    });\n\n    on(replyBtn, 'click', () => {\n      closeModal(MODAL_ID);\n      showEmailModal({ ...props, mode: 'reply' });\n    });\n\n    on(forwardBtn, 'click', () => {\n      // Forward logic\n      toast.info('Forward not implemented');\n    });\n\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n\n    footer.appendChild(closeBtn);\n    footer.appendChild(forwardBtn);\n    footer.appendChild(replyBtn);\n  } else {\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const sendBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Send',\n    });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n    on(sendBtn, 'click', async () => {\n      const form = content.querySelector('#email-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const to = (content.querySelector('#email-to') as HTMLInputElement).value;\n      const cc = (content.querySelector('#email-cc') as HTMLInputElement).value;\n      const subject = (content.querySelector('#email-subject') as HTMLInputElement).value;\n      const body = (content.querySelector('#email-body') as HTMLTextAreaElement).value;\n\n      const emailData: Partial<Email> = {\n        to: to.split(',').map(e => ({ name: '', email: e.trim() })),\n        cc: cc ? cc.split(',').map(e => ({ name: '', email: e.trim() })) : undefined,\n        subject,\n        body,\n      };\n\n      sendBtn.disabled = true;\n      sendBtn.textContent = 'Sending...';\n\n      try {\n        if (onSend) {\n          await onSend(emailData);\n        } else {\n          await http.post('/api/emails/send', emailData);\n        }\n        toast.success('Email sent');\n        closeModal(MODAL_ID);\n      } catch {\n        // Error shown by API service\n      } finally {\n        sendBtn.disabled = false;\n        sendBtn.textContent = 'Send';\n      }\n    });\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(sendBtn);\n  }\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: mode === 'view' ? 'Email' : (mode === 'reply' ? 'Reply' : 'Compose Email'),\n    content,\n    size: 'lg',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Format bytes\n */\nfunction formatBytes(bytes: number): string {\n  if (bytes === 0) return '0 B';\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showEmailModal;\n","/**\n * Charts Store\n * Chart instances and visualization state\n */\n\nimport type { Chart } from 'chart.js';\n\n// Types\nexport interface ChartInstance {\n  id: string;\n  chart: Chart | null;\n  container: string;\n  type: 'bar' | 'line' | 'pie' | 'doughnut' | 'radar';\n}\n\nexport interface NetworkInstance {\n  id: string;\n  network: unknown | null;\n  container: string;\n}\n\nexport interface ChartsState {\n  charts: Map<string, ChartInstance>;\n  networks: Map<string, NetworkInstance>;\n  activeChart: string | null;\n}\n\n// State\nconst state: ChartsState = {\n  charts: new Map(),\n  networks: new Map(),\n  activeChart: null,\n};\n\n// Listeners\nconst listeners: Set<() => void> = new Set();\n\n/**\n * Notify listeners\n */\nfunction notify(): void {\n  listeners.forEach(fn => fn());\n}\n\n/**\n * Register a chart instance\n */\nexport function registerChart(id: string, chart: Chart, container: string, type: ChartInstance['type']): void {\n  state.charts.set(id, { id, chart, container, type });\n  notify();\n}\n\n/**\n * Get a chart instance\n */\nexport function getChart(id: string): Chart | null {\n  return state.charts.get(id)?.chart ?? null;\n}\n\n/**\n * Destroy and remove a chart\n */\nexport function destroyChart(id: string): void {\n  const instance = state.charts.get(id);\n  if (instance?.chart) {\n    instance.chart.destroy();\n  }\n  state.charts.delete(id);\n  notify();\n}\n\n/**\n * Update chart data\n */\nexport function updateChartData(id: string, data: unknown): void {\n  const instance = state.charts.get(id);\n  if (instance?.chart) {\n    instance.chart.data = data as Chart['data'];\n    instance.chart.update();\n  }\n}\n\n/**\n * Register a network visualization\n */\nexport function registerNetwork(id: string, network: unknown, container: string): void {\n  state.networks.set(id, { id, network, container });\n  notify();\n}\n\n/**\n * Get a network instance\n */\nexport function getNetwork(id: string): unknown | null {\n  return state.networks.get(id)?.network ?? null;\n}\n\n/**\n * Destroy and remove a network\n */\nexport function destroyNetwork(id: string): void {\n  const instance = state.networks.get(id);\n  if (instance?.network && typeof (instance.network as { destroy?: () => void }).destroy === 'function') {\n    (instance.network as { destroy: () => void }).destroy();\n  }\n  state.networks.delete(id);\n  notify();\n}\n\n/**\n * Set active chart for highlighting\n */\nexport function setActiveChart(id: string | null): void {\n  state.activeChart = id;\n  notify();\n}\n\n/**\n * Get all chart IDs\n */\nexport function getChartIds(): string[] {\n  return Array.from(state.charts.keys());\n}\n\n/**\n * Get all network IDs\n */\nexport function getNetworkIds(): string[] {\n  return Array.from(state.networks.keys());\n}\n\n/**\n * Destroy all charts and networks\n */\nexport function destroyAll(): void {\n  state.charts.forEach((instance) => {\n    if (instance.chart) {\n      instance.chart.destroy();\n    }\n  });\n  state.networks.forEach((instance) => {\n    if (instance.network && typeof (instance.network as { destroy?: () => void }).destroy === 'function') {\n      (instance.network as { destroy: () => void }).destroy();\n    }\n  });\n  state.charts.clear();\n  state.networks.clear();\n  state.activeChart = null;\n  notify();\n}\n\n/**\n * Subscribe to changes\n */\nexport function subscribe(callback: () => void): () => void {\n  listeners.add(callback);\n  return () => listeners.delete(callback);\n}\n\n// Export as namespace\nexport const chartsStore = {\n  registerChart,\n  getChart,\n  destroyChart,\n  updateChartData,\n  registerNetwork,\n  getNetwork,\n  destroyNetwork,\n  setActiveChart,\n  getChartIds,\n  getNetworkIds,\n  destroyAll,\n  subscribe,\n};\n","/**\n * Graph Modal Component\n * Display graph/network visualizations\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { chartsStore } from '../../stores/charts';\n\nconst MODAL_ID = 'graph-modal';\n\nexport interface GraphNode {\n  id: string;\n  label: string;\n  type?: string;\n  color?: string;\n  size?: number;\n  data?: Record<string, unknown>;\n}\n\nexport interface GraphEdge {\n  id: string;\n  from: string;\n  to: string;\n  label?: string;\n  type?: string;\n  color?: string;\n}\n\nexport interface GraphModalProps {\n  title?: string;\n  nodes: GraphNode[];\n  edges: GraphEdge[];\n  onNodeClick?: (node: GraphNode) => void;\n  onEdgeClick?: (edge: GraphEdge) => void;\n}\n\n/**\n * Show graph modal\n */\nexport function showGraphModal(props: GraphModalProps): void {\n  const { title = 'Graph View', nodes, edges, onNodeClick, onEdgeClick } = props;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'graph-modal-content' });\n\n  content.innerHTML = `\n    <div class=\"graph-toolbar\">\n      <div class=\"graph-info\">\n        <span>Nodes: ${nodes.length}</span>\n        <span>Edges: ${edges.length}</span>\n      </div>\n      <div class=\"graph-controls\">\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"zoom-in\" title=\"Zoom In\">+</button>\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"zoom-out\" title=\"Zoom Out\"></button>\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"fit\" title=\"Fit to View\"></button>\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"fullscreen\" title=\"Fullscreen\"></button>\n      </div>\n    </div>\n    <div id=\"graph-container\" class=\"graph-container\">\n      <div class=\"graph-placeholder\">\n        <p>Loading graph visualization...</p>\n        <p class=\"text-muted\">Requires vis-network library</p>\n      </div>\n    </div>\n    <div class=\"graph-legend\">\n      ${getUniqueTypes(nodes).map(type => `\n        <span class=\"legend-item\">\n          <span class=\"legend-color\" style=\"background: ${getTypeColor(type)}\"></span>\n          ${type}\n        </span>\n      `).join('')}\n    </div>\n  `;\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const exportBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Export Image',\n  });\n\n  const closeBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Close',\n  });\n\n  on(exportBtn, 'click', () => {\n    // Export graph as image\n    const canvas = content.querySelector('canvas') as HTMLCanvasElement;\n    if (canvas) {\n      const link = document.createElement('a');\n      link.download = 'graph.png';\n      link.href = canvas.toDataURL();\n      link.click();\n    } else {\n      toast.warning('Graph not rendered');\n    }\n  });\n\n  on(closeBtn, 'click', () => {\n    // Destroy network before closing\n    chartsStore.destroyNetwork('modal-graph');\n    closeModal(MODAL_ID);\n  });\n\n  footer.appendChild(exportBtn);\n  footer.appendChild(closeBtn);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title,\n    content,\n    size: 'xl',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Initialize graph after modal is visible\n  setTimeout(() => {\n    initializeGraph(content, nodes, edges, onNodeClick, onEdgeClick);\n    bindControls(content);\n  }, 100);\n}\n\n/**\n * Initialize graph visualization\n */\nfunction initializeGraph(\n  container: HTMLElement,\n  nodes: GraphNode[],\n  edges: GraphEdge[],\n  onNodeClick?: (node: GraphNode) => void,\n  onEdgeClick?: (edge: GraphEdge) => void\n): void {\n  const graphContainer = container.querySelector('#graph-container') as HTMLElement;\n  \n  // Check if vis-network is available\n  if (typeof (window as unknown as { vis?: unknown }).vis === 'undefined') {\n    graphContainer.innerHTML = `\n      <div class=\"graph-fallback\">\n        <h4>Graph Data</h4>\n        <div class=\"graph-data\">\n          <strong>Nodes (${nodes.length}):</strong>\n          <ul>${nodes.slice(0, 10).map(n => `<li>${n.label} (${n.type || 'default'})</li>`).join('')}</ul>\n          ${nodes.length > 10 ? `<p class=\"text-muted\">...and ${nodes.length - 10} more</p>` : ''}\n        </div>\n        <div class=\"graph-data\">\n          <strong>Edges (${edges.length}):</strong>\n          <ul>${edges.slice(0, 10).map(e => `<li>${e.from}  ${e.to}${e.label ? ` (${e.label})` : ''}</li>`).join('')}</ul>\n          ${edges.length > 10 ? `<p class=\"text-muted\">...and ${edges.length - 10} more</p>` : ''}\n        </div>\n        <p class=\"text-muted\"><em>vis-network library not loaded</em></p>\n      </div>\n    `;\n    return;\n  }\n\n  const vis = (window as unknown as { vis: typeof import('vis-network') }).vis;\n\n  // Prepare data\n  const visNodes = new vis.DataSet(\n    nodes.map(n => ({\n      id: n.id,\n      label: n.label,\n      color: n.color || getTypeColor(n.type),\n      size: n.size || 20,\n    }))\n  );\n\n  const visEdges = new vis.DataSet(\n    edges.map(e => ({\n      id: e.id,\n      from: e.from,\n      to: e.to,\n      label: e.label,\n      color: e.color,\n    }))\n  );\n\n  const options = {\n    nodes: {\n      shape: 'dot',\n      font: { color: '#eaeaea', size: 12 },\n      borderWidth: 2,\n    },\n    edges: {\n      arrows: 'to',\n      color: { color: '#2a2a4a', highlight: '#e94560' },\n      font: { color: '#a0a0a0', size: 10 },\n    },\n    physics: {\n      enabled: true,\n      stabilization: { iterations: 100 },\n    },\n    interaction: {\n      hover: true,\n      tooltipDelay: 200,\n    },\n  };\n\n  graphContainer.innerHTML = '';\n  const network = new vis.Network(graphContainer, { nodes: visNodes, edges: visEdges }, options);\n\n  // Store reference\n  chartsStore.registerNetwork('modal-graph', network, '#graph-container');\n\n  // Bind events\n  if (onNodeClick) {\n    network.on('click', (params: { nodes: string[] }) => {\n      if (params.nodes.length > 0) {\n        const node = nodes.find(n => n.id === params.nodes[0]);\n        if (node) onNodeClick(node);\n      }\n    });\n  }\n\n  if (onEdgeClick) {\n    network.on('click', (params: { edges: string[] }) => {\n      if (params.edges.length > 0) {\n        const edge = edges.find(e => e.id === params.edges[0]);\n        if (edge) onEdgeClick(edge);\n      }\n    });\n  }\n}\n\n/**\n * Bind control buttons\n */\nfunction bindControls(container: HTMLElement): void {\n  const network = chartsStore.getNetwork('modal-graph') as { \n    moveTo?: (options: object) => void;\n    fit?: () => void;\n  } | null;\n  \n  if (!network) return;\n\n  container.querySelectorAll('[data-action]').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const action = btn.getAttribute('data-action');\n      \n      switch (action) {\n        case 'zoom-in':\n          network.moveTo?.({ scale: 1.2 });\n          break;\n        case 'zoom-out':\n          network.moveTo?.({ scale: 0.8 });\n          break;\n        case 'fit':\n          network.fit?.();\n          break;\n        case 'fullscreen':\n          const graphContainer = container.querySelector('.graph-container') as HTMLElement;\n          if (graphContainer) {\n            graphContainer.requestFullscreen?.();\n          }\n          break;\n      }\n    });\n  });\n}\n\n/**\n * Get unique node types\n */\nfunction getUniqueTypes(nodes: GraphNode[]): string[] {\n  const types = new Set(nodes.map(n => n.type || 'default'));\n  return Array.from(types);\n}\n\n/**\n * Get color for type\n */\nfunction getTypeColor(type?: string): string {\n  const colors: Record<string, string> = {\n    person: '#4ecdc4',\n    organization: '#e94560',\n    document: '#ffe66d',\n    event: '#ff6b6b',\n    location: '#45b7d1',\n    default: '#a0a0a0',\n  };\n  return colors[type || 'default'] || colors.default;\n}\n\n// Toast import for export feedback\nimport { toast } from '../../services/toast';\n\nexport default showGraphModal;\n","/**\n * History Modal Component\n * Display change history / audit log\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { http } from '../../services/api';\nimport { formatRelativeTime } from '../../utils/format';\n\nconst MODAL_ID = 'history-modal';\n\nexport interface HistoryEntry {\n  id: string;\n  action: 'create' | 'update' | 'delete' | 'restore';\n  entityType: string;\n  entityId: string;\n  entityName?: string;\n  changes?: Record<string, { old: unknown; new: unknown }>;\n  actor: {\n    id: string;\n    name: string;\n    email?: string;\n  };\n  timestamp: string;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface HistoryModalProps {\n  entityType?: string;\n  entityId?: string;\n  title?: string;\n  onRestore?: (entry: HistoryEntry) => void;\n}\n\nlet entries: HistoryEntry[] = [];\nlet page = 1;\nlet hasMore = true;\nlet loading = false;\n\n/**\n * Show history modal\n */\nexport async function showHistoryModal(props: HistoryModalProps = {}): Promise<void> {\n  const { entityType, entityId, title = 'History', onRestore } = props;\n\n  entries = [];\n  page = 1;\n  hasMore = true;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'history-modal-content' });\n  content.innerHTML = '<div class=\"loading\">Loading history...</div>';\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const closeBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Close',\n  });\n\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\n  footer.appendChild(closeBtn);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title,\n    content,\n    size: 'lg',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Load initial data\n  await loadHistory(content, entityType, entityId, onRestore);\n}\n\n/**\n * Load history entries\n */\nasync function loadHistory(\n  container: HTMLElement,\n  entityType?: string,\n  entityId?: string,\n  onRestore?: (entry: HistoryEntry) => void\n): Promise<void> {\n  if (loading || !hasMore) return;\n\n  loading = true;\n\n  try {\n    const params = new URLSearchParams({ page: String(page), limit: '20' });\n    if (entityType) params.set('entityType', entityType);\n    if (entityId) params.set('entityId', entityId);\n\n    const response = await http.get<{ entries: HistoryEntry[]; hasMore: boolean }>(\n      `/api/history?${params}`\n    );\n\n    entries = [...entries, ...response.data.entries];\n    hasMore = response.data.hasMore;\n    page++;\n\n    render(container, onRestore);\n  } catch {\n    container.innerHTML = '<div class=\"error\">Failed to load history</div>';\n  } finally {\n    loading = false;\n  }\n}\n\n/**\n * Render history\n */\nfunction render(container: HTMLElement, onRestore?: (entry: HistoryEntry) => void): void {\n  if (entries.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <span class=\"empty-icon\"></span>\n        <p>No history entries</p>\n      </div>\n    `;\n    return;\n  }\n\n  // Group by date\n  const grouped = groupByDate(entries);\n\n  container.innerHTML = `\n    <div class=\"history-timeline\">\n      ${Object.entries(grouped).map(([date, items]) => `\n        <div class=\"history-date-group\">\n          <div class=\"history-date\">${date}</div>\n          ${items.map(entry => renderEntry(entry)).join('')}\n        </div>\n      `).join('')}\n    </div>\n    ${hasMore ? `\n      <div class=\"history-load-more\">\n        <button class=\"btn btn-secondary\" data-action=\"load-more\">Load More</button>\n      </div>\n    ` : ''}\n  `;\n\n  // Bind load more\n  const loadMoreBtn = container.querySelector('[data-action=\"load-more\"]');\n  if (loadMoreBtn) {\n    on(loadMoreBtn as HTMLElement, 'click', async () => {\n      await loadHistory(container, undefined, undefined, onRestore);\n    });\n  }\n\n  // Bind restore buttons\n  if (onRestore) {\n    container.querySelectorAll('[data-action=\"restore\"]').forEach(btn => {\n      on(btn as HTMLElement, 'click', async () => {\n        const entryId = btn.getAttribute('data-entry-id');\n        const entry = entries.find(e => e.id === entryId);\n        if (entry) {\n          const { confirm } = await import('../Modal');\n          const confirmed = await confirm(\n            'Are you sure you want to restore this version?',\n            { title: 'Restore', confirmText: 'Restore' }\n          );\n          if (confirmed) {\n            onRestore(entry);\n          }\n        }\n      });\n    });\n  }\n\n  // Bind expand buttons\n  container.querySelectorAll('[data-action=\"expand\"]').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const changesEl = btn.closest('.history-entry')?.querySelector('.history-changes');\n      if (changesEl) {\n        changesEl.classList.toggle('expanded');\n        btn.textContent = changesEl.classList.contains('expanded') ? 'Hide details' : 'Show details';\n      }\n    });\n  });\n}\n\n/**\n * Render single entry\n */\nfunction renderEntry(entry: HistoryEntry): string {\n  const actionIcons: Record<string, string> = {\n    create: '',\n    update: '',\n    delete: '',\n    restore: '',\n  };\n\n  const actionColors: Record<string, string> = {\n    create: 'success',\n    update: 'info',\n    delete: 'danger',\n    restore: 'warning',\n  };\n\n  const hasChanges = entry.changes && Object.keys(entry.changes).length > 0;\n\n  return `\n    <div class=\"history-entry ${actionColors[entry.action]}\" data-entry-id=\"${entry.id}\">\n      <div class=\"history-icon\">${actionIcons[entry.action]}</div>\n      <div class=\"history-content\">\n        <div class=\"history-summary\">\n          <strong>${entry.actor.name}</strong>\n          ${entry.action}d\n          <span class=\"entity-type\">${entry.entityType}</span>\n          ${entry.entityName ? `\"${escapeHtml(entry.entityName)}\"` : ''}\n        </div>\n        <div class=\"history-time\">${formatRelativeTime(entry.timestamp)}</div>\n        \n        ${hasChanges ? `\n          <div class=\"history-changes\">\n            ${Object.entries(entry.changes!).map(([field, change]) => `\n              <div class=\"change-item\">\n                <span class=\"change-field\">${field}:</span>\n                <span class=\"change-old\">${formatValue(change.old)}</span>\n                <span class=\"change-arrow\"></span>\n                <span class=\"change-new\">${formatValue(change.new)}</span>\n              </div>\n            `).join('')}\n          </div>\n          <button class=\"btn-link\" data-action=\"expand\">Show details</button>\n        ` : ''}\n        \n        ${entry.action === 'delete' ? `\n          <button class=\"btn btn-sm btn-secondary\" data-action=\"restore\" data-entry-id=\"${entry.id}\">\n            Restore\n          </button>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Group entries by date\n */\nfunction groupByDate(items: HistoryEntry[]): Record<string, HistoryEntry[]> {\n  const groups: Record<string, HistoryEntry[]> = {};\n\n  items.forEach(item => {\n    const date = new Date(item.timestamp).toLocaleDateString();\n    if (!groups[date]) {\n      groups[date] = [];\n    }\n    groups[date].push(item);\n  });\n\n  return groups;\n}\n\n/**\n * Format value for display\n */\nfunction formatValue(value: unknown): string {\n  if (value === null || value === undefined) return '(empty)';\n  if (typeof value === 'object') return JSON.stringify(value);\n  return String(value);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showHistoryModal;\n","/**\n * Comment Modal Component\n * Add and view comments on entities\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { appStore } from '../../stores/app';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nconst MODAL_ID = 'comment-modal';\n\nexport interface Comment {\n  id: string;\n  content: string;\n  author: {\n    id: string;\n    name: string;\n    email?: string;\n    avatar?: string;\n  };\n  createdAt: string;\n  updatedAt?: string;\n  edited?: boolean;\n  replies?: Comment[];\n}\n\nexport interface CommentModalProps {\n  entityType: string;\n  entityId: string;\n  entityName?: string;\n  onCommentAdded?: (comment: Comment) => void;\n}\n\nlet comments: Comment[] = [];\n\n/**\n * Show comment modal\n */\nexport async function showCommentModal(props: CommentModalProps): Promise<void> {\n  const { entityType, entityId, entityName, onCommentAdded } = props;\n\n  comments = [];\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'comment-modal-content' });\n  content.innerHTML = '<div class=\"loading\">Loading comments...</div>';\n\n  // Footer with comment input\n  const footer = createElement('div', { className: 'modal-footer comment-footer' });\n  footer.innerHTML = `\n    <div class=\"comment-input-wrapper\">\n      <textarea id=\"comment-input\" placeholder=\"Write a comment...\" rows=\"2\"></textarea>\n      <button id=\"submit-comment\" class=\"btn btn-primary\">Post</button>\n    </div>\n  `;\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: entityName ? `Comments on \"${entityName}\"` : 'Comments',\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Bind submit\n  const submitBtn = footer.querySelector('#submit-comment') as HTMLButtonElement;\n  const input = footer.querySelector('#comment-input') as HTMLTextAreaElement;\n\n  on(submitBtn, 'click', async () => {\n    const text = input.value.trim();\n    if (!text) {\n      toast.warning('Please write a comment');\n      return;\n    }\n\n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Posting...';\n\n    try {\n      const response = await http.post<Comment>(`/api/${entityType}/${entityId}/comments`, {\n        content: text,\n      });\n\n      comments.unshift(response.data);\n      input.value = '';\n      render(content, props);\n      onCommentAdded?.(response.data);\n      toast.success('Comment added');\n    } catch {\n      // Error shown by API service\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Post';\n    }\n  });\n\n  // Ctrl+Enter to submit\n  on(input, 'keydown', (e) => {\n    if (e.key === 'Enter' && e.ctrlKey) {\n      submitBtn.click();\n    }\n  });\n\n  // Load comments\n  try {\n    const response = await http.get<Comment[]>(`/api/${entityType}/${entityId}/comments`);\n    comments = response.data;\n    render(content, props);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load comments</div>';\n  }\n}\n\n/**\n * Render comments\n */\nfunction render(container: HTMLElement, props: CommentModalProps): void {\n  if (comments.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <span class=\"empty-icon\"></span>\n        <p>No comments yet</p>\n        <p class=\"text-muted\">Be the first to comment!</p>\n      </div>\n    `;\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"comments-list\">\n      ${comments.map(c => renderComment(c, props)).join('')}\n    </div>\n  `;\n\n  // Bind actions\n  bindCommentActions(container, props);\n}\n\n/**\n * Render single comment\n */\nfunction renderComment(comment: Comment, props: CommentModalProps, depth = 0): string {\n  const currentUser = appStore.getState().currentUser;\n  const isAuthor = currentUser?.id === comment.author.id;\n  const initials = comment.author.name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n\n  return `\n    <div class=\"comment ${depth > 0 ? 'reply' : ''}\" data-comment-id=\"${comment.id}\" style=\"margin-left: ${depth * 20}px\">\n      <div class=\"comment-avatar\">\n        ${comment.author.avatar \n          ? `<img src=\"${comment.author.avatar}\" alt=\"${escapeHtml(comment.author.name)}\">`\n          : initials\n        }\n      </div>\n      <div class=\"comment-body\">\n        <div class=\"comment-header\">\n          <strong class=\"comment-author\">${escapeHtml(comment.author.name)}</strong>\n          <span class=\"comment-time\">${formatRelativeTime(comment.createdAt)}</span>\n          ${comment.edited ? '<span class=\"comment-edited\">(edited)</span>' : ''}\n        </div>\n        <div class=\"comment-content\">${escapeHtml(comment.content)}</div>\n        <div class=\"comment-actions\">\n          <button class=\"btn-link\" data-action=\"reply\" data-comment-id=\"${comment.id}\">Reply</button>\n          ${isAuthor ? `\n            <button class=\"btn-link\" data-action=\"edit\" data-comment-id=\"${comment.id}\">Edit</button>\n            <button class=\"btn-link text-danger\" data-action=\"delete\" data-comment-id=\"${comment.id}\">Delete</button>\n          ` : ''}\n        </div>\n      </div>\n    </div>\n    ${comment.replies?.map(r => renderComment(r, props, depth + 1)).join('') || ''}\n  `;\n}\n\n/**\n * Bind comment action handlers\n */\nfunction bindCommentActions(container: HTMLElement, props: CommentModalProps): void {\n  container.querySelectorAll('[data-action]').forEach(btn => {\n    const action = btn.getAttribute('data-action');\n    const commentId = btn.getAttribute('data-comment-id');\n\n    on(btn as HTMLElement, 'click', async () => {\n      const comment = findComment(comments, commentId!);\n      if (!comment) return;\n\n      switch (action) {\n        case 'reply':\n          // Show reply input\n          const replyContainer = btn.closest('.comment')?.querySelector('.comment-body');\n          if (replyContainer && !replyContainer.querySelector('.reply-input')) {\n            const replyInput = createElement('div', { className: 'reply-input' });\n            replyInput.innerHTML = `\n              <textarea placeholder=\"Write a reply...\" rows=\"2\"></textarea>\n              <div class=\"reply-actions\">\n                <button class=\"btn btn-sm btn-secondary cancel-reply\">Cancel</button>\n                <button class=\"btn btn-sm btn-primary submit-reply\">Reply</button>\n              </div>\n            `;\n\n            replyContainer.appendChild(replyInput);\n\n            const cancelBtn = replyInput.querySelector('.cancel-reply');\n            const submitBtn = replyInput.querySelector('.submit-reply');\n            const textarea = replyInput.querySelector('textarea') as HTMLTextAreaElement;\n\n            on(cancelBtn as HTMLElement, 'click', () => replyInput.remove());\n            on(submitBtn as HTMLElement, 'click', async () => {\n              const text = textarea.value.trim();\n              if (!text) return;\n\n              try {\n                const response = await http.post<Comment>(\n                  `/api/${props.entityType}/${props.entityId}/comments/${commentId}/replies`,\n                  { content: text }\n                );\n\n                if (!comment.replies) comment.replies = [];\n                comment.replies.push(response.data);\n                render(container, props);\n              } catch {\n                // Error shown by API service\n              }\n            });\n\n            textarea.focus();\n          }\n          break;\n\n        case 'edit':\n          // Inline edit\n          const contentEl = btn.closest('.comment')?.querySelector('.comment-content');\n          if (contentEl) {\n            const originalText = comment.content;\n            contentEl.innerHTML = `\n              <textarea class=\"edit-textarea\">${escapeHtml(originalText)}</textarea>\n              <div class=\"edit-actions\">\n                <button class=\"btn btn-sm btn-secondary cancel-edit\">Cancel</button>\n                <button class=\"btn btn-sm btn-primary save-edit\">Save</button>\n              </div>\n            `;\n\n            const textarea = contentEl.querySelector('textarea') as HTMLTextAreaElement;\n            const cancelBtn = contentEl.querySelector('.cancel-edit');\n            const saveBtn = contentEl.querySelector('.save-edit');\n\n            on(cancelBtn as HTMLElement, 'click', () => {\n              contentEl.textContent = originalText;\n            });\n\n            on(saveBtn as HTMLElement, 'click', async () => {\n              const newText = textarea.value.trim();\n              if (!newText) return;\n\n              try {\n                await http.patch(\n                  `/api/${props.entityType}/${props.entityId}/comments/${commentId}`,\n                  { content: newText }\n                );\n                comment.content = newText;\n                comment.edited = true;\n                render(container, props);\n              } catch {\n                // Error shown by API service\n              }\n            });\n\n            textarea.focus();\n          }\n          break;\n\n        case 'delete':\n          const { confirm } = await import('../Modal');\n          const confirmed = await confirm('Delete this comment?', {\n            title: 'Delete Comment',\n            confirmText: 'Delete',\n            confirmClass: 'btn-danger',\n          });\n\n          if (confirmed) {\n            try {\n              await http.delete(\n                `/api/${props.entityType}/${props.entityId}/comments/${commentId}`\n              );\n              removeComment(comments, commentId!);\n              render(container, props);\n              toast.success('Comment deleted');\n            } catch {\n              // Error shown by API service\n            }\n          }\n          break;\n      }\n    });\n  });\n}\n\n/**\n * Find comment by ID (recursive)\n */\nfunction findComment(list: Comment[], id: string): Comment | undefined {\n  for (const comment of list) {\n    if (comment.id === id) return comment;\n    if (comment.replies) {\n      const found = findComment(comment.replies, id);\n      if (found) return found;\n    }\n  }\n  return undefined;\n}\n\n/**\n * Remove comment by ID (recursive)\n */\nfunction removeComment(list: Comment[], id: string): boolean {\n  const index = list.findIndex(c => c.id === id);\n  if (index !== -1) {\n    list.splice(index, 1);\n    return true;\n  }\n\n  for (const comment of list) {\n    if (comment.replies && removeComment(comment.replies, id)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showCommentModal;\n","/**\n * Profile Modal - SOTA Design\n * View and edit user profile with modern glassmorphism design\n */\n\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { createElement, on } from '../../utils/dom';\nimport { profileService, UserProfile } from '../../services/profile';\nimport { appStore } from '../../stores/app';\nimport { toast } from '../../services/toast';\nimport { http } from '../../services/api';\nimport * as krispService from '../../services/krisp';\n\nconst MODAL_ID = 'profile-modal';\n\ninterface Timezone {\n  code: string;\n  name: string;\n  region?: string;\n  utc_offset: string;\n  abbreviation?: string;\n}\n\nexport interface ProfileModalProps {\n  onClose?: () => void;\n  onUpdate?: (profile: UserProfile) => void;\n}\n\nlet currentProps: ProfileModalProps = {};\nlet currentProfile: UserProfile | null = null;\nlet cachedTimezones: Timezone[] | null = null;\n\n/**\n * Show profile modal\n */\nexport function showProfileModal(props: ProfileModalProps = {}): void {\n  currentProps = props;\n\n  const content = createModalContent();\n  \n  const modal = createModal({\n    id: MODAL_ID,\n    title: '',\n    size: 'lg',\n    content: content,\n    onClose: props.onClose,\n  });\n\n  // Force modal overlay to be centered\n  modal.style.cssText = `\n    position: fixed !important;\n    top: 0 !important;\n    left: 0 !important;\n    right: 0 !important;\n    bottom: 0 !important;\n    width: 100% !important;\n    height: 100% !important;\n    display: flex !important;\n    justify-content: center !important;\n    align-items: center !important;\n    background: rgba(0, 0, 0, 0.75) !important;\n    z-index: 9999 !important;\n    padding: 24px !important;\n    margin: 0 !important;\n  `;\n  \n  // Remove default modal styling for custom design\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\n  if (modalContent) {\n    modalContent.style.cssText = `\n      background: transparent;\n      box-shadow: none;\n      padding: 0;\n      max-width: 720px;\n      width: 95%;\n      margin: 0 !important;\n      position: relative !important;\n    `;\n  }\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\n  if (modalHeader) {\n    modalHeader.style.display = 'none';\n  }\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n  \n  loadProfile(content);\n}\n\n/**\n * Create modal content\n */\nfunction createModalContent(): HTMLElement {\n  const container = createElement('div', { className: 'profile-modal-sota' });\n\n  container.innerHTML = `\n    <style>\n      .profile-modal-sota {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n      \n      .profile-card {\n        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\n        backdrop-filter: blur(20px);\n        border-radius: 24px;\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\n          0 0 0 1px rgba(255, 255, 255, 0.8),\n          inset 0 1px 0 rgba(255, 255, 255, 0.9);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .profile-card {\n        background: linear-gradient(135deg, rgba(30,41,59,0.95) 0%, rgba(15,23,42,0.95) 100%);\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.05);\n      }\n      \n      .profile-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 32px;\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .profile-header::before {\n        content: '';\n        position: absolute;\n        top: -50%;\n        right: -50%;\n        width: 100%;\n        height: 200%;\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\n        pointer-events: none;\n      }\n      \n      .profile-header-content {\n        display: flex;\n        align-items: center;\n        gap: 24px;\n        position: relative;\n        z-index: 1;\n      }\n      \n      .profile-avatar-large {\n        width: 100px;\n        height: 100px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 36px;\n        font-weight: 600;\n        color: white;\n        border: 4px solid rgba(255,255,255,0.3);\n        overflow: hidden;\n        flex-shrink: 0;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        position: relative;\n      }\n      \n      .profile-avatar-large:hover {\n        border-color: rgba(255,255,255,0.5);\n        transform: scale(1.05);\n      }\n      \n      .profile-avatar-large img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .avatar-overlay {\n        position: absolute;\n        inset: 0;\n        background: rgba(0,0,0,0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        opacity: 0;\n        transition: opacity 0.2s;\n        border-radius: 50%;\n      }\n      \n      .profile-avatar-large:hover .avatar-overlay {\n        opacity: 1;\n      }\n      \n      .avatar-overlay svg {\n        width: 28px;\n        height: 28px;\n        color: white;\n      }\n      \n      .profile-user-info h2 {\n        margin: 0 0 4px 0;\n        font-size: 28px;\n        font-weight: 700;\n        color: white;\n      }\n      \n      .profile-user-info .email {\n        color: rgba(255,255,255,0.8);\n        font-size: 14px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .profile-user-info .role-badge {\n        display: inline-flex;\n        align-items: center;\n        gap: 4px;\n        background: rgba(255,255,255,0.2);\n        padding: 4px 10px;\n        border-radius: 20px;\n        font-size: 11px;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n        color: white;\n      }\n      \n      .profile-close-btn {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n        z-index: 10;\n      }\n      \n      .profile-close-btn:hover {\n        background: rgba(255,255,255,0.3);\n        transform: rotate(90deg);\n      }\n      \n      .profile-close-btn svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n      \n      .profile-tabs-nav {\n        display: flex;\n        gap: 0;\n        padding: 0 24px;\n        background: rgba(0,0,0,0.02);\n        border-bottom: 1px solid rgba(0,0,0,0.06);\n      }\n      \n      [data-theme=\"dark\"] .profile-tabs-nav {\n        background: rgba(255,255,255,0.02);\n        border-bottom-color: rgba(255,255,255,0.06);\n      }\n      \n      .profile-tab-btn {\n        padding: 16px 24px;\n        background: transparent;\n        border: none;\n        font-size: 14px;\n        font-weight: 500;\n        color: #64748b;\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n      }\n      \n      .profile-tab-btn:hover {\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .profile-tab-btn:hover {\n        color: #e2e8f0;\n      }\n      \n      .profile-tab-btn.active {\n        color: #e11d48;\n      }\n      \n      .profile-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 24px;\n        right: 24px;\n        height: 2px;\n        background: #e11d48;\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .profile-tab-icon {\n        width: 18px;\n        height: 18px;\n        margin-right: 8px;\n        vertical-align: middle;\n      }\n      \n      .profile-body {\n        padding: 32px;\n      }\n      \n      .profile-section {\n        display: none;\n      }\n      \n      .profile-section.active {\n        display: block;\n      }\n      \n      .form-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 20px;\n      }\n      \n      .form-grid .full-width {\n        grid-column: 1 / -1;\n      }\n      \n      .form-field {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n      }\n      \n      .form-field label {\n        font-size: 13px;\n        font-weight: 600;\n        color: #475569;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n      \n      [data-theme=\"dark\"] .form-field label {\n        color: #94a3b8;\n      }\n      \n      .form-field input,\n      .form-field select,\n      .form-field textarea {\n        padding: 12px 16px;\n        border: 1px solid #e2e8f0;\n        border-radius: 12px;\n        font-size: 14px;\n        background: #f8fafc;\n        color: #1e293b;\n        transition: all 0.2s;\n        outline: none;\n      }\n      \n      [data-theme=\"dark\"] .form-field input,\n      [data-theme=\"dark\"] .form-field select,\n      [data-theme=\"dark\"] .form-field textarea {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .form-field input:focus,\n      .form-field select:focus,\n      .form-field textarea:focus {\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .form-field input:disabled {\n        background: #f1f5f9;\n        color: #94a3b8;\n        cursor: not-allowed;\n      }\n      \n      [data-theme=\"dark\"] .form-field input:disabled {\n        background: rgba(255,255,255,0.02);\n        color: #64748b;\n      }\n      \n      .form-field textarea {\n        resize: vertical;\n        min-height: 100px;\n      }\n      \n      .form-hint {\n        font-size: 12px;\n        color: #94a3b8;\n      }\n      \n      .form-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        margin-top: 24px;\n        padding-top: 24px;\n        border-top: 1px solid rgba(0,0,0,0.06);\n      }\n      \n      [data-theme=\"dark\"] .form-actions {\n        border-top-color: rgba(255,255,255,0.06);\n      }\n      \n      .btn-sota {\n        padding: 12px 24px;\n        border-radius: 12px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .btn-sota.primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\n      }\n      \n      .btn-sota.primary:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\n      }\n      \n      .btn-sota.secondary {\n        background: #f1f5f9;\n        color: #475569;\n      }\n      \n      [data-theme=\"dark\"] .btn-sota.secondary {\n        background: rgba(255,255,255,0.1);\n        color: #e2e8f0;\n      }\n      \n      .btn-sota.secondary:hover {\n        background: #e2e8f0;\n      }\n      \n      [data-theme=\"dark\"] .btn-sota.secondary:hover {\n        background: rgba(255,255,255,0.15);\n      }\n      \n      .btn-sota.danger {\n        background: transparent;\n        color: #dc2626;\n        border: 1px solid #fecaca;\n      }\n      \n      .btn-sota.danger:hover {\n        background: #fef2f2;\n        border-color: #dc2626;\n      }\n      \n      /* Security Section */\n      .security-section {\n        margin-bottom: 32px;\n      }\n      \n      .security-section h3 {\n        font-size: 16px;\n        font-weight: 600;\n        color: #1e293b;\n        margin: 0 0 16px 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      [data-theme=\"dark\"] .security-section h3 {\n        color: #f1f5f9;\n      }\n      \n      .danger-zone {\n        background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);\n        border: 1px solid #fecaca;\n        border-radius: 16px;\n        padding: 24px;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone {\n        background: linear-gradient(135deg, rgba(220,38,38,0.1) 0%, rgba(220,38,38,0.05) 100%);\n        border-color: rgba(220,38,38,0.3);\n      }\n      \n      .danger-zone h3 {\n        color: #dc2626 !important;\n      }\n      \n      .danger-zone p {\n        color: #991b1b;\n        font-size: 14px;\n        margin: 0 0 16px 0;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone p {\n        color: #fca5a5;\n      }\n      \n      /* Sessions */\n      .sessions-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      \n      .session-card {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 16px 20px;\n        background: #f8fafc;\n        border-radius: 12px;\n        border: 1px solid transparent;\n      }\n      \n      [data-theme=\"dark\"] .session-card {\n        background: rgba(255,255,255,0.03);\n      }\n      \n      .session-card.current {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n      }\n      \n      .session-info {\n        display: flex;\n        align-items: center;\n        gap: 16px;\n      }\n      \n      .session-icon {\n        width: 44px;\n        height: 44px;\n        background: #e2e8f0;\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      \n      [data-theme=\"dark\"] .session-icon {\n        background: rgba(255,255,255,0.1);\n      }\n      \n      .session-icon svg {\n        width: 22px;\n        height: 22px;\n        color: #64748b;\n      }\n      \n      .session-details h4 {\n        margin: 0 0 4px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .session-details h4 {\n        color: #f1f5f9;\n      }\n      \n      .session-details p {\n        margin: 0;\n        font-size: 12px;\n        color: #64748b;\n      }\n      \n      .session-badge {\n        font-size: 11px;\n        font-weight: 600;\n        padding: 4px 10px;\n        border-radius: 20px;\n        background: #e11d48;\n        color: white;\n      }\n      \n      .empty-state {\n        text-align: center;\n        padding: 48px 24px;\n        color: #94a3b8;\n      }\n      \n      .empty-state svg {\n        width: 48px;\n        height: 48px;\n        margin-bottom: 16px;\n        opacity: 0.5;\n      }\n      \n      .loading-spinner {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 48px;\n      }\n      \n      .loading-spinner::after {\n        content: '';\n        width: 32px;\n        height: 32px;\n        border: 3px solid #e2e8f0;\n        border-top-color: #e11d48;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n      }\n      \n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n    </style>\n    \n    <div class=\"profile-card\">\n      <div class=\"loading-spinner\"></div>\n    </div>\n  `;\n\n  return container;\n}\n\n/**\n * Load profile data\n */\nasync function loadProfile(container: HTMLElement): Promise<void> {\n  const card = container.querySelector('.profile-card') as HTMLElement;\n  if (!card) return;\n\n  try {\n    // Load profile and timezones in parallel\n    const [apiProfile, timezones] = await Promise.all([\n      profileService.get(),\n      loadTimezones()\n    ]);\n    \n    if (apiProfile) {\n      currentProfile = apiProfile;\n      renderProfile(card, currentProfile, timezones);\n    } else {\n      // Fallback to current user from store\n      const currentUser = appStore.getState().currentUser;\n      if (currentUser) {\n        currentProfile = {\n          id: currentUser.id,\n          email: currentUser.email,\n          display_name: currentUser.name || currentUser.email?.split('@')[0] || 'User',\n          avatar_url: currentUser.avatar,\n          created_at: new Date().toISOString(),\n        };\n        renderProfile(card, currentProfile, timezones);\n      } else {\n        card.innerHTML = '<div class=\"empty-state\">Please log in to view your profile</div>';\n      }\n    }\n  } catch {\n    // Fallback to current user\n    const currentUser = appStore.getState().currentUser;\n    if (currentUser) {\n      currentProfile = {\n        id: currentUser.id,\n        email: currentUser.email,\n        display_name: currentUser.name || 'User',\n        avatar_url: currentUser.avatar,\n        created_at: new Date().toISOString(),\n      };\n      renderProfile(card, currentProfile);\n    } else {\n      card.innerHTML = '<div class=\"empty-state\">Failed to load profile</div>';\n    }\n  }\n}\n\n/**\n * Render profile\n */\nfunction renderProfile(container: HTMLElement, profile: UserProfile, timezones?: Timezone[]): void {\n  const initials = getInitials(profile.display_name || profile.email);\n  const currentUser = appStore.getState().currentUser;\n  const role = currentUser?.role || profile.role || 'user';\n  \n  container.innerHTML = `\n    <!-- Header -->\n    <div class=\"profile-header\">\n      <button class=\"profile-close-btn\" id=\"close-profile-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n      \n      <div class=\"profile-header-content\">\n        <label class=\"profile-avatar-large\" for=\"avatar-input-hidden\" id=\"profile-avatar-display\">\n          <img src=\"${profile.avatar_url || generateFallbackAvatar(profile.display_name || profile.email)}\" alt=\"Avatar\" onerror=\"this.src='${generateFallbackAvatar(profile.display_name || profile.email)}'\">\n          <div class=\"avatar-overlay\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n            </svg>\n          </div>\n          <input type=\"file\" id=\"avatar-input-hidden\" accept=\"image/*\" hidden>\n        </label>\n        \n        <div class=\"profile-user-info\">\n          <h2>${escapeHtml(profile.display_name || profile.username || 'User')}</h2>\n          <div class=\"email\">\n            ${escapeHtml(profile.email)}\n            <span class=\"role-badge\">\n              <svg width=\"12\" height=\"12\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                ${role === 'superadmin' \n                  ? '<path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"/>'\n                  : '<path fill-rule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clip-rule=\"evenodd\"/>'\n                }\n              </svg>\n              ${role === 'superadmin' ? 'Super Admin' : 'User'}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Tabs Navigation -->\n    <nav class=\"profile-tabs-nav\">\n      <button class=\"profile-tab-btn active\" data-tab=\"general\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n        </svg>\n        General\n      </button>\n      <button class=\"profile-tab-btn\" data-tab=\"security\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"/>\n        </svg>\n        Security\n      </button>\n      <button class=\"profile-tab-btn\" data-tab=\"sessions\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n        </svg>\n        Sessions\n      </button>\n      <button class=\"profile-tab-btn\" data-tab=\"integrations\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\n        </svg>\n        Integrations\n      </button>\n    </nav>\n    \n    <!-- Tab Content -->\n    <div class=\"profile-body\">\n      <!-- General Tab -->\n      <div class=\"profile-section active\" id=\"section-general\">\n        <form id=\"profile-form\">\n          <div class=\"form-grid\">\n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n                </svg>\n                Email\n              </label>\n              <input type=\"email\" value=\"${escapeHtml(profile.email)}\" disabled>\n              <span class=\"form-hint\">Email cannot be changed</span>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207\"/>\n                </svg>\n                Username\n              </label>\n              <input type=\"text\" name=\"username\" value=\"${escapeHtml(profile.username || '')}\" placeholder=\"Enter username\">\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                </svg>\n                Display Name\n              </label>\n              <input type=\"text\" name=\"display_name\" value=\"${escapeHtml(profile.display_name || '')}\" placeholder=\"Your display name\">\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\n                </svg>\n                Bio\n              </label>\n              <textarea name=\"bio\" placeholder=\"Tell us a bit about yourself\">${escapeHtml(profile.bio || '')}</textarea>\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                </svg>\n                Avatar URL\n              </label>\n              <input type=\"url\" name=\"avatar_url\" id=\"avatar-url-input\" value=\"${escapeHtml(profile.avatar_url || '')}\" placeholder=\"https://example.com/avatar.jpg\">\n              <span class=\"form-hint\">Enter an image URL or upload using the avatar above. Leave empty for auto-generated avatar.</span>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                </svg>\n                Timezone\n              </label>\n              <select name=\"timezone\">\n                ${generateTimezoneOptions(profile.timezone, timezones)}\n              </select>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129\"/>\n                </svg>\n                Language\n              </label>\n              <select name=\"locale\">\n                <option value=\"en\" ${profile.locale === 'en' ? 'selected' : ''}>English</option>\n                <option value=\"pt\" ${profile.locale === 'pt' ? 'selected' : ''}>Portugus</option>\n                <option value=\"es\" ${profile.locale === 'es' ? 'selected' : ''}>Espaol</option>\n                <option value=\"fr\" ${profile.locale === 'fr' ? 'selected' : ''}>Franais</option>\n              </select>\n            </div>\n          </div>\n          \n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-sota primary\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              Save Changes\n            </button>\n          </div>\n        </form>\n      </div>\n      \n      <!-- Security Tab -->\n      <div class=\"profile-section\" id=\"section-security\">\n        <div class=\"security-section\">\n          <h3>\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"/>\n            </svg>\n            Change Password\n          </h3>\n          \n          <form id=\"password-form\">\n            <div class=\"form-grid\">\n              <div class=\"form-field full-width\">\n                <label>Current Password</label>\n                <input type=\"password\" name=\"current_password\" required>\n              </div>\n              \n              <div class=\"form-field\">\n                <label>New Password</label>\n                <input type=\"password\" name=\"new_password\" minlength=\"12\" required>\n                <span class=\"form-hint\">Minimum 12 characters</span>\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Confirm Password</label>\n                <input type=\"password\" name=\"confirm_password\" required>\n              </div>\n            </div>\n            \n            <div class=\"form-actions\">\n              <button type=\"submit\" class=\"btn-sota primary\">Update Password</button>\n            </div>\n          </form>\n        </div>\n        \n        <div class=\"danger-zone\">\n          <h3>\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n            </svg>\n            Danger Zone\n          </h3>\n          <p>Permanently delete your account and all associated data. This action cannot be undone.</p>\n          <button type=\"button\" class=\"btn-sota danger\" id=\"delete-account-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\n            </svg>\n            Delete Account\n          </button>\n        </div>\n      </div>\n      \n      <!-- Sessions Tab -->\n      <div class=\"profile-section\" id=\"section-sessions\">\n        <div id=\"sessions-list\" class=\"sessions-list\">\n          <div class=\"loading-spinner\"></div>\n        </div>\n        \n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"revoke-all-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"/>\n            </svg>\n            Sign out all other sessions\n          </button>\n        </div>\n      </div>\n      \n      <!-- Integrations Tab -->\n      <div class=\"profile-section\" id=\"section-integrations\">\n        <div class=\"security-section\">\n          <h3>\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"/>\n            </svg>\n            Krisp AI Meeting Assistant\n          </h3>\n          <p class=\"form-hint\" style=\"margin-bottom: 16px;\">\n            Connect your Krisp account to automatically import meeting transcriptions into GodMode.\n          </p>\n          \n          <div id=\"krisp-integration-content\">\n            <div class=\"loading-spinner\"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n\n  bindEvents(container);\n}\n\n/**\n * Bind event handlers\n */\nfunction bindEvents(container: HTMLElement): void {\n  // Close button\n  const closeBtn = container.querySelector('#close-profile-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => {\n      closeModal(MODAL_ID);\n      currentProps.onClose?.();\n    });\n  }\n\n  // Tab switching\n  const tabs = container.querySelectorAll('.profile-tab-btn');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n\n      const tabId = tab.getAttribute('data-tab');\n      container.querySelectorAll('.profile-section').forEach(section => {\n        section.classList.toggle('active', section.id === `section-${tabId}`);\n      });\n\n      if (tabId === 'sessions') {\n        loadSessions();\n      }\n      if (tabId === 'integrations') {\n        loadKrispIntegration(container);\n      }\n    });\n  });\n\n  // Avatar upload\n  const avatarInput = container.querySelector('#avatar-input-hidden') as HTMLInputElement;\n  if (avatarInput) {\n    on(avatarInput, 'change', async () => {\n      const file = avatarInput.files?.[0];\n      if (file) {\n        try {\n          const avatarUrl = await profileService.uploadAvatar(file);\n          const avatarEl = container.querySelector('.profile-avatar-large') as HTMLElement;\n          if (avatarEl) {\n            const img = avatarEl.querySelector('img');\n            if (img) {\n              img.src = avatarUrl;\n            } else {\n              avatarEl.innerHTML = `\n                <img src=\"${avatarUrl}\" alt=\"Avatar\">\n                <div class=\"avatar-overlay\">\n                  <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                  </svg>\n                </div>\n                <input type=\"file\" id=\"avatar-input-hidden\" accept=\"image/*\" hidden>\n              `;\n            }\n          }\n          toast.success('Avatar updated');\n        } catch {\n          toast.error('Failed to upload avatar');\n        }\n      }\n    });\n  }\n\n  // Avatar URL input - live preview\n  const avatarUrlInput = container.querySelector('#avatar-url-input') as HTMLInputElement;\n  const avatarDisplay = container.querySelector('#profile-avatar-display img') as HTMLImageElement;\n  if (avatarUrlInput && avatarDisplay) {\n    on(avatarUrlInput, 'input', () => {\n      const url = avatarUrlInput.value.trim();\n      if (url) {\n        avatarDisplay.src = url;\n      } else if (currentProfile) {\n        // Use fallback if empty\n        avatarDisplay.src = generateFallbackAvatar(currentProfile.display_name || currentProfile.email);\n      }\n    });\n  }\n\n  // Profile form submit\n  const profileForm = container.querySelector('#profile-form') as HTMLFormElement;\n  if (profileForm) {\n    on(profileForm, 'submit', async (e) => {\n      e.preventDefault();\n      const formData = new FormData(profileForm);\n      const avatarUrl = (formData.get('avatar_url') as string)?.trim();\n      const displayName = formData.get('display_name') as string || undefined;\n      \n      const data = {\n        username: formData.get('username') as string || undefined,\n        display_name: displayName,\n        bio: formData.get('bio') as string || undefined,\n        timezone: formData.get('timezone') as string || undefined,\n        locale: formData.get('locale') as string || undefined,\n        avatar_url: avatarUrl || (displayName ? generateFallbackAvatar(displayName) : undefined),\n      };\n\n      try {\n        const updated = await profileService.update(data);\n        currentProfile = updated;\n        toast.success('Profile updated');\n        currentProps.onUpdate?.(updated);\n        \n        // Update the avatar display\n        if (avatarDisplay) {\n          avatarDisplay.src = updated.avatar_url || generateFallbackAvatar(updated.display_name || updated.email);\n        }\n      } catch {\n        toast.error('Failed to update profile');\n      }\n    });\n  }\n\n  // Password form submit\n  const passwordForm = container.querySelector('#password-form') as HTMLFormElement;\n  if (passwordForm) {\n    on(passwordForm, 'submit', async (e) => {\n      e.preventDefault();\n      const formData = new FormData(passwordForm);\n      const currentPassword = formData.get('current_password') as string;\n      const newPassword = formData.get('new_password') as string;\n      const confirmPassword = formData.get('confirm_password') as string;\n\n      if (newPassword !== confirmPassword) {\n        toast.error('Passwords do not match');\n        return;\n      }\n\n      try {\n        await profileService.changePassword({\n          current_password: currentPassword,\n          new_password: newPassword,\n        });\n        toast.success('Password changed');\n        passwordForm.reset();\n      } catch (error) {\n        toast.error(error instanceof Error ? error.message : 'Failed to change password');\n      }\n    });\n  }\n\n  // Delete account\n  const deleteAccountBtn = container.querySelector('#delete-account-btn');\n  if (deleteAccountBtn) {\n    on(deleteAccountBtn as HTMLElement, 'click', async () => {\n      const password = prompt('Enter your password to confirm account deletion:');\n      if (!password) return;\n\n      if (!confirm('Are you sure? This action cannot be undone.')) return;\n\n      try {\n        await profileService.deleteAccount(password);\n        closeModal(MODAL_ID);\n        toast.success('Account deleted');\n        window.location.reload();\n      } catch {\n        toast.error('Failed to delete account');\n      }\n    });\n  }\n\n  // Revoke all sessions\n  const revokeAllBtn = container.querySelector('#revoke-all-btn');\n  if (revokeAllBtn) {\n    on(revokeAllBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Sign out from all other devices?')) return;\n\n      try {\n        await profileService.revokeAllSessions();\n        toast.success('All other sessions signed out');\n        loadSessions();\n      } catch {\n        toast.error('Failed to revoke sessions');\n      }\n    });\n  }\n}\n\n/**\n * Load sessions\n */\nasync function loadSessions(): Promise<void> {\n  const container = document.querySelector('#sessions-list');\n  if (!container) return;\n\n  try {\n    const sessions = await profileService.getSessions();\n\n    if (!sessions || sessions.length === 0) {\n      container.innerHTML = `\n        <div class=\"empty-state\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n          </svg>\n          <p>No active sessions found</p>\n        </div>\n      `;\n      return;\n    }\n\n    container.innerHTML = sessions.map(session => `\n      <div class=\"session-card ${session.is_current ? 'current' : ''}\">\n        <div class=\"session-info\">\n          <div class=\"session-icon\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              ${session.device?.toLowerCase().includes('mobile') \n                ? '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z\"/>'\n                : '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>'\n              }\n            </svg>\n          </div>\n          <div class=\"session-details\">\n            <h4>${escapeHtml(session.device || 'Unknown device')}</h4>\n            <p>${session.location ? `${escapeHtml(session.location)}  ` : ''}${escapeHtml(session.ip_address || 'Unknown IP')}  Last active: ${formatDate(session.last_active)}</p>\n          </div>\n        </div>\n        ${session.is_current \n          ? '<span class=\"session-badge\">Current</span>'\n          : `<button class=\"btn-sota secondary revoke-session-btn\" data-id=\"${session.id}\">Revoke</button>`\n        }\n      </div>\n    `).join('');\n\n    // Bind revoke buttons\n    container.querySelectorAll('.revoke-session-btn').forEach(btn => {\n      on(btn as HTMLElement, 'click', async () => {\n        const sessionId = btn.getAttribute('data-id');\n        if (!sessionId) return;\n\n        try {\n          await profileService.revokeSession(sessionId);\n          toast.success('Session revoked');\n          loadSessions();\n        } catch {\n          toast.error('Failed to revoke session');\n        }\n      });\n    });\n  } catch {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n        </svg>\n        <p>Session management requires authentication</p>\n      </div>\n    `;\n  }\n}\n\n/**\n * Helper functions\n */\nfunction getInitials(name: string): string {\n  return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n}\n\n/**\n * Generate a fallback avatar URL using UI Avatars\n */\nfunction generateFallbackAvatar(name: string): string {\n  const encoded = encodeURIComponent(name || 'User');\n  return `https://ui-avatars.com/api/?name=${encoded}&background=e11d48&color=fff&size=200&font-size=0.4&bold=true`;\n}\n\n/**\n * Load timezones from API\n */\nasync function loadTimezones(): Promise<Timezone[]> {\n  if (cachedTimezones) {\n    return cachedTimezones;\n  }\n  \n  try {\n    const response = await http.get<{ timezones: Timezone[] }>('/api/timezones');\n    cachedTimezones = response.data.timezones;\n    return cachedTimezones;\n  } catch {\n    // Fallback to minimal list\n    return [\n      { code: 'UTC', name: 'Coordinated Universal Time', utc_offset: '+00:00' },\n      { code: 'Europe/Lisbon', name: 'Lisbon, Portugal', utc_offset: '+00:00' },\n      { code: 'Europe/London', name: 'London, United Kingdom', utc_offset: '+00:00' },\n    ];\n  }\n}\n\n/**\n * Generate timezone options HTML - uses cached timezones or fallback\n */\nfunction generateTimezoneOptions(selected?: string, timezones?: Timezone[]): string {\n  const tzList = timezones || cachedTimezones || [\n    { code: 'UTC', name: 'Coordinated Universal Time', utc_offset: '+00:00' },\n  ];\n\n  // Group by region for better UX\n  const grouped = tzList.reduce((acc, tz) => {\n    const region = tz.region || 'Other';\n    if (!acc[region]) acc[region] = [];\n    acc[region].push(tz);\n    return acc;\n  }, {} as Record<string, Timezone[]>);\n\n  // Sort regions\n  const regionOrder = ['Europe', 'Americas', 'Asia', 'Oceania', 'Africa', 'Atlantic', 'UTC', 'Other'];\n  const sortedRegions = Object.keys(grouped).sort((a, b) => {\n    const aIdx = regionOrder.indexOf(a);\n    const bIdx = regionOrder.indexOf(b);\n    return (aIdx === -1 ? 999 : aIdx) - (bIdx === -1 ? 999 : bIdx);\n  });\n\n  let html = '';\n  for (const region of sortedRegions) {\n    html += `<optgroup label=\"${region}\">`;\n    for (const tz of grouped[region]) {\n      const label = `${tz.name} (${tz.utc_offset})`;\n      html += `<option value=\"${tz.code}\" ${selected === tz.code ? 'selected' : ''}>${label}</option>`;\n    }\n    html += '</optgroup>';\n  }\n\n  return html;\n}\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  const now = new Date();\n  const diff = now.getTime() - date.getTime();\n  \n  if (diff < 60000) return 'Just now';\n  if (diff < 3600000) return `${Math.floor(diff / 60000)} min ago`;\n  if (diff < 86400000) return `${Math.floor(diff / 3600000)} hours ago`;\n  if (diff < 604800000) return `${Math.floor(diff / 86400000)} days ago`;\n  \n  return date.toLocaleDateString();\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Load Krisp integration content\n */\nasync function loadKrispIntegration(container: HTMLElement): Promise<void> {\n  const contentEl = container.querySelector('#krisp-integration-content');\n  if (!contentEl) return;\n\n  // Check if user is superadmin (has MCP access)\n  const currentUser = appStore.getState().currentUser;\n  const isSuperAdmin = currentUser?.role === 'superadmin';\n\n  try {\n    const webhook = await krispService.getWebhook();\n    const summary = await krispService.getTranscriptsSummary();\n\n    if (!webhook) {\n      contentEl.innerHTML = `\n        <div class=\"krisp-not-configured\">\n          <p>Krisp integration is not configured yet.</p>\n          <button type=\"button\" class=\"btn-sota primary\" id=\"enable-krisp-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\"/>\n            </svg>\n            Enable Krisp Integration\n          </button>\n        </div>\n      `;\n\n      const enableBtn = contentEl.querySelector('#enable-krisp-btn');\n      if (enableBtn) {\n        on(enableBtn as HTMLElement, 'click', async () => {\n          try {\n            await krispService.getWebhook(); // This creates the webhook if it doesn't exist\n            loadKrispIntegration(container);\n            toast.success('Krisp integration enabled');\n          } catch {\n            toast.error('Failed to enable Krisp integration');\n          }\n        });\n      }\n      return;\n    }\n\n    // Show webhook configuration\n    contentEl.innerHTML = `\n      <div class=\"krisp-config\">\n        ${isSuperAdmin ? `\n        <div class=\"krisp-mcp-banner\">\n          <div class=\"mcp-icon\">\n            <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n            </svg>\n          </div>\n          <div class=\"mcp-info\">\n            <strong>MCP Direct Access</strong>\n            <span>As a Super Admin, you can import meetings directly via MCP without webhook configuration.</span>\n          </div>\n          <button type=\"button\" class=\"btn-sota primary\" id=\"mcp-import-btn\">\n            Import via MCP\n          </button>\n        </div>\n        ` : ''}\n        \n        <div class=\"krisp-status\">\n          <span class=\"status-indicator ${webhook.is_active ? 'active' : 'inactive'}\"></span>\n          <span>${webhook.is_active ? 'Active' : 'Inactive'}</span>\n          <button type=\"button\" class=\"btn-sota small ${webhook.is_active ? 'secondary' : 'primary'}\" id=\"toggle-krisp-btn\">\n            ${webhook.is_active ? 'Disable' : 'Enable'}\n          </button>\n        </div>\n\n        <div class=\"form-field\">\n          <label>Webhook URL</label>\n          <div class=\"input-with-copy\">\n            <input type=\"text\" value=\"${escapeHtml(webhook.webhook_url)}\" readonly>\n            <button type=\"button\" class=\"btn-copy\" data-copy=\"${escapeHtml(webhook.webhook_url)}\" title=\"Copy URL\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        <div class=\"form-field\">\n          <label>Authorization Token</label>\n          <div class=\"input-with-copy\">\n            <input type=\"password\" value=\"${escapeHtml(webhook.webhook_secret)}\" readonly id=\"krisp-secret-input\">\n            <button type=\"button\" class=\"btn-toggle-visibility\" id=\"toggle-secret-btn\" title=\"Show/Hide\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"/>\n              </svg>\n            </button>\n            <button type=\"button\" class=\"btn-copy\" data-copy=\"${escapeHtml(webhook.webhook_secret)}\" title=\"Copy Token\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/>\n              </svg>\n            </button>\n          </div>\n          <span class=\"form-hint\">Use this token in the Authorization header when configuring Krisp webhook.</span>\n        </div>\n\n        <div class=\"krisp-stats\">\n          <div class=\"stat\">\n            <span class=\"stat-value\">${summary?.total_count || 0}</span>\n            <span class=\"stat-label\">Total Transcripts</span>\n          </div>\n          <div class=\"stat\">\n            <span class=\"stat-value\">${summary?.processed_count || 0}</span>\n            <span class=\"stat-label\">Processed</span>\n          </div>\n          <div class=\"stat ${(summary?.quarantine_count || 0) + (summary?.ambiguous_count || 0) > 0 ? 'warning' : ''}\">\n            <span class=\"stat-value\">${(summary?.quarantine_count || 0) + (summary?.ambiguous_count || 0)}</span>\n            <span class=\"stat-label\">Need Attention</span>\n          </div>\n        </div>\n\n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"regenerate-krisp-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\n            </svg>\n            Regenerate Credentials\n          </button>\n          <a href=\"#\" class=\"btn-sota primary\" id=\"view-transcripts-btn\">\n            View Transcripts\n          </a>\n        </div>\n      </div>\n      \n      <style>\n        .krisp-config { padding: 16px 0; }\n        .krisp-status { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }\n        .status-indicator { width: 8px; height: 8px; border-radius: 50%; }\n        .status-indicator.active { background: #22c55e; }\n        .status-indicator.inactive { background: #94a3b8; }\n        .input-with-copy { display: flex; gap: 8px; }\n        .input-with-copy input { flex: 1; }\n        .btn-copy, .btn-toggle-visibility { padding: 8px; background: var(--bg-secondary, #f1f5f9); border: 1px solid var(--border-color, #e2e8f0); border-radius: 6px; cursor: pointer; }\n        .btn-copy:hover, .btn-toggle-visibility:hover { background: var(--bg-tertiary, #e2e8f0); }\n        .krisp-stats { display: flex; gap: 16px; margin: 24px 0; padding: 16px; background: var(--bg-secondary, #f8fafc); border-radius: 12px; }\n        .stat { flex: 1; text-align: center; }\n        .stat-value { display: block; font-size: 24px; font-weight: 600; color: var(--text-primary, #1e293b); }\n        .stat-label { font-size: 12px; color: var(--text-secondary, #64748b); }\n        .stat.warning .stat-value { color: #f59e0b; }\n        .btn-sota.small { padding: 4px 12px; font-size: 12px; }\n        .krisp-not-configured { text-align: center; padding: 32px; }\n        .krisp-not-configured p { margin-bottom: 16px; color: var(--text-secondary, #64748b); }\n        .krisp-mcp-banner {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 16px;\n          background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%);\n          border: 1px solid #93c5fd;\n          border-radius: 12px;\n          margin-bottom: 20px;\n        }\n        .mcp-icon {\n          width: 40px;\n          height: 40px;\n          background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);\n          border-radius: 10px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-shrink: 0;\n        }\n        .mcp-icon svg { color: white; }\n        .mcp-info {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          gap: 2px;\n        }\n        .mcp-info strong {\n          font-size: 14px;\n          color: #1e40af;\n        }\n        .mcp-info span {\n          font-size: 12px;\n          color: #3b82f6;\n        }\n        .krisp-mcp-banner .btn-sota {\n          flex-shrink: 0;\n        }\n        [data-theme=\"dark\"] .krisp-mcp-banner {\n          background: linear-gradient(135deg, rgba(59,130,246,0.15) 0%, rgba(29,78,216,0.1) 100%);\n          border-color: rgba(59,130,246,0.3);\n        }\n        [data-theme=\"dark\"] .mcp-info strong { color: #93c5fd; }\n        [data-theme=\"dark\"] .mcp-info span { color: #60a5fa; }\n        [data-theme=\"dark\"] .krisp-stats { background: rgba(30,41,59,0.5); }\n        [data-theme=\"dark\"] .btn-copy, [data-theme=\"dark\"] .btn-toggle-visibility { background: rgba(30,41,59,0.8); border-color: rgba(255,255,255,0.1); }\n      </style>\n    `;\n\n    // Bind copy buttons\n    contentEl.querySelectorAll('.btn-copy').forEach(btn => {\n      on(btn as HTMLElement, 'click', () => {\n        const text = btn.getAttribute('data-copy') || '';\n        navigator.clipboard.writeText(text);\n        toast.success('Copied to clipboard');\n      });\n    });\n\n    // Toggle secret visibility\n    const toggleSecretBtn = contentEl.querySelector('#toggle-secret-btn');\n    const secretInput = contentEl.querySelector('#krisp-secret-input') as HTMLInputElement;\n    if (toggleSecretBtn && secretInput) {\n      on(toggleSecretBtn as HTMLElement, 'click', () => {\n        secretInput.type = secretInput.type === 'password' ? 'text' : 'password';\n      });\n    }\n\n    // MCP Import button (superadmin only)\n    const mcpImportBtn = contentEl.querySelector('#mcp-import-btn');\n    if (mcpImportBtn) {\n      on(mcpImportBtn as HTMLElement, 'click', async () => {\n        closeModal(MODAL_ID);\n        // Open KrispManager directly on the Import tab\n        const { showKrispManager } = await import('./KrispManager');\n        showKrispManager('import');\n      });\n    }\n\n    // Toggle webhook\n    const toggleBtn = contentEl.querySelector('#toggle-krisp-btn');\n    if (toggleBtn) {\n      on(toggleBtn as HTMLElement, 'click', async () => {\n        const newState = !webhook.is_active;\n        const success = await krispService.toggleWebhook(newState);\n        if (success) {\n          toast.success(newState ? 'Krisp integration enabled' : 'Krisp integration disabled');\n          loadKrispIntegration(container);\n        } else {\n          toast.error('Failed to update integration');\n        }\n      });\n    }\n\n    // Regenerate credentials\n    const regenerateBtn = contentEl.querySelector('#regenerate-krisp-btn');\n    if (regenerateBtn) {\n      on(regenerateBtn as HTMLElement, 'click', async () => {\n        if (!confirm('Are you sure? You will need to update the webhook URL in Krisp.')) return;\n        \n        const newWebhook = await krispService.regenerateWebhook();\n        if (newWebhook) {\n          toast.success('Credentials regenerated');\n          loadKrispIntegration(container);\n        } else {\n          toast.error('Failed to regenerate credentials');\n        }\n      });\n    }\n\n    // View transcripts link\n    const viewTranscriptsBtn = contentEl.querySelector('#view-transcripts-btn');\n    if (viewTranscriptsBtn) {\n      on(viewTranscriptsBtn as HTMLElement, 'click', async (e) => {\n        e.preventDefault();\n        closeModal(MODAL_ID);\n        // Open KrispManager modal\n        const { showKrispManager } = await import('./KrispManager');\n        showKrispManager();\n      });\n    }\n\n  } catch (error) {\n    console.error('[ProfileModal] Krisp integration error:', error);\n    contentEl.innerHTML = `\n      <div class=\"error-message\">\n        <p>Failed to load Krisp integration. Please try again.</p>\n        <button type=\"button\" class=\"btn-sota secondary\" id=\"retry-krisp-btn\">Retry</button>\n      </div>\n    `;\n\n    const retryBtn = contentEl.querySelector('#retry-krisp-btn');\n    if (retryBtn) {\n      on(retryBtn as HTMLElement, 'click', () => loadKrispIntegration(container));\n    }\n  }\n}\n\nexport function closeProfileModal(): void {\n  closeModal(MODAL_ID);\n}\n","/**\n * Fact Modal\n * CRUD modal for facts\n */\n\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { createElement, on } from '../../utils/dom';\nimport { factsService, Fact, CreateFactRequest } from '../../services/facts';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'fact-modal';\n\nexport interface FactModalProps {\n  mode: 'view' | 'create' | 'edit';\n  fact?: Fact;\n  onSave?: (fact: Fact) => void;\n  onDelete?: (factId: string | number) => void;\n  onClose?: () => void;\n}\n\nlet currentProps: FactModalProps = { mode: 'create' };\n\n/**\n * Show fact modal\n */\nexport function showFactModal(props: FactModalProps): void {\n  currentProps = props;\n\n  const title = props.mode === 'create' \n    ? 'Add Fact' \n    : props.mode === 'edit' \n      ? 'Edit Fact' \n      : 'View Fact';\n\n  const modal = createModal({\n    id: MODAL_ID,\n    title,\n    size: 'md',\n    content: createModalContent(props),\n    onClose: props.onClose,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Create modal content\n */\nfunction createModalContent(props: FactModalProps): HTMLElement {\n  const container = createElement('div', { className: 'fact-modal-content' });\n  const fact = props.fact;\n  const isViewMode = props.mode === 'view';\n\n  container.innerHTML = `\n    <form id=\"fact-form\" class=\"fact-form\">\n      <div class=\"form-group\">\n        <label for=\"content\">Fact Content *</label>\n        <textarea id=\"content\" name=\"content\" rows=\"4\" required \n                  ${isViewMode ? 'disabled' : ''}\n                  placeholder=\"Enter the fact...\">${escapeHtml(fact?.content || '')}</textarea>\n      </div>\n\n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label for=\"source\">Source</label>\n          <input type=\"text\" id=\"source\" name=\"source\" \n                 ${isViewMode ? 'disabled' : ''}\n                 value=\"${escapeHtml(fact?.source || '')}\"\n                 placeholder=\"Document, conversation, etc.\">\n        </div>\n        <div class=\"form-group\">\n          <label for=\"category\">Category</label>\n          <input type=\"text\" id=\"category\" name=\"category\" \n                 ${isViewMode ? 'disabled' : ''}\n                 value=\"${escapeHtml(fact?.category || '')}\"\n                 placeholder=\"Technical, Business, etc.\">\n        </div>\n      </div>\n\n      ${fact?.verified ? `\n        <div class=\"verified-info\">\n          <span class=\"verified-badge\"> Verified</span>\n          ${fact.verified_by ? `<span>by ${escapeHtml(fact.verified_by)}</span>` : ''}\n          ${fact.verified_at ? `<span>on ${formatDate(fact.verified_at)}</span>` : ''}\n        </div>\n      ` : ''}\n\n      ${fact?.source_file ? `\n        <div class=\"source-file\">\n          <span class=\"label\">Source File:</span>\n          <span class=\"value\">${escapeHtml(fact.source_file)}</span>\n        </div>\n      ` : ''}\n\n      ${fact ? `\n        <div class=\"metadata\">\n          <span>Created: ${formatDate(fact.created_at)}</span>\n          ${fact.updated_at ? `<span>Updated: ${formatDate(fact.updated_at)}</span>` : ''}\n        </div>\n      ` : ''}\n\n      <div class=\"form-actions\">\n        ${props.mode === 'view' ? `\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-btn\">Edit</button>\n          ${!fact?.verified ? `<button type=\"button\" class=\"btn btn-success\" id=\"verify-btn\">Verify</button>` : ''}\n          <button type=\"button\" class=\"btn btn-danger\" id=\"delete-btn\">Delete</button>\n        ` : `\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\n          <button type=\"submit\" class=\"btn btn-primary\">\n            ${props.mode === 'create' ? 'Add Fact' : 'Save Changes'}\n          </button>\n        `}\n      </div>\n    </form>\n  `;\n\n  bindEvents(container, props);\n  return container;\n}\n\n/**\n * Bind event handlers\n */\nfunction bindEvents(container: HTMLElement, props: FactModalProps): void {\n  const form = container.querySelector('#fact-form') as HTMLFormElement;\n\n  // Form submit\n  if (form) {\n    on(form, 'submit', async (e) => {\n      e.preventDefault();\n\n      const formData = new FormData(form);\n      const data: CreateFactRequest = {\n        content: formData.get('content') as string,\n        source: formData.get('source') as string || undefined,\n        category: formData.get('category') as string || undefined,\n      };\n\n      if (!data.content.trim()) {\n        toast.error('Fact content is required');\n        return;\n      }\n\n      try {\n        let savedFact: Fact;\n\n        if (props.mode === 'create') {\n          savedFact = await factsService.create(data);\n          toast.success('Fact added');\n        } else {\n          savedFact = await factsService.update(props.fact!.id, data);\n          toast.success('Fact updated');\n        }\n\n        closeModal(MODAL_ID);\n        props.onSave?.(savedFact);\n      } catch {\n        toast.error('Failed to save fact');\n      }\n    });\n  }\n\n  // Cancel button\n  const cancelBtn = container.querySelector('#cancel-btn');\n  if (cancelBtn) {\n    on(cancelBtn as HTMLElement, 'click', () => {\n      closeModal(MODAL_ID);\n    });\n  }\n\n  // Edit button (in view mode)\n  const editBtn = container.querySelector('#edit-btn');\n  if (editBtn) {\n    on(editBtn as HTMLElement, 'click', () => {\n      closeModal(MODAL_ID);\n      showFactModal({\n        ...props,\n        mode: 'edit',\n      });\n    });\n  }\n\n  // Verify button\n  const verifyBtn = container.querySelector('#verify-btn');\n  if (verifyBtn && props.fact) {\n    on(verifyBtn as HTMLElement, 'click', async () => {\n      try {\n        const verifiedFact = await factsService.verify(props.fact!.id);\n        toast.success('Fact verified');\n        closeModal(MODAL_ID);\n        props.onSave?.(verifiedFact);\n      } catch {\n        toast.error('Failed to verify fact');\n      }\n    });\n  }\n\n  // Delete button\n  const deleteBtn = container.querySelector('#delete-btn');\n  if (deleteBtn && props.fact) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this fact?')) return;\n\n      try {\n        await factsService.delete(props.fact!.id);\n        toast.success('Fact deleted');\n        closeModal(MODAL_ID);\n        props.onDelete?.(props.fact!.id);\n      } catch {\n        toast.error('Failed to delete fact');\n      }\n    });\n  }\n}\n\n/**\n * Format date\n */\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString();\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport function closeFactModal(): void {\n  closeModal(MODAL_ID);\n}\n","/**\n * Conversation Preview Modal - SOTA\n * Full conversation preview with AI extraction results, entities, notes\n */\n\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nexport interface Conversation {\n  id: string;\n  title: string;\n  conversation_type: string;\n  participants: string[];\n  messages: Array<{ speaker: string; text: string; timestamp?: string }>;\n  metadata?: {\n    extraction_result?: ExtractionResult;\n    extractedEntities?: Entity[];\n    extractedRelationships?: Relationship[];\n    aiProcessedAt?: string;\n  };\n  summary?: string;\n  created_at: string;\n}\n\ninterface Entity {\n  id: string;\n  type: string;\n  name: string;\n  properties?: Record<string, unknown>;\n  confidence?: number;\n}\n\ninterface Relationship {\n  id: string;\n  from_id: string;\n  to_id: string;\n  relation: string;\n}\n\ninterface ExtractionResult {\n  summary?: string;\n  entities?: Entity[];\n  relationships?: Relationship[];\n  facts?: Array<{ id: string; content: string; category?: string; confidence?: number }>;\n  decisions?: Array<{ id: string; content: string; owner_id?: string; confidence?: number }>;\n  action_items?: Array<{ id: string; task: string; owner?: string; status?: string }>;\n  questions?: Array<{ id: string; content: string }>;\n  notes_rendered_text?: string;\n  notes?: {\n    key_points?: Array<{ text: string }>;\n    outline?: Array<{ topic: string; bullets: Array<{ text: string }> }>;\n  };\n}\n\nlet currentTab = 'messages';\n\n/**\n * Show conversation preview modal\n */\nexport function showConversationPreviewModal(conversation: Conversation, onClose?: () => void): void {\n  const existing = document.querySelector('.conversation-preview-overlay');\n  if (existing) existing.remove();\n\n  const content = document.createElement('div');\n  content.className = 'conversation-preview-modal';\n  content.innerHTML = `\n    <style>\n      .conversation-preview-modal {\n        display: flex;\n        flex-direction: column;\n        height: 80vh;\n        max-height: 800px;\n        width: 900px;\n        max-width: 95vw;\n      }\n      .conv-preview-header {\n        display: flex;\n        align-items: center;\n        gap: 16px;\n        padding: 20px 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\n      }\n      .conv-preview-icon {\n        width: 48px;\n        height: 48px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n        background: rgba(var(--primary-rgb), 0.1);\n        border-radius: 12px;\n      }\n      .conv-preview-title {\n        font-size: 18px;\n        font-weight: 600;\n        margin: 0 0 4px 0;\n      }\n      .conv-preview-meta {\n        font-size: 13px;\n        color: var(--text-secondary);\n        display: flex;\n        gap: 16px;\n      }\n      .conv-preview-tabs {\n        display: flex;\n        gap: 4px;\n        padding: 0 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .conv-preview-tab {\n        padding: 12px 16px;\n        background: none;\n        border: none;\n        border-bottom: 2px solid transparent;\n        color: var(--text-secondary);\n        cursor: pointer;\n        font-size: 14px;\n        transition: all 0.15s ease;\n      }\n      .conv-preview-tab:hover {\n        color: var(--text-primary);\n      }\n      .conv-preview-tab.active {\n        color: var(--primary);\n        border-bottom-color: var(--primary);\n      }\n      .conv-preview-tab-badge {\n        background: var(--bg-tertiary);\n        padding: 2px 8px;\n        border-radius: 10px;\n        font-size: 11px;\n        margin-left: 6px;\n      }\n      .conv-preview-body {\n        flex: 1;\n        overflow-y: auto;\n        padding: 20px 24px;\n      }\n      .conv-preview-section {\n        display: none;\n      }\n      .conv-preview-section.active {\n        display: block;\n      }\n      .messages-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      .message-item {\n        padding: 12px 16px;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n      }\n      .message-speaker {\n        font-weight: 600;\n        color: var(--primary);\n        margin-bottom: 4px;\n      }\n      .message-text {\n        color: var(--text-primary);\n        line-height: 1.5;\n      }\n      .message-time {\n        font-size: 11px;\n        color: var(--text-tertiary);\n        margin-top: 4px;\n      }\n      .entity-card {\n        padding: 12px 16px;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        margin-bottom: 8px;\n      }\n      .entity-type {\n        font-size: 11px;\n        text-transform: uppercase;\n        color: var(--text-secondary);\n        margin-bottom: 4px;\n      }\n      .entity-content {\n        color: var(--text-primary);\n      }\n      .entity-meta {\n        font-size: 12px;\n        color: var(--text-tertiary);\n        margin-top: 4px;\n      }\n      .section-title {\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        margin-bottom: 12px;\n        text-transform: uppercase;\n      }\n      .empty-section {\n        text-align: center;\n        padding: 40px;\n        color: var(--text-tertiary);\n      }\n      .notes-rendered {\n        padding: 20px;\n        background: var(--bg-secondary);\n        border-radius: 12px;\n        line-height: 1.7;\n      }\n      .notes-header {\n        font-size: 18px;\n        font-weight: 600;\n        margin-bottom: 4px;\n      }\n      .notes-meta {\n        font-size: 13px;\n        color: var(--text-secondary);\n        margin-bottom: 20px;\n        padding-bottom: 16px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      .notes-topic {\n        margin-bottom: 20px;\n      }\n      .notes-topic-title {\n        font-size: 15px;\n        font-weight: 600;\n        margin-bottom: 10px;\n        padding-left: 8px;\n        border-left: 3px solid var(--primary);\n      }\n      .notes-bullet {\n        padding: 10px 12px;\n        background: var(--bg-primary);\n        border-radius: 8px;\n        margin-bottom: 8px;\n        font-size: 14px;\n        line-height: 1.6;\n      }\n    </style>\n    \n    <div class=\"conv-preview-header\">\n      <div class=\"conv-preview-icon\"></div>\n      <div style=\"flex: 1;\">\n        <h2 class=\"conv-preview-title\">${escapeHtml(conversation.title || 'Untitled Conversation')}</h2>\n        <div class=\"conv-preview-meta\">\n          <span>${conversation.participants?.length || 0} participants</span>\n          <span>${conversation.messages?.length || 0} messages</span>\n          <span>${formatRelativeTime(conversation.created_at)}</span>\n        </div>\n      </div>\n      <button class=\"btn btn-sm close-btn\" style=\"font-size: 20px; padding: 4px 12px;\"></button>\n    </div>\n    \n    <div class=\"conv-preview-tabs\">\n      <button class=\"conv-preview-tab active\" data-tab=\"messages\">Messages</button>\n      <button class=\"conv-preview-tab\" data-tab=\"entities\">\n        Entities\n        <span class=\"conv-preview-tab-badge\" id=\"entities-count\">0</span>\n      </button>\n      <button class=\"conv-preview-tab\" data-tab=\"extraction\">\n        Extraction\n        <span class=\"conv-preview-tab-badge\" id=\"extraction-count\">0</span>\n      </button>\n      <button class=\"conv-preview-tab\" data-tab=\"notes\" id=\"notes-tab\" style=\"display:none\">\n        Notes\n      </button>\n    </div>\n    \n    <div class=\"conv-preview-body\">\n      <div class=\"conv-preview-section active\" data-section=\"messages\" id=\"messages-container\">\n        <div class=\"messages-list\">\n          ${(conversation.messages || []).map(m => `\n            <div class=\"message-item\">\n              <div class=\"message-speaker\">${escapeHtml(m.speaker || 'Unknown')}</div>\n              <div class=\"message-text\">${escapeHtml(m.text || '')}</div>\n              ${m.timestamp ? `<div class=\"message-time\">${m.timestamp}</div>` : ''}\n            </div>\n          `).join('')}\n        </div>\n      </div>\n      \n      <div class=\"conv-preview-section\" data-section=\"entities\" id=\"entities-container\">\n        <div class=\"empty-section\">Loading entities...</div>\n      </div>\n      \n      <div class=\"conv-preview-section\" data-section=\"extraction\" id=\"extraction-container\">\n        <div class=\"empty-section\">Loading extraction results...</div>\n      </div>\n      \n      <div class=\"conv-preview-section\" data-section=\"notes\" id=\"notes-container\">\n        <div class=\"empty-section\">No notes available</div>\n      </div>\n    </div>\n  `;\n\n  // Tab switching\n  content.querySelectorAll('.conv-preview-tab').forEach(tab => {\n    tab.addEventListener('click', () => {\n      const tabName = (tab as HTMLElement).dataset.tab;\n      content.querySelectorAll('.conv-preview-tab').forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      content.querySelectorAll('.conv-preview-section').forEach(s => s.classList.remove('active'));\n      content.querySelector(`[data-section=\"${tabName}\"]`)?.classList.add('active');\n    });\n  });\n\n  // Close button\n  content.querySelector('.close-btn')?.addEventListener('click', () => {\n    overlay.remove();\n    onClose?.();\n  });\n\n  // Load extraction data\n  loadExtractionData(content, conversation);\n\n  // Create overlay\n  const overlay = document.createElement('div');\n  overlay.className = 'modal-overlay conversation-preview-overlay';\n  overlay.style.cssText = `\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(4px);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n  `;\n\n  const modal = document.createElement('div');\n  modal.style.cssText = `\n    background: var(--bg-primary);\n    border-radius: 16px;\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n    overflow: hidden;\n  `;\n  modal.appendChild(content);\n  overlay.appendChild(modal);\n\n  // Close on backdrop click\n  overlay.addEventListener('click', (e) => {\n    if (e.target === overlay) {\n      overlay.remove();\n      onClose?.();\n    }\n  });\n\n  // Close on escape\n  const handleEsc = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      overlay.remove();\n      onClose?.();\n      document.removeEventListener('keydown', handleEsc);\n    }\n  };\n  document.addEventListener('keydown', handleEsc);\n\n  document.body.appendChild(overlay);\n}\n\n/**\n * Load extraction data from conversation metadata\n */\nfunction loadExtractionData(container: HTMLElement, conversation: Conversation): void {\n  const meta = conversation.metadata;\n  const extraction = meta?.extraction_result;\n  \n  // Update entities tab\n  const entities = meta?.extractedEntities || extraction?.entities || [];\n  const entitiesContainer = container.querySelector('#entities-container') as HTMLElement;\n  const entitiesCount = container.querySelector('#entities-count') as HTMLElement;\n  \n  if (entitiesCount) entitiesCount.textContent = String(entities.length);\n  \n  if (entities.length > 0) {\n    entitiesContainer.innerHTML = entities.map(e => `\n      <div class=\"entity-card\">\n        <div class=\"entity-type\">${escapeHtml(e.type)}</div>\n        <div class=\"entity-content\">${escapeHtml(e.name)}</div>\n        ${e.confidence ? `<div class=\"entity-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\n      </div>\n    `).join('');\n  } else {\n    entitiesContainer.innerHTML = '<div class=\"empty-section\">No entities extracted</div>';\n  }\n  \n  // Update extraction tab\n  const extractionContainer = container.querySelector('#extraction-container') as HTMLElement;\n  const facts = extraction?.facts || [];\n  const decisions = extraction?.decisions || [];\n  const actions = extraction?.action_items || [];\n  const questions = extraction?.questions || [];\n  \n  const extractionCount = container.querySelector('#extraction-count') as HTMLElement;\n  const totalItems = facts.length + decisions.length + actions.length + questions.length;\n  if (extractionCount) extractionCount.textContent = String(totalItems);\n  \n  if (totalItems > 0) {\n    let html = '';\n    \n    if (facts.length > 0) {\n      html += `<div class=\"section-title\">Facts (${facts.length})</div>`;\n      html += facts.map(f => `\n        <div class=\"entity-card\">\n          <div class=\"entity-type\">${f.category || 'fact'}</div>\n          <div class=\"entity-content\">${escapeHtml(f.content)}</div>\n        </div>\n      `).join('');\n    }\n    \n    if (decisions.length > 0) {\n      html += `<div class=\"section-title\" style=\"margin-top: 20px;\">Decisions (${decisions.length})</div>`;\n      html += decisions.map(d => `\n        <div class=\"entity-card\">\n          <div class=\"entity-content\">${escapeHtml(d.content)}</div>\n        </div>\n      `).join('');\n    }\n    \n    if (actions.length > 0) {\n      html += `<div class=\"section-title\" style=\"margin-top: 20px;\">Action Items (${actions.length})</div>`;\n      html += actions.map(a => `\n        <div class=\"entity-card\">\n          <div class=\"entity-content\">${escapeHtml(a.task)}</div>\n          ${a.owner ? `<div class=\"entity-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\n        </div>\n      `).join('');\n    }\n    \n    if (questions.length > 0) {\n      html += `<div class=\"section-title\" style=\"margin-top: 20px;\">Questions (${questions.length})</div>`;\n      html += questions.map(q => `\n        <div class=\"entity-card\">\n          <div class=\"entity-content\">${escapeHtml(q.content)}</div>\n        </div>\n      `).join('');\n    }\n    \n    extractionContainer.innerHTML = html;\n  } else {\n    extractionContainer.innerHTML = '<div class=\"empty-section\">No extraction results available</div>';\n  }\n  \n  // Update notes tab\n  const notesContainer = container.querySelector('#notes-container') as HTMLElement;\n  const notesTab = container.querySelector('#notes-tab') as HTMLElement;\n  const notesText = extraction?.notes_rendered_text;\n  \n  if (notesText) {\n    if (notesTab) notesTab.style.display = '';\n    notesContainer.innerHTML = `\n      <div class=\"notes-rendered\">\n        ${renderNotesAsHtml(notesText)}\n        <div style=\"margin-top: 16px;\">\n          <button class=\"btn btn-secondary btn-sm\" id=\"copy-notes-btn\"> Copy Notes</button>\n        </div>\n      </div>\n    `;\n    \n    container.querySelector('#copy-notes-btn')?.addEventListener('click', () => {\n      navigator.clipboard.writeText(notesText);\n      toast.success('Notes copied to clipboard');\n    });\n  } else if (extraction?.notes?.outline?.length) {\n    if (notesTab) notesTab.style.display = '';\n    const outline = extraction.notes.outline;\n    notesContainer.innerHTML = `\n      <div class=\"notes-rendered\">\n        ${outline.map(t => `\n          <div class=\"notes-topic\">\n            <div class=\"notes-topic-title\">${escapeHtml(t.topic)}</div>\n            ${t.bullets?.map(b => `<div class=\"notes-bullet\">${escapeHtml(b.text)}</div>`).join('') || ''}\n          </div>\n        `).join('')}\n      </div>\n    `;\n  }\n}\n\n/**\n * Render notes text as HTML\n */\nfunction renderNotesAsHtml(text: string): string {\n  const lines = text.split('\\n');\n  let html = '';\n  let currentTopic = '';\n  let bulletsHtml = '';\n  let headerDone = false;\n  let metaDone = false;\n  \n  const flushTopic = () => {\n    if (currentTopic && bulletsHtml) {\n      html += `\n        <div class=\"notes-topic\">\n          <div class=\"notes-topic-title\">${escapeHtml(currentTopic)}</div>\n          ${bulletsHtml}\n        </div>\n      `;\n    }\n    currentTopic = '';\n    bulletsHtml = '';\n  };\n  \n  for (const line of lines) {\n    const trimmed = line.trim();\n    if (!trimmed) continue;\n    \n    if (!headerDone && trimmed.startsWith('')) {\n      html += `<div class=\"notes-header\">${escapeHtml(trimmed)}</div>`;\n      headerDone = true;\n      continue;\n    }\n    \n    if (!metaDone && trimmed.startsWith('')) {\n      html += `<div class=\"notes-meta\">${escapeHtml(trimmed)}</div>`;\n      metaDone = true;\n      continue;\n    }\n    \n    if (trimmed.startsWith('-')) {\n      const bulletText = trimmed.substring(1).trim();\n      bulletsHtml += `<div class=\"notes-bullet\">${escapeHtml(bulletText)}</div>`;\n      continue;\n    }\n    \n    flushTopic();\n    currentTopic = trimmed;\n  }\n  \n  flushTopic();\n  \n  if (!html.includes('notes-topic')) {\n    return `<pre style=\"white-space: pre-wrap; font-family: inherit; margin: 0; line-height: 1.6;\">${escapeHtml(text)}</pre>`;\n  }\n  \n  return html;\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showConversationPreviewModal;\n","/**\n * Email Preview Modal - SOTA\n * Full email preview with AI extraction results, entities, analysis\n */\n\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nexport interface EmailData {\n  id: string;\n  subject: string;\n  from: { name: string; email: string };\n  to: Array<{ name: string; email: string }>;\n  cc?: Array<{ name: string; email: string }>;\n  body: string;\n  body_html?: string;\n  date: string;\n  attachments?: Array<{ name: string; size: number }>;\n  // AI extraction fields\n  extracted_entities?: ExtractionResult;\n  ai_summary?: string;\n  detected_intent?: string;\n  sentiment?: string;\n  requires_response?: boolean;\n  processed_at?: string;\n}\n\ninterface ExtractionResult {\n  summary?: string;\n  intent?: string;\n  sentiment?: string;\n  key_points?: string[];\n  action_items?: Array<{ task: string; owner?: string }>;\n  questions?: string[];\n  entities?: Array<{ type: string; name: string; confidence?: number }>;\n  contacts?: Array<{ name: string; email?: string; title?: string; organization?: string }>;\n}\n\nlet currentTab = 'content';\n\n/**\n * Show email preview modal\n */\nexport function showEmailPreviewModal(email: EmailData, onClose?: () => void): void {\n  const existing = document.querySelector('.email-preview-overlay');\n  if (existing) existing.remove();\n\n  const extraction = email.extracted_entities;\n  const hasExtraction = extraction && (\n    extraction.key_points?.length || \n    extraction.action_items?.length || \n    extraction.entities?.length\n  );\n\n  const content = document.createElement('div');\n  content.className = 'email-preview-modal';\n  content.innerHTML = `\n    <style>\n      .email-preview-modal {\n        display: flex;\n        flex-direction: column;\n        height: 80vh;\n        max-height: 800px;\n        width: 900px;\n        max-width: 95vw;\n      }\n      .email-preview-header {\n        display: flex;\n        align-items: flex-start;\n        gap: 16px;\n        padding: 20px 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\n      }\n      .email-preview-icon {\n        width: 48px;\n        height: 48px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n        background: rgba(var(--primary-rgb), 0.1);\n        border-radius: 12px;\n        flex-shrink: 0;\n      }\n      .email-preview-title {\n        font-size: 18px;\n        font-weight: 600;\n        margin: 0 0 8px 0;\n        line-height: 1.3;\n      }\n      .email-preview-meta {\n        font-size: 13px;\n        color: var(--text-secondary);\n      }\n      .email-preview-meta-row {\n        display: flex;\n        gap: 8px;\n        margin-bottom: 4px;\n      }\n      .email-preview-meta-label {\n        color: var(--text-tertiary);\n        min-width: 40px;\n      }\n      .email-preview-badges {\n        display: flex;\n        gap: 8px;\n        margin-top: 8px;\n        flex-wrap: wrap;\n      }\n      .email-badge {\n        display: inline-flex;\n        align-items: center;\n        gap: 4px;\n        padding: 4px 10px;\n        border-radius: 12px;\n        font-size: 12px;\n        font-weight: 500;\n      }\n      .email-badge.intent {\n        background: rgba(var(--primary-rgb), 0.1);\n        color: var(--primary);\n      }\n      .email-badge.sentiment-positive {\n        background: rgba(46, 160, 67, 0.1);\n        color: #2ea043;\n      }\n      .email-badge.sentiment-negative {\n        background: rgba(248, 81, 73, 0.1);\n        color: #f85149;\n      }\n      .email-badge.sentiment-neutral {\n        background: var(--bg-tertiary);\n        color: var(--text-secondary);\n      }\n      .email-badge.response-needed {\n        background: rgba(248, 81, 73, 0.1);\n        color: #f85149;\n      }\n      .email-preview-tabs {\n        display: flex;\n        gap: 4px;\n        padding: 0 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .email-preview-tab {\n        padding: 12px 16px;\n        background: none;\n        border: none;\n        border-bottom: 2px solid transparent;\n        color: var(--text-secondary);\n        cursor: pointer;\n        font-size: 14px;\n        transition: all 0.15s ease;\n      }\n      .email-preview-tab:hover {\n        color: var(--text-primary);\n      }\n      .email-preview-tab.active {\n        color: var(--primary);\n        border-bottom-color: var(--primary);\n      }\n      .email-preview-tab-badge {\n        background: var(--bg-tertiary);\n        padding: 2px 8px;\n        border-radius: 10px;\n        font-size: 11px;\n        margin-left: 6px;\n      }\n      .email-preview-body {\n        flex: 1;\n        overflow-y: auto;\n        padding: 20px 24px;\n      }\n      .email-preview-section {\n        display: none;\n      }\n      .email-preview-section.active {\n        display: block;\n      }\n      .email-content-body {\n        background: var(--bg-secondary);\n        padding: 20px;\n        border-radius: 12px;\n        line-height: 1.7;\n      }\n      .extraction-card {\n        padding: 12px 16px;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        margin-bottom: 8px;\n      }\n      .extraction-type {\n        font-size: 11px;\n        text-transform: uppercase;\n        color: var(--text-secondary);\n        margin-bottom: 4px;\n      }\n      .extraction-content {\n        color: var(--text-primary);\n      }\n      .extraction-meta {\n        font-size: 12px;\n        color: var(--text-tertiary);\n        margin-top: 4px;\n      }\n      .section-title {\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        margin-bottom: 12px;\n        text-transform: uppercase;\n      }\n      .empty-section {\n        text-align: center;\n        padding: 40px;\n        color: var(--text-tertiary);\n      }\n      .ai-summary-box {\n        padding: 16px;\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\n        border-left: 3px solid var(--primary);\n        border-radius: 8px;\n        margin-bottom: 20px;\n      }\n      .ai-summary-label {\n        font-size: 11px;\n        text-transform: uppercase;\n        color: var(--text-secondary);\n        margin-bottom: 8px;\n      }\n      .key-points-list {\n        list-style: none;\n        padding: 0;\n        margin: 0;\n      }\n      .key-points-list li {\n        padding: 8px 0;\n        border-bottom: 1px solid var(--border-color);\n        display: flex;\n        gap: 8px;\n      }\n      .key-points-list li:last-child {\n        border-bottom: none;\n      }\n      .key-points-list li::before {\n        content: \"\";\n        color: var(--primary);\n      }\n      .contact-card {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 12px;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        margin-bottom: 8px;\n      }\n      .contact-avatar {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background: var(--bg-tertiary);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-weight: 600;\n        color: var(--text-secondary);\n      }\n      .contact-info {\n        flex: 1;\n      }\n      .contact-name {\n        font-weight: 600;\n      }\n      .contact-details {\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n    </style>\n    \n    <div class=\"email-preview-header\">\n      <div class=\"email-preview-icon\"></div>\n      <div style=\"flex: 1;\">\n        <h2 class=\"email-preview-title\">${escapeHtml(email.subject || 'No Subject')}</h2>\n        <div class=\"email-preview-meta\">\n          <div class=\"email-preview-meta-row\">\n            <span class=\"email-preview-meta-label\">From:</span>\n            <span><strong>${escapeHtml(email.from?.name || '')}</strong> &lt;${escapeHtml(email.from?.email || '')}&gt;</span>\n          </div>\n          <div class=\"email-preview-meta-row\">\n            <span class=\"email-preview-meta-label\">To:</span>\n            <span>${(email.to || []).map(r => escapeHtml(r.name || r.email)).join(', ')}</span>\n          </div>\n          <div class=\"email-preview-meta-row\">\n            <span class=\"email-preview-meta-label\">Date:</span>\n            <span>${formatRelativeTime(email.date)}</span>\n          </div>\n        </div>\n        <div class=\"email-preview-badges\">\n          ${extraction?.intent ? `<span class=\"email-badge intent\"> ${escapeHtml(extraction.intent)}</span>` : ''}\n          ${extraction?.sentiment ? `<span class=\"email-badge sentiment-${extraction.sentiment}\">${getSentimentEmoji(extraction.sentiment)} ${escapeHtml(extraction.sentiment)}</span>` : ''}\n          ${email.requires_response ? `<span class=\"email-badge response-needed\"> Response Needed</span>` : ''}\n        </div>\n      </div>\n      <button class=\"btn btn-sm close-btn\" style=\"font-size: 20px; padding: 4px 12px;\"></button>\n    </div>\n    \n    <div class=\"email-preview-tabs\">\n      <button class=\"email-preview-tab active\" data-tab=\"content\">Content</button>\n      <button class=\"email-preview-tab\" data-tab=\"analysis\" ${!hasExtraction ? 'style=\"display:none\"' : ''}>\n        Analysis\n      </button>\n      <button class=\"email-preview-tab\" data-tab=\"entities\" ${!extraction?.entities?.length ? 'style=\"display:none\"' : ''}>\n        Entities\n        <span class=\"email-preview-tab-badge\">${extraction?.entities?.length || 0}</span>\n      </button>\n      <button class=\"email-preview-tab\" data-tab=\"contacts\" ${!extraction?.contacts?.length ? 'style=\"display:none\"' : ''}>\n        Contacts\n        <span class=\"email-preview-tab-badge\">${extraction?.contacts?.length || 0}</span>\n      </button>\n    </div>\n    \n    <div class=\"email-preview-body\">\n      <div class=\"email-preview-section active\" data-section=\"content\">\n        ${extraction?.summary || email.ai_summary ? `\n          <div class=\"ai-summary-box\">\n            <div class=\"ai-summary-label\"> AI Summary</div>\n            <div>${escapeHtml(extraction?.summary || email.ai_summary || '')}</div>\n          </div>\n        ` : ''}\n        <div class=\"email-content-body\">\n          ${email.body_html || escapeHtml(email.body || '').replace(/\\n/g, '<br>')}\n        </div>\n      </div>\n      \n      <div class=\"email-preview-section\" data-section=\"analysis\">\n        ${extraction?.key_points?.length ? `\n          <div class=\"section-title\">Key Points</div>\n          <ul class=\"key-points-list\">\n            ${extraction.key_points.map(p => `<li>${escapeHtml(p)}</li>`).join('')}\n          </ul>\n        ` : ''}\n        \n        ${extraction?.action_items?.length ? `\n          <div class=\"section-title\" style=\"margin-top: 20px;\">Action Items</div>\n          ${extraction.action_items.map(a => `\n            <div class=\"extraction-card\">\n              <div class=\"extraction-content\"> ${escapeHtml(a.task)}</div>\n              ${a.owner ? `<div class=\"extraction-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\n            </div>\n          `).join('')}\n        ` : ''}\n        \n        ${extraction?.questions?.length ? `\n          <div class=\"section-title\" style=\"margin-top: 20px;\">Questions</div>\n          ${extraction.questions.map(q => `\n            <div class=\"extraction-card\">\n              <div class=\"extraction-content\"> ${escapeHtml(q)}</div>\n            </div>\n          `).join('')}\n        ` : ''}\n        \n        ${!extraction?.key_points?.length && !extraction?.action_items?.length && !extraction?.questions?.length ? `\n          <div class=\"empty-section\">No analysis available</div>\n        ` : ''}\n      </div>\n      \n      <div class=\"email-preview-section\" data-section=\"entities\">\n        ${extraction?.entities?.length ? extraction.entities.map(e => `\n          <div class=\"extraction-card\">\n            <div class=\"extraction-type\">${escapeHtml(e.type)}</div>\n            <div class=\"extraction-content\">${escapeHtml(e.name)}</div>\n            ${e.confidence ? `<div class=\"extraction-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\n          </div>\n        `).join('') : '<div class=\"empty-section\">No entities extracted</div>'}\n      </div>\n      \n      <div class=\"email-preview-section\" data-section=\"contacts\">\n        ${extraction?.contacts?.length ? extraction.contacts.map(c => `\n          <div class=\"contact-card\">\n            <div class=\"contact-avatar\">${getInitials(c.name)}</div>\n            <div class=\"contact-info\">\n              <div class=\"contact-name\">${escapeHtml(c.name)}</div>\n              <div class=\"contact-details\">\n                ${c.title ? escapeHtml(c.title) + (c.organization ? ' at ' : '') : ''}\n                ${c.organization ? escapeHtml(c.organization) : ''}\n                ${c.email ? `<br>${escapeHtml(c.email)}` : ''}\n              </div>\n            </div>\n          </div>\n        `).join('') : '<div class=\"empty-section\">No contacts extracted</div>'}\n      </div>\n    </div>\n  `;\n\n  // Tab switching\n  content.querySelectorAll('.email-preview-tab').forEach(tab => {\n    tab.addEventListener('click', () => {\n      const tabName = (tab as HTMLElement).dataset.tab;\n      content.querySelectorAll('.email-preview-tab').forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      content.querySelectorAll('.email-preview-section').forEach(s => s.classList.remove('active'));\n      content.querySelector(`[data-section=\"${tabName}\"]`)?.classList.add('active');\n    });\n  });\n\n  // Close button\n  content.querySelector('.close-btn')?.addEventListener('click', () => {\n    overlay.remove();\n    onClose?.();\n  });\n\n  // Create overlay\n  const overlay = document.createElement('div');\n  overlay.className = 'modal-overlay email-preview-overlay';\n  overlay.style.cssText = `\n    position: fixed;\n    inset: 0;\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(4px);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n  `;\n\n  const modal = document.createElement('div');\n  modal.style.cssText = `\n    background: var(--bg-primary);\n    border-radius: 16px;\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n    overflow: hidden;\n  `;\n  modal.appendChild(content);\n  overlay.appendChild(modal);\n\n  // Close on backdrop click\n  overlay.addEventListener('click', (e) => {\n    if (e.target === overlay) {\n      overlay.remove();\n      onClose?.();\n    }\n  });\n\n  // Close on escape\n  const handleEsc = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      overlay.remove();\n      onClose?.();\n      document.removeEventListener('keydown', handleEsc);\n    }\n  };\n  document.addEventListener('keydown', handleEsc);\n\n  document.body.appendChild(overlay);\n}\n\nfunction getSentimentEmoji(sentiment: string): string {\n  switch (sentiment?.toLowerCase()) {\n    case 'positive': return '';\n    case 'negative': return '';\n    default: return '';\n  }\n}\n\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(p => p[0])\n    .slice(0, 2)\n    .join('')\n    .toUpperCase();\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showEmailPreviewModal;\n","/**\n * Briefing Panel Component\n * Displays daily AI-generated briefing with history\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { chatService, Briefing, BriefingHistoryItem } from '../services/chat';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface BriefingPanelProps {\n  onActionClick?: (action: { type: string; id: string }) => void;\n}\n\nlet currentBriefing: Briefing | null = null;\nlet showHistory = false;\n\n/**\n * Create briefing panel\n */\nexport function createBriefingPanel(props: BriefingPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'briefing-panel' });\n\n  panel.innerHTML = `\n    <div class=\"briefing-header\">\n      <h2>Daily Briefing</h2>\n      <div class=\"briefing-actions\">\n        <button class=\"btn btn-sm\" id=\"toggle-history-btn\">History</button>\n        <button class=\"btn btn-sm btn-primary\" id=\"refresh-briefing-btn\">Refresh</button>\n      </div>\n    </div>\n    <div class=\"briefing-content\" id=\"briefing-content\">\n      <div class=\"loading\">Generating briefing...</div>\n    </div>\n    <div class=\"briefing-history hidden\" id=\"briefing-history\"></div>\n  `;\n\n  // Bind events\n  const refreshBtn = panel.querySelector('#refresh-briefing-btn');\n  if (refreshBtn) {\n    on(refreshBtn as HTMLElement, 'click', () => loadBriefing(panel, true, props));\n  }\n\n  const historyBtn = panel.querySelector('#toggle-history-btn');\n  if (historyBtn) {\n    on(historyBtn as HTMLElement, 'click', () => {\n      showHistory = !showHistory;\n      const historyContainer = panel.querySelector('#briefing-history') as HTMLElement;\n      historyContainer.classList.toggle('hidden', !showHistory);\n      if (showHistory) {\n        loadHistory(historyContainer);\n      }\n    });\n  }\n\n  // Initial load\n  loadBriefing(panel, false, props);\n\n  return panel;\n}\n\n/**\n * Load briefing\n */\nasync function loadBriefing(\n  panel: HTMLElement, \n  refresh: boolean,\n  props: BriefingPanelProps\n): Promise<void> {\n  const content = panel.querySelector('#briefing-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Generating briefing...</div>';\n\n  try {\n    const briefing = await chatService.getBriefing(refresh);\n    currentBriefing = briefing;\n    renderBriefing(content, briefing, props);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to generate briefing</div>';\n  }\n}\n\n/**\n * Render briefing content\n */\nfunction renderBriefing(\n  container: HTMLElement, \n  briefing: Briefing,\n  props: BriefingPanelProps\n): void {\n  container.innerHTML = `\n    <div class=\"briefing-meta\">\n      <span class=\"briefing-date\">${formatDate(briefing.generated_at)}</span>\n      ${briefing.cached ? `<span class=\"cached-badge\">Cached</span>` : ''}\n    </div>\n\n    <div class=\"briefing-text\">\n      ${renderMarkdown(briefing.briefing)}\n    </div>\n\n    ${briefing.analysis ? `\n      <div class=\"briefing-analysis\">\n        <h4>Analysis</h4>\n        <div class=\"analysis-content\">${renderMarkdown(briefing.analysis)}</div>\n      </div>\n    ` : ''}\n\n  `;\n}\n\n/**\n * Load briefing history\n */\nasync function loadHistory(container: HTMLElement): Promise<void> {\n  container.innerHTML = '<div class=\"loading\">Loading history...</div>';\n\n  try {\n    const history = await chatService.getBriefingHistory(10);\n    \n    if (!history || history.length === 0) {\n      container.innerHTML = '<p class=\"empty\">No previous briefings</p>';\n      return;\n    }\n\n    container.innerHTML = `\n      <h4>Previous Briefings</h4>\n      <div class=\"history-list\">\n        ${history.map((item: BriefingHistoryItem) => `\n          <div class=\"history-item\" data-id=\"${item.id}\">\n            <div class=\"history-date\">${formatDate(item.generated_at)}</div>\n            <div class=\"history-preview\">${escapeHtml(item.briefing.substring(0, 150))}...</div>\n          </div>\n        `).join('')}\n      </div>\n    `;\n\n    // Bind click events\n    container.querySelectorAll('.history-item').forEach(item => {\n      on(item as HTMLElement, 'click', () => {\n        const id = item.getAttribute('data-id');\n        const historyItem = history.find((h: BriefingHistoryItem) => h.id === id);\n        if (historyItem) {\n          showHistoryDetail(container.closest('.briefing-panel') as HTMLElement, historyItem);\n        }\n      });\n    });\n  } catch {\n    container.innerHTML = '<div class=\"error\">Failed to load history</div>';\n  }\n}\n\n/**\n * Show history detail\n */\nfunction showHistoryDetail(panel: HTMLElement, item: BriefingHistoryItem): void {\n  const content = panel.querySelector('#briefing-content') as HTMLElement;\n  \n  content.innerHTML = `\n    <div class=\"history-detail\">\n      <button class=\"btn btn-sm back-btn\" id=\"back-to-current\"> Back to current</button>\n      <div class=\"briefing-meta\">\n        <span class=\"briefing-date\">${formatDate(item.generated_at)}</span>\n        <span class=\"history-badge\">Historical</span>\n      </div>\n      <div class=\"briefing-text\">${renderMarkdown(item.briefing)}</div>\n    </div>\n  `;\n\n  const backBtn = content.querySelector('#back-to-current');\n  if (backBtn && currentBriefing) {\n    on(backBtn as HTMLElement, 'click', () => {\n      renderBriefing(content, currentBriefing!, {});\n    });\n  }\n}\n\n/**\n * Simple markdown renderer\n */\nfunction renderMarkdown(text: string): string {\n  return text\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n    .replace(/^### (.*$)/gm, '<h5>$1</h5>')\n    .replace(/^## (.*$)/gm, '<h4>$1</h4>')\n    .replace(/^# (.*$)/gm, '<h3>$1</h3>')\n    .replace(/^- (.*$)/gm, '<li>$1</li>')\n    .replace(/(<li>.*<\\/li>)/gs, '<ul>$1</ul>')\n    .replace(/\\n\\n/g, '</p><p>')\n    .replace(/^(.+)$/gm, '<p>$1</p>')\n    .replace(/<p><\\/p>/g, '')\n    .replace(/<p>(<[hul])/g, '$1')\n    .replace(/(<\\/[hul][^>]*>)<\\/p>/g, '$1');\n}\n\n/**\n * Format date\n */\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString(undefined, {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n}\n\n/**\n * Format label\n */\nfunction formatLabel(key: string): string {\n  return key\n    .replace(/_/g, ' ')\n    .replace(/([A-Z])/g, ' $1')\n    .replace(/^./, str => str.toUpperCase());\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createBriefingPanel;\n","/**\n * Reports Panel Component\n * Weekly reports and executive summaries with export\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { chatService } from '../services/chat';\nimport { toast } from '../services/toast';\n\nexport interface ReportsPanelProps {\n  onExport?: (type: 'pdf' | 'md', content: string) => void;\n}\n\ntype ReportType = 'weekly' | 'executive';\n\nlet currentReport: string = '';\nlet currentType: ReportType = 'weekly';\n\n/**\n * Create reports panel\n */\nexport function createReportsPanel(props: ReportsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'reports-panel' });\n\n  panel.innerHTML = `\n    <div class=\"reports-header\">\n      <h2>Reports</h2>\n      <div class=\"reports-actions\">\n        <button class=\"btn btn-sm\" id=\"export-md-btn\">Export MD</button>\n        <button class=\"btn btn-sm btn-primary\" id=\"export-pdf-btn\">Export PDF</button>\n      </div>\n    </div>\n    <div class=\"reports-tabs\">\n      <button class=\"report-tab active\" data-type=\"weekly\">Weekly Report</button>\n      <button class=\"report-tab\" data-type=\"executive\">Executive Summary</button>\n    </div>\n    <div class=\"reports-content\" id=\"reports-content\">\n      <div class=\"loading\">Generating report...</div>\n    </div>\n  `;\n\n  // Bind tab events\n  const tabs = panel.querySelectorAll('.report-tab');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentType = tab.getAttribute('data-type') as ReportType;\n      loadReport(panel, currentType);\n    });\n  });\n\n  // Export buttons\n  const exportMdBtn = panel.querySelector('#export-md-btn');\n  if (exportMdBtn) {\n    on(exportMdBtn as HTMLElement, 'click', () => exportReport('md', props));\n  }\n\n  const exportPdfBtn = panel.querySelector('#export-pdf-btn');\n  if (exportPdfBtn) {\n    on(exportPdfBtn as HTMLElement, 'click', () => exportReport('pdf', props));\n  }\n\n  // Initial load\n  loadReport(panel, 'weekly');\n\n  return panel;\n}\n\n/**\n * Load report\n */\nasync function loadReport(panel: HTMLElement, type: ReportType): Promise<void> {\n  const content = panel.querySelector('#reports-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Generating report...</div>';\n\n  try {\n    let report: string;\n\n    if (type === 'weekly') {\n      report = await chatService.getWeeklyReport();\n    } else {\n      report = await chatService.generateExecutiveSummary();\n    }\n\n    currentReport = report;\n    renderReport(content, report);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to generate report</div>';\n  }\n}\n\n/**\n * Render report\n */\nfunction renderReport(container: HTMLElement, markdown: string): void {\n  container.innerHTML = `\n    <div class=\"report-preview\">\n      ${renderMarkdown(markdown)}\n    </div>\n  `;\n}\n\n/**\n * Export report\n */\nasync function exportReport(format: 'pdf' | 'md', props: ReportsPanelProps): Promise<void> {\n  if (!currentReport) {\n    toast.error('No report to export');\n    return;\n  }\n\n  if (props.onExport) {\n    props.onExport(format, currentReport);\n    return;\n  }\n\n  if (format === 'md') {\n    downloadFile(`${currentType}-report.md`, currentReport, 'text/markdown');\n    toast.success('Report downloaded');\n  } else if (format === 'pdf') {\n    await exportToPdf(currentReport, `${currentType}-report`);\n  }\n}\n\n/**\n * Download file\n */\nfunction downloadFile(filename: string, content: string, mimeType: string): void {\n  const blob = new Blob([content], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n}\n\n/**\n * Export to PDF using html2pdf.js\n */\nasync function exportToPdf(markdown: string, filename: string): Promise<void> {\n  // Check if html2pdf is available\n  const html2pdf = (window as unknown as { html2pdf?: unknown }).html2pdf;\n  \n  if (!html2pdf) {\n    // Fallback: download as HTML\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset=\"utf-8\">\n        <title>${filename}</title>\n        <style>\n          body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 40px; }\n          h1 { color: #1a1a2e; }\n          h2 { color: #16213e; border-bottom: 1px solid #eee; padding-bottom: 10px; }\n          h3 { color: #0f3460; }\n          ul { padding-left: 20px; }\n          li { margin: 5px 0; }\n        </style>\n      </head>\n      <body>\n        ${renderMarkdown(markdown)}\n      </body>\n      </html>\n    `;\n    downloadFile(`${filename}.html`, html, 'text/html');\n    toast.info('Downloaded as HTML (PDF library not available)');\n    return;\n  }\n\n  // Create temporary element for PDF generation\n  const tempDiv = document.createElement('div');\n  tempDiv.innerHTML = renderMarkdown(markdown);\n  tempDiv.style.cssText = 'font-family: system-ui, sans-serif; padding: 40px; max-width: 800px;';\n  document.body.appendChild(tempDiv);\n\n  try {\n    await (html2pdf as (element: HTMLElement) => { save: (filename: string) => Promise<void> })(tempDiv)\n      .save(`${filename}.pdf`);\n    toast.success('PDF exported');\n  } catch {\n    toast.error('Failed to export PDF');\n  } finally {\n    document.body.removeChild(tempDiv);\n  }\n}\n\n/**\n * Simple markdown renderer\n */\nfunction renderMarkdown(text: string): string {\n  return text\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n    .replace(/^### (.*$)/gm, '<h3>$1</h3>')\n    .replace(/^## (.*$)/gm, '<h2>$1</h2>')\n    .replace(/^# (.*$)/gm, '<h1>$1</h1>')\n    .replace(/^- (.*$)/gm, '<li>$1</li>')\n    .replace(/(<li>.*<\\/li>)/gs, '<ul>$1</ul>')\n    .replace(/\\n\\n/g, '</p><p>')\n    .replace(/^(.+)$/gm, '<p>$1</p>')\n    .replace(/<p><\\/p>/g, '')\n    .replace(/<p>(<[hul])/g, '$1')\n    .replace(/(<\\/[hul][^>]*>)<\\/p>/g, '$1');\n}\n\nexport default createReportsPanel;\n","/**\n * Contacts Panel Component - SOTA Design\n * Contact list with search, filters, favorites, and management\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { contactsService, Contact } from '../services/contacts';\nimport { showContactModal } from './modals/ContactModal';\nimport { toast } from '../services/toast';\nimport { http } from '../services/api';\n\nexport interface ContactsPanelProps {\n  onContactClick?: (contact: Contact) => void;\n}\n\nlet currentSearch = '';\nlet currentFilter: { organization?: string; tag?: string; favorites?: boolean } = {};\nlet allContacts: Contact[] = [];\nlet selectedContactIds: Set<string> = new Set();\n\n/**\n * Create contacts panel\n */\nexport function createContactsPanel(props: ContactsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'contacts-panel-sota' });\n\n  panel.innerHTML = `\n    <style>\n      .contacts-panel-sota {\n        padding: 24px;\n        min-height: 100%;\n      }\n\n      /* Header */\n      .contacts-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 24px;\n        flex-wrap: wrap;\n        gap: 16px;\n      }\n\n      .contacts-title {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n\n      .contacts-title-icon {\n        width: 48px;\n        height: 48px;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        border-radius: 14px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 4px 12px rgba(225, 29, 72, 0.3);\n      }\n\n      .contacts-title-icon svg {\n        width: 26px;\n        height: 26px;\n        color: white;\n      }\n\n      .contacts-title h1 {\n        margin: 0;\n        font-size: 28px;\n        font-weight: 700;\n        color: var(--text-primary);\n      }\n\n      .contacts-count {\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        color: white;\n        padding: 4px 12px;\n        border-radius: 20px;\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .contacts-actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n\n      /* Search Bar */\n      .contacts-search-wrapper {\n        position: relative;\n        flex: 1;\n        max-width: 400px;\n        min-width: 200px;\n      }\n\n      .contacts-search-wrapper svg {\n        position: absolute;\n        left: 14px;\n        top: 50%;\n        transform: translateY(-50%);\n        width: 18px;\n        height: 18px;\n        color: var(--text-tertiary);\n        pointer-events: none;\n        transition: color 0.2s;\n      }\n\n      .contacts-search {\n        width: 100%;\n        padding: 12px 14px 12px 44px;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        font-size: 14px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        transition: all 0.2s;\n      }\n\n      .contacts-search:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n\n      .contacts-search:focus + svg {\n        color: #e11d48;\n      }\n\n      /* SOTA Buttons */\n      .btn-sota {\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 10px 18px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n      }\n\n      .btn-sota.primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 12px rgba(225, 29, 72, 0.3);\n      }\n\n      .btn-sota.primary:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 6px 16px rgba(225, 29, 72, 0.4);\n      }\n\n      .btn-sota.secondary {\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n\n      .btn-sota.secondary:hover {\n        background: var(--bg-tertiary);\n        border-color: #e11d48;\n      }\n\n      .btn-sota svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* Filters */\n      .contacts-filters {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        margin-bottom: 20px;\n        flex-wrap: wrap;\n      }\n\n      .filter-chip {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        padding: 8px 14px;\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        border-radius: 20px;\n        font-size: 13px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n\n      .filter-chip:hover {\n        background: var(--bg-tertiary);\n        border-color: #e11d48;\n        color: #e11d48;\n      }\n\n      .filter-chip.active {\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\n        border-color: #e11d48;\n        color: #e11d48;\n      }\n\n      .filter-chip svg {\n        width: 14px;\n        height: 14px;\n      }\n\n      .filter-select {\n        padding: 8px 32px 8px 12px;\n        border: 1px solid var(--border-color);\n        border-radius: 20px;\n        font-size: 13px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        cursor: pointer;\n        appearance: none;\n        background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E\");\n        background-repeat: no-repeat;\n        background-position: right 12px center;\n      }\n\n      .filter-select:focus {\n        outline: none;\n        border-color: #e11d48;\n      }\n\n      /* Alerts */\n      .contacts-alerts {\n        margin-bottom: 20px;\n      }\n\n      .alert-sota {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 14px 18px;\n        background: linear-gradient(135deg, rgba(245,158,11,0.1) 0%, rgba(245,158,11,0.05) 100%);\n        border: 1px solid rgba(245,158,11,0.3);\n        border-radius: 12px;\n        color: #d97706;\n      }\n\n      .alert-sota svg {\n        width: 20px;\n        height: 20px;\n        flex-shrink: 0;\n      }\n\n      .alert-sota span {\n        flex: 1;\n        font-size: 14px;\n      }\n\n      .alert-sota .btn-sota {\n        padding: 6px 12px;\n        font-size: 12px;\n      }\n\n      /* Favorites Section */\n      .favorites-section {\n        margin-bottom: 28px;\n      }\n\n      .section-header {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        margin-bottom: 14px;\n        color: var(--text-secondary);\n        font-size: 13px;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n\n      .section-header svg {\n        width: 16px;\n        height: 16px;\n        color: #f59e0b;\n      }\n\n      .favorites-grid {\n        display: flex;\n        gap: 12px;\n        overflow-x: auto;\n        padding-bottom: 8px;\n      }\n\n      .favorite-card {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        padding: 12px 16px;\n        background: linear-gradient(135deg, rgba(245,158,11,0.08) 0%, rgba(245,158,11,0.02) 100%);\n        border: 1px solid rgba(245,158,11,0.2);\n        border-radius: 12px;\n        cursor: pointer;\n        transition: all 0.2s;\n        white-space: nowrap;\n      }\n\n      .favorite-card:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(245,158,11,0.15);\n        border-color: #f59e0b;\n      }\n\n      .favorite-avatar {\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #f59e0b, #d97706);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 13px;\n        font-weight: 600;\n        color: white;\n        flex-shrink: 0;\n        overflow: hidden;\n      }\n\n      .favorite-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .favorite-info h4 {\n        margin: 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n\n      .favorite-info p {\n        margin: 2px 0 0 0;\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n\n      /* Contacts Grid */\n      .contacts-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n        gap: 16px;\n      }\n\n      .contact-card-sota {\n        background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.5) 100%);\n        border: 1px solid var(--border-color);\n        border-radius: 16px;\n        padding: 20px;\n        cursor: pointer;\n        transition: all 0.25s ease;\n        position: relative;\n        overflow: hidden;\n      }\n\n      [data-theme=\"dark\"] .contact-card-sota {\n        background: linear-gradient(135deg, rgba(30,41,59,0.9) 0%, rgba(30,41,59,0.5) 100%);\n      }\n\n      .contact-card-sota:hover {\n        transform: translateY(-4px);\n        box-shadow: 0 12px 32px rgba(0,0,0,0.1);\n        border-color: rgba(225,29,72,0.3);\n      }\n\n      .contact-card-sota::before {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        height: 4px;\n        background: linear-gradient(90deg, #e11d48, #f59e0b);\n        opacity: 0;\n        transition: opacity 0.2s;\n      }\n\n      .contact-card-sota:hover::before {\n        opacity: 1;\n      }\n\n      .contact-card-header {\n        display: flex;\n        align-items: flex-start;\n        gap: 14px;\n        margin-bottom: 14px;\n      }\n\n      .contact-avatar-sota {\n        width: 56px;\n        height: 56px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 20px;\n        font-weight: 700;\n        color: white;\n        flex-shrink: 0;\n        overflow: hidden;\n        box-shadow: 0 4px 12px rgba(225,29,72,0.25);\n      }\n\n      .contact-avatar-sota img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .contact-main-info {\n        flex: 1;\n        min-width: 0;\n      }\n\n      .contact-name-sota {\n        margin: 0 0 4px 0;\n        font-size: 17px;\n        font-weight: 700;\n        color: var(--text-primary);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n\n      .contact-role-badge {\n        display: inline-flex;\n        align-items: center;\n        gap: 4px;\n        padding: 4px 10px;\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\n        border-radius: 6px;\n        font-size: 12px;\n        font-weight: 600;\n        color: #e11d48;\n        margin-bottom: 4px;\n      }\n\n      .contact-org-sota {\n        font-size: 13px;\n        color: var(--text-secondary);\n        display: flex;\n        align-items: center;\n        gap: 4px;\n      }\n\n      .contact-org-sota svg {\n        width: 14px;\n        height: 14px;\n        opacity: 0.6;\n      }\n\n      .contact-details-sota {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n        padding-top: 12px;\n        border-top: 1px solid var(--border-color);\n      }\n\n      .contact-detail-item {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 13px;\n        color: var(--text-secondary);\n      }\n\n      .contact-detail-item svg {\n        width: 14px;\n        height: 14px;\n        color: #e11d48;\n        flex-shrink: 0;\n      }\n\n      .contact-detail-item span {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n\n      .contact-tags-sota {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 12px;\n      }\n\n      .contact-tag {\n        padding: 3px 8px;\n        background: var(--bg-tertiary);\n        border-radius: 4px;\n        font-size: 11px;\n        font-weight: 500;\n        color: var(--text-secondary);\n      }\n\n      .contact-quick-actions {\n        position: absolute;\n        top: 12px;\n        right: 12px;\n        display: flex;\n        gap: 6px;\n        opacity: 0;\n        transition: opacity 0.2s;\n      }\n\n      .contact-card-sota:hover .contact-quick-actions {\n        opacity: 1;\n      }\n\n      .quick-action-btn {\n        width: 32px;\n        height: 32px;\n        border-radius: 8px;\n        background: var(--bg-primary);\n        border: 1px solid var(--border-color);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n\n      .quick-action-btn:hover {\n        background: #e11d48;\n        border-color: #e11d48;\n        color: white;\n      }\n\n      .quick-action-btn.favorite {\n        color: #f59e0b;\n      }\n\n      .quick-action-btn.favorite.active {\n        background: #f59e0b;\n        border-color: #f59e0b;\n        color: white;\n      }\n\n      .quick-action-btn svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* Selection Checkbox */\n      .contact-select-checkbox {\n        position: absolute;\n        top: 12px;\n        left: 12px;\n        width: 22px;\n        height: 22px;\n        border-radius: 6px;\n        border: 2px solid var(--border-color);\n        background: var(--bg-primary);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: all 0.2s;\n        z-index: 5;\n        opacity: 0;\n      }\n\n      .contact-card-sota:hover .contact-select-checkbox,\n      .contact-card-sota.selected .contact-select-checkbox {\n        opacity: 1;\n      }\n\n      .contact-select-checkbox:hover {\n        border-color: #e11d48;\n      }\n\n      .contact-select-checkbox.checked {\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        border-color: #e11d48;\n      }\n\n      .contact-select-checkbox svg {\n        width: 14px;\n        height: 14px;\n        color: white;\n        display: none;\n      }\n\n      .contact-select-checkbox.checked svg {\n        display: block;\n      }\n\n      .contact-card-sota.selected {\n        border-color: #e11d48;\n        box-shadow: 0 0 0 2px rgba(225,29,72,0.2);\n      }\n\n      /* Selection Bar */\n      .selection-bar {\n        position: fixed;\n        bottom: 24px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: linear-gradient(135deg, #1e293b, #0f172a);\n        padding: 12px 24px;\n        border-radius: 50px;\n        display: flex;\n        align-items: center;\n        gap: 16px;\n        box-shadow: 0 10px 40px rgba(0,0,0,0.3);\n        z-index: 1000;\n        animation: slideUp 0.3s ease;\n      }\n\n      @keyframes slideUp {\n        from { transform: translateX(-50%) translateY(100px); opacity: 0; }\n        to { transform: translateX(-50%) translateY(0); opacity: 1; }\n      }\n\n      .selection-bar-count {\n        color: white;\n        font-size: 14px;\n        font-weight: 600;\n      }\n\n      .selection-bar-count span {\n        color: #f59e0b;\n      }\n\n      .selection-bar-btn {\n        padding: 10px 20px;\n        border-radius: 25px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        transition: all 0.2s;\n        border: none;\n      }\n\n      .selection-bar-btn.merge {\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        color: white;\n      }\n\n      .selection-bar-btn.merge:hover {\n        transform: scale(1.05);\n        box-shadow: 0 4px 12px rgba(225,29,72,0.4);\n      }\n\n      .selection-bar-btn.cancel {\n        background: rgba(255,255,255,0.1);\n        color: white;\n        border: 1px solid rgba(255,255,255,0.2);\n      }\n\n      .selection-bar-btn.cancel:hover {\n        background: rgba(255,255,255,0.2);\n      }\n\n      .selection-bar-btn svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* Empty State */\n      .contacts-empty-state {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 80px 24px;\n        text-align: center;\n      }\n\n      .contacts-empty-state svg {\n        width: 80px;\n        height: 80px;\n        color: #e11d48;\n        opacity: 0.4;\n        margin-bottom: 24px;\n      }\n\n      .contacts-empty-state h3 {\n        margin: 0 0 8px 0;\n        font-size: 20px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n\n      .contacts-empty-state p {\n        margin: 0 0 24px 0;\n        font-size: 14px;\n        color: var(--text-secondary);\n      }\n\n      /* Loading */\n      .contacts-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 60px;\n        color: var(--text-secondary);\n      }\n\n      .contacts-loading::after {\n        content: '';\n        width: 24px;\n        height: 24px;\n        border: 3px solid var(--border-color);\n        border-top-color: #e11d48;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n        margin-left: 12px;\n      }\n\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n\n      /* Projects indicator */\n      .contact-projects-indicator {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        margin-top: 10px;\n        font-size: 12px;\n        color: var(--text-tertiary);\n      }\n\n      .contact-projects-indicator svg {\n        width: 14px;\n        height: 14px;\n      }\n\n      .project-dot {\n        width: 8px;\n        height: 8px;\n        border-radius: 50%;\n        background: #e11d48;\n      }\n    </style>\n\n    <!-- Header -->\n    <div class=\"contacts-header\">\n      <div class=\"contacts-title\">\n        <div class=\"contacts-title-icon\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n          </svg>\n        </div>\n        <h1>Contacts</h1>\n        <span class=\"contacts-count\" id=\"contacts-count\">0</span>\n      </div>\n\n      <div class=\"contacts-actions\">\n        <div class=\"contacts-search-wrapper\">\n          <input type=\"search\" class=\"contacts-search\" id=\"contacts-search\" placeholder=\"Search contacts...\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/>\n          </svg>\n        </div>\n        <button class=\"btn-sota secondary\" id=\"import-contacts-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"/>\n          </svg>\n          Import\n        </button>\n        <button class=\"btn-sota secondary\" id=\"export-contacts-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"/>\n          </svg>\n          Export\n        </button>\n        <button class=\"btn-sota primary\" id=\"add-contact-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Add Contact\n        </button>\n      </div>\n    </div>\n\n    <!-- Filters -->\n    <div class=\"contacts-filters\">\n      <div class=\"filter-chip\" id=\"filter-favorites\" data-filter=\"favorites\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\n        </svg>\n        Favorites\n      </div>\n      <select class=\"filter-select\" id=\"org-filter\">\n        <option value=\"\">All Organizations</option>\n      </select>\n      <select class=\"filter-select\" id=\"tag-filter\">\n        <option value=\"\">All Tags</option>\n      </select>\n    </div>\n\n    <!-- Alerts -->\n    <div class=\"contacts-alerts\" id=\"contacts-alerts\"></div>\n\n    <!-- Favorites Section -->\n    <div class=\"favorites-section\" id=\"favorites-section\" style=\"display: none;\">\n      <div class=\"section-header\">\n        <svg fill=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\n        </svg>\n        Favorites\n      </div>\n      <div class=\"favorites-grid\" id=\"favorites-grid\"></div>\n    </div>\n\n    <!-- Main Content -->\n    <div id=\"contacts-content\">\n      <div class=\"contacts-loading\">Loading contacts</div>\n    </div>\n  `;\n\n  // Bind events\n  bindEvents(panel, props);\n\n  // Initial load\n  loadContacts(panel, props);\n  checkDuplicates(panel);\n\n  return panel;\n}\n\n/**\n * Bind panel events\n */\nfunction bindEvents(panel: HTMLElement, props: ContactsPanelProps): void {\n  // Search\n  const searchInput = panel.querySelector('#contacts-search') as HTMLInputElement;\n  let searchTimeout: number;\n  on(searchInput, 'input', () => {\n    clearTimeout(searchTimeout);\n    searchTimeout = window.setTimeout(() => {\n      currentSearch = searchInput.value;\n      loadContacts(panel, props);\n    }, 300);\n  });\n\n  // Organization filter\n  const orgFilter = panel.querySelector('#org-filter') as HTMLSelectElement;\n  on(orgFilter, 'change', () => {\n    currentFilter.organization = orgFilter.value || undefined;\n    loadContacts(panel, props);\n  });\n\n  // Tag filter\n  const tagFilter = panel.querySelector('#tag-filter') as HTMLSelectElement;\n  on(tagFilter, 'change', () => {\n    currentFilter.tag = tagFilter.value || undefined;\n    loadContacts(panel, props);\n  });\n\n  // Favorites filter\n  const favoritesChip = panel.querySelector('#filter-favorites');\n  if (favoritesChip) {\n    on(favoritesChip as HTMLElement, 'click', () => {\n      favoritesChip.classList.toggle('active');\n      currentFilter.favorites = favoritesChip.classList.contains('active');\n      loadContacts(panel, props);\n    });\n  }\n\n  // Add contact\n  const addBtn = panel.querySelector('#add-contact-btn');\n  if (addBtn) {\n    on(addBtn as HTMLElement, 'click', () => {\n      showContactModal({\n        mode: 'create',\n        onSave: () => loadContacts(panel, props),\n      });\n    });\n  }\n\n  // Export\n  const exportBtn = panel.querySelector('#export-contacts-btn');\n  if (exportBtn) {\n    on(exportBtn as HTMLElement, 'click', () => exportContacts());\n  }\n\n  // Import\n  const importBtn = panel.querySelector('#import-contacts-btn');\n  if (importBtn) {\n    on(importBtn as HTMLElement, 'click', () => {\n      toast.info('Import functionality coming soon');\n    });\n  }\n}\n\n/**\n * Load contacts\n */\nasync function loadContacts(panel: HTMLElement, props?: ContactsPanelProps): Promise<void> {\n  const content = panel.querySelector('#contacts-content') as HTMLElement;\n  content.innerHTML = '<div class=\"contacts-loading\">Loading contacts</div>';\n\n  try {\n    const { contacts, total } = await contactsService.getAll({\n      search: currentSearch || undefined,\n      organization: currentFilter.organization,\n      tag: currentFilter.tag,\n    });\n\n    // Filter favorites if needed\n    let filteredContacts = contacts;\n    if (currentFilter.favorites) {\n      filteredContacts = contacts.filter(c => c.isFavorite);\n    }\n\n    allContacts = contacts;\n\n    renderContacts(content, filteredContacts, props);\n    renderFavorites(panel, contacts.filter(c => c.isFavorite), props);\n    updateCount(panel, total);\n    updateFilters(panel, contacts);\n  } catch {\n    content.innerHTML = `\n      <div class=\"contacts-empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n        </svg>\n        <h3>Failed to load contacts</h3>\n        <p>Please try again later</p>\n      </div>\n    `;\n  }\n}\n\n/**\n * Render contacts grid\n */\nfunction renderContacts(container: HTMLElement, contacts: Contact[], props?: ContactsPanelProps): void {\n  if (contacts.length === 0) {\n    container.innerHTML = `\n      <div class=\"contacts-empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n        </svg>\n        <h3>${currentSearch ? 'No contacts match your search' : 'No contacts yet'}</h3>\n        <p>${currentSearch ? 'Try a different search term' : 'Add your first contact to get started'}</p>\n        <button class=\"btn-sota primary\" id=\"empty-add-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Add Contact\n        </button>\n      </div>\n    `;\n    \n    const addBtn = container.querySelector('#empty-add-btn');\n    if (addBtn) {\n      on(addBtn as HTMLElement, 'click', () => {\n        showContactModal({ mode: 'create' });\n      });\n    }\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"contacts-grid\">\n      ${contacts.map(contact => createContactCard(contact)).join('')}\n    </div>\n  `;\n\n  bindContactCardEvents(container, contacts, props);\n}\n\n/**\n * Create contact card HTML\n */\nfunction createContactCard(contact: Contact): string {\n  const initials = getInitials(contact.name);\n  const hasPhoto = !!(contact.photoUrl || contact.avatarUrl);\n  const photoUrl = contact.photoUrl || contact.avatarUrl;\n  const isSelected = selectedContactIds.has(contact.id);\n\n  return `\n    <div class=\"contact-card-sota ${isSelected ? 'selected' : ''}\" data-id=\"${contact.id}\">\n      <div class=\"contact-select-checkbox ${isSelected ? 'checked' : ''}\" data-action=\"select\" data-id=\"${contact.id}\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M5 13l4 4L19 7\"/>\n        </svg>\n      </div>\n      <div class=\"contact-quick-actions\">\n        <button class=\"quick-action-btn favorite ${contact.isFavorite ? 'active' : ''}\" data-action=\"favorite\" data-id=\"${contact.id}\" title=\"Toggle favorite\">\n          <svg fill=\"${contact.isFavorite ? 'currentColor' : 'none'}\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\n          </svg>\n        </button>\n        <button class=\"quick-action-btn\" data-action=\"edit\" data-id=\"${contact.id}\" title=\"Edit contact\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"contact-card-header\">\n        <div class=\"contact-avatar-sota\">\n          ${hasPhoto \n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\">`\n            : initials\n          }\n        </div>\n        <div class=\"contact-main-info\">\n          <h3 class=\"contact-name-sota\">${escapeHtml(contact.name)}</h3>\n          ${contact.role ? `<span class=\"contact-role-badge\">${escapeHtml(contact.role)}</span>` : ''}\n          ${contact.organization ? `\n            <div class=\"contact-org-sota\">\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\n              </svg>\n              ${escapeHtml(contact.organization)}\n            </div>\n          ` : ''}\n        </div>\n      </div>\n\n      <div class=\"contact-details-sota\">\n        ${contact.email ? `\n          <div class=\"contact-detail-item\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n            </svg>\n            <span>${escapeHtml(contact.email)}</span>\n          </div>\n        ` : ''}\n        ${contact.phone ? `\n          <div class=\"contact-detail-item\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"/>\n            </svg>\n            <span>${escapeHtml(contact.phone)}</span>\n          </div>\n        ` : ''}\n      </div>\n\n      ${contact.tags && contact.tags.length > 0 ? `\n        <div class=\"contact-tags-sota\">\n          ${contact.tags.slice(0, 4).map(tag => `<span class=\"contact-tag\">${escapeHtml(tag)}</span>`).join('')}\n          ${contact.tags.length > 4 ? `<span class=\"contact-tag\">+${contact.tags.length - 4}</span>` : ''}\n        </div>\n      ` : ''}\n    </div>\n  `;\n}\n\n/**\n * Bind contact card events\n */\nfunction bindContactCardEvents(container: HTMLElement, contacts: Contact[], props?: ContactsPanelProps): void {\n  const panel = container.closest('.contacts-panel-sota') as HTMLElement;\n\n  // Selection checkbox click\n  container.querySelectorAll('.contact-select-checkbox').forEach(checkbox => {\n    on(checkbox as HTMLElement, 'click', (e) => {\n      e.stopPropagation();\n      const id = checkbox.getAttribute('data-id');\n      if (!id) return;\n\n      const card = checkbox.closest('.contact-card-sota') as HTMLElement;\n      \n      if (selectedContactIds.has(id)) {\n        selectedContactIds.delete(id);\n        checkbox.classList.remove('checked');\n        card.classList.remove('selected');\n      } else {\n        selectedContactIds.add(id);\n        checkbox.classList.add('checked');\n        card.classList.add('selected');\n      }\n\n      if (props) updateSelectionBar(panel, contacts, props);\n    });\n  });\n\n  // Card click (open modal)\n  container.querySelectorAll('.contact-card-sota').forEach(card => {\n    on(card as HTMLElement, 'click', (e) => {\n      // Ignore if clicking quick action buttons or checkbox\n      if ((e.target as HTMLElement).closest('.quick-action-btn')) return;\n      if ((e.target as HTMLElement).closest('.contact-select-checkbox')) return;\n\n      const id = card.getAttribute('data-id');\n      const contact = contacts.find(c => String(c.id) === id);\n      if (contact) {\n        if (props?.onContactClick) {\n          props.onContactClick(contact);\n        } else {\n          showContactModal({\n            mode: 'edit',\n            contact,\n            onSave: () => loadContacts(panel, props),\n          });\n        }\n      }\n    });\n  });\n\n  // Quick action buttons\n  container.querySelectorAll('.quick-action-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const action = btn.getAttribute('data-action');\n      const id = btn.getAttribute('data-id');\n      const contact = contacts.find(c => String(c.id) === id);\n\n      if (!contact) return;\n\n      if (action === 'favorite') {\n        if (props) await toggleFavorite(contact, btn as HTMLElement, panel, props);\n      } else if (action === 'edit') {\n        showContactModal({\n          mode: 'edit',\n          contact,\n          onSave: () => loadContacts(panel, props),\n        });\n      }\n    });\n  });\n}\n\n/**\n * Update selection bar visibility and content\n */\nfunction updateSelectionBar(panel: HTMLElement, contacts: Contact[], props: ContactsPanelProps): void {\n  // Remove existing selection bar\n  const existingBar = document.querySelector('.selection-bar');\n  if (existingBar) existingBar.remove();\n\n  if (selectedContactIds.size < 2) return;\n\n  // Create selection bar\n  const bar = createElement('div', { className: 'selection-bar' });\n  bar.innerHTML = `\n    <span class=\"selection-bar-count\"><span>${selectedContactIds.size}</span> contacts selected</span>\n    <button class=\"selection-bar-btn merge\" id=\"merge-selected-btn\">\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n      </svg>\n      Merge Selected\n    </button>\n    <button class=\"selection-bar-btn cancel\" id=\"cancel-selection-btn\">\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n      </svg>\n      Cancel\n    </button>\n  `;\n\n  document.body.appendChild(bar);\n\n  // Bind events\n  const mergeBtn = bar.querySelector('#merge-selected-btn');\n  const cancelBtn = bar.querySelector('#cancel-selection-btn');\n\n  on(cancelBtn as HTMLElement, 'click', () => {\n    clearSelection(panel);\n  });\n\n  on(mergeBtn as HTMLElement, 'click', async () => {\n    const ids = Array.from(selectedContactIds);\n    \n    // Get selected contacts for confirmation\n    const selectedContacts = contacts.filter(c => selectedContactIds.has(c.id));\n\n    const confirmed = await showMergeConfirmModal(selectedContacts);\n    if (!confirmed) {\n      return;\n    }\n\n    (mergeBtn as HTMLButtonElement).disabled = true;\n    (mergeBtn as HTMLButtonElement).textContent = 'Merging...';\n\n    try {\n      await contactsService.mergeContacts(ids);\n      toast.success(`Merged ${ids.length} contacts successfully`);\n      clearSelection(panel);\n      await loadContacts(panel, props);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Failed to merge contacts';\n      toast.error(message);\n      (mergeBtn as HTMLButtonElement).disabled = false;\n      (mergeBtn as HTMLButtonElement).innerHTML = `\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n        </svg>\n        Merge Selected\n      `;\n    }\n  });\n}\n\n/**\n * Show styled merge confirmation modal\n */\nfunction showMergeConfirmModal(contacts: Contact[]): Promise<boolean> {\n  return new Promise((resolve) => {\n    const overlay = createElement('div', { className: 'merge-confirm-overlay' });\n    \n    const primaryContact = contacts[0];\n    const otherContacts = contacts.slice(1);\n    \n    overlay.innerHTML = `\n      <style>\n        .merge-confirm-overlay {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background: rgba(0, 0, 0, 0.6);\n          backdrop-filter: blur(4px);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          z-index: 10000;\n          animation: fadeIn 0.2s ease;\n        }\n        \n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        \n        .merge-confirm-modal {\n          background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\n          border-radius: 16px;\n          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n          max-width: 480px;\n          width: 90%;\n          overflow: hidden;\n          animation: slideUp 0.3s ease;\n        }\n        \n        @keyframes slideUp {\n          from { transform: translateY(20px); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        \n        .merge-confirm-header {\n          background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n          color: white;\n          padding: 20px 24px;\n          display: flex;\n          align-items: center;\n          gap: 12px;\n        }\n        \n        .merge-confirm-header svg {\n          width: 24px;\n          height: 24px;\n        }\n        \n        .merge-confirm-header h3 {\n          margin: 0;\n          font-size: 18px;\n          font-weight: 600;\n        }\n        \n        .merge-confirm-body {\n          padding: 24px;\n        }\n        \n        .merge-confirm-body p {\n          margin: 0 0 16px 0;\n          color: #64748b;\n          font-size: 14px;\n        }\n        \n        .merge-contact-list {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n          margin-bottom: 16px;\n        }\n        \n        .merge-contact-item {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 12px;\n          background: #f8fafc;\n          border-radius: 10px;\n          border: 1px solid #e2e8f0;\n        }\n        \n        .merge-contact-item.primary {\n          background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n          border-color: #f59e0b;\n        }\n        \n        .merge-contact-avatar {\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-weight: 600;\n          font-size: 14px;\n          flex-shrink: 0;\n        }\n        \n        .merge-contact-avatar img {\n          width: 100%;\n          height: 100%;\n          border-radius: 50%;\n          object-fit: cover;\n        }\n        \n        .merge-contact-info {\n          flex: 1;\n          min-width: 0;\n        }\n        \n        .merge-contact-name {\n          font-weight: 600;\n          color: #1e293b;\n          font-size: 14px;\n          margin-bottom: 2px;\n        }\n        \n        .merge-contact-details {\n          font-size: 12px;\n          color: #64748b;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .merge-contact-badge {\n          background: #f59e0b;\n          color: white;\n          font-size: 10px;\n          font-weight: 600;\n          padding: 4px 8px;\n          border-radius: 6px;\n          text-transform: uppercase;\n        }\n        \n        .merge-warning {\n          display: flex;\n          align-items: flex-start;\n          gap: 10px;\n          padding: 12px;\n          background: #fef3c7;\n          border-radius: 10px;\n          margin-top: 16px;\n        }\n        \n        .merge-warning svg {\n          width: 18px;\n          height: 18px;\n          color: #d97706;\n          flex-shrink: 0;\n          margin-top: 1px;\n        }\n        \n        .merge-warning p {\n          margin: 0;\n          color: #92400e;\n          font-size: 13px;\n          line-height: 1.5;\n        }\n        \n        .merge-confirm-footer {\n          display: flex;\n          gap: 12px;\n          padding: 16px 24px 24px;\n          justify-content: flex-end;\n        }\n        \n        .merge-confirm-btn {\n          padding: 10px 20px;\n          border-radius: 10px;\n          font-size: 14px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.2s ease;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .merge-confirm-btn.cancel {\n          background: #f1f5f9;\n          border: 1px solid #e2e8f0;\n          color: #64748b;\n        }\n        \n        .merge-confirm-btn.cancel:hover {\n          background: #e2e8f0;\n        }\n        \n        .merge-confirm-btn.confirm {\n          background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n          border: none;\n          color: white;\n          box-shadow: 0 4px 14px rgba(245, 158, 11, 0.4);\n        }\n        \n        .merge-confirm-btn.confirm:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5);\n        }\n        \n        .merge-confirm-btn svg {\n          width: 16px;\n          height: 16px;\n        }\n      </style>\n      \n      <div class=\"merge-confirm-modal\">\n        <div class=\"merge-confirm-header\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n          </svg>\n          <h3>Merge Contacts</h3>\n        </div>\n        \n        <div class=\"merge-confirm-body\">\n          <p>The following contacts will be merged into one:</p>\n          \n          <div class=\"merge-contact-list\">\n            ${contacts.map((c, i) => {\n              const avatar = c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url;\n              const initials = (c.name || '?').split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n              const detail = c.email || c.organization || c.company || '';\n              \n              return `\n                <div class=\"merge-contact-item ${i === 0 ? 'primary' : ''}\">\n                  <div class=\"merge-contact-avatar\">\n                    ${avatar ? `<img src=\"${avatar}\" alt=\"${c.name}\">` : initials}\n                  </div>\n                  <div class=\"merge-contact-info\">\n                    <div class=\"merge-contact-name\">${c.name || 'Unknown'}</div>\n                    <div class=\"merge-contact-details\">${detail}</div>\n                  </div>\n                  ${i === 0 ? '<span class=\"merge-contact-badge\">Primary</span>' : ''}\n                </div>\n              `;\n            }).join('')}\n          </div>\n          \n          <div class=\"merge-warning\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n            </svg>\n            <p>All information will be combined into the primary contact. Other contacts will be archived. This action cannot be undone.</p>\n          </div>\n        </div>\n        \n        <div class=\"merge-confirm-footer\">\n          <button class=\"merge-confirm-btn cancel\" id=\"merge-cancel-btn\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n            </svg>\n            Cancel\n          </button>\n          <button class=\"merge-confirm-btn confirm\" id=\"merge-confirm-btn\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n            </svg>\n            Merge Contacts\n          </button>\n        </div>\n      </div>\n    `;\n    \n    document.body.appendChild(overlay);\n    \n    const cancelBtn = overlay.querySelector('#merge-cancel-btn');\n    const confirmBtn = overlay.querySelector('#merge-confirm-btn');\n    \n    const close = (result: boolean) => {\n      overlay.remove();\n      resolve(result);\n    };\n    \n    on(cancelBtn as HTMLElement, 'click', () => close(false));\n    on(confirmBtn as HTMLElement, 'click', () => close(true));\n    on(overlay, 'click', (e) => {\n      if (e.target === overlay) close(false);\n    });\n    \n    // ESC to close\n    const handleEsc = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        document.removeEventListener('keydown', handleEsc);\n        close(false);\n      }\n    };\n    document.addEventListener('keydown', handleEsc);\n  });\n}\n\n/**\n * Clear selection\n */\nfunction clearSelection(panel: HTMLElement): void {\n  selectedContactIds.clear();\n  \n  // Remove selected class from cards\n  panel.querySelectorAll('.contact-card-sota.selected').forEach(card => {\n    card.classList.remove('selected');\n  });\n  panel.querySelectorAll('.contact-select-checkbox.checked').forEach(checkbox => {\n    checkbox.classList.remove('checked');\n  });\n\n  // Remove selection bar\n  const bar = document.querySelector('.selection-bar');\n  if (bar) bar.remove();\n}\n\n/**\n * Toggle favorite\n */\nasync function toggleFavorite(contact: Contact, btn: HTMLElement, panel: HTMLElement, props: ContactsPanelProps): Promise<void> {\n  const newValue = !contact.isFavorite;\n  \n  try {\n    await http.put(`/api/contacts/${contact.id}`, { is_favorite: newValue });\n    contact.isFavorite = newValue;\n    \n    // Update button visually\n    btn.classList.toggle('active', newValue);\n    const svg = btn.querySelector('svg');\n    if (svg) {\n      svg.setAttribute('fill', newValue ? 'currentColor' : 'none');\n    }\n\n    // Refresh favorites section\n    renderFavorites(panel, allContacts.filter(c => c.isFavorite || (c.id === contact.id && newValue)), props);\n    \n    toast.success(newValue ? 'Added to favorites' : 'Removed from favorites');\n  } catch {\n    toast.error('Failed to update favorite');\n  }\n}\n\n/**\n * Render favorites section\n */\nfunction renderFavorites(panel: HTMLElement, favorites: Contact[], props?: ContactsPanelProps): void {\n  const section = panel.querySelector('#favorites-section') as HTMLElement;\n  const grid = panel.querySelector('#favorites-grid') as HTMLElement;\n\n  if (favorites.length === 0) {\n    section.style.display = 'none';\n    return;\n  }\n\n  section.style.display = 'block';\n  grid.innerHTML = favorites.map(contact => {\n    const initials = getInitials(contact.name);\n    const hasPhoto = !!(contact.photoUrl || contact.avatarUrl);\n    const photoUrl = contact.photoUrl || contact.avatarUrl;\n\n    return `\n      <div class=\"favorite-card\" data-id=\"${contact.id}\">\n        <div class=\"favorite-avatar\">\n          ${hasPhoto \n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\">`\n            : initials\n          }\n        </div>\n        <div class=\"favorite-info\">\n          <h4>${escapeHtml(contact.name)}</h4>\n          ${contact.organization ? `<p>${escapeHtml(contact.organization)}</p>` : ''}\n        </div>\n      </div>\n    `;\n  }).join('');\n\n  // Bind click events\n  grid.querySelectorAll('.favorite-card').forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const id = card.getAttribute('data-id');\n      const contact = favorites.find(c => String(c.id) === id);\n      if (contact) {\n        showContactModal({\n          mode: 'edit',\n          contact,\n          onSave: () => loadContacts(panel, props),\n        });\n      }\n    });\n  });\n}\n\n/**\n * Check for duplicates\n */\nasync function checkDuplicates(panel: HTMLElement): Promise<void> {\n  const alertsContainer = panel.querySelector('#contacts-alerts') as HTMLElement;\n\n  try {\n    const { duplicates } = await contactsService.getDuplicates();\n    \n    if (duplicates.length > 0) {\n      alertsContainer.innerHTML = `\n        <div class=\"alert-sota\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n          </svg>\n          <span><strong>${duplicates.length}</strong> potential duplicate contacts found</span>\n          <button class=\"btn-sota secondary\" id=\"review-duplicates-btn\">Review Duplicates</button>\n        </div>\n      `;\n\n      const reviewBtn = alertsContainer.querySelector('#review-duplicates-btn');\n      if (reviewBtn) {\n        on(reviewBtn as HTMLElement, 'click', () => {\n          showDuplicatesReviewModal(duplicates, panel);\n        });\n      }\n    }\n  } catch {\n    // Ignore errors\n  }\n}\n\n/**\n * Show duplicates review modal\n */\nfunction showDuplicatesReviewModal(duplicateGroups: Contact[][], panel: HTMLElement): void {\n  // Create overlay\n  const overlay = createElement('div', { className: 'duplicates-review-overlay' });\n  \n  overlay.innerHTML = `\n    <style>\n      .duplicates-review-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,0.6);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        animation: fadeIn 0.2s ease;\n      }\n      \n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      \n      .duplicates-modal {\n        background: var(--bg-primary);\n        border-radius: 16px;\n        width: 700px;\n        max-width: 95vw;\n        max-height: 85vh;\n        display: flex;\n        flex-direction: column;\n        box-shadow: 0 25px 60px rgba(0,0,0,0.3);\n        animation: slideUp 0.2s ease;\n      }\n      \n      @keyframes slideUp {\n        from { transform: translateY(20px); opacity: 0; }\n        to { transform: translateY(0); opacity: 1; }\n      }\n      \n      .duplicates-header {\n        padding: 24px;\n        border-bottom: 1px solid var(--border-color);\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n      \n      .duplicates-header h2 {\n        margin: 0;\n        font-size: 20px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n      \n      .duplicates-header h2 svg {\n        width: 24px;\n        height: 24px;\n        color: #f59e0b;\n      }\n      \n      .duplicates-header .close-btn {\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n      }\n      \n      .duplicates-header .close-btn:hover {\n        background: var(--bg-tertiary);\n        border-color: #e11d48;\n      }\n      \n      .duplicates-header .close-btn svg {\n        width: 18px;\n        height: 18px;\n        color: var(--text-secondary);\n      }\n      \n      .duplicates-content {\n        flex: 1;\n        overflow-y: auto;\n        padding: 24px;\n      }\n      \n      .duplicate-group {\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        padding: 16px;\n        margin-bottom: 16px;\n      }\n      \n      .duplicate-group:last-child {\n        margin-bottom: 0;\n      }\n      \n      .duplicate-group-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 12px;\n        padding-bottom: 12px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      \n      .duplicate-group-header h4 {\n        margin: 0;\n        font-size: 14px;\n        color: var(--text-secondary);\n      }\n      \n      .merge-group-btn {\n        padding: 8px 16px;\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        color: white;\n        border: none;\n        border-radius: 8px;\n        font-size: 13px;\n        font-weight: 600;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        transition: all 0.2s;\n      }\n      \n      .merge-group-btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\n      }\n      \n      .merge-group-btn svg {\n        width: 16px;\n        height: 16px;\n      }\n      \n      .duplicate-contacts {\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n      }\n      \n      .duplicate-contact-row {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 10px 12px;\n        background: var(--bg-primary);\n        border-radius: 8px;\n        border: 1px solid var(--border-color);\n      }\n      \n      .duplicate-contact-row input[type=\"radio\"] {\n        width: 18px;\n        height: 18px;\n        accent-color: #e11d48;\n      }\n      \n      .duplicate-avatar {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 14px;\n        font-weight: 600;\n        color: white;\n        flex-shrink: 0;\n      }\n      \n      .duplicate-info {\n        flex: 1;\n        min-width: 0;\n      }\n      \n      .duplicate-info h5 {\n        margin: 0 0 2px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n      \n      .duplicate-info p {\n        margin: 0;\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n      \n      .duplicate-aliases {\n        margin-top: 4px;\n        display: flex;\n        gap: 4px;\n        flex-wrap: wrap;\n      }\n      \n      .alias-tag {\n        padding: 2px 6px;\n        background: rgba(99,102,241,0.1);\n        color: #6366f1;\n        border-radius: 4px;\n        font-size: 10px;\n        font-weight: 500;\n      }\n      \n      .duplicates-footer {\n        padding: 16px 24px;\n        border-top: 1px solid var(--border-color);\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n      \n      .duplicates-footer button {\n        padding: 10px 20px;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      \n      .duplicates-footer .close-review-btn {\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        color: var(--text-primary);\n      }\n      \n      .duplicates-footer .close-review-btn:hover {\n        background: var(--bg-tertiary);\n      }\n      \n      .no-duplicates-msg {\n        text-align: center;\n        padding: 40px;\n        color: var(--text-secondary);\n      }\n      \n      .no-duplicates-msg svg {\n        width: 48px;\n        height: 48px;\n        opacity: 0.4;\n        margin-bottom: 12px;\n      }\n    </style>\n    \n    <div class=\"duplicates-modal\">\n      <div class=\"duplicates-header\">\n        <h2>\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\n          </svg>\n          Review Duplicate Contacts\n        </h2>\n        <button class=\"close-btn\" id=\"close-duplicates-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n          </svg>\n        </button>\n      </div>\n      \n      <div class=\"duplicates-content\" id=\"duplicates-content\">\n        ${duplicateGroups.length === 0 ? `\n          <div class=\"no-duplicates-msg\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n            </svg>\n            <p>No duplicate contacts found</p>\n          </div>\n        ` : duplicateGroups.map((group, groupIndex) => `\n          <div class=\"duplicate-group\" data-group-index=\"${groupIndex}\">\n            <div class=\"duplicate-group-header\">\n              <h4>Potential duplicates (${group.length} contacts)</h4>\n              <button class=\"merge-group-btn\" data-group-index=\"${groupIndex}\">\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n                </svg>\n                Merge All\n              </button>\n            </div>\n            <div class=\"duplicate-contacts\">\n              ${group.map((contact, idx) => `\n                <div class=\"duplicate-contact-row\">\n                  <input type=\"radio\" name=\"primary-${groupIndex}\" value=\"${contact.id}\" ${idx === 0 ? 'checked' : ''}>\n                  <div class=\"duplicate-avatar\">${getInitials(contact.name)}</div>\n                  <div class=\"duplicate-info\">\n                    <h5>${escapeHtml(contact.name)}${idx === 0 ? ' (Primary)' : ''}</h5>\n                    <p>${escapeHtml(contact.email || '')}${contact.organization ? `  ${escapeHtml(contact.organization)}` : ''}</p>\n                    ${(contact.aliases && contact.aliases.length > 0) ? `\n                      <div class=\"duplicate-aliases\">\n                        ${contact.aliases.map(alias => `<span class=\"alias-tag\">${escapeHtml(alias)}</span>`).join('')}\n                      </div>\n                    ` : ''}\n                  </div>\n                </div>\n              `).join('')}\n            </div>\n          </div>\n        `).join('')}\n      </div>\n      \n      <div class=\"duplicates-footer\">\n        <button class=\"close-review-btn\" id=\"close-review-btn\">Close</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  // Close handlers\n  const closeOverlay = () => overlay.remove();\n  \n  const closeBtn = overlay.querySelector('#close-duplicates-btn');\n  const closeReviewBtn = overlay.querySelector('#close-review-btn');\n  \n  if (closeBtn) on(closeBtn as HTMLElement, 'click', closeOverlay);\n  if (closeReviewBtn) on(closeReviewBtn as HTMLElement, 'click', closeOverlay);\n  on(overlay, 'click', (e: Event) => {\n    if (e.target === overlay) closeOverlay();\n  });\n\n  // Merge handlers\n  overlay.querySelectorAll('.merge-group-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const groupIndex = parseInt(btn.getAttribute('data-group-index') || '0');\n      const group = duplicateGroups[groupIndex];\n      \n      if (!group || group.length < 2) return;\n\n      // Get selected primary contact\n      const selectedRadio = overlay.querySelector(`input[name=\"primary-${groupIndex}\"]:checked`) as HTMLInputElement;\n      const primaryId = selectedRadio?.value || group[0].id;\n      \n      // Reorder so primary is first\n      const orderedIds = [primaryId, ...group.filter(c => c.id !== primaryId).map(c => c.id)];\n      \n      (btn as HTMLButtonElement).disabled = true;\n      (btn as HTMLButtonElement).textContent = 'Merging...';\n      \n      try {\n        await contactsService.mergeContacts(orderedIds);\n        toast.success(`Merged ${group.length} contacts successfully`);\n        \n        // Remove this group from the UI\n        const groupEl = overlay.querySelector(`.duplicate-group[data-group-index=\"${groupIndex}\"]`);\n        if (groupEl) groupEl.remove();\n        \n        // Check if no more groups\n        const remainingGroups = overlay.querySelectorAll('.duplicate-group');\n        if (remainingGroups.length === 0) {\n          const content = overlay.querySelector('#duplicates-content');\n          if (content) {\n            content.innerHTML = `\n              <div class=\"no-duplicates-msg\">\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                </svg>\n                <p>All duplicates have been merged!</p>\n              </div>\n            `;\n          }\n        }\n        \n        // Refresh contacts list\n        await loadContacts(panel);\n        \n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Failed to merge contacts';\n        toast.error(message);\n        (btn as HTMLButtonElement).disabled = false;\n        (btn as HTMLButtonElement).innerHTML = `\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n          </svg>\n          Merge All\n        `;\n      }\n    });\n  });\n}\n\n/**\n * Update filters\n */\nfunction updateFilters(panel: HTMLElement, contacts: Contact[]): void {\n  // Organizations\n  const orgFilter = panel.querySelector('#org-filter') as HTMLSelectElement;\n  const orgs = [...new Set(contacts.map(c => c.organization).filter(Boolean))].sort();\n  \n  const currentOrg = orgFilter.value;\n  orgFilter.innerHTML = `\n    <option value=\"\">All Organizations</option>\n    ${orgs.map(org => `<option value=\"${escapeHtml(org!)}\" ${currentOrg === org ? 'selected' : ''}>${escapeHtml(org!)}</option>`).join('')}\n  `;\n\n  // Tags\n  const tagFilter = panel.querySelector('#tag-filter') as HTMLSelectElement;\n  const allTags = contacts.flatMap(c => c.tags || []);\n  const uniqueTags = [...new Set(allTags)].sort();\n  \n  const currentTag = tagFilter.value;\n  tagFilter.innerHTML = `\n    <option value=\"\">All Tags</option>\n    ${uniqueTags.map(tag => `<option value=\"${escapeHtml(tag)}\" ${currentTag === tag ? 'selected' : ''}>${escapeHtml(tag)}</option>`).join('')}\n  `;\n}\n\n/**\n * Export contacts\n */\nasync function exportContacts(): Promise<void> {\n  try {\n    await contactsService.export('json');\n    toast.success('Contacts exported');\n  } catch {\n    toast.error('Failed to export contacts');\n  }\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#contacts-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Get initials\n */\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createContactsPanel;\n","/**\n * Teams Panel Component\n * Team list with members management\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { teamsService, Team } from '../services/contacts';\nimport { showTeamModal } from './modals/TeamModal';\nimport { toast } from '../services/toast';\n\nexport interface TeamsPanelProps {\n  onTeamClick?: (team: Team) => void;\n}\n\n/**\n * Create teams panel\n */\nexport function createTeamsPanel(props: TeamsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'teams-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Teams</h2>\n        <span class=\"panel-count\" id=\"teams-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <button class=\"btn btn-primary btn-sm\" id=\"add-team-btn\">+ Add Team</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"teams-content\">\n      <div class=\"loading\">Loading teams...</div>\n    </div>\n  `;\n\n  // Bind events\n  const addBtn = panel.querySelector('#add-team-btn');\n  if (addBtn) {\n    on(addBtn as HTMLElement, 'click', () => {\n      showTeamModal({\n        mode: 'create',\n        onSave: () => loadTeams(panel, props),\n      });\n    });\n  }\n\n  // Initial load\n  loadTeams(panel, props);\n\n  return panel;\n}\n\n/**\n * Load teams\n */\nasync function loadTeams(panel: HTMLElement, props: TeamsPanelProps): Promise<void> {\n  const content = panel.querySelector('#teams-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const teams = await teamsService.getAll();\n    renderTeams(content, teams, props);\n    updateCount(panel, teams.length);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load teams</div>';\n  }\n}\n\n/**\n * Render teams\n */\nfunction renderTeams(container: HTMLElement, teams: Team[], props: TeamsPanelProps): void {\n  if (teams.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No teams yet</p>\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Create Team</button>\n      </div>\n    `;\n    const addBtn = container.querySelector('#empty-add-btn');\n    if (addBtn) {\n      on(addBtn as HTMLElement, 'click', () => {\n        showTeamModal({ mode: 'create' });\n      });\n    }\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"teams-grid\">\n      ${teams.map(team => createTeamCard(team)).join('')}\n    </div>\n  `;\n\n  // Bind click events\n  container.querySelectorAll('.team-card').forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const id = card.getAttribute('data-id');\n      const team = teams.find(t => String(t.id) === id);\n      if (team) {\n        if (props.onTeamClick) {\n          props.onTeamClick(team);\n        } else {\n          showTeamModal({\n            mode: 'edit',\n            team,\n            onSave: () => loadTeams(card.closest('.teams-panel') as HTMLElement, props),\n          });\n        }\n      }\n    });\n  });\n}\n\n/**\n * Create team card HTML\n */\nfunction createTeamCard(team: Team): string {\n  const memberCount = team.memberCount || 0;\n  const leadMember = team.memberDetails?.find(m => m.isLead);\n\n  return `\n    <div class=\"team-card\" data-id=\"${team.id}\">\n      <div class=\"team-header\">\n        <div class=\"team-color\" style=\"background: ${team.color || '#6366f1'}\"></div>\n        <div class=\"team-name\">${escapeHtml(team.name)}</div>\n        ${team.team_type ? `<span class=\"team-type\">${team.team_type}</span>` : ''}\n      </div>\n      ${team.description ? `<div class=\"team-description\">${escapeHtml(team.description)}</div>` : ''}\n      <div class=\"team-stats\">\n        <span class=\"member-count\">${memberCount} member${memberCount !== 1 ? 's' : ''}</span>\n        ${leadMember ? `<span class=\"team-lead\">Lead: ${escapeHtml(leadMember.name)}</span>` : ''}\n      </div>\n      ${team.memberDetails && team.memberDetails.length > 0 ? `\n        <div class=\"team-members-preview\">\n          ${team.memberDetails.slice(0, 5).map(member => `\n            <div class=\"member-avatar\" title=\"${escapeHtml(member.name)}\">\n              ${getInitials(member.name)}\n            </div>\n          `).join('')}\n          ${team.memberDetails.length > 5 ? `<div class=\"more-members\">+${team.memberDetails.length - 5}</div>` : ''}\n        </div>\n      ` : ''}\n    </div>\n  `;\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#teams-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Get initials\n */\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createTeamsPanel;\n","/**\n * Org Chart Component\n * Interactive organization chart using vis-network\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { contactsService, Contact } from '../services/contacts';\nimport { showContactModal } from './modals/ContactModal';\n\nexport interface OrgChartProps {\n  onNodeClick?: (contact: Contact) => void;\n}\n\ninterface OrgNode {\n  id: string;\n  label: string;\n  title: string;\n  level: number;\n  color?: string;\n}\n\ninterface OrgEdge {\n  from: string;\n  to: string;\n  arrows: string;\n}\n\n// vis.js types - using any for callback params to avoid conflicts with other vis.js declarations\ninterface VisNetworkOrgChart {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  on: (event: string, callback: (params: any) => void) => void;\n  fit: () => void;\n  destroy: () => void;\n}\n\n// Helper to get vis module from window\nfunction getVisOrgChart(): { Network: new (container: HTMLElement, data: unknown, options: unknown) => VisNetworkOrgChart; DataSet: new (data: unknown[]) => unknown } | undefined {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  return (window as any).vis;\n}\n\n/**\n * Create org chart\n */\nexport function createOrgChart(props: OrgChartProps = {}): HTMLElement {\n  const container = createElement('div', { className: 'org-chart' });\n\n  container.innerHTML = `\n    <div class=\"chart-toolbar\">\n      <button class=\"btn btn-sm\" id=\"fit-chart-btn\">Fit</button>\n      <button class=\"btn btn-sm\" id=\"refresh-chart-btn\">Refresh</button>\n    </div>\n    <div class=\"chart-container\" id=\"org-chart-container\">\n      <div class=\"loading\">Loading org chart...</div>\n    </div>\n  `;\n\n  // Bind toolbar events\n  const fitBtn = container.querySelector('#fit-chart-btn');\n  if (fitBtn) {\n    on(fitBtn as HTMLElement, 'click', () => {\n      const network = (container as unknown as { _network?: { fit: () => void } })._network;\n      network?.fit();\n    });\n  }\n\n  const refreshBtn = container.querySelector('#refresh-chart-btn');\n  if (refreshBtn) {\n    on(refreshBtn as HTMLElement, 'click', () => loadOrgChart(container, props));\n  }\n\n  // Initial load\n  loadOrgChart(container, props);\n\n  return container;\n}\n\n/**\n * Load org chart data\n */\nasync function loadOrgChart(container: HTMLElement, props: OrgChartProps): Promise<void> {\n  const chartContainer = container.querySelector('#org-chart-container') as HTMLElement;\n  chartContainer.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    // Get contacts with relationships\n    const { contacts } = await contactsService.getAll({});\n    \n    if (contacts.length === 0) {\n      chartContainer.innerHTML = `\n        <div class=\"empty-state\">\n          <p>No contacts to display</p>\n        </div>\n      `;\n      return;\n    }\n\n    // Build org chart data\n    const { nodes, edges } = buildOrgData(contacts);\n\n    // Check if vis-network is available\n    if (!getVisOrgChart()) {\n      renderFallbackChart(chartContainer, contacts, props);\n      return;\n    }\n\n    // Create vis-network\n    renderVisNetwork(chartContainer, nodes, edges, contacts, props);\n  } catch {\n    chartContainer.innerHTML = '<div class=\"error\">Failed to load org chart</div>';\n  }\n}\n\n/**\n * Build org chart data from contacts\n */\nfunction buildOrgData(contacts: Contact[]): { nodes: OrgNode[]; edges: OrgEdge[] } {\n  const nodes: OrgNode[] = [];\n  const edges: OrgEdge[] = [];\n  const levels: Map<string, number> = new Map();\n\n  // First pass: identify hierarchy\n  contacts.forEach(contact => {\n    const reportsTo = contact.relationships?.find(r => r.type === 'reports_to');\n    if (reportsTo) {\n      // Has a manager\n      const managerLevel = levels.get(reportsTo.contactId) || 0;\n      levels.set(String(contact.id), managerLevel + 1);\n    } else {\n      // Top level\n      levels.set(String(contact.id), 0);\n    }\n  });\n\n  // Build nodes\n  contacts.forEach(contact => {\n    nodes.push({\n      id: String(contact.id),\n      label: contact.name,\n      title: `${contact.name}${contact.role ? `\\n${contact.role}` : ''}${contact.organization ? `\\n${contact.organization}` : ''}`,\n      level: levels.get(String(contact.id)) || 0,\n      color: contact.teams?.[0]?.color,\n    });\n  });\n\n  // Build edges (reports_to relationships)\n  contacts.forEach(contact => {\n    contact.relationships?.forEach(rel => {\n      if (rel.type === 'reports_to') {\n        edges.push({\n          from: rel.contactId,\n          to: String(contact.id),\n          arrows: 'to',\n        });\n      }\n    });\n  });\n\n  return { nodes, edges };\n}\n\n/**\n * Render vis-network\n */\nfunction renderVisNetwork(\n  container: HTMLElement,\n  nodes: OrgNode[],\n  edges: OrgEdge[],\n  contacts: Contact[],\n  props: OrgChartProps\n): void {\n  container.innerHTML = '';\n\n  const visNodes = nodes.map(n => ({\n    id: n.id,\n    label: n.label,\n    title: n.title,\n    level: n.level,\n    color: {\n      background: n.color || '#6366f1',\n      border: n.color || '#4f46e5',\n      highlight: { background: '#818cf8', border: '#6366f1' },\n    },\n    font: { color: '#ffffff' },\n    shape: 'box',\n    margin: 10,\n  }));\n\n  const options = {\n    layout: {\n      hierarchical: {\n        direction: 'UD',\n        sortMethod: 'directed',\n        levelSeparation: 100,\n        nodeSpacing: 150,\n      },\n    },\n    nodes: {\n      borderWidth: 2,\n      shadow: true,\n    },\n    edges: {\n      color: { color: '#9ca3af', highlight: '#6366f1' },\n      width: 2,\n      smooth: { type: 'cubicBezier' },\n    },\n    physics: false,\n    interaction: {\n      hover: true,\n      tooltipDelay: 200,\n    },\n  };\n\n  const vis = getVisOrgChart()!;\n  const network = new vis.Network(container, {\n    nodes: new vis.DataSet(visNodes),\n    edges: new vis.DataSet(edges),\n  }, options);\n\n  // Store reference for fit button\n  (container.closest('.org-chart') as unknown as { _network: typeof network })._network = network;\n\n  // Node click handler\n  network.on('click', (params) => {\n    if (params.nodes.length > 0) {\n      const nodeId = params.nodes[0];\n      const contact = contacts.find(c => String(c.id) === nodeId);\n      if (contact) {\n        if (props.onNodeClick) {\n          props.onNodeClick(contact);\n        } else {\n          showContactModal({ mode: 'view', contact });\n        }\n      }\n    }\n  });\n\n  network.fit();\n}\n\n/**\n * Render fallback chart (when vis-network not available)\n */\nfunction renderFallbackChart(container: HTMLElement, contacts: Contact[], props: OrgChartProps): void {\n  // Group by organization\n  const byOrg: Record<string, Contact[]> = {};\n  contacts.forEach(c => {\n    const org = c.organization || 'Other';\n    if (!byOrg[org]) byOrg[org] = [];\n    byOrg[org].push(c);\n  });\n\n  container.innerHTML = `\n    <div class=\"fallback-org-chart\">\n      ${Object.entries(byOrg).map(([org, members]) => `\n        <div class=\"org-group\">\n          <h4 class=\"org-name\">${escapeHtml(org)}</h4>\n          <div class=\"org-members\">\n            ${members.map(contact => `\n              <div class=\"org-member\" data-id=\"${contact.id}\">\n                <div class=\"member-avatar\">${getInitials(contact.name)}</div>\n                <div class=\"member-info\">\n                  <div class=\"member-name\">${escapeHtml(contact.name)}</div>\n                  ${contact.role ? `<div class=\"member-role\">${escapeHtml(contact.role)}</div>` : ''}\n                </div>\n              </div>\n            `).join('')}\n          </div>\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind click events\n  container.querySelectorAll('.org-member').forEach(el => {\n    on(el as HTMLElement, 'click', () => {\n      const id = el.getAttribute('data-id');\n      const contact = contacts.find(c => String(c.id) === id);\n      if (contact) {\n        if (props.onNodeClick) {\n          props.onNodeClick(contact);\n        } else {\n          showContactModal({ mode: 'view', contact });\n        }\n      }\n    });\n  });\n}\n\n/**\n * Get initials\n */\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createOrgChart;\n","/**\n * Documents Panel Component - Clean Minimal Design\n * Document list with elegant search, filters, and cards\n */\n\nimport { createElement } from '../utils/dom';\nimport { documentsService, Document } from '../services/documents';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime, formatFileSize } from '../utils/format';\nimport { http } from '../services/api';\n\nexport interface DocumentsPanelProps {\n  onDocumentClick?: (document: Document) => void;\n}\n\ntype StatusFilter = 'processed' | 'pending' | 'failed' | 'deleted' | 'all';\ntype TypeFilter = 'all' | 'documents' | 'transcripts' | 'emails' | 'images';\ntype SortOption = 'date' | 'name' | 'size';\ntype ViewMode = 'grid' | 'list';\n\nlet currentStatus: StatusFilter = 'processed';\nlet currentType: TypeFilter = 'all';\nlet currentSort: SortOption = 'date';\nlet currentViewMode: ViewMode = 'grid';\nlet currentSearch = '';\nlet selectedDocuments: Set<string> = new Set();\nlet allDocuments: Document[] = [];\n\n/**\n * Create documents panel - Clean Minimal\n */\nexport function createDocumentsPanel(props: DocumentsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'documents-panel-minimal' });\n\n  panel.innerHTML = `\n    <style>\n      .documents-panel-minimal {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        background: var(--bg-primary);\n        padding: 32px;\n      }\n\n      /* Header - Minimal */\n      .docs-header-minimal {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 32px;\n      }\n      .docs-title-section {\n        display: flex;\n        align-items: baseline;\n        gap: 16px;\n      }\n      .docs-title-section h1 {\n        margin: 0;\n        font-size: 32px;\n        font-weight: 700;\n        color: var(--text-primary);\n      }\n      .docs-total-count {\n        font-size: 16px;\n        color: var(--text-tertiary);\n        font-weight: 400;\n      }\n      .docs-header-actions {\n        display: flex;\n        gap: 12px;\n        align-items: center;\n      }\n      \n      /* View Mode Toggle */\n      .view-mode-toggle {\n        display: flex;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        padding: 4px;\n        gap: 2px;\n      }\n      .view-mode-btn {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: 36px;\n        height: 32px;\n        border: none;\n        background: transparent;\n        border-radius: 6px;\n        cursor: pointer;\n        color: var(--text-tertiary);\n        transition: all 0.15s ease;\n      }\n      .view-mode-btn:hover {\n        color: var(--text-primary);\n        background: var(--bg-tertiary);\n      }\n      .view-mode-btn.active {\n        background: var(--primary);\n        color: white;\n      }\n      .view-mode-btn svg {\n        width: 18px;\n        height: 18px;\n      }\n\n      .btn-minimal {\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 10px 20px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        border: none;\n      }\n      .btn-minimal.primary {\n        background: var(--primary);\n        color: white;\n      }\n      .btn-minimal.primary:hover {\n        opacity: 0.9;\n        transform: translateY(-1px);\n      }\n      .btn-minimal.secondary {\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      .btn-minimal.secondary:hover {\n        background: var(--bg-tertiary);\n      }\n      .btn-minimal svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* Search and Filters - Single Line */\n      .docs-controls {\n        display: flex;\n        align-items: center;\n        gap: 16px;\n        margin-bottom: 24px;\n        flex-wrap: wrap;\n      }\n      .docs-search-minimal {\n        flex: 1;\n        min-width: 280px;\n        max-width: 400px;\n        position: relative;\n      }\n      .docs-search-minimal input {\n        width: 100%;\n        padding: 12px 16px 12px 44px;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        font-size: 14px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        transition: all 0.15s ease;\n      }\n      .docs-search-minimal input:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\n      }\n      .docs-search-minimal input::placeholder {\n        color: var(--text-tertiary);\n      }\n      .docs-search-minimal svg {\n        position: absolute;\n        left: 14px;\n        top: 50%;\n        transform: translateY(-50%);\n        color: var(--text-tertiary);\n        width: 18px;\n        height: 18px;\n      }\n\n      /* Filter Chips */\n      .docs-filters {\n        display: flex;\n        gap: 8px;\n        flex-wrap: wrap;\n      }\n      .filter-chip-minimal {\n        padding: 8px 16px;\n        border-radius: 20px;\n        font-size: 13px;\n        font-weight: 500;\n        background: var(--bg-secondary);\n        color: var(--text-secondary);\n        border: 1px solid transparent;\n        cursor: pointer;\n        transition: all 0.15s ease;\n      }\n      .filter-chip-minimal:hover {\n        background: var(--bg-tertiary);\n        color: var(--text-primary);\n      }\n      .filter-chip-minimal.active {\n        background: var(--primary);\n        color: white;\n      }\n\n      /* Divider with status */\n      .docs-status-bar {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 16px 0;\n        border-bottom: 1px solid var(--border-color);\n        margin-bottom: 24px;\n      }\n      .status-chip {\n        padding: 6px 14px;\n        border-radius: 8px;\n        font-size: 12px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        background: transparent;\n        border: none;\n        color: var(--text-secondary);\n      }\n      .status-chip:hover {\n        background: var(--bg-tertiary);\n      }\n      .status-chip.active {\n        background: var(--bg-tertiary);\n        color: var(--text-primary);\n      }\n      .status-chip.active.processed { color: #10b981; background: rgba(16, 185, 129, 0.1); }\n      .status-chip.active.pending { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }\n      .status-chip.active.failed { color: #ef4444; background: rgba(239, 68, 68, 0.1); }\n      .status-chip.active.deleted { color: #6b7280; background: rgba(107, 114, 128, 0.1); }\n      .status-chip .chip-count {\n        margin-left: 6px;\n        padding: 2px 6px;\n        font-size: 10px;\n        background: rgba(0,0,0,0.05);\n        border-radius: 6px;\n      }\n      [data-theme=\"dark\"] .status-chip .chip-count {\n        background: rgba(255,255,255,0.1);\n      }\n      .status-chip.active .chip-count {\n        background: rgba(0,0,0,0.1);\n      }\n      .docs-sort-minimal {\n        margin-left: auto;\n        padding: 8px 12px;\n        border: 1px solid var(--border-color);\n        border-radius: 8px;\n        background: var(--bg-secondary);\n        font-size: 13px;\n        color: var(--text-primary);\n        cursor: pointer;\n      }\n\n      /* Documents Grid - Larger Cards */\n      .docs-content-minimal {\n        flex: 1;\n        overflow-y: auto;\n      }\n      .docs-grid-minimal {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));\n        gap: 20px;\n      }\n      \n      /* List View Mode */\n      .docs-grid-minimal.list-view {\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n      }\n      .docs-grid-minimal.list-view .doc-card-minimal {\n        flex-direction: row;\n        align-items: center;\n        padding: 12px 20px;\n        gap: 16px;\n        border-radius: 12px;\n      }\n      .docs-grid-minimal.list-view .doc-card-header {\n        flex-shrink: 0;\n        gap: 12px;\n      }\n      .docs-grid-minimal.list-view .doc-card-header .doc-icon {\n        width: 40px;\n        height: 40px;\n        font-size: 18px;\n        border-radius: 8px;\n      }\n      .docs-grid-minimal.list-view .doc-info {\n        flex: 1;\n        display: flex;\n        align-items: center;\n        gap: 24px;\n        min-width: 0;\n      }\n      .docs-grid-minimal.list-view .doc-filename {\n        flex: 1;\n        min-width: 0;\n        margin: 0;\n      }\n      .docs-grid-minimal.list-view .doc-meta {\n        display: flex;\n        gap: 16px;\n        color: var(--text-tertiary);\n        font-size: 13px;\n        flex-shrink: 0;\n      }\n      .docs-grid-minimal.list-view .doc-status-badge {\n        margin: 0;\n        flex-shrink: 0;\n      }\n      .docs-grid-minimal.list-view .doc-summary-section,\n      .docs-grid-minimal.list-view .doc-entities-mini,\n      .docs-grid-minimal.list-view .doc-card-hover {\n        display: none;\n      }\n\n      /* Document Card - Clean Design */\n      .doc-card-minimal {\n        background: var(--bg-secondary);\n        border-radius: 16px;\n        border: 1px solid var(--border-color);\n        padding: 20px;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        position: relative;\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n      }\n      .doc-card-minimal:hover {\n        border-color: rgba(var(--primary-rgb), 0.4);\n        box-shadow: 0 8px 24px rgba(0,0,0,0.08);\n        transform: translateY(-2px);\n      }\n      .doc-card-minimal.selected {\n        border-color: var(--primary);\n        background: rgba(var(--primary-rgb), 0.02);\n      }\n\n      /* Card Header */\n      .doc-card-top {\n        display: flex;\n        align-items: flex-start;\n        gap: 16px;\n      }\n      .doc-icon-minimal {\n        width: 52px;\n        height: 52px;\n        border-radius: 14px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n        flex-shrink: 0;\n      }\n      .doc-icon-minimal.pdf { background: linear-gradient(135deg, #fef2f2, #fee2e2); }\n      .doc-icon-minimal.doc { background: linear-gradient(135deg, #eff6ff, #dbeafe); }\n      .doc-icon-minimal.img { background: linear-gradient(135deg, #f0fdf4, #dcfce7); }\n      .doc-icon-minimal.txt { background: linear-gradient(135deg, #fefce8, #fef9c3); }\n      .doc-icon-minimal.default { background: linear-gradient(135deg, #f5f5f5, #e5e5e5); }\n      [data-theme=\"dark\"] .doc-icon-minimal.pdf { background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.1)); }\n      [data-theme=\"dark\"] .doc-icon-minimal.doc { background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(59,130,246,0.1)); }\n      [data-theme=\"dark\"] .doc-icon-minimal.img { background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.1)); }\n      [data-theme=\"dark\"] .doc-icon-minimal.txt { background: linear-gradient(135deg, rgba(234,179,8,0.15), rgba(234,179,8,0.1)); }\n      [data-theme=\"dark\"] .doc-icon-minimal.default { background: linear-gradient(135deg, rgba(107,114,128,0.15), rgba(107,114,128,0.1)); }\n\n      .doc-info-minimal {\n        flex: 1;\n        min-width: 0;\n      }\n      .doc-filename-minimal {\n        font-size: 15px;\n        font-weight: 600;\n        color: var(--text-primary);\n        margin-bottom: 6px;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .doc-meta-minimal {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 13px;\n        color: var(--text-tertiary);\n      }\n      .doc-meta-minimal .sep {\n        color: var(--border-color);\n      }\n      .doc-status-badge {\n        padding: 4px 10px;\n        font-size: 11px;\n        font-weight: 600;\n        border-radius: 6px;\n        text-transform: capitalize;\n      }\n      .doc-status-badge.processed { background: rgba(16, 185, 129, 0.1); color: #10b981; }\n      .doc-status-badge.pending { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }\n      .doc-status-badge.failed { background: rgba(239, 68, 68, 0.1); color: #ef4444; }\n      .doc-status-badge.deleted { background: rgba(107, 114, 128, 0.1); color: #6b7280; }\n\n      /* Card Summary */\n      .doc-summary-minimal {\n        font-size: 14px;\n        line-height: 1.6;\n        color: var(--text-secondary);\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n      }\n\n      /* Card Footer */\n      .doc-card-footer {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding-top: 16px;\n        border-top: 1px solid var(--border-color);\n      }\n      .doc-entities {\n        display: flex;\n        gap: 16px;\n      }\n      .doc-entity-item {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        font-size: 13px;\n        color: var(--text-secondary);\n      }\n      .doc-entity-item .icon {\n        width: 20px;\n        height: 20px;\n        border-radius: 6px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 11px;\n      }\n      .doc-entity-item.facts .icon { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }\n      .doc-entity-item.decisions .icon { background: rgba(16, 185, 129, 0.1); color: #10b981; }\n      .doc-entity-item.risks .icon { background: rgba(239, 68, 68, 0.1); color: #ef4444; }\n\n      .doc-actions-minimal {\n        display: flex;\n        gap: 4px;\n        opacity: 0;\n        transition: opacity 0.15s ease;\n      }\n      .doc-card-minimal:hover .doc-actions-minimal {\n        opacity: 1;\n      }\n      .doc-action-btn {\n        width: 32px;\n        height: 32px;\n        border-radius: 8px;\n        background: var(--bg-primary);\n        border: 1px solid var(--border-color);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        color: var(--text-secondary);\n        font-size: 14px;\n      }\n      .doc-action-btn:hover {\n        background: var(--primary);\n        border-color: var(--primary);\n        color: white;\n      }\n      .doc-action-btn.favorite.active {\n        color: #f59e0b;\n      }\n      .doc-action-btn.favorite:hover {\n        background: #f59e0b;\n        border-color: #f59e0b;\n        color: white;\n      }\n\n      /* Selection */\n      .doc-select-checkbox {\n        position: absolute;\n        top: 16px;\n        left: 16px;\n        width: 22px;\n        height: 22px;\n        border-radius: 6px;\n        border: 2px solid var(--border-color);\n        background: var(--bg-primary);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        opacity: 0;\n        transition: all 0.15s ease;\n        font-size: 12px;\n        color: white;\n      }\n      .doc-card-minimal:hover .doc-select-checkbox,\n      .doc-card-minimal.selected .doc-select-checkbox {\n        opacity: 1;\n      }\n      .doc-card-minimal.selected .doc-select-checkbox {\n        background: var(--primary);\n        border-color: var(--primary);\n      }\n\n      /* Selection Bar */\n      .selection-bar-minimal {\n        position: fixed;\n        bottom: 32px;\n        left: 50%;\n        transform: translateX(-50%);\n        display: flex;\n        align-items: center;\n        gap: 16px;\n        padding: 16px 24px;\n        background: #1e293b;\n        border-radius: 16px;\n        box-shadow: 0 12px 40px rgba(0,0,0,0.25);\n        z-index: 100;\n        animation: slideUp 0.25s ease;\n      }\n      @keyframes slideUp {\n        from { transform: translateX(-50%) translateY(100px); opacity: 0; }\n        to { transform: translateX(-50%) translateY(0); opacity: 1; }\n      }\n      .selection-bar-minimal.hidden { display: none; }\n      .selection-count-minimal {\n        color: white;\n        font-weight: 600;\n        padding-right: 16px;\n        border-right: 1px solid rgba(255,255,255,0.2);\n      }\n      .selection-count-minimal span { color: #60a5fa; }\n      .selection-bar-minimal .btn-minimal {\n        padding: 8px 16px;\n        font-size: 13px;\n      }\n      .selection-bar-minimal .btn-minimal.secondary {\n        background: rgba(255,255,255,0.1);\n        color: white;\n        border-color: transparent;\n      }\n      .selection-bar-minimal .btn-minimal.secondary:hover {\n        background: rgba(255,255,255,0.2);\n      }\n      .selection-bar-minimal .btn-minimal.danger {\n        background: #ef4444;\n        color: white;\n        border: none;\n      }\n\n      /* Empty State */\n      .docs-empty-minimal {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 80px 40px;\n        text-align: center;\n        grid-column: 1 / -1;\n      }\n      .docs-empty-minimal .empty-icon {\n        width: 80px;\n        height: 80px;\n        border-radius: 24px;\n        background: var(--bg-tertiary);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 36px;\n        margin-bottom: 24px;\n      }\n      .docs-empty-minimal h3 {\n        margin: 0 0 8px 0;\n        font-size: 20px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n      .docs-empty-minimal p {\n        margin: 0 0 24px 0;\n        color: var(--text-secondary);\n      }\n\n      /* Loading */\n      .docs-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 60px;\n        grid-column: 1 / -1;\n        color: var(--text-secondary);\n        gap: 12px;\n      }\n      .docs-loading::after {\n        content: '';\n        width: 20px;\n        height: 20px;\n        border: 2px solid var(--border-color);\n        border-top-color: var(--primary);\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n      }\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n      \n      /* Accessibility: Screen reader only content */\n      .visually-hidden {\n        position: absolute;\n        width: 1px;\n        height: 1px;\n        padding: 0;\n        margin: -1px;\n        overflow: hidden;\n        clip: rect(0, 0, 0, 0);\n        white-space: nowrap;\n        border: 0;\n      }\n      \n      /* Focus styles for keyboard navigation */\n      .doc-card-minimal:focus {\n        outline: 2px solid var(--primary);\n        outline-offset: 2px;\n      }\n      .doc-card-minimal:focus-visible {\n        outline: 2px solid var(--primary);\n        outline-offset: 2px;\n      }\n    </style>\n    \n    <!-- Header -->\n    <div class=\"docs-header-minimal\">\n      <div class=\"docs-title-section\">\n        <h1>Files</h1>\n        <span class=\"docs-total-count\"><span id=\"total-count\">0</span> documents</span>\n      </div>\n      <div class=\"docs-header-actions\">\n        <!-- View Mode Toggle -->\n        <div class=\"view-mode-toggle\">\n          <button class=\"view-mode-btn active\" data-view=\"grid\" title=\"Grid view\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"/>\n              <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"/>\n              <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"/>\n              <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"/>\n            </svg>\n          </button>\n          <button class=\"view-mode-btn\" data-view=\"list\" title=\"List view\">\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <line x1=\"8\" y1=\"6\" x2=\"21\" y2=\"6\"/>\n              <line x1=\"8\" y1=\"12\" x2=\"21\" y2=\"12\"/>\n              <line x1=\"8\" y1=\"18\" x2=\"21\" y2=\"18\"/>\n              <line x1=\"3\" y1=\"6\" x2=\"3.01\" y2=\"6\"/>\n              <line x1=\"3\" y1=\"12\" x2=\"3.01\" y2=\"12\"/>\n              <line x1=\"3\" y1=\"18\" x2=\"3.01\" y2=\"18\"/>\n            </svg>\n          </button>\n        </div>\n        <button class=\"btn-minimal primary\" id=\"upload-btn\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\n            <polyline points=\"17 8 12 3 7 8\"/>\n            <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\n          </svg>\n          Upload\n        </button>\n      </div>\n    </div>\n\n    <!-- Controls -->\n    <div class=\"docs-controls\" role=\"search\">\n      <div class=\"docs-search-minimal\">\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" aria-hidden=\"true\">\n          <circle cx=\"11\" cy=\"11\" r=\"8\"/>\n          <path d=\"m21 21-4.3-4.3\"/>\n        </svg>\n        <input type=\"text\" id=\"docs-search-input\" placeholder=\"Search files...\" \n               aria-label=\"Search files\" autocomplete=\"off\">\n      </div>\n      <div class=\"docs-filters\" role=\"tablist\" aria-label=\"Filter by document type\">\n        <button class=\"filter-chip-minimal active\" data-type=\"all\" role=\"tab\" aria-selected=\"true\">All</button>\n        <button class=\"filter-chip-minimal\" data-type=\"documents\" role=\"tab\" aria-selected=\"false\">Documents</button>\n        <button class=\"filter-chip-minimal\" data-type=\"transcripts\" role=\"tab\" aria-selected=\"false\">Transcripts</button>\n        <button class=\"filter-chip-minimal\" data-type=\"emails\" role=\"tab\" aria-selected=\"false\">Emails</button>\n        <button class=\"filter-chip-minimal\" data-type=\"images\" role=\"tab\" aria-selected=\"false\">Images</button>\n      </div>\n    </div>\n\n    <!-- Status Bar -->\n    <div class=\"docs-status-bar\" role=\"tablist\" aria-label=\"Filter by status\">\n      <button class=\"status-chip active processed\" data-status=\"processed\" role=\"tab\" aria-selected=\"true\">\n        Processed <span class=\"chip-count\" id=\"count-processed\" aria-label=\"count\">0</span>\n      </button>\n      <button class=\"status-chip pending\" data-status=\"pending\" role=\"tab\" aria-selected=\"false\">\n        Pending <span class=\"chip-count\" id=\"count-pending\" aria-label=\"count\">0</span>\n      </button>\n      <button class=\"status-chip failed\" data-status=\"failed\" role=\"tab\" aria-selected=\"false\">\n        Failed <span class=\"chip-count\" id=\"count-failed\" aria-label=\"count\">0</span>\n      </button>\n      <button class=\"status-chip deleted\" data-status=\"deleted\" role=\"tab\" aria-selected=\"false\">\n        Deleted <span class=\"chip-count\" id=\"count-deleted\" aria-label=\"count\">0</span>\n      </button>\n      <label for=\"sort-select\" class=\"visually-hidden\">Sort order</label>\n      <select class=\"docs-sort-minimal\" id=\"sort-select\" aria-label=\"Sort files\">\n        <option value=\"date\">Newest first</option>\n        <option value=\"name\">Name A-Z</option>\n        <option value=\"size\">Largest first</option>\n      </select>\n    </div>\n\n    <!-- Content -->\n    <div class=\"docs-content-minimal\" role=\"main\">\n      <div class=\"docs-grid-minimal\" id=\"docs-grid\" role=\"list\" aria-label=\"Document list\" tabindex=\"0\">\n        <div class=\"docs-loading\" aria-live=\"polite\">Loading files</div>\n      </div>\n    </div>\n\n    <!-- Selection Bar -->\n    <div class=\"selection-bar-minimal hidden\" id=\"selection-bar\" role=\"toolbar\" aria-label=\"Bulk actions\">\n      <span class=\"selection-count-minimal\" aria-live=\"polite\"><span id=\"selected-count\">0</span> selected</span>\n      <button class=\"btn-minimal secondary\" id=\"bulk-export-btn\" aria-label=\"Export selected files\">Export</button>\n      <button class=\"btn-minimal secondary\" id=\"bulk-reprocess-btn\" aria-label=\"Reprocess selected files\">Reprocess</button>\n      <button class=\"btn-minimal danger\" id=\"bulk-delete-btn\" aria-label=\"Delete selected files\">Delete</button>\n      <button class=\"btn-minimal secondary\" id=\"cancel-selection-btn\" aria-label=\"Cancel selection\">Cancel</button>\n    </div>\n  `;\n\n  // Bind events\n  bindPanelEvents(panel, props);\n  \n  // Initial load\n  loadDocuments(panel, props);\n\n  return panel;\n}\n\n/**\n * Bind panel events\n */\nfunction bindPanelEvents(panel: HTMLElement, props: DocumentsPanelProps): void {\n  // Upload button\n  panel.querySelector('#upload-btn')?.addEventListener('click', async () => {\n    const { showFileUploadModal } = await import('./modals/FileUploadModal');\n    showFileUploadModal({ onComplete: () => loadDocuments(panel, props) });\n  });\n\n  // Search with server-side filtering and 500ms debounce\n  const searchInput = panel.querySelector('#docs-search-input') as HTMLInputElement;\n  let searchTimeout: ReturnType<typeof setTimeout>;\n  searchInput?.addEventListener('input', () => {\n    clearTimeout(searchTimeout);\n    searchTimeout = setTimeout(() => {\n      const newSearch = searchInput.value.trim();\n      if (newSearch !== currentSearch) {\n        currentSearch = newSearch;\n        // Trigger server-side search if query is 2+ chars or empty\n        if (currentSearch.length >= 2 || currentSearch.length === 0) {\n          loadDocuments(panel, props);\n        }\n      }\n    }, 500); // Increased debounce for better UX\n  });\n\n  // Sort select\n  panel.querySelector('#sort-select')?.addEventListener('change', (e) => {\n    currentSort = (e.target as HTMLSelectElement).value as SortOption;\n    renderFilteredDocuments(panel, props);\n  });\n\n  // Type filters\n  panel.querySelectorAll('.filter-chip-minimal').forEach(chip => {\n    chip.addEventListener('click', () => {\n      panel.querySelectorAll('.filter-chip-minimal').forEach(c => c.classList.remove('active'));\n      chip.classList.add('active');\n      currentType = chip.getAttribute('data-type') as TypeFilter;\n      renderFilteredDocuments(panel, props);\n    });\n  });\n\n  // Status chips\n  panel.querySelectorAll('.status-chip').forEach(chip => {\n    chip.addEventListener('click', () => {\n      panel.querySelectorAll('.status-chip').forEach(c => c.classList.remove('active'));\n      chip.classList.add('active');\n      currentStatus = chip.getAttribute('data-status') as StatusFilter;\n      loadDocuments(panel, props);\n    });\n  });\n\n  // View mode toggle\n  panel.querySelectorAll('.view-mode-btn').forEach(btn => {\n    btn.addEventListener('click', () => {\n      panel.querySelectorAll('.view-mode-btn').forEach(b => b.classList.remove('active'));\n      btn.classList.add('active');\n      currentViewMode = btn.getAttribute('data-view') as ViewMode;\n      \n      const grid = panel.querySelector('#docs-grid');\n      if (grid) {\n        if (currentViewMode === 'list') {\n          grid.classList.add('list-view');\n        } else {\n          grid.classList.remove('list-view');\n        }\n      }\n    });\n  });\n\n  // Bulk actions\n  panel.querySelector('#bulk-delete-btn')?.addEventListener('click', () => bulkDelete(panel, props));\n  panel.querySelector('#bulk-export-btn')?.addEventListener('click', () => bulkExport());\n  panel.querySelector('#bulk-reprocess-btn')?.addEventListener('click', () => bulkReprocess(panel, props));\n  panel.querySelector('#cancel-selection-btn')?.addEventListener('click', () => {\n    selectedDocuments.clear();\n    updateSelection(panel);\n  });\n}\n\n/**\n * Load documents\n */\nasync function loadDocuments(panel: HTMLElement, props: DocumentsPanelProps): Promise<void> {\n  const grid = panel.querySelector('#docs-grid') as HTMLElement;\n  grid.innerHTML = '<div class=\"docs-loading\" aria-live=\"polite\">Loading files</div>';\n\n  try {\n    // Use server-side filtering for better performance\n    const result = await documentsService.getAll({\n      status: currentStatus === 'all' ? undefined : currentStatus,\n      type: currentType === 'all' ? undefined : currentType,\n      search: currentSearch || undefined,\n      sort: currentSort === 'date' ? 'created_at' : currentSort === 'name' ? 'filename' : undefined,\n      order: currentSort === 'date' ? 'desc' : 'asc',\n      limit: 100 // Load more items for better UX\n    });\n    \n    allDocuments = result.documents || [];\n    \n    console.log('%c[DocumentsPanel] Load result:', 'color: green; font-weight: bold', { \n      total: result.total, \n      docsCount: allDocuments.length,\n      firstDoc: allDocuments[0],\n      currentStatus,\n      currentType\n    });\n    \n    // Update counts\n    const statuses = result.statuses || {};\n    panel.querySelector('#total-count')!.textContent = String(result.total || allDocuments.length);\n    panel.querySelector('#count-processed')!.textContent = String(statuses.processed || 0);\n    panel.querySelector('#count-pending')!.textContent = String((statuses.pending || 0) + (statuses.processing || 0));\n    panel.querySelector('#count-failed')!.textContent = String(statuses.failed || 0);\n    panel.querySelector('#count-deleted')!.textContent = String(statuses.deleted || 0);\n    \n    renderFilteredDocuments(panel, props);\n  } catch (err) {\n    console.error('[DocumentsPanel] Failed to load:', err);\n    grid.innerHTML = '<div class=\"docs-empty-minimal\"><div class=\"empty-icon\">!</div><h3>Failed to load files</h3><p>Please try again</p></div>';\n  }\n}\n\n/**\n * Render filtered documents\n * Note: Server-side filtering is used for status, type, and search.\n * This function now handles only local sorting for size (server doesn't support size sort).\n */\nfunction renderFilteredDocuments(panel: HTMLElement, props: DocumentsPanelProps): void {\n  let filtered = [...allDocuments];\n  \n  // Only need to handle size sorting locally (server handles date and name)\n  if (currentSort === 'size') {\n    filtered.sort((a, b) => (b.size || 0) - (a.size || 0));\n  }\n  \n  renderDocumentsGrid(panel, filtered, props);\n}\n\n/**\n * Get document type from filename\n */\nfunction getDocType(filename: string): string {\n  const ext = filename.split('.').pop()?.toLowerCase();\n  if (['pdf', 'doc', 'docx', 'txt', 'md', 'rtf'].includes(ext || '')) return 'document';\n  if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp'].includes(ext || '')) return 'image';\n  if (['eml', 'msg'].includes(ext || '')) return 'email';\n  return 'document';\n}\n\n/**\n * Render documents grid\n */\nfunction renderDocumentsGrid(panel: HTMLElement, documents: Document[], props: DocumentsPanelProps): void {\n  const grid = panel.querySelector('#docs-grid') as HTMLElement;\n  \n  if (documents.length === 0) {\n    grid.innerHTML = `\n      <div class=\"docs-empty-minimal\">\n        <div class=\"empty-icon\"></div>\n        <h3>No files found</h3>\n        <p>Upload files to get started</p>\n        <button class=\"btn-minimal primary\" id=\"empty-upload-btn\">Upload Files</button>\n      </div>\n    `;\n    \n    grid.querySelector('#empty-upload-btn')?.addEventListener('click', async () => {\n      const { showFileUploadModal } = await import('./modals/FileUploadModal');\n      showFileUploadModal({ onComplete: () => loadDocuments(panel, props) });\n    });\n    return;\n  }\n\n  // Add data-index for potential virtual scrolling\n  grid.innerHTML = documents.map((doc, index) => createDocumentCard(doc, index)).join('');\n  \n  // Add total count and scroll height data for virtual scrolling\n  grid.setAttribute('data-total', String(documents.length));\n\n  // Bind card events\n  grid.querySelectorAll('.doc-card-minimal').forEach(card => {\n    const id = card.getAttribute('data-id')!;\n    const doc = documents.find(d => String(d.id) === id);\n    \n    // Click to preview\n    card.addEventListener('click', (e) => {\n      const target = e.target as HTMLElement;\n      if (target.closest('.doc-select-checkbox') || target.closest('.doc-action-btn')) return;\n      \n      if (doc && props.onDocumentClick) {\n        props.onDocumentClick(doc);\n      }\n    });\n    \n    // Keyboard navigation\n    card.addEventListener('keydown', (e: KeyboardEvent) => {\n      const cards = Array.from(grid.querySelectorAll('.doc-card-minimal'));\n      const currentIndex = cards.indexOf(card);\n      \n      switch (e.key) {\n        case 'Enter':\n        case ' ':\n          e.preventDefault();\n          if (doc && props.onDocumentClick) {\n            props.onDocumentClick(doc);\n          }\n          break;\n        case 'ArrowDown':\n        case 'ArrowRight':\n          e.preventDefault();\n          if (currentIndex < cards.length - 1) {\n            (cards[currentIndex + 1] as HTMLElement).focus();\n          }\n          break;\n        case 'ArrowUp':\n        case 'ArrowLeft':\n          e.preventDefault();\n          if (currentIndex > 0) {\n            (cards[currentIndex - 1] as HTMLElement).focus();\n          }\n          break;\n        case 's':\n          e.preventDefault();\n          // Toggle selection\n          if (selectedDocuments.has(id)) {\n            selectedDocuments.delete(id);\n          } else {\n            selectedDocuments.add(id);\n          }\n          updateSelection(panel);\n          break;\n        case 'Delete':\n        case 'Backspace':\n          e.preventDefault();\n          if (doc && confirm(`Delete \"${doc.filename}\"?`)) {\n            documentsService.delete(id, { softDelete: true }).then(() => {\n              toast.success('File deleted');\n              loadDocuments(panel, props);\n            }).catch(() => toast.error('Failed to delete'));\n          }\n          break;\n      }\n    });\n    \n    // Checkbox for selection\n    card.querySelector('.doc-select-checkbox')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n      if (selectedDocuments.has(id)) {\n        selectedDocuments.delete(id);\n      } else {\n        selectedDocuments.add(id);\n      }\n      updateSelection(panel);\n    });\n    \n    // Favorite toggle\n    card.querySelector('.doc-action-btn.favorite')?.addEventListener('click', async (e) => {\n      e.stopPropagation();\n      try {\n        await http.post(`/api/documents/${id}/favorite`);\n        (e.target as HTMLElement).classList.toggle('active');\n        toast.success('Updated favorites');\n      } catch {\n        toast.error('Failed to update favorite');\n      }\n    });\n  });\n}\n\n/**\n * Create document card HTML\n */\nfunction createDocumentCard(doc: Document, index = 0): string {\n  const iconClass = getIconClass(doc.filename || '');\n  const icon = getDocumentIcon(doc.filename || '');\n  const isSelected = selectedDocuments.has(doc.id);\n  const factsCount = doc.facts_count || 0;\n  const decisionsCount = (doc as any).decisions_count || 0;\n  const risksCount = (doc as any).risks_count || 0;\n\n  const entitiesLabel = [\n    factsCount > 0 ? `${factsCount} facts` : '',\n    decisionsCount > 0 ? `${decisionsCount} decisions` : '',\n    risksCount > 0 ? `${risksCount} risks` : ''\n  ].filter(Boolean).join(', ') || 'No entities';\n  \n  return `\n    <div class=\"doc-card-minimal ${isSelected ? 'selected' : ''}\" \n         data-id=\"${doc.id}\"\n         data-index=\"${index}\"\n         role=\"listitem\"\n         tabindex=\"0\"\n         aria-label=\"${escapeHtml(doc.filename || 'Untitled')}. Status: ${doc.status}. ${entitiesLabel}\">\n      <div class=\"doc-select-checkbox\" role=\"checkbox\" aria-checked=\"${isSelected}\" aria-label=\"Select document\">${isSelected ? '' : ''}</div>\n      \n      <div class=\"doc-card-top\">\n        <div class=\"doc-icon-minimal ${iconClass}\" aria-hidden=\"true\">${icon}</div>\n        <div class=\"doc-info-minimal\">\n          <div class=\"doc-filename-minimal\">${escapeHtml(doc.filename || 'Untitled')}</div>\n          <div class=\"doc-meta-minimal\">\n            <span>${formatFileSize((doc as any).file_size || doc.size || 0)}</span>\n            <span class=\"sep\" aria-hidden=\"true\"></span>\n            <span>${formatRelativeTime(doc.created_at)}</span>\n          </div>\n        </div>\n        <span class=\"doc-status-badge ${doc.status}\" aria-label=\"Status: ${doc.status}\">${doc.status}</span>\n      </div>\n      \n      ${doc.summary ? `<div class=\"doc-summary-minimal\">${escapeHtml(doc.summary)}</div>` : ''}\n      \n      <div class=\"doc-card-footer\">\n        <div class=\"doc-entities\" aria-label=\"Extracted entities\">\n          ${factsCount > 0 ? `<span class=\"doc-entity-item facts\"><span class=\"icon\" aria-hidden=\"true\"></span> ${factsCount} facts</span>` : ''}\n          ${decisionsCount > 0 ? `<span class=\"doc-entity-item decisions\"><span class=\"icon\" aria-hidden=\"true\"></span> ${decisionsCount}</span>` : ''}\n          ${risksCount > 0 ? `<span class=\"doc-entity-item risks\"><span class=\"icon\" aria-hidden=\"true\"></span> ${risksCount}</span>` : ''}\n          ${factsCount === 0 && decisionsCount === 0 && risksCount === 0 ? '<span class=\"doc-entity-item\" style=\"color: var(--text-tertiary);\">No entities</span>' : ''}\n        </div>\n        <div class=\"doc-actions-minimal\">\n          <button class=\"doc-action-btn favorite ${(doc as any).is_favorite ? 'active' : ''}\" \n                  title=\"Favorite\" aria-label=\"${(doc as any).is_favorite ? 'Remove from favorites' : 'Add to favorites'}\"\n                  aria-pressed=\"${(doc as any).is_favorite ? 'true' : 'false'}\"></button>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Get icon class based on file type\n */\nfunction getIconClass(filename: string): string {\n  const ext = filename.split('.').pop()?.toLowerCase();\n  switch (ext) {\n    case 'pdf': return 'pdf';\n    case 'doc':\n    case 'docx': return 'doc';\n    case 'jpg':\n    case 'jpeg':\n    case 'png':\n    case 'gif': return 'img';\n    case 'txt':\n    case 'md': return 'txt';\n    default: return 'default';\n  }\n}\n\n/**\n * Update selection state\n */\nfunction updateSelection(panel: HTMLElement): void {\n  const count = selectedDocuments.size;\n  const selectionBar = panel.querySelector('#selection-bar') as HTMLElement;\n  \n  selectionBar.classList.toggle('hidden', count === 0);\n  panel.querySelector('#selected-count')!.textContent = String(count);\n  \n  // Update card states\n  panel.querySelectorAll('.doc-card-minimal').forEach(card => {\n    const id = card.getAttribute('data-id')!;\n    const isSelected = selectedDocuments.has(id);\n    card.classList.toggle('selected', isSelected);\n    const checkbox = card.querySelector('.doc-select-checkbox');\n    if (checkbox) checkbox.textContent = isSelected ? '' : '';\n  });\n}\n\n/**\n * Show loading overlay on panel\n */\nfunction showLoadingOverlay(panel: HTMLElement, message: string): HTMLElement {\n  const overlay = document.createElement('div');\n  overlay.className = 'bulk-loading-overlay';\n  overlay.innerHTML = `\n    <div class=\"bulk-loading-content\">\n      <div class=\"bulk-loading-spinner\"></div>\n      <div class=\"bulk-loading-message\">${message}</div>\n      <div class=\"bulk-loading-progress\" id=\"bulk-progress\"></div>\n    </div>\n  `;\n  overlay.style.cssText = `\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(var(--bg-rgb, 255, 255, 255), 0.9);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 100;\n    backdrop-filter: blur(2px);\n  `;\n  const content = overlay.querySelector('.bulk-loading-content') as HTMLElement;\n  content.style.cssText = 'text-align: center;';\n  const spinner = overlay.querySelector('.bulk-loading-spinner') as HTMLElement;\n  spinner.style.cssText = `\n    width: 40px;\n    height: 40px;\n    border: 3px solid var(--border-color);\n    border-top-color: var(--primary);\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n    margin: 0 auto 16px;\n  `;\n  panel.style.position = 'relative';\n  panel.appendChild(overlay);\n  return overlay;\n}\n\n/**\n * Hide loading overlay\n */\nfunction hideLoadingOverlay(overlay: HTMLElement): void {\n  overlay?.remove();\n}\n\n/**\n * Disable bulk action buttons\n */\nfunction setBulkButtonsDisabled(panel: HTMLElement, disabled: boolean): void {\n  const buttons = panel.querySelectorAll('#bulk-delete-btn, #bulk-export-btn, #bulk-reprocess-btn');\n  buttons.forEach(btn => {\n    (btn as HTMLButtonElement).disabled = disabled;\n  });\n}\n\n/**\n * Bulk delete\n */\nasync function bulkDelete(panel: HTMLElement, props: DocumentsPanelProps): Promise<void> {\n  const count = selectedDocuments.size;\n  if (!confirm(`Delete ${count} files? This action can be undone from the Deleted tab.`)) return;\n  \n  const overlay = showLoadingOverlay(panel, `Deleting ${count} files...`);\n  setBulkButtonsDisabled(panel, true);\n  \n  try {\n    const ids = Array.from(selectedDocuments);\n    const response = await http.post<{ success: boolean; deleted: number; errors: Array<{ id: string; error: string }> }>(\n      '/api/documents/bulk/delete',\n      { ids }\n    );\n    \n    const result = response.data;\n    if (result.errors && result.errors.length > 0) {\n      toast.warning(`Deleted ${result.deleted} files, ${result.errors.length} failed`);\n    } else {\n      toast.success(`Deleted ${result.deleted} files`);\n    }\n    \n    selectedDocuments.clear();\n    loadDocuments(panel, props);\n  } catch (err) {\n    console.error('[BulkDelete] Error:', err);\n    toast.error('Failed to delete files');\n  } finally {\n    hideLoadingOverlay(overlay);\n    setBulkButtonsDisabled(panel, false);\n  }\n}\n\n/**\n * Bulk export\n */\nasync function bulkExport(): Promise<void> {\n  const count = selectedDocuments.size;\n  toast.info(`Preparing export of ${count} files...`);\n  \n  try {\n    const ids = Array.from(selectedDocuments);\n    \n    // Trigger download via form submission (for ZIP file)\n    const response = await http.post<Blob>(\n      '/api/documents/bulk/export',\n      { ids, format: 'original' },\n      { responseType: 'blob' }\n    );\n    \n    // Create download link\n    const blob = response.data;\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `documents-export-${new Date().toISOString().split('T')[0]}.zip`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n    \n    toast.success(`Exported ${count} files`);\n  } catch (err) {\n    console.error('[BulkExport] Error:', err);\n    toast.error('Failed to export files');\n  }\n}\n\n/**\n * Bulk reprocess\n */\nasync function bulkReprocess(panel: HTMLElement, props: DocumentsPanelProps): Promise<void> {\n  const count = selectedDocuments.size;\n  if (!confirm(`Reprocess ${count} files? This will use AI tokens.`)) return;\n  \n  const overlay = showLoadingOverlay(panel, `Queuing ${count} files for reprocessing...`);\n  setBulkButtonsDisabled(panel, true);\n  \n  try {\n    const ids = Array.from(selectedDocuments);\n    const response = await http.post<{ success: boolean; queued: string[]; failed: Array<{ id: string; error: string }> }>(\n      '/api/documents/bulk/reprocess',\n      { ids }\n    );\n    \n    const result = response.data;\n    if (result.failed && result.failed.length > 0) {\n      toast.warning(`Queued ${result.queued?.length || 0} files, ${result.failed.length} failed`);\n    } else {\n      toast.success(`Queued ${result.queued?.length || count} files for reprocessing`);\n    }\n    \n    selectedDocuments.clear();\n    updateSelection(panel);\n    \n    // Reload after a short delay to show updated statuses\n    setTimeout(() => loadDocuments(panel, props), 1000);\n  } catch (err) {\n    console.error('[BulkReprocess] Error:', err);\n    toast.error('Failed to queue files for reprocessing');\n  } finally {\n    hideLoadingOverlay(overlay);\n    setBulkButtonsDisabled(panel, false);\n  }\n}\n\n/**\n * Get document icon\n */\nfunction getDocumentIcon(filename: string): string {\n  const ext = filename.split('.').pop()?.toLowerCase();\n  switch (ext) {\n    case 'pdf': return '';\n    case 'doc':\n    case 'docx': return '';\n    case 'xls':\n    case 'xlsx': return '';\n    case 'ppt':\n    case 'pptx': return '';\n    case 'txt':\n    case 'md': return '';\n    case 'jpg':\n    case 'jpeg':\n    case 'png':\n    case 'gif': return '';\n    default: return '';\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createDocumentsPanel;\n","/**\n * Knowledge Panel Component\n * Knowledge base management with export, regenerate, status\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { knowledgeService, EmbeddingStatus } from '../services/documents';\nimport { toast } from '../services/toast';\n\nexport interface KnowledgePanelProps {\n  onExport?: (format: 'md' | 'json') => void;\n}\n\n/**\n * Create knowledge panel\n */\nexport function createKnowledgePanel(props: KnowledgePanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'knowledge-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <h2>Knowledge Base</h2>\n    </div>\n    <div class=\"panel-content\">\n      <div class=\"knowledge-status\" id=\"knowledge-status\">\n        <div class=\"loading\">Loading status...</div>\n      </div>\n      <div class=\"knowledge-actions\">\n        <div class=\"action-group\">\n          <h4>Export</h4>\n          <div class=\"action-buttons\">\n            <button class=\"btn btn-sm\" id=\"export-md-btn\">Export Markdown</button>\n            <button class=\"btn btn-sm\" id=\"export-json-btn\">Export JSON</button>\n          </div>\n        </div>\n        <div class=\"action-group\">\n          <h4>Maintenance</h4>\n          <div class=\"action-buttons\">\n            <button class=\"btn btn-sm\" id=\"regenerate-btn\">Regenerate Files</button>\n            <button class=\"btn btn-sm\" id=\"synthesize-btn\">Synthesize Facts</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n\n  // Bind events\n  const exportMdBtn = panel.querySelector('#export-md-btn');\n  if (exportMdBtn) {\n    on(exportMdBtn as HTMLElement, 'click', () => exportKnowledge('md', props));\n  }\n\n  const exportJsonBtn = panel.querySelector('#export-json-btn');\n  if (exportJsonBtn) {\n    on(exportJsonBtn as HTMLElement, 'click', () => exportKnowledge('json', props));\n  }\n\n  const regenerateBtn = panel.querySelector('#regenerate-btn');\n  if (regenerateBtn) {\n    on(regenerateBtn as HTMLElement, 'click', () => regenerateKnowledge(panel));\n  }\n\n  const synthesizeBtn = panel.querySelector('#synthesize-btn');\n  if (synthesizeBtn) {\n    on(synthesizeBtn as HTMLElement, 'click', () => synthesizeFacts(panel));\n  }\n\n  // Load status\n  loadStatus(panel);\n\n  return panel;\n}\n\n/**\n * Load embedding status\n */\nasync function loadStatus(panel: HTMLElement): Promise<void> {\n  const container = panel.querySelector('#knowledge-status') as HTMLElement;\n\n  try {\n    const status = await knowledgeService.getStatus();\n    renderStatus(container, status);\n  } catch {\n    container.innerHTML = '<div class=\"error\">Failed to load status</div>';\n  }\n}\n\n/**\n * Render status\n */\nfunction renderStatus(container: HTMLElement, status: EmbeddingStatus): void {\n  container.innerHTML = `\n    <div class=\"status-grid\">\n      <div class=\"status-item\">\n        <span class=\"status-label\">Documents Embedded</span>\n        <span class=\"status-value\">${status.embedded}</span>\n      </div>\n      <div class=\"status-item\">\n        <span class=\"status-label\">Total Chunks</span>\n        <span class=\"status-value\">${status.totalChunks}</span>\n      </div>\n      <div class=\"status-item\">\n        <span class=\"status-label\">Embedding Model</span>\n        <span class=\"status-value\">${status.model || 'Default'}</span>\n      </div>\n      <div class=\"status-item\">\n        <span class=\"status-label\">Last Updated</span>\n        <span class=\"status-value\">${status.lastUpdated ? formatDate(status.lastUpdated) : 'Never'}</span>\n      </div>\n    </div>\n    ${status.available_embedding_models && status.available_embedding_models.length > 0 ? `\n      <div class=\"available-models\">\n        <h5>Available Models</h5>\n        <div class=\"model-list\">\n          ${status.available_embedding_models.map((model: string) => `\n            <span class=\"model-badge\">${model}</span>\n          `).join('')}\n        </div>\n      </div>\n    ` : ''}\n  `;\n}\n\n/**\n * Export knowledge base\n */\nasync function exportKnowledge(format: 'md' | 'json', props: KnowledgePanelProps): Promise<void> {\n  if (props.onExport) {\n    props.onExport(format);\n    return;\n  }\n\n  try {\n    if (format === 'md') {\n      await knowledgeService.exportMarkdown();\n    } else {\n      await knowledgeService.exportJson();\n    }\n    toast.success(`Knowledge base exported as ${format.toUpperCase()}`);\n  } catch {\n    toast.error('Failed to export knowledge base');\n  }\n}\n\n/**\n * Regenerate knowledge files\n */\nasync function regenerateKnowledge(panel: HTMLElement): Promise<void> {\n  if (!confirm('This will regenerate all knowledge files. Continue?')) return;\n\n  const btn = panel.querySelector('#regenerate-btn') as HTMLButtonElement;\n  btn.disabled = true;\n  btn.textContent = 'Regenerating...';\n\n  try {\n    await knowledgeService.regenerate();\n    toast.success('Knowledge files regenerated');\n    loadStatus(panel);\n  } catch {\n    toast.error('Failed to regenerate knowledge files');\n  } finally {\n    btn.disabled = false;\n    btn.textContent = 'Regenerate Files';\n  }\n}\n\n/**\n * Synthesize facts\n */\nasync function synthesizeFacts(panel: HTMLElement): Promise<void> {\n  if (!confirm('This will consolidate and synthesize facts using AI. This may take a while. Continue?')) return;\n\n  const btn = panel.querySelector('#synthesize-btn') as HTMLButtonElement;\n  btn.disabled = true;\n  btn.textContent = 'Synthesizing...';\n\n  try {\n    await knowledgeService.synthesize();\n    toast.success('Facts synthesized');\n    loadStatus(panel);\n  } catch {\n    toast.error('Failed to synthesize facts');\n  } finally {\n    btn.disabled = false;\n    btn.textContent = 'Synthesize Facts';\n  }\n}\n\n/**\n * Format date\n */\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString();\n}\n\nexport default createKnowledgePanel;\n","/**\n * Conversation Composer Component - SOTA UI\n * Multi-mode conversation/transcript input\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { conversationsService } from '../services/documents';\nimport { toast } from '../services/toast';\n\nexport interface ConversationComposerProps {\n  onImport?: (conversation: unknown) => void;\n  onClose?: () => void;\n}\n\ntype InputMode = 'paste' | 'upload';\nlet currentMode: InputMode = 'paste';\n\n/**\n * Show conversation composer modal\n */\nexport function showConversationComposer(props: ConversationComposerProps = {}): void {\n  const existing = document.getElementById('conversation-composer-overlay');\n  if (existing) existing.remove();\n\n  const overlay = createElement('div', { \n    id: 'conversation-composer-overlay',\n    className: 'composer-overlay' \n  });\n\n  const dialog = createConversationComposer(props);\n  overlay.appendChild(dialog);\n  document.body.appendChild(overlay);\n\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) {\n      closeConversationComposer();\n      props.onClose?.();\n    }\n  });\n\n  requestAnimationFrame(() => overlay.classList.add('visible'));\n}\n\n/**\n * Close conversation composer\n */\nexport function closeConversationComposer(): void {\n  const overlay = document.getElementById('conversation-composer-overlay');\n  if (overlay) {\n    overlay.classList.remove('visible');\n    setTimeout(() => overlay.remove(), 200);\n  }\n}\n\n/**\n * Create conversation composer\n */\nfunction createConversationComposer(props: ConversationComposerProps): HTMLElement {\n  const container = createElement('div', { className: 'composer-modal' });\n\n  container.innerHTML = `\n    <style>\n      .composer-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.5);\n        backdrop-filter: blur(8px);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n      }\n      .composer-overlay.visible {\n        opacity: 1;\n      }\n      .composer-overlay.visible .composer-modal {\n        transform: translateY(0) scale(1);\n        opacity: 1;\n      }\n      .composer-modal {\n        width: 640px;\n        max-width: 95vw;\n        max-height: 85vh;\n        background: var(--bg-primary);\n        border-radius: 16px;\n        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        transform: translateY(20px) scale(0.98);\n        opacity: 0;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n      \n      .composer-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      .composer-header h2 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n      .composer-close {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: var(--text-secondary);\n        transition: all 0.15s ease;\n      }\n      .composer-close:hover {\n        background: var(--bg-tertiary);\n        color: var(--text-primary);\n      }\n      \n      .composer-tabs {\n        display: flex;\n        padding: 0 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-tab {\n        padding: 14px 20px;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        background: none;\n        border: none;\n        cursor: pointer;\n        position: relative;\n        transition: color 0.15s ease;\n      }\n      .composer-tab:hover { color: var(--text-primary); }\n      .composer-tab.active { color: var(--primary); }\n      .composer-tab.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: var(--primary);\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .composer-body {\n        flex: 1;\n        padding: 24px;\n        overflow-y: auto;\n      }\n      \n      .paste-section label {\n        display: block;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 12px;\n      }\n      .paste-section textarea {\n        width: 100%;\n        min-height: 280px;\n        padding: 16px;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-family: 'SF Mono', Monaco, monospace;\n        font-size: 13px;\n        line-height: 1.6;\n        resize: vertical;\n        transition: border-color 0.15s ease, box-shadow 0.15s ease;\n      }\n      .paste-section textarea:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\n      }\n      .paste-section textarea::placeholder { color: var(--text-tertiary); }\n      .paste-hint {\n        margin-top: 12px;\n        font-size: 13px;\n        color: var(--text-tertiary);\n      }\n      \n      .format-row {\n        margin-top: 20px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n      .format-row label {\n        font-size: 13px;\n        color: var(--text-secondary);\n        white-space: nowrap;\n      }\n      .format-row select {\n        flex: 1;\n        max-width: 200px;\n        padding: 10px 14px;\n        border: 1px solid var(--border-color);\n        border-radius: 8px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-size: 13px;\n      }\n      \n      .upload-section .dropzone {\n        border: 2px dashed var(--border-color);\n        border-radius: 16px;\n        padding: 60px 40px;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        background: var(--bg-secondary);\n      }\n      .upload-section .dropzone:hover,\n      .upload-section .dropzone.dragover {\n        border-color: var(--primary);\n        background: rgba(var(--primary-rgb), 0.03);\n      }\n      .dropzone-icon { font-size: 48px; margin-bottom: 16px; }\n      .dropzone-title {\n        font-size: 16px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 8px;\n      }\n      .dropzone-hint { font-size: 13px; color: var(--text-tertiary); }\n      \n      .selected-file {\n        display: none;\n        align-items: center;\n        gap: 16px;\n        margin-top: 20px;\n        padding: 16px;\n        background: var(--bg-secondary);\n        border-radius: 12px;\n        border: 1px solid var(--border-color);\n      }\n      .selected-file.visible { display: flex; }\n      .file-icon {\n        width: 48px;\n        height: 48px;\n        background: linear-gradient(135deg, var(--primary), color-mix(in srgb, var(--primary) 70%, white));\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n      }\n      .file-info { flex: 1; min-width: 0; }\n      .file-name {\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .file-size { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }\n      .file-remove {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: transparent;\n        border-radius: 8px;\n        cursor: pointer;\n        color: var(--text-tertiary);\n        font-size: 18px;\n        transition: all 0.15s ease;\n      }\n      .file-remove:hover {\n        background: rgba(239, 68, 68, 0.1);\n        color: #ef4444;\n      }\n      \n      .preview-area {\n        margin-top: 20px;\n        padding: 16px;\n        background: var(--bg-tertiary);\n        border-radius: 12px;\n        display: none;\n      }\n      .preview-area.visible { display: block; }\n      .preview-area h4 {\n        margin: 0 0 12px 0;\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n      .preview-stats {\n        display: flex;\n        gap: 24px;\n        font-size: 14px;\n      }\n      .preview-stats span { color: var(--text-secondary); }\n      .preview-stats strong { color: var(--text-primary); }\n      \n      .composer-footer {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        padding: 16px 24px;\n        border-top: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-footer .btn {\n        padding: 10px 20px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        border: none;\n      }\n      .composer-footer .btn-secondary {\n        background: var(--bg-primary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      .composer-footer .btn-secondary:hover { background: var(--bg-tertiary); }\n      .composer-footer .btn-outline {\n        background: transparent;\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      .composer-footer .btn-outline:hover { background: var(--bg-tertiary); }\n      .composer-footer .btn-primary {\n        background: var(--primary);\n        color: white;\n      }\n      .composer-footer .btn-primary:hover:not(:disabled) {\n        opacity: 0.9;\n        transform: translateY(-1px);\n      }\n      .composer-footer .btn-primary:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n    </style>\n    \n    <div class=\"composer-header\">\n      <h2>Import Conversation</h2>\n      <button class=\"composer-close\" id=\"close-btn\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M18 6L6 18M6 6l12 12\"/>\n        </svg>\n      </button>\n    </div>\n    \n    <div class=\"composer-tabs\">\n      <button class=\"composer-tab active\" data-mode=\"paste\">Paste Text</button>\n      <button class=\"composer-tab\" data-mode=\"upload\">Upload File</button>\n    </div>\n    \n    <div class=\"composer-body\" id=\"composer-body\">\n      ${renderPasteMode()}\n    </div>\n    \n    <div class=\"composer-footer\">\n      <button class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\n      <button class=\"btn btn-outline\" id=\"preview-btn\" disabled>Preview</button>\n      <button class=\"btn btn-primary\" id=\"import-btn\" disabled>Import</button>\n    </div>\n  `;\n\n  // Bind tabs\n  container.querySelectorAll('.composer-tab').forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      container.querySelectorAll('.composer-tab').forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentMode = tab.getAttribute('data-mode') as InputMode;\n      renderMode(container);\n    });\n  });\n\n  on(container.querySelector('#close-btn') as HTMLElement, 'click', () => {\n    closeConversationComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#cancel-btn') as HTMLElement, 'click', () => {\n    closeConversationComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#preview-btn') as HTMLElement, 'click', () => handlePreview(container));\n  on(container.querySelector('#import-btn') as HTMLElement, 'click', () => handleImport(container, props));\n\n  bindPasteMode(container);\n\n  return container;\n}\n\nfunction renderMode(container: HTMLElement): void {\n  const body = container.querySelector('#composer-body') as HTMLElement;\n  body.innerHTML = currentMode === 'paste' ? renderPasteMode() : renderUploadMode();\n  \n  if (currentMode === 'paste') bindPasteMode(container);\n  else bindUploadMode(container);\n}\n\nfunction renderPasteMode(): string {\n  return `\n    <div class=\"paste-section\">\n      <label>Paste conversation or transcript:</label>\n      <textarea id=\"conversation-input\" placeholder=\"Paste your conversation here...\n\nSupported formats:\n WhatsApp, Slack, Teams, Discord chats\n Meeting transcripts (Zoom, Google Meet)\n Email threads\n Any text with speaker names\n\nExample:\n[10:30] John: Hello everyone\n[10:31] Jane: Hi John!\n[10:32] John: Let's discuss the project...\"></textarea>\n      <p class=\"paste-hint\">Include timestamps and speaker names for better parsing.</p>\n      <div class=\"format-row\">\n        <label>Format:</label>\n        <select id=\"format-select\">\n          <option value=\"\">Auto-detect</option>\n          <option value=\"whatsapp\">WhatsApp</option>\n          <option value=\"slack\">Slack</option>\n          <option value=\"teams\">Microsoft Teams</option>\n          <option value=\"discord\">Discord</option>\n          <option value=\"zoom\">Zoom Transcript</option>\n          <option value=\"generic\">Generic Chat</option>\n        </select>\n      </div>\n    </div>\n    <div class=\"preview-area\" id=\"preview-area\"></div>\n  `;\n}\n\nfunction bindPasteMode(container: HTMLElement): void {\n  const textarea = container.querySelector('#conversation-input') as HTMLTextAreaElement;\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n\n  if (textarea) {\n    on(textarea, 'input', () => {\n      const hasContent = textarea.value.trim().length > 10;\n      previewBtn.disabled = !hasContent;\n      importBtn.disabled = !hasContent;\n    });\n  }\n}\n\nfunction renderUploadMode(): string {\n  return `\n    <div class=\"upload-section\">\n      <div class=\"dropzone\" id=\"file-dropzone\">\n        <div class=\"dropzone-icon\"></div>\n        <p class=\"dropzone-title\">Drop chat file here</p>\n        <p class=\"dropzone-hint\">or click to browse  .txt, .json</p>\n        <input type=\"file\" id=\"file-input\" accept=\".txt,.md,.srt,.vtt,.json\" hidden>\n      </div>\n      <div class=\"selected-file\" id=\"selected-file\">\n        <div class=\"file-icon\"></div>\n        <div class=\"file-info\">\n          <div class=\"file-name\" id=\"file-name\"></div>\n          <div class=\"file-size\" id=\"file-size\"></div>\n        </div>\n        <button class=\"file-remove\" id=\"file-remove\"></button>\n      </div>\n    </div>\n    <div class=\"preview-area\" id=\"preview-area\"></div>\n  `;\n}\n\nfunction bindUploadMode(container: HTMLElement): void {\n  const dropzone = container.querySelector('#file-dropzone') as HTMLElement;\n  const input = container.querySelector('#file-input') as HTMLInputElement;\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n\n  on(dropzone, 'click', () => input.click());\n  on(dropzone, 'dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });\n  on(dropzone, 'dragleave', () => dropzone.classList.remove('dragover'));\n  on(dropzone, 'drop', (e) => {\n    e.preventDefault();\n    dropzone.classList.remove('dragover');\n    if (e.dataTransfer?.files[0]) selectFile(e.dataTransfer.files[0], container);\n  });\n  on(input, 'change', () => { if (input.files?.[0]) selectFile(input.files[0], container); });\n  on(container.querySelector('#file-remove') as HTMLElement, 'click', () => {\n    selectedFile.classList.remove('visible');\n    (container as any)._fileContent = null;\n    previewBtn.disabled = true;\n    importBtn.disabled = true;\n  });\n}\n\nfunction selectFile(file: File, container: HTMLElement): void {\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n  \n  container.querySelector('#file-name')!.textContent = file.name;\n  container.querySelector('#file-size')!.textContent = formatFileSize(file.size);\n  selectedFile.classList.add('visible');\n\n  const reader = new FileReader();\n  reader.onload = () => {\n    (container as any)._fileContent = reader.result;\n    previewBtn.disabled = false;\n    importBtn.disabled = false;\n  };\n  reader.readAsText(file);\n}\n\nfunction getContent(container: HTMLElement): string {\n  if (currentMode === 'paste') {\n    return (container.querySelector('#conversation-input') as HTMLTextAreaElement)?.value || '';\n  }\n  return (container as any)._fileContent || '';\n}\n\nasync function handlePreview(container: HTMLElement): Promise<void> {\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const previewArea = container.querySelector('#preview-area') as HTMLElement;\n  const content = getContent(container);\n  if (!content) return;\n\n  previewBtn.disabled = true;\n  previewBtn.textContent = 'Parsing...';\n\n  try {\n    const result = await conversationsService.parsePreview(content);\n    previewArea.classList.add('visible');\n    previewArea.innerHTML = `\n      <h4>Preview</h4>\n      <div class=\"preview-stats\">\n        <span>Messages: <strong>${result.message_count || 0}</strong></span>\n        <span>Participants: <strong>${result.participants?.length || 0}</strong></span>\n        <span>Format: <strong>${result.format || 'Unknown'}</strong></span>\n      </div>\n    `;\n  } catch {\n    toast.error('Failed to parse conversation');\n  } finally {\n    previewBtn.disabled = false;\n    previewBtn.textContent = 'Preview';\n  }\n}\n\nasync function handleImport(container: HTMLElement, props: ConversationComposerProps): Promise<void> {\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n  const content = getContent(container);\n  const formatSelect = container.querySelector('#format-select') as HTMLSelectElement;\n  if (!content) return;\n\n  importBtn.disabled = true;\n  importBtn.textContent = 'Importing...';\n\n  try {\n    const result = await conversationsService.import(content, { formatHint: formatSelect?.value });\n    toast.success('Conversation imported');\n    props.onImport?.(result);\n    closeConversationComposer();\n  } catch {\n    toast.error('Failed to import conversation');\n  } finally {\n    importBtn.disabled = false;\n    importBtn.textContent = 'Import';\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n\nexport default showConversationComposer;\n","/**\n * Conversations Panel Component\n * Conversation list with import and re-embed\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { conversationsService } from '../services/documents';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\nimport { showConversationComposer } from './ConversationComposer';\nimport { showConversationPreviewModal } from './modals/ConversationPreviewModal';\n\nexport interface ConversationsPanelProps {\n  onConversationClick?: (conversation: Conversation) => void;\n}\n\ninterface Conversation {\n  id: string;\n  title?: string;\n  participants?: string[];\n  message_count?: number;\n  source?: string;\n  created_at: string;\n  embedded?: boolean;\n}\n\n/**\n * Create conversations panel\n */\nexport function createConversationsPanel(props: ConversationsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'conversations-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Conversations</h2>\n        <span class=\"panel-count\" id=\"conversations-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <button class=\"btn btn-primary btn-sm\" id=\"import-conv-btn\">Import</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"conversations-content\">\n      <div class=\"loading\">Loading conversations...</div>\n    </div>\n  `;\n\n  // Bind import button\n  const importBtn = panel.querySelector('#import-conv-btn');\n  if (importBtn) {\n    on(importBtn as HTMLElement, 'click', () => showImportDialog(panel, props));\n  }\n\n  // Initial load\n  loadConversations(panel, props);\n\n  return panel;\n}\n\n/**\n * Load conversations\n */\nasync function loadConversations(panel: HTMLElement, props: ConversationsPanelProps): Promise<void> {\n  const content = panel.querySelector('#conversations-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const conversations = await conversationsService.getAll();\n    renderConversations(content, conversations, props);\n    updateCount(panel, conversations.length);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load conversations</div>';\n  }\n}\n\n/**\n * Render conversations\n */\nfunction renderConversations(\n  container: HTMLElement, \n  conversations: Conversation[], \n  props: ConversationsPanelProps\n): void {\n  if (conversations.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No conversations imported</p>\n        <p class=\"text-muted\">Import chat transcripts, meeting notes, or message threads</p>\n      </div>\n    `;\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"conversations-list\">\n      ${conversations.map(conv => createConversationCard(conv)).join('')}\n    </div>\n  `;\n\n  // Bind events\n  container.querySelectorAll('.conversation-card').forEach(card => {\n    on(card as HTMLElement, 'click', async (e) => {\n      if ((e.target as HTMLElement).closest('.conv-actions')) return;\n      \n      const id = card.getAttribute('data-id');\n      const conv = conversations.find(c => c.id === id);\n      if (conv) {\n        // Fetch full conversation with metadata\n        try {\n          const fullConv = await conversationsService.getById(id!);\n          showConversationPreviewModal(fullConv as any);\n        } catch {\n          // Fallback to basic data\n          showConversationPreviewModal(conv as any);\n        }\n        \n        if (props.onConversationClick) {\n          props.onConversationClick(conv);\n        }\n      }\n    });\n\n    // Re-embed button\n    const reembedBtn = card.querySelector('.reembed-btn');\n    if (reembedBtn) {\n      on(reembedBtn as HTMLElement, 'click', async (e) => {\n        e.stopPropagation();\n        const id = card.getAttribute('data-id');\n        if (!id) return;\n\n        const btn = reembedBtn as HTMLButtonElement;\n        btn.disabled = true;\n        btn.textContent = 'Processing...';\n\n        try {\n          await conversationsService.reembed(id);\n          toast.success('Conversation re-embedded');\n          loadConversations(container.closest('.conversations-panel') as HTMLElement, props);\n        } catch {\n          toast.error('Failed to re-embed conversation');\n          btn.disabled = false;\n          btn.textContent = 'Re-embed';\n        }\n      });\n    }\n\n    // Delete button\n    const deleteBtn = card.querySelector('.delete-conv-btn');\n    if (deleteBtn) {\n      on(deleteBtn as HTMLElement, 'click', async (e) => {\n        e.stopPropagation();\n        const id = card.getAttribute('data-id');\n        if (!id) return;\n\n        if (!confirm('Delete this conversation?')) return;\n\n        try {\n          await conversationsService.delete(id);\n          toast.success('Conversation deleted');\n          loadConversations(container.closest('.conversations-panel') as HTMLElement, props);\n        } catch {\n          toast.error('Failed to delete conversation');\n        }\n      });\n    }\n  });\n}\n\n/**\n * Create conversation card HTML\n */\nfunction createConversationCard(conv: Conversation): string {\n  return `\n    <div class=\"conversation-card\" data-id=\"${conv.id}\">\n      <div class=\"conv-icon\"></div>\n      <div class=\"conv-info\">\n        <div class=\"conv-title\">${escapeHtml(conv.title || 'Untitled Conversation')}</div>\n        <div class=\"conv-meta\">\n          ${conv.participants ? `<span>${conv.participants.length} participants</span>` : ''}\n          ${conv.message_count ? `<span>${conv.message_count} messages</span>` : ''}\n          <span>${formatRelativeTime(conv.created_at)}</span>\n        </div>\n      </div>\n      <div class=\"conv-status\">\n        ${conv.embedded \n          ? '<span class=\"embedded-badge\">Embedded</span>'\n          : '<span class=\"not-embedded-badge\">Not embedded</span>'\n        }\n      </div>\n      <div class=\"conv-actions\">\n        <button class=\"btn btn-sm reembed-btn\">Re-embed</button>\n        <button class=\"btn btn-sm btn-danger delete-conv-btn\">Delete</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Show import dialog using ConversationComposer\n */\nfunction showImportDialog(panel: HTMLElement, props: ConversationsPanelProps): void {\n  showConversationComposer({\n    onImport: () => {\n      loadConversations(panel, props);\n    },\n    onClose: () => {\n      // Nothing to do on close\n    }\n  });\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#conversations-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createConversationsPanel;\n","/**\n * Emails Panel Component\n * Email list with filters and management\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { emailsService, Email } from '../services/emails';\nimport { showEmailModal } from './modals/EmailModal';\nimport { showEmailPreviewModal } from './modals/EmailPreviewModal';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface EmailsPanelProps {\n  onEmailClick?: (email: Email) => void;\n}\n\ntype DirectionFilter = 'all' | 'inbound' | 'outbound' | 'internal';\nlet currentDirection: DirectionFilter = 'all';\nlet showNeedsResponse = false;\n\n/**\n * Create emails panel\n */\nexport function createEmailsPanel(props: EmailsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'emails-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Emails</h2>\n        <span class=\"panel-count\" id=\"emails-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <select id=\"direction-filter\" class=\"filter-select\">\n          <option value=\"all\">All</option>\n          <option value=\"inbound\">Inbound</option>\n          <option value=\"outbound\">Outbound</option>\n          <option value=\"internal\">Internal</option>\n        </select>\n        <label class=\"checkbox-label\">\n          <input type=\"checkbox\" id=\"needs-response-filter\"> Needs Response\n        </label>\n        <button class=\"btn btn-primary btn-sm\" id=\"add-email-btn\">+ Add Email</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"emails-content\">\n      <div class=\"loading\">Loading emails...</div>\n    </div>\n  `;\n\n  // Bind events\n  const directionFilter = panel.querySelector('#direction-filter') as HTMLSelectElement;\n  on(directionFilter, 'change', () => {\n    currentDirection = directionFilter.value as DirectionFilter;\n    loadEmails(panel, props);\n  });\n\n  const needsResponseFilter = panel.querySelector('#needs-response-filter') as HTMLInputElement;\n  on(needsResponseFilter, 'change', () => {\n    showNeedsResponse = needsResponseFilter.checked;\n    loadEmails(panel, props);\n  });\n\n  const addBtn = panel.querySelector('#add-email-btn');\n  if (addBtn) {\n    on(addBtn as HTMLElement, 'click', async () => {\n      const { createEmailComposer, showEmailComposer } = await import('./EmailComposer');\n      showEmailComposer({\n        onSave: () => loadEmails(panel, props),\n      });\n    });\n  }\n\n  // Initial load\n  loadEmails(panel, props);\n\n  return panel;\n}\n\n/**\n * Load emails\n */\nasync function loadEmails(panel: HTMLElement, props: EmailsPanelProps): Promise<void> {\n  const content = panel.querySelector('#emails-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    let emails: Email[];\n\n    if (showNeedsResponse) {\n      emails = await emailsService.getNeedingResponse();\n    } else {\n      const result = await emailsService.getAll({\n        direction: currentDirection === 'all' ? undefined : currentDirection,\n      });\n      emails = result.emails;\n    }\n\n    renderEmails(content, emails, props);\n    updateCount(panel, emails.length);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load emails</div>';\n  }\n}\n\n/**\n * Render emails\n */\nfunction renderEmails(container: HTMLElement, emails: Email[], props: EmailsPanelProps): void {\n  if (emails.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No emails found</p>\n      </div>\n    `;\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"emails-list\">\n      ${emails.map(email => createEmailCard(email)).join('')}\n    </div>\n  `;\n\n  // Bind events\n  container.querySelectorAll('.email-card').forEach(card => {\n    on(card as HTMLElement, 'click', async (e) => {\n      if ((e.target as HTMLElement).closest('.email-actions')) return;\n      \n      const id = card.getAttribute('data-id');\n      const email = emails.find(e => String(e.id) === id);\n      if (email) {\n        // Fetch full email data with extraction results\n        try {\n          const fullEmail = await emailsService.getById(id!);\n          showEmailPreviewModal(fullEmail as any);\n        } catch {\n          // Fallback to basic modal\n          showEmailPreviewModal(email as any);\n        }\n        \n        if (props.onEmailClick) {\n          props.onEmailClick(email);\n        }\n      }\n    });\n\n    // Mark responded\n    const respondedBtn = card.querySelector('.mark-responded-btn');\n    if (respondedBtn) {\n      on(respondedBtn as HTMLElement, 'click', async (e) => {\n        e.stopPropagation();\n        const id = card.getAttribute('data-id');\n        if (!id) return;\n\n        try {\n          await emailsService.markResponded(id);\n          toast.success('Marked as responded');\n          loadEmails(container.closest('.emails-panel') as HTMLElement, props);\n        } catch {\n          toast.error('Failed to update email');\n        }\n      });\n    }\n\n    // Generate response\n    const generateBtn = card.querySelector('.generate-response-btn');\n    if (generateBtn) {\n      on(generateBtn as HTMLElement, 'click', async (e) => {\n        e.stopPropagation();\n        const id = card.getAttribute('data-id');\n        if (!id) return;\n\n        const btn = generateBtn as HTMLButtonElement;\n        btn.disabled = true;\n        btn.textContent = 'Generating...';\n\n        try {\n          const suggestions = await emailsService.generateResponse(id);\n          const draft = suggestions[0]?.response || '';\n          toast.success('Response generated');\n          \n          // Show the generated draft\n          const email = emails.find(e => String(e.id) === id);\n          if (email) {\n            email.draft_response = draft;\n            // Open email modal with draft\n            showEmailModal({ mode: 'view', email: email as unknown as Parameters<typeof showEmailModal>[0]['email'] });\n          }\n        } catch {\n          toast.error('Failed to generate response');\n        } finally {\n          btn.disabled = false;\n          btn.textContent = 'AI Response';\n        }\n      });\n    }\n  });\n}\n\n/**\n * Create email card HTML\n */\nfunction createEmailCard(email: Email): string {\n  const directionIcon = email.direction === 'inbound' ? '' : email.direction === 'outbound' ? '' : '';\n  const needsResponse = email.requires_response && !email.response_sent;\n\n  return `\n    <div class=\"email-card ${needsResponse ? 'needs-response' : ''}\" data-id=\"${email.id}\">\n      <div class=\"email-direction\">${directionIcon}</div>\n      <div class=\"email-info\">\n        <div class=\"email-header\">\n          <span class=\"email-from\">${escapeHtml(email.from_name || email.from_email || email.from || '')}</span>\n          <span class=\"email-date\">${formatRelativeTime(email.created_at || email.date || new Date().toISOString())}</span>\n        </div>\n        <div class=\"email-subject\">${escapeHtml(email.subject || '(No subject)')}</div>\n        <div class=\"email-preview\">${escapeHtml(getPreview(email.body_text || ''))}</div>\n      </div>\n      <div class=\"email-badges\">\n        ${needsResponse ? '<span class=\"needs-response-badge\">Needs Response</span>' : ''}\n        ${email.response_drafted ? '<span class=\"draft-badge\">Draft Ready</span>' : ''}\n        ${email.response_sent ? '<span class=\"responded-badge\">Responded</span>' : ''}\n        ${email.ai_summary ? '<span class=\"ai-badge\">AI Analyzed</span>' : ''}\n      </div>\n      <div class=\"email-actions\">\n        ${needsResponse ? `\n          <button class=\"btn btn-sm generate-response-btn\">AI Response</button>\n          <button class=\"btn btn-sm mark-responded-btn\">Mark Responded</button>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Get preview text\n */\nfunction getPreview(text: string, maxLength = 100): string {\n  const cleaned = text.replace(/\\s+/g, ' ').trim();\n  return cleaned.length > maxLength ? cleaned.slice(0, maxLength) + '...' : cleaned;\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#emails-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createEmailsPanel;\n","/**\n * Email Composer Component - SOTA UI\n * Multi-mode email input: paste, upload .eml/.msg, manual entry\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\n\nexport interface EmailComposerProps {\n  onSave?: (email: unknown) => void;\n  onClose?: () => void;\n}\n\ntype InputMode = 'paste' | 'upload' | 'manual';\nlet currentMode: InputMode = 'paste';\nlet composerContainer: HTMLElement | null = null;\n\n/**\n * Show email composer\n */\nexport function showEmailComposer(props: EmailComposerProps = {}): void {\n  const existing = document.getElementById('email-composer-overlay');\n  if (existing) existing.remove();\n\n  const overlay = createElement('div', { \n    id: 'email-composer-overlay',\n    className: 'composer-overlay' \n  });\n\n  const dialog = createEmailComposer(props);\n  overlay.appendChild(dialog);\n  document.body.appendChild(overlay);\n\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) {\n      closeEmailComposer();\n      props.onClose?.();\n    }\n  });\n\n  requestAnimationFrame(() => overlay.classList.add('visible'));\n  composerContainer = dialog;\n}\n\n/**\n * Close email composer\n */\nexport function closeEmailComposer(): void {\n  const overlay = document.getElementById('email-composer-overlay');\n  if (overlay) {\n    overlay.classList.remove('visible');\n    setTimeout(() => overlay.remove(), 200);\n  }\n  composerContainer = null;\n}\n\n/**\n * Create email composer\n */\nexport function createEmailComposer(props: EmailComposerProps = {}): HTMLElement {\n  const container = createElement('div', { className: 'composer-modal' });\n\n  container.innerHTML = `\n    <style>\n      .composer-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.5);\n        backdrop-filter: blur(8px);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n      }\n      .composer-overlay.visible { opacity: 1; }\n      .composer-overlay.visible .composer-modal {\n        transform: translateY(0) scale(1);\n        opacity: 1;\n      }\n      .composer-modal {\n        width: 640px;\n        max-width: 95vw;\n        max-height: 85vh;\n        background: var(--bg-primary);\n        border-radius: 16px;\n        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        transform: translateY(20px) scale(0.98);\n        opacity: 0;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n      \n      .composer-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      .composer-header h2 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n      .composer-close {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: var(--text-secondary);\n        transition: all 0.15s ease;\n      }\n      .composer-close:hover {\n        background: var(--bg-tertiary);\n        color: var(--text-primary);\n      }\n      \n      .composer-tabs {\n        display: flex;\n        padding: 0 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-tab {\n        padding: 14px 20px;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        background: none;\n        border: none;\n        cursor: pointer;\n        position: relative;\n        transition: color 0.15s ease;\n      }\n      .composer-tab:hover { color: var(--text-primary); }\n      .composer-tab.active { color: var(--primary); }\n      .composer-tab.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: var(--primary);\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .composer-body {\n        flex: 1;\n        padding: 24px;\n        overflow-y: auto;\n      }\n      \n      /* Paste Mode */\n      .paste-section label {\n        display: block;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 12px;\n      }\n      .paste-section textarea {\n        width: 100%;\n        min-height: 280px;\n        padding: 16px;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-family: 'SF Mono', Monaco, monospace;\n        font-size: 13px;\n        line-height: 1.6;\n        resize: vertical;\n        transition: border-color 0.15s ease, box-shadow 0.15s ease;\n      }\n      .paste-section textarea:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\n      }\n      .paste-section textarea::placeholder { color: var(--text-tertiary); }\n      .paste-hint {\n        margin-top: 12px;\n        font-size: 13px;\n        color: var(--text-tertiary);\n      }\n      \n      /* Upload Mode */\n      .upload-section .dropzone {\n        border: 2px dashed var(--border-color);\n        border-radius: 16px;\n        padding: 60px 40px;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        background: var(--bg-secondary);\n      }\n      .upload-section .dropzone:hover,\n      .upload-section .dropzone.dragover {\n        border-color: var(--primary);\n        background: rgba(var(--primary-rgb), 0.03);\n      }\n      .dropzone-icon { font-size: 48px; margin-bottom: 16px; }\n      .dropzone-title {\n        font-size: 16px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 8px;\n      }\n      .dropzone-hint { font-size: 13px; color: var(--text-tertiary); }\n      \n      .selected-file {\n        display: none;\n        align-items: center;\n        gap: 16px;\n        margin-top: 20px;\n        padding: 16px;\n        background: var(--bg-secondary);\n        border-radius: 12px;\n        border: 1px solid var(--border-color);\n      }\n      .selected-file.visible { display: flex; }\n      .file-icon {\n        width: 48px;\n        height: 48px;\n        background: linear-gradient(135deg, #3b82f6, #60a5fa);\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n      }\n      .file-info { flex: 1; min-width: 0; }\n      .file-name {\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .file-size { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }\n      .file-remove {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: transparent;\n        border-radius: 8px;\n        cursor: pointer;\n        color: var(--text-tertiary);\n        font-size: 18px;\n        transition: all 0.15s ease;\n      }\n      .file-remove:hover {\n        background: rgba(239, 68, 68, 0.1);\n        color: #ef4444;\n      }\n      \n      /* Manual Mode */\n      .manual-form {\n        display: flex;\n        flex-direction: column;\n        gap: 20px;\n      }\n      .form-row {\n        display: flex;\n        gap: 16px;\n      }\n      .form-row > .form-group { flex: 1; }\n      .form-group label {\n        display: block;\n        font-size: 13px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        margin-bottom: 8px;\n      }\n      .form-group label .required { color: var(--primary); }\n      .form-group input,\n      .form-group textarea {\n        width: 100%;\n        padding: 12px 14px;\n        border: 1px solid var(--border-color);\n        border-radius: 10px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-size: 14px;\n        transition: border-color 0.15s ease, box-shadow 0.15s ease;\n      }\n      .form-group input:focus,\n      .form-group textarea:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\n      }\n      .form-group textarea {\n        min-height: 120px;\n        resize: vertical;\n      }\n      .form-group input::placeholder,\n      .form-group textarea::placeholder { color: var(--text-tertiary); }\n      \n      .composer-footer {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        padding: 16px 24px;\n        border-top: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-footer .btn {\n        padding: 10px 20px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        border: none;\n      }\n      .composer-footer .btn-secondary {\n        background: var(--bg-primary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      .composer-footer .btn-secondary:hover { background: var(--bg-tertiary); }\n      .composer-footer .btn-primary {\n        background: var(--primary);\n        color: white;\n      }\n      .composer-footer .btn-primary:hover:not(:disabled) {\n        opacity: 0.9;\n        transform: translateY(-1px);\n      }\n      .composer-footer .btn-primary:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n    </style>\n    \n    <div class=\"composer-header\">\n      <h2>Add Email</h2>\n      <button class=\"composer-close\" id=\"close-btn\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M18 6L6 18M6 6l12 12\"/>\n        </svg>\n      </button>\n    </div>\n    \n    <div class=\"composer-tabs\">\n      <button class=\"composer-tab active\" data-mode=\"paste\">Paste Text</button>\n      <button class=\"composer-tab\" data-mode=\"upload\">Upload .eml/.msg</button>\n      <button class=\"composer-tab\" data-mode=\"manual\">Manual Entry</button>\n    </div>\n    \n    <div class=\"composer-body\" id=\"composer-body\">\n      ${renderPasteMode()}\n    </div>\n    \n    <div class=\"composer-footer\">\n      <button class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\n      <button class=\"btn btn-primary\" id=\"save-btn\" disabled>Add Email</button>\n    </div>\n  `;\n\n  // Bind tabs\n  container.querySelectorAll('.composer-tab').forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      container.querySelectorAll('.composer-tab').forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentMode = tab.getAttribute('data-mode') as InputMode;\n      renderMode(container);\n    });\n  });\n\n  on(container.querySelector('#close-btn') as HTMLElement, 'click', () => {\n    closeEmailComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#cancel-btn') as HTMLElement, 'click', () => {\n    closeEmailComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#save-btn') as HTMLElement, 'click', () => saveEmail(container, props));\n\n  bindPasteMode(container);\n\n  return container;\n}\n\nfunction renderMode(container: HTMLElement): void {\n  const body = container.querySelector('#composer-body') as HTMLElement;\n  \n  switch (currentMode) {\n    case 'paste':\n      body.innerHTML = renderPasteMode();\n      bindPasteMode(container);\n      break;\n    case 'upload':\n      body.innerHTML = renderUploadMode();\n      bindUploadMode(container);\n      break;\n    case 'manual':\n      body.innerHTML = renderManualMode();\n      bindManualMode(container);\n      break;\n  }\n}\n\nfunction renderPasteMode(): string {\n  return `\n    <div class=\"paste-section\">\n      <label>Paste email content:</label>\n      <textarea id=\"email-paste\" placeholder=\"Paste the full email content here...\n\nInclude headers if available:\nFrom: sender@example.com\nTo: recipient@example.com\nSubject: Meeting notes\nDate: Jan 31, 2026\n\nEmail body text...\"></textarea>\n      <p class=\"paste-hint\">Include headers (From, To, Subject, Date) for better parsing.</p>\n    </div>\n  `;\n}\n\nfunction bindPasteMode(container: HTMLElement): void {\n  const textarea = container.querySelector('#email-paste') as HTMLTextAreaElement;\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n\n  if (textarea) {\n    on(textarea, 'input', () => {\n      saveBtn.disabled = textarea.value.trim().length < 10;\n    });\n  }\n}\n\nfunction renderUploadMode(): string {\n  return `\n    <div class=\"upload-section\">\n      <div class=\"dropzone\" id=\"file-dropzone\">\n        <div class=\"dropzone-icon\"></div>\n        <p class=\"dropzone-title\">Drop email file here</p>\n        <p class=\"dropzone-hint\">or click to browse  .eml, .msg</p>\n        <input type=\"file\" id=\"file-input\" accept=\".eml,.msg\" hidden>\n      </div>\n      <div class=\"selected-file\" id=\"selected-file\">\n        <div class=\"file-icon\"></div>\n        <div class=\"file-info\">\n          <div class=\"file-name\" id=\"file-name\"></div>\n          <div class=\"file-size\" id=\"file-size\"></div>\n        </div>\n        <button class=\"file-remove\" id=\"file-remove\"></button>\n      </div>\n    </div>\n  `;\n}\n\nfunction bindUploadMode(container: HTMLElement): void {\n  const dropzone = container.querySelector('#file-dropzone') as HTMLElement;\n  const input = container.querySelector('#file-input') as HTMLInputElement;\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n\n  on(dropzone, 'click', () => input.click());\n  on(dropzone, 'dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });\n  on(dropzone, 'dragleave', () => dropzone.classList.remove('dragover'));\n  on(dropzone, 'drop', (e) => {\n    e.preventDefault();\n    dropzone.classList.remove('dragover');\n    if (e.dataTransfer?.files[0]) handleFileSelect(e.dataTransfer.files[0], container);\n  });\n  on(input, 'change', () => { if (input.files?.[0]) handleFileSelect(input.files[0], container); });\n  on(container.querySelector('#file-remove') as HTMLElement, 'click', () => {\n    selectedFile.classList.remove('visible');\n    (container as any)._emlFile = null;\n    saveBtn.disabled = true;\n  });\n}\n\nfunction handleFileSelect(file: File, container: HTMLElement): void {\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n  \n  container.querySelector('#file-name')!.textContent = file.name;\n  container.querySelector('#file-size')!.textContent = formatFileSize(file.size);\n  selectedFile.classList.add('visible');\n  \n  (container as any)._emlFile = file;\n  saveBtn.disabled = false;\n}\n\nfunction renderManualMode(): string {\n  return `\n    <form class=\"manual-form\" id=\"manual-form\">\n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label>From <span class=\"required\">*</span></label>\n          <input type=\"email\" name=\"from\" placeholder=\"sender@example.com\" required>\n        </div>\n        <div class=\"form-group\">\n          <label>Date</label>\n          <input type=\"datetime-local\" name=\"date\">\n        </div>\n      </div>\n      <div class=\"form-group\">\n        <label>To <span class=\"required\">*</span></label>\n        <input type=\"text\" name=\"to\" placeholder=\"recipient@example.com (comma-separated)\" required>\n      </div>\n      <div class=\"form-group\">\n        <label>CC</label>\n        <input type=\"text\" name=\"cc\" placeholder=\"cc@example.com (comma-separated)\">\n      </div>\n      <div class=\"form-group\">\n        <label>Subject</label>\n        <input type=\"text\" name=\"subject\" placeholder=\"Email subject\">\n      </div>\n      <div class=\"form-group\">\n        <label>Body <span class=\"required\">*</span></label>\n        <textarea name=\"body\" placeholder=\"Email content...\" required></textarea>\n      </div>\n    </form>\n  `;\n}\n\nfunction bindManualMode(container: HTMLElement): void {\n  const form = container.querySelector('#manual-form') as HTMLFormElement;\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n\n  const checkValidity = () => {\n    const from = form.querySelector('[name=\"from\"]') as HTMLInputElement;\n    const to = form.querySelector('[name=\"to\"]') as HTMLInputElement;\n    const body = form.querySelector('[name=\"body\"]') as HTMLTextAreaElement;\n    saveBtn.disabled = !from.value || !to.value || !body.value;\n  };\n\n  form.querySelectorAll('input, textarea').forEach(el => {\n    on(el as HTMLElement, 'input', checkValidity);\n  });\n}\n\nasync function fileToBase64(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      const base64 = (reader.result as string).split(',')[1];\n      resolve(base64);\n    };\n    reader.onerror = reject;\n    reader.readAsDataURL(file);\n  });\n}\n\nasync function saveEmail(container: HTMLElement, props: EmailComposerProps): Promise<void> {\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n  saveBtn.disabled = true;\n  saveBtn.textContent = 'Processing...';\n\n  try {\n    let data: Record<string, unknown>;\n\n    switch (currentMode) {\n      case 'paste': {\n        const text = (container.querySelector('#email-paste') as HTMLTextAreaElement).value;\n        data = { emailText: text };\n        break;\n      }\n      case 'upload': {\n        const file = (container as any)._emlFile as File;\n        if (!file) throw new Error('No file selected');\n        \n        const base64 = await fileToBase64(file);\n        if (file.name.toLowerCase().endsWith('.msg')) {\n          data = { msgBase64: base64, filename: file.name };\n        } else {\n          data = { emlBase64: base64, filename: file.name };\n        }\n        break;\n      }\n      case 'manual': {\n        const form = container.querySelector('#manual-form') as HTMLFormElement;\n        const formData = new FormData(form);\n        data = {\n          from: formData.get('from'),\n          to: (formData.get('to') as string).split(',').map(e => e.trim()),\n          cc: formData.get('cc') ? (formData.get('cc') as string).split(',').map(e => e.trim()) : undefined,\n          subject: formData.get('subject'),\n          body: formData.get('body'),\n          date: formData.get('date') || undefined,\n        };\n        break;\n      }\n    }\n\n    const result = await http.post('/api/emails/import', data);\n    toast.success('Email added successfully');\n    props.onSave?.(result);\n    closeEmailComposer();\n  } catch (err) {\n    toast.error('Failed to add email');\n    console.error('[EmailComposer] Error:', err);\n  } finally {\n    saveBtn.disabled = false;\n    saveBtn.textContent = 'Add Email';\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n\nexport default showEmailComposer;\n","/**\n * Notifications Dropdown Component\n * Bell icon with notification list in header\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { notificationsService, Notification } from '../services/notifications';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface NotificationsDropdownProps {\n  onNotificationClick?: (notification: Notification) => void;\n}\n\nlet isOpen = false;\nlet unreadCount = 0;\n\n/**\n * Create notifications dropdown\n */\nexport function createNotificationsDropdown(props: NotificationsDropdownProps = {}): HTMLElement {\n  const container = createElement('div', { className: 'notifications-dropdown' });\n\n  container.innerHTML = `\n    <button class=\"notifications-trigger\" id=\"notifications-trigger\">\n      <span class=\"bell-icon\"></span>\n      <span class=\"notification-badge hidden\" id=\"notification-badge\">0</span>\n    </button>\n    <div class=\"notifications-panel hidden\" id=\"notifications-panel\">\n      <div class=\"notifications-header\">\n        <h3>Notifications</h3>\n        <button class=\"btn-link\" id=\"mark-all-read\">Mark all read</button>\n      </div>\n      <div class=\"notifications-list\" id=\"notifications-list\">\n        <div class=\"loading\">Loading...</div>\n      </div>\n    </div>\n  `;\n\n  // Bind trigger click\n  const trigger = container.querySelector('#notifications-trigger');\n  if (trigger) {\n    on(trigger as HTMLElement, 'click', (e) => {\n      e.stopPropagation();\n      toggleDropdown(container, props);\n    });\n  }\n\n  // Mark all as read\n  const markAllBtn = container.querySelector('#mark-all-read');\n  if (markAllBtn) {\n    on(markAllBtn as HTMLElement, 'click', async () => {\n      try {\n        await notificationsService.markAllRead();\n        toast.success('All notifications marked as read');\n        loadNotifications(container, props);\n        updateBadge(container, 0);\n      } catch {\n        toast.error('Failed to mark notifications as read');\n      }\n    });\n  }\n\n  // Close on outside click\n  document.addEventListener('click', () => {\n    closeDropdown(container);\n  });\n\n  // Initial count load\n  loadUnreadCount(container);\n\n  // Periodic refresh\n  setInterval(() => loadUnreadCount(container), 60000);\n\n  return container;\n}\n\n/**\n * Toggle dropdown\n */\nfunction toggleDropdown(container: HTMLElement, props: NotificationsDropdownProps): void {\n  isOpen = !isOpen;\n  const panel = container.querySelector('#notifications-panel');\n  \n  if (panel) {\n    panel.classList.toggle('hidden', !isOpen);\n    \n    if (isOpen) {\n      loadNotifications(container, props);\n    }\n  }\n}\n\n/**\n * Close dropdown\n */\nfunction closeDropdown(container: HTMLElement): void {\n  isOpen = false;\n  const panel = container.querySelector('#notifications-panel');\n  if (panel) {\n    panel.classList.add('hidden');\n  }\n}\n\n/**\n * Load unread count\n */\nasync function loadUnreadCount(container: HTMLElement): Promise<void> {\n  try {\n    const count = await notificationsService.getUnreadCount();\n    unreadCount = count;\n    updateBadge(container, count);\n  } catch {\n    // Ignore\n  }\n}\n\n/**\n * Update badge\n */\nfunction updateBadge(container: HTMLElement, count: number): void {\n  const badge = container.querySelector('#notification-badge') as HTMLElement;\n  if (badge) {\n    badge.textContent = count > 99 ? '99+' : String(count);\n    badge.classList.toggle('hidden', count === 0);\n  }\n}\n\n/**\n * Load notifications\n */\nasync function loadNotifications(container: HTMLElement, props: NotificationsDropdownProps): Promise<void> {\n  const list = container.querySelector('#notifications-list') as HTMLElement;\n  list.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const notifications = await notificationsService.getAll({ limit: 20 });\n    renderNotifications(list, notifications, container, props);\n  } catch {\n    list.innerHTML = '<div class=\"error\">Failed to load</div>';\n  }\n}\n\n/**\n * Render notifications\n */\nfunction renderNotifications(\n  container: HTMLElement, \n  notifications: Notification[],\n  dropdown: HTMLElement,\n  props: NotificationsDropdownProps\n): void {\n  if (notifications.length === 0) {\n    container.innerHTML = '<div class=\"empty\">No notifications</div>';\n    return;\n  }\n\n  container.innerHTML = notifications.map(n => `\n    <div class=\"notification-item ${n.read ? '' : 'unread'}\" data-id=\"${n.id}\">\n      <div class=\"notification-icon\">${getIcon(n.type)}</div>\n      <div class=\"notification-content\">\n        <div class=\"notification-title\">${escapeHtml(n.title)}</div>\n        ${n.message ? `<div class=\"notification-message\">${escapeHtml(n.message)}</div>` : ''}\n        <div class=\"notification-time\">${formatRelativeTime(n.created_at)}</div>\n      </div>\n      <button class=\"btn-icon dismiss-btn\" title=\"Dismiss\"></button>\n    </div>\n  `).join('');\n\n  // Bind click events\n  container.querySelectorAll('.notification-item').forEach(item => {\n    on(item as HTMLElement, 'click', async (e) => {\n      if ((e.target as HTMLElement).closest('.dismiss-btn')) return;\n      \n      const id = item.getAttribute('data-id');\n      const notification = notifications.find(n => n.id === id);\n      if (notification) {\n        // Mark as read\n        if (!notification.read) {\n          await notificationsService.markRead(id!);\n          item.classList.remove('unread');\n          unreadCount = Math.max(0, unreadCount - 1);\n          updateBadge(dropdown, unreadCount);\n        }\n        \n        closeDropdown(dropdown);\n        props.onNotificationClick?.(notification);\n      }\n    });\n\n    // Dismiss button\n    const dismissBtn = item.querySelector('.dismiss-btn');\n    if (dismissBtn) {\n      on(dismissBtn as HTMLElement, 'click', async (e) => {\n        e.stopPropagation();\n        const id = item.getAttribute('data-id');\n        if (!id) return;\n\n        try {\n          await notificationsService.delete(id);\n          item.remove();\n          if (!item.classList.contains('unread')) return;\n          unreadCount = Math.max(0, unreadCount - 1);\n          updateBadge(dropdown, unreadCount);\n        } catch {\n          // Ignore\n        }\n      });\n    }\n  });\n}\n\n/**\n * Get icon by type\n */\nfunction getIcon(type: string): string {\n  switch (type) {\n    case 'question': return '';\n    case 'risk': return '';\n    case 'action': return '';\n    case 'decision': return '';\n    case 'mention': return '@';\n    case 'comment': return '';\n    case 'assignment': return '';\n    default: return '';\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Initialize notifications in header\n */\nexport function initNotificationsDropdown(\n  container: HTMLElement,\n  props: NotificationsDropdownProps = {}\n): HTMLElement {\n  const dropdown = createNotificationsDropdown(props);\n  container.appendChild(dropdown);\n  return dropdown;\n}\n\nexport default createNotificationsDropdown;\n","/**\n * Comments Thread Component\n * Inline comments for entities\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { commentsService, Comment } from '../services/notifications';\nimport { appStore } from '../stores/app';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface CommentsThreadProps {\n  targetType: 'question' | 'risk' | 'action' | 'decision' | 'contact' | 'document' | 'email';\n  targetId: string;\n  projectId?: string;\n  onCommentAdded?: (comment: Comment) => void;\n}\n\n/**\n * Create comments thread\n */\nexport function createCommentsThread(props: CommentsThreadProps): HTMLElement {\n  const container = createElement('div', { className: 'comments-thread' });\n\n  container.innerHTML = `\n    <div class=\"comments-header\">\n      <h4>Comments</h4>\n      <span class=\"comments-count\" id=\"comments-count\">0</span>\n    </div>\n    <div class=\"comments-list\" id=\"comments-list\">\n      <div class=\"loading\">Loading comments...</div>\n    </div>\n    <div class=\"comment-form\">\n      <textarea id=\"comment-input\" placeholder=\"Add a comment...\" rows=\"2\"></textarea>\n      <div class=\"comment-form-actions\">\n        <button class=\"btn btn-primary btn-sm\" id=\"submit-comment-btn\" disabled>Comment</button>\n      </div>\n    </div>\n  `;\n\n  // Bind input\n  const input = container.querySelector('#comment-input') as HTMLTextAreaElement;\n  const submitBtn = container.querySelector('#submit-comment-btn') as HTMLButtonElement;\n\n  on(input, 'input', () => {\n    submitBtn.disabled = !input.value.trim();\n  });\n\n  on(submitBtn, 'click', () => submitComment(container, props, input));\n\n  // Submit on Ctrl+Enter\n  on(input, 'keydown', (e) => {\n    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\n      e.preventDefault();\n      if (input.value.trim()) {\n        submitComment(container, props, input);\n      }\n    }\n  });\n\n  // Initial load\n  loadComments(container, props);\n\n  return container;\n}\n\n/**\n * Load comments\n */\nasync function loadComments(container: HTMLElement, props: CommentsThreadProps): Promise<void> {\n  const list = container.querySelector('#comments-list') as HTMLElement;\n  list.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const comments = await commentsService.getAll(props.targetType, props.targetId);\n\n    renderComments(list, comments, container, props);\n    updateCount(container, comments.length);\n  } catch {\n    list.innerHTML = '<div class=\"error\">Failed to load comments</div>';\n  }\n}\n\n/**\n * Render comments\n */\nfunction renderComments(\n  container: HTMLElement, \n  comments: Comment[],\n  thread: HTMLElement,\n  props: CommentsThreadProps\n): void {\n  if (comments.length === 0) {\n    container.innerHTML = '<div class=\"empty\">No comments yet</div>';\n    return;\n  }\n\n  // Group by parent\n  const topLevel = comments.filter(c => !c.parent_id);\n  const replies = comments.filter(c => c.parent_id);\n  const repliesByParent: Record<string, Comment[]> = {};\n  \n  replies.forEach(r => {\n    if (!repliesByParent[r.parent_id!]) repliesByParent[r.parent_id!] = [];\n    repliesByParent[r.parent_id!].push(r);\n  });\n\n  container.innerHTML = topLevel.map(comment => \n    renderComment(comment, repliesByParent[comment.id] || [], thread, props)\n  ).join('');\n\n  bindCommentEvents(container, comments, thread, props);\n}\n\n/**\n * Render single comment\n */\nfunction renderComment(\n  comment: Comment, \n  replies: Comment[],\n  thread: HTMLElement,\n  props: CommentsThreadProps\n): string {\n  const currentUser = appStore.getState().currentUser;\n  const isOwn = currentUser?.id === comment.user_id;\n\n  return `\n    <div class=\"comment ${comment.resolved ? 'resolved' : ''}\" data-id=\"${comment.id}\">\n      <div class=\"comment-avatar\">${getInitials(comment.user_name || 'U')}</div>\n      <div class=\"comment-body\">\n        <div class=\"comment-header\">\n          <span class=\"comment-author\">${escapeHtml(comment.user_name || 'Unknown')}</span>\n          <span class=\"comment-time\">${formatRelativeTime(comment.created_at)}</span>\n          ${comment.resolved ? '<span class=\"resolved-badge\">Resolved</span>' : ''}\n        </div>\n        <div class=\"comment-content\">${escapeHtml(comment.content)}</div>\n        <div class=\"comment-actions\">\n          <button class=\"btn-link reply-btn\">Reply</button>\n          ${!comment.resolved ? '<button class=\"btn-link resolve-btn\">Resolve</button>' : ''}\n          ${isOwn ? '<button class=\"btn-link delete-btn\">Delete</button>' : ''}\n        </div>\n        <div class=\"reply-form hidden\">\n          <textarea class=\"reply-input\" placeholder=\"Reply...\" rows=\"2\"></textarea>\n          <div class=\"reply-actions\">\n            <button class=\"btn btn-sm cancel-reply-btn\">Cancel</button>\n            <button class=\"btn btn-primary btn-sm submit-reply-btn\">Reply</button>\n          </div>\n        </div>\n      </div>\n    </div>\n    ${replies.length > 0 ? `\n      <div class=\"comment-replies\">\n        ${replies.map(r => `\n          <div class=\"comment reply\" data-id=\"${r.id}\">\n            <div class=\"comment-avatar small\">${getInitials(r.user_name || 'U')}</div>\n            <div class=\"comment-body\">\n              <div class=\"comment-header\">\n                <span class=\"comment-author\">${escapeHtml(r.user_name || 'Unknown')}</span>\n                <span class=\"comment-time\">${formatRelativeTime(r.created_at)}</span>\n              </div>\n              <div class=\"comment-content\">${escapeHtml(r.content)}</div>\n              ${currentUser?.id === r.user_id ? `\n                <div class=\"comment-actions\">\n                  <button class=\"btn-link delete-btn\">Delete</button>\n                </div>\n              ` : ''}\n            </div>\n          </div>\n        `).join('')}\n      </div>\n    ` : ''}\n  `;\n}\n\n/**\n * Bind comment events\n */\nfunction bindCommentEvents(\n  container: HTMLElement,\n  comments: Comment[],\n  thread: HTMLElement,\n  props: CommentsThreadProps\n): void {\n  // Reply buttons\n  container.querySelectorAll('.reply-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const comment = btn.closest('.comment');\n      const replyForm = comment?.querySelector('.reply-form');\n      if (replyForm) {\n        replyForm.classList.toggle('hidden');\n        const input = replyForm.querySelector('.reply-input') as HTMLTextAreaElement;\n        input?.focus();\n      }\n    });\n  });\n\n  // Cancel reply\n  container.querySelectorAll('.cancel-reply-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const replyForm = btn.closest('.reply-form');\n      if (replyForm) {\n        replyForm.classList.add('hidden');\n        (replyForm.querySelector('.reply-input') as HTMLTextAreaElement).value = '';\n      }\n    });\n  });\n\n  // Submit reply\n  container.querySelectorAll('.submit-reply-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const comment = btn.closest('.comment');\n      const id = comment?.getAttribute('data-id');\n      const input = comment?.querySelector('.reply-input') as HTMLTextAreaElement;\n      if (!id || !input?.value.trim()) return;\n\n      try {\n        await commentsService.create(props.targetType, props.targetId, input.value.trim(), id);\n        toast.success('Reply added');\n        loadComments(thread, props);\n      } catch {\n        toast.error('Failed to add reply');\n      }\n    });\n  });\n\n  // Resolve\n  container.querySelectorAll('.resolve-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const comment = btn.closest('.comment');\n      const id = comment?.getAttribute('data-id');\n      if (!id) return;\n\n      try {\n        await commentsService.resolve(id);\n        toast.success('Comment resolved');\n        loadComments(thread, props);\n      } catch {\n        toast.error('Failed to resolve comment');\n      }\n    });\n  });\n\n  // Delete\n  container.querySelectorAll('.delete-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const comment = btn.closest('.comment');\n      const id = comment?.getAttribute('data-id');\n      if (!id || !confirm('Delete this comment?')) return;\n\n      try {\n        await commentsService.delete(id);\n        toast.success('Comment deleted');\n        loadComments(thread, props);\n      } catch {\n        toast.error('Failed to delete comment');\n      }\n    });\n  });\n}\n\n/**\n * Submit new comment\n */\nasync function submitComment(\n  container: HTMLElement,\n  props: CommentsThreadProps,\n  input: HTMLTextAreaElement\n): Promise<void> {\n  const content = input.value.trim();\n  if (!content) return;\n\n  const btn = container.querySelector('#submit-comment-btn') as HTMLButtonElement;\n  btn.disabled = true;\n\n  try {\n    const comment = await commentsService.create(props.targetType, props.targetId, content);\n\n    input.value = '';\n    toast.success('Comment added');\n    loadComments(container, props);\n    props.onCommentAdded?.(comment);\n  } catch {\n    toast.error('Failed to add comment');\n    btn.disabled = false;\n  }\n}\n\n/**\n * Update count\n */\nfunction updateCount(container: HTMLElement, count: number): void {\n  const countEl = container.querySelector('#comments-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Get initials\n */\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createCommentsThread;\n","/**\n * Members Panel Component\n * Project members management with invites\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { membersService, ProjectMember } from '../services/notifications';\nimport { appStore } from '../stores/app';\nimport { showInviteModal } from './modals/InviteModal';\nimport { showMemberPermissionsModal } from './modals/MemberPermissionsModal';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface MembersPanelProps {\n  projectId?: string;\n  onMemberClick?: (member: ProjectMember) => void;\n}\n\n/**\n * Create members panel\n */\nexport function createMembersPanel(props: MembersPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'members-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Team Members</h2>\n        <span class=\"panel-count\" id=\"members-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <button class=\"btn btn-primary btn-sm\" id=\"invite-member-btn\">+ Invite</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"members-content\">\n      <div class=\"loading\">Loading members...</div>\n    </div>\n    <div class=\"pending-invites\" id=\"pending-invites\"></div>\n  `;\n\n  // Bind invite button\n  const inviteBtn = panel.querySelector('#invite-member-btn');\n  if (inviteBtn) {\n    on(inviteBtn as HTMLElement, 'click', () => {\n      const projectId = props.projectId || appStore.getState().currentProject?.id;\n      if (!projectId) {\n        toast.error('No project selected');\n        return;\n      }\n      showInviteModal({\n        projectId,\n        onInvite: () => loadPendingInvites(panel, projectId),\n      });\n    });\n  }\n\n  // Initial load\n  const projectId = props.projectId || appStore.getState().currentProject?.id;\n  if (projectId) {\n    loadMembers(panel, projectId, props);\n    loadPendingInvites(panel, projectId);\n  }\n\n  return panel;\n}\n\n/**\n * Load members\n */\nasync function loadMembers(\n  panel: HTMLElement, \n  projectId: string,\n  props: MembersPanelProps\n): Promise<void> {\n  const content = panel.querySelector('#members-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const members = await membersService.getAll(projectId);\n    renderMembers(content, members, projectId, props);\n    updateCount(panel, members.length);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load members</div>';\n  }\n}\n\n/**\n * Render members\n */\nfunction renderMembers(\n  container: HTMLElement, \n  members: ProjectMember[],\n  projectId: string,\n  props: MembersPanelProps\n): void {\n  if (members.length === 0) {\n    container.innerHTML = '<div class=\"empty\">No team members</div>';\n    return;\n  }\n\n  const currentUser = appStore.getState().currentUser;\n\n  container.innerHTML = `\n    <div class=\"members-list\">\n      ${members.map(member => `\n        <div class=\"member-card\" data-id=\"${member.user_id}\">\n          <div class=\"member-avatar\">\n            ${member.avatar_url \n              ? `<img src=\"${member.avatar_url}\" alt=\"\">`\n              : `<span>${getInitials(member.name || member.email)}</span>`\n            }\n          </div>\n          <div class=\"member-info\">\n            <div class=\"member-name\">${escapeHtml(member.name || member.email)}</div>\n            <div class=\"member-email\">${escapeHtml(member.email)}</div>\n          </div>\n          <div class=\"member-role\">\n            <select class=\"role-select\" data-user-id=\"${member.user_id}\" ${member.user_id === currentUser?.id ? 'disabled' : ''}>\n              <option value=\"viewer\" ${member.role === 'viewer' ? 'selected' : ''}>Viewer</option>\n              <option value=\"editor\" ${member.role === 'editor' ? 'selected' : ''}>Editor</option>\n              <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\n              <option value=\"owner\" ${member.role === 'owner' ? 'selected' : ''}>Owner</option>\n            </select>\n          </div>\n          <button class=\"btn-icon permissions-btn\" data-user-id=\"${member.user_id}\" title=\"Permissions\" style=\"font-size: 14px;\"></button>\n          ${member.user_id !== currentUser?.id ? `\n            <button class=\"btn-icon remove-member-btn\" data-user-id=\"${member.user_id}\" title=\"Remove\"></button>\n          ` : ''}\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind role change\n  container.querySelectorAll('.role-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const userId = select.getAttribute('data-user-id');\n      const role = (select as HTMLSelectElement).value as 'admin' | 'editor' | 'viewer';\n      if (!userId) return;\n\n      try {\n        await membersService.updateRole(userId, role, projectId);\n        toast.success('Role updated');\n      } catch {\n        toast.error('Failed to update role');\n        loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\n      }\n    });\n  });\n\n  // Bind remove buttons\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const userId = btn.getAttribute('data-user-id');\n      if (!userId || !confirm('Remove this member from the project?')) return;\n\n      try {\n        await membersService.remove(projectId, userId);\n        toast.success('Member removed');\n        loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\n      } catch {\n        toast.error('Failed to remove member');\n      }\n    });\n  });\n\n  // Bind permissions buttons\n  container.querySelectorAll('.permissions-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const userId = btn.getAttribute('data-user-id');\n      const member = members.find(m => m.user_id === userId);\n      if (!member) return;\n\n      showMemberPermissionsModal({\n        projectId,\n        userId: member.user_id,\n        userName: member.name || '',\n        userEmail: member.email,\n        avatarUrl: member.avatar_url,\n        currentRole: member.role,\n        currentPermissions: (member as { permissions?: string[] }).permissions,\n        onSave: () => {\n          loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\n        },\n      });\n    });\n  });\n\n  // Bind member clicks\n  container.querySelectorAll('.member-card').forEach(card => {\n    on(card as HTMLElement, 'click', (e) => {\n      if ((e.target as HTMLElement).closest('.role-select, .remove-member-btn')) return;\n      \n      const userId = card.getAttribute('data-id');\n      const member = members.find(m => m.user_id === userId);\n      if (member && props.onMemberClick) {\n        props.onMemberClick(member);\n      }\n    });\n  });\n}\n\n/**\n * Load pending invites\n */\nasync function loadPendingInvites(panel: HTMLElement, projectId: string): Promise<void> {\n  const container = panel.querySelector('#pending-invites') as HTMLElement;\n\n  try {\n    const invites = await membersService.getInvites(projectId);\n    \n    if (invites.length === 0) {\n      container.innerHTML = '';\n      return;\n    }\n\n    container.innerHTML = `\n      <div class=\"invites-section\">\n        <h4>Pending Invites</h4>\n        <div class=\"invites-list\">\n          ${invites.map(invite => `\n            <div class=\"invite-card\" data-id=\"${invite.id}\">\n              <div class=\"invite-info\">\n                <span class=\"invite-email\">${escapeHtml(invite.email)}</span>\n                <span class=\"invite-role\">${invite.role}</span>\n                <span class=\"invite-time\">Sent ${formatRelativeTime(invite.invited_at || invite.created_at || new Date().toISOString())}</span>\n              </div>\n              <button class=\"btn btn-sm cancel-invite-btn\" data-id=\"${invite.id}\">Cancel</button>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    `;\n\n    // Bind cancel buttons\n    container.querySelectorAll('.cancel-invite-btn').forEach(btn => {\n      on(btn as HTMLElement, 'click', async () => {\n        const inviteId = btn.getAttribute('data-id');\n        if (!inviteId) return;\n\n        try {\n          // TODO: Implement cancel invite in service\n          toast.info('Invite cancellation not implemented');\n        } catch {\n          toast.error('Failed to cancel invite');\n        }\n      });\n    });\n  } catch {\n    // Ignore\n  }\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#members-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Get initials\n */\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createMembersPanel;\n","/**\n * API Keys Panel Component\n * Manage API keys with create, copy, revoke\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface ApiKeysPanelProps {\n  projectId?: string;\n}\n\ninterface ApiKey {\n  id: string;\n  name: string;\n  key_prefix: string;\n  created_at: string;\n  last_used?: string;\n  expires_at?: string;\n  scopes: string[];\n}\n\n/**\n * Create API keys panel\n */\nexport function createApiKeysPanel(props: ApiKeysPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'api-keys-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>API Keys</h2>\n        <span class=\"panel-count\" id=\"keys-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <button class=\"btn btn-primary btn-sm\" id=\"create-key-btn\">+ Create Key</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"keys-content\">\n      <div class=\"loading\">Loading API keys...</div>\n    </div>\n  `;\n\n  // Bind create button\n  const createBtn = panel.querySelector('#create-key-btn');\n  if (createBtn) {\n    on(createBtn as HTMLElement, 'click', () => showCreateKeyModal(panel, props));\n  }\n\n  // Initial load\n  loadApiKeys(panel, props);\n\n  return panel;\n}\n\n/**\n * Load API keys\n */\nasync function loadApiKeys(panel: HTMLElement, props: ApiKeysPanelProps): Promise<void> {\n  const content = panel.querySelector('#keys-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const response = await http.get<{ keys: ApiKey[] }>('/api/keys');\n    renderApiKeys(content, response.data.keys || [], panel, props);\n    updateCount(panel, response.data.keys?.length || 0);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load API keys</div>';\n  }\n}\n\n/**\n * Render API keys\n */\nfunction renderApiKeys(\n  container: HTMLElement, \n  keys: ApiKey[],\n  panel: HTMLElement,\n  props: ApiKeysPanelProps\n): void {\n  if (keys.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No API keys created yet</p>\n        <p class=\"hint\">Create an API key to access the GodMode API programmatically</p>\n      </div>\n    `;\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"keys-list\">\n      ${keys.map(key => `\n        <div class=\"key-card\" data-id=\"${key.id}\">\n          <div class=\"key-info\">\n            <div class=\"key-name\">${escapeHtml(key.name)}</div>\n            <div class=\"key-preview\">${key.key_prefix}</div>\n            <div class=\"key-meta\">\n              Created ${formatRelativeTime(key.created_at)}\n              ${key.last_used ? ` Last used ${formatRelativeTime(key.last_used)}` : ' Never used'}\n              ${key.expires_at ? ` Expires ${formatRelativeTime(key.expires_at)}` : ''}\n            </div>\n            ${key.scopes.length > 0 ? `\n              <div class=\"key-scopes\">\n                ${key.scopes.map(s => `<span class=\"scope-badge\">${s}</span>`).join('')}\n              </div>\n            ` : ''}\n          </div>\n          <div class=\"key-actions\">\n            <button class=\"btn btn-sm revoke-key-btn\" data-id=\"${key.id}\">Revoke</button>\n          </div>\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind revoke buttons\n  container.querySelectorAll('.revoke-key-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const id = btn.getAttribute('data-id');\n      if (!id || !confirm('Revoke this API key? This action cannot be undone.')) return;\n\n      try {\n        await http.delete(`/api/keys/${id}`);\n        toast.success('API key revoked');\n        loadApiKeys(panel, props);\n      } catch {\n        toast.error('Failed to revoke API key');\n      }\n    });\n  });\n}\n\n/**\n * Show create key modal\n */\nfunction showCreateKeyModal(panel: HTMLElement, props: ApiKeysPanelProps): void {\n  const overlay = createElement('div', { className: 'modal-overlay' });\n  \n  overlay.innerHTML = `\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h2>Create API Key</h2>\n        <button class=\"btn-icon close-modal\"></button>\n      </div>\n      <form id=\"create-key-form\" class=\"modal-body\">\n        <div class=\"form-group\">\n          <label for=\"key-name\">Key Name *</label>\n          <input type=\"text\" id=\"key-name\" required placeholder=\"e.g., My Integration\">\n        </div>\n        <div class=\"form-group\">\n          <label for=\"key-expiry\">Expires</label>\n          <select id=\"key-expiry\">\n            <option value=\"\">Never</option>\n            <option value=\"30\">30 days</option>\n            <option value=\"90\">90 days</option>\n            <option value=\"365\">1 year</option>\n          </select>\n        </div>\n        <div class=\"form-group\">\n          <label>Scopes</label>\n          <div class=\"scopes-grid\">\n            <label class=\"checkbox-label\">\n              <input type=\"checkbox\" name=\"scopes\" value=\"read\" checked> Read\n            </label>\n            <label class=\"checkbox-label\">\n              <input type=\"checkbox\" name=\"scopes\" value=\"write\"> Write\n            </label>\n            <label class=\"checkbox-label\">\n              <input type=\"checkbox\" name=\"scopes\" value=\"chat\"> Chat\n            </label>\n            <label class=\"checkbox-label\">\n              <input type=\"checkbox\" name=\"scopes\" value=\"admin\"> Admin\n            </label>\n          </div>\n        </div>\n      </form>\n      <div class=\"modal-footer\">\n        <button class=\"btn btn-secondary close-modal\">Cancel</button>\n        <button class=\"btn btn-primary\" id=\"submit-key-btn\">Create Key</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  // Bind events\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => overlay.remove());\n  });\n\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) overlay.remove();\n  });\n\n  const submitBtn = overlay.querySelector('#submit-key-btn');\n  if (submitBtn) {\n    on(submitBtn as HTMLElement, 'click', async () => {\n      const form = overlay.querySelector('#create-key-form') as HTMLFormElement;\n      const nameInput = form.querySelector('#key-name') as HTMLInputElement;\n      const expirySelect = form.querySelector('#key-expiry') as HTMLSelectElement;\n      const scopeCheckboxes = form.querySelectorAll('input[name=\"scopes\"]:checked');\n\n      if (!nameInput.value.trim()) {\n        toast.error('Key name is required');\n        return;\n      }\n\n      const scopes = Array.from(scopeCheckboxes).map(cb => (cb as HTMLInputElement).value);\n\n      const btn = submitBtn as HTMLButtonElement;\n      btn.disabled = true;\n      btn.textContent = 'Creating...';\n\n      try {\n        const response = await http.post<{ key: string; id: string }>('/api/keys', {\n          name: nameInput.value.trim(),\n          expires_in_days: expirySelect.value ? parseInt(expirySelect.value) : null,\n          scopes,\n        });\n\n        // Show the generated key\n        showNewKeyModal(response.data.key);\n        overlay.remove();\n        loadApiKeys(panel, props);\n      } catch {\n        toast.error('Failed to create API key');\n        btn.disabled = false;\n        btn.textContent = 'Create Key';\n      }\n    });\n  }\n}\n\n/**\n * Show new key modal with copy button\n */\nfunction showNewKeyModal(key: string): void {\n  const overlay = createElement('div', { className: 'modal-overlay' });\n  \n  overlay.innerHTML = `\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h2>API Key Created</h2>\n      </div>\n      <div class=\"modal-body\">\n        <p class=\"warning-text\"> Copy this key now! You won't be able to see it again.</p>\n        <div class=\"key-display\">\n          <code id=\"new-key-value\">${escapeHtml(key)}</code>\n          <button class=\"btn btn-sm\" id=\"copy-key-btn\">Copy</button>\n        </div>\n      </div>\n      <div class=\"modal-footer\">\n        <button class=\"btn btn-primary close-modal\">Done</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  // Copy button\n  const copyBtn = overlay.querySelector('#copy-key-btn');\n  if (copyBtn) {\n    on(copyBtn as HTMLElement, 'click', async () => {\n      try {\n        await navigator.clipboard.writeText(key);\n        toast.success('Key copied to clipboard');\n        copyBtn.textContent = 'Copied!';\n      } catch {\n        toast.error('Failed to copy');\n      }\n    });\n  }\n\n  // Close button\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => overlay.remove());\n  });\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#keys-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createApiKeysPanel;\n","/**\n * Webhooks Panel Component\n * Manage webhooks with CRUD and test functionality\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface WebhooksPanelProps {\n  projectId?: string;\n}\n\ninterface Webhook {\n  id: string;\n  name: string;\n  url: string;\n  events: string[];\n  active: boolean;\n  secret?: string;\n  created_at: string;\n  last_triggered?: string;\n  last_status?: number;\n}\n\nconst AVAILABLE_EVENTS = [\n  'question.created',\n  'question.updated',\n  'question.answered',\n  'risk.created',\n  'risk.updated',\n  'risk.mitigated',\n  'action.created',\n  'action.completed',\n  'decision.created',\n  'decision.approved',\n  'decision.rejected',\n  'document.uploaded',\n  'document.processed',\n  'chat.message',\n];\n\n/**\n * Create webhooks panel\n */\nexport function createWebhooksPanel(props: WebhooksPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'webhooks-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Webhooks</h2>\n        <span class=\"panel-count\" id=\"webhooks-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <button class=\"btn btn-primary btn-sm\" id=\"create-webhook-btn\">+ Add Webhook</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"webhooks-content\">\n      <div class=\"loading\">Loading webhooks...</div>\n    </div>\n  `;\n\n  // Bind create button\n  const createBtn = panel.querySelector('#create-webhook-btn');\n  if (createBtn) {\n    on(createBtn as HTMLElement, 'click', () => showWebhookModal(panel, props));\n  }\n\n  // Initial load\n  loadWebhooks(panel, props);\n\n  return panel;\n}\n\n/**\n * Load webhooks\n */\nasync function loadWebhooks(panel: HTMLElement, props: WebhooksPanelProps): Promise<void> {\n  const content = panel.querySelector('#webhooks-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const response = await http.get<{ webhooks: Webhook[] }>('/api/webhooks');\n    renderWebhooks(content, response.data.webhooks || [], panel, props);\n    updateCount(panel, response.data.webhooks?.length || 0);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load webhooks</div>';\n  }\n}\n\n/**\n * Render webhooks\n */\nfunction renderWebhooks(\n  container: HTMLElement, \n  webhooks: Webhook[],\n  panel: HTMLElement,\n  props: WebhooksPanelProps\n): void {\n  if (webhooks.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <p>No webhooks configured</p>\n        <p class=\"hint\">Webhooks allow you to receive real-time notifications when events occur</p>\n      </div>\n    `;\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"webhooks-list\">\n      ${webhooks.map(webhook => `\n        <div class=\"webhook-card ${webhook.active ? '' : 'inactive'}\" data-id=\"${webhook.id}\">\n          <div class=\"webhook-status\">\n            <span class=\"status-indicator ${webhook.active ? 'active' : 'inactive'}\"></span>\n          </div>\n          <div class=\"webhook-info\">\n            <div class=\"webhook-name\">${escapeHtml(webhook.name)}</div>\n            <div class=\"webhook-url\">${escapeHtml(webhook.url)}</div>\n            <div class=\"webhook-events\">\n              ${webhook.events.slice(0, 3).map(e => `<span class=\"event-badge\">${e}</span>`).join('')}\n              ${webhook.events.length > 3 ? `<span class=\"more-events\">+${webhook.events.length - 3}</span>` : ''}\n            </div>\n            <div class=\"webhook-meta\">\n              Created ${formatRelativeTime(webhook.created_at)}\n              ${webhook.last_triggered \n                ? ` Last triggered ${formatRelativeTime(webhook.last_triggered)} (${webhook.last_status})` \n                : ' Never triggered'\n              }\n            </div>\n          </div>\n          <div class=\"webhook-actions\">\n            <button class=\"btn btn-sm test-webhook-btn\" data-id=\"${webhook.id}\">Test</button>\n            <button class=\"btn btn-sm edit-webhook-btn\" data-id=\"${webhook.id}\">Edit</button>\n            <button class=\"btn btn-sm btn-danger delete-webhook-btn\" data-id=\"${webhook.id}\">Delete</button>\n          </div>\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind events\n  container.querySelectorAll('.test-webhook-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const id = btn.getAttribute('data-id');\n      if (!id) return;\n\n      const button = btn as HTMLButtonElement;\n      button.disabled = true;\n      button.textContent = 'Testing...';\n\n      try {\n        await http.post(`/api/webhooks/${id}/test`);\n        toast.success('Test webhook sent');\n      } catch {\n        toast.error('Failed to send test webhook');\n      } finally {\n        button.disabled = false;\n        button.textContent = 'Test';\n      }\n    });\n  });\n\n  container.querySelectorAll('.edit-webhook-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', (e) => {\n      e.stopPropagation();\n      const id = btn.getAttribute('data-id');\n      const webhook = webhooks.find(w => w.id === id);\n      if (webhook) {\n        showWebhookModal(panel, props, webhook);\n      }\n    });\n  });\n\n  container.querySelectorAll('.delete-webhook-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const id = btn.getAttribute('data-id');\n      if (!id || !confirm('Delete this webhook?')) return;\n\n      try {\n        await http.delete(`/api/webhooks/${id}`);\n        toast.success('Webhook deleted');\n        loadWebhooks(panel, props);\n      } catch {\n        toast.error('Failed to delete webhook');\n      }\n    });\n  });\n}\n\n/**\n * Show webhook modal (create/edit)\n */\nfunction showWebhookModal(panel: HTMLElement, props: WebhooksPanelProps, webhook?: Webhook): void {\n  const isEdit = !!webhook;\n  const overlay = createElement('div', { className: 'modal-overlay' });\n  \n  overlay.innerHTML = `\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h2>${isEdit ? 'Edit Webhook' : 'Create Webhook'}</h2>\n        <button class=\"btn-icon close-modal\"></button>\n      </div>\n      <form id=\"webhook-form\" class=\"modal-body\">\n        <div class=\"form-group\">\n          <label for=\"webhook-name\">Name *</label>\n          <input type=\"text\" id=\"webhook-name\" required value=\"${escapeHtml(webhook?.name || '')}\" placeholder=\"e.g., Slack Notifications\">\n        </div>\n        <div class=\"form-group\">\n          <label for=\"webhook-url\">URL *</label>\n          <input type=\"url\" id=\"webhook-url\" required value=\"${escapeHtml(webhook?.url || '')}\" placeholder=\"https://your-endpoint.com/webhook\">\n        </div>\n        <div class=\"form-group\">\n          <label for=\"webhook-secret\">Secret (Optional)</label>\n          <input type=\"text\" id=\"webhook-secret\" value=\"${escapeHtml(webhook?.secret || '')}\" placeholder=\"Used to sign payloads\">\n        </div>\n        <div class=\"form-group\">\n          <label>Events *</label>\n          <div class=\"events-grid\">\n            ${AVAILABLE_EVENTS.map(event => `\n              <label class=\"checkbox-label\">\n                <input type=\"checkbox\" name=\"events\" value=\"${event}\" ${webhook?.events.includes(event) ? 'checked' : ''}>\n                ${event}\n              </label>\n            `).join('')}\n          </div>\n        </div>\n        <div class=\"form-group\">\n          <label class=\"checkbox-label\">\n            <input type=\"checkbox\" id=\"webhook-active\" ${webhook?.active !== false ? 'checked' : ''}>\n            Active\n          </label>\n        </div>\n      </form>\n      <div class=\"modal-footer\">\n        <button class=\"btn btn-secondary close-modal\">Cancel</button>\n        <button class=\"btn btn-primary\" id=\"submit-webhook-btn\">${isEdit ? 'Save' : 'Create'}</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  // Bind events\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => overlay.remove());\n  });\n\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) overlay.remove();\n  });\n\n  const submitBtn = overlay.querySelector('#submit-webhook-btn');\n  if (submitBtn) {\n    on(submitBtn as HTMLElement, 'click', async () => {\n      const form = overlay.querySelector('#webhook-form') as HTMLFormElement;\n      const nameInput = form.querySelector('#webhook-name') as HTMLInputElement;\n      const urlInput = form.querySelector('#webhook-url') as HTMLInputElement;\n      const secretInput = form.querySelector('#webhook-secret') as HTMLInputElement;\n      const activeCheckbox = form.querySelector('#webhook-active') as HTMLInputElement;\n      const eventCheckboxes = form.querySelectorAll('input[name=\"events\"]:checked');\n\n      if (!nameInput.value.trim() || !urlInput.value.trim()) {\n        toast.error('Name and URL are required');\n        return;\n      }\n\n      const events = Array.from(eventCheckboxes).map(cb => (cb as HTMLInputElement).value);\n      if (events.length === 0) {\n        toast.error('Select at least one event');\n        return;\n      }\n\n      const data = {\n        name: nameInput.value.trim(),\n        url: urlInput.value.trim(),\n        secret: secretInput.value.trim() || undefined,\n        events,\n        active: activeCheckbox.checked,\n      };\n\n      const btn = submitBtn as HTMLButtonElement;\n      btn.disabled = true;\n      btn.textContent = isEdit ? 'Saving...' : 'Creating...';\n\n      try {\n        if (isEdit) {\n          await http.put(`/api/webhooks/${webhook!.id}`, data);\n          toast.success('Webhook updated');\n        } else {\n          await http.post('/api/webhooks', data);\n          toast.success('Webhook created');\n        }\n        overlay.remove();\n        loadWebhooks(panel, props);\n      } catch {\n        toast.error(`Failed to ${isEdit ? 'update' : 'create'} webhook`);\n        btn.disabled = false;\n        btn.textContent = isEdit ? 'Save' : 'Create';\n      }\n    });\n  }\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#webhooks-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createWebhooksPanel;\n","/**\n * Audit Panel Component\n * Audit logs viewer with export wizard\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface AuditPanelProps {\n  projectId?: string;\n}\n\ninterface AuditLog {\n  id: string;\n  action: string;\n  entity_type: string;\n  entity_id?: string;\n  user_id?: string;\n  user_email?: string;\n  user_name?: string;\n  ip_address?: string;\n  details?: Record<string, unknown>;\n  created_at: string;\n}\n\ninterface AuditFilters {\n  action?: string;\n  entity_type?: string;\n  user_id?: string;\n  from_date?: string;\n  to_date?: string;\n}\n\nlet currentFilters: AuditFilters = {};\nlet currentPage = 1;\nconst PAGE_SIZE = 50;\n\n/**\n * Create audit panel\n */\nexport function createAuditPanel(props: AuditPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'audit-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Audit Log</h2>\n        <span class=\"panel-count\" id=\"audit-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <button class=\"btn btn-sm\" id=\"export-audit-btn\">Export</button>\n        <button class=\"btn btn-sm\" id=\"filter-audit-btn\">Filter</button>\n      </div>\n    </div>\n    <div class=\"audit-filters hidden\" id=\"audit-filters\">\n      <div class=\"filter-row\">\n        <select id=\"filter-action\" class=\"filter-select\">\n          <option value=\"\">All Actions</option>\n          <option value=\"create\">Create</option>\n          <option value=\"update\">Update</option>\n          <option value=\"delete\">Delete</option>\n          <option value=\"login\">Login</option>\n          <option value=\"logout\">Logout</option>\n          <option value=\"export\">Export</option>\n        </select>\n        <select id=\"filter-entity\" class=\"filter-select\">\n          <option value=\"\">All Entities</option>\n          <option value=\"question\">Questions</option>\n          <option value=\"risk\">Risks</option>\n          <option value=\"action\">Actions</option>\n          <option value=\"decision\">Decisions</option>\n          <option value=\"contact\">Contacts</option>\n          <option value=\"document\">Documents</option>\n          <option value=\"user\">Users</option>\n          <option value=\"project\">Projects</option>\n        </select>\n        <input type=\"date\" id=\"filter-from\" class=\"filter-date\" placeholder=\"From\">\n        <input type=\"date\" id=\"filter-to\" class=\"filter-date\" placeholder=\"To\">\n        <button class=\"btn btn-sm\" id=\"apply-filters-btn\">Apply</button>\n        <button class=\"btn btn-sm\" id=\"clear-filters-btn\">Clear</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"audit-content\">\n      <div class=\"loading\">Loading audit logs...</div>\n    </div>\n    <div class=\"audit-pagination\" id=\"audit-pagination\"></div>\n  `;\n\n  // Bind filter toggle\n  const filterBtn = panel.querySelector('#filter-audit-btn');\n  if (filterBtn) {\n    on(filterBtn as HTMLElement, 'click', () => {\n      const filters = panel.querySelector('#audit-filters');\n      filters?.classList.toggle('hidden');\n    });\n  }\n\n  // Bind apply filters\n  const applyBtn = panel.querySelector('#apply-filters-btn');\n  if (applyBtn) {\n    on(applyBtn as HTMLElement, 'click', () => {\n      currentFilters = {\n        action: (panel.querySelector('#filter-action') as HTMLSelectElement).value || undefined,\n        entity_type: (panel.querySelector('#filter-entity') as HTMLSelectElement).value || undefined,\n        from_date: (panel.querySelector('#filter-from') as HTMLInputElement).value || undefined,\n        to_date: (panel.querySelector('#filter-to') as HTMLInputElement).value || undefined,\n      };\n      currentPage = 1;\n      loadAuditLogs(panel, props);\n    });\n  }\n\n  // Bind clear filters\n  const clearBtn = panel.querySelector('#clear-filters-btn');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', () => {\n      currentFilters = {};\n      currentPage = 1;\n      (panel.querySelector('#filter-action') as HTMLSelectElement).value = '';\n      (panel.querySelector('#filter-entity') as HTMLSelectElement).value = '';\n      (panel.querySelector('#filter-from') as HTMLInputElement).value = '';\n      (panel.querySelector('#filter-to') as HTMLInputElement).value = '';\n      loadAuditLogs(panel, props);\n    });\n  }\n\n  // Bind export\n  const exportBtn = panel.querySelector('#export-audit-btn');\n  if (exportBtn) {\n    on(exportBtn as HTMLElement, 'click', () => showExportWizard(props));\n  }\n\n  // Initial load\n  loadAuditLogs(panel, props);\n\n  return panel;\n}\n\n/**\n * Load audit logs\n */\nasync function loadAuditLogs(panel: HTMLElement, props: AuditPanelProps): Promise<void> {\n  const content = panel.querySelector('#audit-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const params = new URLSearchParams();\n    params.set('page', String(currentPage));\n    params.set('limit', String(PAGE_SIZE));\n    \n    if (currentFilters.action) params.set('action', currentFilters.action);\n    if (currentFilters.entity_type) params.set('entity_type', currentFilters.entity_type);\n    if (currentFilters.from_date) params.set('from_date', currentFilters.from_date);\n    if (currentFilters.to_date) params.set('to_date', currentFilters.to_date);\n\n    const response = await http.get<{ logs: AuditLog[]; total: number }>(`/api/audit?${params}`);\n    renderAuditLogs(content, response.data.logs || []);\n    updateCount(panel, response.data.total);\n    renderPagination(panel, response.data.total, props);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load audit logs</div>';\n  }\n}\n\n/**\n * Render audit logs\n */\nfunction renderAuditLogs(container: HTMLElement, logs: AuditLog[]): void {\n  if (logs.length === 0) {\n    container.innerHTML = '<div class=\"empty\">No audit logs found</div>';\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"audit-table\">\n      <div class=\"audit-header\">\n        <span class=\"audit-col time\">Time</span>\n        <span class=\"audit-col user\">User</span>\n        <span class=\"audit-col action\">Action</span>\n        <span class=\"audit-col entity\">Entity</span>\n        <span class=\"audit-col details\">Details</span>\n      </div>\n      <div class=\"audit-body\">\n        ${logs.map(log => `\n          <div class=\"audit-row\" data-id=\"${log.id}\">\n            <span class=\"audit-col time\" title=\"${new Date(log.created_at).toLocaleString()}\">\n              ${formatRelativeTime(log.created_at)}\n            </span>\n            <span class=\"audit-col user\">\n              ${log.user_name || log.user_email || 'System'}\n              ${log.ip_address ? `<span class=\"ip-address\">${log.ip_address}</span>` : ''}\n            </span>\n            <span class=\"audit-col action\">\n              <span class=\"action-badge ${getActionClass(log.action)}\">${log.action}</span>\n            </span>\n            <span class=\"audit-col entity\">\n              ${log.entity_type}${log.entity_id ? ` #${log.entity_id.slice(0, 8)}` : ''}\n            </span>\n            <span class=\"audit-col details\">\n              ${log.details ? `<button class=\"btn-link view-details-btn\">View</button>` : '-'}\n            </span>\n          </div>\n        `).join('')}\n      </div>\n    </div>\n  `;\n\n  // Bind view details buttons\n  container.querySelectorAll('.view-details-btn').forEach((btn, index) => {\n    on(btn as HTMLElement, 'click', () => {\n      const log = logs[index];\n      if (log?.details) {\n        showDetailsModal(log);\n      }\n    });\n  });\n}\n\n/**\n * Get action class for styling\n */\nfunction getActionClass(action: string): string {\n  if (action.includes('create')) return 'create';\n  if (action.includes('update')) return 'update';\n  if (action.includes('delete')) return 'delete';\n  if (action.includes('login')) return 'login';\n  if (action.includes('export')) return 'export';\n  return '';\n}\n\n/**\n * Render pagination\n */\nfunction renderPagination(panel: HTMLElement, total: number, props: AuditPanelProps): void {\n  const container = panel.querySelector('#audit-pagination') as HTMLElement;\n  const totalPages = Math.ceil(total / PAGE_SIZE);\n\n  if (totalPages <= 1) {\n    container.innerHTML = '';\n    return;\n  }\n\n  container.innerHTML = `\n    <button class=\"btn btn-sm\" id=\"prev-page\" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>\n    <span class=\"page-info\">Page ${currentPage} of ${totalPages}</span>\n    <button class=\"btn btn-sm\" id=\"next-page\" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>\n  `;\n\n  const prevBtn = container.querySelector('#prev-page');\n  if (prevBtn) {\n    on(prevBtn as HTMLElement, 'click', () => {\n      if (currentPage > 1) {\n        currentPage--;\n        loadAuditLogs(panel, props);\n      }\n    });\n  }\n\n  const nextBtn = container.querySelector('#next-page');\n  if (nextBtn) {\n    on(nextBtn as HTMLElement, 'click', () => {\n      if (currentPage < totalPages) {\n        currentPage++;\n        loadAuditLogs(panel, props);\n      }\n    });\n  }\n}\n\n/**\n * Show details modal\n */\nfunction showDetailsModal(log: AuditLog): void {\n  const overlay = createElement('div', { className: 'modal-overlay' });\n  \n  overlay.innerHTML = `\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h2>Audit Log Details</h2>\n        <button class=\"btn-icon close-modal\"></button>\n      </div>\n      <div class=\"modal-body\">\n        <div class=\"detail-row\">\n          <span class=\"detail-label\">ID:</span>\n          <span class=\"detail-value\">${log.id}</span>\n        </div>\n        <div class=\"detail-row\">\n          <span class=\"detail-label\">Time:</span>\n          <span class=\"detail-value\">${new Date(log.created_at).toLocaleString()}</span>\n        </div>\n        <div class=\"detail-row\">\n          <span class=\"detail-label\">Action:</span>\n          <span class=\"detail-value\">${log.action}</span>\n        </div>\n        <div class=\"detail-row\">\n          <span class=\"detail-label\">Entity:</span>\n          <span class=\"detail-value\">${log.entity_type} ${log.entity_id || ''}</span>\n        </div>\n        <div class=\"detail-row\">\n          <span class=\"detail-label\">User:</span>\n          <span class=\"detail-value\">${log.user_name || log.user_email || 'System'}</span>\n        </div>\n        ${log.ip_address ? `\n          <div class=\"detail-row\">\n            <span class=\"detail-label\">IP Address:</span>\n            <span class=\"detail-value\">${log.ip_address}</span>\n          </div>\n        ` : ''}\n        <div class=\"detail-row\">\n          <span class=\"detail-label\">Details:</span>\n          <pre class=\"detail-json\">${JSON.stringify(log.details, null, 2)}</pre>\n        </div>\n      </div>\n      <div class=\"modal-footer\">\n        <button class=\"btn btn-primary close-modal\">Close</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => overlay.remove());\n  });\n\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) overlay.remove();\n  });\n}\n\n/**\n * Show export wizard\n */\nfunction showExportWizard(props: AuditPanelProps): void {\n  const overlay = createElement('div', { className: 'modal-overlay' });\n  \n  overlay.innerHTML = `\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h2>Export Audit Logs</h2>\n        <button class=\"btn-icon close-modal\"></button>\n      </div>\n      <div class=\"modal-body\">\n        <div class=\"form-group\">\n          <label>Date Range</label>\n          <div class=\"date-range\">\n            <input type=\"date\" id=\"export-from\" placeholder=\"From\">\n            <span>to</span>\n            <input type=\"date\" id=\"export-to\" placeholder=\"To\">\n          </div>\n        </div>\n        <div class=\"form-group\">\n          <label>Format</label>\n          <select id=\"export-format\">\n            <option value=\"csv\">CSV</option>\n            <option value=\"json\">JSON</option>\n          </select>\n        </div>\n        <div class=\"form-group\">\n          <label>Include</label>\n          <div class=\"checkbox-group\">\n            <label class=\"checkbox-label\">\n              <input type=\"checkbox\" name=\"include\" value=\"details\" checked> Details\n            </label>\n            <label class=\"checkbox-label\">\n              <input type=\"checkbox\" name=\"include\" value=\"ip\"> IP Addresses\n            </label>\n          </div>\n        </div>\n      </div>\n      <div class=\"modal-footer\">\n        <button class=\"btn btn-secondary close-modal\">Cancel</button>\n        <button class=\"btn btn-primary\" id=\"export-btn\">Export</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => overlay.remove());\n  });\n\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) overlay.remove();\n  });\n\n  const exportBtn = overlay.querySelector('#export-btn');\n  if (exportBtn) {\n    on(exportBtn as HTMLElement, 'click', async () => {\n      const fromDate = (overlay.querySelector('#export-from') as HTMLInputElement).value;\n      const toDate = (overlay.querySelector('#export-to') as HTMLInputElement).value;\n      const format = (overlay.querySelector('#export-format') as HTMLSelectElement).value;\n      const includeCheckboxes = overlay.querySelectorAll('input[name=\"include\"]:checked');\n      const include = Array.from(includeCheckboxes).map(cb => (cb as HTMLInputElement).value);\n\n      const btn = exportBtn as HTMLButtonElement;\n      btn.disabled = true;\n      btn.textContent = 'Exporting...';\n\n      try {\n        const params = new URLSearchParams();\n        params.set('format', format);\n        if (fromDate) params.set('from_date', fromDate);\n        if (toDate) params.set('to_date', toDate);\n        include.forEach(i => params.append('include', i));\n\n        const response = await fetch(`/api/audit/export?${params}`);\n        if (!response.ok) throw new Error('Export failed');\n\n        const blob = await response.blob();\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `audit-logs-${new Date().toISOString().split('T')[0]}.${format}`;\n        a.click();\n        URL.revokeObjectURL(url);\n\n        toast.success('Audit logs exported');\n        overlay.remove();\n      } catch {\n        toast.error('Failed to export audit logs');\n        btn.disabled = false;\n        btn.textContent = 'Export';\n      }\n    });\n  }\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#audit-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\nexport default createAuditPanel;\n","/**\n * Roles Panel - SOTA Design\n * Manage role templates with AI-enhanced context\n * Note: User permissions are managed separately per member in MembersPanel\n */\n\nimport { on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\n\ninterface Role {\n  id: string;\n  name: string;\n  display_name?: string;\n  description?: string;\n  role_context?: string;\n  color?: string;\n  category?: string;\n  is_template?: boolean;\n  is_system?: boolean;\n  created_at?: string;\n}\n\nconst ROLE_CATEGORIES = [\n  { id: 'project', name: 'Project', icon: '', examples: 'Project Manager, Scrum Master, Product Owner' },\n  { id: 'technical', name: 'Technical', icon: '', examples: 'Developer, Architect, DevOps, QA' },\n  { id: 'management', name: 'Management', icon: '', examples: 'Director, VP, C-Level' },\n  { id: 'stakeholder', name: 'Stakeholder', icon: '', examples: 'Client, Sponsor, External Partner' },\n  { id: 'custom', name: 'Custom', icon: '', examples: 'Custom roles for your team' },\n];\n\nlet currentRoles: Role[] = [];\nlet editingRole: Role | null = null;\n\n/**\n * Render Roles Panel\n */\nexport async function renderRolesPanel(container: HTMLElement): Promise<void> {\n  container.innerHTML = `\n    <style>\n      .roles-panel-sota {\n        padding: 24px;\n        max-width: 1200px;\n        margin: 0 auto;\n      }\n      \n      .roles-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 24px;\n      }\n      \n      .roles-header h2 {\n        margin: 0;\n        font-size: 24px;\n        font-weight: 700;\n        color: var(--text-primary);\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n      \n      .roles-header h2 svg {\n        width: 28px;\n        height: 28px;\n        color: #e11d48;\n      }\n      \n      .roles-header-subtitle {\n        font-size: 14px;\n        color: var(--text-secondary);\n        margin-top: 4px;\n        font-weight: 400;\n      }\n      \n      .btn-create-role {\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 12px 24px;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        border: none;\n        border-radius: 12px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\n      }\n      \n      .btn-create-role:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\n      }\n      \n      .roles-layout {\n        display: grid;\n        grid-template-columns: 320px 1fr;\n        gap: 24px;\n      }\n      \n      @media (max-width: 900px) {\n        .roles-layout {\n          grid-template-columns: 1fr;\n        }\n      }\n      \n      .roles-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      \n      .role-card {\n        background: var(--bg-primary);\n        border: 1px solid var(--border-color);\n        border-radius: 16px;\n        padding: 16px;\n        cursor: pointer;\n        transition: all 0.2s;\n        position: relative;\n      }\n      \n      .role-card:hover {\n        border-color: #e11d48;\n        transform: translateX(4px);\n      }\n      \n      .role-card.active {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.03) 100%);\n      }\n      \n      .role-card-header {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        margin-bottom: 8px;\n      }\n      \n      .role-color-dot {\n        width: 12px;\n        height: 12px;\n        border-radius: 50%;\n        flex-shrink: 0;\n      }\n      \n      .role-card-name {\n        font-weight: 600;\n        color: var(--text-primary);\n        flex: 1;\n      }\n      \n      .role-card-badges {\n        display: flex;\n        gap: 4px;\n      }\n      \n      .role-badge {\n        font-size: 10px;\n        padding: 2px 6px;\n        border-radius: 4px;\n        font-weight: 500;\n      }\n      \n      .role-badge.template {\n        background: #dbeafe;\n        color: #1d4ed8;\n      }\n      \n      .role-badge.system {\n        background: #fef3c7;\n        color: #92400e;\n      }\n      \n      .role-card-category {\n        font-size: 11px;\n        color: var(--text-muted);\n        margin-bottom: 4px;\n      }\n      \n      .role-card-desc {\n        font-size: 13px;\n        color: var(--text-secondary);\n        line-height: 1.5;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n      }\n      \n      /* Editor Panel */\n      .role-editor {\n        background: var(--bg-primary);\n        border: 1px solid var(--border-color);\n        border-radius: 20px;\n        overflow: hidden;\n      }\n      \n      .role-editor-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 24px;\n        color: white;\n      }\n      \n      .role-editor-header h3 {\n        margin: 0;\n        font-size: 20px;\n        font-weight: 700;\n      }\n      \n      .role-editor-body {\n        padding: 24px;\n      }\n      \n      .form-row {\n        display: flex;\n        gap: 16px;\n        margin-bottom: 20px;\n      }\n      \n      .form-group {\n        flex: 1;\n      }\n      \n      .form-group label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        margin-bottom: 8px;\n      }\n      \n      .form-group input,\n      .form-group textarea,\n      .form-group select {\n        width: 100%;\n        padding: 12px 16px;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        font-size: 14px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        transition: all 0.2s;\n        box-sizing: border-box;\n      }\n      \n      .form-group input:focus,\n      .form-group textarea:focus,\n      .form-group select:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .form-group textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .form-hint {\n        font-size: 12px;\n        color: var(--text-muted);\n        margin-top: 6px;\n      }\n      \n      .ai-enhance-section {\n        display: flex;\n        gap: 12px;\n        align-items: flex-start;\n        margin-top: 12px;\n      }\n      \n      .ai-enhance-btn {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        padding: 10px 16px;\n        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n        color: white;\n        border: none;\n        border-radius: 10px;\n        font-size: 13px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        white-space: nowrap;\n      }\n      \n      .ai-enhance-btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n      }\n      \n      .ai-enhance-btn:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n        transform: none;\n      }\n      \n      .ai-enhance-btn svg {\n        width: 14px;\n        height: 14px;\n      }\n      \n      @keyframes spin {\n        from { transform: rotate(0deg); }\n        to { transform: rotate(360deg); }\n      }\n      \n      .spin {\n        animation: spin 1s linear infinite;\n      }\n      \n      /* Actions */\n      .role-editor-actions {\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n        margin-top: 24px;\n        padding-top: 24px;\n        border-top: 1px solid var(--border-color);\n      }\n      \n      .btn {\n        padding: 12px 24px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n      }\n      \n      .btn-secondary {\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      \n      .btn-secondary:hover {\n        background: var(--bg-tertiary);\n      }\n      \n      .btn-primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\n      }\n      \n      .btn-primary:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\n      }\n      \n      .btn-danger {\n        background: #fee2e2;\n        color: #dc2626;\n      }\n      \n      .btn-danger:hover {\n        background: #fecaca;\n      }\n      \n      .template-toggle {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        margin-top: 20px;\n        padding: 14px 16px;\n        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);\n        border: 1px solid #86efac;\n        border-radius: 12px;\n      }\n      \n      .template-toggle label {\n        margin: 0;\n        font-size: 13px;\n        color: #166534;\n        font-weight: 500;\n      }\n      \n      .template-toggle input {\n        accent-color: #16a34a;\n        width: 18px;\n        height: 18px;\n      }\n      \n      .empty-state {\n        text-align: center;\n        padding: 48px;\n        color: var(--text-muted);\n      }\n      \n      .empty-state svg {\n        width: 64px;\n        height: 64px;\n        opacity: 0.3;\n        margin-bottom: 16px;\n      }\n      \n      .info-card {\n        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);\n        border: 1px solid #93c5fd;\n        border-radius: 12px;\n        padding: 16px;\n        margin-bottom: 20px;\n      }\n      \n      .info-card h4 {\n        margin: 0 0 8px;\n        font-size: 14px;\n        color: #1e40af;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n      \n      .info-card p {\n        margin: 0;\n        font-size: 13px;\n        color: #3b82f6;\n        line-height: 1.5;\n      }\n    </style>\n    \n    <div class=\"roles-panel-sota\">\n      <div class=\"roles-header\">\n        <div>\n          <h2>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\"/>\n            </svg>\n            Role Templates\n          </h2>\n          <div class=\"roles-header-subtitle\">Define roles to assign to team members and contacts. The AI uses role context to adapt responses.</div>\n        </div>\n        <button class=\"btn-create-role\" id=\"btn-create-role\">\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create Role\n        </button>\n      </div>\n      \n      <div class=\"roles-layout\">\n        <div class=\"roles-list\" id=\"roles-list\">\n          <div class=\"empty-state\">Loading roles...</div>\n        </div>\n        \n        <div class=\"role-editor\" id=\"role-editor\" style=\"display: none;\">\n          <!-- Editor content will be rendered here -->\n        </div>\n      </div>\n    </div>\n  `;\n\n  // Load roles\n  await loadRoles(container);\n\n  // Bind create button\n  const createBtn = container.querySelector('#btn-create-role');\n  if (createBtn) {\n    on(createBtn as HTMLElement, 'click', () => {\n      editingRole = null;\n      showRoleEditor(container, null);\n    });\n  }\n}\n\n/**\n * Load roles from API\n */\nasync function loadRoles(container: HTMLElement): Promise<void> {\n  const listEl = container.querySelector('#roles-list') as HTMLElement;\n  if (!listEl) return;\n\n  try {\n    // Load role templates\n    const response = await http.get<{ roles: Role[] }>('/api/role-templates');\n    currentRoles = response.data.roles || [];\n\n    if (currentRoles.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"empty-state\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197\"/>\n          </svg>\n          <p>No roles defined yet</p>\n          <p style=\"font-size: 13px; opacity: 0.7;\">Click \"Create Role\" to get started</p>\n        </div>\n      `;\n      return;\n    }\n\n    renderRolesList(listEl, container);\n  } catch (error) {\n    console.error('[RolesPanel] Failed to load roles:', error);\n    listEl.innerHTML = `<div class=\"empty-state\">Failed to load roles</div>`;\n  }\n}\n\n/**\n * Render roles list\n */\nfunction renderRolesList(listEl: HTMLElement, container: HTMLElement): void {\n  const categoryMap = Object.fromEntries(ROLE_CATEGORIES.map(c => [c.id, c]));\n  \n  listEl.innerHTML = currentRoles.map(role => {\n    const cat = categoryMap[role.category || 'custom'];\n    return `\n      <div class=\"role-card${editingRole?.id === role.id ? ' active' : ''}\" data-id=\"${role.id}\">\n        <div class=\"role-card-header\">\n          <div class=\"role-color-dot\" style=\"background: ${role.color || '#e11d48'}\"></div>\n          <div class=\"role-card-name\">${escapeHtml(role.display_name || role.name)}</div>\n          <div class=\"role-card-badges\">\n            ${role.is_template ? '<span class=\"role-badge template\">Template</span>' : ''}\n            ${role.is_system ? '<span class=\"role-badge system\">System</span>' : ''}\n          </div>\n        </div>\n        <div class=\"role-card-category\">${cat?.icon || ''} ${cat?.name || 'Custom'}</div>\n        ${role.description ? `<div class=\"role-card-desc\">${escapeHtml(role.description)}</div>` : ''}\n      </div>\n    `;\n  }).join('');\n\n  // Bind click events\n  listEl.querySelectorAll('.role-card').forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const roleId = card.getAttribute('data-id');\n      const role = currentRoles.find(r => r.id === roleId);\n      if (role) {\n        editingRole = role;\n        listEl.querySelectorAll('.role-card').forEach(c => c.classList.remove('active'));\n        card.classList.add('active');\n        showRoleEditor(container, role);\n      }\n    });\n  });\n}\n\n/**\n * Show role editor\n */\nfunction showRoleEditor(container: HTMLElement, role: Role | null): void {\n  const editorEl = container.querySelector('#role-editor') as HTMLElement;\n  if (!editorEl) return;\n\n  editorEl.style.display = 'block';\n\n  const isNew = !role;\n\n  editorEl.innerHTML = `\n    <div class=\"role-editor-header\">\n      <h3>${isNew ? 'Create New Role' : 'Edit Role'}</h3>\n    </div>\n    \n    <div class=\"role-editor-body\">\n      <div class=\"info-card\">\n        <h4> How Role Templates Work</h4>\n        <p>Role templates define job titles and context that helps the AI understand each person's perspective. When you assign a role to a team member or contact, the AI adapts its responses to be more relevant to their responsibilities.</p>\n      </div>\n      \n      <form id=\"role-form\">\n        <div class=\"form-row\">\n          <div class=\"form-group\" style=\"flex: 2\">\n            <label>Role Name *</label>\n            <input type=\"text\" id=\"role-name\" required value=\"${escapeHtml(role?.display_name || role?.name || '')}\" placeholder=\"e.g., Project Manager, Senior Developer\">\n          </div>\n          <div class=\"form-group\" style=\"flex: 1\">\n            <label>Category</label>\n            <select id=\"role-category\">\n              ${ROLE_CATEGORIES.map(cat => `\n                <option value=\"${cat.id}\" ${role?.category === cat.id ? 'selected' : ''}>${cat.icon} ${cat.name}</option>\n              `).join('')}\n            </select>\n          </div>\n          <div class=\"form-group\" style=\"width: 80px\">\n            <label>Color</label>\n            <input type=\"color\" id=\"role-color\" value=\"${role?.color || '#e11d48'}\" style=\"height: 42px; padding: 4px;\">\n          </div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label>Description</label>\n          <textarea id=\"role-description\" rows=\"2\" placeholder=\"Brief description of this role's main responsibilities...\">${escapeHtml(role?.description || '')}</textarea>\n          <div class=\"form-hint\">A short summary shown in role lists and dropdowns.</div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label>Role Context (for AI)</label>\n          <textarea id=\"role-context\" rows=\"6\" placeholder=\"Describe this role in detail for the AI:&#10;&#10; What are their main responsibilities?&#10; What decisions do they typically make?&#10; What information is most relevant to them?&#10; How should the AI adapt its tone and detail level?\">${escapeHtml(role?.role_context || '')}</textarea>\n          <div class=\"form-hint\">This context helps the AI provide more relevant and targeted responses when interacting with people in this role.</div>\n          <div class=\"ai-enhance-section\">\n            <button type=\"button\" class=\"ai-enhance-btn\" id=\"btn-ai-enhance\">\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n              </svg>\n              Enhance with AI\n            </button>\n            <span class=\"form-hint\" style=\"margin: 0; padding-top: 10px;\">Let AI generate or improve the role context based on the role name.</span>\n          </div>\n        </div>\n        \n        <div class=\"template-toggle\">\n          <input type=\"checkbox\" id=\"is-template\" ${role?.is_template !== false ? 'checked' : ''}>\n          <label for=\"is-template\">Save as template (reusable across all projects)</label>\n        </div>\n        \n        <div class=\"role-editor-actions\">\n          ${!isNew && !role?.is_system ? `\n            <button type=\"button\" class=\"btn btn-danger\" id=\"btn-delete-role\">Delete</button>\n          ` : ''}\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"btn-cancel\">Cancel</button>\n          <button type=\"submit\" class=\"btn btn-primary\">${isNew ? 'Create Role' : 'Save Changes'}</button>\n        </div>\n      </form>\n    </div>\n  `;\n\n  bindEditorEvents(container, role);\n}\n\n/**\n * Bind editor events\n */\nfunction bindEditorEvents(container: HTMLElement, role: Role | null): void {\n  const editorEl = container.querySelector('#role-editor') as HTMLElement;\n  if (!editorEl) return;\n\n  // Cancel button\n  const cancelBtn = editorEl.querySelector('#btn-cancel');\n  if (cancelBtn) {\n    on(cancelBtn as HTMLElement, 'click', () => {\n      editorEl.style.display = 'none';\n      editingRole = null;\n      const listEl = container.querySelector('#roles-list') as HTMLElement;\n      if (listEl) {\n        listEl.querySelectorAll('.role-card').forEach(c => c.classList.remove('active'));\n      }\n    });\n  }\n\n  // Delete button\n  const deleteBtn = editorEl.querySelector('#btn-delete-role');\n  if (deleteBtn && role) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm(`Are you sure you want to delete \"${role.display_name || role.name}\"?`)) return;\n\n      try {\n        await http.delete(`/api/role-templates/${role.id}`);\n        toast.success('Role deleted');\n        editorEl.style.display = 'none';\n        editingRole = null;\n        await loadRoles(container);\n      } catch {\n        toast.error('Failed to delete role');\n      }\n    });\n  }\n\n  // AI Enhance button\n  const aiBtn = editorEl.querySelector('#btn-ai-enhance');\n  if (aiBtn) {\n    on(aiBtn as HTMLElement, 'click', async () => {\n      const nameInput = editorEl.querySelector('#role-name') as HTMLInputElement;\n      const contextInput = editorEl.querySelector('#role-context') as HTMLTextAreaElement;\n      const descInput = editorEl.querySelector('#role-description') as HTMLTextAreaElement;\n\n      const roleName = nameInput.value.trim();\n      if (!roleName) {\n        toast.error('Please enter a role name first');\n        return;\n      }\n\n      (aiBtn as HTMLButtonElement).disabled = true;\n      aiBtn.innerHTML = `<svg class=\"spin\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/></svg> Enhancing...`;\n\n      try {\n        const response = await http.post<{ prompt: string; description?: string }>('/api/roles/generate', {\n          title: roleName,\n          currentContext: contextInput.value,\n        });\n\n        if (response.data.prompt) {\n          contextInput.value = response.data.prompt;\n        }\n        if (response.data.description && !descInput.value) {\n          descInput.value = response.data.description;\n        }\n        toast.success('Role context enhanced with AI');\n      } catch {\n        toast.error('Failed to enhance with AI');\n      } finally {\n        (aiBtn as HTMLButtonElement).disabled = false;\n        aiBtn.innerHTML = `<svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> Enhance with AI`;\n      }\n    });\n  }\n\n  // Form submit\n  const form = editorEl.querySelector('#role-form') as HTMLFormElement;\n  if (form) {\n    on(form, 'submit', async (e) => {\n      e.preventDefault();\n\n      const name = (editorEl.querySelector('#role-name') as HTMLInputElement).value.trim();\n      const category = (editorEl.querySelector('#role-category') as HTMLSelectElement).value;\n      const color = (editorEl.querySelector('#role-color') as HTMLInputElement).value;\n      const description = (editorEl.querySelector('#role-description') as HTMLTextAreaElement).value.trim();\n      const roleContext = (editorEl.querySelector('#role-context') as HTMLTextAreaElement).value.trim();\n      const isTemplate = (editorEl.querySelector('#is-template') as HTMLInputElement).checked;\n\n      const roleData = {\n        name: name.toLowerCase().replace(/\\s+/g, '_'),\n        display_name: name,\n        description,\n        role_context: roleContext,\n        category,\n        color,\n        is_template: isTemplate,\n      };\n\n      try {\n        if (role) {\n          await http.put(`/api/role-templates/${role.id}`, roleData);\n          toast.success('Role updated');\n        } else {\n          await http.post('/api/role-templates', roleData);\n          toast.success('Role created');\n        }\n\n        editorEl.style.display = 'none';\n        editingRole = null;\n        await loadRoles(container);\n      } catch {\n        toast.error('Failed to save role');\n      }\n    });\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default renderRolesPanel;\n","/**\n * AdminPanel Component\n * Platform administration for superadmin users\n * Includes: LLM Config, Graph, Prompts, Processing, Audit Log\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { appStore } from '../stores/app';\nimport { \n  billingService, \n  type ProjectBillingOverview, \n  type PricingConfig, \n  type PricingTier,\n  type ExchangeRateConfig,\n  formatEur, \n  formatTokens \n} from '../services/billing';\n\n// Types\ninterface SystemConfig {\n  id?: string;\n  key: string;\n  value: unknown;\n  category: string;\n  description?: string;\n}\n\ninterface LLMProvider {\n  id: string;\n  name: string;\n  enabled: boolean;\n  models: string[];\n  status?: 'healthy' | 'degraded' | 'offline';\n}\n\ninterface AuditLogEntry {\n  id: string;\n  table_name: string;\n  operation: string;\n  old_values?: Record<string, unknown>;\n  new_values?: Record<string, unknown>;\n  changed_by_email?: string;\n  changed_at: string;\n}\n\ninterface SystemPrompt {\n  id: string;\n  key: string;\n  name: string;\n  description: string;\n  category: string;\n  prompt_template: string;\n  uses_ontology: boolean;\n}\n\n// Ontology state (for Admin Ontology tab)\ninterface OntologyEntityType {\n  name: string;\n  properties?: string[];\n  searchable?: string[];\n  required?: string[];\n  sharedEntity?: boolean;\n}\ninterface OntologyRelationType {\n  name: string;\n  sourceType?: string;\n  targetType?: string;\n}\nlet ontologyEntities: OntologyEntityType[] = [];\nlet ontologyRelations: OntologyRelationType[] = [];\nlet ontologyLoaded = false;\nlet ontologyLoading = false;\n\n// Graph overview state (for Graph section)\ninterface GraphListItem {\n  graphName: string;\n  projectId?: string | null;\n  projectName?: string | null;\n}\nlet graphList: GraphListItem[] = [];\nlet graphStatus: { enabled?: boolean; graphName?: string; stats?: { nodes?: number; relationships?: number } } | null = null;\nlet graphOverviewLoaded = false;\nlet graphOverviewLoading = false;\nlet graphPasswordSet = false; // Track if GRAPH_PASSWORD secret exists\n\n// State\nlet currentSection = 'llm';\nlet systemConfig: Record<string, SystemConfig[]> = {};\nlet providers: LLMProvider[] = [];\nlet auditLogs: AuditLogEntry[] = [];\nlet systemPrompts: SystemPrompt[] = [];\nlet isLoading = false;\n\n// Team Analysis settings state (per-project, loaded on demand)\ninterface TeamAnalysisSettings {\n  enabled: boolean;\n  access: 'admin_only' | 'all';\n}\nlet teamAnalysisSettings: TeamAnalysisSettings = { enabled: true, access: 'admin_only' };\nlet teamAnalysisLoaded = false;\nlet teamAnalysisLoading = false;\n\n// Billing state\nlet billingProjects: ProjectBillingOverview[] = [];\nlet globalPricingConfig: PricingConfig | null = null;\nlet globalPricingTiers: PricingTier[] = [];\nlet exchangeRateConfig: ExchangeRateConfig | null = null;\nlet billingLoaded = false;\nlet billingLoading = false;\n\n/**\n * Load system configuration\n */\nasync function loadSystemConfig(): Promise<void> {\n  try {\n    const response = await http.get<{ \n      llm_pertask?: { text?: { provider: string; model: string }; vision?: { provider: string; model: string }; embeddings?: { provider: string; model: string } };\n      prompts?: Record<string, unknown>;\n      processing?: Record<string, unknown>;\n      graph?: Record<string, unknown>;\n    }>('/api/system/config');\n    \n    // Convert to internal format grouped by category\n    systemConfig = {};\n    \n    // LLM per-task configs\n    if (response.data?.llm_pertask) {\n      systemConfig['llm'] = [];\n      const perTask = response.data.llm_pertask;\n      if (perTask.text) {\n        systemConfig['llm'].push({ key: 'text_provider', value: perTask.text, category: 'llm' });\n      }\n      if (perTask.vision) {\n        systemConfig['llm'].push({ key: 'vision_provider', value: perTask.vision, category: 'llm' });\n      }\n      if (perTask.embeddings) {\n        systemConfig['llm'].push({ key: 'embeddings_provider', value: perTask.embeddings, category: 'llm' });\n      }\n    }\n    \n    // Processing config\n    if (response.data?.processing) {\n      systemConfig['processing'] = [{ key: 'processing', value: response.data.processing, category: 'processing' }];\n    }\n    \n    // Graph config\n    if (response.data?.graph) {\n      systemConfig['graph'] = [{ key: 'graph', value: response.data.graph, category: 'graph' }];\n    }\n    \n    console.log('[AdminPanel] Loaded system config:', systemConfig);\n  } catch (error) {\n    console.warn('Failed to load system config:', error);\n    systemConfig = {};\n  }\n}\n\n/**\n * Load secrets to check if graph password is set\n */\nasync function loadSecrets(): Promise<void> {\n  try {\n    const response = await http.get<{ secrets: Array<{ name: string; masked_value?: string }> }>('/api/secrets');\n    const secrets = response.data?.secrets || [];\n    graphPasswordSet = secrets.some(s => s.name === 'GRAPH_PASSWORD');\n    console.log('[AdminPanel] Graph password set:', graphPasswordSet);\n  } catch (error) {\n    console.warn('Failed to load secrets:', error);\n    graphPasswordSet = false;\n  }\n}\n\n/**\n * Load LLM providers status\n */\nasync function loadProviders(): Promise<void> {\n  // Default providers - all supported LLM providers\n  const defaultProviders: LLMProvider[] = [\n    { id: 'openai', name: 'OpenAI', enabled: false, models: ['gpt-4o', 'gpt-4-turbo', 'gpt-4', 'gpt-3.5-turbo'] },\n    { id: 'anthropic', name: 'Anthropic (Claude)', enabled: false, models: ['claude-3-opus', 'claude-3-sonnet', 'claude-3-haiku'] },\n    { id: 'google', name: 'Google AI (Gemini)', enabled: false, models: ['gemini-2.0-flash', 'gemini-pro', 'gemini-pro-vision'] },\n    { id: 'xai', name: 'xAI (Grok)', enabled: false, models: ['grok-2', 'grok-beta'] },\n    { id: 'deepseek', name: 'DeepSeek', enabled: false, models: ['deepseek-chat', 'deepseek-coder'] },\n    { id: 'kimi', name: 'Kimi (Moonshot)', enabled: false, models: ['moonshot-v1-8k', 'moonshot-v1-32k'] },\n    { id: 'minimax', name: 'MiniMax', enabled: false, models: ['abab5.5-chat', 'abab6-chat'] },\n    { id: 'ollama', name: 'Ollama (Local)', enabled: true, models: ['llama2', 'mistral', 'codellama', 'qwen2.5'] },\n  ];\n  \n  try {\n    const response = await http.get<{ providers: unknown }>('/api/llm/providers');\n    const apiProviders = response.data?.providers;\n\n    // Backend may return providers in different shapes (string ids, objects with id/name, or provider registries).\n    const defaultsById = new Map(defaultProviders.map(p => [p.id, p]));\n\n    const normalized: LLMProvider[] = Array.isArray(apiProviders)\n      ? (apiProviders as any[]).map((p) => {\n          if (typeof p === 'string') {\n            return defaultsById.get(p) || { id: p, name: p, enabled: false, models: [] };\n          }\n\n          const id = p?.id || p?.provider || p?.key || p?.name;\n          const base = (id && defaultsById.get(id)) || null;\n\n          return {\n            id: id || base?.id || 'unknown',\n            name: p?.name || base?.name || String(id || 'Unknown'),\n            enabled: Boolean(p?.enabled ?? p?.isConfigured ?? base?.enabled ?? false),\n            models: Array.isArray(p?.models) ? p.models : (base?.models || []),\n            status: p?.status || undefined\n          } as LLMProvider;\n        })\n      : [];\n\n    providers = normalized.length > 0 ? normalized : defaultProviders;\n  } catch (error) {\n    console.warn('Failed to load providers, using defaults:', error);\n    providers = defaultProviders;\n  }\n}\n\n/**\n * Load audit logs\n */\nasync function loadAuditLogs(): Promise<void> {\n  try {\n    const response = await http.get<{ logs: AuditLogEntry[] }>('/api/system/audit?limit=50');\n    auditLogs = Array.isArray(response.data?.logs) ? response.data.logs : [];\n  } catch (error) {\n    console.warn('Failed to load audit logs:', error);\n    auditLogs = [];\n  }\n}\n\n/**\n * Load system prompts\n */\nasync function loadSystemPrompts(): Promise<void> {\n  try {\n    const response = await http.get<{ prompts: SystemPrompt[] }>('/api/system/prompts');\n    systemPrompts = Array.isArray(response.data?.prompts) ? response.data.prompts : [];\n  } catch (error) {\n    console.warn('Failed to load system prompts:', error);\n    // Use default prompts structure\n    systemPrompts = [\n      { id: '1', key: 'document', name: 'Document Extraction', description: 'Extract information from PDFs and text files', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '2', key: 'transcript', name: 'Transcript Extraction', description: 'Extract information from meeting transcripts', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '3', key: 'vision', name: 'Vision/Image Extraction', description: 'Extract information from images and diagrams', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '4', key: 'conversation', name: 'Conversation Extraction', description: 'Extract information from chat conversations', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '5', key: 'email', name: 'Email Extraction', description: 'Extract information from emails', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '6', key: 'summary', name: 'Content Summary', description: 'Generate concise summaries', category: 'analysis', prompt_template: '', uses_ontology: false },\n    ];\n  }\n}\n\n/**\n * Load ontology data (entities and relations) for Admin Ontology tab\n */\nasync function loadOntologyData(): Promise<void> {\n  ontologyLoading = true;\n  try {\n    const [entitiesRes, relationsRes] = await Promise.all([\n      http.get<{ ok: boolean; entityTypes?: OntologyEntityType[] }>('/api/ontology/entities'),\n      http.get<{ ok: boolean; relationTypes?: OntologyRelationType[] }>('/api/ontology/relations'),\n    ]);\n    ontologyEntities = entitiesRes.data?.entityTypes ?? [];\n    ontologyRelations = relationsRes.data?.relationTypes ?? [];\n    ontologyLoaded = true;\n  } catch (error) {\n    console.warn('Failed to load ontology:', error);\n    ontologyEntities = [];\n    ontologyRelations = [];\n  } finally {\n    ontologyLoading = false;\n  }\n}\n\n/**\n * Load graph overview (list + status) for Graph section\n */\nasync function loadGraphOverview(): Promise<void> {\n  graphOverviewLoading = true;\n  try {\n    const [listRes, statusRes] = await Promise.all([\n      http.get<{ ok: boolean; graphs?: GraphListItem[]; error?: string }>('/api/graph/list'),\n      http.get<{ enabled?: boolean; graphName?: string; stats?: { nodes?: number; relationships?: number } }>('/api/graph/status').catch(() => ({ data: {} })),\n    ]);\n    graphList = listRes.data?.graphs ?? [];\n    if (listRes.data?.error) {\n      graphList = [];\n    }\n    graphStatus = statusRes.data ?? null;\n    graphOverviewLoaded = true;\n  } catch (error) {\n    console.warn('Failed to load graph overview:', error);\n    graphList = [];\n    graphStatus = null;\n  } finally {\n    graphOverviewLoading = false;\n  }\n}\n\n/**\n * Save a config value\n */\nasync function saveConfig(key: string, value: unknown, category: string): Promise<void> {\n  try {\n    await http.post('/api/system/config', { key, value, category });\n    toast.success('Configuration saved');\n    await loadSystemConfig();\n  } catch (error) {\n    toast.error('Failed to save configuration');\n  }\n}\n\n/**\n * Test provider connection\n */\nasync function testProvider(providerId: string): Promise<void> {\n  try {\n    const response = await http.post<{ ok: boolean; error?: { message: string }; models?: number }>(`/api/llm/test/${providerId}`);\n    if (response.data.ok) {\n      const models = response.data.models ? ` (${response.data.models} models)` : '';\n      toast.success(`${providerId} connection successful${models}`);\n    } else {\n      toast.error(response.data.error?.message || 'Connection failed');\n    }\n  } catch (error) {\n    toast.error('Connection test failed');\n  }\n}\n\n/**\n * Get config value by key\n */\nfunction getConfigValue(category: string, key: string, defaultValue: unknown = ''): unknown {\n  const configs = systemConfig[category] || [];\n  \n  // For graph category, the config is stored as { key: 'graph', value: { enabled, graphName, provider } }\n  if (category === 'graph') {\n    const graphConfigEntry = configs.find(c => c.key === 'graph');\n    if (graphConfigEntry?.value && typeof graphConfigEntry.value === 'object') {\n      const graphValue = graphConfigEntry.value as Record<string, unknown>;\n      return graphValue[key] ?? defaultValue;\n    }\n  }\n  \n  const config = configs.find(c => c.key === key);\n  return config?.value ?? defaultValue;\n}\n\n/**\n * Render section navigation\n */\nfunction renderNav(): string {\n  const sections = [\n    { id: 'llm', label: 'LLM Providers', icon: 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z' },\n    { id: 'models', label: 'Model Metadata', icon: 'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10' },\n    { id: 'queue', label: 'LLM Queue', icon: 'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15' },\n    { id: 'graph', label: 'Graph', icon: 'M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4' },\n    { id: 'ontology', label: 'Ontology', icon: 'M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z' },\n    { id: 'prompts', label: 'Prompts', icon: 'M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z' },\n    { id: 'processing', label: 'Processing', icon: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z' },\n    { id: 'storage', label: 'Storage', icon: 'M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z' },\n    { id: 'team-analysis', label: 'Team Analysis', icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' },\n    { id: 'billing', label: 'Billing', icon: 'M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z' },\n    { id: 'audit', label: 'Audit Log', icon: 'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01' },\n  ];\n\n  return sections.map(s => `\n    <button class=\"admin-nav-btn ${currentSection === s.id ? 'active' : ''}\" data-section=\"${s.id}\">\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"20\" height=\"20\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"${s.icon}\"/>\n      </svg>\n      <span>${s.label}</span>\n    </button>\n  `).join('');\n}\n\n/**\n * Render LLM Providers section\n */\nfunction renderLLMSection(): string {\n  const taskTypes = ['text', 'vision', 'embeddings'];\n  \n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>LLM Provider Configuration</h3>\n        <p>Configure AI providers for different task types</p>\n      </div>\n\n      <!-- Provider Status -->\n      <div class=\"admin-card\">\n        <h4>Provider Health</h4>\n        <div class=\"provider-grid\">\n          ${providers.map(p => `\n            <div class=\"provider-card ${p.enabled ? 'enabled' : 'disabled'}\">\n              <div class=\"provider-header\">\n                <span class=\"provider-name\">${p.name}</span>\n                <span class=\"provider-status ${p.status || 'unknown'}\">${p.status || 'unknown'}</span>\n              </div>\n              <div class=\"provider-models\">${(p.models || []).slice(0, 3).join(', ')}</div>\n              <div class=\"provider-actions\">\n                <button class=\"btn-sm\" data-test-provider=\"${p.id}\">Test</button>\n                <label class=\"toggle-switch\">\n                  <input type=\"checkbox\" ${p.enabled ? 'checked' : ''} data-toggle-provider=\"${p.id}\">\n                  <span class=\"slider\"></span>\n                </label>\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n\n      <!-- Task Configuration -->\n      <div class=\"admin-card\">\n        <h4>Task-Specific AI Configuration</h4>\n        <p class=\"text-muted\">Configure which provider and model to use for each AI task. These settings apply globally to the platform and are persisted in Supabase.</p>\n        \n        ${taskTypes.map(task => {\n          const taskConfig = getConfigValue('llm', task + '_provider', { provider: '', model: '' }) as { provider: string; model: string };\n          const icons: Record<string, string> = { text: '', vision: '', embeddings: '' };\n          const labels: Record<string, string> = { text: 'Text / Chat', vision: 'Vision / Images', embeddings: 'Embeddings' };\n          const descs: Record<string, string> = { \n            text: 'Document analysis, chat, briefings, Q&A, extraction',\n            vision: 'Image analysis, scanned documents, diagrams, charts',\n            embeddings: 'Semantic search, similarity matching, RAG'\n          };\n          const icon = icons[task] || '';\n          const label = labels[task] || task;\n          const desc = descs[task] || '';\n          const providerOpts = ['openai', 'anthropic', 'google', 'deepseek', 'grok', 'kimi', 'minimax', 'ollama'];\n          const providerNames: Record<string, string> = {\n            openai: 'OpenAI', anthropic: 'Anthropic (Claude)', google: 'Google AI (Gemini)',\n            deepseek: 'DeepSeek', grok: 'xAI (Grok)', kimi: 'Kimi (Moonshot)', \n            minimax: 'MiniMax', ollama: 'Ollama (Local)'\n          };\n          \n          return '<div class=\"task-config-row\" style=\"margin-bottom: 20px; padding: 16px; background: var(--bg-secondary); border-radius: 12px;\" data-task-row=\"' + task + '\">' +\n            '<div class=\"task-label\" style=\"margin-bottom: 12px;\">' +\n              '<span style=\"font-size: 20px; margin-right: 8px;\">' + icon + '</span>' +\n              '<strong style=\"font-size: 16px;\">' + label + '</strong>' +\n              '<span class=\"text-muted\" style=\"display: block; margin-top: 4px; margin-left: 32px; font-size: 13px;\">' + desc + '</span>' +\n            '</div>' +\n            '<div class=\"task-selects\" style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-left: 32px;\">' +\n              '<div>' +\n                '<label style=\"font-size: 12px; color: var(--text-tertiary); margin-bottom: 4px; display: block;\">Provider</label>' +\n                '<select class=\"form-select provider-select\" data-task=\"' + task + '\" data-field=\"provider\" style=\"width: 100%;\">' +\n                  '<option value=\"\"' + (!taskConfig.provider ? ' selected' : '') + '>-- Select Provider --</option>' +\n                  providerOpts.map(p => '<option value=\"' + p + '\"' + (taskConfig.provider === p ? ' selected' : '') + '>' + providerNames[p] + '</option>').join('') +\n                '</select>' +\n              '</div>' +\n              '<div>' +\n                '<label style=\"font-size: 12px; color: var(--text-tertiary); margin-bottom: 4px; display: block;\">Model</label>' +\n                '<select class=\"form-select model-select\" data-task=\"' + task + '\" data-field=\"model\" style=\"width: 100%;\">' +\n                  '<option value=\"\">-- Select Provider First --</option>' +\n                  (taskConfig.model ? '<option value=\"' + taskConfig.model + '\" selected>' + taskConfig.model + '</option>' : '') +\n                '</select>' +\n                '<span class=\"model-loading\" data-task=\"' + task + '\" style=\"display: none; font-size: 11px; color: var(--primary); margin-top: 4px;\">Loading models...</span>' +\n              '</div>' +\n            '</div>' +\n            '<div class=\"model-status\" data-task=\"' + task + '\" style=\"margin-top: 8px; margin-left: 32px; font-size: 11px; color: var(--text-tertiary);\"></div>' +\n          '</div>';\n        }).join('')}\n        \n        <div style=\"display: flex; gap: 12px; align-items: center; margin-top: 20px;\">\n          <button class=\"btn-primary\" id=\"save-llm-config\">Save LLM Configuration</button>\n          <span class=\"text-muted\" style=\"font-size: 12px;\"> Changes apply immediately to all AI processing</span>\n        </div>\n      </div>\n\n      <!-- API Keys - LLM Providers -->\n      <div class=\"admin-card\">\n        <h4>LLM API Keys</h4>\n        <p class=\"text-muted\">System-level API keys (stored encrypted in Supabase)</p>\n        \n        <div class=\"api-keys-grid\" id=\"api-keys-container\">\n          <div class=\"form-group\" data-secret-name=\"OPENAI_API_KEY\">\n            <label>OpenAI <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"openai-key\" name=\"llm_key_openai_${Date.now()}\" placeholder=\"sk-proj-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"openai-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"CLAUDE_API_KEY\">\n            <label>Anthropic (Claude) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"anthropic-key\" name=\"llm_key_claude_${Date.now()}\" placeholder=\"sk-ant-api03-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"anthropic-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"GOOGLE_API_KEY\">\n            <label>Google AI (Gemini) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"google-key\" name=\"llm_key_google_${Date.now()}\" placeholder=\"AIza...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"google-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"XAI_API_KEY\">\n            <label>xAI (Grok) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"xai-key\" name=\"llm_key_xai_${Date.now()}\" placeholder=\"xai-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"xai-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"DEEPSEEK_API_KEY\">\n            <label>DeepSeek <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"deepseek-key\" name=\"llm_key_deepseek_${Date.now()}\" placeholder=\"sk-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"deepseek-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"KIMI_API_KEY\">\n            <label>Kimi (Moonshot) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"kimi-key\" name=\"llm_key_kimi_${Date.now()}\" placeholder=\"sk-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"kimi-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"MINIMAX_API_KEY\">\n            <label>MiniMax <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"minimax-key\" name=\"llm_key_minimax_${Date.now()}\" placeholder=\"MINIMAX-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"minimax-key\">Show</button>\n            </div>\n          </div>\n        </div>\n        \n        <div id=\"api-keys-loading\" style=\"text-align: center; padding: 10px; color: var(--text-tertiary);\">Loading configured keys...</div>\n        <button class=\"btn-primary mt-4\" id=\"save-api-keys\">Save LLM API Keys</button>\n      </div>\n\n      <!-- Service API Keys -->\n      <div class=\"admin-card\">\n        <h4>Service API Keys</h4>\n        <p class=\"text-muted\">Keys for email, notifications and other services</p>\n        \n        <div class=\"form-group\" data-secret-name=\"RESEND_API_KEY\">\n          <label>Resend API Key (Email Service) <span class=\"key-status\" style=\"font-size: 11px; margin-left: 8px;\"></span></label>\n          <div class=\"input-group\">\n            <input type=\"text\" id=\"resend-key\" name=\"service_key_resend_${Date.now()}\" placeholder=\"re_...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n            <button class=\"btn-icon\" data-toggle-visibility=\"resend-key\">Show</button>\n          </div>\n        </div>\n        \n        <button class=\"btn-primary mt-4\" id=\"save-service-keys\">Save Service Keys</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Graph section (Supabase Graph)\n */\nfunction renderGraphSection(): string {\n  const graphConfig = {\n    enabled: getConfigValue('graph', 'enabled', false) as boolean,\n    graphName: getConfigValue('graph', 'graphName', 'godmode') as string,\n  };\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Graph Database Configuration</h3>\n        <p>Supabase Graph for knowledge graph and GraphRAG</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <div class=\"form-group\">\n          <label class=\"toggle-label\">\n            <input type=\"checkbox\" id=\"graph-enabled\" ${graphConfig.enabled ? 'checked' : ''}>\n            <span>Enable Graph Database</span>\n          </label>\n        </div>\n\n        <div class=\"form-group\" style=\"background: var(--bg-tertiary); padding: 12px; border-radius: 8px; margin: 16px 0;\">\n          <p style=\"margin: 0; color: var(--text-secondary);\">\n            <strong>Provider:</strong> Supabase Graph (PostgreSQL-based)\n          </p>\n          <p style=\"margin: 8px 0 0; font-size: 13px; color: var(--text-muted);\">\n            Uses your existing Supabase connection. No additional configuration needed.\n          </p>\n        </div>\n\n        <div class=\"form-group\">\n          <label>Graph Name</label>\n          <input type=\"text\" id=\"graph-name\" value=\"${graphConfig.graphName}\" class=\"form-input\" placeholder=\"godmode\">\n        </div>\n\n        <div class=\"btn-group mt-4\">\n          <button class=\"btn-primary\" id=\"save-graph-config\">Save Configuration</button>\n          <button class=\"btn-secondary\" id=\"test-graph-connection\">Test Connection</button>\n        </div>\n      </div>\n\n      <div class=\"admin-card\" id=\"graph-overview-card\">\n        <h4>Graph overview</h4>\n        <p class=\"text-muted\">Current graph status. Enable and save configuration above first.</p>\n        <div id=\"graph-overview-content\">\n          ${graphOverviewLoading ? '<p class=\"text-muted\">Loading...</p>' : !graphOverviewLoaded ? '<button class=\"btn-secondary\" id=\"load-graph-overview\">Load overview</button>' : (graphList.length === 0 && !graphStatus?.enabled ? '<p class=\"text-muted\">Graph not enabled or not connected. Enable and save configuration.</p><button class=\"btn-secondary mt-4\" id=\"refresh-graph-overview\">Refresh</button>' : `\n            ${graphStatus?.enabled && (graphStatus.stats != null || graphStatus.graphName) ? `\n              <div class=\"graph-status-row\" style=\"margin-bottom: 12px;\">\n                <strong>Current graph:</strong> ${graphStatus.graphName ?? ''}\n                ${graphStatus.stats?.nodes !== undefined ? `  Nodes: ${graphStatus.stats.nodes}` : ''}\n                ${graphStatus.stats?.relationships !== undefined ? `  Edges: ${graphStatus.stats.relationships}` : ''}\n              </div>\n            ` : ''}\n            ${graphList.length > 0 ? `\n              <table class=\"admin-table\" style=\"width: 100%; margin-top: 8px;\">\n                <thead><tr><th>Graph name</th><th>Project</th></tr></thead>\n                <tbody>\n                  ${graphList.map(g => `<tr><td><code>${g.graphName}</code></td><td>${g.projectName ?? ''}</td></tr>`).join('')}\n                </tbody>\n              </table>\n            ` : ''}\n            <div class=\"btn-group mt-4\">\n              <button class=\"btn-secondary\" id=\"open-graph-tab\">Open in Graph tab</button>\n              <button class=\"btn-secondary\" id=\"refresh-graph-overview\">Refresh</button>\n            </div>\n          `)}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Ontology section\n */\nfunction renderOntologySection(): string {\n  if (ontologyLoading || !ontologyLoaded) {\n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Ontology</h3>\n        <p>Entity types and relation types used by extraction and GraphRAG</p>\n      </div>\n      <div class=\"admin-card\">\n        <p class=\"text-muted\">${ontologyLoading ? 'Loading ontology...' : 'Click Load to fetch entity and relation types from the API.'}</p>\n        ${!ontologyLoading ? '<button class=\"btn-primary\" id=\"load-ontology\">Load ontology</button>' : ''}\n      </div>\n    </div>\n    `;\n  }\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Ontology</h3>\n        <p>Entity types and relation types used by extraction and GraphRAG</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Entity types</h4>\n        <p class=\"text-muted\">Types of entities that can be extracted and stored in the graph.</p>\n        ${ontologyEntities.length === 0 ? '<p class=\"text-muted\">No entity types returned.</p>' : `\n          <ul class=\"ontology-list\">\n            ${ontologyEntities.map(e => `\n              <li><code>${e.name}</code>\n                ${e.sharedEntity ? ' <span class=\"badge badge-info\">shared</span>' : ''}\n                ${e.properties?.length ? `  properties: ${e.properties.join(', ')}` : ''}\n              </li>\n            `).join('')}\n          </ul>\n        `}\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Relation types</h4>\n        <p class=\"text-muted\">Allowed relationships between entity types.</p>\n        ${ontologyRelations.length === 0 ? '<p class=\"text-muted\">No relation types returned.</p>' : `\n          <ul class=\"ontology-list\">\n            ${ontologyRelations.map(r => `\n              <li><code>${r.name}</code>\n                ${(r as { sourceType?: string; targetType?: string }).sourceType ? ` (${(r as { sourceType?: string; targetType?: string }).sourceType}  ${(r as { sourceType?: string; targetType?: string }).targetType})` : ''}\n              </li>\n            `).join('')}\n          </ul>\n        `}\n      </div>\n\n      <div class=\"btn-group mt-4\">\n        <button class=\"btn-secondary\" id=\"reload-ontology\">Reload ontology</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Prompts section\n */\nfunction renderPromptsSection(): string {\n  // Group prompts by category\n  const extractionPrompts = systemPrompts.filter(p => p.category === 'extraction');\n  const analysisPrompts = systemPrompts.filter(p => p.category === 'analysis');\n  const templatePrompts = systemPrompts.filter(p => p.category === 'template');\n\n  const renderPromptCard = (p: SystemPrompt) => `\n    <div class=\"admin-card prompt-card\" data-prompt-id=\"${p.id}\">\n      <div class=\"prompt-header\">\n        <div>\n          <h4>${p.name}</h4>\n          <p class=\"text-muted\">${p.description}</p>\n        </div>\n        <div class=\"prompt-badges\">\n          ${p.uses_ontology ? '<span class=\"badge badge-info\">Ontology-Aware</span>' : ''}\n          <span class=\"badge badge-secondary\">${p.key}</span>\n        </div>\n      </div>\n      <textarea class=\"form-textarea prompt-editor\" data-prompt-key=\"${p.key}\" rows=\"12\" \n                placeholder=\"Enter prompt template...\n\nAvailable placeholders:\n{{CONTENT}} - The document/transcript content\n{{FILENAME}} - The file/document name\n{{TODAY}} - Current date\n{{ONTOLOGY_SECTION}} - Ontology context (if uses_ontology=true)\n{{ROLE_CONTEXT}} - User role context\n{{PROJECT_CONTEXT}} - Project context\">${p.prompt_template || ''}</textarea>\n      <div class=\"prompt-actions\">\n        <button class=\"btn-sm btn-secondary\" data-view-versions=\"${p.key}\">\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n            <polyline points=\"12,6 12,12 16,14\"/>\n          </svg>\n          Version History\n        </button>\n        <span class=\"prompt-status\" id=\"status-${p.key}\"></span>\n      </div>\n      <div class=\"version-history hidden\" id=\"versions-${p.key}\">\n        <div class=\"version-list\"></div>\n      </div>\n    </div>\n  `;\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>AI Prompts Configuration</h3>\n        <p>Customize ontology-aware prompts for AI extraction. All prompts support template variables.</p>\n      </div>\n\n      <div class=\"prompt-info admin-card\">\n        <h4>Template Variables</h4>\n        <div class=\"variables-grid\">\n          <code>{{CONTENT}}</code> <span>Document/transcript content</span>\n          <code>{{FILENAME}}</code> <span>File or document name</span>\n          <code>{{TODAY}}</code> <span>Current date (YYYY-MM-DD)</span>\n          <code>{{ONTOLOGY_SECTION}}</code> <span>Injected ontology context</span>\n          <code>{{ROLE_CONTEXT}}</code> <span>User role context line</span>\n          <code>{{PROJECT_CONTEXT}}</code> <span>Project context line</span>\n          <code>{{CONTENT_LENGTH}}</code> <span>Content length in characters</span>\n        </div>\n      </div>\n\n      <h4 class=\"section-subtitle\">Extraction Prompts</h4>\n      ${extractionPrompts.length > 0 ? extractionPrompts.map(renderPromptCard).join('') : '<p class=\"text-muted\">Run migration 031 to create default prompts</p>'}\n\n      ${analysisPrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Analysis Prompts</h4>\n        ${analysisPrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      ${templatePrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Template Sections</h4>\n        ${templatePrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      <div class=\"btn-group mt-4\">\n        <button class=\"btn-primary\" id=\"save-prompts\">Save All Prompts</button>\n        <button class=\"btn-secondary\" id=\"reload-prompts\">Reload from Database</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Storage section\n */\nfunction renderStorageSection(): string {\n  const rootFolderId = (getConfigValue('storage', 'google_drive_rootFolderId', '') as string) || '';\n  const enabled = !!getConfigValue('storage', 'google_drive_enabled', false);\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Storage</h3>\n        <p>Configure platform-level storage backends</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Google Drive (Platform Storage)</h4>\n        <p class=\"text-muted\">Configured once by superadmin. Projects will create their own folder structure inside the root folder.</p>\n\n        <div class=\"form-group\">\n          <label style=\"display:block; margin-bottom: 8px;\">Enable Google Drive storage</label>\n          <button type=\"button\" class=\"btn ${enabled ? 'btn-primary' : 'btn-secondary'}\" id=\"gdrive-platform-enabled-btn\" data-enabled=\"${enabled ? '1' : '0'}\">\n            ${enabled ? 'Enabled' : 'Disabled'}\n          </button>\n          <div class=\"text-muted\" style=\"font-size: 12px; margin-top: 6px;\">\n            Click to toggle. Remember to press <b>Save</b> to persist.\n          </div>\n        </div>\n\n        <div class=\"form-group\">\n          <label>Root Folder ID</label>\n          <input type=\"text\" id=\"gdrive-platform-root\" class=\"form-input\" placeholder=\"e.g. 1AbCDEFgHijK...\" value=\"${escapeHtml(rootFolderId)}\">\n          <div class=\"text-muted\" style=\"font-size: 12px; margin-top: 6px;\">\n            Share this folder with the Service Account email (Editor).\n          </div>\n        </div>\n\n        <div class=\"form-group\">\n          <label>Service Account JSON</label>\n          <div id=\"gdrive-platform-cred-status\" class=\"text-muted\" style=\"font-size: 12px; margin-bottom: 8px;\">Loading credential status...</div>\n          <input type=\"file\" id=\"gdrive-platform-json-file\" accept=\"application/json,.json\" class=\"form-input\">\n          <textarea id=\"gdrive-platform-json\" class=\"form-input\" placeholder=\"{ ... }\" style=\"min-height: 140px; margin-top: 8px;\"></textarea>\n          <div class=\"text-muted\" style=\"font-size: 12px; margin-top: 6px;\">\n            This credential is stored securely in Supabase as a system secret. It will not be shown again after saving.\n          </div>\n        </div>\n\n        <div style=\"display:flex; gap: 10px; flex-wrap: wrap;\">\n          <button class=\"btn-primary\" id=\"gdrive-platform-save\">Save</button>\n          <button class=\"btn-secondary\" id=\"gdrive-platform-test\">Test</button>\n          <button class=\"btn-secondary\" id=\"gdrive-platform-bootstrap-all\">Bootstrap all projects</button>\n        </div>\n\n        <div id=\"gdrive-platform-status\" style=\"margin-top: 16px; font-size: 13px; color: var(--text-secondary);\"></div>\n        <div id=\"gdrive-platform-projects\" style=\"margin-top: 12px;\"></div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Processing section\n */\nfunction renderProcessingSection(): string {\n  const processing = {\n    chunkSize: getConfigValue('processing', 'chunk_size', 1000) as number,\n    chunkOverlap: getConfigValue('processing', 'chunk_overlap', 200) as number,\n    maxTokens: getConfigValue('processing', 'max_tokens', 4096) as number,\n    temperature: getConfigValue('processing', 'temperature', 0.7) as number,\n    autoProcess: getConfigValue('processing', 'auto_process', true) as boolean,\n    parallelJobs: getConfigValue('processing', 'parallel_jobs', 3) as number,\n  };\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Document Processing Settings</h3>\n        <p>Configure how documents are processed and analyzed</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Chunking Settings</h4>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label>Chunk Size (tokens)</label>\n            <input type=\"number\" id=\"proc-chunk-size\" value=\"${processing.chunkSize}\" class=\"form-input\" min=\"100\" max=\"8000\">\n          </div>\n          <div class=\"form-group\">\n            <label>Chunk Overlap (tokens)</label>\n            <input type=\"number\" id=\"proc-chunk-overlap\" value=\"${processing.chunkOverlap}\" class=\"form-input\" min=\"0\" max=\"1000\">\n          </div>\n        </div>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Generation Settings</h4>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label>Max Tokens</label>\n            <input type=\"number\" id=\"proc-max-tokens\" value=\"${processing.maxTokens}\" class=\"form-input\" min=\"256\" max=\"32000\">\n          </div>\n          <div class=\"form-group\">\n            <label>Temperature</label>\n            <input type=\"number\" id=\"proc-temperature\" value=\"${processing.temperature}\" class=\"form-input\" min=\"0\" max=\"2\" step=\"0.1\">\n          </div>\n        </div>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Job Settings</h4>\n        \n        <div class=\"form-group\">\n          <label class=\"toggle-label\">\n            <input type=\"checkbox\" id=\"proc-auto-process\" ${processing.autoProcess ? 'checked' : ''}>\n            <span>Auto-process uploaded documents</span>\n          </label>\n        </div>\n        \n        <div class=\"form-group\">\n          <label>Parallel Jobs</label>\n          <input type=\"number\" id=\"proc-parallel-jobs\" value=\"${processing.parallelJobs}\" class=\"form-input\" min=\"1\" max=\"10\">\n        </div>\n      </div>\n\n      <button class=\"btn-primary\" id=\"save-processing\">Save Processing Settings</button>\n    </div>\n  `;\n}\n\n/**\n * Load Team Analysis settings for current project\n */\nasync function loadTeamAnalysisSettings(): Promise<void> {\n  const state = appStore.getState();\n  const projectId = state.currentProject?.id;\n  \n  if (!projectId) {\n    teamAnalysisSettings = { enabled: true, access: 'admin_only' };\n    teamAnalysisLoaded = true;\n    return;\n  }\n  \n  teamAnalysisLoading = true;\n  \n  try {\n    const response = await http.get<{ ok: boolean; config: { enabled: boolean; access: string } }>('/api/team-analysis/config');\n    teamAnalysisSettings = {\n      enabled: response?.config?.enabled ?? true,\n      access: (response?.config?.access as 'admin_only' | 'all') ?? 'admin_only'\n    };\n    teamAnalysisLoaded = true;\n  } catch (error) {\n    console.error('[AdminPanel] Error loading team analysis settings:', error);\n    teamAnalysisSettings = { enabled: true, access: 'admin_only' };\n    teamAnalysisLoaded = true;\n  } finally {\n    teamAnalysisLoading = false;\n  }\n}\n\n/**\n * Save Team Analysis settings\n */\nasync function saveTeamAnalysisSettings(enabled: boolean, access: string): Promise<void> {\n  const state = appStore.getState();\n  const projectId = state.currentProject?.id;\n  \n  if (!projectId) {\n    toast.error('No project selected');\n    return;\n  }\n  \n  try {\n    await http.put('/api/team-analysis/config', {\n      enabled,\n      access\n    });\n    \n    teamAnalysisSettings = { enabled, access: access as 'admin_only' | 'all' };\n    toast.success('Team Analysis settings saved');\n  } catch (error) {\n    console.error('[AdminPanel] Error saving team analysis settings:', error);\n    toast.error('Failed to save settings');\n  }\n}\n\n/**\n * Render Team Analysis section\n */\nfunction renderTeamAnalysisSection(): string {\n  const state = appStore.getState();\n  const projectId = state.currentProject?.id;\n  const projectName = state.currentProject?.name || 'Unknown';\n  \n  if (!projectId) {\n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Team Analysis Settings</h3>\n        <p>Configure access control for behavioral analysis features</p>\n      </div>\n      \n      <div class=\"admin-card\">\n        <div style=\"text-align: center; padding: 40px; color: var(--text-tertiary);\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"48\" height=\"48\" style=\"margin: 0 auto 16px; opacity: 0.5;\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n          </svg>\n          <p>Please select a project to configure Team Analysis settings.</p>\n        </div>\n      </div>\n    </div>\n    `;\n  }\n  \n  if (teamAnalysisLoading || !teamAnalysisLoaded) {\n    // Trigger load and show loading state\n    if (!teamAnalysisLoading && !teamAnalysisLoaded) {\n      loadTeamAnalysisSettings();\n    }\n    \n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Team Analysis Settings</h3>\n        <p>Configure access control for behavioral analysis features</p>\n      </div>\n      \n      <div class=\"admin-card\">\n        <div style=\"text-align: center; padding: 40px; color: var(--text-tertiary);\">\n          <div class=\"loading-spinner\" style=\"margin: 0 auto 16px;\"></div>\n          <p>Loading settings...</p>\n        </div>\n      </div>\n    </div>\n    `;\n  }\n  \n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Team Analysis Settings</h3>\n        <p>Configure access control for behavioral analysis features</p>\n      </div>\n\n      <!-- Current Project Info -->\n      <div class=\"admin-card\">\n        <h4>Current Project</h4>\n        <div style=\"display: flex; align-items: center; gap: 12px; margin-top: 12px;\">\n          <div style=\"width: 40px; height: 40px; background: var(--primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;\">\n            ${projectName.charAt(0).toUpperCase()}\n          </div>\n          <div>\n            <div style=\"font-weight: 500;\">${projectName}</div>\n            <div style=\"font-size: 12px; color: var(--text-tertiary);\">ID: ${projectId}</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Feature Toggle -->\n      <div class=\"admin-card\">\n        <h4>Feature Status</h4>\n        <p class=\"text-muted\" style=\"margin-bottom: 16px;\">Enable or disable Team Analysis for this project</p>\n        \n        <div class=\"form-group\">\n          <label class=\"toggle-label\" style=\"display: flex; align-items: center; gap: 12px; cursor: pointer;\">\n            <input type=\"checkbox\" id=\"team-analysis-enabled\" ${teamAnalysisSettings.enabled ? 'checked' : ''} style=\"width: 20px; height: 20px;\">\n            <div>\n              <span style=\"font-weight: 500;\">Enable Team Analysis</span>\n              <p style=\"font-size: 12px; color: var(--text-tertiary); margin: 4px 0 0 0;\">When enabled, users with access can analyze team member behavior from meeting transcripts</p>\n            </div>\n          </label>\n        </div>\n      </div>\n\n      <!-- Access Control -->\n      <div class=\"admin-card\">\n        <h4>Access Control</h4>\n        <p class=\"text-muted\" style=\"margin-bottom: 16px;\">Define who can access Team Analysis features</p>\n        \n        <div class=\"form-group\">\n          <label style=\"font-weight: 500; display: block; margin-bottom: 8px;\">Access Level</label>\n          <select id=\"team-analysis-access\" class=\"form-input\" style=\"width: 100%; max-width: 400px;\">\n            <option value=\"admin_only\" ${teamAnalysisSettings.access === 'admin_only' ? 'selected' : ''}>Admins Only - Only project owner and admins can access</option>\n            <option value=\"all\" ${teamAnalysisSettings.access === 'all' ? 'selected' : ''}>All Members - All project members can access</option>\n          </select>\n          <p style=\"font-size: 12px; color: var(--text-tertiary); margin-top: 8px;\">\n            <strong>Admins Only:</strong> Restricts access to sensitive behavioral analysis to project owner and administrators.<br>\n            <strong>All Members:</strong> Allows all project collaborators to view and run team analysis.\n          </p>\n        </div>\n      </div>\n\n      <!-- Analysis Scope Info -->\n      <div class=\"admin-card\">\n        <h4>How It Works</h4>\n        <div style=\"display: grid; gap: 16px; margin-top: 12px;\">\n          <div style=\"display: flex; gap: 12px; align-items: start;\">\n            <div style=\"min-width: 32px; height: 32px; background: var(--info); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;\">1</div>\n            <div>\n              <div style=\"font-weight: 500;\">Contact-Based Analysis</div>\n              <div style=\"font-size: 13px; color: var(--text-secondary);\">Analysis is performed on contacts defined in the project. Contacts can have aliases to match different name variations in transcripts.</div>\n            </div>\n          </div>\n          <div style=\"display: flex; gap: 12px; align-items: start;\">\n            <div style=\"min-width: 32px; height: 32px; background: var(--info); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;\">2</div>\n            <div>\n              <div style=\"font-weight: 500;\">Incremental Learning</div>\n              <div style=\"font-size: 13px; color: var(--text-secondary);\">Profiles are refined iteratively as more transcripts are processed, building evidence over time.</div>\n            </div>\n          </div>\n          <div style=\"display: flex; gap: 12px; align-items: start;\">\n            <div style=\"min-width: 32px; height: 32px; background: var(--info); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;\">3</div>\n            <div>\n              <div style=\"font-weight: 500;\">Privacy Consideration</div>\n              <div style=\"font-size: 13px; color: var(--text-secondary);\">Behavioral analysis may contain sensitive insights. Configure access carefully.</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <button class=\"btn-primary\" id=\"save-team-analysis\" style=\"margin-top: 8px;\">Save Team Analysis Settings</button>\n    </div>\n  `;\n}\n\n/**\n * Render LLM Queue section\n */\nfunction renderQueueSection(): string {\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>LLM Processing Queue</h3>\n        <p>Monitor and control AI request processing - All requests are persisted in database</p>\n      </div>\n\n      <!-- Queue Status -->\n      <div class=\"admin-card\" id=\"queue-status-card\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n          <h4>Queue Status</h4>\n          <div style=\"display: flex; gap: 8px;\">\n            <span id=\"db-status-badge\" class=\"badge\" style=\"font-size: 11px;\">DB: Checking...</span>\n            <button class=\"btn-sm\" id=\"refresh-queue-status\"> Refresh</button>\n          </div>\n        </div>\n        \n        <div id=\"queue-status-content\" style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\n          Loading queue status...\n        </div>\n      </div>\n\n      <!-- Queue Controls -->\n      <div class=\"admin-card\">\n        <h4>Queue Controls</h4>\n        <p class=\"text-muted\">Control queue processing behavior</p>\n        \n        <div style=\"display: flex; gap: 12px; flex-wrap: wrap; margin-top: 16px;\">\n          <button class=\"btn-primary\" id=\"queue-pause-btn\"> Pause Queue</button>\n          <button class=\"btn-primary\" id=\"queue-resume-btn\"> Resume Queue</button>\n          <button class=\"btn-secondary\" id=\"queue-clear-btn\" style=\"background: var(--warning); color: white;\"> Clear Queue</button>\n        </div>\n      </div>\n\n      <!-- Statistics -->\n      <div class=\"admin-card\">\n        <h4>Queue Statistics (Today)</h4>\n        <div id=\"queue-stats-content\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-top: 16px;\">\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--primary);\" id=\"stat-pending\">-</div>\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Pending</div>\n          </div>\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--info);\" id=\"stat-processing\">-</div>\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Processing</div>\n          </div>\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--success);\" id=\"stat-success\">-</div>\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Completed</div>\n          </div>\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--error);\" id=\"stat-failed\">-</div>\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Failed</div>\n          </div>\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--warning);\" id=\"stat-retry\">-</div>\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Retry Pending</div>\n          </div>\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\n            <div style=\"font-size: 20px; font-weight: bold;\" id=\"stat-avg-time\">-</div>\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Avg Time (ms)</div>\n          </div>\n          <div class=\"stat-box\" style=\"background: var(--bg-secondary); padding: 12px; border-radius: 8px; text-align: center;\">\n            <div style=\"font-size: 20px; font-weight: bold; color: var(--success);\" id=\"stat-cost\">$-</div>\n            <div style=\"font-size: 11px; color: var(--text-tertiary);\">Cost Today</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Queue Items -->\n      <div class=\"admin-card\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n          <h4>Pending Items</h4>\n          <span id=\"pending-count\" class=\"text-muted\">0 items</span>\n        </div>\n        \n        <div id=\"queue-items-content\" style=\"max-height: 300px; overflow-y: auto;\">\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\n            No items in queue\n          </div>\n        </div>\n      </div>\n\n      <!-- Failed Items (Retryable) -->\n      <div class=\"admin-card\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n          <h4>Failed Items</h4>\n          <div style=\"display: flex; gap: 8px;\">\n            <button class=\"btn-sm btn-primary\" id=\"retry-all-btn\"> Retry All</button>\n            <button class=\"btn-sm\" id=\"refresh-failed-btn\"> Refresh</button>\n          </div>\n        </div>\n        \n        <div id=\"failed-items-content\" style=\"max-height: 300px; overflow-y: auto;\">\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\n            No failed items\n          </div>\n        </div>\n      </div>\n\n      <!-- Recent History -->\n      <div class=\"admin-card\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n          <h4>Recent Processing History</h4>\n          <button class=\"btn-sm\" id=\"refresh-queue-history\"> Refresh</button>\n        </div>\n        \n        <div id=\"queue-history-content\" style=\"max-height: 400px; overflow-y: auto;\">\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\n            Loading history...\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Load billing data\n */\nasync function loadBillingData(): Promise<void> {\n  // Guard is now in bindSectionEvents, so we just proceed with loading\n  // billingLoading is already set to true by caller\n  console.log('[AdminPanel] loadBillingData() starting...');\n  \n  try {\n    // Load all data in parallel\n    console.log('[AdminPanel] Calling billing API...');\n    const [projects, config, tiersData, exchangeRate] = await Promise.all([\n      billingService.getAllProjectsBilling(),\n      billingService.getGlobalPricingConfig(),\n      billingService.getGlobalPricingTiers(),\n      billingService.getExchangeRateConfig()\n    ]);\n    \n    console.log('[AdminPanel] API responses:', { projects, config, tiersData, exchangeRate });\n    \n    billingProjects = projects;\n    globalPricingConfig = config;\n    globalPricingTiers = tiersData.tiers;\n    exchangeRateConfig = exchangeRate;\n    billingLoaded = true;\n    \n    console.log('[AdminPanel] Loaded billing data:', { \n      projects: projects.length, \n      config: !!config,\n      tiers: tiersData.tiers.length,\n      exchangeRate: exchangeRate?.currentRate\n    });\n  } catch (error) {\n    console.error('[AdminPanel] Error loading billing data:', error);\n    toast.error('Failed to load billing data');\n  } finally {\n    billingLoading = false;\n  }\n}\n\n/**\n * Render Billing section\n */\nfunction renderBillingSection(): string {\n  // Show loading state\n  if (billingLoading && !billingLoaded) {\n    return `\n      <div class=\"admin-section\">\n        <div class=\"admin-section-header\">\n          <h3>Billing & Cost Control</h3>\n          <p>Manage project balances, pricing, and cost limits</p>\n        </div>\n        <div class=\"admin-card\" style=\"text-align: center; padding: 40px;\">\n          <div class=\"spinner\"></div>\n          <p style=\"margin-top: 16px;\">Loading billing data...</p>\n        </div>\n      </div>\n    `;\n  }\n  \n  // Format tier display\n  const tiersDisplay = globalPricingTiers.length > 0 \n    ? globalPricingTiers.map((tier, i) => {\n        const prevLimit = i > 0 ? globalPricingTiers[i - 1].token_limit : 0;\n        const fromStr = formatTokens(prevLimit || 0);\n        const toStr = tier.token_limit ? formatTokens(tier.token_limit) : '';\n        return `${tier.name || `Tier ${i + 1}`}: ${fromStr}-${toStr} tokens  +${tier.markup_percent}%`;\n      }).join('<br>')\n    : 'No tiers configured (using fixed markup)';\n  \n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Billing & Cost Control</h3>\n        <p>Manage project balances, pricing, and cost limits</p>\n      </div>\n\n      <!-- Exchange Rate Configuration -->\n      <div class=\"admin-card\">\n        <h4 style=\"margin-bottom: 16px;\">Exchange Rate (USD to EUR)</h4>\n        \n        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 16px;\">\n          <div>\n            <div class=\"form-group\">\n              <label style=\"display: flex; align-items: center; gap: 8px;\">\n                <input type=\"checkbox\" id=\"exchange-rate-auto\" ${exchangeRateConfig?.auto !== false ? 'checked' : ''}>\n                <span>Automatic rate from API</span>\n              </label>\n              <small class=\"text-muted\">Fetches live USD/EUR rate daily</small>\n            </div>\n            \n            <div class=\"form-group\" id=\"manual-rate-group\" style=\"${exchangeRateConfig?.auto !== false ? 'display: none;' : ''}\">\n              <label>Manual Rate</label>\n              <input type=\"number\" id=\"exchange-rate-manual\" class=\"form-input\" \n                     value=\"${exchangeRateConfig?.manualRate ?? 0.92}\" min=\"0.01\" max=\"2\" step=\"0.001\">\n            </div>\n          </div>\n          \n          <div style=\"background: var(--bg-secondary); padding: 16px; border-radius: 8px;\">\n            <div style=\"font-size: 12px; color: var(--text-tertiary); margin-bottom: 8px;\">Current Rate</div>\n            <div style=\"font-size: 28px; font-weight: 600; color: var(--text-primary);\" id=\"current-rate-display\">\n              ${exchangeRateConfig?.currentRate?.toFixed(4) ?? '0.9200'}\n            </div>\n            <div style=\"font-size: 12px; color: var(--text-tertiary); margin-top: 4px;\">\n              Source: <span id=\"rate-source\">${exchangeRateConfig?.source ?? 'default'}</span>\n              ${exchangeRateConfig?.lastUpdated ? `<br>Updated: ${new Date(exchangeRateConfig.lastUpdated).toLocaleString()}` : ''}\n            </div>\n            <button class=\"btn-sm btn-secondary\" id=\"refresh-rate-btn\" style=\"margin-top: 12px;\" ${exchangeRateConfig?.auto === false ? 'disabled' : ''}>\n              Refresh Rate\n            </button>\n          </div>\n        </div>\n        \n        <div style=\"display: flex; justify-content: flex-end; gap: 8px;\">\n          <button class=\"btn-primary\" id=\"save-exchange-rate-btn\">Save Exchange Rate Settings</button>\n        </div>\n      </div>\n\n      <!-- Global Pricing Configuration -->\n      <div class=\"admin-card\">\n        <h4 style=\"margin-bottom: 16px;\">Global Pricing Configuration</h4>\n        \n        <div class=\"admin-form-grid\" style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px;\">\n          <div class=\"form-group\">\n            <label>Fixed Markup (%)</label>\n            <input type=\"number\" id=\"global-markup-percent\" class=\"form-input\" \n                   value=\"${globalPricingConfig?.fixed_markup_percent ?? 0}\" min=\"0\" max=\"500\" step=\"0.1\">\n            <small class=\"text-muted\">Applied when no tier matches</small>\n          </div>\n          \n          <div class=\"form-group\">\n            <label>Period Type</label>\n            <select id=\"global-period-type\" class=\"form-input\">\n              <option value=\"monthly\" ${globalPricingConfig?.period_type === 'monthly' ? 'selected' : ''}>Monthly</option>\n              <option value=\"weekly\" ${globalPricingConfig?.period_type === 'weekly' ? 'selected' : ''}>Weekly</option>\n            </select>\n            <small class=\"text-muted\">Tier reset period</small>\n          </div>\n        </div>\n        \n        <div style=\"display: flex; justify-content: flex-end; gap: 8px;\">\n          <button class=\"btn-primary\" id=\"save-global-pricing-btn\">Save Global Pricing</button>\n        </div>\n      </div>\n      \n      <!-- Pricing Tiers -->\n      <div class=\"admin-card\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n          <div>\n            <h4>Pricing Tiers (Volume Discount)</h4>\n            <p class=\"text-muted\" style=\"font-size: 13px; margin-top: 4px;\">\n              Lower markup as projects consume more tokens per period\n            </p>\n          </div>\n          <button class=\"btn-sm btn-primary\" id=\"add-tier-btn\">+ Add Tier</button>\n        </div>\n        \n        <div id=\"pricing-tiers-list\">\n          ${globalPricingTiers.length > 0 ? globalPricingTiers.map((tier, i) => `\n            <div class=\"tier-row\" data-tier-index=\"${i}\" style=\"display: grid; grid-template-columns: 150px 150px 120px auto; gap: 12px; align-items: center; padding: 12px; background: var(--bg-secondary); border-radius: 6px; margin-bottom: 8px;\">\n              <input type=\"text\" class=\"form-input tier-name\" placeholder=\"Tier Name\" value=\"${tier.name || `Tier ${i + 1}`}\">\n              <input type=\"number\" class=\"form-input tier-limit\" placeholder=\"Token Limit\" value=\"${tier.token_limit || ''}\" min=\"0\" ${tier.token_limit === null ? 'disabled' : ''}>\n              <div style=\"display: flex; align-items: center; gap: 4px;\">\n                <input type=\"number\" class=\"form-input tier-markup\" placeholder=\"Markup %\" value=\"${tier.markup_percent}\" min=\"0\" step=\"0.1\" style=\"width: 80px;\">\n                <span>%</span>\n              </div>\n              <div style=\"display: flex; justify-content: flex-end; gap: 8px;\">\n                <label style=\"display: flex; align-items: center; gap: 4px; font-size: 12px;\">\n                  <input type=\"checkbox\" class=\"tier-unlimited\" ${tier.token_limit === null ? 'checked' : ''}>\n                  Unlimited\n                </label>\n                <button class=\"btn-sm btn-danger remove-tier-btn\" data-index=\"${i}\"></button>\n              </div>\n            </div>\n          `).join('') : `\n            <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\n              No tiers configured. Using fixed markup of ${globalPricingConfig?.fixed_markup_percent ?? 0}% for all usage.\n            </div>\n          `}\n        </div>\n        \n        ${globalPricingTiers.length > 0 ? `\n          <div style=\"display: flex; justify-content: flex-end; gap: 8px; margin-top: 16px;\">\n            <button class=\"btn-primary\" id=\"save-tiers-btn\">Save Tiers</button>\n          </div>\n        ` : ''}\n      </div>\n\n      <!-- Projects Billing Overview -->\n      <div class=\"admin-card\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n          <div>\n            <h4>Projects Billing</h4>\n            <p class=\"text-muted\" style=\"font-size: 13px; margin-top: 4px;\">\n              ${billingProjects.length} projects | \n              ${billingProjects.filter(p => p.is_blocked).length} blocked | \n              ${billingProjects.filter(p => p.unlimited_balance).length} unlimited\n            </p>\n          </div>\n          <button class=\"btn-sm\" id=\"refresh-billing-btn\"> Refresh</button>\n        </div>\n        \n        <div style=\"overflow-x: auto;\">\n          <table class=\"data-table\" style=\"width: 100%; border-collapse: collapse;\">\n            <thead>\n              <tr style=\"background: var(--bg-tertiary);\">\n                <th style=\"text-align: left; padding: 8px;\">Project</th>\n                <th style=\"text-align: right; padding: 8px;\">Balance</th>\n                <th style=\"text-align: center; padding: 8px;\">Status</th>\n                <th style=\"text-align: right; padding: 8px;\">Tokens (Period)</th>\n                <th style=\"text-align: right; padding: 8px;\">Cost (Period)</th>\n                <th style=\"text-align: center; padding: 8px;\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${billingProjects.length > 0 ? billingProjects.map(p => `\n                <tr style=\"border-bottom: 1px solid var(--border-color);\">\n                  <td style=\"padding: 12px 8px;\">\n                    <div style=\"font-weight: 500;\">${escapeHtml(p.project_name)}</div>\n                    ${p.current_tier_name ? `<small class=\"text-muted\">Tier: ${p.current_tier_name}</small>` : ''}\n                  </td>\n                  <td style=\"text-align: right; padding: 8px;\">\n                    ${p.unlimited_balance \n                      ? '<span style=\"color: var(--success-color);\"> Unlimited</span>' \n                      : formatEur(p.balance_eur)}\n                  </td>\n                  <td style=\"text-align: center; padding: 8px;\">\n                    ${p.is_blocked \n                      ? '<span class=\"badge badge-danger\">Blocked</span>' \n                      : p.unlimited_balance\n                        ? '<span class=\"badge badge-success\">Unlimited</span>'\n                        : '<span class=\"badge badge-primary\">Active</span>'}\n                  </td>\n                  <td style=\"text-align: right; padding: 8px;\">${formatTokens(p.tokens_this_period)}</td>\n                  <td style=\"text-align: right; padding: 8px;\">${formatEur(p.billable_cost_this_period)}</td>\n                  <td style=\"text-align: center; padding: 8px;\">\n                    <div style=\"display: flex; justify-content: center; gap: 4px;\">\n                      <button class=\"btn-sm add-balance-btn\" data-project-id=\"${p.project_id}\" data-project-name=\"${escapeHtml(p.project_name)}\" title=\"Add Balance\"></button>\n                      <button class=\"btn-sm toggle-unlimited-btn\" data-project-id=\"${p.project_id}\" data-unlimited=\"${p.unlimited_balance}\" title=\"${p.unlimited_balance ? 'Disable Unlimited' : 'Enable Unlimited'}\">\n                        ${p.unlimited_balance ? '' : ''}\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              `).join('') : `\n                <tr>\n                  <td colspan=\"6\" style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\n                    No projects found\n                  </td>\n                </tr>\n              `}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Escape HTML for safe rendering\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Render Audit Log section\n */\nfunction renderAuditSection(): string {\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Configuration Audit Log</h3>\n        <p>Track all configuration changes</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <div class=\"audit-filters\">\n          <select id=\"audit-filter-table\" class=\"form-select\">\n            <option value=\"\">All Tables</option>\n            <option value=\"system_config\">System Config</option>\n            <option value=\"project_config\">Project Config</option>\n            <option value=\"secrets\">Secrets</option>\n          </select>\n          <button class=\"btn-secondary\" id=\"refresh-audit\">Refresh</button>\n        </div>\n\n        <div class=\"audit-log-list\">\n          ${auditLogs.length === 0 ? `\n            <div class=\"empty-state\">\n              <p>No audit logs found</p>\n            </div>\n          ` : auditLogs.map(log => `\n            <div class=\"audit-log-item\">\n              <div class=\"audit-log-header\">\n                <span class=\"audit-operation ${String(log.operation || '').toLowerCase()}\">${log.operation || ''}</span>\n                <span class=\"audit-table\">${log.table_name}</span>\n                <span class=\"audit-time\">${new Date(log.changed_at).toLocaleString()}</span>\n              </div>\n              <div class=\"audit-log-details\">\n                <span class=\"audit-user\">${log.changed_by_email || 'System'}</span>\n                ${log.new_values ? `<pre class=\"audit-values\">${JSON.stringify(log.new_values, null, 2)}</pre>` : ''}\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Model Metadata section\n */\nfunction renderModelsSection(): string {\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>LLM Model Metadata</h3>\n        <p>Manage model information, pricing, and capabilities from database</p>\n      </div>\n      \n      <!-- Sync Controls -->\n      <div class=\"admin-card\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n          <h4>Sync Model Metadata</h4>\n          <button class=\"btn btn-primary\" id=\"sync-all-metadata-btn\">\n             Sync All Providers\n          </button>\n        </div>\n        <p style=\"font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;\">\n          Fetch the latest model list from each configured provider API and update the database with current models and capabilities.\n          Pricing information is updated from known sources.\n        </p>\n        \n        <div id=\"metadata-sync-status\" style=\"margin-bottom: 16px;\">\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\n            Loading sync status...\n          </div>\n        </div>\n        \n        <div id=\"metadata-sync-result\" style=\"display: none;\"></div>\n      </div>\n      \n      <!-- Provider Status -->\n      <div class=\"admin-card\">\n        <h4 style=\"margin-bottom: 16px;\">Provider Model Count</h4>\n        <div id=\"provider-model-counts\">\n          <div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">\n            Loading...\n          </div>\n        </div>\n      </div>\n      \n      <!-- Model Browser -->\n      <div class=\"admin-card\">\n        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;\">\n          <h4>Browse Models</h4>\n          <div style=\"display: flex; gap: 8px;\">\n            <select id=\"browse-provider-select\" class=\"form-select\" style=\"min-width: 150px;\">\n              <option value=\"\">Select Provider</option>\n              <option value=\"openai\">OpenAI</option>\n              <option value=\"anthropic\">Anthropic</option>\n              <option value=\"google\">Google</option>\n              <option value=\"grok\">Grok (xAI)</option>\n              <option value=\"deepseek\">DeepSeek</option>\n            </select>\n            <button class=\"btn btn-secondary\" id=\"browse-models-btn\">Load Models</button>\n          </div>\n        </div>\n        \n        <div id=\"models-browser-content\">\n          <div style=\"text-align: center; padding: 40px; color: var(--text-tertiary);\">\n            Select a provider to browse available models\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render current section content\n */\nfunction renderSectionContent(): string {\n  switch (currentSection) {\n    case 'llm':\n      return renderLLMSection();\n    case 'models':\n      return renderModelsSection();\n    case 'graph':\n      return renderGraphSection();\n    case 'ontology':\n      return renderOntologySection();\n    case 'queue':\n      return renderQueueSection();\n    case 'prompts':\n      return renderPromptsSection();\n    case 'processing':\n      return renderProcessingSection();\n    case 'storage':\n      return renderStorageSection();\n    case 'team-analysis':\n      return renderTeamAnalysisSection();\n    case 'billing':\n      return renderBillingSection();\n    case 'audit':\n      return renderAuditSection();\n    default:\n      return renderLLMSection();\n  }\n}\n\n/**\n * Bind section-specific events\n */\nfunction bindSectionEvents(container: HTMLElement): void {\n  // Nav buttons\n  container.querySelectorAll('.admin-nav-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const newSection = btn.getAttribute('data-section') || 'llm';\n      currentSection = newSection;\n      \n      // Load Team Analysis settings when switching to that section\n      if (newSection === 'team-analysis') {\n        teamAnalysisLoaded = false; // Force reload\n        teamAnalysisLoading = false;\n        renderAdminPanel(container);\n        await loadTeamAnalysisSettings();\n        renderAdminPanel(container);\n      } else if (newSection === 'billing') {\n        // Load billing data\n        if (!billingLoaded && !billingLoading) {\n          billingLoading = true;        // Set loading flag BEFORE rendering\n          renderAdminPanel(container);  // Show loading state\n          await loadBillingData();      // Load data (guard removed, just loads)\n          renderAdminPanel(container);  // Re-render with data\n        } else {\n          renderAdminPanel(container);\n        }\n      } else {\n        renderAdminPanel(container);\n      }\n    });\n  });\n\n  // Toggle visibility buttons\n  container.querySelectorAll('[data-toggle-visibility]').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const inputId = btn.getAttribute('data-toggle-visibility');\n      if (inputId) {\n        const input = container.querySelector(`#${inputId}`) as HTMLInputElement;\n        if (input) {\n          input.type = input.type === 'password' ? 'text' : 'password';\n          (btn as HTMLElement).textContent = input.type === 'password' ? 'Show' : 'Hide';\n        }\n      }\n    });\n  });\n\n  // Test provider buttons\n  container.querySelectorAll('[data-test-provider]').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const providerId = btn.getAttribute('data-test-provider');\n      if (providerId) {\n        (btn as HTMLElement).textContent = 'Testing...';\n        await testProvider(providerId);\n        (btn as HTMLElement).textContent = 'Test';\n      }\n    });\n  });\n\n  // Cache for loaded models by provider\n  const modelsCache: Record<string, { textModels: string[]; visionModels: string[]; embeddingModels: string[] }> = {};\n  \n  // Load models for a provider\n  async function loadModelsForProvider(providerId: string, taskType: string): Promise<void> {\n    const modelSelect = container.querySelector(`select.model-select[data-task=\"${taskType}\"]`) as HTMLSelectElement;\n    const loadingSpan = container.querySelector(`.model-loading[data-task=\"${taskType}\"]`) as HTMLElement;\n    const statusDiv = container.querySelector(`.model-status[data-task=\"${taskType}\"]`) as HTMLElement;\n    \n    if (!modelSelect || !providerId) {\n      if (modelSelect) {\n        modelSelect.innerHTML = '<option value=\"\">-- Select Provider First --</option>';\n      }\n      return;\n    }\n    \n    // Show loading state\n    if (loadingSpan) loadingSpan.style.display = 'inline';\n    modelSelect.disabled = true;\n    \n    try {\n      // Check cache first\n      if (!modelsCache[providerId]) {\n        const response = await http.get<{ textModels: Array<{id: string; name?: string}>; visionModels: Array<{id: string; name?: string}>; embeddingModels: Array<{id: string; name?: string}> }>(`/api/llm/models?provider=${providerId}`);\n        modelsCache[providerId] = {\n          textModels: (response.data.textModels || []).map(m => m.id || m.name || '').filter(Boolean),\n          visionModels: (response.data.visionModels || []).map(m => m.id || m.name || '').filter(Boolean),\n          embeddingModels: (response.data.embeddingModels || []).map(m => m.id || m.name || '').filter(Boolean)\n        };\n      }\n      \n      // Determine which models to show based on task type\n      let models: string[] = [];\n      if (taskType === 'text') models = modelsCache[providerId].textModels;\n      else if (taskType === 'vision') models = modelsCache[providerId].visionModels;\n      else if (taskType === 'embeddings') models = modelsCache[providerId].embeddingModels;\n      \n      // Get current selected value\n      const currentValue = modelSelect.value;\n      \n      // Populate dropdown\n      modelSelect.innerHTML = '<option value=\"\">-- Select Model --</option>' +\n        models.map(m => `<option value=\"${m}\"${m === currentValue ? ' selected' : ''}>${m}</option>`).join('');\n      \n      // Update status\n      if (statusDiv) {\n        statusDiv.textContent = models.length > 0 \n          ? `${models.length} model(s) available` \n          : 'No models found for this task type. Check provider configuration.';\n        statusDiv.style.color = models.length > 0 ? 'var(--success)' : 'var(--warning)';\n      }\n      \n    } catch (error) {\n      console.error(`Failed to load models for ${providerId}:`, error);\n      modelSelect.innerHTML = '<option value=\"\">Error loading models</option>';\n      if (statusDiv) {\n        statusDiv.textContent = 'Failed to load models. Check API key configuration.';\n        statusDiv.style.color = 'var(--error)';\n      }\n    } finally {\n      if (loadingSpan) loadingSpan.style.display = 'none';\n      modelSelect.disabled = false;\n    }\n  }\n  \n  // Provider change handler - load models dynamically\n  container.querySelectorAll('select.provider-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const task = select.getAttribute('data-task');\n      const provider = (select as HTMLSelectElement).value;\n      if (task) {\n        await loadModelsForProvider(provider, task);\n      }\n    });\n    \n    // Initial load if provider is already selected\n    const task = select.getAttribute('data-task');\n    const provider = (select as HTMLSelectElement).value;\n    if (task && provider) {\n      loadModelsForProvider(provider, task);\n    }\n  });\n\n  // Save LLM config\n  const saveLLMBtn = container.querySelector('#save-llm-config');\n  if (saveLLMBtn) {\n    on(saveLLMBtn as HTMLElement, 'click', async () => {\n      const taskConfigs: Record<string, { provider: string; model: string }> = {};\n      \n      container.querySelectorAll('select[data-task]').forEach(el => {\n        const task = el.getAttribute('data-task')!;\n        const field = el.getAttribute('data-field')!;\n        \n        if (!taskConfigs[task]) {\n          taskConfigs[task] = { provider: '', model: '' };\n        }\n        \n        taskConfigs[task][field as 'provider' | 'model'] = (el as HTMLSelectElement).value;\n      });\n\n      try {\n        for (const [task, config] of Object.entries(taskConfigs)) {\n          if (config.provider) {\n            await saveConfig(`${task}_provider`, config, 'llm');\n          }\n        }\n        toast.success('LLM configuration saved to Supabase');\n      } catch (error) {\n        toast.error('Failed to save LLM configuration');\n      }\n    });\n  }\n\n  // Load existing API keys status\n  async function loadApiKeysStatus(): Promise<void> {\n    const loadingEl = container.querySelector('#api-keys-loading') as HTMLElement;\n    try {\n      const response = await http.get<{ success: boolean; secrets: Array<{ name: string; masked_value: string; is_valid: boolean }> }>('/api/secrets');\n      if (response.data?.success && response.data.secrets) {\n        for (const secret of response.data.secrets) {\n          const formGroup = container.querySelector(`[data-secret-name=\"${secret.name}\"]`);\n          if (formGroup) {\n            const statusSpan = formGroup.querySelector('.key-status') as HTMLElement;\n            const input = formGroup.querySelector('input') as HTMLInputElement;\n            if (statusSpan) {\n              if (secret.masked_value) {\n                statusSpan.textContent = ' Configured';\n                statusSpan.style.color = 'var(--success)';\n                if (input) {\n                  input.placeholder = secret.masked_value;\n                }\n              }\n            }\n          }\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to load API keys status:', error);\n    } finally {\n      if (loadingEl) loadingEl.style.display = 'none';\n    }\n  }\n  \n  // Load API keys status on render\n  loadApiKeysStatus();\n\n  // Save LLM API keys\n  const saveKeysBtn = container.querySelector('#save-api-keys');\n  if (saveKeysBtn) {\n    on(saveKeysBtn as HTMLElement, 'click', async () => {\n      const keys = [\n        { id: 'openai-key', name: 'OPENAI_API_KEY' },\n        { id: 'anthropic-key', name: 'CLAUDE_API_KEY' },\n        { id: 'google-key', name: 'GOOGLE_API_KEY' },\n        { id: 'xai-key', name: 'XAI_API_KEY' },\n        { id: 'deepseek-key', name: 'DEEPSEEK_API_KEY' },\n        { id: 'kimi-key', name: 'KIMI_API_KEY' },\n        { id: 'minimax-key', name: 'MINIMAX_API_KEY' },\n      ];\n\n      try {\n        let savedCount = 0;\n        for (const key of keys) {\n          const value = (container.querySelector(`#${key.id}`) as HTMLInputElement)?.value;\n          if (value && value.trim()) {\n            await http.post('/api/secrets', { name: key.name, value: value.trim(), scope: 'system' });\n            savedCount++;\n          }\n        }\n        if (savedCount > 0) {\n          toast.success(`${savedCount} API key(s) saved securely`);\n        } else {\n          toast.info('No API keys to save');\n        }\n      } catch (error) {\n        toast.error('Failed to save API keys');\n      }\n    });\n  }\n\n  // Save service API keys\n  const saveServiceKeysBtn = container.querySelector('#save-service-keys');\n  if (saveServiceKeysBtn) {\n    on(saveServiceKeysBtn as HTMLElement, 'click', async () => {\n      const resendKey = (container.querySelector('#resend-key') as HTMLInputElement)?.value;\n\n      try {\n        if (resendKey && resendKey.trim()) {\n          await http.post('/api/secrets', { name: 'RESEND_API_KEY', value: resendKey.trim(), scope: 'system' });\n          toast.success('Service API key saved securely');\n        } else {\n          toast.info('No service keys to save');\n        }\n      } catch (error) {\n        toast.error('Failed to save service keys');\n      }\n    });\n  }\n\n  // ============ Storage Section Handlers ==========\n  const gdriveEnabledBtn = container.querySelector('#gdrive-platform-enabled-btn') as HTMLButtonElement;\n  if (gdriveEnabledBtn) {\n    on(gdriveEnabledBtn as HTMLElement, 'click', () => {\n      const currentlyEnabled = gdriveEnabledBtn.getAttribute('data-enabled') === '1';\n      const next = !currentlyEnabled;\n      gdriveEnabledBtn.setAttribute('data-enabled', next ? '1' : '0');\n      gdriveEnabledBtn.className = `btn ${next ? 'btn-primary' : 'btn-secondary'}`;\n      gdriveEnabledBtn.textContent = next ? 'Enabled' : 'Disabled';\n    });\n  }\n\n  async function loadGoogleDrivePlatformStatus(): Promise<void> {\n    try {\n      const res = await http.get<{ googleDrive: { enabled: boolean; rootFolderId: string | null; hasCredential: boolean } }>(\n        '/api/system/google-drive'\n      );\n      const statusEl = container.querySelector('#gdrive-platform-cred-status') as HTMLElement;\n      if (statusEl) {\n        statusEl.textContent = res.data.googleDrive?.hasCredential\n          ? 'Credential:  configured'\n          : 'Credential: not configured';\n        statusEl.style.color = res.data.googleDrive?.hasCredential ? 'var(--success)' : 'var(--warning)';\n      }\n\n      const rootEl = container.querySelector('#gdrive-platform-root') as HTMLInputElement;\n      if (rootEl && !rootEl.value) {\n        rootEl.value = res.data.googleDrive?.rootFolderId || '';\n      }\n\n      const enabledBtn = container.querySelector('#gdrive-platform-enabled-btn') as HTMLElement;\n      if (enabledBtn) {\n        const enabled = !!res.data.googleDrive?.enabled;\n        enabledBtn.setAttribute('data-enabled', enabled ? '1' : '0');\n        enabledBtn.className = `btn ${enabled ? 'btn-primary' : 'btn-secondary'}`;\n        enabledBtn.textContent = enabled ? 'Enabled' : 'Disabled';\n      }\n\n      // Load coverage + last run\n      const status = await http.get<{ success: boolean; googleDrive: { enabled: boolean; rootFolderId: string | null; hasCredential: boolean }; projects: { total: number; bootstrapped: number; missing: number; upToDate: boolean }; lastBootstrap: any }>(\n        '/api/system/google-drive/status'\n      );\n\n      const statusBox = container.querySelector('#gdrive-platform-status') as HTMLElement;\n      if (statusBox) {\n        const p = status.data.projects;\n        statusBox.innerHTML = `\n          <div><b>Projects:</b> ${p.bootstrapped}/${p.total} bootstrapped ${p.upToDate ? '<span style=\"color: var(--success)\"> up to date</span>' : `<span style=\"color: var(--warning)\">(${p.missing} missing)</span>`}</div>\n          <div style=\"margin-top: 6px;\"><b>Last bootstrap:</b> ${status.data.lastBootstrap?.at ? new Date(status.data.lastBootstrap.at).toLocaleString() : ''}</div>\n        `;\n      }\n\n      const projList = await http.get<{ success: boolean; projects: Array<{ id: string; name: string; owner_username: string | null; projectFolderId: string | null; folders: any; bootstrappedAt: string | null }> }>(\n        '/api/system/google-drive/projects'\n      );\n\n      const projBox = container.querySelector('#gdrive-platform-projects') as HTMLElement;\n      if (projBox) {\n        const rows = (projList.data.projects || []).slice(0, 50);\n        projBox.innerHTML = `\n          <div style=\"font-weight: 600; margin-bottom: 8px;\">Project folders (latest 50)</div>\n          <div style=\"overflow:auto; border: 1px solid rgba(148, 163, 184, 0.25); border-radius: 10px;\">\n            <table style=\"width:100%; border-collapse: collapse; font-size: 12px;\">\n              <thead>\n                <tr style=\"background: var(--bg-secondary);\">\n                  <th style=\"text-align:left; padding: 8px;\">Owner</th>\n                  <th style=\"text-align:left; padding: 8px;\">Project</th>\n                  <th style=\"text-align:left; padding: 8px;\">Folder ID</th>\n                  <th style=\"text-align:left; padding: 8px;\">Bootstrapped</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${rows.map(r => `\n                  <tr>\n                    <td style=\"padding: 8px; border-top: 1px solid rgba(148, 163, 184, 0.15);\">${escapeHtml(r.owner_username || '')}</td>\n                    <td style=\"padding: 8px; border-top: 1px solid rgba(148, 163, 184, 0.15);\">${escapeHtml(r.name)}<div style=\"color: var(--text-tertiary);\">${r.id}</div></td>\n                    <td style=\"padding: 8px; border-top: 1px solid rgba(148, 163, 184, 0.15); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\">${r.projectFolderId ? escapeHtml(r.projectFolderId) : '<span style=\"color: var(--warning)\">missing</span>'}</td>\n                    <td style=\"padding: 8px; border-top: 1px solid rgba(148, 163, 184, 0.15);\">${r.bootstrappedAt ? new Date(r.bootstrappedAt).toLocaleString() : ''}</td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          </div>\n        `;\n      }\n    } catch {\n      // ignore\n    }\n  }\n\n  loadGoogleDrivePlatformStatus();\n\n  const gdriveJsonFile = container.querySelector('#gdrive-platform-json-file') as HTMLInputElement;\n  if (gdriveJsonFile) {\n    on(gdriveJsonFile as unknown as HTMLElement, 'change', async () => {\n      const file = gdriveJsonFile.files?.[0];\n      const textarea = container.querySelector('#gdrive-platform-json') as HTMLTextAreaElement;\n      if (!file || !textarea) return;\n      try {\n        textarea.value = await file.text();\n        toast.success('Google Drive JSON loaded');\n      } catch {\n        toast.error('Failed to read JSON file');\n      }\n    });\n  }\n\n  const gdriveSaveBtn = container.querySelector('#gdrive-platform-save');\n  if (gdriveSaveBtn) {\n    on(gdriveSaveBtn as HTMLElement, 'click', async () => {\n      const enabled = (container.querySelector('#gdrive-platform-enabled-btn') as HTMLElement)?.getAttribute('data-enabled') === '1';\n      const rootFolderId = (container.querySelector('#gdrive-platform-root') as HTMLInputElement)?.value?.trim();\n      const jsonTxt = (container.querySelector('#gdrive-platform-json') as HTMLTextAreaElement)?.value?.trim();\n\n      if (enabled && !rootFolderId) {\n        toast.error('Root Folder ID is required when enabled');\n        return;\n      }\n\n      try {\n        await http.post('/api/system/google-drive', {\n          enabled,\n          rootFolderId: enabled ? rootFolderId : null,\n          serviceAccountJson: jsonTxt || undefined\n        });\n        // clear json field after save\n        const textarea = container.querySelector('#gdrive-platform-json') as HTMLTextAreaElement;\n        if (textarea) textarea.value = '';\n        toast.success('Google Drive platform settings saved');\n        await loadGoogleDrivePlatformStatus();\n      } catch {\n        toast.error('Failed to save Google Drive settings');\n      }\n    });\n  }\n\n  const gdriveTestBtn = container.querySelector('#gdrive-platform-test');\n  if (gdriveTestBtn) {\n    on(gdriveTestBtn as HTMLElement, 'click', async () => {\n      try {\n        await http.post('/api/system/google-drive/test', {});\n        toast.success('Google Drive OK');\n        await loadGoogleDrivePlatformStatus();\n      } catch {\n        toast.error('Google Drive test failed');\n      }\n    });\n  }\n\n  const gdriveBootstrapAllBtn = container.querySelector('#gdrive-platform-bootstrap-all');\n  if (gdriveBootstrapAllBtn) {\n    on(gdriveBootstrapAllBtn as HTMLElement, 'click', async () => {\n      try {\n        (gdriveBootstrapAllBtn as HTMLElement).textContent = 'Bootstrapping...';\n        await http.post('/api/system/google-drive/bootstrap-all', {});\n        toast.success('Bootstrap completed');\n        await loadGoogleDrivePlatformStatus();\n      } catch {\n        toast.error('Bootstrap-all failed');\n      } finally {\n        (gdriveBootstrapAllBtn as HTMLElement).textContent = 'Bootstrap all projects';\n      }\n    });\n  }\n\n  // ============ Queue Section Handlers ============\n  \n  // Load queue status\n  // Interface for queue data\n  interface QueueStatusData {\n    isProcessing: boolean;\n    isPaused: boolean;\n    queueLength: number;\n    currentRequest: { id: string; context: string; priority: string; startedAt: string } | null;\n    stats: { total: number; successful: number; failed: number; avgProcessingTime: number };\n    pendingItems: Array<{ id: string; context: string; priority: string; queuedAt: string }>;\n    database?: {\n      pendingCount: number;\n      processingCount: number;\n      retryPendingCount: number;\n      completedToday: number;\n      failedToday: number;\n      avgProcessingTimeMs: number;\n      totalCostTodayUsd: number;\n    };\n  }\n\n  async function loadQueueStatus(): Promise<void> {\n    const statusContent = container.querySelector('#queue-status-content');\n    const itemsContent = container.querySelector('#queue-items-content');\n    const pendingCount = container.querySelector('#pending-count');\n    const dbStatusBadge = container.querySelector('#db-status-badge');\n    \n    try {\n      const response = await http.get<QueueStatusData>('/api/llm/queue/status');\n      const data = response.data;\n      \n      // Update DB status badge\n      if (dbStatusBadge) {\n        if (data.database) {\n          dbStatusBadge.className = 'badge badge-success';\n          dbStatusBadge.textContent = 'DB: Connected';\n        } else {\n          dbStatusBadge.className = 'badge badge-warning';\n          dbStatusBadge.textContent = 'DB: Memory Only';\n        }\n      }\n      \n      // Update status\n      if (statusContent) {\n        const statusColor = data.isPaused ? 'var(--warning)' : (data.isProcessing ? 'var(--success)' : 'var(--text-tertiary)');\n        const statusText = data.isPaused ? ' PAUSED' : (data.isProcessing ? ' PROCESSING' : ' IDLE');\n        \n        statusContent.innerHTML = `\n          <div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;\">\n            <div>\n              <div style=\"font-size: 28px; font-weight: bold; color: ${statusColor};\">${statusText}</div>\n              <div style=\"font-size: 12px; color: var(--text-tertiary); margin-top: 4px;\">Queue Status</div>\n            </div>\n            <div>\n              <div style=\"font-size: 28px; font-weight: bold;\">${data.queueLength}</div>\n              <div style=\"font-size: 12px; color: var(--text-tertiary); margin-top: 4px;\">Items in Queue</div>\n            </div>\n            <div>\n              <div style=\"font-size: 28px; font-weight: bold; color: var(--primary);\">${data.isProcessing ? '1' : '0'}</div>\n              <div style=\"font-size: 12px; color: var(--text-tertiary); margin-top: 4px;\">Processing Now</div>\n            </div>\n          </div>\n          ${data.currentRequest ? `\n            <div style=\"margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px; text-align: left;\">\n              <strong>Currently Processing:</strong> ${data.currentRequest.context || 'Unknown'} \n              <span style=\"color: var(--text-tertiary);\">(Priority: ${data.currentRequest.priority})</span>\n              <span style=\"color: var(--text-tertiary); font-size: 11px; margin-left: 8px;\">Started: ${new Date(data.currentRequest.startedAt).toLocaleTimeString()}</span>\n            </div>\n          ` : ''}\n        `;\n      }\n      \n      // Update pending items\n      if (itemsContent && pendingCount) {\n        const pendingLen = data.pendingItems?.length || 0;\n        pendingCount.textContent = `${pendingLen} items`;\n        \n        if (pendingLen > 0) {\n          itemsContent.innerHTML = `\n            <table style=\"width: 100%; font-size: 13px;\">\n              <thead>\n                <tr style=\"text-align: left; color: var(--text-tertiary); border-bottom: 1px solid var(--border);\">\n                  <th style=\"padding: 8px;\">Context</th>\n                  <th style=\"padding: 8px;\">Priority</th>\n                  <th style=\"padding: 8px;\">Queued</th>\n                  <th style=\"padding: 8px;\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${data.pendingItems.map(item => `\n                  <tr style=\"border-bottom: 1px solid var(--border-light);\">\n                    <td style=\"padding: 8px;\">${item.context || 'Unknown'}</td>\n                    <td style=\"padding: 8px;\"><span class=\"badge badge-${item.priority}\">${item.priority}</span></td>\n                    <td style=\"padding: 8px;\">${new Date(item.queuedAt).toLocaleTimeString()}</td>\n                    <td style=\"padding: 8px;\"><button class=\"btn-sm btn-danger\" data-cancel-item=\"${item.id}\">Cancel</button></td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          itemsContent.innerHTML = '<div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">No items in queue</div>';\n        }\n      }\n      \n      // Update stats\n      const db = data.database;\n      const statPending = container.querySelector('#stat-pending');\n      const statProcessing = container.querySelector('#stat-processing');\n      const statSuccess = container.querySelector('#stat-success');\n      const statFailed = container.querySelector('#stat-failed');\n      const statRetry = container.querySelector('#stat-retry');\n      const statAvgTime = container.querySelector('#stat-avg-time');\n      const statCost = container.querySelector('#stat-cost');\n      \n      if (statPending) statPending.textContent = String(db?.pendingCount || data.queueLength || 0);\n      if (statProcessing) statProcessing.textContent = String(db?.processingCount || (data.isProcessing ? 1 : 0));\n      if (statSuccess) statSuccess.textContent = String(db?.completedToday || data.stats?.successful || 0);\n      if (statFailed) statFailed.textContent = String(db?.failedToday || data.stats?.failed || 0);\n      if (statRetry) statRetry.textContent = String(db?.retryPendingCount || 0);\n      if (statAvgTime) statAvgTime.textContent = String(Math.round(db?.avgProcessingTimeMs || data.stats?.avgProcessingTime || 0));\n      if (statCost) statCost.textContent = `$${(db?.totalCostTodayUsd || 0).toFixed(4)}`;\n      \n    } catch (error) {\n      console.error('Failed to load queue status:', error);\n      if (statusContent) {\n        statusContent.innerHTML = '<div style=\"color: var(--error);\">Failed to load queue status</div>';\n      }\n    }\n  }\n  \n  // Load queue history\n  async function loadQueueHistory(): Promise<void> {\n    const historyContent = container.querySelector('#queue-history-content');\n    \n    try {\n      const response = await http.get<{\n        history: Array<{\n          id: string;\n          context: string;\n          priority: string;\n          status: string;\n          processingTime: number;\n          completedAt: string;\n          provider?: string;\n          model?: string;\n          inputTokens?: number;\n          outputTokens?: number;\n          estimatedCost?: number;\n          error?: string;\n        }>;\n      }>('/api/llm/queue/history?limit=50');\n      \n      const history = response.data?.history || [];\n      \n      if (historyContent) {\n        if (history.length > 0) {\n          historyContent.innerHTML = `\n            <table style=\"width: 100%; font-size: 12px;\">\n              <thead>\n                <tr style=\"text-align: left; color: var(--text-tertiary); border-bottom: 1px solid var(--border);\">\n                  <th style=\"padding: 6px;\">Context</th>\n                  <th style=\"padding: 6px;\">Provider/Model</th>\n                  <th style=\"padding: 6px;\">Status</th>\n                  <th style=\"padding: 6px;\">Tokens</th>\n                  <th style=\"padding: 6px;\">Time</th>\n                  <th style=\"padding: 6px;\">Completed</th>\n                  <th style=\"padding: 6px;\">Details</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${history.map(item => `\n                  <tr style=\"border-bottom: 1px solid var(--border-light);\">\n                    <td style=\"padding: 6px; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\" title=\"${item.context || ''}\">${item.context || 'Unknown'}</td>\n                    <td style=\"padding: 6px; font-size: 11px; color: var(--text-secondary);\">${item.provider || '-'}/${item.model || '-'}</td>\n                    <td style=\"padding: 6px;\">\n                      <span style=\"color: ${item.status === 'completed' ? 'var(--success)' : 'var(--error)'};\">\n                        ${item.status === 'completed' ? '' : ''}\n                      </span>\n                      ${item.error ? `<span style=\"font-size: 10px; color: var(--error);\" title=\"${item.error}\">Error</span>` : ''}\n                    </td>\n                    <td style=\"padding: 6px; font-size: 11px;\">${item.inputTokens || '-'}/${item.outputTokens || '-'}</td>\n                    <td style=\"padding: 6px;\">${item.processingTime || '-'}ms</td>\n                    <td style=\"padding: 6px; font-size: 11px;\">${item.completedAt ? new Date(item.completedAt).toLocaleString() : '-'}</td>\n                    <td style=\"padding: 6px;\"><button class=\"btn-sm\" data-view-request=\"${item.id}\">View</button></td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          historyContent.innerHTML = '<div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">No processing history yet</div>';\n        }\n      }\n    } catch (error) {\n      console.error('Failed to load queue history:', error);\n      if (historyContent) {\n        historyContent.innerHTML = '<div style=\"color: var(--error);\">Failed to load history</div>';\n      }\n    }\n  }\n  \n  // Show request details modal\n  async function showRequestDetails(requestId: string): Promise<void> {\n    try {\n      const response = await http.get<{\n        success: boolean;\n        request: {\n          id: string;\n          context: string;\n          request_type: string;\n          provider: string;\n          model: string;\n          status: string;\n          priority: string;\n          input_data: Record<string, unknown>;\n          output_data: Record<string, unknown> | null;\n          output_text: string | null;\n          input_tokens: number | null;\n          output_tokens: number | null;\n          total_tokens: number | null;\n          estimated_cost_usd: number | null;\n          processing_time_ms: number | null;\n          attempt_count: number;\n          max_attempts: number;\n          last_error: string | null;\n          error_details: Record<string, unknown> | null;\n          queued_at: string;\n          started_at: string | null;\n          completed_at: string | null;\n        };\n      }>(`/api/llm/queue/${requestId}`);\n      \n      if (!response.data.success || !response.data.request) {\n        toast.error('Request not found');\n        return;\n      }\n      \n      const req = response.data.request;\n      \n      // Escape HTML in strings to prevent XSS and template breaking\n      const escapeHtml = (str: string | null | undefined): string => {\n        if (!str) return '';\n        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n      };\n      \n      // Format JSON with syntax highlighting\n      const formatJsonHtml = (obj: unknown): string => {\n        const json = JSON.stringify(obj, null, 2);\n        return escapeHtml(json)\n          .replace(/\"([^\"]+)\":/g, '<span style=\"color: #0550ae;\">\"$1\"</span>:')\n          .replace(/: \"([^\"]*)\"/g, ': <span style=\"color: #0a3069;\">\"$1\"</span>')\n          .replace(/: (\\d+)/g, ': <span style=\"color: #0550ae;\">$1</span>')\n          .replace(/: (true|false|null)/g, ': <span style=\"color: #cf222e;\">$1</span>');\n      };\n      \n      // Format prompt text for readability\n      const formatPromptText = (text: string | null | undefined): string => {\n        if (!text) return '<span style=\"color: var(--text-tertiary);\">(No content)</span>';\n        return escapeHtml(text)\n          .replace(/\\\\n/g, '\\n')\n          .replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>')\n          .replace(/^(#{1,3})\\s*(.+)$/gm, '<span style=\"color: var(--accent); font-weight: 600;\">$2</span>')\n          .replace(/^[-]\\s*(.+)$/gm, '   $1')\n          .replace(/---+/g, '<hr style=\"border: none; border-top: 1px solid var(--border); margin: 8px 0;\">');\n      };\n      \n      // Get status color and icon\n      const getStatusInfo = (status: string) => {\n        const statusMap: Record<string, { color: string; icon: string; bg: string }> = {\n          completed: { color: 'var(--success)', icon: '', bg: 'rgba(34, 197, 94, 0.1)' },\n          failed: { color: 'var(--error)', icon: '', bg: 'rgba(239, 68, 68, 0.1)' },\n          processing: { color: 'var(--warning)', icon: '', bg: 'rgba(234, 179, 8, 0.1)' },\n          pending: { color: 'var(--text-secondary)', icon: '', bg: 'var(--bg-tertiary)' },\n          retry_pending: { color: 'var(--warning)', icon: '', bg: 'rgba(234, 179, 8, 0.1)' },\n          cancelled: { color: 'var(--text-tertiary)', icon: '', bg: 'var(--bg-tertiary)' }\n        };\n        return statusMap[status] || { color: 'var(--text-primary)', icon: '?', bg: 'var(--bg-secondary)' };\n      };\n      \n      const statusInfo = getStatusInfo(req.status);\n      const inputData = (req.input_data || {}) as Record<string, unknown>;\n      const messages = inputData.messages as Array<{ content?: string }> | undefined;\n      const promptText = (inputData.prompt as string) || messages?.[0]?.content || '';\n      \n      // Create modal - using unique ID to avoid duplicates\n      const existingModal = document.getElementById('llm-request-details-modal');\n      if (existingModal) {\n        existingModal.remove();\n      }\n      \n      const modal = document.createElement('div');\n      modal.id = 'llm-request-details-modal';\n      modal.className = 'modal open';\n      modal.style.cssText = 'display: flex !important; z-index: 999999 !important;';\n      modal.innerHTML = `\n        <div class=\"modal-content\" style=\"max-width: 900px; width: 95%;\">\n          <div class=\"modal-header\">\n            <div style=\"display: flex; align-items: center; gap: 12px;\">\n              <span style=\"font-size: 24px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: ${statusInfo.bg}; border-radius: 8px; color: ${statusInfo.color};\">${statusInfo.icon}</span>\n              <div>\n                <h3 style=\"margin: 0;\">LLM Request Details</h3>\n                <span style=\"font-size: 12px; color: var(--text-tertiary);\">ID: ${req.id}</span>\n              </div>\n            </div>\n            <button class=\"modal-close\">&times;</button>\n          </div>\n          \n          <div class=\"modal-body\" style=\"max-height: 70vh; overflow-y: auto;\">\n            <!-- Status Bar -->\n            <div style=\"display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 24px; padding: 16px; background: var(--bg-tertiary); border-radius: 12px;\">\n              <div style=\"flex: 1; min-width: 120px;\">\n                <div style=\"font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Context</div>\n                <div style=\"font-weight: 600; font-size: 16px; color: var(--accent);\">${req.context || 'Unknown'}</div>\n              </div>\n              <div style=\"flex: 1; min-width: 120px;\">\n                <div style=\"font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Provider</div>\n                <div style=\"font-weight: 600; font-size: 16px;\">${req.provider || '-'}</div>\n              </div>\n              <div style=\"flex: 1; min-width: 120px;\">\n                <div style=\"font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Model</div>\n                <div style=\"font-weight: 600; font-size: 14px; font-family: monospace;\">${req.model || '-'}</div>\n              </div>\n              <div style=\"flex: 1; min-width: 100px;\">\n                <div style=\"font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Status</div>\n                <div style=\"display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; background: ${statusInfo.bg}; border-radius: 12px; color: ${statusInfo.color}; font-weight: 600; font-size: 13px;\">\n                  ${statusInfo.icon} ${req.status}\n                </div>\n              </div>\n            </div>\n            \n            <!-- Metrics -->\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 24px;\">\n              <div style=\"text-align: center; padding: 16px; background: var(--bg-secondary); border-radius: 8px;\">\n                <div style=\"font-size: 24px; font-weight: 700; color: var(--text-primary);\">${req.input_tokens?.toLocaleString() || '-'}</div>\n                <div style=\"font-size: 11px; color: var(--text-tertiary);\">Input Tokens</div>\n              </div>\n              <div style=\"text-align: center; padding: 16px; background: var(--bg-secondary); border-radius: 8px;\">\n                <div style=\"font-size: 24px; font-weight: 700; color: var(--text-primary);\">${req.output_tokens?.toLocaleString() || '-'}</div>\n                <div style=\"font-size: 11px; color: var(--text-tertiary);\">Output Tokens</div>\n              </div>\n              <div style=\"text-align: center; padding: 16px; background: var(--bg-secondary); border-radius: 8px;\">\n                <div style=\"font-size: 24px; font-weight: 700; color: var(--text-primary);\">${req.processing_time_ms ? `${(req.processing_time_ms / 1000).toFixed(1)}s` : '-'}</div>\n                <div style=\"font-size: 11px; color: var(--text-tertiary);\">Duration</div>\n              </div>\n              <div style=\"text-align: center; padding: 16px; background: var(--bg-secondary); border-radius: 8px;\">\n                <div style=\"font-size: 24px; font-weight: 700; color: ${req.estimated_cost_usd ? 'var(--success)' : 'var(--text-tertiary)'};\">$${req.estimated_cost_usd?.toFixed(4) || '-'}</div>\n                <div style=\"font-size: 11px; color: var(--text-tertiary);\">Est. Cost</div>\n              </div>\n            </div>\n            \n            <!-- Timeline -->\n            <div style=\"display: flex; gap: 24px; margin-bottom: 24px; padding: 12px 16px; background: var(--bg-secondary); border-radius: 8px; font-size: 12px; flex-wrap: wrap;\">\n              <div><strong style=\"color: var(--text-tertiary);\">Queued:</strong> ${req.queued_at ? new Date(req.queued_at).toLocaleString() : '-'}</div>\n              <div><strong style=\"color: var(--text-tertiary);\">Started:</strong> ${req.started_at ? new Date(req.started_at).toLocaleString() : '-'}</div>\n              <div><strong style=\"color: var(--text-tertiary);\">Completed:</strong> ${req.completed_at ? new Date(req.completed_at).toLocaleString() : '-'}</div>\n            </div>\n            \n            ${req.last_error ? `\n              <div style=\"background: rgba(239, 68, 68, 0.1); border: 1px solid var(--error); border-radius: 8px; padding: 16px; margin-bottom: 24px;\">\n                <div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 8px;\">\n                  <span style=\"color: var(--error); font-size: 18px;\"></span>\n                  <strong style=\"color: var(--error);\">Error</strong>\n                  <span style=\"font-size: 12px; color: var(--text-tertiary);\">(Attempt ${req.attempt_count}/${req.max_attempts})</span>\n                </div>\n                <div style=\"font-size: 13px; color: var(--error); font-family: monospace; white-space: pre-wrap;\">${escapeHtml(req.last_error)}</div>\n              </div>\n            ` : ''}\n            \n            <!-- Prompt / Input -->\n            <div style=\"margin-bottom: 24px;\">\n              <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;\">\n                <h4 style=\"margin: 0; display: flex; align-items: center; gap: 8px;\">\n                  <span style=\"font-size: 16px;\"></span> Prompt / Input\n                </h4>\n                <button class=\"btn btn-sm btn-secondary\" id=\"copy-input-btn\">Copy</button>\n              </div>\n              <div style=\"background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; max-height: 250px; overflow-y: auto; font-size: 13px; line-height: 1.6; white-space: pre-wrap; font-family: inherit;\" id=\"input-display\">${formatPromptText(promptText as string)}</div>\n            </div>\n            \n            <!-- Output -->\n            <div style=\"margin-bottom: 24px;\">\n              <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;\">\n                <h4 style=\"margin: 0; display: flex; align-items: center; gap: 8px;\">\n                  <span style=\"font-size: 16px;\"></span> Response\n                </h4>\n                <button class=\"btn btn-sm btn-secondary\" id=\"copy-output-btn\">Copy</button>\n              </div>\n              <div style=\"background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 16px; max-height: 350px; overflow-y: auto; font-size: 13px; line-height: 1.6; white-space: pre-wrap;\" id=\"output-display\">${formatPromptText(req.output_text)}</div>\n            </div>\n            \n            <!-- Raw Data Toggle -->\n            <details style=\"margin-bottom: 16px;\">\n              <summary style=\"cursor: pointer; font-weight: 600; padding: 12px; background: var(--bg-secondary); border-radius: 8px; user-select: none;\">\n                <span style=\"margin-left: 8px;\"> Raw Data (JSON)</span>\n              </summary>\n              <div style=\"margin-top: 12px;\">\n                <div style=\"margin-bottom: 16px;\">\n                  <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\n                    <span style=\"font-size: 12px; font-weight: 600; color: var(--text-secondary);\">Input Data</span>\n                    <button class=\"btn btn-xs btn-secondary\" id=\"copy-input-json-btn\">Copy JSON</button>\n                  </div>\n                  <pre style=\"background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; overflow-x: auto; font-size: 11px; max-height: 200px; overflow-y: auto; margin: 0;\">${formatJsonHtml(req.input_data)}</pre>\n                </div>\n                ${req.output_data ? `\n                  <div>\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\n                      <span style=\"font-size: 12px; font-weight: 600; color: var(--text-secondary);\">Output Data</span>\n                      <button class=\"btn btn-xs btn-secondary\" id=\"copy-output-json-btn\">Copy JSON</button>\n                    </div>\n                    <pre style=\"background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; overflow-x: auto; font-size: 11px; max-height: 200px; overflow-y: auto; margin: 0;\">${formatJsonHtml(req.output_data)}</pre>\n                  </div>\n                ` : ''}\n              </div>\n            </details>\n          </div>\n          \n          <div class=\"modal-footer\">\n            <button class=\"btn btn-secondary modal-close-btn\">Close</button>\n          </div>\n        </div>\n      `;\n      \n      document.body.appendChild(modal);\n      \n      // Close handlers\n      modal.querySelector('.modal-close')?.addEventListener('click', () => modal.remove());\n      modal.querySelector('.modal-close-btn')?.addEventListener('click', () => modal.remove());\n      modal.addEventListener('click', (e) => {\n        if (e.target === modal) modal.remove();\n      });\n      \n      // ESC key to close\n      const handleEsc = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n          modal.remove();\n          document.removeEventListener('keydown', handleEsc);\n        }\n      };\n      document.addEventListener('keydown', handleEsc);\n      \n      // Copy handlers\n      modal.querySelector('#copy-input-btn')?.addEventListener('click', () => {\n        const text = promptText || JSON.stringify(req.input_data, null, 2);\n        navigator.clipboard.writeText(text as string);\n        toast.success('Input copied to clipboard');\n      });\n      modal.querySelector('#copy-output-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(req.output_text || '');\n        toast.success('Response copied to clipboard');\n      });\n      modal.querySelector('#copy-input-json-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(JSON.stringify(req.input_data, null, 2));\n        toast.success('Input JSON copied to clipboard');\n      });\n      modal.querySelector('#copy-output-json-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(JSON.stringify(req.output_data, null, 2));\n        toast.success('Output JSON copied to clipboard');\n      });\n      \n    } catch (error) {\n      console.error('Failed to load request details:', error);\n      toast.error('Failed to load request details');\n    }\n  }\n  \n  // Load failed items\n  async function loadFailedItems(): Promise<void> {\n    const failedContent = container.querySelector('#failed-items-content');\n    \n    try {\n      const response = await http.get<{\n        items: Array<{\n          id: string;\n          context: string;\n          priority: string;\n          provider?: string;\n          model?: string;\n          attemptCount: number;\n          maxAttempts: number;\n          canRetry: boolean;\n          error?: string;\n          completedAt?: string;\n        }>;\n      }>('/api/llm/queue/retryable?limit=20');\n      \n      const items = response.data?.items || [];\n      \n      if (failedContent) {\n        if (items.length > 0) {\n          failedContent.innerHTML = `\n            <table style=\"width: 100%; font-size: 12px;\">\n              <thead>\n                <tr style=\"text-align: left; color: var(--text-tertiary); border-bottom: 1px solid var(--border);\">\n                  <th style=\"padding: 6px;\">Context</th>\n                  <th style=\"padding: 6px;\">Provider</th>\n                  <th style=\"padding: 6px;\">Attempts</th>\n                  <th style=\"padding: 6px;\">Error</th>\n                  <th style=\"padding: 6px;\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${items.map(item => `\n                  <tr style=\"border-bottom: 1px solid var(--border-light);\">\n                    <td style=\"padding: 6px;\">${item.context || 'Unknown'}</td>\n                    <td style=\"padding: 6px; font-size: 11px;\">${item.provider || '-'}</td>\n                    <td style=\"padding: 6px;\">${item.attemptCount}/${item.maxAttempts}</td>\n                    <td style=\"padding: 6px; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--error);\" title=\"${item.error || ''}\">${item.error || '-'}</td>\n                    <td style=\"padding: 6px;\">\n                      <button class=\"btn-sm btn-primary\" data-retry-item=\"${item.id}\" ${!item.canRetry ? 'disabled' : ''}> Retry</button>\n                      <button class=\"btn-sm\" data-retry-reset-item=\"${item.id}\" style=\"margin-left: 4px;\">Reset & Retry</button>\n                    </td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          failedContent.innerHTML = '<div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">No failed items</div>';\n        }\n      }\n    } catch (error) {\n      console.error('Failed to load failed items:', error);\n      if (failedContent) {\n        failedContent.innerHTML = '<div style=\"color: var(--error);\">Failed to load failed items</div>';\n      }\n    }\n  }\n  \n  // Refresh queue status button\n  const refreshStatusBtn = container.querySelector('#refresh-queue-status');\n  if (refreshStatusBtn) {\n    on(refreshStatusBtn as HTMLElement, 'click', loadQueueStatus);\n  }\n  \n  // Refresh history button\n  const refreshHistoryBtn = container.querySelector('#refresh-queue-history');\n  if (refreshHistoryBtn) {\n    on(refreshHistoryBtn as HTMLElement, 'click', loadQueueHistory);\n  }\n  \n  // Refresh failed button\n  const refreshFailedBtn = container.querySelector('#refresh-failed-btn');\n  if (refreshFailedBtn) {\n    on(refreshFailedBtn as HTMLElement, 'click', loadFailedItems);\n  }\n  \n  // Retry all failed items\n  const retryAllBtn = container.querySelector('#retry-all-btn');\n  if (retryAllBtn) {\n    on(retryAllBtn as HTMLElement, 'click', async () => {\n      try {\n        // Get all retryable items and retry them\n        const response = await http.get<{ items: Array<{ id: string; canRetry: boolean }> }>('/api/llm/queue/retryable?limit=50');\n        const items = (response.data?.items || []).filter(i => i.canRetry);\n        \n        let successCount = 0;\n        for (const item of items) {\n          try {\n            await http.post(`/api/llm/queue/${item.id}/retry`, { resetAttempts: false });\n            successCount++;\n          } catch {\n            // Continue with others\n          }\n        }\n        \n        toast.success(`Queued ${successCount} items for retry`);\n        loadQueueStatus();\n        loadFailedItems();\n      } catch (error) {\n        toast.error('Failed to retry items');\n      }\n    });\n  }\n  \n  // Pause queue button\n  const pauseBtn = container.querySelector('#queue-pause-btn');\n  if (pauseBtn) {\n    on(pauseBtn as HTMLElement, 'click', async () => {\n      try {\n        await http.post('/api/llm/queue/pause');\n        toast.success('Queue paused');\n        loadQueueStatus();\n      } catch (error) {\n        toast.error('Failed to pause queue');\n      }\n    });\n  }\n  \n  // Resume queue button\n  const resumeBtn = container.querySelector('#queue-resume-btn');\n  if (resumeBtn) {\n    on(resumeBtn as HTMLElement, 'click', async () => {\n      try {\n        await http.post('/api/llm/queue/resume');\n        toast.success('Queue resumed');\n        loadQueueStatus();\n      } catch (error) {\n        toast.error('Failed to resume queue');\n      }\n    });\n  }\n  \n  // Clear queue button\n  const clearBtn = container.querySelector('#queue-clear-btn');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', async () => {\n      if (confirm('Are you sure you want to clear all pending items from the queue?')) {\n        try {\n          await http.post('/api/llm/queue/clear');\n          toast.success('Queue cleared');\n          loadQueueStatus();\n        } catch (error) {\n          toast.error('Failed to clear queue');\n        }\n      }\n    });\n  }\n  \n  // Cancel individual item, retry handlers, and view details\n  container.addEventListener('click', async (e) => {\n    const target = e.target as HTMLElement;\n    \n    // View request details - use closest to handle click on button or its content\n    const viewBtn = target.closest('[data-view-request]') as HTMLElement | null;\n    if (viewBtn) {\n      e.preventDefault();\n      e.stopPropagation();\n      const viewId = viewBtn.getAttribute('data-view-request');\n      if (viewId) {\n        showRequestDetails(viewId);\n      }\n      return;\n    }\n    \n    // Cancel pending item\n    const cancelBtn = target.closest('[data-cancel-item]') as HTMLElement | null;\n    if (cancelBtn) {\n      const cancelId = cancelBtn.getAttribute('data-cancel-item');\n      if (cancelId) {\n        try {\n          await http.delete(`/api/llm/queue/${cancelId}`);\n          toast.success('Item cancelled');\n          loadQueueStatus();\n        } catch (error) {\n          toast.error('Failed to cancel item');\n        }\n        return;\n      }\n    }\n    \n    // Retry failed item\n    const retryBtn = target.closest('[data-retry-item]') as HTMLElement | null;\n    if (retryBtn) {\n      const retryId = retryBtn.getAttribute('data-retry-item');\n      if (retryId) {\n        try {\n          await http.post(`/api/llm/queue/${retryId}/retry`, { resetAttempts: false });\n          toast.success('Item queued for retry');\n          loadQueueStatus();\n          loadFailedItems();\n        } catch (error) {\n          toast.error('Failed to retry item');\n        }\n        return;\n      }\n    }\n    \n    // Retry with reset\n    const retryResetBtn = target.closest('[data-retry-reset-item]') as HTMLElement | null;\n    if (retryResetBtn) {\n      const retryResetId = retryResetBtn.getAttribute('data-retry-reset-item');\n      if (retryResetId) {\n        try {\n          await http.post(`/api/llm/queue/${retryResetId}/retry`, { resetAttempts: true });\n          toast.success('Item queued for retry (attempts reset)');\n          loadQueueStatus();\n          loadFailedItems();\n        } catch (error) {\n          toast.error('Failed to retry item');\n        }\n        return;\n      }\n    }\n  });\n  \n  // ============ Models Section Handlers ============\n  \n  // Load metadata sync status\n  async function loadMetadataSyncStatus(): Promise<void> {\n    const statusDiv = container.querySelector('#metadata-sync-status');\n    const countsDiv = container.querySelector('#provider-model-counts');\n    \n    try {\n      const response = await http.get<{\n        success: boolean;\n        providers: Array<{\n          provider: string;\n          active_models: number;\n          text_models: number;\n          embedding_models: number;\n          vision_models: number;\n          last_synced: string | null;\n        }>;\n      }>('/api/llm/metadata/status');\n      \n      const providers = response.data?.providers || [];\n      \n      if (statusDiv) {\n        if (providers.length > 0) {\n          statusDiv.innerHTML = `\n            <table style=\"width: 100%; font-size: 13px;\">\n              <thead>\n                <tr style=\"text-align: left; color: var(--text-tertiary); border-bottom: 1px solid var(--border);\">\n                  <th style=\"padding: 8px;\">Provider</th>\n                  <th style=\"padding: 8px;\">Text</th>\n                  <th style=\"padding: 8px;\">Vision</th>\n                  <th style=\"padding: 8px;\">Embeddings</th>\n                  <th style=\"padding: 8px;\">Total</th>\n                  <th style=\"padding: 8px;\">Last Synced</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${providers.map(p => `\n                  <tr style=\"border-bottom: 1px solid var(--border-light);\">\n                    <td style=\"padding: 8px; font-weight: 600; text-transform: capitalize;\">${p.provider}</td>\n                    <td style=\"padding: 8px;\">${p.text_models || 0}</td>\n                    <td style=\"padding: 8px;\">${p.vision_models || 0}</td>\n                    <td style=\"padding: 8px;\">${p.embedding_models || 0}</td>\n                    <td style=\"padding: 8px; font-weight: 600;\">${p.active_models || 0}</td>\n                    <td style=\"padding: 8px; font-size: 11px; color: var(--text-tertiary);\">${p.last_synced ? new Date(p.last_synced).toLocaleString() : 'Never'}</td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          statusDiv.innerHTML = '<div style=\"text-align: center; padding: 20px; color: var(--text-tertiary);\">No metadata found. Click \"Sync All Providers\" to fetch model data.</div>';\n        }\n      }\n      \n      // Update counts display\n      if (countsDiv && providers.length > 0) {\n        const total = providers.reduce((sum, p) => sum + (p.active_models || 0), 0);\n        countsDiv.innerHTML = `\n          <div style=\"display: flex; flex-wrap: wrap; gap: 12px;\">\n            ${providers.map(p => `\n              <div style=\"flex: 1; min-width: 120px; text-align: center; padding: 16px; background: var(--bg-tertiary); border-radius: 8px;\">\n                <div style=\"font-size: 24px; font-weight: 700;\">${p.active_models || 0}</div>\n                <div style=\"font-size: 12px; color: var(--text-tertiary); text-transform: capitalize;\">${p.provider}</div>\n              </div>\n            `).join('')}\n            <div style=\"flex: 1; min-width: 120px; text-align: center; padding: 16px; background: var(--accent); border-radius: 8px; color: white;\">\n              <div style=\"font-size: 24px; font-weight: 700;\">${total}</div>\n              <div style=\"font-size: 12px; opacity: 0.9;\">Total Models</div>\n            </div>\n          </div>\n        `;\n      }\n    } catch (error) {\n      console.error('Failed to load metadata status:', error);\n      if (statusDiv) {\n        statusDiv.innerHTML = '<div style=\"color: var(--error);\">Failed to load metadata status</div>';\n      }\n    }\n  }\n  \n  // Sync all metadata\n  const syncAllBtn = container.querySelector('#sync-all-metadata-btn');\n  if (syncAllBtn) {\n    on(syncAllBtn as HTMLElement, 'click', async () => {\n      const resultDiv = container.querySelector('#metadata-sync-result');\n      (syncAllBtn as HTMLButtonElement).disabled = true;\n      (syncAllBtn as HTMLButtonElement).textContent = 'Syncing...';\n      \n      try {\n        const response = await http.post<{\n          success: boolean;\n          providers: Record<string, { status: string; models?: number; synced?: number; error?: string; reason?: string }>;\n          totalModels: number;\n          errors: Array<{ provider: string; error: string }>;\n        }>('/api/llm/metadata/sync', {});\n        \n        if (resultDiv) {\n          (resultDiv as HTMLElement).style.display = 'block';\n          const providers = response.data?.providers || {};\n          const entries = Object.entries(providers);\n          \n          resultDiv.innerHTML = `\n            <div style=\"padding: 16px; background: var(--bg-tertiary); border-radius: 8px;\">\n              <div style=\"font-weight: 600; margin-bottom: 12px;\">Sync Results</div>\n              <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\n                ${entries.map(([provider, result]) => `\n                  <div style=\"padding: 8px 12px; background: ${result.status === 'success' ? 'rgba(34, 197, 94, 0.1)' : result.status === 'skipped' ? 'var(--bg-secondary)' : 'rgba(239, 68, 68, 0.1)'}; border-radius: 6px; font-size: 12px;\">\n                    <span style=\"font-weight: 600; text-transform: capitalize;\">${provider}</span>\n                    ${result.status === 'success' ? `<span style=\"color: var(--success);\">  ${result.synced} models</span>` : ''}\n                    ${result.status === 'skipped' ? `<span style=\"color: var(--text-tertiary);\"> - ${result.reason}</span>` : ''}\n                    ${result.status === 'error' ? `<span style=\"color: var(--error);\">  ${result.error}</span>` : ''}\n                  </div>\n                `).join('')}\n              </div>\n              <div style=\"margin-top: 12px; font-size: 13px; color: var(--success);\">\n                Total: ${response.data?.totalModels || 0} models synced\n              </div>\n            </div>\n          `;\n        }\n        \n        toast.success(`Synced ${response.data?.totalModels || 0} models`);\n        loadMetadataSyncStatus();\n        \n      } catch (error) {\n        toast.error('Failed to sync metadata');\n        if (resultDiv) {\n          (resultDiv as HTMLElement).style.display = 'block';\n          resultDiv.innerHTML = '<div style=\"color: var(--error);\">Sync failed. Check console for details.</div>';\n        }\n      } finally {\n        (syncAllBtn as HTMLButtonElement).disabled = false;\n        (syncAllBtn as HTMLButtonElement).textContent = ' Sync All Providers';\n      }\n    });\n  }\n  \n  // Browse models by provider\n  const browseModelsBtn = container.querySelector('#browse-models-btn');\n  if (browseModelsBtn) {\n    on(browseModelsBtn as HTMLElement, 'click', async () => {\n      const providerSelect = container.querySelector('#browse-provider-select') as HTMLSelectElement;\n      const contentDiv = container.querySelector('#models-browser-content');\n      const provider = providerSelect?.value;\n      \n      if (!provider) {\n        toast.info('Please select a provider');\n        return;\n      }\n      \n      if (contentDiv) {\n        contentDiv.innerHTML = '<div style=\"text-align: center; padding: 20px;\">Loading models...</div>';\n      }\n      \n      try {\n        const response = await http.get<{\n          success: boolean;\n          textModels: Array<{ model_id: string; display_name: string; context_tokens: number; price_input: number; price_output: number }>;\n          visionModels: Array<{ model_id: string; display_name: string }>;\n          embeddingModels: Array<{ model_id: string; display_name: string }>;\n        }>(`/api/llm/metadata/${provider}`);\n        \n        const { textModels = [], visionModels = [], embeddingModels = [] } = response.data || {};\n        \n        if (contentDiv) {\n          if (textModels.length === 0 && embeddingModels.length === 0) {\n            contentDiv.innerHTML = '<div style=\"text-align: center; padding: 40px; color: var(--text-tertiary);\">No models found for this provider. Try syncing first.</div>';\n          } else {\n            contentDiv.innerHTML = `\n              <div style=\"display: grid; gap: 16px;\">\n                ${textModels.length > 0 ? `\n                  <div>\n                    <h5 style=\"margin-bottom: 8px; color: var(--text-secondary);\">Text Models (${textModels.length})</h5>\n                    <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 8px;\">\n                      ${textModels.map(m => `\n                        <div style=\"padding: 12px; background: var(--bg-tertiary); border-radius: 8px; font-size: 12px;\">\n                          <div style=\"font-weight: 600; margin-bottom: 4px;\">${m.display_name || m.model_id}</div>\n                          <div style=\"color: var(--text-tertiary); font-family: monospace; font-size: 11px;\">${m.model_id}</div>\n                          <div style=\"margin-top: 8px; display: flex; gap: 12px; color: var(--text-secondary);\">\n                            <span title=\"Context Window\"> ${m.context_tokens ? (m.context_tokens / 1000).toFixed(0) + 'K' : '-'}</span>\n                            <span title=\"Input Price\"> $${m.price_input?.toFixed(2) || '-'}/1M</span>\n                            <span title=\"Output Price\"> $${m.price_output?.toFixed(2) || '-'}/1M</span>\n                          </div>\n                        </div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : ''}\n                ${embeddingModels.length > 0 ? `\n                  <div>\n                    <h5 style=\"margin-bottom: 8px; color: var(--text-secondary);\">Embedding Models (${embeddingModels.length})</h5>\n                    <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\n                      ${embeddingModels.map(m => `\n                        <div style=\"padding: 8px 12px; background: var(--bg-tertiary); border-radius: 6px; font-size: 12px;\">\n                          ${m.display_name || m.model_id}\n                        </div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : ''}\n              </div>\n            `;\n          }\n        }\n      } catch (error) {\n        if (contentDiv) {\n          contentDiv.innerHTML = '<div style=\"color: var(--error);\">Failed to load models</div>';\n        }\n      }\n    });\n  }\n  \n  // Auto-load metadata status if on models section\n  if (currentSection === 'models') {\n    loadMetadataSyncStatus();\n  }\n  \n  // Auto-load queue data if on queue section\n  if (currentSection === 'queue') {\n    loadQueueStatus();\n    loadQueueHistory();\n    loadFailedItems();\n  }\n\n  // Save graph config (Supabase Graph)\n  const saveGraphBtn = container.querySelector('#save-graph-config');\n  if (saveGraphBtn) {\n    on(saveGraphBtn as HTMLElement, 'click', async () => {\n      // Build the graph config object for Supabase Graph\n      const graphConfigValue = {\n        enabled: (container.querySelector('#graph-enabled') as HTMLInputElement)?.checked ?? true,\n        provider: 'supabase', // Always use Supabase graph\n        graphName: (container.querySelector('#graph-name') as HTMLInputElement)?.value || 'godmode',\n      };\n\n      try {\n        // Save as a single 'graph' key with the config object\n        await saveConfig('graph', graphConfigValue, 'graph');\n        \n        toast.success('Graph configuration saved!');\n        console.log('[AdminPanel] Saved graph config:', graphConfigValue);\n      } catch (error) {\n        console.error('[AdminPanel] Error saving graph config:', error);\n        toast.error('Failed to save graph configuration');\n      }\n    });\n  }\n\n  // Test graph connection (Supabase Graph)\n  const testGraphBtn = container.querySelector('#test-graph-connection');\n  if (testGraphBtn) {\n    on(testGraphBtn as HTMLElement, 'click', async () => {\n      (testGraphBtn as HTMLElement).textContent = 'Testing...';\n      try {\n        // Supabase graph uses existing Supabase connection\n        const testConfig = {\n          provider: 'supabase',\n          graphName: (container.querySelector('#graph-name') as HTMLInputElement)?.value || 'godmode',\n        };\n        \n        console.log('[AdminPanel] Testing Supabase graph connection');\n        \n        const response = await http.post<{ success: boolean; ok?: boolean; message?: string; error?: string }>('/api/graph/test', testConfig);\n        if (response.data.success || response.data.ok) {\n          toast.success('Supabase graph connection successful!');\n        } else {\n          toast.error(response.data.message || response.data.error || 'Connection failed');\n        }\n      } catch (error) {\n        console.error('[AdminPanel] Graph test error:', error);\n        toast.error('Graph connection test failed');\n      }\n      (testGraphBtn as HTMLElement).textContent = 'Test Connection';\n    });\n  }\n\n  // Load graph overview\n  const loadGraphOverviewBtn = container.querySelector('#load-graph-overview');\n  if (loadGraphOverviewBtn) {\n    on(loadGraphOverviewBtn as HTMLElement, 'click', async () => {\n      await loadGraphOverview();\n      renderAdminPanel(container);\n    });\n  }\n  const refreshGraphOverviewBtn = container.querySelector('#refresh-graph-overview');\n  if (refreshGraphOverviewBtn) {\n    on(refreshGraphOverviewBtn as HTMLElement, 'click', async () => {\n      await loadGraphOverview();\n      renderAdminPanel(container);\n      toast.info('Graph overview refreshed');\n    });\n  }\n  const openGraphTabBtn = container.querySelector('#open-graph-tab');\n  if (openGraphTabBtn) {\n    on(openGraphTabBtn as HTMLElement, 'click', () => {\n      document.querySelector('.nav-item[data-tab=\"graph\"]')?.dispatchEvent(new MouseEvent('click', { bubbles: true }));\n    });\n  }\n\n  // Load ontology\n  const loadOntologyBtn = container.querySelector('#load-ontology');\n  if (loadOntologyBtn) {\n    on(loadOntologyBtn as HTMLElement, 'click', async () => {\n      await loadOntologyData();\n      renderAdminPanel(container);\n    });\n  }\n  const reloadOntologyBtn = container.querySelector('#reload-ontology');\n  if (reloadOntologyBtn) {\n    on(reloadOntologyBtn as HTMLElement, 'click', async () => {\n      ontologyLoaded = false;\n      await loadOntologyData();\n      renderAdminPanel(container);\n      toast.info('Ontology reloaded');\n    });\n  }\n\n  // Save prompts\n  const savePromptsBtn = container.querySelector('#save-prompts');\n  if (savePromptsBtn) {\n    on(savePromptsBtn as HTMLElement, 'click', async () => {\n      const promptElements = container.querySelectorAll('[data-prompt-key]');\n      let savedCount = 0;\n      \n      for (const textarea of promptElements) {\n        const key = textarea.getAttribute('data-prompt-key')!;\n        const value = (textarea as HTMLTextAreaElement).value;\n        \n        if (value && value.trim()) {\n          try {\n            await http.put(`/api/system/prompts/${key}`, { prompt_template: value.trim() });\n            savedCount++;\n            \n            // Update status indicator\n            const statusEl = container.querySelector(`#status-${key}`);\n            if (statusEl) {\n              statusEl.textContent = ' Saved';\n              statusEl.className = 'prompt-status saved';\n            }\n          } catch (error) {\n            console.warn(`Failed to save prompt ${key}:`, error);\n            const statusEl = container.querySelector(`#status-${key}`);\n            if (statusEl) {\n              statusEl.textContent = ' Error';\n              statusEl.className = 'prompt-status error';\n            }\n          }\n        }\n      }\n      \n      if (savedCount > 0) {\n        toast.success(`${savedCount} prompt(s) saved successfully`);\n      } else {\n        toast.info('No prompts to save');\n      }\n    });\n  }\n\n  // Reload prompts\n  const reloadPromptsBtn = container.querySelector('#reload-prompts');\n  if (reloadPromptsBtn) {\n    on(reloadPromptsBtn as HTMLElement, 'click', async () => {\n      await loadSystemPrompts();\n      renderAdminPanel(container);\n      toast.info('Prompts reloaded from database');\n    });\n  }\n\n  // View version history\n  container.querySelectorAll('[data-view-versions]').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const key = btn.getAttribute('data-view-versions')!;\n      const historyDiv = container.querySelector(`#versions-${key}`) as HTMLElement;\n      const listDiv = historyDiv?.querySelector('.version-list') as HTMLElement;\n      \n      if (!historyDiv || !listDiv) return;\n      \n      // Toggle visibility\n      if (!historyDiv.classList.contains('hidden')) {\n        historyDiv.classList.add('hidden');\n        return;\n      }\n      \n      // Load versions\n      listDiv.innerHTML = '<p class=\"text-muted\">Loading versions...</p>';\n      historyDiv.classList.remove('hidden');\n      \n      try {\n        const response = await http.get<{ current_version: number; versions: Array<{ id: string; version: number; created_at: string }> }>(`/api/system/prompts/${key}/versions`);\n        const versions = response.data?.versions || [];\n        const currentVersion = response.data?.current_version || 1;\n        \n        if (versions.length === 0) {\n          listDiv.innerHTML = `\n            <p class=\"text-muted\">No previous versions. Current version: ${currentVersion}</p>\n            <p class=\"text-sm text-muted\">Versions are saved automatically when you edit a prompt.</p>\n          `;\n          return;\n        }\n        \n        listDiv.innerHTML = `\n          <p class=\"text-sm\"><strong>Current version:</strong> ${currentVersion}</p>\n          <div class=\"version-items\">\n            ${versions.map(v => `\n              <div class=\"version-item\">\n                <div class=\"version-info\">\n                  <span class=\"version-number\">v${v.version}</span>\n                  <span class=\"version-date\">${new Date(v.created_at).toLocaleString()}</span>\n                </div>\n                <div class=\"version-actions\">\n                  <button class=\"btn-sm\" data-preview-version=\"${key}:${v.version}\">Preview</button>\n                  <button class=\"btn-sm btn-primary\" data-restore-version=\"${key}:${v.version}\">Restore</button>\n                </div>\n              </div>\n            `).join('')}\n          </div>\n        `;\n        \n        // Bind restore buttons\n        listDiv.querySelectorAll('[data-restore-version]').forEach(restoreBtn => {\n          on(restoreBtn as HTMLElement, 'click', async () => {\n            const [promptKey, versionStr] = restoreBtn.getAttribute('data-restore-version')!.split(':');\n            const version = parseInt(versionStr, 10);\n            \n            if (!confirm(`Restore prompt \"${promptKey}\" to version ${version}? The current version will be saved in history.`)) {\n              return;\n            }\n            \n            try {\n              await http.post(`/api/system/prompts/${promptKey}/restore`, { version });\n              toast.success(`Restored to version ${version}`);\n              await loadSystemPrompts();\n              renderAdminPanel(container);\n            } catch (error) {\n              toast.error('Failed to restore version');\n            }\n          });\n        });\n        \n        // Bind preview buttons\n        listDiv.querySelectorAll('[data-preview-version]').forEach(previewBtn => {\n          on(previewBtn as HTMLElement, 'click', async () => {\n            const [promptKey, versionStr] = previewBtn.getAttribute('data-preview-version')!.split(':');\n            const version = parseInt(versionStr, 10);\n            \n            try {\n              const response = await http.get<{ version: { prompt_template: string } }>(`/api/system/prompts/${promptKey}/versions/${version}`);\n              const template = response.data?.version?.prompt_template || '';\n              \n              // Show in a modal or alert for now\n              const previewModal = document.createElement('div');\n              previewModal.className = 'modal-overlay';\n              previewModal.innerHTML = `\n                <div class=\"modal-content\" style=\"max-width: 800px; max-height: 80vh; overflow: auto;\">\n                  <div class=\"modal-header\">\n                    <h3>Version ${version} Preview</h3>\n                    <button class=\"modal-close\">&times;</button>\n                  </div>\n                  <div class=\"modal-body\">\n                    <pre style=\"white-space: pre-wrap; font-size: 12px; background: var(--bg-tertiary); padding: 1rem; border-radius: 8px;\">${template.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>\n                  </div>\n                </div>\n              `;\n              document.body.appendChild(previewModal);\n              \n              previewModal.querySelector('.modal-close')?.addEventListener('click', () => {\n                previewModal.remove();\n              });\n              previewModal.addEventListener('click', (e) => {\n                if (e.target === previewModal) previewModal.remove();\n              });\n            } catch (error) {\n              toast.error('Failed to load version preview');\n            }\n          });\n        });\n        \n      } catch (error) {\n        listDiv.innerHTML = '<p class=\"text-error\">Failed to load version history</p>';\n      }\n    });\n  });\n\n  // Save processing\n  const saveProcBtn = container.querySelector('#save-processing');\n  if (saveProcBtn) {\n    on(saveProcBtn as HTMLElement, 'click', async () => {\n      await saveConfig('chunk_size', parseInt((container.querySelector('#proc-chunk-size') as HTMLInputElement)?.value || '1000'), 'processing');\n      await saveConfig('chunk_overlap', parseInt((container.querySelector('#proc-chunk-overlap') as HTMLInputElement)?.value || '200'), 'processing');\n      await saveConfig('max_tokens', parseInt((container.querySelector('#proc-max-tokens') as HTMLInputElement)?.value || '4096'), 'processing');\n      await saveConfig('temperature', parseFloat((container.querySelector('#proc-temperature') as HTMLInputElement)?.value || '0.7'), 'processing');\n      await saveConfig('auto_process', (container.querySelector('#proc-auto-process') as HTMLInputElement)?.checked, 'processing');\n      await saveConfig('parallel_jobs', parseInt((container.querySelector('#proc-parallel-jobs') as HTMLInputElement)?.value || '3'), 'processing');\n    });\n  }\n\n  // Save Team Analysis settings\n  const saveTeamAnalysisBtn = container.querySelector('#save-team-analysis');\n  if (saveTeamAnalysisBtn) {\n    on(saveTeamAnalysisBtn as HTMLElement, 'click', async () => {\n      const enabled = (container.querySelector('#team-analysis-enabled') as HTMLInputElement)?.checked ?? true;\n      const access = (container.querySelector('#team-analysis-access') as HTMLSelectElement)?.value || 'admin_only';\n      await saveTeamAnalysisSettings(enabled, access);\n      renderAdminPanel(container);\n    });\n  }\n\n  // =========================\n  // BILLING SECTION EVENTS\n  // =========================\n  \n  // Exchange rate auto toggle\n  const exchangeRateAutoCheckbox = container.querySelector('#exchange-rate-auto');\n  if (exchangeRateAutoCheckbox) {\n    on(exchangeRateAutoCheckbox as HTMLElement, 'change', () => {\n      const isAuto = (exchangeRateAutoCheckbox as HTMLInputElement).checked;\n      const manualGroup = container.querySelector('#manual-rate-group') as HTMLElement;\n      const refreshBtn = container.querySelector('#refresh-rate-btn') as HTMLButtonElement;\n      if (manualGroup) {\n        manualGroup.style.display = isAuto ? 'none' : 'block';\n      }\n      if (refreshBtn) {\n        refreshBtn.disabled = !isAuto;\n      }\n    });\n  }\n  \n  // Refresh exchange rate button\n  const refreshRateBtn = container.querySelector('#refresh-rate-btn');\n  if (refreshRateBtn) {\n    on(refreshRateBtn as HTMLElement, 'click', async () => {\n      const btn = refreshRateBtn as HTMLButtonElement;\n      btn.disabled = true;\n      btn.textContent = 'Refreshing...';\n      \n      try {\n        const result = await billingService.refreshExchangeRate();\n        if (result.success && result.rate) {\n          const rateDisplay = container.querySelector('#current-rate-display');\n          const sourceDisplay = container.querySelector('#rate-source');\n          if (rateDisplay) rateDisplay.textContent = result.rate.toFixed(4);\n          if (sourceDisplay) sourceDisplay.textContent = result.source || 'api';\n          toast.success(`Rate updated: ${result.rate.toFixed(4)}`);\n        } else {\n          toast.error(result.error || 'Failed to refresh rate');\n        }\n      } catch (e) {\n        toast.error('Failed to refresh rate');\n      } finally {\n        btn.disabled = false;\n        btn.textContent = 'Refresh Rate';\n      }\n    });\n  }\n  \n  // Save exchange rate settings\n  const saveExchangeRateBtn = container.querySelector('#save-exchange-rate-btn');\n  if (saveExchangeRateBtn) {\n    on(saveExchangeRateBtn as HTMLElement, 'click', async () => {\n      const isAuto = (container.querySelector('#exchange-rate-auto') as HTMLInputElement)?.checked ?? true;\n      const manualRate = parseFloat((container.querySelector('#exchange-rate-manual') as HTMLInputElement)?.value || '0.92');\n      \n      const result = await billingService.setExchangeRateMode(isAuto, manualRate);\n      \n      if (result.success) {\n        toast.success('Exchange rate settings saved');\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to save');\n      }\n    });\n  }\n  \n  // Save global pricing config\n  const saveGlobalPricingBtn = container.querySelector('#save-global-pricing-btn');\n  if (saveGlobalPricingBtn) {\n    on(saveGlobalPricingBtn as HTMLElement, 'click', async () => {\n      const fixedMarkup = parseFloat((container.querySelector('#global-markup-percent') as HTMLInputElement)?.value || '0');\n      const periodType = (container.querySelector('#global-period-type') as HTMLSelectElement)?.value || 'monthly';\n      \n      const result = await billingService.setGlobalPricingConfig({\n        fixed_markup_percent: fixedMarkup,\n        period_type: periodType as 'monthly' | 'weekly'\n      });\n      \n      if (result.success) {\n        toast.success('Global pricing saved');\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to save');\n      }\n    });\n  }\n  \n  // Add tier button\n  const addTierBtn = container.querySelector('#add-tier-btn');\n  if (addTierBtn) {\n    on(addTierBtn as HTMLElement, 'click', () => {\n      // Add a new tier to the list\n      globalPricingTiers.push({\n        id: '',\n        pricing_config_id: globalPricingConfig?.id || '',\n        token_limit: 100000,\n        markup_percent: 20,\n        name: `Tier ${globalPricingTiers.length + 1}`,\n        tier_order: globalPricingTiers.length\n      });\n      renderAdminPanel(container);\n    });\n  }\n  \n  // Remove tier buttons\n  container.querySelectorAll('.remove-tier-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const index = parseInt(btn.getAttribute('data-index') || '0', 10);\n      globalPricingTiers.splice(index, 1);\n      renderAdminPanel(container);\n    });\n  });\n  \n  // Tier unlimited checkboxes\n  container.querySelectorAll('.tier-unlimited').forEach(checkbox => {\n    on(checkbox as HTMLElement, 'change', () => {\n      const row = (checkbox as HTMLElement).closest('.tier-row') as HTMLElement;\n      const limitInput = row?.querySelector('.tier-limit') as HTMLInputElement;\n      if (limitInput) {\n        limitInput.disabled = (checkbox as HTMLInputElement).checked;\n        if ((checkbox as HTMLInputElement).checked) {\n          limitInput.value = '';\n        }\n      }\n    });\n  });\n  \n  // Save tiers button\n  const saveTiersBtn = container.querySelector('#save-tiers-btn');\n  if (saveTiersBtn) {\n    on(saveTiersBtn as HTMLElement, 'click', async () => {\n      const tiers: Array<{ token_limit: number | null; markup_percent: number; name?: string }> = [];\n      container.querySelectorAll('.tier-row').forEach(row => {\n        const name = (row.querySelector('.tier-name') as HTMLInputElement)?.value || '';\n        const limitValue = (row.querySelector('.tier-limit') as HTMLInputElement)?.value;\n        const markup = parseFloat((row.querySelector('.tier-markup') as HTMLInputElement)?.value || '0');\n        const unlimited = (row.querySelector('.tier-unlimited') as HTMLInputElement)?.checked;\n        \n        tiers.push({\n          token_limit: unlimited ? null : (limitValue ? parseInt(limitValue, 10) : null),\n          markup_percent: markup,\n          name: name || undefined\n        });\n      });\n      \n      const result = await billingService.setGlobalPricingTiers(tiers);\n      if (result.success) {\n        toast.success('Pricing tiers saved');\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to save tiers');\n      }\n    });\n  }\n  \n  // Refresh billing button\n  const refreshBillingBtn = container.querySelector('#refresh-billing-btn');\n  if (refreshBillingBtn) {\n    on(refreshBillingBtn as HTMLElement, 'click', async () => {\n      billingLoaded = false;\n      await loadBillingData();\n      renderAdminPanel(container);\n      toast.info('Billing data refreshed');\n    });\n  }\n  \n  // Add balance buttons\n  container.querySelectorAll('.add-balance-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const projectId = btn.getAttribute('data-project-id');\n      const projectName = btn.getAttribute('data-project-name');\n      if (!projectId) return;\n      \n      const amount = prompt(`Enter amount in EUR to add to \"${projectName}\":`);\n      if (!amount || isNaN(parseFloat(amount))) return;\n      \n      const result = await billingService.creditProjectBalance(projectId, parseFloat(amount));\n      if (result.success) {\n        toast.success(`Added ${parseFloat(amount).toFixed(2)} to ${projectName}. New balance: ${result.new_balance?.toFixed(2)}`);\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to add balance');\n      }\n    });\n  });\n  \n  // Toggle unlimited buttons\n  container.querySelectorAll('.toggle-unlimited-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const projectId = btn.getAttribute('data-project-id');\n      const isUnlimited = btn.getAttribute('data-unlimited') === 'true';\n      if (!projectId) return;\n      \n      const action = isUnlimited ? 'disable unlimited mode' : 'enable unlimited mode';\n      if (!confirm(`Are you sure you want to ${action} for this project?`)) return;\n      \n      const result = await billingService.setProjectUnlimited(projectId, !isUnlimited);\n      if (result.success) {\n        toast.success(`Unlimited mode ${isUnlimited ? 'disabled' : 'enabled'}`);\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to update');\n      }\n    });\n  });\n\n  // Refresh audit\n  const refreshAuditBtn = container.querySelector('#refresh-audit');\n  if (refreshAuditBtn) {\n    on(refreshAuditBtn as HTMLElement, 'click', async () => {\n      await loadAuditLogs();\n      renderAdminPanel(container);\n    });\n  }\n}\n\n/**\n * Render admin panel\n */\nfunction renderAdminPanel(container: HTMLElement): void {\n  container.innerHTML = `\n    <div class=\"admin-panel\">\n      <div class=\"admin-header\">\n        <div class=\"admin-header-content\">\n          <div class=\"admin-icon\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"32\" height=\"32\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/>\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\n            </svg>\n          </div>\n          <div class=\"admin-title\">\n            <h2>Platform Administration</h2>\n            <p>System configuration for superadmins</p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"admin-body\">\n        <nav class=\"admin-nav\">\n          ${renderNav()}\n        </nav>\n\n        <main class=\"admin-content\">\n          ${isLoading ? '<div class=\"loading-spinner\">Loading...</div>' : renderSectionContent()}\n        </main>\n      </div>\n    </div>\n  `;\n\n  bindSectionEvents(container);\n}\n\n/**\n * Initialize and mount admin panel\n */\nexport async function initAdminPanel(container: HTMLElement): Promise<void> {\n  // Check if user is superadmin\n  const state = appStore.getState();\n  if (state.currentUser?.role !== 'superadmin') {\n    container.innerHTML = `\n      <div class=\"admin-panel\">\n        <div class=\"admin-header\">\n          <h2>Access Denied</h2>\n          <p>You need superadmin privileges to access this section.</p>\n        </div>\n      </div>\n    `;\n    return;\n  }\n\n  isLoading = true;\n  renderAdminPanel(container);\n\n  // Load data\n  await Promise.all([\n    loadSystemConfig(),\n    loadProviders(),\n    loadAuditLogs(),\n    loadSystemPrompts(),\n    loadSecrets(),\n  ]);\n\n  isLoading = false;\n  renderAdminPanel(container);\n}\n\nexport default initAdminPanel;\n","/**\n * History Panel Component\n * Display processing history timeline\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { formatRelativeTime, formatDate } from '../utils/format';\nimport { toast } from '../services/toast';\n\nexport interface HistoryEntry {\n  id: string;\n  action: 'create' | 'update' | 'delete' | 'restore' | 'process' | 'upload';\n  entityType: string;\n  entityId: string;\n  entityName?: string;\n  changes?: Record<string, { old: unknown; new: unknown }>;\n  actor: {\n    id: string;\n    name: string;\n    email?: string;\n  };\n  timestamp: string;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface HistoryPanelProps {\n  onRestore?: (entry: HistoryEntry) => void;\n  onExport?: () => void;\n}\n\nlet entries: HistoryEntry[] = [];\nlet page = 1;\nlet hasMore = true;\nlet loading = false;\nlet currentFilters = {\n  action: '' as string,\n  entityType: '' as string,\n  dateFrom: '' as string,\n  dateTo: '' as string,\n};\n\n/**\n * Create history panel\n */\nexport function createHistoryPanel(props: HistoryPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'history-panel' });\n\n  panel.innerHTML = `\n    <div class=\"history-filters\">\n      <select id=\"history-action-filter\" class=\"filter-select\">\n        <option value=\"\">All Actions</option>\n        <option value=\"create\">Created</option>\n        <option value=\"update\">Updated</option>\n        <option value=\"delete\">Deleted</option>\n        <option value=\"restore\">Restored</option>\n        <option value=\"process\">Processed</option>\n        <option value=\"upload\">Uploaded</option>\n      </select>\n      <select id=\"history-entity-filter\" class=\"filter-select\">\n        <option value=\"\">All Types</option>\n        <option value=\"document\">Documents</option>\n        <option value=\"fact\">Facts</option>\n        <option value=\"question\">Questions</option>\n        <option value=\"risk\">Risks</option>\n        <option value=\"action\">Actions</option>\n        <option value=\"decision\">Decisions</option>\n        <option value=\"contact\">Contacts</option>\n        <option value=\"email\">Emails</option>\n      </select>\n      <input type=\"date\" id=\"history-date-from\" class=\"filter-date\" placeholder=\"From\">\n      <input type=\"date\" id=\"history-date-to\" class=\"filter-date\" placeholder=\"To\">\n      <button class=\"btn btn-sm\" id=\"history-clear-filters\">Clear</button>\n    </div>\n    <div class=\"history-content\" id=\"history-content\">\n      <div class=\"loading\">Loading history...</div>\n    </div>\n  `;\n\n  // Bind filter events\n  bindFilters(panel, props);\n\n  // Initial load\n  loadHistory(panel, props);\n\n  return panel;\n}\n\n/**\n * Bind filter event handlers\n */\nfunction bindFilters(panel: HTMLElement, props: HistoryPanelProps): void {\n  const actionFilter = panel.querySelector('#history-action-filter') as HTMLSelectElement;\n  const entityFilter = panel.querySelector('#history-entity-filter') as HTMLSelectElement;\n  const dateFromInput = panel.querySelector('#history-date-from') as HTMLInputElement;\n  const dateToInput = panel.querySelector('#history-date-to') as HTMLInputElement;\n  const clearBtn = panel.querySelector('#history-clear-filters') as HTMLButtonElement;\n\n  const applyFilters = () => {\n    currentFilters = {\n      action: actionFilter.value,\n      entityType: entityFilter.value,\n      dateFrom: dateFromInput.value,\n      dateTo: dateToInput.value,\n    };\n    entries = [];\n    page = 1;\n    hasMore = true;\n    loadHistory(panel, props);\n  };\n\n  on(actionFilter, 'change', applyFilters);\n  on(entityFilter, 'change', applyFilters);\n  on(dateFromInput, 'change', applyFilters);\n  on(dateToInput, 'change', applyFilters);\n\n  on(clearBtn, 'click', () => {\n    actionFilter.value = '';\n    entityFilter.value = '';\n    dateFromInput.value = '';\n    dateToInput.value = '';\n    applyFilters();\n  });\n}\n\n/**\n * Load history entries\n */\nasync function loadHistory(panel: HTMLElement, props: HistoryPanelProps): Promise<void> {\n  if (loading) return;\n\n  const content = panel.querySelector('#history-content') as HTMLElement;\n  \n  if (page === 1) {\n    content.innerHTML = '<div class=\"loading\">Loading history...</div>';\n  }\n\n  loading = true;\n\n  try {\n    const params = new URLSearchParams({ page: String(page), limit: '30' });\n    if (currentFilters.action) params.set('action', currentFilters.action);\n    if (currentFilters.entityType) params.set('entityType', currentFilters.entityType);\n    if (currentFilters.dateFrom) params.set('dateFrom', currentFilters.dateFrom);\n    if (currentFilters.dateTo) params.set('dateTo', currentFilters.dateTo);\n\n    const response = await http.get<{ entries: HistoryEntry[]; hasMore: boolean }>(\n      `/api/history?${params}`\n    );\n\n    entries = page === 1 ? response.data.entries : [...entries, ...response.data.entries];\n    hasMore = response.data.hasMore;\n    page++;\n\n    renderHistory(content, props);\n  } catch {\n    if (page === 1) {\n      content.innerHTML = '<div class=\"error\">Failed to load history</div>';\n    }\n  } finally {\n    loading = false;\n  }\n}\n\n/**\n * Render history timeline\n */\nfunction renderHistory(container: HTMLElement, props: HistoryPanelProps): void {\n  if (entries.length === 0) {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <span class=\"empty-icon\"></span>\n        <p>No history entries found</p>\n        <span class=\"empty-hint\">Processing and editing activity will appear here</span>\n      </div>\n    `;\n    return;\n  }\n\n  // Group by date\n  const grouped = groupByDate(entries);\n\n  container.innerHTML = `\n    <div class=\"history-timeline\">\n      ${Object.entries(grouped).map(([date, items]) => `\n        <div class=\"history-date-group\">\n          <div class=\"history-date-header\">${date}</div>\n          <div class=\"history-items\">\n            ${items.map(entry => renderEntry(entry, props)).join('')}\n          </div>\n        </div>\n      `).join('')}\n    </div>\n    ${hasMore ? `\n      <div class=\"history-load-more\">\n        <button class=\"btn btn-secondary\" id=\"load-more-history\">Load More</button>\n      </div>\n    ` : `\n      <div class=\"history-end\">\n        <span>End of history</span>\n      </div>\n    `}\n  `;\n\n  // Bind load more\n  const loadMoreBtn = container.querySelector('#load-more-history');\n  if (loadMoreBtn) {\n    on(loadMoreBtn as HTMLElement, 'click', async () => {\n      const panel = container.closest('.history-panel') as HTMLElement;\n      await loadHistory(panel, props);\n    });\n  }\n\n  // Bind expand buttons\n  container.querySelectorAll('[data-action=\"expand\"]').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const changesEl = btn.closest('.history-entry')?.querySelector('.history-changes');\n      if (changesEl) {\n        changesEl.classList.toggle('expanded');\n        btn.textContent = changesEl.classList.contains('expanded') ? 'Hide details' : 'Show details';\n      }\n    });\n  });\n\n  // Bind restore buttons\n  if (props.onRestore) {\n    container.querySelectorAll('[data-action=\"restore\"]').forEach(btn => {\n      on(btn as HTMLElement, 'click', () => {\n        const entryId = btn.getAttribute('data-entry-id');\n        const entry = entries.find(e => e.id === entryId);\n        if (entry && props.onRestore) {\n          props.onRestore(entry);\n        }\n      });\n    });\n  }\n}\n\n/**\n * Render single entry\n */\nfunction renderEntry(entry: HistoryEntry, props: HistoryPanelProps): string {\n  const actionIcons: Record<string, string> = {\n    create: '',\n    update: '',\n    delete: '',\n    restore: '',\n    process: '',\n    upload: '',\n  };\n\n  const actionColors: Record<string, string> = {\n    create: 'success',\n    update: 'info',\n    delete: 'danger',\n    restore: 'warning',\n    process: 'info',\n    upload: 'success',\n  };\n\n  const hasChanges = entry.changes && Object.keys(entry.changes).length > 0;\n\n  return `\n    <div class=\"history-entry ${actionColors[entry.action] || 'info'}\" data-entry-id=\"${entry.id}\">\n      <div class=\"history-icon\">${actionIcons[entry.action] || ''}</div>\n      <div class=\"history-content\">\n        <div class=\"history-summary\">\n          <strong>${escapeHtml(entry.actor.name)}</strong>\n          ${getActionVerb(entry.action)}\n          <span class=\"entity-type\">${entry.entityType}</span>\n          ${entry.entityName ? `\"${escapeHtml(entry.entityName)}\"` : ''}\n        </div>\n        <div class=\"history-time\">${formatRelativeTime(entry.timestamp)}</div>\n        \n        ${hasChanges ? `\n          <div class=\"history-changes\">\n            ${Object.entries(entry.changes!).slice(0, 5).map(([field, change]) => `\n              <div class=\"change-item\">\n                <span class=\"change-field\">${formatFieldName(field)}:</span>\n                <span class=\"change-old\">${formatValue(change.old)}</span>\n                <span class=\"change-arrow\"></span>\n                <span class=\"change-new\">${formatValue(change.new)}</span>\n              </div>\n            `).join('')}\n            ${Object.keys(entry.changes!).length > 5 ? `<div class=\"change-more\">+${Object.keys(entry.changes!).length - 5} more changes</div>` : ''}\n          </div>\n          <button class=\"btn-link\" data-action=\"expand\">Show details</button>\n        ` : ''}\n        \n        ${entry.action === 'delete' && props.onRestore ? `\n          <button class=\"btn btn-sm btn-secondary\" data-action=\"restore\" data-entry-id=\"${entry.id}\">\n            Restore\n          </button>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Get action verb\n */\nfunction getActionVerb(action: string): string {\n  const verbs: Record<string, string> = {\n    create: 'created',\n    update: 'updated',\n    delete: 'deleted',\n    restore: 'restored',\n    process: 'processed',\n    upload: 'uploaded',\n  };\n  return verbs[action] || action;\n}\n\n/**\n * Group entries by date\n */\nfunction groupByDate(items: HistoryEntry[]): Record<string, HistoryEntry[]> {\n  const groups: Record<string, HistoryEntry[]> = {};\n  const today = new Date().toDateString();\n  const yesterday = new Date(Date.now() - 86400000).toDateString();\n\n  items.forEach(item => {\n    const itemDate = new Date(item.timestamp);\n    let dateLabel: string;\n    \n    if (itemDate.toDateString() === today) {\n      dateLabel = 'Today';\n    } else if (itemDate.toDateString() === yesterday) {\n      dateLabel = 'Yesterday';\n    } else {\n      dateLabel = itemDate.toLocaleDateString(undefined, { \n        weekday: 'long', \n        month: 'long', \n        day: 'numeric' \n      });\n    }\n\n    if (!groups[dateLabel]) {\n      groups[dateLabel] = [];\n    }\n    groups[dateLabel].push(item);\n  });\n\n  return groups;\n}\n\n/**\n * Format field name\n */\nfunction formatFieldName(field: string): string {\n  return field\n    .replace(/_/g, ' ')\n    .replace(/([A-Z])/g, ' $1')\n    .replace(/^./, str => str.toUpperCase());\n}\n\n/**\n * Format value for display\n */\nfunction formatValue(value: unknown): string {\n  if (value === null || value === undefined) return '(empty)';\n  if (typeof value === 'boolean') return value ? 'Yes' : 'No';\n  if (typeof value === 'object') {\n    const str = JSON.stringify(value);\n    return str.length > 50 ? str.substring(0, 47) + '...' : str;\n  }\n  const str = String(value);\n  return str.length > 50 ? str.substring(0, 47) + '...' : str;\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Export history\n */\nexport async function exportHistory(format: 'json' | 'csv' = 'json'): Promise<void> {\n  try {\n    const params = new URLSearchParams({ format, limit: '1000' });\n    if (currentFilters.action) params.set('action', currentFilters.action);\n    if (currentFilters.entityType) params.set('entityType', currentFilters.entityType);\n    if (currentFilters.dateFrom) params.set('dateFrom', currentFilters.dateFrom);\n    if (currentFilters.dateTo) params.set('dateTo', currentFilters.dateTo);\n\n    const response = await fetch(`/api/history/export?${params}`);\n    const blob = await response.blob();\n    \n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `history-export.${format}`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n    \n    toast.success('History exported successfully');\n  } catch {\n    toast.error('Failed to export history');\n  }\n}\n\nexport default createHistoryPanel;\n","/**\n * Legacy Bridge\n * Provides compatibility layer for legacy index.html code\n * \n * This module exposes the new modular services and stores as global\n * variables that match the original monolithic code's expectations.\n */\n\nimport { appStore, Project, User } from '../stores/app';\nimport { uiStore } from '../stores/ui';\nimport { dataStore, Question, Risk, Action, Decision, Contact } from '../stores/data';\nimport { chartsStore } from '../stores/charts';\nimport { http, api } from '../services/api';\nimport type { ChatMessage } from '../stores/data';\nimport type { MainTab } from '../stores/ui';\nimport { toast } from '../services/toast';\nimport { theme } from '../services/theme';\nimport { storage } from '../services/storage';\nimport { shortcuts } from '../services/shortcuts';\nimport { undoManager } from '../services/undo';\n\n// ============================================================================\n// Global Variable Compatibility\n// ============================================================================\n\n/**\n * Legacy global variable getters/setters\n * These provide compatibility with code that expects global variables\n */\n\n// Current project (was: currentProject)\nObject.defineProperty(window, 'currentProject', {\n  get: () => appStore.getState().currentProject,\n  set: (value: Project | null) => appStore.setCurrentProject(value),\n  configurable: true,\n});\n\n// Current project ID (was: currentProjectId)\nObject.defineProperty(window, 'currentProjectId', {\n  get: () => appStore.getState().currentProjectId,\n  set: (value: string | null) => appStore.setCurrentProjectId(value),\n  configurable: true,\n});\n\n// Current user (was: currentUser)\nObject.defineProperty(window, 'currentUser', {\n  get: () => appStore.getState().currentUser,\n  set: (value: User | null) => appStore.setCurrentUser(value),\n  configurable: true,\n});\n\n// Auth configured (was: authConfigured)\nObject.defineProperty(window, 'authConfigured', {\n  get: () => appStore.getState().authConfigured,\n  set: (value: boolean) => appStore.setAuthConfigured(value),\n  configurable: true,\n});\n\n// Current tab (was: currentTab)\nObject.defineProperty(window, 'currentTab', {\n  get: () => uiStore.getState().currentTab,\n  set: (value: MainTab) => uiStore.setTab(value),\n  configurable: true,\n});\n\n// Questions (was: questions)\nObject.defineProperty(window, 'questions', {\n  get: () => dataStore.getState().questions,\n  set: (value: Question[]) => dataStore.setQuestions(value),\n  configurable: true,\n});\n\n// Risks (was: risks)\nObject.defineProperty(window, 'risks', {\n  get: () => dataStore.getState().risks,\n  set: (value: Risk[]) => dataStore.setRisks(value),\n  configurable: true,\n});\n\n// Actions (was: actions)\nObject.defineProperty(window, 'actions', {\n  get: () => dataStore.getState().actions,\n  set: (value: Action[]) => dataStore.setActions(value),\n  configurable: true,\n});\n\n// Decisions (was: decisions)\nObject.defineProperty(window, 'decisions', {\n  get: () => dataStore.getState().decisions,\n  set: (value: Decision[]) => dataStore.setDecisions(value),\n  configurable: true,\n});\n\n// Contacts (was: contacts)\nObject.defineProperty(window, 'contacts', {\n  get: () => dataStore.getState().contacts,\n  set: (value: Contact[]) => dataStore.setContacts(value),\n  configurable: true,\n});\n\n// Chat history (was: chatHistory)\nObject.defineProperty(window, 'chatHistory', {\n  get: () => dataStore.getState().chatHistory,\n  set: (value: ChatMessage[]) => dataStore.setChatHistory(value),\n  configurable: true,\n});\n\n// ============================================================================\n// Legacy Function Compatibility\n// ============================================================================\n\n/**\n * Legacy API function\n * Maps to new http service\n */\n(window as unknown as Record<string, unknown>).api = async function legacyApi(\n  endpoint: string,\n  method = 'GET',\n  body?: unknown\n): Promise<unknown> {\n  try {\n    let response;\n    switch (method.toUpperCase()) {\n      case 'GET':\n        response = await http.get(endpoint);\n        break;\n      case 'POST':\n        response = await http.post(endpoint, body);\n        break;\n      case 'PUT':\n        response = await http.put(endpoint, body);\n        break;\n      case 'PATCH':\n        response = await http.patch(endpoint, body);\n        break;\n      case 'DELETE':\n        response = await http.delete(endpoint);\n        break;\n      default:\n        response = await api(endpoint, { method, body: body ? JSON.stringify(body) : undefined });\n    }\n    return response.data;\n  } catch (error) {\n    console.error('API Error:', error);\n    throw error;\n  }\n};\n\n/**\n * Legacy showToast function\n */\n(window as unknown as Record<string, unknown>).showToast = function legacyShowToast(\n  message: string,\n  type: 'success' | 'error' | 'warning' | 'info' = 'info'\n): void {\n  toast[type](message);\n};\n\n/**\n * Legacy setTheme function\n */\n(window as unknown as Record<string, unknown>).setTheme = function legacySetTheme(\n  newTheme: 'light' | 'dark' | 'system'\n): void {\n  theme.set(newTheme);\n};\n\n/**\n * Legacy toggleTheme function\n */\n(window as unknown as Record<string, unknown>).toggleTheme = function legacyToggleTheme(): void {\n  theme.toggle();\n};\n\n/**\n * Legacy localStorage wrappers\n */\n(window as unknown as Record<string, unknown>).getStorageItem = function legacyGetItem(\n  key: string,\n  defaultValue: unknown = null\n): unknown {\n  return storage.get(key, defaultValue);\n};\n\n(window as unknown as Record<string, unknown>).setStorageItem = function legacySetItem(\n  key: string,\n  value: unknown\n): void {\n  storage.set(key, value);\n};\n\n/**\n * Legacy switchTab function\n */\n(window as unknown as Record<string, unknown>).switchTab = function legacySwitchTab(\n  tabName: MainTab\n): void {\n  uiStore.setTab(tabName);\n};\n\n/**\n * Legacy refreshData function\n */\n(window as unknown as Record<string, unknown>).refreshData = async function legacyRefreshData(): Promise<void> {\n  const projectId = appStore.getState().currentProjectId;\n  if (!projectId) return;\n\n  try {\n    const [questionsRes, risksRes, actionsRes, decisionsRes, contactsRes] = await Promise.all([\n      http.get<Question[]>(`/api/projects/${projectId}/questions`),\n      http.get<Risk[]>(`/api/projects/${projectId}/risks`),\n      http.get<Action[]>(`/api/projects/${projectId}/actions`),\n      http.get<Decision[]>(`/api/projects/${projectId}/decisions`),\n      http.get<Contact[]>(`/api/projects/${projectId}/contacts`),\n    ]);\n\n    dataStore.setQuestions(questionsRes.data);\n    dataStore.setRisks(risksRes.data);\n    dataStore.setActions(actionsRes.data);\n    dataStore.setDecisions(decisionsRes.data);\n    dataStore.setContacts(contactsRes.data);\n  } catch (error) {\n    console.error('Failed to refresh data:', error);\n  }\n};\n\n// ============================================================================\n// Chart Compatibility\n// ============================================================================\n\n/**\n * Legacy chart management\n */\n(window as unknown as Record<string, unknown>).registerChart = function(\n  id: string,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  chart: any,\n  selector: string,\n  type: 'bar' | 'line' | 'pie' | 'doughnut' | 'radar' = 'bar'\n): void {\n  chartsStore.registerChart(id, chart, selector, type);\n};\n\n(window as unknown as Record<string, unknown>).destroyChart = function(id: string): void {\n  chartsStore.destroyChart(id);\n};\n\n(window as unknown as Record<string, unknown>).getChart = function(id: string): unknown {\n  return chartsStore.getChart(id);\n};\n\n// ============================================================================\n// Keyboard Shortcuts Compatibility\n// ============================================================================\n\n/**\n * Legacy keyboard shortcut registration\n */\n(window as unknown as Record<string, unknown>).registerShortcut = function(\n  key: string,\n  callback: () => void,\n  options: { ctrl?: boolean; shift?: boolean; alt?: boolean; description?: string } = {}\n): void {\n  shortcuts.register({\n    key,\n    ctrl: options.ctrl,\n    shift: options.shift,\n    alt: options.alt,\n    handler: callback,\n    description: options.description || 'Custom shortcut',\n  });\n};\n\n// ============================================================================\n// Undo/Redo Compatibility\n// ============================================================================\n\n/**\n * Legacy undo/redo\n */\n(window as unknown as Record<string, unknown>).pushUndoAction = function(\n  description: string,\n  undo: () => void | Promise<void>,\n  redo: () => void | Promise<void>\n): void {\n  undoManager.push({\n    id: `undo-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\n    description,\n    undo,\n    redo,\n  });\n};\n\n(window as unknown as Record<string, unknown>).undoLastAction = function(): Promise<boolean> {\n  return undoManager.undo();\n};\n\n(window as unknown as Record<string, unknown>).redoLastAction = function(): Promise<boolean> {\n  return undoManager.redo();\n};\n\n// ============================================================================\n// Export for direct imports\n// ============================================================================\n\nexport function initLegacyBridge(): void {\n  console.log('[GodMode] Legacy bridge initialized');\n  \n  // Initialize app store listeners\n  appStore.init();\n  \n  // Log compatibility mode\n  if (process.env.NODE_ENV === 'development') {\n    console.log('[GodMode] Running in compatibility mode for legacy code');\n  }\n}\n\nexport default initLegacyBridge;\n","/**\n * GodMode Frontend - Main Entry Point\n * \n * This file initializes the application and loads all necessary modules.\n * Currently in transition phase - gradually migrating from monolithic\n * index.html to modular TypeScript structure.\n */\n\n// Import styles\nimport './styles/main.css';\nimport './styles/graph.css';\n\n// Import services\nimport {\n  theme, toast, shortcuts, undoManager, storage, http, api, configureApi, auth, projects,\n  addRequestInterceptor,\n  dashboardService, questionsService, risksService, actionsService, decisionsService,\n  chatService, contactsService, teamsService, documentsService, knowledgeService,\n  emailsService, graphService, timelineService, costsService, notificationsService,\n  commentsService, membersService, profileService, userSettingsService, projectSettingsService,\n  apiKeysService, webhooksService, auditService, factsService\n} from './services';\n\n// Import components\nimport { initGlobalSearch, initNotificationsDropdown, showProfileModal } from './components';\nimport * as components from './components';\nimport { createQuestionDetailView } from './components/questions/QuestionDetailView';\nimport { createQuestionsPanel, createFactsPanel, createDecisionsPanel, createRisksPanel, createActionsPanel } from './components/sot';\n\n// Import stores\nimport { appStore, uiStore, dataStore, chartsStore } from './stores';\nimport type { Question } from './stores/data';\n\n// Import legacy bridge for backwards compatibility\nimport { initLegacyBridge } from './utils/legacy-bridge';\n\n// Make services and stores available globally for gradual migration\ndeclare global {\n  interface Window {\n    godmode: {\n      // Core Services\n      theme: typeof theme;\n      toast: typeof toast;\n      shortcuts: typeof shortcuts;\n      undo: typeof undoManager;\n      storage: typeof storage;\n      http: typeof http;\n      api: typeof api;\n      configureApi: typeof configureApi;\n      auth: typeof auth;\n      projects: typeof projects;\n      // Domain Services\n      dashboard: typeof dashboardService;\n      questions: typeof questionsService;\n      risks: typeof risksService;\n      actions: typeof actionsService;\n      decisions: typeof decisionsService;\n      chat: typeof chatService;\n      contacts: typeof contactsService;\n      teams: typeof teamsService;\n      documents: typeof documentsService;\n      knowledge: typeof knowledgeService;\n      emails: typeof emailsService;\n      graph: typeof graphService;\n      timeline: typeof timelineService;\n      costs: typeof costsService;\n      notifications: typeof notificationsService;\n      comments: typeof commentsService;\n      members: typeof membersService;\n      profile: typeof profileService;\n      userSettings: typeof userSettingsService;\n      projectSettings: typeof projectSettingsService;\n      apiKeys: typeof apiKeysService;\n      webhooks: typeof webhooksService;\n      audit: typeof auditService;\n      facts: typeof factsService;\n      // Stores\n      appStore: typeof appStore;\n      uiStore: typeof uiStore;\n      dataStore: typeof dataStore;\n      chartsStore: typeof chartsStore;\n      // Version\n      version: string;\n    };\n  }\n}\n\nwindow.godmode = {\n  // Core Services\n  theme,\n  toast,\n  shortcuts,\n  undo: undoManager,\n  storage,\n  http,\n  api,\n  configureApi,\n  auth,\n  projects,\n  // Domain Services\n  dashboard: dashboardService,\n  questions: questionsService,\n  risks: risksService,\n  actions: actionsService,\n  decisions: decisionsService,\n  chat: chatService,\n  contacts: contactsService,\n  teams: teamsService,\n  documents: documentsService,\n  knowledge: knowledgeService,\n  emails: emailsService,\n  graph: graphService,\n  timeline: timelineService,\n  costs: costsService,\n  notifications: notificationsService,\n  comments: commentsService,\n  members: membersService,\n  profile: profileService,\n  userSettings: userSettingsService,\n  projectSettings: projectSettingsService,\n  apiKeys: apiKeysService,\n  webhooks: webhooksService,\n  audit: auditService,\n  facts: factsService,\n  // Stores\n  appStore,\n  uiStore,\n  dataStore,\n  chartsStore,\n  // Version\n  version: '2.0.0',\n};\n\n// Ensure API requests include current project ID for project-scoped endpoints (e.g. costs)\naddRequestInterceptor((opts) => {\n  const projectId = appStore.getState().currentProjectId;\n  if (projectId && opts.headers) {\n    (opts.headers as Record<string, string>)['X-Project-Id'] = projectId;\n  }\n  return opts;\n});\n\n/**\n * Register default keyboard shortcuts\n */\nfunction registerShortcuts(): void {\n  // Undo: Ctrl+Z\n  shortcuts.register({\n    key: 'z',\n    ctrl: true,\n    description: 'Undo last action',\n    handler: async () => {\n      if (undoManager.canUndo()) {\n        await undoManager.undo();\n        toast.info('Undo: ' + (undoManager.getRedoDescription() || 'Action undone'));\n      }\n    },\n  });\n\n  // Redo: Ctrl+Shift+Z or Ctrl+Y\n  shortcuts.register({\n    key: 'z',\n    ctrl: true,\n    shift: true,\n    description: 'Redo last action',\n    handler: async () => {\n      if (undoManager.canRedo()) {\n        await undoManager.redo();\n        toast.info('Redo: ' + (undoManager.getUndoDescription() || 'Action redone'));\n      }\n    },\n  });\n\n  // Theme toggle: Ctrl+Shift+T\n  shortcuts.register({\n    key: 't',\n    ctrl: true,\n    shift: true,\n    description: 'Cycle theme (light/dark/system)',\n    handler: () => {\n      const newMode = theme.cycle();\n      toast.info(`Theme: ${theme.getLabel()}`);\n    },\n  });\n\n  // Help: ?\n  shortcuts.register({\n    key: '?',\n    description: 'Show keyboard shortcuts',\n    handler: () => {\n      shortcuts.showHelp();\n    },\n  });\n}\n\n/**\n * Configure API client\n */\nfunction configureApiClient(): void {\n  // Setup 401 handler for auth redirect\n  configureApi({\n    onUnauthorized: () => {\n      appStore.setCurrentUser(null);\n      toast.error('Session expired. Please log in again.');\n      // Trigger auth modal via event\n      window.dispatchEvent(new CustomEvent('godmode:auth-required'));\n    },\n    onForbidden: () => {\n      toast.error('You do not have permission to perform this action.');\n    },\n  });\n}\n\n/**\n * Initialize UI event handlers\n */\nfunction initializeUI(): void {\n  // Theme toggle button\n  const themeToggle = document.getElementById('theme-toggle');\n  if (themeToggle) {\n    themeToggle.addEventListener('click', () => {\n      theme.cycle();\n      updateThemeButton();\n      toast.info(`Theme: ${theme.getLabel()}`);\n    });\n    updateThemeButton();\n  }\n\n  // User menu dropdown\n  const userAvatar = document.getElementById('user-avatar');\n  const userDropdown = document.getElementById('user-dropdown');\n  if (userAvatar && userDropdown) {\n    userAvatar.addEventListener('click', (e) => {\n      e.stopPropagation();\n      userDropdown.classList.toggle('hidden');\n    });\n    document.addEventListener('click', () => {\n      userDropdown.classList.add('hidden');\n    });\n  }\n\n  // Login button\n  const loginBtn = document.getElementById('login-btn');\n  if (loginBtn) {\n    loginBtn.addEventListener('click', () => {\n      components.showAuthModal({\n        onSuccess: () => {\n          updateAuthUI();\n          refreshData();\n        }\n      });\n    });\n  }\n\n  // Logout button\n  const logoutBtn = document.getElementById('logout-btn');\n  if (logoutBtn) {\n    logoutBtn.addEventListener('click', async () => {\n      await auth.logout();\n      \n      // Clear all data\n      dataStore.setQuestions([]);\n      dataStore.setRisks([]);\n      dataStore.setActions([]);\n      dataStore.setDecisions([]);\n      dataStore.setContacts([]);\n      dataStore.setProjects([]);\n      appStore.setCurrentProject(null);\n      appStore.setCurrentProjectId(null);\n      \n      // Update UI\n      updateAuthUI();\n      updateDashboard();\n      \n      // Redirect to landing page if auth is configured\n      if (appStore.getState().authConfigured) {\n        toast.info('Signed out successfully');\n        window.location.href = '/';\n      } else {\n        toast.info('Signed out');\n      }\n    });\n  }\n\n  // Settings button\n  const settingsBtn = document.getElementById('settings-btn');\n  if (settingsBtn) {\n    settingsBtn.addEventListener('click', () => {\n      components.showSettingsModal();\n    });\n  }\n\n  // Shortcuts button\n  const shortcutsBtn = document.getElementById('shortcuts-btn');\n  if (shortcutsBtn) {\n    shortcutsBtn.addEventListener('click', () => {\n      components.showShortcutsModal();\n    });\n  }\n\n  // Dev tools button\n  const devToolsBtn = document.getElementById('dev-tools-btn');\n  if (devToolsBtn) {\n    devToolsBtn.addEventListener('click', () => {\n      components.showDeveloperModal();\n    });\n  }\n\n  // Profile button\n  const profileBtn = document.getElementById('profile-btn');\n  if (profileBtn) {\n    profileBtn.addEventListener('click', () => {\n      showProfileModal();\n    });\n  }\n\n  // Initialize notifications dropdown in header\n  const notificationsContainer = document.getElementById('notifications-container');\n  if (notificationsContainer) {\n    initNotificationsDropdown(notificationsContainer, {\n      onNotificationClick: (notification) => {\n        console.log('Notification clicked:', notification);\n        // Navigate based on notification type\n        if (notification.entity_type && notification.entity_id) {\n          window.dispatchEvent(new CustomEvent('godmode:navigate', { \n            detail: { type: notification.entity_type, id: notification.entity_id }\n          }));\n        }\n      }\n    });\n  }\n\n  // Sidebar navigation\n  const navItems = document.querySelectorAll('.nav-item[data-tab]');\n  navItems.forEach(item => {\n    item.addEventListener('click', () => {\n      const tab = item.getAttribute('data-tab');\n      if (tab) {\n        switchTab(tab);\n      }\n    });\n  });\n\n  // SOT tabs\n  const sotTabs = document.querySelectorAll('.sot-tab');\n  sotTabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n      const view = tab.getAttribute('data-view');\n      if (view) {\n        sotTabs.forEach(t => t.classList.remove('active'));\n        tab.classList.add('active');\n        uiStore.setSotView(view as 'questions' | 'facts' | 'risks' | 'actions' | 'decisions');\n        loadSotContent(view);\n      }\n    });\n  });\n\n  // Mobile menu toggle\n  const menuToggle = document.getElementById('menu-toggle');\n  const sidebar = document.getElementById('app-sidebar');\n  if (menuToggle && sidebar) {\n    menuToggle.addEventListener('click', () => {\n      sidebar.classList.toggle('open');\n    });\n  }\n\n  // Chat panel is mounted in initializePanels\n\n  // New contact button\n  const newContactBtn = document.getElementById('new-contact-btn');\n  if (newContactBtn) {\n    newContactBtn.addEventListener('click', () => {\n      components.showContactModal({ mode: 'create' });\n    });\n  }\n\n  // Upload buttons\n  const uploadBtns = document.querySelectorAll('#new-upload-btn, #upload-files-btn');\n  uploadBtns.forEach(btn => {\n    btn.addEventListener('click', () => {\n      components.showFileUploadModal();\n    });\n  });\n\n  // Initialize sidebar action buttons\n  initializeSidebarActions();\n\n  // Project selector\n  const projectSelector = document.getElementById('project-selector') as HTMLSelectElement;\n  const newProjectBtn = document.getElementById('new-project-btn');\n  const editProjectBtn = document.getElementById('edit-project-btn');\n  \n  if (projectSelector) {\n    projectSelector.addEventListener('change', async () => {\n      const projectId = projectSelector.value;\n      console.log(' Project selector changed, value:', projectId);\n      \n      if (projectId) {\n        await selectProject(projectId);\n        if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n      } else {\n        console.log(' Clearing project - starting...');\n        \n        // No project selected - clear everything IMMEDIATELY\n        if (editProjectBtn) editProjectBtn.classList.add('hidden');\n        \n        // Clear current project in store\n        appStore.setCurrentProject(null);\n        appStore.setCurrentProjectId(null);\n        console.log(' Store cleared');\n        \n        // Clear all data\n        dataStore.setQuestions([]);\n        dataStore.setRisks([]);\n        dataStore.setActions([]);\n        dataStore.setDecisions([]);\n        dataStore.setContacts([]);\n        console.log(' Data store cleared');\n        \n        // IMMEDIATELY show empty state (no async import needed)\n        console.log(' Calling showNoProjectState...');\n        showNoProjectState();\n        console.log(' showNoProjectState called');\n        \n        // Switch to Dashboard tab so user sees the empty state\n        switchTab('dashboard');\n        \n        loadSotContent(uiStore.getState().sotCurrentView);\n        \n        // Also deactivate on server side (fire and forget)\n        http.post('/api/projects/deactivate').catch(() => {});\n        \n        console.log(' Project deselected - ALL DONE');\n      }\n    });\n    loadProjects();\n  }\n\n  // New project button\n  if (newProjectBtn) {\n    newProjectBtn.addEventListener('click', () => {\n      components.showProjectModal({\n        mode: 'create',\n        onSave: async (project) => {\n          await loadProjects();\n          if (project.id && projectSelector) {\n            projectSelector.value = project.id;\n            if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n          }\n          await refreshData();\n        },\n      });\n    });\n  }\n\n  // Edit project button\n  if (editProjectBtn) {\n    editProjectBtn.addEventListener('click', () => {\n      const currentProject = appStore.getState().currentProject;\n      if (currentProject) {\n        components.showProjectModal({\n          mode: 'edit',\n          project: currentProject,\n          onSave: async () => {\n            await loadProjects();\n          },\n          onDelete: async () => {\n            await loadProjects();\n            if (editProjectBtn) editProjectBtn.classList.add('hidden');\n            dataStore.setQuestions([]);\n            dataStore.setRisks([]);\n            dataStore.setActions([]);\n            dataStore.setDecisions([]);\n            updateDashboard();\n          },\n        });\n      }\n    });\n  }\n\n  // Contacts subtabs\n  const contactsSubtabs = document.querySelectorAll('#contacts-subtabs .subtab');\n  contactsSubtabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n      contactsSubtabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      const subtab = tab.getAttribute('data-subtab');\n      document.querySelectorAll('[id^=\"contacts-subtab-\"]').forEach(content => {\n        content.classList.toggle('hidden', content.id !== `contacts-subtab-${subtab}`);\n      });\n    });\n  });\n\n  // Refresh dashboard button\n  const refreshDashboardBtn = document.getElementById('refresh-dashboard-btn');\n  if (refreshDashboardBtn) {\n    refreshDashboardBtn.addEventListener('click', () => {\n      initializePanels();\n      toast.info('Dashboard refreshed');\n    });\n  }\n\n  // Mount panels on tab switch\n  initializePanels();\n  \n  // Initialize drop zones\n  initializeDropZones();\n}\n\n/**\n * Show \"No Project Selected\" state immediately (sync, no imports)\n */\nfunction showNoProjectState(): void {\n  console.log(' showNoProjectState() called');\n  const dashboardContainer = document.getElementById('dashboard-container');\n  console.log(' dashboardContainer:', dashboardContainer ? 'FOUND' : 'NOT FOUND');\n  if (!dashboardContainer) return;\n  \n  console.log(' Setting innerHTML NOW...');\n  \n  dashboardContainer.innerHTML = `\n    <div class=\"dashboard\" style=\"padding: 20px;\">\n      <div class=\"no-project-state\" style=\"\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 80px 24px;\n        text-align: center;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n        border-radius: 20px;\n        border: 2px dashed rgba(225,29,72,0.2);\n        min-height: 400px;\n      \">\n        <svg width=\"96\" height=\"96\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" style=\"color: #e11d48; margin-bottom: 24px; opacity: 0.5;\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n        </svg>\n        <h2 style=\"margin: 0 0 12px 0; font-size: 28px; font-weight: 700; color: var(--text-primary);\">No Project Selected</h2>\n        <p style=\"margin: 0 0 28px 0; font-size: 16px; color: var(--text-secondary); max-width: 480px; line-height: 1.6;\">\n          Select a project from the dropdown above, or create a new one to get started with your data management.\n        </p>\n        <button id=\"create-project-empty-cta\" class=\"btn btn-primary\" style=\"\n          padding: 14px 32px;\n          font-size: 15px;\n          font-weight: 600;\n          display: inline-flex;\n          align-items: center;\n          gap: 10px;\n          border-radius: 12px;\n        \">\n          <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create New Project\n        </button>\n      </div>\n    </div>\n  `;\n  \n  console.log(' innerHTML SET! Container visible:', dashboardContainer.offsetParent !== null);\n  console.log(' Container display:', window.getComputedStyle(dashboardContainer).display);\n  \n  // Bind create project button\n  const createBtn = document.getElementById('create-project-empty-cta');\n  if (createBtn) {\n    createBtn.addEventListener('click', () => {\n      components.showProjectModal({\n        mode: 'create',\n        onSave: async (project) => {\n          await loadProjects();\n          const projectSelector = document.getElementById('project-selector') as HTMLSelectElement;\n          if (project.id && projectSelector) {\n            projectSelector.value = project.id;\n          }\n          await refreshData();\n        }\n      });\n    });\n  }\n}\n\n/**\n * Refresh/recreate the dashboard\n */\nasync function refreshDashboardPanel(): Promise<void> {\n  const dashboardContainer = document.getElementById('dashboard-container');\n  if (!dashboardContainer) return;\n  \n  // Check if project is selected - if not, show empty state immediately\n  const currentProject = appStore.getState().currentProject;\n  const currentProjectId = appStore.getState().currentProjectId;\n  \n  if (!currentProject && !currentProjectId) {\n    showNoProjectState();\n    return;\n  }\n  \n  // Clear and recreate with loading state\n  dashboardContainer.innerHTML = '<div class=\"loading-placeholder\" style=\"padding: 40px; text-align: center;\">Loading dashboard...</div>';\n  \n  try {\n    const { createDashboard } = await import('./components/Dashboard');\n    dashboardContainer.innerHTML = '';\n    const dashboard = createDashboard({\n      onStatClick: (statId) => {\n        console.log('Stat clicked:', statId);\n        // Navigate to appropriate view\n        if (statId === 'questions') switchTab('sot');\n        else if (statId === 'facts') {\n          switchTab('sot');\n          uiStore.setSotView('facts');\n          document.querySelectorAll('.sot-tab').forEach(t => {\n            t.classList.toggle('active', t.getAttribute('data-view') === 'facts');\n          });\n          loadSotContent('facts');\n        }\n        else if (statId === 'risks') { switchTab('sot'); uiStore.setSotView('risks'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'risks'); }); loadSotContent('risks'); }\n        else if (statId === 'actions') { switchTab('sot'); uiStore.setSotView('actions'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'actions'); }); loadSotContent('actions'); }\n        else if (statId === 'decisions') { switchTab('sot'); uiStore.setSotView('decisions'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'decisions'); }); loadSotContent('decisions'); }\n        else if (statId === 'contacts') switchTab('contacts');\n      }\n    });\n    dashboardContainer.appendChild(dashboard);\n  } catch (err) {\n    console.error('Failed to load Dashboard:', err);\n    dashboardContainer.innerHTML = '<div class=\"error\">Failed to load dashboard</div>';\n  }\n}\n\n/**\n * Initialize and mount panels\n */\nfunction initializePanels(): void {\n  // Dashboard - Main dashboard with all widgets\n  refreshDashboardPanel();\n\n  // Chat panel (sessions, contact pills, RAG)\n  const chatContainer = document.getElementById('chat-panel-container');\n  if (chatContainer && chatContainer.children.length === 0) {\n    import('./components/Chat').then(({ createChat }) => {\n      const panel = createChat({ showSources: true, showSessions: true });\n      chatContainer.appendChild(panel);\n    }).catch((err) => {\n      console.error('[Chat] Failed to load Chat:', err);\n      chatContainer.innerHTML = '<div style=\"padding: 24px; color: var(--text-secondary);\">Failed to load chat</div>';\n    });\n  }\n\n  // EmailsPanel\n  const emailsContainer = document.getElementById('emails-panel-container');\n  if (emailsContainer && emailsContainer.children.length === 0) {\n    import('./components/EmailsPanel').then(({ createEmailsPanel }) => {\n      const panel = createEmailsPanel();\n      emailsContainer.appendChild(panel);\n    });\n  }\n\n  // ContactsPanel\n  const contactsContainer = document.getElementById('contacts-panel-container');\n  if (contactsContainer && contactsContainer.querySelectorAll('.contacts-panel-sota').length === 0) {\n    import('./components/ContactsPanel').then(({ createContactsPanel }) => {\n      contactsContainer.innerHTML = ''; // Clear comments and whitespace\n      const panel = createContactsPanel();\n      contactsContainer.appendChild(panel);\n    });\n  }\n\n  // TeamsPanel\n  const teamsContainer = document.getElementById('teams-panel-container');\n  if (teamsContainer && teamsContainer.children.length === 0) {\n    import('./components/TeamsPanel').then(({ createTeamsPanel }) => {\n      const panel = createTeamsPanel();\n      teamsContainer.appendChild(panel);\n    });\n  }\n\n  // RolesPanel\n  const rolesContainer = document.getElementById('roles-panel-container');\n  if (rolesContainer && rolesContainer.children.length === 0) {\n    import('./components/RolesPanel').then(({ renderRolesPanel }) => {\n      renderRolesPanel(rolesContainer);\n    });\n  }\n\n  // FilesPanel (DocumentsPanel)\n  const filesContainer = document.getElementById('files-panel-container');\n  if (filesContainer && filesContainer.querySelectorAll('.documents-panel-minimal').length === 0) {\n    filesContainer.innerHTML = ''; // Clear comments and whitespace\n    import('./components/DocumentsPanel').then(({ default: createDocumentsPanel }) => {\n      const panel = createDocumentsPanel({\n        onDocumentClick: async (doc) => {\n          // Open document preview modal\n          const { showDocumentPreviewModal } = await import('./components/modals/DocumentPreviewModal');\n          showDocumentPreviewModal({ document: doc });\n        }\n      });\n      filesContainer.appendChild(panel);\n    }).catch(err => {\n      console.error('[FilesPanel] Failed to load DocumentsPanel:', err);\n      filesContainer.innerHTML = '<div style=\"padding: 24px; color: var(--text-secondary);\">Failed to load files panel</div>';\n    });\n  }\n\n  // OrgChart\n  const orgChartContainer = document.getElementById('org-chart-container');\n  if (orgChartContainer && orgChartContainer.children.length === 0) {\n    import('./components/OrgChart').then(({ createOrgChart }) => {\n      const panel = createOrgChart();\n      orgChartContainer.appendChild(panel);\n    });\n  }\n\n  // CostsDashboard (mount if no element children; container may have comment nodes)\n  const costsContainer = document.getElementById('costs-container');\n  if (costsContainer && costsContainer.children.length === 0) {\n    import('./components/CostsDashboard').then(({ createCostsDashboard }) => {\n      const panel = createCostsDashboard();\n      costsContainer.appendChild(panel);\n    });\n  }\n\n  // HistoryPanel\n  const historyContainer = document.getElementById('history-container');\n  if (historyContainer && historyContainer.children.length === 0) {\n    import('./components/HistoryPanel').then(({ createHistoryPanel, exportHistory }) => {\n      const panel = createHistoryPanel({\n        onRestore: (entry) => {\n          toast.info(`Restoring ${entry.entityType} \"${entry.entityName || entry.entityId}\"`);\n          // Trigger restore via API\n        }\n      });\n      historyContainer.appendChild(panel);\n\n      // Bind export button\n      const exportBtn = document.getElementById('export-history-btn');\n      if (exportBtn) {\n        exportBtn.addEventListener('click', () => exportHistory('json'));\n      }\n    });\n  }\n}\n\n/**\n * Initialize sidebar drop zones\n */\nfunction initializeDropZones(): void {\n  const dropzones = document.querySelectorAll('.dropzone-card[data-type]');\n  console.log('[DropZones] Found', dropzones.length, 'dropzones');\n  \n  dropzones.forEach(zone => {\n    const type = zone.getAttribute('data-type');\n    console.log('[DropZones] Adding click handler for:', type);\n    \n    // Click handler - open appropriate modal or file picker\n    zone.addEventListener('click', async (e) => {\n      console.log('[DropZones] Click on:', type);\n      e.preventDefault();\n      e.stopPropagation();\n      \n      try {\n        switch (type) {\n          case 'emails':\n            // Open EmailComposer modal\n            console.log('[DropZones] Opening EmailComposer...');\n            const { showEmailComposer } = await import('./components/EmailComposer');\n            showEmailComposer({\n              onSave: () => {\n                toast.success('Email imported');\n              }\n            });\n            return;\n            \n          case 'conversations':\n            // Open ConversationComposer modal\n            console.log('[DropZones] Opening ConversationComposer...');\n            const { showConversationComposer } = await import('./components/ConversationComposer');\n            showConversationComposer({\n              onImport: () => {\n                toast.success('Conversation imported');\n              }\n            });\n            return;\n            \n          case 'transcripts':\n            // Open TranscriptComposer modal\n            console.log('[DropZones] Opening TranscriptComposer...');\n            const { showTranscriptComposer } = await import('./components/TranscriptComposer');\n            showTranscriptComposer({\n              onImport: () => {\n                toast.success('Transcript imported');\n              }\n            });\n            return;\n            \n          case 'documents':\n          default:\n            // Open file picker for documents\n            console.log('[DropZones] Opening file picker for documents...');\n            const input = document.createElement('input');\n            input.type = 'file';\n            input.multiple = true;\n            input.accept = '.pdf,.doc,.docx,.txt,.md,.rtf,.odt,.xls,.xlsx,.ppt,.pptx,.csv,.json';\n            \n            input.onchange = () => {\n              if (input.files && input.files.length > 0) {\n                handleDroppedFiles(Array.from(input.files), 'documents');\n              }\n            };\n            \n            input.click();\n            return;\n        }\n      } catch (err) {\n        console.error('[DropZones] Error:', err);\n        toast.error('Failed to open import dialog');\n      }\n    });\n    \n    // Drag and drop handlers\n    zone.addEventListener('dragover', (e) => {\n      e.preventDefault();\n      zone.classList.add('drag-over');\n    });\n    \n    zone.addEventListener('dragleave', () => {\n      zone.classList.remove('drag-over');\n    });\n    \n    zone.addEventListener('drop', (e) => {\n      e.preventDefault();\n      zone.classList.remove('drag-over');\n      \n      const dataTransfer = (e as DragEvent).dataTransfer;\n      if (dataTransfer?.files && dataTransfer.files.length > 0) {\n        handleDroppedFiles(Array.from(dataTransfer.files), type || 'documents');\n      }\n    });\n  });\n}\n\n/**\n * Handle dropped or selected files\n */\nasync function handleDroppedFiles(files: File[], type: string): Promise<void> {\n  // Add files to pending list\n  addPendingFiles(files);\n  \n  const fileNames = files.map(f => f.name).join(', ');\n  toast.info(`Added ${files.length} ${type} to queue: ${fileNames.substring(0, 50)}${fileNames.length > 50 ? '...' : ''}`);\n}\n\n/**\n * Update theme button icon\n */\nfunction updateThemeButton(): void {\n  const themeToggle = document.getElementById('theme-toggle');\n  if (themeToggle) {\n    themeToggle.textContent = theme.getIcon();\n    themeToggle.title = `Theme: ${theme.getLabel()}`;\n  }\n}\n\n// ==================== CLIENT-SIDE ROUTING ====================\n\n/** Valid tab names for routing */\nconst VALID_TABS = ['dashboard', 'chat', 'sot', 'timeline', 'contacts', 'team-analysis', 'files', 'graph', 'emails', 'costs', 'history', 'roles', 'admin', 'org'];\n\n/**\n * Get current tab from URL pathname\n */\nfunction getTabFromUrl(): string {\n  const pathname = window.location.pathname;\n  // Match /app/tabname or /app/tabname/\n  const match = pathname.match(/^\\/app\\/([^/]+)/);\n  if (match && VALID_TABS.includes(match[1])) {\n    return match[1];\n  }\n  // Default to dashboard for /app or /app/\n  return 'dashboard';\n}\n\n/**\n * Update browser URL for current tab (without page reload)\n */\nfunction updateUrlForTab(tabName: string, replace = false): void {\n  const newPath = tabName === 'dashboard' ? '/app' : `/app/${tabName}`;\n  const currentPath = window.location.pathname;\n  \n  // Only update if path is different\n  if (currentPath !== newPath) {\n    if (replace) {\n      window.history.replaceState({ tab: tabName }, '', newPath);\n    } else {\n      window.history.pushState({ tab: tabName }, '', newPath);\n    }\n  }\n}\n\n/**\n * Initialize URL-based routing\n */\nfunction initRouting(): void {\n  // Handle browser back/forward buttons\n  window.addEventListener('popstate', (event) => {\n    const tab = event.state?.tab || getTabFromUrl();\n    switchTab(tab, false); // false = don't update URL again\n  });\n  \n  // On initial load, read tab from URL\n  const initialTab = getTabFromUrl();\n  if (initialTab !== 'dashboard') {\n    // If URL has a specific tab, switch to it (will happen after UI init)\n    setTimeout(() => switchTab(initialTab, true), 0); // true = replace URL state\n  }\n}\n\n/**\n * Switch to a tab\n * @param tabName - The tab to switch to\n * @param updateUrl - Whether to update the browser URL (default: true)\n */\nfunction switchTab(tabName: string, updateUrl = true): void {\n  // Update sidebar nav items\n  document.querySelectorAll('.nav-item[data-tab]').forEach(item => {\n    item.classList.toggle('active', item.getAttribute('data-tab') === tabName);\n  });\n\n  // Update tab content\n  document.querySelectorAll('.tab-content').forEach(tab => {\n    tab.classList.toggle('active', tab.id === `tab-${tabName}`);\n    tab.classList.toggle('hidden', tab.id !== `tab-${tabName}`);\n  });\n\n  // Close mobile sidebar\n  const sidebar = document.getElementById('app-sidebar');\n  if (sidebar) {\n    sidebar.classList.remove('open');\n  }\n  \n  // Update browser URL (client-side routing)\n  if (updateUrl) {\n    updateUrlForTab(tabName);\n  }\n\n  // Update store\n  uiStore.setTab(tabName as 'dashboard' | 'chat' | 'sot' | 'timeline' | 'contacts' | 'team-analysis' | 'files' | 'graph' | 'emails' | 'costs' | 'history' | 'roles' | 'admin' | 'org');\n  \n  // Load admin panel when switching to admin tab\n  if (tabName === 'admin') {\n    const adminContainer = document.getElementById('tab-admin');\n    if (adminContainer) {\n      import('./components/AdminPanel').then(({ initAdminPanel }) => {\n        initAdminPanel(adminContainer);\n      });\n    }\n  }\n  \n  // Load Graph Explorer when switching to graph tab\n  if (tabName === 'graph') {\n    const graphContainer = document.getElementById('graph-container');\n    // Check for actual element children, not just comments or text nodes\n    const hasContent = graphContainer?.querySelector('.graph-explorer');\n    if (graphContainer && !hasContent) {\n      console.log('[Graph] Loading GraphExplorer...');\n      import('./components/graph/GraphExplorer').then(({ createGraphExplorer }) => {\n        graphContainer.innerHTML = ''; // Clear any placeholder\n        const explorer = createGraphExplorer({\n          onNodeSelect: (node) => {\n            console.log('Graph node selected:', node);\n          },\n          onQueryExecute: (cypher) => {\n            console.log('Query executed:', cypher);\n          },\n        });\n        graphContainer.appendChild(explorer);\n        console.log('[Graph] GraphExplorer loaded successfully');\n      }).catch(err => {\n        console.error('[Graph] Failed to load GraphExplorer:', err);\n        graphContainer.innerHTML = '<div style=\"padding: 24px; text-align: center; color: var(--text-secondary);\">Failed to load Graph Explorer</div>';\n      });\n    }\n  }\n\n  // Load Timeline Panel when switching to timeline tab\n  if (tabName === 'timeline') {\n    const timelineContainer = document.getElementById('timeline-content');\n    const hasContent = timelineContainer?.querySelector('.timeline-panel');\n    if (timelineContainer && !hasContent) {\n      console.log('[Timeline] Loading TimelinePanel...');\n      import('./components/TimelinePanel').then(({ createTimelinePanel }) => {\n        timelineContainer.innerHTML = ''; // Clear any placeholder\n        const panel = createTimelinePanel({\n          onEventClick: (event) => {\n            console.log('Timeline event clicked:', event);\n            // Navigate to entity if possible\n            if (event.entity_type && event.entity_id) {\n              const entityType = event.entity_type;\n              if (entityType === 'question') {\n                import('./components/questions/QuestionDetailView').then(({ createQuestionDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createQuestionDetailView({\n                      questionId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else if (entityType === 'decision') {\n                import('./components/decisions/DecisionDetailView').then(({ createDecisionDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createDecisionDetailView({\n                      decisionId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else if (entityType === 'fact') {\n                import('./components/facts/FactDetailView').then(({ createFactDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createFactDetailView({\n                      factId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else if (entityType === 'risk') {\n                import('./components/risks/RiskDetailView').then(({ createRiskDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createRiskDetailView({\n                      riskId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else if (entityType === 'action') {\n                import('./components/actions/ActionDetailView').then(({ createActionDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createActionDetailView({\n                      actionId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else {\n                toast.info(`Event: ${event.title}`);\n              }\n            }\n          },\n        });\n        timelineContainer.appendChild(panel);\n        console.log('[Timeline] TimelinePanel loaded successfully');\n      }).catch(err => {\n        console.error('[Timeline] Failed to load TimelinePanel:', err);\n        timelineContainer.innerHTML = '<div style=\"padding: 24px; text-align: center; color: var(--text-secondary);\">Failed to load Timeline</div>';\n      });\n    }\n  }\n\n  // Load Team Analysis when switching to team-analysis tab\n  if (tabName === 'team-analysis') {\n    const teamAnalysisContainer = document.getElementById('team-analysis-container');\n    const hasContent = teamAnalysisContainer?.querySelector('.team-analysis-panel');\n    if (teamAnalysisContainer && !hasContent) {\n      console.log('[TeamAnalysis] Loading TeamAnalysis component...');\n      import('./components/TeamAnalysis').then(({ createTeamAnalysis }) => {\n        teamAnalysisContainer.innerHTML = ''; // Clear any placeholder\n        const panel = createTeamAnalysis();\n        teamAnalysisContainer.appendChild(panel);\n        console.log('[TeamAnalysis] TeamAnalysis loaded successfully');\n        \n        // Setup subtab switching after component is loaded\n        setupTeamAnalysisSubtabs();\n      }).catch(err => {\n        console.error('[TeamAnalysis] Failed to load TeamAnalysis:', err);\n        teamAnalysisContainer.innerHTML = '<div style=\"padding: 24px; text-align: center; color: var(--text-secondary);\">Failed to load Team Analysis</div>';\n      });\n    } else {\n      // Component already loaded, just setup subtabs\n      setupTeamAnalysisSubtabs();\n    }\n  }\n}\n\n/**\n * Setup Team Analysis subtab switching\n */\nfunction setupTeamAnalysisSubtabs(): void {\n  // Import the store to control subtab switching\n  import('./stores/teamAnalysis').then(({ teamAnalysisStore }) => {\n    document.querySelectorAll('#team-analysis-subtabs .subtab').forEach(btn => {\n      // Remove existing listeners to prevent duplicates\n      const newBtn = btn.cloneNode(true);\n      btn.parentNode?.replaceChild(newBtn, btn);\n      \n      newBtn.addEventListener('click', (e) => {\n        const subtab = (e.target as HTMLElement).dataset.subtab as 'profiles' | 'team' | 'graph';\n        if (subtab) {\n          console.log('[TeamAnalysis] Switching to subtab:', subtab);\n          // Update active state in UI\n          document.querySelectorAll('#team-analysis-subtabs .subtab').forEach(b => {\n            b.classList.toggle('active', b.getAttribute('data-subtab') === subtab);\n          });\n          // Update the store which triggers re-render\n          teamAnalysisStore.setSubtab(subtab);\n        }\n      });\n    });\n  });\n}\n\n/**\n * Load projects\n */\nasync function loadProjects(): Promise<void> {\n  const selector = document.getElementById('project-selector') as HTMLSelectElement;\n  if (!selector) return;\n\n  try {\n    const projectList = await projects.getAll();\n\n    selector.innerHTML = '<option value=\"\">Select Project...</option>';\n    projectList.forEach(project => {\n      const option = document.createElement('option');\n      option.value = project.id;\n      option.textContent = project.name + (project.isDefault ? ' (default)' : '');\n      selector.appendChild(option);\n    });\n\n    // Select current project if any; when none persisted (e.g. storage blocked), auto-select first or default\n    const currentProjectId = appStore.getState().currentProjectId;\n    const editProjectBtn = document.getElementById('edit-project-btn');\n\n    if (currentProjectId) {\n      selector.value = currentProjectId;\n      if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n    } else if (projectList.length > 0) {\n      const firstOrDefault = projectList.find((p: { isDefault?: boolean }) => p.isDefault) || projectList[0];\n      selector.value = firstOrDefault.id;\n      appStore.setCurrentProject(firstOrDefault);\n      appStore.setCurrentProjectId(firstOrDefault.id);\n      if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n    } else {\n      if (editProjectBtn) editProjectBtn.classList.add('hidden');\n    }\n  } catch (error) {\n    // Projects API may not be available yet\n    console.warn('Projects not available:', error);\n  }\n}\n\n/**\n * Select a project\n */\nasync function selectProject(projectId: string): Promise<void> {\n  try {\n    const project = await projects.activate(projectId);\n    \n    if (project) {\n      toast.success(`Switched to: ${project.name}`);\n      await refreshData();\n    }\n  } catch {\n    toast.error('Failed to load project');\n  }\n}\n\n/**\n * Refresh all data for current project\n */\nasync function refreshData(): Promise<void> {\n  try {\n    // First, reload projects list (may auto-select first/default if store was empty)\n    await loadProjects();\n\n    let currentProject = appStore.getState().currentProject;\n    let currentProjectId = appStore.getState().currentProjectId;\n\n    // If store still empty but selector has a value (e.g. user picked one), sync store from selector\n    if (!currentProject && !currentProjectId) {\n      const selector = document.getElementById('project-selector') as HTMLSelectElement;\n      if (selector?.value) {\n        try {\n          const project = await projects.activate(selector.value);\n          if (project) {\n            appStore.setCurrentProject(project);\n            appStore.setCurrentProjectId(project.id);\n            currentProject = project;\n            currentProjectId = project.id;\n          }\n        } catch {\n          // ignore\n        }\n      }\n    }\n\n    if (!currentProject && !currentProjectId) {\n      // No project selected - show empty state and ensure dashboard tab is visible\n      console.log(' No project selected - showing empty state');\n      switchTab('dashboard');\n      dataStore.setQuestions([]);\n      dataStore.setRisks([]);\n      dataStore.setActions([]);\n      dataStore.setDecisions([]);\n      dataStore.setContacts([]);\n      await refreshDashboardPanel();\n      loadSotContent(uiStore.getState().sotCurrentView);\n      return;\n    }\n    \n    // API endpoints don't use projectId in path - project context is server-side\n    const [questionsRes, risksRes, actionsRes, decisionsRes, contactsRes] = await Promise.all([\n      http.get<{ questions: unknown[] }>('/api/questions').catch(() => ({ data: { questions: [] } })),\n      http.get<{ risks: unknown[] }>('/api/risks').catch(() => ({ data: { risks: [] } })),\n      http.get<{ actions: unknown[] }>('/api/actions').catch(() => ({ data: { actions: [] } })),\n      http.get<{ decisions: unknown[] }>('/api/decisions').catch(() => ({ data: { decisions: [] } })),\n      http.get<{ contacts: unknown[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\n    ]);\n\n    dataStore.setQuestions((questionsRes.data.questions || []) as []);\n    dataStore.setRisks((risksRes.data.risks || []) as []);\n    dataStore.setActions((actionsRes.data.actions || []) as []);\n    dataStore.setDecisions((decisionsRes.data.decisions || []) as []);\n    dataStore.setContacts((contactsRes.data.contacts || []) as []);\n\n    // Re-render dashboard with new data\n    await refreshDashboardPanel();\n    loadSotContent(uiStore.getState().sotCurrentView);\n  } catch {\n    console.error('Failed to refresh data');\n  }\n}\n\n/**\n * Update dashboard stats\n */\nfunction updateDashboard(): void {\n  const statsGrid = document.getElementById('dashboard-stats');\n  const dashboardContent = document.getElementById('dashboard-content');\n  if (!statsGrid) return;\n\n  // Check if project is selected\n  const currentProject = appStore.getState().currentProject;\n  const currentProjectId = appStore.getState().currentProjectId;\n  \n  if (!currentProject && !currentProjectId) {\n    // No project selected - show empty state\n    statsGrid.innerHTML = `\n      <div class=\"no-project-message\" style=\"\n        grid-column: 1 / -1;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 48px 24px;\n        text-align: center;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n        border-radius: 16px;\n        border: 2px dashed rgba(225,29,72,0.2);\n      \">\n        <svg width=\"64\" height=\"64\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" style=\"color: #e11d48; margin-bottom: 16px; opacity: 0.7;\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n        </svg>\n        <h3 style=\"margin: 0 0 8px 0; font-size: 20px; font-weight: 600; color: var(--text-primary);\">No Project Selected</h3>\n        <p style=\"margin: 0 0 20px 0; font-size: 14px; color: var(--text-secondary); max-width: 400px;\">\n          Select an existing project from the dropdown above or create a new one to start managing your data.\n        </p>\n        <button id=\"create-project-cta\" class=\"btn btn-primary\" style=\"\n          padding: 12px 24px;\n          font-size: 14px;\n          font-weight: 600;\n          display: inline-flex;\n          align-items: center;\n          gap: 8px;\n        \">\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create New Project\n        </button>\n      </div>\n    `;\n    \n    // Hide dashboard content sections\n    if (dashboardContent) {\n      dashboardContent.style.display = 'none';\n    }\n    \n    // Bind create project button\n    const createBtn = document.getElementById('create-project-cta');\n    if (createBtn) {\n      createBtn.addEventListener('click', () => {\n        components.showProjectModal({\n          mode: 'create',\n          onSave: async (project) => {\n            await loadProjects();\n            await refreshData();\n          }\n        });\n      });\n    }\n    \n    return;\n  }\n\n  // Show dashboard content if hidden\n  if (dashboardContent) {\n    dashboardContent.style.display = '';\n  }\n\n  const state = dataStore.getState();\n  \n  // Count only active questions (exclude dismissed/resolved/answered)\n  const activeQuestions = state.questions.filter(q => \n    q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'answered'\n  );\n  \n  statsGrid.innerHTML = `\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${activeQuestions.length}</div>\n      <div class=\"stat-label\">Questions</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.risks.length}</div>\n      <div class=\"stat-label\">Risks</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.actions.length}</div>\n      <div class=\"stat-label\">Actions</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.decisions.length}</div>\n      <div class=\"stat-label\">Decisions</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.contacts.length}</div>\n      <div class=\"stat-label\">Contacts</div>\n    </div>\n  `;\n}\n\n/**\n * Load SOT content\n */\nfunction loadSotContent(view: string): void {\n  const container = document.getElementById('sot-content');\n  if (!container) return;\n\n  const state = dataStore.getState();\n  let items: Array<{ id: string; [key: string]: unknown }> = [];\n  let template: (item: { id: string; [key: string]: unknown }) => string;\n\n  switch (view) {\n    case 'questions':\n      // Use the full QuestionsPanel with Generate button, filters and detail view\n      container.innerHTML = '';\n      const questionsPanel = createQuestionsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(questionsPanel);\n      return; // Exit early since we're using the full component\n    case 'facts':\n      container.innerHTML = '';\n      const factsPanel = createFactsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(factsPanel);\n      return;\n    case 'decisions':\n      container.innerHTML = '';\n      const decisionsPanel = createDecisionsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(decisionsPanel);\n      return;\n    case 'risks':\n      container.innerHTML = '';\n      const risksPanel = createRisksPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(risksPanel);\n      return;\n    case 'actions':\n      container.innerHTML = '';\n      const actionsPanel = createActionsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(actionsPanel);\n      return;\n    default:\n      container.innerHTML = '<p class=\"text-muted\">Select a view</p>';\n      return;\n  }\n}\n\n/**\n * Show question detail view\n */\nfunction showQuestionDetail(question: Question, container: HTMLElement): void {\n  // Store original content for restoration\n  const originalContent = container.innerHTML;\n  \n  // Transform question to match the expected interface\n  const questionData = {\n    id: question.id,\n    content: String(question.content || question.question || ''),\n    context: question.context as string | undefined,\n    priority: (question.priority || 'medium') as 'low' | 'medium' | 'high' | 'critical',\n    status: (question.status || 'pending') as 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed',\n    assigned_to: question.assigned_to as string | undefined,\n    answer: question.answer as string | undefined,\n    answer_source: question.answer_source as 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai' | undefined,\n    category: question.category as string | undefined,\n    source_file: question.source_file as string | undefined,\n    created_at: String(question.created_at || question.createdAt || new Date().toISOString()),\n    updated_at: question.updated_at as string | undefined,\n    follow_up_to: question.follow_up_to as string | undefined,\n    answered_by_contact_id: question.answered_by_contact_id as string | undefined,\n    answered_by_name: question.answered_by_name as string | undefined,\n    sla_hours: question.sla_hours as number | undefined,\n    sla_breached: question.sla_breached as boolean | undefined,\n    extracted_entities: question.extracted_entities as Array<{ type: string; name: string }> | undefined,\n    extracted_topics: question.extracted_topics as Array<{ name: string }> | undefined,\n  };\n  \n  // Create detail view\n  const detailView = createQuestionDetailView({\n    question: questionData,\n    onClose: () => {\n      // Restore original content\n      container.innerHTML = originalContent;\n      // Re-bind click handlers\n      loadSotContent('questions');\n    },\n    onUpdate: (updatedQuestion) => {\n      // Update question in data store\n      const state = dataStore.getState();\n      const updatedQuestions = state.questions.map((q) => \n        q.id === updatedQuestion.id ? { ...q, ...updatedQuestion } as Question : q\n      );\n      dataStore.setQuestions(updatedQuestions);\n    },\n    onNavigateToQuestion: (questionId) => {\n      // Find and show the target question\n      const state = dataStore.getState();\n      const targetQuestion = state.questions.find((q) => q.id === questionId);\n      if (targetQuestion) {\n        showQuestionDetail(targetQuestion, container);\n      }\n    }\n  });\n  \n  // Replace content with detail view\n  container.innerHTML = '';\n  container.appendChild(detailView);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Format markdown (basic)\n */\nfunction formatMarkdown(text: string): string {\n  return escapeHtml(text)\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n    .replace(/`(.*?)`/g, '<code>$1</code>')\n    .replace(/\\n/g, '<br>');\n}\n\n/**\n * Pending files manager\n */\nconst pendingFiles: File[] = [];\n\nfunction updatePendingFilesUI(): void {\n  const countEl = document.getElementById('pending-count');\n  const listEl = document.getElementById('pending-files-list');\n  \n  if (countEl) {\n    countEl.textContent = `${pendingFiles.length} file${pendingFiles.length !== 1 ? 's' : ''}`;\n  }\n  \n  if (listEl) {\n    if (pendingFiles.length === 0) {\n      listEl.innerHTML = '<div class=\"empty-hint\">No files pending</div>';\n    } else {\n      listEl.innerHTML = pendingFiles.map((file, index) => `\n        <div class=\"pending-file-item\" data-index=\"${index}\">\n          <div class=\"pending-file-info\">\n            <div class=\"pending-file-name\" title=\"${escapeHtml(file.name)}\">${escapeHtml(file.name)}</div>\n            <div class=\"pending-file-size\">${formatFileSize(file.size)}</div>\n          </div>\n          <button class=\"pending-file-remove\" data-index=\"${index}\" title=\"Remove\"></button>\n        </div>\n      `).join('');\n      \n      // Bind remove buttons\n      listEl.querySelectorAll('.pending-file-remove').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n          e.stopPropagation();\n          const idx = parseInt((btn as HTMLElement).dataset.index || '0');\n          pendingFiles.splice(idx, 1);\n          updatePendingFilesUI();\n        });\n      });\n    }\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return bytes + ' B';\n  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n}\n\nfunction addPendingFiles(files: FileList | File[]): void {\n  Array.from(files).forEach(file => {\n    if (!pendingFiles.some(f => f.name === file.name && f.size === file.size)) {\n      pendingFiles.push(file);\n    }\n  });\n  updatePendingFilesUI();\n}\n\n/**\n * Initialize sidebar action buttons\n */\nfunction initializeSidebarActions(): void {\n  // Process Files button\n  const processBtn = document.getElementById('process-files-btn');\n  if (processBtn) {\n    processBtn.addEventListener('click', async () => {\n      if (pendingFiles.length === 0) {\n        toast.warning('No files to process. Add files first.');\n        return;\n      }\n      \n      processBtn.setAttribute('disabled', 'true');\n      processBtn.innerHTML = '<span class=\"btn-icon\"></span> Processing...';\n      \n      try {\n        const result = await documentsService.upload(pendingFiles);\n        if (result.success) {\n          toast.success(`Processed ${result.files.length} files successfully`);\n          pendingFiles.length = 0; // Clear array\n          updatePendingFilesUI();\n          refreshData();\n        }\n      } catch (error) {\n        toast.error('Failed to process files');\n        console.error('Process error:', error);\n      } finally {\n        processBtn.removeAttribute('disabled');\n        processBtn.innerHTML = '<span class=\"btn-icon\"></span> Process Files';\n      }\n    });\n  }\n  \n  // Export Knowledge button\n  const exportKnowledgeBtn = document.getElementById('export-knowledge-btn');\n  if (exportKnowledgeBtn) {\n    exportKnowledgeBtn.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const knowledge = {\n          facts: data.facts || [],\n          decisions: data.decisions || [],\n          exportedAt: new Date().toISOString()\n        };\n        \n        const blob = new Blob([JSON.stringify(knowledge, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'godmode-knowledge-export.json';\n        a.click();\n        URL.revokeObjectURL(url);\n        \n        toast.success('Knowledge exported');\n      } catch (error) {\n        toast.error('Export failed');\n      }\n    });\n  }\n  \n  // Export Knowledge to clipboard\n  const exportKnowledgeClipboard = document.getElementById('export-knowledge-clipboard');\n  if (exportKnowledgeClipboard) {\n    exportKnowledgeClipboard.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const knowledge = {\n          facts: data.facts || [],\n          decisions: data.decisions || []\n        };\n        await navigator.clipboard.writeText(JSON.stringify(knowledge, null, 2));\n        toast.success('Copied to clipboard');\n      } catch (error) {\n        toast.error('Copy failed');\n      }\n    });\n  }\n  \n  // Export Questions button\n  const exportQuestionsBtn = document.getElementById('export-questions-btn');\n  if (exportQuestionsBtn) {\n    exportQuestionsBtn.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const questions = data.questions || [];\n        \n        const blob = new Blob([JSON.stringify(questions, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'godmode-questions-export.json';\n        a.click();\n        URL.revokeObjectURL(url);\n        \n        toast.success('Questions exported');\n      } catch (error) {\n        toast.error('Export failed');\n      }\n    });\n  }\n  \n  // Export Questions to clipboard\n  const exportQuestionsClipboard = document.getElementById('export-questions-clipboard');\n  if (exportQuestionsClipboard) {\n    exportQuestionsClipboard.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const questions = data.questions || [];\n        await navigator.clipboard.writeText(JSON.stringify(questions, null, 2));\n        toast.success('Copied to clipboard');\n      } catch (error) {\n        toast.error('Copy failed');\n      }\n    });\n  }\n  \n  // Copy Overdue Items button\n  const copyOverdueBtn = document.getElementById('copy-overdue-btn');\n  if (copyOverdueBtn) {\n    copyOverdueBtn.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const now = new Date();\n        \n        const overdueActions = (data.actions || []).filter(a => {\n          if (a.status === 'completed') return false;\n          const dueDate = a.dueDate;\n          if (!dueDate) return false;\n          return new Date(dueDate) < now;\n        });\n        \n        const overdueQuestions = (data.questions || []).filter(q => {\n          if (q.status === 'resolved') return false;\n          const createdAt = q.created_at || q.createdAt;\n          if (!createdAt) return false;\n          const created = new Date(createdAt);\n          const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n          return created < sevenDaysAgo;\n        });\n        \n        const overdue = {\n          actions: overdueActions,\n          questions: overdueQuestions,\n          exportedAt: now.toISOString()\n        };\n        \n        await navigator.clipboard.writeText(JSON.stringify(overdue, null, 2));\n        toast.success(`Copied ${overdueActions.length} actions and ${overdueQuestions.length} questions`);\n      } catch (error) {\n        toast.error('Copy failed');\n      }\n    });\n  }\n  \n  // Clean Orphan Data button\n  const cleanOrphanBtn = document.getElementById('clean-orphan-btn');\n  if (cleanOrphanBtn) {\n    cleanOrphanBtn.addEventListener('click', async () => {\n      const confirmed = await components.confirm(\n        'This will remove orphaned data entries that are not linked to any documents. Continue?',\n        { title: 'Clean Orphan Data', confirmText: 'Clean', confirmClass: 'btn-warning' }\n      );\n      \n      if (confirmed) {\n        try {\n          const response = await http.post('/api/cleanup/orphans');\n          toast.success('Orphan data cleaned');\n          refreshData();\n        } catch (error) {\n          toast.error('Cleanup failed');\n        }\n      }\n    });\n  }\n  \n  // Reset Data button (clears knowledge; keeps team, contacts, cost)\n  const resetDataBtn = document.getElementById('reset-data-btn');\n  if (resetDataBtn) {\n    resetDataBtn.addEventListener('click', async () => {\n      const confirmed = await components.confirm(\n        'This will clear all knowledge data (facts, decisions, questions, risks, actions, documents, etc.) for the current project. Team, contacts, and cost data will be kept. Continue?',\n        { title: 'Reset Project Data', confirmText: 'Reset Knowledge Data', confirmClass: 'btn-danger' }\n      );\n\n      if (confirmed) {\n        try {\n          await http.post('/api/reset');\n          toast.success('Project data reset; team, contacts and cost preserved.');\n          refreshData();\n        } catch (error) {\n          toast.error('Reset failed');\n        }\n      }\n    });\n  }\n  \n  // Initialize pending files UI\n  updatePendingFilesUI();\n}\n\n/**\n * Initialize the application\n */\nasync function init(): Promise<void> {\n  console.log(' GodMode Frontend initializing...');\n  \n  // Initialize legacy bridge for backwards compatibility\n  initLegacyBridge();\n  console.log(' Legacy bridge initialized');\n  \n  // Configure API client\n  configureApiClient();\n  console.log(' API client configured');\n  \n  // Initialize authentication\n  await initAuth();\n  console.log(' Auth initialized');\n  \n  // Theme is already initialized via its constructor\n  console.log(` Theme: ${theme.getMode()} (effective: ${theme.getEffective()})`);\n  \n  // Register keyboard shortcuts\n  registerShortcuts();\n  console.log(' Keyboard shortcuts registered');\n  \n  // Initialize global search (Cmd+K / Ctrl+K)\n  initGlobalSearch({\n    onResultClick: (result) => {\n      console.log('Search result clicked:', result);\n      // Navigate to the result based on type\n      window.dispatchEvent(new CustomEvent('godmode:navigate', { detail: result }));\n    }\n  });\n  console.log(' Global search initialized');\n\n  // Listen for godmode:navigate (e.g. \"View source document\" from Fact/Decision/Risk detail)\n  window.addEventListener('godmode:navigate', async (e: Event) => {\n    const d = (e as CustomEvent).detail;\n    if (!d || d.tab !== 'files' || !d.documentId) return;\n    switchTab('files');\n    await new Promise(r => setTimeout(r, 400)); // allow Files panel to mount\n    const doc = await documentsService.get(d.documentId);\n    if (doc) {\n      const { showDocumentPreviewModal } = await import('./components/modals/DocumentPreviewModal');\n      showDocumentPreviewModal({ document: doc });\n    }\n  });\n\n  // Initialize UI\n  initializeUI();\n  console.log(' UI initialized');\n  \n  // Initialize client-side routing (reads URL and activates correct tab)\n  initRouting();\n  console.log(' Client-side routing initialized');\n\n  // Load initial data (only if authenticated or auth not required)\n  if (auth.isAuthenticated()) {\n    refreshData();\n    console.log(' Data loading started');\n  } else if (appStore.getState().authConfigured) {\n    // Auth required but not logged in - redirect to landing page\n    console.log(' Authentication required - redirecting to landing page');\n    window.location.href = '/';\n    return;\n  } else {\n    // Auth not configured - guest mode\n    console.log(' Guest mode - loading data');\n    refreshData();\n  }\n  \n  // Hide loading state with animation\n  const loading = document.getElementById('app-loading');\n  if (loading) {\n    loading.classList.add('fade-out');\n    setTimeout(() => {\n      loading.style.display = 'none';\n    }, 300);\n  }\n  \n  // Log successful initialization\n  console.log(' GodMode Frontend ready');\n  console.log(` Version: ${window.godmode.version}`);\n  console.log(' Press ? for keyboard shortcuts');\n}\n\n/**\n * Initialize authentication\n */\nasync function initAuth(): Promise<void> {\n  // Check auth status and session\n  const isAuthenticated = await auth.init();\n  \n  // Update UI based on auth state\n  updateAuthUI();\n  \n  // Listen for auth required events (e.g., 401 from API)\n  auth.onAuthRequired(() => {\n    components.showAuthModal({\n      required: true, // Session expired, must re-authenticate\n      onSuccess: () => {\n        updateAuthUI();\n        refreshData();\n        toast.success('Session restored! Refreshing data...');\n      }\n    });\n  });\n\n  // Listen for auth success to refresh data\n  window.addEventListener('godmode:auth-success', () => {\n    updateAuthUI();\n    refreshData();\n  });\n}\n\n/**\n * Show full-screen authentication blocker with integrated login form\n * Completely blocks access to the app until login\n */\nfunction showAuthRequiredMessage(): void {\n  // Remove any existing overlay\n  const existing = document.getElementById('auth-blocker-overlay');\n  if (existing) existing.remove();\n  \n  // Create full-screen blocker overlay\n  const authBlocker = document.createElement('div');\n  authBlocker.id = 'auth-blocker-overlay';\n  authBlocker.innerHTML = `\n    <style>\n      #auth-blocker-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 999999;\n        overflow: auto;\n        font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n      }\n      .auth-card {\n        width: 100%;\n        max-width: 420px;\n        background: rgba(255, 255, 255, 0.03);\n        border-radius: 20px;\n        backdrop-filter: blur(20px);\n        border: 1px solid rgba(255, 255, 255, 0.08);\n        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);\n        padding: 2.5rem;\n        margin: 1rem;\n      }\n      .auth-logo {\n        width: 64px;\n        height: 64px;\n        margin: 0 auto 1.25rem;\n        background: linear-gradient(135deg, #e94560, #ff6b6b);\n        border-radius: 16px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);\n      }\n      .auth-title {\n        color: white;\n        font-size: 1.5rem;\n        font-weight: 700;\n        text-align: center;\n        margin-bottom: 0.5rem;\n        letter-spacing: -0.02em;\n      }\n      .auth-subtitle {\n        color: rgba(255, 255, 255, 0.6);\n        font-size: 0.9rem;\n        text-align: center;\n        margin-bottom: 2rem;\n      }\n      .auth-tabs {\n        display: flex;\n        gap: 0.5rem;\n        margin-bottom: 1.5rem;\n        background: rgba(255, 255, 255, 0.05);\n        border-radius: 10px;\n        padding: 4px;\n      }\n      .auth-tab {\n        flex: 1;\n        padding: 0.625rem 1rem;\n        border: none;\n        background: transparent;\n        color: rgba(255, 255, 255, 0.6);\n        font-size: 0.875rem;\n        font-weight: 500;\n        cursor: pointer;\n        border-radius: 8px;\n        transition: all 0.2s;\n      }\n      .auth-tab:hover {\n        color: rgba(255, 255, 255, 0.9);\n      }\n      .auth-tab.active {\n        background: rgba(233, 69, 96, 0.2);\n        color: #ff6b6b;\n      }\n      .auth-form {\n        display: flex;\n        flex-direction: column;\n        gap: 1rem;\n      }\n      .auth-form.hidden {\n        display: none;\n      }\n      .form-group {\n        display: flex;\n        flex-direction: column;\n        gap: 0.375rem;\n      }\n      .form-label {\n        color: rgba(255, 255, 255, 0.8);\n        font-size: 0.8125rem;\n        font-weight: 500;\n      }\n      .form-input {\n        width: 100%;\n        padding: 0.75rem 1rem;\n        background: rgba(255, 255, 255, 0.06);\n        border: 1px solid rgba(255, 255, 255, 0.1);\n        border-radius: 10px;\n        color: white;\n        font-size: 0.9375rem;\n        transition: all 0.2s;\n        box-sizing: border-box;\n      }\n      .form-input::placeholder {\n        color: rgba(255, 255, 255, 0.35);\n      }\n      .form-input:focus {\n        outline: none;\n        border-color: #e94560;\n        background: rgba(255, 255, 255, 0.08);\n        box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.15);\n      }\n      .form-hint {\n        color: rgba(255, 255, 255, 0.4);\n        font-size: 0.75rem;\n      }\n      .form-error {\n        color: #ff6b6b;\n        font-size: 0.8125rem;\n        padding: 0.75rem;\n        background: rgba(255, 107, 107, 0.1);\n        border-radius: 8px;\n        display: none;\n      }\n      .form-error.visible {\n        display: block;\n      }\n      .auth-submit {\n        width: 100%;\n        padding: 0.875rem;\n        background: linear-gradient(135deg, #e94560, #ff6b6b);\n        border: none;\n        border-radius: 10px;\n        color: white;\n        font-size: 0.9375rem;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        margin-top: 0.5rem;\n      }\n      .auth-submit:hover:not(:disabled) {\n        transform: translateY(-2px);\n        box-shadow: 0 8px 25px rgba(233, 69, 96, 0.4);\n      }\n      .auth-submit:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n      }\n      .auth-link {\n        color: #ff6b6b;\n        background: none;\n        border: none;\n        font-size: 0.8125rem;\n        cursor: pointer;\n        padding: 0;\n        text-decoration: underline;\n        text-underline-offset: 2px;\n      }\n      .auth-link:hover {\n        color: #e94560;\n      }\n      .auth-footer {\n        text-align: center;\n        margin-top: 1.5rem;\n        color: rgba(255, 255, 255, 0.5);\n        font-size: 0.8125rem;\n      }\n      .password-toggle {\n        position: absolute;\n        right: 12px;\n        top: 50%;\n        transform: translateY(-50%);\n        background: none;\n        border: none;\n        color: rgba(255, 255, 255, 0.4);\n        cursor: pointer;\n        padding: 4px;\n      }\n      .password-toggle:hover {\n        color: rgba(255, 255, 255, 0.7);\n      }\n      .input-wrapper {\n        position: relative;\n      }\n    </style>\n    \n    <div class=\"auth-card\">\n      <div class=\"auth-logo\">\n        <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\n          <path d=\"M2 17l10 5 10-5\"/>\n          <path d=\"M2 12l10 5 10-5\"/>\n        </svg>\n      </div>\n      <h1 class=\"auth-title\">Welcome to GodMode</h1>\n      <p class=\"auth-subtitle\">Your AI-powered knowledge management platform</p>\n      \n      <div class=\"auth-tabs\">\n        <button class=\"auth-tab active\" data-tab=\"login\">Sign In</button>\n        <button class=\"auth-tab\" data-tab=\"register\">Create Account</button>\n      </div>\n      \n      <!-- Login Form -->\n      <form id=\"login-form\" class=\"auth-form\">\n        <div class=\"form-group\">\n          <label class=\"form-label\">Email</label>\n          <input type=\"email\" class=\"form-input\" id=\"login-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Password</label>\n          <div class=\"input-wrapper\">\n            <input type=\"password\" class=\"form-input\" id=\"login-password\" placeholder=\"Enter your password\" required autocomplete=\"current-password\">\n          </div>\n        </div>\n        <div class=\"form-error\" id=\"login-error\"></div>\n        <button type=\"submit\" class=\"auth-submit\" id=\"login-submit\">Sign In</button>\n        <div class=\"auth-footer\">\n          <button type=\"button\" class=\"auth-link\" id=\"forgot-link\">Forgot your password?</button>\n        </div>\n      </form>\n      \n      <!-- Register Form -->\n      <form id=\"register-form\" class=\"auth-form hidden\">\n        <div class=\"form-group\">\n          <label class=\"form-label\">Email *</label>\n          <input type=\"email\" class=\"form-input\" id=\"register-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Display Name</label>\n          <input type=\"text\" class=\"form-input\" id=\"register-name\" placeholder=\"Your name (optional)\" autocomplete=\"name\">\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Password *</label>\n          <input type=\"password\" class=\"form-input\" id=\"register-password\" placeholder=\"Min. 12 characters\" required minlength=\"12\" autocomplete=\"new-password\">\n          <span class=\"form-hint\">Use at least 12 characters with mixed case, numbers, and symbols</span>\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Confirm Password *</label>\n          <input type=\"password\" class=\"form-input\" id=\"register-confirm\" placeholder=\"Confirm your password\" required autocomplete=\"new-password\">\n        </div>\n        <div class=\"form-error\" id=\"register-error\"></div>\n        <button type=\"submit\" class=\"auth-submit\" id=\"register-submit\">Create Account</button>\n      </form>\n      \n      <!-- Forgot Password Form -->\n      <form id=\"forgot-form\" class=\"auth-form hidden\">\n        <p style=\"color: rgba(255,255,255,0.7); font-size: 0.875rem; margin-bottom: 1rem;\">\n          Enter your email and we'll send you a link to reset your password.\n        </p>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Email</label>\n          <input type=\"email\" class=\"form-input\" id=\"forgot-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\n        </div>\n        <div class=\"form-error\" id=\"forgot-error\"></div>\n        <button type=\"submit\" class=\"auth-submit\">Send Reset Link</button>\n        <div class=\"auth-footer\">\n          <button type=\"button\" class=\"auth-link\" id=\"back-to-login\">Back to Sign In</button>\n        </div>\n      </form>\n    </div>\n  `;\n  \n  document.body.appendChild(authBlocker);\n  \n  // Tab switching\n  const tabs = authBlocker.querySelectorAll('.auth-tab');\n  const loginForm = authBlocker.querySelector('#login-form') as HTMLFormElement;\n  const registerForm = authBlocker.querySelector('#register-form') as HTMLFormElement;\n  const forgotForm = authBlocker.querySelector('#forgot-form') as HTMLFormElement;\n  \n  tabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      \n      const tabId = tab.getAttribute('data-tab');\n      loginForm.classList.toggle('hidden', tabId !== 'login');\n      registerForm.classList.toggle('hidden', tabId !== 'register');\n      forgotForm.classList.add('hidden');\n    });\n  });\n  \n  // Forgot password link\n  const forgotLink = authBlocker.querySelector('#forgot-link');\n  forgotLink?.addEventListener('click', () => {\n    loginForm.classList.add('hidden');\n    registerForm.classList.add('hidden');\n    forgotForm.classList.remove('hidden');\n    tabs.forEach(t => t.classList.remove('active'));\n  });\n  \n  // Back to login\n  const backToLogin = authBlocker.querySelector('#back-to-login');\n  backToLogin?.addEventListener('click', () => {\n    forgotForm.classList.add('hidden');\n    loginForm.classList.remove('hidden');\n    tabs[0].classList.add('active');\n  });\n  \n  // Handle Login\n  loginForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = (authBlocker.querySelector('#login-email') as HTMLInputElement).value;\n    const password = (authBlocker.querySelector('#login-password') as HTMLInputElement).value;\n    const errorEl = authBlocker.querySelector('#login-error') as HTMLElement;\n    const submitBtn = authBlocker.querySelector('#login-submit') as HTMLButtonElement;\n    \n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Signing in...';\n    errorEl.classList.remove('visible');\n    \n    try {\n      await auth.login({ email, password });\n      authBlocker.remove();\n      updateAuthUI();\n      refreshData();\n      toast.success('Welcome back!');\n    } catch (err) {\n      errorEl.textContent = err instanceof Error ? err.message : 'Login failed. Please try again.';\n      errorEl.classList.add('visible');\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Sign In';\n    }\n  });\n  \n  // Handle Register\n  registerForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = (authBlocker.querySelector('#register-email') as HTMLInputElement).value;\n    const name = (authBlocker.querySelector('#register-name') as HTMLInputElement).value;\n    const password = (authBlocker.querySelector('#register-password') as HTMLInputElement).value;\n    const confirm = (authBlocker.querySelector('#register-confirm') as HTMLInputElement).value;\n    const errorEl = authBlocker.querySelector('#register-error') as HTMLElement;\n    const submitBtn = authBlocker.querySelector('#register-submit') as HTMLButtonElement;\n    \n    if (password !== confirm) {\n      errorEl.textContent = 'Passwords do not match';\n      errorEl.classList.add('visible');\n      return;\n    }\n    \n    if (password.length < 12) {\n      errorEl.textContent = 'Password must be at least 12 characters';\n      errorEl.classList.add('visible');\n      return;\n    }\n    \n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Creating account...';\n    errorEl.classList.remove('visible');\n    \n    try {\n      const result = await auth.register({ email, password, display_name: name || undefined });\n      \n      if (result.needsEmailVerification) {\n        toast.success('Account created! Check your email to verify.');\n        // Switch to login tab\n        tabs.forEach(t => t.classList.remove('active'));\n        tabs[0].classList.add('active');\n        registerForm.classList.add('hidden');\n        loginForm.classList.remove('hidden');\n      } else {\n        authBlocker.remove();\n        updateAuthUI();\n        refreshData();\n        toast.success('Account created! Welcome to GodMode.');\n      }\n    } catch (err) {\n      errorEl.textContent = err instanceof Error ? err.message : 'Registration failed. Please try again.';\n      errorEl.classList.add('visible');\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Create Account';\n    }\n  });\n  \n  // Handle Forgot Password\n  forgotForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = (authBlocker.querySelector('#forgot-email') as HTMLInputElement).value;\n    const submitBtn = forgotForm.querySelector('.auth-submit') as HTMLButtonElement;\n    \n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Sending...';\n    \n    try {\n      await auth.forgotPassword(email);\n      toast.success('If an account exists, you will receive a reset link.');\n      // Go back to login\n      forgotForm.classList.add('hidden');\n      loginForm.classList.remove('hidden');\n      tabs[0].classList.add('active');\n    } catch {\n      toast.success('If an account exists, you will receive a reset link.');\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Send Reset Link';\n    }\n  });\n  \n  // Focus email input\n  setTimeout(() => {\n    const emailInput = authBlocker.querySelector('#login-email') as HTMLInputElement;\n    emailInput?.focus();\n  }, 100);\n}\n\n/**\n * Update UI based on auth state\n */\nfunction updateAuthUI(): void {\n  const user = auth.getCurrentUser();\n  const userAvatar = document.getElementById('user-avatar');\n  const userDropdown = document.getElementById('user-dropdown');\n  const loginBtn = document.getElementById('login-btn');\n  \n  // Remove auth blocker if it exists\n  const authBlocker = document.getElementById('auth-blocker-overlay');\n  if (authBlocker && user) {\n    authBlocker.remove();\n  }\n  \n  // Admin nav button - only visible for superadmin\n  const adminNavBtn = document.getElementById('nav-admin-btn');\n  \n  if (user) {\n    // Show user info\n    if (userAvatar) {\n      const displayName = user.name || user.email.split('@')[0] || 'User';\n      const initials = (user.name?.[0] || user.email[0]).toUpperCase();\n      \n      // Generate fallback avatar URL using UI Avatars\n      const fallbackAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=e11d48&color=fff&size=80&font-size=0.4&bold=true`;\n      const avatarUrl = user.avatar || fallbackAvatar;\n      \n      // Use image for avatar\n      userAvatar.innerHTML = `<img src=\"${avatarUrl}\" alt=\"${initials}\" style=\"width:100%;height:100%;border-radius:50%;object-fit:cover;\" onerror=\"this.style.display='none';this.parentElement.textContent='${initials}';\">`;\n      userAvatar.title = user.name || user.email;\n      userAvatar.classList.remove('hidden');\n    }\n    if (loginBtn) {\n      loginBtn.classList.add('hidden');\n    }\n    // Update dropdown content\n    if (userDropdown) {\n      const userName = userDropdown.querySelector('.user-name');\n      const userEmail = userDropdown.querySelector('.user-email');\n      if (userName) userName.textContent = user.name || 'User';\n      if (userEmail) userEmail.textContent = user.email;\n    }\n    \n    // Show/hide Admin nav based on role\n    if (adminNavBtn) {\n      if (user.role === 'superadmin') {\n        adminNavBtn.classList.remove('hidden');\n        console.log(' Admin nav enabled for superadmin:', user.email);\n      } else {\n        adminNavBtn.classList.add('hidden');\n      }\n    }\n  } else {\n    // Show login button\n    if (userAvatar) {\n      userAvatar.classList.add('hidden');\n    }\n    if (loginBtn) {\n      loginBtn.classList.remove('hidden');\n    }\n    // Hide admin nav when logged out\n    if (adminNavBtn) {\n      adminNavBtn.classList.add('hidden');\n    }\n  }\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n\n// Add components to global\nObject.assign(window.godmode, { components });\n\n// Export for potential use in other modules\nexport { \n  theme, toast, shortcuts, undoManager, storage, http, api, configureApi, auth, projects,\n  dashboardService, questionsService, risksService, actionsService, decisionsService,\n  chatService, contactsService, teamsService, documentsService, knowledgeService,\n  emailsService, graphService, timelineService, costsService, notificationsService,\n  commentsService, membersService, profileService, userSettingsService, projectSettingsService,\n  apiKeysService, webhooksService, auditService\n};\nexport { appStore, uiStore, dataStore, chartsStore };\nexport { components };\n"],"file":"main-DZFGTOOo.js"}