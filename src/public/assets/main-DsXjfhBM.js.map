{"version":3,"mappings":"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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAmbuBsgE,EAAW,qBAAuB,EAAE;AAAA;AAAA;AAAA,UA9b1CA,EACpB;AAAA;AAAA;AAAA,iBAIA;AAAA;AAAA;AAAA;AAAA,gBA4bmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAiBatxB,IAAe,UAAY,SAAW,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAOxCA,IAAe,OAAS,SAAW,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCAWpCA,IAAe,UAAY,SAAW,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCAWxCqxB,IAAiB,SAAW,WAAa,EAAE;AAAA,sCAC5CA,IAAiB,QAAU,WAAa,EAAE;AAAA,qCAC3CA,IAAiB,OAAS,WAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCAQ3Cl7D,EAAM,OAAO,WAAa,KAAO,WAAa,EAAE;AAAA,mCAChDA,EAAM,OAAO,WAAa,KAAO,WAAa,EAAE;AAAA,mCAChDA,EAAM,OAAO,WAAa,KAAO,WAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAiBvEA,EAAM,aAAa,OAAS,aAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAQzC,EAAE;AAAA;AAAA;AAAA;AAAA,uCAIuB6pC,IAAe,OAAS,SAAW,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8DAcd7pC,EAAM,OAAO,mBAAqB,GAAQ,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oEAWlDA,EAAM,OAAO,wBAA0B,GAAQ,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mEAW9DA,EAAM,OAAO,uBAAyB,GAAO,UAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAmB9H,CAKO,SAASo7D,GAAkBv2C,EAA4B,GAAU,CAEtE,MAAMsF,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMnqB,EAAQqB,EAAS,WACjB65D,EAAe1gE,GAAM,UACrBqvC,EAAahlB,EAAM,YAAc,UAEjCw2C,EAAez4C,EAAc,MAAO,CAAE,UAAW,yBAA0B,EACjFy4C,EAAa,aAAa,gBAAiB7xC,EAAQ,EACnD,MAAMjG,EAAYX,EAAc,MAAO,CAAE,UAAW,2BAA4B,EAChFW,EAAU,UAAY03C,GAAkBj7D,EAAOk7D,EAAcrxB,EAAY,CAAE,SAAU,GAAO,EAC5FwxB,EAAa,YAAY93C,CAAS,EAClC,SAAS,KAAK,YAAY83C,CAAY,EAEtC,MAAM72C,EAAa,IAAM62C,EAAa,SACtCC,GAAmBD,EAAc,CAC/B,GAAGx2C,EACH,QAASL,EACT,cAAeA,EACf,kBAAmB,IAAM,CACvBA,EAAA,EACAo0C,GAAA,CACF,EACD,CACH,CAKO,SAAS0C,GACdC,EACA12C,EACM,CACN,MAAMgC,EAAW00C,EAAK,cAAc,qBAAqB,EACnDryC,EAAYqyC,EAAK,cAAc,sBAAsB,EACrDC,EAAYD,EAAK,UAAU,SAAS,wBAAwB,EAE5DE,EAAc,IAAM,CACpB52C,EAAM,QAASA,EAAM,UAChB22C,KAAgB,QAC3B,EAEI30C,GAAU5D,EAAG4D,EAAyB,QAAS40C,CAAW,EAC1DvyC,GAAWjG,EAAGiG,EAA0B,QAASuyC,CAAW,EAE5DD,GACFv4C,EAAGs4C,EAAM,QAAUtrD,GAAM,CACnBA,EAAE,SAAWsrD,GAAME,EAAA,CACzB,CAAC,EAGH,MAAMC,EAAqBH,EAAK,cAAc,gCAAgC,EAC1EG,GACFz4C,EAAGy4C,EAAmC,QAAS,IAAM,CAC/C72C,EAAM,kBAAmBA,EAAM,qBAEjC42C,EAAA,EACA7C,GAAA,EAEJ,CAAC,EAIH,MAAMnyC,EAAO80C,EAAK,iBAAiB,eAAe,EAClD90C,EAAK,QAAQ3C,GAAO,CAClBb,EAAGa,EAAoB,QAAS,IAAM,CACpC,MAAMmD,EAAQnD,EAAI,aAAa,UAAU,EACzC2C,EAAK,QAAQ2G,GAAKA,EAAE,UAAU,OAAO,QAAQ,CAAC,EAC9CtJ,EAAI,UAAU,IAAI,QAAQ,EAC1By3C,EAAK,iBAAiB,mBAAmB,EAAE,QAAQluC,GAAW,CAC5DA,EAAQ,UAAU,OAAO,QAAQ,CACnC,CAAC,EACD,MAAMsuC,EAAgBJ,EAAK,cAAc,YAAYt0C,CAAK,EAAE,EACxD00C,GAAeA,EAAc,UAAU,IAAI,QAAQ,CACzD,CAAC,CACH,CAAC,EAED,MAAMC,EAAcL,EAAK,cAAc,gBAAgB,EACnDK,GACF34C,EAAG24C,EAAa,SAAU,IAAM,CAC9BphE,GAAM,IAAIohE,EAAY,KAAoC,CAC5D,CAAC,EAGH,MAAM7wC,EAAUwwC,EAAK,cAAc,oBAAoB,EACnDxwC,GACF9H,EAAG8H,EAAwB,QAAS,IAAM,CACxC,MAAMpN,EAAW,CACf,MAAQ49C,EAAK,cAAc,gBAAgB,GAAyB,MACpE,SAAWA,EAAK,cAAc,mBAAmB,GAAyB,MAC1E,iBAAmBA,EAAK,cAAc,oBAAoB,GAAwB,QAClF,sBAAwBA,EAAK,cAAc,0BAA0B,GAAwB,QAC7F,qBAAuBA,EAAK,cAAc,yBAAyB,GAAwB,SAE7Fl6D,EAAS,UAAU,CACjB,GAAGA,EAAS,WAAW,OACvB,GAAGsc,CAAA,CACJ,EACDkH,EAAM,SAASlH,CAAQ,EACvB5iB,EAAM,QAAQ,gBAAgB,EAC9B8pB,EAAM,iBACR,CAAC,CAEL,CC1tBA,MAAM2E,GAAW,mBAiBjB,IAAIqyC,GAAiC,GACjCC,GAKG,SAASC,GAAoBl3C,EAA8B,GAAU,CAC1E,KAAM,CACJ,MAAAkD,EAAQ,aACR,MAAAi0C,EAAQ,GACR,SAAAC,EACA,YAAAC,EAAc,IACZr3C,EAEJg3C,GAAeG,EACfF,GAAiBG,EAGjB,MAAM9xC,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMje,EAAU0W,EAAc,MAAO,CAAE,UAAW,qBAAsB,EACxEu5C,GAAcjwD,CAAO,EAErB,MAAMkc,EAAS8zC,EAAcE,GAAA,EAAiB,KAExC/zC,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAAzB,EACA,QAAA7b,EACA,KAAM,KACN,SAAU,GACV,OAAAkc,CAAA,CACD,EAED,SAAS,KAAK,YAAYC,CAAK,EAC/B/D,GAAUkF,EAAQ,CACpB,CAKA,SAAS2yC,GAAc54C,EAA8B,CACnDA,EAAU,UAAY;AAAA;AAAA,QAEhBs4C,GAAa,IAAIQ,GAAQC,GAAWD,CAAI,CAAC,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,wDAIHE,IAA0B;AAAA;AAAA,mCAE/CA,IAA0B;AAAA;AAAA,GAG7D,CAKA,SAASD,GAAWD,EAA8B,CAChD,MAAMG,EAAa,CACjB,QAAS,IACT,QAAS,KACT,UAAW,IACX,MAAO,KACPH,EAAK,MAAM,EAIb,MAAO;AAAA,kCAFaA,EAAK,MAGkB,mBAAmBA,EAAK,EAAE;AAAA,gCACvCG,CAAU;AAAA;AAAA,kCAERH,EAAK,KAAK;AAAA,UAClCA,EAAK,QAAU,6BAA6BA,EAAK,OAAO,SAAW,EAAE;AAAA,UACrEA,EAAK,SAAW,WAAaA,EAAK,WAAa,OAAY;AAAA;AAAA;AAAA,8DAGPA,EAAK,QAAQ;AAAA;AAAA;AAAA,UAG/D,EAAE;AAAA;AAAA;AAAA,GAId,CAKA,SAASE,IAAmC,CAC1C,GAAIV,GAAa,SAAW,EAAG,MAAO,GAEtC,MAAMY,EAAYZ,GAAa,UAAY,EAAE,SAAW,WAAW,EAAE,OAC/Da,EAAUb,GAAa,KAAK,GAAK,EAAE,SAAW,SAAS,EACvDc,EAAkBD,GAAS,UAAY,EAE7C,OAAO,KAAK,OACRD,GAAaC,EAAUC,EAAkB,IAAM,IAAMd,GAAa,OAAU,IAElF,CAKA,SAASO,IAA4B,CACnC,MAAMh0C,EAASxF,EAAc,MAAO,CAAE,UAAW,eAAgB,EAE3DsG,EAAYtG,EAAc,SAAU,CACxC,UAAW,oBACX,YAAa,SACd,EAED,OAAAK,EAAGiG,EAAW,QAAS,IAAM,CAC3B4yC,KAAA,EACAc,GAAA,CACF,CAAC,EAEDx0C,EAAO,YAAYc,CAAS,EACrBd,CACT,CAKO,SAASy0C,GACdC,EACA3jD,EACM,CACN,MAAM4jD,EAAYlB,GAAa,UAAUl8D,GAAKA,EAAE,KAAOm9D,CAAM,EAC7D,GAAIC,IAAc,GAAI,OAEtBlB,GAAakB,CAAS,EAAI,CAAE,GAAGlB,GAAakB,CAAS,EAAG,GAAG5jD,CAAA,EAG3D,MAAMkP,EAAQ,SAAS,cAAc,mBAAmBmB,EAAQ,IAAI,EACpE,GAAInB,EAAO,CACT,MAAMnc,EAAUmc,EAAM,cAAc,qBAAqB,EACrDnc,GACFiwD,GAAcjwD,CAAsB,CAExC,CACF,CAKO,SAAS8wD,GAAkBX,EAA4B,CAC5DR,GAAa,KAAKQ,CAAI,EAEtB,MAAMh0C,EAAQ,SAAS,cAAc,mBAAmBmB,EAAQ,IAAI,EACpE,GAAInB,EAAO,CACT,MAAMnc,EAAUmc,EAAM,cAAc,qBAAqB,EACrDnc,GACFiwD,GAAcjwD,CAAsB,CAExC,CACF,CAKO,SAAS+wD,GAAmBjB,EAA+B,CAChEH,GAAeG,EAEf,MAAM3zC,EAAQ,SAAS,cAAc,mBAAmBmB,EAAQ,IAAI,EACpE,GAAInB,EAAO,CACT,MAAMnc,EAAUmc,EAAM,cAAc,qBAAqB,EACrDnc,GACFiwD,GAAcjwD,CAAsB,CAExC,CACF,CAKO,SAAS0wD,IAA6B,CAC3Cp4C,EAAWgF,EAAQ,EACnBqyC,GAAe,GACfC,GAAiB,MACnB,CAKO,SAASoB,IAAiC,CAE/C,OADc,SAAS,cAAc,mBAAmB1zC,EAAQ,IAAI,GACtD,UAAU,SAAS,MAAM,GAAK,EAC9C,CC5MA,MAAMA,GAAW,aAajB,IAAI2zC,GAAwB,QACxBjyC,GAA+B,GAC/BkyC,GAAmB,GACnBC,GAAyB,EACzBC,GAAqC,KAKlC,SAASC,GAAc14C,EAAwB,GAAU,CAC9Ds4C,GAAct4C,EAAM,aAAe,QACnCqG,GAAerG,EAGf,MAAMsF,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMje,EAAU0W,EAAc,MAAO,CAAE,UAAW,eAAgB,EAClE46C,GAAkBtxD,CAAO,EAEzB,MAAMmc,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAOi0C,GAAA,EACP,QAAAvxD,EACA,KAAM,KACN,SAAU,CAAC2Y,EAAM,SACjB,QAASA,EAAM,QACf,OAAQ,KACT,EAED,SAAS,KAAK,YAAYwD,CAAK,EAC/B/D,GAAUkF,EAAQ,EAGlB,WAAW,IAAM,CACf,MAAMk0C,EAAaxxD,EAAQ,cAAc,OAAO,EAC5CwxD,KAAuB,OAC7B,EAAG,GAAG,CACR,CAKA,SAASD,IAAmB,CAC1B,OAAQN,GAAA,CACN,IAAK,QAAS,MAAO,UACrB,IAAK,WAAY,MAAO,iBACxB,IAAK,SAAU,MAAO,iBACtB,IAAK,QAAS,MAAO,mBACrB,IAAK,cAAe,MAAO,oBAC3B,IAAK,aAAc,MAAO,aAC1B,IAAK,gBAAiB,MAAO,gBAEjC,CAKA,SAASK,GAAkBj6C,EAA8B,CAOvD,OALI+5C,KACF,cAAcA,EAAW,EACzBA,GAAc,MAGRH,GAAA,CACN,IAAK,QACHQ,GAAgBp6C,CAAS,EACzB,MACF,IAAK,WACHq6C,GAAmBr6C,CAAS,EAC5B,MACF,IAAK,SACHs6C,GAAiBt6C,CAAS,EAC1B,MACF,IAAK,QACHu6C,GAAgBv6C,CAAS,EACzB,MACF,IAAK,cACHw6C,GAAqBx6C,CAAS,EAC9B,MACF,IAAK,aACHy6C,GAAoBz6C,CAAS,EAC7B,MACF,IAAK,gBACH06C,GAAuB16C,CAAS,EAChC,MAEN,CAKA,SAASo6C,GAAgBp6C,EAA8B,CACrDA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAiCtB,MAAMyJ,EAAOzJ,EAAU,cAAc,aAAa,EAClDN,EAAG+J,EAAM,SAAU,MAAO/c,GAAM,CAC9BA,EAAE,iBACF,MAAMiuD,GAAYlxC,CAAI,CACxB,CAAC,EAEDmxC,GAAc56C,CAAS,CACzB,CAKA,SAASq6C,GAAmBr6C,EAA8B,CACxDA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAuCtB,MAAMyJ,EAAOzJ,EAAU,cAAc,gBAAgB,EAG/C66C,EAAgBpxC,EAAK,cAAc,oBAAoB,EAC7D/J,EAAGm7C,EAAe,QAAS,IAAM,CAC/BC,GAAuBD,EAAc,KAAK,CAC5C,CAAC,EAEDn7C,EAAG+J,EAAM,SAAU,MAAO/c,GAAM,CAC9BA,EAAE,iBACF,MAAMquD,GAAetxC,CAAI,CAC3B,CAAC,EAEDmxC,GAAc56C,CAAS,CACzB,CAKA,SAASs6C,GAAiBt6C,EAA8B,CACtDA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAsBtB,MAAMyJ,EAAOzJ,EAAU,cAAc,cAAc,EACnDN,EAAG+J,EAAM,SAAU,MAAO/c,GAAM,CAC9BA,EAAE,iBACF,MAAMsuD,GAAavxC,CAAI,CACzB,CAAC,EAEDmxC,GAAc56C,CAAS,CACzB,CAKA,SAASu6C,GAAgBv6C,EAA8B,CACrDA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAyBtB,MAAMyJ,EAAOzJ,EAAU,cAAc,aAAa,EAG5C66C,EAAgBpxC,EAAK,cAAc,iBAAiB,EAC1D/J,EAAGm7C,EAAe,QAAS,IAAM,CAC/BC,GAAuBD,EAAc,MAAO,yBAAyB,CACvE,CAAC,EAEDn7C,EAAG+J,EAAM,SAAU,MAAO/c,GAAM,CAC9BA,EAAE,iBACF,MAAMuuD,GAAYxxC,CAAI,CACxB,CAAC,CACH,CAKA,SAAS+wC,GAAqBx6C,EAA8B,CAC1DA,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+GAOuF65C,EAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAiBrH,MAAMpwC,EAAOzJ,EAAU,cAAc,mBAAmB,EACxDN,EAAG+J,EAAM,SAAU,MAAO/c,GAAM,CAC9BA,EAAE,iBACF,MAAMwuD,GAAiBzxC,EAAMzJ,CAAS,CACxC,CAAC,EAED46C,GAAc56C,CAAS,CACzB,CAKA,SAASy6C,GAAoBz6C,EAA8B,CACzD,MAAMm7C,EAActB,GAClBA,GAAS,QAAQ,kBAAmB,SAAS,EAC7C,aAEF75C,EAAU,UAAY;AAAA;AAAA;AAAA,iDAGyBm7C,CAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sEAsBUrB,GAAiB,EAAI,WAAa,EAAE;AAAA,YAC9FA,GAAiB,EAAI,kBAAkBA,EAAc,IAAM,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAWlF,MAAMrwC,EAAOzJ,EAAU,cAAc,kBAAkB,EACjDo7C,EAASp7C,EAAU,iBAAiB,YAAY,EAChDq7C,EAAcr7C,EAAU,cAAc,WAAW,EACjDwiC,EAAYxiC,EAAU,cAAc,iBAAiB,EACrDs7C,EAAYt7C,EAAU,cAAc,kBAAkB,EAG5Du7C,GAAeH,EAAQC,EAAa7Y,CAAS,EAGzCsX,GAAiB,GACnB0B,GAAoBF,CAAS,EAI/B57C,EAAG47C,EAAW,QAAS,SAAY,CACjC,MAAMG,GAAiBz7C,CAAS,CAClC,CAAC,EAEDN,EAAG+J,EAAM,SAAU,MAAO/c,GAAM,CAC9BA,EAAE,iBACF,MAAMgvD,GAAgBjyC,CAAe,CACvC,CAAC,EAEDmxC,GAAc56C,CAAS,EAGvB,WAAW,IAAMo7C,EAAO,CAAC,GAAG,QAAS,GAAG,CAC1C,CAKA,SAASV,GAAuB16C,EAA8B,CAC5D,MAAMrhB,EAAQgpB,GAAa,OAASkyC,IAAY,GAEhD75C,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA,sDAI8BrhB,GAAS,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA2BzE,MAAM8qB,EAAOzJ,EAAU,cAAc,qBAAqB,EACpDo7C,EAASp7C,EAAU,iBAAiB,YAAY,EAChDq7C,EAAcr7C,EAAU,cAAc,eAAe,EACrD4F,EAAa5F,EAAU,cAAc,cAAc,EAEzDu7C,GAAeH,EAAQC,EAAaz1C,CAAU,EAE9ClG,EAAG+J,EAAM,SAAU,MAAO/c,GAAM,CAC9BA,EAAE,iBACF,MAAMivD,GAAmBlyC,EAAMzJ,EAAWrhB,CAAK,CACjD,CAAC,EAEDi8D,GAAc56C,CAAS,EACvB,WAAW,IAAMo7C,EAAO,CAAC,GAAG,QAAS,GAAG,CAC1C,CAKA,SAASG,GACPH,EACAC,EACA1xC,EACM,CACN,MAAMiyC,EAAoB,IAAM,CAC9B,MAAM18D,EAAO,MAAM,KAAKk8D,CAAM,EAAE,IAAI,GAAK,EAAE,KAAK,EAAE,KAAK,EAAE,EACzDC,EAAY,MAAQn8D,EACpByqB,EAAU,SAAWzqB,EAAK,SAAW,GAAK,CAAC,UAAU,KAAKA,CAAI,CAChE,EAEAk8D,EAAO,QAAQ,CAAC5gE,EAAOlC,IAAU,CAE/BonB,EAAGllB,EAAO,QAAUkS,GAAM,CACxB,MAAMxR,EAASwR,EAAE,OAA4B,MAG7C,GAAI,CAAC,QAAQ,KAAKxR,CAAK,EAAG,CACxBV,EAAM,MAAQU,EAAM,QAAQ,MAAO,EAAE,EACrC,MACF,CAGA,GAAIA,EAAM,OAAS,EAAG,CACpB,MAAM2gE,EAAS3gE,EAAM,MAAM,EAAE,EAC7BkgE,EAAO,QAAQ,CAACU,EAAKjtC,IAAM,CACzBitC,EAAI,MAAQD,EAAOhtC,CAAC,GAAK,EAC3B,CAAC,EACD,MAAM/3B,EAAY,KAAK,IAAI+kE,EAAO,OAAQ,CAAC,EAC3CT,EAAOtkE,CAAS,GAAG,QACnB8kE,EAAA,EACA,MACF,CAGI1gE,GAAS5C,EAAQ8iE,EAAO,OAAS,GACnCA,EAAO9iE,EAAQ,CAAC,EAAE,QAGpBsjE,EAAA,CACF,CAAC,EAGDl8C,EAAGllB,EAAO,UAAYkS,GAAM,CAC1B,MAAM5R,EAAO4R,EAAoB,IAE7B5R,IAAQ,aAAe,CAACN,EAAM,OAASlC,EAAQ,IACjD8iE,EAAO9iE,EAAQ,CAAC,EAAE,QAClB8iE,EAAO9iE,EAAQ,CAAC,EAAE,MAAQ,GAC1BsjE,EAAA,GAIE9gE,IAAQ,aAAexC,EAAQ,GACjC8iE,EAAO9iE,EAAQ,CAAC,EAAE,QAEhBwC,IAAQ,cAAgBxC,EAAQ8iE,EAAO,OAAS,GAClDA,EAAO9iE,EAAQ,CAAC,EAAE,OAEtB,CAAC,EAGDonB,EAAGllB,EAAO,QAAUkS,GAAM,CACxBA,EAAE,iBAEF,MAAMmvD,GADUnvD,EAAqB,eAAe,QAAQ,MAAM,GAAK,IACjD,QAAQ,MAAO,EAAE,EAAE,MAAM,EAAG,CAAC,EAEnD,GAAImvD,EAAQ,CACVA,EAAO,MAAM,EAAE,EAAE,QAAQ,CAACE,EAAOltC,IAAM,CACjCusC,EAAOvsC,CAAC,IAAGusC,EAAOvsC,CAAC,EAAE,MAAQktC,EACnC,CAAC,EACD,MAAMjlE,EAAY,KAAK,IAAI+kE,EAAO,OAAQ,CAAC,EAC3CT,EAAOtkE,CAAS,GAAG,QACnB8kE,EAAA,CACF,CACF,CAAC,EAGDl8C,EAAGllB,EAAO,QAAS,IAAMA,EAAM,QAAQ,CACzC,CAAC,CACH,CAKA,SAASghE,GAAoBv7C,EAAiC,CACxD85C,kBAA2BA,EAAW,EAE1C,MAAM75C,EAAe,IAAM,CACrB45C,GAAiB,GACnB75C,EAAO,SAAW,GAClBA,EAAO,YAAc,kBAAkB65C,EAAc,IACrDA,OAEA75C,EAAO,SAAW,GAClBA,EAAO,YAAc,cACjB85C,KACF,cAAcA,EAAW,EACzBA,GAAc,MAGpB,EAEA75C,EAAA,EACA65C,GAAc,YAAY75C,EAAc,GAAI,CAC9C,CAKA,eAAeg7C,GAAiBzxC,EAAuBzJ,EAAuC,CAC5F,MAAMrhB,EAAS8qB,EAAK,cAAc,YAAY,EAAuB,MAAM,OACrEuyC,EAAUvyC,EAAK,cAAc,oBAAoB,EAEvDwyC,GAAexyC,EAAM,EAAI,EACzByyC,GAAUF,CAAO,EAEjB,GAAI,CACF,MAAMviE,EAAS,MAAMoG,GAAK,iBAAiBlB,CAAK,EAGhDk7D,GAAWl7D,EAGXm7D,GAAiB,GAEjBtiE,EAAM,QAAQiC,EAAO,SAAW,8BAA8B,EAG9DmgE,GAAc,aACd,MAAMt0C,EAAU,SAAS,cAAc,mBAAmBW,EAAQ,qBAAqB,EACnFX,IAASA,EAAQ,YAAc40C,GAAA,GACnCD,GAAkBj6C,CAAS,CAE7B,OAASroB,EAAgB,CAEvB,MAAMP,EADMO,EACQ,SAAW,sBAC/BwkE,GAAUH,EAAS5kE,CAAO,CAC5B,SACE6kE,GAAexyC,EAAM,EAAK,CAC5B,CACF,CAKA,eAAeiyC,GAAgBjyC,EAAuBzJ,EAAuC,CAC3F,MAAM9gB,EAAQuqB,EAAK,cAAc,WAAW,EAAuB,MAC7DuyC,EAAUvyC,EAAK,cAAc,mBAAmB,EAEtD,GAAI,CAACvqB,GAAQA,EAAK,SAAW,EAAG,CAC9Bi9D,GAAUH,EAAS,+BAA+B,EAClD,MACF,CAEAC,GAAexyC,EAAM,EAAI,EACzByyC,GAAUF,CAAO,EAEjB,GAAI,CACF,MAAM7+D,EAAO,MAAM0C,GAAK,gBAAgBg6D,GAAU36D,CAAI,EAEtD1H,EAAM,QAAQ,wBAAwB,EACtCmwB,GAAa,YAAYxqB,CAAI,EAC7B8jB,EAAWgF,EAAQ,EAGnB,OAAO,cAAc,IAAI,YAAY,sBAAsB,CAAC,CAE9D,OAAStuB,EAAgB,CACvB,MAAMo4B,EAAMp4B,EAOZ,IAAIP,EAAU24B,EAAI,SAAW,sBAEzBA,EAAI,oBAAsB,QAAaA,EAAI,kBAAoB,IACjE34B,GAAW,KAAK24B,EAAI,iBAAiB,wBAGnCA,EAAI,yBACN34B,EAAU,4CAIR24B,EAAI,qBACN34B,EAAU,8CAGZ+kE,GAAUH,EAAS5kE,CAAO,EAG1B,MAAMgkE,EAAS3xC,EAAK,iBAAiB,YAAY,EACjD2xC,EAAO,QAAQvsC,GAAKA,EAAE,MAAQ,EAAE,EAChCusC,EAAO,CAAC,GAAG,OAEb,SACEa,GAAexyC,EAAM,EAAK,CAC5B,CACF,CAKA,eAAegyC,GAAiBz7C,EAAuC,CACrE,GAAI85C,GAAiB,EAAG,OAExB,MAAMwB,EAAYt7C,EAAU,cAAc,kBAAkB,EAC5Ds7C,EAAU,SAAW,GACrBA,EAAU,YAAc,aAExB,GAAI,CACF,MAAMz7D,GAAK,iBAAiBg6D,EAAQ,EACpCriE,EAAM,QAAQ,gBAAgB,EAC9BsiE,GAAiB,GACjB0B,GAAoBF,CAAS,CAC/B,OAAS3jE,EAAgB,CACvB,MAAMo4B,EAAMp4B,EACZH,EAAM,MAAMu4B,EAAI,SAAW,uBAAuB,EAClDurC,EAAU,SAAW,GACrBA,EAAU,YAAc,aAC1B,CACF,CAKA,eAAeK,GAAmBlyC,EAAuBzJ,EAAwBrhB,EAA8B,CAC7G,MAAMO,EAAQuqB,EAAK,cAAc,eAAe,EAAuB,MACjEuyC,EAAUvyC,EAAK,cAAc,sBAAsB,EAEzD,GAAI,CAACvqB,GAAQA,EAAK,SAAW,EAAG,CAC9Bi9D,GAAUH,EAAS,+BAA+B,EAClD,MACF,CAEAC,GAAexyC,EAAM,EAAI,EACzByyC,GAAUF,CAAO,EAEjB,GAAI,CACF,MAAMn8D,GAAK,aAAalB,EAAOO,CAAI,EAEnC1H,EAAM,QAAQ,uCAAuC,EAGrDoiE,GAAc,QACd,MAAMt0C,EAAU,SAAS,cAAc,mBAAmBW,EAAQ,qBAAqB,EACnFX,IAASA,EAAQ,YAAc40C,GAAA,GACnCD,GAAkBj6C,CAAS,CAE7B,OAASroB,EAAgB,CAEvBwkE,GAAUH,EADErkE,EACW,SAAW,qBAAqB,EAGvD,MAAMyjE,EAAS3xC,EAAK,iBAAiB,YAAY,EACjD2xC,EAAO,QAAQvsC,GAAKA,EAAE,MAAQ,EAAE,EAChCusC,EAAO,CAAC,GAAG,OACb,SACEa,GAAexyC,EAAM,EAAK,CAC5B,CACF,CAKA,SAASmxC,GAAc56C,EAA8B,CACrCA,EAAU,iBAAiB,eAAe,EAClD,QAAQ8b,GAAQ,CACpBpc,EAAGoc,EAAqB,QAAS,IAAM,CAErC89B,GADe99B,EAAK,aAAa,aAAa,EAI9C,MAAMxW,EAAU,SAAS,cAAc,mBAAmBW,EAAQ,qBAAqB,EACnFX,IAASA,EAAQ,YAAc40C,GAAA,GAGnCD,GAAkBj6C,CAAS,CAC7B,CAAC,CACH,CAAC,CACH,CAKA,eAAe26C,GAAYlxC,EAAsC,CAC/D,MAAM9qB,EAAS8qB,EAAK,cAAc,cAAc,EAAuB,MAAM,OACvE5qB,EAAY4qB,EAAK,cAAc,iBAAiB,EAAuB,MACvEuyC,EAAUvyC,EAAK,cAAc,cAAc,EAEjDwyC,GAAexyC,EAAM,EAAI,EACzByyC,GAAUF,CAAO,EAEjB,GAAI,CACF,MAAM7+D,EAAO,MAAM0C,GAAK,MAAM,CAAE,MAAAlB,EAAO,SAAAE,EAAU,EAEjDrH,EAAM,QAAQ,wBAAwB,EACtCmwB,GAAa,YAAYxqB,CAAI,EAC7B8jB,EAAWgF,EAAQ,EAGnB,OAAO,cAAc,IAAI,YAAY,sBAAsB,CAAC,CAC9D,OAAStuB,EAAgB,CACvB,MAAMo4B,EAAMp4B,EAKNykE,EAAersC,EAAI,UAAU,KACnC,GAAIqsC,GAAc,uBAAwB,CAExCvC,GAAWuC,EAAa,OAASz9D,EACjCgpB,GAAa,MAAQkyC,GACrBC,GAAiB,GAEjBtiE,EAAM,KAAK,uCAAuC,EAElDoiE,GAAc,gBACd,MAAM55C,EAAYyJ,EAAK,cACjBnE,EAAU,SAAS,cAAc,mBAAmBW,EAAQ,qBAAqB,EACnFX,IAASA,EAAQ,YAAc40C,GAAA,GACnCD,GAAkBj6C,CAAS,EAC3B,MACF,CAEA,MAAM5oB,EAAU24B,EAAI,SAAW,eAC/BosC,GAAUH,EAAS5kE,CAAO,CAC5B,SACE6kE,GAAexyC,EAAM,EAAK,CAC5B,CACF,CAKA,eAAesxC,GAAetxC,EAAsC,CAClE,MAAM9qB,EAAS8qB,EAAK,cAAc,iBAAiB,EAAuB,MAAM,OAC1E4yC,EAAY5yC,EAAK,cAAc,oBAAoB,EAAuB,MAAM,OAChF6yC,EAAe7yC,EAAK,cAAc,wBAAwB,EAAuB,MAAM,OACvF5qB,EAAY4qB,EAAK,cAAc,oBAAoB,EAAuB,MAC1ElE,EAAWkE,EAAK,cAAc,mBAAmB,EAAuB,MACxEuyC,EAAUvyC,EAAK,cAAc,iBAAiB,EAGpD,GAAI5qB,IAAa0mB,EAAS,CACxB42C,GAAUH,EAAS,wBAAwB,EAC3C,MACF,CAGA,GAAIn9D,EAAS,OAAS,GAAI,CACxBs9D,GAAUH,EAAS,yCAAyC,EAC5D,MACF,CAEAC,GAAexyC,EAAM,EAAI,EACzByyC,GAAUF,CAAO,EAEjB,GAAI,CACF,MAAMviE,EAAS,MAAMoG,GAAK,SAAS,CACjC,MAAAlB,EACA,SAAAE,EACA,SAAUw9D,GAAY,OACtB,aAAcC,GAAe,OAC9B,EAED,GAAI7iE,EAAO,uBAAwB,CACjCjC,EAAM,QAAQ,qDAAqD,EAEnEoiE,GAAc,QACd,MAAM55C,EAAYyJ,EAAK,cACjBnE,EAAU,SAAS,cAAc,mBAAmBW,EAAQ,qBAAqB,EACnFX,IAASA,EAAQ,YAAc40C,GAAA,GACnCD,GAAkBj6C,CAAS,CAC7B,MACExoB,EAAM,QAAQ,8BAA8B,EAC5CmwB,GAAa,YAAYluB,EAAO,IAAI,EACpCwnB,EAAWgF,EAAQ,EACnB,OAAO,cAAc,IAAI,YAAY,sBAAsB,CAAC,CAEhE,OAAStuB,EAAO,CACd,MAAMP,EAAUO,aAAiB,MAAQA,EAAM,QAAU,sBACzDwkE,GAAUH,EAAS5kE,CAAO,CAC5B,SACE6kE,GAAexyC,EAAM,EAAK,CAC5B,CACF,CAKA,eAAeuxC,GAAavxC,EAAsC,CAChE,MAAM9qB,EAAS8qB,EAAK,cAAc,eAAe,EAAuB,MAAM,OACxEuyC,EAAUvyC,EAAK,cAAc,eAAe,EAElDwyC,GAAexyC,EAAM,EAAI,EACzByyC,GAAUF,CAAO,EAEjB,GAAI,CACF,MAAMn8D,GAAK,eAAelB,CAAK,EAC/BnH,EAAM,QAAQ,sEAAsE,EAGpFoiE,GAAc,QACd,MAAM55C,EAAYyJ,EAAK,cACjBnE,EAAU,SAAS,cAAc,mBAAmBW,EAAQ,qBAAqB,EACnFX,IAASA,EAAQ,YAAc40C,GAAA,GACnCD,GAAkBj6C,CAAS,CAC7B,MAAgB,CAEdxoB,EAAM,QAAQ,sEAAsE,CACtF,SACEykE,GAAexyC,EAAM,EAAK,CAC5B,CACF,CAKA,eAAewxC,GAAYxxC,EAAsC,CAC/D,MAAM5qB,EAAY4qB,EAAK,cAAc,iBAAiB,EAAuB,MACvElE,EAAWkE,EAAK,cAAc,gBAAgB,EAAuB,MACrEuyC,EAAUvyC,EAAK,cAAc,cAAc,EAEjD,GAAI5qB,IAAa0mB,EAAS,CACxB42C,GAAUH,EAAS,wBAAwB,EAC3C,MACF,CAEA,GAAIn9D,EAAS,OAAS,GAAI,CACxBs9D,GAAUH,EAAS,yCAAyC,EAC5D,MACF,CAEA,GAAI,CAACr0C,GAAa,WAAY,CAC5Bw0C,GAAUH,EAAS,uDAAuD,EAC1E,MACF,CAEAC,GAAexyC,EAAM,EAAI,EACzByyC,GAAUF,CAAO,EAEjB,GAAI,CACF,MAAMn8D,GAAK,cAAchB,EAAU8oB,GAAa,UAAU,EAC1DnwB,EAAM,QAAQ,mDAAmD,EAGjEoiE,GAAc,QACd,MAAM55C,EAAYyJ,EAAK,cACjBnE,EAAU,SAAS,cAAc,mBAAmBW,EAAQ,qBAAqB,EACnFX,IAASA,EAAQ,YAAc40C,GAAA,GACnCD,GAAkBj6C,CAAS,CAC7B,OAASroB,EAAO,CACd,MAAMP,EAAUO,aAAiB,MAAQA,EAAM,QAAU,wBACzDwkE,GAAUH,EAAS5kE,CAAO,CAC5B,SACE6kE,GAAexyC,EAAM,EAAK,CAC5B,CACF,CAKA,SAASwyC,GAAexyC,EAAuBqqB,EAAwB,CACrE,MAAMnqB,EAAYF,EAAK,cAAc,uBAAuB,EACtD2xC,EAAS3xC,EAAK,iBAAiB,OAAO,EACtC8yC,EAAU5yC,EAAU,cAAc,WAAW,EAC7C6yC,EAAa7yC,EAAU,cAAc,cAAc,EAEzDA,EAAU,SAAWmqB,EACrBsnB,EAAO,QAAQ5gE,GAASA,EAAM,SAAWs5C,CAAO,EAE5CyoB,GAAWC,IACbD,EAAQ,UAAU,OAAO,SAAU,CAAC,CAACzoB,CAAO,EAC5C0oB,EAAW,UAAU,OAAO,SAAU,CAAC1oB,CAAO,EAElD,CAKA,SAASqoB,GAAUH,EAAsB5kE,EAAuB,CAC9D4kE,EAAQ,YAAc5kE,EACtB4kE,EAAQ,UAAU,OAAO,QAAQ,CACnC,CAKA,SAASE,GAAUF,EAA4B,CAC7CA,EAAQ,UAAU,IAAI,QAAQ,EAC9BA,EAAQ,YAAc,EACxB,CAKA,SAASlB,GAAuBj8D,EAAkB49D,EAAY,oBAA2B,CACvF,MAAMC,EAAa,SAAS,eAAeD,CAAS,EACpD,GAAI,CAACC,EAAY,OAEjB,MAAMC,EAAWC,GAA0B/9D,CAAQ,EAEnD69D,EAAW,UAAY,8BAA8BC,EAAS,KAAK,GACnED,EAAW,UAAY;AAAA;AAAA,4DAEmCC,EAAS,KAAK;AAAA;AAAA,mCAEvCA,EAAS,KAAK;AAAA,GAEjD,CAKA,SAASC,GAA0B/9D,EAAmE,CACpG,IAAI8xB,EAAQ,EASZ,OAPI9xB,EAAS,QAAU,KAAI8xB,GAAS,IAChC9xB,EAAS,QAAU,KAAI8xB,GAAS,IAChC,QAAQ,KAAK9xB,CAAQ,IAAG8xB,GAAS,IACjC,QAAQ,KAAK9xB,CAAQ,IAAG8xB,GAAS,IACjC,QAAQ,KAAK9xB,CAAQ,IAAG8xB,GAAS,IACjC,eAAe,KAAK9xB,CAAQ,IAAG8xB,GAAS,IAExCA,EAAQ,GAAW,CAAE,MAAO,OAAQ,MAAAA,EAAO,MAAO,QAClDA,EAAQ,GAAW,CAAE,MAAO,OAAQ,MAAAA,EAAO,MAAO,QAClDA,EAAQ,GAAW,CAAE,MAAO,OAAQ,MAAAA,EAAO,MAAO,QAC/C,CAAE,MAAO,SAAU,MAAO,KAAK,IAAIA,EAAO,GAAG,EAAG,MAAO,SAChE,CAKO,SAASksC,IAAuB,CACrC57C,EAAWgF,EAAQ,CACrB,CCh+BA,MAAMA,GAAW,gBAiDjB,IAAI62C,GAAiC,KACjCC,GAAoC,GACpCC,GAAsC,GACtCC,GAAqC,GACrCC,GAA8C,GAC9CC,GAAgC,GAK7B,SAASC,GAAiB97C,EAAgC,CAC/D,KAAM,CAAE,KAAA1qB,EAAM,QAAAw1B,CAAA,EAAY9K,EAC1Bw7C,GAAiB1wC,GAAW,KAG5B,MAAMxF,EAAW,SAAS,cAAc,mBAAmBX,EAAQ,IAAI,EACnEW,KAAmB,SAEvB,MAAMje,EAAUuf,GAAmBtxB,EAAMw1B,CAAO,EAG1CtH,EAAQP,GAAY,CACxB,GAAI0B,GACJ,MAAO,GACP,QAAAtd,EACA,KAAM,KACP,EAGKoc,EAAeD,EAAM,cAAc,gBAAgB,EACrDC,GACFA,EAAa,UAAU,IAAI,2BAA2B,EAExD,MAAMsD,EAAcvD,EAAM,cAAc,eAAe,EACnDuD,GACFA,EAAY,UAAU,IAAI,QAAQ,EAGpC,SAAS,KAAK,YAAYvD,CAAK,EAC/B/D,GAAUkF,EAAQ,EAGdrvB,IAAS,QAAUw1B,GAAS,GAC9BixC,GAAgB10D,EAASyjB,EAAQ,EAAE,GAEnCkxC,GAAkB30D,CAAO,EACzB40D,GAAgB50D,CAAO,EACvB60D,GAAc70D,CAAO,GAIvB+xB,GAAW/xB,EAAS2Y,CAAK,CAC3B,CAKA,SAAS4G,GAAmBtxB,EAAkCw1B,EAAgC,CAC5F,MAAMpM,EAAYX,EAAc,MAAO,CAAE,UAAW,qBAAsB,EACpE0nB,EAASnwC,IAAS,OAClBwrB,EAAWgK,EAAUvF,GAAYuF,EAAQ,IAAI,EAAI,IACjDqxC,EAAW,CAAC,EAAErxC,GAAS,UAAYA,GAAS,WAC5CoR,EAAWpR,GAAS,UAAYA,GAAS,UAE/C,OAAApM,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAA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AAAW,EAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA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AAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QA8ShB+2D,IAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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","names":["ThemeService","saved","effective","fn","mode","modes","nextIndex","newTheme","callback","theme","defaultOptions","showToast","message","type","options","opts","toast","pos","success","error","warning","info","getCurrentProjectId","setProjectIdGetter","getter","config","requestInterceptors","responseInterceptors","addRequestInterceptor","interceptor","index","api","path","attempt","url","finalOptions","timeoutMs","controller","timeoutId","response","contentType","text","data","msg","ApiError","retryAfter","sleep","errorMessage","extractErrorMessage","result","rawMessage","fallback","obj","ms","resolve","status","details","http","body","configureApi","newConfig","getProjectHeaders","id","fetchWithProject","input","init","headers","k","v","getItem","key","defaultValue","item","setItem","value","removeItem","clear","hasItem","getKeys","storage","ShortcutService","shortcutStr","handler","description","parts","syntheticEvent","shortcut","event","target","shortcutOrKey","enabled","shortcuts","s","UndoService","action","undoManager","initialState","state","listeners","notify","getState","subscribe","setCurrentProjectId","projectId","setCurrentProject","project","setCurrentUser","user","setAuthConfigured","configured","setConfig","setLoading","isLoading","setError","setOnline","online","reset","initAppStore","appStore","isInitialized","authCheckPromise","checkAuthStatus","checkSession","authUser","mapAuthUserToUser","initAuth","login","credentials","register","logout","forgotPassword","email","resetPassword","password","accessToken","refreshSession","requestLoginCode","verifyLoginCode","code","getOTPConfig","confirmEmail","resendConfirmation","profile","metadata","isAuthenticated","isAuthInitialized","getCurrentUser","onAuthRequired","triggerAuthRequired","auth","setQuestions","questions","setRisks","risks","setActions","actions","setDecisions","decisions","setFacts","facts","setContacts","contacts","setChatHistory","chatHistory","addChatMessage","setProjects","projects","clearChatHistory","dataStore","getProjects","getCurrentProject","createProject","updateProject","currentProject","deleteProject","activateProject","setDefaultProject","getProjectStats","exportProject","importProject","file","formData","initProjects","defaultProject","p","listCompanies","list","getCompany","createCompany","updateCompany","deleteCompany","analyzeCompany","getTemplate","companyId","updateTemplate","html","generateTemplate","res","getDashboard","getStats","getTrends","days","getHealth","getInsights","getAlerts","loadDashboardData","dashboard","health","insights","alerts","dashboardService","getQuestions","filters","params","query","createQuestion","updateQuestion","deleteQuestion","reason","answerQuestion","getQuestionsByPerson","getQuestionsByTeam","suggestAssignee","reopenQuestion","dismissQuestion","deferQuestion","until","submitAnswerFeedback","wasUseful","feedback","getQuestionStats","now","sevenDaysAgo","q","questionsService","getRisks","getRisk","getDeletedRisks","restoreRisk","getRiskEvents","getRisksByCategory","createRisk","updateRisk","deleteRisk","calculateRiskScore","impact","likelihood","impactScores","likelihoodScores","suggestRisk","owners","getRiskMatrixData","matrix","r","risk","risksService","normalizeAction","row","getActions","sprintId","decisionId","createAction","payload","raw","updateAction","deleteAction","getDeletedActions","restoreAction","suggestAssignees","suggestTaskFromDescription","getActionEvents","isOverdue","getActionStats","a","getActionsReport","getSimilarActions","getUserStories","addUserStory","getUserStory","updateUserStory","actionsService","getDecisions","getDecision","getDeletedDecisions","restoreDecision","getDecisionEvents","getSimilarDecisions","limit","runDecisionCheck","detectConflicts","suggest","content","rationale","suggestOwner","createDecision","updateDecision","deleteDecision","approveDecision","approvedBy","rejectDecision","decisionsService","sendMessage","request","m","userMessage","assistantMessage","ask","sotChat","getBriefing","refresh","getBriefingHistory","getWeeklyReport","generateExecutiveSummary","getChatHistory","addToHistory","chatService","getContacts","c","getContact","createContact","updateContact","deleteContact","getContactStats","findContactByName","name","getDuplicates","mergeContacts","contactIds","enrichContact","exportContacts","format","blob","getContactWithAssociations","addContactToProject","contactId","removeContactFromProject","getContactProjects","getTeams","getTeam","createTeam","updateTeam","deleteTeam","addTeamMember","teamId","role","isLead","removeTeamMember","contactsService","teamsService","uploadFiles","files","onProgress","xhr","reject","e","uploadWithExtraction","getProcessingStatus","getDocuments","statusOrOptions","queryString","getDocument","deleteDocument","restoreDocument","reprocessDocument","getDocumentSummary","getKnowledgeBase","category","addKnowledgeItem","searchKnowledge","getConversations","getConversation","parseConversationPreview","importConversation","deleteConversation","reembedConversation","bulkDeleteDocuments","ids","bulkReprocessDocuments","bulkExportDocuments","downloadBulkExport","documentsService","getKnowledgeStatus","exportKnowledgeMarkdown","exportKnowledgeJson","regenerateKnowledge","synthesizeKnowledge","topic","knowledgeService","conversationsService","getEmails","getEmail","getEmailThread","threadId","markAsRead","markAsUnread","starEmail","unstarEmail","archiveEmail","deleteEmail","sendEmail","draft","saveDraft","generateAIResponse","emailId","tone","generateSummary","categorizeEmail","getEmailStats","syncEmails","getById","getNeedingResponse","markResponded","generateResponse","emailsService","getVisualizationData","nodesResponse","edgesResponse","nodes","edges","getGraph","getEntityGraph","entityId","depth","getRelatedEntities","getOntologySchema","getOntologyEntities","getOntologyRelations","getOntologySuggestions","approveOntologySuggestion","suggestionId","rejectOntologySuggestion","getOntologyTypeStats","getOntologySyncStatus","forceOntologySync","runLLMAnalysis","autoApproveHighConfidence","threshold","getOntologyChanges","migrateOntologyToSupabase","getBackgroundWorkerStatus","triggerBackgroundAnalysis","getBackgroundWorkerLog","getOntologyJobs","toggleOntologyJob","jobId","extractOntologyFromGraph","validateOntologyCompliance","getOntologyDiff","findUnusedOntologyTypes","mergeOntology","cleanupOntology","getFalkorDBBrowserInfo","listAllFalkorDBGraphs","syncFalkorDBGraphs","dryRun","deleteFalkorDBGraph","graphName","getCommunities","getCentrality","getBridges","graphRAGQuery","streamGraphRAGQuery","onChunk","onComplete","onError","reader","decoder","fullResponse","done","lines","line","parsed","multiHopQuery","explainConnection","nodeId1","nodeId2","summarizeSelection","nodeIds","naturalLanguageFilter","filterText","suggestRelated","nodeId","executeCypher","cypher","getQueryTemplates","schema","pattern","getProjectGraphs","getCrossProjectEntities","entityType","saveQueryHistory","getQueryHistory","toggleQueryFavorite","queryId","deleteQueryHistory","saveView","view","getSavedViews","updateView","viewId","updates","deleteView","addBookmark","bookmark","getBookmarks","updateBookmark","bookmarkId","removeBookmark","createAnnotation","annotation","getAnnotations","updateAnnotation","annotationId","deleteAnnotation","saveChatMessage","getChatSessions","sessionId","toggleChatPin","messageId","createSnapshot","snapshot","getSnapshots","getSnapshot","snapshotId","compareSnapshots","snapshotId1","snapshotId2","deleteSnapshot","getTimeline","events","getEntityTimeline","getCosts","getCostSummary","period","normalized","d","getRecentCostRequests","getCostsPricing","getCostsBudget","limitUsd","alertThresholdPercent","setCostsBudget","getLLMConfig","graphService","timelineService","costsService","getNotifications","getUnreadCount","markAllAsRead","deleteNotification","getComments","addComment","parentId","updateComment","commentId","deleteComment","addReaction","emoji","removeReaction","createComment","resolveComment","getProjectMembers","inviteMember","updateMemberRole","memberId","removeMember","notificationsService","commentsService","getInvites","membersService","getUserSettings","updateUserSettings","settings","getProjectSettings","updateProjectSettings","getAPIKeys","createAPIKey","permissions","revokeAPIKey","getWebhooks","createWebhook","webhook","updateWebhook","deleteWebhook","testWebhook","getAuditLogs","exportAuditLogs","userSettingsService","projectSettingsService","apiKeysService","webhooksService","auditService","getProfile","updateProfile","currentUser","uploadAvatar","removeAvatar","changePassword","deleteAccount","getActivity","getSessions","revokeSession","revokeAllSessions","profileService","getFacts","getFact","createFact","updateFact","deleteFact","getDeletedFacts","restoreFact","verifyFact","runFactCheck","getFactsByCategory","grouped","fact","getFactsBySource","source","getFactsByDocument","documentId","getFactEvents","factId","getSimilarFacts","searchFacts","getFactStats","stats","f","factsService","getWebhook","regenerateWebhook","toggleWebhook","isActive","getTranscripts","getTranscriptsSummary","assignProject","transcriptId","skipTranscript","retryTranscript","processTranscript","getMappings","deleteMapping","mappingId","getQuarantinedTranscripts","getAvailableMeetings","importAvailableMeetings","meetingIds","generateAvailableMeetingSummary","meetingId","formatStatus","formatDuration","minutes","hours","mins","createElement","tag","attributes","children","el","on","element","addClass","classes","removeClass","createThemeToggle","container","button","updateButton","getThemeIcon","mountThemeToggle","selector","setTab","tab","setDevTab","setSotView","setSelectedPerson","person","toggleSidebar","setSidebarOpen","open","openModal","modalId","closeModal","setSearchQuery","toggleFilter","uiStore","createHeader","props","header","logoSection","actionsSection","projectSelector","createProjectSelector","themeToggle","userMenu","createUserMenu","mobileMenuBtn","onProjectChange","dropdown","projectName","isOpen","initials","n","updateDropdown","settingsBtn","shortcutsBtn","logoutBtn","closeDropdown","mountHeader","defaultTabs","adminTab","getTabsForUser","createTabButton","rebuildNavigation","nav","tabs","currentTab","createSidebar","sidebar","closeBtn","btn","initialActiveBtn","updateTabBadge","tabId","count","badge","mountSidebar","containerInstance","getToastContainer","position","createToastElement","duration","icons","dismissToast","showToastInContainer","activeModals","createModal","title","size","closable","onClose","onOpen","footer","modal","modalContent","footerEl","closeAllModals","_","isModalOpen","updateModalContent","updateModalTitle","titleEl","confirm","confirmText","cancelText","confirmClass","cancelBtn","confirmBtn","alert","okBtn","prompt","placeholder","MODAL_ID","PERMISSION_CATEGORIES","ROLE_DEFAULTS","showMemberPermissionsModal","userId","userName","userEmail","avatarUrl","currentRole","onSave","selectedPermissions","existing","getInitials","escapeHtml","cat","roleSelect","defaults","updateCheckboxes","checkbox","updateItemStyles","checkboxes","allChecked","cb","saveBtn","selected","div","currentProps","inlineOnCancel","projectMembers","projectRoles","projectConfig","projectContacts","showProjectModal","createModalContent","loadProjectData","renderCreateForm","modalHeader","closeOrInlineCancel","card","projectRes","membersRes","rolesRes","configRes","contactsRes","contactsData","renderEditForm","bindCreateEvents","renderMembersList","renderRolesList","getConfigValue","bindEditEvents","member","isOwner","part","companySelect","companies","form","projectData","submitBtn","loadProjects","t","section","companySelectEdit","currentCompanyId","projectForm","descEl","deleteBtn","inviteBtn","inviteFirstBtn","showInviteModal","addRoleBtn","showAddRoleDialog","select","newRole","membersList","bindMemberEvents","configForm","showEditUserRoleDialog","existingDialog","dialog","closeDialog","enhanceBtn","nameInput","contextInput","descInput","roleName","roleContext","loadProjectRoles","rolesGrid","overlay","customInput","promptTextarea","selectedOption","isCustom","roleSelectValue","userRole","userRolePrompt","linkedContactId","memberIndex","contact","handleEscape","showInvite","__vitePreload","InviteModal","initProjectSelector","newBtn","editBtn","loadProjectsIntoSelector","selectProject","updateSelectorOptions","projectList","currentProjectId","currentValue","option","onChange","wrapper","defaultOption","formatNumber","locale","formatDate","date","formatDateTime","formatRelativeTime","diffMs","diffSec","diffMin","diffHour","diffDay","futureDays","yesterday","isSameDay","startOfWeek","getStartOfWeek","startOfLastWeek","d1","d2","day","formatFileSize","bytes","units","i","formatCurrency","currency","createDashboard","loadFullDashboard","healthSection","briefingSection","statsGrid","overdueSection","alertsSection","insightsSection","riskSummaryContainer","goldenHoursSection","createBtn","ProjectModal","createBriefingPanel","BriefingPanel","briefingPanel","err","renderHealthIndicator","renderStatsGrid","renderOverdueActionsAlert","renderAlerts","renderInsights","renderQuestionsPriorityChart","renderFactsChart","renderWeeklyTrendsChart","renderRiskSummary","loadGoldenHours","statusClass","score","color","factors","onClick","qPriority","rImpact","factsVerified","stat","statId","getAlertIcon","onAction","insight","getSeverity","impactLevel","likelihoodLevel","activeRisks","counts","severity","total","mitigated","getPercent","conicStops","currentDeg","colors","level","degrees","byCat","categories","sum","pct","critical","high","medium","resolved","trendsData","history","trends","entry","maxValue","overdueCount","viewBtn","getLocalTimeInfo","timezone","localTime","localHour","isOnline","findBestMeetingTimes","entries","suggestions","hour","available","totalScore","formatter","utcHour","offset","theirHour","b","members","linkedContactIds","memberEntries","linkedContact","tz","timeInfo","contactEntries","memberGolden","calculateGoldenHours","contactGolden","deduplicatedContactEntries","allEntries","allGolden","meetingSuggestions","onlineMembers","onlineContacts","onlineDeduplicatedContacts","onlineAll","escapeHtmlSimple","renderTimezoneChart","renderGoldenSummary","teamSuggestions","contactSuggestions","uniqueTimezones","offsets","overlapStart","overlapEnd","workStartUtc","workEndUtc","firstOffset","golden","tzCounts","uniqueTzs","h","workStart","workEnd","workLeft","workWidth","displayTz","formatHour","maxAvatars","showEntries","moreCount","str","mountDashboard","createChat","showSessions","chat","currentSessionId","sessions","newChatBtn","newChatContextWrap","newChatContextLabel","newChatContextSelect","sessionsList","mainArea","chatContainer","chatHeader","contextLabel","contextSelect","loadContacts","renderContextSelect","currentContextId","renderNewChatContextSelect","onContextChange","idx","messagesContainer","inputContainer","sendBtn","handleSend","loadSessions","renderSessionsList","selectSession","loadMessages","msgs","renderMessage","createNewSession","contextContactId","session","loadingEl","scrollToBottom","quickPrompts","showSources","msgEl","metaEl","confidenceClass","metaHtml","methodLabel","totalSources","sourcesEl","sources","contactSources","topSources","pillsEl","mountChat","currentQuestion","createQuestionDetailView","question","onUpdate","onNavigateToQuestion","renderEntities","renderExistingAnswer","bindEvents","loadChain","loadSimilar","loadTimeline","entities","topics","getScoreColor","renderProvenance","provenance","backLink","aiSuggestBtn","loadAISuggestions","checkAnswersBtn","checkPotentialAnswers","saveAnswerBtn","saveAnswer","reopenBtn","dismissBtn","dismissMenu","reasonLinks","link","dismissQuestionWithReason","deferBtn","showDeferDialog","undeferBtn","feedbackYes","feedbackNo","submitFeedback","toggleEditMode","assigneeSelect","answeredBySelect","contactList","contactSearch","otherOption","renderContactGrid","filtered","updateAssignedDisplay","bindPickerButtons","setupAnswererPicker","setupSourceOptions","showBtn","answererList","answererSearch","answererOtherInput","renderAnswererList","filter","photoUrl","contactName","selectAnswerer","clearBtn","display","opt","contactsToRender","isCurrentAssignee","picker","showPickerBtn","changeBtn","searchInput","questionId","onNavigate","chainContent","parent","child","similarContent","similar","timelineContent","icon","getEventIcon","getEventDescription","eventType","panel","showAllBtn","roleDisplay","scoreColor","selectBtn","suggestion","hideBtn","timeoutMessage","retryBtn","answersDiv","potentialAnswers","answerInput","sourceSelect","followupInput","answer","answeredByContactId","followupQuestions","answeredByName","updated","untilInput","reasonInput","feedbackBtns","currentSuggestions","showQuestionModal","onDismiss","renderQuestionView","createFooterButtons","getModalTitle","onDelete","handleCreate","handleEdit","handleDismiss","handleAnswer","answerBtn","handleReopen","suggestBtn","loadAssigneeSuggestions","showAnswerField","suggestionsContainer","assigneeInput","getValue","newQuestion","Modal","currentFilter","currentView","createQuestionsPanel","filterSelect","loadQuestions","viewTabs","addBtn","generateBtn","showGenerateForTeamDialog","updateCount","renderByStatus","renderGrouped","slaHours","created","deadline","createQuestionCard","bindCardEvents","groups","groupName","allQuestions","qs","priorityClass","slaBreached","autoDetected","hasAnswer","hasRequesterRole","getPhotoUrl","renderAvatar","cssClass","requesterName","requesterRole","requesterContactId","requesterPhotoUrl","assigneePhotoUrl","showQuestionDetailView","containerEl","panelContent","detailView","updatedQuestion","targetQuestion","currentSource","selectedRole","allRoles","questionCount","configSection","selectedBadge","genOverlay","genContent","getRoleIcon","loadRoles","roles","roleMap","showConfig","generateQuestions","countVal","countEl","createSourceOfTruth","panels","questionsPanel","createFullQuestionsPanel","risksPanel","createRisksPanel","actionsPanel","createActionsPanel","decisionsPanel","createDecisionsPanel","questionsBadge","risksBadge","actionsBadge","decisionsBadge","renderQuestions","renderRisks","renderActions","renderDecisions","initialView","initialTab","initialPanel","showQuestionDetail","originalContent","propsOrCallback","decision","mountSourceOfTruth","sot","showRiskModal","isEdit","isView","riskDesc","riskProb","riskCreated","riskOwner","impactEl","probEl","contentText","ownerEl","mitigationEl","desc","owner","riskData","iso","getRiskEventIcon","getRiskEventDescription","ev","actor","changes","toStr","fromStr","createRiskDetailView","viewContent","editForm","cancelEditBtn","contentEl","likelihoodEl","statusEl","deleteInEditBtn","ownerPickerTrigger","ownerPickerDropdown","ownerPickerValue","ownerHiddenInput","ownerPickerList","ownerPickerSearch","editFormContacts","renderOwnerPickerList","editAiSuggestBtn","editSuggestionsPanel","mitigation","roleOrReason","assignBtn","applyMitigationBtn","lastMitigation","suggestionsPanel","docLink","timelineEl","viewContacts","riskContactPicker","riskContactList","riskContactSearch","renderRiskContactGrid","getContactPhotoUrl","showRiskPicker","wasHidden","changeOwnerBtn","findContactByOwner","byExact","byPartial","byAlias","aLower","u","roleEl","avatarEl","img","riskDetailProps","updatedRisk","currentSearch","showMatrix","lastLoadedRisks","loadRisks","searchTimeout","matrixBtn","matrixContainer","risksToShow","renderRiskMatrix","refreshRemovedSection","deleted","truncate","restoreBtn","len","filterRisksBySearch","lower","renderRisksBySource","byStatus","statuses","createRiskCard","bindRiskCards","bySource","src","IMPACT_BAR_COLOR","barColor","ownerChipHtml","sourceChip","getSprints","getSprint","createSprint","generateSprintTasks","applySprintGeneration","getSprintReport","analyzeSprintReport","getSprintBusinessReport","generateSprintReportDocument","generateSprintReportPresentation","taskText","dueDateText","createdText","parentStoryRef","sizeEstimate","descriptionText","dodList","acList","showActionModal","due","dod","ac","dodStr","acStr","completeBtn","contentVal","parentStoryIdEl","dependsOnEl","parentStoryId","dependsOn","o","cardEl","cid","stories","parentSelect","sprints","sprintSelect","depSelect","currentId","newStoryBtn","pointsInput","story_points","story","editStoryBtn","storyId","newTitle","runGenerateFromDraft","btnLabel","parentRef","genBtn","regenBtn","requesterTrigger","requesterDropdown","requesterValue","requesterList","requesterSearch","requesterContactIdInput","requesterNameInput","requesterContacts","renderRequesterList","closeRequesterDropdown","removed","removeListeners","clickHandler","keyHandler","showCreateSprintModal","onSuccess","createdSprint","proposedNewTasks","existingActionIds","existingCheckboxes","getVal","step2","applyBtn","start_date","end_date","existingDetails","newList","existingList","checked","selectedExisting","STATUS_COLORS","capitalize","createBreakdownChart","byAssignee","height","showAssignee","statusEntries","assigneeEntries","chartId","statusCanvas","statusLabels","statusValues","statusKeys","initBarChart","assigneeCanvas","palette","canvas","labels","values","colorFn","renderFallbackBars","l","Chart","max","bars","label","wrap","showSprintReportModal","sprintName","reportData","loadReport","loading","errEl","report","summaryEl","pointsLine","chartEl","listEl","exportReportAsPdf","sprint","aiEl","bizEl","aiHtml","bizHtml","w","exportPdfBtn","docOptions","pptOptions","docBtn","pptBtn","radio","isDoc","openHtmlInNewTab","forPdf","out","printScript","style","includeAnalysis","includeBusiness","aiContent","bizContent","createCommentsThread","submitComment","loadComments","comments","renderComments","thread","topLevel","replies","repliesByParent","comment","renderComment","bindCommentEvents","isOwn","replyForm","getActionEventIcon","getActionEventDescription","textFields","normalizeDefinitionOfDone","getDescriptionBodyHtml","_assigneeStr","dlParts","dlHtml","descHtml","dodHtml","acHtml","createActionDetailView","onDecisionClick","currentAction","task","assignee","refineAiBtn","userInput","refreshDescriptionAndTimeline","bindDodToggles","bodyEl","li","previousDone","renderTimeline","hasRestore","snapshotAttr","originalText","taskEl","refreshDecisionSection","displayEl","linkBtn","unlinkBtn","commentsMount","commentsThread","similarMount","chosen","pickerEl","renderDecisionList","assigneePickerTrigger","assigneePickerDropdown","assigneePickerValue","assigneeHiddenInput","assigneePickerList","assigneePickerSearch","renderAssigneePickerList","requesterPickerTrigger","requesterPickerDropdown","requesterPickerValue","requesterPickerList","requesterPickerSearch","renderRequesterPickerList","editAssigneeHiddenInput","editAssigneePickerValue","suggested_assignees","findContactByAssignee","priorityEl","assigneeEl","dueEl","requesterContactIdEl","requesterNameEl","doDelete","docId","actionContactPicker","actionContactList","actionContactSearch","renderActionContactGrid","showActionPicker","findContactByRequester","byId","requesterDisplay","requesterContact","actionDetailProps","updatedAction","currentSprintId","currentViewMode","loadActions","createSprintBtn","refreshRemovedActionsSection","refreshReportStrip","refreshSprintDetailHeader","start","end","reportBtn","strip","bySprint","sprintParts","sprintFilter","renderGroupedBySprint","renderGroupedByStory","noSprint","sid","sprintList","groupActions","createGroupSection","noSprintSection","byStory","noStory","noStorySection","onHeaderClick","renderActionCards","findContactById","priorityBarColor","buildActionCardHtml","bindActionCards","priority","assigneeChipHtml","requestedBy","requestedByContactId","requesterChipHtml","dueChip","reload","viewLink","showDecisionModal","viewImpact","viewSummary","modalContacts","renderMadeByDisplay","madeBy","madeByDisplay","madeByInput","chooseBtn","showModalPicker","modalPicker","renderModalContactGrid","modalContactSearch","modalContactList","currentMadeBy","decisionContent","decisionImpact","decisionSummary","hintEl","approveBtn","rejectBtn","updateStatus","decisionData","apiPayload","createDecisionDetailView","onActionClick","renderEditFormOwnerDisplay","currentOwnerName","rationaleEl","madeByEl","viewContentText","viewRationale","statusBadge","badges","impactPill","oldPill","currentOwnerEl","chBtn","showOwnerPicker","ownerPicker","ownerList","ownerSearch","renderOwnerContactGrid","currentEl","showOwnerPickerBtn","editOwnerDisplay","editMadeByInput","editContactPicker","editContactList","editContactSearch","showEditOwnerPicker","renderEditFormContactGrid","ownerAiSuggestBtn","ownerSuggestionsPanel","suggested_owners","rationaleAiSuggestBtn","actorLabel","similarEl","implementingTasksEl","actionId","decisionDetailProps","clickedDecision","loadDecisions","checkConflictsBtn","checkConflicts","conflicts","createConflictCard","bindConflictCards","keepId","discardId","filterDecisionsBySearch","renderDecisionsBySource","createDecisionCard","bindDecisionCards","STATUS_BAR_COLOR","createFactDetailView","onFactClick","verifyFactBtn","verifyBtn","showFactModal","FactModal","CATEGORIES","factDetailProps","createFactsPanel","clickedFact","loadFacts","conflictsBtn","showAddFactModal","categoryFilter","rawFacts","renderFactsBySource","renderFacts","refreshRemovedFactsSection","conflictsContainer","emptyAddBtn","factsByCategory","catFacts","createFactCard","newPanel","CATEGORY_BAR_COLOR","categoryClass","confidencePct","renderConflicts","conflict","keepLeftBtn","keepRightBtn","resolveConflict","keep","toDelete","toKeep","createStatsCard","trendHtml","getTrendArrow","direction","updateStatsCard","subValue","valueEl","subEl","createStatsGrid","grid","createHealthIndicator","showFactors","indicator","createHealthBadge","getHealthColor","getHealthStatus","METRIC_COLORS","createTrendChart","metrics","initChart","renderFallbackChart","datasets","metric","dateStr","IMPACTS","LIKELIHOODS","CELL_COLORS","createRiskMatrix","onCellClick","groupRisksByCell","cellRisks","cell","createRiskSummary","summary","bySeverity","fileQueue","createFileUploader","allowedTypes","maxFileSize","multiple","uploader","dropzone","fileInput","queueContainer","actionsContainer","statusContainer","addFilesToQueue","updateQueueUI","uploadBtn","checkProcessingStatus","maxSize","qf","getFileIcon","pendingFiles","progress","pollProcessingStatus","renderProcessingStatus","pollingInterval","mimeType","NODE_COLORS","createKnowledgeGraph","initGraph","graphContainer","statsContainer","loadStats","network","createVisNetwork","bindToolbarEvents","visNodes","getNodeSize","visEdges","node","showNodeDetails","connections","matchingNode","refreshBtn","fitBtn","detailsContainer","renderStats","createTimeline","daysSelect","filterBtns","filterEvents","groupByDate","dayEvents","formatTime","visibleEvents","EVENT_TYPES","DAY_PERIODS","currentDays","currentDensity","currentTypeFilters","allEvents","focusedEventIndex","createTimelinePanel","renderSkeletons","periodSelect","densityBtns","updateDensity","renderFilteredEvents","exportBtn","showExportMenu","navigateEvents","selectFocusedEvent","clearEventFocus","endDate","startDate","updateTypeCounts","renderError","renderEmptyState","today","formatDateLabel","renderEventCard","bindEventCardClicks","time","relativeTime","fullDateTime","typesWithEvents","chips","chip","allChip","cards","targetCard","menu","exportTimeline","closeHandler","filename","rows","thisWeekStart","todayStr","yesterdayStr","maxLength","getAllProjectsBilling","getGlobalPricingConfig","setGlobalPricingConfig","getGlobalPricingTiers","setGlobalPricingTiers","tiers","getProjectBillingSummaryAdmin","getProjectBalance","creditProjectBalance","amount","setProjectUnlimited","unlimited","getBalanceTransactions","getProjectPricingOverride","setProjectPricingOverride","deleteProjectPricingOverride","getProjectBillingSummary","formatEur","formatTokens","getTierDisplayInfo","tier","prevLimit","getExchangeRateConfig","setExchangeRateMode","auto","manualRate","refreshExchangeRate","billingService","billingSummary","BUDGET_MODAL_ID","createCostsDashboard","loadCosts","handleExport","pricingBtn","pricingPanel","togglePricingPanel","budgetBtn","showBudgetModal","recentRequests","billing","renderCosts","periodRangeEl","formatPeriod","dailyBreakdown","byProvider","byModel","totalCalls","avgPerCall","byProviderArray","provider","cost","byModelArray","model","byOperationMap","op","byOperationArray","operation","byContextArray","ctx","totalInput","totalOutput","hasNoData","periodChangeHtml","budgetHtml","emptyStateHtml","billingBannerHtml","balanceDisplay","renderDailyChart","renderRecentRequests","requests","formatRequestTime","ext","pricing","renderPricingTable","budgetPeriod","currentLimit","currentThreshold","budget","limitEl","thresholdEl","thresholdRaw","skeletonDailyForPeriod","daily","chartDaily","maxCost","isPlaceholder","formatDateShort","currentQuery","selectedIndex","results","TYPE_ICONS","initGlobalSearch","createSearchModal","toggleSearch","backdrop","resultsContainer","closeSearch","debounceSearch","handleKeydown","openSearch","updateSelection","selectResult","performSearch","renderResults","performLocalSearch","groupByType","items","navigateToResult","selectedIds","createBulkActionsBar","bar","getActionsForType","clearSelection","updateBar","bindActionButtons","common","performBulkAction","endpoint","toggleSelection","selectItem","deselectItem","getSelectedIds","isSelected","createBulkCheckbox","createSyncStatus","loadSyncDetails","checkSyncStatus","updateIndicator","infoContainer","deadLettersContainer","deadLetters","dl","createSyncIndicator","checkMiniStatus","dot","S","isValidUrl","showCompaniesModal","close","renderList","analyzedAt","analyzed","analyzeLabel","analyzedBadge","loadList","listViewBodyHtml","showListView","bindListEvents","showForm","company","fd","logoUrl","websiteUrl","linkedinUrl","templatesBtn","showTemplateEditor","currentType","editor","loadBtn","setType","REPORT_SECTION_LABELS","showDetailView","ba","aiContext","primaryColor","secondaryColor","hasReport","reportSectionKeys","reportHtml","logoBlock","reanalyzeBtn","analyzeBtn","detailBtn","origText","getSettingsMarkup","currentTheme","pageMode","showSettingsModal","modalOverlay","bindSettingsEvents","root","isOverlay","closeAction","manageCompaniesBtn","targetSection","themeSelect","currentSteps","cancelCallback","showProcessingModal","steps","onCancel","allowCancel","renderContent","createFooter","step","renderStep","calculateOverallProgress","statusIcon","completed","running","runningProgress","closeProcessingModal","updateProcessingStep","stepId","stepIndex","addProcessingStep","setProcessingSteps","isProcessingModalOpen","currentMode","otpEmail","resendCooldown","resendTimer","showAuthModal","renderAuthContent","getTitle","firstInput","renderLoginForm","renderRegisterForm","renderForgotForm","renderResetForm","renderOTPRequestForm","renderOTPVerifyForm","renderEmailConfirmForm","handleLogin","bindModeLinks","passwordInput","updatePasswordStrength","handleRegister","handleForgot","handleReset","handleOTPRequest","maskedEmail","inputs","hiddenInput","resendBtn","setupOTPInputs","startResendCooldown","handleResendCode","handleOTPVerify","handleEmailConfirm","updateHiddenValue","digits","inp","digit","errorEl","setFormLoading","hideError","showError","responseData","username","displayName","btnText","btnLoading","elementId","strengthEl","strength","calculatePasswordStrength","closeAuthModal","currentContact","contactProjects","contactRelations","contactActivity","allProjects","roleTemplates","showContactModal","loadContactData","loadRoleTemplates","loadAllProjects","loadTimezones","hasPhoto","projectsRes","relationsRes","activityRes","allProjectsRes","timezonesRes","timezones","renderTimezoneDropdown","renderRoleDropdown","renderProjectsList","renderRelationsList","renderActivityTimeline","updateTabCounts","tzSelect","currentTz","region","sortedRegions","isCustomRole","listContainer","associatedIds","relation","formatRelationType","timeline","activity","projectsCount","relationsCount","customRoleInput","tagsInput","tags","aliasesInput","aliases","contactData","selectedProjects","savedContactId","enrichBtn","addRelationBtn","showAddRelationDialog","orgInput","headerName","headerOrg","avatar","span","avatarUrlInput","avatarContainer","currentName","parentContainer","availableContacts","contactSelect","typeSelect","toContactId","relationType","diffDays","currentMembers","showTeamModal","onInvite","onRemove","onRoleChange","renderMembers","renderMemberCard","removeBtn","isSuperadmin","cachedMembers","onInviteSent","activeTab","selectedContact","btnAddDirect","btnSendInvite","generateInviteLink","tabBtns","copyBtn","linkInput","loadProjectMembers","onSelect","hasEmail","subtitle","defaultPermissions","showRoleModal","availablePermissions","formatPermission","rolePermissions","selectAll","selectNone","roleData","permission","word","showExportModal","defaultFormat","defaultScope","group","scope","performExport","getContentType","createBlob","getExtension","uploadQueue","isUploading","sprintsList","actionsList","selectedSprintId","selectedActionId","showFileUploadModal","accept","onUpload","render","sprintOptions","actionOptions","renderFileItem","bindDropZone","bindFileItems","bindSprintTaskSelectors","dropZone","addFiles","dt","fileId","loadSprints","loadActionsForSprint","actionSelect","rerender","showDeveloperModal","renderTabContent","bindActions","renderInfoTab","renderLogsTab","renderCacheTab","renderApiTab","appState","dataState","uiState","getMemoryUsage","keys","totalSize","acc","formatBytes","testApi","method","bodyText","responseEl","elapsed","perf","sizes","shortcutGroups","showShortcutsModal","registeredShortcuts","notifications","showNotificationsModal","markAllBtn","unreadCount","renderNotification","notification","getNotificationIcon","showEmailModal","onSend","isReply","replyTo","replySubject","zone","preview","replyBtn","forwardBtn","to","cc","subject","emailData","registerChart","chart","getChart","destroyChart","instance","updateChartData","registerNetwork","getNetwork","destroyNetwork","setActiveChart","getChartIds","getNetworkIds","destroyAll","chartsStore","showGraphModal","onNodeClick","onEdgeClick","getUniqueTypes","getTypeColor","initializeGraph","bindControls","vis","edge","types","page","hasMore","showHistoryModal","onRestore","loadHistory","renderEntry","loadMoreBtn","entryId","changesEl","actionIcons","actionColors","hasChanges","field","change","formatValue","showCommentModal","entityName","onCommentAdded","bindCommentActions","isAuthor","findComment","replyContainer","replyInput","textarea","newText","removeComment","found","currentProfile","cachedTimezones","showProfileModal","loadProfile","bindOptions","apiProfile","renderProfile","generateFallbackAvatar","generateTimezoneOptions","loadKrispIntegration","avatarInput","avatarDisplay","profileForm","passwordForm","currentPassword","newPassword","confirmPassword","deleteAccountBtn","revokeAllBtn","regionOrder","aIdx","bIdx","diff","isSuperAdmin","krispService.getWebhook","krispService.getTranscriptsSummary","enableBtn","toggleSecretBtn","secretInput","mcpImportBtn","showKrispManager","toggleBtn","newState","krispService.toggleWebhook","regenerateBtn","krispService.regenerateWebhook","viewTranscriptsBtn","closeProfileModal","initProfilePage","isViewMode","savedFact","verifiedFact","closeFactModal","showConversationPreviewModal","conversation","tabName","loadExtractionData","handleEsc","meta","extraction","entitiesContainer","entitiesCount","extractionContainer","extractionCount","totalItems","notesContainer","notesTab","notesText","renderNotesAsHtml","outline","currentTopic","bulletsHtml","headerDone","metaDone","flushTopic","trimmed","bulletText","showEmailPreviewModal","hasExtraction","getSentimentEmoji","sentiment","currentBriefing","showHistory","loadBriefing","historyBtn","historyContainer","briefing","renderBriefing","renderMarkdown","historyItem","showHistoryDetail","backBtn","currentReport","createReportsPanel","exportMdBtn","exportReport","renderReport","markdown","downloadFile","exportToPdf","html2pdf","tempDiv","allContacts","selectedContactIds","createContactsPanel","checkDuplicates","orgFilter","tagFilter","favoritesChip","importBtn","filteredContacts","renderContacts","renderFavorites","updateFilters","createContactCard","bindContactCardEvents","updateSelectionBar","toggleFavorite","existingBar","mergeBtn","selectedContacts","showMergeConfirmModal","detail","newValue","svg","favorites","alertsContainer","duplicates","reviewBtn","showDuplicatesReviewModal","duplicateGroups","groupIndex","alias","closeOverlay","closeReviewBtn","primaryId","orderedIds","groupEl","orgs","currentOrg","org","allTags","uniqueTags","currentTag","createTeamsPanel","loadTeams","teams","renderTeams","team","createTeamCard","memberCount","leadMember","getVisOrgChart","createOrgChart","loadOrgChart","chartContainer","buildOrgData","renderVisNetwork","levels","reportsTo","managerLevel","rel","byOrg","currentStatus","currentSort","selectedDocuments","allDocuments","createDocumentsPanel","bindPanelEvents","loadDocuments","FileUploadModal","newSearch","renderFilteredDocuments","bulkDelete","bulkExport","bulkReprocess","renderDocumentsGrid","documents","doc","createDocumentCard","currentIndex","iconClass","getIconClass","getDocumentIcon","factsCount","decisionsCount","risksCount","entitiesLabel","showLoadingOverlay","hideLoadingOverlay","setBulkButtonsDisabled","disabled","createKnowledgePanel","exportKnowledge","exportJsonBtn","synthesizeBtn","synthesizeFacts","loadStatus","renderStatus","showConversationComposer","createConversationComposer","closeConversationComposer","renderPasteMode","renderMode","handlePreview","handleImport","bindPasteMode","renderUploadMode","previewBtn","hasContent","bindUploadMode","selectedFile","selectFile","getContent","previewArea","formatSelect","createConversationsPanel","showImportDialog","loadConversations","conversations","renderConversations","conv","createConversationCard","fullConv","reembedBtn","currentDirection","showNeedsResponse","createEmailsPanel","directionFilter","loadEmails","needsResponseFilter","createEmailComposer","showEmailComposer","EmailComposer","emails","renderEmails","createEmailCard","fullEmail","respondedBtn","directionIcon","needsResponse","getPreview","cleaned","closeEmailComposer","saveEmail","initEmailSprintTask","renderManualMode","bindManualMode","handleFileSelect","checkValidity","from","fileToBase64","base64","createNotificationsDropdown","trigger","toggleDropdown","loadNotifications","updateBadge","loadUnreadCount","renderNotifications","getIcon","initNotificationsDropdown","createMembersPanel","loadMembers","loadPendingInvites","invites","invite","createApiKeysPanel","showCreateKeyModal","loadApiKeys","renderApiKeys","expirySelect","scopeCheckboxes","scopes","showNewKeyModal","AVAILABLE_EVENTS","createWebhooksPanel","showWebhookModal","loadWebhooks","renderWebhooks","webhooks","urlInput","activeCheckbox","eventCheckboxes","currentFilters","currentPage","PAGE_SIZE","createAuditPanel","filterBtn","loadAuditLogs","showExportWizard","renderAuditLogs","renderPagination","logs","log","getActionClass","showDetailsModal","totalPages","prevBtn","nextBtn","fromDate","toDate","includeCheckboxes","include","ROLE_CATEGORIES","currentRoles","editingRole","renderRolesPanel","showRoleEditor","categoryMap","roleId","editorEl","isNew","bindEditorEvents","aiBtn","isTemplate","ontologyEntities","ontologyRelations","ontologyLoaded","ontologyLoading","graphList","graphStatus","graphOverviewLoaded","graphOverviewLoading","graphPasswordSet","currentSection","systemConfig","providers","auditLogs","systemPrompts","teamAnalysisSettings","teamAnalysisLoaded","teamAnalysisLoading","billingProjects","globalPricingConfig","globalPricingTiers","exchangeRateConfig","billingLoaded","billingLoading","googleDriveState","googleDriveLoading","googleDriveLoaded","loadSystemConfig","perTask","loadSecrets","DEFAULT_PROVIDER_IDS","loadProviders","defaultProviders","apiProviders","loadSystemPrompts","loadOntologyData","entitiesRes","loadGraphOverview","listRes","statusRes","saveConfig","testProvider","providerId","models","configs","graphConfigEntry","renderNav","renderLLMSection","taskTypes","taskConfig","descs","providerOpts","providerNames","renderGraphSection","graphConfig","g","renderOntologySection","renderPromptsSection","extractionPrompts","analysisPrompts","templatePrompts","sprintPrompts","reportPrompts","renderPromptCard","renderProcessingSection","processing","loadTeamAnalysisSettings","saveTeamAnalysisSettings","access","loadGoogleDriveState","renderGoogleDriveSection","gd","renderTeamAnalysisSection","renderQueueSection","loadBillingData","tiersData","exchangeRate","renderBillingSection","renderAuditSection","renderModelsSection","renderSectionContent","bindSectionEvents","newSection","renderAdminPanel","inputId","modelsCache","loadModelsForProvider","taskType","modelSelect","loadingSpan","statusDiv","saveLLMBtn","taskConfigs","loadApiKeysStatus","secret","formGroup","statusSpan","saveKeysBtn","savedCount","saveServiceKeysBtn","resendKey","braveKey","loadQueueStatus","statusContent","itemsContent","pendingCount","dbStatusBadge","statusColor","statusText","pendingLen","db","statPending","statProcessing","statSuccess","statFailed","statRetry","statAvgTime","statCost","loadQueueHistory","historyContent","showRequestDetails","requestId","req","formatJsonHtml","json","formatPromptText","statusInfo","inputData","messages","promptText","existingModal","loadFailedItems","failedContent","refreshStatusBtn","refreshHistoryBtn","refreshFailedBtn","retryAllBtn","successCount","pauseBtn","resumeBtn","cancelId","retryId","retryResetBtn","retryResetId","loadMetadataSyncStatus","countsDiv","syncAllBtn","resultDiv","browseModelsBtn","providerSelect","contentDiv","textModels","visionModels","embeddingModels","saveGraphBtn","graphConfigValue","testGraphBtn","testConfig","loadGraphOverviewBtn","refreshGraphOverviewBtn","openGraphTabBtn","loadOntologyBtn","reloadOntologyBtn","savePromptsBtn","promptElements","reloadPromptsBtn","historyDiv","listDiv","versions","currentVersion","promptKey","versionStr","version","template","previewModal","saveProcBtn","saveTeamAnalysisBtn","rootFolderId","serviceJson","exchangeRateAutoCheckbox","isAuto","manualGroup","refreshRateBtn","rateDisplay","sourceDisplay","saveExchangeRateBtn","saveGlobalPricingBtn","fixedMarkup","periodType","addTierBtn","limitInput","saveTiersBtn","limitValue","markup","refreshBillingBtn","isUnlimited","refreshAuditBtn","initAdminPanel","createHistoryPanel","bindFilters","actionFilter","entityFilter","dateFromInput","dateToInput","applyFilters","renderHistory","getActionVerb","formatFieldName","itemDate","dateLabel","exportHistory","setAnalyzing","analyzing","setProfiles","profiles","setSelectedProfile","setTeamAnalysis","analysis","setRelationships","relationships","setGraphData","setSubtab","subtab","loadProfiles","personId","analyzeProfile","updatedProfiles","loadTeamAnalysis","analyzeTeam","forceReanalysis","loadRelationships","loadGraphData","loadAll","teamAnalysisStore","questionsRes","risksRes","actionsRes","decisionsRes","undo","redo","initLegacyBridge","registerShortcuts","configureApiClient","initializeUI","updateThemeButton","userAvatar","userDropdown","loginBtn","components.showAuthModal","updateAuthUI","refreshData","clearProjectScopedState","updateDashboard","switchTab","components.showShortcutsModal","devToolsBtn","components.showDeveloperModal","profileBtn","notificationsContainer","sotTabs","loadSotContent","menuToggle","newContactBtn","components.showContactModal","components.showFileUploadModal","initializeSidebarActions","newProjectBtn","editProjectBtn","showNoProjectState","contactsSubtabs","refreshDashboardBtn","initializePanels","initializeDropZones","dashboardContainer","refreshDashboardPanel","Dashboard","Chat","emailsContainer","EmailsPanel","contactsContainer","ContactsPanel","teamsContainer","TeamsPanel","rolesContainer","RolesPanel","filesContainer","DocumentsPanel","showDocumentPreviewModal","orgChartContainer","OrgChart","costsContainer","CostsDashboard","HistoryPanel","dropzones","ConversationComposer","showTranscriptComposer","handleDroppedFiles","dataTransfer","addPendingFiles","fileNames","VALID_TABS","getTabFromUrl","match","updateUrlForTab","replace","newPath","initRouting","updateUrl","profileContainer","ProfileModal","projectsContainer","initProjectsPage","settingsContainer","initSettingsPage","adminContainer","AdminPanel","createGraphExplorer","explorer","timelineContainer","TimelinePanel","createQuestionDetailView2","QuestionDetailView","DecisionDetailView","FactDetailView","RiskDetailView","ActionDetailView","teamAnalysisContainer","createTeamAnalysis","setupTeamAnalysisSubtabs","teamAnalysisStore2","teamAnalysis","firstOrDefault","base","dashboardContent","activeQuestions","factsPanel","updatePendingFilesUI","processBtn","exportKnowledgeBtn","knowledge","exportKnowledgeClipboard","exportQuestionsBtn","exportQuestionsClipboard","copyOverdueBtn","overdueActions","dueDate","overdueQuestions","createdAt","overdue","cleanOrphanBtn","components.confirm","resetDataBtn","authBlocker","adminNavBtn","fallbackAvatar","components"],"ignoreList":[],"sources":["../../frontend/services/theme.ts","../../frontend/services/toast.ts","../../frontend/services/api.ts","../../frontend/services/storage.ts","../../frontend/services/shortcuts.ts","../../frontend/services/undo.ts","../../frontend/stores/app.ts","../../frontend/services/auth.ts","../../frontend/stores/data.ts","../../frontend/services/projects.ts","../../frontend/services/companies.ts","../../frontend/services/dashboard.ts","../../frontend/services/questions.ts","../../frontend/services/risks.ts","../../frontend/services/actions.ts","../../frontend/services/decisions.ts","../../frontend/services/chat.ts","../../frontend/services/contacts.ts","../../frontend/services/documents.ts","../../frontend/services/emails.ts","../../frontend/services/graph.ts","../../frontend/services/notifications.ts","../../frontend/services/settings.ts","../../frontend/services/profile.ts","../../frontend/services/facts.ts","../../frontend/services/krisp.ts","../../frontend/utils/dom.ts","../../frontend/components/ThemeToggle.ts","../../frontend/stores/ui.ts","../../frontend/components/Header.ts","../../frontend/components/Sidebar.ts","../../frontend/components/Toast.ts","../../frontend/components/Modal.ts","../../frontend/components/modals/MemberPermissionsModal.ts","../../frontend/components/modals/ProjectModal.ts","../../frontend/components/ProjectSelector.ts","../../frontend/utils/format.ts","../../frontend/components/Dashboard.ts","../../frontend/components/Chat.ts","../../frontend/components/questions/QuestionDetailView.ts","../../frontend/components/modals/QuestionModal.ts","../../frontend/components/sot/QuestionsPanel.ts","../../frontend/components/SourceOfTruth.ts","../../frontend/components/modals/RiskModal.ts","../../frontend/components/risks/RiskDetailView.ts","../../frontend/components/sot/RisksPanel.ts","../../frontend/services/sprints.ts","../../frontend/components/modals/ActionModal.ts","../../frontend/components/sprints/CreateSprintModal.ts","../../frontend/components/widgets/BreakdownChart.ts","../../frontend/components/sprints/SprintReportModal.ts","../../frontend/components/CommentsThread.ts","../../frontend/components/actions/ActionDetailView.ts","../../frontend/components/sot/ActionsPanel.ts","../../frontend/components/modals/DecisionModal.ts","../../frontend/components/decisions/DecisionDetailView.ts","../../frontend/components/sot/DecisionsPanel.ts","../../frontend/components/facts/FactDetailView.ts","../../frontend/components/sot/FactsPanel.ts","../../frontend/components/widgets/StatsCard.ts","../../frontend/components/widgets/HealthIndicator.ts","../../frontend/components/widgets/TrendChart.ts","../../frontend/components/widgets/RiskMatrix.ts","../../frontend/components/FileUploader.ts","../../frontend/components/KnowledgeGraph.ts","../../frontend/components/Timeline.ts","../../frontend/components/TimelinePanel.ts","../../frontend/services/billing.ts","../../frontend/components/CostsDashboard.ts","../../frontend/components/GlobalSearch.ts","../../frontend/components/BulkActions.ts","../../frontend/components/SyncStatus.ts","../../frontend/components/modals/CompaniesModal.ts","../../frontend/components/modals/SettingsModal.ts","../../frontend/components/modals/ProcessingModal.ts","../../frontend/components/modals/AuthModal.ts","../../frontend/components/modals/ContactModal.ts","../../frontend/components/modals/TeamModal.ts","../../frontend/components/modals/InviteModal.ts","../../frontend/components/modals/RoleModal.ts","../../frontend/components/modals/ExportModal.ts","../../frontend/components/modals/FileUploadModal.ts","../../frontend/components/modals/DeveloperModal.ts","../../frontend/components/modals/ShortcutsModal.ts","../../frontend/components/modals/NotificationsModal.ts","../../frontend/components/modals/EmailModal.ts","../../frontend/stores/charts.ts","../../frontend/components/modals/GraphModal.ts","../../frontend/components/modals/HistoryModal.ts","../../frontend/components/modals/CommentModal.ts","../../frontend/components/modals/ProfileModal.ts","../../frontend/components/modals/FactModal.ts","../../frontend/components/modals/ConversationPreviewModal.ts","../../frontend/components/modals/EmailPreviewModal.ts","../../frontend/components/BriefingPanel.ts","../../frontend/components/ReportsPanel.ts","../../frontend/components/ContactsPanel.ts","../../frontend/components/TeamsPanel.ts","../../frontend/components/OrgChart.ts","../../frontend/components/DocumentsPanel.ts","../../frontend/components/KnowledgePanel.ts","../../frontend/components/ConversationComposer.ts","../../frontend/components/ConversationsPanel.ts","../../frontend/components/EmailsPanel.ts","../../frontend/components/EmailComposer.ts","../../frontend/components/NotificationsDropdown.ts","../../frontend/components/MembersPanel.ts","../../frontend/components/ApiKeysPanel.ts","../../frontend/components/WebhooksPanel.ts","../../frontend/components/AuditPanel.ts","../../frontend/components/RolesPanel.ts","../../frontend/components/AdminPanel.ts","../../frontend/components/HistoryPanel.ts","../../frontend/stores/teamAnalysis.ts","../../frontend/utils/legacy-bridge.ts","../../frontend/main.ts"],"sourcesContent":["/**\r\n * Theme Service\r\n * Manages dark/light/system theme with auto-detection\r\n */\r\n\r\nexport type ThemeMode = 'light' | 'dark' | 'system';\r\nexport type EffectiveTheme = 'light' | 'dark';\r\n\r\nclass ThemeService {\r\n  private mode: ThemeMode;\r\n  private listeners: Set<(theme: EffectiveTheme) => void> = new Set();\r\n  private mediaQuery: MediaQueryList;\r\n\r\n  constructor() {\r\n    this.mode = this.getSavedTheme();\r\n    this.mediaQuery = window.matchMedia('(prefers-color-scheme: light)');\r\n    this.apply();\r\n    this.watchSystemChanges();\r\n  }\r\n\r\n  /**\r\n   * Get saved theme from localStorage or default to 'system'\r\n   */\r\n  private getSavedTheme(): ThemeMode {\r\n    const saved = localStorage.getItem('theme');\r\n    if (saved === 'light' || saved === 'dark' || saved === 'system') {\r\n      return saved;\r\n    }\r\n    return 'system';\r\n  }\r\n\r\n  /**\r\n   * Get the system's preferred color scheme\r\n   */\r\n  private getSystemTheme(): EffectiveTheme {\r\n    return this.mediaQuery.matches ? 'light' : 'dark';\r\n  }\r\n\r\n  /**\r\n   * Watch for system theme changes\r\n   */\r\n  private watchSystemChanges(): void {\r\n    this.mediaQuery.addEventListener('change', () => {\r\n      if (this.mode === 'system') {\r\n        this.apply();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get the effective theme (resolving 'system' to actual theme)\r\n   */\r\n  getEffective(): EffectiveTheme {\r\n    if (this.mode === 'system') {\r\n      return this.getSystemTheme();\r\n    }\r\n    return this.mode;\r\n  }\r\n\r\n  /**\r\n   * Get the current mode setting\r\n   */\r\n  getMode(): ThemeMode {\r\n    return this.mode;\r\n  }\r\n\r\n  /**\r\n   * Apply the current theme to the document\r\n   */\r\n  apply(): void {\r\n    const effective = this.getEffective();\r\n    document.documentElement.setAttribute('data-theme', effective);\r\n    \r\n    // Notify listeners\r\n    this.listeners.forEach(fn => fn(effective));\r\n  }\r\n\r\n  /**\r\n   * Set theme mode directly\r\n   */\r\n  set(mode: ThemeMode): void {\r\n    this.mode = mode;\r\n    localStorage.setItem('theme', mode);\r\n    this.apply();\r\n  }\r\n\r\n  /**\r\n   * Cycle through themes: light -> dark -> system -> light\r\n   */\r\n  cycle(): ThemeMode {\r\n    const modes: ThemeMode[] = ['light', 'dark', 'system'];\r\n    const currentIndex = modes.indexOf(this.mode);\r\n    const nextIndex = (currentIndex + 1) % modes.length;\r\n    this.set(modes[nextIndex]);\r\n    return this.mode;\r\n  }\r\n\r\n  /**\r\n   * Toggle between light and dark (ignores system)\r\n   */\r\n  toggle(): EffectiveTheme {\r\n    const effective = this.getEffective();\r\n    const newTheme: EffectiveTheme = effective === 'dark' ? 'light' : 'dark';\r\n    this.set(newTheme);\r\n    return newTheme;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to theme changes\r\n   */\r\n  onChange(callback: (theme: EffectiveTheme) => void): () => void {\r\n    this.listeners.add(callback);\r\n    return () => this.listeners.delete(callback);\r\n  }\r\n\r\n  /**\r\n   * Get icon for current theme mode\r\n   */\r\n  getIcon(): string {\r\n    switch (this.mode) {\r\n      case 'light': return '';\r\n      case 'dark': return '';\r\n      case 'system': return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get label for current theme mode\r\n   */\r\n  getLabel(): string {\r\n    switch (this.mode) {\r\n      case 'light': return 'Light';\r\n      case 'dark': return 'Dark';\r\n      case 'system': return 'System';\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const theme = new ThemeService();\r\n\r\n// Export class for testing\r\nexport { ThemeService };\r\n","/**\r\n * Toast Notification Service\r\n * Displays temporary notification messages\r\n */\r\n\r\nexport type ToastType = 'success' | 'error' | 'warning' | 'info';\r\n\r\ninterface ToastOptions {\r\n  duration?: number;\r\n  position?: 'top-right' | 'top-left' | 'bottom-right' | 'bottom-left';\r\n}\r\n\r\nconst defaultOptions: ToastOptions = {\r\n  duration: 3000,\r\n  position: 'bottom-right',\r\n};\r\n\r\n/**\r\n * Show a toast notification\r\n */\r\nexport function showToast(\r\n  message: string,\r\n  type: ToastType = 'success',\r\n  options: ToastOptions = {}\r\n): void {\r\n  const opts = { ...defaultOptions, ...options };\r\n  \r\n  // Create toast element\r\n  const toast = document.createElement('div');\r\n  const pos = opts.position || 'bottom-right';\r\n  toast.className = `toast toast-${type} toast--${pos} fade-in`;\r\n  toast.textContent = message;\r\n\r\n  // Add to DOM\r\n  document.body.appendChild(toast);\r\n\r\n  // Remove after duration\r\n  setTimeout(() => {\r\n    toast.classList.add('toast-fade-out');\r\n    setTimeout(() => toast.remove(), 300);\r\n  }, opts.duration);\r\n}\r\n\r\n/**\r\n * Show success toast\r\n */\r\nexport function success(message: string, options?: ToastOptions): void {\r\n  showToast(message, 'success', options);\r\n}\r\n\r\n/**\r\n * Show error toast\r\n */\r\nexport function error(message: string, options?: ToastOptions): void {\r\n  showToast(message, 'error', options);\r\n}\r\n\r\n/**\r\n * Show warning toast\r\n */\r\nexport function warning(message: string, options?: ToastOptions): void {\r\n  showToast(message, 'warning', options);\r\n}\r\n\r\n/**\r\n * Show info toast\r\n */\r\nexport function info(message: string, options?: ToastOptions): void {\r\n  showToast(message, 'info', options);\r\n}\r\n\r\n// Export as namespace for convenience\r\nexport const toast = {\r\n  show: showToast,\r\n  success,\r\n  error,\r\n  warning,\r\n  info,\r\n};\r\n","/**\r\n * API Service\r\n * Centralized HTTP client with error handling\r\n */\r\n\r\nimport { toast } from './toast';\r\n\r\nlet getCurrentProjectId: (() => string | null) | null = null;\r\nexport function setProjectIdGetter(getter: () => string | null): void {\r\n  getCurrentProjectId = getter;\r\n}\r\n\r\nexport interface ApiResponse<T = unknown> {\r\n  data: T;\r\n  ok: boolean;\r\n  status: number;\r\n  statusText: string;\r\n}\r\n\r\n/**\r\n * API client configuration\r\n */\r\ninterface ApiConfig {\r\n  baseUrl: string;\r\n  defaultHeaders: Record<string, string>;\r\n  showErrorToasts: boolean;\r\n  timeout: number;\r\n  retryCount: number;\r\n  retryDelay: number;\r\n  onUnauthorized?: () => void;\r\n  onForbidden?: () => void;\r\n}\r\n\r\nconst config: ApiConfig = {\r\n  baseUrl: '',\r\n  defaultHeaders: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n  showErrorToasts: true,\r\n  timeout: 30000, // 30 seconds\r\n  retryCount: 2, // Retry failed requests up to 2 times\r\n  retryDelay: 1000, // Start with 1 second delay\r\n};\r\n\r\n// Request interceptors\r\ntype RequestInterceptor = (options: RequestInit) => RequestInit | Promise<RequestInit>;\r\ntype ResponseInterceptor = (response: ApiResponse<unknown>) => ApiResponse<unknown> | Promise<ApiResponse<unknown>>;\r\n\r\nconst requestInterceptors: RequestInterceptor[] = [];\r\nconst responseInterceptors: ResponseInterceptor[] = [];\r\n\r\n/**\r\n * Add request interceptor\r\n */\r\nexport function addRequestInterceptor(interceptor: RequestInterceptor): () => void {\r\n  requestInterceptors.push(interceptor);\r\n  return () => {\r\n    const index = requestInterceptors.indexOf(interceptor);\r\n    if (index > -1) requestInterceptors.splice(index, 1);\r\n  };\r\n}\r\n\r\n/**\r\n * Add response interceptor\r\n */\r\nexport function addResponseInterceptor(interceptor: ResponseInterceptor): () => void {\r\n  responseInterceptors.push(interceptor);\r\n  return () => {\r\n    const index = responseInterceptors.indexOf(interceptor);\r\n    if (index > -1) responseInterceptors.splice(index, 1);\r\n  };\r\n}\r\n\r\n/**\r\n * Make an API request with proper error handling\r\n */\r\nexport async function api<T = unknown>(\r\n  path: string,\r\n  options: RequestInit = {},\r\n  attempt = 0\r\n): Promise<ApiResponse<T>> {\r\n  const url = `${config.baseUrl}${path}`;\r\n  \r\n  // Apply request interceptors\r\n  let finalOptions: RequestInit = {\r\n    ...options,\r\n    headers: {\r\n      ...config.defaultHeaders,\r\n      ...options.headers,\r\n    },\r\n  };\r\n\r\n  for (const interceptor of requestInterceptors) {\r\n    finalOptions = await interceptor(finalOptions);\r\n  }\r\n\r\n  // Per-request timeout (optional); do not pass timeout to fetch\r\n  const optsWithTimeout = finalOptions as RequestInit & { timeout?: number };\r\n  const timeoutMs = optsWithTimeout.timeout ?? config.timeout;\r\n  delete (finalOptions as RequestInit & { timeout?: number }).timeout;\r\n\r\n  // Create abort controller for timeout\r\n  const controller = new AbortController();\r\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\r\n\r\n  try {\r\n    const response = await fetch(url, {\r\n      ...finalOptions,\r\n      signal: controller.signal,\r\n      credentials: 'include', // Include cookies for authentication\r\n    });\r\n\r\n    clearTimeout(timeoutId);\r\n\r\n    const contentType = (response.headers.get('content-type') || '').toLowerCase();\r\n    const text = await response.text();\r\n    let data: T;\r\n    if (contentType.includes('application/json') && text) {\r\n      try {\r\n        data = JSON.parse(text) as T;\r\n      } catch {\r\n        const msg = 'Invalid server response (not JSON). You may be seeing an error page or wrong endpoint.';\r\n        if (config.showErrorToasts) toast.error(msg);\r\n        throw new ApiError(msg, response.status || 0);\r\n      }\r\n    } else {\r\n      data = text as unknown as T;\r\n    }\r\n\r\n    if (!response.ok) {\r\n      // Handle specific HTTP errors\r\n      switch (response.status) {\r\n        case 401:\r\n          if (config.onUnauthorized) {\r\n            config.onUnauthorized();\r\n          }\r\n          break;\r\n        case 403:\r\n          if (config.onForbidden) {\r\n            config.onForbidden();\r\n          }\r\n          break;\r\n        case 429:\r\n          // Rate limited - auto retry with exponential backoff\r\n          if (attempt < 3) {\r\n            const retryAfter = parseInt(response.headers.get('Retry-After') || '5', 10);\r\n            await sleep(retryAfter * 1000);\r\n            return api<T>(path, options, attempt + 1);\r\n          }\r\n          break;\r\n        case 503:\r\n        case 504:\r\n          // Service unavailable - retry\r\n          if (attempt < config.retryCount) {\r\n            await sleep(config.retryDelay * Math.pow(2, attempt));\r\n            return api<T>(path, options, attempt + 1);\r\n          }\r\n          break;\r\n      }\r\n\r\n      const errorMessage = extractErrorMessage(data, response.statusText);\r\n      \r\n      if (config.showErrorToasts) {\r\n        toast.error(errorMessage);\r\n      }\r\n      \r\n      throw new ApiError(errorMessage, response.status, data);\r\n    }\r\n\r\n    let result: ApiResponse<T> = {\r\n      data,\r\n      ok: true,\r\n      status: response.status,\r\n      statusText: response.statusText,\r\n    };\r\n\r\n    // Apply response interceptors\r\n    for (const interceptor of responseInterceptors) {\r\n      result = await interceptor(result) as ApiResponse<T>;\r\n    }\r\n\r\n    return result;\r\n  } catch (error) {\r\n    clearTimeout(timeoutId);\r\n\r\n    if (error instanceof ApiError) {\r\n      throw error;\r\n    }\r\n\r\n    // Abort error (timeout)\r\n    if (error instanceof DOMException && error.name === 'AbortError') {\r\n      const message = 'Request timed out';\r\n      if (config.showErrorToasts) {\r\n        toast.error(message);\r\n      }\r\n      throw new ApiError(message, 0);\r\n    }\r\n    \r\n    // Network or other error - retry if configured\r\n    if (attempt < config.retryCount) {\r\n      await sleep(config.retryDelay * Math.pow(2, attempt));\r\n      return api<T>(path, options, attempt + 1);\r\n    }\r\n\r\n    const rawMessage = error instanceof Error ? error.message : 'Network error';\r\n    const isJsonParseError = rawMessage.includes('JSON') || rawMessage.includes('Unexpected token');\r\n    const message = isJsonParseError\r\n      ? 'Invalid server response. Check that the server is running and the URL is correct.'\r\n      : rawMessage;\r\n    if (config.showErrorToasts) {\r\n      toast.error(`Connection error: ${message}`);\r\n    }\r\n    throw new ApiError(message, 0);\r\n  }\r\n}\r\n\r\n/**\r\n * Extract error message from response data\r\n */\r\nfunction extractErrorMessage(data: unknown, fallback: string): string {\r\n  if (typeof data === 'object' && data !== null) {\r\n    const obj = data as Record<string, unknown>;\r\n    return String(obj.error || obj.message || obj.detail || fallback);\r\n  }\r\n  return fallback || 'Request failed';\r\n}\r\n\r\n/**\r\n * Sleep helper\r\n */\r\nfunction sleep(ms: number): Promise<void> {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * Custom API Error class\r\n */\r\nclass ApiError extends Error {\r\n  status: number;\r\n  details?: unknown;\r\n\r\n  constructor(message: string, status: number, details?: unknown) {\r\n    super(message);\r\n    this.name = 'ApiError';\r\n    this.status = status;\r\n    this.details = details;\r\n  }\r\n}\r\n\r\n/**\r\n * Convenience methods\r\n */\r\nexport const http = {\r\n  get: <T = unknown>(path: string, options?: RequestInit) =>\r\n    api<T>(path, { ...options, method: 'GET' }),\r\n\r\n  post: <T = unknown>(path: string, body?: unknown, options?: RequestInit) =>\r\n    api<T>(path, {\r\n      ...options,\r\n      method: 'POST',\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    }),\r\n\r\n  put: <T = unknown>(path: string, body?: unknown, options?: RequestInit) =>\r\n    api<T>(path, {\r\n      ...options,\r\n      method: 'PUT',\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    }),\r\n\r\n  patch: <T = unknown>(path: string, body?: unknown, options?: RequestInit) =>\r\n    api<T>(path, {\r\n      ...options,\r\n      method: 'PATCH',\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    }),\r\n\r\n  delete: <T = unknown>(path: string, options?: RequestInit) =>\r\n    api<T>(path, { ...options, method: 'DELETE' }),\r\n};\r\n\r\n/**\r\n * Configure API client\r\n */\r\nexport function configureApi(newConfig: Partial<ApiConfig>): void {\r\n  Object.assign(config, newConfig);\r\n}\r\n\r\nexport { ApiError };\r\n\r\n/**\r\n * Returns headers that include X-Project-Id for project-scoped API calls.\r\n * Use with raw fetch when the response is not JSON (e.g. blob, stream).\r\n */\r\nexport function getProjectHeaders(): Record<string, string> {\r\n  const id = getCurrentProjectId?.() ?? null;\r\n  return id ? { 'X-Project-Id': id } : {};\r\n}\r\n\r\n/**\r\n * fetch with X-Project-Id and credentials for project-scoped endpoints.\r\n * Use instead of raw fetch when the route is project-scoped (e.g. export, upload, graph sync).\r\n */\r\nexport async function fetchWithProject(\r\n  input: RequestInfo | URL,\r\n  init?: RequestInit\r\n): Promise<Response> {\r\n  const headers = new Headers(init?.headers);\r\n  Object.entries(getProjectHeaders()).forEach(([k, v]) => headers.set(k, v));\r\n  return fetch(input, { ...init, headers, credentials: 'include' });\r\n}\r\n","/**\r\n * Storage Service\r\n * Wrapper for localStorage with type safety and JSON handling\r\n */\r\n\r\n/**\r\n * Get item from localStorage with JSON parsing.\r\n * Never throws: returns defaultValue if storage is blocked (e.g. Tracking Prevention) or parse fails.\r\n */\r\nexport function getItem<T>(key: string, defaultValue: T): T {\r\n  try {\r\n    const item = localStorage.getItem(key);\r\n    if (item === null) {\r\n      return defaultValue;\r\n    }\r\n    return JSON.parse(item) as T;\r\n  } catch {\r\n    return defaultValue;\r\n  }\r\n}\r\n\r\n/**\r\n * Set item in localStorage with JSON serialization.\r\n * Never throws: no-op if storage is blocked (e.g. Tracking Prevention).\r\n */\r\nexport function setItem<T>(key: string, value: T): void {\r\n  try {\r\n    localStorage.setItem(key, JSON.stringify(value));\r\n  } catch {\r\n    // Storage blocked or quota exceeded - ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Remove item from localStorage. Never throws; no-op if storage is blocked.\r\n */\r\nexport function removeItem(key: string): void {\r\n  try {\r\n    localStorage.removeItem(key);\r\n  } catch {\r\n    // ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Clear all localStorage. Never throws; no-op if storage is blocked.\r\n */\r\nexport function clear(): void {\r\n  try {\r\n    localStorage.clear();\r\n  } catch {\r\n    // ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Check if key exists in localStorage. Returns false if storage is blocked.\r\n */\r\nexport function hasItem(key: string): boolean {\r\n  try {\r\n    return localStorage.getItem(key) !== null;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all keys in localStorage. Returns [] if storage is blocked.\r\n */\r\nexport function getKeys(): string[] {\r\n  try {\r\n    return Object.keys(localStorage);\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Storage namespace export\r\n */\r\nexport const storage = {\r\n  get: getItem,\r\n  set: setItem,\r\n  remove: removeItem,\r\n  clear,\r\n  has: hasItem,\r\n  keys: getKeys,\r\n};\r\n","/**\r\n * Keyboard Shortcuts Service\r\n * Manages global keyboard shortcuts\r\n */\r\n\r\nexport interface Shortcut {\r\n  key: string;\r\n  ctrl?: boolean;\r\n  shift?: boolean;\r\n  alt?: boolean;\r\n  meta?: boolean;\r\n  description: string;\r\n  handler: () => void;\r\n}\r\n\r\n// Type for string-based shortcut registration (e.g., 'mod+k', 'ctrl+shift+s')\r\nexport type ShortcutHandler = (event: KeyboardEvent) => void;\r\n\r\nclass ShortcutService {\r\n  private shortcuts: Map<string, Shortcut> = new Map();\r\n  private enabled = true;\r\n  private isMac = typeof navigator !== 'undefined' && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\r\n\r\n  constructor() {\r\n    this.handleKeydown = this.handleKeydown.bind(this);\r\n    document.addEventListener('keydown', this.handleKeydown);\r\n  }\r\n\r\n  /**\r\n   * Parse string shortcut to Shortcut object\r\n   * Supports: 'mod+k' (cmd on Mac, ctrl on others), 'ctrl+shift+s', '/', 'Escape'\r\n   */\r\n  private parseShortcut(shortcutStr: string, handler: ShortcutHandler, description = ''): Shortcut {\r\n    const parts = shortcutStr.toLowerCase().split('+');\r\n    const key = parts.pop() || shortcutStr;\r\n    \r\n    const shortcut: Shortcut = {\r\n      key,\r\n      ctrl: parts.includes('ctrl') || (parts.includes('mod') && !this.isMac),\r\n      shift: parts.includes('shift'),\r\n      alt: parts.includes('alt'),\r\n      meta: parts.includes('meta') || (parts.includes('mod') && this.isMac),\r\n      description,\r\n      handler: () => {\r\n        // Create a synthetic event for backwards compatibility\r\n        const syntheticEvent = new KeyboardEvent('keydown', { key });\r\n        handler(syntheticEvent);\r\n      },\r\n    };\r\n\r\n    return shortcut;\r\n  }\r\n\r\n  /**\r\n   * Generate unique key for shortcut\r\n   */\r\n  private getShortcutKey(shortcut: Omit<Shortcut, 'description' | 'handler'>): string {\r\n    const parts: string[] = [];\r\n    if (shortcut.ctrl) parts.push('ctrl');\r\n    if (shortcut.shift) parts.push('shift');\r\n    if (shortcut.alt) parts.push('alt');\r\n    if (shortcut.meta) parts.push('meta');\r\n    if (shortcut.key) {\r\n      parts.push(shortcut.key.toLowerCase());\r\n    }\r\n    return parts.join('+');\r\n  }\r\n\r\n  /**\r\n   * Handle keydown events\r\n   */\r\n  private handleKeydown(event: KeyboardEvent): void {\r\n    if (!this.enabled) return;\r\n\r\n    // Don't trigger shortcuts when typing in input fields\r\n    const target = event.target as HTMLElement;\r\n    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\r\n      // Allow Escape in input fields\r\n      if (event.key !== 'Escape') {\r\n        return;\r\n      }\r\n    }\r\n\r\n    const key = this.getShortcutKey({\r\n      key: event.key,\r\n      ctrl: event.ctrlKey,\r\n      shift: event.shiftKey,\r\n      alt: event.altKey,\r\n      meta: event.metaKey,\r\n    });\r\n\r\n    const shortcut = this.shortcuts.get(key);\r\n    if (shortcut) {\r\n      event.preventDefault();\r\n      shortcut.handler();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Register a keyboard shortcut\r\n   * Supports both object format and string format:\r\n   * - Object: { key: 'k', ctrl: true, handler: () => {}, description: 'Search' }\r\n   * - String: register('mod+k', (e) => {}, 'Search')\r\n   */\r\n  register(shortcutOrKey: Shortcut | string, handler?: ShortcutHandler, description?: string): () => void {\r\n    let shortcut: Shortcut;\r\n    \r\n    if (typeof shortcutOrKey === 'string') {\r\n      if (!handler) {\r\n        throw new Error('Handler is required when using string shortcut format');\r\n      }\r\n      shortcut = this.parseShortcut(shortcutOrKey, handler, description || '');\r\n    } else {\r\n      shortcut = shortcutOrKey;\r\n    }\r\n    \r\n    const key = this.getShortcutKey(shortcut);\r\n    this.shortcuts.set(key, shortcut);\r\n    \r\n    // Return unregister function\r\n    return () => this.shortcuts.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Unregister a shortcut by key combination\r\n   */\r\n  unregister(shortcut: Omit<Shortcut, 'description' | 'handler'>): void {\r\n    const key = this.getShortcutKey(shortcut);\r\n    this.shortcuts.delete(key);\r\n  }\r\n\r\n  /**\r\n   * Enable/disable all shortcuts\r\n   */\r\n  setEnabled(enabled: boolean): void {\r\n    this.enabled = enabled;\r\n  }\r\n\r\n  /**\r\n   * Get all registered shortcuts\r\n   */\r\n  getAll(): Shortcut[] {\r\n    return Array.from(this.shortcuts.values());\r\n  }\r\n\r\n  /**\r\n   * Show shortcuts help modal\r\n   */\r\n  showHelp(): void {\r\n    const shortcuts = this.getAll();\r\n    console.log('Keyboard Shortcuts:');\r\n    shortcuts.forEach(s => {\r\n      const parts: string[] = [];\r\n      if (s.ctrl) parts.push('Ctrl');\r\n      if (s.shift) parts.push('Shift');\r\n      if (s.alt) parts.push('Alt');\r\n      if (s.meta) parts.push('Cmd');\r\n      parts.push(s.key.toUpperCase());\r\n      console.log(`  ${parts.join('+')} - ${s.description}`);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Destroy service and remove event listener\r\n   */\r\n  destroy(): void {\r\n    document.removeEventListener('keydown', this.handleKeydown);\r\n    this.shortcuts.clear();\r\n  }\r\n}\r\n\r\n// Export singleton\r\nexport const shortcuts = new ShortcutService();\r\n\r\n// Export class for testing\r\nexport { ShortcutService };\r\n","/**\r\n * Undo Service\r\n * Manages undo/redo stack for operations\r\n */\r\n\r\nexport interface UndoAction {\r\n  id?: string;\r\n  type?: string;\r\n  description: string;\r\n  undo: () => Promise<void> | void;\r\n  redo?: () => Promise<void> | void;\r\n  timestamp: number;\r\n}\r\n\r\nclass UndoService {\r\n  private undoStack: UndoAction[] = [];\r\n  private redoStack: UndoAction[] = [];\r\n  private maxSize = 50;\r\n  private listeners: Set<() => void> = new Set();\r\n\r\n  /**\r\n   * Push a new action to the undo stack\r\n   */\r\n  push(action: Omit<UndoAction, 'timestamp'>): void {\r\n    this.undoStack.push({\r\n      ...action,\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    // Clear redo stack on new action\r\n    this.redoStack = [];\r\n\r\n    // Limit stack size\r\n    if (this.undoStack.length > this.maxSize) {\r\n      this.undoStack.shift();\r\n    }\r\n\r\n    this.notify();\r\n  }\r\n\r\n  /**\r\n   * Undo the last action\r\n   */\r\n  async undo(): Promise<boolean> {\r\n    const action = this.undoStack.pop();\r\n    if (!action) return false;\r\n\r\n    try {\r\n      await action.undo();\r\n      this.redoStack.push(action);\r\n      this.notify();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Undo failed:', error);\r\n      // Put action back on stack\r\n      this.undoStack.push(action);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redo the last undone action\r\n   */\r\n  async redo(): Promise<boolean> {\r\n    const action = this.redoStack.pop();\r\n    if (!action || !action.redo) return false;\r\n\r\n    try {\r\n      await action.redo();\r\n      this.undoStack.push(action);\r\n      this.notify();\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Redo failed:', error);\r\n      // Put action back on stack\r\n      this.redoStack.push(action);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if undo is available\r\n   */\r\n  canUndo(): boolean {\r\n    return this.undoStack.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Check if redo is available\r\n   */\r\n  canRedo(): boolean {\r\n    return this.redoStack.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Get last undoable action description\r\n   */\r\n  getUndoDescription(): string | null {\r\n    const action = this.undoStack[this.undoStack.length - 1];\r\n    return action?.description ?? null;\r\n  }\r\n\r\n  /**\r\n   * Get last redoable action description\r\n   */\r\n  getRedoDescription(): string | null {\r\n    const action = this.redoStack[this.redoStack.length - 1];\r\n    return action?.description ?? null;\r\n  }\r\n\r\n  /**\r\n   * Clear all undo/redo history\r\n   */\r\n  clear(): void {\r\n    this.undoStack = [];\r\n    this.redoStack = [];\r\n    this.notify();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to changes\r\n   */\r\n  onChange(callback: () => void): () => void {\r\n    this.listeners.add(callback);\r\n    return () => this.listeners.delete(callback);\r\n  }\r\n\r\n  /**\r\n   * Notify listeners of changes\r\n   */\r\n  private notify(): void {\r\n    this.listeners.forEach(fn => fn());\r\n  }\r\n\r\n  /**\r\n   * Get stack sizes for debugging\r\n   */\r\n  getState(): { undoCount: number; redoCount: number } {\r\n    return {\r\n      undoCount: this.undoStack.length,\r\n      redoCount: this.redoStack.length,\r\n    };\r\n  }\r\n}\r\n\r\n// Export singleton\r\nexport const undoManager = new UndoService();\r\n\r\n// Export class for testing\r\nexport { UndoService };\r\n","/**\r\n * App Store\r\n * Core application state\r\n */\r\n\r\nimport { storage } from '../services/storage';\r\n\r\n// Types\r\nexport interface User {\r\n  id: string;\r\n  email: string;\r\n  role: 'superadmin' | 'admin' | 'member';\r\n  name?: string;\r\n  avatar?: string;\r\n}\r\n\r\nexport interface Project {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  status?: 'active' | 'archived' | 'completed';\r\n  createdAt?: string;\r\n  updatedAt?: string;\r\n  ownerId?: string;\r\n  settings?: Record<string, unknown>;\r\n}\r\n\r\nexport interface ProjectConfig {\r\n  aiProvider?: string;\r\n  aiModel?: string;\r\n  language?: string;\r\n  timezone?: string;\r\n  analyticsEnabled?: boolean;\r\n  errorReportingEnabled?: boolean;\r\n  aiImprovementEnabled?: boolean;\r\n}\r\n\r\nexport interface AppState {\r\n  currentProjectId: string | null;\r\n  currentProject: Project | null;\r\n  currentUser: User | null;\r\n  authConfigured: boolean;\r\n  config: ProjectConfig;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n  isOnline: boolean;\r\n  version: string;\r\n}\r\n\r\n// Initial state\r\nconst initialState: AppState = {\r\n  currentProjectId: storage.get('currentProjectId', null),\r\n  currentProject: storage.get('currentProject', null),\r\n  currentUser: null,\r\n  authConfigured: false,\r\n  config: {},\r\n  isLoading: false,\r\n  error: null,\r\n  isOnline: navigator.onLine,\r\n  version: '1.0.0',\r\n};\r\n\r\n// State\r\nlet state: AppState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: AppState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners of state change\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): AppState {\r\n  return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: AppState) => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set current project by ID only\r\n */\r\nexport function setCurrentProjectId(projectId: string | null): void {\r\n  state = { ...state, currentProjectId: projectId };\r\n  if (projectId) {\r\n    storage.set('currentProjectId', projectId);\r\n  } else {\r\n    storage.remove('currentProjectId');\r\n    storage.remove('currentProject');\r\n    state = { ...state, currentProject: null };\r\n  }\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set current project (full object)\r\n */\r\nexport function setCurrentProject(project: Project | null): void {\r\n  state = { \r\n    ...state, \r\n    currentProject: project,\r\n    currentProjectId: project?.id || null,\r\n  };\r\n  if (project) {\r\n    storage.set('currentProject', project);\r\n    storage.set('currentProjectId', project.id);\r\n  } else {\r\n    storage.remove('currentProject');\r\n    storage.remove('currentProjectId');\r\n  }\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set current user\r\n */\r\nexport function setCurrentUser(user: User | null): void {\r\n  state = { ...state, currentUser: user };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set auth configured status\r\n */\r\nexport function setAuthConfigured(configured: boolean): void {\r\n  state = { ...state, authConfigured: configured };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set project config\r\n */\r\nexport function setConfig(config: Partial<ProjectConfig>): void {\r\n  state = { ...state, config: { ...state.config, ...config } };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set loading state\r\n */\r\nexport function setLoading(isLoading: boolean): void {\r\n  state = { ...state, isLoading };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set error\r\n */\r\nexport function setError(error: string | null): void {\r\n  state = { ...state, error };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set online status\r\n */\r\nexport function setOnline(online: boolean): void {\r\n  state = { ...state, isOnline: online };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n  state = { ...initialState };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Initialize app store\r\n * Sets up online/offline listeners\r\n */\r\nexport function initAppStore(): void {\r\n  window.addEventListener('online', () => setOnline(true));\r\n  window.addEventListener('offline', () => setOnline(false));\r\n}\r\n\r\n// Export as namespace\r\nexport const appStore = {\r\n  getState,\r\n  subscribe,\r\n  setCurrentProject,\r\n  setCurrentProjectId,\r\n  setCurrentUser,\r\n  setAuthConfigured,\r\n  setConfig,\r\n  setLoading,\r\n  setError,\r\n  setOnline,\r\n  reset,\r\n  init: initAppStore,\r\n};\r\n","/**\r\n * Auth Service\r\n * Handles authentication state and API calls\r\n */\r\n\r\nimport { http } from './api';\r\nimport { appStore, User } from '../stores/app';\r\nimport { toast } from './toast';\r\n\r\n// Types\r\nexport interface AuthStatus {\r\n  configured: boolean;\r\n  url?: string;\r\n}\r\n\r\nexport interface LoginRequest {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nexport interface OTPRequestResponse {\r\n  success: boolean;\r\n  message?: string;\r\n  expiresInMinutes?: number;\r\n  config?: OTPConfig;\r\n  retryAfter?: number;\r\n}\r\n\r\nexport interface OTPVerifyResponse {\r\n  success: boolean;\r\n  user?: AuthUser;\r\n  redirectTo?: string;\r\n  error?: string;\r\n  attemptsRemaining?: number;\r\n  needsEmailVerification?: boolean;\r\n  fallbackToPassword?: boolean;\r\n}\r\n\r\nexport interface OTPConfig {\r\n  codeLength: number;\r\n  expirationMinutes: number;\r\n  resendCooldownSeconds: number;\r\n}\r\n\r\nexport interface RegisterRequest {\r\n  email: string;\r\n  password: string;\r\n  username?: string;\r\n  display_name?: string;\r\n}\r\n\r\nexport interface AuthUser {\r\n  id: string;\r\n  email: string;\r\n  email_confirmed_at?: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  user_metadata?: {\r\n    username?: string;\r\n    display_name?: string;\r\n  };\r\n  profile?: UserProfile | null;\r\n}\r\n\r\nexport interface UserProfile {\r\n  id: string;\r\n  username?: string;\r\n  display_name?: string;\r\n  avatar_url?: string;\r\n  timezone?: string;\r\n  preferences?: Record<string, unknown>;\r\n  role?: 'user' | 'admin' | 'superadmin'; // Application role from user_profiles table\r\n}\r\n\r\nexport interface LoginResponse {\r\n  success: boolean;\r\n  user: AuthUser;\r\n}\r\n\r\nexport interface RegisterResponse {\r\n  success: boolean;\r\n  user: AuthUser;\r\n  session?: {\r\n    access_token: string;\r\n    refresh_token: string;\r\n    expires_at: number;\r\n  };\r\n  needsEmailVerification: boolean;\r\n}\r\n\r\nexport interface MeResponse {\r\n  authenticated: boolean;\r\n  user: AuthUser | null;\r\n}\r\n\r\n// Auth state\r\nlet isInitialized = false;\r\nlet authCheckPromise: Promise<boolean> | null = null;\r\n\r\n/**\r\n * Check if authentication is configured (Supabase)\r\n */\r\nexport async function checkAuthStatus(): Promise<AuthStatus> {\r\n  try {\r\n    const response = await http.get<AuthStatus>('/api/auth/status');\r\n    const configured = response.data.configured;\r\n    appStore.setAuthConfigured(configured);\r\n    return response.data;\r\n  } catch {\r\n    appStore.setAuthConfigured(false);\r\n    return { configured: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Check current session and get user\r\n */\r\nexport async function checkSession(): Promise<User | null> {\r\n  try {\r\n    const response = await http.get<MeResponse>('/api/auth/me');\r\n    \r\n    if (response.data.authenticated && response.data.user) {\r\n      const authUser = response.data.user;\r\n      const user = mapAuthUserToUser(authUser);\r\n      appStore.setCurrentUser(user);\r\n      return user;\r\n    }\r\n    \r\n    appStore.setCurrentUser(null);\r\n    return null;\r\n  } catch {\r\n    appStore.setCurrentUser(null);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize auth - check status and session\r\n * When Supabase is configured, always requires valid authentication\r\n */\r\nexport async function initAuth(): Promise<boolean> {\r\n  // Prevent multiple simultaneous checks\r\n  if (authCheckPromise) {\r\n    return authCheckPromise;\r\n  }\r\n\r\n  authCheckPromise = (async () => {\r\n    try {\r\n      // Check if auth is configured\r\n      const status = await checkAuthStatus();\r\n      \r\n      if (!status.configured) {\r\n        // Auth not configured - allow guest mode\r\n        isInitialized = true;\r\n        return false;\r\n      }\r\n\r\n      // Auth is configured - check current session\r\n      // If session is invalid, user MUST login\r\n      const user = await checkSession();\r\n      isInitialized = true;\r\n      \r\n      if (!user) {\r\n        // No valid session - clear any stale user data\r\n        appStore.setCurrentUser(null);\r\n        console.log(' Supabase configured but no valid session - login required');\r\n        return false;\r\n      }\r\n      \r\n      return true;\r\n    } catch {\r\n      // Auth check failed - clear user and require login\r\n      appStore.setCurrentUser(null);\r\n      isInitialized = true;\r\n      return false;\r\n    } finally {\r\n      authCheckPromise = null;\r\n    }\r\n  })();\r\n\r\n  return authCheckPromise;\r\n}\r\n\r\n/**\r\n * Login with email and password\r\n */\r\nexport async function login(credentials: LoginRequest): Promise<User> {\r\n  const response = await http.post<LoginResponse>('/api/auth/login', credentials);\r\n  \r\n  if (!response.data.success) {\r\n    throw new Error('Login failed');\r\n  }\r\n\r\n  const user = mapAuthUserToUser(response.data.user);\r\n  appStore.setCurrentUser(user);\r\n  return user;\r\n}\r\n\r\n/**\r\n * Register new account\r\n */\r\nexport async function register(data: RegisterRequest): Promise<{ user: User; needsEmailVerification: boolean }> {\r\n  // Validate password length (min 12 chars as per server)\r\n  if (data.password.length < 12) {\r\n    throw new Error('Password must be at least 12 characters');\r\n  }\r\n\r\n  // Validate username if provided\r\n  if (data.username && data.username.length < 3) {\r\n    throw new Error('Username must be at least 3 characters');\r\n  }\r\n\r\n  if (data.username && !/^[a-zA-Z0-9_]+$/.test(data.username)) {\r\n    throw new Error('Username can only contain letters, numbers, and underscores');\r\n  }\r\n\r\n  const response = await http.post<RegisterResponse>('/api/auth/register', data);\r\n  \r\n  if (!response.data.success) {\r\n    throw new Error('Registration failed');\r\n  }\r\n\r\n  const user = mapAuthUserToUser(response.data.user);\r\n  \r\n  // Only set user if no email verification required\r\n  if (!response.data.needsEmailVerification) {\r\n    appStore.setCurrentUser(user);\r\n  }\r\n\r\n  return { \r\n    user, \r\n    needsEmailVerification: response.data.needsEmailVerification \r\n  };\r\n}\r\n\r\n/**\r\n * Logout current user\r\n */\r\nexport async function logout(): Promise<void> {\r\n  try {\r\n    await http.post('/api/auth/logout');\r\n  } catch {\r\n    // Ignore logout errors - clear local state anyway\r\n  }\r\n  \r\n  appStore.setCurrentUser(null);\r\n  appStore.setCurrentProject(null);\r\n}\r\n\r\n/**\r\n * Request password reset\r\n */\r\nexport async function forgotPassword(email: string): Promise<void> {\r\n  await http.post('/api/auth/forgot-password', { email });\r\n  // Always succeeds - doesn't reveal if email exists\r\n}\r\n\r\n/**\r\n * Reset password with token\r\n */\r\nexport async function resetPassword(password: string, accessToken: string): Promise<void> {\r\n  if (password.length < 12) {\r\n    throw new Error('Password must be at least 12 characters');\r\n  }\r\n\r\n  const response = await http.post<{ success: boolean }>('/api/auth/reset-password', {\r\n    password,\r\n    access_token: accessToken,\r\n  });\r\n\r\n  if (!response.data.success) {\r\n    throw new Error('Password reset failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Refresh session token\r\n */\r\nexport async function refreshSession(): Promise<boolean> {\r\n  try {\r\n    const response = await http.post<{ success: boolean }>('/api/auth/refresh');\r\n    return response.data.success;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Request OTP code for passwordless login\r\n */\r\nexport async function requestLoginCode(email: string): Promise<OTPRequestResponse> {\r\n  const response = await http.post<OTPRequestResponse>('/api/auth/otp/request', { email });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Verify OTP code and complete login\r\n */\r\nexport async function verifyLoginCode(email: string, code: string): Promise<User> {\r\n  const response = await http.post<OTPVerifyResponse>('/api/auth/otp/verify', { email, code });\r\n  \r\n  if (!response.data.success) {\r\n    const error = new Error(response.data.error || 'Verification failed') as Error & {\r\n      attemptsRemaining?: number;\r\n      needsEmailVerification?: boolean;\r\n      fallbackToPassword?: boolean;\r\n    };\r\n    error.attemptsRemaining = response.data.attemptsRemaining;\r\n    error.needsEmailVerification = response.data.needsEmailVerification;\r\n    error.fallbackToPassword = response.data.fallbackToPassword;\r\n    throw error;\r\n  }\r\n  \r\n  // Handle redirect if needed (magic link flow)\r\n  if (response.data.redirectTo) {\r\n    window.location.href = response.data.redirectTo;\r\n    throw new Error('Redirecting...');\r\n  }\r\n  \r\n  if (!response.data.user) {\r\n    throw new Error('Login completed but no user data received');\r\n  }\r\n  \r\n  const user = mapAuthUserToUser(response.data.user);\r\n  appStore.setCurrentUser(user);\r\n  return user;\r\n}\r\n\r\n/**\r\n * Get OTP configuration\r\n */\r\nexport async function getOTPConfig(): Promise<OTPConfig> {\r\n  try {\r\n    const response = await http.get<OTPConfig>('/api/auth/otp/config');\r\n    return response.data;\r\n  } catch {\r\n    // Return defaults if API fails\r\n    return {\r\n      codeLength: 6,\r\n      expirationMinutes: 10,\r\n      resendCooldownSeconds: 60\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Confirm email with code\r\n */\r\nexport async function confirmEmail(email: string, code: string): Promise<void> {\r\n  const response = await http.post<{ success: boolean; message?: string; error?: string }>('/api/auth/confirm-email', { email, code });\r\n  \r\n  if (!response.data.success) {\r\n    throw new Error(response.data.error || 'Confirmation failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Resend email confirmation code\r\n */\r\nexport async function resendConfirmation(email: string): Promise<{ expiresInMinutes?: number }> {\r\n  const response = await http.post<{ success: boolean; message?: string; expiresInMinutes?: number; error?: string; retryAfter?: number }>('/api/auth/resend-confirmation', { email });\r\n  \r\n  if (!response.data.success) {\r\n    const error = new Error(response.data.error || 'Failed to resend confirmation') as Error & { retryAfter?: number };\r\n    error.retryAfter = response.data.retryAfter;\r\n    throw error;\r\n  }\r\n  \r\n  return { expiresInMinutes: response.data.expiresInMinutes };\r\n}\r\n\r\n/**\r\n * Map AuthUser to app User type\r\n * Note: role here is the APPLICATION role (superadmin/user) from user_profiles,\r\n * NOT the project role (owner/admin/write/read) from project_members\r\n */\r\nfunction mapAuthUserToUser(authUser: AuthUser): User {\r\n  const profile = authUser.profile;\r\n  const metadata = authUser.user_metadata || {};\r\n\r\n  return {\r\n    id: authUser.id,\r\n    email: authUser.email,\r\n    name: profile?.display_name || metadata.display_name || metadata.username || authUser.email.split('@')[0],\r\n    avatar: profile?.avatar_url,\r\n    role: profile?.role === 'superadmin' ? 'superadmin' : (profile?.role === 'admin' ? 'admin' : 'member'), // Map to app roles\r\n  };\r\n}\r\n\r\n/**\r\n * Check if user is authenticated\r\n */\r\nexport function isAuthenticated(): boolean {\r\n  return appStore.getState().currentUser !== null;\r\n}\r\n\r\n/**\r\n * Check if auth is initialized\r\n */\r\nexport function isAuthInitialized(): boolean {\r\n  return isInitialized;\r\n}\r\n\r\n/**\r\n * Get current user\r\n */\r\nexport function getCurrentUser(): User | null {\r\n  return appStore.getState().currentUser;\r\n}\r\n\r\n/**\r\n * Listen for auth required events\r\n */\r\nexport function onAuthRequired(callback: () => void): () => void {\r\n  const handler = () => callback();\r\n  window.addEventListener('godmode:auth-required', handler);\r\n  return () => window.removeEventListener('godmode:auth-required', handler);\r\n}\r\n\r\n/**\r\n * Trigger auth required event\r\n */\r\nexport function triggerAuthRequired(): void {\r\n  window.dispatchEvent(new CustomEvent('godmode:auth-required'));\r\n}\r\n\r\n// Export as namespace\r\nexport const auth = {\r\n  checkStatus: checkAuthStatus,\r\n  checkSession,\r\n  init: initAuth,\r\n  login,\r\n  register,\r\n  logout,\r\n  forgotPassword,\r\n  resetPassword,\r\n  refreshSession,\r\n  isAuthenticated,\r\n  isInitialized: isAuthInitialized,\r\n  getCurrentUser,\r\n  onAuthRequired,\r\n  triggerAuthRequired,\r\n  // OTP / Magic Code\r\n  requestLoginCode,\r\n  verifyLoginCode,\r\n  getOTPConfig,\r\n  confirmEmail,\r\n  resendConfirmation,\r\n};\r\n","/**\r\n * Data Store\r\n * Application data cache\r\n */\r\n\r\nimport type { Fact } from '../services/facts';\r\n\r\n// Types\r\nexport interface Question {\r\n  id: string;\r\n  content: string;  // Primary field (API uses this)\r\n  question?: string;  // Legacy field for backwards compatibility\r\n  context?: string;\r\n  answer?: string;\r\n  answer_source?: string;\r\n  status: 'open' | 'answered' | 'dismissed' | 'pending' | 'assigned' | 'resolved' | 'reopened' | 'closed' | 'deferred';\r\n  priority: 'critical' | 'high' | 'medium' | 'low';\r\n  category?: string;\r\n  source?: string;\r\n  source_file?: string;\r\n  created_at?: string;  // API format\r\n  createdAt?: string;   // Legacy format\r\n  updated_at?: string;  // API format\r\n  updatedAt?: string;   // Legacy format\r\n  assigned_to?: string;\r\n  answered_by_contact_id?: string;\r\n  answered_by_name?: string;\r\n  follow_up_to?: string;\r\n  // SOTA fields\r\n  sla_hours?: number;\r\n  sla_breached?: boolean;\r\n  extracted_entities?: Array<{ type: string; name: string; entity_id?: string; confidence?: number }>;\r\n  extracted_topics?: Array<{ name: string; type?: string; confidence?: number }>;\r\n}\r\n\r\nexport interface Risk {\r\n  id: string | number;\r\n  content?: string;\r\n  description?: string;\r\n  impact: 'high' | 'medium' | 'low' | 'critical';\r\n  probability?: 'high' | 'medium' | 'low';\r\n  likelihood?: 'high' | 'medium' | 'low';\r\n  mitigation?: string;\r\n  owner?: string;\r\n  status: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\r\n  createdAt?: string;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface Action {\r\n  id: string;\r\n  task: string;\r\n  assignee?: string;\r\n  dueDate?: string;\r\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\r\n  priority: 'high' | 'medium' | 'low';\r\n  createdAt: string;\r\n}\r\n\r\nexport interface Decision {\r\n  id: string | number;\r\n  decision: string;\r\n  content?: string;\r\n  rationale?: string;\r\n  madeBy?: string;\r\n  made_by?: string;\r\n  madeAt: string;\r\n  decided_at?: string;\r\n  status: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\r\n  source?: string;\r\n  source_file?: string;\r\n  owner?: string;\r\n  [key: string]: unknown; // Allow additional properties\r\n}\r\n\r\nexport interface Contact {\r\n  id: string;\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  company?: string;\r\n  organization?: string;\r\n  role?: string;\r\n  rolePrompt?: string;\r\n  department?: string;\r\n  linkedin?: string;\r\n  timezone?: string;\r\n  location?: string;\r\n  photoUrl?: string;\r\n  avatarUrl?: string;\r\n  photo_url?: string;\r\n  avatar_url?: string;\r\n  notes?: string;\r\n  tags?: string[];\r\n  aliases?: string[];\r\n  isFavorite?: boolean;\r\n  is_favorite?: boolean;\r\n}\r\n\r\nexport interface ChatSource {\r\n  id: string;\r\n  type: string;\r\n  score: number;\r\n  rrfScore?: number;\r\n  semanticScore?: number;\r\n  keywordScore?: number;\r\n  sourceCount?: number;\r\n  source?: string;\r\n  contactName?: string;\r\n  contactRole?: string;\r\n  avatarUrl?: string;\r\n}\r\n\r\nexport interface ChatRAGInfo {\r\n  method: string;\r\n  vectorResults: number;\r\n  graphResults: number;\r\n  fusedResults: number;\r\n  usedHyDE: boolean;\r\n  entityFilter?: string[];\r\n}\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  timestamp: string;\r\n  sources?: ChatSource[] | string[];\r\n  queryType?: string;\r\n  confidence?: 'high' | 'medium' | 'low';\r\n  contextQuality?: string;\r\n  rag?: ChatRAGInfo;\r\n}\r\n\r\nexport interface DataState {\r\n  questions: Question[];\r\n  risks: Risk[];\r\n  actions: Action[];\r\n  decisions: Decision[];\r\n  facts: Fact[];\r\n  contacts: Contact[];\r\n  chatHistory: ChatMessage[];\r\n  projects: Array<{ id: string; name: string }>;\r\n  lastUpdated: Record<string, number>;\r\n}\r\n\r\n// Initial state\r\nconst initialState: DataState = {\r\n  questions: [],\r\n  risks: [],\r\n  actions: [],\r\n  decisions: [],\r\n  facts: [],\r\n  contacts: [],\r\n  chatHistory: [],\r\n  projects: [],\r\n  lastUpdated: {},\r\n};\r\n\r\n// State\r\nlet state: DataState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: DataState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): DataState {\r\n  return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: DataState) => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set questions\r\n */\r\nexport function setQuestions(questions: Question[]): void {\r\n  state = { \r\n    ...state, \r\n    questions,\r\n    lastUpdated: { ...state.lastUpdated, questions: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set risks\r\n */\r\nexport function setRisks(risks: Risk[]): void {\r\n  state = { \r\n    ...state, \r\n    risks,\r\n    lastUpdated: { ...state.lastUpdated, risks: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set actions\r\n */\r\nexport function setActions(actions: Action[]): void {\r\n  state = { \r\n    ...state, \r\n    actions,\r\n    lastUpdated: { ...state.lastUpdated, actions: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set decisions\r\n */\r\nexport function setDecisions(decisions: Decision[]): void {\r\n  state = { \r\n    ...state, \r\n    decisions,\r\n    lastUpdated: { ...state.lastUpdated, decisions: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set facts\r\n */\r\nexport function setFacts(facts: Fact[]): void {\r\n  state = { \r\n    ...state, \r\n    facts,\r\n    lastUpdated: { ...state.lastUpdated, facts: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set contacts\r\n */\r\nexport function setContacts(contacts: Contact[]): void {\r\n  state = { \r\n    ...state, \r\n    contacts,\r\n    lastUpdated: { ...state.lastUpdated, contacts: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set chat history\r\n */\r\nexport function setChatHistory(chatHistory: ChatMessage[]): void {\r\n  state = { ...state, chatHistory };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Add chat message\r\n */\r\nexport function addChatMessage(message: ChatMessage): void {\r\n  state = { ...state, chatHistory: [...state.chatHistory, message] };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set projects\r\n */\r\nexport function setProjects(projects: Array<{ id: string; name: string }>): void {\r\n  state = { \r\n    ...state, \r\n    projects,\r\n    lastUpdated: { ...state.lastUpdated, projects: Date.now() }\r\n  };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Clear chat history\r\n */\r\nexport function clearChatHistory(): void {\r\n  state = { ...state, chatHistory: [] };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n  state = { ...initialState };\r\n  notify();\r\n}\r\n\r\n// Export as namespace\r\nexport const dataStore = {\r\n  getState,\r\n  subscribe,\r\n  setQuestions,\r\n  setRisks,\r\n  setActions,\r\n  setDecisions,\r\n  setFacts,\r\n  setContacts,\r\n  setChatHistory,\r\n  addChatMessage,\r\n  setProjects,\r\n  clearChatHistory,\r\n  reset,\r\n};\r\n","/**\n * Projects Service\n * Handles project CRUD operations and state\n */\n\nimport { http, fetchWithProject } from './api';\nimport { appStore, Project } from '../stores/app';\nimport { dataStore } from '../stores/data';\nimport { toast } from './toast';\n\n// Types\nexport interface ProjectListItem {\n  id: string;\n  name: string;\n  isDefault?: boolean;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\nexport interface CreateProjectRequest {\n  name: string;\n  description?: string;\n  userRole?: string;\n  userRolePrompt?: string;\n}\n\nexport interface UpdateProjectRequest {\n  name?: string;\n  description?: string;\n  userRole?: string;\n  userRolePrompt?: string;\n  isDefault?: boolean;\n}\n\nexport interface ProjectStats {\n  members?: number;\n  comments?: number;\n  recentActivity?: number;\n  facts?: number;\n  questions?: number;\n  documents?: number;\n  decisions?: number;\n  risks?: number;\n  actions?: number;\n  people?: number;\n}\n\n/**\n * Get all projects\n */\nexport async function getProjects(): Promise<ProjectListItem[]> {\n  try {\n    const response = await http.get<{ projects: ProjectListItem[] }>('/api/projects');\n    const projects = response.data.projects || [];\n    dataStore.setProjects(projects);\n    return projects;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get current/active project\n */\nexport async function getCurrentProject(): Promise<Project | null> {\n  try {\n    const response = await http.get<{ project: Project }>('/api/projects/current');\n    const project = response.data.project;\n    if (project) {\n      appStore.setCurrentProject(project);\n      return project;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Create a new project\n */\nexport async function createProject(data: CreateProjectRequest): Promise<Project> {\n  const response = await http.post<{ id: string; name?: string }>('/api/projects', data);\n  \n  const project: Project = {\n    id: response.data.id,\n    name: data.name,\n    description: data.description,\n  };\n\n  // Refresh projects list\n  await getProjects();\n  \n  return project;\n}\n\n/**\n * Update a project\n */\nexport async function updateProject(id: string, data: UpdateProjectRequest): Promise<void> {\n  await http.put(`/api/projects/${id}`, data);\n\n  // Update local state if it's the current project\n  const currentProject = appStore.getState().currentProject;\n  if (currentProject?.id === id) {\n    appStore.setCurrentProject({\n      ...currentProject,\n      ...data,\n    });\n  }\n\n  // Refresh projects list\n  await getProjects();\n}\n\n/**\n * Delete a project\n */\nexport async function deleteProject(id: string): Promise<void> {\n  await http.delete(`/api/projects/${id}`);\n\n  // Clear current project if it was deleted\n  if (appStore.getState().currentProjectId === id) {\n    appStore.setCurrentProject(null);\n  }\n\n  // Refresh projects list\n  await getProjects();\n}\n\n/**\n * Activate/switch to a project\n */\nexport async function activateProject(id: string): Promise<Project | null> {\n  try {\n    await http.put(`/api/projects/${id}/activate`);\n    \n    // Get the full project info\n    const project = await getCurrentProject();\n    return project;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Set a project as default\n */\nexport async function setDefaultProject(id: string): Promise<void> {\n  await http.post(`/api/projects/${id}/set-default`);\n  await getProjects();\n}\n\n/**\n * Get project statistics\n */\nexport async function getProjectStats(id: string): Promise<ProjectStats> {\n  try {\n    const response = await http.get<{ stats: ProjectStats }>(`/api/projects/${id}/stats`);\n    return response.data.stats || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Export project data\n */\nexport async function exportProject(id: string): Promise<Blob> {\n  const response = await fetchWithProject(`/api/projects/${id}/export`);\n  if (!response.ok) {\n    throw new Error('Failed to export project');\n  }\n  return response.blob();\n}\n\n/**\n * Import project data\n */\nexport async function importProject(file: File): Promise<Project> {\n  const formData = new FormData();\n  formData.append('file', file);\n\n  const response = await fetchWithProject('/api/projects/import', {\n    method: 'POST',\n    body: formData,\n  });\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => ({ error: 'Import failed' }));\n    throw new Error(error.error || 'Import failed');\n  }\n\n  const data = await response.json();\n  await getProjects();\n  \n  return data.project;\n}\n\n/**\n * Initialize projects - load list and set current\n */\nexport async function initProjects(): Promise<void> {\n  // Load all projects\n  await getProjects();\n\n  // Try to get current project from server\n  const current = await getCurrentProject();\n  \n  // If no current project, try to find default or first project\n  if (!current) {\n    const projects = dataStore.getState().projects;\n    if (projects.length > 0) {\n      const defaultProject = projects.find(p => (p as { isDefault?: boolean }).isDefault) || projects[0];\n      await activateProject(defaultProject.id);\n    }\n  }\n}\n\n// Export as namespace\nexport const projects = {\n  getAll: getProjects,\n  getCurrent: getCurrentProject,\n  create: createProject,\n  update: updateProject,\n  delete: deleteProject,\n  activate: activateProject,\n  setDefault: setDefaultProject,\n  getStats: getProjectStats,\n  export: exportProject,\n  import: importProject,\n  init: initProjects,\n};\n","/**\r\n * Companies Service\r\n * CRUD and templates for company profiles (branding, A4/PPT)\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface AnalysisReport {\r\n  ficha_identidade?: string;\r\n  visao_geral?: string;\r\n  produtos_servicos?: string;\r\n  publico_alvo?: string;\r\n  equipa_lideranca?: string;\r\n  presenca_digital?: string;\r\n  analise_competitiva?: string;\r\n  indicadores_crescimento?: string;\r\n  swot?: string;\r\n  conclusoes?: string;\r\n}\r\n\r\nexport interface BrandAssets {\r\n  primary_color?: string;\r\n  secondary_color?: string;\r\n  ai_context?: string;\r\n  analyzed_at?: string;\r\n  analysis_report?: AnalysisReport;\r\n}\r\n\r\nexport interface Company {\r\n  id: string;\r\n  name: string;\r\n  description?: string | null;\r\n  logo_url?: string | null;\r\n  website_url?: string | null;\r\n  linkedin_url?: string | null;\r\n  owner_id: string;\r\n  brand_assets?: BrandAssets;\r\n  a4_template_html?: string | null;\r\n  ppt_template_html?: string | null;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface CreateCompanyRequest {\r\n  name: string;\r\n  description?: string;\r\n  logo_url?: string;\r\n  website_url?: string;\r\n  linkedin_url?: string;\r\n}\r\n\r\nexport interface UpdateCompanyRequest {\r\n  name?: string;\r\n  description?: string;\r\n  logo_url?: string;\r\n  website_url?: string;\r\n  linkedin_url?: string;\r\n  brand_assets?: BrandAssets;\r\n}\r\n\r\nexport async function listCompanies(): Promise<Company[]> {\r\n  try {\r\n    const res = await http.get<{ companies?: Company[] }>('/api/companies');\r\n    const list = res.data?.companies;\r\n    return Array.isArray(list) ? list : [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getCompany(id: string): Promise<Company | null> {\r\n  try {\r\n    const res = await http.get<{ company: Company }>(`/api/companies/${id}`);\r\n    return res.data?.company ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function createCompany(data: CreateCompanyRequest): Promise<Company> {\r\n  const res = await http.post<{ company: Company }>('/api/companies', data);\r\n  return res.data.company;\r\n}\r\n\r\nexport async function updateCompany(id: string, data: UpdateCompanyRequest): Promise<Company> {\r\n  const res = await http.put<{ company: Company }>(`/api/companies/${id}`, data);\r\n  return res.data.company;\r\n}\r\n\r\nexport async function deleteCompany(id: string): Promise<void> {\r\n  await http.delete(`/api/companies/${id}`);\r\n}\r\n\r\nexport async function analyzeCompany(id: string): Promise<Company> {\r\n  const res = await http.post<{ company: Company }>(`/api/companies/${id}/analyze`, {});\r\n  return res.data.company;\r\n}\r\n\r\nexport type TemplateType = 'a4' | 'ppt';\r\n\r\nexport async function getTemplate(companyId: string, type: TemplateType): Promise<string> {\r\n  const res = await http.get<{ html: string }>(`/api/companies/${companyId}/templates/${type}`);\r\n  return res.data?.html ?? '';\r\n}\r\n\r\nexport async function updateTemplate(companyId: string, type: TemplateType, html: string): Promise<void> {\r\n  await http.put(`/api/companies/${companyId}/templates/${type}`, { html });\r\n}\r\n\r\nexport async function generateTemplate(companyId: string, type: TemplateType): Promise<{ html: string; company: Company }> {\r\n  const res = await http.post<{ html: string; company: Company }>(`/api/companies/${companyId}/templates/generate`, { type });\r\n  return { html: res.data.html, company: res.data.company };\r\n}\r\n","/**\r\n * Dashboard Service\r\n * Fetches dashboard data, stats, trends, and health metrics\r\n */\r\n\r\nimport { http } from './api';\r\n\r\n// Types\r\nexport interface DashboardData {\r\n  documents: {\r\n    total: number;\r\n    processed: number;\r\n    pending: number;\r\n  };\r\n  totalFacts: number;\r\n  factsByCategory?: Record<string, number>;\r\n  factsVerifiedCount?: number;\r\n  totalQuestions: number;\r\n  totalDecisions: number;\r\n  totalRisks: number;\r\n  totalActions: number;\r\n  totalPeople: number;\r\n  questionsByPriority: {\r\n    critical: number;\r\n    high: number;\r\n    medium: number;\r\n    resolved: number;\r\n  };\r\n  risksByImpact: {\r\n    high: number;\r\n    medium: number;\r\n    low: number;\r\n  };\r\n  overdueActions: number;\r\n  overdueItems: Array<{\r\n    id: string;\r\n    content: string;\r\n    assignee?: string;\r\n    due_date?: string;\r\n  }>;\r\n  questionAging: {\r\n    fresh: number;    // 0-3 days\r\n    aging: number;    // 4-7 days\r\n    stale: number;    // 8-14 days\r\n    critical: number; // 14+ days\r\n  };\r\n  oldestQuestions: Array<{\r\n    id: string;\r\n    content: string;\r\n    created_at: string;\r\n    priority?: string;\r\n  }>;\r\n  trends?: TrendData;\r\n  trendInsights?: Record<string, unknown>;\r\n}\r\n\r\nexport interface TrendData {\r\n  hasTrends: boolean;\r\n  periodDays: number;\r\n  compareDate: string;\r\n  facts: TrendMetric;\r\n  questions: TrendMetric;\r\n  risks: TrendMetric;\r\n  actions: TrendMetric;\r\n  decisions: TrendMetric;\r\n}\r\n\r\nexport interface TrendMetric {\r\n  current: number;\r\n  previous: number;\r\n  delta: number;\r\n  direction: 'up' | 'down' | 'stable';\r\n  sentiment: 'positive' | 'negative' | 'neutral';\r\n}\r\n\r\nexport interface TrendHistory {\r\n  date: string;\r\n  facts: number;\r\n  questions: number;\r\n  risks: number;\r\n  actions: number;\r\n  decisions: number;\r\n  // Index signature for dynamic access\r\n  [key: string]: string | number;\r\n}\r\n\r\nexport interface HealthData {\r\n  score: number; // 0-100\r\n  status: 'Healthy' | 'Good' | 'Needs Attention' | 'At Risk' | 'Critical';\r\n  color: string;\r\n  factors: Array<{\r\n    type: 'positive' | 'negative';\r\n    factor: string;\r\n    impact: number;\r\n    detail: string;\r\n  }>;\r\n  calculatedAt: string;\r\n}\r\n\r\nexport interface Insight {\r\n  type: 'warning' | 'alert' | 'info' | 'positive';\r\n  icon: string;\r\n  title: string;\r\n  message: string;\r\n  suggestion: string;\r\n  category: 'workload' | 'risk' | 'timeline' | 'knowledge' | 'progress';\r\n}\r\n\r\nexport interface Alert {\r\n  severity: 'critical' | 'high' | 'warning';\r\n  type: 'action' | 'risk' | 'question';\r\n  title: string;\r\n  message: string;\r\n  owner?: string;\r\n  assignee?: string;\r\n  id: string | number;\r\n}\r\n\r\n/**\r\n * Get full dashboard data\r\n */\r\nexport async function getDashboard(): Promise<DashboardData | null> {\r\n  try {\r\n    const response = await http.get<DashboardData>('/api/dashboard');\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get basic stats\r\n */\r\nexport async function getStats(): Promise<{\r\n  documents: { total: number; processed: number; pending: number };\r\n  facts: number;\r\n  questions: { total: number; pending: number; resolved: number; critical: number };\r\n  decisions: number;\r\n  risks: number;\r\n  people: number;\r\n} | null> {\r\n  try {\r\n    const response = await http.get('/api/stats');\r\n    return response.data as {\r\n      documents: { total: number; processed: number; pending: number };\r\n      facts: number;\r\n      questions: { total: number; pending: number; resolved: number; critical: number };\r\n      decisions: number;\r\n      risks: number;\r\n      people: number;\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get trends data\r\n */\r\nexport async function getTrends(days = 7): Promise<{\r\n  trends: TrendData;\r\n  history: TrendHistory[];\r\n} | null> {\r\n  try {\r\n    const response = await http.get<{ trends: TrendData; history: TrendHistory[] }>(`/api/trends?days=${days}`);\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get health score\r\n */\r\nexport async function getHealth(): Promise<HealthData | null> {\r\n  try {\r\n    const response = await http.get<HealthData>('/api/sot/health');\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get insights\r\n */\r\nexport async function getInsights(): Promise<Insight[]> {\r\n  try {\r\n    const response = await http.get<{ insights: Insight[] }>('/api/sot/insights');\r\n    return response.data.insights || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get alerts\r\n */\r\nexport async function getAlerts(): Promise<Alert[]> {\r\n  try {\r\n    const response = await http.get<{ alerts: Alert[] }>('/api/sot/alerts');\r\n    return response.data.alerts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Load all dashboard data in parallel\r\n */\r\nexport async function loadDashboardData(): Promise<{\r\n  dashboard: DashboardData | null;\r\n  health: HealthData | null;\r\n  insights: Insight[];\r\n  alerts: Alert[];\r\n}> {\r\n  const [dashboard, health, insights, alerts] = await Promise.all([\r\n    getDashboard(),\r\n    getHealth(),\r\n    getInsights(),\r\n    getAlerts(),\r\n  ]);\r\n\r\n  return { dashboard, health, insights, alerts };\r\n}\r\n\r\n// Export as namespace\r\nexport const dashboardService = {\r\n  getDashboard,\r\n  getStats,\r\n  getTrends,\r\n  getHealth,\r\n  getInsights,\r\n  getAlerts,\r\n  loadAll: loadDashboardData,\r\n};\r\n","/**\n * Questions Service\n * Handles question CRUD, answering, and AI suggestions\n */\n\nimport { http } from './api';\n\n// Types\nexport interface Question {\n  id: string | number;\n  content: string;\n  context?: string;\n  priority: 'low' | 'medium' | 'high' | 'critical';\n  status: 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed' | 'open' | 'answered' | 'closed' | 'deferred';\n  assigned_to?: string;\n  assigned_at?: string;\n  answer?: string;\n  answer_source?: 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai';\n  answered_at?: string;\n  answered_by_contact_id?: string;\n  answered_by_name?: string;\n  answer_provenance?: {\n    sources: Array<{ type: string; id?: string; content: string; confidence: number }>;\n    synthesis_method?: string;\n  };\n  category?: string;\n  source_file?: string;\n  created_at: string;\n  updated_at?: string;\n  resolved_at?: string;\n  previous_answer?: string;\n  edit_history?: Array<{\n    answer: string;\n    edited_at: string;\n  }>;\n  cached_suggestions?: AssigneeSuggestion[];\n  suggestions_generated_at?: string;\n  why?: string;\n  confidence?: number;\n  // SOTA fields\n  extracted_entities?: Array<{ type: string; name: string; entity_id?: string; confidence?: number }>;\n  extracted_topics?: Array<{ name: string; type?: string; confidence?: number }>;\n  sla_hours?: number;\n  sla_breached?: boolean;\n  sla_breached_at?: string;\n  follow_up_to?: string;\n  generation_source?: 'manual' | 'extracted' | 'template' | 'ai_generated';\n  cluster_id?: number;\n  cluster_label?: string;\n  // Dismissed tracking\n  dismissed_at?: string;\n  dismissed_by?: string;\n  dismissed_reason?: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other';\n  // Deferred tracking\n  deferred_at?: string;\n  deferred_by?: string;\n  deferred_until?: string;\n  deferred_reason?: string;\n  // Reopened tracking\n  reopened_at?: string;\n  reopened_by?: string;\n  reopened_reason?: string;\n  reopen_count?: number;\n  // Resolution type\n  resolution_type?: 'answered_manual' | 'answered_auto' | 'answered_ai' | 'dismissed' | 'merged' | 'superseded';\n  // Merged/Superseded\n  merged_into_id?: string;\n  superseded_by_id?: string;\n  // Usefulness feedback\n  was_useful?: boolean;\n  usefulness_feedback?: string;\n  // Requester role - who the question is FROM (their perspective)\n  requester_role?: string;\n  requester_role_prompt?: string;\n  requester_contact_id?: string;\n  requester_name?: string;\n}\n\nexport interface CreateQuestionRequest {\n  content: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  assigned_to?: string;\n  context?: string;\n  skipDedup?: boolean;\n}\n\nexport interface UpdateQuestionRequest {\n  content?: string;\n  context?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  status?: 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed';\n  assigned_to?: string;\n  category?: string;\n  reopen_reason?: string;\n  dismissed_reason?: string;\n}\n\nexport interface AnswerQuestionRequest {\n  answer: string;\n  source?: 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai';\n  followupQuestions?: string;\n  answeredByContactId?: string;\n  answeredByName?: string;\n  answerProvenance?: {\n    sources: Array<{ type: string; id?: string; content: string; confidence: number }>;\n    synthesis_method?: string;\n  };\n}\n\nexport interface AssigneeSuggestion {\n  person: string;\n  score: number;\n  reason: string;\n  contactId?: string;\n  role?: string;\n  organization?: string;\n  method: string;\n}\n\nexport interface CreateQuestionResponse {\n  success: boolean;\n  id?: number;\n  action?: string;\n  duplicate?: boolean;\n  existingId?: number;\n  similarity?: number;\n  message?: string;\n}\n\nexport interface AnswerQuestionResponse {\n  success: boolean;\n  question: Question;\n  followupsCreated: number;\n  message: string;\n}\n\nexport interface SuggestAssigneeResponse {\n  suggestions: AssigneeSuggestion[];\n  category: string;\n  method: string;\n  cached: boolean;\n  cachedAt?: string;\n}\n\n/**\n * Get all questions\n */\nexport async function getQuestions(filters?: {\n  status?: string;\n  priority?: string;\n}): Promise<Question[]> {\n  try {\n    const params = new URLSearchParams();\n    if (filters?.status) params.set('status', filters.status);\n    if (filters?.priority) params.set('priority', filters.priority);\n    \n    const query = params.toString();\n    const url = query ? `/api/questions?${query}` : '/api/questions';\n    \n    const response = await http.get<{ questions: Question[] }>(url);\n    return response.data.questions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Create a new question\n */\nexport async function createQuestion(data: CreateQuestionRequest): Promise<CreateQuestionResponse> {\n  const response = await http.post<CreateQuestionResponse>('/api/questions', data);\n  return response.data;\n}\n\n/**\n * Update a question\n */\nexport async function updateQuestion(id: string | number, data: UpdateQuestionRequest): Promise<Question> {\n  const response = await http.put<{ question: Question }>(`/api/questions/${id}`, data);\n  return response.data.question;\n}\n\n/**\n * Delete/dismiss a question\n */\nexport async function deleteQuestion(id: string | number, reason?: string): Promise<void> {\n  await http.delete(`/api/questions/${id}`, {\n    body: JSON.stringify({ reason }),\n  });\n}\n\n/**\n * Answer a question\n */\nexport async function answerQuestion(\n  id: string | number, \n  data: AnswerQuestionRequest\n): Promise<AnswerQuestionResponse> {\n  const response = await http.post<AnswerQuestionResponse>(`/api/questions/${id}/answer`, data);\n  return response.data;\n}\n\n/**\n * Get questions grouped by person\n */\nexport async function getQuestionsByPerson(): Promise<Record<string, Question[]>> {\n  try {\n    const response = await http.get<{ questionsByPerson: Record<string, Question[]> }>('/api/questions/by-person');\n    return response.data.questionsByPerson || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get questions grouped by team/category\n */\nexport async function getQuestionsByTeam(): Promise<Record<string, Question[]>> {\n  try {\n    const response = await http.get<{ questionsByTeam: Record<string, Question[]> }>('/api/questions/by-team');\n    return response.data.questionsByTeam || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get AI-powered assignee suggestions\n */\nexport async function suggestAssignee(options: {\n  content?: string;\n  id?: string | number;\n  useAI?: boolean;\n  refresh?: boolean;\n}): Promise<SuggestAssigneeResponse> {\n  const params = new URLSearchParams();\n  if (options.content) params.set('content', options.content);\n  if (options.id) params.set('id', String(options.id));\n  if (options.useAI === false) params.set('ai', 'false');\n  if (options.refresh) params.set('refresh', 'true');\n\n  const response = await http.get<SuggestAssigneeResponse>(\n    `/api/questions/suggest-assignee?${params.toString()}`,\n    { timeout: 90000 }\n  );\n  return response.data;\n}\n\n/**\n * Reopen a resolved question\n */\nexport async function reopenQuestion(id: string | number, reason: string): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/reopen`, { reason });\n  return response.data.question;\n}\n\n/**\n * Dismiss a question (permanently close without answer)\n */\nexport async function dismissQuestion(\n  id: string | number, \n  reason: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other',\n  details?: string\n): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/dismiss`, { \n    reason,\n    details \n  });\n  return response.data.question;\n}\n\n/**\n * Defer a question (postpone for later)\n */\nexport async function deferQuestion(\n  id: string | number, \n  until: string | Date,\n  reason?: string\n): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/defer`, { \n    until: typeof until === 'string' ? until : until.toISOString(),\n    reason \n  });\n  return response.data.question;\n}\n\n/**\n * Merge a question into another\n */\nexport async function mergeQuestion(\n  sourceId: string | number,\n  targetId: string | number\n): Promise<{ source: Question; target: Question }> {\n  const response = await http.post<{ source: Question; target: Question }>(\n    `/api/questions/${sourceId}/merge`, \n    { targetId }\n  );\n  return response.data;\n}\n\n/**\n * Submit feedback on an answer\n */\nexport async function submitAnswerFeedback(\n  id: string | number,\n  wasUseful: boolean,\n  feedback?: string\n): Promise<Question> {\n  const response = await http.post<{ question: Question }>(`/api/questions/${id}/feedback`, { \n    wasUseful,\n    feedback \n  });\n  return response.data.question;\n}\n\n/**\n * Get deferred questions that are due\n */\nexport async function getDueDeferredQuestions(): Promise<Question[]> {\n  try {\n    const response = await http.get<{ questions: Question[] }>('/api/questions/deferred/due');\n    return response.data.questions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get question lifecycle stats\n */\nexport async function getLifecycleStats(): Promise<Record<string, number>> {\n  try {\n    const response = await http.get<{ stats: Record<string, number> }>('/api/questions/stats/lifecycle');\n    return response.data.stats || {};\n  } catch {\n    return {};\n  }\n}\n\n/**\n * Get question statistics\n */\nexport function getQuestionStats(questions: Question[]): {\n  total: number;\n  pending: number;\n  assigned: number;\n  resolved: number;\n  critical: number;\n  overdue: number;\n} {\n  const now = new Date();\n  const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n  return {\n    total: questions.length,\n    pending: questions.filter(q => q.status === 'pending').length,\n    assigned: questions.filter(q => q.status === 'assigned').length,\n    resolved: questions.filter(q => q.status === 'resolved').length,\n    critical: questions.filter(q => q.priority === 'critical' && q.status !== 'resolved').length,\n    overdue: questions.filter(q => {\n      if (q.status === 'resolved') return false;\n      const created = new Date(q.created_at);\n      return created < sevenDaysAgo;\n    }).length,\n  };\n}\n\n// Export as namespace\nexport const questionsService = {\n  getAll: getQuestions,\n  create: createQuestion,\n  update: updateQuestion,\n  delete: deleteQuestion,\n  answer: answerQuestion,\n  getByPerson: getQuestionsByPerson,\n  getByTeam: getQuestionsByTeam,\n  suggestAssignee,\n  reopen: reopenQuestion,\n  getStats: getQuestionStats,\n  dismissQuestion,\n  deferQuestion,\n  submitAnswerFeedback,\n};\n","/**\r\n * Risks Service\r\n * Handles risk CRUD operations\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Risk {\r\n  id: string | number;\r\n  content: string;\r\n  title?: string;\r\n  description?: string;\r\n  impact: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood: 'low' | 'medium' | 'high';\r\n  mitigation?: string;\r\n  contingency?: string;\r\n  status: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\r\n  owner?: string;\r\n  category?: 'technical' | 'schedule' | 'budget' | 'resource' | 'scope' | 'external' | 'other';\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\r\n  created_at: string;\r\n  updated_at?: string;\r\n  deleted_at?: string | null;\r\n}\r\n\r\nexport interface RiskEvent {\r\n  id: string;\r\n  risk_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface CreateRiskRequest {\r\n  content: string;\r\n  title?: string;\r\n  impact?: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood?: 'low' | 'medium' | 'high';\r\n  mitigation?: string;\r\n  owner?: string;\r\n  category?: string;\r\n}\r\n\r\nexport interface UpdateRiskRequest {\r\n  content?: string;\r\n  title?: string;\r\n  impact?: 'low' | 'medium' | 'high' | 'critical';\r\n  likelihood?: 'low' | 'medium' | 'high';\r\n  mitigation?: string;\r\n  contingency?: string;\r\n  status?: 'open' | 'mitigating' | 'mitigated' | 'accepted' | 'closed';\r\n  owner?: string;\r\n  category?: string;\r\n}\r\n\r\n/**\r\n * Get all risks\r\n */\r\nexport async function getRisks(status?: string): Promise<Risk[]> {\r\n  try {\r\n    const url = status ? `/api/risks?status=${status}` : '/api/risks';\r\n    const response = await http.get<{ risks: Risk[] }>(url);\r\n    return response.data.risks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single risk by id\r\n */\r\nexport async function getRisk(id: string | number): Promise<Risk | null> {\r\n  try {\r\n    const response = await http.get<{ risk: Risk }>(`/api/risks/${id}`);\r\n    return response.data.risk ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get soft-deleted risks (for restore)\r\n */\r\nexport async function getDeletedRisks(): Promise<Risk[]> {\r\n  try {\r\n    const response = await http.get<{ risks: Risk[] }>('/api/risks/deleted');\r\n    return response.data.risks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted risk\r\n */\r\nexport async function restoreRisk(id: string | number): Promise<Risk> {\r\n  const response = await http.post<{ risk: Risk }>(`/api/risks/${id}/restore`, {});\r\n  return response.data.risk;\r\n}\r\n\r\n/**\r\n * Get risk timeline events\r\n */\r\nexport async function getRiskEvents(id: string | number): Promise<RiskEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: RiskEvent[] }>(`/api/risks/${id}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get risks grouped by category\r\n */\r\nexport async function getRisksByCategory(): Promise<Record<string, Risk[]>> {\r\n  try {\r\n    const response = await http.get<{ risksByCategory: Record<string, Risk[]> }>('/api/risks/by-category');\r\n    return response.data.risksByCategory || {};\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new risk\r\n */\r\nexport async function createRisk(data: CreateRiskRequest): Promise<Risk> {\r\n  const response = await http.post<{ risk: Risk; id: string | number }>('/api/risks', data);\r\n  return response.data.risk || { ...data, id: response.data.id, status: 'open', created_at: new Date().toISOString() } as Risk;\r\n}\r\n\r\n/**\r\n * Update a risk\r\n */\r\nexport async function updateRisk(id: string | number, data: UpdateRiskRequest): Promise<Risk> {\r\n  const response = await http.put<{ risk: Risk }>(`/api/risks/${id}`, data);\r\n  return response.data.risk;\r\n}\r\n\r\n/**\r\n * Delete a risk\r\n */\r\nexport async function deleteRisk(id: string | number): Promise<void> {\r\n  await http.delete(`/api/risks/${id}`);\r\n}\r\n\r\n/**\r\n * Calculate risk score (impact x likelihood)\r\n */\r\nexport function calculateRiskScore(impact: string, likelihood: string): number {\r\n  const impactScores: Record<string, number> = { low: 1, medium: 2, high: 3, critical: 4 };\r\n  const likelihoodScores: Record<string, number> = { low: 1, medium: 2, high: 3 };\r\n  return (impactScores[impact] || 2) * (likelihoodScores[likelihood] || 2);\r\n}\r\n\r\n/**\r\n * AI suggest owner and mitigation from risk content\r\n */\r\nexport interface RiskOwnerSuggestion {\r\n  name: string;\r\n  reason: string;\r\n  score?: number;\r\n}\r\n\r\nexport async function suggestRisk(options: { content: string; impact?: string; likelihood?: string; probability?: string }): Promise<{\r\n  suggested_owner: string;\r\n  suggested_mitigation: string;\r\n  suggested_owners: RiskOwnerSuggestion[];\r\n}> {\r\n  const response = await http.post<{\r\n    suggested_owner?: string;\r\n    suggested_mitigation?: string;\r\n    suggested_owners?: RiskOwnerSuggestion[];\r\n    error?: string;\r\n  }>('/api/risks/suggest', {\r\n    content: options.content?.trim() || '',\r\n    impact: options.impact || 'medium',\r\n    likelihood: options.likelihood ?? options.probability ?? 'medium',\r\n  });\r\n  if (response.data.error) throw new Error(response.data.error);\r\n  const owners = Array.isArray(response.data.suggested_owners) ? response.data.suggested_owners : [];\r\n  return {\r\n    suggested_owner: response.data.suggested_owner ?? (owners[0]?.name ?? ''),\r\n    suggested_mitigation: response.data.suggested_mitigation ?? '',\r\n    suggested_owners: owners,\r\n  };\r\n}\r\n\r\n/**\r\n * Get risk matrix data\r\n */\r\nexport function getRiskMatrixData(risks: Risk[]): Record<string, Risk[]> {\r\n  const matrix: Record<string, Risk[]> = {};\r\n  \r\n  risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed').forEach(risk => {\r\n    const impact = (risk.impact || '').toString().toLowerCase();\r\n    const likelihood = (risk.likelihood || '').toString().toLowerCase();\r\n    const key = `${impact}-${likelihood}`;\r\n    if (!matrix[key]) matrix[key] = [];\r\n    matrix[key].push(risk);\r\n  });\r\n  \r\n  return matrix;\r\n}\r\n\r\nexport const risksService = {\r\n  getAll: getRisks,\r\n  get: getRisk,\r\n  getByCategory: getRisksByCategory,\r\n  getDeleted: getDeletedRisks,\r\n  restore: restoreRisk,\r\n  getEvents: getRiskEvents,\r\n  suggest: suggestRisk,\r\n  create: createRisk,\r\n  update: updateRisk,\r\n  delete: deleteRisk,\r\n  calculateScore: calculateRiskScore,\r\n  getMatrixData: getRiskMatrixData,\r\n};\r\n","/**\n * Actions Service\n * Handles action item CRUD operations\n */\n\nimport { http } from './api';\n\n/** API returns task, owner, deadline (action_items table). We expose content, assignee, due_date for UI. DevOps Sprint Board fields included. */\nexport interface Action {\n  id: string | number;\n  /** UI: use content; API may return task (title of the task - concrete action) */\n  content?: string;\n  task?: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  /** UI: use assignee; API may return owner */\n  assignee?: string;\n  owner?: string;\n  /** UI: use due_date; API may return deadline */\n  due_date?: string;\n  deadline?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  source_file?: string;\n  source_document_id?: string;\n  depends_on?: string[];\n  blocked_by?: string[];\n  created_at: string;\n  updated_at?: string;\n  completed_at?: string;\n  /** Parent User Story reference e.g. US-102 */\n  parent_story_ref?: string;\n  /** Parent User Story UUID (from user_stories table) */\n  parent_story_id?: string;\n  /** Estimate e.g. 1 day, 8h (max 8h per task) */\n  size_estimate?: string;\n  /** Technical description / implementation notes */\n  description?: string;\n  /** Definition of Done checklist (strings or { text, done } for checkmarks) */\n  definition_of_done?: (string | { text: string; done?: boolean })[];\n  /** Acceptance criteria checklist */\n  acceptance_criteria?: string[];\n  /** How the action was created: extracted, quick_capture, manual, import, sprint_generated */\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import' | 'sprint_generated';\n  source_email_id?: string;\n  source_type?: 'transcript' | 'email' | 'manual';\n  requested_by?: string;\n  requested_by_contact_id?: string;\n  supporting_document_ids?: string[];\n  /** Sprint this task belongs to */\n  sprint_id?: string;\n  sprint_name?: string;\n  /** Optional task points for velocity/breakdown */\n  task_points?: number;\n  /** Optional decision this task implements / is driven by */\n  decision_id?: string | null;\n}\n\nexport interface CreateActionRequest {\n  content: string;\n  status?: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  assignee?: string;\n  due_date?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  parent_story_ref?: string;\n  parent_story_id?: string;\n  size_estimate?: string;\n  description?: string;\n  definition_of_done?: string[];\n  acceptance_criteria?: string[];\n  depends_on?: string[];\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\n  source_document_id?: string;\n  source_email_id?: string;\n  source_type?: 'transcript' | 'email' | 'manual';\n  requested_by?: string;\n  requested_by_contact_id?: string;\n  supporting_document_ids?: string[];\n  sprint_id?: string;\n  task_points?: number;\n  decision_id?: string | null;\n}\n\nexport interface UpdateActionRequest {\n  content?: string;\n  task?: string;\n  status?: 'pending' | 'in_progress' | 'completed' | 'cancelled';\n  assignee?: string;\n  owner?: string;\n  due_date?: string;\n  deadline?: string;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n  depends_on?: string[];\n  blocked_by?: string[];\n  parent_story_ref?: string;\n  parent_story_id?: string;\n  size_estimate?: string;\n  description?: string;\n  definition_of_done?: (string | { text: string; done?: boolean })[];\n  acceptance_criteria?: string[];\n  source_email_id?: string;\n  source_type?: 'transcript' | 'email' | 'manual';\n  requested_by?: string;\n  requested_by_contact_id?: string;\n  supporting_document_ids?: string[];\n  sprint_id?: string;\n  task_points?: number;\n  decision_id?: string | null;\n  /** Backend: emit refined_with_ai event and store snapshot for rollback */\n  refined_with_ai?: boolean;\n  /** Backend: restore action from a previous snapshot (e.g. from timeline) */\n  restore_snapshot?: { content?: string; task?: string; description?: string; definition_of_done?: (string | { text: string; done?: boolean })[]; acceptance_criteria?: string[]; size_estimate?: string };\n}\n\n/** Normalize API row (task, owner, deadline) to UI shape (content, assignee, due_date); preserve sprint board fields */\nfunction normalizeAction(row: Record<string, unknown>): Action {\n  return {\n    ...row,\n    content: (row.content ?? row.task) as string,\n    assignee: (row.assignee ?? row.owner) as string | undefined,\n    due_date: (row.due_date ?? row.deadline) as string | undefined,\n    definition_of_done: Array.isArray(row.definition_of_done) ? row.definition_of_done as (string | { text: string; done?: boolean })[] : [],\n    acceptance_criteria: Array.isArray(row.acceptance_criteria) ? row.acceptance_criteria as string[] : [],\n    depends_on: Array.isArray(row.depends_on) ? row.depends_on as string[] : [],\n    sprint_id: row.sprint_id as string | undefined,\n    sprint_name: (row.sprint_name ?? (row.sprints as { name?: string })?.name ?? (row.sprint as { name?: string })?.name) as string | undefined,\n  } as Action;\n}\n\n/**\n * Get all actions (optionally filter by status, sprint, or decision)\n */\nexport async function getActions(status?: string, sprintId?: string, decisionId?: string | null): Promise<Action[]> {\n  try {\n    const params = new URLSearchParams();\n    if (status) params.set('status', status);\n    if (sprintId) params.set('sprint_id', sprintId);\n    if (decisionId) params.set('decision_id', decisionId);\n    const q = params.toString();\n    const url = q ? `/api/actions?${q}` : '/api/actions';\n    const response = await http.get<{ actions: Record<string, unknown>[] }>(url);\n    const raw = response.data.actions || [];\n    return raw.map(normalizeAction);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Create a new action\n */\nexport async function createAction(data: CreateActionRequest): Promise<Action> {\n  const payload = {\n    content: data.content,\n    task: data.content,\n    assignee: data.assignee,\n    owner: data.assignee,\n    due_date: data.due_date,\n    deadline: data.due_date,\n    status: data.status,\n    priority: data.priority,\n    parent_story_ref: data.parent_story_ref,\n    parent_story_id: data.parent_story_id,\n    size_estimate: data.size_estimate,\n    description: data.description,\n    definition_of_done: data.definition_of_done,\n    acceptance_criteria: data.acceptance_criteria,\n    depends_on: data.depends_on,\n    generation_source: data.generation_source,\n    source_document_id: data.source_document_id,\n    source_email_id: data.source_email_id,\n    source_type: data.source_type,\n    requested_by: data.requested_by,\n    requested_by_contact_id: data.requested_by_contact_id,\n    supporting_document_ids: data.supporting_document_ids,\n    sprint_id: data.sprint_id,\n    task_points: data.task_points,\n    decision_id: data.decision_id ?? null,\n  };\n  const response = await http.post<{ action: Record<string, unknown>; id: string | number }>('/api/actions', payload);\n  const raw = response.data.action || { ...payload, id: response.data.id, created_at: new Date().toISOString() };\n  return normalizeAction(raw);\n}\n\n/**\n * Update an action\n */\nexport async function updateAction(id: string | number, data: UpdateActionRequest): Promise<Action> {\n  const payload: Record<string, unknown> = {\n    task: data.content ?? data.task,\n    owner: data.assignee ?? data.owner,\n    deadline: data.due_date ?? data.deadline,\n    parent_story_ref: data.parent_story_ref,\n    parent_story_id: data.parent_story_id,\n    size_estimate: data.size_estimate,\n    description: data.description,\n    definition_of_done: data.definition_of_done,\n    acceptance_criteria: data.acceptance_criteria,\n    depends_on: data.depends_on,\n    sprint_id: data.sprint_id,\n    task_points: data.task_points,\n    status: data.status,\n    priority: data.priority,\n    decision_id: data.decision_id !== undefined ? data.decision_id : undefined,\n  };\n  if (data.refined_with_ai === true) payload.refined_with_ai = true;\n  if (data.restore_snapshot != null) payload.restore_snapshot = data.restore_snapshot;\n  const response = await http.put<{ action: Record<string, unknown> }>(`/api/actions/${id}`, payload);\n  const raw = response.data.action;\n  return raw ? normalizeAction(raw) : {} as Action;\n}\n\n/**\n * Delete an action\n */\nexport async function deleteAction(id: string | number): Promise<void> {\n  await http.delete(`/api/actions/${id}`);\n}\n\n/**\n * List soft-deleted actions (for restore)\n */\nexport async function getDeletedActions(): Promise<Action[]> {\n  try {\n    const response = await http.get<{ actions: Record<string, unknown>[] }>('/api/actions/deleted');\n    const raw = response.data.actions || [];\n    return raw.map(normalizeAction);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Restore a soft-deleted action (syncs back to graph)\n */\nexport async function restoreAction(id: string | number): Promise<Action> {\n  const response = await http.post<{ action: Record<string, unknown> }>(`/api/actions/${id}/restore`, {});\n  return normalizeAction(response.data.action || {});\n}\n\nexport interface ActionEvent {\n  id: string;\n  action_id: string;\n  event_type: string;\n  event_data?: Record<string, unknown>;\n  actor_name?: string;\n  created_at: string;\n}\n\nexport interface ActionAssigneeSuggestion {\n  name: string;\n  reason?: string;\n  score?: number;\n}\n\n/**\n * Suggest assignees for an action from task content (AI + project contacts).\n */\nexport async function suggestAssignees(options: { content: string }): Promise<{ suggested_assignees: ActionAssigneeSuggestion[] }> {\n  try {\n    const response = await http.post<{ suggested_assignees: ActionAssigneeSuggestion[] }>('/api/actions/suggest', {\n      content: (options.content || '').trim(),\n    });\n    return {\n      suggested_assignees: Array.isArray(response.data.suggested_assignees) ? response.data.suggested_assignees : [],\n    };\n  } catch {\n    return { suggested_assignees: [] };\n  }\n}\n\nexport interface SuggestTaskResult {\n  task: string;\n  description: string;\n  size_estimate: string;\n  definition_of_done: string[];\n  acceptance_criteria: string[];\n}\n\n/**\n * Generate full task structure from a short description (AI using Sprint Board prompt from Admin).\n */\nexport async function suggestTaskFromDescription(options: {\n  user_input: string;\n  parent_story_ref?: string;\n}): Promise<SuggestTaskResult> {\n  const response = await http.post<SuggestTaskResult>('/api/actions/suggest-task', {\n    user_input: (options.user_input || '').trim(),\n    parent_story_ref: options.parent_story_ref || '',\n  });\n  return {\n    task: response.data.task || '',\n    description: response.data.description || '',\n    size_estimate: response.data.size_estimate || '1 day',\n    definition_of_done: Array.isArray(response.data.definition_of_done) ? response.data.definition_of_done : [],\n    acceptance_criteria: Array.isArray(response.data.acceptance_criteria) ? response.data.acceptance_criteria : [],\n  };\n}\n\n/**\n * Get action timeline events\n */\nexport async function getActionEvents(id: string | number): Promise<ActionEvent[]> {\n  try {\n    const response = await http.get<{ events: ActionEvent[] }>(`/api/actions/${id}/events`);\n    return response.data.events || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Check if action is overdue\n */\nexport function isOverdue(action: Action): boolean {\n  if (!action.due_date || action.status === 'completed' || action.status === 'cancelled') {\n    return false;\n  }\n  return new Date(action.due_date) < new Date();\n}\n\n/**\n * Get action statistics\n */\nexport function getActionStats(actions: Action[]): {\n  total: number;\n  pending: number;\n  inProgress: number;\n  completed: number;\n  overdue: number;\n} {\n  return {\n    total: actions.length,\n    pending: actions.filter(a => a.status === 'pending').length,\n    inProgress: actions.filter(a => a.status === 'in_progress').length,\n    completed: actions.filter(a => a.status === 'completed').length,\n    overdue: actions.filter(a => isOverdue(a)).length,\n  };\n}\n\nexport interface BySprintEntry {\n  count: number;\n  name: string;\n}\n\n/**\n * Get actions report (by_status, by_assignee, by_sprint)\n */\nexport async function getActionsReport(): Promise<{\n  by_status: Record<string, number>;\n  by_assignee: Record<string, number>;\n  by_sprint: Record<string, BySprintEntry>;\n}> {\n  try {\n    const response = await http.get<{\n      by_status: Record<string, number>;\n      by_assignee: Record<string, number>;\n      by_sprint: Record<string, BySprintEntry>;\n    }>('/api/actions/report');\n    return {\n      by_status: response.data?.by_status || {},\n      by_assignee: response.data?.by_assignee || {},\n      by_sprint: response.data?.by_sprint || {},\n    };\n  } catch {\n    return { by_status: {}, by_assignee: {}, by_sprint: {} };\n  }\n}\n\n/**\n * Get semantically similar actions (requires embeddings)\n */\nexport async function getSimilarActions(id: string | number): Promise<Action[]> {\n  try {\n    const response = await http.get<{ similar: Action[] }>(`/api/actions/${id}/similar`);\n    return response.data?.similar || [];\n  } catch {\n    return [];\n  }\n}\n\nexport interface UserStory {\n  id: string;\n  title: string;\n  description?: string;\n  status?: string;\n  acceptance_criteria?: string[];\n  created_at?: string;\n  story_points?: number;\n}\n\nexport async function getUserStories(status?: string): Promise<UserStory[]> {\n  try {\n    const url = status ? `/api/user-stories?status=${status}` : '/api/user-stories';\n    const response = await http.get<{ user_stories: UserStory[] }>(url);\n    return response.data.user_stories || [];\n  } catch {\n    return [];\n  }\n}\n\nexport async function addUserStory(data: { title: string; description?: string; status?: string; story_points?: number }): Promise<UserStory> {\n  const response = await http.post<{ user_story: UserStory; id: string }>('/api/user-stories', data);\n  return response.data.user_story || { id: response.data.id, title: data.title, ...data };\n}\n\nexport async function getUserStory(id: string): Promise<UserStory | null> {\n  try {\n    const response = await http.get<{ user_story: UserStory }>(`/api/user-stories/${id}`);\n    return response.data?.user_story ?? null;\n  } catch {\n    return null;\n  }\n}\n\nexport async function updateUserStory(\n  id: string,\n  data: { title?: string; description?: string; status?: string; story_points?: number | null; acceptance_criteria?: string[] }\n): Promise<UserStory> {\n  const response = await http.put<{ user_story: UserStory }>(`/api/user-stories/${id}`, data);\n  return response.data.user_story;\n}\n\nexport const actionsService = {\n  getAll: getActions,\n  create: createAction,\n  update: updateAction,\n  delete: deleteAction,\n  getDeletedActions,\n  restoreAction,\n  getEvents: getActionEvents,\n  suggest: suggestAssignees,\n  suggestTaskFromDescription,\n  getUserStories,\n  getUserStory,\n  addUserStory,\n  updateUserStory,\n  isOverdue,\n  getStats: getActionStats,\n  getReport: getActionsReport,\n  getSimilar: getSimilarActions,\n};\n","/**\r\n * Decisions Service\r\n * Handles decision CRUD operations\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Decision {\r\n  id: string | number;\r\n  content: string;\r\n  status: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\r\n  rationale?: string;\r\n  made_by?: string;\r\n  approved_by?: string;\r\n  decided_at?: string;\r\n  impact?: 'low' | 'medium' | 'high';\r\n  reversible?: boolean;\r\n  source?: string;\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  owner?: string;\r\n  context?: string;\r\n  decision_date?: string;\r\n  generation_source?: 'extracted' | 'quick_capture' | 'manual' | 'import';\r\n  created_at: string;\r\n  updated_at?: string;\r\n  summary?: string;\r\n}\r\n\r\nexport interface DecisionSuggestResponse {\r\n  rationale: string;\r\n  impact: 'high' | 'medium' | 'low';\r\n  impact_summary: string;\r\n  summary: string;\r\n}\r\n\r\nexport interface DecisionOwnerSuggestion {\r\n  name: string;\r\n  reason?: string;\r\n  score?: number;\r\n}\r\n\r\nexport interface DecisionEvent {\r\n  id: string;\r\n  decision_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_user_id?: string;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\nexport interface DecisionConflict {\r\n  decisionId1: string | number;\r\n  decisionId2: string | number;\r\n  decision1: Decision;\r\n  decision2: Decision;\r\n  conflictType: string;\r\n  description?: string;\r\n  reason?: string;\r\n  confidence?: number;\r\n}\r\n\r\nexport interface SimilarDecisionItem {\r\n  decision: Decision;\r\n  similarityScore: number;\r\n}\r\n\r\nexport interface CreateDecisionRequest {\r\n  content: string;\r\n  status?: 'proposed' | 'approved' | 'rejected' | 'deferred';\r\n  rationale?: string;\r\n  made_by?: string;\r\n  impact?: 'low' | 'medium' | 'high';\r\n  summary?: string;\r\n}\r\n\r\nexport interface UpdateDecisionRequest {\r\n  content?: string;\r\n  status?: 'proposed' | 'approved' | 'rejected' | 'deferred' | 'active' | 'superseded' | 'revoked';\r\n  rationale?: string;\r\n  made_by?: string;\r\n  approved_by?: string;\r\n  decided_at?: string;\r\n  impact?: 'low' | 'medium' | 'high';\r\n  reversible?: boolean;\r\n  summary?: string;\r\n}\r\n\r\n/**\r\n * Get all decisions\r\n */\r\nexport async function getDecisions(status?: string): Promise<Decision[]> {\r\n  try {\r\n    const url = status ? `/api/decisions?status=${status}` : '/api/decisions';\r\n    const response = await http.get<{ decisions: Decision[] }>(url);\r\n    return response.data.decisions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single decision\r\n */\r\nexport async function getDecision(id: string | number): Promise<Decision | null> {\r\n  try {\r\n    const response = await http.get<{ decision: Decision }>(`/api/decisions/${id}`);\r\n    return response.data.decision;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * List soft-deleted decisions (for restore / undo)\r\n */\r\nexport async function getDeletedDecisions(): Promise<Decision[]> {\r\n  try {\r\n    const response = await http.get<{ decisions: Decision[] }>('/api/decisions/deleted');\r\n    return response.data.decisions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted decision\r\n */\r\nexport async function restoreDecision(id: string | number): Promise<Decision> {\r\n  const response = await http.post<{ decision: Decision }>(`/api/decisions/${id}/restore`, {});\r\n  return response.data.decision;\r\n}\r\n\r\n/**\r\n * Get decision events (timeline)\r\n */\r\nexport async function getDecisionEvents(decisionId: string | number): Promise<DecisionEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: DecisionEvent[] }>(`/api/decisions/${decisionId}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get similar decisions\r\n */\r\nexport async function getSimilarDecisions(decisionId: string | number, limit = 10): Promise<SimilarDecisionItem[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (limit !== 10) params.set('limit', String(limit));\r\n    const query = params.toString();\r\n    const url = query ? `/api/decisions/${decisionId}/similar?${query}` : `/api/decisions/${decisionId}/similar`;\r\n    const response = await http.get<{ similar: SimilarDecisionItem[] }>(url);\r\n    return response.data.similar || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Run decision-check (AI conflict detection, records events)\r\n */\r\nexport async function runDecisionCheck(): Promise<{ ok: boolean; conflicts: DecisionConflict[]; analyzed_decisions: number; events_recorded: number }> {\r\n  const response = await http.post<{ ok: boolean; conflicts: DecisionConflict[]; analyzed_decisions: number; events_recorded: number }>('/api/decision-check/run', {});\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Detect conflicts between decisions (no events recorded)\r\n */\r\nexport async function detectConflicts(): Promise<DecisionConflict[]> {\r\n  try {\r\n    const response = await http.get<{ conflicts: DecisionConflict[] }>('/api/conflicts/decisions');\r\n    return response.data.conflicts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * AI suggest: rationale, impact, impact_summary, one-line summary from decision content\r\n */\r\nexport async function suggest(content: string, rationale?: string): Promise<DecisionSuggestResponse> {\r\n  const response = await http.post<DecisionSuggestResponse>('/api/decisions/suggest', {\r\n    content: content.trim(),\r\n    rationale: rationale?.trim() || '',\r\n  });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * AI suggest owner (made_by) from decision content; backend uses project contacts only.\r\n */\r\nexport async function suggestOwner(content: string, rationale?: string): Promise<{ suggested_owners: DecisionOwnerSuggestion[] }> {\r\n  const response = await http.post<{ suggested_owners: DecisionOwnerSuggestion[] }>('/api/decisions/suggest-owner', {\r\n    content: content.trim(),\r\n    rationale: rationale?.trim() || '',\r\n  });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Create a new decision\r\n */\r\nexport async function createDecision(data: CreateDecisionRequest): Promise<Decision> {\r\n  const response = await http.post<{ decision: Decision; id: string | number }>('/api/decisions', data);\r\n  return response.data.decision || { ...data, id: response.data.id, status: data.status || 'proposed', created_at: new Date().toISOString() } as Decision;\r\n}\r\n\r\n/**\r\n * Update a decision\r\n */\r\nexport async function updateDecision(id: string | number, data: UpdateDecisionRequest): Promise<Decision> {\r\n  const response = await http.put<{ decision: Decision }>(`/api/decisions/${id}`, data);\r\n  return response.data.decision;\r\n}\r\n\r\n/**\r\n * Delete a decision\r\n */\r\nexport async function deleteDecision(id: string | number): Promise<void> {\r\n  await http.delete(`/api/decisions/${id}`);\r\n}\r\n\r\n/**\r\n * Approve a decision\r\n */\r\nexport async function approveDecision(id: string | number, approvedBy: string): Promise<Decision> {\r\n  return updateDecision(id, {\r\n    status: 'approved',\r\n    approved_by: approvedBy,\r\n    decided_at: new Date().toISOString(),\r\n  });\r\n}\r\n\r\n/**\r\n * Reject a decision\r\n */\r\nexport async function rejectDecision(id: string | number, rationale?: string): Promise<Decision> {\r\n  return updateDecision(id, {\r\n    status: 'rejected',\r\n    rationale,\r\n    decided_at: new Date().toISOString(),\r\n  });\r\n}\r\n\r\nexport const decisionsService = {\r\n  getAll: getDecisions,\r\n  get: getDecision,\r\n  create: createDecision,\r\n  update: updateDecision,\r\n  delete: deleteDecision,\r\n  approve: approveDecision,\r\n  reject: rejectDecision,\r\n  getDeletedDecisions,\r\n  restore: restoreDecision,\r\n  getEvents: getDecisionEvents,\r\n  getSimilarDecisions,\r\n  runDecisionCheck,\r\n  detectConflicts,\r\n  suggest,\r\n  suggestOwner,\r\n};\r\n","/**\r\n * Chat Service\r\n * Handles chat and AI interactions\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface ChatMessage {\r\n  id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  timestamp: string;\r\n  sources?: ChatSource[];\r\n  contextQuality?: 'high' | 'medium' | 'low' | 'none';\r\n}\r\n\r\nexport interface ChatSource {\r\n  type: 'fact' | 'document' | 'question' | 'decision';\r\n  id: string | number;\r\n  title?: string;\r\n  excerpt?: string;\r\n}\r\n\r\nexport interface ChatRequest {\r\n  message: string;\r\n  context?: string;\r\n  history?: Array<{ role: string; content: string }>;\r\n  semantic?: boolean;\r\n  deepReasoning?: boolean;\r\n}\r\n\r\nexport interface ChatResponse {\r\n  message: string;\r\n  response: string;\r\n  sources: ChatSource[];\r\n  contextQuality: 'high' | 'medium' | 'low' | 'none';\r\n}\r\n\r\nexport interface AskRequest {\r\n  question: string;\r\n  model?: string;\r\n}\r\n\r\nexport interface AskResponse {\r\n  question: string;\r\n  answer: string;\r\n  sources: {\r\n    facts: number;\r\n    questions: number;\r\n    decisions: number;\r\n    knowledgeItems: number;\r\n  };\r\n}\r\n\r\nexport interface SotChatRequest {\r\n  message: string;\r\n  model?: string;\r\n}\r\n\r\nexport interface SotChatResponse {\r\n  response: string;\r\n  model: string;\r\n  healthScore: number;\r\n}\r\n\r\nexport interface BriefingResponse {\r\n  briefing: string;\r\n  analysis: string;\r\n  generated_at: string;\r\n  stats: Record<string, number>;\r\n  cached: boolean;\r\n  cacheSource?: 'supabase' | 'memory';\r\n}\r\n\r\nexport interface BriefingHistoryItem {\r\n  id: string;\r\n  briefing: string;\r\n  generated_at: string;\r\n}\r\n\r\n// Type alias for backwards compatibility\r\nexport type Briefing = BriefingResponse;\r\n\r\n// Chat history for context\r\nlet chatHistory: ChatMessage[] = [];\r\n\r\n/**\r\n * Send a chat message\r\n */\r\nexport async function sendMessage(request: ChatRequest): Promise<ChatResponse> {\r\n  const response = await http.post<ChatResponse>('/api/chat', {\r\n    message: request.message,\r\n    context: request.context,\r\n    history: request.history || chatHistory.slice(-10).map(m => ({\r\n      role: m.role,\r\n      content: m.content,\r\n    })),\r\n    semantic: request.semantic ?? true,\r\n    deepReasoning: request.deepReasoning ?? false,\r\n  });\r\n\r\n  // Add to history\r\n  const userMessage: ChatMessage = {\r\n    id: `msg-${Date.now()}-user`,\r\n    role: 'user',\r\n    content: request.message,\r\n    timestamp: new Date().toISOString(),\r\n  };\r\n\r\n  const assistantMessage: ChatMessage = {\r\n    id: `msg-${Date.now()}-assistant`,\r\n    role: 'assistant',\r\n    content: response.data.response,\r\n    timestamp: new Date().toISOString(),\r\n    sources: response.data.sources,\r\n    contextQuality: response.data.contextQuality,\r\n  };\r\n\r\n  chatHistory.push(userMessage, assistantMessage);\r\n\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Ask a question about the knowledge base\r\n */\r\nexport async function ask(request: AskRequest): Promise<AskResponse> {\r\n  const response = await http.post<AskResponse>('/api/ask', request);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Chat with SOT context\r\n */\r\nexport async function sotChat(request: SotChatRequest): Promise<SotChatResponse> {\r\n  const response = await http.post<SotChatResponse>('/api/sot/chat', request);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get daily briefing\r\n */\r\nexport async function getBriefing(refresh = false): Promise<BriefingResponse> {\r\n  const url = refresh ? '/api/briefing?refresh=true' : '/api/briefing';\r\n  const response = await http.get<BriefingResponse>(url);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get briefing history\r\n */\r\nexport async function getBriefingHistory(limit = 30): Promise<BriefingHistoryItem[]> {\r\n  const response = await http.get<{ history: BriefingHistoryItem[]; total: number }>(`/api/briefing/history?limit=${limit}`);\r\n  return response.data.history || [];\r\n}\r\n\r\n/**\r\n * Get weekly report\r\n */\r\nexport async function getWeeklyReport(): Promise<string> {\r\n  const response = await http.get<string>('/api/reports/weekly');\r\n  return typeof response.data === 'string' ? response.data : '';\r\n}\r\n\r\n/**\r\n * Generate executive summary\r\n */\r\nexport async function generateExecutiveSummary(): Promise<string> {\r\n  const response = await http.post<{ summary: string }>('/api/sot/executive-summary');\r\n  return response.data.summary || '';\r\n}\r\n\r\n/**\r\n * Get chat history\r\n */\r\nexport function getChatHistory(): ChatMessage[] {\r\n  return [...chatHistory];\r\n}\r\n\r\n/**\r\n * Clear chat history\r\n */\r\nexport function clearChatHistory(): void {\r\n  chatHistory = [];\r\n}\r\n\r\n/**\r\n * Add message to history\r\n */\r\nexport function addToHistory(message: ChatMessage): void {\r\n  chatHistory.push(message);\r\n}\r\n\r\nexport const chatService = {\r\n  send: sendMessage,\r\n  ask,\r\n  sotChat,\r\n  getBriefing,\r\n  getBriefingHistory,\r\n  getWeeklyReport,\r\n  generateExecutiveSummary,\r\n  getHistory: getChatHistory,\r\n  clearHistory: clearChatHistory,\r\n  addToHistory,\r\n};\r\n","/**\r\n * Contacts Service\r\n * Handles contact and team CRUD operations\r\n */\r\n\r\nimport { http, fetchWithProject } from './api';\r\n\r\nexport interface Contact {\r\n  id: string;\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  organization?: string;\r\n  company?: string;\r\n  role?: string;\r\n  rolePrompt?: string;\r\n  department?: string;\r\n  linkedin?: string;\r\n  timezone?: string;\r\n  location?: string;\r\n  photoUrl?: string;\r\n  avatarUrl?: string;\r\n  photo_url?: string;\r\n  avatar_url?: string;\r\n  tags?: string[];\r\n  notes?: string;\r\n  aliases?: string[];\r\n  isFavorite?: boolean;\r\n  is_favorite?: boolean;\r\n  relationships?: Array<{\r\n    contactId: string;\r\n    type: 'reports_to' | 'works_with' | 'manages' | 'collaborates';\r\n  }>;\r\n  activity?: Array<{\r\n    type: 'conversation' | 'document' | 'transcript';\r\n    id: string;\r\n    title: string;\r\n    date: string;\r\n  }>;\r\n  teams?: Array<{\r\n    id: string;\r\n    name: string;\r\n    color: string;\r\n  }>;\r\n  created_at: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface Team {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  color?: string;\r\n  team_type?: 'team' | 'department' | 'organization' | 'group';\r\n  memberCount?: number;\r\n  memberDetails?: Array<{\r\n    contactId: string;\r\n    name: string;\r\n    role: string;\r\n    isLead: boolean;\r\n  }>;\r\n  created_at: string;\r\n}\r\n\r\nexport interface CreateContactRequest {\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  organization?: string;\r\n  role?: string;\r\n  department?: string;\r\n  tags?: string[];\r\n  notes?: string;\r\n}\r\n\r\nexport interface UpdateContactRequest {\r\n  name?: string;\r\n  email?: string;\r\n  phone?: string;\r\n  organization?: string;\r\n  role?: string;\r\n  rolePrompt?: string;\r\n  department?: string;\r\n  linkedin?: string;\r\n  timezone?: string;\r\n  photoUrl?: string;\r\n  tags?: string[];\r\n  notes?: string;\r\n  aliases?: string[];\r\n}\r\n\r\nexport interface CreateTeamRequest {\r\n  name: string;\r\n  description?: string;\r\n  color?: string;\r\n  team_type?: 'team' | 'department' | 'organization' | 'group';\r\n}\r\n\r\n/**\r\n * Get all contacts\r\n */\r\nexport async function getContacts(filters?: {\r\n  organization?: string;\r\n  tag?: string;\r\n  search?: string;\r\n}): Promise<{ contacts: Contact[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (filters?.organization) params.set('organization', filters.organization);\r\n    if (filters?.tag) params.set('tag', filters.tag);\r\n    if (filters?.search) params.set('search', filters.search);\r\n    \r\n    const query = params.toString();\r\n    const url = query ? `/api/contacts?${query}` : '/api/contacts';\r\n    \r\n    const response = await http.get<{ contacts: Contact[]; total: number }>(url);\r\n    const rawContacts = response.data.contacts || [];\r\n    \r\n    // Normalize field names (API uses snake_case, frontend uses camelCase)\r\n    const contacts = rawContacts.map(c => ({\r\n      ...c,\r\n      photoUrl: c.photo_url || c.avatar_url || c.photoUrl || c.avatarUrl,\r\n      avatarUrl: c.avatar_url || c.photo_url || c.avatarUrl || c.photoUrl,\r\n      isFavorite: c.is_favorite ?? c.isFavorite ?? false,\r\n      company: c.organization || c.company,\r\n    }));\r\n    \r\n    return { contacts, total: response.data.total || contacts.length };\r\n  } catch (error) {\r\n    console.error('[ContactsService] Failed to get contacts:', error);\r\n    return { contacts: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single contact\r\n */\r\nexport async function getContact(id: string): Promise<Contact | null> {\r\n  try {\r\n    const response = await http.get<{ contact: Contact }>(`/api/contacts/${id}`);\r\n    return response.data.contact;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new contact\r\n */\r\nexport async function createContact(data: CreateContactRequest): Promise<Contact> {\r\n  const response = await http.post<{ id: string; ok: boolean }>('/api/contacts', data);\r\n  return { ...data, id: response.data.id, created_at: new Date().toISOString() } as Contact;\r\n}\r\n\r\n/**\r\n * Update a contact\r\n */\r\nexport async function updateContact(id: string, data: UpdateContactRequest): Promise<void> {\r\n  await http.put(`/api/contacts/${id}`, data);\r\n}\r\n\r\n/**\r\n * Delete a contact\r\n */\r\nexport async function deleteContact(id: string): Promise<void> {\r\n  await http.delete(`/api/contacts/${id}`);\r\n}\r\n\r\n/**\r\n * Get contact stats\r\n */\r\nexport async function getContactStats(): Promise<Record<string, number>> {\r\n  const response = await http.get<{ ok: boolean } & Record<string, number>>('/api/contacts/stats');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Find contact by name\r\n */\r\nexport async function findContactByName(name: string): Promise<Contact | null> {\r\n  try {\r\n    const response = await http.get<{ found: boolean; contact: Contact | null }>(`/api/contacts/find-by-name?name=${encodeURIComponent(name)}`);\r\n    return response.data.found ? response.data.contact : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get duplicate contacts\r\n */\r\nexport async function getDuplicates(): Promise<{ duplicates: Contact[][]; groups: number }> {\r\n  const response = await http.get<{ duplicates: Contact[][]; groups: number }>('/api/contacts/duplicates');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Merge contacts\r\n */\r\nexport async function mergeContacts(contactIds: string[]): Promise<string> {\r\n  const response = await http.post<{ mergedId: string }>('/api/contacts/merge', { contactIds });\r\n  return response.data.mergedId;\r\n}\r\n\r\n/**\r\n * Enrich contact with AI\r\n */\r\nexport async function enrichContact(id: string): Promise<{\r\n  role?: string;\r\n  department?: string;\r\n  tags?: string[];\r\n  additionalNotes?: string;\r\n}> {\r\n  const response = await http.post<{ suggestions: Record<string, unknown> }>(`/api/contacts/${id}/enrich`);\r\n  return response.data.suggestions as {\r\n    role?: string;\r\n    department?: string;\r\n    tags?: string[];\r\n    additionalNotes?: string;\r\n  };\r\n}\r\n\r\n/**\r\n * Export contacts in specified format\r\n */\r\nexport async function exportContacts(format: 'json' | 'csv' = 'json'): Promise<void> {\r\n  try {\r\n    const response = await fetchWithProject(`/api/contacts/export?format=${format}`);\r\n    if (!response.ok) throw new Error('Export failed');\r\n    \r\n    const blob = await response.blob();\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `contacts-export.${format}`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n  } catch (error) {\r\n    console.error('Export failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Get contact with all associations (teams, projects)\r\n */\r\nexport async function getContactWithAssociations(id: string): Promise<Contact & {\r\n  projects?: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }>;\r\n} | null> {\r\n  try {\r\n    const response = await http.get<{ \r\n      contact: Contact & { \r\n        projects?: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }> \r\n      } \r\n    }>(`/api/contacts/${id}/associations`);\r\n    return response.data.contact;\r\n  } catch {\r\n    // Fallback to regular get if associations endpoint not available\r\n    return getContact(id);\r\n  }\r\n}\r\n\r\n/**\r\n * Add contact to a project\r\n */\r\nexport async function addContactToProject(contactId: string, projectId: string, options?: {\r\n  role?: string;\r\n  isPrimary?: boolean;\r\n}): Promise<void> {\r\n  await http.post(`/api/contacts/${contactId}/projects`, { projectId, ...options });\r\n}\r\n\r\n/**\r\n * Remove contact from a project\r\n */\r\nexport async function removeContactFromProject(contactId: string, projectId: string): Promise<void> {\r\n  await http.delete(`/api/contacts/${contactId}/projects/${projectId}`);\r\n}\r\n\r\n/**\r\n * Get projects a contact belongs to\r\n */\r\nexport async function getContactProjects(contactId: string): Promise<Array<{\r\n  id: string;\r\n  name: string;\r\n  role?: string;\r\n  isPrimary?: boolean;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{ projects: Array<{ id: string; name: string; role?: string; isPrimary?: boolean }> }>(\r\n      `/api/contacts/${contactId}/projects`\r\n    );\r\n    return response.data.projects || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get all teams\r\n */\r\nexport async function getTeams(): Promise<Team[]> {\r\n  try {\r\n    const response = await http.get<{ teams: Team[] }>('/api/teams');\r\n    return response.data.teams || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single team with members\r\n */\r\nexport async function getTeam(id: string): Promise<{ team: Team; members: Contact[] } | null> {\r\n  try {\r\n    const response = await http.get<{ team: Team; members: Contact[] }>(`/api/teams/${id}`);\r\n    return response.data;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new team\r\n */\r\nexport async function createTeam(data: CreateTeamRequest): Promise<Team> {\r\n  const response = await http.post<{ id: string; ok: boolean }>('/api/teams', data);\r\n  return { ...data, id: response.data.id, created_at: new Date().toISOString() } as Team;\r\n}\r\n\r\n/**\r\n * Update a team\r\n */\r\nexport async function updateTeam(id: string, data: Partial<CreateTeamRequest>): Promise<void> {\r\n  await http.put(`/api/teams/${id}`, data);\r\n}\r\n\r\n/**\r\n * Delete a team\r\n */\r\nexport async function deleteTeam(id: string): Promise<void> {\r\n  await http.delete(`/api/teams/${id}`);\r\n}\r\n\r\n/**\r\n * Add member to team\r\n */\r\nexport async function addTeamMember(teamId: string, contactId: string, role?: string, isLead = false): Promise<void> {\r\n  await http.post(`/api/teams/${teamId}/members`, { contactId, role, isLead });\r\n}\r\n\r\n/**\r\n * Remove member from team\r\n */\r\nexport async function removeTeamMember(teamId: string, contactId: string): Promise<void> {\r\n  await http.delete(`/api/teams/${teamId}/members/${contactId}`);\r\n}\r\n\r\nexport const contactsService = {\r\n  getAll: getContacts,\r\n  get: getContact,\r\n  create: createContact,\r\n  update: updateContact,\r\n  delete: deleteContact,\r\n  getStats: getContactStats,\r\n  findByName: findContactByName,\r\n  getDuplicates,\r\n  merge: mergeContacts,\r\n  mergeContacts,\r\n  enrich: enrichContact,\r\n  export: exportContacts,\r\n  getWithAssociations: getContactWithAssociations,\r\n  addToProject: addContactToProject,\r\n  removeFromProject: removeContactFromProject,\r\n  getProjects: getContactProjects,\r\n};\r\n\r\nexport const teamsService = {\r\n  getAll: getTeams,\r\n  get: getTeam,\r\n  create: createTeam,\r\n  update: updateTeam,\r\n  delete: deleteTeam,\r\n  addMember: addTeamMember,\r\n  removeMember: removeTeamMember,\r\n};\r\n","/**\r\n * Documents Service\r\n * Handles file upload, processing, and document management\r\n */\r\n\r\nimport { http, fetchWithProject } from './api';\r\nimport { toast } from './toast';\r\n\r\nexport interface Document {\r\n  id: string;\r\n  filename: string;\r\n  originalName: string;\r\n  mimeType: string;\r\n  size: number;\r\n  path?: string;\r\n  content?: string;\r\n  summary?: string;\r\n  metadata?: Record<string, unknown>;\r\n  status: 'pending' | 'processing' | 'processed' | 'failed';\r\n  processingError?: string;\r\n  facts_count?: number;\r\n  questions_count?: number;\r\n  created_at: string;\r\n  processed_at?: string;\r\n}\r\n\r\nexport interface UploadResult {\r\n  success: boolean;\r\n  files: Array<{\r\n    filename: string;\r\n    id: string;\r\n    size: number;\r\n    status: string;\r\n  }>;\r\n  totalSize: number;\r\n  processingStarted: boolean;\r\n}\r\n\r\nexport interface ProcessingStatus {\r\n  isProcessing: boolean;\r\n  queueLength: number;\r\n  completedCount: number;\r\n  errorCount: number;\r\n  pendingFiles: string[];\r\n  processingFile?: string;\r\n  completedFiles: string[];\r\n  errors: Array<{ file: string; error: string }>;\r\n}\r\n\r\nexport interface EmbeddingStatus {\r\n  total: number;\r\n  totalChunks?: number;\r\n  embedded: number;\r\n  pending: number;\r\n  failed?: number;\r\n  model?: string;\r\n  models: string[];\r\n  available_embedding_models?: string[];\r\n  lastUpdated?: string;\r\n}\r\n\r\nexport interface KnowledgeItem {\r\n  id: string;\r\n  content: string;\r\n  category?: string;\r\n  source?: string;\r\n  embedding?: number[];\r\n  created_at: string;\r\n}\r\n\r\nexport interface Conversation {\r\n  id: string;\r\n  participants: string[];\r\n  subject?: string;\r\n  summary?: string;\r\n  messages: Array<{\r\n    from: string;\r\n    content: string;\r\n    timestamp: string;\r\n  }>;\r\n  source_file?: string;\r\n  created_at: string;\r\n}\r\n\r\n/**\r\n * Upload files\r\n */\r\nexport async function uploadFiles(files: File[], onProgress?: (progress: number) => void): Promise<UploadResult> {\r\n  const formData = new FormData();\r\n  files.forEach(file => {\r\n    formData.append('files', file);\r\n  });\r\n\r\n  const xhr = new XMLHttpRequest();\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    xhr.upload.addEventListener('progress', (e) => {\r\n      if (e.lengthComputable && onProgress) {\r\n        onProgress(Math.round((e.loaded / e.total) * 100));\r\n      }\r\n    });\r\n\r\n    xhr.addEventListener('load', () => {\r\n      if (xhr.status >= 200 && xhr.status < 300) {\r\n        try {\r\n          resolve(JSON.parse(xhr.responseText));\r\n        } catch {\r\n          reject(new Error('Invalid response'));\r\n        }\r\n      } else {\r\n        reject(new Error(`Upload failed: ${xhr.statusText}`));\r\n      }\r\n    });\r\n\r\n    xhr.addEventListener('error', () => {\r\n      reject(new Error('Upload failed'));\r\n    });\r\n\r\n    xhr.open('POST', '/api/upload');\r\n    xhr.send(formData);\r\n  });\r\n}\r\n\r\n/**\r\n * Upload single file with text extraction\r\n */\r\nexport async function uploadWithExtraction(file: File): Promise<{\r\n  id: string;\r\n  text: string;\r\n  pageCount?: number;\r\n}> {\r\n  const formData = new FormData();\r\n  formData.append('file', file);\r\n\r\n  const response = await fetchWithProject('/api/upload-extract', {\r\n    method: 'POST',\r\n    body: formData,\r\n  });\r\n\r\n  if (!response.ok) {\r\n    throw new Error('Upload failed');\r\n  }\r\n\r\n  return response.json();\r\n}\r\n\r\n/**\r\n * Get processing status\r\n */\r\nexport async function getProcessingStatus(): Promise<ProcessingStatus> {\r\n  const response = await http.get<ProcessingStatus>('/api/processing-status');\r\n  return response.data;\r\n}\r\n\r\nexport interface DocumentsResponse {\r\n  documents: Document[];\r\n  total: number;\r\n  limit?: number;\r\n  offset?: number;\r\n  hasMore?: boolean;\r\n  statuses: {\r\n    processed: number;\r\n    pending: number;\r\n    processing?: number;\r\n    failed: number;\r\n    deleted?: number;\r\n  };\r\n}\r\n\r\n/**\r\n * Get all documents with optional status filter\r\n */\r\nexport interface GetDocumentsOptions {\r\n  status?: string;\r\n  type?: string; // documents, transcripts, emails, images\r\n  search?: string;\r\n  sort?: 'created_at' | 'updated_at' | 'filename';\r\n  order?: 'asc' | 'desc';\r\n  limit?: number;\r\n  offset?: number;\r\n}\r\n\r\nexport async function getDocuments(statusOrOptions?: string | GetDocumentsOptions): Promise<DocumentsResponse> {\r\n  try {\r\n    // Handle both legacy (status string) and new options object\r\n    const options: GetDocumentsOptions = typeof statusOrOptions === 'string' \r\n      ? { status: statusOrOptions }\r\n      : statusOrOptions || {};\r\n    \r\n    const params = new URLSearchParams();\r\n    if (options.status && options.status !== 'all') params.set('status', options.status);\r\n    if (options.type && options.type !== 'all') params.set('type', options.type);\r\n    if (options.search) params.set('search', options.search);\r\n    if (options.sort) params.set('sort', options.sort);\r\n    if (options.order) params.set('order', options.order);\r\n    if (options.limit) params.set('limit', String(options.limit));\r\n    if (options.offset) params.set('offset', String(options.offset));\r\n    \r\n    const queryString = params.toString();\r\n    const url = queryString ? `/api/documents?${queryString}` : '/api/documents';\r\n    \r\n    const response = await http.get<DocumentsResponse>(url);\r\n    return {\r\n      documents: response.data.documents || [],\r\n      total: response.data.total || 0,\r\n      limit: response.data.limit,\r\n      offset: response.data.offset,\r\n      hasMore: response.data.hasMore,\r\n      statuses: response.data.statuses || { processed: 0, pending: 0, failed: 0, deleted: 0 }\r\n    };\r\n  } catch {\r\n    return { documents: [], total: 0, statuses: { processed: 0, pending: 0, failed: 0, deleted: 0 } };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single document\r\n */\r\nexport async function getDocument(id: string): Promise<Document | null> {\r\n  try {\r\n    const response = await http.get<{ document: Document }>(`/api/documents/${id}`);\r\n    return response.data.document;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a document\r\n */\r\nexport async function deleteDocument(id: string, options?: { softDelete?: boolean }): Promise<void> {\r\n  const params = options?.softDelete ? '?soft=true' : '';\r\n  await http.delete(`/api/documents/${id}${params}`);\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted document\r\n */\r\nexport async function restoreDocument(id: string): Promise<void> {\r\n  await http.post(`/api/documents/${id}/restore`);\r\n  toast.success('Document restored');\r\n}\r\n\r\n/**\r\n * Reprocess a document\r\n */\r\nexport async function reprocessDocument(id: string): Promise<void> {\r\n  await http.post(`/api/documents/${id}/reprocess`);\r\n  toast.info('Document queued for reprocessing');\r\n}\r\n\r\n/**\r\n * Get document summary\r\n */\r\nexport async function getDocumentSummary(id: string): Promise<string> {\r\n  const response = await http.get<{ summary: string }>(`/api/documents/${id}/summary`);\r\n  return response.data.summary || '';\r\n}\r\n\r\n/**\r\n * Get knowledge base items\r\n */\r\nexport async function getKnowledgeBase(category?: string): Promise<KnowledgeItem[]> {\r\n  try {\r\n    const url = category ? `/api/knowledge?category=${category}` : '/api/knowledge';\r\n    const response = await http.get<{ items: KnowledgeItem[] }>(url);\r\n    return response.data.items || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Add knowledge item\r\n */\r\nexport async function addKnowledgeItem(content: string, category?: string): Promise<KnowledgeItem> {\r\n  const response = await http.post<{ item: KnowledgeItem; id: string }>('/api/knowledge', {\r\n    content,\r\n    category,\r\n  });\r\n  return response.data.item || { id: response.data.id, content, category, created_at: new Date().toISOString() };\r\n}\r\n\r\n/**\r\n * Search knowledge base\r\n */\r\nexport async function searchKnowledge(query: string, limit = 10): Promise<KnowledgeItem[]> {\r\n  const response = await http.get<{ results: KnowledgeItem[] }>(`/api/knowledge/search?q=${encodeURIComponent(query)}&limit=${limit}`);\r\n  return response.data.results || [];\r\n}\r\n\r\n/**\r\n * Get conversations\r\n */\r\nexport async function getConversations(): Promise<Conversation[]> {\r\n  try {\r\n    const response = await http.get<{ conversations: Conversation[] }>('/api/conversations');\r\n    return response.data.conversations || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single conversation\r\n */\r\nexport async function getConversation(id: string): Promise<Conversation | null> {\r\n  try {\r\n    const response = await http.get<{ conversation: Conversation }>(`/api/conversations/${id}`);\r\n    return response.data.conversation;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse conversation preview (without saving)\r\n */\r\nexport async function parseConversationPreview(text: string): Promise<{\r\n  message_count: number;\r\n  participants: string[];\r\n  format: string;\r\n  preview: unknown[];\r\n}> {\r\n  const response = await http.post<{\r\n    message_count: number;\r\n    participants: string[];\r\n    format: string;\r\n    preview: unknown[];\r\n  }>('/api/conversations/parse', { text });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Import a conversation\r\n */\r\nexport async function importConversation(text: string, options?: { \r\n  skipAI?: boolean; \r\n  formatHint?: string;\r\n  meta?: Record<string, unknown>;\r\n}): Promise<Conversation> {\r\n  const response = await http.post<{ conversation: Conversation }>('/api/conversations', { \r\n    text, \r\n    ...options \r\n  });\r\n  return response.data.conversation;\r\n}\r\n\r\n/**\r\n * Delete a conversation\r\n */\r\nexport async function deleteConversation(id: string): Promise<void> {\r\n  await http.delete(`/api/conversations/${id}`);\r\n}\r\n\r\n/**\r\n * Re-embed a conversation (regenerate embeddings)\r\n */\r\nexport async function reembedConversation(id: string): Promise<void> {\r\n  await http.post(`/api/conversations/${id}/reembed`);\r\n}\r\n\r\n// ==================== Bulk Operations ====================\r\n\r\n/**\r\n * Bulk delete documents\r\n */\r\nexport async function bulkDeleteDocuments(ids: string[]): Promise<{ deleted: number; errors: Array<{ id: string; error: string }> }> {\r\n  const response = await http.post<{ deleted: number; errors: Array<{ id: string; error: string }> }>('/api/documents/bulk/delete', { ids });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Bulk reprocess documents\r\n */\r\nexport async function bulkReprocessDocuments(ids: string[]): Promise<{ success: boolean; message: string; ids: string[] }> {\r\n  const response = await http.post<{ success: boolean; message: string; ids: string[] }>('/api/documents/bulk/reprocess', { ids });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Bulk export documents as ZIP\r\n */\r\nexport async function bulkExportDocuments(ids: string[], format: 'original' | 'markdown' = 'original'): Promise<Blob> {\r\n  const response = await fetchWithProject('/api/documents/bulk/export', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ ids, format }),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error('Failed to export documents');\r\n  }\r\n  \r\n  return response.blob();\r\n}\r\n\r\n/**\r\n * Download bulk export\r\n */\r\nexport async function downloadBulkExport(ids: string[], format: 'original' | 'markdown' = 'original'): Promise<void> {\r\n  const blob = await bulkExportDocuments(ids, format);\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = `documents_export_${Date.now()}.zip`;\r\n  document.body.appendChild(a);\r\n  a.click();\r\n  document.body.removeChild(a);\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\nexport const documentsService = {\r\n  upload: uploadFiles,\r\n  uploadWithExtraction,\r\n  getProcessingStatus,\r\n  getAll: getDocuments,\r\n  get: getDocument,\r\n  delete: deleteDocument,\r\n  restore: restoreDocument,\r\n  reprocess: reprocessDocument,\r\n  getSummary: getDocumentSummary,\r\n  // Bulk operations\r\n  bulkDelete: bulkDeleteDocuments,\r\n  bulkReprocess: bulkReprocessDocuments,\r\n  bulkExport: bulkExportDocuments,\r\n  downloadBulkExport,\r\n};\r\n\r\n// Additional knowledge functions\r\nasync function getKnowledgeStatus(): Promise<{\r\n  total: number;\r\n  embedded: number;\r\n  pending: number;\r\n  models: string[];\r\n}> {\r\n  try {\r\n    const response = await http.get<{ status: { total: number; embedded: number; pending: number; models: string[] } }>('/api/knowledge/status');\r\n    return response.data.status;\r\n  } catch {\r\n    return { total: 0, embedded: 0, pending: 0, models: [] };\r\n  }\r\n}\r\n\r\nasync function exportKnowledgeMarkdown(): Promise<string> {\r\n  const response = await http.get<{ markdown: string }>('/api/knowledge/export?format=markdown');\r\n  return response.data.markdown || '';\r\n}\r\n\r\nasync function exportKnowledgeJson(): Promise<KnowledgeItem[]> {\r\n  const response = await http.get<{ items: KnowledgeItem[] }>('/api/knowledge/export?format=json');\r\n  return response.data.items || [];\r\n}\r\n\r\nasync function regenerateKnowledge(): Promise<{ success: boolean; processed: number }> {\r\n  const response = await http.post<{ success: boolean; processed: number }>('/api/knowledge/regenerate');\r\n  return response.data;\r\n}\r\n\r\nasync function synthesizeKnowledge(topic?: string): Promise<{ summary: string; sources: string[] }> {\r\n  const response = await http.post<{ summary: string; sources: string[] }>('/api/knowledge/synthesize', { topic });\r\n  return response.data;\r\n}\r\n\r\nexport const knowledgeService = {\r\n  getAll: getKnowledgeBase,\r\n  add: addKnowledgeItem,\r\n  search: searchKnowledge,\r\n  getStatus: getKnowledgeStatus,\r\n  exportMarkdown: exportKnowledgeMarkdown,\r\n  exportJson: exportKnowledgeJson,\r\n  regenerate: regenerateKnowledge,\r\n  synthesize: synthesizeKnowledge,\r\n};\r\n\r\nexport const conversationsService = {\r\n  getAll: getConversations,\r\n  get: getConversation,\r\n  getById: getConversation, // Alias\r\n  parsePreview: parseConversationPreview,\r\n  import: importConversation,\r\n  delete: deleteConversation,\r\n  reembed: reembedConversation,\r\n};\r\n","/**\r\n * Emails Service\r\n * Handles email management and AI responses\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Email {\r\n  id: string;\r\n  message_id?: string;\r\n  from: string;\r\n  from_name?: string;\r\n  from_email?: string;\r\n  to: string[];\r\n  cc?: string[];\r\n  bcc?: string[];\r\n  subject: string;\r\n  body: string;\r\n  body_text?: string;\r\n  body_html?: string;\r\n  date: string;\r\n  thread_id?: string;\r\n  labels?: string[];\r\n  is_read: boolean;\r\n  read?: boolean; // Alias for is_read\r\n  is_starred: boolean;\r\n  has_attachments: boolean;\r\n  attachments?: Array<{\r\n    filename: string;\r\n    mimeType: string;\r\n    size: number;\r\n  }>;\r\n  // Direction and response tracking\r\n  direction?: 'inbound' | 'outbound' | 'internal';\r\n  requires_response?: boolean;\r\n  response_sent?: boolean;\r\n  response_drafted?: boolean;\r\n  draft_response?: string;\r\n  // AI fields\r\n  ai_summary?: string;\r\n  ai_category?: string;\r\n  ai_sentiment?: 'positive' | 'neutral' | 'negative';\r\n  ai_priority?: 'low' | 'medium' | 'high' | 'urgent';\r\n  created_at: string;\r\n}\r\n\r\nexport interface EmailThread {\r\n  id: string;\r\n  subject: string;\r\n  participants: string[];\r\n  message_count: number;\r\n  last_message_date: string;\r\n  messages: Email[];\r\n  summary?: string;\r\n}\r\n\r\nexport interface DraftEmail {\r\n  to: string[];\r\n  cc?: string[];\r\n  bcc?: string[];\r\n  subject: string;\r\n  body: string;\r\n  replyTo?: string;\r\n  threadId?: string;\r\n}\r\n\r\nexport interface AIResponseSuggestion {\r\n  tone: 'professional' | 'friendly' | 'formal' | 'brief';\r\n  response: string;\r\n  confidence: number;\r\n}\r\n\r\n/**\r\n * Get all emails\r\n */\r\nexport async function getEmails(filters?: {\r\n  folder?: string;\r\n  label?: string;\r\n  unread?: boolean;\r\n  starred?: boolean;\r\n  search?: string;\r\n  limit?: number;\r\n  offset?: number;\r\n  direction?: 'inbound' | 'outbound' | 'internal';\r\n}): Promise<{ emails: Email[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (filters?.folder) params.set('folder', filters.folder);\r\n    if (filters?.label) params.set('label', filters.label);\r\n    if (filters?.unread) params.set('unread', 'true');\r\n    if (filters?.starred) params.set('starred', 'true');\r\n    if (filters?.search) params.set('search', filters.search);\r\n    if (filters?.limit) params.set('limit', String(filters.limit));\r\n    if (filters?.offset) params.set('offset', String(filters.offset));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/emails?${query}` : '/api/emails';\r\n    \r\n    const response = await http.get<{ emails: Email[]; total: number }>(url);\r\n    return response.data;\r\n  } catch {\r\n    return { emails: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single email\r\n */\r\nexport async function getEmail(id: string): Promise<Email | null> {\r\n  try {\r\n    const response = await http.get<{ email: Email }>(`/api/emails/${id}`);\r\n    return response.data.email;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get email thread\r\n */\r\nexport async function getEmailThread(threadId: string): Promise<EmailThread | null> {\r\n  try {\r\n    const response = await http.get<{ thread: EmailThread }>(`/api/emails/thread/${threadId}`);\r\n    return response.data.thread;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Mark email as read\r\n */\r\nexport async function markAsRead(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/read`);\r\n}\r\n\r\n/**\r\n * Mark email as unread\r\n */\r\nexport async function markAsUnread(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/unread`);\r\n}\r\n\r\n/**\r\n * Star an email\r\n */\r\nexport async function starEmail(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/star`);\r\n}\r\n\r\n/**\r\n * Unstar an email\r\n */\r\nexport async function unstarEmail(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/unstar`);\r\n}\r\n\r\n/**\r\n * Archive an email\r\n */\r\nexport async function archiveEmail(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/archive`);\r\n}\r\n\r\n/**\r\n * Delete an email\r\n */\r\nexport async function deleteEmail(id: string): Promise<void> {\r\n  await http.delete(`/api/emails/${id}`);\r\n}\r\n\r\n/**\r\n * Send an email\r\n */\r\nexport async function sendEmail(draft: DraftEmail): Promise<{ success: boolean; messageId: string }> {\r\n  const response = await http.post<{ success: boolean; messageId: string }>('/api/emails/send', draft);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Save as draft\r\n */\r\nexport async function saveDraft(draft: DraftEmail): Promise<{ id: string }> {\r\n  const response = await http.post<{ id: string }>('/api/emails/draft', draft);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Generate AI response\r\n */\r\nexport async function generateAIResponse(emailId: string, tone?: string): Promise<AIResponseSuggestion[]> {\r\n  const response = await http.post<{ suggestions: AIResponseSuggestion[] }>(`/api/emails/${emailId}/ai-response`, {\r\n    tone,\r\n  });\r\n  return response.data.suggestions || [];\r\n}\r\n\r\n/**\r\n * Generate AI summary of email\r\n */\r\nexport async function generateSummary(emailId: string): Promise<string> {\r\n  const response = await http.post<{ summary: string }>(`/api/emails/${emailId}/summarize`);\r\n  return response.data.summary || '';\r\n}\r\n\r\n/**\r\n * Categorize email with AI\r\n */\r\nexport async function categorizeEmail(emailId: string): Promise<{\r\n  category: string;\r\n  priority: string;\r\n  sentiment: string;\r\n}> {\r\n  const response = await http.post<{\r\n    category: string;\r\n    priority: string;\r\n    sentiment: string;\r\n  }>(`/api/emails/${emailId}/categorize`);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get email stats\r\n */\r\nexport async function getEmailStats(): Promise<{\r\n  total: number;\r\n  unread: number;\r\n  starred: number;\r\n  today: number;\r\n  byCategory: Record<string, number>;\r\n}> {\r\n  const response = await http.get<{\r\n    total: number;\r\n    unread: number;\r\n    starred: number;\r\n    today: number;\r\n    byCategory: Record<string, number>;\r\n  }>('/api/emails/stats');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Sync emails from provider\r\n */\r\nexport async function syncEmails(): Promise<{ synced: number; errors: number }> {\r\n  const response = await http.post<{ synced: number; errors: number }>('/api/emails/sync');\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get email by ID (alias for get)\r\n */\r\nexport async function getById(id: string): Promise<Email | null> {\r\n  return getEmail(id);\r\n}\r\n\r\n/**\r\n * Get emails needing response\r\n */\r\nexport async function getNeedingResponse(): Promise<Email[]> {\r\n  try {\r\n    const response = await http.get<{ emails: Email[] }>('/api/emails?requires_response=true&response_sent=false');\r\n    return response.data.emails || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Mark email as responded\r\n */\r\nexport async function markResponded(id: string): Promise<void> {\r\n  await http.put(`/api/emails/${id}/responded`);\r\n}\r\n\r\n/**\r\n * Generate response (alias for generateAIResponse)\r\n */\r\nexport async function generateResponse(emailId: string, tone?: string): Promise<AIResponseSuggestion[]> {\r\n  return generateAIResponse(emailId, tone);\r\n}\r\n\r\nexport const emailsService = {\r\n  getAll: getEmails,\r\n  get: getEmail,\r\n  getById,\r\n  getThread: getEmailThread,\r\n  markAsRead,\r\n  markAsUnread,\r\n  star: starEmail,\r\n  unstar: unstarEmail,\r\n  archive: archiveEmail,\r\n  delete: deleteEmail,\r\n  send: sendEmail,\r\n  saveDraft,\r\n  generateAIResponse,\r\n  generateResponse,\r\n  generateSummary,\r\n  categorize: categorizeEmail,\r\n  getStats: getEmailStats,\r\n  sync: syncEmails,\r\n  getNeedingResponse,\r\n  markResponded,\r\n};\r\n","/**\r\n * Graph Service - SOTA Knowledge Graph UI\r\n * Handles knowledge graph, visualization, GraphRAG, analytics, and Supabase persistence\r\n */\r\n\r\nimport { http, fetchWithProject } from './api';\r\n\r\n// ============================================\r\n// TYPES - Graph Data\r\n// ============================================\r\n\r\nexport interface GraphNode {\r\n  id: string;\r\n  label: string;\r\n  name?: string;\r\n  type: string;\r\n  properties?: Record<string, unknown>;\r\n  // Avatar/visual properties\r\n  avatarUrl?: string;\r\n  photoUrl?: string;\r\n  role?: string;\r\n  organization?: string;\r\n  department?: string;\r\n  email?: string;\r\n  // Graph metrics\r\n  connections?: number;\r\n  centrality?: number;\r\n  communityId?: number;\r\n  // Position (for saved layouts)\r\n  x?: number;\r\n  y?: number;\r\n}\r\n\r\nexport interface GraphEdge {\r\n  id: string;\r\n  source: string;\r\n  target: string;\r\n  label: string;\r\n  type: string;\r\n  weight?: number;\r\n  properties?: Record<string, unknown>;\r\n}\r\n\r\nexport interface GraphData {\r\n  nodes: GraphNode[];\r\n  edges: GraphEdge[];\r\n  stats?: GraphStats;\r\n}\r\n\r\nexport interface GraphStats {\r\n  nodeCount: number;\r\n  edgeCount: number;\r\n  density?: number;\r\n  nodeTypes?: Record<string, number>;\r\n  edgeTypes?: Record<string, number>;\r\n  avgConnections?: number;\r\n  communities?: number;\r\n  graphName?: string;\r\n  connected?: boolean;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Ontology\r\n// ============================================\r\n\r\nexport interface OntologyEntityType {\r\n  name: string;\r\n  label: string;\r\n  description?: string;\r\n  icon?: string;\r\n  color?: string;\r\n  sharedEntity?: boolean;\r\n  properties?: Array<{\r\n    name: string;\r\n    type: string;\r\n    required?: boolean;\r\n    searchable?: boolean;\r\n  }>;\r\n}\r\n\r\nexport interface OntologyRelationType {\r\n  name: string;\r\n  label?: string;\r\n  description?: string;\r\n  fromTypes: string[];\r\n  toTypes: string[];\r\n  properties?: Array<{\r\n    name: string;\r\n    type: string;\r\n  }>;\r\n}\r\n\r\nexport interface OntologySchema {\r\n  version: string;\r\n  entityTypes: Record<string, OntologyEntityType>;\r\n  relationTypes: Record<string, OntologyRelationType>;\r\n  queryPatterns?: Record<string, { cypher: string; description: string }>;\r\n}\r\n\r\nexport interface OntologySuggestion {\r\n  id: string;\r\n  type: 'entity' | 'relation';\r\n  name: string;\r\n  description?: string;\r\n  fromTypes?: string[];\r\n  toTypes?: string[];\r\n  properties?: string[];\r\n  source?: string;\r\n  example?: string;\r\n  status: 'pending' | 'approved' | 'rejected';\r\n  createdAt: string;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Analytics\r\n// ============================================\r\n\r\nexport interface Community {\r\n  id: number;\r\n  size: number;\r\n  members: Array<{ id: string; name: string; type: string }>;\r\n  types?: Record<string, number>;\r\n  hub?: { id: string; name: string };\r\n}\r\n\r\nexport interface CentralityMetrics {\r\n  topNodes: Array<{\r\n    id: string;\r\n    name: string;\r\n    type: string;\r\n    connections: number;\r\n    centrality: number;\r\n    avatarUrl?: string;\r\n  }>;\r\n}\r\n\r\nexport interface BridgeNode {\r\n  id: string;\r\n  name: string;\r\n  org1?: string;\r\n  org2?: string;\r\n  connects: number;\r\n}\r\n\r\nexport interface GraphInsight {\r\n  type: string;\r\n  title: string;\r\n  description: string;\r\n  importance: 'low' | 'medium' | 'high';\r\n  relatedNodes?: string[];\r\n}\r\n\r\n// ============================================\r\n// TYPES - GraphRAG\r\n// ============================================\r\n\r\nexport interface GraphRAGResponse {\r\n  ok: boolean;\r\n  answer: string;\r\n  sources: Array<{\r\n    type: string;\r\n    content: string;\r\n    id?: string;\r\n  }>;\r\n  queryType: 'structural' | 'semantic' | 'hybrid';\r\n  cypherGenerated?: string;\r\n  reasoningChain?: Array<{\r\n    step: string;\r\n    input: string;\r\n    output: unknown;\r\n    reasoning?: string;\r\n  }>;\r\n  highlightedNodes?: string[];\r\n  latencyMs: number;\r\n  confidence?: number;\r\n  cached?: boolean;\r\n}\r\n\r\nexport interface MultiHopResult {\r\n  answer: string;\r\n  reasoningChain: Array<{\r\n    step: string;\r\n    input: string;\r\n    output: unknown;\r\n    reasoning?: string;\r\n  }>;\r\n  subQueries?: Array<{ query: string; result: unknown }>;\r\n  confidence: number;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Query\r\n// ============================================\r\n\r\nexport interface CypherQueryResult {\r\n  ok: boolean;\r\n  results: Array<Record<string, unknown>>;\r\n  columns?: string[];\r\n  executionTimeMs?: number;\r\n  error?: string;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Supabase Persistence\r\n// ============================================\r\n\r\nexport interface GraphQueryHistory {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  query_type: 'cypher' | 'natural_language' | 'visual' | 'template';\r\n  query_text: string;\r\n  query_name?: string;\r\n  generated_cypher?: string;\r\n  result_count?: number;\r\n  execution_time_ms?: number;\r\n  is_favorite: boolean;\r\n  tags?: string[];\r\n  metadata?: Record<string, unknown>;\r\n  created_at: string;\r\n}\r\n\r\nexport interface GraphSavedView {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  name: string;\r\n  description?: string;\r\n  view_config: {\r\n    filters?: {\r\n      entityTypes?: string[];\r\n      communityIds?: number[];\r\n      dateRange?: { start?: string; end?: string };\r\n    };\r\n    layout?: {\r\n      type: 'physics' | 'hierarchical' | 'manual';\r\n      positions?: Record<string, { x: number; y: number }>;\r\n    };\r\n    zoom?: { scale: number; position: { x: number; y: number } };\r\n    selectedNodes?: string[];\r\n    highlightedPaths?: string[][];\r\n    communityColors?: Record<number, string>;\r\n    showLabels?: boolean;\r\n    showEdgeLabels?: boolean;\r\n  };\r\n  thumbnail_url?: string;\r\n  is_default: boolean;\r\n  is_shared: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface GraphBookmark {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  node_id: string;\r\n  node_type: string;\r\n  node_label: string;\r\n  node_avatar_url?: string;\r\n  note?: string;\r\n  color?: string;\r\n  sort_order: number;\r\n  created_at: string;\r\n}\r\n\r\nexport interface GraphAnnotation {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  target_type: 'node' | 'edge' | 'path' | 'region';\r\n  target_id: string;\r\n  target_label?: string;\r\n  content: string;\r\n  annotation_type: 'note' | 'warning' | 'highlight' | 'question' | 'todo';\r\n  color?: string;\r\n  icon?: string;\r\n  is_shared: boolean;\r\n  is_resolved: boolean;\r\n  resolved_at?: string;\r\n  resolved_by?: string;\r\n  metadata?: Record<string, unknown>;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface GraphChatMessage {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  session_id: string;\r\n  role: 'user' | 'assistant' | 'system';\r\n  content: string;\r\n  metadata?: {\r\n    queryType?: string;\r\n    cypherGenerated?: string;\r\n    sources?: unknown[];\r\n    reasoningChain?: unknown[];\r\n    highlightedNodes?: string[];\r\n    executionTimeMs?: number;\r\n    confidence?: number;\r\n    isVoiceInput?: boolean;\r\n  };\r\n  is_pinned: boolean;\r\n  created_at: string;\r\n}\r\n\r\nexport interface GraphSnapshot {\r\n  id: string;\r\n  project_id: string;\r\n  user_id: string;\r\n  name: string;\r\n  description?: string;\r\n  snapshot_type: 'manual' | 'auto' | 'milestone' | 'before_change';\r\n  snapshot_data: {\r\n    nodes: GraphNode[];\r\n    edges: GraphEdge[];\r\n    stats: GraphStats;\r\n    communities?: Community[];\r\n    capturedAt: string;\r\n  };\r\n  node_count: number;\r\n  edge_count: number;\r\n  file_size_bytes?: number;\r\n  is_baseline: boolean;\r\n  tags?: string[];\r\n  created_at: string;\r\n}\r\n\r\n// ============================================\r\n// TYPES - Timeline & Costs (existing)\r\n// ============================================\r\n\r\nexport interface TimelineEvent {\r\n  id: string;\r\n  date: string;\r\n  title: string;\r\n  description?: string;\r\n  content?: string;\r\n  type: 'fact' | 'question' | 'question_answered' | 'decision' | 'risk' | 'action' | 'action_completed' | 'deadline' | 'document' | 'transcript' | 'email' | 'conversation' | 'chat_session';\r\n  entity_id?: string;\r\n  entity_type?: string;\r\n  metadata?: Record<string, unknown>;\r\n  importance?: 'low' | 'medium' | 'high';\r\n  user?: string;\r\n  actor?: string;\r\n  owner?: string;\r\n  icon?: string;\r\n  color?: string;\r\n  status?: string;\r\n}\r\n\r\nexport interface TimelineData {\r\n  events: TimelineEvent[];\r\n  startDate: string;\r\n  endDate: string;\r\n  totalEvents: number;\r\n}\r\n\r\nexport interface LLMCost {\r\n  id: string;\r\n  provider: string;\r\n  model: string;\r\n  operation: string;\r\n  tokens_input: number;\r\n  tokens_output: number;\r\n  cost: number;\r\n  timestamp: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface CostSummary {\r\n  total: number;\r\n  byProvider: Record<string, number>;\r\n  byModel: Record<string, number>;\r\n  byOperation: Record<string, number>;\r\n  byContext?: Record<string, number>;\r\n  period: { start: string; end: string };\r\n  dailyBreakdown: Array<{ date: string; cost: number; calls: number }>;\r\n  totalInputTokens?: number;\r\n  totalOutputTokens?: number;\r\n  previousPeriodCost?: number | null;\r\n  percentChange?: number | null;\r\n  budgetLimit?: number | null;\r\n  budgetUsedPercent?: number | null;\r\n  budgetAlertTriggered?: boolean;\r\n}\r\n\r\n// ============================================\r\n// GRAPH DATA FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get visualization data for vis-network\r\n */\r\nexport async function getVisualizationData(options?: {\r\n  types?: string[];\r\n  limit?: number;\r\n  communityId?: number;\r\n}): Promise<{ nodes: GraphNode[]; edges: GraphEdge[] }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.types?.length) params.set('types', options.types.join(','));\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.communityId !== undefined) params.set('communityId', String(options.communityId));\r\n\r\n    // First try to get nodes\r\n    const nodesResponse = await http.get<{ ok: boolean; nodes?: GraphNode[]; results?: unknown[] }>(\r\n      `/api/graph/nodes?${params.toString()}`\r\n    );\r\n    \r\n    // Then get relationships\r\n    const edgesResponse = await http.get<{ ok: boolean; relationships?: GraphEdge[]; results?: unknown[] }>(\r\n      `/api/graph/relationships?${params.toString()}`\r\n    );\r\n\r\n    const nodes = nodesResponse.data.nodes || nodesResponse.data.results?.map((item) => {\r\n      const r = item as Record<string, unknown>;\r\n      return {\r\n        id: String(r.id || r.nodeId || ''),\r\n        label: String(r.name || r.label || r.title || (r.content as string)?.substring(0, 50) || ''),\r\n        name: String(r.name || ''),\r\n        type: String(r.type || r.label || 'Unknown'),\r\n        avatarUrl: (r.avatarUrl || r.avatar_url || r.photoUrl || r.photo_url) as string | undefined,\r\n        role: r.role as string | undefined,\r\n        organization: r.organization as string | undefined,\r\n        properties: r,\r\n      };\r\n    }) || [];\r\n\r\n    // Map relationships to expected format (from/to -> source/target)\r\n    const rawEdges = edgesResponse.data.relationships || edgesResponse.data.results || [];\r\n    const edges = rawEdges.map((item) => {\r\n      const r = item as Record<string, unknown>;\r\n      return {\r\n        id: String(r.id || `${r.from || r.source}-${r.to || r.target}-${r.type}`),\r\n        source: String(r.from || r.source || ''),\r\n        target: String(r.to || r.target || ''),\r\n        label: String(r.type || r.label || ''),\r\n        type: String(r.type || ''),\r\n      };\r\n    });\r\n\r\n    return { nodes: nodes as GraphNode[], edges: edges as GraphEdge[] };\r\n  } catch (error) {\r\n    console.error('[GraphService] getVisualizationData error:', error);\r\n    return { nodes: [], edges: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get graph statistics\r\n */\r\nexport async function getStats(): Promise<GraphStats> {\r\n  try {\r\n    const response = await http.get<{ \r\n      ok: boolean; \r\n      stats?: GraphStats;\r\n      nodes?: number;\r\n      relationships?: number;\r\n      enabled?: boolean;\r\n      connected?: boolean;\r\n      graphName?: string;\r\n    }>('/api/graph/status');\r\n    \r\n    if (response.data.stats) {\r\n      return {\r\n        ...response.data.stats,\r\n        graphName: response.data.graphName,\r\n        connected: response.data.connected,\r\n      };\r\n    }\r\n    \r\n    return {\r\n      nodeCount: response.data.nodes || 0,\r\n      edgeCount: response.data.relationships || 0,\r\n      graphName: response.data.graphName,\r\n      connected: response.data.connected,\r\n    };\r\n  } catch {\r\n    return { nodeCount: 0, edgeCount: 0, connected: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get knowledge graph data (legacy)\r\n */\r\nexport async function getGraph(options?: {\r\n  type?: string;\r\n  depth?: number;\r\n  limit?: number;\r\n}): Promise<GraphData> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.type) params.set('type', options.type);\r\n    if (options?.depth) params.set('depth', String(options.depth));\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/graph?${query}` : '/api/graph';\r\n\r\n    const response = await http.get<GraphData>(url);\r\n    return response.data;\r\n  } catch {\r\n    return { nodes: [], edges: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get entity graph (centered on a specific entity)\r\n */\r\nexport async function getEntityGraph(entityId: string, depth = 2): Promise<GraphData> {\r\n  try {\r\n    const response = await http.get<GraphData>(`/api/graph/entity/${entityId}?depth=${depth}`);\r\n    return response.data;\r\n  } catch {\r\n    return { nodes: [], edges: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get related entities\r\n */\r\nexport async function getRelatedEntities(entityId: string): Promise<GraphNode[]> {\r\n  try {\r\n    const response = await http.get<{ related: GraphNode[] }>(`/api/graph/related/${entityId}`);\r\n    return response.data.related || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// ONTOLOGY FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get full ontology schema\r\n */\r\nexport async function getOntologySchema(): Promise<OntologySchema | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; schema: OntologySchema }>('/api/ontology/schema');\r\n    return response.data.schema || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get entity types\r\n */\r\nexport async function getOntologyEntities(): Promise<OntologyEntityType[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; entityTypes: OntologyEntityType[] }>('/api/ontology/entities');\r\n    return response.data.entityTypes || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get relation types\r\n */\r\nexport async function getOntologyRelations(): Promise<OntologyRelationType[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; relationTypes: OntologyRelationType[] }>('/api/ontology/relations');\r\n    return response.data.relationTypes || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology suggestions\r\n */\r\nexport async function getOntologySuggestions(): Promise<OntologySuggestion[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; suggestions: OntologySuggestion[] }>('/api/ontology/suggestions');\r\n    return response.data.suggestions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Approve ontology suggestion\r\n */\r\nexport async function approveOntologySuggestion(suggestionId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean }>(`/api/ontology/suggestions/${suggestionId}/approve`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Reject ontology suggestion\r\n */\r\nexport async function rejectOntologySuggestion(suggestionId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean }>(`/api/ontology/suggestions/${suggestionId}/reject`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SOTA v2.0 - ONTOLOGY MANAGEMENT\r\n// ============================================\r\n\r\nexport interface OntologyTypeStats {\r\n  entities: Record<string, { count: number; inOntology: boolean }>;\r\n  relations: Record<string, { count: number; inOntology: boolean }>;\r\n  unused: { entities: string[]; relations: string[] };\r\n  notInOntology: { entities: string[]; relations: string[] };\r\n}\r\n\r\nexport interface OntologySyncStatus {\r\n  isListening: boolean;\r\n  syncInProgress: boolean;\r\n  lastSyncAt: string | null;\r\n  pendingChanges: number;\r\n  ontologySource: 'supabase' | 'file' | null;\r\n  graphConnected: boolean;\r\n}\r\n\r\nexport interface OntologyChange {\r\n  id: string;\r\n  change_type: string;\r\n  target_type: string;\r\n  target_name: string;\r\n  old_definition: unknown;\r\n  new_definition: unknown;\r\n  diff: { added: unknown; removed: unknown; modified: unknown } | null;\r\n  reason: string | null;\r\n  source: string;\r\n  changed_at: string;\r\n  changed_by: string | null;\r\n}\r\n\r\nexport interface LLMAnalysisResult {\r\n  analysis: {\r\n    missingInOntology: Array<{ name: string; type: string; count: number; description: string; confidence: number }>;\r\n    unusedInOntology: Array<{ name: string; type: string }>;\r\n    suggestedRelations: Array<{ from: string; to: string; name: string; description: string }>;\r\n    suggestedInferenceRules: Array<{ name: string; description: string; pattern: string }>;\r\n    summary: string;\r\n  };\r\n  suggestions: OntologySuggestion[];\r\n  summary: string;\r\n}\r\n\r\n/**\r\n * Get type usage statistics from the graph\r\n */\r\nexport async function getOntologyTypeStats(): Promise<OntologyTypeStats | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; stats: OntologyTypeStats }>('/api/ontology/stats');\r\n    return response.data.stats || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology sync status (Supabase Graph)\r\n */\r\nexport async function getOntologySyncStatus(): Promise<OntologySyncStatus | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; status: OntologySyncStatus }>('/api/ontology/sync/status');\r\n    return response.data.status || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Force sync ontology to graph\r\n */\r\nexport async function forceOntologySync(): Promise<{ ok: boolean; results?: unknown; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; results?: unknown; error?: string }>('/api/ontology/sync/force', {});\r\n    return response.data;\r\n  } catch (e) {\r\n    return { ok: false, error: String(e) };\r\n  }\r\n}\r\n\r\n/**\r\n * Trigger LLM analysis of graph vs ontology\r\n */\r\nexport async function runLLMAnalysis(): Promise<LLMAnalysisResult | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean } & LLMAnalysisResult>('/api/ontology/analyze', {});\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Auto-approve high confidence suggestions\r\n */\r\nexport async function autoApproveHighConfidence(threshold = 0.85): Promise<{ approved: number; skipped: number }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; approved: number; skipped: number }>(\r\n      '/api/ontology/suggestions/auto-approve',\r\n      { threshold }\r\n    );\r\n    return { approved: response.data.approved || 0, skipped: response.data.skipped || 0 };\r\n  } catch {\r\n    return { approved: 0, skipped: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology change history (audit trail)\r\n */\r\nexport async function getOntologyChanges(options: {\r\n  targetType?: string;\r\n  targetName?: string;\r\n  limit?: number;\r\n} = {}): Promise<OntologyChange[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options.targetType) params.append('targetType', options.targetType);\r\n    if (options.targetName) params.append('targetName', options.targetName);\r\n    if (options.limit) params.append('limit', String(options.limit));\r\n    \r\n    const response = await http.get<{ ok: boolean; changes: OntologyChange[] }>(\r\n      `/api/ontology/changes?${params.toString()}`\r\n    );\r\n    return response.data.changes || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Migrate schema.json to Supabase\r\n */\r\nexport async function migrateOntologyToSupabase(): Promise<{ success: boolean; counts?: unknown; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; counts?: unknown; error?: string }>(\r\n      '/api/ontology/migrate',\r\n      {}\r\n    );\r\n    return response.data;\r\n  } catch (e) {\r\n    return { success: false, error: String(e) };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SOTA v2.1 - BACKGROUND WORKER\r\n// ============================================\r\n\r\nexport interface BackgroundWorkerStatus {\r\n  isRunning: boolean;\r\n  hasPendingAnalysis: boolean;\r\n  lastRun: Record<string, string>;\r\n  graphConnected: boolean;\r\n  llmConfigured: boolean;\r\n  thresholds: {\r\n    autoApprove: number;\r\n    minNodesForAnalysis: number;\r\n    analysisDebounceMs: number;\r\n  };\r\n}\r\n\r\nexport interface BackgroundWorkerStats {\r\n  totalExecutions: number;\r\n  byType: Record<string, number>;\r\n  byStatus: { completed: number; failed: number };\r\n  avgDuration: number;\r\n}\r\n\r\nexport interface BackgroundJobExecution {\r\n  type: string;\r\n  startedAt: string;\r\n  completedAt?: string;\r\n  status: string;\r\n  duration?: number;\r\n  results?: unknown;\r\n  error?: string;\r\n}\r\n\r\nexport interface OntologyJob {\r\n  id: string;\r\n  name: string;\r\n  type: string;\r\n  schedule: string;\r\n  enabled: boolean;\r\n  lastRun: string | null;\r\n  nextRun: string | null;\r\n  runCount: number;\r\n}\r\n\r\n/**\r\n * Get background worker status\r\n */\r\nexport async function getBackgroundWorkerStatus(): Promise<{ status: BackgroundWorkerStatus; stats: BackgroundWorkerStats } | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; status: BackgroundWorkerStatus; stats: BackgroundWorkerStats }>(\r\n      '/api/ontology/worker/status'\r\n    );\r\n    if (response.data.ok) {\r\n      return { status: response.data.status, stats: response.data.stats };\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Trigger background analysis manually\r\n */\r\nexport async function triggerBackgroundAnalysis(\r\n  type: 'full' | 'inference' | 'dedup' | 'auto_approve' | 'gaps',\r\n  config: Record<string, unknown> = {}\r\n): Promise<BackgroundJobExecution | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean } & BackgroundJobExecution>(\r\n      '/api/ontology/worker/trigger',\r\n      { type, config }\r\n    );\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get background worker execution log\r\n */\r\nexport async function getBackgroundWorkerLog(options: {\r\n  type?: string;\r\n  status?: string;\r\n  limit?: number;\r\n} = {}): Promise<BackgroundJobExecution[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options.type) params.append('type', options.type);\r\n    if (options.status) params.append('status', options.status);\r\n    if (options.limit) params.append('limit', String(options.limit));\r\n    \r\n    const response = await http.get<{ ok: boolean; log: BackgroundJobExecution[] }>(\r\n      `/api/ontology/worker/log?${params.toString()}`\r\n    );\r\n    return response.data.log || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get ontology-related scheduled jobs\r\n */\r\nexport async function getOntologyJobs(): Promise<OntologyJob[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; jobs: OntologyJob[] }>('/api/ontology/jobs');\r\n    return response.data.jobs || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle an ontology job (enable/disable)\r\n */\r\nexport async function toggleOntologyJob(jobId: string, enabled?: boolean): Promise<OntologyJob | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; job: OntologyJob }>(\r\n      `/api/ontology/jobs/${jobId}/toggle`,\r\n      { enabled }\r\n    );\r\n    if (response.data.ok) {\r\n      return response.data.job;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// ONTOLOGY EXTRACTOR (SOTA v2.1)\r\n// ============================================\r\n\r\nexport interface ExtractedOntology {\r\n  version: string;\r\n  extractedAt: string;\r\n  entityTypes: Record<string, {\r\n    label: string;\r\n    description: string;\r\n    properties: Record<string, { type: string; required: boolean; searchable: boolean }>;\r\n    nodeCount: number;\r\n    extractedFrom: string;\r\n  }>;\r\n  relationTypes: Record<string, {\r\n    label: string;\r\n    description: string;\r\n    fromTypes: string[];\r\n    toTypes: string[];\r\n    edgeCount: number;\r\n    extractedFrom: string;\r\n  }>;\r\n}\r\n\r\nexport interface ComplianceResult {\r\n  valid: boolean;\r\n  score: number;\r\n  issues: Array<{\r\n    type: string;\r\n    severity: 'error' | 'warning' | 'info';\r\n    message: string;\r\n    label?: string;\r\n    count?: number;\r\n    suggestion?: string;\r\n  }>;\r\n  stats: {\r\n    totalNodes: number;\r\n    validNodes: number;\r\n    invalidNodes: number;\r\n    unknownTypeNodes: number;\r\n    totalRelationships: number;\r\n    validRelationships: number;\r\n    invalidRelationships: number;\r\n    unknownTypeRelationships: number;\r\n    missingRequiredProperties: number;\r\n    invalidPropertyTypes: number;\r\n  };\r\n}\r\n\r\nexport interface OntologyDiff {\r\n  entitiesOnlyInA: string[];\r\n  entitiesOnlyInB: string[];\r\n  entitiesInBoth: string[];\r\n  relationsOnlyInA: string[];\r\n  relationsOnlyInB: string[];\r\n  relationsInBoth: string[];\r\n}\r\n\r\nexport interface GraphBrowserInfo {\r\n  browserUrl: string;\r\n  isCloud: boolean;\r\n  host: string;\r\n  note: string;\r\n}\r\n\r\n// Alias for backward compatibility\r\nexport type FalkorDBBrowserInfo = GraphBrowserInfo;\r\n\r\n/**\r\n * Extract ontology from graph\r\n */\r\nexport async function extractOntologyFromGraph(): Promise<{ ok: boolean; ontology?: ExtractedOntology; stats?: Record<string, number>; error?: string }> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; ontology?: ExtractedOntology; stats?: Record<string, number>; error?: string }>('/api/ontology/extract-from-graph');\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, error: 'Failed to extract ontology' };\r\n  }\r\n}\r\n\r\n/**\r\n * Validate graph compliance against ontology\r\n */\r\nexport async function validateOntologyCompliance(): Promise<ComplianceResult | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean } & ComplianceResult>('/api/ontology/validate-compliance');\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get diff between current ontology and graph\r\n */\r\nexport async function getOntologyDiff(): Promise<{ diff: OntologyDiff; extractedOntology: ExtractedOntology } | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; diff: OntologyDiff; extractedOntology: ExtractedOntology }>('/api/ontology/diff');\r\n    if (response.data.ok) {\r\n      return { diff: response.data.diff, extractedOntology: response.data.extractedOntology };\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Find unused types in ontology\r\n */\r\nexport async function findUnusedOntologyTypes(): Promise<{ entities: string[]; relations: string[] }> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; unused: { entities: string[]; relations: string[] } }>('/api/ontology/unused-types');\r\n    return response.data.unused || { entities: [], relations: [] };\r\n  } catch {\r\n    return { entities: [], relations: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Merge extracted ontology with current\r\n */\r\nexport async function mergeOntology(options: { \r\n  ontology?: ExtractedOntology; \r\n  mergeProperties?: boolean; \r\n  mergeEndpoints?: boolean; \r\n  save?: boolean \r\n}): Promise<{ ok: boolean; changes?: Array<{ type: string; name: string }>; saved?: boolean }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; changes: Array<{ type: string; name: string }>; saved: boolean }>('/api/ontology/merge', options);\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Cleanup orphan ontology types\r\n */\r\nexport async function cleanupOntology(options: {\r\n  discardEntitiesWithoutRelations?: boolean;\r\n  discardRelationsWithoutEntities?: boolean;\r\n  save?: boolean;\r\n}): Promise<{ ok: boolean; discardedEntities?: Array<{ name: string }>; discardedRelations?: Array<{ name: string }> }> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; discardedEntities: Array<{ name: string }>; discardedRelations: Array<{ name: string }> }>('/api/ontology/cleanup', options);\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false };\r\n  }\r\n}\r\n\r\n/**\r\n * Get Graph Browser URL info (legacy - kept for compatibility)\r\n */\r\nexport async function getFalkorDBBrowserInfo(): Promise<FalkorDBBrowserInfo | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean } & FalkorDBBrowserInfo>('/api/graph/falkordb-browser');\r\n    if (response.data.ok) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport interface FalkorDBGraphSyncResult {\r\n  ok: boolean;\r\n  error?: string;\r\n  graphs: string[];\r\n  validGraphs: string[];\r\n  orphanGraphs: string[];\r\n  deleted: string[];\r\n  dryRun: boolean;\r\n}\r\n\r\n/**\r\n * List all graphs in FalkorDB\r\n */\r\nexport async function listAllFalkorDBGraphs(): Promise<{ ok: boolean; graphs: string[] }> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; graphs: string[] }>('/api/graph/list-all');\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, graphs: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Sync graphs with Supabase projects (cleanup orphans)\r\n * @param dryRun - If true, only report what would be deleted without actually deleting\r\n */\r\nexport async function syncFalkorDBGraphs(dryRun = false): Promise<FalkorDBGraphSyncResult> {\r\n  try {\r\n    const response = await http.post<FalkorDBGraphSyncResult>('/api/graph/sync-projects', { dryRun });\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, error: 'Request failed', graphs: [], validGraphs: [], orphanGraphs: [], deleted: [], dryRun };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a specific graph\r\n */\r\nexport async function deleteFalkorDBGraph(graphName: string): Promise<{ ok: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean; error?: string }>(`/api/graph/delete/${encodeURIComponent(graphName)}`);\r\n    return response.data;\r\n  } catch {\r\n    return { ok: false, error: 'Request failed' };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// ANALYTICS FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get detected communities\r\n */\r\nexport async function getCommunities(): Promise<Community[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; communities: Community[] }>('/api/graphrag/communities');\r\n    return response.data.communities || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get centrality metrics\r\n */\r\nexport async function getCentrality(): Promise<CentralityMetrics> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; centrality: CentralityMetrics }>('/api/graphrag/centrality');\r\n    return response.data.centrality || { topNodes: [] };\r\n  } catch {\r\n    return { topNodes: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Get bridge nodes\r\n */\r\nexport async function getBridges(): Promise<BridgeNode[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; bridges: BridgeNode[] }>('/api/graphrag/bridges');\r\n    return response.data.bridges || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get AI-generated insights\r\n */\r\nexport async function getInsights(): Promise<GraphInsight[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; insights: GraphInsight[] }>('/api/graph/insights');\r\n    return response.data.insights || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// GRAPHRAG / AI FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Query using GraphRAG\r\n */\r\nexport async function graphRAGQuery(query: string, options?: {\r\n  noCache?: boolean;\r\n}): Promise<GraphRAGResponse> {\r\n  try {\r\n    const response = await http.post<GraphRAGResponse>('/api/graphrag/query', {\r\n      query,\r\n      noCache: options?.noCache,\r\n    });\r\n    return response.data;\r\n  } catch (error) {\r\n    return {\r\n      ok: false,\r\n      answer: 'Failed to process query',\r\n      sources: [],\r\n      queryType: 'hybrid',\r\n      latencyMs: 0,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Stream GraphRAG response (for AI Copilot)\r\n */\r\nexport function streamGraphRAGQuery(\r\n  query: string,\r\n  onChunk: (chunk: string) => void,\r\n  onComplete: (response: GraphRAGResponse) => void,\r\n  onError: (error: Error) => void\r\n): () => void {\r\n  const controller = new AbortController();\r\n  \r\n  fetchWithProject('/api/graphrag/stream', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ query }),\r\n    signal: controller.signal,\r\n  })\r\n    .then(async (response) => {\r\n      if (!response.ok) throw new Error('Stream request failed');\r\n      \r\n      const reader = response.body?.getReader();\r\n      if (!reader) throw new Error('No reader available');\r\n      \r\n      const decoder = new TextDecoder();\r\n      let fullResponse = '';\r\n      \r\n      while (true) {\r\n        const { done, value } = await reader.read();\r\n        if (done) break;\r\n        \r\n        const chunk = decoder.decode(value, { stream: true });\r\n        const lines = chunk.split('\\n');\r\n        \r\n        for (const line of lines) {\r\n          if (line.startsWith('data: ')) {\r\n            const data = line.slice(6);\r\n            if (data === '[DONE]') {\r\n              onComplete({\r\n                ok: true,\r\n                answer: fullResponse,\r\n                sources: [],\r\n                queryType: 'hybrid',\r\n                latencyMs: 0,\r\n              });\r\n              return;\r\n            }\r\n            try {\r\n              const parsed = JSON.parse(data);\r\n              if (parsed.content) {\r\n                fullResponse += parsed.content;\r\n                onChunk(parsed.content);\r\n              }\r\n            } catch {\r\n              // Not JSON, treat as raw text\r\n              fullResponse += data;\r\n              onChunk(data);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      if (error.name !== 'AbortError') {\r\n        onError(error);\r\n      }\r\n    });\r\n  \r\n  return () => controller.abort();\r\n}\r\n\r\n/**\r\n * Multi-hop reasoning query\r\n */\r\nexport async function multiHopQuery(query: string): Promise<MultiHopResult> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean } & MultiHopResult>('/api/graphrag/multihop', { query });\r\n    return response.data;\r\n  } catch {\r\n    return {\r\n      answer: 'Failed to process multi-hop query',\r\n      reasoningChain: [],\r\n      confidence: 0,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Explain connection between two nodes (LLM-powered)\r\n */\r\nexport async function explainConnection(nodeId1: string, nodeId2: string): Promise<{\r\n  explanation: string;\r\n  paths: Array<{ nodes: string[]; relationships: string[] }>;\r\n  facts: string[];\r\n}> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      explanation: string;\r\n      paths: Array<{ nodes: string[]; relationships: string[] }>;\r\n      facts: string[];\r\n    }>('/api/graphrag/explain', { nodeId1, nodeId2 });\r\n    return response.data;\r\n  } catch {\r\n    return { explanation: 'Unable to explain connection', paths: [], facts: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Summarize selected nodes (LLM-powered)\r\n */\r\nexport async function summarizeSelection(nodeIds: string[]): Promise<{\r\n  summary: string;\r\n  insights: string[];\r\n  suggestedActions: string[];\r\n}> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      summary: string;\r\n      insights: string[];\r\n      suggestedActions: string[];\r\n    }>('/api/graphrag/summarize', { nodeIds });\r\n    return response.data;\r\n  } catch {\r\n    return { summary: 'Unable to generate summary', insights: [], suggestedActions: [] };\r\n  }\r\n}\r\n\r\n/**\r\n * Natural language filter (LLM-powered)\r\n */\r\nexport async function naturalLanguageFilter(filterText: string): Promise<{\r\n  filters: {\r\n    entityTypes?: string[];\r\n    properties?: Record<string, unknown>;\r\n    cypher?: string;\r\n  };\r\n  explanation: string;\r\n}> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      filters: {\r\n        entityTypes?: string[];\r\n        properties?: Record<string, unknown>;\r\n        cypher?: string;\r\n      };\r\n      explanation: string;\r\n    }>('/api/graphrag/filter', { filterText });\r\n    return response.data;\r\n  } catch {\r\n    return { filters: {}, explanation: 'Unable to parse filter' };\r\n  }\r\n}\r\n\r\n/**\r\n * Suggest related nodes to explore\r\n */\r\nexport async function suggestRelated(nodeId: string): Promise<Array<{\r\n  node: GraphNode;\r\n  reason: string;\r\n  relevance: number;\r\n}>> {\r\n  try {\r\n    const response = await http.post<{\r\n      ok: boolean;\r\n      suggestions: Array<{ node: GraphNode; reason: string; relevance: number }>;\r\n    }>('/api/graphrag/suggest-related', { nodeId });\r\n    return response.data.suggestions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// CYPHER QUERY FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Execute raw Cypher query\r\n */\r\nexport async function executeCypher(cypher: string): Promise<CypherQueryResult> {\r\n  try {\r\n    const response = await http.post<CypherQueryResult>('/api/graph/query', { cypher });\r\n    return response.data;\r\n  } catch (error) {\r\n    return {\r\n      ok: false,\r\n      results: [],\r\n      error: error instanceof Error ? error.message : 'Query failed',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Get query templates\r\n */\r\nexport async function getQueryTemplates(): Promise<Array<{\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  cypher: string;\r\n  category: string;\r\n}>> {\r\n  try {\r\n    const schema = await getOntologySchema();\r\n    if (!schema?.queryPatterns) return [];\r\n    \r\n    return Object.entries(schema.queryPatterns).map(([id, pattern]) => ({\r\n      id,\r\n      name: id.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase()),\r\n      description: pattern.description,\r\n      cypher: pattern.cypher,\r\n      category: 'ontology',\r\n    }));\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// CROSS-PROJECT FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Get list of project graphs\r\n */\r\nexport async function getProjectGraphs(): Promise<Array<{\r\n  graphName: string;\r\n  projectId: string;\r\n  projectName: string;\r\n  nodeCount?: number;\r\n  edgeCount?: number;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; graphs: Array<{\r\n      graphName: string;\r\n      projectId: string;\r\n      projectName: string;\r\n      nodeCount?: number;\r\n      edgeCount?: number;\r\n    }> }>('/api/graph/projects');\r\n    return response.data.graphs || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get cross-project entity (shared entities)\r\n */\r\nexport async function getCrossProjectEntities(entityType: string): Promise<Array<{\r\n  entity: GraphNode;\r\n  projects: Array<{ id: string; name: string }>;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      entities: Array<{ entity: GraphNode; projects: Array<{ id: string; name: string }> }>;\r\n    }>(`/api/graph/cross-project/${entityType}`);\r\n    return response.data.entities || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Query History\r\n// ============================================\r\n\r\n/**\r\n * Save query to history\r\n */\r\nexport async function saveQueryHistory(query: Omit<GraphQueryHistory, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphQueryHistory | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; query: GraphQueryHistory }>('/api/graph/queries', query);\r\n    return response.data.query || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get query history\r\n */\r\nexport async function getQueryHistory(options?: {\r\n  limit?: number;\r\n  favoritesOnly?: boolean;\r\n}): Promise<GraphQueryHistory[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.favoritesOnly) params.set('favorites', 'true');\r\n    \r\n    const response = await http.get<{ ok: boolean; queries: GraphQueryHistory[] }>(\r\n      `/api/graph/queries?${params.toString()}`\r\n    );\r\n    return response.data.queries || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle query favorite\r\n */\r\nexport async function toggleQueryFavorite(queryId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/queries/${queryId}/favorite`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete query from history\r\n */\r\nexport async function deleteQueryHistory(queryId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/queries/${queryId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Saved Views\r\n// ============================================\r\n\r\n/**\r\n * Save current view\r\n */\r\nexport async function saveView(view: Omit<GraphSavedView, 'id' | 'project_id' | 'user_id' | 'created_at' | 'updated_at'>): Promise<GraphSavedView | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; view: GraphSavedView }>('/api/graph/views', view);\r\n    return response.data.view || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get saved views\r\n */\r\nexport async function getSavedViews(): Promise<GraphSavedView[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; views: GraphSavedView[] }>('/api/graph/views');\r\n    return response.data.views || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update saved view\r\n */\r\nexport async function updateView(viewId: string, updates: Partial<GraphSavedView>): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/views/${viewId}`, updates);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete saved view\r\n */\r\nexport async function deleteView(viewId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/views/${viewId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Bookmarks\r\n// ============================================\r\n\r\n/**\r\n * Add bookmark\r\n */\r\nexport async function addBookmark(bookmark: Omit<GraphBookmark, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphBookmark | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; bookmark: GraphBookmark }>('/api/graph/bookmarks', bookmark);\r\n    return response.data.bookmark || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get bookmarks\r\n */\r\nexport async function getBookmarks(): Promise<GraphBookmark[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; bookmarks: GraphBookmark[] }>('/api/graph/bookmarks');\r\n    return response.data.bookmarks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update bookmark\r\n */\r\nexport async function updateBookmark(bookmarkId: string, updates: Partial<GraphBookmark>): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/bookmarks/${bookmarkId}`, updates);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Remove bookmark\r\n */\r\nexport async function removeBookmark(bookmarkId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/bookmarks/${bookmarkId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Annotations\r\n// ============================================\r\n\r\n/**\r\n * Create annotation\r\n */\r\nexport async function createAnnotation(annotation: Omit<GraphAnnotation, 'id' | 'project_id' | 'user_id' | 'created_at' | 'updated_at'>): Promise<GraphAnnotation | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; annotation: GraphAnnotation }>('/api/graph/annotations', annotation);\r\n    return response.data.annotation || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get annotations\r\n */\r\nexport async function getAnnotations(options?: {\r\n  targetType?: string;\r\n  targetId?: string;\r\n  includeShared?: boolean;\r\n}): Promise<GraphAnnotation[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.targetType) params.set('targetType', options.targetType);\r\n    if (options?.targetId) params.set('targetId', options.targetId);\r\n    if (options?.includeShared) params.set('includeShared', 'true');\r\n    \r\n    const response = await http.get<{ ok: boolean; annotations: GraphAnnotation[] }>(\r\n      `/api/graph/annotations?${params.toString()}`\r\n    );\r\n    return response.data.annotations || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Update annotation\r\n */\r\nexport async function updateAnnotation(annotationId: string, updates: Partial<GraphAnnotation>): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/annotations/${annotationId}`, updates);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete annotation\r\n */\r\nexport async function deleteAnnotation(annotationId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/annotations/${annotationId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Chat History\r\n// ============================================\r\n\r\n/**\r\n * Save chat message\r\n */\r\nexport async function saveChatMessage(message: Omit<GraphChatMessage, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphChatMessage | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; message: GraphChatMessage }>('/api/graph/chat', message);\r\n    return response.data.message || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get chat sessions\r\n */\r\nexport async function getChatSessions(): Promise<Array<{\r\n  sessionId: string;\r\n  firstMessage: string;\r\n  messageCount: number;\r\n  lastActivity: string;\r\n}>> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      sessions: Array<{\r\n        sessionId: string;\r\n        firstMessage: string;\r\n        messageCount: number;\r\n        lastActivity: string;\r\n      }>;\r\n    }>('/api/graph/chat/sessions');\r\n    return response.data.sessions || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get chat history for session\r\n */\r\nexport async function getChatHistory(sessionId: string): Promise<GraphChatMessage[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; messages: GraphChatMessage[] }>(\r\n      `/api/graph/chat/session/${sessionId}`\r\n    );\r\n    return response.data.messages || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle message pin\r\n */\r\nexport async function toggleChatPin(messageId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.patch<{ ok: boolean }>(`/api/graph/chat/${messageId}/pin`, {});\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SUPABASE PERSISTENCE - Snapshots\r\n// ============================================\r\n\r\n/**\r\n * Create snapshot\r\n */\r\nexport async function createSnapshot(snapshot: Omit<GraphSnapshot, 'id' | 'project_id' | 'user_id' | 'created_at'>): Promise<GraphSnapshot | null> {\r\n  try {\r\n    const response = await http.post<{ ok: boolean; snapshot: GraphSnapshot }>('/api/graph/snapshots', snapshot);\r\n    return response.data.snapshot || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get snapshots\r\n */\r\nexport async function getSnapshots(): Promise<GraphSnapshot[]> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; snapshots: GraphSnapshot[] }>('/api/graph/snapshots');\r\n    return response.data.snapshots || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get snapshot by ID\r\n */\r\nexport async function getSnapshot(snapshotId: string): Promise<GraphSnapshot | null> {\r\n  try {\r\n    const response = await http.get<{ ok: boolean; snapshot: GraphSnapshot }>(`/api/graph/snapshots/${snapshotId}`);\r\n    return response.data.snapshot || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Compare snapshots\r\n */\r\nexport async function compareSnapshots(snapshotId1: string, snapshotId2: string): Promise<{\r\n  diff: {\r\n    nodesAdded: GraphNode[];\r\n    nodesRemoved: GraphNode[];\r\n    edgesAdded: GraphEdge[];\r\n    edgesRemoved: GraphEdge[];\r\n    statsComparison: {\r\n      nodeCountDiff: number;\r\n      edgeCountDiff: number;\r\n    };\r\n  };\r\n}> {\r\n  try {\r\n    const response = await http.get<{\r\n      ok: boolean;\r\n      diff: {\r\n        nodesAdded: GraphNode[];\r\n        nodesRemoved: GraphNode[];\r\n        edgesAdded: GraphEdge[];\r\n        edgesRemoved: GraphEdge[];\r\n        statsComparison: { nodeCountDiff: number; edgeCountDiff: number };\r\n      };\r\n    }>(`/api/graph/snapshots/compare?id1=${snapshotId1}&id2=${snapshotId2}`);\r\n    return response.data;\r\n  } catch {\r\n    return {\r\n      diff: {\r\n        nodesAdded: [],\r\n        nodesRemoved: [],\r\n        edgesAdded: [],\r\n        edgesRemoved: [],\r\n        statsComparison: { nodeCountDiff: 0, edgeCountDiff: 0 },\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete snapshot\r\n */\r\nexport async function deleteSnapshot(snapshotId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ ok: boolean }>(`/api/graph/snapshots/${snapshotId}`);\r\n    return response.data.ok;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// TIMELINE FUNCTIONS (existing)\r\n// ============================================\r\n\r\nexport async function getTimeline(options?: {\r\n  startDate?: string;\r\n  endDate?: string;\r\n  types?: string[];\r\n  limit?: number;\r\n}): Promise<TimelineData> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.startDate) params.set('startDate', options.startDate);\r\n    if (options?.endDate) params.set('endDate', options.endDate);\r\n    if (options?.types?.length) params.set('types', options.types.join(','));\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/timeline?${query}` : '/api/timeline';\r\n\r\n    const response = await http.get<{\r\n      events?: Array<Record<string, unknown>>;\r\n      totalEvents?: number;\r\n      startDate?: string;\r\n      endDate?: string;\r\n    }>(url);\r\n\r\n    const raw = response.data.events || [];\r\n    const events: TimelineEvent[] = raw.map((e: Record<string, unknown>) => ({\r\n      id: String(e.id ?? ''),\r\n      date: String(e.date ?? ''),\r\n      title: String(e.title ?? ''),\r\n      description: e.content != null ? String(e.content) : undefined,\r\n      content: e.content != null ? String(e.content) : undefined,\r\n      type: (e.type as TimelineEvent['type']) ?? 'document',\r\n      entity_id: e.entity_id != null ? String(e.entity_id) : undefined,\r\n      entity_type: e.entity_type != null ? String(e.entity_type) : undefined,\r\n      metadata: (e.metadata as Record<string, unknown>) ?? undefined,\r\n      user: e.owner != null ? String(e.owner) : e.user as string | undefined,\r\n      actor: e.owner != null ? String(e.owner) : e.actor as string | undefined,\r\n      owner: e.owner != null ? String(e.owner) : undefined,\r\n      icon: e.icon as string | undefined,\r\n      color: e.color as string | undefined,\r\n      status: e.status as string | undefined,\r\n    }));\r\n\r\n    return {\r\n      events,\r\n      totalEvents: response.data.totalEvents ?? events.length,\r\n      startDate: response.data.startDate ?? '',\r\n      endDate: response.data.endDate ?? '',\r\n    };\r\n  } catch {\r\n    return { events: [], startDate: '', endDate: '', totalEvents: 0 };\r\n  }\r\n}\r\n\r\nexport async function getEntityTimeline(entityType: string, entityId: string): Promise<TimelineEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: TimelineEvent[] }>(`/api/timeline/${entityType}/${entityId}`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n// ============================================\r\n// COST FUNCTIONS (existing)\r\n// ============================================\r\n\r\nexport async function getCosts(options?: {\r\n  startDate?: string;\r\n  endDate?: string;\r\n  provider?: string;\r\n  model?: string;\r\n}): Promise<LLMCost[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.startDate) params.set('startDate', options.startDate);\r\n    if (options?.endDate) params.set('endDate', options.endDate);\r\n    if (options?.provider) params.set('provider', options.provider);\r\n    if (options?.model) params.set('model', options.model);\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/costs?${query}` : '/api/costs';\r\n\r\n    const response = await http.get<{ costs: LLMCost[] }>(url);\r\n    return response.data.costs || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getCostSummary(period?: 'day' | 'week' | 'month' | 'all'): Promise<CostSummary> {\r\n  try {\r\n    const url = period ? `/api/costs/summary?period=${period}` : '/api/costs/summary';\r\n    const response = await http.get<Record<string, unknown>>(url);\r\n    const raw = response.data;\r\n    if (!raw) {\r\n      return {\r\n        total: 0,\r\n        byProvider: {},\r\n        byModel: {},\r\n        byOperation: {},\r\n        period: { start: '', end: '' },\r\n        dailyBreakdown: [],\r\n      };\r\n    }\r\n    // Normalize snake_case from API to camelCase for frontend\r\n    const dailyBreakdown = (raw.dailyBreakdown ?? raw.daily_breakdown) as Array<{ date: string; cost: number; calls?: number; requests?: number }> | undefined;\r\n    const normalized = (dailyBreakdown ?? []).map((d) => ({\r\n      date: d.date,\r\n      cost: typeof d.cost === 'number' ? d.cost : parseFloat(String(d.cost)) || 0,\r\n      calls: d.calls ?? d.requests ?? 0,\r\n    }));\r\n    return {\r\n      total: typeof raw.total === 'number' ? raw.total : parseFloat(String(raw.total)) || 0,\r\n      byProvider: (raw.byProvider ?? raw.by_provider ?? {}) as Record<string, number>,\r\n      byModel: (raw.byModel ?? raw.by_model ?? {}) as Record<string, number>,\r\n      byOperation: (raw.byOperation ?? raw.by_operation ?? {}) as Record<string, number>,\r\n      byContext: (raw.byContext ?? raw.by_context) as Record<string, number> | undefined,\r\n      period: (raw.period ?? { start: '', end: '' }) as { start: string; end: string },\r\n      dailyBreakdown: normalized,\r\n      totalInputTokens: (raw.totalInputTokens ?? raw.total_input_tokens) as number | undefined,\r\n      totalOutputTokens: (raw.totalOutputTokens ?? raw.total_output_tokens) as number | undefined,\r\n      previousPeriodCost: (raw.previousPeriodCost ?? raw.previous_period_cost) as number | null | undefined,\r\n      percentChange: (raw.percentChange ?? raw.percent_change) as number | null | undefined,\r\n      budgetLimit: (raw.budgetLimit ?? raw.budget_limit) as number | null | undefined,\r\n      budgetUsedPercent: (raw.budgetUsedPercent ?? raw.budget_used_percent) as number | null | undefined,\r\n      budgetAlertTriggered: (raw.budgetAlertTriggered ?? raw.budget_alert_triggered) as boolean | undefined,\r\n    };\r\n  } catch {\r\n    return {\r\n      total: 0,\r\n      byProvider: {},\r\n      byModel: {},\r\n      byOperation: {},\r\n      period: { start: '', end: '' },\r\n      dailyBreakdown: [],\r\n    };\r\n  }\r\n}\r\n\r\nexport interface RecentCostRequest {\r\n  id: string;\r\n  timestamp: string;\r\n  provider: string;\r\n  model: string;\r\n  operation?: string;\r\n  request_type?: string | null;\r\n  input_tokens?: number;\r\n  output_tokens?: number;\r\n  cost?: number;\r\n  latency_ms?: number | null;\r\n  success?: boolean;\r\n}\r\n\r\nexport async function getRecentCostRequests(limit = 20): Promise<RecentCostRequest[]> {\r\n  try {\r\n    const response = await http.get<{ requests: RecentCostRequest[] }>(\r\n      `/api/costs/recent?limit=${limit}`\r\n    );\r\n    return response.data?.requests ?? [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface PricingRow {\r\n  model: string;\r\n  inputPer1M: number;\r\n  outputPer1M: number;\r\n}\r\n\r\nexport async function getCostsPricing(): Promise<PricingRow[]> {\r\n  try {\r\n    const response = await http.get<{ pricing: PricingRow[] }>('/api/costs/pricing');\r\n    return response.data?.pricing ?? [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface CostBudget {\r\n  period: 'week' | 'month';\r\n  limitUsd: number;\r\n  alertThresholdPercent: number;\r\n  notifiedAt?: string | null;\r\n}\r\n\r\nexport async function getCostsBudget(period: 'week' | 'month'): Promise<CostBudget | null> {\r\n  try {\r\n    const response = await http.get<{ budget: Record<string, unknown> | null }>(\r\n      `/api/costs/budget?period=${period}`\r\n    );\r\n    const raw = response.data?.budget;\r\n    if (!raw) return null;\r\n    const limitUsd = (raw.limitUsd ?? raw.limit_usd) as number | undefined;\r\n    const alertThresholdPercent = (raw.alertThresholdPercent ?? raw.alert_threshold_percent) as number | undefined;\r\n    if (limitUsd == null || !Number.isFinite(Number(limitUsd))) return null;\r\n    return {\r\n      period: (raw.period as 'week' | 'month') ?? period,\r\n      limitUsd: Number(limitUsd),\r\n      alertThresholdPercent: alertThresholdPercent != null ? Math.min(100, Math.max(0, Number(alertThresholdPercent))) : 80,\r\n      notifiedAt: (raw.notifiedAt ?? raw.notified_at) as string | null | undefined,\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function setCostsBudget(\r\n  period: 'week' | 'month',\r\n  limitUsd: number,\r\n  alertThresholdPercent: number\r\n): Promise<void> {\r\n  await http.post('/api/costs/budget', {\r\n    period,\r\n    limitUsd,\r\n    alertThresholdPercent,\r\n  });\r\n}\r\n\r\nexport async function getLLMConfig(): Promise<{\r\n  provider: string;\r\n  model: string;\r\n  available: string[];\r\n  limits?: Record<string, number>;\r\n}> {\r\n  try {\r\n    const response = await http.get<{\r\n      provider: string;\r\n      model: string;\r\n      available: string[];\r\n      limits?: Record<string, number>;\r\n    }>('/api/llm/config');\r\n    return response.data;\r\n  } catch {\r\n    return { provider: 'unknown', model: 'unknown', available: [] };\r\n  }\r\n}\r\n\r\n// ============================================\r\n// SERVICE EXPORTS\r\n// ============================================\r\n\r\nexport const graphService = {\r\n  // Data\r\n  getVisualizationData,\r\n  getStats,\r\n  getGraph,\r\n  getEntityGraph,\r\n  getRelated: getRelatedEntities,\r\n  \r\n  // Ontology\r\n  getOntologySchema,\r\n  getOntologyEntities,\r\n  getOntologyRelations,\r\n  getOntologySuggestions,\r\n  approveOntologySuggestion,\r\n  rejectOntologySuggestion,\r\n  \r\n  // Ontology SOTA v2.0\r\n  getOntologyTypeStats,\r\n  getOntologySyncStatus,\r\n  forceOntologySync,\r\n  runLLMAnalysis,\r\n  autoApproveHighConfidence,\r\n  getOntologyChanges,\r\n  migrateOntologyToSupabase,\r\n  \r\n  // Background Worker (SOTA v2.1)\r\n  getBackgroundWorkerStatus,\r\n  triggerBackgroundAnalysis,\r\n  getBackgroundWorkerLog,\r\n  getOntologyJobs,\r\n  toggleOntologyJob,\r\n  \r\n  // Ontology Extractor (SOTA v2.1)\r\n  extractOntologyFromGraph,\r\n  validateOntologyCompliance,\r\n  getOntologyDiff,\r\n  findUnusedOntologyTypes,\r\n  mergeOntology,\r\n  cleanupOntology,\r\n  getFalkorDBBrowserInfo,\r\n  \r\n  // Graph Management (legacy names kept for compatibility)\r\n  listAllFalkorDBGraphs,\r\n  syncFalkorDBGraphs,\r\n  deleteFalkorDBGraph,\r\n  \r\n  // Analytics\r\n  getCommunities,\r\n  getCentrality,\r\n  getBridges,\r\n  getInsights,\r\n  \r\n  // GraphRAG / AI\r\n  query: graphRAGQuery,\r\n  stream: streamGraphRAGQuery,\r\n  multiHop: multiHopQuery,\r\n  explainConnection,\r\n  summarizeSelection,\r\n  naturalLanguageFilter,\r\n  suggestRelated,\r\n  \r\n  // Cypher\r\n  executeCypher,\r\n  getQueryTemplates,\r\n  \r\n  // Cross-project\r\n  getProjectGraphs,\r\n  getCrossProjectEntities,\r\n  \r\n  // Persistence - Queries\r\n  saveQueryHistory,\r\n  getQueryHistory,\r\n  toggleQueryFavorite,\r\n  deleteQueryHistory,\r\n  \r\n  // Persistence - Views\r\n  saveView,\r\n  getSavedViews,\r\n  updateView,\r\n  deleteView,\r\n  \r\n  // Persistence - Bookmarks\r\n  addBookmark,\r\n  getBookmarks,\r\n  updateBookmark,\r\n  removeBookmark,\r\n  \r\n  // Persistence - Annotations\r\n  createAnnotation,\r\n  getAnnotations,\r\n  updateAnnotation,\r\n  deleteAnnotation,\r\n  \r\n  // Persistence - Chat\r\n  saveChatMessage,\r\n  getChatSessions,\r\n  getChatHistory,\r\n  toggleChatPin,\r\n  \r\n  // Persistence - Snapshots\r\n  createSnapshot,\r\n  getSnapshots,\r\n  getSnapshot,\r\n  compareSnapshots,\r\n  deleteSnapshot,\r\n};\r\n\r\nexport const timelineService = {\r\n  getAll: getTimeline,\r\n  getTimeline, // Direct export for backwards compatibility\r\n  getForEntity: getEntityTimeline,\r\n};\r\n\r\nexport const costsService = {\r\n  getAll: getCosts,\r\n  getSummary: getCostSummary,\r\n  getRecentRequests: getRecentCostRequests,\r\n  getPricing: getCostsPricing,\r\n  getBudget: getCostsBudget,\r\n  setBudget: setCostsBudget,\r\n  getLLMConfig,\r\n};\r\n","/**\r\n * Notifications Service\r\n * Handles notifications and collaboration features\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  type: 'info' | 'warning' | 'success' | 'error' | 'mention' | 'assignment' | 'update' | 'reminder';\r\n  title: string;\r\n  message: string;\r\n  entity_type?: 'question' | 'risk' | 'action' | 'decision' | 'document' | 'contact' | 'project';\r\n  entity_id?: string;\r\n  is_read: boolean;\r\n  read?: boolean; // Alias for is_read\r\n  created_at: string;\r\n  read_at?: string;\r\n  action_url?: string;\r\n}\r\n\r\nexport interface Comment {\r\n  id: string;\r\n  entity_type: 'question' | 'risk' | 'action' | 'decision' | 'document' | 'contact';\r\n  entity_id: string;\r\n  content: string;\r\n  author: string;\r\n  author_id?: string;\r\n  user_id?: string;\r\n  user_name?: string;\r\n  mentions?: string[];\r\n  reactions?: Array<{\r\n    emoji: string;\r\n    users: string[];\r\n  }>;\r\n  parent_id?: string;\r\n  replies?: Comment[];\r\n  resolved?: boolean;\r\n  resolved_at?: string;\r\n  resolved_by?: string;\r\n  created_at: string;\r\n  updated_at?: string;\r\n  is_edited: boolean;\r\n}\r\n\r\nexport interface ProjectMember {\r\n  id: string;\r\n  user_id: string;\r\n  project_id: string;\r\n  role: 'owner' | 'admin' | 'editor' | 'viewer';\r\n  email: string;\r\n  name?: string;\r\n  avatar_url?: string;\r\n  joined_at: string;\r\n  invited_by?: string;\r\n  last_active?: string;\r\n}\r\n\r\n/**\r\n * Get all notifications\r\n */\r\nexport async function getNotifications(options?: {\r\n  unread?: boolean;\r\n  type?: string;\r\n  limit?: number;\r\n}): Promise<Notification[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.unread) params.set('unread', 'true');\r\n    if (options?.type) params.set('type', options.type);\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/notifications?${query}` : '/api/notifications';\r\n\r\n    const response = await http.get<{ notifications: Notification[] }>(url);\r\n    return response.data.notifications || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get unread count\r\n */\r\nexport async function getUnreadCount(): Promise<number> {\r\n  try {\r\n    const response = await http.get<{ count: number }>('/api/notifications/count');\r\n    return response.data.count || 0;\r\n  } catch {\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Mark notification as read\r\n */\r\nexport async function markAsRead(id: string): Promise<void> {\r\n  await http.post(`/api/notifications/${id}/read`);\r\n}\r\n\r\n/**\r\n * Mark all as read\r\n */\r\nexport async function markAllAsRead(): Promise<void> {\r\n  await http.post('/api/notifications/read-all');\r\n}\r\n\r\n/**\r\n * Delete a notification\r\n */\r\nexport async function deleteNotification(id: string): Promise<void> {\r\n  await http.delete(`/api/notifications/${id}`);\r\n}\r\n\r\n/**\r\n * Get comments for an entity\r\n */\r\nexport async function getComments(entityType: string, entityId: string): Promise<Comment[]> {\r\n  try {\r\n    const response = await http.get<{ comments: Comment[] }>(`/api/comments/${entityType}/${entityId}`);\r\n    return response.data.comments || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Add a comment\r\n */\r\nexport async function addComment(entityType: string, entityId: string, content: string, parentId?: string): Promise<Comment> {\r\n  const response = await http.post<{ comment: Comment; id: string }>(`/api/comments/${entityType}/${entityId}`, {\r\n    content,\r\n    parentId,\r\n  });\r\n  return response.data.comment || {\r\n    id: response.data.id,\r\n    entity_type: entityType as Comment['entity_type'],\r\n    entity_id: entityId,\r\n    content,\r\n    author: 'You',\r\n    created_at: new Date().toISOString(),\r\n    is_edited: false,\r\n  };\r\n}\r\n\r\n/**\r\n * Update a comment\r\n */\r\nexport async function updateComment(commentId: string, content: string): Promise<void> {\r\n  await http.put(`/api/comments/${commentId}`, { content });\r\n}\r\n\r\n/**\r\n * Delete a comment\r\n */\r\nexport async function deleteComment(commentId: string): Promise<void> {\r\n  await http.delete(`/api/comments/${commentId}`);\r\n}\r\n\r\n/**\r\n * Add reaction to comment\r\n */\r\nexport async function addReaction(commentId: string, emoji: string): Promise<void> {\r\n  await http.post(`/api/comments/${commentId}/react`, { emoji });\r\n}\r\n\r\n/**\r\n * Remove reaction from comment\r\n */\r\nexport async function removeReaction(commentId: string, emoji: string): Promise<void> {\r\n  await http.delete(`/api/comments/${commentId}/react/${emoji}`);\r\n}\r\n\r\n/**\r\n * Create comment (alias for addComment)\r\n */\r\nexport async function createComment(entityType: string, entityId: string, content: string, parentId?: string): Promise<Comment> {\r\n  return addComment(entityType, entityId, content, parentId);\r\n}\r\n\r\n/**\r\n * Resolve a comment thread\r\n */\r\nexport async function resolveComment(commentId: string): Promise<void> {\r\n  await http.put(`/api/comments/${commentId}/resolve`);\r\n}\r\n\r\n/**\r\n * Get project members\r\n */\r\nexport async function getProjectMembers(projectId?: string): Promise<ProjectMember[]> {\r\n  try {\r\n    const url = projectId ? `/api/projects/${projectId}/members` : '/api/project/members';\r\n    const response = await http.get<{ members: ProjectMember[] }>(url);\r\n    return response.data.members || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Invite member to project\r\n */\r\nexport async function inviteMember(email: string, role: 'admin' | 'editor' | 'viewer', projectId?: string): Promise<{ success: boolean; inviteId: string }> {\r\n  const url = projectId ? `/api/projects/${projectId}/members` : '/api/project/members';\r\n  const response = await http.post<{ success: boolean; inviteId: string }>(url, { email, role });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Update member role\r\n */\r\nexport async function updateMemberRole(memberId: string, role: 'admin' | 'editor' | 'viewer', projectId?: string): Promise<void> {\r\n  const url = projectId ? `/api/projects/${projectId}/members/${memberId}` : `/api/project/members/${memberId}`;\r\n  await http.put(url, { role });\r\n}\r\n\r\n/**\r\n * Remove member from project\r\n */\r\nexport async function removeMember(memberId: string, projectId?: string): Promise<void> {\r\n  const url = projectId ? `/api/projects/${projectId}/members/${memberId}` : `/api/project/members/${memberId}`;\r\n  await http.delete(url);\r\n}\r\n\r\nexport const notificationsService = {\r\n  getAll: getNotifications,\r\n  getUnreadCount,\r\n  markAsRead,\r\n  markRead: markAsRead, // Alias\r\n  markAllAsRead,\r\n  markAllRead: markAllAsRead, // Alias\r\n  delete: deleteNotification,\r\n};\r\n\r\nexport const commentsService = {\r\n  getAll: getComments,\r\n  add: addComment,\r\n  create: createComment,\r\n  update: updateComment,\r\n  delete: deleteComment,\r\n  addReaction,\r\n  removeReaction,\r\n  resolve: resolveComment,\r\n};\r\n\r\nexport interface PendingInvite {\r\n  id: string;\r\n  email: string;\r\n  role: 'admin' | 'editor' | 'viewer';\r\n  invited_at: string;\r\n  created_at?: string;\r\n  invited_by?: string;\r\n  status: 'pending' | 'accepted' | 'expired';\r\n}\r\n\r\n/**\r\n * Get pending invites for a project\r\n */\r\nexport async function getInvites(projectId?: string): Promise<PendingInvite[]> {\r\n  try {\r\n    const url = projectId ? `/api/projects/${projectId}/invites` : '/api/project/invites';\r\n    const response = await http.get<{ invites: PendingInvite[] }>(url);\r\n    return response.data.invites || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport const membersService = {\r\n  getAll: getProjectMembers,\r\n  invite: inviteMember,\r\n  updateRole: updateMemberRole,\r\n  remove: removeMember,\r\n  getInvites,\r\n};\r\n","/**\r\n * Settings Service\r\n * Handles user settings, API keys, webhooks, and audit logs\r\n */\r\n\r\nimport { http, fetchWithProject } from './api';\r\n\r\nexport interface UserSettings {\r\n  theme?: 'light' | 'dark' | 'system';\r\n  language?: string;\r\n  timezone?: string;\r\n  notifications?: {\r\n    email: boolean;\r\n    browser: boolean;\r\n    mentions: boolean;\r\n    updates: boolean;\r\n  };\r\n  display?: {\r\n    density: 'compact' | 'comfortable' | 'spacious';\r\n    sidebarCollapsed: boolean;\r\n  };\r\n  ai?: {\r\n    model?: string;\r\n    temperature?: number;\r\n    autoSuggest: boolean;\r\n  };\r\n}\r\n\r\nexport interface ProjectSettings {\r\n  name: string;\r\n  description?: string;\r\n  userRole?: string;\r\n  userRolePrompt?: string;\r\n  llm?: {\r\n    provider: string;\r\n    model: string;\r\n  };\r\n  processing?: {\r\n    autoExtractFacts: boolean;\r\n    autoCreateQuestions: boolean;\r\n    deduplication: boolean;\r\n  };\r\n  notifications?: {\r\n    dailyBriefing: boolean;\r\n    overdueAlerts: boolean;\r\n  };\r\n}\r\n\r\nexport interface APIKey {\r\n  id: string;\r\n  name: string;\r\n  key_prefix: string;\r\n  permissions: string[];\r\n  last_used?: string;\r\n  expires_at?: string;\r\n  created_at: string;\r\n  is_active: boolean;\r\n}\r\n\r\nexport interface Webhook {\r\n  id: string;\r\n  name: string;\r\n  url: string;\r\n  events: string[];\r\n  secret?: string;\r\n  is_active: boolean;\r\n  last_triggered?: string;\r\n  failure_count: number;\r\n  created_at: string;\r\n}\r\n\r\nexport interface AuditLogEntry {\r\n  id: string;\r\n  action: string;\r\n  entity_type: string;\r\n  entity_id: string;\r\n  user_id?: string;\r\n  user_email?: string;\r\n  changes?: Record<string, { old: unknown; new: unknown }>;\r\n  metadata?: Record<string, unknown>;\r\n  ip_address?: string;\r\n  user_agent?: string;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Get user settings\r\n */\r\nexport async function getUserSettings(): Promise<UserSettings> {\r\n  try {\r\n    const response = await http.get<UserSettings>('/api/settings');\r\n    return response.data;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Update user settings\r\n */\r\nexport async function updateUserSettings(settings: Partial<UserSettings>): Promise<void> {\r\n  await http.put('/api/settings', settings);\r\n}\r\n\r\n/**\r\n * Get project settings\r\n */\r\nexport async function getProjectSettings(projectId?: string): Promise<ProjectSettings | null> {\r\n  try {\r\n    const url = projectId ? `/api/projects/${projectId}/settings` : '/api/project/settings';\r\n    const response = await http.get<{ settings: ProjectSettings }>(url);\r\n    return response.data.settings;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Update project settings\r\n */\r\nexport async function updateProjectSettings(settings: Partial<ProjectSettings>, projectId?: string): Promise<void> {\r\n  const url = projectId ? `/api/projects/${projectId}/settings` : '/api/project/settings';\r\n  await http.put(url, settings);\r\n}\r\n\r\n/**\r\n * Get API keys\r\n */\r\nexport async function getAPIKeys(): Promise<APIKey[]> {\r\n  try {\r\n    const response = await http.get<{ keys: APIKey[] }>('/api/api-keys');\r\n    return response.data.keys || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Create API key\r\n */\r\nexport async function createAPIKey(name: string, permissions: string[]): Promise<{ key: string; id: string }> {\r\n  const response = await http.post<{ key: string; id: string }>('/api/api-keys', { name, permissions });\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Revoke API key\r\n */\r\nexport async function revokeAPIKey(id: string): Promise<void> {\r\n  await http.delete(`/api/api-keys/${id}`);\r\n}\r\n\r\n/**\r\n * Get webhooks\r\n */\r\nexport async function getWebhooks(): Promise<Webhook[]> {\r\n  try {\r\n    const response = await http.get<{ webhooks: Webhook[] }>('/api/webhooks');\r\n    return response.data.webhooks || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Create webhook\r\n */\r\nexport async function createWebhook(webhook: {\r\n  name: string;\r\n  url: string;\r\n  events: string[];\r\n  secret?: string;\r\n}): Promise<Webhook> {\r\n  const response = await http.post<{ webhook: Webhook; id: string }>('/api/webhooks', webhook);\r\n  return response.data.webhook || { ...webhook, id: response.data.id, is_active: true, failure_count: 0, created_at: new Date().toISOString() };\r\n}\r\n\r\n/**\r\n * Update webhook\r\n */\r\nexport async function updateWebhook(id: string, updates: Partial<Webhook>): Promise<void> {\r\n  await http.put(`/api/webhooks/${id}`, updates);\r\n}\r\n\r\n/**\r\n * Delete webhook\r\n */\r\nexport async function deleteWebhook(id: string): Promise<void> {\r\n  await http.delete(`/api/webhooks/${id}`);\r\n}\r\n\r\n/**\r\n * Test webhook\r\n */\r\nexport async function testWebhook(id: string): Promise<{ success: boolean; status: number; response?: string }> {\r\n  const response = await http.post<{ success: boolean; status: number; response?: string }>(`/api/webhooks/${id}/test`);\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Get audit logs\r\n */\r\nexport async function getAuditLogs(options?: {\r\n  action?: string;\r\n  entity_type?: string;\r\n  user_id?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  limit?: number;\r\n  offset?: number;\r\n}): Promise<{ logs: AuditLogEntry[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.action) params.set('action', options.action);\r\n    if (options?.entity_type) params.set('entity_type', options.entity_type);\r\n    if (options?.user_id) params.set('user_id', options.user_id);\r\n    if (options?.startDate) params.set('startDate', options.startDate);\r\n    if (options?.endDate) params.set('endDate', options.endDate);\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.offset) params.set('offset', String(options.offset));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/audit?${query}` : '/api/audit';\r\n\r\n    const response = await http.get<{ logs: AuditLogEntry[]; total: number }>(url);\r\n    return response.data;\r\n  } catch {\r\n    return { logs: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Export audit logs\r\n */\r\nexport async function exportAuditLogs(format: 'json' | 'csv', options?: {\r\n  startDate?: string;\r\n  endDate?: string;\r\n}): Promise<Blob> {\r\n  const params = new URLSearchParams();\r\n  params.set('format', format);\r\n  if (options?.startDate) params.set('startDate', options.startDate);\r\n  if (options?.endDate) params.set('endDate', options.endDate);\r\n\r\n  const response = await fetchWithProject(`/api/audit/export?${params.toString()}`);\r\n  if (!response.ok) throw new Error('Export failed');\r\n  return response.blob();\r\n}\r\n\r\nexport const userSettingsService = {\r\n  get: getUserSettings,\r\n  update: updateUserSettings,\r\n};\r\n\r\nexport const projectSettingsService = {\r\n  get: getProjectSettings,\r\n  update: updateProjectSettings,\r\n};\r\n\r\nexport const apiKeysService = {\r\n  getAll: getAPIKeys,\r\n  create: createAPIKey,\r\n  revoke: revokeAPIKey,\r\n};\r\n\r\nexport const webhooksService = {\r\n  getAll: getWebhooks,\r\n  create: createWebhook,\r\n  update: updateWebhook,\r\n  delete: deleteWebhook,\r\n  test: testWebhook,\r\n};\r\n\r\nexport const auditService = {\r\n  getAll: getAuditLogs,\r\n  export: exportAuditLogs,\r\n};\r\n","/**\n * Profile Service\n * Handles user profile management\n */\n\nimport { http, fetchWithProject } from './api';\nimport { appStore, User } from '../stores/app';\n\nexport interface UserProfile {\n  id: string;\n  email: string;\n  username?: string;\n  display_name?: string;\n  avatar_url?: string;\n  timezone?: string;\n  locale?: string;\n  bio?: string;\n  role?: 'user' | 'admin' | 'superadmin';\n  preferences?: Record<string, unknown>;\n  created_at: string;\n  updated_at?: string;\n}\n\nexport interface UpdateProfileRequest {\n  username?: string;\n  display_name?: string;\n  avatar_url?: string;\n  timezone?: string;\n  locale?: string;\n  bio?: string;\n  preferences?: Record<string, unknown>;\n}\n\nexport interface ChangePasswordRequest {\n  current_password: string;\n  new_password: string;\n}\n\n/**\n * Get current user profile\n */\nexport async function getProfile(): Promise<UserProfile | null> {\n  try {\n    const response = await http.get<{ profile: UserProfile }>('/api/profile');\n    return response.data.profile;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Update user profile\n */\nexport async function updateProfile(data: UpdateProfileRequest): Promise<UserProfile> {\n  const response = await http.put<{ profile: UserProfile }>('/api/profile', data);\n  \n  // Update app store with new user info\n  const currentUser = appStore.getState().currentUser;\n  if (currentUser) {\n    appStore.setCurrentUser({\n      ...currentUser,\n      name: data.display_name || currentUser.name,\n      avatar: data.avatar_url || currentUser.avatar,\n    });\n  }\n  \n  return response.data.profile;\n}\n\n/**\n * Upload avatar\n */\nexport async function uploadAvatar(file: File): Promise<string> {\n  const formData = new FormData();\n  formData.append('avatar', file);\n\n  const response = await fetchWithProject('/api/profile/avatar', {\n    method: 'POST',\n    body: formData,\n  });\n\n  if (!response.ok) {\n    throw new Error('Avatar upload failed');\n  }\n\n  const data = await response.json();\n  \n  // Update app store\n  const currentUser = appStore.getState().currentUser;\n  if (currentUser) {\n    appStore.setCurrentUser({\n      ...currentUser,\n      avatar: data.avatar_url,\n    });\n  }\n  \n  return data.avatar_url;\n}\n\n/**\n * Remove avatar\n */\nexport async function removeAvatar(): Promise<void> {\n  await http.delete('/api/profile/avatar');\n  \n  // Update app store\n  const currentUser = appStore.getState().currentUser;\n  if (currentUser) {\n    appStore.setCurrentUser({\n      ...currentUser,\n      avatar: undefined,\n    });\n  }\n}\n\n/**\n * Change password\n */\nexport async function changePassword(data: ChangePasswordRequest): Promise<void> {\n  if (data.new_password.length < 12) {\n    throw new Error('New password must be at least 12 characters');\n  }\n\n  await http.post('/api/profile/change-password', data);\n}\n\n/**\n * Delete account\n */\nexport async function deleteAccount(password: string): Promise<void> {\n  await http.post('/api/profile/delete', { password });\n  appStore.setCurrentUser(null);\n  appStore.setCurrentProject(null);\n}\n\n/**\n * Get user activity\n */\nexport async function getActivity(limit = 50): Promise<Array<{\n  type: string;\n  action: string;\n  entity_type: string;\n  entity_id: string;\n  timestamp: string;\n}>> {\n  try {\n    const response = await http.get<{ activities: Array<{\n      type: string;\n      action: string;\n      entity_type: string;\n      entity_id: string;\n      timestamp: string;\n    }> }>(`/api/profile/activity?limit=${limit}`);\n    return response.data.activities || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Get user sessions\n */\nexport async function getSessions(): Promise<Array<{\n  id: string;\n  device: string;\n  location?: string;\n  ip_address: string;\n  last_active: string;\n  is_current: boolean;\n}>> {\n  try {\n    const response = await http.get<{ sessions: Array<{\n      id: string;\n      device: string;\n      location?: string;\n      ip_address: string;\n      last_active: string;\n      is_current: boolean;\n    }> }>('/api/profile/sessions');\n    return response.data.sessions || [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Revoke a session\n */\nexport async function revokeSession(sessionId: string): Promise<void> {\n  await http.delete(`/api/profile/sessions/${sessionId}`);\n}\n\n/**\n * Revoke all other sessions\n */\nexport async function revokeAllSessions(): Promise<void> {\n  await http.post('/api/profile/sessions/revoke-all');\n}\n\nexport const profileService = {\n  get: getProfile,\n  update: updateProfile,\n  uploadAvatar,\n  removeAvatar,\n  changePassword,\n  deleteAccount,\n  getActivity,\n  getSessions,\n  revokeSession,\n  revokeAllSessions,\n};\n","/**\r\n * Facts Service\r\n * Handles facts CRUD and conflict detection\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Fact {\r\n  id: string | number;\r\n  content: string;\r\n  source?: string;\r\n  source_file?: string;\r\n  source_document_id?: string;\r\n  category?: string;\r\n  confidence?: number;\r\n  verified?: boolean;\r\n  verified_by?: string;\r\n  verified_at?: string;\r\n  created_at: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface CreateFactRequest {\r\n  content: string;\r\n  source?: string;\r\n  category?: string;\r\n  verified?: boolean;\r\n}\r\n\r\nexport interface UpdateFactRequest {\r\n  content?: string;\r\n  source?: string;\r\n  category?: string;\r\n  verified?: boolean;\r\n}\r\n\r\nexport interface FactConflict {\r\n  factId1: string | number;\r\n  factId2: string | number;\r\n  fact1: Fact;\r\n  fact2: Fact;\r\n  conflictType: 'contradiction' | 'inconsistency' | 'outdated' | 'process';\r\n  description?: string;\r\n  reason?: string;\r\n  confidence?: number;\r\n}\r\n\r\n/**\r\n * Get all facts\r\n */\r\nexport async function getFacts(options?: {\r\n  limit?: number;\r\n  offset?: number;\r\n  search?: string;\r\n  category?: string;\r\n  verified?: boolean;\r\n}): Promise<{ facts: Fact[]; total: number }> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (options?.limit) params.set('limit', String(options.limit));\r\n    if (options?.offset) params.set('offset', String(options.offset));\r\n    if (options?.search) params.set('search', options.search);\r\n    if (options?.category) params.set('category', options.category);\r\n    if (options?.verified !== undefined) params.set('verified', String(options.verified));\r\n\r\n    const query = params.toString();\r\n    const url = query ? `/api/facts?${query}` : '/api/facts';\r\n\r\n    const response = await http.get<{ facts: Fact[]; total?: number }>(url);\r\n    return {\r\n      facts: response.data.facts || [],\r\n      total: response.data.total || response.data.facts?.length || 0,\r\n    };\r\n  } catch {\r\n    return { facts: [], total: 0 };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a single fact\r\n */\r\nexport async function getFact(id: string | number): Promise<Fact | null> {\r\n  try {\r\n    const response = await http.get<{ fact: Fact }>(`/api/facts/${id}`);\r\n    return response.data.fact;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new fact\r\n */\r\nexport async function createFact(data: CreateFactRequest): Promise<Fact> {\r\n  const response = await http.post<{ fact: Fact; id: string | number }>('/api/facts', data);\r\n  return response.data.fact || {\r\n    ...data,\r\n    id: response.data.id,\r\n    created_at: new Date().toISOString(),\r\n  } as Fact;\r\n}\r\n\r\n/**\r\n * Update a fact\r\n */\r\nexport async function updateFact(id: string | number, data: UpdateFactRequest): Promise<Fact> {\r\n  const response = await http.put<{ fact: Fact }>(`/api/facts/${id}`, data);\r\n  return response.data.fact;\r\n}\r\n\r\n/**\r\n * Delete a fact (soft delete; syncs removal to graph/FalkorDB)\r\n */\r\nexport async function deleteFact(id: string | number): Promise<void> {\r\n  await http.delete(`/api/facts/${id}`);\r\n}\r\n\r\n/**\r\n * List soft-deleted facts (for restore / undo)\r\n */\r\nexport async function getDeletedFacts(): Promise<Fact[]> {\r\n  try {\r\n    const response = await http.get<{ facts: Fact[] }>('/api/facts/deleted');\r\n    return response.data.facts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a soft-deleted fact (undo); syncs back to graph/FalkorDB\r\n */\r\nexport async function restoreFact(id: string | number): Promise<Fact> {\r\n  const response = await http.post<{ fact: Fact }>(`/api/facts/${id}/restore`, {});\r\n  return response.data.fact;\r\n}\r\n\r\n/**\r\n * Verify a fact\r\n */\r\nexport async function verifyFact(id: string | number): Promise<Fact> {\r\n  return updateFact(id, { verified: true });\r\n}\r\n\r\n/**\r\n * Run full fact-check (AI analysis, records conflict_detected events)\r\n */\r\nexport async function runFactCheck(): Promise<{ ok: boolean; conflicts: FactConflict[]; analyzed_facts: number; events_recorded: number }> {\r\n  const response = await http.post<{ ok: boolean; conflicts: FactConflict[]; analyzed_facts: number; events_recorded: number }>('/api/fact-check/run', {});\r\n  return response.data;\r\n}\r\n\r\n/**\r\n * Detect conflicts between facts\r\n */\r\nexport async function detectConflicts(): Promise<FactConflict[]> {\r\n  try {\r\n    const response = await http.get<{ conflicts: FactConflict[] }>('/api/conflicts');\r\n    return response.data.conflicts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get facts by category\r\n */\r\nexport async function getFactsByCategory(): Promise<Record<string, Fact[]>> {\r\n  try {\r\n    const { facts } = await getFacts({ limit: 1000 });\r\n    const grouped: Record<string, Fact[]> = {};\r\n    \r\n    facts.forEach(fact => {\r\n      const category = fact.category || 'Uncategorized';\r\n      if (!grouped[category]) grouped[category] = [];\r\n      grouped[category].push(fact);\r\n    });\r\n    \r\n    return grouped;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Get facts grouped by source (source_file or source)\r\n */\r\nexport async function getFactsBySource(): Promise<Record<string, Fact[]>> {\r\n  try {\r\n    const { facts } = await getFacts({ limit: 1000 });\r\n    const grouped: Record<string, Fact[]> = {};\r\n    \r\n    facts.forEach(fact => {\r\n      const source = fact.source_file || fact.source || 'Unknown source';\r\n      if (!grouped[source]) grouped[source] = [];\r\n      grouped[source].push(fact);\r\n    });\r\n    \r\n    return grouped;\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Get facts by source document id\r\n */\r\nexport async function getFactsByDocument(documentId: string): Promise<Fact[]> {\r\n  try {\r\n    const params = new URLSearchParams({ document_id: documentId });\r\n    const response = await http.get<{ facts: Fact[] }>(`/api/facts?${params}`);\r\n    return response.data.facts || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface FactEvent {\r\n  id: string;\r\n  fact_id: string;\r\n  event_type: string;\r\n  event_data?: Record<string, unknown>;\r\n  actor_user_id?: string;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\n/**\r\n * Get fact events (timeline) for a fact\r\n */\r\nexport async function getFactEvents(factId: string | number): Promise<FactEvent[]> {\r\n  try {\r\n    const response = await http.get<{ events: FactEvent[] }>(`/api/facts/${factId}/events`);\r\n    return response.data.events || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport interface SimilarFactItem {\r\n  fact: Fact;\r\n  similarityScore: number;\r\n}\r\n\r\n/**\r\n * Get similar facts (from fact_similarities cache or computed)\r\n */\r\nexport async function getSimilarFacts(factId: string | number, limit = 10): Promise<SimilarFactItem[]> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    if (limit !== 10) params.set('limit', String(limit));\r\n    const query = params.toString();\r\n    const url = query ? `/api/facts/${factId}/similar?${query}` : `/api/facts/${factId}/similar`;\r\n    const response = await http.get<{ similar: SimilarFactItem[] }>(url);\r\n    return response.data.similar || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Search facts\r\n */\r\nexport async function searchFacts(query: string, limit = 20): Promise<Fact[]> {\r\n  const { facts } = await getFacts({ search: query, limit });\r\n  return facts;\r\n}\r\n\r\n/**\r\n * Get fact statistics\r\n */\r\nexport function getFactStats(facts: Fact[]): {\r\n  total: number;\r\n  verified: number;\r\n  unverified: number;\r\n  byCategory: Record<string, number>;\r\n} {\r\n  const stats = {\r\n    total: facts.length,\r\n    verified: facts.filter(f => f.verified).length,\r\n    unverified: facts.filter(f => !f.verified).length,\r\n    byCategory: {} as Record<string, number>,\r\n  };\r\n\r\n  facts.forEach(fact => {\r\n    const category = fact.category || 'Uncategorized';\r\n    stats.byCategory[category] = (stats.byCategory[category] || 0) + 1;\r\n  });\r\n\r\n  return stats;\r\n}\r\n\r\nexport const factsService = {\r\n  getAll: getFacts,\r\n  get: getFact,\r\n  create: createFact,\r\n  update: updateFact,\r\n  delete: deleteFact,\r\n  deleteFact, // Alias for backwards compatibility\r\n  verify: verifyFact,\r\n  verifyFact, // Alias for backwards compatibility\r\n  detectConflicts,\r\n  getByCategory: getFactsByCategory,\r\n  getBySource: getFactsBySource,\r\n  getByDocument: getFactsByDocument,\r\n  getEvents: getFactEvents,\r\n  getSimilarFacts,\r\n  search: searchFacts,\r\n  getStats: getFactStats,\r\n  getDeletedFacts,\r\n  restoreFact,\r\n  runFactCheck,\r\n};\r\n","/**\n * Krisp Integration Service\n * Handles Krisp AI Meeting Assistant integration\n */\n\nimport { http } from './api';\n\n// ==================== Types ====================\n\nexport interface KrispWebhook {\n  id: string;\n  user_id: string;\n  webhook_token: string;\n  webhook_secret: string;\n  webhook_url: string;\n  is_active: boolean;\n  events_enabled: string[];\n  last_event_at?: string;\n  total_events_received: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface KrispTranscript {\n  id: string;\n  user_id: string;\n  krisp_meeting_id: string;\n  source: 'webhook' | 'mcp_sync';\n  event_type: string;\n  krisp_title: string;\n  display_title?: string;\n  meeting_date: string;\n  duration_minutes?: number;\n  speakers: string[];\n  has_unidentified_speakers: boolean;\n  matched_project_id?: string;\n  project_confidence?: number;\n  project_candidates?: ProjectCandidate[];\n  status_reason?: string;\n  matched_contacts?: MatchedContact[];\n  transcript_text?: string;\n  action_items?: unknown[];\n  key_points?: unknown[];\n  notes?: unknown;\n  status: 'pending' | 'quarantine' | 'ambiguous' | 'matched' | 'processed' | 'failed' | 'skipped';\n  retry_count: number;\n  processed_document_id?: string;\n  received_at: string;\n  projects?: {\n    id: string;\n    name: string;\n    project_number: string;\n  };\n}\n\nexport interface ProjectCandidate {\n  projectId: string;\n  projectName: string;\n  projectNumber: string;\n  count: number;\n  percentage: number;\n}\n\nexport interface MatchedContact {\n  speaker: string;\n  contact_id: string | null;\n  contact_name: string | null;\n  action: string;\n  confidence: number;\n}\n\nexport interface KrispSpeakerMapping {\n  id: string;\n  user_id?: string;\n  project_id: string;\n  speaker_name: string;\n  contact_id: string;\n  is_global: boolean;\n  is_active: boolean;\n  confidence: number;\n  source: string;\n  contacts?: {\n    id: string;\n    name: string;\n  };\n}\n\nexport interface TranscriptsSummary {\n  total_count: number;\n  pending_count: number;\n  quarantine_count: number;\n  ambiguous_count: number;\n  processed_count: number;\n  failed_count: number;\n}\n\nexport interface QuarantineStats {\n  total: number;\n  quarantine: number;\n  ambiguous: number;\n  maxedOut: number;\n  readyForRetry: number;\n}\n\n// ==================== Webhook Management ====================\n\n/**\n * Get or create Krisp webhook configuration\n */\nexport async function getWebhook(): Promise<KrispWebhook | null> {\n  try {\n    const response = await http.get<{ webhook: KrispWebhook }>('/api/krisp/webhook');\n    return response.data.webhook;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Regenerate webhook credentials\n */\nexport async function regenerateWebhook(): Promise<KrispWebhook | null> {\n  try {\n    const response = await http.post<{ webhook: KrispWebhook }>('/api/krisp/webhook/regenerate');\n    return response.data.webhook;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Toggle webhook active status\n */\nexport async function toggleWebhook(isActive: boolean): Promise<boolean> {\n  try {\n    await http.put('/api/krisp/webhook/toggle', { is_active: isActive });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Update enabled events\n */\nexport async function updateEnabledEvents(events: string[]): Promise<string[]> {\n  const response = await http.put<{ events: string[] }>('/api/krisp/webhook/events', { events });\n  return response.data.events;\n}\n\n// ==================== Transcript Management ====================\n\n/**\n * Get transcripts with optional filtering\n */\nexport async function getTranscripts(options: {\n  status?: string | string[];\n  projectId?: string;\n  limit?: number;\n  offset?: number;\n} = {}): Promise<KrispTranscript[]> {\n  const params = new URLSearchParams();\n  \n  if (options.status) {\n    if (Array.isArray(options.status)) {\n      params.append('status', options.status.join(','));\n    } else {\n      params.append('status', options.status);\n    }\n  }\n  if (options.projectId) params.append('project_id', options.projectId);\n  if (options.limit) params.append('limit', String(options.limit));\n  if (options.offset) params.append('offset', String(options.offset));\n\n  const url = `/api/krisp/transcripts${params.toString() ? `?${params}` : ''}`;\n  const response = await http.get<{ transcripts: KrispTranscript[] }>(url);\n  return response.data.transcripts;\n}\n\n/**\n * Get transcript by ID\n */\nexport async function getTranscript(id: string): Promise<KrispTranscript | null> {\n  try {\n    const response = await http.get<{ transcript: KrispTranscript }>(`/api/krisp/transcripts/${id}`);\n    return response.data.transcript;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get transcripts summary\n */\nexport async function getTranscriptsSummary(): Promise<TranscriptsSummary | null> {\n  try {\n    const response = await http.get<{ summary: TranscriptsSummary }>('/api/krisp/transcripts/summary');\n    return response.data.summary;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Assign transcript to a project\n */\nexport async function assignProject(transcriptId: string, projectId: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/assign`, { project_id: projectId });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Skip/discard a transcript\n */\nexport async function skipTranscript(transcriptId: string, reason?: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/skip`, { reason });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Force retry processing\n */\nexport async function retryTranscript(transcriptId: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/retry`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Process a MATCHED transcript (create document)\n */\nexport async function processTranscript(transcriptId: string): Promise<boolean> {\n  try {\n    await http.post(`/api/krisp/transcripts/${transcriptId}/process`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==================== Speaker Mappings ====================\n\n/**\n * Get speaker mappings\n */\nexport async function getMappings(): Promise<KrispSpeakerMapping[]> {\n  try {\n    const response = await http.get<{ mappings: KrispSpeakerMapping[] }>('/api/krisp/mappings');\n    return response.data.mappings;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Create speaker mapping\n */\nexport async function createMapping(\n  speakerName: string,\n  contactId: string,\n  projectId: string,\n  isGlobal = false\n): Promise<KrispSpeakerMapping | null> {\n  try {\n    const response = await http.post<{ mapping: KrispSpeakerMapping }>('/api/krisp/mappings', {\n      speaker_name: speakerName,\n      contact_id: contactId,\n      project_id: projectId,\n      is_global: isGlobal\n    });\n    return response.data.mapping;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Delete speaker mapping\n */\nexport async function deleteMapping(mappingId: string): Promise<boolean> {\n  try {\n    await http.delete(`/api/krisp/mappings/${mappingId}`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n// ==================== AI Summary ====================\n\nexport interface TranscriptSummary {\n  title: string;\n  date?: string;\n  duration?: number;\n  speakers: string[];\n  topic?: string;\n  keyPoints: string[];\n  actionItems: string[];\n  decisions?: string[];\n  nextSteps?: string;\n  notes?: string;\n  source: 'krisp_metadata' | 'ai_generated' | 'excerpt_fallback' | 'no_content';\n}\n\nexport interface GenerateSummaryOptions {\n  forceRegenerate?: boolean;\n}\n\n/**\n * Generate AI summary of a transcript\n */\nexport async function generateSummary(\n  transcriptId: string, \n  options: GenerateSummaryOptions = {}\n): Promise<TranscriptSummary | null> {\n  try {\n    const response = await http.post<{ summary: TranscriptSummary }>(\n      `/api/krisp/transcripts/${transcriptId}/summary`,\n      { forceRegenerate: options.forceRegenerate || false }\n    );\n    return response.data.summary;\n  } catch {\n    return null;\n  }\n}\n\n// ==================== Quarantine ====================\n\n/**\n * Get quarantine statistics\n */\nexport async function getQuarantineStats(): Promise<QuarantineStats | null> {\n  try {\n    const response = await http.get<{ stats: QuarantineStats }>('/api/krisp/quarantine/stats');\n    return response.data.stats;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get quarantined transcripts\n */\nexport async function getQuarantinedTranscripts(): Promise<KrispTranscript[]> {\n  return getTranscripts({ status: ['quarantine', 'ambiguous'] });\n}\n\n// ==================== MCP Import ====================\n\nexport interface McpMeeting {\n  meeting_id: string;\n  name: string;\n  date: string;\n  url?: string;\n  speakers?: string[];\n  attendees?: string[];\n  is_recurring?: boolean;\n  meeting_notes?: {\n    detailed_summary?: string;\n    key_points?: string[];\n    action_items?: string[];\n  };\n  transcript?: {\n    status?: string;\n    text?: string;\n  };\n}\n\nexport interface McpSearchFilters {\n  search?: string;\n  after?: string;\n  before?: string;\n  participantDomains?: string[];\n  limit?: number;\n  offset?: number;\n}\n\nexport interface ImportResult {\n  meetingId: string;\n  title?: string;\n  success: boolean;\n  transcriptId?: string;\n  error?: string;\n  duplicate?: boolean;\n}\n\nexport interface ImportResponse {\n  success: boolean;\n  results: ImportResult[];\n  imported: number;\n  skipped: number;\n  failed: number;\n}\n\nexport interface ImportHistoryItem {\n  id: string;\n  krisp_meeting_id: string;\n  krisp_title: string;\n  meeting_date: string;\n  status: string;\n  created_at: string;\n}\n\n/**\n * Check which meetings have already been imported\n */\nexport async function getImportedMeetingIds(meetingIds: string[]): Promise<string[]> {\n  if (!meetingIds.length) return [];\n  \n  try {\n    const response = await http.get<{ imported: string[] }>(\n      `/api/krisp/mcp/imported?ids=${meetingIds.join(',')}`\n    );\n    return response.data.imported;\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Import meetings from MCP data\n */\nexport async function importMeetings(\n  meetings: McpMeeting[], \n  options: { forceReimport?: boolean } = {}\n): Promise<ImportResponse | null> {\n  try {\n    const response = await http.post<ImportResponse>('/api/krisp/mcp/import', {\n      meetings,\n      forceReimport: options.forceReimport\n    });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Import a single meeting\n */\nexport async function importMeeting(\n  meeting: McpMeeting,\n  options: { forceReimport?: boolean } = {}\n): Promise<ImportResult | null> {\n  const result = await importMeetings([meeting], options);\n  return result?.results[0] || null;\n}\n\n/**\n * Get import history\n */\nexport async function getImportHistory(\n  options: { limit?: number; offset?: number } = {}\n): Promise<ImportHistoryItem[]> {\n  try {\n    const params = new URLSearchParams();\n    if (options.limit) params.set('limit', String(options.limit));\n    if (options.offset) params.set('offset', String(options.offset));\n    \n    const url = `/api/krisp/mcp/history${params.toString() ? '?' + params.toString() : ''}`;\n    const response = await http.get<{ history: ImportHistoryItem[] }>(url);\n    return response.data.history;\n  } catch {\n    return [];\n  }\n}\n\n// ==================== Available Meetings (MCP Sync) ====================\n\nexport interface AvailableMeeting {\n  id: string;\n  user_id: string;\n  krisp_meeting_id: string;\n  meeting_name: string;\n  meeting_date: string;\n  meeting_url?: string;\n  is_recurring: boolean;\n  attendees: string[];\n  speakers: string[];\n  key_points: string[];\n  action_items: unknown[];\n  summary?: string;\n  is_imported: boolean;\n  imported_at?: string;\n  imported_transcript_id?: string;\n  first_seen_at: string;\n  last_synced_at: string;\n}\n\nexport interface AvailableMeetingsStats {\n  total_available: number;\n  total_imported: number;\n  total_pending: number;\n  oldest_meeting?: string;\n  newest_meeting?: string;\n  last_sync?: string;\n}\n\nexport interface AvailableMeetingsResponse {\n  meetings: AvailableMeeting[];\n  stats: AvailableMeetingsStats;\n}\n\nexport interface SyncMeetingsResponse {\n  success: boolean;\n  synced: number;\n  errors: number;\n}\n\nexport interface ImportAvailableResponse {\n  success: boolean;\n  imported: number;\n  errors: Array<{ meetingId: string; error: string }>;\n}\n\n/**\n * Get available meetings from catalog\n */\nexport async function getAvailableMeetings(options: {\n  limit?: number;\n  offset?: number;\n  showImported?: boolean;\n  startDate?: string;\n  endDate?: string;\n  search?: string;\n} = {}): Promise<AvailableMeetingsResponse | null> {\n  try {\n    const params = new URLSearchParams();\n    if (options.limit) params.set('limit', String(options.limit));\n    if (options.offset) params.set('offset', String(options.offset));\n    if (options.showImported === false) params.set('showImported', 'false');\n    if (options.startDate) params.set('startDate', options.startDate);\n    if (options.endDate) params.set('endDate', options.endDate);\n    if (options.search) params.set('search', options.search);\n    \n    const url = `/api/krisp/available${params.toString() ? '?' + params.toString() : ''}`;\n    const response = await http.get<AvailableMeetingsResponse>(url);\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Sync meetings from MCP (called by Cursor agent)\n */\nexport async function syncMeetingsFromMcp(meetings: McpMeeting[]): Promise<SyncMeetingsResponse | null> {\n  try {\n    const response = await http.post<SyncMeetingsResponse>('/api/krisp/available/sync', { meetings });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Import selected available meetings\n */\nexport async function importAvailableMeetings(meetingIds: string[], projectId?: string): Promise<ImportAvailableResponse | null> {\n  try {\n    const response = await http.post<ImportAvailableResponse>('/api/krisp/available/import', { \n      meetingIds,\n      projectId \n    });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get available meetings stats\n */\nexport async function getAvailableMeetingsStats(): Promise<AvailableMeetingsStats | null> {\n  try {\n    const response = await http.get<{ stats: AvailableMeetingsStats }>('/api/krisp/available/stats');\n    return response.data.stats;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * AI Summary result interface\n */\nexport interface MeetingSummary {\n  key_points: string[];\n  action_items: string[];\n  excerpt: string;\n  speakers?: string[];\n  attendees?: string[];\n  meeting_date?: string;\n  mentioned_people?: string[];\n}\n\nexport interface GenerateSummaryResponse {\n  success: boolean;\n  summary?: MeetingSummary;\n  error?: string;\n}\n\n/**\n * Generate AI summary for a specific available meeting\n */\nexport async function generateAvailableMeetingSummary(meetingId: string): Promise<GenerateSummaryResponse | null> {\n  try {\n    const response = await http.post<GenerateSummaryResponse>('/api/krisp/available/summary', { meetingId });\n    return response.data;\n  } catch {\n    return null;\n  }\n}\n\n// ==================== Helpers ====================\n\n/**\n * Format transcript status for display\n */\nexport function formatStatus(status: KrispTranscript['status']): { label: string; color: string } {\n  const statusMap: Record<string, { label: string; color: string }> = {\n    pending: { label: 'Pending', color: 'blue' },\n    quarantine: { label: 'Quarantine', color: 'yellow' },\n    ambiguous: { label: 'Ambiguous', color: 'orange' },\n    matched: { label: 'Matched', color: 'cyan' },\n    processed: { label: 'Processed', color: 'green' },\n    failed: { label: 'Failed', color: 'red' },\n    skipped: { label: 'Skipped', color: 'gray' }\n  };\n  \n  return statusMap[status] || { label: status, color: 'gray' };\n}\n\n/**\n * Format duration for display\n */\nexport function formatDuration(minutes?: number): string {\n  if (!minutes) return '-';\n  \n  const hours = Math.floor(minutes / 60);\n  const mins = minutes % 60;\n  \n  if (hours > 0) {\n    return `${hours}h ${mins}m`;\n  }\n  return `${mins}m`;\n}\n\n/**\n * Check if transcript needs action\n */\nexport function needsAction(transcript: KrispTranscript): boolean {\n  return ['quarantine', 'ambiguous', 'failed'].includes(transcript.status);\n}\n\n/**\n * Get action items count\n */\nexport function getActionItemsCount(transcript: KrispTranscript): number {\n  if (Array.isArray(transcript.action_items)) {\n    return transcript.action_items.length;\n  }\n  return 0;\n}\n","/**\r\n * DOM Utilities\r\n * Helper functions for DOM manipulation\r\n */\r\n\r\n/**\r\n * Query selector with type safety\r\n */\r\nexport function $(selector: string, parent: ParentNode = document): HTMLElement | null {\r\n  return parent.querySelector(selector);\r\n}\r\n\r\n/**\r\n * Query selector all with type safety\r\n */\r\nexport function $$(selector: string, parent: ParentNode = document): HTMLElement[] {\r\n  return Array.from(parent.querySelectorAll(selector));\r\n}\r\n\r\n/**\r\n * Get element by ID with type safety\r\n */\r\nexport function $id<T extends HTMLElement = HTMLElement>(id: string): T | null {\r\n  return document.getElementById(id) as T | null;\r\n}\r\n\r\n/**\r\n * Create element with attributes\r\n */\r\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\r\n  tag: K,\r\n  attributes?: Partial<HTMLElementTagNameMap[K]>,\r\n  children?: (Node | string)[]\r\n): HTMLElementTagNameMap[K] {\r\n  const el = document.createElement(tag);\r\n  \r\n  if (attributes) {\r\n    Object.entries(attributes).forEach(([key, value]) => {\r\n      if (key === 'className') {\r\n        el.className = value as string;\r\n      } else if (key === 'style' && typeof value === 'object') {\r\n        Object.assign(el.style, value);\r\n      } else if (key.startsWith('data')) {\r\n        el.setAttribute(key.replace(/([A-Z])/g, '-$1').toLowerCase(), String(value));\r\n      } else {\r\n        (el as Record<string, unknown>)[key] = value;\r\n      }\r\n    });\r\n  }\r\n  \r\n  if (children) {\r\n    children.forEach(child => {\r\n      if (typeof child === 'string') {\r\n        el.appendChild(document.createTextNode(child));\r\n      } else {\r\n        el.appendChild(child);\r\n      }\r\n    });\r\n  }\r\n  \r\n  return el;\r\n}\r\n\r\n/**\r\n * Add event listener with cleanup\r\n */\r\nexport function on<K extends keyof HTMLElementEventMap>(\r\n  element: HTMLElement | Window | Document,\r\n  event: K,\r\n  handler: (e: HTMLElementEventMap[K]) => void,\r\n  options?: AddEventListenerOptions\r\n): () => void {\r\n  element.addEventListener(event, handler as EventListener, options);\r\n  return () => element.removeEventListener(event, handler as EventListener, options);\r\n}\r\n\r\n/**\r\n * Toggle class on element\r\n */\r\nexport function toggleClass(element: HTMLElement, className: string, force?: boolean): boolean {\r\n  return element.classList.toggle(className, force);\r\n}\r\n\r\n/**\r\n * Add multiple classes\r\n */\r\nexport function addClass(element: HTMLElement, ...classes: string[]): void {\r\n  element.classList.add(...classes);\r\n}\r\n\r\n/**\r\n * Remove multiple classes\r\n */\r\nexport function removeClass(element: HTMLElement, ...classes: string[]): void {\r\n  element.classList.remove(...classes);\r\n}\r\n\r\n/**\r\n * Check if element has class\r\n */\r\nexport function hasClass(element: HTMLElement, className: string): boolean {\r\n  return element.classList.contains(className);\r\n}\r\n\r\n/**\r\n * Set multiple attributes\r\n */\r\nexport function setAttributes(element: HTMLElement, attrs: Record<string, string>): void {\r\n  Object.entries(attrs).forEach(([key, value]) => {\r\n    element.setAttribute(key, value);\r\n  });\r\n}\r\n\r\n/**\r\n * Remove element from DOM\r\n */\r\nexport function remove(element: HTMLElement): void {\r\n  element.remove();\r\n}\r\n\r\n/**\r\n * Empty element contents\r\n */\r\nexport function empty(element: HTMLElement): void {\r\n  element.innerHTML = '';\r\n}\r\n\r\n/**\r\n * Set inner HTML safely\r\n */\r\nexport function setHTML(element: HTMLElement, html: string): void {\r\n  element.innerHTML = html;\r\n}\r\n\r\n/**\r\n * Show element. Uses class 'hidden' when display is 'block'; otherwise sets style.display.\r\n */\r\nexport function show(element: HTMLElement, display = 'block'): void {\r\n  element.classList.remove('hidden');\r\n  if (display === 'block') {\r\n    element.style.removeProperty('display');\r\n  } else {\r\n    element.style.display = display;\r\n  }\r\n}\r\n\r\n/**\r\n * Hide element using class 'hidden' (display: none).\r\n */\r\nexport function hide(element: HTMLElement): void {\r\n  element.classList.add('hidden');\r\n}\r\n\r\n/**\r\n * Toggle element visibility. Uses class 'hidden' when display is 'block'.\r\n */\r\nexport function toggle(element: HTMLElement, visible?: boolean, display = 'block'): void {\r\n  if (visible === undefined) {\r\n    visible = element.classList.contains('hidden');\r\n  }\r\n  if (visible) {\r\n    show(element, display);\r\n  } else {\r\n    hide(element);\r\n  }\r\n}\r\n\r\n/**\r\n * Scroll element into view\r\n */\r\nexport function scrollIntoView(element: HTMLElement, options?: ScrollIntoViewOptions): void {\r\n  element.scrollIntoView({\r\n    behavior: 'smooth',\r\n    block: 'center',\r\n    ...options,\r\n  });\r\n}\r\n\r\n/**\r\n * Focus element with optional scroll\r\n */\r\nexport function focus(element: HTMLElement, preventScroll = false): void {\r\n  element.focus({ preventScroll });\r\n}\r\n\r\n/**\r\n * Wait for element to appear in DOM\r\n */\r\nexport function waitForElement(selector: string, timeout = 5000): Promise<HTMLElement> {\r\n  return new Promise((resolve, reject) => {\r\n    const element = $(selector);\r\n    if (element) {\r\n      resolve(element);\r\n      return;\r\n    }\r\n\r\n    const observer = new MutationObserver(() => {\r\n      const element = $(selector);\r\n      if (element) {\r\n        observer.disconnect();\r\n        resolve(element);\r\n      }\r\n    });\r\n\r\n    observer.observe(document.body, {\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n\r\n    setTimeout(() => {\r\n      observer.disconnect();\r\n      reject(new Error(`Element ${selector} not found within ${timeout}ms`));\r\n    }, timeout);\r\n  });\r\n}\r\n","/**\r\n * Theme Toggle Component\r\n * Button to cycle through theme modes (light/dark/system)\r\n */\r\n\r\nimport { theme } from '../services/theme';\r\nimport { toast } from '../services/toast';\r\nimport { createElement, on } from '../utils/dom';\r\n\r\n/**\r\n * Create theme toggle button element\r\n */\r\nexport function createThemeToggle(container?: HTMLElement): HTMLButtonElement {\r\n  const button = createElement('button', {\r\n    className: 'btn btn-ghost theme-toggle',\r\n    title: `Theme: ${theme.getLabel()} (Ctrl+Shift+T)`,\r\n  });\r\n\r\n  // Update button content\r\n  function updateButton(): void {\r\n    button.innerHTML = getThemeIcon();\r\n    button.title = `Theme: ${theme.getLabel()} (Ctrl+Shift+T)`;\r\n    button.setAttribute('data-theme-mode', theme.getMode());\r\n  }\r\n\r\n  // Get icon for current theme\r\n  function getThemeIcon(): string {\r\n    const mode = theme.getMode();\r\n    switch (mode) {\r\n      case 'light':\r\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"5\"/>\r\n          <path d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"/>\r\n        </svg>`;\r\n      case 'dark':\r\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"/>\r\n        </svg>`;\r\n      case 'system':\r\n        return `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\"/>\r\n          <line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\"/>\r\n          <line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\"/>\r\n        </svg>`;\r\n    }\r\n  }\r\n\r\n  // Handle click\r\n  on(button, 'click', () => {\r\n    theme.cycle();\r\n    updateButton();\r\n    toast.info(`Theme: ${theme.getLabel()}`);\r\n  });\r\n\r\n  // Subscribe to theme changes\r\n  theme.onChange(() => {\r\n    updateButton();\r\n  });\r\n\r\n  // Initial update\r\n  updateButton();\r\n\r\n  // Append to container if provided\r\n  if (container) {\r\n    container.appendChild(button);\r\n  }\r\n\r\n  return button;\r\n}\r\n\r\n/**\r\n * Mount theme toggle to existing element by selector\r\n */\r\nexport function mountThemeToggle(selector: string): HTMLButtonElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`ThemeToggle: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n  return createThemeToggle(container as HTMLElement);\r\n}\r\n\r\nexport default createThemeToggle;\r\n","/**\r\n * UI Store\r\n * User interface state\r\n */\r\n\r\n// Types\r\nexport type MainTab = 'dashboard' | 'chat' | 'sot' | 'timeline' | 'org' | 'files' | 'emails' | 'contacts' | 'team-analysis' | 'roles' | 'graph' | 'costs' | 'history' | 'profile' | 'settings' | 'admin' | 'projects';\r\nexport type SotView = 'questions' | 'facts' | 'risks' | 'actions' | 'decisions';\r\nexport type DevTab = 'info' | 'logs' | 'settings';\r\n\r\nexport interface SelectedPerson {\r\n  id: string;\r\n  name: string;\r\n  type: 'contact' | 'member';\r\n}\r\n\r\nexport interface UIState {\r\n  currentTab: MainTab;\r\n  currentDevTab: DevTab;\r\n  sotCurrentView: SotView;\r\n  selectedPerson: SelectedPerson | null;\r\n  sidebarOpen: boolean;\r\n  modalOpen: string | null;\r\n  searchQuery: string;\r\n  filterActive: boolean;\r\n}\r\n\r\n// Initial state\r\nconst initialState: UIState = {\r\n  currentTab: 'dashboard',\r\n  currentDevTab: 'info',\r\n  sotCurrentView: 'questions',\r\n  selectedPerson: null,\r\n  sidebarOpen: true,\r\n  modalOpen: null,\r\n  searchQuery: '',\r\n  filterActive: false,\r\n};\r\n\r\n// State\r\nlet state: UIState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: UIState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): UIState {\r\n  return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: UIState) => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set main tab\r\n */\r\nexport function setTab(tab: MainTab): void {\r\n  state = { ...state, currentTab: tab };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set developer tab\r\n */\r\nexport function setDevTab(tab: DevTab): void {\r\n  state = { ...state, currentDevTab: tab };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set Source of Truth view\r\n */\r\nexport function setSotView(view: SotView): void {\r\n  state = { ...state, sotCurrentView: view };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set selected person\r\n */\r\nexport function setSelectedPerson(person: SelectedPerson | null): void {\r\n  state = { ...state, selectedPerson: person };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Toggle sidebar\r\n */\r\nexport function toggleSidebar(): void {\r\n  state = { ...state, sidebarOpen: !state.sidebarOpen };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set sidebar open state\r\n */\r\nexport function setSidebarOpen(open: boolean): void {\r\n  state = { ...state, sidebarOpen: open };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Open modal\r\n */\r\nexport function openModal(modalId: string): void {\r\n  state = { ...state, modalOpen: modalId };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Close modal\r\n */\r\nexport function closeModal(): void {\r\n  state = { ...state, modalOpen: null };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set search query\r\n */\r\nexport function setSearchQuery(query: string): void {\r\n  state = { ...state, searchQuery: query };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Toggle filter\r\n */\r\nexport function toggleFilter(): void {\r\n  state = { ...state, filterActive: !state.filterActive };\r\n  notify();\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n  state = { ...initialState };\r\n  notify();\r\n}\r\n\r\n// Export as namespace\r\nexport const uiStore = {\r\n  getState,\r\n  subscribe,\r\n  setTab,\r\n  setDevTab,\r\n  setSotView,\r\n  setSelectedPerson,\r\n  toggleSidebar,\r\n  setSidebarOpen,\r\n  openModal,\r\n  closeModal,\r\n  setSearchQuery,\r\n  toggleFilter,\r\n  reset,\r\n};\r\n","/**\r\n * Header Component\r\n * Main application header with project selector and user menu\r\n */\r\n\r\nimport { createElement, on, $, show, hide } from '../utils/dom';\r\nimport { appStore } from '../stores/app';\r\nimport { uiStore } from '../stores/ui';\r\nimport { theme } from '../services/theme';\r\nimport { createThemeToggle } from './ThemeToggle';\r\n\r\nexport interface HeaderProps {\r\n  onProjectChange?: (projectId: string) => void;\r\n  onLogout?: () => void;\r\n  onSettings?: () => void;\r\n}\r\n\r\n/**\r\n * Create header element\r\n */\r\nexport function createHeader(props: HeaderProps = {}): HTMLElement {\r\n  const header = createElement('header', { className: 'app-header' });\r\n\r\n  // Logo and title\r\n  const logoSection = createElement('div', { className: 'header-logo' });\r\n  logoSection.innerHTML = `\r\n    <span class=\"logo-icon\"></span>\r\n    <h1>GodMode</h1>\r\n  `;\r\n\r\n  // Actions section\r\n  const actionsSection = createElement('div', { className: 'header-actions' });\r\n\r\n  // Project selector\r\n  const projectSelector = createProjectSelector(props.onProjectChange);\r\n  actionsSection.appendChild(projectSelector);\r\n\r\n  // Theme toggle\r\n  const themeToggle = createThemeToggle();\r\n  actionsSection.appendChild(themeToggle);\r\n\r\n  // User menu\r\n  const userMenu = createUserMenu(props);\r\n  actionsSection.appendChild(userMenu);\r\n\r\n  // Mobile menu button\r\n  const mobileMenuBtn = createElement('button', {\r\n    className: 'mobile-menu-btn',\r\n    innerHTML: '',\r\n  });\r\n  on(mobileMenuBtn, 'click', () => {\r\n    uiStore.toggleSidebar();\r\n  });\r\n\r\n  header.appendChild(mobileMenuBtn);\r\n  header.appendChild(logoSection);\r\n  header.appendChild(actionsSection);\r\n\r\n  return header;\r\n}\r\n\r\n/**\r\n * Create project selector dropdown\r\n */\r\nfunction createProjectSelector(onProjectChange?: (projectId: string) => void): HTMLElement {\r\n  const container = createElement('div', { className: 'project-selector' });\r\n\r\n  const button = createElement('button', {\r\n    className: 'project-btn',\r\n  });\r\n\r\n  const dropdown = createElement('div', { className: 'project-dropdown' });\r\n\r\n  // Update button text\r\n  function updateButton(): void {\r\n    const state = appStore.getState();\r\n    const projectName = state.currentProjectId || 'Select Project';\r\n    button.innerHTML = `\r\n      <span class=\"project-name\">${projectName}</span>\r\n      <span class=\"dropdown-arrow\"></span>\r\n    `;\r\n  }\r\n\r\n  // Toggle dropdown\r\n  let isOpen = false;\r\n  on(button, 'click', (e) => {\r\n    e.stopPropagation();\r\n    isOpen = !isOpen;\r\n    dropdown.classList.toggle('show', isOpen);\r\n  });\r\n\r\n  // Close on outside click\r\n  on(document, 'click', () => {\r\n    isOpen = false;\r\n    dropdown.classList.remove('show');\r\n  });\r\n\r\n  // Subscribe to state changes\r\n  appStore.subscribe(() => {\r\n    updateButton();\r\n  });\r\n\r\n  // Initial update\r\n  updateButton();\r\n\r\n  container.appendChild(button);\r\n  container.appendChild(dropdown);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Create user menu dropdown\r\n */\r\nfunction createUserMenu(props: HeaderProps): HTMLElement {\r\n  const container = createElement('div', { className: 'user-menu' });\r\n\r\n  const button = createElement('button', { className: 'user-menu-btn' });\r\n\r\n  const dropdown = createElement('div', { className: 'user-dropdown' });\r\n\r\n  // Update button\r\n  function updateButton(): void {\r\n    const state = appStore.getState();\r\n    const user = state.currentUser;\r\n    const initials = user?.name\r\n      ? user.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2)\r\n      : user?.email?.[0]?.toUpperCase() || '?';\r\n\r\n    button.innerHTML = `\r\n      <div class=\"user-avatar\">${initials}</div>\r\n      <span class=\"user-name\">${user?.name || user?.email || 'Guest'}</span>\r\n    `;\r\n  }\r\n\r\n  // Update dropdown content\r\n  function updateDropdown(): void {\r\n    const state = appStore.getState();\r\n    const user = state.currentUser;\r\n\r\n    dropdown.innerHTML = `\r\n      <div class=\"user-dropdown-header\">\r\n        <strong>${user?.name || 'Guest'}</strong>\r\n        <span class=\"text-muted\">${user?.email || ''}</span>\r\n        ${user?.role ? `<span class=\"role-badge ${user.role}\">${user.role}</span>` : ''}\r\n      </div>\r\n      <div class=\"user-dropdown-items\">\r\n        <button data-action=\"settings\">\r\n          <span></span> Settings\r\n        </button>\r\n        <button data-action=\"shortcuts\">\r\n          <span></span> Shortcuts\r\n        </button>\r\n        <button data-action=\"logout\" class=\"text-error\">\r\n          <span></span> Logout\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n    // Bind action handlers\r\n    const settingsBtn = dropdown.querySelector('[data-action=\"settings\"]');\r\n    const shortcutsBtn = dropdown.querySelector('[data-action=\"shortcuts\"]');\r\n    const logoutBtn = dropdown.querySelector('[data-action=\"logout\"]');\r\n\r\n    if (settingsBtn) {\r\n      on(settingsBtn as HTMLElement, 'click', () => {\r\n        props.onSettings?.();\r\n        closeDropdown();\r\n      });\r\n    }\r\n\r\n    if (shortcutsBtn) {\r\n      on(shortcutsBtn as HTMLElement, 'click', () => {\r\n        // Show shortcuts modal\r\n        uiStore.openModal('shortcuts');\r\n        closeDropdown();\r\n      });\r\n    }\r\n\r\n    if (logoutBtn) {\r\n      on(logoutBtn as HTMLElement, 'click', () => {\r\n        props.onLogout?.();\r\n        closeDropdown();\r\n      });\r\n    }\r\n  }\r\n\r\n  // Toggle dropdown\r\n  let isOpen = false;\r\n  function closeDropdown(): void {\r\n    isOpen = false;\r\n    dropdown.classList.remove('show');\r\n  }\r\n\r\n  on(button, 'click', (e) => {\r\n    e.stopPropagation();\r\n    isOpen = !isOpen;\r\n    dropdown.classList.toggle('show', isOpen);\r\n    if (isOpen) {\r\n      updateDropdown();\r\n    }\r\n  });\r\n\r\n  // Close on outside click\r\n  on(document, 'click', closeDropdown);\r\n\r\n  // Subscribe to state changes\r\n  appStore.subscribe(updateButton);\r\n\r\n  // Initial update\r\n  updateButton();\r\n\r\n  container.appendChild(button);\r\n  container.appendChild(dropdown);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Mount header to existing element\r\n */\r\nexport function mountHeader(selector: string, props: HeaderProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`Header: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const header = createHeader(props);\r\n  container.appendChild(header);\r\n  return header;\r\n}\r\n\r\nexport default createHeader;\r\n","/**\r\n * Sidebar Component\r\n * Navigation sidebar with tabs\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../utils/dom';\r\nimport { uiStore, MainTab } from '../stores/ui';\r\nimport { appStore } from '../stores/app';\r\n\r\nexport interface SidebarTab {\r\n  id: MainTab;\r\n  label: string;\r\n  icon: string;\r\n  badge?: number;\r\n}\r\n\r\nexport interface SidebarProps {\r\n  tabs?: SidebarTab[];\r\n  onTabChange?: (tabId: MainTab) => void;\r\n}\r\n\r\nconst defaultTabs: SidebarTab[] = [\r\n  { id: 'dashboard', label: 'Dashboard', icon: '' },\r\n  { id: 'chat', label: 'Chat', icon: '' },\r\n  { id: 'sot', label: 'Source of Truth', icon: '' },\r\n  { id: 'timeline', label: 'Timeline', icon: '' },\r\n  { id: 'org', label: 'Org Chart', icon: '' },\r\n  { id: 'files', label: 'Files', icon: '' },\r\n  { id: 'emails', label: 'Emails', icon: '' },\r\n  { id: 'contacts', label: 'Contacts', icon: '' },\r\n  { id: 'roles', label: 'Roles', icon: '' },\r\n  { id: 'graph', label: 'Graph DB', icon: '' },\r\n  { id: 'costs', label: 'Costs', icon: '' },\r\n  { id: 'history', label: 'History', icon: '' },\r\n];\r\n\r\n// Admin tab - only shown for superadmin users\r\nconst adminTab: SidebarTab = { id: 'admin', label: 'Admin', icon: '' };\r\n\r\n/**\r\n * Get tabs based on user role\r\n */\r\nfunction getTabsForUser(): SidebarTab[] {\r\n  const state = appStore.getState();\r\n  const isSuperAdmin = state.currentUser?.role === 'superadmin';\r\n  \r\n  if (isSuperAdmin) {\r\n    return [...defaultTabs, adminTab];\r\n  }\r\n  return defaultTabs;\r\n}\r\n\r\n/**\r\n * Create a tab button element\r\n */\r\nfunction createTabButton(tab: SidebarTab, props: SidebarProps): HTMLButtonElement {\r\n  const button = createElement('button', {\r\n    className: 'sidebar-tab',\r\n  }) as HTMLButtonElement;\r\n  button.setAttribute('data-tab', tab.id);\r\n\r\n  button.innerHTML = `\r\n    <span class=\"tab-icon\">${tab.icon}</span>\r\n    <span class=\"tab-label\">${tab.label}</span>\r\n    ${tab.badge ? `<span class=\"tab-badge\">${tab.badge}</span>` : ''}\r\n  `;\r\n\r\n  on(button, 'click', () => {\r\n    uiStore.setTab(tab.id);\r\n    props.onTabChange?.(tab.id);\r\n\r\n    // Close sidebar on mobile after selection\r\n    if (window.innerWidth < 768) {\r\n      uiStore.setSidebarOpen(false);\r\n    }\r\n  });\r\n\r\n  return button;\r\n}\r\n\r\n/**\r\n * Rebuild navigation tabs based on current user\r\n */\r\nfunction rebuildNavigation(nav: HTMLElement, props: SidebarProps): void {\r\n  const tabs = props.tabs || getTabsForUser();\r\n  const currentTab = uiStore.getState().currentTab;\r\n  \r\n  // Clear existing tabs\r\n  nav.innerHTML = '';\r\n  \r\n  // Add tabs\r\n  tabs.forEach(tab => {\r\n    const button = createTabButton(tab, props);\r\n    if (tab.id === currentTab) {\r\n      addClass(button, 'active');\r\n    }\r\n    nav.appendChild(button);\r\n  });\r\n}\r\n\r\n/**\r\n * Create sidebar element\r\n */\r\nexport function createSidebar(props: SidebarProps = {}): HTMLElement {\r\n  const sidebar = createElement('aside', { className: 'sidebar' });\r\n\r\n  // Close button for mobile\r\n  const closeBtn = createElement('button', {\r\n    className: 'sidebar-close-btn',\r\n    innerHTML: '',\r\n  });\r\n  on(closeBtn, 'click', () => {\r\n    uiStore.setSidebarOpen(false);\r\n  });\r\n  sidebar.appendChild(closeBtn);\r\n\r\n  // Navigation\r\n  const nav = createElement('nav', { className: 'sidebar-nav' });\r\n  \r\n  // Initial build\r\n  rebuildNavigation(nav, props);\r\n\r\n  sidebar.appendChild(nav);\r\n  \r\n  // Subscribe to app store to rebuild when user changes (for admin tab visibility)\r\n  appStore.subscribe(() => {\r\n    rebuildNavigation(nav, props);\r\n  });\r\n\r\n  // Subscribe to UI state changes\r\n  uiStore.subscribe((state) => {\r\n    // Update active tab\r\n    const buttons = nav.querySelectorAll('.sidebar-tab');\r\n    buttons.forEach(btn => {\r\n      const tabId = btn.getAttribute('data-tab');\r\n      if (tabId === state.currentTab) {\r\n        addClass(btn as HTMLElement, 'active');\r\n      } else {\r\n        removeClass(btn as HTMLElement, 'active');\r\n      }\r\n    });\r\n\r\n    // Update sidebar visibility (mobile)\r\n    if (state.sidebarOpen) {\r\n      addClass(sidebar, 'mobile-open');\r\n    } else {\r\n      removeClass(sidebar, 'mobile-open');\r\n    }\r\n  });\r\n\r\n  // Set initial active state\r\n  const initialState = uiStore.getState();\r\n  const initialActiveBtn = nav.querySelector(`[data-tab=\"${initialState.currentTab}\"]`);\r\n  if (initialActiveBtn) {\r\n    addClass(initialActiveBtn as HTMLElement, 'active');\r\n  }\r\n\r\n  return sidebar;\r\n}\r\n\r\n/**\r\n * Update tab badge\r\n */\r\nexport function updateTabBadge(tabId: MainTab, count: number | null): void {\r\n  const tab = document.querySelector(`.sidebar-tab[data-tab=\"${tabId}\"]`);\r\n  if (!tab) return;\r\n\r\n  let badge = tab.querySelector('.tab-badge');\r\n\r\n  if (count === null || count === 0) {\r\n    badge?.remove();\r\n    return;\r\n  }\r\n\r\n  if (!badge) {\r\n    badge = createElement('span', { className: 'tab-badge' });\r\n    tab.appendChild(badge);\r\n  }\r\n\r\n  badge.textContent = count > 99 ? '99+' : String(count);\r\n}\r\n\r\n/**\r\n * Mount sidebar to existing element\r\n */\r\nexport function mountSidebar(selector: string, props: SidebarProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`Sidebar: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const sidebar = createSidebar(props);\r\n  container.appendChild(sidebar);\r\n  return sidebar;\r\n}\r\n\r\nexport default createSidebar;\r\n","/**\r\n * Toast Container Component\r\n * Visual container for toast notifications\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\n\r\nexport type ToastPosition = 'top-right' | 'top-left' | 'bottom-right' | 'bottom-left' | 'top-center' | 'bottom-center';\r\n\r\nexport interface ToastContainerProps {\r\n  position?: ToastPosition;\r\n  maxToasts?: number;\r\n}\r\n\r\nlet containerInstance: HTMLElement | null = null;\r\n\r\n/**\r\n * Get or create toast container\r\n */\r\nexport function getToastContainer(props: ToastContainerProps = {}): HTMLElement {\r\n  if (containerInstance) {\r\n    return containerInstance;\r\n  }\r\n\r\n  const position = props.position || 'bottom-right';\r\n  const container = createElement('div', {\r\n    className: `toast-container toast-${position}`,\r\n  });\r\n\r\n  // Container uses CSS classes for position (toast-container.toast-{position} in layout.css)\r\n\r\n  document.body.appendChild(container);\r\n  containerInstance = container;\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Create a toast element\r\n */\r\nexport function createToastElement(\r\n  message: string,\r\n  type: 'success' | 'error' | 'warning' | 'info' = 'info',\r\n  duration = 3000\r\n): HTMLElement {\r\n  const toast = createElement('div', {\r\n    className: `toast toast-${type} fade-in`,\r\n  });\r\n\r\n  const icons: Record<string, string> = {\r\n    success: '',\r\n    error: '',\r\n    warning: '',\r\n    info: '',\r\n  };\r\n\r\n  toast.innerHTML = `\r\n    <span class=\"toast-icon\">${icons[type]}</span>\r\n    <span class=\"toast-message\">${message}</span>\r\n  `;\r\n\r\n  // Click to dismiss\r\n  on(toast, 'click', () => {\r\n    dismissToast(toast);\r\n  });\r\n\r\n  // Auto dismiss\r\n  if (duration > 0) {\r\n    setTimeout(() => {\r\n      dismissToast(toast);\r\n    }, duration);\r\n  }\r\n\r\n  return toast;\r\n}\r\n\r\n/**\r\n * Dismiss a toast with animation\r\n */\r\nfunction dismissToast(toast: HTMLElement): void {\r\n  toast.classList.add('toast-dismiss');\r\n  setTimeout(() => {\r\n    toast.remove();\r\n  }, 300);\r\n}\r\n\r\n/**\r\n * Show a toast notification\r\n */\r\nexport function showToastInContainer(\r\n  message: string,\r\n  type: 'success' | 'error' | 'warning' | 'info' = 'info',\r\n  duration = 3000\r\n): HTMLElement {\r\n  const container = getToastContainer();\r\n  const toast = createToastElement(message, type, duration);\r\n  container.appendChild(toast);\r\n  return toast;\r\n}\r\n\r\nexport default getToastContainer;\r\n","/**\n * Modal Component\n * Reusable modal dialog\n */\n\nimport { createElement, on, addClass, removeClass, show, hide } from '../utils/dom';\nimport { uiStore } from '../stores/ui';\nimport { shortcuts } from '../services/shortcuts';\n\nexport interface ModalProps {\n  id: string;\n  title: string;\n  content?: string | HTMLElement;\n  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';\n  closable?: boolean;\n  onClose?: () => void;\n  onOpen?: () => void;\n  footer?: HTMLElement | null;\n}\n\n// Store active modals\nconst activeModals: Map<string, HTMLElement> = new Map();\n\n/**\n * Create modal element\n */\nexport function createModal(props: ModalProps): HTMLElement {\n  const {\n    id,\n    title,\n    content,\n    size = 'md',\n    closable = true,\n    onClose,\n    onOpen,\n    footer,\n  } = props;\n\n  // Backdrop\n  const modal = createElement('div', {\n    className: `modal modal-${size}`,\n  });\n  modal.setAttribute('data-modal-id', id);\n\n  // Content wrapper\n  const modalContent = createElement('div', { className: 'modal-content' });\n\n  // Header\n  const header = createElement('div', { className: 'modal-header' });\n  header.innerHTML = `<h3>${title}</h3>`;\n\n  if (closable) {\n    const closeBtn = createElement('button', {\n      className: 'modal-close',\n      innerHTML: '',\n    });\n    on(closeBtn, 'click', () => closeModal(id));\n    header.appendChild(closeBtn);\n  }\n\n  // Body\n  const body = createElement('div', { className: 'modal-body' });\n  if (typeof content === 'string') {\n    body.innerHTML = content;\n  } else if (content) {\n    body.appendChild(content);\n  }\n\n  // Footer\n  const footerEl = footer || createElement('div', { className: 'modal-footer' });\n\n  // Assemble\n  modalContent.appendChild(header);\n  modalContent.appendChild(body);\n  if (footer !== null) {\n    modalContent.appendChild(footerEl);\n  }\n  modal.appendChild(modalContent);\n\n  // Click backdrop to close\n  if (closable) {\n    on(modal, 'click', (e) => {\n      if (e.target === modal) {\n        closeModal(id);\n      }\n    });\n  }\n\n  // Store reference\n  activeModals.set(id, modal);\n\n  return modal;\n}\n\n/**\n * Open a modal by ID\n */\nexport function openModal(id: string): void {\n  const modal = activeModals.get(id) || document.querySelector(`[data-modal-id=\"${id}\"]`) as HTMLElement;\n  if (!modal) {\n    console.warn(`Modal not found: ${id}`);\n    return;\n  }\n\n  addClass(modal, 'open');\n  document.body.classList.add('modal-open');\n\n  // Update UI store\n  uiStore.openModal(id);\n\n  // Focus first input\n  setTimeout(() => {\n    const firstInput = modal.querySelector('input, textarea, select, button') as HTMLElement;\n    firstInput?.focus();\n  }, 100);\n}\n\n/**\n * Close a modal by ID\n */\nexport function closeModal(id: string): void {\n  const modal = activeModals.get(id) || document.querySelector(`[data-modal-id=\"${id}\"]`) as HTMLElement;\n  if (!modal) return;\n\n  removeClass(modal, 'open');\n  document.body.classList.remove('modal-open');\n\n  // Update UI store\n  uiStore.closeModal();\n}\n\n/**\n * Close all open modals\n */\nexport function closeAllModals(): void {\n  activeModals.forEach((_, id) => closeModal(id));\n}\n\n/**\n * Check if modal is open\n */\nexport function isModalOpen(id: string): boolean {\n  const modal = activeModals.get(id);\n  return modal?.classList.contains('open') || false;\n}\n\n/**\n * Update modal content\n */\nexport function updateModalContent(id: string, content: string | HTMLElement): void {\n  const modal = activeModals.get(id);\n  if (!modal) return;\n\n  const body = modal.querySelector('.modal-body');\n  if (!body) return;\n\n  if (typeof content === 'string') {\n    body.innerHTML = content;\n  } else {\n    body.innerHTML = '';\n    body.appendChild(content);\n  }\n}\n\n/**\n * Update modal title\n */\nexport function updateModalTitle(id: string, title: string): void {\n  const modal = activeModals.get(id);\n  if (!modal) return;\n\n  const titleEl = modal.querySelector('.modal-header h3');\n  if (titleEl) {\n    titleEl.textContent = title;\n  }\n}\n\n/**\n * Create and show a confirm dialog\n */\nexport function confirm(\n  message: string,\n  options: {\n    title?: string;\n    confirmText?: string;\n    cancelText?: string;\n    confirmClass?: string;\n  } = {}\n): Promise<boolean> {\n  return new Promise((resolve) => {\n    const {\n      title = 'Confirm',\n      confirmText = 'Confirm',\n      cancelText = 'Cancel',\n      confirmClass = 'btn-primary',\n    } = options;\n\n    const id = `confirm-${Date.now()}`;\n\n    const footer = createElement('div', { className: 'modal-footer' });\n\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: cancelText,\n    });\n\n    const confirmBtn = createElement('button', {\n      className: `btn ${confirmClass}`,\n      textContent: confirmText,\n    });\n\n    on(cancelBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(false);\n    });\n\n    on(confirmBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(true);\n    });\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(confirmBtn);\n\n    const modal = createModal({\n      id,\n      title,\n      content: `<p>${message}</p>`,\n      size: 'sm',\n      closable: true,\n      onClose: () => resolve(false),\n      footer,\n    });\n\n    document.body.appendChild(modal);\n    openModal(id);\n  });\n}\n\n/**\n * Create and show an alert dialog\n */\nexport function alert(message: string, title = 'Alert'): Promise<void> {\n  return new Promise((resolve) => {\n    const id = `alert-${Date.now()}`;\n\n    const footer = createElement('div', { className: 'modal-footer' });\n\n    const okBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'OK',\n    });\n\n    on(okBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve();\n    });\n\n    footer.appendChild(okBtn);\n\n    const modal = createModal({\n      id,\n      title,\n      content: `<p>${message}</p>`,\n      size: 'sm',\n      closable: true,\n      onClose: () => resolve(),\n      footer,\n    });\n\n    document.body.appendChild(modal);\n    openModal(id);\n  });\n}\n\n/**\n * Create and show a prompt dialog\n */\nexport function prompt(\n  message: string,\n  options: {\n    title?: string;\n    placeholder?: string;\n    defaultValue?: string;\n  } = {}\n): Promise<string | null> {\n  return new Promise((resolve) => {\n    const id = `prompt-${Date.now()}`;\n    const { title = 'Input', placeholder = '', defaultValue = '' } = options;\n\n    const content = createElement('div', { className: 'prompt-content' });\n    content.innerHTML = `\n      <p>${message}</p>\n      <input type=\"text\" class=\"prompt-input gm-w-full gm-p-2 gm-mt-2\" placeholder=\"${placeholder}\" value=\"${defaultValue}\">\n    `;\n\n    const footer = createElement('div', { className: 'modal-footer' });\n\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const okBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'OK',\n    });\n\n    on(cancelBtn, 'click', () => {\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(null);\n    });\n\n    on(okBtn, 'click', () => {\n      const input = modal.querySelector('.prompt-input') as HTMLInputElement;\n      const value = input?.value || '';\n      closeModal(id);\n      modal.remove();\n      activeModals.delete(id);\n      resolve(value);\n    });\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(okBtn);\n\n    const modal = createModal({\n      id,\n      title,\n      content,\n      size: 'sm',\n      closable: true,\n      onClose: () => resolve(null),\n      footer,\n    });\n\n    document.body.appendChild(modal);\n    openModal(id);\n\n    // Focus input after modal opens\n    setTimeout(() => {\n      const input = modal.querySelector('.prompt-input') as HTMLInputElement;\n      input?.focus();\n    }, 100);\n  });\n}\n\n// Register Escape key to close modals\nshortcuts.register({\n  key: 'Escape',\n  description: 'Close modal',\n  handler: () => {\n    const state = uiStore.getState();\n    if (state.modalOpen) {\n      closeModal(state.modalOpen);\n    }\n  },\n});\n\nexport default createModal;\n","/**\r\n * Member Permissions Modal - SOTA Design\r\n * Edit granular permissions for a project member\r\n */\r\n\r\nimport { on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'member-permissions-modal';\r\n\r\ninterface MemberPermissionsProps {\r\n  projectId: string;\r\n  userId: string;\r\n  userName: string;\r\n  userEmail: string;\r\n  avatarUrl?: string;\r\n  currentRole: string;\r\n  currentPermissions?: string[];\r\n  onSave?: () => void;\r\n}\r\n\r\n// Permission definitions organized by category\r\nconst PERMISSION_CATEGORIES = [\r\n  {\r\n    id: 'view',\r\n    name: 'View',\r\n    icon: '',\r\n    color: '#3b82f6',\r\n    permissions: [\r\n      { id: 'view:dashboard', name: 'Dashboard', desc: 'View project dashboard and stats' },\r\n      { id: 'view:chat', name: 'AI Chat', desc: 'Use the AI assistant' },\r\n      { id: 'view:sot', name: 'Source of Truth', desc: 'View decisions, risks, actions, questions' },\r\n      { id: 'view:contacts', name: 'Contacts', desc: 'View project contacts' },\r\n      { id: 'view:documents', name: 'Documents', desc: 'View uploaded documents' },\r\n      { id: 'view:emails', name: 'Emails', desc: 'View email history' },\r\n      { id: 'view:team', name: 'Team', desc: 'View team members' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'comment',\r\n    name: 'Comment',\r\n    icon: '',\r\n    color: '#8b5cf6',\r\n    permissions: [\r\n      { id: 'comment:sot', name: 'Comment on Items', desc: 'Add comments to decisions, risks, etc.' },\r\n      { id: 'comment:documents', name: 'Comment on Docs', desc: 'Add comments to documents' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'edit',\r\n    name: 'Edit',\r\n    icon: '',\r\n    color: '#10b981',\r\n    permissions: [\r\n      { id: 'edit:questions', name: 'Questions', desc: 'Create and edit questions' },\r\n      { id: 'edit:risks', name: 'Risks', desc: 'Create and edit risks' },\r\n      { id: 'edit:actions', name: 'Actions', desc: 'Create and edit actions' },\r\n      { id: 'edit:decisions', name: 'Decisions', desc: 'Create and edit decisions' },\r\n      { id: 'edit:contacts', name: 'Contacts', desc: 'Create and edit contacts' },\r\n      { id: 'edit:documents', name: 'Documents', desc: 'Upload and edit documents' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'manage',\r\n    name: 'Manage',\r\n    icon: '',\r\n    color: '#f59e0b',\r\n    permissions: [\r\n      { id: 'manage:team', name: 'Team', desc: 'Invite and remove team members' },\r\n      { id: 'manage:roles', name: 'Roles', desc: 'Create and assign roles' },\r\n      { id: 'manage:settings', name: 'Settings', desc: 'Change project settings' },\r\n      { id: 'manage:integrations', name: 'Integrations', desc: 'Configure integrations' },\r\n    ],\r\n  },\r\n  {\r\n    id: 'delete',\r\n    name: 'Delete',\r\n    icon: '',\r\n    color: '#ef4444',\r\n    permissions: [\r\n      { id: 'delete:data', name: 'Delete Data', desc: 'Permanently delete items' },\r\n      { id: 'export:data', name: 'Export Data', desc: 'Export project data' },\r\n    ],\r\n  },\r\n];\r\n\r\n// Default permission sets for each role\r\nconst ROLE_DEFAULTS: Record<string, string[]> = {\r\n  viewer: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n  ],\r\n  editor: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n    'comment:sot', 'comment:documents',\r\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\r\n  ],\r\n  admin: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n    'comment:sot', 'comment:documents',\r\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\r\n    'manage:team', 'manage:roles', 'manage:settings', 'manage:integrations',\r\n    'delete:data', 'export:data',\r\n  ],\r\n  owner: [\r\n    'view:dashboard', 'view:chat', 'view:sot', 'view:contacts', 'view:documents', 'view:emails', 'view:team',\r\n    'comment:sot', 'comment:documents',\r\n    'edit:questions', 'edit:risks', 'edit:actions', 'edit:decisions', 'edit:contacts', 'edit:documents',\r\n    'manage:team', 'manage:roles', 'manage:settings', 'manage:integrations',\r\n    'delete:data', 'export:data',\r\n  ],\r\n};\r\n\r\n/**\r\n * Show member permissions modal\r\n */\r\nexport function showMemberPermissionsModal(props: MemberPermissionsProps): void {\r\n  const { projectId, userId, userName, userEmail, avatarUrl, currentRole, onSave } = props;\r\n  \r\n  // Use current permissions or defaults for role\r\n  let selectedPermissions = new Set(props.currentPermissions || ROLE_DEFAULTS[currentRole] || []);\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'member-permissions-content';\r\n  \r\n  content.innerHTML = `\r\n    <style>\r\n      .member-permissions-content {\r\n        padding: 0;\r\n      }\r\n      \r\n      .member-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.03) 100%);\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .member-avatar {\r\n        width: 56px;\r\n        height: 56px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        font-weight: 700;\r\n        font-size: 20px;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .member-avatar img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n      \r\n      .member-info h4 {\r\n        margin: 0 0 4px;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .member-info p {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      \r\n      .role-selector {\r\n        margin-left: auto;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: flex-end;\r\n        gap: 4px;\r\n      }\r\n      \r\n      .role-selector label {\r\n        font-size: 11px;\r\n        color: var(--text-muted);\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n      }\r\n      \r\n      .role-selector select {\r\n        padding: 8px 32px 8px 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        cursor: pointer;\r\n      }\r\n      \r\n      .permissions-body {\r\n        padding: 24px;\r\n        max-height: 400px;\r\n        overflow-y: auto;\r\n      }\r\n      \r\n      .permission-category {\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .permission-category:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .category-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        margin-bottom: 12px;\r\n        padding-bottom: 8px;\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .category-icon {\r\n        font-size: 16px;\r\n      }\r\n      \r\n      .category-name {\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        flex: 1;\r\n      }\r\n      \r\n      .category-toggle {\r\n        font-size: 11px;\r\n        padding: 4px 10px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 6px;\r\n        background: transparent;\r\n        cursor: pointer;\r\n        color: var(--text-secondary);\r\n        transition: all 0.15s;\r\n      }\r\n      \r\n      .category-toggle:hover {\r\n        background: var(--bg-secondary);\r\n        border-color: #e11d48;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .permission-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));\r\n        gap: 8px;\r\n      }\r\n      \r\n      .permission-item {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 10px;\r\n        padding: 10px 12px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 10px;\r\n        cursor: pointer;\r\n        transition: all 0.15s;\r\n        border: 1px solid transparent;\r\n      }\r\n      \r\n      .permission-item:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .permission-item.selected {\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\r\n        border-color: rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .permission-item input {\r\n        margin-top: 2px;\r\n        accent-color: #e11d48;\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n      \r\n      .permission-info {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      \r\n      .permission-name {\r\n        font-size: 13px;\r\n        font-weight: 500;\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .permission-desc {\r\n        font-size: 11px;\r\n        color: var(--text-muted);\r\n        margin-top: 2px;\r\n      }\r\n      \r\n      .modal-actions {\r\n        display: flex;\r\n        gap: 12px;\r\n        justify-content: flex-end;\r\n        padding: 16px 24px;\r\n        border-top: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      \r\n      .btn {\r\n        padding: 10px 20px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n      \r\n      .btn-secondary {\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .btn-secondary:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .btn-primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-primary:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"member-header\">\r\n      <div class=\"member-avatar\">\r\n        ${avatarUrl \r\n          ? `<img src=\"${avatarUrl}\" alt=\"\">` \r\n          : getInitials(userName || userEmail)}\r\n      </div>\r\n      <div class=\"member-info\">\r\n        <h4>${escapeHtml(userName || userEmail)}</h4>\r\n        <p>${escapeHtml(userEmail)}</p>\r\n      </div>\r\n      <div class=\"role-selector\">\r\n        <label>Base Role</label>\r\n        <select id=\"base-role\">\r\n          <option value=\"viewer\" ${currentRole === 'viewer' ? 'selected' : ''}>Viewer</option>\r\n          <option value=\"editor\" ${currentRole === 'editor' ? 'selected' : ''}>Editor</option>\r\n          <option value=\"admin\" ${currentRole === 'admin' ? 'selected' : ''}>Admin</option>\r\n          <option value=\"owner\" ${currentRole === 'owner' ? 'selected' : ''}>Owner</option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"permissions-body\">\r\n      ${PERMISSION_CATEGORIES.map(cat => `\r\n        <div class=\"permission-category\" data-category=\"${cat.id}\">\r\n          <div class=\"category-header\">\r\n            <span class=\"category-icon\">${cat.icon}</span>\r\n            <span class=\"category-name\">${cat.name}</span>\r\n            <button type=\"button\" class=\"category-toggle\" data-action=\"toggle\">Toggle All</button>\r\n          </div>\r\n          <div class=\"permission-grid\">\r\n            ${cat.permissions.map(p => `\r\n              <label class=\"permission-item${selectedPermissions.has(p.id) ? ' selected' : ''}\">\r\n                <input type=\"checkbox\" name=\"permission\" value=\"${p.id}\" ${selectedPermissions.has(p.id) ? 'checked' : ''}>\r\n                <div class=\"permission-info\">\r\n                  <div class=\"permission-name\">${p.name}</div>\r\n                  <div class=\"permission-desc\">${p.desc}</div>\r\n                </div>\r\n              </label>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    \r\n    <div class=\"modal-actions\">\r\n      <button type=\"button\" class=\"btn btn-secondary\" id=\"btn-cancel\">Cancel</button>\r\n      <button type=\"button\" class=\"btn btn-primary\" id=\"btn-save\">Save Permissions</button>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  setTimeout(() => {\r\n    // Base role change - apply defaults\r\n    const roleSelect = content.querySelector('#base-role') as HTMLSelectElement;\r\n    if (roleSelect) {\r\n      on(roleSelect, 'change', () => {\r\n        const role = roleSelect.value;\r\n        const defaults = ROLE_DEFAULTS[role] || [];\r\n        selectedPermissions = new Set(defaults);\r\n        updateCheckboxes(content, selectedPermissions);\r\n      });\r\n    }\r\n\r\n    // Permission checkbox changes\r\n    content.querySelectorAll('input[name=\"permission\"]').forEach(checkbox => {\r\n      on(checkbox as HTMLElement, 'change', () => {\r\n        const value = (checkbox as HTMLInputElement).value;\r\n        const checked = (checkbox as HTMLInputElement).checked;\r\n        \r\n        if (checked) {\r\n          selectedPermissions.add(value);\r\n        } else {\r\n          selectedPermissions.delete(value);\r\n        }\r\n        \r\n        updateItemStyles(content);\r\n      });\r\n    });\r\n\r\n    // Category toggle buttons\r\n    content.querySelectorAll('.category-toggle').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => {\r\n        const category = btn.closest('.permission-category');\r\n        if (!category) return;\r\n        \r\n        const checkboxes = category.querySelectorAll('input[name=\"permission\"]');\r\n        const allChecked = Array.from(checkboxes).every(cb => (cb as HTMLInputElement).checked);\r\n        \r\n        checkboxes.forEach(cb => {\r\n          const input = cb as HTMLInputElement;\r\n          input.checked = !allChecked;\r\n          if (!allChecked) {\r\n            selectedPermissions.add(input.value);\r\n          } else {\r\n            selectedPermissions.delete(input.value);\r\n          }\r\n        });\r\n        \r\n        updateItemStyles(content);\r\n      });\r\n    });\r\n\r\n    // Cancel button\r\n    const cancelBtn = content.querySelector('#btn-cancel');\r\n    if (cancelBtn) {\r\n      on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n    }\r\n\r\n    // Save button\r\n    const saveBtn = content.querySelector('#btn-save');\r\n    if (saveBtn) {\r\n      on(saveBtn as HTMLElement, 'click', async () => {\r\n        const role = roleSelect?.value || currentRole;\r\n        const permissions = Array.from(selectedPermissions);\r\n        \r\n        (saveBtn as HTMLButtonElement).disabled = true;\r\n        saveBtn.textContent = 'Saving...';\r\n        \r\n        try {\r\n          await http.put(`/api/projects/${projectId}/members/${userId}/permissions`, {\r\n            role,\r\n            permissions,\r\n          });\r\n          \r\n          toast.success('Permissions updated');\r\n          closeModal(MODAL_ID);\r\n          onSave?.();\r\n        } catch (error) {\r\n          toast.error('Failed to update permissions');\r\n          (saveBtn as HTMLButtonElement).disabled = false;\r\n          saveBtn.textContent = 'Save Permissions';\r\n        }\r\n      });\r\n    }\r\n  }, 0);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Member Permissions',\r\n    content,\r\n    size: 'lg',\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Update checkboxes from selected set\r\n */\r\nfunction updateCheckboxes(container: HTMLElement, selected: Set<string>): void {\r\n  container.querySelectorAll('input[name=\"permission\"]').forEach(cb => {\r\n    const input = cb as HTMLInputElement;\r\n    input.checked = selected.has(input.value);\r\n  });\r\n  updateItemStyles(container);\r\n}\r\n\r\n/**\r\n * Update item styles based on selection\r\n */\r\nfunction updateItemStyles(container: HTMLElement): void {\r\n  container.querySelectorAll('.permission-item').forEach(item => {\r\n    const checkbox = item.querySelector('input[name=\"permission\"]') as HTMLInputElement;\r\n    item.classList.toggle('selected', checkbox?.checked || false);\r\n  });\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showMemberPermissionsModal;\r\n","/**\n * Project Modal - SOTA Design\n * Create and edit projects with modern glassmorphism design\n * Includes: General settings, Members, Roles, and Configuration tabs\n */\n\nimport { createModal, openModal, closeModal, confirm } from '../Modal';\nimport { createElement, on } from '../../utils/dom';\nimport { appStore } from '../../stores/app';\nimport { dataStore } from '../../stores/data';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { showMemberPermissionsModal } from './MemberPermissionsModal';\nimport { listCompanies } from '../../services/companies';\n\nconst MODAL_ID = 'project-modal';\n\n// ==================== Types ====================\n\nexport interface ProjectData {\n  id?: string;\n  name: string;\n  description?: string;\n  owner_id?: string;\n  company_id?: string;\n  company?: { id: string; name?: string; logo_url?: string; brand_assets?: Record<string, unknown> };\n  settings?: ProjectSettings;\n  created_at?: string;\n  updated_at?: string;\n}\n\ninterface ProjectSettings {\n  userRole?: string;\n  userRolePrompt?: string;\n}\n\ninterface ProjectMember {\n  user_id: string;\n  email?: string;\n  display_name?: string;\n  avatar_url?: string;\n  role: 'owner' | 'admin' | 'write' | 'read';\n  user_role?: string;\n  user_role_prompt?: string;\n  linked_contact_id?: string;\n  linked_contact?: {\n    id: string;\n    name: string;\n    email?: string;\n    organization?: string;\n    role?: string;\n  };\n  joined_at: string;\n}\n\ninterface Contact {\n  id: string;\n  name: string;\n  email?: string;\n  organization?: string;\n  role?: string;\n}\n\ninterface RoleTemplate {\n  id: string;\n  name: string;\n  display_name: string;\n  description?: string;\n  icon?: string;\n  prompt_template?: string;\n  focus_areas?: string[];\n  category?: string;\n  is_builtin: boolean;\n  is_active: boolean;\n}\n\ninterface ProjectConfig {\n  id?: string;\n  project_id: string;\n  llm_config?: Record<string, unknown>;\n  ollama_config?: Record<string, unknown>;\n  prompts?: Record<string, string>;\n  processing_settings?: Record<string, unknown>;\n  ui_preferences?: Record<string, unknown>;\n}\n\nexport interface ProjectModalProps {\n  mode: 'create' | 'edit';\n  project?: ProjectData;\n  onSave?: (project: ProjectData) => void;\n  onDelete?: (projectId: string) => void;\n}\n\n// ==================== State ====================\n\nlet currentProps: ProjectModalProps = { mode: 'create' };\nlet currentProject: ProjectData | null = null;\n/** When set, form is shown inline (no modal); close/cancel/save/delete call this then clear */\nlet inlineOnCancel: (() => void) | null = null;\nlet projectMembers: ProjectMember[] = [];\nlet projectRoles: RoleTemplate[] = [];\nlet projectConfig: ProjectConfig | null = null;\nlet projectContacts: Contact[] = [];\n\n// ==================== Main Functions ====================\n\n/**\n * Show project modal (or inline when container provided)\n */\nexport function showProjectModal(props: ProjectModalProps & { inlineContainer?: HTMLElement; onCancel?: () => void }): void {\n  currentProps = props;\n  currentProject = props.project || null;\n  inlineOnCancel = props.inlineContainer ? (props.onCancel ?? (() => {})) : null;\n\n  const content = createModalContent(props.mode);\n\n  if (props.inlineContainer) {\n    props.inlineContainer.innerHTML = '';\n    props.inlineContainer.appendChild(content);\n    if (props.mode === 'edit' && props.project?.id) {\n      loadProjectData(content, props.project.id);\n    } else {\n      renderCreateForm(content);\n    }\n    return;\n  }\n\n  const modal = createModal({\n    id: MODAL_ID,\n    title: '',\n    size: 'lg',\n    content: content,\n  });\n\n  // Remove default modal styling for custom design\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\n  if (modalContent) {\n    modalContent.classList.add('project-modal-content-bare');\n  }\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\n  if (modalHeader) {\n    modalHeader.classList.add('hidden');\n  }\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  if (props.mode === 'edit' && props.project?.id) {\n    loadProjectData(content, props.project.id);\n  } else {\n    renderCreateForm(content);\n  }\n}\n\nfunction closeOrInlineCancel(): void {\n  if (inlineOnCancel) {\n    inlineOnCancel();\n    inlineOnCancel = null;\n  } else {\n    closeModal(MODAL_ID);\n  }\n}\n\n/**\n * Create modal content with SOTA styling\n */\nfunction createModalContent(mode: 'create' | 'edit'): HTMLElement {\n  const container = createElement('div', { className: 'project-modal-sota' });\n\n  container.innerHTML = `\n    <style>\n      .project-modal-sota {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n      \n      .project-card {\n        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\n        backdrop-filter: blur(20px);\n        border-radius: 24px;\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\n          0 0 0 1px rgba(255, 255, 255, 0.8),\n          inset 0 1px 0 rgba(255, 255, 255, 0.9);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .project-card {\n        background: linear-gradient(135deg, rgba(30,41,59,0.95) 0%, rgba(15,23,42,0.95) 100%);\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.05);\n      }\n      \n      .project-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 32px;\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .project-header::before {\n        content: '';\n        position: absolute;\n        top: -50%;\n        right: -50%;\n        width: 100%;\n        height: 200%;\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\n        pointer-events: none;\n      }\n      \n      .project-header-content {\n        display: flex;\n        align-items: center;\n        gap: 20px;\n        position: relative;\n        z-index: 1;\n      }\n      \n      .project-icon-large {\n        width: 72px;\n        height: 72px;\n        border-radius: 18px;\n        background: rgba(255,255,255,0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border: 3px solid rgba(255,255,255,0.3);\n        flex-shrink: 0;\n      }\n      \n      .project-icon-large svg {\n        width: 36px;\n        height: 36px;\n        color: white;\n      }\n      \n      .project-title-info h2 {\n        margin: 0 0 4px 0;\n        font-size: 24px;\n        font-weight: 700;\n        color: white;\n      }\n      \n      .project-title-info p {\n        margin: 0;\n        color: rgba(255,255,255,0.8);\n        font-size: 14px;\n      }\n      \n      .project-close-btn {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n        z-index: 10;\n      }\n      \n      .project-close-btn:hover {\n        background: rgba(255,255,255,0.3);\n        transform: rotate(90deg);\n      }\n      \n      .project-close-btn svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n      \n      .project-tabs-nav {\n        display: flex;\n        gap: 0;\n        padding: 0 24px;\n        background: rgba(0,0,0,0.02);\n        border-bottom: 1px solid rgba(0,0,0,0.06);\n        overflow-x: auto;\n      }\n      \n      [data-theme=\"dark\"] .project-tabs-nav {\n        background: rgba(255,255,255,0.02);\n        border-bottom-color: rgba(255,255,255,0.06);\n      }\n      \n      .project-tab-btn {\n        padding: 16px 20px;\n        background: transparent;\n        border: none;\n        font-size: 14px;\n        font-weight: 500;\n        color: #64748b;\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n        white-space: nowrap;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .project-tab-btn:hover {\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .project-tab-btn:hover {\n        color: #e2e8f0;\n      }\n      \n      .project-tab-btn.active {\n        color: #e11d48;\n      }\n      \n      .project-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 20px;\n        right: 20px;\n        height: 2px;\n        background: #e11d48;\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .project-tab-icon {\n        width: 18px;\n        height: 18px;\n      }\n      \n      .project-body {\n        padding: 32px;\n        max-height: 60vh;\n        overflow-y: auto;\n      }\n      \n      .project-section {\n        display: none;\n      }\n      \n      .project-section.active {\n        display: block;\n      }\n      \n      .form-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 20px;\n      }\n      \n      .form-grid .full-width {\n        grid-column: 1 / -1;\n      }\n      \n      .form-field {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n      }\n      \n      .form-field label {\n        font-size: 13px;\n        font-weight: 600;\n        color: #475569;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n      \n      [data-theme=\"dark\"] .form-field label {\n        color: #94a3b8;\n      }\n      \n      .form-field input,\n      .form-field select,\n      .form-field textarea {\n        padding: 12px 16px;\n        border: 1px solid #e2e8f0;\n        border-radius: 12px;\n        font-size: 14px;\n        background: #f8fafc;\n        color: #1e293b;\n        transition: all 0.2s;\n        outline: none;\n      }\n      \n      [data-theme=\"dark\"] .form-field input,\n      [data-theme=\"dark\"] .form-field select,\n      [data-theme=\"dark\"] .form-field textarea {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .form-field input:focus,\n      .form-field select:focus,\n      .form-field textarea:focus {\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .form-field input:disabled {\n        background: #f1f5f9;\n        color: #94a3b8;\n        cursor: not-allowed;\n      }\n      \n      .form-field textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .form-hint {\n        font-size: 12px;\n        color: #94a3b8;\n      }\n      \n      .form-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        margin-top: 24px;\n        padding-top: 24px;\n        border-top: 1px solid rgba(0,0,0,0.06);\n      }\n      \n      [data-theme=\"dark\"] .form-actions {\n        border-top-color: rgba(255,255,255,0.06);\n      }\n      \n      .btn-sota {\n        padding: 12px 24px;\n        border-radius: 12px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .btn-sota.primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\n      }\n      \n      .btn-sota.primary:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\n      }\n      \n      .btn-sota.primary:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n        transform: none;\n      }\n      \n      .btn-sota.secondary {\n        background: #f1f5f9;\n        color: #475569;\n      }\n      \n      [data-theme=\"dark\"] .btn-sota.secondary {\n        background: rgba(255,255,255,0.1);\n        color: #e2e8f0;\n      }\n      \n      .btn-sota.secondary:hover {\n        background: #e2e8f0;\n      }\n      \n      .btn-sota.danger {\n        background: transparent;\n        color: #dc2626;\n        border: 1px solid #fecaca;\n      }\n      \n      .btn-sota.danger:hover {\n        background: #fef2f2;\n        border-color: #dc2626;\n      }\n      \n      .btn-sota.small {\n        padding: 8px 16px;\n        font-size: 13px;\n      }\n      \n      /* Section Headers */\n      .section-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 20px;\n      }\n      \n      .section-header h3 {\n        font-size: 16px;\n        font-weight: 600;\n        color: #1e293b;\n        margin: 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      [data-theme=\"dark\"] .section-header h3 {\n        color: #f1f5f9;\n      }\n      \n      .section-header h3 svg {\n        width: 20px;\n        height: 20px;\n        color: #e11d48;\n      }\n      \n      /* Members List */\n      .members-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      \n      .member-card {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 16px 20px;\n        background: #f8fafc;\n        border-radius: 12px;\n        border: 1px solid transparent;\n        transition: all 0.2s;\n      }\n      \n      [data-theme=\"dark\"] .member-card {\n        background: rgba(255,255,255,0.03);\n      }\n      \n      .member-card:hover {\n        border-color: #e2e8f0;\n      }\n      \n      .member-card.owner {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n      }\n      \n      .member-info {\n        display: flex;\n        align-items: center;\n        gap: 14px;\n      }\n      \n      .member-avatar {\n        width: 44px;\n        height: 44px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 16px;\n        font-weight: 600;\n        color: white;\n        flex-shrink: 0;\n        overflow: hidden;\n      }\n      \n      .member-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .member-details h4 {\n        margin: 0 0 4px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .member-details h4 {\n        color: #f1f5f9;\n      }\n      \n      .member-details p {\n        margin: 0;\n        font-size: 12px;\n        color: #64748b;\n      }\n      \n      .member-actions {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n      \n      .role-badge {\n        font-size: 11px;\n        font-weight: 600;\n        padding: 4px 10px;\n        border-radius: 20px;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n      \n      .role-badge.owner {\n        background: #e11d48;\n        color: white;\n      }\n      \n      .role-badge.admin {\n        background: #8b5cf6;\n        color: white;\n      }\n      \n      .role-badge.write {\n        background: #0ea5e9;\n        color: white;\n      }\n      \n      .role-badge.read {\n        background: #64748b;\n        color: white;\n      }\n      \n      .role-select {\n        padding: 6px 12px;\n        border: 1px solid #e2e8f0;\n        border-radius: 8px;\n        font-size: 13px;\n        background: white;\n        cursor: pointer;\n      }\n      \n      [data-theme=\"dark\"] .role-select {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      /* Role Templates List */\n      .roles-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 16px;\n      }\n      \n      .role-card {\n        padding: 20px;\n        background: #f8fafc;\n        border-radius: 16px;\n        border: 2px solid transparent;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      \n      [data-theme=\"dark\"] .role-card {\n        background: rgba(255,255,255,0.03);\n      }\n      \n      .role-card:hover {\n        border-color: #e2e8f0;\n        transform: translateY(-2px);\n      }\n      \n      .role-card.active {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n      }\n      \n      .role-card-header {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        margin-bottom: 12px;\n      }\n      \n      .role-icon {\n        width: 40px;\n        height: 40px;\n        border-radius: 10px;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      \n      .role-icon svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n      \n      .role-card h4 {\n        margin: 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .role-card h4 {\n        color: #f1f5f9;\n      }\n      \n      .role-card p {\n        margin: 0;\n        font-size: 13px;\n        color: #64748b;\n        line-height: 1.5;\n      }\n      \n      .role-card .toggle-active {\n        margin-top: 12px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 12px;\n        color: #64748b;\n      }\n      \n      /* Config Section */\n      .config-group {\n        margin-bottom: 32px;\n      }\n      \n      .config-group h4 {\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n        margin: 0 0 16px 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      [data-theme=\"dark\"] .config-group h4 {\n        color: #f1f5f9;\n      }\n      \n      .config-group h4 svg {\n        width: 16px;\n        height: 16px;\n        color: #e11d48;\n      }\n      \n      .api-key-field {\n        display: flex;\n        gap: 12px;\n      }\n      \n      .api-key-field input {\n        flex: 1;\n      }\n      \n      .api-key-field .btn-sota {\n        flex-shrink: 0;\n      }\n      \n      /* Danger Zone */\n      .danger-zone {\n        background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);\n        border: 1px solid #fecaca;\n        border-radius: 16px;\n        padding: 24px;\n        margin-top: 32px;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone {\n        background: linear-gradient(135deg, rgba(220,38,38,0.1) 0%, rgba(220,38,38,0.05) 100%);\n        border-color: rgba(220,38,38,0.3);\n      }\n      \n      .danger-zone h3 {\n        color: #dc2626 !important;\n        margin: 0 0 8px 0;\n        font-size: 16px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .danger-zone h3 svg {\n        width: 18px;\n        height: 18px;\n      }\n      \n      .danger-zone p {\n        color: #991b1b;\n        font-size: 14px;\n        margin: 0 0 16px 0;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone p {\n        color: #fca5a5;\n      }\n      \n      /* Empty State */\n      .empty-state {\n        text-align: center;\n        padding: 48px 24px;\n        color: #94a3b8;\n      }\n      \n      .empty-state svg {\n        width: 48px;\n        height: 48px;\n        margin-bottom: 16px;\n        opacity: 0.5;\n      }\n      \n      .empty-state p {\n        margin: 0 0 16px 0;\n      }\n      \n      /* Loading */\n      .loading-spinner {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 48px;\n      }\n      \n      .loading-spinner::after {\n        content: '';\n        width: 32px;\n        height: 32px;\n        border: 3px solid #e2e8f0;\n        border-top-color: #e11d48;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n      }\n      \n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n      \n      /* Responsive */\n      @media (max-width: 640px) {\n        .form-grid {\n          grid-template-columns: 1fr;\n        }\n        \n        .roles-grid {\n          grid-template-columns: 1fr;\n        }\n        \n        .project-tabs-nav {\n          padding: 0 16px;\n        }\n        \n        .project-tab-btn {\n          padding: 14px 16px;\n        }\n      }\n    </style>\n    \n    <div class=\"project-card\">\n      <div class=\"loading-spinner\"></div>\n    </div>\n  `;\n\n  return container;\n}\n\n/**\n * Load project data for editing\n */\nasync function loadProjectData(container: HTMLElement, projectId: string): Promise<void> {\n  const card = container.querySelector('.project-card') as HTMLElement;\n  if (!card) return;\n\n  try {\n    // Load project details, members, roles, config, and contacts in parallel\n    const [projectRes, membersRes, rolesRes, configRes, contactsRes] = await Promise.all([\n      http.get<{ project: ProjectData }>(`/api/projects/${projectId}`).catch(() => null),\n      http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`).catch(() => ({ data: { members: [] } })),\n      http.get<{ roles: RoleTemplate[] }>('/api/role-templates').catch(() => ({ data: { roles: [] } })),\n      http.get<{ config: ProjectConfig }>(`/api/projects/${projectId}/config`).catch(() => ({ data: { config: null } })),\n      http.get<{ contacts: Contact[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\n    ]);\n\n    if (projectRes?.data?.project) {\n      currentProject = projectRes.data.project;\n    }\n    projectMembers = membersRes?.data?.members || [];\n    projectRoles = rolesRes?.data?.roles || [];\n    projectConfig = configRes?.data?.config || null;\n    // Handle different response formats for contacts\n    const contactsData = contactsRes?.data;\n    projectContacts = Array.isArray(contactsData) ? contactsData : (contactsData?.contacts || []);\n\n    renderEditForm(card);\n  } catch {\n    // Use props project as fallback\n    renderEditForm(card);\n  }\n}\n\n/**\n * Render create form\n */\nfunction renderCreateForm(container: HTMLElement): void {\n  const card = container.querySelector('.project-card') as HTMLElement;\n  if (!card) return;\n\n  card.innerHTML = `\n    <!-- Header -->\n    <div class=\"project-header\">\n      <button class=\"project-close-btn\" id=\"close-project-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n      \n      <div class=\"project-header-content\">\n        <div class=\"project-icon-large\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n          </svg>\n        </div>\n        <div class=\"project-title-info\">\n          <h2>New Project</h2>\n          <p>Create a new project to organize your work</p>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Form -->\n    <div class=\"project-body\">\n      <form id=\"project-form\">\n        <div class=\"form-grid\">\n          <div class=\"form-field full-width\">\n            <label>\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n              </svg>\n              Project Name *\n            </label>\n            <input type=\"text\" name=\"name\" required placeholder=\"Enter project name\">\n          </div>\n          \n          <div class=\"form-field full-width\">\n            <label>\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\n              </svg>\n              Description\n            </label>\n            <textarea name=\"description\" placeholder=\"Brief description of the project\"></textarea>\n          </div>\n          <div class=\"form-field full-width\">\n            <label>\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\n              </svg>\n              Company *\n            </label>\n            <select name=\"company_id\" id=\"project-company-id\">\n              <option value=\"\">Loading...</option>\n            </select>\n          </div>\n        </div>\n        \n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"cancel-btn\">Cancel</button>\n          <button type=\"submit\" class=\"btn-sota primary\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n            </svg>\n            Create Project\n          </button>\n        </div>\n      </form>\n    </div>\n  `;\n\n  bindCreateEvents(card);\n}\n\n/**\n * Render edit form with tabs\n */\nfunction renderEditForm(container: HTMLElement): void {\n  const project = currentProject || currentProps.project;\n  if (!project) return;\n\n  const settings = project.settings || {};\n\n  container.innerHTML = `\n    <!-- Header -->\n    <div class=\"project-header\">\n      <button class=\"project-close-btn\" id=\"close-project-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n      \n      <div class=\"project-header-content\">\n        <div class=\"project-icon-large\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\"/>\n          </svg>\n        </div>\n        <div class=\"project-title-info\">\n          <h2>${escapeHtml(project.name)}</h2>\n          <p>${project.description ? escapeHtml(project.description) : 'No description'}</p>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Tabs Navigation -->\n    <nav class=\"project-tabs-nav\">\n      <button class=\"project-tab-btn active\" data-tab=\"general\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/>\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\n        </svg>\n        General\n      </button>\n      <button class=\"project-tab-btn\" data-tab=\"members\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\n        </svg>\n        Members\n        <span class=\"badge\">${projectMembers.length}</span>\n      </button>\n      <button class=\"project-tab-btn\" data-tab=\"roles\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\n        </svg>\n        Roles\n      </button>\n      <button class=\"project-tab-btn\" data-tab=\"config\">\n        <svg class=\"project-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4\"/>\n        </svg>\n        Config\n      </button>\n    </nav>\n    \n    <!-- Tab Content -->\n    <div class=\"project-body\">\n      <!-- General Tab -->\n      <div class=\"project-section active\" id=\"section-general\">\n        <form id=\"project-form\">\n          <div class=\"form-grid\">\n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n                </svg>\n                Project Name *\n              </label>\n              <input type=\"text\" name=\"name\" required value=\"${escapeHtml(project.name)}\" placeholder=\"Enter project name\">\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\n                </svg>\n                Description\n              </label>\n              <textarea name=\"description\" placeholder=\"Brief description of the project\">${escapeHtml(project.description || '')}</textarea>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                </svg>\n                Your Role\n              </label>\n              <input type=\"text\" name=\"userRole\" value=\"${escapeHtml(settings.userRole || '')}\" placeholder=\"e.g., Project Manager, Tech Lead\">\n              <span class=\"form-hint\">Your role in this project (used for AI context)</span>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\"/>\n                </svg>\n                Role Prompt\n              </label>\n              <input type=\"text\" name=\"userRolePrompt\" value=\"${escapeHtml(settings.userRolePrompt || '')}\" placeholder=\"e.g., I manage the project timeline\">\n              <span class=\"form-hint\">Brief description of your responsibilities</span>\n            </div>\n\n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\n                </svg>\n                Company\n              </label>\n              <select name=\"company_id\" id=\"project-company-id\">\n                <option value=\"\">Loading...</option>\n              </select>\n            </div>\n          </div>\n          \n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-sota primary\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              Save Changes\n            </button>\n          </div>\n        </form>\n        \n        <!-- Danger Zone -->\n        <div class=\"danger-zone\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n            </svg>\n            Danger Zone\n          </h3>\n          <p>Deleting a project will permanently remove all associated data including questions, decisions, risks, and contacts.</p>\n          <button type=\"button\" class=\"btn-sota danger\" id=\"delete-project-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\n            </svg>\n            Delete Project\n          </button>\n        </div>\n      </div>\n      \n      <!-- Members Tab -->\n      <div class=\"project-section\" id=\"section-members\">\n        <div class=\"section-header\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\n            </svg>\n            Team Members\n          </h3>\n          <button class=\"btn-sota primary small\" id=\"invite-member-btn\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\n            </svg>\n            Invite\n          </button>\n        </div>\n        \n        <div class=\"members-list\" id=\"members-list\">\n          ${renderMembersList()}\n        </div>\n      </div>\n      \n      <!-- Roles Tab -->\n      <div class=\"project-section\" id=\"section-roles\">\n        <div class=\"section-header\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\n            </svg>\n            Available Roles\n          </h3>\n          <button class=\"btn-sota primary small\" id=\"add-role-btn\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n            </svg>\n            Add Role\n          </button>\n        </div>\n        <p class=\"section-intro\">\n          Select which roles are available for team members in this project.\n        </p>\n        \n        <div class=\"roles-grid\" id=\"roles-grid\">\n          ${renderRolesList()}\n        </div>\n      </div>\n      \n      <!-- Config Tab -->\n      <div class=\"project-section\" id=\"section-config\">\n        <div class=\"section-header\">\n          <h3>\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4\"/>\n            </svg>\n            Project Configuration\n          </h3>\n        </div>\n        <p class=\"section-intro-24\">\n          Override system defaults with project-specific API keys. Leave empty to use system defaults.\n        </p>\n        \n        <form id=\"config-form\">\n          <!-- LLM Per-Task Configuration -->\n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z\"/>\n              </svg>\n              LLM Model Selection\n            </h4>\n            <p class=\"section-intro-sm\">\n              Override system defaults for each task type. Uncheck to use platform defaults.\n            </p>\n            \n            <!-- Text -->\n            <div class=\"llm-task-override\">\n              <div class=\"task-header-inline\">\n                <label class=\"checkbox-inline\">\n                  <input type=\"checkbox\" name=\"use_system_text\" ${getConfigValue('llm_pertask.useSystemDefaults.text') !== 'false' ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Text / Chat\n                </label>\n                <span class=\"system-hint\">(Use system default)</span>\n              </div>\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.text') !== 'false' ? 'disabled' : ''}\">\n                <select name=\"text_provider\" class=\"form-control\" disabled>\n                  <option value=\"\">Loading...</option>\n                </select>\n                <select name=\"text_model\" class=\"form-control\" disabled>\n                  <option value=\"\">Select provider first</option>\n                </select>\n              </div>\n            </div>\n            \n            <!-- Vision -->\n            <div class=\"llm-task-override\">\n              <div class=\"task-header-inline\">\n                <label class=\"checkbox-inline\">\n                  <input type=\"checkbox\" name=\"use_system_vision\" ${getConfigValue('llm_pertask.useSystemDefaults.vision') !== 'false' ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Vision\n                </label>\n                <span class=\"system-hint\">(Use system default)</span>\n              </div>\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.vision') !== 'false' ? 'disabled' : ''}\">\n                <select name=\"vision_provider\" class=\"form-control\" disabled>\n                  <option value=\"\">Loading...</option>\n                </select>\n                <select name=\"vision_model\" class=\"form-control\" disabled>\n                  <option value=\"\">Select provider first</option>\n                </select>\n              </div>\n            </div>\n            \n            <!-- Embeddings -->\n            <div class=\"llm-task-override\">\n              <div class=\"task-header-inline\">\n                <label class=\"checkbox-inline\">\n                  <input type=\"checkbox\" name=\"use_system_embeddings\" ${getConfigValue('llm_pertask.useSystemDefaults.embeddings') !== 'false' ? 'checked' : ''}>\n                  <span class=\"task-icon\"></span> Embeddings\n                </label>\n                <span class=\"system-hint\">(Use system default)</span>\n              </div>\n              <div class=\"task-override-fields ${getConfigValue('llm_pertask.useSystemDefaults.embeddings') !== 'false' ? 'disabled' : ''}\">\n                <select name=\"embeddings_provider\" class=\"form-control\" disabled>\n                  <option value=\"\">Loading...</option>\n                </select>\n                <select name=\"embeddings_model\" class=\"form-control\" disabled>\n                  <option value=\"\">Select provider first</option>\n                </select>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z\"/>\n              </svg>\n              LLM API Keys\n            </h4>\n            <p class=\"section-intro-sm\">\n              Override system API keys for this project. Leave empty to use system defaults.\n            </p>\n            \n            <div class=\"form-grid\">\n              <div class=\"form-field\">\n                <label>OpenAI API Key</label>\n                <input type=\"password\" name=\"openai_key\" placeholder=\"sk-...\" value=\"${escapeHtml(getConfigValue('llm_config.openai_key'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Anthropic API Key</label>\n                <input type=\"password\" name=\"anthropic_key\" placeholder=\"sk-ant-...\" value=\"${escapeHtml(getConfigValue('llm_config.anthropic_key'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Google AI API Key</label>\n                <input type=\"password\" name=\"google_key\" placeholder=\"AI...\" value=\"${escapeHtml(getConfigValue('llm_config.google_key'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>xAI (Grok) API Key</label>\n                <input type=\"password\" name=\"grok_key\" placeholder=\"xai-...\" value=\"${escapeHtml(getConfigValue('llm_config.grok_key'))}\">\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"config-group\">\n            <h4>\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01\"/>\n              </svg>\n              Ollama Configuration\n            </h4>\n            \n            <div class=\"form-grid\">\n              <div class=\"form-field\">\n                <label>Ollama URL</label>\n                <input type=\"url\" name=\"ollama_url\" placeholder=\"http://localhost:11434\" value=\"${escapeHtml(getConfigValue('ollama_config.url'))}\">\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Default Model</label>\n                <input type=\"text\" name=\"ollama_model\" placeholder=\"llama2, mistral, etc.\" value=\"${escapeHtml(getConfigValue('ollama_config.model'))}\">\n              </div>\n            </div>\n          </div>\n          \n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-sota primary\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              Save Configuration\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  `;\n\n  bindEditEvents(container);\n}\n\n// ==================== Render Helpers ====================\n\nfunction renderMembersList(): string {\n  if (projectMembers.length === 0) {\n    return `\n      <div class=\"empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\"/>\n        </svg>\n        <p>No team members yet</p>\n        <button class=\"btn-sota primary small\" id=\"invite-first-btn\">Invite Member</button>\n      </div>\n    `;\n  }\n\n  return projectMembers.map(member => {\n    const initials = getInitials(member.display_name || member.email || 'U');\n    const isOwner = member.role === 'owner';\n    \n    return `\n      <div class=\"member-card ${isOwner ? 'owner' : ''}\" data-user-id=\"${member.user_id}\">\n        <div class=\"member-info\">\n          <div class=\"member-avatar\">\n            ${member.avatar_url \n              ? `<img src=\"${member.avatar_url}\" alt=\"${escapeHtml(member.display_name || '')}\">`\n              : initials\n            }\n          </div>\n          <div class=\"member-details\">\n            <h4>${escapeHtml(member.display_name || member.email || 'Unknown')}</h4>\n            <p>\n              ${escapeHtml(member.email || '')}\n              ${member.user_role ? `  <strong>${escapeHtml(member.user_role)}</strong>` : '  <em class=\"member-role-muted\">No role defined</em>'}\n              ${member.linked_contact ? `  <span class=\"member-link\" title=\"Linked to contact: ${escapeHtml(member.linked_contact.name)}\"> ${escapeHtml(member.linked_contact.name)}</span>` : ''}\n            </p>\n          </div>\n        </div>\n        <div class=\"member-actions\">\n          <button class=\"btn-sota secondary small edit-user-role-btn\" data-user-id=\"${member.user_id}\" title=\"Edit project role\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\n            </svg>\n          </button>\n          <button class=\"btn-sota secondary small permissions-btn\" data-user-id=\"${member.user_id}\" title=\"Edit permissions\">\n            \n          </button>\n          ${isOwner \n            ? `<span class=\"role-badge owner\">Owner</span>`\n            : `\n              <select class=\"role-select member-role-select\" data-user-id=\"${member.user_id}\" title=\"Access level\">\n                <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\n                <option value=\"write\" ${member.role === 'write' ? 'selected' : ''}>Write</option>\n                <option value=\"read\" ${member.role === 'read' ? 'selected' : ''}>Read</option>\n              </select>\n              <button class=\"btn-sota danger small remove-member-btn\" data-user-id=\"${member.user_id}\" title=\"Remove member\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n                </svg>\n              </button>\n            `\n          }\n        </div>\n      </div>\n    `;\n  }).join('');\n}\n\nfunction renderRolesList(): string {\n  if (projectRoles.length === 0) {\n    return `\n      <div class=\"empty-state gm-grid-col-all\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z\"/>\n        </svg>\n        <p>No role templates available</p>\n      </div>\n    `;\n  }\n\n  return projectRoles.map(role => `\n    <div class=\"role-card ${role.is_active ? 'active' : ''}\" data-role-id=\"${role.id}\">\n      <div class=\"role-card-header\">\n        <div class=\"role-icon\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n          </svg>\n        </div>\n        <h4>${escapeHtml(role.display_name)}</h4>\n      </div>\n      <p>${escapeHtml(role.description || 'No description')}</p>\n      <div class=\"toggle-active\">\n        <input type=\"checkbox\" id=\"role-${role.id}\" ${role.is_active ? 'checked' : ''}>\n        <label for=\"role-${role.id}\">Active in this project</label>\n      </div>\n    </div>\n  `).join('');\n}\n\nfunction getConfigValue(path: string): string {\n  if (!projectConfig) return '';\n  \n  const parts = path.split('.');\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let value: any = projectConfig;\n  \n  for (const part of parts) {\n    if (value && typeof value === 'object' && part in value) {\n      value = value[part];\n    } else {\n      return '';\n    }\n  }\n  \n  return typeof value === 'string' ? value : '';\n}\n\n// ==================== Event Binding ====================\n\nfunction bindCreateEvents(container: HTMLElement): void {\n  // Close button\n  const closeBtn = container.querySelector('#close-project-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => closeOrInlineCancel());\n  }\n\n  // Cancel button\n  const cancelBtn = container.querySelector('#cancel-btn');\n  if (cancelBtn) {\n    on(cancelBtn as HTMLElement, 'click', () => closeOrInlineCancel());\n  }\n\n  // Load companies for dropdown\n  const companySelect = container.querySelector('#project-company-id') as HTMLSelectElement;\n  if (companySelect) {\n    listCompanies()\n      .then((companies) => {\n        companySelect.innerHTML = '<option value=\"\">Use default company</option>' +\n          companies.map((c) => `<option value=\"${c.id}\">${escapeHtml(c.name)}</option>`).join('');\n      })\n      .catch(() => {\n        companySelect.innerHTML = '<option value=\"\">Use default company</option>';\n      });\n  }\n\n  // Form submit\n  const form = container.querySelector('#project-form') as HTMLFormElement;\n  if (form) {\n    on(form, 'submit', async (e) => {\n      e.preventDefault();\n      \n      const formData = new FormData(form);\n      const companyId = (formData.get('company_id') as string)?.trim() || undefined;\n      const projectData: ProjectData & { company_id?: string } = {\n        name: (formData.get('name') as string).trim(),\n        description: (formData.get('description') as string).trim() || undefined,\n      };\n      if (companyId) projectData.company_id = companyId;\n\n      const submitBtn = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\n      submitBtn.disabled = true;\n      submitBtn.innerHTML = '<span class=\"loading-spinner gm-size-4\"></span> Creating...';\n\n      try {\n        const response = await http.post<{ id: string; project?: ProjectData }>('/api/projects', projectData);\n        projectData.id = response.data.id;\n        \n        toast.success('Project created');\n        \n        // Set as current project\n        appStore.setCurrentProject({\n          id: projectData.id,\n          name: projectData.name,\n          description: projectData.description,\n        });\n        \n        currentProps.onSave?.(projectData);\n        closeOrInlineCancel();\n        loadProjects();\n      } catch {\n        toast.error('Failed to create project');\n      } finally {\n        submitBtn.disabled = false;\n        submitBtn.innerHTML = `\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create Project\n        `;\n      }\n    });\n  }\n}\n\nfunction bindEditEvents(container: HTMLElement): void {\n  // Close button\n  const closeBtn = container.querySelector('#close-project-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => closeOrInlineCancel());\n  }\n\n  // Tab switching\n  const tabs = container.querySelectorAll('.project-tab-btn');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n\n      const tabId = tab.getAttribute('data-tab');\n      container.querySelectorAll('.project-section').forEach(section => {\n        section.classList.toggle('active', section.id === `section-${tabId}`);\n      });\n    });\n  });\n\n  // Load companies for edit form dropdown\n  const companySelectEdit = container.querySelector('#project-company-id') as HTMLSelectElement;\n  if (companySelectEdit) {\n    const project = currentProject || currentProps.project;\n    const currentCompanyId = project?.company_id ?? (project as ProjectData & { company?: { id: string } })?.company?.id;\n    listCompanies()\n      .then((companies) => {\n        companySelectEdit.innerHTML = '<option value=\"\"></option>' +\n          companies.map((c) => `<option value=\"${c.id}\" ${c.id === currentCompanyId ? 'selected' : ''}>${escapeHtml(c.name)}</option>`).join('');\n      })\n      .catch(() => {\n        companySelectEdit.innerHTML = '<option value=\"\"></option>';\n      });\n  }\n\n  // General form submit\n  const projectForm = container.querySelector('#project-form') as HTMLFormElement;\n  if (projectForm) {\n    on(projectForm, 'submit', async (e) => {\n      e.preventDefault();\n      \n      const formData = new FormData(projectForm);\n      const companyId = (formData.get('company_id') as string)?.trim() || undefined;\n      const projectData: Record<string, unknown> = {\n        name: (formData.get('name') as string).trim(),\n        description: (formData.get('description') as string).trim() || undefined,\n        settings: {\n          userRole: (formData.get('userRole') as string).trim() || undefined,\n          userRolePrompt: (formData.get('userRolePrompt') as string).trim() || undefined,\n        },\n      };\n      if (companyId) projectData.company_id = companyId;\n\n      try {\n        await http.put(`/api/projects/${currentProject?.id || currentProps.project?.id}`, projectData);\n        toast.success('Project updated');\n        currentProps.onSave?.({ ...currentProject, ...projectData } as ProjectData);\n        if (inlineOnCancel) closeOrInlineCancel();\n\n        // Update header\n        const titleEl = container.querySelector('.project-title-info h2');\n        const descEl = container.querySelector('.project-title-info p');\n        if (titleEl) titleEl.textContent = String(projectData.name);\n        if (descEl) descEl.textContent = String(projectData.description || 'No description');\n      } catch {\n        toast.error('Failed to update project');\n      }\n    });\n  }\n\n  // Delete project\n  const deleteBtn = container.querySelector('#delete-project-btn');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      const project = currentProject || currentProps.project;\n      if (!project?.id) return;\n\n      const confirmed = await confirm(\n        `Are you sure you want to delete \"${project.name}\"? This action cannot be undone.`,\n        {\n          title: 'Delete Project',\n          confirmText: 'Delete',\n          confirmClass: 'btn-danger',\n        }\n      );\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/projects/${project.id}`);\n          toast.success('Project deleted');\n          currentProps.onDelete?.(project.id);\n          closeOrInlineCancel();\n\n          if (appStore.getState().currentProjectId === project.id) {\n            appStore.setCurrentProject(null);\n          }\n          \n          loadProjects();\n        } catch {\n          toast.error('Failed to delete project');\n        }\n      }\n    });\n  }\n\n  // Invite member buttons\n  const inviteBtn = container.querySelector('#invite-member-btn');\n  const inviteFirstBtn = container.querySelector('#invite-first-btn');\n  [inviteBtn, inviteFirstBtn].forEach(btn => {\n    if (btn) {\n      on(btn as HTMLElement, 'click', () => {\n        showInviteModal();\n      });\n    }\n  });\n\n  // Add role button\n  const addRoleBtn = container.querySelector('#add-role-btn');\n  if (addRoleBtn) {\n    on(addRoleBtn as HTMLElement, 'click', () => {\n      showAddRoleDialog(container);\n    });\n  }\n\n  // Member role changes\n  container.querySelectorAll('.member-role-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const userId = select.getAttribute('data-user-id');\n      const newRole = (select as HTMLSelectElement).value;\n      const projectId = currentProject?.id || currentProps.project?.id;\n      \n      if (!userId || !projectId) return;\n\n      try {\n        await http.put(`/api/projects/${projectId}/members/${userId}`, { role: newRole });\n        toast.success('Member role updated');\n      } catch {\n        toast.error('Failed to update role');\n      }\n    });\n  });\n\n  // Remove member\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const userId = btn.getAttribute('data-user-id');\n      const projectId = currentProject?.id || currentProps.project?.id;\n      \n      if (!userId || !projectId) return;\n\n      const confirmed = await confirm('Remove this member from the project?', {\n        title: 'Remove Member',\n        confirmText: 'Remove',\n        confirmClass: 'btn-danger',\n      });\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/projects/${projectId}/members/${userId}`);\n          toast.success('Member removed');\n          \n          // Remove from list\n          projectMembers = projectMembers.filter(m => m.user_id !== userId);\n          const membersList = container.querySelector('#members-list');\n          if (membersList) {\n            membersList.innerHTML = renderMembersList();\n            bindMemberEvents(container);\n          }\n        } catch {\n          toast.error('Failed to remove member');\n        }\n      }\n    });\n  });\n\n  // Config form submit\n  const configForm = container.querySelector('#config-form') as HTMLFormElement;\n  if (configForm) {\n    on(configForm, 'submit', async (e) => {\n      e.preventDefault();\n      \n      const formData = new FormData(configForm);\n      const config = {\n        llm_config: {\n          openai_key: formData.get('openai_key') || undefined,\n          anthropic_key: formData.get('anthropic_key') || undefined,\n          google_key: formData.get('google_key') || undefined,\n          grok_key: formData.get('grok_key') || undefined,\n        },\n        ollama_config: {\n          url: formData.get('ollama_url') || undefined,\n          model: formData.get('ollama_model') || undefined,\n        },\n      };\n\n      const projectId = currentProject?.id || currentProps.project?.id;\n      if (!projectId) return;\n\n      try {\n        await http.put(`/api/projects/${projectId}/config`, config);\n        toast.success('Configuration saved');\n      } catch {\n        toast.error('Failed to save configuration');\n      }\n    });\n  }\n\n  // Bind member-specific events (edit role buttons)\n  bindMemberEvents(container);\n}\n\nfunction bindMemberEvents(container: HTMLElement): void {\n  // Edit user role buttons\n  container.querySelectorAll('.edit-user-role-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const userId = btn.getAttribute('data-user-id');\n      if (!userId) return;\n      \n      const member = projectMembers.find(m => m.user_id === userId);\n      if (member) {\n        showEditUserRoleDialog(container, member);\n      }\n    });\n  });\n\n  // Permissions buttons\n  container.querySelectorAll('.permissions-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const userId = btn.getAttribute('data-user-id');\n      if (!userId) return;\n      \n      const member = projectMembers.find(m => m.user_id === userId);\n      const projectId = currentProject?.id || currentProps.project?.id;\n      if (!member || !projectId) return;\n\n      showMemberPermissionsModal({\n        projectId,\n        userId: member.user_id,\n        userName: member.display_name || '',\n        userEmail: member.email || '',\n        avatarUrl: member.avatar_url,\n        currentRole: member.role,\n        currentPermissions: (member as { permissions?: string[] }).permissions,\n        onSave: async () => {\n          // Reload members after permissions update\n          try {\n            const response = await http.get<{ members: typeof projectMembers }>(`/api/projects/${projectId}/members`);\n            projectMembers = response.data.members || [];\n            const membersList = container.querySelector('#members-list');\n            if (membersList) {\n              membersList.innerHTML = renderMembersList();\n              bindMemberEvents(container);\n            }\n          } catch {\n            // Ignore\n          }\n        },\n      });\n    });\n  });\n\n  // Re-bind member role changes and remove buttons after list update\n  container.querySelectorAll('.member-role-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const userId = select.getAttribute('data-user-id');\n      const newRole = (select as HTMLSelectElement).value;\n      const projectId = currentProject?.id || currentProps.project?.id;\n      \n      if (!userId || !projectId) return;\n\n      try {\n        await http.put(`/api/projects/${projectId}/members/${userId}`, { role: newRole });\n        toast.success('Access level updated');\n      } catch {\n        toast.error('Failed to update access level');\n      }\n    });\n  });\n\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const userId = btn.getAttribute('data-user-id');\n      const projectId = currentProject?.id || currentProps.project?.id;\n      \n      if (!userId || !projectId) return;\n\n      const confirmed = await confirm('Remove this member from the project?', {\n        title: 'Remove Member',\n        confirmText: 'Remove',\n        confirmClass: 'btn-danger',\n      });\n\n      if (confirmed) {\n        try {\n          await http.delete(`/api/projects/${projectId}/members/${userId}`);\n          toast.success('Member removed');\n          \n          projectMembers = projectMembers.filter(m => m.user_id !== userId);\n          const membersList = container.querySelector('#members-list');\n          if (membersList) {\n            membersList.innerHTML = renderMembersList();\n            bindMemberEvents(container);\n          }\n        } catch {\n          toast.error('Failed to remove member');\n        }\n      }\n    });\n  });\n}\n\n/**\n * Show dialog to add a new role\n */\nfunction showAddRoleDialog(container: HTMLElement): void {\n  // Check if dialog already exists\n  const existingDialog = container.querySelector('.add-role-dialog');\n  if (existingDialog) existingDialog.remove();\n\n  const projectId = currentProject?.id || currentProps.project?.id;\n  if (!projectId) return;\n\n  // Create dialog\n  const dialog = createElement('div', { className: 'add-role-dialog' });\n  dialog.innerHTML = `\n    <style>\n      .add-role-dialog {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0,0,0,0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10001;\n        backdrop-filter: blur(4px);\n      }\n      \n      .add-role-card {\n        background: white;\n        border-radius: 20px;\n        width: 100%;\n        max-width: 500px;\n        box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .add-role-card {\n        background: #1e293b;\n      }\n      \n      .add-role-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 20px 24px;\n        color: white;\n      }\n      \n      .add-role-header h4 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 700;\n      }\n      \n      .add-role-body {\n        padding: 24px;\n      }\n      \n      .add-role-field {\n        margin-bottom: 20px;\n      }\n      \n      .add-role-field label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        color: #64748b;\n        margin-bottom: 8px;\n      }\n      \n      .add-role-field input,\n      .add-role-field textarea,\n      .add-role-field select {\n        width: 100%;\n        padding: 12px 16px;\n        border: 1px solid #e2e8f0;\n        border-radius: 10px;\n        font-size: 14px;\n        box-sizing: border-box;\n        background: #f8fafc;\n      }\n      \n      [data-theme=\"dark\"] .add-role-field input,\n      [data-theme=\"dark\"] .add-role-field textarea,\n      [data-theme=\"dark\"] .add-role-field select {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .add-role-field input:focus,\n      .add-role-field textarea:focus,\n      .add-role-field select:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\n      }\n      \n      .add-role-field textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .add-role-ai-btn {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        padding: 8px 14px;\n        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\n        color: white;\n        border: none;\n        border-radius: 8px;\n        font-size: 12px;\n        font-weight: 600;\n        cursor: pointer;\n        margin-top: 8px;\n        transition: all 0.2s;\n      }\n      \n      .add-role-ai-btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 12px rgba(139,92,246,0.3);\n      }\n      \n      .add-role-ai-btn:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n      }\n      \n      .add-role-actions {\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n        padding-top: 16px;\n        border-top: 1px solid #e2e8f0;\n      }\n      \n      [data-theme=\"dark\"] .add-role-actions {\n        border-color: rgba(255,255,255,0.1);\n      }\n    </style>\n    \n    <div class=\"add-role-card\">\n      <div class=\"add-role-header\">\n        <h4>Add New Role</h4>\n      </div>\n      <div class=\"add-role-body\">\n        <form id=\"add-role-form\">\n          <div class=\"add-role-field\">\n            <label>Role Name *</label>\n            <input type=\"text\" id=\"new-role-name\" required placeholder=\"e.g., Senior Developer, Tech Lead\">\n          </div>\n          \n          <div class=\"add-role-field\">\n            <label>Category</label>\n            <select id=\"new-role-category\">\n              <option value=\"project\"> Project</option>\n              <option value=\"technical\"> Technical</option>\n              <option value=\"management\"> Management</option>\n              <option value=\"stakeholder\"> Stakeholder</option>\n              <option value=\"custom\"> Custom</option>\n            </select>\n          </div>\n          \n          <div class=\"add-role-field\">\n            <label>Description</label>\n            <input type=\"text\" id=\"new-role-description\" placeholder=\"Brief description of this role\">\n          </div>\n          \n          <div class=\"add-role-field\">\n            <label>Role Context (for AI)</label>\n            <textarea id=\"new-role-context\" placeholder=\"Describe this role's responsibilities, priorities, and how the AI should adapt responses...\"></textarea>\n            <button type=\"button\" class=\"add-role-ai-btn\" id=\"enhance-role-btn\">\n               Enhance with AI\n            </button>\n          </div>\n          \n          <div class=\"add-role-actions\">\n            <button type=\"button\" class=\"btn-sota secondary\" id=\"cancel-add-role\">Cancel</button>\n            <button type=\"submit\" class=\"btn-sota primary\">Create Role</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  `;\n\n  container.appendChild(dialog);\n\n  // Bind events\n  const closeDialog = () => dialog.remove();\n\n  // Cancel button\n  const cancelBtn = dialog.querySelector('#cancel-add-role');\n  if (cancelBtn) {\n    on(cancelBtn as HTMLElement, 'click', closeDialog);\n  }\n\n  // Click outside to close\n  on(dialog, 'click', (e) => {\n    if (e.target === dialog) closeDialog();\n  });\n\n  // AI enhance button\n  const enhanceBtn = dialog.querySelector('#enhance-role-btn');\n  if (enhanceBtn) {\n    on(enhanceBtn as HTMLElement, 'click', async () => {\n      const nameInput = dialog.querySelector('#new-role-name') as HTMLInputElement;\n      const contextInput = dialog.querySelector('#new-role-context') as HTMLTextAreaElement;\n      const descInput = dialog.querySelector('#new-role-description') as HTMLInputElement;\n\n      const roleName = nameInput.value.trim();\n      if (!roleName) {\n        toast.error('Please enter a role name first');\n        return;\n      }\n\n      (enhanceBtn as HTMLButtonElement).disabled = true;\n      enhanceBtn.textContent = ' Enhancing...';\n\n      try {\n        const response = await http.post<{ prompt: string; description?: string }>('/api/roles/generate', {\n          title: roleName,\n          currentContext: contextInput.value,\n        });\n\n        if (response.data.prompt) {\n          contextInput.value = response.data.prompt;\n        }\n        if (response.data.description && !descInput.value) {\n          descInput.value = response.data.description;\n        }\n        toast.success('Role context enhanced');\n      } catch {\n        toast.error('Failed to enhance with AI');\n      } finally {\n        (enhanceBtn as HTMLButtonElement).disabled = false;\n        enhanceBtn.textContent = ' Enhance with AI';\n      }\n    });\n  }\n\n  // Form submit\n  const form = dialog.querySelector('#add-role-form') as HTMLFormElement;\n  if (form) {\n    on(form, 'submit', async (e) => {\n      e.preventDefault();\n\n      const name = (dialog.querySelector('#new-role-name') as HTMLInputElement).value.trim();\n      const category = (dialog.querySelector('#new-role-category') as HTMLSelectElement).value;\n      const description = (dialog.querySelector('#new-role-description') as HTMLInputElement).value.trim();\n      const roleContext = (dialog.querySelector('#new-role-context') as HTMLTextAreaElement).value.trim();\n\n      if (!name) {\n        toast.error('Role name is required');\n        return;\n      }\n\n      try {\n        await http.post('/api/role-templates', {\n          name: name.toLowerCase().replace(/\\s+/g, '_'),\n          display_name: name,\n          description,\n          role_context: roleContext,\n          category,\n          color: '#e11d48',\n          is_template: true,\n        });\n\n        toast.success('Role created');\n        closeDialog();\n\n        // Reload roles\n        await loadProjectRoles(projectId);\n        const rolesGrid = container.querySelector('#roles-grid');\n        if (rolesGrid) {\n          rolesGrid.innerHTML = renderRolesList();\n        }\n      } catch {\n        toast.error('Failed to create role');\n      }\n    });\n  }\n\n  // Focus on name input\n  setTimeout(() => {\n    const nameInput = dialog.querySelector('#new-role-name') as HTMLInputElement;\n    if (nameInput) nameInput.focus();\n  }, 100);\n}\n\n/**\n * Show inline edit dialog for user role\n */\nfunction showEditUserRoleDialog(container: HTMLElement, member: ProjectMember): void {\n  // Check if dialog already exists\n  const existingDialog = container.querySelector('.user-role-edit-dialog');\n  if (existingDialog) existingDialog.remove();\n\n  const projectId = currentProject?.id || currentProps.project?.id;\n  if (!projectId) return;\n\n  // Create inline edit dialog\n  const dialog = createElement('div', { className: 'user-role-edit-dialog' });\n  dialog.innerHTML = `\n    <style>\n      .user-role-edit-dialog {\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: white;\n        border-radius: 16px;\n        box-shadow: 0 25px 50px rgba(0,0,0,0.25);\n        padding: 24px;\n        z-index: 10001;\n        width: 400px;\n        max-width: 90vw;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog {\n        background: #1e293b;\n      }\n      \n      .user-role-edit-dialog h3 {\n        margin: 0 0 20px 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: #1e293b;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog h3 {\n        color: #f1f5f9;\n      }\n      \n      .user-role-edit-dialog h3 svg {\n        width: 20px;\n        height: 20px;\n        color: #e11d48;\n      }\n      \n      .user-role-edit-dialog .form-field {\n        margin-bottom: 16px;\n      }\n      \n      .user-role-edit-dialog .form-field label {\n        display: block;\n        font-size: 13px;\n        font-weight: 600;\n        color: #475569;\n        margin-bottom: 6px;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field label {\n        color: #94a3b8;\n      }\n      \n      .user-role-edit-dialog .form-field input,\n      .user-role-edit-dialog .form-field textarea,\n      .user-role-edit-dialog .form-field select {\n        width: 100%;\n        padding: 10px 14px;\n        border: 1px solid #e2e8f0;\n        border-radius: 10px;\n        font-size: 14px;\n        background: #f8fafc;\n        color: #1e293b;\n        box-sizing: border-box;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field input,\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field textarea,\n      [data-theme=\"dark\"] .user-role-edit-dialog .form-field select {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .user-role-edit-dialog .form-field input:focus,\n      .user-role-edit-dialog .form-field textarea:focus,\n      .user-role-edit-dialog .form-field select:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .user-role-edit-dialog .form-field textarea {\n        resize: vertical;\n        min-height: 80px;\n      }\n      \n      .user-role-edit-dialog .form-hint {\n        font-size: 12px;\n        color: #94a3b8;\n        margin-top: 4px;\n      }\n      \n      .user-role-edit-dialog .linked-contact-info {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        padding: 10px 14px;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n        border: 1px solid rgba(225,29,72,0.2);\n        border-radius: 10px;\n        margin-top: 8px;\n      }\n      \n      .user-role-edit-dialog .linked-contact-info svg {\n        width: 16px;\n        height: 16px;\n        color: #e11d48;\n        flex-shrink: 0;\n      }\n      \n      .user-role-edit-dialog .linked-contact-info span {\n        font-size: 13px;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .user-role-edit-dialog .linked-contact-info span {\n        color: #f1f5f9;\n      }\n      \n      .user-role-edit-dialog .dialog-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n        margin-top: 20px;\n      }\n      \n      .user-role-edit-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,0.4);\n        z-index: 10000;\n      }\n    </style>\n    \n    <h3>\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n      </svg>\n      Edit Project Role\n    </h3>\n    <p class=\"section-intro-last\">\n      Define <strong>${escapeHtml(member.display_name || member.email || 'this member')}</strong>'s role in the project\n    </p>\n    \n    <div class=\"form-field\">\n      <label>Role Title</label>\n      <select id=\"edit-user-role\">\n        <option value=\"\">-- Select a role --</option>\n        ${projectRoles.filter(r => r.is_active).map(r => `\n          <option value=\"${escapeHtml(r.display_name || r.name)}\" \n                  data-prompt=\"${escapeHtml(r.prompt_template || '')}\"\n                  ${member.user_role === r.display_name || member.user_role === r.name ? 'selected' : ''}>\n            ${escapeHtml(r.display_name || r.name)}\n          </option>\n        `).join('')}\n        <option value=\"__custom__\" ${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? 'selected' : ''}>Custom role...</option>\n      </select>\n      <div class=\"form-hint\">Select a predefined role or choose \"Custom role\" for a custom title</div>\n      <input type=\"text\" id=\"edit-user-role-custom\" \n             value=\"${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? escapeHtml(member.user_role) : ''}\" \n             placeholder=\"Enter custom role title\"\n             class=\"gm-mt-2 ${member.user_role && !projectRoles.some(r => r.display_name === member.user_role || r.name === member.user_role) ? '' : 'hidden'}\">\n    </div>\n    \n    <div class=\"form-field\">\n      <label>Role Description</label>\n      <textarea id=\"edit-user-role-prompt\" placeholder=\"e.g., I manage the technical architecture and lead the development team\">${escapeHtml(member.user_role_prompt || '')}</textarea>\n      <div class=\"form-hint\">Brief description of responsibilities (used for AI context)</div>\n    </div>\n    \n    <div class=\"form-field\">\n      <label>\n        <svg class=\"gm-inline-icon\" width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n        </svg>\n        Link to Contact\n      </label>\n      <select id=\"edit-linked-contact\">\n        <option value=\"\">-- No linked contact --</option>\n        ${projectContacts.map(c => `\n          <option value=\"${c.id}\" ${member.linked_contact_id === c.id ? 'selected' : ''}>\n            ${escapeHtml(c.name)}${c.organization ? ` (${escapeHtml(c.organization)})` : ''}${c.email ? ` - ${escapeHtml(c.email)}` : ''}\n          </option>\n        `).join('')}\n      </select>\n      <div class=\"form-hint\">Associate this team member with a project contact</div>\n      ${member.linked_contact ? `\n        <div class=\"linked-contact-info\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\n          </svg>\n          <span>Currently linked to: <strong>${escapeHtml(member.linked_contact.name)}</strong></span>\n        </div>\n      ` : ''}\n    </div>\n    \n    <div class=\"dialog-actions\">\n      <button class=\"btn-sota secondary\" id=\"cancel-role-edit\">Cancel</button>\n      <button class=\"btn-sota primary\" id=\"save-role-edit\">\n        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n        </svg>\n        Save Role\n      </button>\n    </div>\n  `;\n\n  // Create overlay\n  const overlay = createElement('div', { className: 'user-role-edit-overlay' });\n  \n  document.body.appendChild(overlay);\n  document.body.appendChild(dialog);\n\n  // Focus first input\n  const roleSelect = dialog.querySelector('#edit-user-role') as HTMLSelectElement;\n  const customInput = dialog.querySelector('#edit-user-role-custom') as HTMLInputElement;\n  const promptTextarea = dialog.querySelector('#edit-user-role-prompt') as HTMLTextAreaElement;\n  setTimeout(() => roleSelect?.focus(), 100);\n\n  // Handle role selection change\n  on(roleSelect, 'change', () => {\n    const selectedOption = roleSelect.options[roleSelect.selectedIndex];\n    const isCustom = roleSelect.value === '__custom__';\n    \n    // Show/hide custom input\n    customInput.classList.toggle('hidden', !isCustom);\n    if (isCustom) {\n      customInput.focus();\n    }\n    \n    // Auto-fill prompt from role template (always when selecting a predefined role)\n    if (!isCustom && selectedOption.dataset.prompt) {\n      promptTextarea.value = selectedOption.dataset.prompt;\n    }\n  });\n\n  // Cancel button\n  const cancelBtn = dialog.querySelector('#cancel-role-edit');\n  const closeDialog = () => {\n    overlay.remove();\n    dialog.remove();\n  };\n\n  on(cancelBtn as HTMLElement, 'click', closeDialog);\n  on(overlay, 'click', closeDialog);\n\n  // Save button\n  const saveBtn = dialog.querySelector('#save-role-edit');\n  on(saveBtn as HTMLElement, 'click', async () => {\n    const roleSelectValue = roleSelect.value;\n    const userRole = roleSelectValue === '__custom__' ? customInput.value.trim() : roleSelectValue;\n    const userRolePrompt = (dialog.querySelector('#edit-user-role-prompt') as HTMLTextAreaElement).value.trim();\n    const linkedContactId = (dialog.querySelector('#edit-linked-contact') as HTMLSelectElement).value || null;\n\n    try {\n      await http.put(`/api/projects/${projectId}/members/${member.user_id}`, {\n        user_role: userRole,\n        user_role_prompt: userRolePrompt,\n        linked_contact_id: linkedContactId,\n      });\n\n      // Update local state\n      const memberIndex = projectMembers.findIndex(m => m.user_id === member.user_id);\n      if (memberIndex !== -1) {\n        projectMembers[memberIndex].user_role = userRole;\n        projectMembers[memberIndex].user_role_prompt = userRolePrompt;\n        projectMembers[memberIndex].linked_contact_id = linkedContactId || undefined;\n        // Find linked contact info\n        if (linkedContactId) {\n          const contact = projectContacts.find(c => c.id === linkedContactId);\n          if (contact) {\n            projectMembers[memberIndex].linked_contact = {\n              id: contact.id,\n              name: contact.name,\n              email: contact.email,\n              organization: contact.organization,\n              role: contact.role,\n            };\n          }\n        } else {\n          projectMembers[memberIndex].linked_contact = undefined;\n        }\n      }\n\n      // Refresh list\n      const membersList = container.querySelector('#members-list');\n      if (membersList) {\n        membersList.innerHTML = renderMembersList();\n        bindMemberEvents(container);\n      }\n\n      toast.success('Project role updated');\n      closeDialog();\n    } catch {\n      toast.error('Failed to update role');\n    }\n  });\n\n  // Close on Escape\n  const handleEscape = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      closeDialog();\n      document.removeEventListener('keydown', handleEscape);\n    }\n  };\n  document.addEventListener('keydown', handleEscape);\n}\n\n// ==================== Helper Functions ====================\n\nasync function showInviteModal(): Promise<void> {\n  const { showInviteModal: showInvite } = await import('./InviteModal');\n  const projectId = currentProject?.id || currentProps.project?.id;\n  if (projectId) {\n    showInvite({\n      projectId,\n      onInvite: async () => {\n        // Refresh members list\n        try {\n          const res = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\n          projectMembers = res.data.members || [];\n          const membersList = document.querySelector('#members-list');\n          if (membersList) {\n            membersList.innerHTML = renderMembersList();\n            bindMemberEvents(membersList.closest('.project-card') as HTMLElement);\n          }\n        } catch {\n          // Ignore\n        }\n      },\n    });\n  }\n}\n\nasync function loadProjects(): Promise<void> {\n  try {\n    const response = await http.get<Array<{ id: string; name: string }>>('/api/projects');\n    dataStore.setProjects(response.data);\n  } catch {\n    // Silent fail\n  }\n}\n\nasync function loadProjectRoles(projectId: string): Promise<void> {\n  try {\n    const response = await http.get<{ roles: RoleTemplate[] }>('/api/role-templates');\n    projectRoles = response.data.roles || [];\n  } catch {\n    projectRoles = [];\n  }\n}\n\nfunction getInitials(name: string): string {\n  return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport function closeProjectModal(): void {\n  closeModal(MODAL_ID);\n}\n\nexport default showProjectModal;\n","/**\r\n * Project Selector Component\r\n * Dropdown for selecting and managing projects\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { appStore } from '../stores/app';\r\nimport { dataStore } from '../stores/data';\r\nimport { projects } from '../services/projects';\r\nimport { toast } from '../services/toast';\r\nimport { showProjectModal } from './modals/ProjectModal';\r\n\r\nexport interface ProjectSelectorOptions {\r\n  containerId?: string;\r\n  onProjectChange?: (projectId: string) => void;\r\n}\r\n\r\n/**\r\n * Initialize project selector\r\n */\r\nexport function initProjectSelector(options: ProjectSelectorOptions = {}): void {\r\n  const container = options.containerId \r\n    ? document.getElementById(options.containerId)\r\n    : document.getElementById('project-selector-container');\r\n\r\n  if (!container) return;\r\n\r\n  // Create selector HTML\r\n  container.innerHTML = `\r\n    <div class=\"project-selector-wrapper\">\r\n      <select id=\"project-selector\" class=\"project-selector\">\r\n        <option value=\"\">Select Project...</option>\r\n      </select>\r\n      <button id=\"new-project-btn\" class=\"btn-icon\" title=\"Create new project\">+</button>\r\n      <button id=\"edit-project-btn\" class=\"btn-icon hidden\" title=\"Edit project\"></button>\r\n    </div>\r\n  `;\r\n\r\n  const selector = container.querySelector('#project-selector') as HTMLSelectElement;\r\n  const newBtn = container.querySelector('#new-project-btn') as HTMLButtonElement;\r\n  const editBtn = container.querySelector('#edit-project-btn') as HTMLButtonElement;\r\n\r\n  // Load and populate projects\r\n  loadProjectsIntoSelector(selector);\r\n\r\n  // Handle selection change\r\n  on(selector, 'change', async () => {\r\n    const projectId = selector.value;\r\n    if (projectId) {\r\n      await selectProject(projectId, options.onProjectChange);\r\n      editBtn.classList.remove('hidden');\r\n    } else {\r\n      editBtn.classList.add('hidden');\r\n    }\r\n  });\r\n\r\n  // New project button\r\n  on(newBtn, 'click', () => {\r\n    showProjectModal({\r\n      mode: 'create',\r\n      onSave: async (project) => {\r\n        await loadProjectsIntoSelector(selector);\r\n        if (project.id) {\r\n          selector.value = project.id;\r\n          editBtn.classList.remove('hidden');\r\n          options.onProjectChange?.(project.id);\r\n        }\r\n      },\r\n    });\r\n  });\r\n\r\n  // Edit project button\r\n  on(editBtn, 'click', () => {\r\n    const currentProject = appStore.getState().currentProject;\r\n    if (currentProject) {\r\n      showProjectModal({\r\n        mode: 'edit',\r\n        project: currentProject,\r\n        onSave: async () => {\r\n          await loadProjectsIntoSelector(selector);\r\n        },\r\n        onDelete: async () => {\r\n          await loadProjectsIntoSelector(selector);\r\n          editBtn.classList.add('hidden');\r\n        },\r\n      });\r\n    }\r\n  });\r\n\r\n  // Subscribe to store changes\r\n  dataStore.subscribe((state) => {\r\n    updateSelectorOptions(selector, state.projects);\r\n  });\r\n\r\n  appStore.subscribe((state) => {\r\n    if (state.currentProjectId && selector.value !== state.currentProjectId) {\r\n      selector.value = state.currentProjectId;\r\n      editBtn.classList.remove('hidden');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Load projects into selector\r\n */\r\nasync function loadProjectsIntoSelector(selector: HTMLSelectElement): Promise<void> {\r\n  const projectList = await projects.getAll();\r\n  updateSelectorOptions(selector, projectList);\r\n\r\n  // Set current project if any\r\n  const currentProjectId = appStore.getState().currentProjectId;\r\n  if (currentProjectId) {\r\n    selector.value = currentProjectId;\r\n  }\r\n}\r\n\r\n/**\r\n * Update selector options\r\n */\r\nfunction updateSelectorOptions(\r\n  selector: HTMLSelectElement, \r\n  projectList: Array<{ id: string; name: string; isDefault?: boolean }>\r\n): void {\r\n  const currentValue = selector.value;\r\n  \r\n  selector.innerHTML = '<option value=\"\">Select Project...</option>';\r\n  \r\n  projectList.forEach(project => {\r\n    const option = document.createElement('option');\r\n    option.value = project.id;\r\n    option.textContent = project.name + (project.isDefault ? ' (default)' : '');\r\n    selector.appendChild(option);\r\n  });\r\n\r\n  // Restore selection if possible\r\n  if (currentValue && projectList.some(p => p.id === currentValue)) {\r\n    selector.value = currentValue;\r\n  }\r\n}\r\n\r\n/**\r\n * Select a project\r\n */\r\nasync function selectProject(\r\n  projectId: string, \r\n  onChange?: (projectId: string) => void\r\n): Promise<void> {\r\n  try {\r\n    const project = await projects.activate(projectId);\r\n    if (project) {\r\n      toast.success(`Switched to: ${project.name}`);\r\n      onChange?.(projectId);\r\n    }\r\n  } catch {\r\n    toast.error('Failed to switch project');\r\n  }\r\n}\r\n\r\n/**\r\n * Create standalone project selector element\r\n */\r\nexport function createProjectSelector(options: ProjectSelectorOptions = {}): HTMLElement {\r\n  const wrapper = createElement('div', { className: 'project-selector-wrapper' });\r\n  \r\n  const selector = createElement('select', { \r\n    className: 'project-selector',\r\n    id: 'project-selector',\r\n  }) as HTMLSelectElement;\r\n  \r\n  const defaultOption = createElement('option', { \r\n    textContent: 'Select Project...',\r\n  }) as HTMLOptionElement;\r\n  defaultOption.value = '';\r\n  selector.appendChild(defaultOption);\r\n\r\n  const newBtn = createElement('button', {\r\n    className: 'btn-icon',\r\n    textContent: '+',\r\n    title: 'Create new project',\r\n  });\r\n\r\n  wrapper.appendChild(selector);\r\n  wrapper.appendChild(newBtn);\r\n\r\n  // Load projects\r\n  projects.getAll().then(projectList => {\r\n    updateSelectorOptions(selector, projectList);\r\n    const currentProjectId = appStore.getState().currentProjectId;\r\n    if (currentProjectId) {\r\n      selector.value = currentProjectId;\r\n    }\r\n  });\r\n\r\n  // Bind events\r\n  on(selector, 'change', async () => {\r\n    const projectId = selector.value;\r\n    if (projectId) {\r\n      await selectProject(projectId, options.onProjectChange);\r\n    }\r\n  });\r\n\r\n  on(newBtn, 'click', () => {\r\n    showProjectModal({\r\n      mode: 'create',\r\n      onSave: async (project) => {\r\n        const projectList = await projects.getAll();\r\n        updateSelectorOptions(selector, projectList);\r\n        if (project.id) {\r\n          selector.value = project.id;\r\n          options.onProjectChange?.(project.id);\r\n        }\r\n      },\r\n    });\r\n  });\r\n\r\n  return wrapper;\r\n}\r\n\r\nexport default initProjectSelector;\r\n","/**\r\n * Format Utilities\r\n * Helper functions for formatting values\r\n */\r\n\r\n/**\r\n * Format number with thousand separators\r\n */\r\nexport function formatNumber(value: number, locale = 'en-US'): string {\r\n  return new Intl.NumberFormat(locale).format(value);\r\n}\r\n\r\n/**\r\n * Format date to locale string\r\n */\r\nexport function formatDate(date: string | Date, options?: Intl.DateTimeFormatOptions): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  return d.toLocaleDateString(undefined, options);\r\n}\r\n\r\n/**\r\n * Format date and time\r\n */\r\nexport function formatDateTime(date: string | Date): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  return d.toLocaleString();\r\n}\r\n\r\n/**\r\n * Format relative time (e.g., \"2 hours ago\", \"yesterday\", \"this week\")\r\n * \r\n * Returns human-friendly labels:\r\n * - \"just now\" for < 1 minute\r\n * - \"X minutes ago\" for < 1 hour\r\n * - \"X hours ago\" for same day\r\n * - \"yesterday\" for previous day\r\n * - \"X days ago\" for < 7 days\r\n * - \"this week\" for same week\r\n * - \"last week\" for previous week\r\n * - Full date for older\r\n */\r\nexport function formatRelativeTime(date: string | Date): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - d.getTime();\r\n  const diffSec = Math.floor(diffMs / 1000);\r\n  const diffMin = Math.floor(diffSec / 60);\r\n  const diffHour = Math.floor(diffMin / 60);\r\n  const diffDay = Math.floor(diffHour / 24);\r\n\r\n  // Future dates\r\n  if (diffMs < 0) {\r\n    const futureDays = Math.ceil(Math.abs(diffMs) / (1000 * 60 * 60 * 24));\r\n    if (futureDays === 0) return 'today';\r\n    if (futureDays === 1) return 'tomorrow';\r\n    if (futureDays < 7) return `in ${futureDays} days`;\r\n    return formatDate(d, { month: 'short', day: 'numeric' });\r\n  }\r\n\r\n  // Past dates\r\n  if (diffSec < 60) return 'just now';\r\n  if (diffMin < 60) return `${diffMin} min${diffMin === 1 ? '' : 's'} ago`;\r\n  if (diffHour < 24) return `${diffHour} hour${diffHour === 1 ? '' : 's'} ago`;\r\n\r\n  // Check if yesterday\r\n  const yesterday = new Date(now);\r\n  yesterday.setDate(yesterday.getDate() - 1);\r\n  if (isSameDay(d, yesterday)) return 'yesterday';\r\n\r\n  // Check if this week (same calendar week)\r\n  const startOfWeek = getStartOfWeek(now);\r\n  if (d >= startOfWeek) return 'this week';\r\n\r\n  // Check if last week\r\n  const startOfLastWeek = new Date(startOfWeek);\r\n  startOfLastWeek.setDate(startOfLastWeek.getDate() - 7);\r\n  if (d >= startOfLastWeek) return 'last week';\r\n\r\n  // Within 30 days\r\n  if (diffDay < 30) return `${diffDay} days ago`;\r\n\r\n  // Within this year\r\n  if (d.getFullYear() === now.getFullYear()) {\r\n    return formatDate(d, { month: 'short', day: 'numeric' });\r\n  }\r\n  \r\n  // Older\r\n  return formatDate(d, { year: 'numeric', month: 'short', day: 'numeric' });\r\n}\r\n\r\n/**\r\n * Check if two dates are the same calendar day\r\n */\r\nfunction isSameDay(d1: Date, d2: Date): boolean {\r\n  return d1.getFullYear() === d2.getFullYear() &&\r\n         d1.getMonth() === d2.getMonth() &&\r\n         d1.getDate() === d2.getDate();\r\n}\r\n\r\n/**\r\n * Get start of week (Sunday)\r\n */\r\nfunction getStartOfWeek(date: Date): Date {\r\n  const d = new Date(date);\r\n  const day = d.getDay();\r\n  d.setDate(d.getDate() - day);\r\n  d.setHours(0, 0, 0, 0);\r\n  return d;\r\n}\r\n\r\n/**\r\n * Format file size\r\n */\r\nexport function formatFileSize(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  \r\n  const units = ['B', 'KB', 'MB', 'GB', 'TB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\r\n  const size = bytes / Math.pow(1024, i);\r\n  \r\n  return `${size.toFixed(i > 0 ? 1 : 0)} ${units[i]}`;\r\n}\r\n\r\n/**\r\n * Format percentage\r\n */\r\nexport function formatPercent(value: number, decimals = 0): string {\r\n  return `${(value * 100).toFixed(decimals)}%`;\r\n}\r\n\r\n/**\r\n * Format currency\r\n */\r\nexport function formatCurrency(value: number, currency = 'USD', locale = 'en-US'): string {\r\n  return new Intl.NumberFormat(locale, {\r\n    style: 'currency',\r\n    currency,\r\n  }).format(value);\r\n}\r\n\r\n/**\r\n * Truncate text with ellipsis\r\n */\r\nexport function truncate(text: string, maxLength: number, suffix = '...'): string {\r\n  if (text.length <= maxLength) return text;\r\n  return text.slice(0, maxLength - suffix.length) + suffix;\r\n}\r\n\r\n/**\r\n * Capitalize first letter\r\n */\r\nexport function capitalize(text: string): string {\r\n  return text.charAt(0).toUpperCase() + text.slice(1);\r\n}\r\n\r\n/**\r\n * Convert to title case\r\n */\r\nexport function titleCase(text: string): string {\r\n  return text\r\n    .toLowerCase()\r\n    .split(' ')\r\n    .map(word => capitalize(word))\r\n    .join(' ');\r\n}\r\n\r\n/**\r\n * Convert to kebab-case\r\n */\r\nexport function kebabCase(text: string): string {\r\n  return text\r\n    .replace(/([a-z])([A-Z])/g, '$1-$2')\r\n    .replace(/[\\s_]+/g, '-')\r\n    .toLowerCase();\r\n}\r\n\r\n/**\r\n * Convert to camelCase\r\n */\r\nexport function camelCase(text: string): string {\r\n  return text\r\n    .replace(/[-_\\s]+(.)?/g, (_, c) => c ? c.toUpperCase() : '')\r\n    .replace(/^[A-Z]/, c => c.toLowerCase());\r\n}\r\n\r\n/**\r\n * Pluralize word based on count\r\n */\r\nexport function pluralize(count: number, singular: string, plural?: string): string {\r\n  return count === 1 ? singular : (plural || singular + 's');\r\n}\r\n\r\n/**\r\n * Format duration in seconds to human readable\r\n */\r\nexport function formatDuration(seconds: number): string {\r\n  if (seconds < 60) return `${seconds}s`;\r\n  if (seconds < 3600) {\r\n    const min = Math.floor(seconds / 60);\r\n    const sec = seconds % 60;\r\n    return sec > 0 ? `${min}m ${sec}s` : `${min}m`;\r\n  }\r\n  \r\n  const hours = Math.floor(seconds / 3600);\r\n  const min = Math.floor((seconds % 3600) / 60);\r\n  return min > 0 ? `${hours}h ${min}m` : `${hours}h`;\r\n}\r\n","/**\n * Dashboard Component\n * Main dashboard view with stats, health, trends, insights, and alerts\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { dataStore } from '../stores/data';\nimport { appStore } from '../stores/app';\nimport { formatNumber, formatPercent, formatRelativeTime } from '../utils/format';\nimport { dashboardService, DashboardData, HealthData, Insight, Alert, TrendMetric } from '../services/dashboard';\nimport { http } from '../services/api';\nimport { risksService } from '../services/risks';\n\nexport interface DashboardStats {\n  totalQuestions: number;\n  answeredQuestions: number;\n  totalRisks: number;\n  highPriorityRisks: number;\n  totalActions: number;\n  completedActions: number;\n  totalDecisions: number;\n  totalContacts: number;\n  healthScore: number;\n}\n\nexport interface DashboardProps {\n  onStatClick?: (statId: string) => void;\n  onAlertClick?: (alert: Alert) => void;\n  onInsightAction?: (insight: Insight) => void;\n}\n\n/**\n * Create dashboard element\n */\nexport function createDashboard(props: DashboardProps = {}): HTMLElement {\n  const dashboard = createElement('div', { className: 'dashboard' });\n\n  // Layout: Stats  Insights  Briefing  Bottom Row (Health + Charts)\n  dashboard.innerHTML = `\n    <!-- Row 1: Stats Cards -->\n    <div class=\"dashboard-row\">\n      <div id=\"dashboard-stats-grid\" class=\"stats-grid\"></div>\n    </div>\n\n    <!-- Row 2: Insights (horizontal) -->\n    <div id=\"dashboard-insights\" class=\"dashboard-insights-row\"></div>\n\n    <!-- Row 3: Alerts if any -->\n    <div id=\"dashboard-overdue\" class=\"dashboard-overdue-section\"></div>\n    <div id=\"dashboard-alerts\" class=\"dashboard-alerts-section\"></div>\n\n    <!-- Row 4: Daily Briefing (full width) -->\n    <div class=\"dashboard-briefing-section\" id=\"dashboard-briefing\"></div>\n\n    <!-- Row 5: Golden Hours (includes Team info) -->\n    <div id=\"dashboard-golden-hours\" class=\"dashboard-golden-hours-section\"></div>\n\n    <!-- Row 6: Charts (Questions priority, Facts by category, Trends) -->\n    <div class=\"dashboard-charts-row\">\n      <div id=\"questions-chart\" class=\"chart-container\"></div>\n      <div id=\"facts-chart\" class=\"chart-container\"></div>\n      <div id=\"trends-chart\" class=\"chart-container\"></div>\n    </div>\n\n    <!-- Row 7: Bottom - Health + Risk Summary -->\n    <div class=\"dashboard-bottom-row\">\n      <div id=\"dashboard-health\" class=\"dashboard-health-card\"></div>\n      <div id=\"risk-summary-container\" class=\"dashboard-risk-summary-card\"></div>\n    </div>\n  `;\n\n  // Load dashboard data\n  loadFullDashboard(dashboard, props);\n\n  return dashboard;\n}\n\n/**\n * Load full dashboard data from API\n */\nasync function loadFullDashboard(dashboard: HTMLElement, props: DashboardProps): Promise<void> {\n  const healthSection = dashboard.querySelector('#dashboard-health');\n  const briefingSection = dashboard.querySelector('#dashboard-briefing');\n  const statsGrid = dashboard.querySelector('#dashboard-stats-grid');\n  const overdueSection = dashboard.querySelector('#dashboard-overdue');\n  const alertsSection = dashboard.querySelector('#dashboard-alerts');\n  const insightsSection = dashboard.querySelector('#dashboard-insights');\n  const riskSummaryContainer = dashboard.querySelector('#risk-summary-container');\n  const goldenHoursSection = dashboard.querySelector('#dashboard-golden-hours');\n\n  // Check if project is selected\n  const currentProject = appStore.getState().currentProject;\n  const currentProjectId = appStore.getState().currentProjectId;\n  \n  if (!currentProject && !currentProjectId) {\n    // No project selected - show empty state\n    if (statsGrid) {\n      statsGrid.innerHTML = `\n        <div class=\"no-project-state\">\n          <svg class=\"no-project-icon\" width=\"80\" height=\"80\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n          </svg>\n          <h2 class=\"no-project-title\">No Project Selected</h2>\n          <p class=\"no-project-desc\">\n            Select a project from the dropdown in the header to view your dashboard, or create a new project to get started.\n          </p>\n          <div class=\"no-project-actions\">\n            <button class=\"btn btn-primary create-project-btn no-project-btn\">\n              <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n              </svg>\n              Create New Project\n            </button>\n          </div>\n        </div>\n      `;\n      \n      // Bind create project button\n      const createBtn = statsGrid.querySelector('.create-project-btn');\n      if (createBtn) {\n        createBtn.addEventListener('click', async () => {\n          const { showProjectModal } = await import('./modals/ProjectModal');\n          showProjectModal({\n            mode: 'create',\n            onSave: () => {\n              // Trigger refresh\n              window.dispatchEvent(new CustomEvent('godmode:project-created'));\n            }\n          });\n        });\n      }\n    }\n    \n    // Hide other sections\n    if (healthSection) (healthSection as HTMLElement).innerHTML = '';\n    if (briefingSection) (briefingSection as HTMLElement).innerHTML = '';\n    if (overdueSection) (overdueSection as HTMLElement).innerHTML = '';\n    if (alertsSection) (alertsSection as HTMLElement).innerHTML = '';\n    if (insightsSection) (insightsSection as HTMLElement).innerHTML = '';\n    if (riskSummaryContainer) (riskSummaryContainer as HTMLElement).innerHTML = '';\n    if (goldenHoursSection) (goldenHoursSection as HTMLElement).innerHTML = '';\n    \n    return;\n  }\n\n  // Show loading state\n  if (statsGrid) {\n    statsGrid.innerHTML = '<div class=\"loading-placeholder\">Loading dashboard...</div>';\n  }\n\n  // Load Briefing Panel (async)\n  if (briefingSection && !briefingSection.hasChildNodes()) {\n    import('./BriefingPanel').then(({ createBriefingPanel }) => {\n      const briefingPanel = createBriefingPanel();\n      briefingSection.appendChild(briefingPanel);\n    }).catch(err => console.error('Failed to load BriefingPanel:', err));\n  }\n\n  try {\n    const { dashboard: data, health, insights, alerts } = await dashboardService.loadAll();\n\n    // Render health indicator\n    if (healthSection && health) {\n      renderHealthIndicator(healthSection as HTMLElement, health);\n    }\n\n    // Render stats\n    if (statsGrid && data) {\n      renderStatsGrid(statsGrid as HTMLElement, data, props.onStatClick);\n    }\n\n    // Render overdue actions alert\n    if (overdueSection && data && data.overdueActions > 0) {\n      renderOverdueActionsAlert(overdueSection as HTMLElement, data.overdueActions);\n    }\n\n    // Render alerts\n    if (alertsSection && alerts.length > 0) {\n      renderAlerts(alertsSection as HTMLElement, alerts, props.onAlertClick);\n    }\n\n    // Render insights\n    if (insightsSection && insights.length > 0) {\n      renderInsights(insightsSection as HTMLElement, insights, props.onInsightAction);\n    }\n\n    // Render charts\n    if (data) {\n      renderQuestionsPriorityChart(data);\n      renderFactsChart(data);\n      // Load trends asynchronously (don't block)\n      renderWeeklyTrendsChart(data).catch(err => \n        console.error('Failed to render trends chart:', err)\n      );\n    }\n\n    // Load Risk Summary with risks data (donut, bars, and 2D matrix)\n    if (riskSummaryContainer && !riskSummaryContainer.hasChildNodes()) {\n      risksService.getAll().then(risks => {\n        renderRiskSummary(riskSummaryContainer as HTMLElement, risks);\n      }).catch(err => console.error('Failed to load Risk Summary:', err));\n    }\n\n    // Load Golden Hours section (includes Team info)\n    if (goldenHoursSection && !goldenHoursSection.hasChildNodes()) {\n      const projectId = currentProjectId || currentProject?.id;\n      if (projectId) {\n        loadGoldenHours(goldenHoursSection as HTMLElement, projectId);\n      }\n    }\n  } catch (error) {\n    console.error('Failed to load dashboard:', error);\n    if (statsGrid) {\n      statsGrid.innerHTML = '<div class=\"error-message\">Failed to load dashboard data</div>';\n    }\n  }\n}\n\n/**\n * Render health indicator\n */\nfunction renderHealthIndicator(container: HTMLElement, health: HealthData): void {\n  // Handle missing or incomplete health data\n  if (!health || typeof health.status !== 'string') {\n    container.innerHTML = `\n      <div class=\"health-indicator unknown\">\n        <div class=\"health-gauge\">\n          <span class=\"score-value\">--</span>\n          <span class=\"score-label\">Health</span>\n        </div>\n        <p class=\"health-status\">Health data unavailable</p>\n      </div>\n    `;\n    return;\n  }\n\n  const statusClass = health.status.toLowerCase().replace(/\\s+/g, '-');\n  const score = health.score ?? 0;\n  const color = health.color || '#888';\n  const factors = health.factors || [];\n  \n  container.innerHTML = `\n    <div class=\"health-indicator ${statusClass}\">\n      <div class=\"health-gauge\">\n        <div class=\"health-score\" style=\"--score: ${score}%\">\n          <span class=\"score-value\">${score}</span>\n          <span class=\"score-label\">Health</span>\n        </div>\n        <div class=\"health-bar\">\n          <div class=\"health-fill\" style=\"--fill-width: ${score}%; --fill-color: ${color}\"></div>\n        </div>\n      </div>\n      <div class=\"health-status\">\n        <span class=\"status-text\" style=\"--status-color: ${color}\">${health.status}</span>\n      </div>\n      <div class=\"health-factors\">\n        ${factors.slice(0, 3).map(f => `\n          <div class=\"factor ${f.type}\">\n            <span class=\"factor-icon\">${f.type === 'positive' ? '' : '!'}</span>\n            <span class=\"factor-text\">${f.factor}</span>\n          </div>\n        `).join('')}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render stats grid\n */\nfunction renderStatsGrid(container: HTMLElement, data: DashboardData, onClick?: (statId: string) => void): void {\n  // Safe access to nested properties with defaults\n  const docs = data.documents || { total: 0, processed: 0, pending: 0 };\n  const qPriority = data.questionsByPriority || { critical: 0, high: 0, medium: 0, resolved: 0 };\n  const rImpact = data.risksByImpact || { high: 0, medium: 0, low: 0 };\n\n  const factsVerified = data.factsVerifiedCount ?? 0;\n  const stats = [\n    { id: 'facts', label: 'Facts', value: data.totalFacts ?? 0, sub: factsVerified > 0 ? `${factsVerified} verified` : undefined, icon: '' },\n    { id: 'questions', label: 'Questions', value: data.totalQuestions ?? 0, sub: `${qPriority.resolved} resolved`, icon: '' },\n    { id: 'decisions', label: 'Decisions', value: data.totalDecisions ?? 0, icon: '' },\n    { id: 'risks', label: 'Risks', value: data.totalRisks ?? 0, sub: `${rImpact.high} high`, icon: '' },\n    { id: 'actions', label: 'Actions', value: data.totalActions ?? 0, sub: `${data.overdueActions ?? 0} overdue`, icon: '' },\n  ];\n\n  container.innerHTML = stats.map(stat => `\n    <div class=\"stat-card\" data-stat-id=\"${stat.id}\">\n      <div class=\"stat-value\">${stat.value}</div>\n      <div class=\"stat-label\">${stat.label}</div>\n      ${stat.sub ? `<div class=\"stat-sub\">${stat.sub}</div>` : ''}\n    </div>\n  `).join('');\n\n  // Bind click events\n  if (onClick) {\n    container.querySelectorAll('.stat-card[data-stat-id]').forEach(card => {\n      card.addEventListener('click', () => {\n        const statId = card.getAttribute('data-stat-id');\n        if (statId) onClick(statId);\n      });\n    });\n  }\n}\n\n/**\n * Render alerts\n */\nfunction renderAlerts(container: HTMLElement, alerts: Alert[], onClick?: (alert: Alert) => void): void {\n  container.innerHTML = `\n    <div class=\"alerts-header\">\n      <h3>Alerts</h3>\n      <span class=\"alerts-count\">${alerts.length}</span>\n    </div>\n    <div class=\"alerts-list\">\n      ${alerts.slice(0, 5).map((alert, i) => `\n        <div class=\"alert-item ${alert.severity}\" data-alert-index=\"${i}\">\n          <span class=\"alert-icon\">${getAlertIcon(alert.severity)}</span>\n          <div class=\"alert-content\">\n            <div class=\"alert-title\">${alert.title}</div>\n            <div class=\"alert-message\">${alert.message}</div>\n          </div>\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind click events\n  if (onClick) {\n    container.querySelectorAll('.alert-item').forEach(item => {\n      item.addEventListener('click', () => {\n        const index = parseInt(item.getAttribute('data-alert-index') || '0', 10);\n        onClick(alerts[index]);\n      });\n    });\n  }\n}\n\n/**\n * Render insights\n */\nfunction renderInsights(container: HTMLElement, insights: Insight[], onAction?: (insight: Insight) => void): void {\n  // Render insights directly as horizontal cards\n  container.innerHTML = insights.slice(0, 4).map((insight, i) => `\n    <div class=\"insight-item ${insight.type}\" data-insight-index=\"${i}\">\n      <span class=\"insight-icon\">${insight.icon}</span>\n      <div class=\"insight-content\">\n        <div class=\"insight-title\">${insight.title}</div>\n        <div class=\"insight-message\">${insight.message}</div>\n      </div>\n    </div>\n  `).join('');\n}\n\n/**\n * Render Risk Summary Chart (compact donut + bars)\n */\nfunction renderRiskSummary(container: HTMLElement, risks: Array<{ impact?: string; likelihood?: string; status?: string }>): void {\n  // Count risks by severity\n  const getSeverity = (impact?: string, likelihood?: string): string => {\n    const impactLevel = ['low', 'medium', 'high', 'critical'].indexOf(impact?.toLowerCase() || 'low');\n    const likelihoodLevel = ['low', 'medium', 'high'].indexOf(likelihood?.toLowerCase() || 'low');\n    const score = impactLevel + likelihoodLevel;\n    if (score >= 4) return 'critical';\n    if (score >= 3) return 'high';\n    if (score >= 2) return 'medium';\n    return 'low';\n  };\n\n  const activeRisks = risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed');\n  const counts = { critical: 0, high: 0, medium: 0, low: 0 };\n  \n  activeRisks.forEach(risk => {\n    const severity = getSeverity(risk.impact, risk.likelihood);\n    counts[severity as keyof typeof counts]++;\n  });\n\n  const total = activeRisks.length;\n  const mitigated = risks.length - activeRisks.length;\n\n  // Calculate percentages for donut\n  const getPercent = (count: number) => total > 0 ? Math.round((count / total) * 100) : 0;\n  \n  // Create conic gradient for donut\n  let conicStops = '';\n  let currentDeg = 0;\n  \n  const colors = {\n    critical: '#ef4444',\n    high: '#f97316', \n    medium: '#eab308',\n    low: '#22c55e'\n  };\n\n  (['critical', 'high', 'medium', 'low'] as const).forEach(level => {\n    const percent = getPercent(counts[level]);\n    const degrees = (percent / 100) * 360;\n    if (degrees > 0) {\n      conicStops += `${colors[level]} ${currentDeg}deg ${currentDeg + degrees}deg, `;\n      currentDeg += degrees;\n    }\n  });\n\n  // Default to gray if no risks\n  if (!conicStops) {\n    conicStops = 'var(--color-border) 0deg 360deg';\n  } else {\n    conicStops = conicStops.slice(0, -2); // Remove trailing comma\n  }\n\n  container.innerHTML = `\n    <div class=\"risk-summary\">\n      <div class=\"risk-summary-header\">\n        <h4>Risk Overview</h4>\n        <span class=\"risk-total\">${total} active</span>\n      </div>\n      \n      <div class=\"risk-summary-content\">\n        <div class=\"risk-donut-container\">\n          <div class=\"risk-donut\" style=\"--donut-conic: conic-gradient(${conicStops})\">\n            <div class=\"risk-donut-center\">\n              <span class=\"donut-value\">${total}</span>\n              <span class=\"donut-label\">Risks</span>\n            </div>\n          </div>\n        </div>\n        \n        <div class=\"risk-bars\">\n          <div class=\"risk-bar-item critical\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">Critical</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.critical)}%\"></div></div>\n            <span class=\"bar-count\">${counts.critical}</span>\n          </div>\n          <div class=\"risk-bar-item high\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">High</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.high)}%\"></div></div>\n            <span class=\"bar-count\">${counts.high}</span>\n          </div>\n          <div class=\"risk-bar-item medium\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">Medium</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.medium)}%\"></div></div>\n            <span class=\"bar-count\">${counts.medium}</span>\n          </div>\n          <div class=\"risk-bar-item low\">\n            <span class=\"bar-icon\"></span>\n            <span class=\"bar-label\">Low</span>\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.low)}%\"></div></div>\n            <span class=\"bar-count\">${counts.low}</span>\n          </div>\n        </div>\n      </div>\n      \n      ${mitigated > 0 ? `\n        <div class=\"risk-mitigated\">\n          <span class=\"mitigated-icon\"></span>\n          <span>${mitigated} risk${mitigated > 1 ? 's' : ''} mitigated</span>\n        </div>\n      ` : ''}\n    </div>\n  `;\n}\n\n/**\n * Render facts by category chart\n */\nfunction renderFactsChart(data: DashboardData): void {\n  const container = document.getElementById('facts-chart');\n  if (!container) return;\n\n  const byCat = data.factsByCategory || {};\n  const categories = ['technical', 'process', 'policy', 'people', 'timeline', 'general'] as const;\n  const total = categories.reduce((sum, c) => sum + (byCat[c] ?? 0), 0);\n\n  if (total === 0) {\n    container.innerHTML = '<div class=\"empty-chart\">No facts yet</div>';\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"facts-chart-title\">Facts by category</div>\n    <div class=\"priority-bars\">\n      ${categories.map(cat => {\n        const count = byCat[cat] ?? 0;\n        const pct = total > 0 ? (count / total) * 100 : 0;\n        return `\n        <div class=\"priority-bar\">\n          <div class=\"bar-label\">${cat}</div>\n          <div class=\"bar-track\">\n            <div class=\"bar-fill\" style=\"--bar-width: ${pct}%\"></div>\n          </div>\n          <div class=\"bar-value\">${count}</div>\n        </div>`;\n      }).join('')}\n    </div>\n  `;\n}\n\n/**\n * Render questions by priority chart\n */\nfunction renderQuestionsPriorityChart(data: DashboardData): void {\n  const container = document.getElementById('questions-chart');\n  if (!container) return;\n\n  const { critical, high, medium, resolved } = data.questionsByPriority;\n  const total = critical + high + medium + resolved;\n  \n  if (total === 0) {\n    container.innerHTML = '<div class=\"empty-chart\">No questions yet</div>';\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"priority-bars\">\n      <div class=\"priority-bar\">\n        <div class=\"bar-label\">Critical</div>\n        <div class=\"bar-track\">\n          <div class=\"bar-fill critical\" style=\"--bar-width: ${(critical / total) * 100}%\"></div>\n        </div>\n        <div class=\"bar-value\">${critical}</div>\n      </div>\n      <div class=\"priority-bar\">\n        <div class=\"bar-label\">High</div>\n        <div class=\"bar-track\">\n          <div class=\"bar-fill high\" style=\"--bar-width: ${(high / total) * 100}%\"></div>\n        </div>\n        <div class=\"bar-value\">${high}</div>\n      </div>\n      <div class=\"priority-bar\">\n        <div class=\"bar-label\">Medium</div>\n        <div class=\"bar-track\">\n          <div class=\"bar-fill medium\" style=\"--bar-width: ${(medium / total) * 100}%\"></div>\n        </div>\n        <div class=\"bar-value\">${medium}</div>\n      </div>\n      <div class=\"priority-bar\">\n        <div class=\"bar-label\">Resolved</div>\n        <div class=\"bar-track\">\n          <div class=\"bar-fill resolved\" style=\"--bar-width: ${(resolved / total) * 100}%\"></div>\n        </div>\n        <div class=\"bar-value\">${resolved}</div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render weekly trends chart with real API data\n */\nasync function renderWeeklyTrendsChart(data: DashboardData): Promise<void> {\n  const container = document.getElementById('trends-chart');\n  if (!container) return;\n\n  // Show loading state\n  container.innerHTML = '<div class=\"loading\">Loading trends...</div>';\n\n  try {\n    // Fetch real trends data from API\n    const trendsData = await dashboardService.getTrends(7);\n    \n    if (!trendsData || !trendsData.history || trendsData.history.length === 0) {\n      container.innerHTML = '<div class=\"empty-chart\">No trend data available yet</div>';\n      return;\n    }\n\n    // Use real history data\n    const history = trendsData.history;\n    \n    // Build arrays from history\n    const days: string[] = [];\n    const trends = {\n      facts: [] as number[],\n      questions: [] as number[],\n      risks: [] as number[],\n      actions: [] as number[],\n    };\n\n    history.forEach(entry => {\n      const d = new Date(entry.date);\n      days.push(d.toLocaleDateString(undefined, { weekday: 'short' }));\n      trends.facts.push(entry.facts || 0);\n      trends.questions.push(entry.questions || 0);\n      trends.risks.push(entry.risks || 0);\n      trends.actions.push(entry.actions || 0);\n    });\n\n    const maxValue = Math.max(\n      ...trends.facts, \n      ...trends.questions, \n      ...trends.risks, \n      ...trends.actions, \n      1\n    );\n\n    container.innerHTML = `\n      <div class=\"trends-chart\">\n        <div class=\"trends-legend\">\n          <span class=\"legend-item\"><span class=\"legend-dot facts\"></span>Facts</span>\n          <span class=\"legend-item\"><span class=\"legend-dot questions\"></span>Questions</span>\n          <span class=\"legend-item\"><span class=\"legend-dot risks\"></span>Risks</span>\n          <span class=\"legend-item\"><span class=\"legend-dot actions\"></span>Actions</span>\n        </div>\n        <div class=\"trends-bars\">\n          ${days.map((day, i) => `\n            <div class=\"trend-column\">\n              <div class=\"trend-bars-group\">\n                <div class=\"trend-bar facts\" style=\"--trend-height: ${(trends.facts[i] / maxValue) * 100}%\" title=\"Facts: ${trends.facts[i]}\"></div>\n                <div class=\"trend-bar questions\" style=\"--trend-height: ${(trends.questions[i] / maxValue) * 100}%\" title=\"Questions: ${trends.questions[i]}\"></div>\n                <div class=\"trend-bar risks\" style=\"--trend-height: ${(trends.risks[i] / maxValue) * 100}%\" title=\"Risks: ${trends.risks[i]}\"></div>\n                <div class=\"trend-bar actions\" style=\"--trend-height: ${(trends.actions[i] / maxValue) * 100}%\" title=\"Actions: ${trends.actions[i]}\"></div>\n              </div>\n              <div class=\"trend-label\">${day}</div>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    `;\n  } catch (error) {\n    console.error('Failed to load trends:', error);\n    container.innerHTML = '<div class=\"error\">Failed to load trend data</div>';\n  }\n}\n\n/**\n * Render overdue actions alert\n */\nfunction renderOverdueActionsAlert(container: HTMLElement, overdueCount: number): void {\n  if (overdueCount === 0) {\n    container.innerHTML = '';\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"overdue-alert\">\n      <div class=\"overdue-icon\"></div>\n      <div class=\"overdue-content\">\n        <strong>${overdueCount} Overdue Action${overdueCount !== 1 ? 's' : ''}</strong>\n        <span>Action items past their due date require immediate attention</span>\n      </div>\n      <button class=\"btn btn-sm btn-warning\" id=\"view-overdue-btn\">View Actions</button>\n    </div>\n  `;\n\n  // Bind view button\n  const viewBtn = container.querySelector('#view-overdue-btn');\n  if (viewBtn) {\n    viewBtn.addEventListener('click', () => {\n      // Navigate to actions tab with overdue filter\n      window.dispatchEvent(new CustomEvent('godmode:navigate', { \n        detail: { tab: 'sot', view: 'actions', filter: 'overdue' }\n      }));\n    });\n  }\n}\n\n/**\n * Get alert icon based on severity\n */\nfunction getAlertIcon(severity: string): string {\n  switch (severity) {\n    case 'critical': return '';\n    case 'high': return '';\n    case 'warning': return '';\n    default: return '';\n  }\n}\n\n/**\n * Create a stat card element\n */\nfunction createStatCard(\n  config: {\n    id: string;\n    label: string;\n    icon: string;\n    getValue: (s: DashboardStats) => string | number;\n    subValue?: (s: DashboardStats) => string;\n    isScore?: boolean;\n  },\n  onClick?: (statId: string) => void\n): HTMLElement {\n  const card = createElement('div', {\n    className: `stat-item ${onClick ? 'clickable' : ''}`,\n  });\n  card.setAttribute('data-stat-id', config.id);\n\n  if (onClick) {\n    on(card, 'click', () => onClick(config.id));\n  }\n\n  card.innerHTML = `\n    <div class=\"stat-icon\">${config.icon}</div>\n    <div class=\"value\" data-value>-</div>\n    <div class=\"label\">${config.label}</div>\n    ${config.subValue ? '<div class=\"sub-value\" data-sub-value></div>' : ''}\n  `;\n\n  return card;\n}\n\n/**\n * Update dashboard with current data\n */\nfunction updateDashboard(\n  statsGrid: HTMLElement,\n  statConfigs: Array<{\n    id: string;\n    getValue: (s: DashboardStats) => string | number;\n    subValue?: (s: DashboardStats) => string;\n    isScore?: boolean;\n  }>\n): void {\n  const data = dataStore.getState();\n\n  // Only count active questions (not dismissed/resolved/closed)\n  const activeQuestions = data.questions.filter(q => \n    q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'closed' && q.status !== 'answered'\n  );\n  \n  const stats: DashboardStats = {\n    totalQuestions: activeQuestions.length,\n    answeredQuestions: data.questions.filter(q => q.status === 'answered' || q.status === 'resolved').length,\n    totalRisks: data.risks.length,\n    highPriorityRisks: data.risks.filter(r => r.impact === 'high').length,\n    totalActions: data.actions.length,\n    completedActions: data.actions.filter(a => a.status === 'completed').length,\n    totalDecisions: data.decisions.length,\n    totalContacts: data.contacts.length,\n    healthScore: calculateHealthScore(data),\n  };\n\n  statConfigs.forEach(config => {\n    const card = statsGrid.querySelector(`[data-stat-id=\"${config.id}\"]`);\n    if (!card) return;\n\n    const valueEl = card.querySelector('[data-value]');\n    const subValueEl = card.querySelector('[data-sub-value]');\n\n    if (valueEl) {\n      const value = config.getValue(stats);\n      valueEl.textContent = typeof value === 'number' ? formatNumber(value) : value;\n\n      // Add color for health score\n      if (config.isScore && typeof value === 'number') {\n        valueEl.className = 'value ' + getHealthClass(value);\n      }\n    }\n\n    if (subValueEl && config.subValue) {\n      subValueEl.textContent = config.subValue(stats);\n    }\n  });\n}\n\n/**\n * Calculate health score from data\n */\nfunction calculateHealthScore(data: ReturnType<typeof dataStore.getState>): number {\n  const weights = {\n    questionsAnswered: 25,\n    risksManaged: 25,\n    actionsCompleted: 25,\n    decisionsProgress: 25,\n  };\n\n  let score = 0;\n\n  // Questions answered\n  if (data.questions.length > 0) {\n    const answered = data.questions.filter(q => q.status === 'answered').length;\n    score += (answered / data.questions.length) * weights.questionsAnswered;\n  } else {\n    score += weights.questionsAnswered;\n  }\n\n  // Risks managed\n  if (data.risks.length > 0) {\n    const managed = data.risks.filter(r => r.status !== 'open').length;\n    score += (managed / data.risks.length) * weights.risksManaged;\n  } else {\n    score += weights.risksManaged;\n  }\n\n  // Actions completed\n  if (data.actions.length > 0) {\n    const completed = data.actions.filter(a => a.status === 'completed').length;\n    score += (completed / data.actions.length) * weights.actionsCompleted;\n  } else {\n    score += weights.actionsCompleted;\n  }\n\n  // Decisions made\n  if (data.decisions.length > 0) {\n    const approved = data.decisions.filter(d => d.status === 'approved').length;\n    score += (approved / data.decisions.length) * weights.decisionsProgress;\n  } else {\n    score += weights.decisionsProgress;\n  }\n\n  return Math.round(score);\n}\n\n/**\n * Get CSS class for health score\n */\nfunction getHealthClass(score: number): string {\n  if (score >= 80) return 'excellent';\n  if (score >= 60) return 'good';\n  if (score >= 40) return 'warning';\n  return 'critical';\n}\n\n/**\n * Load and render project team section\n */\nasync function loadProjectTeam(container: HTMLElement, projectId: string): Promise<void> {\n  try {\n    const response = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\n    const members = response.data?.members || [];\n    \n    if (members.length === 0) {\n      container.innerHTML = '';\n      return;\n    }\n\n    container.innerHTML = `\n      <style>\n        .team-section {\n          background: var(--bg-primary);\n          border-radius: 16px;\n          padding: 24px;\n          border: 1px solid var(--border-color);\n        }\n        \n        .team-section-header {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          margin-bottom: 20px;\n        }\n        \n        .team-section-header h3 {\n          margin: 0;\n          font-size: 18px;\n          font-weight: 600;\n          color: var(--text-primary);\n          display: flex;\n          align-items: center;\n          gap: 10px;\n        }\n        \n        .team-section-header h3 svg {\n          color: #e11d48;\n        }\n        \n        .team-section-header .member-count {\n          background: linear-gradient(135deg, #e11d48, #be123c);\n          color: white;\n          padding: 4px 10px;\n          border-radius: 20px;\n          font-size: 12px;\n          font-weight: 600;\n        }\n        \n        .team-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n          gap: 16px;\n        }\n        \n        .team-member-card {\n          background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.4) 100%);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          padding: 16px;\n          display: flex;\n          align-items: center;\n          gap: 14px;\n          transition: all 0.2s ease;\n        }\n        \n        [data-theme=\"dark\"] .team-member-card {\n          background: linear-gradient(135deg, rgba(30,41,59,0.8) 0%, rgba(30,41,59,0.4) 100%);\n        }\n        \n        .team-member-card:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 8px 24px rgba(0,0,0,0.08);\n          border-color: rgba(225,29,72,0.3);\n        }\n        \n        .team-member-avatar {\n          width: 52px;\n          height: 52px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #e11d48, #be123c);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-weight: 600;\n          font-size: 18px;\n          color: white;\n          flex-shrink: 0;\n          overflow: hidden;\n        }\n        \n        .team-member-avatar img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        }\n        \n        .team-member-avatar.owner {\n          background: linear-gradient(135deg, #f59e0b, #d97706);\n        }\n        \n        .team-member-info {\n          flex: 1;\n          min-width: 0;\n        }\n        \n        .team-member-info h4 {\n          margin: 0 0 4px 0;\n          font-size: 15px;\n          font-weight: 600;\n          color: var(--text-primary);\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .team-member-info .role-badge {\n          display: inline-flex;\n          align-items: center;\n          gap: 4px;\n          padding: 3px 8px;\n          border-radius: 6px;\n          font-size: 11px;\n          font-weight: 600;\n          background: rgba(225,29,72,0.1);\n          color: #e11d48;\n          margin-bottom: 4px;\n        }\n        \n        .team-member-info .role-badge.owner {\n          background: rgba(245,158,11,0.15);\n          color: #d97706;\n        }\n        \n        .team-member-info .role-badge.admin {\n          background: rgba(59,130,246,0.1);\n          color: #3b82f6;\n        }\n        \n        .team-member-info .user-role {\n          font-size: 13px;\n          color: var(--text-secondary);\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .team-member-info .linked-contact {\n          font-size: 11px;\n          color: #e11d48;\n          display: flex;\n          align-items: center;\n          gap: 4px;\n          margin-top: 4px;\n        }\n        \n        .team-member-info .linked-contact svg {\n          width: 12px;\n          height: 12px;\n        }\n      </style>\n      \n      <div class=\"team-section\">\n        <div class=\"team-section-header\">\n          <h3>\n            <svg width=\"22\" height=\"22\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n            </svg>\n            Project Team\n          </h3>\n          <span class=\"member-count\">${members.length} member${members.length !== 1 ? 's' : ''}</span>\n        </div>\n        \n        <div class=\"team-grid\">\n          ${members.map(member => {\n            const isOwner = member.role === 'owner';\n            const isAdmin = member.role === 'admin';\n            const initials = getInitials(member.display_name || member.username || member.email || '?');\n            // Use linked contact avatar if member doesn't have one\n            const avatarUrl = member.avatar_url || member.linked_contact?.avatar_url || member.linked_contact?.photo_url;\n            \n            return `\n              <div class=\"team-member-card\">\n                <div class=\"team-member-avatar ${isOwner ? 'owner' : ''}\">\n                  ${avatarUrl \n                    ? `<img src=\"${escapeHtml(avatarUrl)}\" alt=\"${escapeHtml(member.display_name || '')}\">`\n                    : initials\n                  }\n                </div>\n                <div class=\"team-member-info\">\n                  <h4>${escapeHtml(member.display_name || member.username || member.email || 'Unknown')}</h4>\n                  <span class=\"role-badge ${isOwner ? 'owner' : isAdmin ? 'admin' : ''}\">\n                    ${isOwner ? ' Owner' : isAdmin ? 'Admin' : member.role === 'write' ? 'Write' : 'Read'}\n                  </span>\n                  ${member.user_role ? `<div class=\"user-role\">${escapeHtml(member.user_role)}</div>` : ''}\n                  ${member.linked_contact ? `\n                    <div class=\"linked-contact\">\n                      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\n                      </svg>\n                      ${escapeHtml(member.linked_contact.name)}\n                    </div>\n                  ` : ''}\n                </div>\n              </div>\n            `;\n          }).join('')}\n        </div>\n      </div>\n    `;\n  } catch (error) {\n    console.error('Failed to load project team:', error);\n  }\n}\n\n// Types for team section\ninterface ProjectMember {\n  user_id: string;\n  role: string;\n  user_role?: string;\n  user_role_prompt?: string;\n  linked_contact_id?: string;\n  linked_contact?: {\n    id: string;\n    name: string;\n    email?: string;\n    organization?: string;\n    avatar_url?: string;\n    photo_url?: string;\n    timezone?: string;\n  };\n  username?: string;\n  display_name?: string;\n  avatar_url?: string;\n  email?: string;\n  timezone?: string;\n}\n\ninterface TimezoneEntry {\n  name: string;\n  timezone: string;\n  type: 'member' | 'contact';\n  avatarUrl?: string;\n  localTime?: string;\n  localHour?: number;\n  isOnline?: boolean;\n  role?: string;\n  linkedContactId?: string; // For deduplication\n  contactId?: string; // For contacts\n}\n\n/**\n * Get local time info for a timezone\n */\nfunction getLocalTimeInfo(timezone: string): { localTime: string; localHour: number; isOnline: boolean } {\n  try {\n    const now = new Date();\n    const formatter = new Intl.DateTimeFormat('en-GB', {\n      timeZone: timezone,\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false,\n    });\n    const localTime = formatter.format(now);\n    const localHour = parseInt(localTime.split(':')[0], 10);\n    // Consider online if between 8:00 and 18:00\n    const isOnline = localHour >= 8 && localHour < 18;\n    return { localTime, localHour, isOnline };\n  } catch {\n    return { localTime: '--:--', localHour: 12, isOnline: false };\n  }\n}\n\n/**\n * Find best meeting times for all participants\n */\nfunction findBestMeetingTimes(entries: TimezoneEntry[]): { time: string; score: number; available: number }[] {\n  if (entries.length === 0) return [];\n\n  const suggestions: { time: string; score: number; available: number }[] = [];\n  const now = new Date();\n\n  // Check each hour of the day\n  for (let hour = 0; hour < 24; hour++) {\n    let available = 0;\n    let totalScore = 0;\n\n    for (const entry of entries) {\n      try {\n        const formatter = new Intl.DateTimeFormat('en-US', {\n          timeZone: entry.timezone,\n          hour: 'numeric',\n          hour12: false,\n        });\n        const localHour = parseInt(formatter.format(now), 10);\n        const utcHour = now.getUTCHours();\n        let offset = localHour - utcHour;\n        if (offset > 12) offset -= 24;\n        if (offset < -12) offset += 24;\n\n        // What hour would it be for this person?\n        const theirHour = (hour + offset + 24) % 24;\n\n        // Score based on how \"comfortable\" the hour is\n        if (theirHour >= 9 && theirHour <= 17) {\n          available++;\n          // Peak hours (10-12, 14-16) get higher score\n          if (theirHour >= 10 && theirHour <= 12) totalScore += 10;\n          else if (theirHour >= 14 && theirHour <= 16) totalScore += 10;\n          else totalScore += 7;\n        } else if (theirHour >= 8 && theirHour <= 18) {\n          available++;\n          totalScore += 4;\n        }\n      } catch { /* ignore */ }\n    }\n\n    if (available > 0) {\n      suggestions.push({\n        time: `${hour.toString().padStart(2, '0')}:00 UTC`,\n        score: totalScore,\n        available,\n      });\n    }\n  }\n\n  // Sort by number available (desc), then by score (desc)\n  suggestions.sort((a, b) => {\n    if (b.available !== a.available) return b.available - a.available;\n    return b.score - a.score;\n  });\n\n  return suggestions.slice(0, 3); // Top 3 suggestions\n}\n\n/**\n * Load Golden Hours section\n * Shows working hours overlap for team members and contacts\n */\nasync function loadGoldenHours(container: HTMLElement, projectId: string): Promise<void> {\n  try {\n    // Fetch team members and contacts in parallel\n    const [membersRes, contactsRes] = await Promise.all([\n      http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`).catch(() => ({ data: { members: [] } })),\n      http.get<{ contacts: { name: string; timezone?: string; avatarUrl?: string; photoUrl?: string; photo_url?: string; avatar_url?: string }[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\n    ]);\n\n    const members = membersRes.data?.members || [];\n    const contacts = contactsRes.data?.contacts || [];\n\n    // Extract timezone entries - use linked contact data if member doesn't have one\n    // Also track linked_contact_id for deduplication\n    const linkedContactIds = new Set<string>();\n    \n    const memberEntries = members\n      .map(m => {\n        // Check if member has linked contact with timezone and role\n        const linkedContact = m.linked_contact as { id?: string; timezone?: string; avatar_url?: string; photo_url?: string; role?: string } | undefined;\n        const tz = m.timezone || linkedContact?.timezone;\n        if (!tz) return null;\n        \n        const timeInfo = getLocalTimeInfo(tz);\n        // Use linked contact avatar if member doesn't have one\n        const avatarUrl = m.avatar_url || linkedContact?.avatar_url || linkedContact?.photo_url;\n        // Use user_role or linked contact role\n        const role = m.user_role || linkedContact?.role || (m.role === 'owner' ? 'Owner' : m.role === 'admin' ? 'Admin' : undefined);\n        \n        // Track linked contact id for deduplication\n        const linkedContactId = m.linked_contact_id || linkedContact?.id;\n        if (linkedContactId) {\n          linkedContactIds.add(linkedContactId);\n        }\n        \n        return {\n          name: m.display_name || m.username || m.email || 'Unknown',\n          timezone: tz,\n          type: 'member' as const,\n          avatarUrl,\n          role,\n          linkedContactId,\n          ...timeInfo,\n        } as TimezoneEntry;\n      })\n      .filter((m): m is TimezoneEntry => m !== null);\n\n    const contactEntries: TimezoneEntry[] = contacts\n      .filter(c => c.timezone)\n      .map(c => {\n        const timeInfo = getLocalTimeInfo(c.timezone || 'UTC');\n        const contactId = (c as { id?: string }).id;\n        return {\n          name: c.name,\n          timezone: c.timezone || 'UTC',\n          type: 'contact' as const,\n          avatarUrl: c.avatarUrl || c.photoUrl || c.photo_url || c.avatar_url,\n          role: (c as { role?: string }).role,\n          contactId,\n          ...timeInfo,\n        };\n      });\n\n    // If no timezone data, don't show the section\n    if (memberEntries.length === 0 && contactEntries.length === 0) {\n      container.innerHTML = '';\n      return;\n    }\n\n    // Calculate golden hours for each group\n    const memberGolden = calculateGoldenHours(memberEntries);\n    const contactGolden = calculateGoldenHours(contactEntries);\n    \n    // For combined view, deduplicate: remove contacts that are already represented by team members\n    const deduplicatedContactEntries = contactEntries.filter(c => !c.contactId || !linkedContactIds.has(c.contactId));\n    const allEntries = [...memberEntries, ...deduplicatedContactEntries];\n    const allGolden = calculateGoldenHours(allEntries);\n    \n    // Find best meeting times\n    const meetingSuggestions = findBestMeetingTimes(allEntries);\n    \n    // Count online people\n    const onlineMembers = memberEntries.filter(m => m.isOnline).length;\n    const onlineContacts = contactEntries.filter(c => c.isOnline).length;\n    const onlineDeduplicatedContacts = deduplicatedContactEntries.filter(c => c.isOnline).length;\n    const onlineAll = onlineMembers + onlineDeduplicatedContacts;\n\n    container.innerHTML = `\n      <style>\n        .golden-hours-section {\n          background: var(--bg-primary);\n          border-radius: 16px;\n          padding: 24px;\n          border: 1px solid var(--border-color);\n          margin-bottom: 24px;\n        }\n        \n        .golden-hours-header {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          margin-bottom: 24px;\n        }\n        \n        .golden-hours-header h3 {\n          margin: 0;\n          font-size: 18px;\n          font-weight: 600;\n          color: var(--text-primary);\n          display: flex;\n          align-items: center;\n          gap: 10px;\n        }\n        \n        .golden-hours-header h3 svg {\n          color: #f59e0b;\n        }\n        \n        .golden-hours-grid {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));\n          gap: 20px;\n        }\n        \n        .golden-card {\n          background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,250,252,0.9) 100%);\n          border: 1px solid var(--border-color);\n          border-radius: 12px;\n          padding: 20px;\n        }\n        \n        [data-theme=\"dark\"] .golden-card {\n          background: linear-gradient(135deg, rgba(30,41,59,0.9) 0%, rgba(30,41,59,0.6) 100%);\n        }\n        \n        .golden-card h4 {\n          margin: 0 0 16px 0;\n          font-size: 14px;\n          font-weight: 600;\n          color: var(--text-secondary);\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .golden-card h4 .count {\n          background: var(--bg-secondary);\n          padding: 2px 8px;\n          border-radius: 10px;\n          font-size: 12px;\n        }\n        \n        .timezone-bars {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n          margin-bottom: 16px;\n        }\n        \n        .timezone-row {\n          display: flex;\n          align-items: center;\n          gap: 10px;\n        }\n        \n        .tz-name {\n          width: 100px;\n          font-size: 12px;\n          color: var(--text-secondary);\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .tz-bar-container {\n          flex: 1;\n          height: 24px;\n          background: var(--bg-secondary);\n          border-radius: 4px;\n          position: relative;\n          overflow: hidden;\n        }\n        \n        .tz-bar {\n          position: absolute;\n          height: 100%;\n          border-radius: 2px;\n        }\n        \n        .tz-bar.work-hours {\n          background: linear-gradient(90deg, #10b981, #34d399);\n          opacity: 0.6;\n        }\n        \n        .tz-bar.golden {\n          background: linear-gradient(90deg, #f59e0b, #fbbf24);\n          opacity: 0.9;\n        }\n        \n        .hour-labels {\n          display: flex;\n          justify-content: space-between;\n          padding: 0 110px 0 0;\n          margin-bottom: 4px;\n        }\n        \n        .hour-label {\n          font-size: 10px;\n          color: var(--text-muted);\n          width: 20px;\n          text-align: center;\n        }\n        \n        .golden-summary {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 12px;\n          background: linear-gradient(135deg, rgba(245,158,11,0.1) 0%, rgba(251,191,36,0.05) 100%);\n          border-radius: 8px;\n          border: 1px solid rgba(245,158,11,0.2);\n        }\n        \n        .golden-icon {\n          width: 40px;\n          height: 40px;\n          background: linear-gradient(135deg, #f59e0b, #d97706);\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-size: 18px;\n        }\n        \n        .golden-text {\n          flex: 1;\n        }\n        \n        .golden-text .label {\n          font-size: 12px;\n          color: var(--text-secondary);\n        }\n        \n        .golden-text .hours {\n          font-size: 16px;\n          font-weight: 700;\n          color: #d97706;\n        }\n        \n        .no-overlap {\n          color: var(--text-muted);\n          font-size: 13px;\n          font-style: italic;\n        }\n        \n        .participants-row {\n          display: flex;\n          align-items: center;\n          gap: 4px;\n          margin-top: 12px;\n        }\n        \n        .participant-avatar {\n          width: 24px;\n          height: 24px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #667eea, #764ba2);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-size: 10px;\n          font-weight: 600;\n          border: 2px solid var(--bg-primary);\n          margin-left: -8px;\n        }\n        \n        .participant-avatar:first-child {\n          margin-left: 0;\n        }\n        \n        .participant-avatar img {\n          width: 100%;\n          height: 100%;\n          border-radius: 50%;\n          object-fit: cover;\n        }\n        \n        .participant-avatar.more {\n          background: var(--bg-secondary);\n          color: var(--text-secondary);\n        }\n        \n        .online-status-bar {\n          display: flex;\n          align-items: center;\n          gap: 16px;\n          padding: 16px;\n          background: linear-gradient(135deg, rgba(16,185,129,0.1) 0%, rgba(52,211,153,0.05) 100%);\n          border-radius: 12px;\n          border: 1px solid rgba(16,185,129,0.2);\n          margin-bottom: 20px;\n        }\n        \n        .online-indicator {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .online-dot {\n          width: 10px;\n          height: 10px;\n          border-radius: 50%;\n          background: #10b981;\n          box-shadow: 0 0 8px rgba(16,185,129,0.6);\n          animation: pulse 2s infinite;\n        }\n        \n        @keyframes pulse {\n          0%, 100% { transform: scale(1); opacity: 1; }\n          50% { transform: scale(1.2); opacity: 0.7; }\n        }\n        \n        .online-count {\n          font-size: 14px;\n          font-weight: 600;\n          color: #059669;\n        }\n        \n        .people-list {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 12px;\n          margin-top: 16px;\n        }\n        \n        .person-chip {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 8px 12px;\n          background: var(--bg-secondary);\n          border-radius: 20px;\n          border: 1px solid var(--border-color);\n          transition: all 0.2s ease;\n        }\n        \n        .person-chip.online {\n          background: linear-gradient(135deg, rgba(16,185,129,0.1) 0%, rgba(16,185,129,0.05) 100%);\n          border-color: rgba(16,185,129,0.3);\n        }\n        \n        .person-chip.offline {\n          opacity: 0.6;\n        }\n        \n        .person-avatar-small {\n          width: 28px;\n          height: 28px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #667eea, #764ba2);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-size: 11px;\n          font-weight: 600;\n          position: relative;\n        }\n        \n        .person-avatar-small img {\n          width: 100%;\n          height: 100%;\n          border-radius: 50%;\n          object-fit: cover;\n        }\n        \n        .person-avatar-small .status-dot {\n          position: absolute;\n          bottom: -2px;\n          right: -2px;\n          width: 10px;\n          height: 10px;\n          border-radius: 50%;\n          border: 2px solid var(--bg-primary);\n        }\n        \n        .person-avatar-small .status-dot.online {\n          background: #10b981;\n        }\n        \n        .person-avatar-small .status-dot.offline {\n          background: #9ca3af;\n        }\n        \n        .person-info {\n          display: flex;\n          flex-direction: column;\n        }\n        \n        .person-name {\n          font-size: 13px;\n          font-weight: 500;\n          color: var(--text-primary);\n        }\n        \n        .person-time {\n          font-size: 11px;\n          color: var(--text-secondary);\n        }\n        \n        .person-role {\n          font-size: 10px;\n          color: #e11d48;\n          font-weight: 500;\n          margin-top: 2px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          max-width: 120px;\n        }\n        \n        .meeting-suggestions {\n          margin-top: 20px;\n          padding: 16px;\n          background: linear-gradient(135deg, rgba(99,102,241,0.1) 0%, rgba(139,92,246,0.05) 100%);\n          border-radius: 12px;\n          border: 1px solid rgba(99,102,241,0.2);\n        }\n        \n        .meeting-suggestions h5 {\n          margin: 0 0 12px 0;\n          font-size: 14px;\n          font-weight: 600;\n          color: var(--text-primary);\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .meeting-suggestions h5 svg {\n          color: #6366f1;\n        }\n        \n        .suggestion-list {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 10px;\n        }\n        \n        .suggestion-pill {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 8px 14px;\n          background: white;\n          border-radius: 20px;\n          border: 1px solid rgba(99,102,241,0.3);\n          font-size: 13px;\n          cursor: pointer;\n          transition: all 0.2s ease;\n        }\n        \n        [data-theme=\"dark\"] .suggestion-pill {\n          background: rgba(30,41,59,0.8);\n        }\n        \n        .suggestion-pill:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 4px 12px rgba(99,102,241,0.2);\n        }\n        \n        .suggestion-pill .time {\n          font-weight: 600;\n          color: #6366f1;\n        }\n        \n        .suggestion-pill .availability {\n          font-size: 11px;\n          color: var(--text-secondary);\n          padding: 2px 6px;\n          background: rgba(16,185,129,0.1);\n          border-radius: 8px;\n          color: #059669;\n        }\n      </style>\n      \n      <div class=\"golden-hours-section\">\n        <div class=\"golden-hours-header\">\n          <h3>\n            <svg width=\"24\" height=\"24\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\"/>\n            </svg>\n            Golden Hours\n          </h3>\n          <span class=\"golden-header-time\">\n            ${new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })} your time\n          </span>\n        </div>\n        \n        <div class=\"golden-hours-grid\">\n          <!-- Team Members Section -->\n          ${memberEntries.length > 0 ? `\n            <div class=\"golden-card\">\n              <h4>\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                </svg>\n                Team Members\n                <span class=\"count\">${memberEntries.length}</span>\n                ${onlineMembers > 0 ? `<span class=\"online-badge\"> ${onlineMembers} online</span>` : ''}\n              </h4>\n              \n              <!-- Team People List -->\n              <div class=\"people-list\">\n                ${memberEntries.map(e => {\n                  const initials = e.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n                  return `\n                    <div class=\"person-chip ${e.isOnline ? 'online' : 'offline'}\">\n                      <div class=\"person-avatar-small\">\n                        ${e.avatarUrl ? `<img src=\"${escapeHtmlSimple(e.avatarUrl)}\" alt=\"${escapeHtmlSimple(e.name)}\">` : initials}\n                        <span class=\"status-dot ${e.isOnline ? 'online' : 'offline'}\"></span>\n                      </div>\n                      <div class=\"person-info\">\n                        <span class=\"person-name\">${escapeHtmlSimple(e.name)}</span>\n                        ${e.role ? `<span class=\"person-role\">${escapeHtmlSimple(e.role)}</span>` : ''}\n                        <span class=\"person-time\">${e.localTime || '--:--'} ${e.timezone.split('/').pop()?.replace(/_/g, ' ') || ''}</span>\n                      </div>\n                    </div>\n                  `;\n                }).join('')}\n              </div>\n              \n              ${renderTimezoneChart(memberEntries, memberGolden)}\n              ${renderGoldenSummary(memberGolden, memberEntries)}\n              \n              <!-- Team Meeting Suggestions -->\n              ${(() => {\n                const teamSuggestions = findBestMeetingTimes(memberEntries);\n                return teamSuggestions.length > 0 ? `\n                  <div class=\"meeting-suggestions\">\n                    <h5>\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                      </svg>\n                      Best Times for Team\n                    </h5>\n                    <div class=\"suggestion-list\">\n                      ${teamSuggestions.map((s, i) => `\n                        <div class=\"suggestion-pill\">\n                          <span class=\"suggestion-star\" style=\"--suggestion-star-color: ${i === 0 ? '#f59e0b' : 'var(--text-muted)'};\">${i === 0 ? '' : ''}</span>\n                          <span class=\"time\">${s.time}</span>\n                          <span class=\"availability\">${s.available}/${memberEntries.length}</span>\n                        </div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : '';\n              })()}\n            </div>\n          ` : ''}\n          \n          <!-- Contacts Section -->\n          ${contactEntries.length > 0 ? `\n            <div class=\"golden-card\">\n              <h4>\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\"/>\n                </svg>\n                Contacts\n                <span class=\"count\">${contactEntries.length}</span>\n                ${onlineContacts > 0 ? `<span class=\"online-badge\"> ${onlineContacts} online</span>` : ''}\n              </h4>\n              \n              <!-- Contacts People List -->\n              <div class=\"people-list\">\n                ${contactEntries.map(e => {\n                  const initials = e.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n                  return `\n                    <div class=\"person-chip ${e.isOnline ? 'online' : 'offline'}\">\n                      <div class=\"person-avatar-small\">\n                        ${e.avatarUrl ? `<img src=\"${escapeHtmlSimple(e.avatarUrl)}\" alt=\"${escapeHtmlSimple(e.name)}\">` : initials}\n                        <span class=\"status-dot ${e.isOnline ? 'online' : 'offline'}\"></span>\n                      </div>\n                      <div class=\"person-info\">\n                        <span class=\"person-name\">${escapeHtmlSimple(e.name)}</span>\n                        ${e.role ? `<span class=\"person-role\">${escapeHtmlSimple(e.role)}</span>` : ''}\n                        <span class=\"person-time\">${e.localTime || '--:--'} ${e.timezone.split('/').pop()?.replace(/_/g, ' ') || ''}</span>\n                      </div>\n                    </div>\n                  `;\n                }).join('')}\n              </div>\n              \n              ${renderTimezoneChart(contactEntries, contactGolden)}\n              ${renderGoldenSummary(contactGolden, contactEntries)}\n              \n              <!-- Contacts Meeting Suggestions -->\n              ${(() => {\n                const contactSuggestions = findBestMeetingTimes(contactEntries);\n                return contactSuggestions.length > 0 ? `\n                  <div class=\"meeting-suggestions\">\n                    <h5>\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                      </svg>\n                      Best Times for Contacts\n                    </h5>\n                    <div class=\"suggestion-list\">\n                      ${contactSuggestions.map((s, i) => `\n                        <div class=\"suggestion-pill\">\n                          <span class=\"suggestion-star\" style=\"--suggestion-star-color: ${i === 0 ? '#f59e0b' : 'var(--text-muted)'};\">${i === 0 ? '' : ''}</span>\n                          <span class=\"time\">${s.time}</span>\n                          <span class=\"availability\">${s.available}/${contactEntries.length}</span>\n                        </div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : '';\n              })()}\n            </div>\n          ` : ''}\n        </div>\n        \n        <!-- Combined Section (only if both exist) -->\n        ${memberEntries.length > 0 && contactEntries.length > 0 ? `\n          <div class=\"golden-card golden-card-mt\">\n            <h4>\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n              </svg>\n              Combined: Team + Contacts\n              <span class=\"count\">${allEntries.length}</span>\n              <span class=\"online-badge\"> ${onlineAll} online</span>\n            </h4>\n            ${renderGoldenSummary(allGolden, allEntries)}\n            \n            <!-- Combined Meeting Suggestions -->\n            ${meetingSuggestions.length > 0 ? `\n              <div class=\"meeting-suggestions\">\n                <h5>\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                  </svg>\n                  Best Times for Everyone\n                </h5>\n                <div class=\"suggestion-list\">\n                  ${meetingSuggestions.map((s, i) => `\n                    <div class=\"suggestion-pill\">\n                      <span class=\"suggestion-star\" style=\"--suggestion-star-color: ${i === 0 ? '#f59e0b' : 'var(--text-muted)'};\">${i === 0 ? '' : ''}</span>\n                      <span class=\"time\">${s.time}</span>\n                      <span class=\"availability\">${s.available}/${allEntries.length}</span>\n                    </div>\n                  `).join('')}\n                </div>\n              </div>\n            ` : ''}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  } catch (error) {\n    console.error('Failed to load golden hours:', error);\n  }\n}\n\n/**\n * Calculate golden hours (9-18 work hours overlap) for a set of timezone entries\n */\nfunction calculateGoldenHours(entries: TimezoneEntry[]): { start: number; end: number } | null {\n  if (entries.length === 0) return null;\n\n  // Get unique timezones\n  const uniqueTimezones = [...new Set(entries.map(e => e.timezone))];\n  \n  if (uniqueTimezones.length === 1) {\n    // All same timezone - work hours are 8-18\n    return { start: 8, end: 18 };\n  }\n\n  // Calculate UTC offsets for each timezone\n  const now = new Date();\n  const offsets: number[] = [];\n\n  for (const tz of uniqueTimezones) {\n    try {\n      const formatter = new Intl.DateTimeFormat('en-US', {\n        timeZone: tz,\n        hour: 'numeric',\n        hour12: false,\n      });\n      const localHour = parseInt(formatter.format(now), 10);\n      const utcHour = now.getUTCHours();\n      let offset = localHour - utcHour;\n      if (offset > 12) offset -= 24;\n      if (offset < -12) offset += 24;\n      offsets.push(offset);\n    } catch {\n      offsets.push(0); // Default to UTC if timezone is invalid\n    }\n  }\n\n  // Find overlap of 8-18 work hours across all timezones\n  // Convert each timezone's work hours to UTC, then find intersection\n  let overlapStart = 0;\n  let overlapEnd = 24;\n\n  for (const offset of offsets) {\n    // Work hours in UTC for this timezone\n    const workStartUtc = (8 - offset + 24) % 24;\n    const workEndUtc = (18 - offset + 24) % 24;\n\n    // Handle wraparound\n    if (workStartUtc < workEndUtc) {\n      overlapStart = Math.max(overlapStart, workStartUtc);\n      overlapEnd = Math.min(overlapEnd, workEndUtc);\n    }\n  }\n\n  if (overlapStart >= overlapEnd) {\n    return null; // No overlap\n  }\n\n  // Convert back to first timezone for display\n  const firstOffset = offsets[0];\n  return {\n    start: (overlapStart + firstOffset + 24) % 24,\n    end: (overlapEnd + firstOffset + 24) % 24,\n  };\n}\n\n/**\n * Render timezone chart showing work hours for each participant\n */\nfunction renderTimezoneChart(entries: TimezoneEntry[], golden: { start: number; end: number } | null): string {\n  // Get unique timezones with count\n  const tzCounts = new Map<string, number>();\n  for (const e of entries) {\n    tzCounts.set(e.timezone, (tzCounts.get(e.timezone) || 0) + 1);\n  }\n\n  const uniqueTzs = [...tzCounts.keys()].slice(0, 5); // Max 5 timezones\n\n  if (uniqueTzs.length === 0) {\n    return '<div class=\"no-overlap\">No timezone data available</div>';\n  }\n\n  const now = new Date();\n\n  return `\n    <div class=\"hour-labels\">\n      ${[0, 6, 12, 18, 24].map(h => `<span class=\"hour-label\">${h}</span>`).join('')}\n    </div>\n    <div class=\"timezone-bars\">\n      ${uniqueTzs.map(tz => {\n        // Calculate work hours position (9-18)\n        let offset = 0;\n        try {\n          const formatter = new Intl.DateTimeFormat('en-US', {\n            timeZone: tz,\n            hour: 'numeric',\n            hour12: false,\n          });\n          const localHour = parseInt(formatter.format(now), 10);\n          const utcHour = now.getUTCHours();\n          offset = localHour - utcHour;\n          if (offset > 12) offset -= 24;\n          if (offset < -12) offset += 24;\n        } catch { /* ignore */ }\n\n        // Work hours 9-18 in this timezone\n        const workStart = 9;\n        const workEnd = 18;\n        const workLeft = ((workStart) / 24) * 100;\n        const workWidth = ((workEnd - workStart) / 24) * 100;\n\n        // Display name\n        const displayTz = tz.split('/').pop()?.replace(/_/g, ' ') || tz;\n        const count = tzCounts.get(tz) || 1;\n\n        return `\n          <div class=\"timezone-row\">\n            <span class=\"tz-name\" title=\"${tz}\">${displayTz} ${count > 1 ? `(${count})` : ''}</span>\n            <div class=\"tz-bar-container\">\n              <div class=\"tz-bar work-hours\" style=\"--tz-left: ${workLeft}%; --tz-width: ${workWidth}%;\"></div>\n              ${golden ? `<div class=\"tz-bar golden\" style=\"--tz-left: ${(golden.start / 24) * 100}%; --tz-width: ${((golden.end - golden.start) / 24) * 100}%;\"></div>` : ''}\n            </div>\n          </div>\n        `;\n      }).join('')}\n    </div>\n  `;\n}\n\n/**\n * Render golden hours summary\n */\nfunction renderGoldenSummary(golden: { start: number; end: number } | null, entries: TimezoneEntry[]): string {\n  if (!golden) {\n    return `\n      <div class=\"golden-summary golden-summary-warning\">\n        <div class=\"golden-icon\"></div>\n        <div class=\"golden-text\">\n          <div class=\"label\">No overlap found</div>\n          <div class=\"hours\">Timezones too far apart</div>\n        </div>\n      </div>\n    `;\n  }\n\n  const formatHour = (h: number) => `${h.toString().padStart(2, '0')}:00`;\n  const duration = golden.end - golden.start;\n\n  // Show participant avatars\n  const maxAvatars = 5;\n  const showEntries = entries.slice(0, maxAvatars);\n  const moreCount = entries.length - maxAvatars;\n\n  return `\n    <div class=\"golden-summary\">\n      <div class=\"golden-icon\"></div>\n      <div class=\"golden-text\">\n        <div class=\"label\">Golden Hours</div>\n        <div class=\"hours\">${formatHour(golden.start)} - ${formatHour(golden.end)} (${duration}h overlap)</div>\n      </div>\n    </div>\n    <div class=\"participants-row\">\n      ${showEntries.map(e => {\n        const initials = e.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n        return `\n          <div class=\"participant-avatar\" title=\"${escapeHtmlSimple(e.name)}\">\n            ${e.avatarUrl ? `<img src=\"${escapeHtmlSimple(e.avatarUrl)}\" alt=\"${escapeHtmlSimple(e.name)}\">` : initials}\n          </div>\n        `;\n      }).join('')}\n      ${moreCount > 0 ? `<div class=\"participant-avatar more\">+${moreCount}</div>` : ''}\n    </div>\n  `;\n}\n\nfunction escapeHtmlSimple(str: string): string {\n  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n// Helper functions\nfunction getInitials(name: string): string {\n  return name\n    .split(/\\s+/)\n    .map(part => part[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2) || '?';\n}\n\nfunction escapeHtml(str: string): string {\n  const div = document.createElement('div');\n  div.textContent = str;\n  return div.innerHTML;\n}\n\n/**\n * Mount dashboard to container\n */\nexport function mountDashboard(selector: string, props: DashboardProps = {}): HTMLElement | null {\n  const container = document.querySelector(selector);\n  if (!container) {\n    console.warn(`Dashboard: Container not found: ${selector}`);\n    return null;\n  }\n\n  const dashboard = createDashboard(props);\n  container.appendChild(dashboard);\n  return dashboard;\n}\n\nexport default createDashboard;\n","/**\r\n * Chat Component\r\n * AI chat interface with multiple sessions, persistence, and contact pills\r\n */\r\n\r\nimport { createElement, on, scrollIntoView } from '../utils/dom';\r\nimport { dataStore, ChatMessage, ChatSource, ChatRAGInfo } from '../stores/data';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\ninterface ChatSession {\r\n  id: string;\r\n  title: string;\r\n  context_contact_id?: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\ninterface ContactOption {\r\n  id: string;\r\n  name: string;\r\n  role?: string;\r\n  organization?: string;\r\n}\r\n\r\ninterface ChatAPIResponse {\r\n  success: boolean;\r\n  response: string;\r\n  sessionId?: string;\r\n  model?: string;\r\n  provider?: string;\r\n  confidence?: 'high' | 'medium' | 'low';\r\n  contextQuality?: string;\r\n  queryType?: string;\r\n  sources?: ChatSource[];\r\n  rag?: ChatRAGInfo;\r\n}\r\n\r\nexport interface ChatProps {\r\n  onSend?: (message: string) => Promise<void>;\r\n  placeholder?: string;\r\n  showSources?: boolean;\r\n  showSessions?: boolean; // Show sidebar with multiple conversations\r\n}\r\n\r\n/**\r\n * Create chat component\r\n */\r\nexport function createChat(props: ChatProps = {}): HTMLElement {\r\n  const showSessions = props.showSessions !== false;\r\n  \r\n  const chat = createElement('div', { className: 'chat-layout' });\r\n\r\n  // State for multiple sessions\r\n  let currentSessionId: string | null = null;\r\n  let sessions: ChatSession[] = [];\r\n  let contacts: ContactOption[] = [];\r\n\r\n  // Sidebar (sessions list)\r\n  const sidebar = createElement('div', { className: 'chat-sidebar' });\r\n  const newChatBtn = createElement('button', { \r\n    className: 'chat-new-conversation',\r\n    innerHTML: `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\"/><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"/></svg> Nova conversa`\r\n  });\r\n  const newChatContextWrap = createElement('div', { className: 'chat-new-context-wrap' });\r\n  const newChatContextLabel = createElement('span', { className: 'chat-new-context-label', textContent: 'Como quem?' });\r\n  const newChatContextSelect = createElement('select', { className: 'chat-new-context-select' }) as HTMLSelectElement;\r\n  newChatContextWrap.appendChild(newChatContextLabel);\r\n  newChatContextWrap.appendChild(newChatContextSelect);\r\n  const sessionsList = createElement('div', { className: 'chat-sessions-list' });\r\n  sidebar.appendChild(newChatBtn);\r\n  sidebar.appendChild(newChatContextWrap);\r\n  sidebar.appendChild(sessionsList);\r\n\r\n  // Main area\r\n  const mainArea = createElement('div', { className: 'chat-main' });\r\n  const chatContainer = createElement('div', { className: 'chat-container' });\r\n\r\n  // Chat header: \"Como quem?\" context selector\r\n  const chatHeader = createElement('div', { className: 'chat-header' });\r\n  const contextLabel = createElement('label', { className: 'chat-context-label', textContent: 'Como quem?' });\r\n  const contextSelect = createElement('select', { className: 'chat-context-select' }) as HTMLSelectElement;\r\n  chatHeader.appendChild(contextLabel);\r\n  chatHeader.appendChild(contextSelect);\r\n\r\n  async function loadContacts(): Promise<void> {\r\n    try {\r\n      const res = await http.get<{ contacts?: Array<{ id: string; name: string; role?: string; organization?: string }> }>('/api/contacts');\r\n      contacts = res.data?.contacts || [];\r\n      renderContextSelect();\r\n    } catch {\r\n      contacts = [];\r\n    }\r\n  }\r\n\r\n  function renderContextSelect(): void {\r\n    const currentSession = sessions.find(s => s.id === currentSessionId);\r\n    const currentContextId = currentSession?.context_contact_id || null;\r\n    contextSelect.innerHTML = `<option value=\"\">Sem contexto</option>${contacts.map(c => `<option value=\"${c.id}\" ${c.id === currentContextId ? 'selected' : ''}>${escapeHtml(c.name)}${c.role ? ` - ${c.role}` : ''}${c.organization ? ` (${c.organization})` : ''}</option>`).join('')}`;\r\n    contextSelect.disabled = !currentSessionId;\r\n  }\r\n\r\n  function renderNewChatContextSelect(): void {\r\n    newChatContextSelect.innerHTML = `<option value=\"\">Sem contexto</option>${contacts.map(c => `<option value=\"${c.id}\">${escapeHtml(c.name)}${c.role ? ` - ${c.role}` : ''}${c.organization ? ` (${c.organization})` : ''}</option>`).join('')}`;\r\n  }\r\n\r\n  async function onContextChange(): Promise<void> {\r\n    if (!currentSessionId) return;\r\n    const contactId = contextSelect.value || null;\r\n    try {\r\n      await http.put(`/api/chat/sessions/${currentSessionId}`, { contextContactId: contactId });\r\n      const idx = sessions.findIndex(s => s.id === currentSessionId);\r\n      if (idx !== -1) sessions[idx] = { ...sessions[idx], context_contact_id: contactId };\r\n      toast.success('Contexto actualizado');\r\n    } catch (e) {\r\n      toast.error('Falha ao actualizar contexto');\r\n      console.error('[Chat] Update context error:', e);\r\n      renderContextSelect();\r\n    }\r\n  }\r\n\r\n  // Messages container\r\n  const messagesContainer = createElement('div', { className: 'chat-messages' });\r\n\r\n  // Input container\r\n  const inputContainer = createElement('div', { className: 'chat-input-container' });\r\n\r\n  const input = createElement('textarea', {\r\n    className: 'chat-input',\r\n    placeholder: props.placeholder || 'Ask a question about your project...',\r\n  }) as HTMLTextAreaElement;\r\n\r\n  const sendBtn = createElement('button', {\r\n    className: 'chat-send-btn',\r\n    innerHTML: `<svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n      <path d=\"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z\"/>\r\n    </svg>`,\r\n  });\r\n\r\n  // Auto-resize textarea\r\n  on(input, 'input', () => {\r\n    input.style.height = 'auto';\r\n    input.style.height = Math.min(input.scrollHeight, 120) + 'px';\r\n  });\r\n\r\n  // Send on Enter (Shift+Enter for new line)\r\n  on(input, 'keydown', (e) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSend();\r\n    }\r\n  });\r\n\r\n  // Send button click\r\n  on(sendBtn, 'click', handleSend);\r\n\r\n  let isLoading = false;\r\n\r\n  async function loadSessions(): Promise<void> {\r\n    try {\r\n      const res = await http.get<{ ok: boolean; sessions?: ChatSession[] }>('/api/chat/sessions');\r\n      sessions = res.data?.sessions || [];\r\n      renderSessionsList();\r\n    } catch {\r\n      sessions = [];\r\n    }\r\n  }\r\n\r\n  function renderSessionsList(): void {\r\n    sessionsList.innerHTML = sessions.map(s => `\r\n      <button class=\"chat-session-item ${s.id === currentSessionId ? 'active' : ''}\" data-session-id=\"${s.id}\">\r\n        <span class=\"session-title\">${escapeHtml(s.title.length > 40 ? s.title.substring(0, 37) + '...' : s.title)}</span>\r\n        <span class=\"session-date\">${formatRelativeTime(s.updated_at)}</span>\r\n      </button>\r\n    `).join('');\r\n    sessionsList.querySelectorAll('.chat-session-item').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => selectSession((btn as HTMLElement).getAttribute('data-session-id')!));\r\n    });\r\n  }\r\n\r\n  async function loadMessages(sessionId: string): Promise<void> {\r\n    try {\r\n      const res = await http.get<{ ok: boolean; messages?: Array<{ id: string; role: string; content: string; sources?: ChatSource[]; metadata?: Record<string, unknown>; created_at: string }> }>(`/api/chat/sessions/${sessionId}/messages`);\r\n      const msgs = res.data?.messages || [];\r\n      dataStore.setChatHistory(msgs.map(m => ({\r\n        id: m.id,\r\n        role: m.role as 'user' | 'assistant' | 'system',\r\n        content: m.content,\r\n        timestamp: m.created_at,\r\n        sources: m.sources,\r\n        ...(m.metadata?.queryType && { queryType: m.metadata.queryType as string }),\r\n        ...(m.metadata?.confidence && { confidence: m.metadata.confidence as 'high' | 'medium' | 'low' })\r\n      })));\r\n    } catch {\r\n      dataStore.setChatHistory([]);\r\n    }\r\n  }\r\n\r\n  async function selectSession(sessionId: string): Promise<void> {\r\n    currentSessionId = sessionId;\r\n    renderSessionsList();\r\n    dataStore.clearChatHistory();\r\n    await loadMessages(sessionId);\r\n    messagesContainer.innerHTML = '';\r\n    dataStore.getState().chatHistory.forEach(msg => renderMessage(msg, messagesContainer, props.showSources));\r\n  }\r\n\r\n  async function createNewSession(contextContactId?: string | null): Promise<void> {\r\n    try {\r\n      const res = await http.post<{ ok: boolean; session?: { id: string; title?: string; context_contact_id?: string | null; created_at?: string; updated_at?: string } }>('/api/chat/sessions', { title: 'Nova conversa', contextContactId: contextContactId || null });\r\n      const session = res.data?.session;\r\n      if (session) {\r\n        sessions.unshift({\r\n          id: session.id,\r\n          title: session.title || 'Nova conversa',\r\n          context_contact_id: session.context_contact_id ?? null,\r\n          created_at: session.created_at || new Date().toISOString(),\r\n          updated_at: session.updated_at || new Date().toISOString()\r\n        });\r\n        await selectSession(session.id);\r\n        renderSessionsList();\r\n      }\r\n    } catch (e) {\r\n      toast.error('Failed to create new conversation');\r\n      console.error('[Chat] Create session error:', e);\r\n    }\r\n  }\r\n\r\n  async function handleSend(): Promise<void> {\r\n    const message = input.value.trim();\r\n    if (!message || isLoading) return;\r\n\r\n    input.value = '';\r\n    input.style.height = 'auto';\r\n    isLoading = true;\r\n    sendBtn.setAttribute('disabled', 'true');\r\n\r\n    // Add user message\r\n    const userMessage: ChatMessage = {\r\n      id: `msg-${Date.now()}`,\r\n      role: 'user',\r\n      content: message,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n    dataStore.addChatMessage(userMessage);\r\n    renderMessage(userMessage, messagesContainer);\r\n\r\n    // Show loading\r\n    const loadingEl = createElement('div', { className: 'chat-loading' });\r\n    loadingEl.innerHTML = `\r\n      <div class=\"chat-loading-dots\">\r\n        <span></span><span></span><span></span>\r\n      </div>\r\n      <span>Thinking...</span>\r\n    `;\r\n    messagesContainer.appendChild(loadingEl);\r\n    scrollToBottom(messagesContainer);\r\n\r\n    try {\r\n      if (props.onSend) {\r\n        await props.onSend(message);\r\n      } else {\r\n        const response = await http.post<ChatAPIResponse>('/api/chat', {\r\n          message,\r\n          history: dataStore.getState().chatHistory.slice(-10),\r\n          sessionId: currentSessionId,\r\n        });\r\n\r\n        const assistantMessage: ChatMessage = {\r\n          id: `msg-${Date.now()}`,\r\n          role: 'assistant',\r\n          content: response.data.response,\r\n          timestamp: new Date().toISOString(),\r\n          sources: response.data.sources,\r\n          queryType: response.data.queryType,\r\n          confidence: response.data.confidence,\r\n          contextQuality: response.data.contextQuality,\r\n          rag: response.data.rag,\r\n        };\r\n        dataStore.addChatMessage(assistantMessage);\r\n        renderMessage(assistantMessage, messagesContainer, props.showSources);\r\n\r\n        // Update current session if backend created one\r\n        if (response.data.sessionId && !currentSessionId) {\r\n          currentSessionId = response.data.sessionId;\r\n          await loadSessions();\r\n          renderSessionsList();\r\n          renderContextSelect();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      const errorMessage: ChatMessage = {\r\n        id: `msg-${Date.now()}`,\r\n        role: 'system',\r\n        content: 'Failed to get response. Please try again.',\r\n        timestamp: new Date().toISOString(),\r\n      };\r\n      renderMessage(errorMessage, messagesContainer);\r\n    } finally {\r\n      loadingEl.remove();\r\n      isLoading = false;\r\n      sendBtn.removeAttribute('disabled');\r\n      input.focus();\r\n    }\r\n  }\r\n\r\n  inputContainer.appendChild(input);\r\n  inputContainer.appendChild(sendBtn);\r\n\r\n  // Quick prompts\r\n  const quickPrompts = createElement('div', { className: 'quick-prompts' });\r\n  const prompts = [\r\n    'Summarize key risks',\r\n    'List open questions',\r\n    'What actions are overdue?',\r\n    'Who are the key contacts?',\r\n  ];\r\n\r\n  prompts.forEach(prompt => {\r\n    const btn = createElement('button', {\r\n      className: 'quick-prompt',\r\n      textContent: prompt,\r\n    });\r\n    on(btn, 'click', () => {\r\n      input.value = prompt;\r\n      handleSend();\r\n    });\r\n    quickPrompts.appendChild(btn);\r\n  });\r\n\r\n  // Layout assembly\r\n  on(contextSelect, 'change', onContextChange);\r\n  chatContainer.appendChild(chatHeader);\r\n  chatContainer.appendChild(messagesContainer);\r\n  chatContainer.appendChild(quickPrompts);\r\n  chatContainer.appendChild(inputContainer);\r\n  mainArea.appendChild(chatContainer);\r\n\r\n  if (showSessions) {\r\n    chat.appendChild(sidebar);\r\n    on(newChatBtn as HTMLElement, 'click', createNewSession);\r\n    loadContacts().then(() => renderNewChatContextSelect());\r\n    loadSessions();\r\n  } else {\r\n    chatHeader.classList.add('hidden');\r\n  }\r\n  chat.appendChild(mainArea);\r\n\r\n  // Render existing messages (from dataStore - may be empty initially)\r\n  const existingMessages = dataStore.getState().chatHistory;\r\n  existingMessages.forEach(msg => renderMessage(msg, messagesContainer, props.showSources));\r\n\r\n  return chat;\r\n}\r\n\r\n/**\r\n * Render a chat message with SOTA RAG info\r\n */\r\nfunction renderMessage(\r\n  message: ChatMessage,\r\n  container: HTMLElement,\r\n  showSources = true\r\n): HTMLElement {\r\n  const msgEl = createElement('div', {\r\n    className: `chat-message ${message.role}`,\r\n  });\r\n\r\n  let content = escapeHtml(message.content);\r\n\r\n  // Parse markdown-like formatting\r\n  content = content\r\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\r\n    .replace(/`(.*?)`/g, '<code>$1</code>')\r\n    .replace(/\\n/g, '<br>');\r\n\r\n  msgEl.innerHTML = `<div class=\"chat-message-content\">${content}</div>`;\r\n\r\n  // Add RAG metadata badge for assistant messages\r\n  if (message.role === 'assistant' && (message.confidence || message.rag)) {\r\n    const metaEl = createElement('div', { className: 'chat-meta' });\r\n    const confidenceClass = message.confidence === 'high' ? 'confidence-high' : \r\n                            message.confidence === 'medium' ? 'confidence-medium' : 'confidence-low';\r\n    \r\n    let metaHtml = '';\r\n    \r\n    // Confidence badge\r\n    if (message.confidence) {\r\n      metaHtml += `<span class=\"chat-badge ${confidenceClass}\" title=\"Confidence level\">${message.confidence}</span>`;\r\n    }\r\n    \r\n    // Query type badge\r\n    if (message.queryType) {\r\n      metaHtml += `<span class=\"chat-badge query-type\" title=\"Query classification\">${message.queryType}</span>`;\r\n    }\r\n    \r\n    // RAG method badge\r\n    if (message.rag) {\r\n      const methodLabel = message.rag.usedHyDE ? 'HyDE+RRF' : \r\n                          message.rag.graphResults > 0 ? 'Graph+Vector' : 'Hybrid';\r\n      metaHtml += `<span class=\"chat-badge rag-method\" title=\"RAG method: ${message.rag.method}\">${methodLabel}</span>`;\r\n      \r\n      // Sources count\r\n      const totalSources = message.rag.fusedResults || (message.rag.vectorResults + message.rag.graphResults);\r\n      if (totalSources > 0) {\r\n        metaHtml += `<span class=\"chat-badge sources-count\" title=\"Sources found\">${totalSources} sources</span>`;\r\n      }\r\n    }\r\n    \r\n    metaEl.innerHTML = metaHtml;\r\n    msgEl.appendChild(metaEl);\r\n  }\r\n\r\n  // Add detailed sources if present\r\n  if (showSources && message.sources && message.sources.length > 0) {\r\n    const sourcesEl = createElement('div', { className: 'chat-sources' });\r\n    \r\n    // Handle both string[] (legacy) and ChatSource[] (SOTA) formats\r\n    if (typeof message.sources[0] === 'string') {\r\n      // Legacy format\r\n      sourcesEl.innerHTML = `\r\n        <span class=\"sources-label\">Sources:</span>\r\n        ${(message.sources as string[]).map(s => `<span class=\"source-link\">${escapeHtml(s)}</span>`).join('')}\r\n      `;\r\n    } else {\r\n      // SOTA format with detailed sources and contact pills\r\n      const sources = message.sources as ChatSource[];\r\n      const contactSources = sources.filter(s => s.contactName);\r\n      const otherSources = sources.filter(s => !s.contactName);\r\n      const topSources = otherSources.slice(0, 5);\r\n\r\n      // Contact pills (avatar + name + role)\r\n      if (contactSources.length > 0) {\r\n        const pillsEl = createElement('div', { className: 'chat-contact-pills' });\r\n        pillsEl.innerHTML = contactSources.map(s => `\r\n          <div class=\"contact-pill\">\r\n            ${s.avatarUrl ? `<img class=\"contact-pill-avatar\" src=\"${escapeHtml(s.avatarUrl)}\" alt=\"\" onerror=\"this.classList.add('hidden')\"/>` : `<div class=\"contact-pill-avatar-placeholder\">${escapeHtml((s.contactName || s.type || '?')[0])}</div>`}\r\n            <div class=\"contact-pill-info\">\r\n              <span class=\"contact-pill-name\">${escapeHtml(s.contactName || s.type || 'Contact')}</span>\r\n              ${s.contactRole ? `<span class=\"contact-pill-role\">${escapeHtml(s.contactRole)}</span>` : ''}\r\n            </div>\r\n          </div>\r\n        `).join('');\r\n        msgEl.appendChild(pillsEl);\r\n      }\r\n      \r\n      sourcesEl.innerHTML = `\r\n        <details class=\"sources-details\">\r\n          <summary class=\"sources-label\">\r\n            <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polyline points=\"9 18 15 12 9 6\"></polyline>\r\n            </svg>\r\n            ${sources.length} sources used\r\n          </summary>\r\n          <div class=\"sources-list\">\r\n            ${topSources.map(s => `\r\n              <div class=\"source-item\">\r\n                <span class=\"source-type\">${escapeHtml(s.type || 'unknown')}</span>\r\n                <span class=\"source-score\" title=\"Relevance score\">${Math.round((s.rrfScore || s.score || 0) * 100)}%</span>\r\n                ${s.sourceCount && s.sourceCount > 1 ? `<span class=\"source-multi\" title=\"Found in multiple searches\">x${s.sourceCount}</span>` : ''}\r\n                ${s.source ? `<span class=\"source-from\">${escapeHtml(s.source)}</span>` : ''}\r\n              </div>\r\n            `).join('')}\r\n            ${sources.length > 5 ? `<div class=\"sources-more\">+${sources.length - 5} more</div>` : ''}\r\n          </div>\r\n        </details>\r\n      `;\r\n    }\r\n    msgEl.appendChild(sourcesEl);\r\n  }\r\n\r\n  container.appendChild(msgEl);\r\n  scrollToBottom(container);\r\n\r\n  return msgEl;\r\n}\r\n\r\n/**\r\n * Scroll container to bottom\r\n */\r\nfunction scrollToBottom(container: HTMLElement): void {\r\n  container.scrollTop = container.scrollHeight;\r\n}\r\n\r\n/**\r\n * Escape HTML to prevent XSS\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Mount chat to container\r\n */\r\nexport function mountChat(selector: string, props: ChatProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`Chat: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const chat = createChat(props);\r\n  container.appendChild(chat);\r\n  return chat;\r\n}\r\n\r\nexport default createChat;\r\n","/**\r\n * Question Detail View\r\n * Full-page view for question details, replacing the panel when a card is clicked\r\n * Features: timeline, contact picker, answer suggestions, follow-up chain, entity display\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Question, questionsService } from '../../services/questions';\r\nimport { contactsService, Contact } from '../../services/contacts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\r\nimport { http } from '../../services/api';\r\n\r\nexport interface QuestionDetailViewProps {\r\n  question: Question;\r\n  onClose: () => void;\r\n  onUpdate?: (question: Question) => void;\r\n  onNavigateToQuestion?: (questionId: string) => void;\r\n}\r\n\r\ninterface QuestionChain {\r\n  parent: Question | null;\r\n  children: Question[];\r\n}\r\n\r\ninterface TimelineEvent {\r\n  id: string;\r\n  event_type: string;\r\n  event_data: Record<string, unknown>;\r\n  actor_name?: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface PotentialAnswer {\r\n  type: 'fact' | 'decision';\r\n  id: string;\r\n  content: string;\r\n  confidence: number;\r\n  source?: string;\r\n}\r\n\r\ninterface SimilarQuestion {\r\n  id: string;\r\n  content: string;\r\n  status: string;\r\n  priority: string;\r\n  similarityScore: number;\r\n}\r\n\r\nlet currentQuestion: Question | null = null;\r\nlet contacts: Contact[] = [];\r\n\r\n/**\r\n * Create and show the question detail view\r\n */\r\nexport function createQuestionDetailView(props: QuestionDetailViewProps): HTMLElement {\r\n  const { question, onClose, onUpdate, onNavigateToQuestion } = props;\r\n  currentQuestion = question;\r\n\r\n  const container = createElement('div', { className: 'question-detail-view' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Questions</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Question #${String(question.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        ${question.sla_breached ? '<span class=\"sla-badge breached\">SLA Breached</span>' : ''}\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content\">\r\n      <!-- Main Question Card -->\r\n      <section class=\"detail-section question-main\">\r\n        <div class=\"question-badges\">\r\n          <span class=\"priority-badge priority-${question.priority}\">${question.priority}</span>\r\n          <span class=\"status-badge status-${question.status}\">${question.status}</span>\r\n          ${question.requester_role ? `\r\n            <div class=\"requester-badge-full\" title=\"Question from the perspective of this role\">\r\n              <div class=\"requester-avatar-sm\">${getInitials((question as any).requester_name || question.requester_role)}</div>\r\n              <div class=\"requester-text\">\r\n                ${(question as any).requester_name ? `<span class=\"requester-name-sm\">${escapeHtml((question as any).requester_name)}</span>` : ''}\r\n                <span class=\"requester-role-sm\">${escapeHtml(question.requester_role)}</span>\r\n              </div>\r\n            </div>\r\n          ` : ''}\r\n          <span class=\"question-date\">Created ${formatRelativeTime(question.created_at)}</span>\r\n        </div>\r\n        <h2 class=\"question-text\">${escapeHtml(question.content)}</h2>\r\n        ${question.context ? `<p class=\"question-context\">${escapeHtml(question.context)}</p>` : ''}\r\n        ${renderEntities(question)}\r\n      </section>\r\n\r\n      <!-- Two-column layout -->\r\n      <div class=\"detail-columns\">\r\n        <div class=\"detail-column-left\">\r\n          <!-- Assignment Section - SOTA Design -->\r\n          <section class=\"detail-section\" id=\"assignment-section\">\r\n            <div class=\"section-header-sota\">\r\n              <h3>\r\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Assignment\r\n                <span class=\"section-subtitle\">Who should answer this question?</span>\r\n              </h3>\r\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"ai-suggest-btn\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n                </svg>\r\n                AI Suggest\r\n              </button>\r\n            </div>\r\n            \r\n            <!-- Current Assignment Display -->\r\n            <div id=\"current-assignment\" class=\"current-assignment-card\">\r\n              ${question.assigned_to ? `\r\n                <div class=\"assigned-contact-display\">\r\n                  <div class=\"contact-avatar-lg\" id=\"assigned-avatar\">\r\n                    ${getInitials(question.assigned_to)}\r\n                  </div>\r\n                  <div class=\"contact-details\">\r\n                    <div class=\"contact-name-lg\">${escapeHtml(question.assigned_to)}</div>\r\n                    <div class=\"contact-role-sm\" id=\"assigned-role\">Loading...</div>\r\n                  </div>\r\n                  <button class=\"btn-change-assignment\" id=\"change-assignee-btn\">\r\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/>\r\n                    </svg>\r\n                    Change\r\n                  </button>\r\n                </div>\r\n              ` : `\r\n                <div class=\"no-assignment\">\r\n                  <div class=\"no-assignment-icon\">\r\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\r\n                    </svg>\r\n                  </div>\r\n                  <span>No one assigned to answer</span>\r\n                  <p class=\"no-assignment-hint\">Use AI Suggest to find the best person</p>\r\n                  <button class=\"btn-assign-now\" id=\"show-picker-btn\">Choose Manually</button>\r\n                </div>\r\n              `}\r\n            </div>\r\n            \r\n            <!-- Contact Picker (hidden by default) -->\r\n            <div id=\"contact-picker\" class=\"contact-picker-sota hidden\">\r\n              <div class=\"picker-search\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/>\r\n                </svg>\r\n                <input type=\"text\" id=\"contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"contact-list\" class=\"contact-list-grid\">\r\n                <div class=\"loading\">Loading contacts...</div>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- Hidden select for form submission -->\r\n            <select id=\"assignee-select\" class=\"form-select hidden\">\r\n              <option value=\"\">Select contact...</option>\r\n            </select>\r\n            \r\n            <!-- AI Suggestions Panel -->\r\n            <div id=\"suggestions-panel\" class=\"suggestions-panel-sota hidden\"></div>\r\n          </section>\r\n\r\n          <!-- Potential Answers Section -->\r\n          <section class=\"detail-section\" id=\"answers-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Potential Answers</h3>\r\n              <button class=\"btn btn-secondary btn-sm\" id=\"check-answers-btn\">\r\n                Check Knowledge Base\r\n              </button>\r\n            </div>\r\n            <div id=\"potential-answers\" class=\"potential-answers\">\r\n              <p class=\"empty-state\">Click \"Check Knowledge Base\" to find potential answers</p>\r\n            </div>\r\n          </section>\r\n\r\n          <!-- Answer Form Section -->\r\n          <section class=\"detail-section\" id=\"answer-section\">\r\n            <h3>${question.answer ? 'Current Answer' : 'Your Answer'}</h3>\r\n            ${question.answer ? renderExistingAnswer(question) : ''}\r\n            <div class=\"answer-form ${question.status === 'resolved' ? 'hidden' : ''}\">\r\n              <div class=\"form-group\">\r\n                <textarea id=\"answer-input\" rows=\"4\" \r\n                  placeholder=\"Type your answer here...\">${question.answer || ''}</textarea>\r\n              </div>\r\n              <div class=\"form-row answer-form-row\">\r\n                <div class=\"form-group source-group\">\r\n                  <label>Source</label>\r\n                  <div class=\"source-options\">\r\n                    <label class=\"source-option ${question.answer_source === 'manual' || !question.answer_source ? 'active' : ''}\">\r\n                      <input type=\"radio\" name=\"answer-source\" value=\"manual\" ${question.answer_source === 'manual' || !question.answer_source ? 'checked' : ''}>\r\n                      <span class=\"source-icon\"></span>\r\n                      <span class=\"source-label\">Manual</span>\r\n                    </label>\r\n                    <label class=\"source-option ${question.answer_source === 'document' ? 'active' : ''}\">\r\n                      <input type=\"radio\" name=\"answer-source\" value=\"document\" ${question.answer_source === 'document' ? 'checked' : ''}>\r\n                      <span class=\"source-icon\"></span>\r\n                      <span class=\"source-label\">Document</span>\r\n                    </label>\r\n                    <label class=\"source-option ${question.answer_source === 'ai' ? 'active' : ''}\">\r\n                      <input type=\"radio\" name=\"answer-source\" value=\"ai\" ${question.answer_source === 'ai' ? 'checked' : ''}>\r\n                      <span class=\"source-icon\"></span>\r\n                      <span class=\"source-label\">AI</span>\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n                <div class=\"form-group answered-by-group\">\r\n                  <label>Answered By</label>\r\n                  <div class=\"answered-by-picker\">\r\n                    <div id=\"answered-by-display\" class=\"answered-by-display\">\r\n                      ${question.answered_by_contact_id || question.answered_by_name ? `\r\n                        <div class=\"answered-by-card\" id=\"current-answerer\">\r\n                          <div class=\"answerer-avatar\" id=\"answerer-avatar\">${getInitials(question.answered_by_name || '')}</div>\r\n                          <span class=\"answerer-name\">${escapeHtml(question.answered_by_name || 'Contact')}</span>\r\n                          <button type=\"button\" class=\"btn-clear-answerer\" id=\"clear-answerer\"></button>\r\n                        </div>\r\n                      ` : `\r\n                        <button type=\"button\" class=\"btn-select-answerer\" id=\"show-answerer-picker\">\r\n                          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                          </svg>\r\n                          Select who answered...\r\n                        </button>\r\n                      `}\r\n                    </div>\r\n                    <!-- Hidden select for form -->\r\n                    <select id=\"answered-by-contact\" class=\"form-select hidden\">\r\n                      <option value=\"\">Select who answered...</option>\r\n                    </select>\r\n                    <!-- Contact picker dropdown -->\r\n                    <div id=\"answerer-picker-dropdown\" class=\"answerer-picker-dropdown hidden\">\r\n                      <div class=\"picker-search-sm\">\r\n                        <input type=\"text\" id=\"answerer-search\" placeholder=\"Search contacts...\">\r\n                      </div>\r\n                      <div id=\"answerer-list\" class=\"answerer-list\"></div>\r\n                      <div class=\"answerer-other\">\r\n                        <input type=\"text\" id=\"answerer-other-name\" placeholder=\"Or type a name...\">\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"form-group\">\r\n                <label>Follow-up Questions (one per line)</label>\r\n                <textarea id=\"followup-input\" rows=\"2\" \r\n                  placeholder=\"Add any follow-up questions...\"></textarea>\r\n              </div>\r\n              <div class=\"form-actions\">\r\n                <button class=\"btn btn-primary\" id=\"save-answer-btn\">\r\n                  ${question.answer ? 'Update Answer' : 'Save Answer'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </section>\r\n        </div>\r\n\r\n        <div class=\"detail-column-right\">\r\n          <!-- Follow-up Chain Section -->\r\n          <section class=\"detail-section\" id=\"chain-section\">\r\n            <h3>Follow-up Chain</h3>\r\n            <div id=\"chain-content\" class=\"chain-content\">\r\n              <div class=\"loading\">Loading...</div>\r\n            </div>\r\n          </section>\r\n\r\n          <!-- Similar Questions Section -->\r\n          <section class=\"detail-section\" id=\"similar-section\">\r\n            <h3>Similar Questions</h3>\r\n            <div id=\"similar-content\" class=\"similar-content\">\r\n              <div class=\"loading\">Loading...</div>\r\n            </div>\r\n          </section>\r\n\r\n          <!-- Timeline Section -->\r\n          <section class=\"detail-section\" id=\"timeline-section\">\r\n            <h3>Timeline</h3>\r\n            <div id=\"timeline-content\" class=\"timeline-content\">\r\n              <div class=\"loading\">Loading...</div>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n\r\n    <!-- Actions Bar - Outside scrollable content for proper click handling -->\r\n    <div class=\"detail-actions\">\r\n      ${question.status === 'resolved' || question.status === 'dismissed' ? `\r\n        <button class=\"btn btn-warning\" id=\"reopen-btn\">Reopen</button>\r\n      ` : ''}\r\n      ${question.status === 'deferred' ? `\r\n        <button class=\"btn btn-info\" id=\"undefer-btn\">Resume Now</button>\r\n      ` : `\r\n        <button class=\"btn btn-secondary\" id=\"defer-btn\">Defer</button>\r\n      `}\r\n      ${question.was_useful === undefined && question.answer ? `\r\n        <div class=\"feedback-buttons\">\r\n          <span class=\"feedback-label\">Was this helpful?</span>\r\n          <button class=\"btn btn-sm btn-success\" id=\"feedback-yes\">Yes</button>\r\n          <button class=\"btn btn-sm btn-secondary\" id=\"feedback-no\">No</button>\r\n        </div>\r\n      ` : ''}\r\n      <button class=\"btn btn-secondary\" id=\"edit-btn\">Edit</button>\r\n      <div class=\"dropdown dismiss-dropdown\">\r\n        <button class=\"btn btn-danger\" id=\"dismiss-btn\">Dismiss </button>\r\n        <div class=\"dropdown-menu\" id=\"dismiss-menu\">\r\n          <a href=\"#\" data-reason=\"duplicate\">Duplicate</a>\r\n          <a href=\"#\" data-reason=\"not_relevant\">Not Relevant</a>\r\n          <a href=\"#\" data-reason=\"out_of_scope\">Out of Scope</a>\r\n          <a href=\"#\" data-reason=\"answered_elsewhere\">Answered Elsewhere</a>\r\n          <a href=\"#\" data-reason=\"no_longer_needed\">No Longer Needed</a>\r\n          <a href=\"#\" data-reason=\"other\">Other...</a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  bindEvents(container, props);\r\n\r\n  // Load async data\r\n  loadContacts(container);\r\n  loadChain(container, question.id, onNavigateToQuestion);\r\n  loadSimilar(container, question.id, onNavigateToQuestion);\r\n  loadTimeline(container, question.id);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Render extracted entities as tags\r\n */\r\nfunction renderEntities(question: Question): string {\r\n  const entities = question.extracted_entities || [];\r\n  const topics = question.extracted_topics || [];\r\n  \r\n  if (entities.length === 0 && topics.length === 0) {\r\n    return '';\r\n  }\r\n\r\n  const tags = [\r\n    ...entities.map(e => `<span class=\"entity-tag entity-${e.type}\">@${e.name}</span>`),\r\n    ...topics.map(t => `<span class=\"entity-tag entity-topic\">#${t.name}</span>`)\r\n  ];\r\n\r\n  return `<div class=\"question-entities\">${tags.join('')}</div>`;\r\n}\r\n\r\n/**\r\n * Get initials from name\r\n */\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  if (parts.length === 1) {\r\n    return parts[0].substring(0, 2).toUpperCase();\r\n  }\r\n  return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\n/**\r\n * Get avatar HTML for a contact\r\n */\r\nfunction getContactAvatar(contact: { name: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string }): string {\r\n  const photoUrl = contact.photoUrl || contact.avatarUrl || contact.photo_url || contact.avatar_url;\r\n  if (photoUrl) {\r\n    return `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\" onerror=\"this.classList.add('gm-none'); this.nextElementSibling.classList.remove('gm-none'); this.nextElementSibling.classList.add('gm-flex');\">\r\n            <span class=\"avatar-fallback gm-none\">${getInitials(contact.name)}</span>`;\r\n  }\r\n  return getInitials(contact.name);\r\n}\r\n\r\n/**\r\n * Get score color based on value\r\n */\r\nfunction getScoreColor(score: number): string {\r\n  if (score >= 75) return '#10b981'; // green\r\n  if (score >= 50) return '#f59e0b'; // amber\r\n  return '#6b7280'; // gray\r\n}\r\n\r\n/**\r\n * Render existing answer display\r\n */\r\nfunction renderExistingAnswer(question: Question): string {\r\n  if (!question.answer) return '';\r\n\r\n  return `\r\n    <div class=\"existing-answer\">\r\n      <div class=\"answer-text\">${escapeHtml(question.answer)}</div>\r\n      <div class=\"answer-meta\">\r\n        <span class=\"answer-source-badge\">${question.answer_source || 'manual'}</span>\r\n        ${question.answered_by_name ? `<span class=\"answered-by\">by ${escapeHtml(question.answered_by_name)}</span>` : ''}\r\n        ${question.answered_at ? `<span class=\"answered-date\">${formatRelativeTime(question.answered_at)}</span>` : ''}\r\n      </div>\r\n      ${question.answer_provenance ? renderProvenance(question.answer_provenance) : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render answer provenance chain\r\n */\r\nfunction renderProvenance(provenance: { sources?: Array<{ type: string; content: string; confidence: number }> }): string {\r\n  if (!provenance.sources || provenance.sources.length === 0) return '';\r\n\r\n  const sources = provenance.sources.map(s => `\r\n    <div class=\"provenance-source\">\r\n      <span class=\"source-type\">${s.type}</span>\r\n      <span class=\"source-content\">${escapeHtml(s.content.substring(0, 100))}...</span>\r\n      <span class=\"source-confidence\">${Math.round(s.confidence * 100)}%</span>\r\n    </div>\r\n  `).join('');\r\n\r\n  return `\r\n    <div class=\"answer-provenance\">\r\n      <div class=\"provenance-label\">Sources:</div>\r\n      ${sources}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind all event handlers\r\n */\r\nfunction bindEvents(container: HTMLElement, props: QuestionDetailViewProps): void {\r\n  const { onClose, onUpdate } = props;\r\n\r\n  // Close button\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  // Back to list link\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n\r\n  // AI Suggest button\r\n  const aiSuggestBtn = container.querySelector('#ai-suggest-btn');\r\n  if (aiSuggestBtn) {\r\n    on(aiSuggestBtn as HTMLElement, 'click', () => loadAISuggestions(container));\r\n  }\r\n\r\n  // Check answers button\r\n  const checkAnswersBtn = container.querySelector('#check-answers-btn');\r\n  if (checkAnswersBtn) {\r\n    on(checkAnswersBtn as HTMLElement, 'click', () => checkPotentialAnswers(container));\r\n  }\r\n\r\n  // Save answer button\r\n  const saveAnswerBtn = container.querySelector('#save-answer-btn');\r\n  if (saveAnswerBtn) {\r\n    on(saveAnswerBtn as HTMLElement, 'click', () => saveAnswer(container, onUpdate));\r\n  }\r\n\r\n  // Reopen button\r\n  const reopenBtn = container.querySelector('#reopen-btn');\r\n  if (reopenBtn) {\r\n    on(reopenBtn as HTMLElement, 'click', () => reopenQuestion(container, onUpdate));\r\n  }\r\n\r\n  // Dismiss button and dropdown\r\n  const dismissBtn = container.querySelector('#dismiss-btn');\r\n  const dismissMenu = container.querySelector('#dismiss-menu');\r\n  console.log('[QuestionDetail] Dismiss btn found:', !!dismissBtn, 'Menu found:', !!dismissMenu);\r\n  \r\n  if (dismissBtn && dismissMenu) {\r\n    on(dismissBtn as HTMLElement, 'click', (e) => {\r\n      console.log('[QuestionDetail] Dismiss button clicked');\r\n      e.stopPropagation();\r\n      dismissMenu.classList.toggle('show');\r\n    });\r\n    \r\n    // Dismiss reasons\r\n    const reasonLinks = dismissMenu.querySelectorAll('a[data-reason]');\r\n    console.log('[QuestionDetail] Dismiss reason links:', reasonLinks.length);\r\n    \r\n    reasonLinks.forEach(link => {\r\n      on(link as HTMLElement, 'click', async (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const reason = link.getAttribute('data-reason') as 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other';\r\n        console.log('[QuestionDetail] Dismiss reason clicked:', reason);\r\n        dismissMenu.classList.remove('show');\r\n        \r\n        let details: string | undefined;\r\n        if (reason === 'other') {\r\n          details = prompt('Please provide a reason for dismissing this question:') || undefined;\r\n          if (!details) return;\r\n        }\r\n        \r\n        try {\r\n          console.log('[QuestionDetail] Calling dismissQuestionWithReason...');\r\n          await dismissQuestionWithReason(container, props, reason, details);\r\n          console.log('[QuestionDetail] Dismiss completed');\r\n        } catch (err) {\r\n          console.error('[QuestionDetail] Dismiss error:', err);\r\n        }\r\n      });\r\n    });\r\n    \r\n    // Close dropdown on outside click\r\n    document.addEventListener('click', (e) => {\r\n      if (!(e.target as HTMLElement).closest('.dismiss-dropdown')) {\r\n        dismissMenu.classList.remove('show');\r\n      }\r\n    });\r\n  } else {\r\n    console.warn('[QuestionDetail] Dismiss button or menu not found!');\r\n  }\r\n\r\n  // Defer button\r\n  const deferBtn = container.querySelector('#defer-btn');\r\n  if (deferBtn) {\r\n    on(deferBtn as HTMLElement, 'click', () => showDeferDialog(container, onUpdate));\r\n  }\r\n\r\n  // Undefer button\r\n  const undeferBtn = container.querySelector('#undefer-btn');\r\n  if (undeferBtn) {\r\n    on(undeferBtn as HTMLElement, 'click', () => reopenQuestion(container, onUpdate));\r\n  }\r\n\r\n  // Feedback buttons\r\n  const feedbackYes = container.querySelector('#feedback-yes');\r\n  const feedbackNo = container.querySelector('#feedback-no');\r\n  if (feedbackYes) {\r\n    on(feedbackYes as HTMLElement, 'click', () => submitFeedback(container, true, onUpdate));\r\n  }\r\n  if (feedbackNo) {\r\n    on(feedbackNo as HTMLElement, 'click', () => submitFeedback(container, false, onUpdate));\r\n  }\r\n\r\n  // Edit button\r\n  const editBtn = container.querySelector('#edit-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => toggleEditMode(container));\r\n  }\r\n}\r\n\r\n/**\r\n * Load contacts for dropdowns\r\n */\r\nasync function loadContacts(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await contactsService.getAll();\r\n    contacts = response?.contacts || [];\r\n    \r\n    const assigneeSelect = container.querySelector('#assignee-select') as HTMLSelectElement;\r\n    const answeredBySelect = container.querySelector('#answered-by-contact') as HTMLSelectElement;\r\n    const contactList = container.querySelector('#contact-list') as HTMLElement;\r\n    const contactSearch = container.querySelector('#contact-search') as HTMLInputElement;\r\n\r\n    // Populate hidden select for form\r\n    if (assigneeSelect) {\r\n      for (const contact of contacts) {\r\n        const option = document.createElement('option');\r\n        option.value = contact.id;\r\n        option.textContent = `${contact.name}${contact.role ? ` (${contact.role})` : ''}`;\r\n        if (currentQuestion?.assigned_to === contact.name) {\r\n          option.selected = true;\r\n        }\r\n        assigneeSelect.appendChild(option);\r\n      }\r\n    }\r\n\r\n    // Populate answered by select\r\n    if (answeredBySelect) {\r\n      for (const contact of contacts) {\r\n        const option = document.createElement('option');\r\n        option.value = contact.id;\r\n        option.textContent = `${contact.name}${contact.role ? ` (${contact.role})` : ''}`;\r\n        if (currentQuestion?.answered_by_contact_id === contact.id) {\r\n          option.selected = true;\r\n        }\r\n        answeredBySelect.appendChild(option);\r\n      }\r\n      \r\n      // Add \"Other\" option for external\r\n      const otherOption = document.createElement('option');\r\n      otherOption.value = '__other__';\r\n      otherOption.textContent = '+ Other (type name)';\r\n      answeredBySelect.appendChild(otherOption);\r\n    }\r\n\r\n    // Render SOTA contact picker grid\r\n    if (contactList) {\r\n      renderContactGrid(container, contacts);\r\n      \r\n      // Bind search\r\n      if (contactSearch) {\r\n        contactSearch.addEventListener('input', () => {\r\n          const query = contactSearch.value.toLowerCase();\r\n          const filtered = contacts.filter(c => \r\n            c.name.toLowerCase().includes(query) ||\r\n            (c.role && c.role.toLowerCase().includes(query)) ||\r\n            (c.organization && c.organization.toLowerCase().includes(query))\r\n          );\r\n          renderContactGrid(container, filtered);\r\n        });\r\n      }\r\n    }\r\n    \r\n    // Update assigned contact avatar display\r\n    updateAssignedDisplay(container);\r\n    \r\n    // Bind picker toggle buttons\r\n    bindPickerButtons(container);\r\n    \r\n    // Setup answerer picker\r\n    setupAnswererPicker(container);\r\n    \r\n    // Setup source options\r\n    setupSourceOptions(container);\r\n    \r\n  } catch (e) {\r\n    console.error('Error loading contacts:', e);\r\n  }\r\n}\r\n\r\n/**\r\n * Setup the answerer picker functionality\r\n */\r\nfunction setupAnswererPicker(container: HTMLElement): void {\r\n  const showBtn = container.querySelector('#show-answerer-picker');\r\n  const dropdown = container.querySelector('#answerer-picker-dropdown') as HTMLElement;\r\n  const answererList = container.querySelector('#answerer-list') as HTMLElement;\r\n  const answererSearch = container.querySelector('#answerer-search') as HTMLInputElement;\r\n  const answererOtherInput = container.querySelector('#answerer-other-name') as HTMLInputElement;\r\n  \r\n  if (!dropdown || !answererList) return;\r\n  \r\n  // Render contacts in answerer list\r\n  const renderAnswererList = (filter = '') => {\r\n    const filtered = filter \r\n      ? contacts.filter(c => \r\n          c.name.toLowerCase().includes(filter.toLowerCase()) ||\r\n          (c.role && c.role.toLowerCase().includes(filter.toLowerCase()))\r\n        )\r\n      : contacts;\r\n    \r\n    answererList.innerHTML = filtered.map(contact => {\r\n      const photoUrl = contact.photoUrl || contact.avatarUrl || contact.photo_url || contact.avatar_url;\r\n      return `\r\n        <div class=\"answerer-item\" data-contact-id=\"${contact.id}\" data-contact-name=\"${escapeHtml(contact.name)}\">\r\n          <div class=\"answerer-avatar-sm\">\r\n            ${photoUrl \r\n              ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(contact.name)}'\">`\r\n              : getInitials(contact.name)\r\n            }\r\n          </div>\r\n          <div class=\"answerer-info\">\r\n            <span class=\"answerer-name\">${escapeHtml(contact.name)}</span>\r\n            ${contact.role ? `<span class=\"answerer-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n    \r\n    // Bind click handlers\r\n    answererList.querySelectorAll('.answerer-item').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        const contactId = item.getAttribute('data-contact-id');\r\n        const contactName = item.getAttribute('data-contact-name');\r\n        selectAnswerer(container, contactId || '', contactName || '');\r\n        dropdown.classList.add('hidden');\r\n      });\r\n    });\r\n  };\r\n  \r\n  // Show picker\r\n  if (showBtn) {\r\n    on(showBtn as HTMLElement, 'click', () => {\r\n      dropdown.classList.toggle('hidden');\r\n      renderAnswererList();\r\n      if (answererSearch) answererSearch.focus();\r\n    });\r\n  }\r\n  \r\n  // Search filter\r\n  if (answererSearch) {\r\n    answererSearch.addEventListener('input', () => {\r\n      renderAnswererList(answererSearch.value);\r\n    });\r\n  }\r\n  \r\n  // Other name input\r\n  if (answererOtherInput) {\r\n    answererOtherInput.addEventListener('keypress', (e) => {\r\n      if (e.key === 'Enter') {\r\n        const name = answererOtherInput.value.trim();\r\n        if (name) {\r\n          selectAnswerer(container, '', name);\r\n          dropdown.classList.add('hidden');\r\n        }\r\n      }\r\n    });\r\n  }\r\n  \r\n  // Clear button\r\n  const clearBtn = container.querySelector('#clear-answerer');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      selectAnswerer(container, '', '');\r\n    });\r\n  }\r\n  \r\n  // Close on outside click\r\n  document.addEventListener('click', (e) => {\r\n    const target = e.target as HTMLElement;\r\n    if (!target.closest('.answered-by-picker') && !dropdown.classList.contains('hidden')) {\r\n      dropdown.classList.add('hidden');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Select an answerer\r\n */\r\nfunction selectAnswerer(container: HTMLElement, contactId: string, contactName: string): void {\r\n  const display = container.querySelector('#answered-by-display') as HTMLElement;\r\n  const select = container.querySelector('#answered-by-contact') as HTMLSelectElement;\r\n  \r\n  if (select) {\r\n    select.value = contactId;\r\n  }\r\n  \r\n  if (display) {\r\n    if (contactName) {\r\n      const contact = contacts.find(c => c.id === contactId);\r\n      const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\r\n      \r\n      display.innerHTML = `\r\n        <div class=\"answered-by-card\" id=\"current-answerer\">\r\n          <div class=\"answerer-avatar\">\r\n            ${photoUrl \r\n              ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contactName)}\" onerror=\"this.parentElement.innerHTML='${getInitials(contactName)}'\">`\r\n              : getInitials(contactName)\r\n            }\r\n          </div>\r\n          <span class=\"answerer-name\">${escapeHtml(contactName)}</span>\r\n          <button type=\"button\" class=\"btn-clear-answerer\" id=\"clear-answerer\"></button>\r\n        </div>\r\n      `;\r\n      \r\n      // Re-bind clear button\r\n      const clearBtn = display.querySelector('#clear-answerer');\r\n      if (clearBtn) {\r\n        on(clearBtn as HTMLElement, 'click', (e) => {\r\n          e.stopPropagation();\r\n          selectAnswerer(container, '', '');\r\n        });\r\n      }\r\n    } else {\r\n      display.innerHTML = `\r\n        <button type=\"button\" class=\"btn-select-answerer\" id=\"show-answerer-picker\">\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n          </svg>\r\n          Select who answered...\r\n        </button>\r\n      `;\r\n      \r\n      // Re-setup picker\r\n      setupAnswererPicker(container);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Setup source option radio buttons\r\n */\r\nfunction setupSourceOptions(container: HTMLElement): void {\r\n  const sourceOptions = container.querySelectorAll('.source-option input[type=\"radio\"]');\r\n  \r\n  sourceOptions.forEach(input => {\r\n    input.addEventListener('change', () => {\r\n      // Update active state\r\n      container.querySelectorAll('.source-option').forEach(opt => opt.classList.remove('active'));\r\n      (input as HTMLElement).closest('.source-option')?.classList.add('active');\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render contact grid with cards\r\n */\r\nfunction renderContactGrid(container: HTMLElement, contactsToRender: typeof contacts): void {\r\n  const contactList = container.querySelector('#contact-list') as HTMLElement;\r\n  if (!contactList) return;\r\n  \r\n  if (contactsToRender.length === 0) {\r\n    contactList.innerHTML = '<div class=\"empty-state\">No contacts found</div>';\r\n    return;\r\n  }\r\n  \r\n  contactList.innerHTML = contactsToRender.map(contact => {\r\n    const photoUrl = contact.photoUrl || contact.avatarUrl || contact.photo_url || contact.avatar_url;\r\n    const isCurrentAssignee = currentQuestion?.assigned_to === contact.name;\r\n    \r\n    return `\r\n      <div class=\"contact-card-picker ${isCurrentAssignee ? 'selected' : ''}\" data-contact-id=\"${contact.id}\" data-contact-name=\"${escapeHtml(contact.name)}\">\r\n        <div class=\"contact-avatar-picker\">\r\n          ${photoUrl \r\n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(contact.name)}'\">`\r\n            : getInitials(contact.name)\r\n          }\r\n        </div>\r\n        <div class=\"contact-info-picker\">\r\n          <div class=\"contact-name-picker\">${escapeHtml(contact.name)}</div>\r\n          ${contact.role ? `<div class=\"contact-role-picker\">${escapeHtml(contact.role)}</div>` : ''}\r\n          ${contact.organization ? `<div class=\"contact-org-picker\">${escapeHtml(contact.organization)}</div>` : ''}\r\n        </div>\r\n        ${isCurrentAssignee ? '<div class=\"current-badge\">Current</div>' : ''}\r\n      </div>\r\n    `;\r\n  }).join('');\r\n  \r\n  // Bind click handlers\r\n  contactList.querySelectorAll('.contact-card-picker').forEach(card => {\r\n    on(card as HTMLElement, 'click', async () => {\r\n      const contactId = card.getAttribute('data-contact-id');\r\n      const contactName = card.getAttribute('data-contact-name');\r\n      const assigneeSelect = container.querySelector('#assignee-select') as HTMLSelectElement;\r\n      const picker = container.querySelector('#contact-picker') as HTMLElement;\r\n      \r\n      if (contactId && assigneeSelect && currentQuestion) {\r\n        assigneeSelect.value = contactId;\r\n        \r\n        // Save to server FIRST\r\n        try {\r\n          await questionsService.update(currentQuestion.id, {\r\n            assigned_to: contactName || undefined,\r\n            status: 'assigned'\r\n          });\r\n          \r\n          // Update current question state\r\n          currentQuestion.assigned_to = contactName || undefined;\r\n          currentQuestion.status = 'assigned';\r\n          \r\n          // Update display\r\n          updateAssignedDisplay(container);\r\n          \r\n          // Hide picker\r\n          if (picker) {\r\n            picker.classList.add('hidden');\r\n          }\r\n          \r\n          toast.success(`Assigned to ${contactName}`);\r\n        } catch (e) {\r\n          console.error('[QuestionDetail] Failed to save assignment:', e);\r\n          toast.error('Failed to save assignment');\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Update assigned contact display\r\n */\r\nfunction updateAssignedDisplay(container: HTMLElement): void {\r\n  const display = container.querySelector('#current-assignment') as HTMLElement;\r\n  if (!display || !currentQuestion) return;\r\n  \r\n  if (currentQuestion.assigned_to) {\r\n    const contact = contacts.find(c => c.name === currentQuestion?.assigned_to);\r\n    const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\r\n    \r\n    display.innerHTML = `\r\n      <div class=\"assigned-contact-display\">\r\n        <div class=\"contact-avatar-lg\">\r\n          ${photoUrl \r\n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(currentQuestion.assigned_to)}\" onerror=\"this.parentElement.innerHTML='${getInitials(currentQuestion.assigned_to)}'\">`\r\n            : getInitials(currentQuestion.assigned_to)\r\n          }\r\n        </div>\r\n        <div class=\"contact-details\">\r\n          <div class=\"contact-name-lg\">${escapeHtml(currentQuestion.assigned_to)}</div>\r\n          <div class=\"contact-role-sm\">${contact?.role || 'Team Member'}</div>\r\n          ${contact?.organization ? `<div class=\"contact-org-sm\">${escapeHtml(contact.organization)}</div>` : ''}\r\n        </div>\r\n        <button class=\"btn-change-assignment\" id=\"change-assignee-btn\">\r\n          <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/>\r\n          </svg>\r\n          Change\r\n        </button>\r\n      </div>\r\n    `;\r\n  } else {\r\n    display.innerHTML = `\r\n      <div class=\"no-assignment\">\r\n        <div class=\"no-assignment-icon\">\r\n          <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/>\r\n          </svg>\r\n        </div>\r\n        <span>No one assigned yet</span>\r\n        <button class=\"btn-assign-now\" id=\"show-picker-btn\">Assign Someone</button>\r\n      </div>\r\n    `;\r\n  }\r\n  \r\n  // Re-bind picker buttons\r\n  bindPickerButtons(container);\r\n}\r\n\r\n/**\r\n * Bind picker toggle buttons\r\n */\r\nfunction bindPickerButtons(container: HTMLElement): void {\r\n  const showPickerBtn = container.querySelector('#show-picker-btn');\r\n  const changeBtn = container.querySelector('#change-assignee-btn');\r\n  const picker = container.querySelector('#contact-picker') as HTMLElement;\r\n  \r\n  if (showPickerBtn && picker) {\r\n    on(showPickerBtn as HTMLElement, 'click', () => {\r\n      picker.classList.toggle('hidden');\r\n      const searchInput = picker.querySelector('#contact-search') as HTMLInputElement;\r\n      if (searchInput) {\r\n        searchInput.focus();\r\n      }\r\n    });\r\n  }\r\n  \r\n  if (changeBtn && picker) {\r\n    on(changeBtn as HTMLElement, 'click', () => {\r\n      picker.classList.toggle('hidden');\r\n      const searchInput = picker.querySelector('#contact-search') as HTMLInputElement;\r\n      if (searchInput) {\r\n        searchInput.focus();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Load question chain (parent + children)\r\n */\r\nasync function loadChain(\r\n  container: HTMLElement, \r\n  questionId: string | number,\r\n  onNavigate?: (id: string) => void\r\n): Promise<void> {\r\n  const chainContent = container.querySelector('#chain-content');\r\n  if (!chainContent) return;\r\n\r\n  try {\r\n    const response = await http.get<{ parent: Question | null; children: Question[] }>(\r\n      `/api/questions/${questionId}/chain`\r\n    );\r\n    const { parent, children } = response.data;\r\n\r\n    if (!parent && children.length === 0) {\r\n      chainContent.innerHTML = '<p class=\"empty-state\">No follow-up chain</p>';\r\n      return;\r\n    }\r\n\r\n    let html = '';\r\n\r\n    if (parent) {\r\n      html += `\r\n        <div class=\"chain-item chain-parent\" data-id=\"${parent.id}\">\r\n          <span class=\"chain-arrow\"></span>\r\n          <span class=\"chain-label\">Parent:</span>\r\n          <span class=\"chain-content\">${escapeHtml(parent.content.substring(0, 50))}...</span>\r\n          <span class=\"status-badge status-${parent.status}\">${parent.status}</span>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    html += `<div class=\"chain-item chain-current\">This question</div>`;\r\n\r\n    for (const child of children) {\r\n      html += `\r\n        <div class=\"chain-item chain-child\" data-id=\"${child.id}\">\r\n          <span class=\"chain-arrow\"></span>\r\n          <span class=\"chain-content\">${escapeHtml(child.content.substring(0, 50))}...</span>\r\n          <span class=\"status-badge status-${child.status}\">${child.status}</span>\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    chainContent.innerHTML = html;\r\n\r\n    // Bind click handlers for navigation\r\n    chainContent.querySelectorAll('.chain-item[data-id]').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        const id = item.getAttribute('data-id');\r\n        if (id && onNavigate) {\r\n          onNavigate(id);\r\n        }\r\n      });\r\n    });\r\n  } catch (e) {\r\n    chainContent.innerHTML = '<p class=\"error\">Failed to load chain</p>';\r\n  }\r\n}\r\n\r\n/**\r\n * Load similar questions\r\n */\r\nasync function loadSimilar(\r\n  container: HTMLElement, \r\n  questionId: string | number,\r\n  onNavigate?: (id: string) => void\r\n): Promise<void> {\r\n  const similarContent = container.querySelector('#similar-content');\r\n  if (!similarContent) return;\r\n\r\n  try {\r\n    const response = await http.get<{ similar: SimilarQuestion[] }>(\r\n      `/api/questions/${questionId}/similar?limit=5`\r\n    );\r\n    const { similar } = response.data;\r\n\r\n    if (!similar || similar.length === 0) {\r\n      similarContent.innerHTML = '<p class=\"empty-state\">No similar questions found</p>';\r\n      return;\r\n    }\r\n\r\n    const html = similar.map(q => `\r\n      <div class=\"similar-item\" data-id=\"${q.id}\">\r\n        <div class=\"similar-content\">${escapeHtml(q.content.substring(0, 60))}...</div>\r\n        <div class=\"similar-meta\">\r\n          <span class=\"status-badge status-${q.status}\">${q.status}</span>\r\n          <span class=\"similarity-score\">${Math.round(q.similarityScore * 100)}%</span>\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n\r\n    similarContent.innerHTML = html;\r\n\r\n    // Bind click handlers\r\n    similarContent.querySelectorAll('.similar-item').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        const id = item.getAttribute('data-id');\r\n        if (id && onNavigate) {\r\n          onNavigate(id);\r\n        }\r\n      });\r\n    });\r\n  } catch (e) {\r\n    similarContent.innerHTML = '<p class=\"error\">Failed to load similar questions</p>';\r\n  }\r\n}\r\n\r\n/**\r\n * Load timeline events\r\n */\r\nasync function loadTimeline(container: HTMLElement, questionId: string | number): Promise<void> {\r\n  const timelineContent = container.querySelector('#timeline-content');\r\n  if (!timelineContent) return;\r\n\r\n  try {\r\n    const response = await http.get<{ events: TimelineEvent[] }>(\r\n      `/api/questions/${questionId}/timeline`\r\n    );\r\n    const { events } = response.data;\r\n\r\n    if (!events || events.length === 0) {\r\n      timelineContent.innerHTML = '<p class=\"empty-state\">No events recorded</p>';\r\n      return;\r\n    }\r\n\r\n    const html = events.map(e => {\r\n      const icon = getEventIcon(e.event_type);\r\n      const description = getEventDescription(e);\r\n      \r\n      return `\r\n        <div class=\"timeline-item\">\r\n          <div class=\"timeline-icon\">${icon}</div>\r\n          <div class=\"timeline-content\">\r\n            <div class=\"timeline-title\">${description}</div>\r\n            <div class=\"timeline-date\">${formatDateTime(e.created_at)}</div>\r\n          </div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    timelineContent.innerHTML = `<div class=\"timeline-list\">${html}</div>`;\r\n  } catch (e) {\r\n    timelineContent.innerHTML = '<p class=\"error\">Failed to load timeline</p>';\r\n  }\r\n}\r\n\r\n/**\r\n * Get icon for event type\r\n */\r\nfunction getEventIcon(eventType: string): string {\r\n  const icons: Record<string, string> = {\r\n    created: '',\r\n    assigned: '',\r\n    answered: '',\r\n    priority_changed: '',\r\n    status_changed: '',\r\n    reopened: '',\r\n    dismissed: '',\r\n    sla_breached: '',\r\n    entity_extracted: '',\r\n    similar_linked: ''\r\n  };\r\n  return icons[eventType] || '';\r\n}\r\n\r\n/**\r\n * Get description for event\r\n */\r\nfunction getEventDescription(event: TimelineEvent): string {\r\n  const data = event.event_data || {};\r\n  \r\n  switch (event.event_type) {\r\n    case 'created':\r\n      return `Created${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n    case 'assigned':\r\n      return `Assigned to ${data.to || 'someone'}${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n    case 'answered':\r\n      return `Answered${event.actor_name ? ` by ${event.actor_name}` : ''} (${data.source || 'manual'})`;\r\n    case 'priority_changed':\r\n      return `Priority changed: ${data.from}  ${data.to}`;\r\n    case 'status_changed':\r\n      return `Status changed: ${data.from}  ${data.to}`;\r\n    case 'reopened':\r\n      return `Reopened${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n    case 'dismissed':\r\n      return `Dismissed${event.actor_name ? ` by ${event.actor_name}` : ''}`;\r\n    case 'sla_breached':\r\n      return 'SLA breached';\r\n    case 'entity_extracted':\r\n      return `Entities extracted: ${(data.entities as Array<{name: string}>)?.length || 0}`;\r\n    default:\r\n      return event.event_type;\r\n  }\r\n}\r\n\r\n/**\r\n * Load AI suggestions for assignee\r\n */\r\nasync function loadAISuggestions(container: HTMLElement): Promise<void> {\r\n  const panel = container.querySelector('#suggestions-panel') as HTMLElement;\r\n  const btn = container.querySelector('#ai-suggest-btn') as HTMLButtonElement;\r\n  \r\n  if (!panel || !currentQuestion) return;\r\n\r\n  btn.disabled = true;\r\n  btn.innerHTML = `\r\n    <svg class=\"spin\" width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n      <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\r\n    </svg>\r\n    Analyzing...\r\n  `;\r\n  panel.classList.remove('hidden');\r\n  panel.innerHTML = `\r\n    <div class=\"suggestions-loading\">\r\n      <div class=\"ai-thinking-animation\">\r\n        <span></span><span></span><span></span>\r\n      </div>\r\n      <div class=\"loading-text\">AI is analyzing question context and team expertise...</div>\r\n    </div>\r\n  `;\r\n\r\n  try {\r\n    const result = await questionsService.suggestAssignee({\r\n      id: currentQuestion.id,\r\n      useAI: true\r\n    });\r\n\r\n    if (result.suggestions.length === 0) {\r\n      panel.innerHTML = `\r\n        <div class=\"no-suggestions\">\r\n          <svg width=\"40\" height=\"40\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n          </svg>\r\n          <div class=\"no-suggestions-text\">No matching experts found</div>\r\n          <button class=\"btn-show-all-contacts\" id=\"show-all-btn\">Browse all contacts</button>\r\n        </div>\r\n      `;\r\n      \r\n      // Bind show all button\r\n      const showAllBtn = panel.querySelector('#show-all-btn');\r\n      if (showAllBtn) {\r\n        on(showAllBtn as HTMLElement, 'click', () => {\r\n          panel.classList.add('hidden');\r\n          const picker = container.querySelector('#contact-picker') as HTMLElement;\r\n          if (picker) {\r\n            picker.classList.remove('hidden');\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      panel.innerHTML = `\r\n        <div class=\"suggestions-header-sota\">\r\n          <div class=\"ai-badge\">\r\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n            </svg>\r\n            AI Recommended\r\n          </div>\r\n          ${result.cached ? '<span class=\"cached-tag\">Cached</span>' : '<span class=\"fresh-tag\">Fresh</span>'}\r\n        </div>\r\n        <div class=\"suggestions-list-sota\">\r\n          ${result.suggestions.map((s, i) => {\r\n            const contact = contacts.find(c => (c.name || '').trim().toLowerCase() === (s.person || '').trim().toLowerCase())\r\n              || contacts.find(c => (c.aliases || []).some(a => String(a).trim().toLowerCase() === (s.person || '').trim().toLowerCase()));\r\n            const photoUrl = contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url;\r\n            const roleDisplay = contact?.role ?? s.role ?? '';\r\n            const scoreColor = getScoreColor(s.score);\r\n            \r\n            return `\r\n              <div class=\"suggestion-card-sota\" data-index=\"${i}\">\r\n                <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                <div class=\"suggestion-avatar-sota\">\r\n                  ${photoUrl \r\n                    ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(s.person)}\" onerror=\"this.parentElement.innerHTML='${getInitials(s.person)}'\">`\r\n                    : getInitials(s.person)\r\n                  }\r\n                </div>\r\n                <div class=\"suggestion-info-sota\">\r\n                  <div class=\"suggestion-name-sota\">${escapeHtml(s.person)}</div>\r\n                  ${roleDisplay ? `<div class=\"suggestion-role-sota\">${escapeHtml(roleDisplay)}</div>` : ''}\r\n                  <div class=\"suggestion-reason-sota\">${escapeHtml(s.reason)}</div>\r\n                </div>\r\n                <div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\">\r\n                  <div class=\"score-ring\">\r\n                    <svg viewBox=\"0 0 36 36\">\r\n                      <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                      <path class=\"score-fill\" stroke-dasharray=\"${s.score}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                    </svg>\r\n                    <div class=\"score-value\">${s.score}%</div>\r\n                  </div>\r\n                  <div class=\"score-label\">Match</div>\r\n                </div>\r\n                <button class=\"btn-select-suggestion\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n                  </svg>\r\n                  Assign\r\n                </button>\r\n              </div>\r\n            `;\r\n          }).join('')}\r\n        </div>\r\n        <div class=\"suggestions-footer\">\r\n          <button class=\"btn-link\" id=\"hide-suggestions-btn\">Close suggestions</button>\r\n        </div>\r\n      `;\r\n\r\n      // Bind click to select\r\n      panel.querySelectorAll('.suggestion-card-sota').forEach(item => {\r\n        const selectBtn = item.querySelector('.btn-select-suggestion');\r\n        if (selectBtn) {\r\n          on(selectBtn as HTMLElement, 'click', async (e) => {\r\n            e.stopPropagation();\r\n            const idx = parseInt(item.getAttribute('data-index') || '0');\r\n            const suggestion = result.suggestions[idx];\r\n            if (suggestion && currentQuestion) {\r\n              const select = container.querySelector('#assignee-select') as HTMLSelectElement;\r\n              const contact = contacts.find(c => c.name === suggestion.person);\r\n              \r\n              // Save to server FIRST\r\n              try {\r\n                await questionsService.update(currentQuestion.id, {\r\n                  assigned_to: suggestion.person,\r\n                  status: 'assigned'\r\n                });\r\n                \r\n                if (contact && select) {\r\n                  select.value = contact.id;\r\n                }\r\n                // Update current question state\r\n                currentQuestion.assigned_to = suggestion.person;\r\n                currentQuestion.status = 'assigned';\r\n                \r\n                // Update display\r\n                updateAssignedDisplay(container);\r\n                panel.classList.add('hidden');\r\n                toast.success(`Assigned to ${suggestion.person}`);\r\n              } catch (err) {\r\n                console.error('[QuestionDetail] Failed to save AI suggestion assignment:', err);\r\n                toast.error('Failed to save assignment');\r\n              }\r\n            }\r\n          });\r\n        }\r\n      });\r\n      \r\n      // Bind hide button\r\n      const hideBtn = panel.querySelector('#hide-suggestions-btn');\r\n      if (hideBtn) {\r\n        on(hideBtn as HTMLElement, 'click', () => {\r\n          panel.classList.add('hidden');\r\n        });\r\n      }\r\n    }\r\n  } catch (e) {\r\n    const isTimeout = (err: unknown) =>\r\n      (err as { message?: string; status?: number }).message === 'Request timed out' ||\r\n      (err as { status?: number }).status === 0;\r\n    const timeoutMessage = isTimeout(e);\r\n    panel.innerHTML = `\r\n      <div class=\"suggestions-error\">\r\n        <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\r\n        </svg>\r\n        <div>${timeoutMessage ? 'This took longer than expected.' : 'Failed to get AI suggestions.'}</div>\r\n        ${timeoutMessage ? '<p class=\"suggestions-error-hint\">You can try again (suggestions may be ready) or choose someone manually.</p>' : ''}\r\n        <button class=\"btn-retry\" id=\"retry-suggestions-btn\">Try Again</button>\r\n      </div>\r\n    `;\r\n    \r\n    const retryBtn = panel.querySelector('#retry-suggestions-btn');\r\n    if (retryBtn) {\r\n      on(retryBtn as HTMLElement, 'click', () => loadAISuggestions(container));\r\n    }\r\n  } finally {\r\n    btn.disabled = false;\r\n    btn.innerHTML = `\r\n      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n      </svg>\r\n      AI Suggest\r\n    `;\r\n  }\r\n}\r\n\r\n/**\r\n * Check for potential answers in knowledge base\r\n */\r\nasync function checkPotentialAnswers(container: HTMLElement): Promise<void> {\r\n  const answersDiv = container.querySelector('#potential-answers') as HTMLElement;\r\n  const btn = container.querySelector('#check-answers-btn') as HTMLButtonElement;\r\n  \r\n  if (!answersDiv || !currentQuestion) return;\r\n\r\n  btn.disabled = true;\r\n  btn.textContent = 'Checking...';\r\n  answersDiv.innerHTML = '<div class=\"loading\">Searching knowledge base...</div>';\r\n\r\n  try {\r\n    const response = await http.post<{ potentialAnswers: PotentialAnswer[] }>(\r\n      `/api/questions/${currentQuestion.id}/check-answer`,\r\n      {}\r\n    );\r\n    const { potentialAnswers } = response.data;\r\n\r\n    if (!potentialAnswers || potentialAnswers.length === 0) {\r\n      answersDiv.innerHTML = '<p class=\"empty-state\">No potential answers found in knowledge base</p>';\r\n    } else {\r\n      answersDiv.innerHTML = potentialAnswers.map(a => `\r\n        <div class=\"potential-answer\" data-content=\"${escapeHtml(a.content)}\">\r\n          <div class=\"answer-header\">\r\n            <span class=\"answer-type\">${a.type.toUpperCase()}</span>\r\n            <span class=\"answer-confidence\">${Math.round(a.confidence * 100)}%</span>\r\n          </div>\r\n          <div class=\"answer-content\">${escapeHtml(a.content.substring(0, 200))}...</div>\r\n          ${a.source ? `<div class=\"answer-source\">Source: ${escapeHtml(a.source)}</div>` : ''}\r\n          <button class=\"btn btn-sm btn-secondary use-answer-btn\">Use This</button>\r\n        </div>\r\n      `).join('');\r\n\r\n      // Bind \"Use This\" buttons\r\n      answersDiv.querySelectorAll('.use-answer-btn').forEach(btn => {\r\n        on(btn as HTMLElement, 'click', (e) => {\r\n          e.stopPropagation();\r\n          const parent = (btn as HTMLElement).closest('.potential-answer');\r\n          const content = parent?.getAttribute('data-content');\r\n          if (content) {\r\n            const answerInput = container.querySelector('#answer-input') as HTMLTextAreaElement;\r\n            if (answerInput) {\r\n              answerInput.value = content;\r\n              toast.success('Answer filled from knowledge base');\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n  } catch (e) {\r\n    answersDiv.innerHTML = '<p class=\"error\">Failed to check knowledge base</p>';\r\n  } finally {\r\n    btn.disabled = false;\r\n    btn.textContent = 'Check Knowledge Base';\r\n  }\r\n}\r\n\r\n/**\r\n * Save answer\r\n */\r\nasync function saveAnswer(\r\n  container: HTMLElement, \r\n  onUpdate?: (question: Question) => void\r\n): Promise<void> {\r\n  if (!currentQuestion) return;\r\n\r\n  const answerInput = container.querySelector('#answer-input') as HTMLTextAreaElement;\r\n  const sourceSelect = container.querySelector('#answer-source') as HTMLSelectElement;\r\n  const answeredBySelect = container.querySelector('#answered-by-contact') as HTMLSelectElement;\r\n  const followupInput = container.querySelector('#followup-input') as HTMLTextAreaElement;\r\n  const saveBtn = container.querySelector('#save-answer-btn') as HTMLButtonElement;\r\n\r\n  const answer = answerInput?.value.trim();\r\n  const source = sourceSelect?.value || 'manual';\r\n  const answeredByContactId = answeredBySelect?.value !== '__other__' ? answeredBySelect?.value : undefined;\r\n  const followupQuestions = followupInput?.value.trim();\r\n\r\n  if (!answer || answer.length < 3) {\r\n    toast.warning('Please provide an answer (at least 3 characters)');\r\n    return;\r\n  }\r\n\r\n  // Get contact name if selected\r\n  let answeredByName: string | undefined;\r\n  if (answeredByContactId) {\r\n    const contact = contacts.find(c => c.id === answeredByContactId);\r\n    answeredByName = contact?.name;\r\n  }\r\n\r\n  saveBtn.disabled = true;\r\n  saveBtn.textContent = 'Saving...';\r\n\r\n  try {\r\n    const result = await questionsService.answer(currentQuestion.id, {\r\n      answer,\r\n      source: source as 'manual' | 'document' | 'ai',\r\n      followupQuestions,\r\n      answeredByContactId,\r\n      answeredByName\r\n    });\r\n\r\n    toast.success(result.message);\r\n    \r\n    if (onUpdate && result.question) {\r\n      currentQuestion = result.question;\r\n      onUpdate(result.question);\r\n    }\r\n  } catch (e) {\r\n    toast.error('Failed to save answer');\r\n  } finally {\r\n    saveBtn.disabled = false;\r\n    saveBtn.textContent = 'Save Answer';\r\n  }\r\n}\r\n\r\n/**\r\n * Reopen question\r\n */\r\nasync function reopenQuestion(\r\n  container: HTMLElement,\r\n  onUpdate?: (question: Question) => void\r\n): Promise<void> {\r\n  if (!currentQuestion) return;\r\n\r\n  const reason = prompt('Why are you reopening this question?');\r\n  if (!reason) return;\r\n\r\n  try {\r\n    const updated = await questionsService.reopen(currentQuestion.id, reason);\r\n    toast.success('Question reopened');\r\n    currentQuestion = updated;\r\n    if (onUpdate) onUpdate(updated);\r\n  } catch (e) {\r\n    toast.error('Failed to reopen question');\r\n  }\r\n}\r\n\r\n/**\r\n * Dismiss question with reason\r\n */\r\nasync function dismissQuestionWithReason(\r\n  container: HTMLElement,\r\n  props: QuestionDetailViewProps,\r\n  reason: 'duplicate' | 'not_relevant' | 'out_of_scope' | 'answered_elsewhere' | 'no_longer_needed' | 'other',\r\n  details?: string\r\n): Promise<void> {\r\n  console.log('[QuestionDetail] dismissQuestionWithReason called, reason:', reason);\r\n  \r\n  if (!currentQuestion) {\r\n    console.error('[QuestionDetail] No current question!');\r\n    toast.error('No question selected');\r\n    return;\r\n  }\r\n\r\n  console.log('[QuestionDetail] Dismissing question:', currentQuestion.id);\r\n\r\n  try {\r\n    const updated = await questionsService.dismissQuestion(currentQuestion.id, reason, details);\r\n    console.log('[QuestionDetail] Dismiss API response:', updated);\r\n    toast.success(`Question dismissed: ${reason.replace(/_/g, ' ')}`);\r\n    currentQuestion = updated;\r\n    if (props.onUpdate) props.onUpdate(updated);\r\n    props.onClose();\r\n  } catch (e) {\r\n    console.error('[QuestionDetail] Dismiss API error:', e);\r\n    toast.error('Failed to dismiss question');\r\n  }\r\n}\r\n\r\n/**\r\n * Show defer dialog\r\n */\r\nasync function showDeferDialog(\r\n  container: HTMLElement,\r\n  onUpdate?: (question: Question) => void\r\n): Promise<void> {\r\n  if (!currentQuestion) return;\r\n\r\n  // Create modal for defer options\r\n  const modal = document.createElement('div');\r\n  modal.className = 'modal open';\r\n  modal.id = 'defer-modal';\r\n  modal.innerHTML = `\r\n    <div class=\"modal-backdrop\"></div>\r\n    <div class=\"modal-container defer-modal-container\">\r\n      <div class=\"modal-header\">\r\n        <h3>Defer Question</h3>\r\n        <button class=\"btn btn-icon modal-close\"></button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label>Defer until</label>\r\n          <input type=\"datetime-local\" id=\"defer-until\" class=\"form-input\" \r\n            min=\"${new Date().toISOString().slice(0, 16)}\" required>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Quick options</label>\r\n          <div class=\"defer-quick-options\">\r\n            <button class=\"btn btn-sm btn-secondary\" data-days=\"1\">Tomorrow</button>\r\n            <button class=\"btn btn-sm btn-secondary\" data-days=\"7\">Next Week</button>\r\n            <button class=\"btn btn-sm btn-secondary\" data-days=\"30\">Next Month</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Reason (optional)</label>\r\n          <input type=\"text\" id=\"defer-reason\" class=\"form-input\" placeholder=\"Why are you deferring this?\">\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary\" id=\"cancel-defer\">Cancel</button>\r\n        <button class=\"btn btn-primary\" id=\"confirm-defer\">Defer</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(modal);\r\n\r\n  // Bind events\r\n  modal.querySelector('.modal-close')?.addEventListener('click', () => modal.remove());\r\n  modal.querySelector('.modal-backdrop')?.addEventListener('click', () => modal.remove());\r\n  modal.querySelector('#cancel-defer')?.addEventListener('click', () => modal.remove());\r\n\r\n  // Quick options\r\n  modal.querySelectorAll('.defer-quick-options button').forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      const days = parseInt(btn.getAttribute('data-days') || '1');\r\n      const date = new Date();\r\n      date.setDate(date.getDate() + days);\r\n      const input = modal.querySelector('#defer-until') as HTMLInputElement;\r\n      input.value = date.toISOString().slice(0, 16);\r\n    });\r\n  });\r\n\r\n  // Confirm\r\n  modal.querySelector('#confirm-defer')?.addEventListener('click', async () => {\r\n    const untilInput = modal.querySelector('#defer-until') as HTMLInputElement;\r\n    const reasonInput = modal.querySelector('#defer-reason') as HTMLInputElement;\r\n\r\n    if (!untilInput.value) {\r\n      toast.warning('Please select a date');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const updated = await questionsService.deferQuestion(\r\n        currentQuestion!.id,\r\n        new Date(untilInput.value),\r\n        reasonInput.value || undefined\r\n      );\r\n      toast.success('Question deferred');\r\n      modal.remove();\r\n      currentQuestion = updated;\r\n      if (onUpdate) onUpdate(updated);\r\n    } catch (e) {\r\n      toast.error('Failed to defer question');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Submit feedback on answer\r\n */\r\nasync function submitFeedback(\r\n  container: HTMLElement,\r\n  wasUseful: boolean,\r\n  onUpdate?: (question: Question) => void\r\n): Promise<void> {\r\n  if (!currentQuestion) return;\r\n\r\n  let feedback: string | undefined;\r\n  if (!wasUseful) {\r\n    feedback = prompt('What could be improved about this answer?') || undefined;\r\n  }\r\n\r\n  try {\r\n    const updated = await questionsService.submitAnswerFeedback(\r\n      currentQuestion.id,\r\n      wasUseful,\r\n      feedback\r\n    );\r\n    toast.success('Thank you for your feedback!');\r\n    currentQuestion = updated;\r\n    if (onUpdate) onUpdate(updated);\r\n    \r\n    // Update UI to hide feedback buttons\r\n    const feedbackBtns = container.querySelector('.feedback-buttons');\r\n    if (feedbackBtns) {\r\n      feedbackBtns.innerHTML = `<span class=\"feedback-result\">${wasUseful ? ' Helpful' : ' Not helpful'}</span>`;\r\n    }\r\n  } catch (e) {\r\n    toast.error('Failed to submit feedback');\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle edit mode\r\n */\r\nfunction toggleEditMode(container: HTMLElement): void {\r\n  // TODO: Implement edit mode for question content, priority, etc.\r\n  toast.info('Edit mode coming soon');\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createQuestionDetailView;\r\n","/**\n * Question Modal Component\n * View, create, edit, and answer questions with AI suggestions\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { \n  questionsService, \n  Question, \n  CreateQuestionRequest, \n  AssigneeSuggestion \n} from '../../services/questions';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nconst MODAL_ID = 'question-modal';\n\nexport interface QuestionModalProps {\n  mode: 'view' | 'answer' | 'create' | 'edit';\n  question?: Question;\n  onSave?: (question: Question) => void;\n  onDismiss?: (questionId: string | number) => void;\n  onDelete?: (questionId: string | number) => void;\n}\n\nlet currentSuggestions: AssigneeSuggestion[] = [];\n\n/**\n * Show question modal\n */\nexport function showQuestionModal(props: QuestionModalProps): void {\n  const { mode, question, onSave, onDismiss } = props;\n  currentSuggestions = [];\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'question-modal-content' });\n\n  if (mode === 'create') {\n    renderCreateForm(content);\n  } else if (mode === 'edit' && question) {\n    renderEditForm(content, question);\n  } else if (question) {\n    renderQuestionView(content, question, mode === 'answer');\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n  createFooterButtons(footer, mode, question, content, props);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: getModalTitle(mode),\n    content,\n    size: 'lg',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Get modal title based on mode\n */\nfunction getModalTitle(mode: string): string {\n  switch (mode) {\n    case 'create': return 'New Question';\n    case 'edit': return 'Edit Question';\n    case 'answer': return 'Answer Question';\n    default: return 'Question Details';\n  }\n}\n\n/**\n * Create footer buttons based on mode\n */\nfunction createFooterButtons(\n  footer: HTMLElement,\n  mode: string,\n  question: Question | undefined,\n  content: HTMLElement,\n  props: QuestionModalProps\n): void {\n  const { onSave, onDismiss, onDelete } = props;\n\n  if (mode === 'create') {\n    const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\n    const createBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Create Question' });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n    on(createBtn, 'click', () => handleCreate(content, onSave));\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(createBtn);\n  } else if (mode === 'edit' && question) {\n    const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\n    const saveBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save Changes' });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n    on(saveBtn, 'click', () => handleEdit(content, question, onSave));\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(saveBtn);\n  } else if (question) {\n    const status = question.status;\n\n    if (status !== 'resolved' && status !== 'dismissed') {\n      const dismissBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Dismiss' });\n      on(dismissBtn, 'click', () => handleDismiss(question.id, onDismiss));\n      footer.appendChild(dismissBtn);\n\n      if (mode === 'answer') {\n        const saveAnswerBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save Answer' });\n        on(saveAnswerBtn, 'click', () => handleAnswer(content, question, onSave));\n        footer.appendChild(saveAnswerBtn);\n      } else {\n        const answerBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Answer' });\n        on(answerBtn, 'click', () => {\n          closeModal(MODAL_ID);\n          showQuestionModal({ ...props, mode: 'answer' });\n        });\n        footer.appendChild(answerBtn);\n      }\n    } else if (status === 'resolved') {\n      const reopenBtn = createElement('button', { className: 'btn btn-warning', textContent: 'Reopen' });\n      on(reopenBtn, 'click', () => handleReopen(question, onSave));\n      footer.appendChild(reopenBtn);\n    }\n\n    const closeBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Close' });\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    footer.appendChild(closeBtn);\n  }\n}\n\n/**\n * Render create form\n */\nfunction renderCreateForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"question-form\" class=\"question-form\">\n      <div class=\"form-group\">\n        <label for=\"question-content\">Question <span class=\"required\">*</span></label>\n        <textarea id=\"question-content\" rows=\"3\" required minlength=\"5\"\n                  placeholder=\"What needs to be clarified? (min 5 characters)\"></textarea>\n        <div id=\"duplicate-warning\" class=\"form-warning hidden\"></div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-context\">Context</label>\n        <textarea id=\"question-context\" rows=\"2\"\n                  placeholder=\"Why is this question important?\"></textarea>\n      </div>\n      \n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label for=\"question-priority\">Priority</label>\n          <select id=\"question-priority\">\n            <option value=\"low\">Low</option>\n            <option value=\"medium\" selected>Medium</option>\n            <option value=\"high\">High</option>\n            <option value=\"critical\">Critical</option>\n          </select>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"question-assignee\">Assign To</label>\n          <input type=\"text\" id=\"question-assignee\" placeholder=\"Person name\">\n          <button type=\"button\" id=\"suggest-assignee-btn\" class=\"btn btn-sm btn-secondary\">\n            AI Suggest\n          </button>\n        </div>\n      </div>\n      \n      <div id=\"suggestions-container\" class=\"suggestions-container hidden\"></div>\n    </form>\n  `;\n\n  // Bind AI suggest button\n  const suggestBtn = container.querySelector('#suggest-assignee-btn');\n  if (suggestBtn) {\n    on(suggestBtn as HTMLElement, 'click', () => loadAssigneeSuggestions(container));\n  }\n}\n\n/**\n * Render edit form\n */\nfunction renderEditForm(container: HTMLElement, question: Question): void {\n  container.innerHTML = `\n    <form id=\"question-form\" class=\"question-form\">\n      <div class=\"form-group\">\n        <label for=\"question-content\">Question <span class=\"required\">*</span></label>\n        <textarea id=\"question-content\" rows=\"3\" required minlength=\"5\">${escapeHtml(question.content)}</textarea>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-context\">Context</label>\n        <textarea id=\"question-context\" rows=\"2\">${escapeHtml(question.context || '')}</textarea>\n      </div>\n      \n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label for=\"question-priority\">Priority</label>\n          <select id=\"question-priority\">\n            <option value=\"low\" ${question.priority === 'low' ? 'selected' : ''}>Low</option>\n            <option value=\"medium\" ${question.priority === 'medium' ? 'selected' : ''}>Medium</option>\n            <option value=\"high\" ${question.priority === 'high' ? 'selected' : ''}>High</option>\n            <option value=\"critical\" ${question.priority === 'critical' ? 'selected' : ''}>Critical</option>\n          </select>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"question-status\">Status</label>\n          <select id=\"question-status\">\n            <option value=\"pending\" ${question.status === 'pending' ? 'selected' : ''}>Pending</option>\n            <option value=\"assigned\" ${question.status === 'assigned' ? 'selected' : ''}>Assigned</option>\n            <option value=\"resolved\" ${question.status === 'resolved' ? 'selected' : ''}>Resolved</option>\n            <option value=\"dismissed\" ${question.status === 'dismissed' ? 'selected' : ''}>Dismissed</option>\n          </select>\n        </div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-assignee\">Assigned To</label>\n        <input type=\"text\" id=\"question-assignee\" value=\"${escapeHtml(question.assigned_to || '')}\">\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"question-category\">Category</label>\n        <input type=\"text\" id=\"question-category\" value=\"${escapeHtml(question.category || '')}\">\n      </div>\n    </form>\n  `;\n}\n\n/**\n * Render question view\n */\nfunction renderQuestionView(container: HTMLElement, question: Question, showAnswerField: boolean): void {\n  container.innerHTML = `\n    <div class=\"question-view\">\n      <div class=\"question-meta\">\n        <span class=\"priority-badge priority-${question.priority}\">${question.priority}</span>\n        <span class=\"status-badge status-${question.status}\">${question.status}</span>\n        <span class=\"question-date\">${formatRelativeTime(question.created_at)}</span>\n        ${question.assigned_to ? `<span class=\"question-assignee\"> ${escapeHtml(question.assigned_to)}</span>` : ''}\n      </div>\n      \n      <div class=\"question-content-large\">\n        ${escapeHtml(question.content)}\n      </div>\n      \n      ${question.context ? `<div class=\"question-context\"><strong>Context:</strong> ${escapeHtml(question.context)}</div>` : ''}\n      ${question.category ? `<div class=\"question-category\"><strong>Category:</strong> ${escapeHtml(question.category)}</div>` : ''}\n      ${question.source_file ? `<div class=\"question-source\"><strong>Source:</strong> ${escapeHtml(question.source_file)}</div>` : ''}\n      \n      ${question.answer ? `\n        <div class=\"question-answer-section\">\n          <h4>Answer ${question.answer_source ? `<span class=\"answer-source\">(${question.answer_source})</span>` : ''}</h4>\n          <div class=\"answer-text\">${escapeHtml(question.answer)}</div>\n          ${question.resolved_at ? `<div class=\"answer-date\">Resolved ${formatRelativeTime(question.resolved_at)}</div>` : ''}\n        </div>\n      ` : ''}\n      \n      ${showAnswerField && question.status !== 'resolved' ? `\n        <div class=\"answer-form\">\n          <div class=\"form-group\">\n            <label for=\"question-answer\">Your Answer <span class=\"required\">*</span></label>\n            <textarea id=\"question-answer\" rows=\"4\" required minlength=\"3\"\n                      placeholder=\"Provide an answer (min 3 characters)...\"></textarea>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"answer-source\">Source</label>\n            <select id=\"answer-source\">\n              <option value=\"manual\" selected>Manual</option>\n              <option value=\"document\">From Document</option>\n              <option value=\"ai\">AI Assisted</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"followup-questions\">Follow-up Questions (one per line)</label>\n            <textarea id=\"followup-questions\" rows=\"2\"\n                      placeholder=\"Add any follow-up questions...\"></textarea>\n          </div>\n        </div>\n      ` : ''}\n      \n      ${question.reopened_reason ? `\n        <div class=\"reopen-reason\">\n          <strong>Reopen Reason:</strong> ${escapeHtml(question.reopened_reason)}\n        </div>\n      ` : ''}\n    </div>\n  `;\n}\n\n/**\n * Load AI assignee suggestions\n */\nasync function loadAssigneeSuggestions(container: HTMLElement): Promise<void> {\n  const contentInput = container.querySelector('#question-content') as HTMLTextAreaElement;\n  const content = contentInput?.value.trim();\n\n  if (!content || content.length < 5) {\n    toast.warning('Please enter at least 5 characters for the question');\n    return;\n  }\n\n  const suggestionsContainer = container.querySelector('#suggestions-container') as HTMLElement;\n  const suggestBtn = container.querySelector('#suggest-assignee-btn') as HTMLButtonElement;\n\n  suggestBtn.disabled = true;\n  suggestBtn.textContent = 'Loading...';\n  suggestionsContainer.classList.remove('hidden');\n  suggestionsContainer.innerHTML = '<div class=\"loading\">Getting AI suggestions...</div>';\n\n  try {\n    const result = await questionsService.suggestAssignee({ content, useAI: true });\n    currentSuggestions = result.suggestions;\n\n    if (currentSuggestions.length === 0) {\n      suggestionsContainer.innerHTML = '<div class=\"no-suggestions\">No suggestions available</div>';\n    } else {\n      suggestionsContainer.innerHTML = `\n        <h4>AI Suggestions ${result.cached ? '<span class=\"cached\">(cached)</span>' : ''}</h4>\n        <div class=\"suggestions-list\">\n          ${currentSuggestions.map((s, i) => `\n            <div class=\"suggestion-item\" data-index=\"${i}\">\n              <div class=\"suggestion-person\">${escapeHtml(s.person)}</div>\n              <div class=\"suggestion-score\">${s.score}%</div>\n              <div class=\"suggestion-reason\">${escapeHtml(s.reason)}</div>\n              ${s.role ? `<div class=\"suggestion-role\">${escapeHtml(s.role)}</div>` : ''}\n            </div>\n          `).join('')}\n        </div>\n      `;\n\n      // Bind click to select suggestion\n      suggestionsContainer.querySelectorAll('.suggestion-item').forEach(item => {\n        on(item as HTMLElement, 'click', () => {\n          const index = parseInt(item.getAttribute('data-index') || '0', 10);\n          const suggestion = currentSuggestions[index];\n          if (suggestion) {\n            const assigneeInput = container.querySelector('#question-assignee') as HTMLInputElement;\n            if (assigneeInput) {\n              assigneeInput.value = suggestion.person;\n            }\n            suggestionsContainer.classList.add('hidden');\n            toast.success(`Selected: ${suggestion.person}`);\n          }\n        });\n      });\n    }\n  } catch {\n    suggestionsContainer.innerHTML = '<div class=\"error\">Failed to get suggestions</div>';\n  } finally {\n    suggestBtn.disabled = false;\n    suggestBtn.textContent = 'AI Suggest';\n  }\n}\n\n/**\n * Handle create\n */\nasync function handleCreate(\n  container: HTMLElement,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const form = container.querySelector('#question-form') as HTMLFormElement;\n  if (!form.checkValidity()) {\n    form.reportValidity();\n    return;\n  }\n\n  const getValue = (id: string) => {\n    const el = container.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n    return el?.value.trim() || '';\n  };\n\n  const data: CreateQuestionRequest = {\n    content: getValue('question-content'),\n    priority: getValue('question-priority') as 'low' | 'medium' | 'high' | 'critical',\n    assigned_to: getValue('question-assignee') || undefined,\n    context: getValue('question-context') || undefined,\n  };\n\n  try {\n    const result = await questionsService.create(data);\n\n    if (result.duplicate) {\n      const warning = container.querySelector('#duplicate-warning') as HTMLElement;\n      if (warning) {\n        warning.classList.remove('hidden');\n        warning.innerHTML = ` Similar question exists (${result.similarity}% match). <a href=\"#\" id=\"view-duplicate\">View existing</a>`;\n      }\n      return;\n    }\n\n    toast.success('Question created');\n    \n    const newQuestion: Question = {\n      id: result.id || Date.now(),\n      content: data.content,\n      priority: data.priority || 'medium',\n      status: data.assigned_to ? 'assigned' : 'pending',\n      assigned_to: data.assigned_to,\n      context: data.context,\n      created_at: new Date().toISOString(),\n    };\n\n    onSave?.(newQuestion);\n    closeModal(MODAL_ID);\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Handle edit\n */\nasync function handleEdit(\n  container: HTMLElement,\n  question: Question,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const getValue = (id: string) => {\n    const el = container.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;\n    return el?.value.trim() || '';\n  };\n\n  try {\n    const updated = await questionsService.update(question.id, {\n      content: getValue('question-content'),\n      context: getValue('question-context') || undefined,\n      priority: getValue('question-priority') as 'low' | 'medium' | 'high' | 'critical',\n      status: getValue('question-status') as 'pending' | 'assigned' | 'resolved' | 'dismissed',\n      assigned_to: getValue('question-assignee') || undefined,\n      category: getValue('question-category') || undefined,\n    });\n\n    toast.success('Question updated');\n    onSave?.(updated);\n    closeModal(MODAL_ID);\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Handle answer\n */\nasync function handleAnswer(\n  container: HTMLElement,\n  question: Question,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const answerInput = container.querySelector('#question-answer') as HTMLTextAreaElement;\n  const sourceSelect = container.querySelector('#answer-source') as HTMLSelectElement;\n  const followupInput = container.querySelector('#followup-questions') as HTMLTextAreaElement;\n\n  const answer = answerInput?.value.trim();\n  const source = sourceSelect?.value || 'manual';\n  const followupQuestions = followupInput?.value.trim();\n\n  if (!answer || answer.length < 3) {\n    toast.warning('Please provide an answer (at least 3 characters)');\n    return;\n  }\n\n  try {\n    const result = await questionsService.answer(question.id, {\n      answer,\n      source: source as 'manual' | 'document' | 'ai',\n      followupQuestions,\n    });\n\n    toast.success(result.message);\n    onSave?.(result.question);\n    closeModal(MODAL_ID);\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Handle dismiss\n */\nasync function handleDismiss(\n  questionId: string | number,\n  onDismiss?: (questionId: string | number) => void\n): Promise<void> {\n  const { confirm } = await import('../Modal');\n  const confirmed = await confirm(\n    'Are you sure you want to dismiss this question?',\n    {\n      title: 'Dismiss Question',\n      confirmText: 'Dismiss',\n    }\n  );\n\n  if (confirmed) {\n    try {\n      await questionsService.delete(questionId, 'dismissed');\n      toast.success('Question dismissed');\n      onDismiss?.(questionId);\n      closeModal(MODAL_ID);\n    } catch {\n      // Error shown by API service\n    }\n  }\n}\n\n/**\n * Handle reopen\n */\nasync function handleReopen(\n  question: Question,\n  onSave?: (question: Question) => void\n): Promise<void> {\n  const { prompt } = await import('../Modal');\n  const reason = await prompt('Why are you reopening this question?', {\n    title: 'Reopen Question',\n    placeholder: 'Enter reason...',\n  });\n\n  if (reason) {\n    try {\n      const updated = await questionsService.reopen(question.id, reason);\n      toast.success('Question reopened');\n      onSave?.(updated);\n      closeModal(MODAL_ID);\n    } catch {\n      // Error shown by API service\n    }\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showQuestionModal;\n","/**\r\n * Questions Panel Component\r\n * Displays and manages questions in the Source of Truth\r\n * Updated to support detail view instead of modal\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { questionsService, Question } from '../../services/questions';\r\nimport { dataStore } from '../../stores/data';\r\nimport { showQuestionModal } from '../modals/QuestionModal';\r\nimport { createQuestionDetailView } from '../questions/QuestionDetailView';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\nimport { http } from '../../services/api';\r\n\r\nexport interface QuestionsPanelProps {\r\n  onQuestionClick?: (question: Question) => void;\r\n  useDetailView?: boolean; // If true, replace panel with detail view instead of modal\r\n  containerElement?: HTMLElement; // Parent container for detail view replacement\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentView: 'status' | 'person' | 'team' = 'status';\r\n\r\n/**\r\n * Create questions panel\r\n */\r\nexport function createQuestionsPanel(props: QuestionsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel questions-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Questions</h2>\r\n        <span class=\"panel-count\" id=\"questions-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"questions-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All Active</option>\r\n          <option value=\"pending\">Pending</option>\r\n          <option value=\"assigned\">Assigned</option>\r\n          <option value=\"critical\">Critical Priority</option>\r\n          <option value=\"overdue\">Overdue (SLA)</option>\r\n          <option value=\"resolved\"> Resolved</option>\r\n          <option value=\"dismissed\"> Dismissed</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\r\n          <button class=\"view-tab\" data-view=\"person\">By Person</button>\r\n          <button class=\"view-tab\" data-view=\"team\">By Team</button>\r\n        </div>\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"generate-team-btn\" title=\"Generate questions for team based on roles\"> Generate</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-question-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"questions-content\">\r\n      <div class=\"loading\">Loading questions...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const filterSelect = panel.querySelector('#questions-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadQuestions(panel, props);\r\n  });\r\n\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'status' | 'person' | 'team';\r\n      loadQuestions(panel, props);\r\n    });\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-question-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showQuestionModal({\r\n        mode: 'create',\r\n        onSave: () => loadQuestions(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Generate for team button\r\n  const generateBtn = panel.querySelector('#generate-team-btn');\r\n  if (generateBtn) {\r\n    on(generateBtn as HTMLElement, 'click', () => showGenerateForTeamDialog(panel, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadQuestions(panel, props);\r\n\r\n  // Subscribe to data changes\r\n  dataStore.subscribe(() => {\r\n    updateCount(panel);\r\n  });\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load questions\r\n */\r\nasync function loadQuestions(panel: HTMLElement, props: QuestionsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#questions-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    let questions: Question[] = [];\r\n\r\n    if (currentView === 'status') {\r\n      // Handle special filters\r\n      if (currentFilter === 'overdue') {\r\n        // Get all pending/assigned questions and filter by SLA breach\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => \r\n          q.sla_breached === true || \r\n          (q.status !== 'resolved' && q.status !== 'dismissed' && isOverdue(q))\r\n        );\r\n      } else if (currentFilter === 'critical') {\r\n        // Filter by critical priority\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.priority === 'critical' && q.status !== 'resolved' && q.status !== 'dismissed');\r\n      } else if (currentFilter === 'all') {\r\n        // \"All\" means all ACTIVE questions - exclude dismissed/resolved\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'closed');\r\n      } else if (currentFilter === 'dismissed') {\r\n        // Specifically show dismissed questions\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status === 'dismissed');\r\n      } else if (currentFilter === 'resolved') {\r\n        // Specifically show resolved/answered questions\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status === 'resolved' || q.status === 'answered');\r\n      } else {\r\n        // Filter by specific status (pending, assigned, etc.)\r\n        questions = await questionsService.getAll();\r\n        questions = questions.filter(q => q.status === currentFilter);\r\n      }\r\n      renderByStatus(content, questions, props);\r\n    } else if (currentView === 'person') {\r\n      const grouped = await questionsService.getByPerson();\r\n      renderGrouped(content, grouped, props);\r\n    } else if (currentView === 'team') {\r\n      const grouped = await questionsService.getByTeam();\r\n      renderGrouped(content, grouped, props);\r\n    }\r\n\r\n    // Update store\r\n    if (currentView === 'status') {\r\n      dataStore.setQuestions(questions as unknown as []);\r\n    }\r\n\r\n    updateCount(panel);\r\n  } catch (error) {\r\n    content.innerHTML = '<div class=\"error\">Failed to load questions</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a question is overdue based on SLA\r\n */\r\nfunction isOverdue(question: Question): boolean {\r\n  if (!question.created_at) return false;\r\n  const slaHours = question.sla_hours || 168; // 7 days default\r\n  const created = new Date(question.created_at);\r\n  const deadline = new Date(created.getTime() + slaHours * 60 * 60 * 1000);\r\n  return new Date() > deadline;\r\n}\r\n\r\n/**\r\n * Render questions by status\r\n */\r\nfunction renderByStatus(container: HTMLElement, questions: Question[], props: QuestionsPanelProps): void {\r\n  if (questions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No questions found</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Question</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showQuestionModal({ mode: 'create' });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = questions.map(q => createQuestionCard(q)).join('');\r\n  bindCardEvents(container, questions, props);\r\n}\r\n\r\n/**\r\n * Render grouped questions\r\n */\r\nfunction renderGrouped(\r\n  container: HTMLElement,\r\n  grouped: Record<string, Question[]>,\r\n  props: QuestionsPanelProps\r\n): void {\r\n  const groups = Object.entries(grouped);\r\n  \r\n  if (groups.length === 0) {\r\n    container.innerHTML = '<div class=\"empty-state\"><p>No questions found</p></div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = groups.map(([groupName, questions]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(groupName)}</h3>\r\n        <span class=\"group-count\">${questions.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${questions.map(q => createQuestionCard(q)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Flatten for event binding\r\n  const allQuestions = groups.flatMap(([, qs]) => qs);\r\n  bindCardEvents(container, allQuestions, props);\r\n}\r\n\r\n/**\r\n * Create question card HTML - SOTA Design\r\n */\r\nfunction createQuestionCard(question: Question): string {\r\n  const priorityClass = `priority-${question.priority}`;\r\n  const statusClass = `status-${question.status}`;\r\n  const slaBreached = question.sla_breached;\r\n  const autoDetected = question.answer_source === 'auto-detected';\r\n  const hasAnswer = !!question.answer;\r\n  const hasRequesterRole = !!question.requester_role;\r\n\r\n  // Get initials for avatar\r\n  const getInitials = (name: string): string => {\r\n    if (!name) return '?';\r\n    const parts = name.trim().split(/\\s+/);\r\n    return parts.length === 1 \r\n      ? parts[0].substring(0, 2).toUpperCase() \r\n      : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n  };\r\n\r\n  // Build the card HTML\r\n  let html = `<div class=\"question-card-sota${slaBreached ? ' sla-breached' : ''}${hasAnswer ? ' has-answer' : ''}\" data-id=\"${question.id}\">`;\r\n  \r\n  // Priority Bar\r\n  html += `<div class=\"card-priority-bar ${priorityClass}\"></div>`;\r\n  \r\n  // Card Body\r\n  html += `<div class=\"card-body\">`;\r\n  \r\n  // Top Row\r\n  html += `<div class=\"card-top-row\">`;\r\n  html += `<div class=\"card-badges\">`;\r\n  html += `<span class=\"priority-pill ${priorityClass}\">${question.priority}</span>`;\r\n  html += `<span class=\"status-pill ${statusClass}\">${question.status}</span>`;\r\n  if (slaBreached) html += `<span class=\"sla-pill\">SLA</span>`;\r\n  if (autoDetected) html += `<span class=\"auto-pill\">Answer Found</span>`;\r\n  if (question.follow_up_to) html += `<span class=\"followup-pill\">Follow-up</span>`;\r\n  html += `</div>`; // .card-badges\r\n  html += `<span class=\"card-timestamp\">${formatRelativeTime(question.created_at)}</span>`;\r\n  html += `</div>`; // .card-top-row\r\n  \r\n  // Question Text\r\n  html += `<div class=\"card-question-text\">${escapeHtml(question.content)}</div>`;\r\n  \r\n  // Bottom Row\r\n  html += `<div class=\"card-bottom-row\">`;\r\n  \r\n  // Get contacts for photo lookup\r\n  const contacts = dataStore.getState().contacts || [];\r\n  \r\n  // Helper to get photo URL\r\n  const getPhotoUrl = (name: string, contactId?: string): string | null => {\r\n    const contact = contactId \r\n      ? contacts.find((c: any) => c.id === contactId)\r\n      : contacts.find((c: any) => c.name === name);\r\n    return contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url || null;\r\n  };\r\n  \r\n  // Helper to render avatar (photo or initials)\r\n  const renderAvatar = (name: string, photoUrl: string | null, cssClass: string): string => {\r\n    if (photoUrl) {\r\n      return `<div class=\"${cssClass}\"><img src=\"${photoUrl}\" alt=\"${escapeHtml(name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\"></div>`;\r\n    }\r\n    return `<div class=\"${cssClass}\">${getInitials(name)}</div>`;\r\n  };\r\n  \r\n  // Left: Requester (who is asking) - shows avatar + name + role\r\n  html += `<div class=\"card-requester\">`;\r\n  if (hasRequesterRole) {\r\n    const requesterName = (question as any).requester_name || '';\r\n    const requesterRole = question.requester_role || '';\r\n    const requesterContactId = (question as any).requester_contact_id;\r\n    const requesterPhotoUrl = getPhotoUrl(requesterName, requesterContactId);\r\n    \r\n    html += `<div class=\"requester-chip\">`;\r\n    html += renderAvatar(requesterName || requesterRole, requesterPhotoUrl, 'requester-avatar');\r\n    html += `<div class=\"requester-info\">`;\r\n    if (requesterName) {\r\n      html += `<span class=\"requester-name\">${escapeHtml(requesterName)}</span>`;\r\n    }\r\n    html += `<span class=\"requester-role\">${escapeHtml(requesterRole)}</span>`;\r\n    html += `</div>`;\r\n    html += `</div>`;\r\n  }\r\n  html += `</div>`; // .card-requester\r\n  \r\n  // Right: Assignment (who should answer) - shows avatar + name\r\n  html += `<div class=\"card-assignment\">`;\r\n  if (question.assigned_to) {\r\n    const assigneePhotoUrl = getPhotoUrl(question.assigned_to);\r\n    \r\n    html += `<div class=\"assignee-chip\">`;\r\n    html += renderAvatar(question.assigned_to, assigneePhotoUrl, 'assignee-avatar');\r\n    html += `<div class=\"assignee-info\">`;\r\n    html += `<span class=\"assignee-name\">${escapeHtml(question.assigned_to)}</span>`;\r\n    if (hasAnswer) html += `<span class=\"answered-badge\">Answered</span>`;\r\n    html += `</div>`;\r\n    html += `</div>`;\r\n  } else {\r\n    html += `<div class=\"unassigned-chip\">`;\r\n    html += `<span>Unassigned</span>`;\r\n    html += `</div>`;\r\n  }\r\n  html += `</div>`; // .card-assignment\r\n  \r\n  html += `</div>`; // .card-bottom-row\r\n  html += `</div>`; // .card-body\r\n  html += `</div>`; // .question-card-sota\r\n  \r\n  return html;\r\n}\r\n\r\n/**\r\n * Bind card click events\r\n */\r\nfunction bindCardEvents(container: HTMLElement, questions: Question[], props: QuestionsPanelProps): void {\r\n  container.querySelectorAll('.question-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const question = questions.find(q => String(q.id) === id);\r\n      if (question) {\r\n        if (props.onQuestionClick) {\r\n          props.onQuestionClick(question);\r\n        } else if (props.useDetailView && props.containerElement) {\r\n          // Replace panel with detail view\r\n          showQuestionDetailView(question, props);\r\n        } else {\r\n          // Fallback to modal\r\n          showQuestionModal({\r\n            mode: 'view',\r\n            question,\r\n            onSave: () => loadQuestions(container.closest('.questions-panel') as HTMLElement, props),\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show question detail view (replaces panel content)\r\n */\r\nfunction showQuestionDetailView(question: Question, props: QuestionsPanelProps): void {\r\n  const containerEl = props.containerElement;\r\n  if (!containerEl) return;\r\n\r\n  // Store current panel content for restoration\r\n  const panelContent = containerEl.innerHTML;\r\n\r\n  // Create detail view\r\n  const detailView = createQuestionDetailView({\r\n    question,\r\n    onClose: () => {\r\n      // Restore panel content\r\n      containerEl.innerHTML = panelContent;\r\n      // Re-initialize the panel\r\n      const panel = containerEl.querySelector('.questions-panel');\r\n      if (panel) {\r\n        loadQuestions(panel as HTMLElement, props);\r\n      }\r\n    },\r\n    onUpdate: (updatedQuestion) => {\r\n      // If question was dismissed/resolved, close detail view and refresh list\r\n      if (updatedQuestion.status === 'dismissed' || updatedQuestion.status === 'resolved' || updatedQuestion.status === 'closed') {\r\n        // Restore panel content and reload\r\n        containerEl.innerHTML = panelContent;\r\n        const panel = containerEl.querySelector('.questions-panel');\r\n        if (panel) {\r\n          loadQuestions(panel as HTMLElement, props);\r\n        }\r\n        toast.info('Question updated - returning to list');\r\n      }\r\n    },\r\n    onNavigateToQuestion: async (questionId) => {\r\n      // Navigate to another question\r\n      try {\r\n        const questions = await questionsService.getAll();\r\n        const targetQuestion = questions.find(q => String(q.id) === questionId);\r\n        if (targetQuestion) {\r\n          showQuestionDetailView(targetQuestion, props);\r\n        }\r\n      } catch (e) {\r\n        toast.error('Failed to load question');\r\n      }\r\n    }\r\n  });\r\n\r\n  // Replace content with detail view\r\n  containerEl.innerHTML = '';\r\n  containerEl.appendChild(detailView);\r\n}\r\n\r\n/**\r\n * Show AI-powered generate questions dialog (SOTA version)\r\n * Uses the universal modal-sota.css system\r\n */\r\nasync function showGenerateForTeamDialog(panel: HTMLElement, props: QuestionsPanelProps): Promise<void> {\r\n  const modal = document.createElement('div');\r\n  modal.className = 'modal open';\r\n  modal.id = 'generate-ai-modal';\r\n  modal.innerHTML = `\r\n    <div class=\"modal-backdrop\"></div>\r\n    <div class=\"modal-container modal-sota modal-sota-relative\">\r\n      <!-- Header -->\r\n      <div class=\"sota-header header-primary\">\r\n        <div class=\"header-row\">\r\n          <div class=\"header-icon\">\r\n            <svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <path d=\"M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z\"/>\r\n              <circle cx=\"7.5\" cy=\"14.5\" r=\"1.5\"/><circle cx=\"16.5\" cy=\"14.5\" r=\"1.5\"/>\r\n            </svg>\r\n          </div>\r\n          <div class=\"header-text\">\r\n            <h2>AI Question Generator</h2>\r\n            <p>Generate contextual questions for your project team</p>\r\n          </div>\r\n        </div>\r\n        <button class=\"header-close\" id=\"close-modal\">\r\n          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Tabs -->\r\n      <div class=\"sota-tabs\">\r\n        <button class=\"sota-tab active\" data-source=\"team\">\r\n          <span class=\"tab-icon\"></span>\r\n          <span>Team Members</span>\r\n        </button>\r\n        <button class=\"sota-tab\" data-source=\"contacts\">\r\n          <span class=\"tab-icon\"></span>\r\n          <span>Project Contacts</span>\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Body -->\r\n      <div class=\"sota-body\">\r\n        <!-- Section: Roles -->\r\n        <div class=\"sota-section\">\r\n          <div class=\"section-title\">\r\n            <span class=\"title-icon\"></span>\r\n            <span>Select a Role</span>\r\n          </div>\r\n          <div id=\"roles-grid\" class=\"sota-grid\">\r\n            <div class=\"sota-loading\">\r\n              <div class=\"spinner-ring\"></div>\r\n              <p>Loading roles...</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Section: Configuration (hidden until role selected) -->\r\n        <div class=\"sota-section hidden\" id=\"config-section\">\r\n          <div id=\"selected-badge\"></div>\r\n          \r\n          <div class=\"config-row\">\r\n            <label>Questions to generate</label>\r\n            <div class=\"config-buttons\">\r\n              <button class=\"config-btn active\" data-count=\"auto\" title=\"AI determines optimal count\"> Auto</button>\r\n              <button class=\"config-btn\" data-count=\"3\">3</button>\r\n              <button class=\"config-btn\" data-count=\"5\">5</button>\r\n              <button class=\"config-btn\" data-count=\"8\">8</button>\r\n            </div>\r\n          </div>\r\n\r\n          <label class=\"toggle-row\">\r\n            <input type=\"checkbox\" id=\"use-context\" checked>\r\n            <span class=\"toggle-track\"><span class=\"toggle-thumb\"></span></span>\r\n            <span>Use project context (facts, documents)</span>\r\n          </label>\r\n          \r\n          <label class=\"toggle-row\">\r\n            <input type=\"checkbox\" id=\"skip-dupes\" checked>\r\n            <span class=\"toggle-track\"><span class=\"toggle-thumb\"></span></span>\r\n            <span>Skip duplicate questions</span>\r\n          </label>\r\n\r\n          <button class=\"sota-btn-primary sota-btn-mt\" id=\"btn-generate\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polygon points=\"13 2 3 14 12 14 11 22 21 10 12 10 13 2\"/>\r\n            </svg>\r\n            Generate Questions\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Overlay for generation -->\r\n      <div class=\"sota-overlay hidden\" id=\"gen-overlay\">\r\n        <div id=\"gen-content\">\r\n          <div class=\"overlay-spinner\"></div>\r\n          <h4 class=\"overlay-title\">Generating questions...</h4>\r\n          <p class=\"overlay-subtitle\">AI is analyzing your project context</p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(modal);\r\n\r\n  // State\r\n  type RoleData = { role: string; rolePrompt?: string; members: Array<{ id: string; name: string; photoUrl?: string; email?: string }> };\r\n  let currentSource: 'team' | 'contacts' = 'team';\r\n  let selectedRole: RoleData | null = null;\r\n  let allRoles: RoleData[] = [];\r\n  let questionCount: number | 'auto' = 'auto';\r\n\r\n  // Elements\r\n  const rolesGrid = modal.querySelector('#roles-grid') as HTMLElement;\r\n  const configSection = modal.querySelector('#config-section') as HTMLElement;\r\n  const selectedBadge = modal.querySelector('#selected-badge') as HTMLElement;\r\n  const genOverlay = modal.querySelector('#gen-overlay') as HTMLElement;\r\n  const genContent = modal.querySelector('#gen-content') as HTMLElement;\r\n\r\n  // Helpers\r\n  const getInitials = (name: string) => {\r\n    if (!name) return '?';\r\n    return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\r\n  };\r\n  \r\n  const getRoleIcon = (role: string): string => {\r\n    const r = role.toLowerCase();\r\n    if (r.includes('analyst') || r.includes('data')) return '';\r\n    if (r.includes('manager') || r.includes('lead')) return '';\r\n    if (r.includes('developer') || r.includes('engineer')) return '';\r\n    if (r.includes('design') || r.includes('ux')) return '';\r\n    if (r.includes('product') || r.includes('owner')) return '';\r\n    if (r.includes('qa') || r.includes('test')) return '';\r\n    if (r.includes('support') || r.includes('success')) return '';\r\n    if (r.includes('sales') || r.includes('commercial')) return '';\r\n    if (r.includes('marketing')) return '';\r\n    if (r.includes('security')) return '';\r\n    if (r.includes('devops') || r.includes('infra')) return '';\r\n    if (r.includes('legal')) return '';\r\n    return '';\r\n  };\r\n\r\n  // Load roles based on source\r\n  const loadRoles = async (source: 'team' | 'contacts') => {\r\n    rolesGrid.innerHTML = '<div class=\"sota-loading\"><div class=\"spinner-ring\"></div><p>Loading roles...</p></div>';\r\n    configSection.classList.add('hidden');\r\n    selectedRole = null;\r\n\r\n    try {\r\n      let roles: RoleData[] = [];\r\n\r\n      if (source === 'team') {\r\n        const res = await http.get<{ roles: RoleData[] }>('/api/questions/team-roles');\r\n        roles = res.data.roles || [];\r\n      } else {\r\n        // Load from contacts\r\n        const res = await http.get<{ contacts: Array<{ id: string; name: string; role?: string; photo_url?: string; email?: string }> }>('/api/contacts');\r\n        const contacts = res.data.contacts || [];\r\n        \r\n        // Group by role\r\n        const roleMap: Record<string, RoleData> = {};\r\n        for (const c of contacts) {\r\n          if (!c.role) continue;\r\n          if (!roleMap[c.role]) {\r\n            roleMap[c.role] = { role: c.role, members: [] };\r\n          }\r\n          roleMap[c.role].members.push({\r\n            id: c.id,\r\n            name: c.name,\r\n            photoUrl: c.photo_url,\r\n            email: c.email\r\n          });\r\n        }\r\n        roles = Object.values(roleMap);\r\n      }\r\n\r\n      allRoles = roles;\r\n\r\n      if (roles.length === 0) {\r\n        rolesGrid.innerHTML = `\r\n          <div class=\"sota-empty sota-empty-full\">\r\n            <div class=\"empty-icon\">${source === 'team' ? '' : ''}</div>\r\n            <h4>No ${source === 'team' ? 'Team Members' : 'Contacts'} with Roles</h4>\r\n            <p>${source === 'team' \r\n              ? 'Add team members with roles in Project Settings' \r\n              : 'Add contacts with roles to this project'}</p>\r\n          </div>\r\n        `;\r\n        return;\r\n      }\r\n\r\n      rolesGrid.innerHTML = roles.map((r, idx) => `\r\n        <div class=\"sota-card\" data-idx=\"${idx}\">\r\n          <div class=\"card-icon\">${getRoleIcon(r.role)}</div>\r\n          <div class=\"card-title\">${escapeHtml(r.role)}</div>\r\n          <div class=\"card-avatars\">\r\n            ${r.members.slice(0, 3).map(m => `\r\n              <div class=\"mini-avatar\" title=\"${escapeHtml(m.name)}\">\r\n                ${m.photoUrl \r\n                  ? `<img src=\"${m.photoUrl}\" alt=\"\" class=\"mini-avatar-img\" onerror=\"this.classList.add('hidden');this.nextElementSibling.classList.remove('hidden')\">`\r\n                  : ''}\r\n                <span class=\"avatar-fallback${m.photoUrl ? ' hidden' : ''}\">${getInitials(m.name)}</span>\r\n              </div>\r\n            `).join('')}\r\n            ${r.members.length > 3 ? `<div class=\"mini-avatar more\">+${r.members.length - 3}</div>` : ''}\r\n          </div>\r\n          <div class=\"card-subtitle\">${r.members.map(m => m.name).slice(0, 2).join(', ')}${r.members.length > 2 ? '...' : ''}</div>\r\n          <div class=\"card-badge\">${r.members.length}</div>\r\n        </div>\r\n      `).join('');\r\n\r\n      // Bind clicks\r\n      rolesGrid.querySelectorAll('.sota-card').forEach(card => {\r\n        card.addEventListener('click', () => {\r\n          rolesGrid.querySelectorAll('.sota-card').forEach(c => c.classList.remove('selected'));\r\n          card.classList.add('selected');\r\n          \r\n          const idx = parseInt(card.getAttribute('data-idx') || '0', 10);\r\n          selectedRole = allRoles[idx];\r\n          showConfig();\r\n        });\r\n      });\r\n\r\n    } catch (err) {\r\n      rolesGrid.innerHTML = `\r\n        <div class=\"sota-empty sota-empty-full\">\r\n          <div class=\"empty-icon\"></div>\r\n          <h4>Failed to Load</h4>\r\n          <p>Could not fetch roles. Please try again.</p>\r\n          <button class=\"sota-btn-primary sota-btn-retry\" id=\"retry-load\">Retry</button>\r\n        </div>\r\n      `;\r\n      modal.querySelector('#retry-load')?.addEventListener('click', () => loadRoles(source));\r\n    }\r\n  };\r\n\r\n  // Show config panel\r\n  const showConfig = () => {\r\n    if (!selectedRole) return;\r\n    \r\n    configSection.classList.remove('hidden');\r\n    selectedBadge.innerHTML = `\r\n      <div class=\"selected-badge\">\r\n        <span class=\"badge-icon\">${getRoleIcon(selectedRole.role)}</span>\r\n        <div class=\"badge-info\">\r\n          <strong>${escapeHtml(selectedRole.role)}</strong>\r\n          <span>${selectedRole.members.map(m => m.name).join(', ')}</span>\r\n        </div>\r\n        <button class=\"badge-clear\" id=\"clear-selection\"></button>\r\n      </div>\r\n    `;\r\n\r\n    modal.querySelector('#clear-selection')?.addEventListener('click', () => {\r\n      selectedRole = null;\r\n      configSection.classList.add('hidden');\r\n      rolesGrid.querySelectorAll('.sota-card').forEach(c => c.classList.remove('selected'));\r\n    });\r\n  };\r\n\r\n  // Generate questions\r\n  const generateQuestions = async () => {\r\n    if (!selectedRole) return;\r\n\r\n    genOverlay.classList.remove('hidden');\r\n\r\n    try {\r\n      const res = await http.post<{\r\n        generated: number;\r\n        skipped: number;\r\n        questions: Array<{ content: string; priority: string; requester_role: string }>;\r\n      }>('/api/questions/generate-ai', {\r\n        role: selectedRole.role,\r\n        memberIds: selectedRole.members.map(m => m.id),\r\n        count: questionCount,\r\n        includeContext: (modal.querySelector('#use-context') as HTMLInputElement)?.checked ?? true,\r\n        skipDuplicates: (modal.querySelector('#skip-dupes') as HTMLInputElement)?.checked ?? true\r\n      });\r\n\r\n      const q = res.data.questions || [];\r\n\r\n      genContent.innerHTML = `\r\n        <div class=\"sota-success\">\r\n          <div class=\"success-icon\"></div>\r\n          <h4>${res.data.generated} Questions Generated</h4>\r\n          <p>${res.data.skipped > 0 ? `${res.data.skipped} duplicates skipped` : 'All questions created successfully'}</p>\r\n        </div>\r\n        <div class=\"results-list\">\r\n          ${q.slice(0, 5).map(item => `\r\n            <div class=\"result-row\">\r\n              <span class=\"result-badge ${item.priority}\">${item.priority}</span>\r\n              <span class=\"result-text\">${escapeHtml(item.content.length > 70 ? item.content.substring(0, 70) + '...' : item.content)}</span>\r\n            </div>\r\n          `).join('')}\r\n          ${q.length > 5 ? `<p class=\"sota-more-hint\">+ ${q.length - 5} more questions</p>` : ''}\r\n        </div>\r\n        <p class=\"sota-questions-footer\">\r\n           Questions from <strong>${selectedRole?.role}</strong> perspective<br>\r\n          <span class=\"sota-questions-footer-muted\">Use AI Suggest on each question to find who should answer</span>\r\n        </p>\r\n        <button class=\"sota-btn-primary\" id=\"btn-done\">Done</button>\r\n      `;\r\n\r\n      modal.querySelector('#btn-done')?.addEventListener('click', () => {\r\n        modal.remove();\r\n        loadQuestions(panel, props);\r\n      });\r\n\r\n    } catch (err) {\r\n      genContent.innerHTML = `\r\n        <div class=\"sota-error\">\r\n          <div class=\"error-icon\"></div>\r\n          <h4>Generation Failed</h4>\r\n          <p>Something went wrong. Please try again.</p>\r\n          <button class=\"sota-btn-primary sota-btn-retry sota-btn-retry-mt\" id=\"retry-gen\">Retry</button>\r\n        </div>\r\n      `;\r\n      modal.querySelector('#retry-gen')?.addEventListener('click', generateQuestions);\r\n    }\r\n  };\r\n\r\n  // Bind events\r\n  modal.querySelector('#close-modal')?.addEventListener('click', () => modal.remove());\r\n  modal.querySelector('.modal-backdrop')?.addEventListener('click', () => modal.remove());\r\n\r\n  // Source tabs\r\n  modal.querySelectorAll('.sota-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      modal.querySelectorAll('.sota-tab').forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentSource = (tab.getAttribute('data-source') as 'team' | 'contacts') || 'team';\r\n      loadRoles(currentSource);\r\n    });\r\n  });\r\n\r\n  // Count buttons\r\n  modal.querySelectorAll('.config-btn').forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      modal.querySelectorAll('.config-btn').forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n      const countVal = btn.getAttribute('data-count') || 'auto';\r\n      questionCount = countVal === 'auto' ? 'auto' : parseInt(countVal, 10);\r\n    });\r\n  });\r\n\r\n  // Generate button\r\n  modal.querySelector('#btn-generate')?.addEventListener('click', generateQuestions);\r\n\r\n  // Initial load\r\n  loadRoles('team');\r\n}\r\n\r\n/**\r\n * Update count badge\r\n */\r\nfunction updateCount(panel: HTMLElement): void {\r\n  const countEl = panel.querySelector('#questions-count');\r\n  if (countEl) {\r\n    const questions = dataStore.getState().questions;\r\n    countEl.textContent = String(questions.length);\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createQuestionsPanel;\r\n","/**\r\n * Source of Truth Component\r\n * Displays questions, risks, actions, and decisions\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../utils/dom';\r\nimport { uiStore, SotView } from '../stores/ui';\r\nimport { dataStore, Question, Risk, Action, Decision } from '../stores/data';\r\nimport { formatRelativeTime } from '../utils/format';\r\nimport { createQuestionDetailView } from './questions/QuestionDetailView';\r\nimport { Question as QuestionAPI } from '../services/questions';\r\nimport { createQuestionsPanel as createFullQuestionsPanel } from './sot/QuestionsPanel';\r\n\r\nexport interface SourceOfTruthProps {\r\n  onQuestionClick?: (question: Question) => void;\r\n  onRiskClick?: (risk: Risk) => void;\r\n  onActionClick?: (action: Action) => void;\r\n  onDecisionClick?: (decision: Decision) => void;\r\n}\r\n\r\n/**\r\n * Create Source of Truth component\r\n */\r\nexport function createSourceOfTruth(props: SourceOfTruthProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'source-of-truth' });\r\n\r\n  // Tabs\r\n  const tabs = createElement('div', { className: 'tabs' });\r\n  const tabConfigs: Array<{ id: SotView; label: string; icon: string }> = [\r\n    { id: 'questions', label: 'Questions', icon: '' },\r\n    { id: 'risks', label: 'Risks', icon: '' },\r\n    { id: 'actions', label: 'Actions', icon: '' },\r\n    { id: 'decisions', label: 'Decisions', icon: '' },\r\n  ];\r\n\r\n  tabConfigs.forEach(config => {\r\n    const tab = createElement('button', {\r\n      className: 'tab',\r\n    });\r\n    tab.setAttribute('data-tab', config.id);\r\n    tab.innerHTML = `${config.icon} ${config.label} <span class=\"badge\" data-count=\"0\">0</span>`;\r\n\r\n    on(tab, 'click', () => {\r\n      uiStore.setSotView(config.id);\r\n    });\r\n\r\n    tabs.appendChild(tab);\r\n  });\r\n\r\n  container.appendChild(tabs);\r\n\r\n  // Content panels\r\n  const panels = createElement('div', { className: 'tab-panels' });\r\n\r\n  // Use the full QuestionsPanel with Generate button and filters\r\n  const questionsPanel = createFullQuestionsPanel({\r\n    onQuestionClick: props.onQuestionClick as unknown as (q: QuestionAPI) => void,\r\n    useDetailView: true,\r\n    containerElement: container\r\n  });\r\n  questionsPanel.classList.add('tab-panel');\r\n  \r\n  const risksPanel = createRisksPanel(props.onRiskClick);\r\n  const actionsPanel = createActionsPanel(props.onActionClick);\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const decisionsPanel = createDecisionsPanel({\r\n    onDecisionClick: props.onDecisionClick as any,\r\n    useDetailView: true,\r\n    containerElement: container\r\n  });\r\n\r\n  questionsPanel.setAttribute('data-panel', 'questions');\r\n  risksPanel.setAttribute('data-panel', 'risks');\r\n  actionsPanel.setAttribute('data-panel', 'actions');\r\n  decisionsPanel.setAttribute('data-panel', 'decisions');\r\n\r\n  panels.appendChild(questionsPanel);\r\n  panels.appendChild(risksPanel);\r\n  panels.appendChild(actionsPanel);\r\n  panels.appendChild(decisionsPanel);\r\n\r\n  container.appendChild(panels);\r\n\r\n  // Subscribe to UI state changes\r\n  uiStore.subscribe((state) => {\r\n    // Update active tab\r\n    tabs.querySelectorAll('.tab').forEach(tab => {\r\n      const tabId = tab.getAttribute('data-tab');\r\n      if (tabId === state.sotCurrentView) {\r\n        addClass(tab as HTMLElement, 'active');\r\n      } else {\r\n        removeClass(tab as HTMLElement, 'active');\r\n      }\r\n    });\r\n\r\n    // Update active panel\r\n    panels.querySelectorAll('[data-panel]').forEach(panel => {\r\n      const panelId = panel.getAttribute('data-panel');\r\n      if (panelId === state.sotCurrentView) {\r\n        addClass(panel as HTMLElement, 'active');\r\n      } else {\r\n        removeClass(panel as HTMLElement, 'active');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Subscribe to data changes\r\n  dataStore.subscribe((data) => {\r\n    // Update badges\r\n    const questionsBadge = tabs.querySelector('[data-tab=\"questions\"] .badge');\r\n    const risksBadge = tabs.querySelector('[data-tab=\"risks\"] .badge');\r\n    const actionsBadge = tabs.querySelector('[data-tab=\"actions\"] .badge');\r\n    const decisionsBadge = tabs.querySelector('[data-tab=\"decisions\"] .badge');\r\n\r\n    if (questionsBadge) questionsBadge.textContent = String(data.questions.length);\r\n    if (risksBadge) risksBadge.textContent = String(data.risks.length);\r\n    if (actionsBadge) actionsBadge.textContent = String(data.actions.length);\r\n    if (decisionsBadge) decisionsBadge.textContent = String(data.decisions.length);\r\n\r\n    // Re-render panels\r\n    renderQuestions(questionsPanel, data.questions, props.onQuestionClick);\r\n    renderRisks(risksPanel, data.risks, props.onRiskClick);\r\n    renderActions(actionsPanel, data.actions, props.onActionClick);\r\n    renderDecisions(decisionsPanel, data.decisions, props.onDecisionClick);\r\n  });\r\n\r\n  // Set initial active state\r\n  const initialView = uiStore.getState().sotCurrentView;\r\n  const initialTab = tabs.querySelector(`[data-tab=\"${initialView}\"]`);\r\n  const initialPanel = panels.querySelector(`[data-panel=\"${initialView}\"]`);\r\n  if (initialTab) addClass(initialTab as HTMLElement, 'active');\r\n  if (initialPanel) addClass(initialPanel as HTMLElement, 'active');\r\n\r\n  return container;\r\n}\r\n\r\n// NOTE: createQuestionsPanel is now imported from './sot/QuestionsPanel' as createFullQuestionsPanel\r\n// The legacy inline version has been removed in favor of the full-featured panel\r\n\r\n/**\r\n * Render questions list\r\n */\r\nfunction renderQuestions(panel: HTMLElement, questions: Question[], onClick?: (q: Question) => void): void {\r\n  const list = panel.querySelector('.questions-list');\r\n  if (!list) return;\r\n\r\n  if (questions.length === 0) {\r\n    list.innerHTML = '<div class=\"empty-state\">No questions yet</div>';\r\n    return;\r\n  }\r\n\r\n  list.innerHTML = questions.map(q => `\r\n    <div class=\"question-card ${q.status}\" data-id=\"${q.id}\">\r\n      <div class=\"question-header\">\r\n        <span class=\"priority-badge priority-${q.priority}\">${q.priority}</span>\r\n        <span class=\"status-badge ${q.status}\">${q.status}</span>\r\n      </div>\r\n      <div class=\"question-text\">${escapeHtml(q.content || q.question || '')}</div>\r\n      ${q.answer ? `<div class=\"question-answer\">${escapeHtml(q.answer)}</div>` : ''}\r\n      <div class=\"question-meta\">${formatRelativeTime(q.created_at || q.createdAt || new Date().toISOString())}</div>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Always bind click to open detail view\r\n  list.querySelectorAll('.question-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const question = questions.find(q => q.id === id || String(q.id) === id);\r\n      if (question) {\r\n        // Call onClick if provided (for modal fallback)\r\n        if (onClick) {\r\n          onClick(question);\r\n        }\r\n        \r\n        // Show the detail view\r\n        showQuestionDetail(panel, question as unknown as QuestionAPI, questions as unknown as QuestionAPI[]);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show question detail view (replaces the panel content)\r\n */\r\nfunction showQuestionDetail(panel: HTMLElement, question: QuestionAPI, allQuestions: QuestionAPI[]): void {\r\n  // Store original content\r\n  const originalContent = panel.innerHTML;\r\n  \r\n  // Create detail view\r\n  const detailView = createQuestionDetailView({\r\n    question,\r\n    onClose: () => {\r\n      // Restore original content\r\n      panel.innerHTML = originalContent;\r\n      // Re-render questions\r\n      const questions = dataStore.getState().questions;\r\n      renderQuestions(panel, questions);\r\n    },\r\n    onUpdate: (updatedQuestion) => {\r\n      // Update the question in data store\r\n      const questions = dataStore.getState().questions;\r\n      const index = questions.findIndex(q => q.id === updatedQuestion.id || String(q.id) === String(updatedQuestion.id));\r\n      if (index >= 0) {\r\n        questions[index] = updatedQuestion as unknown as Question;\r\n        dataStore.setQuestions(questions);\r\n      }\r\n    },\r\n    onNavigateToQuestion: (questionId) => {\r\n      // Navigate to another question\r\n      const targetQuestion = allQuestions.find(q => String(q.id) === questionId);\r\n      if (targetQuestion) {\r\n        showQuestionDetail(panel, targetQuestion, allQuestions);\r\n      }\r\n    }\r\n  });\r\n  \r\n  // Replace panel content with detail view\r\n  panel.innerHTML = '';\r\n  panel.appendChild(detailView);\r\n}\r\n\r\n/**\r\n * Create risks panel\r\n */\r\nfunction createRisksPanel(onClick?: (r: Risk) => void): HTMLElement {\r\n  const panel = createElement('div', { className: 'tab-panel risks-panel' });\r\n  panel.innerHTML = '<div class=\"risks-list\"></div>';\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Render risks list\r\n */\r\nfunction renderRisks(panel: HTMLElement, risks: Risk[], onClick?: (r: Risk) => void): void {\r\n  const list = panel.querySelector('.risks-list');\r\n  if (!list) return;\r\n\r\n  if (risks.length === 0) {\r\n    list.innerHTML = '<div class=\"empty-state\">No risks identified</div>';\r\n    return;\r\n  }\r\n\r\n  list.innerHTML = risks.map(r => `\r\n    <div class=\"risk-card ${r.impact}-impact\" data-id=\"${r.id}\">\r\n      <div class=\"risk-header\">\r\n        <span class=\"impact-badge impact-${r.impact}\">${r.impact} impact</span>\r\n        <span class=\"probability-badge\">${r.probability} probability</span>\r\n      </div>\r\n      <div class=\"risk-description\">${escapeHtml(r.description || r.content || '')}</div>\r\n      ${r.mitigation ? `<div class=\"risk-mitigation\">Mitigation: ${escapeHtml(r.mitigation)}</div>` : ''}\r\n    </div>\r\n  `).join('');\r\n\r\n  if (onClick) {\r\n    list.querySelectorAll('.risk-card').forEach(card => {\r\n      on(card as HTMLElement, 'click', () => {\r\n        const id = card.getAttribute('data-id');\r\n        const risk = risks.find(r => r.id === id);\r\n        if (risk) onClick(risk);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Create actions panel\r\n */\r\nfunction createActionsPanel(onClick?: (a: Action) => void): HTMLElement {\r\n  const panel = createElement('div', { className: 'tab-panel actions-panel' });\r\n  panel.innerHTML = '<div class=\"actions-list\"></div>';\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Render actions list\r\n */\r\nfunction renderActions(panel: HTMLElement, actions: Action[], onClick?: (a: Action) => void): void {\r\n  const list = panel.querySelector('.actions-list');\r\n  if (!list) return;\r\n\r\n  if (actions.length === 0) {\r\n    list.innerHTML = '<div class=\"empty-state\">No actions defined</div>';\r\n    return;\r\n  }\r\n\r\n  list.innerHTML = actions.map(a => `\r\n    <div class=\"action-card ${a.status}\" data-id=\"${a.id}\">\r\n      <div class=\"action-header\">\r\n        <span class=\"priority-badge priority-${a.priority}\">${a.priority}</span>\r\n        <span class=\"status-badge ${a.status}\">${a.status.replace('_', ' ')}</span>\r\n      </div>\r\n      <div class=\"action-task\">${escapeHtml(a.task)}</div>\r\n      <div class=\"action-meta\">\r\n        ${a.assignee ? `<span>Assigned to: ${escapeHtml(a.assignee)}</span>` : ''}\r\n        ${a.dueDate ? `<span>Due: ${a.dueDate}</span>` : ''}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  if (onClick) {\r\n    list.querySelectorAll('.action-card').forEach(card => {\r\n      on(card as HTMLElement, 'click', () => {\r\n        const id = card.getAttribute('data-id');\r\n        const action = actions.find(a => a.id === id);\r\n        if (action) onClick(action);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Create decisions panel\r\n */\r\nfunction createDecisionsPanel(propsOrCallback?: { onDecisionClick?: (d: Decision) => void; useDetailView?: boolean; containerElement?: HTMLElement } | ((d: Decision) => void)): HTMLElement {\r\n  const panel = createElement('div', { className: 'tab-panel decisions-panel' });\r\n  panel.innerHTML = '<div class=\"decisions-list\"></div>';\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Render decisions list\r\n */\r\nfunction renderDecisions(panel: HTMLElement, decisions: Decision[], onClick?: (d: Decision) => void): void {\r\n  const list = panel.querySelector('.decisions-list');\r\n  if (!list) return;\r\n\r\n  if (decisions.length === 0) {\r\n    list.innerHTML = '<div class=\"empty-state\">No decisions recorded</div>';\r\n    return;\r\n  }\r\n\r\n  list.innerHTML = decisions.map(d => `\r\n    <div class=\"decision-card\" data-id=\"${d.id}\">\r\n      <div class=\"decision-header\">\r\n        <span class=\"status-badge ${d.status}\">${d.status}</span>\r\n      </div>\r\n      <div class=\"decision-text\">${escapeHtml((d as any).content ?? d.decision ?? '')}</div>\r\n      ${d.rationale ? `<div class=\"decision-rationale\">Rationale: ${escapeHtml(d.rationale)}</div>` : ''}\r\n      <div class=\"decision-meta\">\r\n        ${((d as any).made_by ?? d.madeBy) ? `<span>By: ${escapeHtml((d as any).made_by ?? d.madeBy ?? '')}</span>` : ''}\r\n        <span>${formatRelativeTime((d as any).decided_at ?? (d as any).created_at ?? d.madeAt ?? '')}</span>\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  if (onClick) {\r\n    list.querySelectorAll('.decision-card').forEach(card => {\r\n      on(card as HTMLElement, 'click', () => {\r\n        const id = card.getAttribute('data-id');\r\n        const decision = decisions.find(d => d.id === id);\r\n        if (decision) onClick(decision);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Mount to container\r\n */\r\nexport function mountSourceOfTruth(selector: string, props: SourceOfTruthProps = {}): HTMLElement | null {\r\n  const container = document.querySelector(selector);\r\n  if (!container) {\r\n    console.warn(`SourceOfTruth: Container not found: ${selector}`);\r\n    return null;\r\n  }\r\n\r\n  const sot = createSourceOfTruth(props);\r\n  container.appendChild(sot);\r\n  return sot;\r\n}\r\n\r\nexport default createSourceOfTruth;\r\n","/**\n * Risk Modal Component\n * Create, view and edit risks\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { Risk } from '../../stores/data';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\nimport { risksService } from '../../services/risks';\n\nconst MODAL_ID = 'risk-modal';\n\nexport interface RiskModalProps {\n  mode: 'view' | 'edit' | 'create';\n  risk?: Risk;\n  onSave?: (risk: Risk) => void;\n  onDelete?: (riskId: string) => void;\n}\n\n/**\n * Show risk modal\n */\nexport function showRiskModal(props: RiskModalProps): void {\n  const { mode, risk, onSave, onDelete } = props;\n  const isEdit = mode === 'edit' && risk?.id;\n  const isView = mode === 'view';\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'risk-modal-content' });\n\n  const riskDesc = risk?.description ?? (risk as { content?: string })?.content ?? '';\n  const riskProb = risk?.probability ?? (risk as { likelihood?: string })?.likelihood ?? 'medium';\n  const riskCreated = risk?.createdAt ?? (risk as { created_at?: string })?.created_at ?? '';\n\n  if (isView && risk) {\n    content.innerHTML = `\n      <div class=\"risk-view\">\n        <div class=\"risk-meta\">\n          <span class=\"impact-badge impact-${risk.impact}\">${risk.impact} impact</span>\n          <span class=\"probability-badge\">${riskProb} probability</span>\n          <span class=\"status-badge ${risk.status}\">${risk.status}</span>\n        </div>\n        \n        <div class=\"risk-description-large\">\n          ${escapeHtml(riskDesc)}\n        </div>\n        \n        ${risk.mitigation ? `\n          <div class=\"risk-mitigation-section\">\n            <h4>Mitigation Strategy</h4>\n            <p>${escapeHtml(risk.mitigation)}</p>\n          </div>\n        ` : ''}\n        \n        <div class=\"risk-date\">Created ${formatRelativeTime(riskCreated)}</div>\n      </div>\n    `;\n  } else {\n    const riskOwner = risk?.owner ?? '';\n    content.innerHTML = `\n      <form id=\"risk-form\" class=\"risk-form\">\n        <div class=\"form-group gm-flex gm-flex-center gm-gap-3 gm-flex-wrap\">\n          <label for=\"risk-description\" class=\"gm-mb-0\">Risk Description *</label>\n          <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-ai-suggest-btn\" title=\"Suggest owner and mitigation from description\"> AI suggest</button>\n        </div>\n        <div class=\"form-group\">\n          <textarea id=\"risk-description\" rows=\"3\" required \n                    placeholder=\"Describe the risk...\">${riskDesc}</textarea>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"risk-impact\">Impact</label>\n            <select id=\"risk-impact\">\n              <option value=\"low\" ${risk?.impact === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${risk?.impact === 'medium' || !risk ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${risk?.impact === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n          \n          <div class=\"form-group\">\n            <label for=\"risk-probability\">Probability</label>\n            <select id=\"risk-probability\">\n              <option value=\"low\" ${riskProb === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${riskProb === 'medium' ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${riskProb === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"risk-status\">Status</label>\n          <select id=\"risk-status\">\n            <option value=\"open\" ${risk?.status === 'open' || !risk ? 'selected' : ''}>Open</option>\n            <option value=\"mitigating\" ${risk?.status === 'mitigating' ? 'selected' : ''}>Mitigating</option>\n            <option value=\"mitigated\" ${risk?.status === 'mitigated' ? 'selected' : ''}>Mitigated</option>\n            <option value=\"accepted\" ${risk?.status === 'accepted' ? 'selected' : ''}>Accepted</option>\n            <option value=\"closed\" ${risk?.status === 'closed' ? 'selected' : ''}>Closed</option>\n          </select>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"risk-owner\">Owner</label>\n          <input type=\"text\" id=\"risk-owner\" class=\"form-input\" placeholder=\"Who owns this risk?\" value=\"${escapeHtml(riskOwner)}\">\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"risk-mitigation\">Mitigation Strategy</label>\n          <textarea id=\"risk-mitigation\" rows=\"3\" \n                    placeholder=\"How will this risk be mitigated?\">${risk?.mitigation || ''}</textarea>\n        </div>\n      </form>\n    `;\n\n    const suggestBtn = content.querySelector('#risk-ai-suggest-btn');\n    if (suggestBtn) {\n      on(suggestBtn as HTMLElement, 'click', async () => {\n        const descEl = content.querySelector('#risk-description') as HTMLTextAreaElement;\n        const impactEl = content.querySelector('#risk-impact') as HTMLSelectElement;\n        const probEl = content.querySelector('#risk-probability') as HTMLSelectElement;\n        const contentText = descEl?.value?.trim() || '';\n        if (!contentText) {\n          toast.error('Enter a risk description first');\n          return;\n        }\n        (suggestBtn as HTMLButtonElement).disabled = true;\n        (suggestBtn as HTMLButtonElement).textContent = '';\n        try {\n          const result = await risksService.suggest({\n            content: contentText,\n            impact: impactEl?.value || 'medium',\n            likelihood: probEl?.value || 'medium',\n          });\n          const ownerEl = content.querySelector('#risk-owner') as HTMLInputElement;\n          const mitigationEl = content.querySelector('#risk-mitigation') as HTMLTextAreaElement;\n          if (ownerEl && result.suggested_owner) ownerEl.value = result.suggested_owner;\n          if (mitigationEl && result.suggested_mitigation) mitigationEl.value = result.suggested_mitigation;\n          toast.success('Owner and mitigation suggested');\n        } catch (e) {\n          toast.error((e as Error).message || 'AI suggest failed');\n        } finally {\n          (suggestBtn as HTMLButtonElement).disabled = false;\n          (suggestBtn as HTMLButtonElement).textContent = ' AI suggest';\n        }\n      });\n    }\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  if (isView) {\n    const editBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Edit',\n    });\n\n    const closeBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Close',\n    });\n\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    on(editBtn, 'click', () => {\n      closeModal(MODAL_ID);\n      showRiskModal({ ...props, mode: 'edit' });\n    });\n\n    footer.appendChild(closeBtn);\n    footer.appendChild(editBtn);\n  } else {\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const saveBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: isEdit ? 'Save Changes' : 'Create Risk',\n    });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n    on(saveBtn, 'click', async () => {\n      const form = content.querySelector('#risk-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\n\n      const desc = getValue('risk-description');\n      const owner = getValue('risk-owner') || undefined;\n      const riskData: Risk & { content?: string; likelihood?: string; owner?: string } = {\n        id: risk?.id || `risk-${Date.now()}`,\n        description: desc,\n        content: desc,\n        impact: getValue('risk-impact') as Risk['impact'],\n        probability: getValue('risk-probability') as Risk['probability'],\n        likelihood: getValue('risk-probability') as 'low' | 'medium' | 'high',\n        status: getValue('risk-status') as Risk['status'],\n        mitigation: getValue('risk-mitigation') || undefined,\n        owner,\n        createdAt: risk?.createdAt ?? (risk as { created_at?: string })?.created_at ?? new Date().toISOString(),\n      };\n\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Saving...';\n\n      try {\n        if (isEdit) {\n          await http.put(`/api/risks/${risk!.id}`, { content: riskData.content ?? riskData.description, impact: riskData.impact, likelihood: riskData.likelihood ?? riskData.probability, mitigation: riskData.mitigation, status: riskData.status, owner: riskData.owner });\n          toast.success('Risk updated');\n        } else {\n          const response = await http.post<{ id: string; risk: Risk }>('/api/risks', { content: riskData.content ?? riskData.description, impact: riskData.impact, likelihood: riskData.likelihood ?? riskData.probability, mitigation: riskData.mitigation, status: riskData.status, owner: riskData.owner });\n          const created = response.data.risk;\n          if (created) riskData.id = created.id as string;\n          else riskData.id = response.data.id as string;\n          toast.success('Risk created');\n        }\n\n        onSave?.({ ...riskData, description: riskData.description ?? riskData.content, content: riskData.content ?? riskData.description } as Risk);\n        closeModal(MODAL_ID);\n      } catch {\n        // Error shown by API service\n      } finally {\n        saveBtn.disabled = false;\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Risk';\n      }\n    });\n\n    if (isEdit) {\n      const deleteBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Delete',\n      });\n\n      on(deleteBtn, 'click', async () => {\n        const { confirm } = await import('../Modal');\n        const confirmed = await confirm(\n          'Are you sure you want to delete this risk?',\n          {\n            title: 'Delete Risk',\n            confirmText: 'Delete',\n            confirmClass: 'btn-danger',\n          }\n        );\n\n        if (confirmed) {\n          try {\n            await http.delete(`/api/risks/${risk!.id}`);\n            toast.success('Risk deleted');\n            onDelete?.(String(risk!.id));\n            closeModal(MODAL_ID);\n          } catch {\n            // Error shown by API service\n          }\n        }\n      });\n\n      footer.appendChild(saveBtn);\n      footer.appendChild(cancelBtn);\n      footer.appendChild(deleteBtn);\n    } else {\n      footer.appendChild(saveBtn);\n      footer.appendChild(cancelBtn);\n    }\n  }\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: isView ? 'Risk Details' : (isEdit ? 'Edit Risk' : 'New Risk'),\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showRiskModal;\n","/**\r\n * Risk Detail View\r\n * Full-page view for risk details: content, impact, likelihood, mitigation, status, owner, source, timeline\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Risk, RiskEvent, RiskOwnerSuggestion, risksService } from '../../services/risks';\r\nimport { contactsService, Contact } from '../../services/contacts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\r\n\r\nexport interface RiskDetailViewProps {\r\n  risk: Risk;\r\n  onClose: () => void;\r\n  onUpdate?: (risk: Risk) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nfunction getScoreColor(score: number): string {\r\n  if (score >= 70) return 'var(--success, #4ecdc4)';\r\n  if (score >= 50) return 'var(--warning, #ffe66d)';\r\n  return 'var(--text-muted, #6a6a8a)';\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .trim()\r\n    .split(/\\s+/)\r\n    .map((s) => s[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .substring(0, 2);\r\n}\r\n\r\nfunction getRiskEventIcon(eventType: string): string {\r\n  const icons: Record<string, string> = {\r\n    created: '',\r\n    updated: '',\r\n    deleted: '',\r\n    restored: '',\r\n  };\r\n  return icons[eventType] || '';\r\n}\r\n\r\nfunction getRiskEventDescription(ev: RiskEvent): string {\r\n  const data = ev.event_data || {};\r\n  const actor = ev.actor_name ? ` by ${ev.actor_name}` : '';\r\n\r\n  switch (ev.event_type) {\r\n    case 'created':\r\n      return `Created${actor}`;\r\n    case 'updated': {\r\n      const changes = (data.changes as Array<{ field: string; from: string; to: string }>) || [];\r\n      if (changes.length === 0) return `Updated${actor}`;\r\n      if (changes.length === 1) {\r\n        const c = changes[0];\r\n        const toStr = String(c.to).trim() ? c.to : '';\r\n        const fromStr = String(c.from).trim() ? c.from : '';\r\n        return `${c.field} changed: ${fromStr}  ${toStr}${actor}`;\r\n      }\r\n      return `${changes.map((c) => `${c.field}: ${c.from || ''}  ${c.to || ''}`).join('; ')}${actor}`;\r\n    }\r\n    case 'deleted':\r\n      return `Deleted${data.reason ? ` (${data.reason})` : ''}${actor}`;\r\n    case 'restored':\r\n      return `Restored${actor}`;\r\n    default:\r\n      return ev.event_type;\r\n  }\r\n}\r\n\r\nexport function createRiskDetailView(props: RiskDetailViewProps): HTMLElement {\r\n  const { risk, onClose, onUpdate } = props;\r\n\r\n  const container = createElement('div', { className: 'risk-detail-view question-detail-view' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header risk-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Risks</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Risk #${String(risk.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        <span class=\"status-badge status-${(risk.status || 'open').toLowerCase()}\">${escapeHtml(String(risk.status))}</span>\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content risk-detail-content\">\r\n      <div id=\"risk-view-content\">\r\n      <section class=\"detail-section risk-main\">\r\n        <div class=\"question-badges risk-badges\">\r\n          ${risk.impact ? `<span class=\"priority-pill impact-${risk.impact}\">${escapeHtml(risk.impact)} impact</span>` : ''}\r\n          ${risk.likelihood ? `<span class=\"priority-pill likelihood-${risk.likelihood}\">${escapeHtml(risk.likelihood)} likelihood</span>` : ''}\r\n          ${risk.generation_source ? `<span class=\"status-pill\">${escapeHtml(risk.generation_source)}</span>` : ''}\r\n          <span class=\"question-date risk-date\">Created ${formatRelativeTime(risk.created_at)}</span>\r\n        </div>\r\n        <h2 class=\"question-text risk-content-text\">${escapeHtml(risk.content)}</h2>\r\n      </section>\r\n\r\n      <div class=\"detail-columns\">\r\n        <div class=\"detail-column-left\">\r\n          <!-- Assignment (Owner) Section - SOTA (aligned with Questions) -->\r\n          <section class=\"detail-section\" id=\"risk-assignment-section\">\r\n            <div class=\"section-header-sota\">\r\n              <h3>\r\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Assignment\r\n                <span class=\"section-subtitle\">Who should own this risk?</span>\r\n              </h3>\r\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"risk-ai-suggest-btn\" title=\"Suggest owner and mitigation from risk content\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI Suggest\r\n              </button>\r\n            </div>\r\n\r\n            <!-- Current Assignment (Owner) Display -->\r\n            <div id=\"risk-current-assignment\" class=\"current-assignment-card\">\r\n              ${risk.owner ? `\r\n                <div class=\"assigned-contact-display\">\r\n                  <div class=\"contact-avatar-lg\" id=\"risk-assigned-avatar\">${getInitials(risk.owner)}</div>\r\n                  <div class=\"contact-details\">\r\n                    <div class=\"contact-name-lg\">${escapeHtml(risk.owner)}</div>\r\n                    <div class=\"contact-role-sm\" id=\"risk-assigned-role\"></div>\r\n                  </div>\r\n                  <button class=\"btn-change-assignment\" id=\"risk-change-owner-btn\" type=\"button\">\r\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                    Change\r\n                  </button>\r\n                </div>\r\n              ` : `\r\n                <div class=\"no-assignment\">\r\n                  <div class=\"no-assignment-icon\">\r\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\r\n                  </div>\r\n                  <span>No one assigned</span>\r\n                  <p class=\"no-assignment-hint\">Use AI Suggest or choose manually</p>\r\n                  <button class=\"btn-assign-now\" id=\"risk-show-picker-btn\" type=\"button\">Choose Manually</button>\r\n                </div>\r\n              `}\r\n            </div>\r\n\r\n            <!-- Contact Picker (hidden by default) -->\r\n            <div id=\"risk-contact-picker\" class=\"contact-picker-sota hidden\">\r\n              <div class=\"picker-search\">\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\r\n                <input type=\"text\" id=\"risk-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"risk-contact-list\" class=\"contact-list-grid\">Loading...</div>\r\n            </div>\r\n\r\n            <!-- AI Suggestions Panel -->\r\n            <div id=\"risk-suggestions-panel\" class=\"suggestions-panel-sota risk-suggestions-panel hidden\"></div>\r\n\r\n            <!-- Mitigation (below assignment) -->\r\n            <div class=\"risk-mitigation-block\">\r\n              <strong>Mitigation</strong>\r\n              <p id=\"risk-detail-mitigation\" class=\"risk-mitigation\">${risk.mitigation ? escapeHtml(risk.mitigation) : '<span class=\"text-muted\">No mitigation recorded</span>'}</p>\r\n            </div>\r\n          </section>\r\n\r\n          <section class=\"detail-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Source</h3>\r\n            </div>\r\n            ${risk.source_file ? `<p class=\"source-file\">${escapeHtml(risk.source_file)}</p>` : ''}\r\n            ${risk.source_document_id ? `\r\n              <p class=\"source-doc\">\r\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(risk.source_document_id))}\">View source document</a>\r\n              </p>\r\n            ` : ''}\r\n            ${!risk.source_file && !risk.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\r\n          </section>\r\n        </div>\r\n\r\n        <div class=\"detail-column-right\">\r\n          <section class=\"detail-section metadata-section\">\r\n            <h3>Metadata</h3>\r\n            <dl class=\"metadata-list\">\r\n              <dt>Created</dt>\r\n              <dd>${formatDate(risk.created_at)}</dd>\r\n              ${risk.updated_at ? `<dt>Updated</dt><dd>${formatDate(risk.updated_at)}</dd>` : ''}\r\n            </dl>\r\n          </section>\r\n\r\n          <section class=\"detail-section\" id=\"risk-timeline-section\">\r\n            <h3>Timeline</h3>\r\n            <div id=\"timeline-content\" class=\"timeline-content\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"detail-actions\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-risk-btn\">Edit</button>\r\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-risk-btn\">Delete</button>\r\n      </div>\r\n      </div>\r\n\r\n      <div id=\"risk-edit-form\" class=\"risk-detail-edit-form hidden\">\r\n        <form id=\"risk-inline-form\" class=\"risk-form\">\r\n          <div class=\"form-group\">\r\n            <div class=\"gm-flex gm-flex-center gm-justify-between gm-flex-wrap gm-gap-2 gm-mb-2\">\r\n              <label for=\"risk-edit-content\" class=\"gm-mb-0\">Risk description *</label>\r\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"risk-edit-ai-suggest-btn\" title=\"Suggest owner and mitigation from description\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI suggest\r\n              </button>\r\n            </div>\r\n            <textarea id=\"risk-edit-content\" rows=\"3\" required placeholder=\"Describe the risk...\">${escapeHtml(risk.content || '')}</textarea>\r\n          </div>\r\n          <div id=\"risk-edit-suggestions-panel\" class=\"suggestions-panel-sota risk-suggestions-panel hidden gm-mb-4\"></div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group\">\r\n              <label for=\"risk-edit-impact\">Impact</label>\r\n              <select id=\"risk-edit-impact\">\r\n                <option value=\"low\" ${risk.impact === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${risk.impact === 'medium' || !risk.impact ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${risk.impact === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"risk-edit-likelihood\">Likelihood</label>\r\n              <select id=\"risk-edit-likelihood\">\r\n                <option value=\"low\" ${risk.likelihood === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${risk.likelihood === 'medium' || !risk.likelihood ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${risk.likelihood === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"risk-edit-status\">Status</label>\r\n              <select id=\"risk-edit-status\">\r\n                <option value=\"open\" ${risk.status === 'open' || !risk.status ? 'selected' : ''}>Open</option>\r\n                <option value=\"mitigating\" ${risk.status === 'mitigating' ? 'selected' : ''}>Mitigating</option>\r\n                <option value=\"mitigated\" ${risk.status === 'mitigated' ? 'selected' : ''}>Mitigated</option>\r\n                <option value=\"accepted\" ${risk.status === 'accepted' ? 'selected' : ''}>Accepted</option>\r\n                <option value=\"closed\" ${risk.status === 'closed' ? 'selected' : ''}>Closed</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group risk-owner-picker-wrap\">\r\n            <label>Owner</label>\r\n            <input type=\"hidden\" id=\"risk-edit-owner\" value=\"${escapeHtml(risk.owner || '')}\">\r\n            <div class=\"risk-owner-picker-trigger\" id=\"risk-owner-picker-trigger\" title=\"Click to select from project contacts\">\r\n              <span class=\"risk-owner-picker-value\" id=\"risk-owner-picker-value\">${risk.owner ? escapeHtml(risk.owner) : '<span class=\"text-muted\">Select owner...</span>'}</span>\r\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n            </div>\r\n            <div id=\"risk-owner-picker-dropdown\" class=\"risk-owner-picker-dropdown hidden\">\r\n              <div class=\"risk-owner-picker-search\">\r\n                <input type=\"text\" id=\"risk-owner-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"risk-owner-picker-list\" class=\"risk-owner-picker-list\">Loading...</div>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"risk-edit-mitigation\">Mitigation strategy</label>\r\n            <textarea id=\"risk-edit-mitigation\" rows=\"3\" placeholder=\"How will this risk be mitigated?\">${escapeHtml(risk.mitigation || '')}</textarea>\r\n          </div>\r\n        </form>\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"risk-save-btn\">Save</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"risk-cancel-edit-btn\">Cancel</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"risk-delete-in-edit-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  const viewContent = container.querySelector('#risk-view-content') as HTMLElement;\r\n  const editForm = container.querySelector('#risk-edit-form') as HTMLElement;\r\n\r\n  const editBtn = container.querySelector('#edit-risk-btn');\r\n  if (editBtn && viewContent && editForm) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      viewContent.classList.add('hidden');\r\n      editForm.classList.remove('hidden');\r\n    });\r\n  }\r\n\r\n  const cancelEditBtn = container.querySelector('#risk-cancel-edit-btn');\r\n  if (cancelEditBtn && viewContent && editForm) {\r\n    on(cancelEditBtn as HTMLElement, 'click', () => {\r\n      editForm.classList.add('hidden');\r\n      viewContent.classList.remove('hidden');\r\n    });\r\n  }\r\n\r\n  const saveBtn = container.querySelector('#risk-save-btn');\r\n  if (saveBtn && editForm && onUpdate) {\r\n    on(saveBtn as HTMLElement, 'click', async () => {\r\n      const form = container.querySelector('#risk-inline-form') as HTMLFormElement;\r\n      if (!form?.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n      const contentEl = container.querySelector('#risk-edit-content') as HTMLTextAreaElement;\r\n      const impactEl = container.querySelector('#risk-edit-impact') as HTMLSelectElement;\r\n      const likelihoodEl = container.querySelector('#risk-edit-likelihood') as HTMLSelectElement;\r\n      const statusEl = container.querySelector('#risk-edit-status') as HTMLSelectElement;\r\n      const ownerEl = container.querySelector('#risk-edit-owner') as HTMLInputElement;\r\n      const mitigationEl = container.querySelector('#risk-edit-mitigation') as HTMLTextAreaElement;\r\n      const content = contentEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.error('Risk description is required');\r\n        return;\r\n      }\r\n      (saveBtn as HTMLButtonElement).disabled = true;\r\n      (saveBtn as HTMLButtonElement).textContent = 'Saving...';\r\n      try {\r\n        const updated = await risksService.update(risk.id, {\r\n          content,\r\n          impact: (impactEl?.value || 'medium') as Risk['impact'],\r\n          likelihood: (likelihoodEl?.value || 'medium') as Risk['likelihood'],\r\n          status: (statusEl?.value || 'open') as Risk['status'],\r\n          owner: ownerEl?.value?.trim() || undefined,\r\n          mitigation: mitigationEl?.value?.trim() || undefined,\r\n        });\r\n        toast.success('Risk updated');\r\n        onUpdate(updated);\r\n      } catch {\r\n        toast.error('Failed to save');\r\n      } finally {\r\n        (saveBtn as HTMLButtonElement).disabled = false;\r\n        (saveBtn as HTMLButtonElement).textContent = 'Save';\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteInEditBtn = container.querySelector('#risk-delete-in-edit-btn');\r\n  if (deleteInEditBtn) {\r\n    on(deleteInEditBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this risk?')) return;\r\n      try {\r\n        await risksService.delete(risk.id);\r\n        toast.success('Risk deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Owner contact picker in edit form (project contacts with cards)\r\n  const ownerPickerTrigger = container.querySelector('#risk-owner-picker-trigger');\r\n  const ownerPickerDropdown = container.querySelector('#risk-owner-picker-dropdown') as HTMLElement;\r\n  const ownerPickerValue = container.querySelector('#risk-owner-picker-value');\r\n  const ownerHiddenInput = container.querySelector('#risk-edit-owner') as HTMLInputElement;\r\n  const ownerPickerList = container.querySelector('#risk-owner-picker-list') as HTMLElement;\r\n  const ownerPickerSearch = container.querySelector('#risk-owner-picker-search') as HTMLInputElement;\r\n\r\n  if (ownerPickerTrigger && ownerPickerDropdown && ownerPickerList && ownerHiddenInput) {\r\n    let editFormContacts: Contact[] = [];\r\n    const renderOwnerPickerList = (filter = '') => {\r\n      const filtered = filter\r\n        ? editFormContacts.filter(\r\n            (c) =>\r\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n          )\r\n        : editFormContacts;\r\n      if (editFormContacts.length === 0) {\r\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n        return;\r\n      }\r\n      if (filtered.length === 0) {\r\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n        return;\r\n      }\r\n      ownerPickerList.innerHTML = filtered\r\n        .map((c) => {\r\n          const photoUrl = c.photoUrl || c.avatarUrl;\r\n          const selected = (ownerHiddenInput?.value || '').trim() === (c.name || '').trim();\r\n          return `\r\n            <div class=\"risk-owner-card-picker ${selected ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"risk-owner-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n              <div class=\"risk-owner-card-info\">\r\n                <div class=\"risk-owner-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"risk-owner-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `;\r\n        })\r\n        .join('');\r\n      ownerPickerList.querySelectorAll('.risk-owner-card-picker').forEach((card) => {\r\n        on(card as HTMLElement, 'click', () => {\r\n          const name = card.getAttribute('data-contact-name') || '';\r\n          ownerHiddenInput.value = name;\r\n          if (ownerPickerValue) ownerPickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select owner...</span>';\r\n          ownerPickerDropdown.classList.add('hidden');\r\n        });\r\n      });\r\n    };\r\n    on(ownerPickerTrigger as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const isOpen = !ownerPickerDropdown.classList.contains('hidden');\r\n      ownerPickerDropdown.classList.toggle('hidden', isOpen);\r\n      if (!isOpen && editFormContacts.length === 0) {\r\n        ownerPickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          editFormContacts = res?.contacts || [];\r\n          renderOwnerPickerList(ownerPickerSearch?.value || '');\r\n        } catch {\r\n          ownerPickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        }\r\n      } else if (!isOpen) renderOwnerPickerList(ownerPickerSearch?.value || '');\r\n    });\r\n    if (ownerPickerSearch) {\r\n      ownerPickerSearch.addEventListener('input', () => renderOwnerPickerList(ownerPickerSearch.value));\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.risk-owner-picker-wrap') && !ownerPickerDropdown?.classList.contains('hidden')) {\r\n        ownerPickerDropdown.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI suggest in edit form (fill owner + mitigation)\r\n  const editAiSuggestBtn = container.querySelector('#risk-edit-ai-suggest-btn');\r\n  const editSuggestionsPanel = container.querySelector('#risk-edit-suggestions-panel') as HTMLElement;\r\n  if (editAiSuggestBtn && editSuggestionsPanel) {\r\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const contentEl = container.querySelector('#risk-edit-content') as HTMLTextAreaElement;\r\n      const content = contentEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.error('Enter a risk description first');\r\n        return;\r\n      }\r\n      const btn = editAiSuggestBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.innerHTML = '<span class=\"spin\"></span> Analyzing...';\r\n      editSuggestionsPanel.classList.remove('hidden');\r\n      editSuggestionsPanel.innerHTML = '<div class=\"suggestions-loading\"><div class=\"loading-text\">AI is suggesting owners and mitigation...</div></div>';\r\n      try {\r\n        const [result, contactsRes] = await Promise.all([\r\n          risksService.suggest({ content, impact: (container.querySelector('#risk-edit-impact') as HTMLSelectElement)?.value || 'medium', likelihood: (container.querySelector('#risk-edit-likelihood') as HTMLSelectElement)?.value || 'medium' }),\r\n          contactsService.getAll(),\r\n        ]);\r\n        const contacts: Contact[] = contactsRes?.contacts || [];\r\n        const owners: RiskOwnerSuggestion[] = result.suggested_owners?.length ? result.suggested_owners : result.suggested_owner ? [{ name: result.suggested_owner, reason: '', score: 0 }] : [];\r\n        const mitigation = result.suggested_mitigation || '';\r\n        if (owners.length === 0 && !mitigation) {\r\n          editSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\"><div class=\"no-suggestions-text\">No suggestions</div><button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close</button></div>';\r\n        } else {\r\n          editSuggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\"><div class=\"ai-badge\"> AI Recommended</div></div>\r\n            ${owners.length > 0 ? `<div class=\"suggestions-list-sota\">${owners.map((s, i) => {\r\n              const contact = contacts.find((c) => (c.name || '').trim().toLowerCase() === (s.name || '').trim().toLowerCase());\r\n              const photoUrl = contact?.photoUrl || contact?.avatarUrl || (contact as { photo_url?: string })?.photo_url || (contact as { avatar_url?: string })?.avatar_url;\r\n              const roleOrReason = contact?.role ?? s.reason ?? '';\r\n              const score = s.score ?? 0;\r\n              const scoreColor = getScoreColor(score);\r\n              return `<div class=\"suggestion-card-sota risk-owner-card\" data-owner-name=\"${escapeHtml(s.name || '')}\">\r\n                <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                <div class=\"suggestion-info-sota\"><div class=\"suggestion-name-sota\">${escapeHtml(s.name || '')}</div>${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}</div>\r\n                ${score > 0 ? `<div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\"><div class=\"score-value\">${score}%</div></div>` : ''}\r\n                <button type=\"button\" class=\"btn-select-suggestion\">Assign</button>\r\n              </div>`;\r\n            }).join('')}</div>` : ''}\r\n            ${mitigation ? `<div class=\"risk-suggestion-card risk-mitigation-suggestion\"><strong>Suggested mitigation</strong><p class=\"risk-suggestion-mitigation\">${escapeHtml(mitigation)}</p><button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-edit-apply-mitigation-btn\">Apply mitigation</button></div>` : ''}\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close suggestions</button></div>\r\n          `;\r\n          editSuggestionsPanel.querySelectorAll('.risk-owner-card .btn-select-suggestion').forEach((assignBtn) => {\r\n            const card = (assignBtn as HTMLElement).closest('.risk-owner-card');\r\n            const name = card?.getAttribute('data-owner-name') || '';\r\n            if (!name) return;\r\n            on(assignBtn as HTMLElement, 'click', () => {\r\n              if (ownerHiddenInput) ownerHiddenInput.value = name;\r\n              if (ownerPickerValue) ownerPickerValue.innerHTML = escapeHtml(name);\r\n              editSuggestionsPanel.classList.add('hidden');\r\n              toast.success(`Owner set to ${name}`);\r\n            });\r\n          });\r\n          const applyMitigationBtn = editSuggestionsPanel.querySelector('#risk-edit-apply-mitigation-btn');\r\n          if (applyMitigationBtn && mitigation) {\r\n            on(applyMitigationBtn as HTMLElement, 'click', () => {\r\n              const mitigationEl = container.querySelector('#risk-edit-mitigation') as HTMLTextAreaElement;\r\n              if (mitigationEl) mitigationEl.value = mitigation;\r\n              toast.success('Mitigation applied');\r\n            });\r\n          }\r\n        }\r\n        const hideBtn = editSuggestionsPanel.querySelector('#risk-edit-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { editSuggestionsPanel.classList.add('hidden'); });\r\n      } catch {\r\n        editSuggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"risk-edit-hide-suggest-btn\">Close</button></div>';\r\n        const h = editSuggestionsPanel.querySelector('#risk-edit-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { editSuggestionsPanel.classList.add('hidden'); });\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.innerHTML = '<svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> AI suggest';\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteBtn = container.querySelector('#delete-risk-btn');\r\n  if (deleteBtn) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this risk?')) return;\r\n      try {\r\n        await risksService.delete(risk.id);\r\n        toast.success('Risk deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete risk');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI suggest owner & mitigation (same UX as Question Assignment: list of owner cards with Assign each)\r\n  let lastMitigation = '';\r\n  const aiSuggestBtn = container.querySelector('#risk-ai-suggest-btn');\r\n  const suggestionsPanel = container.querySelector('#risk-suggestions-panel') as HTMLElement;\r\n  if (aiSuggestBtn && suggestionsPanel) {\r\n    on(aiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const btn = aiSuggestBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.innerHTML = `\r\n        <svg class=\"spin\" width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\r\n        </svg>\r\n        Analyzing...\r\n      `;\r\n      suggestionsPanel.classList.remove('hidden');\r\n      suggestionsPanel.innerHTML = `\r\n        <div class=\"suggestions-loading\">\r\n          <div class=\"ai-thinking-animation\"><span></span><span></span><span></span></div>\r\n          <div class=\"loading-text\">AI is suggesting owners and mitigation...</div>\r\n        </div>\r\n      `;\r\n      try {\r\n        const [result, contactsRes] = await Promise.all([\r\n          risksService.suggest({\r\n            content: risk.content || '',\r\n            impact: risk.impact || 'medium',\r\n            likelihood: risk.likelihood || 'medium',\r\n          }),\r\n          contactsService.getAll(),\r\n        ]);\r\n        const contacts: Contact[] = contactsRes?.contacts || [];\r\n        lastMitigation = result.suggested_mitigation || '';\r\n        const owners: RiskOwnerSuggestion[] = result.suggested_owners?.length ? result.suggested_owners : (result.suggested_owner ? [{ name: result.suggested_owner, reason: '', score: 0 }] : []);\r\n\r\n        if (owners.length === 0 && !lastMitigation) {\r\n          suggestionsPanel.innerHTML = `\r\n            <div class=\"no-suggestions\">\r\n              <div class=\"no-suggestions-text\">No owner or mitigation suggestions</div>\r\n              <button type=\"button\" class=\"btn-link\" id=\"risk-hide-suggestions-btn\">Close</button>\r\n            </div>\r\n          `;\r\n        } else {\r\n          suggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\">\r\n              <div class=\"ai-badge\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n                </svg>\r\n                AI Recommended\r\n              </div>\r\n            </div>\r\n            ${owners.length > 0 ? `\r\n            <div class=\"suggestions-list-sota\">\r\n              ${owners.map((s, i) => {\r\n                const score = s.score ?? 0;\r\n                const scoreColor = getScoreColor(score);\r\n                const contact = contacts.find((c) => (c.name || '').trim().toLowerCase() === (s.name || '').trim().toLowerCase());\r\n                const photoUrl = contact?.photoUrl || contact?.avatarUrl || (contact as { photo_url?: string })?.photo_url || (contact as { avatar_url?: string })?.avatar_url;\r\n                const roleOrReason = contact?.role ?? s.reason ?? '';\r\n                return `\r\n                  <div class=\"suggestion-card-sota risk-owner-card\" data-index=\"${i}\">\r\n                    <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                    <div class=\"suggestion-avatar-sota\">${photoUrl\r\n                      ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(s.name)}\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">`\r\n                      : getInitials(s.name)}</div>\r\n                    <div class=\"suggestion-info-sota\">\r\n                      <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\r\n                      ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                    </div>\r\n                    ${score > 0 ? `\r\n                    <div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\">\r\n                      <div class=\"score-ring\">\r\n                        <svg viewBox=\"0 0 36 36\">\r\n                          <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                          <path class=\"score-fill\" stroke-dasharray=\"${score}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                        </svg>\r\n                        <div class=\"score-value\">${score}%</div>\r\n                      </div>\r\n                      <div class=\"score-label\">Match</div>\r\n                    </div>\r\n                    ` : ''}\r\n                    <button type=\"button\" class=\"btn-select-suggestion\">\r\n                      <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n                      </svg>\r\n                      Assign\r\n                    </button>\r\n                  </div>\r\n                `;\r\n              }).join('')}\r\n            </div>\r\n            ` : ''}\r\n            ${lastMitigation ? `\r\n            <div class=\"risk-suggestion-card risk-mitigation-suggestion\">\r\n              <strong>Suggested mitigation</strong>\r\n              <p class=\"risk-suggestion-mitigation\">${escapeHtml(lastMitigation)}</p>\r\n              <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"risk-apply-mitigation-btn\">Apply mitigation</button>\r\n            </div>\r\n            ` : ''}\r\n            <div class=\"suggestions-footer\">\r\n              <button type=\"button\" class=\"btn-link\" id=\"risk-hide-suggestions-btn\">Close suggestions</button>\r\n            </div>\r\n          `;\r\n\r\n          // Bind Assign per owner card\r\n          suggestionsPanel.querySelectorAll('.risk-owner-card').forEach((item) => {\r\n            const selectBtn = item.querySelector('.btn-select-suggestion');\r\n            if (!selectBtn) return;\r\n            const idx = parseInt(item.getAttribute('data-index') || '0');\r\n            const suggestion = owners[idx];\r\n            if (!suggestion || !onUpdate) return;\r\n            on(selectBtn as HTMLElement, 'click', async (e) => {\r\n              e.stopPropagation();\r\n              try {\r\n                const updated = await risksService.update(risk.id, { owner: suggestion.name });\r\n                suggestionsPanel.classList.add('hidden');\r\n                onUpdate(updated);\r\n                toast.success(`Assigned to ${suggestion.name}`);\r\n              } catch {\r\n                toast.error('Failed to save');\r\n              }\r\n            });\r\n          });\r\n\r\n          // Bind Apply mitigation\r\n          const applyMitigationBtn = suggestionsPanel.querySelector('#risk-apply-mitigation-btn');\r\n          if (applyMitigationBtn && lastMitigation && onUpdate) {\r\n            on(applyMitigationBtn as HTMLElement, 'click', async () => {\r\n              try {\r\n                const updated = await risksService.update(risk.id, { mitigation: lastMitigation });\r\n                const mitigationEl = container.querySelector('#risk-detail-mitigation');\r\n                if (mitigationEl) mitigationEl.innerHTML = escapeHtml(lastMitigation);\r\n                onUpdate(updated);\r\n                toast.success('Mitigation updated');\r\n              } catch {\r\n                toast.error('Failed to save');\r\n              }\r\n            });\r\n          }\r\n        }\r\n\r\n        const hideBtn = suggestionsPanel.querySelector('#risk-hide-suggestions-btn');\r\n        if (hideBtn) {\r\n          on(hideBtn as HTMLElement, 'click', () => {\r\n            suggestionsPanel.classList.add('hidden');\r\n          });\r\n        }\r\n      } catch {\r\n        suggestionsPanel.innerHTML = `\r\n          <div class=\"suggestions-error\">\r\n            <div>Failed to get AI suggestions</div>\r\n            <button type=\"button\" class=\"btn-retry\" id=\"risk-retry-suggest-btn\">Try again</button>\r\n          </div>\r\n        `;\r\n        const retryBtn = suggestionsPanel.querySelector('#risk-retry-suggest-btn');\r\n        if (retryBtn) {\r\n          on(retryBtn as HTMLElement, 'click', () => (aiSuggestBtn as HTMLElement).click());\r\n        }\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.innerHTML = `\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n          </svg>\r\n          AI suggest\r\n        `;\r\n      }\r\n    });\r\n  }\r\n\r\n  const docLink = container.querySelector('.doc-link');\r\n  if (docLink && risk.source_document_id) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n        detail: { tab: 'files', documentId: risk.source_document_id }\r\n      }));\r\n    });\r\n  }\r\n\r\n  const timelineEl = container.querySelector('#timeline-content');\r\n  if (timelineEl) {\r\n    risksService.getEvents(risk.id).then((events: RiskEvent[]) => {\r\n      if (events.length === 0) {\r\n        (timelineEl as HTMLElement).innerHTML = '<p class=\"empty-state\">No events recorded</p>';\r\n        return;\r\n      }\r\n      const html = events.map((ev) => {\r\n        const icon = getRiskEventIcon(ev.event_type);\r\n        const description = getRiskEventDescription(ev);\r\n        return `\r\n          <div class=\"timeline-item risk-event-${escapeHtml(ev.event_type)}\">\r\n            <div class=\"timeline-icon\">${icon}</div>\r\n            <div class=\"timeline-content\">\r\n              <div class=\"timeline-title\">${escapeHtml(description)}</div>\r\n              <div class=\"timeline-date\">${formatDateTime(ev.created_at)}</div>\r\n            </div>\r\n          </div>`;\r\n      }).join('');\r\n      (timelineEl as HTMLElement).innerHTML = `<div class=\"timeline-list\">${html}</div>`;\r\n    }).catch(() => {\r\n      (timelineEl as HTMLElement).innerHTML = '<p class=\"error\">Failed to load timeline</p>';\r\n    });\r\n  }\r\n\r\n  // Contact picker in view: show on Change/Choose Manually, on select update owner via API\r\n  let viewContacts: Contact[] = [];\r\n  const owner = risk.owner || '';\r\n  const riskContactPicker = container.querySelector('#risk-contact-picker') as HTMLElement;\r\n  const riskContactList = container.querySelector('#risk-contact-list') as HTMLElement;\r\n  const riskContactSearch = container.querySelector('#risk-contact-search') as HTMLInputElement;\r\n\r\n  const renderRiskContactGrid = (filter = '') => {\r\n    if (!riskContactList) return;\r\n    const list = filter\r\n      ? viewContacts.filter(\r\n          (c) =>\r\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\r\n        )\r\n      : viewContacts;\r\n    if (viewContacts.length === 0) {\r\n      riskContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n      return;\r\n    }\r\n    if (list.length === 0) {\r\n      riskContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n      return;\r\n    }\r\n    riskContactList.innerHTML = list\r\n      .map((c) => {\r\n        const photoUrl = getContactPhotoUrl(c);\r\n        const isCurrent = (owner || '').trim() === (c.name || '').trim();\r\n        return `\r\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n            <div class=\"contact-info-picker\">\r\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\r\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\r\n            </div>\r\n          </div>`;\r\n      })\r\n      .join('');\r\n    riskContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\r\n      on(card as HTMLElement, 'click', async () => {\r\n        const name = card.getAttribute('data-contact-name') || '';\r\n        if (!name) return;\r\n        try {\r\n          const updated = await risksService.update(risk.id, { owner: name });\r\n          toast.success(`Owner set to ${name}`);\r\n          if (riskContactPicker) riskContactPicker.classList.add('hidden');\r\n          onUpdate?.(updated);\r\n        } catch {\r\n          toast.error('Failed to save');\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  const showRiskPicker = () => {\r\n    if (!riskContactPicker) return;\r\n    const wasHidden = riskContactPicker.classList.contains('hidden');\r\n    riskContactPicker.classList.toggle('hidden', wasHidden);\r\n    if (wasHidden && viewContacts.length === 0) {\r\n      contactsService.getAll().then((res) => {\r\n        viewContacts = res?.contacts || [];\r\n        renderRiskContactGrid(riskContactSearch?.value || '');\r\n      }).catch(() => {\r\n        if (riskContactList) riskContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n      });\r\n    } else if (wasHidden) {\r\n      renderRiskContactGrid(riskContactSearch?.value || '');\r\n    }\r\n    if (riskContactSearch) riskContactSearch.focus();\r\n  };\r\n\r\n  const changeOwnerBtn = container.querySelector('#risk-change-owner-btn');\r\n  const showPickerBtn = container.querySelector('#risk-show-picker-btn');\r\n  if (changeOwnerBtn && riskContactPicker) on(changeOwnerBtn as HTMLElement, 'click', showRiskPicker);\r\n  if (showPickerBtn && riskContactPicker) on(showPickerBtn as HTMLElement, 'click', showRiskPicker);\r\n  if (riskContactSearch) {\r\n    riskContactSearch.addEventListener('input', () => renderRiskContactGrid(riskContactSearch.value));\r\n  }\r\n\r\n  function findContactByOwner(name: string): Contact | undefined {\r\n    if (!name || !viewContacts.length) return undefined;\r\n    const n = name.trim().toLowerCase();\r\n    if (!n) return undefined;\r\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n    if (byExact) return byExact;\r\n    const byPartial = viewContacts.find(\r\n      (c) =>\r\n        (c.name || '').trim().toLowerCase().includes(n) ||\r\n        n.includes((c.name || '').trim().toLowerCase())\r\n    );\r\n    if (byPartial) return byPartial;\r\n    const byAlias = viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n    );\r\n    if (byAlias) return byAlias;\r\n    return viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => {\r\n        const aLower = String(a).trim().toLowerCase();\r\n        return aLower.includes(n) || n.includes(aLower);\r\n      })\r\n    );\r\n  }\r\n\r\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\r\n    if (!c) return null;\r\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\r\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\r\n  }\r\n\r\n  contactsService.getAll().then((res) => {\r\n    viewContacts = res?.contacts || [];\r\n    const contact = findContactByOwner(owner);\r\n    const roleEl = container.querySelector('#risk-assigned-role');\r\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\r\n    const avatarEl = container.querySelector('#risk-assigned-avatar');\r\n    if (avatarEl && owner) {\r\n      const photoUrl = getContactPhotoUrl(contact);\r\n      if (photoUrl) {\r\n        avatarEl.innerHTML = '';\r\n        const img = document.createElement('img');\r\n        img.src = photoUrl;\r\n        img.alt = '';\r\n        img.onerror = () => { avatarEl.textContent = getInitials(owner); };\r\n        avatarEl.appendChild(img);\r\n      }\r\n    }\r\n  }).catch(() => {});\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Risks Panel Component\r\n * Displays and manages risks with view tabs, search, grouping, detail view, and removed section (SOTA parity)\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { risksService, Risk } from '../../services/risks';\r\nimport { dataStore } from '../../stores/data';\r\nimport { showRiskModal } from '../modals/RiskModal';\r\nimport { createRiskDetailView, RiskDetailViewProps } from '../risks/RiskDetailView';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nfunction riskDetailProps(containerEl: HTMLElement, props: RisksPanelProps, risk: Risk): RiskDetailViewProps {\r\n  return {\r\n    risk,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createRisksPanel(props));\r\n    },\r\n    onUpdate: (updatedRisk?: Risk) => {\r\n      containerEl.innerHTML = '';\r\n      if (updatedRisk) {\r\n        containerEl.appendChild(createRiskDetailView(riskDetailProps(containerEl, props, updatedRisk)));\r\n      } else {\r\n        containerEl.appendChild(createRisksPanel(props));\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport interface RisksPanelProps {\r\n  onRiskClick?: (risk: Risk) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentSearch: string = '';\r\nlet currentView: 'status' | 'source' = 'status';\r\nlet showMatrix: boolean = false;\r\nlet lastLoadedRisks: Risk[] = [];\r\n\r\n/**\r\n * Create risks panel\r\n */\r\nexport function createRisksPanel(props: RisksPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel risks-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Risks</h2>\r\n        <span class=\"panel-count\" id=\"risks-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"risks-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"open\">Open</option>\r\n          <option value=\"mitigating\">Mitigating</option>\r\n          <option value=\"mitigated\">Mitigated</option>\r\n          <option value=\"high\">High Impact</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\r\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\r\n        </div>\r\n        <input type=\"search\" id=\"risks-search\" class=\"search-input\" placeholder=\"Search risks...\" title=\"Search\">\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"toggle-matrix-btn\">Show Matrix</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-risk-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"risk-matrix-container\" class=\"risk-matrix-container hidden\"></div>\r\n    <div class=\"panel-content\" id=\"risks-content\">\r\n      <div class=\"loading\">Loading risks...</div>\r\n    </div>\r\n    <div id=\"removed-risks-container\" class=\"removed-risks-container hidden\"></div>\r\n  `;\r\n\r\n  const filterSelect = panel.querySelector('#risks-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadRisks(panel, props);\r\n  });\r\n\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'status' | 'source';\r\n      loadRisks(panel, props);\r\n    });\r\n  });\r\n\r\n  const searchInput = panel.querySelector('#risks-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value.trim();\r\n      loadRisks(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  const matrixBtn = panel.querySelector('#toggle-matrix-btn') as HTMLButtonElement;\r\n  on(matrixBtn, 'click', () => {\r\n    showMatrix = !showMatrix;\r\n    matrixBtn.textContent = showMatrix ? 'Hide Matrix' : 'Show Matrix';\r\n    const matrixContainer = panel.querySelector('#risk-matrix-container') as HTMLElement;\r\n    matrixContainer.classList.toggle('hidden', !showMatrix);\r\n    if (showMatrix) {\r\n      const risksToShow = lastLoadedRisks.length > 0 ? lastLoadedRisks : (dataStore.getState().risks as unknown as Risk[]) || [];\r\n      renderRiskMatrix(matrixContainer, Array.isArray(risksToShow) ? risksToShow : []);\r\n    }\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-risk-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showRiskModal({\r\n        mode: 'create',\r\n        onSave: () => {\r\n          loadRisks(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  loadRisks(panel, props);\r\n  refreshRemovedSection(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\nasync function refreshRemovedSection(panel: HTMLElement, props: RisksPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-risks-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await risksService.getDeleted();\r\n    if (deleted.length === 0) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    container.innerHTML = `\r\n      <div class=\"removed-risks-section\">\r\n        <div class=\"removed-risks-header section-header-sota\">\r\n          <h3>Removed risks</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-risks-hint\">Restore to bring the risk back; it will be synced to the graph.</p>\r\n        <div class=\"removed-risks-list\">\r\n          ${deleted.map((r) => `\r\n            <div class=\"removed-risk-item\" data-risk-id=\"${r.id}\">\r\n              <div class=\"removed-risk-content\">${escapeHtml(truncate(r.content ?? '', 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach((restoreBtn) => {\r\n      on(restoreBtn as HTMLElement, 'click', async () => {\r\n        const id = (restoreBtn as HTMLElement).closest('.removed-risk-item')?.getAttribute('data-risk-id');\r\n        if (!id) return;\r\n        try {\r\n          await risksService.restore(id);\r\n          toast.success('Risk restored');\r\n          loadRisks(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        } catch {\r\n          toast.error('Failed to restore risk');\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\nfunction truncate(s: string, len: number): string {\r\n  if (s.length <= len) return s;\r\n  return s.substring(0, len) + '';\r\n}\r\n\r\nfunction filterRisksBySearch(risks: Risk[], q: string): Risk[] {\r\n  if (!q) return risks;\r\n  const lower = q.toLowerCase();\r\n  return risks.filter(\r\n    r =>\r\n      (r.content || '').toLowerCase().includes(lower) ||\r\n      (r.mitigation || '').toLowerCase().includes(lower) ||\r\n      (r.owner || '').toLowerCase().includes(lower) ||\r\n      (r.source_file || '').toLowerCase().includes(lower)\r\n  );\r\n}\r\n\r\nasync function loadRisks(panel: HTMLElement, props: RisksPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#risks-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const status = currentFilter === 'all' || currentFilter === 'high' ? undefined : currentFilter;\r\n    let risks = await risksService.getAll(status);\r\n    if (currentFilter === 'high') {\r\n      risks = risks.filter(r => r.impact === 'high' || r.impact === 'critical');\r\n    }\r\n    risks = filterRisksBySearch(risks, currentSearch);\r\n\r\n    if (currentView === 'source') {\r\n      renderRisksBySource(content, risks, props);\r\n    } else {\r\n      renderRisks(content, risks, props);\r\n    }\r\n    lastLoadedRisks = risks;\r\n    dataStore.setRisks(risks as unknown as []);\r\n    updateCount(panel, risks.length);\r\n\r\n    if (showMatrix) {\r\n      const matrixContainer = panel.querySelector('#risk-matrix-container') as HTMLElement;\r\n      renderRiskMatrix(matrixContainer, risks);\r\n    }\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load risks</div>';\r\n  }\r\n}\r\n\r\nfunction renderRisks(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\r\n  if (risks.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No risks match your search' : 'No risks found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Risk</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showRiskModal({ mode: 'create', onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const byStatus: Record<string, Risk[]> = {};\r\n  risks.forEach(r => {\r\n    const s = (r.status || 'open').toLowerCase();\r\n    if (!byStatus[s]) byStatus[s] = [];\r\n    byStatus[s].push(r);\r\n  });\r\n  const statuses = Object.keys(byStatus);\r\n\r\n  if (statuses.length > 1) {\r\n    container.innerHTML = statuses.map(status => `\r\n      <div class=\"question-group\">\r\n        <div class=\"group-header\">\r\n          <h3>${escapeHtml(status)}</h3>\r\n          <span class=\"group-count\">${byStatus[status].length}</span>\r\n        </div>\r\n        <div class=\"group-items\">\r\n          ${byStatus[status].map(r => createRiskCard(r, contacts)).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    container.innerHTML = risks.map(r => createRiskCard(r, contacts)).join('');\r\n  }\r\n  bindRiskCards(container, risks, props);\r\n}\r\n\r\nfunction renderRisksBySource(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\r\n  if (risks.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No risks match your search' : 'No risks found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Risk</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showRiskModal({ mode: 'create', onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const bySource: Record<string, Risk[]> = {};\r\n  risks.forEach(r => {\r\n    const src = r.source_file || 'Unknown source';\r\n    if (!bySource[src]) bySource[src] = [];\r\n    bySource[src].push(r);\r\n  });\r\n  container.innerHTML = Object.entries(bySource).map(([source, list]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(source)}</h3>\r\n        <span class=\"group-count\">${list.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${list.map(r => createRiskCard(r, contacts)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n  bindRiskCards(container, risks, props);\r\n}\r\n\r\nconst IMPACT_BAR_COLOR: Record<string, string> = {\r\n  critical: '#dc2626',\r\n  high: '#ea580c',\r\n  medium: '#ca8a04',\r\n  low: '#16a34a',\r\n};\r\n\r\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\r\n\r\nfunction findContactByOwner(contacts: ContactLike[], name: string): ContactLike | undefined {\r\n  if (!name || !contacts.length) return undefined;\r\n  const n = name.trim().toLowerCase();\r\n  if (!n) return undefined;\r\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n  if (byExact) return byExact;\r\n  const byPartial = contacts.find(\r\n    (c) =>\r\n      (c.name || '').trim().toLowerCase().includes(n) ||\r\n      n.includes((c.name || '').trim().toLowerCase())\r\n  );\r\n  if (byPartial) return byPartial;\r\n  const byAlias = contacts.find((c) =>\r\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n  );\r\n  return byAlias || contacts.find((c) =>\r\n    (c.aliases || []).some((a) => {\r\n      const aLower = String(a).trim().toLowerCase();\r\n      return aLower.includes(n) || n.includes(aLower);\r\n    })\r\n  );\r\n}\r\n\r\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\r\n  if (!c) return null;\r\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\nfunction createRiskCard(risk: Risk, contacts: ContactLike[]): string {\r\n  const impact = (risk.impact || 'medium').toLowerCase();\r\n  const barColor = IMPACT_BAR_COLOR[impact] ?? IMPACT_BAR_COLOR.medium;\r\n  const content = risk.content || '';\r\n  const source = risk.source_file || '';\r\n  const owner = risk.owner || '';\r\n  const contact = owner ? findContactByOwner(contacts, owner) : undefined;\r\n  const photoUrl = getContactPhotoUrl(contact);\r\n  const ownerChipHtml = owner\r\n    ? `\r\n        <div class=\"assignee-chip\">\r\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(owner)}\" onerror=\"this.parentElement.innerHTML='${getInitials(owner)}'\">` : getInitials(owner)}</div>\r\n          <div class=\"assignee-info\">\r\n            <span class=\"assignee-name\">${escapeHtml(owner)}</span>\r\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n          </div>\r\n        </div>\r\n      `\r\n    : '<span class=\"card-owner-placeholder text-muted\">No owner</span>';\r\n  const sourceChip = source ? `<span class=\"card-source-chip\">${escapeHtml(truncate(source, 40))}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>';\r\n\r\n  return `\r\n    <div class=\"risk-card-sota question-card-sota\" data-id=\"${risk.id}\" style=\"--risk-impact-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar risk-impact-bar\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"priority-pill impact-${impact}\">${escapeHtml(risk.impact || 'medium')}</span>\r\n            <span class=\"status-pill\">L: ${escapeHtml(risk.likelihood || 'medium')}</span>\r\n            <span class=\"status-pill status-${(risk.status || 'open').toLowerCase()}\">${escapeHtml(risk.status || 'open')}</span>\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(risk.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\r\n        ${risk.mitigation ? `<div class=\"card-mitigation text-muted\">${escapeHtml(truncate(risk.mitigation, 120))}</div>` : ''}\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${sourceChip}\r\n            ${ownerChipHtml}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            <button type=\"button\" class=\"btn-link risk-view-link\">View</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindRiskCards(container: HTMLElement, risks: Risk[], props: RisksPanelProps): void {\r\n  container.querySelectorAll('.risk-card-sota').forEach((card) => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.card-actions')) return;\r\n      const id = card.getAttribute('data-id');\r\n      const risk = risks.find(r => String(r.id) === id);\r\n      if (!risk) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createRiskDetailView(riskDetailProps(containerEl, props, risk)));\r\n      } else if (props.onRiskClick) {\r\n        props.onRiskClick(risk);\r\n      } else {\r\n        showRiskModal({\r\n          mode: 'edit',\r\n          risk: { ...risk },\r\n          onSave: () => loadRisks(container.closest('.risks-panel') as HTMLElement, props),\r\n        });\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nfunction renderRiskMatrix(container: HTMLElement, risks: Risk[]): void {\r\n  const activeRisks = risks.filter(r => r.status !== 'mitigated' && r.status !== 'closed');\r\n  const getSeverity = (impact?: string, likelihood?: string): string => {\r\n    const impactLevel = ['low', 'medium', 'high', 'critical'].indexOf((impact || '').toString().toLowerCase() || 'low');\r\n    const likelihoodLevel = ['low', 'medium', 'high'].indexOf((likelihood || '').toString().toLowerCase() || 'low');\r\n    const score = impactLevel + likelihoodLevel;\r\n    if (score >= 4) return 'critical';\r\n    if (score >= 3) return 'high';\r\n    if (score >= 2) return 'medium';\r\n    return 'low';\r\n  };\r\n  const counts = { critical: 0, high: 0, medium: 0, low: 0 };\r\n  activeRisks.forEach(risk => {\r\n    const severity = getSeverity(risk.impact, risk.likelihood);\r\n    counts[severity as keyof typeof counts]++;\r\n  });\r\n  const total = activeRisks.length;\r\n  const mitigated = risks.length - activeRisks.length;\r\n  const getPercent = (count: number) => total > 0 ? Math.round((count / total) * 100) : 0;\r\n  let conicStops = '';\r\n  let currentDeg = 0;\r\n  const colors = { critical: '#ef4444', high: '#f97316', medium: '#eab308', low: '#22c55e' };\r\n  (['critical', 'high', 'medium', 'low'] as const).forEach(level => {\r\n    const percent = getPercent(counts[level]);\r\n    const degrees = (percent / 100) * 360;\r\n    if (degrees > 0) {\r\n      conicStops += `${colors[level]} ${currentDeg}deg ${currentDeg + degrees}deg, `;\r\n      currentDeg += degrees;\r\n    }\r\n  });\r\n  if (!conicStops) conicStops = 'var(--color-border) 0deg 360deg';\r\n  else conicStops = conicStops.slice(0, -2);\r\n\r\n  container.innerHTML = `\r\n    <div class=\"risk-summary\">\r\n      <div class=\"risk-summary-header\">\r\n        <h4>Risk Overview</h4>\r\n        <span class=\"risk-total\">${total} active</span>\r\n      </div>\r\n      <div class=\"risk-summary-content\">\r\n        <div class=\"risk-donut-container\">\r\n          <div class=\"risk-donut\" style=\"background: conic-gradient(${conicStops})\">\r\n            <div class=\"risk-donut-center\">\r\n              <span class=\"donut-value\">${total}</span>\r\n              <span class=\"donut-label\">Risks</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"risk-bars\">\r\n          <div class=\"risk-bar-item critical\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Critical</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.critical)}\"></div></div>\r\n            <span class=\"bar-count\">${counts.critical}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item high\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">High</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.high)}\"></div></div>\r\n            <span class=\"bar-count\">${counts.high}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item medium\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Medium</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.medium)}\"></div></div>\r\n            <span class=\"bar-count\">${counts.medium}</span>\r\n          </div>\r\n          <div class=\"risk-bar-item low\">\r\n            <span class=\"bar-icon\"></span>\r\n            <span class=\"bar-label\">Low</span>\r\n            <div class=\"bar-track\"><div class=\"bar-fill\" style=\"--bar-width: ${getPercent(counts.low)}\"></div></div>\r\n            <span class=\"bar-count\">${counts.low}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      ${mitigated > 0 ? `<div class=\"risk-mitigated\"><span class=\"mitigated-icon\"></span><span>${mitigated} risk${mitigated > 1 ? 's' : ''} mitigated</span></div>` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#risks-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createRisksPanel;\r\n","/**\r\n * Sprints Service\r\n * Create sprint, generate tasks from emails/transcripts, apply\r\n */\r\n\r\nimport { http } from './api';\r\n\r\nexport interface Sprint {\r\n  id: string;\r\n  project_id: string;\r\n  name: string;\r\n  start_date: string;\r\n  end_date: string;\r\n  context?: string;\r\n  analysis_start_date?: string;\r\n  analysis_end_date?: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\nexport interface ProposedTask {\r\n  task: string;\r\n  description?: string;\r\n  size_estimate?: string;\r\n  definition_of_done?: string[];\r\n  acceptance_criteria?: string[];\r\n  priority?: string;\r\n  due_date?: string;\r\n}\r\n\r\nexport interface SprintGenerateResult {\r\n  proposed_new_tasks: ProposedTask[];\r\n  existing_action_ids: string[];\r\n  existing_details?: { id: string; task: string; status: string }[];\r\n}\r\n\r\nexport interface SprintApplyResult {\r\n  ok: boolean;\r\n  created: number;\r\n  linked: number;\r\n  sprint: Sprint;\r\n}\r\n\r\nexport async function getSprints(): Promise<Sprint[]> {\r\n  try {\r\n    const response = await http.get<{ sprints: Sprint[] }>('/api/sprints');\r\n    return response.data.sprints || [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getSprint(id: string): Promise<Sprint | null> {\r\n  try {\r\n    const response = await http.get<{ sprint: Sprint }>(`/api/sprints/${id}`);\r\n    return response.data.sprint || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function createSprint(data: {\r\n  name: string;\r\n  start_date: string;\r\n  end_date: string;\r\n  context?: string;\r\n  analysis_start_date?: string;\r\n  analysis_end_date?: string;\r\n}): Promise<Sprint> {\r\n  const response = await http.post<{ sprint: Sprint }>('/api/sprints', data);\r\n  return response.data.sprint;\r\n}\r\n\r\nexport async function generateSprintTasks(\r\n  sprintId: string,\r\n  body?: { analysis_start_date?: string; analysis_end_date?: string }\r\n): Promise<SprintGenerateResult> {\r\n  const response = await http.post<SprintGenerateResult>(`/api/sprints/${sprintId}/generate`, body || {});\r\n  return response.data;\r\n}\r\n\r\nexport async function applySprintGeneration(\r\n  sprintId: string,\r\n  body: { new_tasks: ProposedTask[]; existing_action_ids: string[] }\r\n): Promise<SprintApplyResult> {\r\n  const response = await http.post<SprintApplyResult>(`/api/sprints/${sprintId}/apply`, body);\r\n  return response.data;\r\n}\r\n\r\n/** Report: sprint + actions + breakdown for charts */\r\nexport interface SprintReport {\r\n  sprint: Sprint;\r\n  actions: Array<{ id: string; task?: string; content?: string; status?: string; owner?: string; task_points?: number }>;\r\n  breakdown: { by_status: Record<string, number>; by_assignee: Record<string, number> };\r\n  total_task_points: number;\r\n  completed_task_points: number;\r\n  total_tasks: number;\r\n  completed_tasks: number;\r\n}\r\n\r\nexport async function getSprintReport(sprintId: string): Promise<SprintReport | null> {\r\n  try {\r\n    const response = await http.get<SprintReport>(`/api/sprints/${sprintId}/report`);\r\n    return response.data ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function analyzeSprintReport(sprintId: string): Promise<{ analysis: string; ai_analysis: string | null; error?: string }> {\r\n  const response = await http.post<{ analysis: string; ai_analysis: string | null; error?: string }>(\r\n    `/api/sprints/${sprintId}/report/analyze`,\r\n    {}\r\n  );\r\n  return response.data;\r\n}\r\n\r\nexport async function getSprintBusinessReport(sprintId: string): Promise<{\r\n  summary: string;\r\n  business_report: string | null;\r\n  error?: string;\r\n}> {\r\n  const response = await http.post<{ summary: string; business_report: string | null; error?: string }>(\r\n    `/api/sprints/${sprintId}/report/business`,\r\n    {}\r\n  );\r\n  return response.data;\r\n}\r\n\r\nexport type ReportDocumentStyle =\r\n  | ''\r\n  | 'sprint_report_style_corporate_classic'\r\n  | 'sprint_report_style_modern_minimal'\r\n  | 'sprint_report_style_startup_tech'\r\n  | 'sprint_report_style_consultancy';\r\n\r\nexport async function generateSprintReportDocument(\r\n  sprintId: string,\r\n  options?: { include_analysis?: boolean; include_business?: boolean; style?: ReportDocumentStyle }\r\n): Promise<{ html: string }> {\r\n  const response = await http.post<{ html: string }>(`/api/sprints/${sprintId}/report/document`, {\r\n    include_analysis: options?.include_analysis ?? false,\r\n    include_business: options?.include_business ?? false,\r\n    style: options?.style ?? '',\r\n  });\r\n  return response.data;\r\n}\r\n\r\nexport async function generateSprintReportPresentation(\r\n  sprintId: string,\r\n  options?: { include_analysis?: boolean; include_business?: boolean }\r\n): Promise<{ html: string }> {\r\n  const response = await http.post<{ html: string }>(`/api/sprints/${sprintId}/report/presentation`, {\r\n    include_analysis: options?.include_analysis ?? false,\r\n    include_business: options?.include_business ?? false,\r\n  });\r\n  return response.data;\r\n}\r\n","/**\r\n * Action Modal Component\r\n * Create, view and edit actions/tasks\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { Action } from '../../services/actions';\r\nimport { actionsService } from '../../services/actions';\r\nimport { getSprints } from '../../services/sprints';\r\nimport { contactsService } from '../../services/contacts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'action-modal';\r\n\r\nexport interface ActionModalProps {\r\n  mode: 'view' | 'edit' | 'create';\r\n  action?: Action;\r\n  onSave?: (action: Action) => void;\r\n  onDelete?: (actionId: string) => void;\r\n}\r\n\r\nfunction taskText(a: Action | undefined): string {\r\n  return (a?.content ?? a?.task ?? '') as string;\r\n}\r\nfunction dueDateText(a: Action | undefined): string {\r\n  return (a?.due_date ?? (a as { dueDate?: string })?.dueDate ?? '') as string;\r\n}\r\nfunction createdText(a: Action | undefined): string {\r\n  return (a?.created_at ?? (a as { createdAt?: string })?.createdAt ?? '') as string;\r\n}\r\nfunction parentStoryRef(a: Action | undefined): string {\r\n  return (a?.parent_story_ref ?? '') as string;\r\n}\r\nfunction sizeEstimate(a: Action | undefined): string {\r\n  return (a?.size_estimate ?? '') as string;\r\n}\r\nfunction descriptionText(a: Action | undefined): string {\r\n  return (a?.description ?? '') as string;\r\n}\r\nfunction dodList(a: Action | undefined): string[] {\r\n  return Array.isArray(a?.definition_of_done) ? a.definition_of_done : [];\r\n}\r\nfunction acList(a: Action | undefined): string[] {\r\n  return Array.isArray(a?.acceptance_criteria) ? a.acceptance_criteria : [];\r\n}\r\n\r\n/**\r\n * Show action modal\r\n */\r\nexport function showActionModal(props: ActionModalProps): void {\r\n  const { mode, action, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit' && action?.id;\r\n  const isView = mode === 'view';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'action-modal-content' });\r\n\r\n  if (isView && action) {\r\n    const due = dueDateText(action);\r\n    const isOverdue = due && new Date(due) < new Date() && action.status !== 'completed';\r\n    const parent = parentStoryRef(action);\r\n    const size = sizeEstimate(action);\r\n    const desc = descriptionText(action);\r\n    const dod = dodList(action);\r\n    const ac = acList(action);\r\n\r\n    content.innerHTML = `\r\n      <div class=\"action-view\">\r\n        <div class=\"action-meta\">\r\n          <span class=\"priority-badge priority-${action.priority || 'medium'}\">${action.priority || 'medium'}</span>\r\n          <span class=\"status-badge ${action.status}\">${action.status.replace('_', ' ')}</span>\r\n          ${isOverdue ? '<span class=\"status-badge overdue\">Overdue</span>' : ''}\r\n        </div>\r\n        \r\n        <div class=\"action-task-large ${action.status === 'completed' ? 'completed' : ''}\">\r\n          ${escapeHtml(taskText(action))}\r\n        </div>\r\n        \r\n        <div class=\"action-details\">\r\n          ${action.assignee ? `<div class=\"detail-item\"><strong>Assignee:</strong> ${escapeHtml(action.assignee)}</div>` : ''}\r\n          ${due ? `<div class=\"detail-item\"><strong>Due Date:</strong> ${due}</div>` : ''}\r\n          ${size ? `<div class=\"detail-item\"><strong>Effort:</strong> ${escapeHtml(size)}</div>` : ''}\r\n          ${parent ? `<div class=\"detail-item\"><strong>Parent Story:</strong> ${escapeHtml(parent)}</div>` : ''}\r\n          ${action.generation_source ? `<div class=\"detail-item\"><strong>Source:</strong> ${escapeHtml(action.generation_source)}</div>` : ''}\r\n          ${(action.sprint_id || action.sprint_name) ? `<div class=\"detail-item\"><strong>Sprint:</strong> ${escapeHtml((action.sprint_name as string) || action.sprint_id || '')}</div>` : ''}\r\n          ${action.task_points != null ? `<div class=\"detail-item\"><strong>Task points:</strong> ${action.task_points}</div>` : ''}\r\n          ${(action.requested_by || (action as { requested_by_contact_id?: string }).requested_by_contact_id) ? `<div class=\"detail-item\" id=\"action-view-requester-wrap\"><strong>Requested by:</strong> <span id=\"action-view-requester-card\">${escapeHtml((action.requested_by as string) || '')}</span></div>` : ''}\r\n          <div class=\"detail-item\"><strong>Created:</strong> ${formatRelativeTime(createdText(action))}</div>\r\n        </div>\r\n        ${desc ? `<div class=\"action-description\"><strong>Description</strong><p>${escapeHtml(desc)}</p></div>` : ''}\r\n        ${dod.length ? `<div class=\"action-dod\"><strong>Definition of Done</strong><ul>${dod.map((item: string) => `<li>${escapeHtml(item)}</li>`).join('')}</ul></div>` : ''}\r\n        ${ac.length ? `<div class=\"action-ac\"><strong>Acceptance Criteria</strong><ul>${ac.map((item: string) => `<li>${escapeHtml(item)}</li>`).join('')}</ul></div>` : ''}\r\n      </div>\r\n    `;\r\n  } else {\r\n    const dodStr = dodList(action).join('\\n');\r\n    const acStr = acList(action).join('\\n');\r\n    content.innerHTML = `\r\n      <form id=\"action-form\" class=\"action-form\">\r\n        <div class=\"form-group action-generate-block\">\r\n          <label>Generate from description (AI, uses Sprint Board rules)</label>\r\n          <textarea id=\"action-description-draft\" rows=\"2\" placeholder=\"e.g. Add JWT validation to the API\">${isEdit && action ? escapeHtml([taskText(action), descriptionText(action)].filter(Boolean).join('\\n\\n')) : ''}</textarea>\r\n          <div class=\"action-generate-buttons mt-1\">\r\n            <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"action-generate-btn\">Generate from description</button>\r\n            ${isEdit && action ? '<button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" id=\"action-regenerate-ai-btn\">Regenerate with AI</button>' : ''}\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"action-task\">Task (title) *</label>\r\n          <textarea id=\"action-task\" rows=\"2\" required \r\n                    placeholder=\"Concrete action e.g. Implementar validao JWT no backend\">${escapeHtml(taskText(action))}</textarea>\r\n        </div>\r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"action-parent-story-id\">Parent User Story</label>\r\n            <div class=\"form-row-inline\">\r\n              <select id=\"action-parent-story-id\">\r\n                <option value=\"\"> None </option>\r\n              </select>\r\n              <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"action-new-story-btn\">New story</button>\r\n              <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" id=\"action-edit-story-btn\" title=\"Edit selected story (title, story points)\">Edit story</button>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group\">\r\n            <label for=\"action-size\">Size (estimate)</label>\r\n            <input type=\"text\" id=\"action-size\" \r\n                   value=\"${escapeHtml(sizeEstimate(action))}\" \r\n                   placeholder=\"e.g. 1 day, 8h (max 8h)\">\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"action-sprint-id\">Sprint</label>\r\n          <select id=\"action-sprint-id\">\r\n            <option value=\"\"> None </option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"action-task-points\">Task points (optional)</label>\r\n          <input type=\"number\" id=\"action-task-points\" min=\"0\" step=\"1\" \r\n                 value=\"${action?.task_points != null ? String(action.task_points) : ''}\" \r\n                 placeholder=\"e.g. 2\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"action-depends-on\">Depends on (other tasks)</label>\r\n          <select id=\"action-depends-on\" multiple class=\"form-select-multi\">\r\n            <option value=\"\" disabled>Loading...</option>\r\n          </select>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"action-description\">Description (technical)</label>\r\n          <textarea id=\"action-description\" rows=\"3\" \r\n                    placeholder=\"Implementation notes\">${escapeHtml(descriptionText(action))}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"action-priority\">Priority</label>\r\n            <select id=\"action-priority\">\r\n              <option value=\"low\" ${action?.priority === 'low' ? 'selected' : ''}>Low</option>\r\n              <option value=\"medium\" ${action?.priority === 'medium' || !action ? 'selected' : ''}>Medium</option>\r\n              <option value=\"high\" ${action?.priority === 'high' ? 'selected' : ''}>High</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label for=\"action-status\">Status</label>\r\n            <select id=\"action-status\">\r\n              <option value=\"pending\" ${action?.status === 'pending' || !action ? 'selected' : ''}>Pending</option>\r\n              <option value=\"in_progress\" ${action?.status === 'in_progress' ? 'selected' : ''}>Active (In Progress)</option>\r\n              <option value=\"completed\" ${action?.status === 'completed' ? 'selected' : ''}>Completed</option>\r\n              <option value=\"cancelled\" ${action?.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-row\">\r\n          <div class=\"form-group\">\r\n            <label for=\"action-assignee\">Assignee</label>\r\n            <input type=\"text\" id=\"action-assignee\" \r\n                   value=\"${escapeHtml(action?.assignee ?? action?.owner ?? '')}\" \r\n                   placeholder=\"Who is responsible?\">\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label for=\"action-due\">Due Date</label>\r\n            <input type=\"date\" id=\"action-due\" \r\n                   value=\"${dueDateText(action)}\">\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group action-requester-picker-wrap\">\r\n          <label>Requested by (optional)</label>\r\n          <input type=\"hidden\" id=\"action-requested-by-contact-id\" value=\"${escapeHtml((action?.requested_by_contact_id as string) ?? '')}\">\r\n          <input type=\"hidden\" id=\"action-requested-by\" value=\"${escapeHtml((action?.requested_by as string) ?? '')}\">\r\n          <div class=\"action-assignee-picker-trigger\" id=\"action-modal-requester-trigger\" title=\"Select who requested this task\">\r\n            <span class=\"action-assignee-picker-value\" id=\"action-modal-requester-value\">${(action?.requested_by as string) ? escapeHtml(action.requested_by as string) : '<span class=\"text-muted\">Select requester...</span>'}</span>\r\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n          </div>\r\n          <div id=\"action-modal-requester-dropdown\" class=\"action-assignee-picker-dropdown hidden\">\r\n            <div class=\"action-assignee-picker-search\">\r\n              <input type=\"text\" id=\"action-modal-requester-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n            </div>\r\n            <div id=\"action-modal-requester-list\" class=\"action-assignee-picker-list\">Loading...</div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"action-dod\">Definition of Done (one per line)</label>\r\n          <textarea id=\"action-dod\" rows=\"3\" \r\n                    placeholder=\"e.g. Cdigo testado localmente&#10;PR criado e revisto\">${escapeHtml(dodStr)}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"action-ac\">Acceptance Criteria (one per line)</label>\r\n          <textarea id=\"action-ac\" rows=\"3\" \r\n                    placeholder=\"e.g. Middleware rejeita tokens invlidos com 401&#10;Testes unitrios passam\">${escapeHtml(acStr)}</textarea>\r\n        </div>\r\n      </form>\r\n    `;\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (isView && action) {\r\n    const editBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Edit',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    // Quick complete button if not completed\r\n    if (action.status !== 'completed') {\r\n      const completeBtn = createElement('button', {\r\n        className: 'btn btn-success',\r\n        textContent: 'Mark Complete',\r\n      });\r\n\r\n      on(completeBtn, 'click', async () => {\r\n        try {\r\n          const updated = await actionsService.update(action.id, { status: 'completed' });\r\n          toast.success('Action completed');\r\n          onSave?.(updated);\r\n          closeModal(MODAL_ID);\r\n        } catch {\r\n          // Error shown by API service\r\n        }\r\n      });\r\n\r\n      footer.appendChild(completeBtn);\r\n    }\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n    on(editBtn, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showActionModal({ ...props, mode: 'edit' });\r\n    });\r\n\r\n    footer.appendChild(closeBtn);\r\n    footer.appendChild(editBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const saveBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: isEdit ? 'Save Changes' : 'Create Action',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(saveBtn, 'click', async () => {\r\n      const form = content.querySelector('#action-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\r\n      const lines = (id: string) => getValue(id).split(/\\n/).map((s: string) => s.trim()).filter(Boolean);\r\n\r\n      const contentVal = getValue('action-task');\r\n      const parentStoryIdEl = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n      const dependsOnEl = content.querySelector('#action-depends-on') as HTMLSelectElement;\r\n      const parentStoryId = parentStoryIdEl?.value?.trim() || undefined;\r\n      const dependsOn = dependsOnEl ? Array.from((dependsOnEl as HTMLSelectElement).selectedOptions).map(o => o.value).filter(Boolean) : [];\r\n\r\n      const sprintIdEl = content.querySelector('#action-sprint-id') as HTMLSelectElement;\r\n      const sprintId = sprintIdEl?.value?.trim() || undefined;\r\n      const payload = {\r\n        content: contentVal,\r\n        status: getValue('action-status') as Action['status'],\r\n        priority: getValue('action-priority') as Action['priority'],\r\n        assignee: getValue('action-assignee') || undefined,\r\n        due_date: getValue('action-due') || undefined,\r\n        parent_story_id: parentStoryId,\r\n        size_estimate: getValue('action-size') || undefined,\r\n        description: getValue('action-description') || undefined,\r\n        definition_of_done: lines('action-dod'),\r\n        acceptance_criteria: lines('action-ac'),\r\n        depends_on: dependsOn.length ? dependsOn : undefined,\r\n        requested_by: getValue('action-requested-by') || undefined,\r\n        requested_by_contact_id: getValue('action-requested-by-contact-id') || undefined,\r\n        sprint_id: sprintId,\r\n        task_points: (() => {\r\n          const v = getValue('action-task-points');\r\n          if (v === '' || v == null) return undefined;\r\n          const n = Number(v);\r\n          return Number.isFinite(n) && n >= 0 ? n : undefined;\r\n        })(),\r\n      };\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        if (isEdit) {\r\n          const updated = await actionsService.update(action!.id, payload);\r\n          toast.success('Action updated');\r\n          onSave?.(updated);\r\n        } else {\r\n          const created = await actionsService.create(payload);\r\n          toast.success('Action created');\r\n          onSave?.(created);\r\n        }\r\n\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Action';\r\n      }\r\n    });\r\n\r\n    if (isEdit) {\r\n      const deleteBtn = createElement('button', {\r\n        className: 'btn btn-danger',\r\n        textContent: 'Delete',\r\n      });\r\n\r\n      on(deleteBtn, 'click', async () => {\r\n        const { confirm } = await import('../Modal');\r\n        const confirmed = await confirm(\r\n          'Are you sure you want to delete this action?',\r\n          {\r\n            title: 'Delete Action',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await actionsService.delete(action!.id);\r\n            toast.success('Action deleted');\r\n            onDelete?.(String(action!.id));\r\n            closeModal(MODAL_ID);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n\r\n      footer.appendChild(deleteBtn);\r\n    }\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(saveBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: isView ? 'Action Details' : (isEdit ? 'Edit Action' : 'New Action'),\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  if (isView && action && (action.requested_by || (action as { requested_by_contact_id?: string }).requested_by_contact_id)) {\r\n    const cardEl = content.querySelector('#action-view-requester-card') as HTMLElement;\r\n    if (cardEl) {\r\n      (async () => {\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          const contacts = (res?.contacts || []) as { id?: string; name?: string; role?: string; photoUrl?: string; avatarUrl?: string }[];\r\n          const cid = (action as { requested_by_contact_id?: string }).requested_by_contact_id;\r\n          const contact = cid\r\n            ? contacts.find((c) => c.id && String(c.id) === String(cid))\r\n            : contacts.find(\r\n                (c) =>\r\n                  (c.name || '').trim().toLowerCase() === (action.requested_by as string)?.trim().toLowerCase() ||\r\n                  (c.name || '').toLowerCase().includes((action.requested_by as string)?.toLowerCase() || '')\r\n              );\r\n          const name = contact?.name ?? (action.requested_by as string) ?? '';\r\n          const role = contact?.role ?? '';\r\n          const photoUrl = contact?.photoUrl || contact?.avatarUrl || null;\r\n          const initials = name ? name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2) : '?';\r\n          if (contact) {\r\n            cardEl.innerHTML = `\r\n              <div class=\"action-view-requester-card-inner assignee-chip\">\r\n                <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(name)}\" onerror=\"this.parentElement.innerHTML='${initials}'\">` : initials}</div>\r\n                <div class=\"action-assignee-card-info\">\r\n                  <div class=\"action-assignee-card-name\">${escapeHtml(name)}</div>\r\n                  ${role ? `<div class=\"action-assignee-card-role\">${escapeHtml(role)}</div>` : ''}\r\n                </div>\r\n              </div>\r\n            `;\r\n          }\r\n        } catch {\r\n          /* keep text fallback */\r\n        }\r\n      })();\r\n    }\r\n  }\r\n\r\n  if (!isView && content) {\r\n    (async () => {\r\n      const stories = await actionsService.getUserStories();\r\n      const parentSelect = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n      if (parentSelect) {\r\n        parentSelect.innerHTML = '<option value=\"\"> None </option>';\r\n        stories.forEach(s => {\r\n          const opt = document.createElement('option');\r\n          opt.value = s.id;\r\n          opt.textContent = s.story_points != null ? `${s.title} (${s.story_points} pt)` : s.title;\r\n          if (action?.parent_story_id && String(s.id) === String(action.parent_story_id)) opt.selected = true;\r\n          parentSelect.appendChild(opt);\r\n        });\r\n      }\r\n      const sprints = await getSprints();\r\n      const sprintSelect = content.querySelector('#action-sprint-id') as HTMLSelectElement;\r\n      if (sprintSelect) {\r\n        sprintSelect.innerHTML = '<option value=\"\"> None </option>';\r\n        sprints.forEach(s => {\r\n          const opt = document.createElement('option');\r\n          opt.value = s.id;\r\n          opt.textContent = s.name;\r\n          if (action?.sprint_id && String(s.id) === String(action.sprint_id)) opt.selected = true;\r\n          sprintSelect.appendChild(opt);\r\n        });\r\n      }\r\n      const actions = await actionsService.getAll();\r\n      const depSelect = content.querySelector('#action-depends-on') as HTMLSelectElement;\r\n      if (depSelect) {\r\n        depSelect.innerHTML = '';\r\n        const currentId = action?.id ? String(action.id) : '';\r\n        actions.filter(a => String(a.id) !== currentId).forEach(a => {\r\n          const opt = document.createElement('option');\r\n          opt.value = String(a.id);\r\n          opt.textContent = ((a.content || a.task) || '').substring(0, 60) + (((a.content || a.task) || '').length > 60 ? '...' : '');\r\n          if (Array.isArray(action?.depends_on) && action.depends_on.includes(String(a.id))) opt.selected = true;\r\n          depSelect.appendChild(opt);\r\n        });\r\n      }\r\n    })();\r\n    const newStoryBtn = content.querySelector('#action-new-story-btn');\r\n    if (newStoryBtn) {\r\n      on(newStoryBtn as HTMLElement, 'click', async () => {\r\n        const title = window.prompt('User story title');\r\n        if (!title?.trim()) return;\r\n        const pointsInput = window.prompt('Story points (optional, number). Leave empty to skip.');\r\n        let story_points: number | undefined;\r\n        if (pointsInput != null && pointsInput.trim() !== '') {\r\n          const n = Number(pointsInput.trim());\r\n          if (Number.isFinite(n) && n >= 0) story_points = n;\r\n        }\r\n        try {\r\n          const story = await actionsService.addUserStory({ title: title.trim(), story_points });\r\n          const parentSelect = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n          if (parentSelect) {\r\n            const opt = document.createElement('option');\r\n            opt.value = story.id;\r\n            opt.textContent = story.story_points != null ? `${story.title} (${story.story_points} pt)` : story.title;\r\n            opt.selected = true;\r\n            parentSelect.appendChild(opt);\r\n          }\r\n          toast.success('User story created');\r\n        } catch (e) {\r\n          toast.error((e as Error).message || 'Failed to create story');\r\n        }\r\n      });\r\n    }\r\n    const editStoryBtn = content.querySelector('#action-edit-story-btn');\r\n    if (editStoryBtn) {\r\n      on(editStoryBtn as HTMLElement, 'click', async () => {\r\n        const parentSelect = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n        const storyId = parentSelect?.value?.trim();\r\n        if (!storyId) {\r\n          toast.error('Select a user story first');\r\n          return;\r\n        }\r\n        try {\r\n          const story = await actionsService.getUserStory(storyId);\r\n          if (!story) {\r\n            toast.error('Story not found');\r\n            return;\r\n          }\r\n          const newTitle = window.prompt('User story title', story.title);\r\n          if (newTitle == null) return;\r\n          const title = newTitle.trim();\r\n          if (!title) {\r\n            toast.error('Title is required');\r\n            return;\r\n          }\r\n          const pointsInput = window.prompt('Story points (optional, number). Leave empty to clear.', story.story_points != null ? String(story.story_points) : '');\r\n          let story_points: number | null | undefined = undefined;\r\n          if (pointsInput != null) {\r\n            if (pointsInput.trim() === '') story_points = null;\r\n            else {\r\n              const n = Number(pointsInput.trim());\r\n              if (Number.isFinite(n) && n >= 0) story_points = n;\r\n            }\r\n          }\r\n          await actionsService.updateUserStory(storyId, { title, ...(story_points !== undefined ? { story_points } : {}) });\r\n          if (parentSelect) {\r\n            const opt = parentSelect.selectedOptions?.[0];\r\n            if (opt) opt.textContent = story_points != null ? `${title} (${story_points} pt)` : title;\r\n          }\r\n          toast.success('User story updated');\r\n        } catch (e) {\r\n          toast.error((e as Error).message || 'Failed to update story');\r\n        }\r\n      });\r\n    }\r\n    const runGenerateFromDraft = async (btn: HTMLButtonElement, btnLabel: string) => {\r\n      const draftEl = content.querySelector('#action-description-draft') as HTMLTextAreaElement;\r\n      const draft = draftEl?.value?.trim() || '';\r\n      if (!draft) {\r\n        toast.error('Enter a short description first');\r\n        return;\r\n      }\r\n      btn.textContent = 'Generating...';\r\n      btn.disabled = true;\r\n      try {\r\n        const parentSelect = content.querySelector('#action-parent-story-id') as HTMLSelectElement;\r\n        const parentRef = parentSelect?.selectedOptions?.[0]?.textContent || '';\r\n        const result = await actionsService.suggestTaskFromDescription({ user_input: draft, parent_story_ref: parentRef || undefined });\r\n        (content.querySelector('#action-task') as HTMLTextAreaElement).value = result.task;\r\n        (content.querySelector('#action-description') as HTMLTextAreaElement).value = result.description;\r\n        (content.querySelector('#action-size') as HTMLInputElement).value = result.size_estimate;\r\n        (content.querySelector('#action-dod') as HTMLTextAreaElement).value = result.definition_of_done.join('\\n');\r\n        (content.querySelector('#action-ac') as HTMLTextAreaElement).value = result.acceptance_criteria.join('\\n');\r\n        toast.success(btn.id === 'action-regenerate-ai-btn' ? 'Task regenerated with AI' : 'Task generated from description');\r\n      } catch (e) {\r\n        toast.error((e as Error).message || 'Failed to generate');\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.textContent = btnLabel;\r\n      }\r\n    };\r\n    const genBtn = content.querySelector('#action-generate-btn');\r\n    if (genBtn) {\r\n      on(genBtn as HTMLElement, 'click', () => runGenerateFromDraft(genBtn as HTMLButtonElement, 'Generate from description'));\r\n    }\r\n    const regenBtn = content.querySelector('#action-regenerate-ai-btn');\r\n    if (regenBtn) {\r\n      on(regenBtn as HTMLElement, 'click', () => runGenerateFromDraft(regenBtn as HTMLButtonElement, 'Regenerate with AI'));\r\n    }\r\n    const requesterTrigger = content.querySelector('#action-modal-requester-trigger');\r\n    const requesterDropdown = content.querySelector('#action-modal-requester-dropdown') as HTMLElement;\r\n    const requesterValue = content.querySelector('#action-modal-requester-value');\r\n    const requesterList = content.querySelector('#action-modal-requester-list') as HTMLElement;\r\n    const requesterSearch = content.querySelector('#action-modal-requester-search') as HTMLInputElement;\r\n    const requesterContactIdInput = content.querySelector('#action-requested-by-contact-id') as HTMLInputElement;\r\n    const requesterNameInput = content.querySelector('#action-requested-by') as HTMLInputElement;\r\n    if (requesterTrigger && requesterDropdown && requesterList && requesterContactIdInput && requesterNameInput) {\r\n      let requesterContacts: { id: string; name: string; role?: string }[] = [];\r\n      const escapeHtml = (s: string) => {\r\n        const div = document.createElement('div');\r\n        div.textContent = s;\r\n        return div.innerHTML;\r\n      };\r\n      const getInitials = (name: string) => name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\r\n      const renderRequesterList = (filter = '') => {\r\n        const filtered = filter\r\n          ? requesterContacts.filter(\r\n              (c) =>\r\n                (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n                (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n            )\r\n          : requesterContacts;\r\n        if (requesterContacts.length === 0) {\r\n          requesterList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n          return;\r\n        }\r\n        requesterList.innerHTML =\r\n          '<div class=\"action-assignee-card-picker\" data-contact-id=\"\" data-contact-name=\"\"><div class=\"action-assignee-card-info\"><div class=\"action-assignee-card-name text-muted\">No requester</div></div></div>' +\r\n          filtered\r\n            .map(\r\n              (c) => `\r\n            <div class=\"action-assignee-card-picker\" data-contact-id=\"${escapeHtml(c.id)}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"action-assignee-card-info\">\r\n                <div class=\"action-assignee-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"action-assignee-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `\r\n            )\r\n            .join('');\r\n        requesterList.querySelectorAll('.action-assignee-card-picker').forEach((card) => {\r\n          on(card as HTMLElement, 'click', () => {\r\n            const id = card.getAttribute('data-contact-id') || '';\r\n            const name = card.getAttribute('data-contact-name') || '';\r\n            requesterContactIdInput.value = id;\r\n            requesterNameInput.value = name;\r\n            if (requesterValue) requesterValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select requester...</span>';\r\n            requesterDropdown.classList.add('hidden');\r\n          });\r\n        });\r\n      };\r\n      on(requesterTrigger as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const isOpen = !requesterDropdown.classList.contains('hidden');\r\n        requesterDropdown.classList.toggle('hidden', isOpen);\r\n        if (!isOpen && requesterContacts.length === 0) {\r\n          requesterList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n          try {\r\n            const res = await contactsService.getAll();\r\n            requesterContacts = (res?.contacts || []).map((c) => ({ id: c.id, name: c.name || '', role: c.role }));\r\n            renderRequesterList(requesterSearch?.value || '');\r\n          } catch {\r\n            requesterList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n          }\r\n        } else if (!isOpen) renderRequesterList(requesterSearch?.value || '');\r\n      });\r\n      if (requesterSearch) requesterSearch.addEventListener('input', () => renderRequesterList(requesterSearch.value));\r\n      const closeRequesterDropdown = () => {\r\n        if (requesterDropdown && !requesterDropdown.classList.contains('hidden')) requesterDropdown.classList.add('hidden');\r\n      };\r\n      let removed = false;\r\n      const removeListeners = () => {\r\n        if (removed) return;\r\n        removed = true;\r\n        document.removeEventListener('click', clickHandler);\r\n        document.removeEventListener('keydown', keyHandler);\r\n      };\r\n      const clickHandler = (e: MouseEvent) => {\r\n        const modalEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n        if (!modalEl?.classList.contains('open')) {\r\n          removeListeners();\r\n          return;\r\n        }\r\n        const target = e.target as HTMLElement;\r\n        if (!target.closest('.action-requester-picker-wrap')) closeRequesterDropdown();\r\n      };\r\n      const keyHandler = (e: KeyboardEvent) => {\r\n        const modalEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n        if (!modalEl?.classList.contains('open')) {\r\n          removeListeners();\r\n          return;\r\n        }\r\n        if (e.key === 'Escape') closeRequesterDropdown();\r\n      };\r\n      document.addEventListener('click', clickHandler);\r\n      document.addEventListener('keydown', keyHandler);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showActionModal;\r\n","/**\r\n * Create Sprint Modal\r\n * Create sprint, generate tasks from emails/transcripts, preview and apply\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { createSprint, generateSprintTasks, applySprintGeneration, ProposedTask, Sprint } from '../../services/sprints';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'create-sprint-modal';\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport interface CreateSprintModalProps {\r\n  onSuccess?: (sprint: Sprint) => void;\r\n}\r\n\r\nexport function showCreateSprintModal(props: CreateSprintModalProps = {}): void {\r\n  const { onSuccess } = props;\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'create-sprint-modal-content' });\r\n  content.innerHTML = `\r\n    <form id=\"create-sprint-form\" class=\"create-sprint-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"sprint-name\">Sprint name *</label>\r\n        <input type=\"text\" id=\"sprint-name\" required placeholder=\"e.g. Sprint 12\">\r\n      </div>\r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"sprint-start\">Start date *</label>\r\n          <input type=\"date\" id=\"sprint-start\" required>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"sprint-end\">End date *</label>\r\n          <input type=\"date\" id=\"sprint-end\" required>\r\n        </div>\r\n      </div>\r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"sprint-analysis-start\">Analysis period start</label>\r\n          <input type=\"date\" id=\"sprint-analysis-start\" title=\"From when to consider emails/transcripts\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"sprint-analysis-end\">Analysis period end</label>\r\n          <input type=\"date\" id=\"sprint-analysis-end\" title=\"Until when to consider emails/transcripts\">\r\n        </div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label for=\"sprint-context\">Sprint context / goals</label>\r\n        <textarea id=\"sprint-context\" rows=\"3\" placeholder=\"What is the focus of this sprint? Goals, priorities...\"></textarea>\r\n      </div>\r\n    </form>\r\n    <div id=\"create-sprint-step2\" class=\"create-sprint-preview hidden\">\r\n      <p class=\"create-sprint-preview-intro\">Review proposed tasks and existing actions to link. Then click Apply.</p>\r\n      <div class=\"form-group\">\r\n        <label>New tasks to create</label>\r\n        <div id=\"create-sprint-new-tasks-list\" class=\"create-sprint-tasks-list\"></div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Existing actions to add to this sprint</label>\r\n        <div id=\"create-sprint-existing-list\" class=\"create-sprint-existing-list\"></div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n  footer.innerHTML = `\r\n    <button type=\"button\" class=\"btn btn-secondary\" id=\"create-sprint-cancel-btn\">Cancel</button>\r\n    <button type=\"button\" class=\"btn btn-primary\" id=\"create-sprint-generate-btn\">Create Sprint & Generate Tasks</button>\r\n    <button type=\"button\" class=\"btn btn-primary hidden\" id=\"create-sprint-apply-btn\">Apply</button>\r\n  `;\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Create Sprint',\r\n    content,\r\n    size: 'lg',\r\n    closable: true,\r\n    footer,\r\n    onClose: () => {},\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  let createdSprint: Sprint | null = null;\r\n  let proposedNewTasks: ProposedTask[] = [];\r\n  let existingActionIds: string[] = [];\r\n  const existingCheckboxes: Map<string, HTMLInputElement> = new Map();\r\n\r\n  const getVal = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement)?.value?.trim() || '';\r\n  const form = content.querySelector('#create-sprint-form') as HTMLFormElement;\r\n  const step2 = content.querySelector('#create-sprint-step2') as HTMLElement;\r\n  const generateBtn = content.querySelector('#create-sprint-generate-btn') as HTMLButtonElement;\r\n  const applyBtn = content.querySelector('#create-sprint-apply-btn') as HTMLButtonElement;\r\n  const cancelBtn = content.querySelector('#create-sprint-cancel-btn') as HTMLButtonElement;\r\n\r\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n  on(generateBtn, 'click', async () => {\r\n    if (!form.checkValidity()) {\r\n      form.reportValidity();\r\n      return;\r\n    }\r\n    const name = getVal('sprint-name');\r\n    const start_date = getVal('sprint-start');\r\n    const end_date = getVal('sprint-end');\r\n    if (new Date(end_date) < new Date(start_date)) {\r\n      toast.error('End date must be after start date');\r\n      return;\r\n    }\r\n    generateBtn.disabled = true;\r\n    generateBtn.textContent = 'Creating...';\r\n    try {\r\n      createdSprint = await createSprint({\r\n        name,\r\n        start_date,\r\n        end_date,\r\n        context: getVal('sprint-context') || undefined,\r\n        analysis_start_date: getVal('sprint-analysis-start') || undefined,\r\n        analysis_end_date: getVal('sprint-analysis-end') || undefined,\r\n      });\r\n      generateBtn.textContent = 'Generating tasks...';\r\n      const result = await generateSprintTasks(createdSprint.id, {\r\n        analysis_start_date: getVal('sprint-analysis-start') || undefined,\r\n        analysis_end_date: getVal('sprint-analysis-end') || undefined,\r\n      });\r\n      proposedNewTasks = result.proposed_new_tasks || [];\r\n      existingActionIds = result.existing_action_ids || [];\r\n      const existingDetails = result.existing_details || [];\r\n\r\n      form.classList.add('hidden');\r\n      step2.classList.remove('hidden');\r\n      generateBtn.classList.add('hidden');\r\n      applyBtn.classList.remove('hidden');\r\n\r\n      const newList = content.querySelector('#create-sprint-new-tasks-list') as HTMLElement;\r\n      newList.innerHTML = proposedNewTasks.length\r\n        ? proposedNewTasks.map((t, i) => `\r\n          <div class=\"create-sprint-task-item\" data-index=\"${i}\">\r\n            <div class=\"create-sprint-task-title\">${escapeHtml((t.task || '').slice(0, 120))}${(t.task || '').length > 120 ? '' : ''}</div>\r\n            ${t.size_estimate ? `<span class=\"create-sprint-task-size\">${escapeHtml(t.size_estimate)}</span>` : ''}\r\n          </div>\r\n        `).join('')\r\n        : '<p class=\"text-muted\">No new tasks suggested.</p>';\r\n\r\n      const existingList = content.querySelector('#create-sprint-existing-list') as HTMLElement;\r\n      existingCheckboxes.clear();\r\n      if (existingDetails.length) {\r\n        existingList.innerHTML = existingDetails.map((a) => {\r\n          const checked = existingActionIds.includes(a.id);\r\n          return `\r\n            <label class=\"create-sprint-existing-item\">\r\n              <input type=\"checkbox\" data-action-id=\"${a.id}\" ${checked ? 'checked' : ''}>\r\n              <span>${escapeHtml((a.task || '').slice(0, 80))}${(a.task || '').length > 80 ? '' : ''}</span>\r\n              <span class=\"create-sprint-existing-status\">${escapeHtml(a.status || '')}</span>\r\n            </label>\r\n          `;\r\n        }).join('');\r\n        existingList.querySelectorAll('input[type=checkbox]').forEach((cb) => {\r\n          existingCheckboxes.set((cb as HTMLInputElement).dataset.actionId!, cb as HTMLInputElement);\r\n        });\r\n      } else {\r\n        existingList.innerHTML = '<p class=\"text-muted\">No existing actions suggested.</p>';\r\n      }\r\n      toast.success('Sprint created. Review and click Apply to add tasks.');\r\n    } catch (e) {\r\n      toast.error((e as Error).message || 'Failed');\r\n    } finally {\r\n      generateBtn.disabled = false;\r\n      generateBtn.textContent = 'Create Sprint & Generate Tasks';\r\n    }\r\n  });\r\n\r\n  on(applyBtn, 'click', async () => {\r\n    if (!createdSprint) return;\r\n    const selectedExisting = Array.from(existingCheckboxes.entries())\r\n      .filter(([, el]) => el.checked)\r\n      .map(([id]) => id);\r\n    applyBtn.disabled = true;\r\n    applyBtn.textContent = 'Applying...';\r\n    try {\r\n      await applySprintGeneration(createdSprint.id, {\r\n        new_tasks: proposedNewTasks,\r\n        existing_action_ids: selectedExisting,\r\n      });\r\n      toast.success('Sprint applied. New tasks created and existing actions linked.');\r\n      closeModal(MODAL_ID);\r\n      onSuccess?.(createdSprint);\r\n    } catch (e) {\r\n      toast.error((e as Error).message || 'Apply failed');\r\n    } finally {\r\n      applyBtn.disabled = false;\r\n      applyBtn.textContent = 'Apply';\r\n    }\r\n  });\r\n}\r\n","/**\r\n * Breakdown Chart Widget\r\n * Bar/doughnut chart for sprint report: by status, by assignee\r\n */\r\n\r\nimport { createElement } from '../../utils/dom';\r\n\r\nconst STATUS_COLORS: Record<string, string> = {\r\n  pending: '#94a3b8',\r\n  in_progress: '#3b82f6',\r\n  completed: '#22c55e',\r\n  cancelled: '#64748b',\r\n  overdue: '#ef4444',\r\n};\r\n\r\nexport interface BreakdownChartProps {\r\n  byStatus: Record<string, number>;\r\n  byAssignee?: Record<string, number>;\r\n  height?: number;\r\n  showAssignee?: boolean;\r\n}\r\n\r\nfunction capitalize(str: string): string {\r\n  return str.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\r\n}\r\n\r\n/**\r\n * Create breakdown chart element (by status; optional by assignee)\r\n */\r\nexport function createBreakdownChart(props: BreakdownChartProps): HTMLElement {\r\n  const { byStatus, byAssignee = {}, height = 220, showAssignee = true } = props;\r\n\r\n  const container = createElement('div', { className: 'breakdown-chart-container' });\r\n  container.style.height = `${height}px`;\r\n\r\n  const statusEntries = Object.entries(byStatus).filter(([, v]) => v > 0);\r\n  const assigneeEntries = Object.entries(byAssignee).filter(([, v]) => v > 0);\r\n\r\n  if (statusEntries.length === 0 && assigneeEntries.length === 0) {\r\n    container.innerHTML = '<div class=\"empty-chart\">No data for breakdown</div>';\r\n    return container;\r\n  }\r\n\r\n  const chartId = `breakdown-chart-${Date.now()}`;\r\n  container.innerHTML = `\r\n    <div class=\"breakdown-chart-wrapper\">\r\n      <div class=\"breakdown-chart-section\">\r\n        <div class=\"breakdown-chart-title\">By status</div>\r\n        <canvas id=\"${chartId}-status\" width=\"280\" height=\"${Math.min(180, height - 40)}\"></canvas>\r\n      </div>\r\n      ${showAssignee && assigneeEntries.length > 0 ? `\r\n      <div class=\"breakdown-chart-section\">\r\n        <div class=\"breakdown-chart-title\">By assignee</div>\r\n        <canvas id=\"${chartId}-assignee\" width=\"280\" height=\"${Math.min(180, height - 40)}\"></canvas>\r\n      </div>\r\n      ` : ''}\r\n    </div>\r\n  `;\r\n\r\n  const statusCanvas = container.querySelector(`#${chartId}-status`) as HTMLCanvasElement;\r\n  if (statusCanvas && statusEntries.length > 0) {\r\n    const statusLabels = statusEntries.map(([k]) => capitalize(k));\r\n    const statusValues = statusEntries.map(([, v]) => v);\r\n    const statusKeys = statusEntries.map(([k]) => k);\r\n    initBarChart(statusCanvas, statusLabels, statusValues, (_, i) => STATUS_COLORS[statusKeys[i]] || '#6366f1');\r\n  }\r\n\r\n  if (showAssignee && assigneeEntries.length > 0) {\r\n    const assigneeCanvas = container.querySelector(`#${chartId}-assignee`) as HTMLCanvasElement;\r\n    if (assigneeCanvas) {\r\n      const palette = ['#6366f1', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6'];\r\n      initBarChart(assigneeCanvas, assigneeEntries.map(([k]) => k || '(unassigned)'), assigneeEntries.map(([, v]) => v), (_, i) => palette[i % palette.length]);\r\n    }\r\n  }\r\n\r\n  return container;\r\n}\r\n\r\nfunction initBarChart(\r\n  canvas: HTMLCanvasElement,\r\n  labels: string[],\r\n  values: number[],\r\n  colorFn: (label: string, index: number) => string\r\n): void {\r\n  if (typeof (window as unknown as { Chart?: unknown }).Chart === 'undefined') {\r\n    renderFallbackBars(canvas.parentElement as HTMLElement, labels, values, (l, i) => colorFn(l, i));\r\n    return;\r\n  }\r\n\r\n  const Chart = (window as unknown as { Chart: typeof import('chart.js').Chart }).Chart;\r\n  const colors = labels.map((l, i) => colorFn(l, i));\r\n\r\n  new Chart(canvas, {\r\n    type: 'bar',\r\n    data: {\r\n      labels,\r\n      datasets: [{\r\n        label: 'Count',\r\n        data: values,\r\n        backgroundColor: colors,\r\n        borderColor: colors.map(c => c),\r\n        borderWidth: 1,\r\n      }],\r\n    },\r\n    options: {\r\n      responsive: true,\r\n      maintainAspectRatio: false,\r\n      plugins: {\r\n        legend: { display: false },\r\n      },\r\n      scales: {\r\n        y: { beginAtZero: true, ticks: { stepSize: 1 } },\r\n      },\r\n    },\r\n  });\r\n}\r\n\r\nfunction renderFallbackBars(\r\n  container: HTMLElement,\r\n  labels: string[],\r\n  values: number[],\r\n  colorFn: (label: string, index: number) => string\r\n): void {\r\n  const max = Math.max(...values, 1);\r\n  const bars = labels.map((label, i) => {\r\n    const v = values[i];\r\n    const pct = (v / max) * 100;\r\n    const color = colorFn(label, i);\r\n    return `<div class=\"breakdown-fallback-bar\"><span class=\"bar-label\">${escapeHtml(label)}</span><div class=\"bar-track\"><div class=\"bar-fill\" style=\"width:${pct}%;background:${color}\"></div></div><span class=\"bar-value\">${v}</span></div>`;\r\n  }).join('');\r\n  const wrap = document.createElement('div');\r\n  wrap.className = 'breakdown-fallback';\r\n  wrap.innerHTML = bars;\r\n  container.appendChild(wrap);\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createBreakdownChart;\r\n","/**\r\n * Sprint Report Modal\r\n * Full report: breakdown chart, task list, AI analysis, business report\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport {\r\n  getSprintReport,\r\n  analyzeSprintReport,\r\n  getSprintBusinessReport,\r\n  generateSprintReportDocument,\r\n  generateSprintReportPresentation,\r\n  type SprintReport,\r\n  type ReportDocumentStyle,\r\n} from '../../services/sprints';\r\nimport { createBreakdownChart } from '../widgets/BreakdownChart';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'sprint-report-modal';\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport interface SprintReportModalProps {\r\n  sprintId: string;\r\n  sprintName?: string;\r\n  onClose?: () => void;\r\n}\r\n\r\nexport function showSprintReportModal(props: SprintReportModalProps): void {\r\n  const { sprintId, sprintName = 'Sprint', onClose } = props;\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'sprint-report-modal-content' });\r\n  content.innerHTML = `\r\n    <div class=\"sprint-report-loading\">Loading report...</div>\r\n    <div id=\"sprint-report-body\" class=\"sprint-report-body hidden\">\r\n      <div class=\"sprint-report-export-section\">\r\n        <h4>Export as</h4>\r\n        <div class=\"sprint-report-format-row\">\r\n          <label class=\"sprint-report-format-option\">\r\n            <input type=\"radio\" name=\"sprint-report-format\" value=\"document\" checked> Document (A4)\r\n          </label>\r\n          <label class=\"sprint-report-format-option\">\r\n            <input type=\"radio\" name=\"sprint-report-format\" value=\"presentation\"> Presentation (PPT)\r\n          </label>\r\n        </div>\r\n        <div id=\"sprint-report-document-options\" class=\"sprint-report-format-options\">\r\n          <label class=\"sprint-report-style-row\">\r\n            <span>Style:</span>\r\n            <select id=\"sprint-report-document-style\">\r\n              <option value=\"\">Default</option>\r\n              <option value=\"sprint_report_style_corporate_classic\">Corporativo clssico</option>\r\n              <option value=\"sprint_report_style_modern_minimal\">Moderno minimalista</option>\r\n              <option value=\"sprint_report_style_startup_tech\">Startup / Tech</option>\r\n              <option value=\"sprint_report_style_consultancy\">Consultoria / Enterprise</option>\r\n            </select>\r\n          </label>\r\n          <label class=\"sprint-report-check\"><input type=\"checkbox\" id=\"sprint-report-include-analysis\"> Include AI analysis</label>\r\n          <label class=\"sprint-report-check\"><input type=\"checkbox\" id=\"sprint-report-include-business\"> Include business report</label>\r\n        </div>\r\n        <div id=\"sprint-report-presentation-options\" class=\"sprint-report-format-options hidden\">\r\n          <label class=\"sprint-report-check\"><input type=\"checkbox\" id=\"sprint-report-ppt-include-analysis\"> Include AI analysis</label>\r\n          <label class=\"sprint-report-check\"><input type=\"checkbox\" id=\"sprint-report-ppt-include-business\"> Include business report</label>\r\n        </div>\r\n        <div class=\"sprint-report-generate-row\">\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"sprint-report-generate-doc-btn\">Generate document (A4)</button>\r\n          <button type=\"button\" class=\"btn btn-primary hidden\" id=\"sprint-report-generate-ppt-btn\">Generate presentation (PPT)</button>\r\n          <label class=\"sprint-report-check sprint-report-pdf-option\"><input type=\"checkbox\" id=\"sprint-report-open-for-pdf\"> Open for PDF (print dialog)</label>\r\n        </div>\r\n        <div id=\"sprint-report-generate-status\" class=\"sprint-report-generate-status hidden\"></div>\r\n      </div>\r\n      <div class=\"sprint-report-summary\" id=\"sprint-report-summary\"></div>\r\n      <div class=\"sprint-report-chart\" id=\"sprint-report-chart\"></div>\r\n      <div class=\"sprint-report-actions-list\" id=\"sprint-report-actions\"></div>\r\n      <div class=\"sprint-report-ai-section\">\r\n        <h4>AI analysis</h4>\r\n        <div id=\"sprint-report-ai-placeholder\" class=\"sprint-report-ai-placeholder\">Click \"Analyze with AI\" to generate.</div>\r\n        <div id=\"sprint-report-ai-content\" class=\"sprint-report-ai-content hidden\"></div>\r\n      </div>\r\n      <div class=\"sprint-report-business-section\">\r\n        <h4>Business report</h4>\r\n        <div id=\"sprint-report-business-placeholder\" class=\"sprint-report-business-placeholder\">Click \"Business report\" to generate.</div>\r\n        <div id=\"sprint-report-business-content\" class=\"sprint-report-business-content hidden\"></div>\r\n      </div>\r\n    </div>\r\n    <div id=\"sprint-report-error\" class=\"sprint-report-error hidden\"></div>\r\n  `;\r\n\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n  footer.innerHTML = `\r\n    <button type=\"button\" class=\"btn btn-outline-secondary\" id=\"sprint-report-export-pdf-btn\">Export report as PDF</button>\r\n    <button type=\"button\" class=\"btn btn-secondary\" id=\"sprint-report-analyze-btn\">Analyze with AI</button>\r\n    <button type=\"button\" class=\"btn btn-outline-primary\" id=\"sprint-report-business-btn\">Business report</button>\r\n    <button type=\"button\" class=\"btn btn-primary\" id=\"sprint-report-close-btn\">Close</button>\r\n  `;\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: `Sprint report: ${escapeHtml(sprintName)}`,\r\n    content,\r\n    size: 'xl',\r\n    closable: true,\r\n    footer,\r\n    onClose: () => {\r\n      onClose?.();\r\n    },\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  let reportData: SprintReport | null = null;\r\n\r\n  async function loadReport(): Promise<void> {\r\n    const loading = content.querySelector('.sprint-report-loading') as HTMLElement;\r\n    const body = content.querySelector('#sprint-report-body') as HTMLElement;\r\n    const errEl = content.querySelector('#sprint-report-error') as HTMLElement;\r\n    if (!loading || !body || !errEl) return;\r\n\r\n    try {\r\n      const report = await getSprintReport(sprintId);\r\n      if (!report) {\r\n        errEl.textContent = 'Failed to load report';\r\n        errEl.classList.remove('hidden');\r\n        loading.classList.add('hidden');\r\n        return;\r\n      }\r\n      reportData = report;\r\n      loading.classList.add('hidden');\r\n      errEl.classList.add('hidden');\r\n      body.classList.remove('hidden');\r\n\r\n      const summaryEl = content.querySelector('#sprint-report-summary') as HTMLElement;\r\n      if (summaryEl) {\r\n        const pct = report.total_tasks ? Math.round((report.completed_tasks / report.total_tasks) * 100) : 0;\r\n        const pointsLine =\r\n          report.total_task_points > 0\r\n            ? `  ${report.completed_task_points}/${report.total_task_points} points`\r\n            : '';\r\n        summaryEl.innerHTML = `\r\n          <p><strong>${report.completed_tasks}</strong> / <strong>${report.total_tasks}</strong> tasks completed (${pct}%)${pointsLine}</p>\r\n          <p class=\"sprint-report-dates\">${report.sprint.start_date}  ${report.sprint.end_date}</p>\r\n          ${report.sprint.context ? `<p class=\"sprint-report-context\">${escapeHtml(report.sprint.context)}</p>` : ''}\r\n        `;\r\n      }\r\n\r\n      const chartEl = content.querySelector('#sprint-report-chart') as HTMLElement;\r\n      if (chartEl) {\r\n        chartEl.innerHTML = '';\r\n        chartEl.appendChild(\r\n          createBreakdownChart({\r\n            byStatus: report.breakdown.by_status,\r\n            byAssignee: report.breakdown.by_assignee,\r\n            height: 200,\r\n            showAssignee: true,\r\n          })\r\n        );\r\n      }\r\n\r\n      const listEl = content.querySelector('#sprint-report-actions') as HTMLElement;\r\n      if (listEl && report.actions.length > 0) {\r\n        listEl.innerHTML = `\r\n          <h4>Tasks (${report.actions.length})</h4>\r\n          <ul class=\"sprint-report-task-list\">\r\n            ${report.actions\r\n              .map(\r\n                (a) =>\r\n                  `<li class=\"sprint-report-task-item\" data-status=\"${escapeHtml((a.status || 'pending').toLowerCase())}\">\r\n                    <span class=\"task-status-dot\"></span>\r\n                    ${escapeHtml(a.task || a.content || '')}\r\n                    ${a.task_points != null ? `<span class=\"task-points\">${a.task_points} pt</span>` : ''}\r\n                  </li>`\r\n              )\r\n              .join('')}\r\n          </ul>\r\n        `;\r\n      } else if (listEl) {\r\n        listEl.innerHTML = '<p class=\"sprint-report-no-tasks\">No tasks in this sprint.</p>';\r\n      }\r\n    } catch (e) {\r\n      loading.classList.add('hidden');\r\n      body.classList.add('hidden');\r\n      errEl.textContent = e instanceof Error ? e.message : 'Failed to load report';\r\n      errEl.classList.remove('hidden');\r\n    }\r\n  }\r\n\r\n  on(footer.querySelector('#sprint-report-close-btn') as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n\r\n  /** Build printable HTML from current report data and open print dialog (Save as PDF). */\r\n  function exportReportAsPdf(): void {\r\n    if (!reportData) {\r\n      toast.error('Report not loaded yet');\r\n      return;\r\n    }\r\n    const sprint = reportData.sprint;\r\n    const aiEl = content.querySelector('#sprint-report-ai-content');\r\n    const bizEl = content.querySelector('#sprint-report-business-content');\r\n    const aiHtml = aiEl && !aiEl.classList.contains('hidden') ? aiEl.innerHTML : '';\r\n    const bizHtml = bizEl && !bizEl.classList.contains('hidden') ? bizEl.innerHTML : '';\r\n    const byStatus = reportData.breakdown.by_status || {};\r\n    const byAssignee = reportData.breakdown.by_assignee || {};\r\n    const html = `<!DOCTYPE html><html><head><meta charset=\"utf-8\"><title>Sprint Report  ${escapeHtml(sprint.name)}</title>\r\n<style>\r\n  body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; color: #333; line-height: 1.5; }\r\n  h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }\r\n  h2 { font-size: 1.15rem; margin-top: 1.5rem; margin-bottom: 0.5rem; }\r\n  p, ul { margin: 0.5rem 0; }\r\n  ul { padding-left: 1.5rem; }\r\n  .meta { color: #666; font-size: 0.9rem; }\r\n  .section { margin-top: 1rem; }\r\n  @media print { body { margin: 1rem; } }\r\n</style></head><body>\r\n  <h1>${escapeHtml(sprint.name)}</h1>\r\n  <p class=\"meta\">${escapeHtml(sprint.start_date)}  ${escapeHtml(sprint.end_date)}</p>\r\n  ${sprint.context ? `<p>${escapeHtml(sprint.context)}</p>` : ''}\r\n  <div class=\"section\">\r\n    <h2>Summary</h2>\r\n    <p><strong>${reportData.completed_tasks}</strong> / <strong>${reportData.total_tasks}</strong> tasks completed${reportData.total_task_points > 0 ? `  ${reportData.completed_task_points}/${reportData.total_task_points} points` : ''}.</p>\r\n  </div>\r\n  <div class=\"section\">\r\n    <h2>By status</h2>\r\n    <ul>${Object.entries(byStatus).map(([k, v]) => `<li>${escapeHtml(k)}: ${v}</li>`).join('')}</ul>\r\n  </div>\r\n  <div class=\"section\">\r\n    <h2>By assignee</h2>\r\n    <ul>${Object.entries(byAssignee).map(([k, v]) => `<li>${escapeHtml(k)}: ${v}</li>`).join('')}</ul>\r\n  </div>\r\n  <div class=\"section\">\r\n    <h2>Tasks</h2>\r\n    <ul>${reportData.actions.slice(0, 100).map(a => `<li>${escapeHtml((a.status || 'pending'))}: ${escapeHtml((a.task || a.content || '').substring(0, 200))}${a.task_points != null ? ` (${a.task_points} pt)` : ''}</li>`).join('')}</ul>\r\n    ${reportData.actions.length > 100 ? `<p class=\"meta\"> and ${reportData.actions.length - 100} more tasks</p>` : ''}\r\n  </div>\r\n  ${aiHtml ? `<div class=\"section\"><h2>AI analysis</h2><div>${aiHtml}</div></div>` : ''}\r\n  ${bizHtml ? `<div class=\"section\"><h2>Business report</h2><div>${bizHtml}</div></div>` : ''}\r\n<script>window.onload=function(){window.print();}<\\/script>\r\n</body></html>`;\r\n    const blob = new Blob([html], { type: 'text/html;charset=utf-8' });\r\n    const url = URL.createObjectURL(blob);\r\n    const w = window.open(url, '_blank', 'noopener');\r\n    if (w) {\r\n      w.addEventListener('load', () => URL.revokeObjectURL(url), { once: true });\r\n    } else {\r\n      toast.error('Allow pop-ups to export PDF');\r\n      URL.revokeObjectURL(url);\r\n    }\r\n  }\r\n\r\n  const exportPdfBtn = footer.querySelector('#sprint-report-export-pdf-btn');\r\n  if (exportPdfBtn) on(exportPdfBtn as HTMLElement, 'click', () => exportReportAsPdf());\r\n\r\n  // Format: Document vs Presentation  toggle options and which generate button is visible\r\n  const docOptions = content.querySelector('#sprint-report-document-options') as HTMLElement;\r\n  const pptOptions = content.querySelector('#sprint-report-presentation-options') as HTMLElement;\r\n  const docBtn = content.querySelector('#sprint-report-generate-doc-btn') as HTMLButtonElement;\r\n  const pptBtn = content.querySelector('#sprint-report-generate-ppt-btn') as HTMLButtonElement;\r\n  content.querySelectorAll('input[name=\"sprint-report-format\"]').forEach((radio) => {\r\n    on(radio as HTMLElement, 'change', () => {\r\n      const isDoc = (content.querySelector('input[name=\"sprint-report-format\"]:checked') as HTMLInputElement)?.value === 'document';\r\n      if (docOptions) docOptions.classList.toggle('hidden', !isDoc);\r\n      if (pptOptions) pptOptions.classList.toggle('hidden', isDoc);\r\n      if (docBtn) docBtn.classList.toggle('hidden', !isDoc);\r\n      if (pptBtn) pptBtn.classList.toggle('hidden', isDoc);\r\n    });\r\n  });\r\n\r\n  /** Open generated HTML in new tab; if forPdf, inject script to open print dialog (user can Save as PDF). */\r\n  function openHtmlInNewTab(html: string, forPdf = false): void {\r\n    let out = html;\r\n    if (forPdf) {\r\n      const printScript = '<script>window.onload=function(){window.print();}<\\/script>';\r\n      if (out.includes('</body>')) {\r\n        out = out.replace('</body>', printScript + '</body>');\r\n      } else if (out.includes('</html>')) {\r\n        out = out.replace('</html>', printScript + '</html>');\r\n      } else {\r\n        out = out + printScript;\r\n      }\r\n    }\r\n    const blob = new Blob([out], { type: 'text/html;charset=utf-8' });\r\n    const url = URL.createObjectURL(blob);\r\n    window.open(url, '_blank', 'noopener');\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  const statusEl = content.querySelector('#sprint-report-generate-status') as HTMLElement;\r\n  if (docBtn) {\r\n    on(docBtn, 'click', async () => {\r\n      if (!statusEl) return;\r\n      docBtn.disabled = true;\r\n      statusEl.classList.remove('hidden');\r\n      statusEl.textContent = 'Generating document';\r\n      try {\r\n        const style = (content.querySelector('#sprint-report-document-style') as HTMLSelectElement)?.value as ReportDocumentStyle | '' || '';\r\n        const includeAnalysis = (content.querySelector('#sprint-report-include-analysis') as HTMLInputElement)?.checked ?? false;\r\n        const includeBusiness = (content.querySelector('#sprint-report-include-business') as HTMLInputElement)?.checked ?? false;\r\n        const result = await generateSprintReportDocument(sprintId, { include_analysis: includeAnalysis, include_business: includeBusiness, style: style || undefined });\r\n        const forPdf = (content.querySelector('#sprint-report-open-for-pdf') as HTMLInputElement)?.checked ?? false;\r\n        statusEl.textContent = forPdf ? 'Done. Opening for PDF' : 'Done. Opening in new tab';\r\n        openHtmlInNewTab(result.html, forPdf);\r\n      } catch (e) {\r\n        toast.error(e instanceof Error ? e.message : 'Failed to generate document');\r\n        statusEl.textContent = '';\r\n      } finally {\r\n        docBtn.disabled = false;\r\n      }\r\n    });\r\n  }\r\n  if (pptBtn) {\r\n    on(pptBtn, 'click', async () => {\r\n      if (!statusEl) return;\r\n      pptBtn.disabled = true;\r\n      statusEl.classList.remove('hidden');\r\n      statusEl.textContent = 'Generating presentation';\r\n      try {\r\n        const includeAnalysis = (content.querySelector('#sprint-report-ppt-include-analysis') as HTMLInputElement)?.checked ?? false;\r\n        const includeBusiness = (content.querySelector('#sprint-report-ppt-include-business') as HTMLInputElement)?.checked ?? false;\r\n        const result = await generateSprintReportPresentation(sprintId, { include_analysis: includeAnalysis, include_business: includeBusiness });\r\n        const forPdf = (content.querySelector('#sprint-report-open-for-pdf') as HTMLInputElement)?.checked ?? false;\r\n        statusEl.textContent = forPdf ? 'Done. Opening for PDF' : 'Done. Opening in new tab';\r\n        openHtmlInNewTab(result.html, forPdf);\r\n      } catch (e) {\r\n        toast.error(e instanceof Error ? e.message : 'Failed to generate presentation');\r\n        statusEl.textContent = '';\r\n      } finally {\r\n        pptBtn.disabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  on(footer.querySelector('#sprint-report-analyze-btn') as HTMLElement, 'click', async () => {\r\n    const btn = footer.querySelector('#sprint-report-analyze-btn') as HTMLButtonElement;\r\n    const placeholder = content.querySelector('#sprint-report-ai-placeholder') as HTMLElement;\r\n    const aiContent = content.querySelector('#sprint-report-ai-content') as HTMLElement;\r\n    if (!btn || !placeholder || !aiContent) return;\r\n    btn.disabled = true;\r\n    placeholder.textContent = 'Analyzing...';\r\n    try {\r\n      const result = await analyzeSprintReport(sprintId);\r\n      placeholder.classList.add('hidden');\r\n      aiContent.classList.remove('hidden');\r\n      aiContent.innerHTML = result.ai_analysis\r\n        ? `<div class=\"sprint-report-ai-text\">${escapeHtml(result.ai_analysis).replace(/\\n/g, '<br>')}</div>`\r\n        : `<div class=\"sprint-report-ai-text\">${escapeHtml(result.error || 'No analysis available.')}</div>`;\r\n    } catch (e) {\r\n      toast.error(e instanceof Error ? e.message : 'Analysis failed');\r\n      placeholder.textContent = 'Click \"Analyze with AI\" to generate.';\r\n    } finally {\r\n      btn.disabled = false;\r\n    }\r\n  });\r\n  on(footer.querySelector('#sprint-report-business-btn') as HTMLElement, 'click', async () => {\r\n    const btn = footer.querySelector('#sprint-report-business-btn') as HTMLButtonElement;\r\n    const placeholder = content.querySelector('#sprint-report-business-placeholder') as HTMLElement;\r\n    const bizContent = content.querySelector('#sprint-report-business-content') as HTMLElement;\r\n    if (!btn || !placeholder || !bizContent) return;\r\n    btn.disabled = true;\r\n    placeholder.textContent = 'Generating...';\r\n    try {\r\n      const result = await getSprintBusinessReport(sprintId);\r\n      placeholder.classList.add('hidden');\r\n      bizContent.classList.remove('hidden');\r\n      bizContent.innerHTML = result.business_report\r\n        ? `<div class=\"sprint-report-business-text\">${escapeHtml(result.business_report).replace(/\\n/g, '<br>')}</div>`\r\n        : `<div class=\"sprint-report-business-text\">${escapeHtml(result.error || 'No business report available.')}</div>`;\r\n    } catch (e) {\r\n      toast.error(e instanceof Error ? e.message : 'Business report failed');\r\n      placeholder.textContent = 'Click \"Business report\" to generate.';\r\n    } finally {\r\n      btn.disabled = false;\r\n    }\r\n  });\r\n\r\n  loadReport();\r\n}\r\n","/**\r\n * Comments Thread Component\r\n * Inline comments for entities\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { commentsService, Comment } from '../services/notifications';\r\nimport { appStore } from '../stores/app';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface CommentsThreadProps {\r\n  targetType: 'question' | 'risk' | 'action' | 'decision' | 'contact' | 'document' | 'email';\r\n  targetId: string;\r\n  projectId?: string;\r\n  onCommentAdded?: (comment: Comment) => void;\r\n}\r\n\r\n/**\r\n * Create comments thread\r\n */\r\nexport function createCommentsThread(props: CommentsThreadProps): HTMLElement {\r\n  const container = createElement('div', { className: 'comments-thread' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"comments-header\">\r\n      <h4>Comments</h4>\r\n      <span class=\"comments-count\" id=\"comments-count\">0</span>\r\n    </div>\r\n    <div class=\"comments-list\" id=\"comments-list\">\r\n      <div class=\"loading\">Loading comments...</div>\r\n    </div>\r\n    <div class=\"comment-form\">\r\n      <textarea id=\"comment-input\" placeholder=\"Add a comment...\" rows=\"2\"></textarea>\r\n      <div class=\"comment-form-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"submit-comment-btn\" disabled>Comment</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind input\r\n  const input = container.querySelector('#comment-input') as HTMLTextAreaElement;\r\n  const submitBtn = container.querySelector('#submit-comment-btn') as HTMLButtonElement;\r\n\r\n  on(input, 'input', () => {\r\n    submitBtn.disabled = !input.value.trim();\r\n  });\r\n\r\n  on(submitBtn, 'click', () => submitComment(container, props, input));\r\n\r\n  // Submit on Ctrl+Enter\r\n  on(input, 'keydown', (e) => {\r\n    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\r\n      e.preventDefault();\r\n      if (input.value.trim()) {\r\n        submitComment(container, props, input);\r\n      }\r\n    }\r\n  });\r\n\r\n  // Initial load\r\n  loadComments(container, props);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load comments\r\n */\r\nasync function loadComments(container: HTMLElement, props: CommentsThreadProps): Promise<void> {\r\n  const list = container.querySelector('#comments-list') as HTMLElement;\r\n  list.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const comments = await commentsService.getAll(props.targetType, props.targetId);\r\n\r\n    renderComments(list, comments, container, props);\r\n    updateCount(container, comments.length);\r\n  } catch {\r\n    list.innerHTML = '<div class=\"error\">Failed to load comments</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render comments\r\n */\r\nfunction renderComments(\r\n  container: HTMLElement, \r\n  comments: Comment[],\r\n  thread: HTMLElement,\r\n  props: CommentsThreadProps\r\n): void {\r\n  if (comments.length === 0) {\r\n    container.innerHTML = '<div class=\"empty\">No comments yet</div>';\r\n    return;\r\n  }\r\n\r\n  // Group by parent\r\n  const topLevel = comments.filter(c => !c.parent_id);\r\n  const replies = comments.filter(c => c.parent_id);\r\n  const repliesByParent: Record<string, Comment[]> = {};\r\n  \r\n  replies.forEach(r => {\r\n    if (!repliesByParent[r.parent_id!]) repliesByParent[r.parent_id!] = [];\r\n    repliesByParent[r.parent_id!].push(r);\r\n  });\r\n\r\n  container.innerHTML = topLevel.map(comment => \r\n    renderComment(comment, repliesByParent[comment.id] || [], thread, props)\r\n  ).join('');\r\n\r\n  bindCommentEvents(container, comments, thread, props);\r\n}\r\n\r\n/**\r\n * Render single comment\r\n */\r\nfunction renderComment(\r\n  comment: Comment, \r\n  replies: Comment[],\r\n  thread: HTMLElement,\r\n  props: CommentsThreadProps\r\n): string {\r\n  const currentUser = appStore.getState().currentUser;\r\n  const isOwn = currentUser?.id === comment.user_id;\r\n\r\n  return `\r\n    <div class=\"comment ${comment.resolved ? 'resolved' : ''}\" data-id=\"${comment.id}\">\r\n      <div class=\"comment-avatar\">${getInitials(comment.user_name || 'U')}</div>\r\n      <div class=\"comment-body\">\r\n        <div class=\"comment-header\">\r\n          <span class=\"comment-author\">${escapeHtml(comment.user_name || 'Unknown')}</span>\r\n          <span class=\"comment-time\">${formatRelativeTime(comment.created_at)}</span>\r\n          ${comment.resolved ? '<span class=\"resolved-badge\">Resolved</span>' : ''}\r\n        </div>\r\n        <div class=\"comment-content\">${escapeHtml(comment.content)}</div>\r\n        <div class=\"comment-actions\">\r\n          <button class=\"btn-link reply-btn\">Reply</button>\r\n          ${!comment.resolved ? '<button class=\"btn-link resolve-btn\">Resolve</button>' : ''}\r\n          ${isOwn ? '<button class=\"btn-link delete-btn\">Delete</button>' : ''}\r\n        </div>\r\n        <div class=\"reply-form hidden\">\r\n          <textarea class=\"reply-input\" placeholder=\"Reply...\" rows=\"2\"></textarea>\r\n          <div class=\"reply-actions\">\r\n            <button class=\"btn btn-sm cancel-reply-btn\">Cancel</button>\r\n            <button class=\"btn btn-primary btn-sm submit-reply-btn\">Reply</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    ${replies.length > 0 ? `\r\n      <div class=\"comment-replies\">\r\n        ${replies.map(r => `\r\n          <div class=\"comment reply\" data-id=\"${r.id}\">\r\n            <div class=\"comment-avatar small\">${getInitials(r.user_name || 'U')}</div>\r\n            <div class=\"comment-body\">\r\n              <div class=\"comment-header\">\r\n                <span class=\"comment-author\">${escapeHtml(r.user_name || 'Unknown')}</span>\r\n                <span class=\"comment-time\">${formatRelativeTime(r.created_at)}</span>\r\n              </div>\r\n              <div class=\"comment-content\">${escapeHtml(r.content)}</div>\r\n              ${currentUser?.id === r.user_id ? `\r\n                <div class=\"comment-actions\">\r\n                  <button class=\"btn-link delete-btn\">Delete</button>\r\n                </div>\r\n              ` : ''}\r\n            </div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind comment events\r\n */\r\nfunction bindCommentEvents(\r\n  container: HTMLElement,\r\n  comments: Comment[],\r\n  thread: HTMLElement,\r\n  props: CommentsThreadProps\r\n): void {\r\n  // Reply buttons\r\n  container.querySelectorAll('.reply-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const comment = btn.closest('.comment');\r\n      const replyForm = comment?.querySelector('.reply-form');\r\n      if (replyForm) {\r\n        replyForm.classList.toggle('hidden');\r\n        const input = replyForm.querySelector('.reply-input') as HTMLTextAreaElement;\r\n        input?.focus();\r\n      }\r\n    });\r\n  });\r\n\r\n  // Cancel reply\r\n  container.querySelectorAll('.cancel-reply-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const replyForm = btn.closest('.reply-form');\r\n      if (replyForm) {\r\n        replyForm.classList.add('hidden');\r\n        (replyForm.querySelector('.reply-input') as HTMLTextAreaElement).value = '';\r\n      }\r\n    });\r\n  });\r\n\r\n  // Submit reply\r\n  container.querySelectorAll('.submit-reply-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = btn.closest('.comment');\r\n      const id = comment?.getAttribute('data-id');\r\n      const input = comment?.querySelector('.reply-input') as HTMLTextAreaElement;\r\n      if (!id || !input?.value.trim()) return;\r\n\r\n      try {\r\n        await commentsService.create(props.targetType, props.targetId, input.value.trim(), id);\r\n        toast.success('Reply added');\r\n        loadComments(thread, props);\r\n      } catch {\r\n        toast.error('Failed to add reply');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Resolve\r\n  container.querySelectorAll('.resolve-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = btn.closest('.comment');\r\n      const id = comment?.getAttribute('data-id');\r\n      if (!id) return;\r\n\r\n      try {\r\n        await commentsService.resolve(id);\r\n        toast.success('Comment resolved');\r\n        loadComments(thread, props);\r\n      } catch {\r\n        toast.error('Failed to resolve comment');\r\n      }\r\n    });\r\n  });\r\n\r\n  // Delete\r\n  container.querySelectorAll('.delete-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = btn.closest('.comment');\r\n      const id = comment?.getAttribute('data-id');\r\n      if (!id || !confirm('Delete this comment?')) return;\r\n\r\n      try {\r\n        await commentsService.delete(id);\r\n        toast.success('Comment deleted');\r\n        loadComments(thread, props);\r\n      } catch {\r\n        toast.error('Failed to delete comment');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Submit new comment\r\n */\r\nasync function submitComment(\r\n  container: HTMLElement,\r\n  props: CommentsThreadProps,\r\n  input: HTMLTextAreaElement\r\n): Promise<void> {\r\n  const content = input.value.trim();\r\n  if (!content) return;\r\n\r\n  const btn = container.querySelector('#submit-comment-btn') as HTMLButtonElement;\r\n  btn.disabled = true;\r\n\r\n  try {\r\n    const comment = await commentsService.create(props.targetType, props.targetId, content);\r\n\r\n    input.value = '';\r\n    toast.success('Comment added');\r\n    loadComments(container, props);\r\n    props.onCommentAdded?.(comment);\r\n  } catch {\r\n    toast.error('Failed to add comment');\r\n    btn.disabled = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(container: HTMLElement, count: number): void {\r\n  const countEl = container.querySelector('#comments-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createCommentsThread;\r\n","/**\r\n * Action Detail View\r\n * Full-page view for action details: task, status, priority, assignee, due date, source, timeline\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Action, ActionEvent, ActionAssigneeSuggestion, actionsService } from '../../services/actions';\r\nimport { decisionsService, Decision } from '../../services/decisions';\r\nimport { contactsService, Contact } from '../../services/contacts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\r\nimport { createCommentsThread } from '../CommentsThread';\r\nimport { appStore } from '../../stores/app';\r\n\r\nfunction getInitials(name: string): string {\r\n  return name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\r\n}\r\n\r\nexport interface ActionDetailViewProps {\r\n  action: Action;\r\n  onClose: () => void;\r\n  onUpdate?: (action: Action) => void;\r\n  /** When user clicks the linked decision (optional, e.g. open decision detail) */\r\n  onDecisionClick?: (decisionId: string | number) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\nfunction taskText(a: Action): string {\r\n  return (a.content ?? a.task ?? '') as string;\r\n}\r\n\r\nfunction getActionEventIcon(eventType: string): string {\r\n  const icons: Record<string, string> = {\r\n    created: '',\r\n    updated: '',\r\n    deleted: '',\r\n    restored: '',\r\n    refined_with_ai: '',\r\n    rollback: '',\r\n  };\r\n  return icons[eventType] || '';\r\n}\r\n\r\nfunction getActionEventDescription(ev: ActionEvent): string {\r\n  const data = ev.event_data || {};\r\n  const actor = ev.actor_name ? ` by ${ev.actor_name}` : '';\r\n\r\n  switch (ev.event_type) {\r\n    case 'created':\r\n      return `Created${actor}`;\r\n    case 'refined_with_ai':\r\n      return `Refined with AI${actor}`;\r\n    case 'rollback':\r\n      return `Restored previous version${actor}`;\r\n    case 'updated': {\r\n      const changes = (data.changes as Array<{ field: string; from: string; to: string }>) || [];\r\n      if (changes.length === 0) return `Updated${actor}`;\r\n      const textFields = ['Description', 'Task', 'DoD', 'Acceptance criteria'];\r\n      const hasLongText = changes.some((c) => textFields.includes(c.field));\r\n      if (hasLongText && changes.length >= 2) {\r\n        return `Fields updated${actor}`;\r\n      }\r\n      if (changes.length === 1) {\r\n        const c = changes[0];\r\n        const toStr = String(c.to).trim() ? c.to : '';\r\n        const fromStr = String(c.from).trim() ? c.from : '';\r\n        return `${c.field} changed: ${fromStr}  ${toStr}${actor}`;\r\n      }\r\n      return `${changes.map((c) => `${c.field}: ${c.from || ''}  ${c.to || ''}`).join('; ')}${actor}`;\r\n    }\r\n    case 'deleted':\r\n      return `Deleted${data.reason ? ` (${data.reason})` : ''}${actor}`;\r\n    case 'restored':\r\n      return `Restored${actor}`;\r\n    default:\r\n      return ev.event_type;\r\n  }\r\n}\r\n\r\ntype DodItem = { text: string; done: boolean };\r\n\r\nfunction normalizeDefinitionOfDone(raw: (string | { text?: string; done?: boolean })[] | undefined): DodItem[] {\r\n  if (!Array.isArray(raw) || raw.length === 0) return [];\r\n  return raw.map((item) => {\r\n    if (typeof item === 'string') return { text: item, done: false };\r\n    return { text: (item.text ?? '').toString(), done: Boolean(item.done) };\r\n  });\r\n}\r\n\r\nfunction getDescriptionBodyHtml(a: Action, _assigneeStr: string): string {\r\n  const dod = normalizeDefinitionOfDone((a.definition_of_done as (string | { text?: string; done?: boolean })[]) || []);\r\n  const ac = (a.acceptance_criteria || []).map((item) => (typeof item === 'string' ? item : String(item)));\r\n  // Task title is shown in the header; Assignee in Assignment section; Status in header badge  avoid duplicating here\r\n  const dlParts: string[] = [];\r\n  if (a.parent_story_ref || a.parent_story_id) {\r\n    dlParts.push(`<dt>Parent</dt><dd>${escapeHtml(String(a.parent_story_ref || a.parent_story_id))}</dd>`);\r\n  }\r\n  if (a.size_estimate) {\r\n    dlParts.push(`<dt>Size</dt><dd>${escapeHtml(a.size_estimate)}</dd>`);\r\n  }\r\n  const dlHtml = dlParts.length\r\n    ? `<dl class=\"action-description-dl\">${dlParts.join('')}</dl>`\r\n    : '';\r\n  const descHtml = a.description ? `<div class=\"action-description-text\"><strong>Description</strong><p>${escapeHtml(a.description).replace(/\\n/g, '<br>')}</p></div>` : '';\r\n  const dodHtml = dod.length\r\n    ? `<div class=\"action-dod\"><strong>Definition of Done</strong><ul class=\"action-checklist action-dod-list\">${dod.map((item, i) => `<li class=\"dod-item ${item.done ? 'dod-done' : ''}\" data-dod-index=\"${i}\"><button type=\"button\" class=\"dod-item-toggle\" data-dod-index=\"${i}\" aria-label=\"${item.done ? 'Mark undone' : 'Mark done'}\">${item.done ? '' : ''}</button><span class=\"dod-item-text\">${escapeHtml(item.text)}</span></li>`).join('')}</ul></div>`\r\n    : '';\r\n  const acHtml = ac.length ? `<div class=\"action-ac\"><strong>Acceptance criteria</strong><ul class=\"action-checklist\">${ac.map((item) => `<li>${escapeHtml(item)}</li>`).join('')}</ul></div>` : '';\r\n  return `${dlHtml}${descHtml}${dodHtml}${acHtml}`;\r\n}\r\n\r\nexport function createActionDetailView(props: ActionDetailViewProps): HTMLElement {\r\n  const { action, onClose, onUpdate, onDecisionClick } = props;\r\n  let currentAction: Action = action;\r\n\r\n  const container = createElement('div', { className: 'action-detail-view question-detail-view' });\r\n\r\n  const task = taskText(action);\r\n  const due = action.due_date ?? (action as { deadline?: string }).deadline ?? '';\r\n  const assignee = action.assignee ?? action.owner ?? '';\r\n  const projectName = appStore.getState().currentProject?.name ?? null;\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header action-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Actions</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        ${projectName ? `<span class=\"breadcrumb-project\" title=\"Project\">${escapeHtml(projectName)}</span><span class=\"breadcrumb-separator\"></span>` : ''}\r\n        <span class=\"breadcrumb-current\">Action #${String(action.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"action-refine-ai-btn\" title=\"Refine task description, DoD and acceptance criteria with AI\">\r\n          <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n          Refine with AI\r\n        </button>\r\n        <span class=\"status-badge status-${(action.status || 'pending').toLowerCase()}\">${escapeHtml(String(action.status).replace('_', ' '))}</span>\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content action-detail-content\">\r\n      <div id=\"action-view-content\">\r\n        <section class=\"detail-section action-main\">\r\n          <div class=\"question-badges action-badges\">\r\n            ${projectName ? `<span class=\"project-badge\" title=\"Project\">${escapeHtml(projectName)}</span>` : ''}\r\n            ${action.priority ? `<span class=\"priority-pill priority-${action.priority}\">${escapeHtml(action.priority)}</span>` : ''}\r\n            <span class=\"question-date action-date\">Created ${formatRelativeTime(action.created_at)}</span>\r\n          </div>\r\n          <h2 class=\"question-text action-task-text\">${escapeHtml(task)}</h2>\r\n        </section>\r\n\r\n        <section class=\"detail-section action-description-structured\" id=\"action-description-section\">\r\n          <h3 class=\"section-header-sota\">Description</h3>\r\n          <div class=\"action-description-body\">${getDescriptionBodyHtml(action, assignee)}</div>\r\n        </section>\r\n\r\n        <div class=\"detail-columns\">\r\n          <div class=\"detail-column-left\">\r\n            <!-- Assignment Section - SOTA (aligned with Questions) -->\r\n            <section class=\"detail-section\" id=\"action-assignment-section\">\r\n              <div class=\"section-header-sota\">\r\n                <h3>\r\n                  <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                  </svg>\r\n                  Assignment\r\n                  <span class=\"section-subtitle\">Who should do this?</span>\r\n                </h3>\r\n                <button type=\"button\" class=\"btn-ai-suggest\" id=\"action-ai-suggest-btn\" title=\"Suggest who should do this task (assignee) from task content\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                  AI Suggest\r\n                </button>\r\n              </div>\r\n\r\n              <!-- Current Assignment Display -->\r\n              <div id=\"action-current-assignment\" class=\"current-assignment-card\">\r\n                ${assignee ? `\r\n                  <div class=\"assigned-contact-display\">\r\n                    <div class=\"contact-avatar-lg\" id=\"action-assigned-avatar\">${getInitials(assignee)}</div>\r\n                    <div class=\"contact-details\">\r\n                      <div class=\"contact-name-lg\">${escapeHtml(assignee)}</div>\r\n                      <div class=\"contact-role-sm\" id=\"action-assigned-role\"></div>\r\n                    </div>\r\n                    <button class=\"btn-change-assignment\" id=\"action-change-assignee-btn\" type=\"button\">\r\n                      <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\r\n                      Change\r\n                    </button>\r\n                  </div>\r\n                ` : `\r\n                  <div class=\"no-assignment\">\r\n                    <div class=\"no-assignment-icon\">\r\n                      <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\r\n                    </div>\r\n                    <span>No one assigned</span>\r\n                    <p class=\"no-assignment-hint\">Use AI Suggest or choose manually</p>\r\n                    <button class=\"btn-assign-now\" id=\"action-show-picker-btn\" type=\"button\">Choose Manually</button>\r\n                  </div>\r\n                `}\r\n              </div>\r\n\r\n              <!-- Contact Picker (hidden by default) -->\r\n              <div id=\"action-contact-picker\" class=\"contact-picker-sota hidden\">\r\n                <div class=\"picker-search\">\r\n                  <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\r\n                  <input type=\"text\" id=\"action-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n                </div>\r\n                <div id=\"action-contact-list\" class=\"contact-list-grid\">Loading...</div>\r\n              </div>\r\n\r\n              <!-- AI Suggestions Panel -->\r\n              <div id=\"action-suggestions-panel\" class=\"suggestions-panel-sota action-suggestions-panel hidden gm-mb-3\"></div>\r\n\r\n              <!-- Due date, Sprint (Status is only in header badge) -->\r\n              <dl class=\"metadata-list action-meta-inline\">\r\n                <dt>Due date</dt>\r\n                <dd>${due ? formatDate(due) : ''}</dd>\r\n                ${(action.sprint_id || action.sprint_name) ? `\r\n                <dt>Sprint</dt>\r\n                <dd>${escapeHtml((action.sprint_name as string) || String(action.sprint_id))}</dd>\r\n                ` : ''}\r\n              </dl>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-decision-section\">\r\n              <div class=\"section-header\"><h3>Implementing decision</h3></div>\r\n              <div id=\"action-decision-display\" class=\"action-decision-display\">\r\n                ${(action as Action).decision_id ? `<p class=\"text-muted\">Loading</p>` : '<p class=\"text-muted\">No decision linked</p>'}\r\n              </div>\r\n              <div class=\"action-decision-actions\">\r\n                <button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" id=\"action-link-decision-btn\">${(action as Action).decision_id ? 'Change' : 'Link decision'}</button>\r\n                <button type=\"button\" class=\"btn btn-sm btn-link ${!(action as Action).decision_id ? 'hidden' : ''}\" id=\"action-unlink-decision-btn\">Unlink</button>\r\n              </div>\r\n              <div id=\"action-decision-picker\" class=\"action-decision-picker hidden\">\r\n                <div class=\"picker-search\"><input type=\"text\" id=\"action-decision-search\" placeholder=\"Search decisions...\" autocomplete=\"off\"></div>\r\n                <div id=\"action-decision-list\" class=\"action-decision-list\">Loading</div>\r\n              </div>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-source-section\">\r\n              <div class=\"section-header\"><h3>Source</h3></div>\r\n              <div class=\"source-content\">\r\n              ${[\r\n                action.source_file ? `<p class=\"source-file\"><strong>File:</strong> ${escapeHtml(action.source_file)}</p>` : '',\r\n                action.source_document_id ? `<p class=\"source-doc\"><a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(action.source_document_id))}\">View source document</a></p>` : '',\r\n                action.source_type ? `<p class=\"source-type\"><strong>Origin:</strong> ${escapeHtml(action.source_type)}</p>` : '',\r\n                action.generation_source ? `<p class=\"source-meta\"><strong>Generation:</strong> <span class=\"status-pill\">${escapeHtml(action.generation_source)}</span></p>` : '',\r\n                action.requested_by ? `<div id=\"action-requester-display\" class=\"requester-display\"><p><strong>Requested by:</strong> ${escapeHtml(action.requested_by)}</p></div>` : '',\r\n              ].filter(Boolean).join('') || '<p class=\"text-muted\">No source recorded</p>'}\r\n              </div>\r\n            </section>\r\n          </div>\r\n\r\n          <div class=\"detail-column-right\">\r\n            <section class=\"detail-section metadata-section\">\r\n              <h3>Metadata</h3>\r\n              <dl class=\"metadata-list\">\r\n                <dt>Created</dt>\r\n                <dd>${formatDate(action.created_at)}</dd>\r\n                ${action.updated_at ? `<dt>Updated</dt><dd>${formatDate(action.updated_at)}</dd>` : ''}\r\n              </dl>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-timeline-section\">\r\n              <h3>Timeline</h3>\r\n              <div id=\"timeline-content\" class=\"timeline-content\">\r\n                <span class=\"text-muted\">Loading</span>\r\n              </div>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-comments-section\">\r\n              <div id=\"action-comments-mount\"></div>\r\n            </section>\r\n\r\n            <section class=\"detail-section\" id=\"action-similar-section\">\r\n              <h3 class=\"section-header-sota\">Similar actions</h3>\r\n              <div id=\"action-similar-mount\" class=\"action-similar-list\"><span class=\"text-muted\">Loading</span></div>\r\n            </section>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-action-btn\">Edit</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"delete-action-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div id=\"action-edit-form\" class=\"action-detail-edit-form hidden\">\r\n        <form id=\"action-inline-form\" class=\"action-form\">\r\n          <div class=\"form-group\">\r\n            <div class=\"gm-flex gm-flex-center gm-justify-between gm-flex-wrap gm-gap-2 gm-mb-2\">\r\n              <label for=\"action-edit-task\" class=\"gm-mb-0\">Task *</label>\r\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"action-edit-ai-suggest-btn\" title=\"Suggest assignee from task content\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI suggest\r\n              </button>\r\n            </div>\r\n            <textarea id=\"action-edit-task\" rows=\"3\" required placeholder=\"What needs to be done?\">${escapeHtml(task)}</textarea>\r\n          </div>\r\n          <div id=\"action-edit-suggestions-panel\" class=\"suggestions-panel-sota action-suggestions-panel hidden gm-mb-4\"></div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group\">\r\n              <label for=\"action-edit-status\">Status</label>\r\n              <select id=\"action-edit-status\">\r\n                <option value=\"pending\" ${action.status === 'pending' ? 'selected' : ''}>Pending</option>\r\n                <option value=\"in_progress\" ${action.status === 'in_progress' ? 'selected' : ''}>In Progress</option>\r\n                <option value=\"completed\" ${action.status === 'completed' ? 'selected' : ''}>Completed</option>\r\n                <option value=\"cancelled\" ${action.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>\r\n              </select>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"action-edit-priority\">Priority</label>\r\n              <select id=\"action-edit-priority\">\r\n                <option value=\"low\" ${action.priority === 'low' ? 'selected' : ''}>Low</option>\r\n                <option value=\"medium\" ${action.priority === 'medium' || !action.priority ? 'selected' : ''}>Medium</option>\r\n                <option value=\"high\" ${action.priority === 'high' ? 'selected' : ''}>High</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <div class=\"form-row\">\r\n            <div class=\"form-group action-assignee-picker-wrap\">\r\n              <label>Assignee</label>\r\n              <input type=\"hidden\" id=\"action-edit-assignee\" value=\"${escapeHtml(assignee)}\">\r\n              <div class=\"action-assignee-picker-trigger\" id=\"action-assignee-picker-trigger\" title=\"Click to select from project contacts\">\r\n                <span class=\"action-assignee-picker-value\" id=\"action-assignee-picker-value\">${assignee ? escapeHtml(assignee) : '<span class=\"text-muted\">Select assignee...</span>'}</span>\r\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n              </div>\r\n              <div id=\"action-assignee-picker-dropdown\" class=\"action-assignee-picker-dropdown hidden\">\r\n                <div class=\"action-assignee-picker-search\">\r\n                  <input type=\"text\" id=\"action-assignee-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n                </div>\r\n                <div id=\"action-assignee-picker-list\" class=\"action-assignee-picker-list\">Loading...</div>\r\n              </div>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"action-edit-due\">Due date</label>\r\n              <input type=\"date\" id=\"action-edit-due\" value=\"${due ? due.split('T')[0] : ''}\">\r\n            </div>\r\n          </div>\r\n          <div class=\"form-group action-requester-picker-wrap\">\r\n            <label>Requested by</label>\r\n            <input type=\"hidden\" id=\"action-edit-requester-contact-id\" value=\"${escapeHtml((action.requested_by_contact_id as string) || '')}\">\r\n            <input type=\"hidden\" id=\"action-edit-requester-name\" value=\"${escapeHtml((action.requested_by as string) || '')}\">\r\n            <div class=\"action-assignee-picker-trigger\" id=\"action-requester-picker-trigger\" title=\"Click to select who requested this task\">\r\n              <span class=\"action-assignee-picker-value\" id=\"action-requester-picker-value\">${(action.requested_by as string) ? escapeHtml(action.requested_by as string) : '<span class=\"text-muted\">Select requester...</span>'}</span>\r\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\"/></svg>\r\n            </div>\r\n            <div id=\"action-requester-picker-dropdown\" class=\"action-assignee-picker-dropdown hidden\">\r\n              <div class=\"action-assignee-picker-search\">\r\n                <input type=\"text\" id=\"action-requester-picker-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\r\n              </div>\r\n              <div id=\"action-requester-picker-list\" class=\"action-assignee-picker-list\">Loading...</div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n        <div class=\"detail-actions\">\r\n          <button type=\"button\" class=\"btn btn-primary\" id=\"action-save-btn\">Save</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"action-cancel-edit-btn\">Cancel</button>\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"action-delete-in-edit-btn\">Delete</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  const refineAiBtn = container.querySelector('#action-refine-ai-btn');\r\n  if (refineAiBtn) {\r\n    on(refineAiBtn as HTMLElement, 'click', async () => {\r\n      const task = taskText(action);\r\n      const desc = (action.description ?? '') as string;\r\n      const userInput = [task, desc].filter(Boolean).join('\\n\\n');\r\n      if (!userInput.trim()) {\r\n        toast.error('Task has no content to refine');\r\n        return;\r\n      }\r\n      (refineAiBtn as HTMLButtonElement).disabled = true;\r\n      (refineAiBtn as HTMLButtonElement).textContent = 'Refining...';\r\n      try {\r\n        const result = await actionsService.suggestTaskFromDescription({\r\n          user_input: userInput,\r\n          parent_story_ref: (action.parent_story_ref as string) || undefined,\r\n        });\r\n        const updated = await actionsService.update(action.id, {\r\n          content: result.task,\r\n          description: result.description,\r\n          definition_of_done: result.definition_of_done,\r\n          acceptance_criteria: result.acceptance_criteria,\r\n          size_estimate: result.size_estimate,\r\n          refined_with_ai: true,\r\n        });\r\n        toast.success('Task refined with AI');\r\n        currentAction = updated;\r\n        refreshDescriptionAndTimeline();\r\n        onUpdate?.(updated);\r\n      } catch (e) {\r\n        toast.error((e as Error).message || 'Failed to refine');\r\n      } finally {\r\n        (refineAiBtn as HTMLButtonElement).disabled = false;\r\n        (refineAiBtn as HTMLButtonElement).innerHTML = `\r\n          <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n          Refine with AI\r\n        `;\r\n      }\r\n    });\r\n  }\r\n\r\n  function bindDodToggles(): void {\r\n    const bodyEl = container.querySelector('#action-description-section .action-description-body');\r\n    if (!bodyEl) return;\r\n    bodyEl.querySelectorAll('.dod-item-toggle').forEach((btn) => {\r\n      on(btn as HTMLElement, 'click', async () => {\r\n        const idx = parseInt((btn as HTMLElement).getAttribute('data-dod-index') ?? '-1', 10);\r\n        if (idx < 0) return;\r\n        const dod = normalizeDefinitionOfDone((currentAction.definition_of_done as (string | { text?: string; done?: boolean })[]) || []);\r\n        if (idx >= dod.length) return;\r\n        const li = (btn as HTMLElement).closest('.dod-item');\r\n        const previousDone = dod[idx].done;\r\n        dod[idx].done = !dod[idx].done;\r\n        const payload = dod.map((item) => ({ text: item.text, done: item.done }));\r\n        // Optimistic UI: update DOM immediately\r\n        if (li) li.classList.toggle('dod-done', dod[idx].done);\r\n        (btn as HTMLButtonElement).textContent = dod[idx].done ? '' : '';\r\n        (btn as HTMLButtonElement).setAttribute('aria-label', dod[idx].done ? 'Mark undone' : 'Mark done');\r\n        try {\r\n          const updated = await actionsService.update(currentAction.id, { definition_of_done: payload });\r\n          currentAction = updated;\r\n          toast.success(dod[idx].done ? 'Marked done' : 'Marked undone');\r\n        } catch (e) {\r\n          // Revert optimistic update\r\n          dod[idx].done = previousDone;\r\n          if (li) li.classList.toggle('dod-done', previousDone);\r\n          (btn as HTMLButtonElement).textContent = previousDone ? '' : '';\r\n          (btn as HTMLButtonElement).setAttribute('aria-label', previousDone ? 'Mark undone' : 'Mark done');\r\n          toast.error((e as Error).message || 'Failed to update');\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  function renderTimeline(el: HTMLElement | null): void {\r\n    if (!el) return;\r\n    actionsService.getEvents(currentAction.id).then((events: ActionEvent[]) => {\r\n      if (events.length === 0) {\r\n        el.innerHTML = '<p class=\"empty-state\">No events recorded</p>';\r\n        bindDodToggles();\r\n        return;\r\n      }\r\n      const html = events.map((ev) => {\r\n        const icon = getActionEventIcon(ev.event_type);\r\n        const description = getActionEventDescription(ev);\r\n        const data = ev.event_data || {};\r\n        const snapshot = data.snapshot as Record<string, unknown> | undefined;\r\n        const hasRestore = ev.event_type === 'refined_with_ai' && snapshot && typeof snapshot === 'object';\r\n        const snapshotAttr = hasRestore ? ` data-snapshot=\"${escapeHtml(JSON.stringify(snapshot))}\"` : '';\r\n        const restoreBtn = hasRestore\r\n          ? `<button type=\"button\" class=\"btn btn-sm btn-outline-secondary action-restore-btn\"${snapshotAttr} title=\"Restore this version\">Restore</button>`\r\n          : '';\r\n        return `\r\n          <div class=\"timeline-item action-event-${escapeHtml(ev.event_type)}\">\r\n            <div class=\"timeline-icon\">${icon}</div>\r\n            <div class=\"timeline-content\">\r\n              <div class=\"timeline-title-row\">\r\n                <span class=\"timeline-title\">${escapeHtml(description)}</span>\r\n                ${restoreBtn}\r\n              </div>\r\n              <div class=\"timeline-date\">${formatDateTime(ev.created_at)}</div>\r\n            </div>\r\n          </div>`;\r\n      }).join('');\r\n      el.innerHTML = `<div class=\"timeline-list\">${html}</div>`;\r\n      el.querySelectorAll('.action-restore-btn').forEach((btn) => {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          const raw = (btn as HTMLElement).getAttribute('data-snapshot');\r\n          if (!raw) return;\r\n          const restoreBtn = btn as HTMLButtonElement;\r\n          restoreBtn.disabled = true;\r\n          const originalText = restoreBtn.textContent || 'Restore';\r\n          restoreBtn.textContent = 'Restoring';\r\n          try {\r\n            const snapshot = JSON.parse(raw) as { content?: string; task?: string; description?: string; definition_of_done?: (string | { text: string; done?: boolean })[]; acceptance_criteria?: string[]; size_estimate?: string };\r\n            const updated = await actionsService.update(currentAction.id, { restore_snapshot: snapshot });\r\n            toast.success('Previous version restored');\r\n            currentAction = updated;\r\n            refreshDescriptionAndTimeline();\r\n            onUpdate?.(updated);\r\n          } catch (e) {\r\n            toast.error((e as Error).message || 'Failed to restore');\r\n            restoreBtn.disabled = false;\r\n            restoreBtn.textContent = originalText;\r\n          }\r\n        });\r\n      });\r\n      bindDodToggles();\r\n    }).catch(() => {\r\n      el.innerHTML = '<p class=\"error\">Failed to load timeline</p>';\r\n    });\r\n  }\r\n\r\n  function refreshDescriptionAndTimeline(): void {\r\n    const taskEl = container.querySelector('.action-task-text');\r\n    if (taskEl) taskEl.textContent = taskText(currentAction);\r\n    const bodyEl = container.querySelector('#action-description-section .action-description-body');\r\n    if (bodyEl) {\r\n      bodyEl.innerHTML = getDescriptionBodyHtml(currentAction, currentAction.assignee ?? (currentAction as Action).owner ?? '');\r\n      bindDodToggles();\r\n    }\r\n    const timelineEl = container.querySelector('#timeline-content') as HTMLElement | null;\r\n    if (timelineEl) timelineEl.innerHTML = '<span class=\"text-muted\">Loading</span>';\r\n    renderTimeline(timelineEl);\r\n  }\r\n\r\n  function refreshDecisionSection(): void {\r\n    const displayEl = container.querySelector('#action-decision-display') as HTMLElement;\r\n    const linkBtn = container.querySelector('#action-link-decision-btn') as HTMLButtonElement;\r\n    const unlinkBtn = container.querySelector('#action-unlink-decision-btn');\r\n    const decisionId = (currentAction as Action).decision_id;\r\n    if (!displayEl) return;\r\n    if (decisionId) {\r\n      displayEl.innerHTML = '<p class=\"text-muted\">Loading</p>';\r\n      decisionsService.getDecision(decisionId).then((d: Decision | null) => {\r\n        if (!displayEl) return;\r\n        const title = (d?.summary || d?.content || '').toString().trim().substring(0, 80) + ((d?.content || '').toString().length > 80 ? '' : '');\r\n        displayEl.innerHTML = `<p><a href=\"#\" class=\"decision-link\" data-decision-id=\"${escapeHtml(String(decisionId))}\">${escapeHtml(title || `Decision #${String(decisionId).substring(0, 8)}`)}</a></p>`;\r\n        displayEl.querySelector('.decision-link') && on(displayEl.querySelector('.decision-link') as HTMLElement, 'click', (e) => {\r\n          e.preventDefault();\r\n          onDecisionClick?.(decisionId);\r\n        });\r\n      }).catch(() => {\r\n        displayEl.innerHTML = `<p><a href=\"#\" class=\"decision-link\" data-decision-id=\"${escapeHtml(String(decisionId))}\">Decision #${String(decisionId).substring(0, 8)}</a></p>`;\r\n      });\r\n      if (linkBtn) linkBtn.textContent = 'Change';\r\n      if (unlinkBtn) (unlinkBtn as HTMLElement).classList.remove('hidden');\r\n    } else {\r\n      displayEl.innerHTML = '<p class=\"text-muted\">No decision linked</p>';\r\n      if (linkBtn) linkBtn.textContent = 'Link decision';\r\n      if (unlinkBtn) (unlinkBtn as HTMLElement).classList.add('hidden');\r\n    }\r\n  }\r\n\r\n  const viewContent = container.querySelector('#action-view-content') as HTMLElement;\r\n  const editForm = container.querySelector('#action-edit-form') as HTMLElement;\r\n\r\n  const commentsMount = container.querySelector('#action-comments-mount') as HTMLElement;\r\n  if (commentsMount) {\r\n    const projectId = appStore.getState().currentProject?.id;\r\n    const commentsThread = createCommentsThread({\r\n      targetType: 'action',\r\n      targetId: String(action.id),\r\n      projectId: projectId || undefined,\r\n    });\r\n    commentsMount.appendChild(commentsThread);\r\n  }\r\n\r\n  const similarMount = container.querySelector('#action-similar-mount') as HTMLElement;\r\n  if (similarMount) {\r\n    (async () => {\r\n      try {\r\n        const similar = await actionsService.getSimilar(action.id);\r\n        if (similar.length === 0) {\r\n          similarMount.innerHTML = '<span class=\"text-muted\">No similar actions found. Rebuild RAG embeddings to enable.</span>';\r\n          return;\r\n        }\r\n        similarMount.innerHTML = similar\r\n          .map(\r\n            (a) => `\r\n          <div class=\"action-similar-card\" data-action-id=\"${escapeHtml(String(a.id))}\" role=\"button\" tabindex=\"0\">\r\n            <span class=\"action-similar-status status-pill status-${(a.status || 'pending').toLowerCase()}\">${escapeHtml(String(a.status || 'pending').replace('_', ' '))}</span>\r\n            <span class=\"action-similar-task\">${escapeHtml(((a.content || a.task) || '').toString().trim().substring(0, 80))}${((a.content || a.task) || '').toString().length > 80 ? '' : ''}</span>\r\n          </div>\r\n        `\r\n          )\r\n          .join('');\r\n        similarMount.querySelectorAll('.action-similar-card').forEach((el) => {\r\n          on(el as HTMLElement, 'click', () => {\r\n            const id = (el as HTMLElement).getAttribute('data-action-id');\r\n            const chosen = similar.find((a) => String(a.id) === id);\r\n            if (chosen) onUpdate?.(chosen);\r\n          });\r\n        });\r\n      } catch {\r\n        similarMount.innerHTML = '<span class=\"text-muted\">Could not load similar actions.</span>';\r\n      }\r\n    })();\r\n  }\r\n\r\n  // Implementing decision: load linked decision and bind Link/Unlink/Picker\r\n  (() => {\r\n    refreshDecisionSection();\r\n    const linkBtn = container.querySelector('#action-link-decision-btn');\r\n    const unlinkBtn = container.querySelector('#action-unlink-decision-btn');\r\n    const pickerEl = container.querySelector('#action-decision-picker') as HTMLElement;\r\n    const listEl = container.querySelector('#action-decision-list') as HTMLElement;\r\n    const searchInput = container.querySelector('#action-decision-search') as HTMLInputElement;\r\n\r\n    const renderDecisionList = (decisions: Decision[], filter = '') => {\r\n      if (!listEl) return;\r\n      const f = filter.trim().toLowerCase();\r\n      const filtered = f ? decisions.filter((d) => (d.content || '').toLowerCase().includes(f) || (d.summary || '').toLowerCase().includes(f)) : decisions;\r\n      if (filtered.length === 0) {\r\n        listEl.innerHTML = '<div class=\"empty-state\">No decisions match</div>';\r\n        return;\r\n      }\r\n      listEl.innerHTML = filtered\r\n        .map((d) => {\r\n          const title = (d.summary || d.content || '').toString().trim().substring(0, 60) + ((d.content || '').toString().length > 60 ? '' : '');\r\n          return `<div class=\"action-decision-item\" data-decision-id=\"${escapeHtml(String(d.id))}\" role=\"button\" tabindex=\"0\">${escapeHtml(title)}</div>`;\r\n        })\r\n        .join('');\r\n      listEl.querySelectorAll('.action-decision-item').forEach((el) => {\r\n        on(el as HTMLElement, 'click', async () => {\r\n          const id = (el as HTMLElement).getAttribute('data-decision-id');\r\n          if (!id) return;\r\n          try {\r\n            const updated = await actionsService.update(currentAction.id, { decision_id: id });\r\n            currentAction = updated as Action;\r\n            onUpdate?.(updated as Action);\r\n            refreshDecisionSection();\r\n            if (pickerEl) pickerEl.classList.add('hidden');\r\n            toast.success('Decision linked');\r\n          } catch (e) {\r\n            toast.error((e as Error).message || 'Failed to link decision');\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    if (linkBtn) {\r\n      on(linkBtn as HTMLElement, 'click', async () => {\r\n        if (!pickerEl || !listEl) return;\r\n        const isOpen = !pickerEl.classList.contains('hidden');\r\n        pickerEl.classList.toggle('hidden', isOpen);\r\n        if (!isOpen) {\r\n          listEl.innerHTML = 'Loading';\r\n          try {\r\n            const decisions = await decisionsService.getDecisions();\r\n            renderDecisionList(decisions, searchInput?.value || '');\r\n          } catch {\r\n            listEl.innerHTML = '<div class=\"empty-state\">Failed to load decisions</div>';\r\n          }\r\n        }\r\n      });\r\n    }\r\n    if (unlinkBtn) {\r\n      on(unlinkBtn as HTMLElement, 'click', async () => {\r\n        try {\r\n          const updated = await actionsService.update(currentAction.id, { decision_id: null });\r\n          currentAction = updated as Action;\r\n          onUpdate?.(updated as Action);\r\n          refreshDecisionSection();\r\n          toast.success('Decision unlinked');\r\n        } catch (e) {\r\n          toast.error((e as Error).message || 'Failed to unlink');\r\n        }\r\n      });\r\n    }\r\n    if (searchInput && listEl) {\r\n      searchInput.addEventListener('input', () => {\r\n        decisionsService.getDecisions().then((decisions) => renderDecisionList(decisions, searchInput.value));\r\n      });\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      if (pickerEl && !(e.target as HTMLElement).closest('#action-decision-section') && !pickerEl.classList.contains('hidden')) {\r\n        pickerEl.classList.add('hidden');\r\n      }\r\n    });\r\n  })();\r\n\r\n  const editBtn = container.querySelector('#edit-action-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      viewContent.classList.add('hidden');\r\n      editForm.classList.remove('hidden');\r\n    });\r\n  }\r\n\r\n  const cancelEditBtn = container.querySelector('#action-cancel-edit-btn');\r\n  if (cancelEditBtn) {\r\n    on(cancelEditBtn as HTMLElement, 'click', () => {\r\n      editForm.classList.add('hidden');\r\n      viewContent.classList.remove('hidden');\r\n    });\r\n  }\r\n\r\n  const assigneePickerTrigger = container.querySelector('#action-assignee-picker-trigger');\r\n  const assigneePickerDropdown = container.querySelector('#action-assignee-picker-dropdown') as HTMLElement;\r\n  const assigneePickerValue = container.querySelector('#action-assignee-picker-value');\r\n  const assigneeHiddenInput = container.querySelector('#action-edit-assignee') as HTMLInputElement;\r\n  const assigneePickerList = container.querySelector('#action-assignee-picker-list') as HTMLElement;\r\n  const assigneePickerSearch = container.querySelector('#action-assignee-picker-search') as HTMLInputElement;\r\n  if (assigneePickerTrigger && assigneePickerDropdown && assigneePickerList && assigneeHiddenInput) {\r\n    let editFormContacts: Contact[] = [];\r\n    const renderAssigneePickerList = (filter = '') => {\r\n      const filtered = filter\r\n        ? editFormContacts.filter(\r\n            (c) =>\r\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n          )\r\n        : editFormContacts;\r\n      if (editFormContacts.length === 0) {\r\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n        return;\r\n      }\r\n      if (filtered.length === 0) {\r\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n        return;\r\n      }\r\n      assigneePickerList.innerHTML = filtered\r\n        .map((c) => {\r\n          const photoUrl = (c as { photoUrl?: string }).photoUrl || (c as { avatarUrl?: string }).avatarUrl;\r\n          const selected = (assigneeHiddenInput?.value || '').trim() === (c.name || '').trim();\r\n          return `\r\n            <div class=\"action-assignee-card-picker ${selected ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"action-assignee-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n              <div class=\"action-assignee-card-info\">\r\n                <div class=\"action-assignee-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"action-assignee-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `;\r\n        })\r\n        .join('');\r\n      assigneePickerList.querySelectorAll('.action-assignee-card-picker').forEach((card) => {\r\n        on(card as HTMLElement, 'click', () => {\r\n          const name = card.getAttribute('data-contact-name') || '';\r\n          assigneeHiddenInput.value = name;\r\n          if (assigneePickerValue) assigneePickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select assignee...</span>';\r\n          assigneePickerDropdown.classList.add('hidden');\r\n        });\r\n      });\r\n    };\r\n    on(assigneePickerTrigger as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const isOpen = !assigneePickerDropdown.classList.contains('hidden');\r\n      assigneePickerDropdown.classList.toggle('hidden', isOpen);\r\n      if (!isOpen && editFormContacts.length === 0) {\r\n        assigneePickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          editFormContacts = res?.contacts || [];\r\n          renderAssigneePickerList(assigneePickerSearch?.value || '');\r\n        } catch {\r\n          assigneePickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        }\r\n      } else if (!isOpen) renderAssigneePickerList(assigneePickerSearch?.value || '');\r\n    });\r\n    if (assigneePickerSearch) {\r\n      assigneePickerSearch.addEventListener('input', () => renderAssigneePickerList(assigneePickerSearch.value));\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.action-assignee-picker-wrap') && !assigneePickerDropdown?.classList.contains('hidden')) {\r\n        assigneePickerDropdown.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  const requesterPickerTrigger = container.querySelector('#action-requester-picker-trigger');\r\n  const requesterPickerDropdown = container.querySelector('#action-requester-picker-dropdown') as HTMLElement;\r\n  const requesterPickerValue = container.querySelector('#action-requester-picker-value');\r\n  const requesterContactIdInput = container.querySelector('#action-edit-requester-contact-id') as HTMLInputElement;\r\n  const requesterNameInput = container.querySelector('#action-edit-requester-name') as HTMLInputElement;\r\n  const requesterPickerList = container.querySelector('#action-requester-picker-list') as HTMLElement;\r\n  const requesterPickerSearch = container.querySelector('#action-requester-picker-search') as HTMLInputElement;\r\n  if (requesterPickerTrigger && requesterPickerDropdown && requesterPickerList && requesterContactIdInput && requesterNameInput) {\r\n    let requesterContacts: Contact[] = [];\r\n    const renderRequesterPickerList = (filter = '') => {\r\n      const filtered = filter\r\n        ? requesterContacts.filter(\r\n            (c) =>\r\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\r\n          )\r\n        : requesterContacts;\r\n      if (requesterContacts.length === 0) {\r\n        requesterPickerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n        return;\r\n      }\r\n      requesterPickerList.innerHTML =\r\n        '<div class=\"action-assignee-card-picker\" data-contact-id=\"\" data-contact-name=\"\"><div class=\"action-assignee-card-info\"><div class=\"action-assignee-card-name text-muted\">No requester</div></div></div>' +\r\n        filtered\r\n          .map((c) => {\r\n            const photoUrl = (c as { photoUrl?: string }).photoUrl || (c as { avatarUrl?: string }).avatarUrl;\r\n            return `\r\n            <div class=\"action-assignee-card-picker\" data-contact-id=\"${escapeHtml(c.id)}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n              <div class=\"action-assignee-card-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n              <div class=\"action-assignee-card-info\">\r\n                <div class=\"action-assignee-card-name\">${escapeHtml(c.name || '')}</div>\r\n                ${c.role ? `<div class=\"action-assignee-card-role\">${escapeHtml(c.role)}</div>` : ''}\r\n              </div>\r\n            </div>\r\n          `;\r\n          })\r\n          .join('');\r\n      requesterPickerList.querySelectorAll('.action-assignee-card-picker').forEach((card) => {\r\n        on(card as HTMLElement, 'click', () => {\r\n          const id = card.getAttribute('data-contact-id') || '';\r\n          const name = card.getAttribute('data-contact-name') || '';\r\n          requesterContactIdInput.value = id;\r\n          requesterNameInput.value = name;\r\n          if (requesterPickerValue) requesterPickerValue.innerHTML = name ? escapeHtml(name) : '<span class=\"text-muted\">Select requester...</span>';\r\n          requesterPickerDropdown.classList.add('hidden');\r\n        });\r\n      });\r\n    };\r\n    on(requesterPickerTrigger as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const isOpen = !requesterPickerDropdown.classList.contains('hidden');\r\n      requesterPickerDropdown.classList.toggle('hidden', isOpen);\r\n      if (!isOpen && requesterContacts.length === 0) {\r\n        requesterPickerList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\r\n        try {\r\n          const res = await contactsService.getAll();\r\n          requesterContacts = res?.contacts || [];\r\n          renderRequesterPickerList(requesterPickerSearch?.value || '');\r\n        } catch {\r\n          requesterPickerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n        }\r\n      } else if (!isOpen) renderRequesterPickerList(requesterPickerSearch?.value || '');\r\n    });\r\n    if (requesterPickerSearch) {\r\n      requesterPickerSearch.addEventListener('input', () => renderRequesterPickerList(requesterPickerSearch.value));\r\n    }\r\n    document.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (!target.closest('.action-requester-picker-wrap') && !requesterPickerDropdown?.classList.contains('hidden')) {\r\n        requesterPickerDropdown.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI suggest in edit form (suggest assignee from task; fill picker only, user clicks Save)\r\n  const editAiSuggestBtn = container.querySelector('#action-edit-ai-suggest-btn');\r\n  const editSuggestionsPanel = container.querySelector('#action-edit-suggestions-panel') as HTMLElement;\r\n  const editAssigneeHiddenInput = container.querySelector('#action-edit-assignee') as HTMLInputElement;\r\n  const editAssigneePickerValue = container.querySelector('#action-assignee-picker-value');\r\n  if (editAiSuggestBtn && editSuggestionsPanel) {\r\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\r\n      const taskEl = container.querySelector('#action-edit-task') as HTMLTextAreaElement;\r\n      const content = taskEl?.value?.trim() || '';\r\n      if (!content) {\r\n        toast.warning('Enter task content first');\r\n        return;\r\n      }\r\n      const btn = editAiSuggestBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.innerHTML = '<span class=\"spin\"></span> Analyzing...';\r\n      editSuggestionsPanel.classList.remove('hidden');\r\n      editSuggestionsPanel.innerHTML = '<div class=\"suggestions-loading\"><div class=\"loading-text\">AI is suggesting assignees...</div></div>';\r\n      try {\r\n        if (viewContacts.length === 0) {\r\n          const res = await contactsService.getAll();\r\n          viewContacts = res?.contacts || [];\r\n        }\r\n        const { suggested_assignees } = await actionsService.suggest({ content });\r\n        if (!suggested_assignees?.length) {\r\n          editSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\"><div class=\"no-suggestions-text\">No suggestions</div><button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close</button></div>';\r\n        } else {\r\n          editSuggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\"><div class=\"ai-badge\"> AI Recommended</div></div>\r\n            <div class=\"suggestions-list-sota\">\r\n              ${suggested_assignees.map((s: ActionAssigneeSuggestion) => {\r\n                const contact = findContactByAssignee(s.name);\r\n                const photoUrl = getContactPhotoUrl(contact);\r\n                const roleOrReason = contact?.role ?? s.reason ?? '';\r\n                return `\r\n                <div class=\"action-suggestion-card suggestion-card-sota\">\r\n                  <div class=\"suggestion-card-left\">\r\n                    <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                    <div class=\"suggestion-score-ring\" style=\"--score-color: ${(s.score ?? 0) >= 70 ? 'var(--success)' : (s.score ?? 0) >= 50 ? 'var(--warning)' : 'var(--text-muted)'}\">${s.score ?? 0}</div>\r\n                    <div>\r\n                      <div class=\"suggestion-name\">${escapeHtml(s.name)}</div>\r\n                      ${roleOrReason ? `<div class=\"suggestion-reason\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                    </div>\r\n                  </div>\r\n                  <button type=\"button\" class=\"btn-select-suggestion\" data-assignee-name=\"${escapeHtml(s.name)}\">Assign</button>\r\n                </div>\r\n              `;\r\n              }).join('')}\r\n            </div>\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close suggestions</button></div>\r\n          `;\r\n          editSuggestionsPanel.querySelectorAll('.btn-select-suggestion').forEach((assignBtn) => {\r\n            const name = (assignBtn as HTMLElement).getAttribute('data-assignee-name') || '';\r\n            if (!name) return;\r\n            on(assignBtn as HTMLElement, 'click', () => {\r\n              if (editAssigneeHiddenInput) editAssigneeHiddenInput.value = name;\r\n              if (editAssigneePickerValue) editAssigneePickerValue.innerHTML = escapeHtml(name);\r\n              editSuggestionsPanel.classList.add('hidden');\r\n              toast.success(`Assignee set to ${name}`);\r\n            });\r\n          });\r\n        }\r\n        const hideBtn = editSuggestionsPanel.querySelector('#action-edit-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { editSuggestionsPanel.classList.add('hidden'); });\r\n      } catch {\r\n        editSuggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-edit-hide-suggest-btn\">Close</button></div>';\r\n        const h = editSuggestionsPanel.querySelector('#action-edit-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { editSuggestionsPanel.classList.add('hidden'); });\r\n      } finally {\r\n        btn.disabled = false;\r\n        btn.innerHTML = '<svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> AI suggest';\r\n      }\r\n    });\r\n  }\r\n\r\n  const saveBtn = container.querySelector('#action-save-btn');\r\n  if (saveBtn) {\r\n    on(saveBtn as HTMLElement, 'click', async () => {\r\n      const taskEl = container.querySelector('#action-edit-task') as HTMLTextAreaElement;\r\n      const statusEl = container.querySelector('#action-edit-status') as HTMLSelectElement;\r\n      const priorityEl = container.querySelector('#action-edit-priority') as HTMLSelectElement;\r\n      const assigneeEl = container.querySelector('#action-edit-assignee') as HTMLInputElement;\r\n      const dueEl = container.querySelector('#action-edit-due') as HTMLInputElement;\r\n      const requesterContactIdEl = container.querySelector('#action-edit-requester-contact-id') as HTMLInputElement;\r\n      const requesterNameEl = container.querySelector('#action-edit-requester-name') as HTMLInputElement;\r\n      if (!taskEl?.value.trim()) {\r\n        toast.warning('Task is required');\r\n        return;\r\n      }\r\n      try {\r\n        const updated = await actionsService.update(action.id, {\r\n          content: taskEl.value.trim(),\r\n          status: statusEl?.value as Action['status'],\r\n          priority: priorityEl?.value as Action['priority'],\r\n          assignee: assigneeEl?.value.trim() || undefined,\r\n          due_date: dueEl?.value || undefined,\r\n          requested_by_contact_id: requesterContactIdEl?.value?.trim() || undefined,\r\n          requested_by: requesterNameEl?.value?.trim() || undefined,\r\n        });\r\n        toast.success('Action updated');\r\n        onUpdate?.(updated);\r\n      } catch {\r\n        toast.error('Failed to update action');\r\n      }\r\n    });\r\n  }\r\n\r\n  const deleteBtn = container.querySelector('#delete-action-btn');\r\n  const deleteInEditBtn = container.querySelector('#action-delete-in-edit-btn');\r\n  const doDelete = async () => {\r\n    const { confirm } = await import('../Modal');\r\n    const confirmed = await confirm('Are you sure you want to delete this action?', {\r\n      title: 'Delete Action',\r\n      confirmText: 'Delete',\r\n      confirmClass: 'btn-danger',\r\n    });\r\n    if (confirmed) {\r\n      try {\r\n        await actionsService.delete(action.id);\r\n        toast.success('Action deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete action');\r\n      }\r\n    }\r\n  };\r\n  if (deleteBtn) on(deleteBtn as HTMLElement, 'click', doDelete);\r\n  if (deleteInEditBtn) on(deleteInEditBtn as HTMLElement, 'click', doDelete);\r\n\r\n  const docLink = container.querySelector('.doc-link[data-document-id]');\r\n  if (docLink) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      const docId = (docLink as HTMLElement).getAttribute('data-document-id');\r\n      if (docId) {\r\n        window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n          detail: { tab: 'files', documentId: docId }\r\n        }));\r\n      }\r\n    });\r\n  }\r\n\r\n  const aiSuggestBtn = container.querySelector('#action-ai-suggest-btn');\r\n  const suggestionsPanel = container.querySelector('#action-suggestions-panel') as HTMLElement;\r\n  if (aiSuggestBtn && suggestionsPanel) {\r\n    on(aiSuggestBtn as HTMLElement, 'click', async () => {\r\n      (aiSuggestBtn as HTMLButtonElement).disabled = true;\r\n      suggestionsPanel.classList.remove('hidden');\r\n      suggestionsPanel.innerHTML = '<div class=\"suggestions-loading\">Loading suggestions...</div>';\r\n      try {\r\n        const task = taskText(action);\r\n        if (viewContacts.length === 0) {\r\n          const res = await contactsService.getAll();\r\n          viewContacts = res?.contacts || [];\r\n        }\r\n        const { suggested_assignees } = await actionsService.suggest({ content: task });\r\n        if (!suggested_assignees?.length) {\r\n          suggestionsPanel.innerHTML = '<div class=\"no-suggestions\">No suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close suggestions</button></div>';\r\n        } else {\r\n          suggestionsPanel.innerHTML = `\r\n            <div class=\"suggestions-header-sota\">\r\n              <div class=\"ai-badge\">\r\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\r\n                AI Recommended\r\n              </div>\r\n            </div>\r\n            <div class=\"suggestions-list-sota\">\r\n              ${suggested_assignees.map((s: ActionAssigneeSuggestion, i: number) => {\r\n                const contact = findContactByAssignee(s.name);\r\n                const photoUrl = getContactPhotoUrl(contact);\r\n                const roleOrReason = contact?.role ?? s.reason ?? '';\r\n                return `\r\n                <div class=\"suggestion-card-sota\" data-index=\"${i}\">\r\n                  <div class=\"suggestion-rank\">#${i + 1}</div>\r\n                  <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\r\n                  <div class=\"suggestion-info-sota\">\r\n                    <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\r\n                    ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\r\n                  </div>\r\n                  <div class=\"suggestion-score-sota\" style=\"--score-color: ${(s.score ?? 0) >= 70 ? 'var(--success)' : (s.score ?? 0) >= 50 ? 'var(--warning)' : 'var(--text-muted)'}\">\r\n                    <div class=\"score-ring\">\r\n                      <svg viewBox=\"0 0 36 36\">\r\n                        <path class=\"score-bg\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                        <path class=\"score-fill\" stroke-dasharray=\"${s.score ?? 0}, 100\" d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"/>\r\n                      </svg>\r\n                      <div class=\"score-value\">${s.score ?? 0}%</div>\r\n                    </div>\r\n                    <div class=\"score-label\">Match</div>\r\n                  </div>\r\n                  <button type=\"button\" class=\"btn-select-suggestion\" data-assignee-name=\"${escapeHtml(s.name)}\">\r\n                    <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/></svg>\r\n                    Assign\r\n                  </button>\r\n                </div>\r\n              `;\r\n              }).join('')}\r\n            </div>\r\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close suggestions</button></div>\r\n          `;\r\n          suggestionsPanel.querySelectorAll('.btn-select-suggestion').forEach((btn) => {\r\n            on(btn as HTMLElement, 'click', async () => {\r\n              const name = (btn as HTMLElement).getAttribute('data-assignee-name') || '';\r\n              if (!name) return;\r\n              try {\r\n                const updated = await actionsService.update(action.id, { assignee: name });\r\n                toast.success(`Assigned to ${name}`);\r\n                onUpdate?.(updated);\r\n                suggestionsPanel.classList.add('hidden');\r\n              } catch {\r\n                toast.error('Failed to assign');\r\n              }\r\n            });\r\n          });\r\n        }\r\n        const hideBtn = suggestionsPanel.querySelector('#action-hide-suggest-btn');\r\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { suggestionsPanel.classList.add('hidden'); });\r\n      } catch {\r\n        suggestionsPanel.innerHTML = '<div class=\"suggestions-error\">Failed to get suggestions. <button type=\"button\" class=\"btn-link\" id=\"action-hide-suggest-btn\">Close</button></div>';\r\n        const h = suggestionsPanel.querySelector('#action-hide-suggest-btn');\r\n        if (h) on(h as HTMLElement, 'click', () => { suggestionsPanel.classList.add('hidden'); });\r\n      } finally {\r\n        (aiSuggestBtn as HTMLButtonElement).disabled = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  const timelineEl = container.querySelector('#timeline-content');\r\n  if (timelineEl) renderTimeline(timelineEl as HTMLElement);\r\n  bindDodToggles();\r\n\r\n  // Contact picker in view: load contacts, show picker on Change/Choose Manually, on select update assignee via API\r\n  let viewContacts: Contact[] = [];\r\n  const actionContactPicker = container.querySelector('#action-contact-picker') as HTMLElement;\r\n  const actionContactList = container.querySelector('#action-contact-list') as HTMLElement;\r\n  const actionContactSearch = container.querySelector('#action-contact-search') as HTMLInputElement;\r\n\r\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\r\n    if (!c) return null;\r\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\r\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\r\n  }\r\n\r\n  const renderActionContactGrid = (filter = '') => {\r\n    if (!actionContactList) return;\r\n    const list = filter\r\n      ? viewContacts.filter(\r\n          (c) =>\r\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\r\n            ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\r\n        )\r\n      : viewContacts;\r\n    if (viewContacts.length === 0) {\r\n      actionContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\r\n      return;\r\n    }\r\n    if (list.length === 0) {\r\n      actionContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\r\n      return;\r\n    }\r\n    actionContactList.innerHTML = list\r\n      .map((c) => {\r\n        const photoUrl = getContactPhotoUrl(c);\r\n        const isCurrent = (assignee || '').trim() === (c.name || '').trim();\r\n        return `\r\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\r\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\r\n            <div class=\"contact-info-picker\">\r\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\r\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\r\n            </div>\r\n          </div>`;\r\n      })\r\n      .join('');\r\n    actionContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\r\n      on(card as HTMLElement, 'click', async () => {\r\n        const name = card.getAttribute('data-contact-name') || '';\r\n        if (!name) return;\r\n        try {\r\n          const updated = await actionsService.update(action.id, { assignee: name });\r\n          toast.success(`Assigned to ${name}`);\r\n          if (actionContactPicker) actionContactPicker.classList.add('hidden');\r\n          onUpdate?.(updated);\r\n        } catch {\r\n          toast.error('Failed to save assignment');\r\n        }\r\n      });\r\n    });\r\n  };\r\n\r\n  const showActionPicker = () => {\r\n    if (!actionContactPicker) return;\r\n    actionContactPicker.classList.toggle('hidden');\r\n    if (!actionContactPicker.classList.contains('hidden') && viewContacts.length === 0) {\r\n      contactsService.getAll().then((res) => {\r\n        viewContacts = res?.contacts || [];\r\n        renderActionContactGrid(actionContactSearch?.value || '');\r\n      }).catch(() => {\r\n        if (actionContactList) actionContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\r\n      });\r\n    } else if (!actionContactPicker.classList.contains('hidden')) {\r\n      renderActionContactGrid(actionContactSearch?.value || '');\r\n    }\r\n    if (actionContactSearch) actionContactSearch.focus();\r\n  };\r\n\r\n  const changeBtn = container.querySelector('#action-change-assignee-btn');\r\n  const showPickerBtn = container.querySelector('#action-show-picker-btn');\r\n  if (changeBtn && actionContactPicker) on(changeBtn as HTMLElement, 'click', showActionPicker);\r\n  if (showPickerBtn && actionContactPicker) on(showPickerBtn as HTMLElement, 'click', showActionPicker);\r\n  if (actionContactSearch) {\r\n    actionContactSearch.addEventListener('input', () => renderActionContactGrid(actionContactSearch.value));\r\n  }\r\n\r\n  // Find contact by assignee name: exact name, partial name, or any alias (case-insensitive)\r\n  function findContactByAssignee(name: string): Contact | undefined {\r\n    if (!name || !viewContacts.length) return undefined;\r\n    const n = name.trim().toLowerCase();\r\n    if (!n) return undefined;\r\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n    if (byExact) return byExact;\r\n    const byPartial = viewContacts.find(\r\n      (c) =>\r\n        (c.name || '').trim().toLowerCase().includes(n) ||\r\n        n.includes((c.name || '').trim().toLowerCase())\r\n    );\r\n    if (byPartial) return byPartial;\r\n    const byAlias = viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n    );\r\n    if (byAlias) return byAlias;\r\n    return viewContacts.find((c) =>\r\n      (c.aliases || []).some((a) => {\r\n        const aLower = String(a).trim().toLowerCase();\r\n        return aLower.includes(n) || n.includes(aLower);\r\n      })\r\n    );\r\n  }\r\n\r\n  function findContactByRequester(contacts: Contact[], action: Action): Contact | undefined {\r\n    if (!contacts.length) return undefined;\r\n    if (action.requested_by_contact_id) {\r\n      const byId = contacts.find((c) => String(c.id) === String(action.requested_by_contact_id));\r\n      if (byId) return byId;\r\n    }\r\n    const name = (action.requested_by || '').trim();\r\n    if (!name) return undefined;\r\n    const n = name.toLowerCase();\r\n    const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n    if (byExact) return byExact;\r\n    const byPartial = contacts.find((c) => (c.name || '').trim().toLowerCase().includes(n) || n.includes((c.name || '').trim().toLowerCase()));\r\n    return byPartial;\r\n  }\r\n\r\n  // Load contacts to show assigned role/avatar and requester card\r\n  contactsService.getAll().then((res) => {\r\n    viewContacts = res?.contacts || [];\r\n    const contact = findContactByAssignee(assignee);\r\n    const roleEl = container.querySelector('#action-assigned-role');\r\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\r\n    const avatarEl = container.querySelector('#action-assigned-avatar');\r\n    if (avatarEl && assignee) {\r\n      const photoUrl = getContactPhotoUrl(contact);\r\n      if (photoUrl) {\r\n        avatarEl.innerHTML = '';\r\n        const img = document.createElement('img');\r\n        img.src = photoUrl;\r\n        img.alt = '';\r\n        img.onerror = () => { avatarEl.textContent = getInitials(assignee); };\r\n        avatarEl.appendChild(img);\r\n      }\r\n    }\r\n    const requesterDisplay = container.querySelector('#action-requester-display') as HTMLElement;\r\n    if (requesterDisplay && (action.requested_by || action.requested_by_contact_id)) {\r\n      const requesterContact = findContactByRequester(viewContacts, action);\r\n      if (requesterContact) {\r\n        const photoUrl = getContactPhotoUrl(requesterContact);\r\n        const name = requesterContact.name || action.requested_by || '';\r\n        requesterDisplay.innerHTML = `\r\n          <p class=\"requested-by-label\">Requested by</p>\r\n          <div class=\"assigned-contact-display requester-contact-card\">\r\n            <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.textContent='${getInitials(name)}'\">` : getInitials(name)}</div>\r\n            <div class=\"contact-details\">\r\n              <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\r\n              ${requesterContact.role ? `<div class=\"contact-role-sm\">${escapeHtml(requesterContact.role)}</div>` : ''}\r\n            </div>\r\n          </div>\r\n        `;\r\n      }\r\n    }\r\n  }).catch(() => {});\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Actions Panel Component\r\n * Displays and manages action items\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { actionsService, Action } from '../../services/actions';\r\nimport { getSprints, getSprint } from '../../services/sprints';\r\nimport type { Sprint } from '../../services/sprints';\r\nimport { dataStore } from '../../stores/data';\r\nimport { showActionModal } from '../modals/ActionModal';\r\nimport { showCreateSprintModal } from '../sprints/CreateSprintModal';\r\nimport { showSprintReportModal } from '../sprints/SprintReportModal';\r\nimport { createActionDetailView, ActionDetailViewProps } from '../actions/ActionDetailView';\r\nimport { formatRelativeTime, formatDate } from '../../utils/format';\r\nimport { toast } from '../../services/toast';\r\n\r\ntype ViewMode = 'list' | 'by_sprint' | 'by_story';\r\n\r\nfunction actionDetailProps(containerEl: HTMLElement, props: ActionsPanelProps, action: Action): ActionDetailViewProps {\r\n  return {\r\n    action,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createActionsPanel(props));\r\n    },\r\n    onUpdate: (updatedAction?: Action) => {\r\n      containerEl.innerHTML = '';\r\n      if (updatedAction) {\r\n        containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, updatedAction)));\r\n      } else {\r\n        containerEl.appendChild(createActionsPanel(props));\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport interface ActionsPanelProps {\r\n  onActionClick?: (action: Action) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentSprintId: string = '';\r\nlet currentViewMode: ViewMode = 'by_sprint';\r\n\r\n/**\r\n * Create actions panel\r\n */\r\nexport function createActionsPanel(props: ActionsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel actions-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Actions</h2>\r\n        <span class=\"panel-count\" id=\"actions-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <div class=\"view-mode-tabs\" role=\"tablist\">\r\n          <button type=\"button\" class=\"view-mode-tab\" data-view=\"list\" title=\"Flat list\">List</button>\r\n          <button type=\"button\" class=\"view-mode-tab active\" data-view=\"by_sprint\" title=\"Group by sprint\">Sprints</button>\r\n          <button type=\"button\" class=\"view-mode-tab\" data-view=\"by_story\" title=\"Group by user story\">Stories</button>\r\n        </div>\r\n        <select id=\"actions-sprint-filter\" class=\"filter-select\" title=\"Sprint (List view)\">\r\n          <option value=\"\">All sprints</option>\r\n        </select>\r\n        <select id=\"actions-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"pending\">Pending</option>\r\n          <option value=\"in_progress\">In Progress</option>\r\n          <option value=\"completed\">Completed</option>\r\n          <option value=\"overdue\">Overdue</option>\r\n        </select>\r\n        <button class=\"btn btn-outline-primary btn-sm\" id=\"create-sprint-btn\" title=\"Create sprint and generate tasks from emails/transcripts\">Sprint</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-action-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"actions-report-strip\" class=\"actions-report-strip hidden\"></div>\r\n    <div id=\"actions-sprint-detail\" class=\"actions-sprint-detail hidden\"></div>\r\n    <div class=\"panel-content\" id=\"actions-content\">\r\n      <div class=\"loading\">Loading actions...</div>\r\n    </div>\r\n    <div id=\"removed-actions-container\" class=\"removed-actions-container hidden\"></div>\r\n  `;\r\n\r\n  // Populate sprint filter and bind\r\n  (async () => {\r\n    const sprintSelect = panel.querySelector('#actions-sprint-filter') as HTMLSelectElement;\r\n    if (!sprintSelect) return;\r\n    try {\r\n      const sprints = await getSprints();\r\n      sprints.forEach((s) => {\r\n        const opt = document.createElement('option');\r\n        opt.value = s.id;\r\n        opt.textContent = s.name;\r\n        if (s.id === currentSprintId) opt.selected = true;\r\n        sprintSelect.appendChild(opt);\r\n      });\r\n      on(sprintSelect, 'change', () => {\r\n        currentSprintId = sprintSelect.value || '';\r\n        loadActions(panel, props);\r\n      });\r\n    } catch {\r\n      // ignore\r\n    }\r\n  })();\r\n\r\n  panel.querySelectorAll('.view-mode-tab').forEach((tab) => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      const view = (tab as HTMLElement).getAttribute('data-view') as ViewMode;\r\n      if (!view || view === currentViewMode) return;\r\n      currentViewMode = view;\r\n      panel.querySelectorAll('.view-mode-tab').forEach((t) => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      loadActions(panel, props);\r\n    });\r\n  });\r\n\r\n  const filterSelect = panel.querySelector('#actions-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadActions(panel, props);\r\n  });\r\n\r\n  const createSprintBtn = panel.querySelector('#create-sprint-btn');\r\n  if (createSprintBtn) {\r\n    on(createSprintBtn as HTMLElement, 'click', () => {\r\n      showCreateSprintModal({\r\n        onSuccess: () => loadActions(panel, props),\r\n      });\r\n    });\r\n  }\r\n  const addBtn = panel.querySelector('#add-action-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showActionModal({\r\n        mode: 'create',\r\n        onSave: () => loadActions(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadActions(panel, props);\r\n  refreshRemovedActionsSection(panel, props);\r\n  refreshReportStrip(panel);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load and render the Sprint detail header when a sprint is selected\r\n */\r\nasync function refreshSprintDetailHeader(panel: HTMLElement): Promise<void> {\r\n  const container = panel.querySelector('#actions-sprint-detail') as HTMLElement;\r\n  if (!container) return;\r\n  if (!currentSprintId) {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n    return;\r\n  }\r\n  try {\r\n    const sprint = await getSprint(currentSprintId);\r\n    if (!sprint) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    const start = sprint.start_date ? new Date(sprint.start_date).toLocaleDateString() : '';\r\n    const end = sprint.end_date ? new Date(sprint.end_date).toLocaleDateString() : '';\r\n    container.innerHTML = `\r\n      <div class=\"sprint-detail-header\">\r\n        <div class=\"sprint-detail-title\">${escapeHtml(sprint.name)}</div>\r\n        <div class=\"sprint-detail-meta\">${start}  ${end}</div>\r\n        ${sprint.context ? `<div class=\"sprint-detail-context\">${escapeHtml(sprint.context)}</div>` : ''}\r\n        <button type=\"button\" class=\"btn btn-outline-primary btn-sm sprint-report-btn\" id=\"sprint-report-open-btn\" data-sprint-id=\"${escapeHtml(sprint.id)}\" data-sprint-name=\"${escapeHtml(sprint.name)}\">Sprint report</button>\r\n      </div>\r\n    `;\r\n    const reportBtn = container.querySelector('#sprint-report-open-btn');\r\n    if (reportBtn) {\r\n      on(reportBtn as HTMLElement, 'click', () => {\r\n        const id = (reportBtn as HTMLElement).getAttribute('data-sprint-id');\r\n        const name = (reportBtn as HTMLElement).getAttribute('data-sprint-name') || undefined;\r\n        if (id) showSprintReportModal({ sprintId: id, sprintName: name || undefined, onClose: () => {} });\r\n      });\r\n    }\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Load and render the actions report strip (by status)\r\n */\r\nasync function refreshReportStrip(panel: HTMLElement): Promise<void> {\r\n  const strip = panel.querySelector('#actions-report-strip') as HTMLElement;\r\n  if (!strip) return;\r\n  try {\r\n    const report = await actionsService.getReport();\r\n    const byStatus = report.by_status || {};\r\n    const bySprint = report.by_sprint || {};\r\n    const parts: string[] = [];\r\n    ['pending', 'in_progress', 'completed', 'cancelled'].forEach((s) => {\r\n      const n = byStatus[s] ?? 0;\r\n      if (n > 0) parts.push(`${s.replace('_', ' ')}: ${n}`);\r\n    });\r\n    const sprintParts = Object.entries(bySprint)\r\n      .filter(([k]) => k !== '(no sprint)')\r\n      .map(([, v]) => `${v.name}: ${v.count}`);\r\n    if (sprintParts.length > 0) parts.push(`Sprints: ${sprintParts.join('  ')}`);\r\n    if (parts.length === 0) {\r\n      strip.classList.add('hidden');\r\n      strip.innerHTML = '';\r\n      return;\r\n    }\r\n    strip.classList.remove('hidden');\r\n    strip.innerHTML = `<span class=\"actions-report-label\">By status:</span> ${parts.join('  ')}`;\r\n  } catch {\r\n    strip.classList.add('hidden');\r\n    strip.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Load and render the \"Removed actions\" section (for restore). Syncs with graph on restore.\r\n */\r\nasync function refreshRemovedActionsSection(panel: HTMLElement, props: ActionsPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-actions-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await actionsService.getDeletedActions();\r\n    if (deleted.length === 0) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    const truncate = (s: string, max: number) => (s.length > max ? s.slice(0, max) + '' : s);\r\n    container.innerHTML = `\r\n      <div class=\"removed-actions-section\">\r\n        <div class=\"removed-actions-header section-header-sota\">\r\n          <h3>Removed actions</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-actions-hint\">Restore to undo; action will be synced back to the graph.</p>\r\n        <div class=\"removed-actions-list\">\r\n          ${deleted.map((a) => `\r\n            <div class=\"removed-action-item\" data-action-id=\"${a.id}\">\r\n              <div class=\"removed-action-content\">${escapeHtml(truncate((a.task || a.content || ''), 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach((btn) => {\r\n      const item = (btn as HTMLElement).closest('.removed-action-item');\r\n      const id = item?.getAttribute('data-action-id');\r\n      if (id) {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          try {\r\n            await actionsService.restoreAction(id);\r\n            toast.success('Action restored');\r\n            await loadActions(panel, props);\r\n            refreshRemovedActionsSection(panel, props);\r\n          } catch {\r\n            toast.error('Failed to restore action');\r\n          }\r\n        });\r\n      }\r\n    });\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Load actions (list or grouped by sprint / story)\r\n */\r\nasync function loadActions(panel: HTMLElement, props: ActionsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#actions-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const status = currentFilter === 'all' || currentFilter === 'overdue' ? undefined : currentFilter;\r\n    const sprintFilter = currentViewMode === 'list' ? (currentSprintId || undefined) : undefined;\r\n    let actions = await actionsService.getAll(status, sprintFilter);\r\n\r\n    if (currentFilter === 'overdue') {\r\n      actions = actions.filter(a => actionsService.isOverdue(a));\r\n    }\r\n\r\n    dataStore.setActions(actions as unknown as []);\r\n\r\n    if (currentViewMode === 'by_sprint') {\r\n      await renderGroupedBySprint(content, actions, panel, props);\r\n    } else if (currentViewMode === 'by_story') {\r\n      await renderGroupedByStory(content, actions, panel, props);\r\n    } else {\r\n      renderActions(content, actions, props);\r\n    }\r\n\r\n    updateCount(panel, actions.length);\r\n    refreshRemovedActionsSection(panel, props);\r\n    refreshReportStrip(panel);\r\n    refreshSprintDetailHeader(panel);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load actions</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Group actions by sprint and render sections (Sprint A, Sprint B, Tasks without sprint)\r\n */\r\nasync function renderGroupedBySprint(\r\n  content: HTMLElement,\r\n  actions: Action[],\r\n  panel: HTMLElement,\r\n  props: ActionsPanelProps\r\n): Promise<void> {\r\n  const sprints = await getSprints();\r\n  const bySprint = new Map<string, Action[]>();\r\n  const noSprint: Action[] = [];\r\n\r\n  for (const a of actions) {\r\n    const sid = (a as { sprint_id?: string }).sprint_id;\r\n    if (sid) {\r\n      if (!bySprint.has(sid)) bySprint.set(sid, []);\r\n      bySprint.get(sid)!.push(a);\r\n    } else {\r\n      noSprint.push(a);\r\n    }\r\n  }\r\n\r\n  const sprintList = sprints.filter((s) => bySprint.has(s.id));\r\n  content.innerHTML = '';\r\n\r\n  for (const sprint of sprintList) {\r\n    const groupActions = bySprint.get(sprint.id) || [];\r\n    const section = createGroupSection(\r\n      `${sprint.name} (${groupActions.length})`,\r\n      groupActions,\r\n      panel,\r\n      props,\r\n      () => {\r\n        currentSprintId = sprint.id;\r\n        refreshSprintDetailHeader(panel);\r\n      }\r\n    );\r\n    content.appendChild(section);\r\n  }\r\n\r\n  const noSprintSection = createGroupSection('Tasks without sprint', noSprint, panel, props);\r\n  content.appendChild(noSprintSection);\r\n}\r\n\r\n/**\r\n * Group actions by user story and render sections (Story 1, Story 2, Tasks without story)\r\n */\r\nasync function renderGroupedByStory(\r\n  content: HTMLElement,\r\n  actions: Action[],\r\n  panel: HTMLElement,\r\n  props: ActionsPanelProps\r\n): Promise<void> {\r\n  const stories = await actionsService.getUserStories();\r\n  const byStory = new Map<string, Action[]>();\r\n  const noStory: Action[] = [];\r\n\r\n  for (const a of actions) {\r\n    const storyId = (a as { parent_story_id?: string }).parent_story_id;\r\n    if (storyId) {\r\n      if (!byStory.has(storyId)) byStory.set(storyId, []);\r\n      byStory.get(storyId)!.push(a);\r\n    } else {\r\n      noStory.push(a);\r\n    }\r\n  }\r\n\r\n  content.innerHTML = '';\r\n\r\n  for (const story of stories) {\r\n    const groupActions = byStory.get(story.id) || [];\r\n    if (groupActions.length === 0 && !byStory.has(story.id)) continue;\r\n    const title = story.story_points != null ? `${story.title} (${story.story_points} pt)` : story.title;\r\n    const section = createGroupSection(`${title}  ${groupActions.length} tasks`, groupActions, panel, props);\r\n    content.appendChild(section);\r\n  }\r\n\r\n  const noStorySection = createGroupSection('Tasks without story', noStory, panel, props);\r\n  content.appendChild(noStorySection);\r\n}\r\n\r\nfunction createGroupSection(\r\n  title: string,\r\n  groupActions: Action[],\r\n  panel: HTMLElement,\r\n  props: ActionsPanelProps,\r\n  onHeaderClick?: () => void\r\n): HTMLElement {\r\n  const section = createElement('div', { className: 'actions-group' });\r\n  const header = createElement('div', { className: 'actions-group-header' });\r\n  header.innerHTML = `<h3 class=\"actions-group-title\">${escapeHtml(title)}</h3><span class=\"actions-group-count\">${groupActions.length}</span>`;\r\n  if (onHeaderClick) header.style.cursor = 'pointer';\r\n  if (onHeaderClick) on(header, 'click', onHeaderClick);\r\n  section.appendChild(header);\r\n  const listEl = createElement('div', { className: 'actions-group-list' });\r\n  section.appendChild(listEl);\r\n  if (groupActions.length === 0) {\r\n    listEl.innerHTML = '<p class=\"actions-group-empty\">No tasks</p>';\r\n  } else {\r\n    renderActionCards(listEl, groupActions, props);\r\n  }\r\n  return section;\r\n}\r\n\r\ntype ContactLike = { id?: string; name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\r\n\r\nfunction findContactById(contacts: ContactLike[], id: string): ContactLike | undefined {\r\n  if (!id || !contacts.length) return undefined;\r\n  return contacts.find((c) => (c as { id?: string }).id && String((c as { id: string }).id) === String(id));\r\n}\r\n\r\nfunction findContactByAssignee(contacts: ContactLike[], name: string): ContactLike | undefined {\r\n  if (!name || !contacts.length) return undefined;\r\n  const n = name.trim().toLowerCase();\r\n  if (!n) return undefined;\r\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n  if (byExact) return byExact;\r\n  const byPartial = contacts.find(\r\n    (c) =>\r\n      (c.name || '').trim().toLowerCase().includes(n) ||\r\n      n.includes((c.name || '').trim().toLowerCase())\r\n  );\r\n  if (byPartial) return byPartial;\r\n  const byAlias = contacts.find((c) =>\r\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n  );\r\n  return byAlias || contacts.find((c) =>\r\n    (c.aliases || []).some((a) => {\r\n      const aLower = String(a).trim().toLowerCase();\r\n      return aLower.includes(n) || n.includes(aLower);\r\n    })\r\n  );\r\n}\r\n\r\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\r\n  if (!c) return null;\r\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\n/**\r\n * Render action cards into a container (used by list view and grouped sections)\r\n */\r\nfunction renderActionCards(container: HTMLElement, actions: Action[], props: ActionsPanelProps): void {\r\n  if (actions.length === 0) return;\r\n  const panel = (container.closest && container.closest('.actions-panel')) as HTMLElement | null;\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const priorityBarColor: Record<string, string> = { high: '#ea580c', medium: '#ca8a04', low: '#16a34a' };\r\n  container.innerHTML = actions.map(action => buildActionCardHtml(action, contacts, priorityBarColor)).join('');\r\n  bindActionCards(container, actions, props, panel || undefined);\r\n}\r\n\r\nfunction buildActionCardHtml(\r\n  action: Action,\r\n  contacts: ContactLike[],\r\n  priorityBarColor: Record<string, string>\r\n): string {\r\n  const isOverdue = actionsService.isOverdue(action);\r\n  const priority = (action.priority || 'medium').toLowerCase();\r\n  const barColor = priorityBarColor[priority] ?? priorityBarColor.medium;\r\n  const content = (action.content ?? (action as { task?: string }).task ?? '').trim();\r\n  const assignee = action.assignee ?? (action as { owner?: string }).owner ?? '';\r\n  const contact = assignee ? findContactByAssignee(contacts, assignee) : undefined;\r\n  const photoUrl = getContactPhotoUrl(contact);\r\n  const assigneeChipHtml = assignee\r\n    ? `\r\n    <div class=\"assignee-chip\">\r\n      <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(assignee)}\" onerror=\"this.parentElement.innerHTML='${getInitials(assignee)}'\">` : getInitials(assignee)}</div>\r\n      <div class=\"assignee-info\">\r\n        <span class=\"assignee-name\">${escapeHtml(assignee)}</span>\r\n        ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n      </div>\r\n    </div>\r\n  `\r\n    : '';\r\n  const requestedBy = (action as { requested_by?: string }).requested_by ?? '';\r\n  const requestedByContactId = (action as { requested_by_contact_id?: string }).requested_by_contact_id ?? '';\r\n  const requesterContact = requestedByContactId\r\n    ? findContactById(contacts, requestedByContactId)\r\n    : requestedBy\r\n      ? findContactByAssignee(contacts, requestedBy)\r\n      : undefined;\r\n  const requesterName = requesterContact?.name ?? requestedBy;\r\n  const requesterPhotoUrl = getContactPhotoUrl(requesterContact);\r\n  const requesterChipHtml =\r\n    requesterName || requestedByContactId\r\n      ? `\r\n    <div class=\"requester-chip card-source-chip\">\r\n      <span class=\"requester-label\">Requested by</span>\r\n      <div class=\"assignee-chip requester-chip-inner\">\r\n        <div class=\"assignee-avatar\">${requesterPhotoUrl ? `<img src=\"${escapeHtml(requesterPhotoUrl)}\" alt=\"${escapeHtml(requesterName || '')}\" onerror=\"this.parentElement.innerHTML='${getInitials(requesterName || '?')}'\">` : getInitials(requesterName || '?')}</div>\r\n        <span class=\"assignee-name\">${escapeHtml(requesterName || 'Unknown')}</span>\r\n      </div>\r\n    </div>\r\n  `\r\n      : '';\r\n  const dueChip = action.due_date ? `<span class=\"card-source-chip\">Due: ${formatDate(action.due_date)}</span>` : '<span class=\"card-source-chip text-muted\">No due date</span>';\r\n  return `\r\n    <div class=\"action-card-sota question-card-sota ${isOverdue ? 'overdue' : ''}\" data-id=\"${action.id}\" style=\"--action-priority-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar action-priority-bar\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"status-pill status-${(action.status || 'pending').toLowerCase()}\">${escapeHtml(String(action.status).replace('_', ' '))}</span>\r\n            ${action.priority ? `<span class=\"priority-pill priority-${action.priority}\">${escapeHtml(action.priority)}</span>` : ''}\r\n            ${isOverdue ? '<span class=\"status-pill overdue\">OVERDUE</span>' : ''}\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(action.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${assigneeChipHtml}\r\n            ${requesterChipHtml}\r\n            ${dueChip}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            <button type=\"button\" class=\"btn-link action-view-link\">View</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindActionCards(container: HTMLElement, actions: Action[], props: ActionsPanelProps, panel?: HTMLElement | null): void {\r\n  const reload = () => (panel ? loadActions(panel, props) : undefined);\r\n  container.querySelectorAll('.action-card-sota').forEach((card) => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.card-assignment')) return;\r\n      const id = card.getAttribute('data-id');\r\n      const action = actions.find((a) => String(a.id) === id);\r\n      if (!action) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, action)));\r\n      } else if (props.onActionClick) {\r\n        props.onActionClick(action);\r\n      } else {\r\n        showActionModal({ mode: 'edit', action, onSave: reload });\r\n      }\r\n    });\r\n    const viewLink = card.querySelector('.action-view-link');\r\n    if (viewLink) {\r\n      on(viewLink as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        const action = actions.find((a) => String(a.id) === id);\r\n        if (!action) return;\r\n        if (props.useDetailView && props.containerElement) {\r\n          const containerEl = props.containerElement;\r\n          containerEl.innerHTML = '';\r\n          containerEl.appendChild(createActionDetailView(actionDetailProps(containerEl, props, action)));\r\n        } else if (props.onActionClick) {\r\n          props.onActionClick(action);\r\n        } else {\r\n          showActionModal({ mode: 'edit', action, onSave: reload });\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render actions list (flat view)\r\n */\r\nfunction renderActions(container: HTMLElement, actions: Action[], props: ActionsPanelProps): void {\r\n  if (actions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No actions found</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Action</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showActionModal({ mode: 'create' });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  renderActionCards(container, actions, props);\r\n}\r\n\r\n/**\r\n * Update count badge\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#actions-count');\r\n  if (countEl) {\r\n    countEl.textContent = String(count);\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createActionsPanel;\r\n","/**\n * Decision Modal Component\n * Create, view and edit decisions\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { Decision } from '../../stores/data';\nimport { http } from '../../services/api';\nimport { decisionsService } from '../../services/decisions';\nimport { contactsService, Contact } from '../../services/contacts';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime } from '../../utils/format';\n\nfunction getInitials(name: string): string {\n  if (!name) return '?';\n  const parts = name.trim().split(/\\s+/);\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\n}\n\nfunction getContactPhotoUrl(c: Contact | undefined): string | null {\n  if (!c) return null;\n  const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\n  return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\n}\n\nconst MODAL_ID = 'decision-modal';\n\nexport interface DecisionModalProps {\n  mode: 'view' | 'edit' | 'create';\n  decision?: Decision;\n  onSave?: (decision: Decision) => void;\n  onDelete?: (decisionId: string) => void;\n}\n\n/**\n * Show decision modal\n */\nexport function showDecisionModal(props: DecisionModalProps): void {\n  const { mode, decision, onSave, onDelete } = props;\n  const isEdit = mode === 'edit' && decision?.id;\n  const isView = mode === 'view';\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'decision-modal-content' });\n\n  if (isView && decision) {\n    const viewContent = (decision as any).content ?? decision.decision;\n    const viewImpact = (decision as any).impact;\n    const viewSummary = (decision as any).summary;\n    content.innerHTML = `\n      <div class=\"decision-view\">\n        <div class=\"decision-meta\">\n          <span class=\"status-badge ${decision.status}\">${decision.status}</span>\n          ${viewImpact ? `<span class=\"impact-badge impact-${viewImpact}\">${escapeHtml(viewImpact)} impact</span>` : ''}\n          <span class=\"decision-date\">${formatRelativeTime(decision.madeAt)}</span>\n        </div>\n        \n        <div class=\"decision-text-large\">\n          ${escapeHtml(viewContent)}\n        </div>\n        \n        ${viewSummary ? `\n          <div class=\"decision-section decision-summary\">\n            <h4>Summary</h4>\n            <p>${escapeHtml(viewSummary)}</p>\n          </div>\n        ` : ''}\n        \n        ${decision.rationale ? `\n          <div class=\"decision-section\">\n            <h4>Rationale</h4>\n            <p>${escapeHtml(decision.rationale)}</p>\n          </div>\n        ` : ''}\n        \n        ${decision.madeBy ? `\n          <div class=\"decision-made-by\">\n            <strong>Decision made by:</strong> ${escapeHtml(decision.madeBy)}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  } else {\n    const decisionContent = (decision as any)?.content ?? decision?.decision ?? '';\n    const decisionImpact = (decision as any)?.impact ?? '';\n    const decisionSummary = (decision as any)?.summary ?? '';\n    content.innerHTML = `\n      <form id=\"decision-form\" class=\"decision-form\">\n        <div class=\"form-group\">\n          <label for=\"decision-text\">Decision *</label>\n          <textarea id=\"decision-text\" rows=\"3\" required \n                    placeholder=\"What was decided?\">${escapeHtml(decisionContent)}</textarea>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"decision-rationale\">Rationale</label>\n          <div class=\"form-group-with-action\">\n            <textarea id=\"decision-rationale\" rows=\"2\" \n                      placeholder=\"Why was this decision made?\">${escapeHtml(decision?.rationale || '')}</textarea>\n          </div>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"decision-impact\">Impact</label>\n            <select id=\"decision-impact\">\n              <option value=\"\"></option>\n              <option value=\"low\" ${decisionImpact === 'low' ? 'selected' : ''}>Low</option>\n              <option value=\"medium\" ${decisionImpact === 'medium' || !decisionImpact ? 'selected' : ''}>Medium</option>\n              <option value=\"high\" ${decisionImpact === 'high' ? 'selected' : ''}>High</option>\n            </select>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"decision-summary\">Summary (one line)</label>\n            <input type=\"text\" id=\"decision-summary\" \n                   value=\"${escapeHtml(decisionSummary)}\" \n                   placeholder=\"One-line summary for lists/reports\">\n          </div>\n        </div>\n        \n        <div class=\"form-row form-row-actions\">\n          <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"decision-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n            AI suggest\n          </button>\n          <span class=\"form-hint\" id=\"decision-suggest-hint\"></span>\n        </div>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label for=\"decision-status\">Status</label>\n            <select id=\"decision-status\">\n              <option value=\"proposed\" ${decision?.status === 'proposed' || !decision ? 'selected' : ''}>Proposed</option>\n              <option value=\"approved\" ${decision?.status === 'approved' ? 'selected' : ''}>Approved</option>\n              <option value=\"rejected\" ${decision?.status === 'rejected' ? 'selected' : ''}>Rejected</option>\n            </select>\n          </div>\n          \n          <div class=\"form-group\">\n            <label>Made By</label>\n            <input type=\"hidden\" id=\"decision-by\" value=\"${escapeHtml(decision?.madeBy || '')}\">\n            <div id=\"decision-made-by-display\" class=\"current-assignment-card decision-modal-owner-card\"></div>\n            <div id=\"decision-modal-contact-picker\" class=\"contact-picker-sota contact-picker-mt hidden\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"decision-modal-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"decision-modal-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n          </div>\n        </div>\n      </form>\n    `;\n\n    const suggestBtn = content.querySelector('#decision-ai-suggest-btn');\n    const hintEl = content.querySelector('#decision-suggest-hint');\n    if (suggestBtn) {\n      on(suggestBtn as HTMLElement, 'click', async () => {\n        const getVal = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value?.trim() || '';\n        const text = getVal('decision-text');\n        if (!text) {\n          toast.warning('Enter decision text first');\n          return;\n        }\n        (suggestBtn as HTMLButtonElement).disabled = true;\n        if (hintEl) hintEl.textContent = 'Asking AI';\n        try {\n          const result = await decisionsService.suggest(text, getVal('decision-rationale'));\n          (content.querySelector('#decision-rationale') as HTMLTextAreaElement).value = result.rationale || '';\n          (content.querySelector('#decision-impact') as HTMLSelectElement).value = result.impact || 'medium';\n          (content.querySelector('#decision-summary') as HTMLInputElement).value = result.summary || '';\n          if (hintEl) hintEl.textContent = result.impact_summary ? `Impact: ${result.impact_summary}` : 'Done';\n        } catch {\n          if (hintEl) hintEl.textContent = '';\n          toast.error('AI suggest failed');\n        } finally {\n          (suggestBtn as HTMLButtonElement).disabled = false;\n        }\n      });\n    }\n\n    // Made By: contact picker + current-assignment display\n    let modalContacts: Contact[] = [];\n    const madeByDisplay = content.querySelector('#decision-made-by-display') as HTMLElement;\n    const madeByInput = content.querySelector('#decision-by') as HTMLInputElement;\n    const modalPicker = content.querySelector('#decision-modal-contact-picker') as HTMLElement;\n    const modalContactList = content.querySelector('#decision-modal-contact-list') as HTMLElement;\n    const modalContactSearch = content.querySelector('#decision-modal-contact-search') as HTMLInputElement;\n\n    function findContactByName(name: string): Contact | undefined {\n      if (!name || !modalContacts.length) return undefined;\n      const n = name.trim().toLowerCase();\n      if (!n) return undefined;\n      const byExact = modalContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n      if (byExact) return byExact;\n      const byAlias = modalContacts.find((c) =>\n        (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n      );\n      return byAlias;\n    }\n\n    function renderMadeByDisplay(madeBy: string) {\n      if (!madeByDisplay || !madeByInput) return;\n      madeByInput.value = madeBy;\n      if (madeBy) {\n        const contact = findContactByName(madeBy);\n        const photoUrl = getContactPhotoUrl(contact);\n        madeByDisplay.innerHTML = `\n          <div class=\"assigned-contact-display\">\n            <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(madeBy)}'\">` : getInitials(madeBy)}</div>\n            <div class=\"contact-details\">\n              <div class=\"contact-name-lg\">${escapeHtml(madeBy)}</div>\n              ${contact?.role ? `<div class=\"contact-role-sm\">${escapeHtml(contact.role)}</div>` : ''}\n            </div>\n            <button type=\"button\" class=\"btn-change-assignment\" id=\"decision-modal-change-owner-btn\">\n              <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n              Change\n            </button>\n          </div>`;\n      } else {\n        madeByDisplay.innerHTML = `\n          <div class=\"no-assignment\">\n            <span>No owner</span>\n            <button type=\"button\" class=\"btn-assign-now\" id=\"decision-modal-choose-owner-btn\">Choose</button>\n          </div>`;\n      }\n      const changeBtn = madeByDisplay.querySelector('#decision-modal-change-owner-btn');\n      const chooseBtn = madeByDisplay.querySelector('#decision-modal-choose-owner-btn');\n      if (changeBtn) on(changeBtn as HTMLElement, 'click', showModalPicker);\n      if (chooseBtn) on(chooseBtn as HTMLElement, 'click', showModalPicker);\n    }\n\n    function showModalPicker() {\n      if (!modalPicker) return;\n      const wasHidden = modalPicker.classList.contains('hidden');\n      modalPicker.classList.toggle('hidden', !wasHidden);\n      if (wasHidden && modalContacts.length === 0) {\n        contactsService.getAll().then((res) => {\n          modalContacts = res?.contacts || [];\n          renderModalContactGrid(modalContactSearch?.value || '');\n        }).catch(() => {\n          if (modalContactList) modalContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n        });\n      } else if (wasHidden) {\n        renderModalContactGrid(modalContactSearch?.value || '');\n      }\n      if (modalContactSearch) modalContactSearch.focus();\n    }\n\n    function renderModalContactGrid(filter: string) {\n      if (!modalContactList) return;\n      const list = filter\n        ? modalContacts.filter(\n            (c) =>\n              (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n              (c.role || '').toLowerCase().includes(filter.toLowerCase())\n          )\n        : modalContacts;\n      if (modalContacts.length === 0) {\n        modalContactList.innerHTML = '<div class=\"empty-state\">Loading...</div>';\n        return;\n      }\n      if (list.length === 0) {\n        modalContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n        return;\n      }\n      const currentMadeBy = (madeByInput?.value || '').trim();\n      modalContactList.innerHTML = list\n        .map((c) => {\n          const photoUrl = getContactPhotoUrl(c);\n          const isCurrent = currentMadeBy === (c.name || '').trim();\n          return `\n            <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n              <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n              <div class=\"contact-info-picker\">\n                <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n                ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n              </div>\n            </div>`;\n        })\n        .join('');\n      modalContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\n        on(card as HTMLElement, 'click', () => {\n          const name = card.getAttribute('data-contact-name') || '';\n          if (name) {\n            renderMadeByDisplay(name);\n            if (modalPicker) modalPicker.classList.add('hidden');\n          }\n        });\n      });\n    }\n\n    contactsService.getAll().then((res) => {\n      modalContacts = res?.contacts || [];\n      renderMadeByDisplay(decision?.madeBy || '');\n    }).catch(() => {\n      renderMadeByDisplay(decision?.madeBy || '');\n    });\n\n    if (modalContactSearch) {\n      modalContactSearch.addEventListener('input', () => renderModalContactGrid(modalContactSearch.value));\n    }\n  }\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  if (isView && decision) {\n    // Quick status change buttons for proposed decisions\n    if (decision.status === 'proposed') {\n      const approveBtn = createElement('button', {\n        className: 'btn btn-success',\n        textContent: 'Approve',\n      });\n\n      const rejectBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Reject',\n      });\n\n      on(approveBtn, 'click', () => updateStatus(String(decision.id), 'approved', onSave));\n      on(rejectBtn, 'click', () => updateStatus(String(decision.id), 'rejected', onSave));\n\n      footer.appendChild(rejectBtn);\n      footer.appendChild(approveBtn);\n    }\n\n    const editBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: 'Edit',\n    });\n\n    const closeBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Close',\n    });\n\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\n    on(editBtn, 'click', () => {\n      closeModal(MODAL_ID);\n      showDecisionModal({ ...props, mode: 'edit' });\n    });\n\n    footer.appendChild(closeBtn);\n    footer.appendChild(editBtn);\n  } else {\n    const cancelBtn = createElement('button', {\n      className: 'btn btn-secondary',\n      textContent: 'Cancel',\n    });\n\n    const saveBtn = createElement('button', {\n      className: 'btn btn-primary',\n      textContent: isEdit ? 'Save Changes' : 'Create Decision',\n    });\n\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n    on(saveBtn, 'click', async () => {\n      const form = content.querySelector('#decision-form') as HTMLFormElement;\n      if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n\n      const getValue = (id: string) => (content.querySelector(`#${id}`) as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement)?.value.trim() || '';\n\n      const decisionData: Decision & { impact?: string; summary?: string } = {\n        id: decision?.id || `dec-${Date.now()}`,\n        decision: getValue('decision-text'),\n        rationale: getValue('decision-rationale') || undefined,\n        status: getValue('decision-status') as Decision['status'],\n        madeBy: getValue('decision-by') || undefined,\n        madeAt: decision?.madeAt || new Date().toISOString(),\n        impact: getValue('decision-impact') as 'low' | 'medium' | 'high' || undefined,\n        summary: getValue('decision-summary') || undefined,\n      };\n\n      saveBtn.disabled = true;\n      saveBtn.textContent = 'Saving...';\n\n      const apiPayload = {\n        content: decisionData.decision,\n        decision: decisionData.decision,\n        rationale: decisionData.rationale,\n        status: decisionData.status,\n        made_by: decisionData.madeBy,\n        impact: decisionData.impact,\n        summary: decisionData.summary,\n      };\n      try {\n        if (isEdit) {\n          await http.put(`/api/decisions/${decision!.id}`, apiPayload);\n          toast.success('Decision updated');\n        } else {\n          const response = await http.post<{ id: string }>('/api/decisions', apiPayload);\n          decisionData.id = response.data.id;\n          toast.success('Decision recorded');\n        }\n\n        onSave?.(decisionData);\n        closeModal(MODAL_ID);\n      } catch {\n        // Error shown by API service\n      } finally {\n        saveBtn.disabled = false;\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Decision';\n      }\n    });\n\n    if (isEdit) {\n      const deleteBtn = createElement('button', {\n        className: 'btn btn-danger',\n        textContent: 'Delete',\n      });\n\n      on(deleteBtn, 'click', async () => {\n        const { confirm } = await import('../Modal');\n        const confirmed = await confirm(\n          'Are you sure you want to delete this decision?',\n          {\n            title: 'Delete Decision',\n            confirmText: 'Delete',\n            confirmClass: 'btn-danger',\n          }\n        );\n\n        if (confirmed) {\n          try {\n            await http.delete(`/api/decisions/${decision!.id}`);\n            toast.success('Decision deleted');\n            onDelete?.(String(decision!.id));\n            closeModal(MODAL_ID);\n          } catch {\n            // Error shown by API service\n          }\n        }\n      });\n\n      footer.appendChild(deleteBtn);\n    }\n\n    footer.appendChild(cancelBtn);\n    footer.appendChild(saveBtn);\n  }\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: isView ? 'Decision Details' : (isEdit ? 'Edit Decision' : 'Record Decision'),\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n}\n\n/**\n * Update decision status\n */\nasync function updateStatus(\n  decisionId: string,\n  status: Decision['status'],\n  onSave?: (decision: Decision) => void\n): Promise<void> {\n  try {\n    await http.patch(`/api/decisions/${decisionId}`, { status });\n    toast.success(`Decision ${status}`);\n    closeModal(MODAL_ID);\n    // Note: In a real app, we'd update the local state here\n  } catch {\n    // Error shown by API service\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showDecisionModal;\n","/**\n * Decision Detail View\n * Full-page view for decision details: content, status, rationale, owner, source, timeline, similar decisions\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { Decision, decisionsService } from '../../services/decisions';\nimport { actionsService } from '../../services/actions';\nimport { contactsService, Contact } from '../../services/contacts';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\n\nfunction getInitials(name: string): string {\n  return name.trim().split(/\\s+/).map((s) => s[0]).join('').toUpperCase().substring(0, 2);\n}\n\nexport interface DecisionDetailViewProps {\n  decision: Decision;\n  onClose: () => void;\n  onUpdate?: (decision: Decision) => void;\n  onDecisionClick?: (decision: Decision) => void;\n  /** When user clicks an implementing action (optional, e.g. open action detail) */\n  onActionClick?: (action: { id: string | number; task?: string; content?: string; status?: string }) => void;\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nfunction formatDate(iso: string | undefined): string {\n  if (!iso) return '';\n  try {\n    return formatDateTime(iso);\n  } catch {\n    return iso;\n  }\n}\n\nexport function createDecisionDetailView(props: DecisionDetailViewProps): HTMLElement {\n  const { decision, onClose, onUpdate, onDecisionClick, onActionClick } = props;\n\n  const container = createElement('div', { className: 'decision-detail-view question-detail-view' });\n\n  container.innerHTML = `\n    <div class=\"question-detail-header decision-detail-header\">\n      <div class=\"breadcrumb\">\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Decisions</a>\n        <span class=\"breadcrumb-separator\"></span>\n        <span class=\"breadcrumb-current\">Decision #${String(decision.id).substring(0, 8)}</span>\n      </div>\n      <div class=\"header-actions\">\n        <span class=\"status-badge status-${(decision.status || 'active').toLowerCase()}\">${escapeHtml(String(decision.status))}</span>\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\n      </div>\n    </div>\n\n    <div class=\"question-detail-content decision-detail-content\">\n      <div id=\"decision-view-content\">\n      <section class=\"detail-section decision-main\">\n        <div class=\"question-badges decision-badges\">\n          ${decision.impact ? `<span class=\"priority-pill impact-${decision.impact}\">${escapeHtml(decision.impact)} impact</span>` : ''}\n          ${decision.generation_source ? `<span class=\"status-pill\">${escapeHtml(decision.generation_source)}</span>` : ''}\n          <span class=\"question-date decision-date\">Created ${formatRelativeTime(decision.created_at)}</span>\n        </div>\n        <h2 class=\"question-text decision-content-text\" id=\"decision-view-content-text\">${escapeHtml(decision.content)}</h2>\n      </section>\n\n      <div class=\"detail-columns\">\n        <div class=\"detail-column-left\">\n          <section class=\"detail-section\">\n            <div class=\"section-header-sota\">\n              <h3>Rationale / Context</h3>\n              <span class=\"section-subtitle\">Why was this decision made?</span>\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"decision-rationale-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Suggest\n              </button>\n            </div>\n            <div id=\"decision-view-rationale\">${(decision.rationale || decision.context) ? `<p class=\"decision-rationale\">${escapeHtml(decision.rationale || decision.context || '')}</p>` : '<p class=\"text-muted\">No rationale recorded</p>'}</div>\n            <div id=\"decision-suggestions-panel\" class=\"suggestions-panel-sota decision-suggestions-panel hidden gm-mt-2\"></div>\n          </section>\n\n          <section class=\"detail-section\" id=\"decision-owner-section\">\n            <div class=\"section-header-sota\">\n              <h3>\n                <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                </svg>\n                Owner / Made by\n                <span class=\"section-subtitle\">Who made this decision?</span>\n              </h3>\n              <button type=\"button\" class=\"btn-ai-suggest\" id=\"decision-owner-ai-suggest-btn\" title=\"Suggest owner from decision content\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Suggest\n              </button>\n            </div>\n\n            <div id=\"decision-current-owner\" class=\"current-assignment-card\">\n              ${(decision.made_by || decision.owner) ? `\n                <div class=\"assigned-contact-display\">\n                  <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${getInitials(decision.made_by || decision.owner || '')}</div>\n                  <div class=\"contact-details\">\n                    <div class=\"contact-name-lg\">${escapeHtml(decision.made_by || decision.owner || '')}</div>\n                    <div class=\"contact-role-sm\" id=\"decision-owner-role\"></div>\n                  </div>\n                  <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                    <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                    Change\n                  </button>\n                </div>\n              ` : `\n                <div class=\"no-assignment\">\n                  <div class=\"no-assignment-icon\">\n                    <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\n                  </div>\n                  <span>No owner</span>\n                  <p class=\"no-assignment-hint\">Choose from contacts</p>\n                  <button class=\"btn-assign-now\" id=\"decision-show-owner-picker-btn\" type=\"button\">Choose</button>\n                </div>\n              `}\n            </div>\n\n            <div id=\"decision-contact-picker\" class=\"contact-picker-sota hidden\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"decision-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"decision-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n\n            <div id=\"decision-owner-suggestions-panel\" class=\"suggestions-panel-sota decision-owner-suggestions-panel hidden gm-mt-2\"></div>\n\n            ${decision.approved_by ? `<p class=\"text-muted gm-mt-2\">Approved by: ${escapeHtml(decision.approved_by)}</p>` : ''}\n            ${decision.decided_at ? `<p class=\"text-muted\">Decided: ${formatDate(decision.decided_at)}</p>` : ''}\n          </section>\n\n          <section class=\"detail-section\">\n            <div class=\"section-header\">\n              <h3>Source</h3>\n            </div>\n            ${decision.source_file ? `<p class=\"source-file\">${escapeHtml(decision.source_file)}</p>` : ''}\n            ${decision.source_document_id ? `\n              <p class=\"source-doc\">\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(decision.source_document_id))}\">View source document</a>\n              </p>\n            ` : ''}\n            ${!decision.source_file && !decision.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\n          </section>\n        </div>\n\n        <div class=\"detail-column-right\">\n          <section class=\"detail-section metadata-section\">\n            <div class=\"section-header\">\n              <h3>Metadata</h3>\n            </div>\n            <dl class=\"metadata-list\">\n              <dt>Created</dt>\n              <dd>${formatDate(decision.created_at)}</dd>\n              ${decision.updated_at ? `<dt>Updated</dt><dd>${formatDate(decision.updated_at)}</dd>` : ''}\n            </dl>\n          </section>\n\n          <section class=\"detail-section\" id=\"decision-implementing-tasks-section\">\n            <div class=\"section-header\">\n              <h3>Implementing tasks</h3>\n            </div>\n            <div id=\"decision-implementing-tasks-list\" class=\"decision-implementing-tasks-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n\n          <section class=\"detail-section decision-timeline-section\">\n            <div class=\"section-header\">\n              <h3>Timeline</h3>\n            </div>\n            <div id=\"decision-timeline-list\" class=\"decision-timeline-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n\n          <section class=\"detail-section decision-similar-section\">\n            <div class=\"section-header\">\n              <h3>Similar decisions</h3>\n            </div>\n            <div id=\"decision-similar-list\" class=\"decision-similar-list\">\n              <span class=\"text-muted\">Loading</span>\n            </div>\n          </section>\n        </div>\n      </div>\n\n      <div class=\"detail-actions\">\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-decision-btn\">Edit</button>\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-decision-btn\">Delete</button>\n      </div>\n      </div>\n\n      <div id=\"decision-edit-form\" class=\"decision-detail-edit-form hidden\">\n        <form id=\"decision-inline-form\" class=\"decision-form\">\n          <div class=\"form-group\">\n            <label for=\"decision-edit-content\">Decision *</label>\n            <textarea id=\"decision-edit-content\" rows=\"3\" required placeholder=\"What was decided?\">${escapeHtml(decision.content || '')}</textarea>\n          </div>\n          <div class=\"form-group\">\n            <div class=\"gm-flex gm-flex-center gm-justify-between gm-flex-wrap gm-gap-2 gm-mb-2\">\n              <label for=\"decision-edit-rationale\" class=\"gm-mb-0\">Rationale</label>\n              <button type=\"button\" class=\"btn-ai-suggest btn-sm\" id=\"decision-edit-ai-suggest-btn\" title=\"Suggest rationale, impact and summary from decision text\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI suggest\n              </button>\n            </div>\n            <textarea id=\"decision-edit-rationale\" rows=\"2\" placeholder=\"Why was this decision made?\">${escapeHtml(decision.rationale || decision.context || '')}</textarea>\n          </div>\n          <div id=\"decision-edit-suggestions-panel\" class=\"suggestions-panel-sota hidden gm-mb-3\"></div>\n          <div class=\"form-row\">\n            <div class=\"form-group\">\n              <label for=\"decision-edit-impact\">Impact</label>\n              <select id=\"decision-edit-impact\">\n                <option value=\"low\" ${decision.impact === 'low' ? 'selected' : ''}>Low</option>\n                <option value=\"medium\" ${decision.impact === 'medium' || !decision.impact ? 'selected' : ''}>Medium</option>\n                <option value=\"high\" ${decision.impact === 'high' ? 'selected' : ''}>High</option>\n              </select>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"decision-edit-summary\">Summary (one line)</label>\n              <input type=\"text\" id=\"decision-edit-summary\" value=\"${escapeHtml((decision as { summary?: string }).summary || '')}\" placeholder=\"One-line summary for lists/reports\">\n            </div>\n            <div class=\"form-group\">\n              <label for=\"decision-edit-status\">Status</label>\n              <select id=\"decision-edit-status\">\n                <option value=\"proposed\" ${decision.status === 'proposed' || !decision.status ? 'selected' : ''}>Proposed</option>\n                <option value=\"approved\" ${decision.status === 'approved' ? 'selected' : ''}>Approved</option>\n                <option value=\"rejected\" ${decision.status === 'rejected' ? 'selected' : ''}>Rejected</option>\n                <option value=\"deferred\" ${decision.status === 'deferred' ? 'selected' : ''}>Deferred</option>\n                <option value=\"active\" ${decision.status === 'active' ? 'selected' : ''}>Active</option>\n                <option value=\"superseded\" ${decision.status === 'superseded' ? 'selected' : ''}>Superseded</option>\n                <option value=\"revoked\" ${decision.status === 'revoked' ? 'selected' : ''}>Revoked</option>\n              </select>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label>Made by</label>\n            <input type=\"hidden\" id=\"decision-edit-made-by\" value=\"${escapeHtml(decision.made_by || (decision as { owner?: string }).owner || '')}\">\n            <div id=\"decision-edit-owner-display\" class=\"current-assignment-card decision-edit-owner-card\"></div>\n            <div id=\"decision-edit-contact-picker\" class=\"contact-picker-sota hidden gm-mt-2\">\n              <div class=\"picker-search\">\n                <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/></svg>\n                <input type=\"text\" id=\"decision-edit-contact-search\" placeholder=\"Search contacts...\" autocomplete=\"off\">\n              </div>\n              <div id=\"decision-edit-contact-list\" class=\"contact-list-grid\">Loading...</div>\n            </div>\n          </div>\n        </form>\n        <div class=\"detail-actions\">\n          <button type=\"button\" class=\"btn btn-primary\" id=\"decision-save-btn\">Save</button>\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"decision-cancel-edit-btn\">Cancel</button>\n          <button type=\"button\" class=\"btn btn-danger\" id=\"decision-delete-in-edit-btn\">Delete</button>\n        </div>\n      </div>\n    </div>\n  `;\n\n  const backLink = container.querySelector('#back-to-list');\n  if (backLink) {\n    on(backLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      onClose();\n    });\n  }\n  const closeBtn = container.querySelector('#close-detail');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', onClose);\n  }\n\n  const viewContent = container.querySelector('#decision-view-content') as HTMLElement;\n  const editForm = container.querySelector('#decision-edit-form') as HTMLElement;\n\n  const editBtn = container.querySelector('#edit-decision-btn');\n  if (editBtn && viewContent && editForm) {\n    on(editBtn as HTMLElement, 'click', () => {\n      viewContent.classList.add('hidden');\n      editForm.classList.remove('hidden');\n      // Sync edit form owner (in case owner was changed in view)\n      renderEditFormOwnerDisplay(currentOwnerName);\n    });\n  }\n\n  const cancelEditBtn = container.querySelector('#decision-cancel-edit-btn');\n  if (cancelEditBtn && viewContent && editForm) {\n    on(cancelEditBtn as HTMLElement, 'click', () => {\n      editForm.classList.add('hidden');\n      viewContent.classList.remove('hidden');\n    });\n  }\n\n  const saveBtn = container.querySelector('#decision-save-btn');\n  if (saveBtn && editForm && onUpdate) {\n    on(saveBtn as HTMLElement, 'click', async () => {\n      const form = container.querySelector('#decision-inline-form') as HTMLFormElement;\n      if (!form?.checkValidity()) {\n        form.reportValidity();\n        return;\n      }\n      const contentEl = container.querySelector('#decision-edit-content') as HTMLTextAreaElement;\n      const rationaleEl = container.querySelector('#decision-edit-rationale') as HTMLTextAreaElement;\n      const impactEl = container.querySelector('#decision-edit-impact') as HTMLSelectElement;\n      const summaryEl = container.querySelector('#decision-edit-summary') as HTMLInputElement;\n      const statusEl = container.querySelector('#decision-edit-status') as HTMLSelectElement;\n      const madeByEl = container.querySelector('#decision-edit-made-by') as HTMLInputElement;\n      const content = contentEl?.value?.trim() || '';\n      if (!content) {\n        toast.error('Decision text is required');\n        return;\n      }\n      (saveBtn as HTMLButtonElement).disabled = true;\n      (saveBtn as HTMLButtonElement).textContent = 'Saving...';\n      try {\n        const updated = await decisionsService.update(decision.id, {\n          content,\n          rationale: rationaleEl?.value?.trim() || undefined,\n          impact: (impactEl?.value || undefined) as Decision['impact'],\n          summary: (summaryEl?.value?.trim() || undefined) as string | undefined,\n          status: (statusEl?.value || 'active') as Decision['status'],\n          made_by: madeByEl?.value?.trim() || undefined,\n        });\n        toast.success('Decision updated');\n        // Update view DOM from response\n        const viewContentText = container.querySelector('#decision-view-content-text');\n        if (viewContentText) viewContentText.textContent = updated.content || content;\n        const viewRationale = container.querySelector('#decision-view-rationale');\n        if (viewRationale) {\n          viewRationale.innerHTML = (updated.rationale || updated.context)\n            ? `<p class=\"decision-rationale\">${escapeHtml(updated.rationale || updated.context || '')}</p>`\n            : '<p class=\"text-muted\">No rationale recorded</p>';\n        }\n        const statusBadge = container.querySelector('.decision-detail-header .status-badge');\n        if (statusBadge) {\n          statusBadge.textContent = String(updated.status || 'active');\n          statusBadge.className = `status-badge status-${(updated.status || 'active').toLowerCase()}`;\n        }\n        const badges = container.querySelector('.decision-badges');\n        if (badges) {\n          const impactPill = (updated as Decision).impact\n            ? `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span>`\n            : '';\n          const existing = badges.innerHTML;\n          if (impactPill && !existing.includes('impact-')) {\n            badges.insertAdjacentHTML('afterbegin', impactPill + ' ');\n          } else if (impactPill) {\n            const oldPill = badges.querySelector('.priority-pill.impact-');\n            if (oldPill) oldPill.outerHTML = impactPill;\n          }\n        }\n        currentOwnerName = updated.made_by || (updated as { owner?: string }).owner || '';\n        // Refresh owner display in view\n        const currentOwnerEl = container.querySelector('#decision-current-owner');\n        if (currentOwnerEl && currentOwnerName) {\n          const contact = findContactByOwner(currentOwnerName);\n          const photoUrl = getContactPhotoUrl(contact);\n          currentOwnerEl.innerHTML = `\n            <div class=\"assigned-contact-display\">\n              <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(currentOwnerName)}'\">` : getInitials(currentOwnerName)}</div>\n              <div class=\"contact-details\">\n                <div class=\"contact-name-lg\">${escapeHtml(currentOwnerName)}</div>\n                <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\n              </div>\n              <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                Change\n              </button>\n            </div>`;\n          const chBtn = currentOwnerEl.querySelector('#decision-change-owner-btn');\n          if (chBtn) on(chBtn as HTMLElement, 'click', showOwnerPicker);\n        } else if (currentOwnerEl && !currentOwnerName) {\n          currentOwnerEl.innerHTML = `\n            <div class=\"no-assignment\">\n              <div class=\"no-assignment-icon\">\n                <svg width=\"32\" height=\"32\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\"/></svg>\n              </div>\n              <span>No owner</span>\n              <p class=\"no-assignment-hint\">Choose from contacts</p>\n              <button class=\"btn-assign-now\" id=\"decision-show-owner-picker-btn\" type=\"button\">Choose</button>\n            </div>`;\n          const showBtn = currentOwnerEl.querySelector('#decision-show-owner-picker-btn');\n          if (showBtn) on(showBtn as HTMLElement, 'click', showOwnerPicker);\n        }\n        onUpdate(updated);\n        editForm.classList.add('hidden');\n        viewContent.classList.remove('hidden');\n      } catch {\n        toast.error('Failed to save decision');\n      } finally {\n        (saveBtn as HTMLButtonElement).disabled = false;\n        (saveBtn as HTMLButtonElement).textContent = 'Save';\n      }\n    });\n  }\n\n  const deleteInEditBtn = container.querySelector('#decision-delete-in-edit-btn');\n  if (deleteInEditBtn) {\n    on(deleteInEditBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this decision?')) return;\n      try {\n        await decisionsService.delete(decision.id);\n        toast.success('Decision deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete decision');\n      }\n    });\n  }\n\n  const deleteBtn = container.querySelector('#delete-decision-btn');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Are you sure you want to delete this decision?')) return;\n      try {\n        await decisionsService.delete(decision.id);\n        toast.success('Decision deleted');\n        onClose();\n      } catch {\n        toast.error('Failed to delete decision');\n      }\n    });\n  }\n\n  const docLink = container.querySelector('.doc-link');\n  if (docLink && decision.source_document_id) {\n    on(docLink as HTMLElement, 'click', (e) => {\n      e.preventDefault();\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\n        detail: { tab: 'files', documentId: decision.source_document_id }\n      }));\n    });\n  }\n\n  // Owner section: load contacts, show avatar/role, contact picker\n  let viewContacts: Contact[] = [];\n  let currentOwnerName = decision.made_by || (decision as { owner?: string }).owner || '';\n  const ownerPicker = container.querySelector('#decision-contact-picker') as HTMLElement;\n  const ownerList = container.querySelector('#decision-contact-list') as HTMLElement;\n  const ownerSearch = container.querySelector('#decision-contact-search') as HTMLInputElement;\n\n  function getContactPhotoUrl(c: Contact | undefined): string | null {\n    if (!c) return null;\n    const u = c as { photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string };\n    return u.photoUrl || u.avatarUrl || u.photo_url || u.avatar_url || null;\n  }\n\n  function findContactByOwner(name: string): Contact | undefined {\n    if (!name || !viewContacts.length) return undefined;\n    const n = name.trim().toLowerCase();\n    if (!n) return undefined;\n    const byExact = viewContacts.find((c) => (c.name || '').trim().toLowerCase() === n);\n    if (byExact) return byExact;\n    const byPartial = viewContacts.find(\n      (c) =>\n        (c.name || '').trim().toLowerCase().includes(n) ||\n        n.includes((c.name || '').trim().toLowerCase())\n    );\n    if (byPartial) return byPartial;\n    const byAlias = viewContacts.find((c) =>\n      (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\n    );\n    return byAlias || viewContacts.find((c) =>\n      (c.aliases || []).some((a) => {\n        const aLower = String(a).trim().toLowerCase();\n        return aLower.includes(n) || n.includes(aLower);\n      })\n    );\n  }\n\n  const renderOwnerContactGrid = (filter = '') => {\n    if (!ownerList) return;\n    const list = filter\n      ? viewContacts.filter(\n          (c) =>\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n            (c.role || '').toLowerCase().includes(filter.toLowerCase()) ||\n            ((c as { organization?: string }).organization || '').toLowerCase().includes(filter.toLowerCase())\n        )\n      : viewContacts;\n    if (viewContacts.length === 0) {\n      ownerList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n      return;\n    }\n    if (list.length === 0) {\n      ownerList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n      return;\n    }\n    ownerList.innerHTML = list\n      .map((c) => {\n        const photoUrl = getContactPhotoUrl(c);\n        const isCurrent = (currentOwnerName || '').trim() === (c.name || '').trim();\n        return `\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n            <div class=\"contact-info-picker\">\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n            </div>\n          </div>`;\n      })\n      .join('');\n    ownerList.querySelectorAll('.contact-card-picker').forEach((card) => {\n      on(card as HTMLElement, 'click', async () => {\n        const name = card.getAttribute('data-contact-name') || '';\n        if (!name) return;\n        try {\n          const updated = await decisionsService.update(decision.id, { made_by: name });\n          currentOwnerName = name;\n          toast.success(`Owner set to ${name}`);\n          if (ownerPicker) ownerPicker.classList.add('hidden');\n          if (onUpdate) onUpdate({ ...decision, made_by: name, ...updated });\n          // Refresh displayed owner in current-assignment card\n          const currentEl = container.querySelector('#decision-current-owner');\n          if (currentEl) {\n            const contact = findContactByOwner(name);\n            const photoUrl = getContactPhotoUrl(contact);\n            currentEl.innerHTML = `\n              <div class=\"assigned-contact-display\">\n                <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\">` : getInitials(name)}</div>\n                <div class=\"contact-details\">\n                  <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\n                  <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\n                </div>\n                <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                  <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                  Change\n                </button>\n              </div>`;\n            const changeBtn = currentEl.querySelector('#decision-change-owner-btn');\n            if (changeBtn) on(changeBtn as HTMLElement, 'click', showOwnerPicker);\n          }\n        } catch {\n          toast.error('Failed to save owner');\n        }\n      });\n    });\n  };\n\n  const showOwnerPicker = () => {\n    if (!ownerPicker) return;\n    ownerPicker.classList.toggle('hidden');\n    if (!ownerPicker.classList.contains('hidden') && viewContacts.length === 0) {\n      contactsService.getAll().then((res) => {\n        viewContacts = res?.contacts || [];\n        renderOwnerContactGrid(ownerSearch?.value || '');\n      }).catch(() => {\n        if (ownerList) ownerList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n      });\n    } else if (!ownerPicker.classList.contains('hidden')) {\n      renderOwnerContactGrid(ownerSearch?.value || '');\n    }\n    if (ownerSearch) ownerSearch.focus();\n  };\n\n  const changeOwnerBtn = container.querySelector('#decision-change-owner-btn');\n  const showOwnerPickerBtn = container.querySelector('#decision-show-owner-picker-btn');\n  if (changeOwnerBtn && ownerPicker) on(changeOwnerBtn as HTMLElement, 'click', showOwnerPicker);\n  if (showOwnerPickerBtn && ownerPicker) on(showOwnerPickerBtn as HTMLElement, 'click', showOwnerPicker);\n  if (ownerSearch) {\n    ownerSearch.addEventListener('input', () => renderOwnerContactGrid(ownerSearch.value));\n  }\n\n  contactsService.getAll().then((res) => {\n    viewContacts = res?.contacts || [];\n    const contact = findContactByOwner(currentOwnerName);\n    const roleEl = container.querySelector('#decision-owner-role');\n    if (roleEl) roleEl.textContent = contact?.role ?? '';\n    const avatarEl = container.querySelector('#decision-owner-avatar');\n    if (avatarEl && currentOwnerName) {\n      const photoUrl = getContactPhotoUrl(contact);\n      if (photoUrl) {\n        avatarEl.innerHTML = '';\n        const img = document.createElement('img');\n        img.src = photoUrl;\n        img.alt = '';\n        img.onerror = () => { avatarEl.textContent = getInitials(currentOwnerName); };\n        avatarEl.appendChild(img);\n      }\n    }\n  }).catch(() => {});\n\n  // Edit form: owner display and contact picker (reuse viewContacts)\n  const editOwnerDisplay = container.querySelector('#decision-edit-owner-display') as HTMLElement;\n  const editMadeByInput = container.querySelector('#decision-edit-made-by') as HTMLInputElement;\n  const editContactPicker = container.querySelector('#decision-edit-contact-picker') as HTMLElement;\n  const editContactList = container.querySelector('#decision-edit-contact-list') as HTMLElement;\n  const editContactSearch = container.querySelector('#decision-edit-contact-search') as HTMLInputElement;\n\n  function renderEditFormOwnerDisplay(madeBy: string) {\n    if (!editOwnerDisplay || !editMadeByInput) return;\n    editMadeByInput.value = madeBy;\n    if (madeBy) {\n      const contact = findContactByOwner(madeBy);\n      const photoUrl = getContactPhotoUrl(contact);\n      editOwnerDisplay.innerHTML = `\n        <div class=\"assigned-contact-display\">\n          <div class=\"contact-avatar-lg\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(madeBy)}'\">` : getInitials(madeBy)}</div>\n          <div class=\"contact-details\">\n            <div class=\"contact-name-lg\">${escapeHtml(madeBy)}</div>\n            ${contact?.role ? `<div class=\"contact-role-sm\">${escapeHtml(contact.role)}</div>` : ''}\n          </div>\n          <button type=\"button\" class=\"btn-change-assignment\" id=\"decision-edit-change-owner-btn\">\n            <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n            Change\n          </button>\n        </div>`;\n    } else {\n      editOwnerDisplay.innerHTML = `\n        <div class=\"no-assignment\">\n          <span>No owner</span>\n          <button type=\"button\" class=\"btn-assign-now\" id=\"decision-edit-choose-owner-btn\">Choose</button>\n        </div>`;\n    }\n    const chBtn = editOwnerDisplay.querySelector('#decision-edit-change-owner-btn');\n    const chooseBtn = editOwnerDisplay.querySelector('#decision-edit-choose-owner-btn');\n    if (chBtn) on(chBtn as HTMLElement, 'click', showEditOwnerPicker);\n    if (chooseBtn) on(chooseBtn as HTMLElement, 'click', showEditOwnerPicker);\n  }\n\n  function renderEditFormContactGrid(filter = '') {\n    if (!editContactList) return;\n    const list = filter\n      ? viewContacts.filter(\n          (c) =>\n            (c.name || '').toLowerCase().includes(filter.toLowerCase()) ||\n            (c.role || '').toLowerCase().includes(filter.toLowerCase())\n        )\n      : viewContacts;\n    if (viewContacts.length === 0) {\n      editContactList.innerHTML = '<div class=\"empty-state\">Loading contacts...</div>';\n      return;\n    }\n    if (list.length === 0) {\n      editContactList.innerHTML = '<div class=\"empty-state\">No contacts match</div>';\n      return;\n    }\n    const currentMadeBy = (editMadeByInput?.value || '').trim();\n    editContactList.innerHTML = list\n      .map((c) => {\n        const photoUrl = getContactPhotoUrl(c);\n        const isCurrent = currentMadeBy === (c.name || '').trim();\n        return `\n          <div class=\"contact-card-picker ${isCurrent ? 'selected' : ''}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n            <div class=\"contact-avatar-picker\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(c.name || '')}'\">` : getInitials(c.name || '')}</div>\n            <div class=\"contact-info-picker\">\n              <div class=\"contact-name-picker\">${escapeHtml(c.name || '')}</div>\n              ${c.role ? `<div class=\"contact-role-picker\">${escapeHtml(c.role)}</div>` : ''}\n            </div>\n          </div>`;\n      })\n      .join('');\n    editContactList.querySelectorAll('.contact-card-picker').forEach((card) => {\n      on(card as HTMLElement, 'click', () => {\n        const name = card.getAttribute('data-contact-name') || '';\n        if (name) {\n          renderEditFormOwnerDisplay(name);\n          if (editContactPicker) editContactPicker.classList.add('hidden');\n        }\n      });\n    });\n  }\n\n  function showEditOwnerPicker() {\n    if (!editContactPicker) return;\n    editContactPicker.classList.toggle('hidden');\n    if (!editContactPicker.classList.contains('hidden')) {\n      if (viewContacts.length === 0) {\n        contactsService.getAll().then((res) => {\n          viewContacts = res?.contacts || [];\n          renderEditFormContactGrid(editContactSearch?.value || '');\n        }).catch(() => {\n          if (editContactList) editContactList.innerHTML = '<div class=\"empty-state\">Failed to load contacts</div>';\n        });\n      } else {\n        renderEditFormContactGrid(editContactSearch?.value || '');\n      }\n    }\n    if (editContactSearch) editContactSearch.focus();\n  }\n\n  if (editContactSearch) {\n    editContactSearch.addEventListener('input', () => renderEditFormContactGrid(editContactSearch.value));\n  }\n\n  // Initial edit form owner display (when user opens edit, we call renderEditFormOwnerDisplay in edit button handler)\n  renderEditFormOwnerDisplay(decision.made_by || (decision as { owner?: string }).owner || '');\n\n  // AI Suggest (view mode): Owner section  suggest owner from decision content (project contacts only)\n  const ownerAiSuggestBtn = container.querySelector('#decision-owner-ai-suggest-btn');\n  const ownerSuggestionsPanel = container.querySelector('#decision-owner-suggestions-panel') as HTMLElement;\n  if (ownerAiSuggestBtn && ownerSuggestionsPanel) {\n    on(ownerAiSuggestBtn as HTMLElement, 'click', async () => {\n      (ownerAiSuggestBtn as HTMLButtonElement).disabled = true;\n      ownerSuggestionsPanel.classList.remove('hidden');\n      ownerSuggestionsPanel.innerHTML = '<div class=\"loading\">Asking AI</div>';\n      try {\n        if (viewContacts.length === 0) {\n          const res = await contactsService.getAll();\n          viewContacts = res?.contacts || [];\n        }\n        const { suggested_owners } = await decisionsService.suggestOwner(decision.content || '', decision.rationale || decision.context || '');\n        if (!suggested_owners?.length) {\n          ownerSuggestionsPanel.innerHTML = '<div class=\"no-suggestions\">No owner suggestions. <button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>';\n        } else {\n          ownerSuggestionsPanel.innerHTML = `\n            <div class=\"suggestions-header-sota\">\n              <div class=\"ai-badge\">\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg>\n                AI Recommended\n              </div>\n            </div>\n            <div class=\"suggestions-list-sota\">\n              ${suggested_owners.map((s, i) => {\n                const contact = findContactByOwner(s.name);\n                const photoUrl = getContactPhotoUrl(contact);\n                const roleOrReason = contact?.role ?? s.reason ?? '';\n                const score = s.score ?? 0;\n                const scoreColor = score >= 70 ? 'var(--success)' : score >= 50 ? 'var(--warning)' : 'var(--text-muted)';\n                return `\n                <div class=\"suggestion-card-sota decision-owner-card\" data-owner-name=\"${escapeHtml(s.name)}\">\n                  <div class=\"suggestion-rank\">#${i + 1}</div>\n                  <div class=\"suggestion-avatar-sota\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(s.name)}'\">` : getInitials(s.name)}</div>\n                  <div class=\"suggestion-info-sota\">\n                    <div class=\"suggestion-name-sota\">${escapeHtml(s.name)}</div>\n                    ${roleOrReason ? `<div class=\"suggestion-reason-sota\">${escapeHtml(roleOrReason)}</div>` : ''}\n                  </div>\n                  ${score > 0 ? `<div class=\"suggestion-score-sota\" style=\"--score-color: ${scoreColor}\"><div class=\"score-value\">${score}%</div><div class=\"score-label\">Match</div></div>` : ''}\n                  <button type=\"button\" class=\"btn-select-suggestion\">Assign</button>\n                </div>`;\n              }).join('')}\n            </div>\n            <div class=\"suggestions-footer\"><button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>\n          `;\n          ownerSuggestionsPanel.querySelectorAll('.decision-owner-card .btn-select-suggestion').forEach((btn) => {\n            const card = (btn as HTMLElement).closest('.decision-owner-card');\n            const name = card?.getAttribute('data-owner-name') || '';\n            if (!name) return;\n            on(btn as HTMLElement, 'click', async () => {\n              try {\n                const updated = await decisionsService.update(decision.id, { made_by: name });\n                currentOwnerName = name;\n                toast.success(`Owner set to ${name}`);\n                ownerSuggestionsPanel.classList.add('hidden');\n                const currentOwnerEl = container.querySelector('#decision-current-owner');\n                if (currentOwnerEl) {\n                  const contact = findContactByOwner(name);\n                  const photoUrl = getContactPhotoUrl(contact);\n                  currentOwnerEl.innerHTML = `\n                    <div class=\"assigned-contact-display\">\n                      <div class=\"contact-avatar-lg\" id=\"decision-owner-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"\" onerror=\"this.parentElement.innerHTML='${getInitials(name)}'\">` : getInitials(name)}</div>\n                      <div class=\"contact-details\">\n                        <div class=\"contact-name-lg\">${escapeHtml(name)}</div>\n                        <div class=\"contact-role-sm\" id=\"decision-owner-role\">${escapeHtml(contact?.role ?? '')}</div>\n                      </div>\n                      <button class=\"btn-change-assignment\" id=\"decision-change-owner-btn\" type=\"button\">\n                        <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z\"/></svg>\n                        Change\n                      </button>\n                    </div>`;\n                  const chBtn = currentOwnerEl.querySelector('#decision-change-owner-btn');\n                  if (chBtn) on(chBtn as HTMLElement, 'click', showOwnerPicker);\n                }\n                if (onUpdate) onUpdate(updated);\n              } catch {\n                toast.error('Failed to save owner');\n              }\n            });\n          });\n        }\n        const hideBtn = ownerSuggestionsPanel.querySelector('#decision-owner-hide-suggest-btn');\n        if (hideBtn) on(hideBtn as HTMLElement, 'click', () => { ownerSuggestionsPanel.classList.add('hidden'); });\n      } catch {\n        ownerSuggestionsPanel.innerHTML = '<div class=\"error\">AI suggest failed. <button type=\"button\" class=\"btn-link\" id=\"decision-owner-hide-suggest-btn\">Close</button></div>';\n        const h = ownerSuggestionsPanel.querySelector('#decision-owner-hide-suggest-btn');\n        if (h) on(h as HTMLElement, 'click', () => { ownerSuggestionsPanel.classList.add('hidden'); });\n        toast.error('AI suggest failed');\n      } finally {\n        (ownerAiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  // AI Suggest (view mode): Rationale section  fetch suggestion, show panel, Apply updates decision\n  const rationaleAiSuggestBtn = container.querySelector('#decision-rationale-ai-suggest-btn');\n  const suggestionsPanel = container.querySelector('#decision-suggestions-panel') as HTMLElement;\n  if (rationaleAiSuggestBtn && suggestionsPanel) {\n    on(rationaleAiSuggestBtn as HTMLElement, 'click', async () => {\n      (rationaleAiSuggestBtn as HTMLButtonElement).disabled = true;\n      suggestionsPanel.classList.remove('hidden');\n      suggestionsPanel.innerHTML = '<div class=\"loading\">Asking AI</div>';\n      try {\n        const result = await decisionsService.suggest(decision.content || '', decision.rationale || decision.context || '');\n        suggestionsPanel.innerHTML = `\n          <div class=\"suggestion-card\">\n            <p><strong>Rationale:</strong> ${escapeHtml((result.rationale || '').substring(0, 300))}${(result.rationale || '').length > 300 ? '' : ''}</p>\n            <p><strong>Impact:</strong> ${escapeHtml(result.impact || '')} ${result.impact_summary ? ` ${escapeHtml(result.impact_summary)}` : ''}</p>\n            <p><strong>Summary:</strong> ${escapeHtml(result.summary || '')}</p>\n            <button type=\"button\" class=\"btn btn-primary btn-sm\" id=\"decision-apply-suggestion-btn\">Apply</button>\n          </div>`;\n        const applyBtn = suggestionsPanel.querySelector('#decision-apply-suggestion-btn');\n        if (applyBtn) {\n          on(applyBtn as HTMLElement, 'click', async () => {\n            try {\n              const updated = await decisionsService.update(decision.id, {\n                rationale: result.rationale,\n                impact: result.impact,\n                summary: result.summary,\n              });\n              toast.success('Suggestion applied');\n              const viewRationale = container.querySelector('#decision-view-rationale');\n              if (viewRationale) {\n                viewRationale.innerHTML = (updated.rationale || updated.context)\n                  ? `<p class=\"decision-rationale\">${escapeHtml(updated.rationale || updated.context || '')}</p>`\n                  : '<p class=\"text-muted\">No rationale recorded</p>';\n              }\n              const badges = container.querySelector('.decision-badges');\n              if (badges && (updated as Decision).impact) {\n                const impactPill = badges.querySelector('.priority-pill.impact-low, .priority-pill.impact-medium, .priority-pill.impact-high');\n                if (impactPill) impactPill.outerHTML = `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span>`;\n                else badges.insertAdjacentHTML('afterbegin', `<span class=\"priority-pill impact-${(updated as Decision).impact}\">${escapeHtml((updated as Decision).impact || '')} impact</span> `);\n              }\n              if (onUpdate) onUpdate(updated);\n              suggestionsPanel.classList.add('hidden');\n            } catch {\n              toast.error('Failed to apply');\n            }\n          });\n        }\n      } catch {\n        suggestionsPanel.innerHTML = '<div class=\"error\">AI suggest failed</div>';\n        toast.error('AI suggest failed');\n      } finally {\n        (rationaleAiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  // AI Suggest (edit form): fill rationale, impact, summary\n  const editAiSuggestBtn = container.querySelector('#decision-edit-ai-suggest-btn');\n  const editSuggestionsPanel = container.querySelector('#decision-edit-suggestions-panel') as HTMLElement;\n  if (editAiSuggestBtn) {\n    on(editAiSuggestBtn as HTMLElement, 'click', async () => {\n      const contentEl = container.querySelector('#decision-edit-content') as HTMLTextAreaElement;\n      const rationaleEl = container.querySelector('#decision-edit-rationale') as HTMLTextAreaElement;\n      const impactEl = container.querySelector('#decision-edit-impact') as HTMLSelectElement;\n      const summaryEl = container.querySelector('#decision-edit-summary') as HTMLInputElement;\n      const content = contentEl?.value?.trim() || '';\n      if (!content) {\n        toast.warning('Enter decision text first');\n        return;\n      }\n      (editAiSuggestBtn as HTMLButtonElement).disabled = true;\n      if (editSuggestionsPanel) {\n        editSuggestionsPanel.classList.remove('hidden');\n        editSuggestionsPanel.innerHTML = '<span class=\"text-muted\">Asking AI</span>';\n      }\n      try {\n        const result = await decisionsService.suggest(content, rationaleEl?.value?.trim() || '');\n        if (rationaleEl) rationaleEl.value = result.rationale || '';\n        if (impactEl) impactEl.value = result.impact || 'medium';\n        if (summaryEl) summaryEl.value = result.summary || '';\n        if (editSuggestionsPanel) {\n          editSuggestionsPanel.classList.add('hidden');\n          editSuggestionsPanel.innerHTML = '';\n        }\n        toast.success('Suggestion applied');\n      } catch {\n        if (editSuggestionsPanel) {\n          editSuggestionsPanel.innerHTML = '<span class=\"error\">AI suggest failed</span>';\n        }\n        toast.error('AI suggest failed');\n      } finally {\n        (editAiSuggestBtn as HTMLButtonElement).disabled = false;\n      }\n    });\n  }\n\n  const timelineEl = container.querySelector('#decision-timeline-list');\n  if (timelineEl) {\n    decisionsService.getEvents(decision.id).then((events) => {\n      const labels: Record<string, string> = {\n        created: 'Created',\n        updated: 'Updated',\n        conflict_detected: 'Conflict detected',\n        deleted: 'Deleted',\n        restored: 'Restored',\n      };\n      const actorLabel = (ev: { actor_name?: string; event_data?: { trigger?: string } }) =>\n        ev.actor_name || (ev.event_data?.trigger === 'decision_check_flow' ? 'System' : null);\n      if (events.length === 0) {\n        (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No events yet</span>';\n        return;\n      }\n      (timelineEl as HTMLElement).innerHTML = events\n        .map((ev) => {\n          const actor = actorLabel(ev);\n          return `<div class=\"decision-timeline-item decision-event-${escapeHtml(ev.event_type)}\">\n            <span class=\"decision-event-type\">${escapeHtml(labels[ev.event_type] || ev.event_type)}</span>\n            ${actor ? `<span class=\"decision-event-actor\">${escapeHtml(actor)}</span>` : ''}\n            <span class=\"decision-event-date\">${formatRelativeTime(ev.created_at)}</span>\n          </div>`;\n        })\n        .join('');\n    }).catch(() => {\n      (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load timeline</span>';\n    });\n  }\n\n  const similarEl = container.querySelector('#decision-similar-list');\n  if (similarEl) {\n    decisionsService.getSimilarDecisions(decision.id, 10).then((similar) => {\n      if (similar.length === 0) {\n        (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No similar decisions</span>';\n        return;\n      }\n      (similarEl as HTMLElement).innerHTML = similar\n        .map((s) => `\n          <div class=\"decision-similar-item\" data-decision-id=\"${s.decision.id}\" role=\"${onDecisionClick ? 'button' : 'none'}\">\n            <span class=\"decision-similar-score\">${Math.round(s.similarityScore * 100)}%</span>\n            <span class=\"decision-similar-content\">${escapeHtml((s.decision.content || '').substring(0, 80))}${(s.decision.content || '').length > 80 ? '' : ''}</span>\n          </div>\n        `)\n        .join('');\n      if (onDecisionClick) {\n        (similarEl as HTMLElement).querySelectorAll('.decision-similar-item').forEach((el) => {\n          on(el as HTMLElement, 'click', () => {\n            const item = similar.find((s) => String(s.decision.id) === (el as HTMLElement).getAttribute('data-decision-id'));\n            if (item) onDecisionClick(item.decision);\n          });\n        });\n      }\n    }).catch(() => {\n      (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load similar decisions</span>';\n    });\n  }\n\n  const implementingTasksEl = container.querySelector('#decision-implementing-tasks-list');\n  if (implementingTasksEl) {\n    actionsService.getActions(undefined, undefined, String(decision.id)).then((actions) => {\n      if (actions.length === 0) {\n        (implementingTasksEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No tasks linked to this decision</span>';\n        return;\n      }\n      (implementingTasksEl as HTMLElement).innerHTML = actions\n        .map((a) => {\n          const title = ((a.content || a.task) || '').toString().trim().substring(0, 60) + (((a.content || a.task) || '').toString().length > 60 ? '' : '');\n          const status = (a.status || 'pending').toLowerCase();\n          return `<div class=\"decision-implementing-task-item\" data-action-id=\"${escapeHtml(String(a.id))}\" role=\"${onActionClick ? 'button' : 'none'}\">\n            <span class=\"status-pill status-${status}\">${escapeHtml(String(a.status || 'pending').replace('_', ' '))}</span>\n            <span class=\"decision-implementing-task-title\">${escapeHtml(title)}</span>\n          </div>`;\n        })\n        .join('');\n      if (onActionClick) {\n        (implementingTasksEl as HTMLElement).querySelectorAll('.decision-implementing-task-item').forEach((el) => {\n          on(el as HTMLElement, 'click', () => {\n            const actionId = (el as HTMLElement).getAttribute('data-action-id');\n            const action = actions.find((a) => String(a.id) === actionId);\n            if (action) onActionClick(action);\n          });\n        });\n      }\n    }).catch(() => {\n      (implementingTasksEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load tasks</span>';\n    });\n  }\n\n  return container;\n}\n","/**\r\n * Decisions Panel Component\r\n * Displays and manages decisions with conflict detection, filters, detail view, and removed section\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { decisionsService, Decision, DecisionConflict } from '../../services/decisions';\r\nimport { dataStore } from '../../stores/data';\r\nimport { showDecisionModal } from '../modals/DecisionModal';\r\nimport { createDecisionDetailView, DecisionDetailViewProps } from '../decisions/DecisionDetailView';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\n/** Build DecisionDetailView props with onDecisionClick so similar-decision clicks open that decision in the same container */\r\nfunction decisionDetailProps(containerEl: HTMLElement, props: DecisionsPanelProps, decision: Decision): DecisionDetailViewProps {\r\n  return {\r\n    decision,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createDecisionsPanel(props));\r\n    },\r\n    onUpdate: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createDecisionsPanel(props));\r\n    },\r\n    onDecisionClick: (clickedDecision) => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createDecisionDetailView(decisionDetailProps(containerEl, props, clickedDecision)));\r\n    },\r\n  };\r\n}\r\n\r\nexport interface DecisionsPanelProps {\r\n  onDecisionClick?: (decision: Decision) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentFilter: string = 'all';\r\nlet currentSearch: string = '';\r\nlet currentView: 'status' | 'source' = 'status';\r\n\r\n/**\r\n * Create decisions panel\r\n */\r\nexport function createDecisionsPanel(props: DecisionsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel decisions-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Decisions</h2>\r\n        <span class=\"panel-count\" id=\"decisions-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"decisions-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"proposed\">Proposed</option>\r\n          <option value=\"approved\">Approved</option>\r\n          <option value=\"rejected\">Rejected</option>\r\n          <option value=\"deferred\">Deferred</option>\r\n          <option value=\"active\">Active</option>\r\n          <option value=\"superseded\">Superseded</option>\r\n          <option value=\"revoked\">Revoked</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"status\">By Status</button>\r\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\r\n        </div>\r\n        <input type=\"search\" id=\"decisions-search\" class=\"search-input\" placeholder=\"Search decisions...\" title=\"Search\">\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"check-conflicts-btn\" title=\"Check for conflicting decisions\">Check Conflicts</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-decision-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"conflicts-container\" class=\"conflicts-container hidden\"></div>\r\n    <div class=\"panel-content\" id=\"decisions-content\">\r\n      <div class=\"loading\">Loading decisions...</div>\r\n    </div>\r\n    <div id=\"removed-decisions-container\" class=\"removed-decisions-container hidden\"></div>\r\n  `;\r\n\r\n  const filterSelect = panel.querySelector('#decisions-filter') as HTMLSelectElement;\r\n  on(filterSelect, 'change', () => {\r\n    currentFilter = filterSelect.value;\r\n    loadDecisions(panel, props);\r\n  });\r\n\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'status' | 'source';\r\n      loadDecisions(panel, props);\r\n    });\r\n  });\r\n\r\n  const searchInput = panel.querySelector('#decisions-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value.trim();\r\n      loadDecisions(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  const checkConflictsBtn = panel.querySelector('#check-conflicts-btn');\r\n  if (checkConflictsBtn) {\r\n    on(checkConflictsBtn as HTMLElement, 'click', async () => {\r\n      const container = panel.querySelector('#conflicts-container') as HTMLElement;\r\n      await checkConflicts(container, panel, props);\r\n    });\r\n  }\r\n\r\n  const addBtn = panel.querySelector('#add-decision-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showDecisionModal({\r\n        mode: 'create',\r\n        onSave: () => {\r\n          loadDecisions(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  loadDecisions(panel, props);\r\n  refreshRemovedSection(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\nasync function checkConflicts(container: HTMLElement, panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\r\n  container.classList.remove('hidden');\r\n  container.innerHTML = '<div class=\"loading\">Checking for conflicts...</div>';\r\n  try {\r\n    const result = await decisionsService.runDecisionCheck();\r\n    const conflicts = result.conflicts || [];\r\n    if (conflicts.length === 0) {\r\n      container.innerHTML = `\r\n        <div class=\"no-conflicts\">\r\n          <span class=\"success-icon\"></span>\r\n          <p>No conflicts detected</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n    container.innerHTML = conflicts.map((c: DecisionConflict) => createConflictCard(c, panel, props)).join('');\r\n    bindConflictCards(container, panel, props);\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to check conflicts</div>';\r\n  }\r\n}\r\n\r\nfunction createConflictCard(c: DecisionConflict, panel: HTMLElement, props: DecisionsPanelProps): string {\r\n  const d1 = c.decision1;\r\n  const d2 = c.decision2;\r\n  const desc = (c.description || c.reason || 'Conflict').substring(0, 200);\r\n  return `\r\n    <div class=\"conflict-card-sota\" data-decision-id1=\"${d1.id}\" data-decision-id2=\"${d2.id}\">\r\n      <div class=\"conflict-card-priority-bar conflict-card-priority-bar-warning\"></div>\r\n      <div class=\"conflict-card-body\">\r\n        <div class=\"conflict-card-header\">\r\n          <span class=\"conflict-type-badge\">Conflict</span>\r\n          <p class=\"conflict-description\">${escapeHtml(desc)}</p>\r\n        </div>\r\n        <div class=\"conflict-pair\">\r\n          <div class=\"conflict-item\">\r\n            <div class=\"conflict-item-content\">${escapeHtml((d1.content || '').substring(0, 120))}${(d1.content || '').length > 120 ? '' : ''}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-keep-btn\" data-keep-id=\"${d1.id}\" data-discard-id=\"${d2.id}\">Keep this</button>\r\n          </div>\r\n          <div class=\"conflict-vs\">vs</div>\r\n          <div class=\"conflict-item\">\r\n            <div class=\"conflict-item-content\">${escapeHtml((d2.content || '').substring(0, 120))}${(d2.content || '').length > 120 ? '' : ''}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-keep-btn\" data-keep-id=\"${d2.id}\" data-discard-id=\"${d1.id}\">Keep this</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction bindConflictCards(container: HTMLElement, panel: HTMLElement, props: DecisionsPanelProps): void {\r\n  container.querySelectorAll('.conflict-keep-btn').forEach((btn) => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const keepId = (btn as HTMLElement).getAttribute('data-keep-id');\r\n      const discardId = (btn as HTMLElement).getAttribute('data-discard-id');\r\n      if (!keepId || !discardId) return;\r\n      try {\r\n        await decisionsService.delete(discardId);\r\n        await decisionsService.runDecisionCheck();\r\n        await decisionsService.update(keepId, { status: 'approved' as const });\r\n        toast.success('Conflict resolved');\r\n        loadDecisions(panel, props);\r\n        await checkConflicts(container, panel, props);\r\n        refreshRemovedSection(panel, props);\r\n      } catch {\r\n        toast.error('Failed to resolve conflict');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nasync function refreshRemovedSection(panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-decisions-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await decisionsService.getDeletedDecisions();\r\n    if (deleted.length === 0) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    container.innerHTML = `\r\n      <div class=\"removed-decisions-section\">\r\n        <div class=\"removed-decisions-header section-header-sota\">\r\n          <h3>Removed decisions</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-decisions-hint\">Restore to undo a conflict resolution; decision will be synced back to the graph.</p>\r\n        <div class=\"removed-decisions-list\">\r\n          ${deleted.map((d) => `\r\n            <div class=\"removed-decision-item\" data-decision-id=\"${d.id}\">\r\n              <div class=\"removed-decision-content\">${escapeHtml(truncate(d.content ?? '', 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach((restoreBtn) => {\r\n      on(restoreBtn as HTMLElement, 'click', async () => {\r\n        const id = (restoreBtn as HTMLElement).closest('.removed-decision-item')?.getAttribute('data-decision-id');\r\n        if (!id) return;\r\n        try {\r\n          await decisionsService.restore(id);\r\n          toast.success('Decision restored');\r\n          loadDecisions(panel, props);\r\n          refreshRemovedSection(panel, props);\r\n        } catch {\r\n          toast.error('Failed to restore decision');\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\nfunction truncate(s: string, len: number): string {\r\n  if (s.length <= len) return s;\r\n  return s.substring(0, len) + '';\r\n}\r\n\r\n/**\r\n * Filter decisions by search (client-side)\r\n */\r\nfunction filterDecisionsBySearch(decisions: Decision[], q: string): Decision[] {\r\n  if (!q) return decisions;\r\n  const lower = q.toLowerCase();\r\n  return decisions.filter(\r\n    d =>\r\n      (d.content || '').toLowerCase().includes(lower) ||\r\n      (d.rationale || '').toLowerCase().includes(lower) ||\r\n      (d.made_by || '').toLowerCase().includes(lower) ||\r\n      (d.source_file || '').toLowerCase().includes(lower)\r\n  );\r\n}\r\n\r\n/**\r\n * Load decisions\r\n */\r\nasync function loadDecisions(panel: HTMLElement, props: DecisionsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#decisions-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const status = currentFilter === 'all' ? undefined : currentFilter;\r\n    const raw = await decisionsService.getAll(status);\r\n    const decisions = filterDecisionsBySearch(raw, currentSearch);\r\n\r\n    if (currentView === 'source') {\r\n      renderDecisionsBySource(content, decisions, props);\r\n    } else {\r\n      renderDecisions(content, decisions, props);\r\n    }\r\n    dataStore.setDecisions(raw as unknown as []);\r\n    updateCount(panel, decisions.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load decisions</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render decisions list (grouped by status when multiple statuses)\r\n */\r\nfunction renderDecisions(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\r\n  if (decisions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No decisions match your search' : 'No decisions found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Decision</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showDecisionModal({ mode: 'create', onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const byStatus: Record<string, Decision[]> = {};\r\n  decisions.forEach(d => {\r\n    const s = (d.status || 'active').toLowerCase();\r\n    if (!byStatus[s]) byStatus[s] = [];\r\n    byStatus[s].push(d);\r\n  });\r\n  const statuses = Object.keys(byStatus);\r\n\r\n  if (statuses.length > 1) {\r\n    container.innerHTML = statuses.map(status => `\r\n      <div class=\"question-group\">\r\n        <div class=\"group-header\">\r\n          <h3>${escapeHtml(status)}</h3>\r\n          <span class=\"group-count\">${byStatus[status].length}</span>\r\n        </div>\r\n        <div class=\"group-items\">\r\n          ${byStatus[status].map(d => createDecisionCard(d, contacts)).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    container.innerHTML = decisions.map(d => createDecisionCard(d, contacts)).join('');\r\n  }\r\n\r\n  bindDecisionCards(container, decisions, props);\r\n}\r\n\r\n/**\r\n * Render decisions grouped by source\r\n */\r\nfunction renderDecisionsBySource(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\r\n  if (decisions.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No decisions match your search' : 'No decisions found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Add Decision</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showDecisionModal({ mode: 'create', onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props) });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  const contacts: ContactLike[] = (dataStore.getState().contacts || []) as ContactLike[];\r\n  const bySource: Record<string, Decision[]> = {};\r\n  decisions.forEach(d => {\r\n    const src = d.source_file || d.source || 'Unknown source';\r\n    if (!bySource[src]) bySource[src] = [];\r\n    bySource[src].push(d);\r\n  });\r\n  container.innerHTML = Object.entries(bySource).map(([source, list]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(source)}</h3>\r\n        <span class=\"group-count\">${list.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${list.map(d => createDecisionCard(d, contacts)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  bindDecisionCards(container, decisions, props);\r\n}\r\n\r\nfunction bindDecisionCards(container: HTMLElement, decisions: Decision[], props: DecisionsPanelProps): void {\r\n  container.querySelectorAll('.decision-card-sota').forEach((card) => {\r\n    on(card as HTMLElement, 'click', (e) => {\r\n      if ((e.target as HTMLElement).closest('.card-actions')) return;\r\n      const id = card.getAttribute('data-id');\r\n      const decision = decisions.find((d) => String(d.id) === id);\r\n      if (!decision) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createDecisionDetailView(decisionDetailProps(containerEl, props, decision)));\r\n      } else if (props.onDecisionClick) {\r\n        props.onDecisionClick(decision);\r\n      } else {\r\n        showDecisionModal({\r\n          mode: 'edit',\r\n          decision: { ...decision, decision: decision.content, madeBy: decision.made_by, madeAt: decision.created_at },\r\n          onSave: () => loadDecisions(container.closest('.decisions-panel') as HTMLElement, props),\r\n        });\r\n      }\r\n    });\r\n\r\n    const approveBtn = card.querySelector('.approve-btn');\r\n    const rejectBtn = card.querySelector('.reject-btn');\r\n    const id = card.getAttribute('data-id');\r\n\r\n    if (approveBtn && id) {\r\n      on(approveBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        try {\r\n          await decisionsService.approve(id, 'Current User');\r\n          loadDecisions(container.closest('.decisions-panel') as HTMLElement, props);\r\n        } catch {\r\n          // no-op\r\n        }\r\n      });\r\n    }\r\n    if (rejectBtn && id) {\r\n      on(rejectBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        try {\r\n          await decisionsService.reject(id);\r\n          loadDecisions(container.closest('.decisions-panel') as HTMLElement, props);\r\n        } catch {\r\n          // no-op\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/** Status bar color (left edge) - align with fact category bar */\r\nconst STATUS_BAR_COLOR: Record<string, string> = {\r\n  proposed: '#f59e0b',\r\n  approved: '#10b981',\r\n  rejected: '#ef4444',\r\n  deferred: '#6b7280',\r\n  active: '#3b82f6',\r\n  superseded: '#8b5cf6',\r\n  revoked: '#6b7280',\r\n};\r\n\r\ntype ContactLike = { name?: string; role?: string; photoUrl?: string; avatarUrl?: string; photo_url?: string; avatar_url?: string; aliases?: string[] };\r\n\r\nfunction findContactByOwner(contacts: ContactLike[], name: string): ContactLike | undefined {\r\n  if (!name || !contacts.length) return undefined;\r\n  const n = name.trim().toLowerCase();\r\n  if (!n) return undefined;\r\n  const byExact = contacts.find((c) => (c.name || '').trim().toLowerCase() === n);\r\n  if (byExact) return byExact;\r\n  const byPartial = contacts.find(\r\n    (c) =>\r\n      (c.name || '').trim().toLowerCase().includes(n) ||\r\n      n.includes((c.name || '').trim().toLowerCase())\r\n  );\r\n  if (byPartial) return byPartial;\r\n  const byAlias = contacts.find((c) =>\r\n    (c.aliases || []).some((a) => String(a).trim().toLowerCase() === n)\r\n  );\r\n  return byAlias || contacts.find((c) =>\r\n    (c.aliases || []).some((a) => {\r\n      const aLower = String(a).trim().toLowerCase();\r\n      return aLower.includes(n) || n.includes(aLower);\r\n    })\r\n  );\r\n}\r\n\r\nfunction getContactPhotoUrl(c: ContactLike | undefined): string | null {\r\n  if (!c) return null;\r\n  return c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url || null;\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  if (!name) return '?';\r\n  const parts = name.trim().split(/\\s+/);\r\n  return parts.length === 1 ? parts[0].substring(0, 2).toUpperCase() : (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n}\r\n\r\nfunction createDecisionCard(decision: Decision, contacts: ContactLike[]): string {\r\n  const status = (decision.status || 'active').toLowerCase();\r\n  const statusClass = status.replace(/\\s+/g, '-');\r\n  const barColor = STATUS_BAR_COLOR[status] ?? STATUS_BAR_COLOR.active;\r\n  const content = decision.content || '';\r\n  const source = decision.source_file || decision.source || '';\r\n  const owner = decision.made_by || (decision as { owner?: string }).owner || '';\r\n  const contact = owner ? findContactByOwner(contacts, owner) : undefined;\r\n  const photoUrl = getContactPhotoUrl(contact);\r\n  const ownerChipHtml = owner\r\n    ? `\r\n        <div class=\"assignee-chip\">\r\n          <div class=\"assignee-avatar\">${photoUrl ? `<img src=\"${escapeHtml(photoUrl)}\" alt=\"${escapeHtml(owner)}\" onerror=\"this.parentElement.innerHTML='${getInitials(owner)}'\">` : getInitials(owner)}</div>\r\n          <div class=\"assignee-info\">\r\n            <span class=\"assignee-name\">${escapeHtml(owner)}</span>\r\n            ${contact?.role ? `<span class=\"assignee-role\">${escapeHtml(contact.role)}</span>` : ''}\r\n          </div>\r\n        </div>\r\n      `\r\n    : '<span class=\"card-owner-placeholder text-muted\">No owner</span>';\r\n  const sourceChip = source ? `<span class=\"card-source-chip\">${escapeHtml(source.substring(0, 40))}${source.length > 40 ? '' : ''}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>';\r\n\r\n  return `\r\n    <div class=\"decision-card-sota question-card-sota\" data-id=\"${decision.id}\" style=\"--decision-status-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar decision-status-bar\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"priority-pill status-${statusClass}\">${escapeHtml(String(decision.status))}</span>\r\n            ${decision.impact ? `<span class=\"status-pill\">${escapeHtml(decision.impact)} impact</span>` : ''}\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(decision.decided_at || decision.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(content)}</div>\r\n        ${(decision as any).summary ? `<div class=\"card-summary text-muted\">${escapeHtml((decision as any).summary)}</div>` : ''}\r\n        ${decision.rationale ? `<div class=\"card-rationale text-muted\">${escapeHtml((decision.rationale || '').substring(0, 100))}${(decision.rationale || '').length > 100 ? '' : ''}</div>` : ''}\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${sourceChip}\r\n            ${ownerChipHtml}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            ${decision.status === 'proposed' || decision.status === 'active'\r\n              ? `<span class=\"card-actions\"><button type=\"button\" class=\"btn btn-sm btn-success approve-btn\">Approve</button><button type=\"button\" class=\"btn btn-sm btn-danger reject-btn\">Reject</button></span>`\r\n              : '<button type=\"button\" class=\"btn-link decision-view-link\">View</button>'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#decisions-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createDecisionsPanel;\r\n","/**\r\n * Fact Detail View\r\n * Full-page view for fact details: content, category, confidence, source, verified, document link\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Fact, factsService } from '../../services/facts';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime, formatDateTime } from '../../utils/format';\r\n\r\nexport interface FactDetailViewProps {\r\n  fact: Fact;\r\n  onClose: () => void;\r\n  onUpdate?: (fact: Fact) => void;\r\n  /** When user clicks a similar fact, open that fact (e.g. replace view) */\r\n  onFactClick?: (fact: Fact) => void;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatDate(iso: string | undefined): string {\r\n  if (!iso) return '';\r\n  try {\r\n    return formatDateTime(iso);\r\n  } catch {\r\n    return iso;\r\n  }\r\n}\r\n\r\n/**\r\n * Create and show the fact detail view\r\n */\r\nexport function createFactDetailView(props: FactDetailViewProps): HTMLElement {\r\n  const { fact, onClose, onUpdate, onFactClick } = props;\r\n\r\n  const container = createElement('div', { className: 'fact-detail-view question-detail-view' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"question-detail-header fact-detail-header\">\r\n      <div class=\"breadcrumb\">\r\n        <a href=\"#\" class=\"breadcrumb-link\" id=\"back-to-list\">Facts</a>\r\n        <span class=\"breadcrumb-separator\"></span>\r\n        <span class=\"breadcrumb-current\">Fact #${String(fact.id).substring(0, 8)}</span>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        ${fact.verified ? '<span class=\"verified-badge detail sla-badge\"> Verified</span>' : ''}\r\n        <button class=\"btn btn-icon\" id=\"close-detail\" title=\"Close\"></button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"question-detail-content fact-detail-content\">\r\n      <section class=\"detail-section question-main fact-main\">\r\n        <div class=\"question-badges fact-badges\">\r\n          ${fact.category ? `<span class=\"priority-pill category-${(fact.category || 'general').toLowerCase().replace(/\\s+/g, '-')}\">${escapeHtml(fact.category)}</span>` : ''}\r\n          ${fact.confidence != null ? `<span class=\"status-pill status-pending\">${Math.round((fact.confidence ?? 0) * 100)}%</span>` : ''}\r\n          ${fact.verified ? '<span class=\"auto-pill\"> Verified</span>' : ''}\r\n          <span class=\"question-date fact-date\">Created ${formatRelativeTime(fact.created_at)}</span>\r\n        </div>\r\n        <h2 class=\"question-text fact-content-text\">${escapeHtml(fact.content)}</h2>\r\n      </section>\r\n\r\n      <div class=\"detail-columns\">\r\n        <div class=\"detail-column-left\">\r\n          <section class=\"detail-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Source</h3>\r\n            </div>\r\n            ${fact.source_file ? `<p class=\"source-file\">${escapeHtml(fact.source_file)}</p>` : ''}\r\n            ${fact.source ? `<p class=\"source-ref\">${escapeHtml(fact.source)}</p>` : ''}\r\n            ${fact.source_document_id ? `\r\n              <p class=\"source-doc\">\r\n                <a href=\"#\" class=\"doc-link\" data-document-id=\"${escapeHtml(String(fact.source_document_id))}\">View source document</a>\r\n              </p>\r\n            ` : ''}\r\n            ${!fact.source && !fact.source_file && !fact.source_document_id ? '<p class=\"text-muted\">No source recorded</p>' : ''}\r\n          </section>\r\n\r\n          <section class=\"detail-section verification-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Verification</h3>\r\n            </div>\r\n            ${fact.verified\r\n              ? `\r\n              <div class=\"verified-info\">\r\n                <span class=\"verified-badge auto-pill\"> Verified</span>\r\n                ${fact.verified_at ? `<span class=\"text-muted\">on ${formatDate(fact.verified_at)}</span>` : ''}\r\n              </div>\r\n            `\r\n              : `\r\n              <div class=\"unverified-info\">\r\n                <p class=\"text-muted\">This fact has not been verified.</p>\r\n                <button type=\"button\" class=\"btn btn-success btn-sm\" id=\"verify-fact-btn\">Verify</button>\r\n              </div>\r\n            `}\r\n          </section>\r\n        </div>\r\n\r\n        <div class=\"detail-column-right\">\r\n          <section class=\"detail-section metadata-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Metadata</h3>\r\n            </div>\r\n            <dl class=\"metadata-list\">\r\n              <dt>Created</dt>\r\n              <dd>${formatDate(fact.created_at)}</dd>\r\n              ${fact.updated_at ? `<dt>Updated</dt><dd>${formatDate(fact.updated_at)}</dd>` : ''}\r\n            </dl>\r\n          </section>\r\n\r\n          <section class=\"detail-section fact-timeline-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Timeline</h3>\r\n            </div>\r\n            <div id=\"fact-timeline-list\" class=\"fact-timeline-list\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n\r\n          <section class=\"detail-section fact-similar-section\">\r\n            <div class=\"section-header\">\r\n              <h3>Similar facts</h3>\r\n            </div>\r\n            <div id=\"fact-similar-list\" class=\"fact-similar-list\">\r\n              <span class=\"text-muted\">Loading</span>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"detail-actions\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-fact-btn\">Edit</button>\r\n        ${!fact.verified ? '<button type=\"button\" class=\"btn btn-success\" id=\"verify-btn\">Verify</button>' : ''}\r\n        <button type=\"button\" class=\"btn btn-danger\" id=\"delete-fact-btn\">Delete</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Back / Close\r\n  const backLink = container.querySelector('#back-to-list');\r\n  if (backLink) {\r\n    on(backLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      onClose();\r\n    });\r\n  }\r\n  const closeBtn = container.querySelector('#close-detail');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', onClose);\r\n  }\r\n\r\n  // Verify (header or section)\r\n  const verifyFactBtn = container.querySelector('#verify-fact-btn');\r\n  if (verifyFactBtn) {\r\n    on(verifyFactBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        const updated = await factsService.verify(fact.id);\r\n        toast.success('Fact verified');\r\n        if (onUpdate) onUpdate(updated);\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to verify fact');\r\n      }\r\n    });\r\n  }\r\n  const verifyBtn = container.querySelector('#verify-btn');\r\n  if (verifyBtn) {\r\n    on(verifyBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        const updated = await factsService.verify(fact.id);\r\n        toast.success('Fact verified');\r\n        if (onUpdate) onUpdate(updated);\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to verify fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Edit\r\n  const editBtn = container.querySelector('#edit-fact-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      import('../modals/FactModal').then(({ showFactModal }) => {\r\n        showFactModal({\r\n          mode: 'edit',\r\n          fact,\r\n          onSave: (updated) => {\r\n            if (onUpdate) onUpdate(updated);\r\n            onClose();\r\n          },\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  // Delete\r\n  const deleteBtn = container.querySelector('#delete-fact-btn');\r\n  if (deleteBtn) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this fact?')) return;\r\n      try {\r\n        await factsService.delete(fact.id);\r\n        toast.success('Fact deleted');\r\n        onClose();\r\n      } catch {\r\n        toast.error('Failed to delete fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Document link (navigate to files / document preview if implemented)\r\n  const docLink = container.querySelector('.doc-link');\r\n  if (docLink && fact.source_document_id) {\r\n    on(docLink as HTMLElement, 'click', (e) => {\r\n      e.preventDefault();\r\n      window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n        detail: { tab: 'files', documentId: fact.source_document_id }\r\n      }));\r\n    });\r\n  }\r\n\r\n  // Load timeline (fact events)\r\n  const timelineEl = container.querySelector('#fact-timeline-list');\r\n  if (timelineEl) {\r\n    factsService.getEvents(fact.id).then((events) => {\r\n      const labels: Record<string, string> = {\r\n        created: 'Created',\r\n        verified: 'Verified',\r\n        updated: 'Updated',\r\n        conflict_detected: 'Conflict detected',\r\n        deleted: 'Deleted',\r\n        restored: 'Restored',\r\n      };\r\n      const actorLabel = (ev: { actor_name?: string; event_data?: { trigger?: string } }) =>\r\n        ev.actor_name || (ev.event_data?.trigger === 'fact_check_flow' ? 'System' : null);\r\n      if (events.length === 0) {\r\n        (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No events yet</span>';\r\n        return;\r\n      }\r\n      (timelineEl as HTMLElement).innerHTML = events\r\n        .map(\r\n          (ev) => {\r\n            const actor = actorLabel(ev);\r\n            return `<div class=\"fact-timeline-item fact-event-${escapeHtml(ev.event_type)}\">\r\n              <span class=\"fact-event-type\">${escapeHtml(labels[ev.event_type] || ev.event_type)}</span>\r\n              ${actor ? `<span class=\"fact-event-actor\">${escapeHtml(actor)}</span>` : ''}\r\n              <span class=\"fact-event-date\">${formatRelativeTime(ev.created_at)}</span>\r\n            </div>`;\r\n          }\r\n        )\r\n        .join('');\r\n    }).catch(() => {\r\n      (timelineEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load timeline</span>';\r\n    });\r\n  }\r\n\r\n  // Load similar facts\r\n  const similarEl = container.querySelector('#fact-similar-list');\r\n  if (similarEl) {\r\n    factsService.getSimilarFacts(fact.id, 10).then((similar) => {\r\n      if (similar.length === 0) {\r\n        (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">No similar facts</span>';\r\n        return;\r\n      }\r\n      (similarEl as HTMLElement).innerHTML = similar\r\n        .map(\r\n          (s) => `\r\n            <div class=\"fact-similar-item\" data-fact-id=\"${s.fact.id}\" role=\"${onFactClick ? 'button' : 'none'}\">\r\n              <span class=\"fact-similar-score\">${Math.round(s.similarityScore * 100)}%</span>\r\n              <span class=\"fact-similar-content\">${escapeHtml((s.fact.content || '').substring(0, 80))}${(s.fact.content || '').length > 80 ? '' : ''}</span>\r\n            </div>\r\n          `\r\n        )\r\n        .join('');\r\n      if (onFactClick) {\r\n        (similarEl as HTMLElement).querySelectorAll('.fact-similar-item').forEach((el) => {\r\n          on(el as HTMLElement, 'click', () => {\r\n            const item = similar.find((s) => String(s.fact.id) === (el as HTMLElement).getAttribute('data-fact-id'));\r\n            if (item) onFactClick(item.fact);\r\n          });\r\n        });\r\n      }\r\n    }).catch(() => {\r\n      (similarEl as HTMLElement).innerHTML = '<span class=\"text-muted\">Could not load similar facts</span>';\r\n    });\r\n  }\r\n\r\n  return container;\r\n}\r\n","/**\r\n * Facts Panel Component\r\n * Displays and manages facts with conflict detection, filters, and detail view\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { factsService, Fact, FactConflict } from '../../services/facts';\r\nimport { createFactDetailView, FactDetailViewProps } from '../facts/FactDetailView';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst CATEGORIES = ['technical', 'process', 'policy', 'people', 'timeline', 'general'] as const;\r\n\r\n/** Build FactDetailView props with onFactClick so similar-fact clicks open that fact in the same container */\r\nfunction factDetailProps(containerEl: HTMLElement, props: FactsPanelProps, fact: Fact): FactDetailViewProps {\r\n  return {\r\n    fact,\r\n    onClose: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createFactsPanel(props));\r\n    },\r\n    onUpdate: () => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createFactsPanel(props));\r\n    },\r\n    onFactClick: (clickedFact) => {\r\n      containerEl.innerHTML = '';\r\n      containerEl.appendChild(createFactDetailView(factDetailProps(containerEl, props, clickedFact)));\r\n    },\r\n  };\r\n}\r\n\r\nexport interface FactsPanelProps {\r\n  onFactClick?: (fact: Fact) => void;\r\n  useDetailView?: boolean;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\nlet currentSearch: string = '';\r\nlet currentFilter: string = 'all';\r\nlet currentView: 'category' | 'source' = 'category';\r\nlet showConflicts: boolean = false;\r\n\r\n/**\r\n * Create facts panel\r\n */\r\nexport function createFactsPanel(props: FactsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'sot-panel facts-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Facts</h2>\r\n        <span class=\"panel-count\" id=\"facts-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"facts-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"verified\"> Verified</option>\r\n          <option value=\"unverified\">Unverified</option>\r\n          <option value=\"technical\">Technical</option>\r\n          <option value=\"process\">Process</option>\r\n          <option value=\"policy\">Policy</option>\r\n          <option value=\"people\">People</option>\r\n          <option value=\"timeline\">Timeline</option>\r\n          <option value=\"general\">General</option>\r\n        </select>\r\n        <div class=\"view-tabs\">\r\n          <button class=\"view-tab active\" data-view=\"category\">By Category</button>\r\n          <button class=\"view-tab\" data-view=\"source\">By Source</button>\r\n        </div>\r\n        <input type=\"search\" id=\"facts-search\" class=\"search-input\" placeholder=\"Search facts...\" title=\"Search\">\r\n        <button class=\"btn btn-secondary btn-sm\" id=\"check-conflicts-btn\" title=\"Check for conflicting facts\">Check Conflicts</button>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-fact-btn\">+ Add</button>\r\n      </div>\r\n    </div>\r\n    <div id=\"conflicts-container\" class=\"conflicts-container hidden\"></div>\r\n    <div class=\"panel-content\" id=\"facts-content\">\r\n      <div class=\"loading\">Loading facts...</div>\r\n    </div>\r\n    <div id=\"removed-facts-container\" class=\"removed-facts-container hidden\"></div>\r\n  `;\r\n\r\n  // Filter\r\n  const filterSelect = panel.querySelector('#facts-filter') as HTMLSelectElement;\r\n  if (filterSelect) {\r\n    on(filterSelect, 'change', () => {\r\n      currentFilter = filterSelect.value;\r\n      loadFacts(panel, props);\r\n    });\r\n  }\r\n\r\n  // View tabs\r\n  const viewTabs = panel.querySelectorAll('.view-tab');\r\n  viewTabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      viewTabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      currentView = tab.getAttribute('data-view') as 'category' | 'source';\r\n      loadFacts(panel, props);\r\n    });\r\n  });\r\n\r\n  // Search\r\n  const searchInput = panel.querySelector('#facts-search') as HTMLInputElement;\r\n  let searchTimeout: number;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = window.setTimeout(() => {\r\n      currentSearch = searchInput.value;\r\n      loadFacts(panel, props);\r\n    }, 300);\r\n  });\r\n\r\n  const conflictsBtn = panel.querySelector('#check-conflicts-btn');\r\n  if (conflictsBtn) {\r\n    on(conflictsBtn as HTMLElement, 'click', async () => {\r\n      const container = panel.querySelector('#conflicts-container') as HTMLElement;\r\n      await checkConflicts(container, panel, props);\r\n    });\r\n  }\r\n\r\n  const addBtn = panel.querySelector('#add-fact-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showAddFactModal(panel, props);\r\n    });\r\n  }\r\n\r\n  // Initial load (loadFacts calls refreshRemovedFactsSection at end)\r\n  loadFacts(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load facts\r\n */\r\nasync function loadFacts(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#facts-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const categoryFilter = CATEGORIES.includes(currentFilter as typeof CATEGORIES[number])\r\n      ? currentFilter\r\n      : undefined;\r\n\r\n    const { facts: rawFacts, total } = await factsService.getAll({\r\n      search: currentSearch || undefined,\r\n      limit: 500,\r\n      category: categoryFilter,\r\n    });\r\n\r\n    // Client-side filter for verified/unverified (API may not support these params)\r\n    const facts =\r\n      currentFilter === 'verified' ? rawFacts.filter(f => f.verified) :\r\n      currentFilter === 'unverified' ? rawFacts.filter(f => !f.verified) :\r\n      rawFacts;\r\n\r\n    if (currentView === 'source') {\r\n      renderFactsBySource(content, facts, props);\r\n    } else {\r\n      renderFacts(content, facts, props);\r\n    }\r\n    updateCount(panel, facts.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load facts</div>';\r\n  }\r\n  await refreshRemovedFactsSection(panel, props);\r\n}\r\n\r\n/**\r\n * Load and render the \"Removed facts\" section (for restore / undo). Syncs with graph/FalkorDB on restore.\r\n */\r\nasync function refreshRemovedFactsSection(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  const container = panel.querySelector('#removed-facts-container') as HTMLElement;\r\n  if (!container) return;\r\n  try {\r\n    const deleted = await factsService.getDeletedFacts();\r\n    if (deleted.length === 0) {\r\n      container.classList.add('hidden');\r\n      container.innerHTML = '';\r\n      return;\r\n    }\r\n    container.classList.remove('hidden');\r\n    container.innerHTML = `\r\n      <div class=\"removed-facts-section\">\r\n        <div class=\"removed-facts-header section-header-sota\">\r\n          <h3>Removed facts</h3>\r\n          <span class=\"panel-count removed-count\">${deleted.length}</span>\r\n        </div>\r\n        <p class=\"removed-facts-hint\">Restore to undo a conflict resolution; fact will be synced back to the graph.</p>\r\n        <div class=\"removed-facts-list\">\r\n          ${deleted.map(f => `\r\n            <div class=\"removed-fact-item\" data-fact-id=\"${f.id}\">\r\n              <div class=\"removed-fact-content\">${escapeHtml(truncate(f.content ?? '', 100))}</div>\r\n              <button type=\"button\" class=\"btn btn-sm conflict-resolve-restore\">Restore</button>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    `;\r\n    container.querySelectorAll('.conflict-resolve-restore').forEach(btn => {\r\n      const item = (btn as HTMLElement).closest('.removed-fact-item');\r\n      const id = item?.getAttribute('data-fact-id');\r\n      if (id) {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          try {\r\n            await factsService.restoreFact(id);\r\n            toast.success('Fact restored');\r\n            await loadFacts(panel, props);\r\n            refreshRemovedFactsSection(panel, props);\r\n            const conflictsContainer = panel.querySelector('#conflicts-container') as HTMLElement;\r\n            if (conflictsContainer && !conflictsContainer.classList.contains('hidden')) {\r\n              await checkConflicts(conflictsContainer, panel, props);\r\n            }\r\n          } catch {\r\n            toast.error('Failed to restore fact');\r\n          }\r\n        });\r\n      }\r\n    });\r\n  } catch {\r\n    container.classList.add('hidden');\r\n    container.innerHTML = '';\r\n  }\r\n}\r\n\r\n/**\r\n * Render facts list\r\n */\r\nfunction renderFacts(container: HTMLElement, facts: Fact[], props: FactsPanelProps): void {\r\n  if (facts.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No facts match your search' : 'No facts found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-fact-btn\">Add Fact</button>\r\n      </div>\r\n    `;\r\n    const emptyAddBtn = container.querySelector('#empty-add-fact-btn');\r\n    if (emptyAddBtn) {\r\n      on(emptyAddBtn as HTMLElement, 'click', () => {\r\n        const panel = container.closest('.facts-panel') as HTMLElement;\r\n        if (panel) showAddFactModal(panel, props);\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Group by category (same structure as Questions: question-group, group-header, group-items)\r\n  const factsByCategory: Record<string, Fact[]> = {};\r\n  facts.forEach(fact => {\r\n    const cat = fact.category || 'Uncategorized';\r\n    if (!factsByCategory[cat]) factsByCategory[cat] = [];\r\n    factsByCategory[cat].push(fact);\r\n  });\r\n  const categories = Object.keys(factsByCategory);\r\n\r\n  if (categories.length > 1) {\r\n    container.innerHTML = Object.entries(factsByCategory).map(([category, catFacts]) => `\r\n      <div class=\"question-group\">\r\n        <div class=\"group-header\">\r\n          <h3>${escapeHtml(category)}</h3>\r\n          <span class=\"group-count\">${catFacts.length}</span>\r\n        </div>\r\n        <div class=\"group-items\">\r\n          ${catFacts.map(fact => createFactCard(fact)).join('')}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    container.innerHTML = facts.map(fact => createFactCard(fact)).join('');\r\n  }\r\n\r\n  // Bind click events (cards use .fact-card-sota, same click target)\r\n  container.querySelectorAll('.fact-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const fact = facts.find(f => String(f.id) === id);\r\n      if (!fact) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(createFactDetailView(factDetailProps(containerEl, props, fact)));\r\n      } else if (props.onFactClick) {\r\n        props.onFactClick(fact);\r\n      } else {\r\n        import('../modals/FactModal').then(({ showFactModal }) => {\r\n          showFactModal({ mode: 'view', fact });\r\n        });\r\n      }\r\n    });\r\n\r\n    // Bind verify button\r\n    const verifyBtn = card.querySelector('.fact-verify-btn');\r\n    if (verifyBtn) {\r\n      on(verifyBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (id) {\r\n          try {\r\n            await factsService.verify(id);\r\n            toast.success('Fact verified');\r\n            loadFacts(container.closest('.facts-panel') as HTMLElement, props);\r\n          } catch {\r\n            // Error handled by service\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render facts grouped by source (same group structure as Questions)\r\n */\r\nfunction renderFactsBySource(container: HTMLElement, facts: Fact[], props: FactsPanelProps): void {\r\n  if (facts.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>${currentSearch ? 'No facts match your search' : 'No facts found'}</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-fact-btn\">Add Fact</button>\r\n      </div>\r\n    `;\r\n    const emptyAddBtn = container.querySelector('#empty-add-fact-btn');\r\n    if (emptyAddBtn) {\r\n      on(emptyAddBtn as HTMLElement, 'click', () => {\r\n        const panel = container.closest('.facts-panel') as HTMLElement;\r\n        if (panel) showAddFactModal(panel, props);\r\n      });\r\n    }\r\n    return;\r\n  }\r\n  const bySource: Record<string, Fact[]> = {};\r\n  facts.forEach(fact => {\r\n    const source = fact.source_file || fact.source || 'Unknown source';\r\n    if (!bySource[source]) bySource[source] = [];\r\n    bySource[source].push(fact);\r\n  });\r\n  container.innerHTML = Object.entries(bySource).map(([source, catFacts]) => `\r\n    <div class=\"question-group\">\r\n      <div class=\"group-header\">\r\n        <h3>${escapeHtml(source)}</h3>\r\n        <span class=\"group-count\">${catFacts.length}</span>\r\n      </div>\r\n      <div class=\"group-items\">\r\n        ${catFacts.map(fact => createFactCard(fact)).join('')}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  container.querySelectorAll('.fact-card-sota').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const fact = facts.find(f => String(f.id) === id);\r\n      if (!fact) return;\r\n      if (props.useDetailView && props.containerElement) {\r\n        const containerEl = props.containerElement;\r\n        const detailView = createFactDetailView({\r\n          fact,\r\n          onClose: () => {\r\n            containerEl.innerHTML = '';\r\n            const newPanel = createFactsPanel(props);\r\n            containerEl.appendChild(newPanel);\r\n          },\r\n          onUpdate: () => {\r\n            containerEl.innerHTML = '';\r\n            const newPanel = createFactsPanel(props);\r\n            containerEl.appendChild(newPanel);\r\n          },\r\n        });\r\n        containerEl.innerHTML = '';\r\n        containerEl.appendChild(detailView);\r\n      } else if (props.onFactClick) {\r\n        props.onFactClick(fact);\r\n      } else {\r\n        import('../modals/FactModal').then(({ showFactModal }) => {\r\n          showFactModal({ mode: 'view', fact });\r\n        });\r\n      }\r\n    });\r\n    const verifyBtn = card.querySelector('.fact-verify-btn');\r\n    if (verifyBtn) {\r\n      on(verifyBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (id) {\r\n          try {\r\n            await factsService.verify(id);\r\n            toast.success('Fact verified');\r\n            loadFacts(container.closest('.facts-panel') as HTMLElement, props);\r\n          } catch {\r\n            // Error handled by service\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/** Category bar color (left edge) - align with question priority bar */\r\nconst CATEGORY_BAR_COLOR: Record<string, string> = {\r\n  technical: '#3b82f6',\r\n  process: '#8b5cf6',\r\n  policy: '#ec4899',\r\n  people: '#10b981',\r\n  timeline: '#f59e0b',\r\n  general: '#6b7280',\r\n};\r\n\r\n/**\r\n * Create fact card HTML - SOTA design aligned with question-card-sota\r\n */\r\nfunction createFactCard(fact: Fact): string {\r\n  const category = (fact.category || 'general').toLowerCase();\r\n  const categoryClass = category.replace(/\\s+/g, '-');\r\n  const barColor = CATEGORY_BAR_COLOR[category] || CATEGORY_BAR_COLOR.general;\r\n  const confidencePct = fact.confidence != null ? Math.round(fact.confidence * 100) : null;\r\n\r\n  return `\r\n    <div class=\"fact-card-sota question-card-sota ${fact.verified ? 'has-answer' : ''}\" data-id=\"${fact.id}\" style=\"--fact-category-bar: ${barColor}\">\r\n      <div class=\"card-priority-bar fact-category-bar\"></div>\r\n      <div class=\"card-body\">\r\n        <div class=\"card-top-row\">\r\n          <div class=\"card-badges\">\r\n            <span class=\"priority-pill fact-category-pill category-${categoryClass}\">${escapeHtml(fact.category || 'general')}</span>\r\n            ${confidencePct != null ? `<span class=\"status-pill status-pending\">${confidencePct}%</span>` : ''}\r\n            ${fact.verified ? '<span class=\"auto-pill\"> Verified</span>' : ''}\r\n          </div>\r\n          <span class=\"card-timestamp\">${formatRelativeTime(fact.created_at)}</span>\r\n        </div>\r\n        <div class=\"card-question-text\">${escapeHtml(fact.content)}</div>\r\n        <div class=\"card-bottom-row\">\r\n          <div class=\"card-requester\">\r\n            ${fact.source_file || fact.source ? `<span class=\"card-source-chip\">${escapeHtml((fact.source_file || fact.source || '').substring(0, 40))}${(fact.source_file || fact.source || '').length > 40 ? '' : ''}</span>` : '<span class=\"card-source-chip text-muted\">No source</span>'}\r\n          </div>\r\n          <div class=\"card-assignment\">\r\n            ${fact.verified ? '<span class=\"answered-badge\">Verified</span>' : '<button type=\"button\" class=\"btn-link fact-verify-btn\">Verify</button>'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Check for conflicts\r\n */\r\nasync function checkConflicts(container: HTMLElement, panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  container.classList.remove('hidden');\r\n  container.innerHTML = '<div class=\"loading\">Checking for conflicts...</div>';\r\n\r\n  try {\r\n    const conflicts = await factsService.detectConflicts();\r\n\r\n    if (conflicts.length === 0) {\r\n      container.innerHTML = `\r\n        <div class=\"no-conflicts\">\r\n          <span class=\"success-icon\"></span>\r\n          <p>No conflicts detected</p>\r\n        </div>\r\n      `;\r\n      setTimeout(() => {\r\n        container.classList.add('hidden');\r\n      }, 3000);\r\n    } else {\r\n      renderConflicts(container, conflicts, panel, props);\r\n    }\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to check conflicts</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render conflicts  SOTA-style cards; each card has \"Keep left\" / \"Keep right\" to resolve.\r\n */\r\nfunction renderConflicts(container: HTMLElement, conflicts: FactConflict[], panel: HTMLElement, props: FactsPanelProps): void {\r\n  container.innerHTML = `\r\n    <div class=\"conflicts-section\">\r\n      <div class=\"conflicts-header section-header-sota\">\r\n        <h3>Conflicts Detected</h3>\r\n        <span class=\"conflicts-count panel-count\">${conflicts.length}</span>\r\n        <button type=\"button\" class=\"btn-icon close-conflicts\" title=\"Close\"></button>\r\n      </div>\r\n      <div class=\"conflicts-list question-group\">\r\n        ${conflicts.map((conflict, index) => createConflictCard(conflict, index)).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const closeBtn = container.querySelector('.close-conflicts');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => {\r\n      container.classList.add('hidden');\r\n    });\r\n  }\r\n\r\n  conflicts.forEach((conflict, index) => {\r\n    const card = container.querySelector(`[data-conflict-index=\"${index}\"]`);\r\n    if (!card) return;\r\n    const keepLeftBtn = card.querySelector('.conflict-resolve-keep-left');\r\n    const keepRightBtn = card.querySelector('.conflict-resolve-keep-right');\r\n    if (keepLeftBtn) {\r\n      on(keepLeftBtn as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        resolveConflict(conflict, 'left', panel, props, container);\r\n      });\r\n    }\r\n    if (keepRightBtn) {\r\n      on(keepRightBtn as HTMLElement, 'click', (e) => {\r\n        e.stopPropagation();\r\n        resolveConflict(conflict, 'right', panel, props, container);\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Resolve conflict: keep chosen fact, delete the other, refresh facts, re-run AI fact-check, optionally verify kept fact.\r\n */\r\nasync function resolveConflict(\r\n  conflict: FactConflict,\r\n  keep: 'left' | 'right',\r\n  panel: HTMLElement,\r\n  props: FactsPanelProps,\r\n  conflictsContainer: HTMLElement\r\n): Promise<void> {\r\n  const toDelete = keep === 'left' ? conflict.fact2 : conflict.fact1;\r\n  const toKeep = keep === 'left' ? conflict.fact1 : conflict.fact2;\r\n  if (!toDelete?.id) return;\r\n  try {\r\n    await factsService.deleteFact(toDelete.id);\r\n    toast.success(`Removed conflicting fact; kept: \"${truncate(toKeep?.content ?? '', 50)}\"`);\r\n    await loadFacts(panel, props);\r\n    // Re-run AI fact-check on remaining facts (automatic analysis)\r\n    try {\r\n      await factsService.runFactCheck();\r\n    } catch {\r\n      // Non-blocking\r\n    }\r\n    if (toKeep?.id) {\r\n      try {\r\n        await factsService.verifyFact(toKeep.id);\r\n      } catch {\r\n        // Non-blocking\r\n      }\r\n    }\r\n    await checkConflicts(conflictsContainer, panel, props);\r\n    const updated = await factsService.detectConflicts();\r\n    if (updated.length === 0) {\r\n      conflictsContainer.classList.add('hidden');\r\n      conflictsContainer.innerHTML = '';\r\n    } else {\r\n      renderConflicts(conflictsContainer, updated, panel, props);\r\n    }\r\n    refreshRemovedFactsSection(panel, props);\r\n  } catch {\r\n    toast.error('Failed to resolve conflict');\r\n  }\r\n}\r\n\r\n/**\r\n * Create a single conflict card  isolated layout (no fact-card-sota) + Keep left / Keep right.\r\n */\r\nfunction createConflictCard(conflict: FactConflict, index: number): string {\r\n  const type = (conflict.conflictType || 'contradiction').toLowerCase();\r\n  const desc = conflict.description || conflict.reason || 'Conflict detected';\r\n  const barClass = type === 'contradiction' ? 'conflict-bar-contradiction' : type === 'inconsistency' ? 'conflict-bar-inconsistency' : 'conflict-bar-process';\r\n\r\n  return `\r\n    <div class=\"conflict-card-sota\" data-conflict-index=\"${index}\">\r\n      <div class=\"conflict-type-bar ${barClass}\"></div>\r\n      <div class=\"conflict-card-body\">\r\n        <div class=\"conflict-card-top\">\r\n          <span class=\"conflict-type-pill conflict-type-${type}\">${escapeHtml(type)}</span>\r\n          ${conflict.confidence != null ? `<span class=\"conflict-confidence-pill\">${Math.round(conflict.confidence * 100)}%</span>` : ''}\r\n        </div>\r\n        <div class=\"conflict-facts-row\">\r\n          <div class=\"conflict-fact-cell\">\r\n            <div class=\"conflict-fact-snippet\">${escapeHtml(truncate(conflict.fact1?.content ?? '', 120))}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-resolve-keep-left\">Keep this</button>\r\n          </div>\r\n          <span class=\"conflict-vs\">vs</span>\r\n          <div class=\"conflict-fact-cell\">\r\n            <div class=\"conflict-fact-snippet\">${escapeHtml(truncate(conflict.fact2?.content ?? '', 120))}</div>\r\n            <button type=\"button\" class=\"btn btn-sm conflict-resolve-keep-right\">Keep this</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"conflict-description-row\">\r\n          <div class=\"conflict-description\">${escapeHtml(desc)}</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction truncate(s: string, max: number): string {\r\n  if (s.length <= max) return s;\r\n  return s.slice(0, max).trim() + '';\r\n}\r\n\r\n/**\r\n * Show add fact modal\r\n */\r\nasync function showAddFactModal(panel: HTMLElement, props: FactsPanelProps): Promise<void> {\r\n  // Dynamic import to avoid circular dependency\r\n  const { showFactModal } = await import('../modals/FactModal');\r\n  showFactModal({\r\n    mode: 'create',\r\n    onSave: () => loadFacts(panel, props),\r\n  });\r\n}\r\n\r\n/**\r\n * Update count badge\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#facts-count');\r\n  if (countEl) {\r\n    countEl.textContent = String(count);\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createFactsPanel;\r\n","/**\r\n * Stats Card Widget\r\n * Displays a single statistic with icon and optional trend\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { formatNumber } from '../../utils/format';\r\n\r\nexport interface StatsCardProps {\r\n  id: string;\r\n  label: string;\r\n  value: number | string;\r\n  icon?: string;\r\n  subValue?: string;\r\n  trend?: {\r\n    direction: 'up' | 'down' | 'stable';\r\n    value: number;\r\n    sentiment: 'positive' | 'negative' | 'neutral';\r\n  };\r\n  color?: string;\r\n  onClick?: () => void;\r\n}\r\n\r\n/**\r\n * Create stats card element\r\n */\r\nexport function createStatsCard(props: StatsCardProps): HTMLElement {\r\n  const card = createElement('div', {\r\n    className: `stats-card ${props.onClick ? 'clickable' : ''} ${props.color ? `color-${props.color}` : ''}`,\r\n  });\r\n  card.setAttribute('data-stat-id', props.id);\r\n\r\n  const trendHtml = props.trend ? `\r\n    <div class=\"stat-trend ${props.trend.direction} ${props.trend.sentiment}\">\r\n      <span class=\"trend-arrow\">${getTrendArrow(props.trend.direction)}</span>\r\n      <span class=\"trend-value\">${props.trend.value}%</span>\r\n    </div>\r\n  ` : '';\r\n\r\n  card.innerHTML = `\r\n    ${props.icon ? `<div class=\"stat-icon\">${props.icon}</div>` : ''}\r\n    <div class=\"stat-value\">${typeof props.value === 'number' ? formatNumber(props.value) : props.value}</div>\r\n    <div class=\"stat-label\">${props.label}</div>\r\n    ${props.subValue ? `<div class=\"stat-sub\">${props.subValue}</div>` : ''}\r\n    ${trendHtml}\r\n  `;\r\n\r\n  if (props.onClick) {\r\n    on(card, 'click', props.onClick);\r\n  }\r\n\r\n  return card;\r\n}\r\n\r\n/**\r\n * Get trend arrow character\r\n */\r\nfunction getTrendArrow(direction: 'up' | 'down' | 'stable'): string {\r\n  switch (direction) {\r\n    case 'up': return '';\r\n    case 'down': return '';\r\n    case 'stable': return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Update stats card value\r\n */\r\nexport function updateStatsCard(card: HTMLElement, value: number | string, subValue?: string): void {\r\n  const valueEl = card.querySelector('.stat-value');\r\n  const subEl = card.querySelector('.stat-sub');\r\n  \r\n  if (valueEl) {\r\n    valueEl.textContent = typeof value === 'number' ? formatNumber(value) : value;\r\n  }\r\n  \r\n  if (subEl && subValue !== undefined) {\r\n    subEl.textContent = subValue;\r\n  }\r\n}\r\n\r\n/**\r\n * Create stats grid with multiple cards\r\n */\r\nexport function createStatsGrid(stats: StatsCardProps[]): HTMLElement {\r\n  const grid = createElement('div', { className: 'stats-grid' });\r\n  \r\n  stats.forEach(stat => {\r\n    const card = createStatsCard(stat);\r\n    grid.appendChild(card);\r\n  });\r\n\r\n  return grid;\r\n}\r\n\r\nexport default createStatsCard;\r\n","/**\r\n * Health Indicator Widget\r\n * Displays project health score with gauge and factors\r\n */\r\n\r\nimport { createElement } from '../../utils/dom';\r\nimport { HealthData } from '../../services/dashboard';\r\n\r\nexport interface HealthIndicatorProps {\r\n  health: HealthData;\r\n  showFactors?: boolean;\r\n  size?: 'sm' | 'md' | 'lg';\r\n}\r\n\r\n/**\r\n * Create health indicator element\r\n */\r\nexport function createHealthIndicator(props: HealthIndicatorProps): HTMLElement {\r\n  const { health, showFactors = true, size = 'md' } = props;\r\n  const statusClass = health.status.toLowerCase().replace(/\\s+/g, '-');\r\n\r\n  const indicator = createElement('div', {\r\n    className: `health-indicator ${statusClass} size-${size}`,\r\n  });\r\n\r\n  indicator.innerHTML = `\r\n    <div class=\"health-gauge\">\r\n      <svg class=\"gauge-svg\" viewBox=\"0 0 100 50\">\r\n        <path class=\"gauge-bg\" d=\"M 10 50 A 40 40 0 0 1 90 50\" />\r\n        <path class=\"gauge-fill\" d=\"M 10 50 A 40 40 0 0 1 90 50\" \r\n              style=\"stroke-dasharray: ${(health.score / 100) * 126} 126; stroke: ${health.color};\" />\r\n      </svg>\r\n      <div class=\"gauge-center\">\r\n        <span class=\"score-value\">${health.score}</span>\r\n        <span class=\"score-label\">Health</span>\r\n      </div>\r\n    </div>\r\n    <div class=\"health-status\" style=\"--health-status-color: ${health.color}\">${health.status}</div>\r\n    ${showFactors && health.factors.length > 0 ? `\r\n      <div class=\"health-factors\">\r\n        ${health.factors.slice(0, 4).map(f => `\r\n          <div class=\"factor ${f.type}\">\r\n            <span class=\"factor-icon\">${f.type === 'positive' ? '' : '!'}</span>\r\n            <span class=\"factor-text\">${f.factor}</span>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  return indicator;\r\n}\r\n\r\n/**\r\n * Create mini health badge (for header/compact views)\r\n */\r\nexport function createHealthBadge(score: number, status: string, color: string): HTMLElement {\r\n  const badge = createElement('div', { className: 'health-badge' });\r\n  \r\n  badge.innerHTML = `\r\n    <span class=\"badge-score\" style=\"--badge-bg: ${color}\">${score}</span>\r\n    <span class=\"badge-status\">${status}</span>\r\n  `;\r\n\r\n  return badge;\r\n}\r\n\r\n/**\r\n * Get health color based on score\r\n */\r\nexport function getHealthColor(score: number): string {\r\n  if (score >= 80) return '#22c55e'; // green\r\n  if (score >= 60) return '#84cc16'; // lime\r\n  if (score >= 40) return '#eab308'; // yellow\r\n  if (score >= 20) return '#f97316'; // orange\r\n  return '#ef4444'; // red\r\n}\r\n\r\n/**\r\n * Get health status based on score\r\n */\r\nexport function getHealthStatus(score: number): string {\r\n  if (score >= 80) return 'Healthy';\r\n  if (score >= 60) return 'Good';\r\n  if (score >= 40) return 'Needs Attention';\r\n  if (score >= 20) return 'At Risk';\r\n  return 'Critical';\r\n}\r\n\r\nexport default createHealthIndicator;\r\n","/**\r\n * Trend Chart Widget\r\n * Displays trends over time using Chart.js\r\n */\r\n\r\nimport { createElement } from '../../utils/dom';\r\nimport { TrendHistory } from '../../services/dashboard';\r\n\r\nexport interface TrendChartProps {\r\n  data: TrendHistory[];\r\n  metrics?: ('facts' | 'questions' | 'risks' | 'actions' | 'decisions')[];\r\n  height?: number;\r\n}\r\n\r\n// Color palette for metrics\r\nconst METRIC_COLORS: Record<string, { line: string; fill: string }> = {\r\n  facts: { line: '#6366f1', fill: 'rgba(99, 102, 241, 0.1)' },\r\n  questions: { line: '#f59e0b', fill: 'rgba(245, 158, 11, 0.1)' },\r\n  risks: { line: '#ef4444', fill: 'rgba(239, 68, 68, 0.1)' },\r\n  actions: { line: '#22c55e', fill: 'rgba(34, 197, 94, 0.1)' },\r\n  decisions: { line: '#8b5cf6', fill: 'rgba(139, 92, 246, 0.1)' },\r\n};\r\n\r\n/**\r\n * Create trend chart element\r\n */\r\nexport function createTrendChart(props: TrendChartProps): HTMLElement {\r\n  const { data, metrics = ['facts', 'questions', 'risks'], height = 200 } = props;\r\n\r\n  const container = createElement('div', { className: 'trend-chart-container' });\r\n  container.style.height = `${height}px`;\r\n\r\n  if (data.length === 0) {\r\n    container.innerHTML = '<div class=\"empty-chart\">No trend data available</div>';\r\n    return container;\r\n  }\r\n\r\n  // Create canvas for Chart.js\r\n  const canvas = createElement('canvas', { id: `trend-chart-${Date.now()}` }) as HTMLCanvasElement;\r\n  container.appendChild(canvas);\r\n\r\n  // Initialize chart (requires Chart.js to be loaded)\r\n  initChart(canvas, data, metrics);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Initialize Chart.js chart\r\n */\r\nfunction initChart(\r\n  canvas: HTMLCanvasElement,\r\n  data: TrendHistory[],\r\n  metrics: string[]\r\n): void {\r\n  // Check if Chart.js is available\r\n  if (typeof (window as unknown as { Chart?: unknown }).Chart === 'undefined') {\r\n    console.warn('Chart.js not loaded, using fallback');\r\n    renderFallbackChart(canvas.parentElement as HTMLElement, data, metrics);\r\n    return;\r\n  }\r\n\r\n  const Chart = (window as unknown as { Chart: typeof import('chart.js').Chart }).Chart;\r\n\r\n  const labels = data.map(d => formatDate(d.date));\r\n  const datasets = metrics.map(metric => ({\r\n    label: capitalize(metric),\r\n    data: data.map(d => (d as Record<string, number>)[metric] || 0),\r\n    borderColor: METRIC_COLORS[metric]?.line || '#6366f1',\r\n    backgroundColor: METRIC_COLORS[metric]?.fill || 'rgba(99, 102, 241, 0.1)',\r\n    fill: true,\r\n    tension: 0.3,\r\n  }));\r\n\r\n  new Chart(canvas, {\r\n    type: 'line',\r\n    data: { labels, datasets },\r\n    options: {\r\n      responsive: true,\r\n      maintainAspectRatio: false,\r\n      plugins: {\r\n        legend: {\r\n          position: 'bottom',\r\n        },\r\n      },\r\n      scales: {\r\n        y: {\r\n          beginAtZero: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Render fallback chart (pure CSS/HTML)\r\n */\r\nfunction renderFallbackChart(container: HTMLElement, data: TrendHistory[], metrics: string[]): void {\r\n  const maxValue = Math.max(\r\n    ...data.flatMap(d => metrics.map(m => (d as Record<string, number>)[m] || 0))\r\n  );\r\n\r\n  container.innerHTML = `\r\n    <div class=\"fallback-chart\">\r\n      <div class=\"chart-legend\">\r\n        ${metrics.map(m => `\r\n          <span class=\"legend-item\">\r\n            <span class=\"legend-color\" style=\"--legend-color: ${METRIC_COLORS[m]?.line || '#6366f1'}\"></span>\r\n            ${capitalize(m)}\r\n          </span>\r\n        `).join('')}\r\n      </div>\r\n      <div class=\"chart-bars\">\r\n        ${data.slice(-7).map(d => `\r\n          <div class=\"bar-group\">\r\n            ${metrics.map(m => {\r\n              const value = (d as Record<string, number>)[m] || 0;\r\n              const height = maxValue > 0 ? (value / maxValue) * 100 : 0;\r\n              return `<div class=\"bar\" style=\"--bar-height: ${height}; --bar-color: ${METRIC_COLORS[m]?.line || '#6366f1'}\" title=\"${capitalize(m)}: ${value}\"></div>`;\r\n            }).join('')}\r\n            <div class=\"bar-label\">${formatDate(d.date)}</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Format date for display\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\r\n}\r\n\r\n/**\r\n * Capitalize first letter\r\n */\r\nfunction capitalize(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\nexport default createTrendChart;\r\n","/**\r\n * Risk Matrix Widget\r\n * 5x4 matrix showing risks by impact and likelihood\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { Risk, risksService } from '../../services/risks';\r\n\r\nexport interface RiskMatrixProps {\r\n  risks: Risk[];\r\n  onCellClick?: (risks: Risk[], impact: string, likelihood: string) => void;\r\n  size?: 'sm' | 'md' | 'lg';\r\n}\r\n\r\nconst IMPACTS = ['critical', 'high', 'medium', 'low'];\r\nconst LIKELIHOODS = ['high', 'medium', 'low'];\r\n\r\n// Cell colors based on risk level\r\nconst CELL_COLORS: Record<string, string> = {\r\n  'critical-high': '#dc2626',   // dark red\r\n  'critical-medium': '#ef4444', // red\r\n  'critical-low': '#f87171',    // light red\r\n  'high-high': '#ef4444',       // red\r\n  'high-medium': '#f97316',     // orange\r\n  'high-low': '#fb923c',        // light orange\r\n  'medium-high': '#f97316',     // orange\r\n  'medium-medium': '#eab308',   // yellow\r\n  'medium-low': '#facc15',      // light yellow\r\n  'low-high': '#eab308',        // yellow\r\n  'low-medium': '#84cc16',      // lime\r\n  'low-low': '#22c55e',         // green\r\n};\r\n\r\n/**\r\n * Create risk matrix element\r\n */\r\nexport function createRiskMatrix(props: RiskMatrixProps): HTMLElement {\r\n  const { risks, onCellClick, size = 'md' } = props;\r\n\r\n  const matrix = createElement('div', { className: `risk-matrix size-${size}` });\r\n  \r\n  // Group risks by cell\r\n  const grouped = groupRisksByCell(risks);\r\n\r\n  matrix.innerHTML = `\r\n    <div class=\"matrix-container\">\r\n      <div class=\"matrix-y-label\">Impact</div>\r\n      <div class=\"matrix-grid\">\r\n        <div class=\"matrix-header\">\r\n          <div class=\"matrix-corner\"></div>\r\n          ${LIKELIHOODS.map(l => `<div class=\"matrix-col-header\">${capitalize(l)}</div>`).join('')}\r\n        </div>\r\n        ${IMPACTS.map(impact => `\r\n          <div class=\"matrix-row\">\r\n            <div class=\"matrix-row-header\">${capitalize(impact)}</div>\r\n            ${LIKELIHOODS.map(likelihood => {\r\n              const key = `${impact}-${likelihood}`;\r\n              const cellRisks = grouped[key] || [];\r\n              const color = CELL_COLORS[key] || '#e5e7eb';\r\n              const count = cellRisks.length;\r\n              return `\r\n                <div class=\"matrix-cell ${count > 0 ? 'has-risks' : ''}\" \r\n                     data-impact=\"${impact}\" \r\n                     data-likelihood=\"${likelihood}\"\r\n                     style=\"background-color: ${count > 0 ? color : 'var(--color-surface-hover)'}\">\r\n                  ${count > 0 ? `<span class=\"cell-count\">${count}</span>` : ''}\r\n                </div>\r\n              `;\r\n            }).join('')}\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n      <div class=\"matrix-x-label\">Likelihood</div>\r\n    </div>\r\n    <div class=\"matrix-legend\">\r\n      <span class=\"legend-item\"><span class=\"legend-color risk-legend-low\"></span> Low</span>\r\n      <span class=\"legend-item\"><span class=\"legend-color risk-legend-medium\"></span> Medium</span>\r\n      <span class=\"legend-item\"><span class=\"legend-color risk-legend-high\"></span> High</span>\r\n      <span class=\"legend-item\"><span class=\"legend-color risk-legend-critical\"></span> Critical</span>\r\n    </div>\r\n  `;\r\n\r\n  // Bind cell click events\r\n  if (onCellClick) {\r\n    matrix.querySelectorAll('.matrix-cell.has-risks').forEach(cell => {\r\n      on(cell as HTMLElement, 'click', () => {\r\n        const impact = cell.getAttribute('data-impact') || '';\r\n        const likelihood = cell.getAttribute('data-likelihood') || '';\r\n        const key = `${impact}-${likelihood}`;\r\n        const cellRisks = grouped[key] || [];\r\n        onCellClick(cellRisks, impact, likelihood);\r\n      });\r\n    });\r\n  }\r\n\r\n  return matrix;\r\n}\r\n\r\n/**\r\n * Group risks by matrix cell\r\n */\r\nfunction groupRisksByCell(risks: Risk[]): Record<string, Risk[]> {\r\n  const grouped: Record<string, Risk[]> = {};\r\n  \r\n  risks\r\n    .filter(r => r.status !== 'mitigated' && r.status !== 'closed')\r\n    .forEach(risk => {\r\n      const key = `${risk.impact}-${risk.likelihood}`;\r\n      if (!grouped[key]) grouped[key] = [];\r\n      grouped[key].push(risk);\r\n    });\r\n  \r\n  return grouped;\r\n}\r\n\r\n/**\r\n * Capitalize first letter\r\n */\r\nfunction capitalize(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\n/**\r\n * Create compact risk summary (for dashboard)\r\n */\r\nexport function createRiskSummary(risks: Risk[]): HTMLElement {\r\n  const summary = createElement('div', { className: 'risk-summary' });\r\n  \r\n  const bySeverity = {\r\n    critical: risks.filter(r => r.impact === 'critical' && r.status === 'open').length,\r\n    high: risks.filter(r => r.impact === 'high' && r.status === 'open').length,\r\n    medium: risks.filter(r => r.impact === 'medium' && r.status === 'open').length,\r\n    low: risks.filter(r => r.impact === 'low' && r.status === 'open').length,\r\n  };\r\n\r\n  summary.innerHTML = `\r\n    <div class=\"summary-bars\">\r\n      ${Object.entries(bySeverity).map(([level, count]) => `\r\n        <div class=\"summary-bar\">\r\n          <span class=\"bar-label\">${capitalize(level)}</span>\r\n          <div class=\"bar-track\">\r\n            <div class=\"bar-fill impact-${level}\" style=\"--bar-width: ${Math.min(count * 20, 100)}\"></div>\r\n          </div>\r\n          <span class=\"bar-count\">${count}</span>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  return summary;\r\n}\r\n\r\nexport default createRiskMatrix;\r\n","/**\r\n * File Uploader Component\r\n * Drag-and-drop file upload with progress and file list\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { documentsService, UploadResult, ProcessingStatus } from '../services/documents';\r\nimport { toast } from '../services/toast';\r\nimport { formatFileSize } from '../utils/format';\r\n\r\nexport interface FileUploaderProps {\r\n  onUploadComplete?: (result: UploadResult) => void;\r\n  onProcessingStart?: () => void;\r\n  allowedTypes?: string[];\r\n  maxFileSize?: number; // in bytes\r\n  multiple?: boolean;\r\n}\r\n\r\ninterface QueuedFile {\r\n  file: File;\r\n  id: string;\r\n  progress: number;\r\n  status: 'pending' | 'uploading' | 'complete' | 'error';\r\n  error?: string;\r\n}\r\n\r\nlet fileQueue: QueuedFile[] = [];\r\nlet isProcessing = false;\r\n\r\n/**\r\n * Create file uploader component\r\n */\r\nexport function createFileUploader(props: FileUploaderProps = {}): HTMLElement {\r\n  const { allowedTypes, maxFileSize = 50 * 1024 * 1024, multiple = true } = props;\r\n\r\n  const uploader = createElement('div', { className: 'file-uploader' });\r\n\r\n  uploader.innerHTML = `\r\n    <div class=\"dropzone\" id=\"dropzone\">\r\n      <div class=\"dropzone-content\">\r\n        <div class=\"dropzone-icon\"></div>\r\n        <div class=\"dropzone-text\">\r\n          <p>Drag & drop files here</p>\r\n          <p class=\"dropzone-subtext\">or click to browse</p>\r\n        </div>\r\n        <input type=\"file\" id=\"file-input\" ${multiple ? 'multiple' : ''} \r\n               ${allowedTypes ? `accept=\"${allowedTypes.join(',')}\"` : ''} hidden>\r\n      </div>\r\n    </div>\r\n    <div class=\"file-queue hidden\" id=\"file-queue\"></div>\r\n    <div class=\"upload-actions hidden\" id=\"upload-actions\">\r\n      <button class=\"btn btn-secondary\" id=\"clear-queue-btn\">Clear</button>\r\n      <button class=\"btn btn-primary\" id=\"upload-btn\">Upload Files</button>\r\n    </div>\r\n    <div class=\"processing-status hidden\" id=\"processing-status\"></div>\r\n  `;\r\n\r\n  const dropzone = uploader.querySelector('#dropzone') as HTMLElement;\r\n  const fileInput = uploader.querySelector('#file-input') as HTMLInputElement;\r\n  const queueContainer = uploader.querySelector('#file-queue') as HTMLElement;\r\n  const actionsContainer = uploader.querySelector('#upload-actions') as HTMLElement;\r\n  const statusContainer = uploader.querySelector('#processing-status') as HTMLElement;\r\n\r\n  // Click to browse\r\n  on(dropzone, 'click', () => fileInput.click());\r\n\r\n  // File input change\r\n  on(fileInput, 'change', () => {\r\n    if (fileInput.files) {\r\n      addFilesToQueue(Array.from(fileInput.files), maxFileSize);\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    }\r\n    fileInput.value = ''; // Reset for same file selection\r\n  });\r\n\r\n  // Drag events\r\n  on(dropzone, 'dragover', (e) => {\r\n    e.preventDefault();\r\n    dropzone.classList.add('dragover');\r\n  });\r\n\r\n  on(dropzone, 'dragleave', () => {\r\n    dropzone.classList.remove('dragover');\r\n  });\r\n\r\n  on(dropzone, 'drop', (e) => {\r\n    e.preventDefault();\r\n    dropzone.classList.remove('dragover');\r\n    const files = Array.from(e.dataTransfer?.files || []);\r\n    if (files.length > 0) {\r\n      addFilesToQueue(files, maxFileSize);\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    }\r\n  });\r\n\r\n  // Clear queue\r\n  const clearBtn = uploader.querySelector('#clear-queue-btn');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      fileQueue = [];\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    });\r\n  }\r\n\r\n  // Upload button\r\n  const uploadBtn = uploader.querySelector('#upload-btn');\r\n  if (uploadBtn) {\r\n    on(uploadBtn as HTMLElement, 'click', async () => {\r\n      await uploadFiles(queueContainer, actionsContainer, statusContainer, props);\r\n    });\r\n  }\r\n\r\n  // Check processing status on mount\r\n  checkProcessingStatus(statusContainer);\r\n\r\n  return uploader;\r\n}\r\n\r\n/**\r\n * Add files to queue\r\n */\r\nfunction addFilesToQueue(files: File[], maxSize: number): void {\r\n  files.forEach(file => {\r\n    // Check size\r\n    if (file.size > maxSize) {\r\n      toast.warning(`${file.name} is too large (max ${formatFileSize(maxSize)})`);\r\n      return;\r\n    }\r\n\r\n    // Check if already in queue\r\n    if (fileQueue.some(f => f.file.name === file.name && f.file.size === file.size)) {\r\n      return;\r\n    }\r\n\r\n    fileQueue.push({\r\n      file,\r\n      id: `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n      progress: 0,\r\n      status: 'pending',\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Update queue UI\r\n */\r\nfunction updateQueueUI(container: HTMLElement, actionsContainer: HTMLElement): void {\r\n  if (fileQueue.length === 0) {\r\n    container.classList.add('hidden');\r\n    actionsContainer.classList.add('hidden');\r\n    return;\r\n  }\r\n\r\n  container.classList.remove('hidden');\r\n  actionsContainer.classList.remove('hidden');\r\n\r\n  container.innerHTML = fileQueue.map(qf => `\r\n    <div class=\"queued-file ${qf.status}\" data-id=\"${qf.id}\">\r\n      <div class=\"file-info\">\r\n        <span class=\"file-icon\">${getFileIcon(qf.file.type)}</span>\r\n        <span class=\"file-name\">${escapeHtml(qf.file.name)}</span>\r\n        <span class=\"file-size\">${formatFileSize(qf.file.size)}</span>\r\n      </div>\r\n      <div class=\"file-status\">\r\n        ${qf.status === 'uploading' ? `\r\n          <div class=\"progress-bar\">\r\n            <div class=\"progress-fill\" style=\"--progress: ${qf.progress}\"></div>\r\n          </div>\r\n          <span class=\"progress-text\">${qf.progress}%</span>\r\n        ` : qf.status === 'complete' ? `\r\n          <span class=\"status-icon success\"></span>\r\n        ` : qf.status === 'error' ? `\r\n          <span class=\"status-icon error\"></span>\r\n          <span class=\"error-text\">${escapeHtml(qf.error || 'Error')}</span>\r\n        ` : `\r\n          <button class=\"btn-icon remove-file\" data-id=\"${qf.id}\"></button>\r\n        `}\r\n      </div>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind remove buttons\r\n  container.querySelectorAll('.remove-file').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      fileQueue = fileQueue.filter(f => f.id !== id);\r\n      updateQueueUI(container, actionsContainer);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Upload files\r\n */\r\nasync function uploadFiles(\r\n  queueContainer: HTMLElement,\r\n  actionsContainer: HTMLElement,\r\n  statusContainer: HTMLElement,\r\n  props: FileUploaderProps\r\n): Promise<void> {\r\n  const pendingFiles = fileQueue.filter(f => f.status === 'pending');\r\n  if (pendingFiles.length === 0) return;\r\n\r\n  // Disable buttons during upload\r\n  const uploadBtn = actionsContainer.querySelector('#upload-btn') as HTMLButtonElement;\r\n  if (uploadBtn) uploadBtn.disabled = true;\r\n\r\n  try {\r\n    // Mark all as uploading\r\n    pendingFiles.forEach(f => {\r\n      f.status = 'uploading';\r\n      f.progress = 0;\r\n    });\r\n    updateQueueUI(queueContainer, actionsContainer);\r\n\r\n    // Upload files\r\n    const result = await documentsService.upload(\r\n      pendingFiles.map(f => f.file),\r\n      (progress) => {\r\n        pendingFiles.forEach(f => {\r\n          f.progress = progress;\r\n        });\r\n        updateQueueUI(queueContainer, actionsContainer);\r\n      }\r\n    );\r\n\r\n    // Mark as complete\r\n    pendingFiles.forEach(f => {\r\n      f.status = 'complete';\r\n      f.progress = 100;\r\n    });\r\n    updateQueueUI(queueContainer, actionsContainer);\r\n\r\n    toast.success(`Uploaded ${result.files.length} file(s)`);\r\n    props.onUploadComplete?.(result);\r\n\r\n    // Clear completed after delay\r\n    setTimeout(() => {\r\n      fileQueue = fileQueue.filter(f => f.status !== 'complete');\r\n      updateQueueUI(queueContainer, actionsContainer);\r\n    }, 2000);\r\n\r\n    // Check if processing started\r\n    if (result.processingStarted) {\r\n      props.onProcessingStart?.();\r\n      pollProcessingStatus(statusContainer);\r\n    }\r\n  } catch (error) {\r\n    pendingFiles.forEach(f => {\r\n      f.status = 'error';\r\n      f.error = error instanceof Error ? error.message : 'Upload failed';\r\n    });\r\n    updateQueueUI(queueContainer, actionsContainer);\r\n  } finally {\r\n    if (uploadBtn) uploadBtn.disabled = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Check processing status\r\n */\r\nasync function checkProcessingStatus(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const status = await documentsService.getProcessingStatus();\r\n    if (status.isProcessing || status.queueLength > 0) {\r\n      renderProcessingStatus(container, status);\r\n      pollProcessingStatus(container);\r\n    }\r\n  } catch {\r\n    // Ignore errors\r\n  }\r\n}\r\n\r\n/**\r\n * Poll processing status\r\n */\r\nlet pollingInterval: number | null = null;\r\n\r\nfunction pollProcessingStatus(container: HTMLElement): void {\r\n  if (pollingInterval) return;\r\n\r\n  pollingInterval = window.setInterval(async () => {\r\n    try {\r\n      const status = await documentsService.getProcessingStatus();\r\n      renderProcessingStatus(container, status);\r\n\r\n      if (!status.isProcessing && status.queueLength === 0) {\r\n        if (pollingInterval) {\r\n          clearInterval(pollingInterval);\r\n          pollingInterval = null;\r\n        }\r\n        setTimeout(() => container.classList.add('hidden'), 3000);\r\n      }\r\n    } catch {\r\n      if (pollingInterval) {\r\n        clearInterval(pollingInterval);\r\n        pollingInterval = null;\r\n      }\r\n    }\r\n  }, 2000);\r\n}\r\n\r\n/**\r\n * Render processing status\r\n */\r\nfunction renderProcessingStatus(container: HTMLElement, status: ProcessingStatus): void {\r\n  container.classList.remove('hidden');\r\n\r\n  container.innerHTML = `\r\n    <div class=\"processing-header\">\r\n      <span class=\"processing-icon\">${status.isProcessing ? '' : ''}</span>\r\n      <span class=\"processing-title\">${status.isProcessing ? 'Processing...' : 'Complete'}</span>\r\n    </div>\r\n    <div class=\"processing-stats\">\r\n      <span>Completed: ${status.completedCount}</span>\r\n      <span>Pending: ${status.queueLength}</span>\r\n      ${status.errorCount > 0 ? `<span class=\"error\">Errors: ${status.errorCount}</span>` : ''}\r\n    </div>\r\n    ${status.processingFile ? `<div class=\"current-file\">Current: ${escapeHtml(status.processingFile)}</div>` : ''}\r\n    ${status.isProcessing ? `\r\n      <div class=\"processing-progress\">\r\n        <div class=\"progress-bar\">\r\n          <div class=\"progress-fill\" style=\"--progress: ${(status.completedCount / (status.completedCount + status.queueLength + 1)) * 100}\"></div>\r\n        </div>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Get file icon based on type\r\n */\r\nfunction getFileIcon(mimeType: string): string {\r\n  if (mimeType.startsWith('image/')) return '';\r\n  if (mimeType.startsWith('video/')) return '';\r\n  if (mimeType.startsWith('audio/')) return '';\r\n  if (mimeType === 'application/pdf') return '';\r\n  if (mimeType.includes('spreadsheet') || mimeType.includes('excel')) return '';\r\n  if (mimeType.includes('document') || mimeType.includes('word')) return '';\r\n  if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return '';\r\n  if (mimeType.includes('text')) return '';\r\n  return '';\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createFileUploader;\r\n","/**\n * Knowledge Graph Component\n * Interactive graph visualization using vis-network\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { graphService, GraphNode, GraphEdge, GraphStats } from '../services/graph';\nimport { toast } from '../services/toast';\n\nexport interface KnowledgeGraphProps {\n  onNodeClick?: (node: GraphNode) => void;\n  onEdgeClick?: (edge: GraphEdge) => void;\n  height?: number;\n}\n\ninterface VisNetwork {\n  setData: (data: { nodes: unknown[]; edges: unknown[] }) => void;\n  on: (event: string, callback: (params: unknown) => void) => void;\n  fit: () => void;\n  focus: (nodeId: string, options?: { scale?: number }) => void;\n  destroy: () => void;\n}\n\ndeclare global {\n  interface Window {\n    vis?: {\n      Network: new (container: HTMLElement, data: unknown, options: unknown) => VisNetwork;\n      DataSet: new (data: unknown[]) => unknown;\n    };\n  }\n}\n\nconst NODE_COLORS: Record<string, string> = {\n  Person: '#6366f1',\n  Document: '#22c55e',\n  Question: '#f59e0b',\n  Risk: '#ef4444',\n  Action: '#8b5cf6',\n  Decision: '#06b6d4',\n  Fact: '#84cc16',\n  Email: '#ec4899',\n  default: '#9ca3af',\n};\n\n/**\n * Create knowledge graph component\n */\nexport function createKnowledgeGraph(props: KnowledgeGraphProps = {}): HTMLElement {\n  const { height = 500 } = props;\n\n  const container = createElement('div', { className: 'knowledge-graph' });\n\n  container.innerHTML = `\n    <div class=\"graph-toolbar\">\n      <div class=\"graph-filters\">\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Person\"> People\n        </label>\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Document\"> Documents\n        </label>\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Question\"> Questions\n        </label>\n        <label class=\"filter-item\">\n          <input type=\"checkbox\" checked data-type=\"Risk\"> Risks\n        </label>\n      </div>\n      <div class=\"graph-actions\">\n        <input type=\"search\" id=\"graph-search\" class=\"search-input\" placeholder=\"Search nodes...\">\n        <button class=\"btn btn-sm\" id=\"graph-refresh\">Refresh</button>\n        <button class=\"btn btn-sm\" id=\"graph-fit\">Fit</button>\n      </div>\n    </div>\n    <div class=\"graph-container\" id=\"graph-container\" style=\"--graph-height: ${height}px;\">\n      <div class=\"graph-loading\">Loading graph...</div>\n    </div>\n    <div class=\"graph-stats\" id=\"graph-stats\"></div>\n    <div class=\"node-details hidden\" id=\"node-details\"></div>\n  `;\n\n  // Initialize graph\n  initGraph(container, props);\n\n  return container;\n}\n\n/**\n * Initialize graph visualization\n */\nasync function initGraph(container: HTMLElement, props: KnowledgeGraphProps): Promise<void> {\n  const graphContainer = container.querySelector('#graph-container') as HTMLElement;\n  const statsContainer = container.querySelector('#graph-stats') as HTMLElement;\n\n  // Check if vis-network is available\n  if (!window.vis) {\n    graphContainer.innerHTML = `\n      <div class=\"graph-fallback\">\n        <p>Graph visualization requires vis-network library</p>\n        <p class=\"text-muted\">Add vis-network to enable interactive graph</p>\n      </div>\n    `;\n    await loadStats(statsContainer);\n    return;\n  }\n\n  try {\n    // Load graph data\n    const { nodes, edges } = await graphService.getVisualizationData();\n    \n    if (nodes.length === 0) {\n      graphContainer.innerHTML = `\n        <div class=\"graph-empty\">\n          <p>No graph data available</p>\n          <p class=\"text-muted\">Process some documents to populate the knowledge graph</p>\n        </div>\n      `;\n      return;\n    }\n\n    // Create vis-network\n    const network = createVisNetwork(graphContainer, nodes, edges, props);\n    \n    // Bind toolbar events\n    bindToolbarEvents(container, network, nodes, props);\n\n    // Load stats\n    await loadStats(statsContainer);\n\n  } catch (error) {\n    graphContainer.innerHTML = `\n      <div class=\"graph-error\">\n        <p>Failed to load graph</p>\n        <button class=\"btn btn-sm\" id=\"retry-graph\">Retry</button>\n      </div>\n    `;\n    const retryBtn = graphContainer.querySelector('#retry-graph');\n    if (retryBtn) {\n      on(retryBtn as HTMLElement, 'click', () => initGraph(container, props));\n    }\n  }\n}\n\n/**\n * Create vis-network instance\n */\nfunction createVisNetwork(\n  container: HTMLElement,\n  nodes: GraphNode[],\n  edges: GraphEdge[],\n  props: KnowledgeGraphProps\n): VisNetwork {\n  container.innerHTML = ''; // Clear loading\n\n  const visNodes = nodes.map(n => ({\n    id: n.id,\n    label: n.label || n.name || n.id,\n    color: NODE_COLORS[n.type] || NODE_COLORS.default,\n    title: `${n.type}: ${n.label || n.name || n.id}`,\n    shape: 'dot',\n    size: getNodeSize(n),\n  }));\n\n  const visEdges = edges.map(e => ({\n    from: e.source,\n    to: e.target,\n    label: e.type,\n    arrows: 'to',\n    color: { color: '#9ca3af', opacity: 0.6 },\n  }));\n\n  const options = {\n    nodes: {\n      borderWidth: 2,\n      shadow: true,\n      font: {\n        size: 12,\n        color: getComputedStyle(document.documentElement).getPropertyValue('--color-text').trim() || '#333',\n      },\n    },\n    edges: {\n      width: 1,\n      shadow: false,\n      smooth: {\n        type: 'continuous',\n      },\n      font: {\n        size: 10,\n        color: '#9ca3af',\n      },\n    },\n    physics: {\n      stabilization: {\n        iterations: 100,\n      },\n      barnesHut: {\n        gravitationalConstant: -5000,\n        springLength: 150,\n      },\n    },\n    interaction: {\n      hover: true,\n      tooltipDelay: 200,\n    },\n  };\n\n  const network = new window.vis!.Network(container, {\n    nodes: new window.vis!.DataSet(visNodes),\n    edges: new window.vis!.DataSet(visEdges),\n  }, options);\n\n  // Node click handler\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  network.on('click', (params: any) => {\n    if (params.nodes && params.nodes.length > 0) {\n      const nodeId = params.nodes[0];\n      const node = nodes.find(n => n.id === nodeId);\n      if (node && props.onNodeClick) {\n        props.onNodeClick(node);\n      }\n      showNodeDetails(container, node);\n    }\n  });\n\n  return network;\n}\n\n/**\n * Get node size based on connections\n */\nfunction getNodeSize(node: GraphNode): number {\n  const connections = (node as unknown as { connections?: number }).connections || 1;\n  return Math.min(10 + connections * 2, 30);\n}\n\n/**\n * Bind toolbar events\n */\nfunction bindToolbarEvents(\n  container: HTMLElement,\n  network: VisNetwork,\n  nodes: GraphNode[],\n  props: KnowledgeGraphProps\n): void {\n  // Search\n  const searchInput = container.querySelector('#graph-search') as HTMLInputElement;\n  on(searchInput, 'input', () => {\n    const query = searchInput.value.toLowerCase();\n    const matchingNode = nodes.find(n => \n      (n.label || n.name || n.id).toLowerCase().includes(query)\n    );\n    if (matchingNode) {\n      network.focus(matchingNode.id, { scale: 1.5 });\n    }\n  });\n\n  // Refresh\n  const refreshBtn = container.querySelector('#graph-refresh');\n  if (refreshBtn) {\n    on(refreshBtn as HTMLElement, 'click', () => {\n      initGraph(container, props);\n    });\n  }\n\n  // Fit\n  const fitBtn = container.querySelector('#graph-fit');\n  if (fitBtn) {\n    on(fitBtn as HTMLElement, 'click', () => {\n      network.fit();\n    });\n  }\n\n  // Filters\n  container.querySelectorAll('.filter-item input').forEach(checkbox => {\n    on(checkbox as HTMLElement, 'change', () => {\n      // TODO: Implement filtering\n      toast.info('Filtering not yet implemented');\n    });\n  });\n}\n\n/**\n * Show node details\n */\nfunction showNodeDetails(container: HTMLElement, node?: GraphNode): void {\n  const detailsContainer = container.querySelector('#node-details') as HTMLElement;\n  \n  if (!node) {\n    detailsContainer.classList.add('hidden');\n    return;\n  }\n\n  detailsContainer.classList.remove('hidden');\n  detailsContainer.innerHTML = `\n    <div class=\"details-header\">\n      <span class=\"node-type\" style=\"--type-color: ${NODE_COLORS[node.type] || NODE_COLORS.default}\">${node.type}</span>\n      <span class=\"node-label\">${escapeHtml(node.label || node.name || node.id)}</span>\n      <button class=\"btn-icon close-details\"></button>\n    </div>\n    ${node.properties ? `\n      <div class=\"details-properties\">\n        ${Object.entries(node.properties).map(([key, value]) => `\n          <div class=\"property\">\n            <span class=\"property-key\">${escapeHtml(key)}:</span>\n            <span class=\"property-value\">${escapeHtml(String(value))}</span>\n          </div>\n        `).join('')}\n      </div>\n    ` : ''}\n  `;\n\n  const closeBtn = detailsContainer.querySelector('.close-details');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => {\n      detailsContainer.classList.add('hidden');\n    });\n  }\n}\n\n/**\n * Load graph stats\n */\nasync function loadStats(container: HTMLElement): Promise<void> {\n  try {\n    const stats = await graphService.getStats();\n    renderStats(container, stats);\n  } catch {\n    container.innerHTML = '';\n  }\n}\n\n/**\n * Render stats\n */\nfunction renderStats(container: HTMLElement, stats: GraphStats): void {\n  container.innerHTML = `\n    <div class=\"stat-item\">\n      <span class=\"stat-value\">${stats.nodeCount}</span>\n      <span class=\"stat-label\">Nodes</span>\n    </div>\n    <div class=\"stat-item\">\n      <span class=\"stat-value\">${stats.edgeCount}</span>\n      <span class=\"stat-label\">Edges</span>\n    </div>\n    ${stats.nodeTypes ? Object.entries(stats.nodeTypes).map(([type, count]) => `\n      <div class=\"stat-item type-${type.toLowerCase()}\">\n        <span class=\"stat-value\">${count}</span>\n        <span class=\"stat-label\">${type}</span>\n      </div>\n    `).join('') : ''}\n  `;\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createKnowledgeGraph;\n","/**\n * Timeline Component\n * Vertical timeline with events\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { timelineService, TimelineEvent } from '../services/graph';\nimport { formatRelativeTime, formatDate } from '../utils/format';\n\nexport interface TimelineProps {\n  days?: number;\n  onEventClick?: (event: TimelineEvent) => void;\n}\n\n/**\n * Create timeline component\n */\nexport function createTimeline(props: TimelineProps = {}): HTMLElement {\n  const { days = 30 } = props;\n\n  const container = createElement('div', { className: 'timeline-container' });\n\n  container.innerHTML = `\n    <div class=\"timeline-header\">\n      <h3>Timeline</h3>\n      <select id=\"timeline-days\" class=\"filter-select\">\n        <option value=\"7\" ${days === 7 ? 'selected' : ''}>Last 7 days</option>\n        <option value=\"14\" ${days === 14 ? 'selected' : ''}>Last 14 days</option>\n        <option value=\"30\" ${days === 30 ? 'selected' : ''}>Last 30 days</option>\n        <option value=\"90\" ${days === 90 ? 'selected' : ''}>Last 90 days</option>\n      </select>\n    </div>\n    <div class=\"timeline-filters\">\n      <button class=\"filter-btn active\" data-type=\"all\">All</button>\n      <button class=\"filter-btn\" data-type=\"document\">Documents</button>\n      <button class=\"filter-btn\" data-type=\"question\">Questions</button>\n      <button class=\"filter-btn\" data-type=\"decision\">Decisions</button>\n      <button class=\"filter-btn\" data-type=\"risk\">Risks</button>\n    </div>\n    <div class=\"timeline-content\" id=\"timeline-content\">\n      <div class=\"loading\">Loading timeline...</div>\n    </div>\n  `;\n\n  // Bind events\n  const daysSelect = container.querySelector('#timeline-days') as HTMLSelectElement;\n  on(daysSelect, 'change', () => {\n    loadTimeline(container, parseInt(daysSelect.value), props);\n  });\n\n  const filterBtns = container.querySelectorAll('.filter-btn');\n  filterBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      filterBtns.forEach(b => b.classList.remove('active'));\n      btn.classList.add('active');\n      filterEvents(container, btn.getAttribute('data-type') || 'all');\n    });\n  });\n\n  // Initial load\n  loadTimeline(container, days, props);\n\n  return container;\n}\n\n/**\n * Load timeline events\n */\nasync function loadTimeline(container: HTMLElement, days: number, props: TimelineProps): Promise<void> {\n  const content = container.querySelector('#timeline-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const data = await timelineService.getAll({ limit: days * 10 }); // Approximate events per day\n    renderTimeline(content, data.events || [], props);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load timeline</div>';\n  }\n}\n\n/**\n * Render timeline\n */\nfunction renderTimeline(container: HTMLElement, events: TimelineEvent[], props: TimelineProps): void {\n  if (events.length === 0) {\n    container.innerHTML = '<div class=\"empty-state\">No events in this period</div>';\n    return;\n  }\n\n  // Group by date\n  const grouped = groupByDate(events);\n\n  container.innerHTML = `\n    <div class=\"timeline\">\n      ${Object.entries(grouped).map(([date, dayEvents]) => `\n        <div class=\"timeline-day\">\n          <div class=\"timeline-date\">${formatDate(date)}</div>\n          ${dayEvents.map(event => `\n            <div class=\"timeline-event\" data-type=\"${event.type}\" data-id=\"${event.id}\">\n              <div class=\"event-marker ${event.type}\"></div>\n              <div class=\"event-content\">\n                <div class=\"event-header\">\n                  <span class=\"event-type\">${event.type}</span>\n                  <span class=\"event-time\">${formatTime(event.date)}</span>\n                </div>\n                <div class=\"event-title\">${escapeHtml(event.title)}</div>\n                ${event.description ? `<div class=\"event-description\">${escapeHtml(event.description)}</div>` : ''}\n                ${event.user ? `<div class=\"event-user\">by ${escapeHtml(event.user)}</div>` : ''}\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind click events\n  container.querySelectorAll('.timeline-event').forEach(el => {\n    on(el as HTMLElement, 'click', () => {\n      const id = el.getAttribute('data-id');\n      const event = events.find(e => String(e.id) === id);\n      if (event && props.onEventClick) {\n        props.onEventClick(event);\n      }\n    });\n  });\n}\n\n/**\n * Group events by date\n */\nfunction groupByDate(events: TimelineEvent[]): Record<string, TimelineEvent[]> {\n  const grouped: Record<string, TimelineEvent[]> = {};\n  \n  events.forEach(event => {\n    const date = event.date.split('T')[0];\n    if (!grouped[date]) grouped[date] = [];\n    grouped[date].push(event);\n  });\n\n  // Sort by date descending\n  return Object.fromEntries(\n    Object.entries(grouped).sort(([a], [b]) => b.localeCompare(a))\n  );\n}\n\n/**\n * Filter events by type\n */\nfunction filterEvents(container: HTMLElement, type: string): void {\n  const events = container.querySelectorAll('.timeline-event');\n  events.forEach(el => {\n    if (type === 'all' || el.getAttribute('data-type') === type) {\n      (el as HTMLElement).classList.remove('hidden');\n    } else {\n      (el as HTMLElement).classList.add('hidden');\n    }\n  });\n\n  // Hide empty days\n  container.querySelectorAll('.timeline-day').forEach(day => {\n    const visibleEvents = day.querySelectorAll('.timeline-event:not(.hidden)');\n    (day as HTMLElement).classList.toggle('hidden', visibleEvents.length === 0);\n  });\n}\n\n/**\n * Format time\n */\nfunction formatTime(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createTimeline;\n","/**\r\n * TimelinePanel - SOTA Timeline Component\r\n * \r\n * Features:\r\n * - Sticky date headers\r\n * - \"Today\" line marker\r\n * - Density toggle (compact, comfortable, spacious)\r\n * - Rich event cards with avatars, icons, status badges\r\n * - Relative time formatting with tooltip\r\n * - In-timeline search\r\n * - Keyboard navigation (J/K, Enter, /, Esc)\r\n * - Type filters with counts\r\n * - Skeleton loading\r\n * - Empty states with illustrations\r\n * - Export options\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { getTimeline, TimelineEvent, TimelineData } from '../services/graph';\r\nimport { formatRelativeTime, formatDate, formatDateTime } from '../utils/format';\r\n\r\n// ============================================\r\n// TYPES\r\n// ============================================\r\n\r\nexport interface TimelinePanelProps {\r\n  onEventClick?: (event: TimelineEvent) => void;\r\n  containerElement?: HTMLElement;\r\n}\r\n\r\ninterface EventTypeConfig {\r\n  label: string;\r\n  icon: string;\r\n  color: string;\r\n}\r\n\r\ntype Density = 'compact' | 'comfortable' | 'spacious';\r\n\r\n// ============================================\r\n// CONSTANTS\r\n// ============================================\r\n\r\nconst EVENT_TYPES: Record<string, EventTypeConfig> = {\r\n  document: { label: 'Documents', icon: '', color: '#1abc9c' },\r\n  transcript: { label: 'Transcripts', icon: '', color: '#8b5cf6' },\r\n  email: { label: 'Emails', icon: '', color: '#6366f1' },\r\n  conversation: { label: 'Conversations', icon: '', color: '#ec4899' },\r\n  chat_session: { label: 'Chat Sessions', icon: '', color: '#0ea5e9' },\r\n  fact: { label: 'Facts', icon: '', color: '#3b82f6' },\r\n  question: { label: 'Questions', icon: '', color: '#f59e0b' },\r\n  question_answered: { label: 'Answered', icon: '', color: '#10b981' },\r\n  decision: { label: 'Decisions', icon: '', color: '#3498db' },\r\n  risk: { label: 'Risks', icon: '', color: '#f39c12' },\r\n  action: { label: 'Actions', icon: '', color: '#9b59b6' },\r\n  action_completed: { label: 'Completed', icon: '', color: '#2ecc71' },\r\n  deadline: { label: 'Deadlines', icon: '', color: '#9b59b6' },\r\n};\r\n\r\nconst DAY_PERIODS = [\r\n  { label: 'Last 7 days', days: 7 },\r\n  { label: 'Last 14 days', days: 14 },\r\n  { label: 'Last 30 days', days: 30 },\r\n  { label: 'Last 90 days', days: 90 },\r\n  { label: 'All time', days: 365 },\r\n];\r\n\r\n// ============================================\r\n// STATE\r\n// ============================================\r\n\r\nlet currentDays = 30;\r\nlet currentDensity: Density = 'comfortable';\r\nlet currentTypeFilters: string[] = [];\r\nlet currentSearch = '';\r\nlet allEvents: TimelineEvent[] = [];\r\nlet focusedEventIndex = -1;\r\n\r\n// ============================================\r\n// MAIN COMPONENT\r\n// ============================================\r\n\r\n/**\r\n * Create SOTA Timeline Panel\r\n */\r\nexport function createTimelinePanel(props: TimelinePanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'timeline-panel sot-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Timeline</h2>\r\n        <span class=\"panel-count\" id=\"timeline-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <div class=\"timeline-search-wrapper\">\r\n          <input type=\"text\" id=\"timeline-search\" class=\"timeline-search\" placeholder=\"Search events...\" />\r\n        </div>\r\n        <select id=\"timeline-period\" class=\"filter-select\">\r\n          ${DAY_PERIODS.map(p => `<option value=\"${p.days}\" ${p.days === currentDays ? 'selected' : ''}>${p.label}</option>`).join('')}\r\n        </select>\r\n        <div class=\"density-toggle\" title=\"View density\">\r\n          <button class=\"density-btn ${currentDensity === 'compact' ? 'active' : ''}\" data-density=\"compact\" title=\"Compact\"></button>\r\n          <button class=\"density-btn ${currentDensity === 'comfortable' ? 'active' : ''}\" data-density=\"comfortable\" title=\"Comfortable\"></button>\r\n          <button class=\"density-btn ${currentDensity === 'spacious' ? 'active' : ''}\" data-density=\"spacious\" title=\"Spacious\"></button>\r\n        </div>\r\n        <div class=\"timeline-actions-menu\">\r\n          <button class=\"btn btn-secondary btn-sm timeline-export-btn\" title=\"Export\"></button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"timeline-filters\" id=\"timeline-type-filters\">\r\n      <button class=\"filter-chip active\" data-type=\"\">All</button>\r\n    </div>\r\n    <div class=\"timeline-content\" id=\"timeline-content\">\r\n      ${renderSkeletons()}\r\n    </div>\r\n    <div class=\"timeline-footer hidden\" id=\"timeline-footer\">\r\n      <button class=\"btn btn-secondary btn-sm\" id=\"timeline-load-more\">Load more</button>\r\n    </div>\r\n  `;\r\n\r\n  bindEvents(panel, props);\r\n  loadTimeline(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n// ============================================\r\n// EVENT BINDING\r\n// ============================================\r\n\r\nfunction bindEvents(panel: HTMLElement, props: TimelinePanelProps): void {\r\n  // Period selector\r\n  const periodSelect = panel.querySelector('#timeline-period') as HTMLSelectElement;\r\n  on(periodSelect, 'change', () => {\r\n    currentDays = parseInt(periodSelect.value);\r\n    loadTimeline(panel, props);\r\n  });\r\n\r\n  // Density toggle\r\n  const densityBtns = panel.querySelectorAll('.density-btn');\r\n  densityBtns.forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      densityBtns.forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n      currentDensity = btn.getAttribute('data-density') as Density;\r\n      updateDensity(panel);\r\n    });\r\n  });\r\n\r\n  // Search\r\n  const searchInput = panel.querySelector('#timeline-search') as HTMLInputElement;\r\n  let searchTimeout: ReturnType<typeof setTimeout>;\r\n  on(searchInput, 'input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = setTimeout(() => {\r\n      currentSearch = searchInput.value.toLowerCase();\r\n      renderFilteredEvents(panel, props);\r\n    }, 200);\r\n  });\r\n\r\n  // Export\r\n  const exportBtn = panel.querySelector('.timeline-export-btn');\r\n  if (exportBtn) {\r\n    on(exportBtn as HTMLElement, 'click', () => showExportMenu(panel));\r\n  }\r\n\r\n  // Keyboard navigation\r\n  on(panel, 'keydown', (e: KeyboardEvent) => {\r\n    const content = panel.querySelector('#timeline-content');\r\n    if (!content) return;\r\n\r\n    if (e.key === 'j' || e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      navigateEvents(panel, 1, props);\r\n    } else if (e.key === 'k' || e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      navigateEvents(panel, -1, props);\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      selectFocusedEvent(panel, props);\r\n    } else if (e.key === '/') {\r\n      e.preventDefault();\r\n      searchInput.focus();\r\n    } else if (e.key === 'Escape') {\r\n      searchInput.blur();\r\n      focusedEventIndex = -1;\r\n      clearEventFocus(panel);\r\n    }\r\n  });\r\n\r\n  // Make panel focusable for keyboard events\r\n  panel.setAttribute('tabindex', '0');\r\n}\r\n\r\n// ============================================\r\n// DATA LOADING\r\n// ============================================\r\n\r\nasync function loadTimeline(panel: HTMLElement, props: TimelinePanelProps): Promise<void> {\r\n  const content = panel.querySelector('#timeline-content') as HTMLElement;\r\n  content.innerHTML = renderSkeletons();\r\n\r\n  try {\r\n    const endDate = new Date();\r\n    const startDate = new Date();\r\n    startDate.setDate(startDate.getDate() - currentDays);\r\n\r\n    const data: TimelineData = await getTimeline({\r\n      startDate: startDate.toISOString().split('T')[0],\r\n      endDate: endDate.toISOString().split('T')[0],\r\n      limit: 500,\r\n    });\r\n\r\n    allEvents = data.events || [];\r\n    updateTypeCounts(panel, allEvents);\r\n    renderFilteredEvents(panel, props);\r\n    updateCount(panel, allEvents.length);\r\n  } catch (error) {\r\n    console.error('Failed to load timeline:', error);\r\n    content.innerHTML = renderError();\r\n  }\r\n}\r\n\r\n// ============================================\r\n// RENDERING\r\n// ============================================\r\n\r\nfunction renderFilteredEvents(panel: HTMLElement, props: TimelinePanelProps): void {\r\n  let filtered = [...allEvents];\r\n\r\n  // Apply type filter\r\n  if (currentTypeFilters.length > 0) {\r\n    filtered = filtered.filter(e => currentTypeFilters.includes(e.type));\r\n  }\r\n\r\n  // Apply search filter\r\n  if (currentSearch) {\r\n    filtered = filtered.filter(e => {\r\n      const title = (e.title || '').toLowerCase();\r\n      const content = (e.content || e.description || '').toLowerCase();\r\n      const owner = (e.owner || e.user || e.actor || '').toLowerCase();\r\n      return title.includes(currentSearch) || content.includes(currentSearch) || owner.includes(currentSearch);\r\n    });\r\n  }\r\n\r\n  const content = panel.querySelector('#timeline-content') as HTMLElement;\r\n\r\n  if (filtered.length === 0) {\r\n    content.innerHTML = renderEmptyState();\r\n    return;\r\n  }\r\n\r\n  // Group by date\r\n  const grouped = groupByDate(filtered);\r\n  const today = new Date().toISOString().split('T')[0];\r\n\r\n  content.innerHTML = `\r\n    <div class=\"timeline-list density-${currentDensity}\">\r\n      ${Object.entries(grouped).map(([date, events]) => `\r\n        <div class=\"timeline-day\" data-date=\"${date}\">\r\n          <div class=\"timeline-date-header sticky\">\r\n            <span class=\"date-label\">${formatDateLabel(date)}</span>\r\n            <span class=\"event-count\">${events.length} event${events.length === 1 ? '' : 's'}</span>\r\n          </div>\r\n          ${date === today ? '<div class=\"today-marker\"><span>Today</span></div>' : ''}\r\n          <div class=\"timeline-day-events\">\r\n            ${events.map((event, idx) => renderEventCard(event, idx)).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  bindEventCardClicks(panel, filtered, props);\r\n  focusedEventIndex = -1;\r\n}\r\n\r\nfunction renderEventCard(event: TimelineEvent, index: number): string {\r\n  const config = EVENT_TYPES[event.type] || { label: event.type, icon: '', color: '#888' };\r\n  const icon = event.icon || config.icon;\r\n  const color = event.color || config.color;\r\n  const owner = event.owner || event.user || event.actor;\r\n  const initials = owner ? getInitials(owner) : '';\r\n  const statusBadge = event.status ? `<span class=\"status-badge status-${event.status}\">${event.status}</span>` : '';\r\n  const time = event.date ? formatTime(event.date) : '';\r\n  const relativeTime = event.date ? formatRelativeTime(event.date) : '';\r\n  const fullDateTime = event.date ? formatDateTime(event.date) : '';\r\n\r\n  return `\r\n    <div class=\"timeline-event\" data-id=\"${event.id}\" data-index=\"${index}\" tabindex=\"0\">\r\n      <div class=\"event-avatar\" style=\"--event-color: ${color}\">\r\n        ${initials || icon}\r\n      </div>\r\n      <div class=\"event-body\">\r\n        <div class=\"event-header\">\r\n          <span class=\"event-type-badge\" style=\"--event-color: ${color}\">\r\n            <span class=\"type-icon\">${icon}</span>\r\n            ${config.label}\r\n          </span>\r\n          ${statusBadge}\r\n          <span class=\"event-time\" title=\"${fullDateTime}\">${relativeTime}</span>\r\n        </div>\r\n        <div class=\"event-title\">${escapeHtml(event.title)}</div>\r\n        ${event.content || event.description ? `<div class=\"event-content\">${escapeHtml(truncate(event.content || event.description || '', 150))}</div>` : ''}\r\n        ${owner ? `<div class=\"event-owner\"><span class=\"owner-name\">by ${escapeHtml(owner)}</span></div>` : ''}\r\n      </div>\r\n      <div class=\"event-meta\">\r\n        <span class=\"meta-time\">${time}</span>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderSkeletons(): string {\r\n  const skeletonCount = 8;\r\n  return `\r\n    <div class=\"timeline-skeletons\">\r\n      ${Array(skeletonCount).fill(0).map(() => `\r\n        <div class=\"skeleton-event\">\r\n          <div class=\"skeleton-avatar shimmer\"></div>\r\n          <div class=\"skeleton-body\">\r\n            <div class=\"skeleton-line short shimmer\"></div>\r\n            <div class=\"skeleton-line long shimmer\"></div>\r\n            <div class=\"skeleton-line medium shimmer\"></div>\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderEmptyState(): string {\r\n  return `\r\n    <div class=\"timeline-empty\">\r\n      <div class=\"empty-illustration\">\r\n        <svg width=\"120\" height=\"120\" viewBox=\"0 0 120 120\" fill=\"none\">\r\n          <circle cx=\"60\" cy=\"60\" r=\"50\" fill=\"var(--bg-card)\" stroke=\"var(--border)\" stroke-width=\"2\"/>\r\n          <path d=\"M60 30V60L80 75\" stroke=\"var(--accent)\" stroke-width=\"4\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          <circle cx=\"60\" cy=\"60\" r=\"6\" fill=\"var(--accent)\"/>\r\n        </svg>\r\n      </div>\r\n      <h3>No events found</h3>\r\n      <p>Try adjusting your filters or date range</p>\r\n      <div class=\"empty-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"empty-clear-filters\">Clear Filters</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction renderError(): string {\r\n  return `\r\n    <div class=\"timeline-error\">\r\n      <div class=\"error-icon\"></div>\r\n      <h3>Failed to load timeline</h3>\r\n      <p>Please try again later</p>\r\n      <button class=\"btn btn-primary btn-sm\" id=\"timeline-retry\">Retry</button>\r\n    </div>\r\n  `;\r\n}\r\n\r\n// ============================================\r\n// TYPE FILTERS\r\n// ============================================\r\n\r\nfunction updateTypeCounts(panel: HTMLElement, events: TimelineEvent[]): void {\r\n  const counts: Record<string, number> = {};\r\n  events.forEach(e => {\r\n    counts[e.type] = (counts[e.type] || 0) + 1;\r\n  });\r\n\r\n  const container = panel.querySelector('#timeline-type-filters') as HTMLElement;\r\n  const typesWithEvents = Object.keys(counts).filter(type => counts[type] > 0);\r\n\r\n  container.innerHTML = `\r\n    <button class=\"filter-chip ${currentTypeFilters.length === 0 ? 'active' : ''}\" data-type=\"\">All (${events.length})</button>\r\n    ${typesWithEvents.map(type => {\r\n      const config = EVENT_TYPES[type] || { label: type, icon: '', color: '#888' };\r\n      const isActive = currentTypeFilters.includes(type);\r\n      return `\r\n        <button class=\"filter-chip ${isActive ? 'active' : ''}\" data-type=\"${type}\" style=\"--chip-color: ${config.color}\">\r\n          ${config.icon} ${config.label} (${counts[type]})\r\n        </button>\r\n      `;\r\n    }).join('')}\r\n  `;\r\n\r\n  // Bind filter clicks\r\n  const chips = container.querySelectorAll('.filter-chip');\r\n  chips.forEach(chip => {\r\n    on(chip as HTMLElement, 'click', () => {\r\n      const type = chip.getAttribute('data-type') || '';\r\n      if (!type) {\r\n        currentTypeFilters = [];\r\n        chips.forEach(c => c.classList.remove('active'));\r\n        chip.classList.add('active');\r\n      } else {\r\n        const allChip = container.querySelector('[data-type=\"\"]');\r\n        allChip?.classList.remove('active');\r\n\r\n        if (currentTypeFilters.includes(type)) {\r\n          currentTypeFilters = currentTypeFilters.filter(t => t !== type);\r\n          chip.classList.remove('active');\r\n        } else {\r\n          currentTypeFilters.push(type);\r\n          chip.classList.add('active');\r\n        }\r\n\r\n        if (currentTypeFilters.length === 0) {\r\n          allChip?.classList.add('active');\r\n        }\r\n      }\r\n      renderFilteredEvents(panel, {});\r\n    });\r\n  });\r\n}\r\n\r\n// ============================================\r\n// NAVIGATION & INTERACTION\r\n// ============================================\r\n\r\nfunction bindEventCardClicks(panel: HTMLElement, events: TimelineEvent[], props: TimelinePanelProps): void {\r\n  const cards = panel.querySelectorAll('.timeline-event');\r\n  cards.forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const event = events.find(e => String(e.id) === id);\r\n      if (event && props.onEventClick) {\r\n        props.onEventClick(event);\r\n      }\r\n    });\r\n  });\r\n\r\n  // Clear filters button in empty state\r\n  const clearBtn = panel.querySelector('#empty-clear-filters');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      currentTypeFilters = [];\r\n      currentSearch = '';\r\n      const searchInput = panel.querySelector('#timeline-search') as HTMLInputElement;\r\n      if (searchInput) searchInput.value = '';\r\n      updateTypeCounts(panel, allEvents);\r\n      renderFilteredEvents(panel, props);\r\n    });\r\n  }\r\n\r\n  // Retry button in error state\r\n  const retryBtn = panel.querySelector('#timeline-retry');\r\n  if (retryBtn) {\r\n    on(retryBtn as HTMLElement, 'click', () => loadTimeline(panel, props));\r\n  }\r\n}\r\n\r\nfunction navigateEvents(panel: HTMLElement, direction: number, props: TimelinePanelProps): void {\r\n  const cards = panel.querySelectorAll('.timeline-event');\r\n  if (cards.length === 0) return;\r\n\r\n  clearEventFocus(panel);\r\n  focusedEventIndex = Math.max(0, Math.min(cards.length - 1, focusedEventIndex + direction));\r\n  \r\n  const targetCard = cards[focusedEventIndex] as HTMLElement;\r\n  if (targetCard) {\r\n    targetCard.classList.add('focused');\r\n    targetCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\r\n    targetCard.focus();\r\n  }\r\n}\r\n\r\nfunction selectFocusedEvent(panel: HTMLElement, props: TimelinePanelProps): void {\r\n  const cards = panel.querySelectorAll('.timeline-event');\r\n  if (focusedEventIndex >= 0 && focusedEventIndex < cards.length) {\r\n    const card = cards[focusedEventIndex] as HTMLElement;\r\n    card.click();\r\n  }\r\n}\r\n\r\nfunction clearEventFocus(panel: HTMLElement): void {\r\n  panel.querySelectorAll('.timeline-event.focused').forEach(el => el.classList.remove('focused'));\r\n}\r\n\r\nfunction updateDensity(panel: HTMLElement): void {\r\n  const list = panel.querySelector('.timeline-list');\r\n  if (list) {\r\n    list.className = `timeline-list density-${currentDensity}`;\r\n  }\r\n}\r\n\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#timeline-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n// ============================================\r\n// EXPORT MENU\r\n// ============================================\r\n\r\nfunction showExportMenu(panel: HTMLElement): void {\r\n  const existing = panel.querySelector('.export-menu');\r\n  if (existing) {\r\n    existing.remove();\r\n    return;\r\n  }\r\n\r\n  const menu = createElement('div', { className: 'export-menu dropdown-menu' });\r\n  menu.innerHTML = `\r\n    <button class=\"dropdown-item\" data-format=\"csv\"> Export CSV</button>\r\n    <button class=\"dropdown-item\" data-format=\"json\"> Export JSON</button>\r\n  `;\r\n\r\n  const exportBtn = panel.querySelector('.timeline-export-btn');\r\n  if (exportBtn) {\r\n    exportBtn.appendChild(menu);\r\n  }\r\n\r\n  menu.querySelectorAll('.dropdown-item').forEach(item => {\r\n    on(item as HTMLElement, 'click', () => {\r\n      const format = item.getAttribute('data-format');\r\n      exportTimeline(format || 'csv');\r\n      menu.remove();\r\n    });\r\n  });\r\n\r\n  // Close on outside click\r\n  setTimeout(() => {\r\n    const closeHandler = (e: Event) => {\r\n      if (!menu.contains(e.target as Node)) {\r\n        menu.remove();\r\n        document.removeEventListener('click', closeHandler);\r\n      }\r\n    };\r\n    document.addEventListener('click', closeHandler);\r\n  }, 0);\r\n}\r\n\r\nfunction exportTimeline(format: string): void {\r\n  const data = allEvents.map(e => ({\r\n    date: e.date,\r\n    type: e.type,\r\n    title: e.title,\r\n    content: e.content || e.description,\r\n    owner: e.owner || e.user || e.actor,\r\n    status: e.status,\r\n  }));\r\n\r\n  let content: string;\r\n  let filename: string;\r\n  let mimeType: string;\r\n\r\n  if (format === 'csv') {\r\n    const headers = ['Date', 'Type', 'Title', 'Content', 'Owner', 'Status'];\r\n    const rows = data.map(d => [\r\n      d.date, d.type, `\"${(d.title || '').replace(/\"/g, '\"\"')}\"`,\r\n      `\"${(d.content || '').replace(/\"/g, '\"\"')}\"`,\r\n      `\"${(d.owner || '').replace(/\"/g, '\"\"')}\"`, d.status || ''\r\n    ].join(','));\r\n    content = [headers.join(','), ...rows].join('\\n');\r\n    filename = `timeline-${new Date().toISOString().split('T')[0]}.csv`;\r\n    mimeType = 'text/csv';\r\n  } else {\r\n    content = JSON.stringify(data, null, 2);\r\n    filename = `timeline-${new Date().toISOString().split('T')[0]}.json`;\r\n    mimeType = 'application/json';\r\n  }\r\n\r\n  const blob = new Blob([content], { type: mimeType });\r\n  const url = URL.createObjectURL(blob);\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = filename;\r\n  a.click();\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\n// ============================================\r\n// UTILITIES\r\n// ============================================\r\n\r\nfunction groupByDate(events: TimelineEvent[]): Record<string, TimelineEvent[]> {\r\n  const grouped: Record<string, TimelineEvent[]> = {};\r\n  \r\n  events.forEach(event => {\r\n    const date = event.date ? event.date.split('T')[0] : 'unknown';\r\n    if (!grouped[date]) grouped[date] = [];\r\n    grouped[date].push(event);\r\n  });\r\n\r\n  // Sort by date descending\r\n  return Object.fromEntries(\r\n    Object.entries(grouped).sort(([a], [b]) => b.localeCompare(a))\r\n  );\r\n}\r\n\r\nfunction formatDateLabel(dateStr: string): string {\r\n  const date = new Date(dateStr + 'T00:00:00');\r\n  const today = new Date();\r\n  const yesterday = new Date(today);\r\n  yesterday.setDate(yesterday.getDate() - 1);\r\n  const thisWeekStart = new Date(today);\r\n  thisWeekStart.setDate(today.getDate() - today.getDay());\r\n\r\n  const todayStr = today.toISOString().split('T')[0];\r\n  const yesterdayStr = yesterday.toISOString().split('T')[0];\r\n\r\n  if (dateStr === todayStr) return 'Today';\r\n  if (dateStr === yesterdayStr) return 'Yesterday';\r\n  if (date >= thisWeekStart) return 'This week - ' + formatDate(date, { weekday: 'long' });\r\n\r\n  return formatDate(date, { weekday: 'short', month: 'short', day: 'numeric' });\r\n}\r\n\r\nfunction formatTime(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(/\\s+/)\r\n    .map(part => part.charAt(0).toUpperCase())\r\n    .slice(0, 2)\r\n    .join('');\r\n}\r\n\r\nfunction truncate(text: string, maxLength: number): string {\r\n  if (text.length <= maxLength) return text;\r\n  return text.slice(0, maxLength - 3) + '...';\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createTimelinePanel;\r\n","/**\r\n * Billing Service\r\n * API client for project billing and cost control\r\n */\r\n\r\nimport { http } from './api';\r\n\r\n// ============================================\r\n// TYPES\r\n// ============================================\r\n\r\nexport interface ProjectBillingSummary {\r\n  balance_eur: number;\r\n  unlimited_balance: boolean;\r\n  period_key: string;\r\n  tokens_this_period: number;\r\n  provider_cost_this_period: number;\r\n  billable_cost_this_period: number;\r\n  requests_this_period: number;\r\n  current_tier_name: string | null;\r\n  current_markup_percent: number;\r\n  balance_percent_used: number;\r\n}\r\n\r\nexport interface ProjectBillingOverview {\r\n  project_id: string;\r\n  project_name: string;\r\n  balance_eur: number;\r\n  unlimited_balance: boolean;\r\n  tokens_this_period: number;\r\n  billable_cost_this_period: number;\r\n  is_blocked: boolean;\r\n  current_tier_name: string | null;\r\n}\r\n\r\nexport interface PricingConfig {\r\n  id: string;\r\n  scope: 'global' | 'project';\r\n  project_id: string | null;\r\n  fixed_markup_percent: number;\r\n  period_type: 'monthly' | 'weekly';\r\n  usd_to_eur_rate: number;\r\n  is_active: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n  pricing_tiers?: PricingTier[];\r\n}\r\n\r\nexport interface PricingTier {\r\n  id: string;\r\n  pricing_config_id: string;\r\n  token_limit: number | null;\r\n  markup_percent: number;\r\n  name: string | null;\r\n  tier_order: number;\r\n}\r\n\r\nexport interface BalanceTransaction {\r\n  id: string;\r\n  project_id: string;\r\n  transaction_type: 'credit' | 'debit' | 'adjustment' | 'refund';\r\n  amount_eur: number;\r\n  balance_before: number;\r\n  balance_after: number;\r\n  llm_request_id: string | null;\r\n  description: string | null;\r\n  performed_by: string | null;\r\n  created_at: string;\r\n}\r\n\r\nexport interface BalanceCheckResult {\r\n  allowed: boolean;\r\n  reason?: string;\r\n  balance_eur: number;\r\n  unlimited: boolean;\r\n  tokens_in_period: number;\r\n  current_tier_name?: string;\r\n  current_markup_percent: number;\r\n}\r\n\r\n// ============================================\r\n// ADMIN FUNCTIONS (Superadmin only)\r\n// ============================================\r\n\r\n/**\r\n * Get billing overview for all projects\r\n */\r\nexport async function getAllProjectsBilling(): Promise<ProjectBillingOverview[]> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; projects: ProjectBillingOverview[] }>(\r\n      '/api/admin/billing/projects'\r\n    );\r\n    return response.data?.projects || [];\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting all projects billing:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get global pricing config\r\n */\r\nexport async function getGlobalPricingConfig(): Promise<PricingConfig | null> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; config: PricingConfig }>(\r\n      '/api/admin/billing/pricing'\r\n    );\r\n    return response.data?.config || null;\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting global pricing config:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Set global pricing config\r\n */\r\nexport async function setGlobalPricingConfig(config: {\r\n  fixed_markup_percent?: number;\r\n  period_type?: 'monthly' | 'weekly';\r\n  usd_to_eur_rate?: number;\r\n}): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; error?: string }>(\r\n      '/api/admin/billing/pricing',\r\n      config\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting global pricing config:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Get global pricing tiers\r\n */\r\nexport async function getGlobalPricingTiers(): Promise<{ tiers: PricingTier[]; config_id: string | null }> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; tiers: PricingTier[]; config_id: string }>(\r\n      '/api/admin/billing/pricing/tiers'\r\n    );\r\n    return { \r\n      tiers: response.data?.tiers || [], \r\n      config_id: response.data?.config_id || null \r\n    };\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting global pricing tiers:', error);\r\n    return { tiers: [], config_id: null };\r\n  }\r\n}\r\n\r\n/**\r\n * Set global pricing tiers\r\n */\r\nexport async function setGlobalPricingTiers(tiers: Array<{\r\n  token_limit: number | null;\r\n  markup_percent: number;\r\n  name?: string;\r\n}>): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; error?: string }>(\r\n      '/api/admin/billing/pricing/tiers',\r\n      { tiers }\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting global pricing tiers:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Get project billing summary (admin)\r\n */\r\nexport async function getProjectBillingSummaryAdmin(projectId: string): Promise<ProjectBillingSummary | null> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; summary: ProjectBillingSummary }>(\r\n      `/api/admin/billing/projects/${projectId}`\r\n    );\r\n    return response.data?.summary || null;\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting project billing summary:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get project balance (admin)\r\n */\r\nexport async function getProjectBalance(projectId: string): Promise<BalanceCheckResult | null> {\r\n  try {\r\n    const response = await http.get<BalanceCheckResult & { success: boolean }>(\r\n      `/api/admin/billing/projects/${projectId}/balance`\r\n    );\r\n    if (response.data?.success) {\r\n      return response.data;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting project balance:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Credit project balance (admin)\r\n */\r\nexport async function creditProjectBalance(\r\n  projectId: string, \r\n  amount: number, \r\n  description?: string\r\n): Promise<{ success: boolean; new_balance?: number; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; new_balance: number; reason?: string }>(\r\n      `/api/admin/billing/projects/${projectId}/balance`,\r\n      { amount, description }\r\n    );\r\n    return {\r\n      success: response.data?.success || false,\r\n      new_balance: response.data?.new_balance,\r\n      error: response.data?.reason\r\n    };\r\n  } catch (error) {\r\n    console.error('[Billing] Error crediting project balance:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Set project unlimited mode (admin)\r\n */\r\nexport async function setProjectUnlimited(\r\n  projectId: string, \r\n  unlimited: boolean\r\n): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; unlimited: boolean }>(\r\n      `/api/admin/billing/projects/${projectId}/balance`,\r\n      { unlimited }\r\n    );\r\n    return { success: response.data?.success || false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting project unlimited:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Get project balance transactions (admin)\r\n */\r\nexport async function getBalanceTransactions(\r\n  projectId: string, \r\n  limit = 50\r\n): Promise<BalanceTransaction[]> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; transactions: BalanceTransaction[] }>(\r\n      `/api/admin/billing/projects/${projectId}/transactions?limit=${limit}`\r\n    );\r\n    return response.data?.transactions || [];\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting balance transactions:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Get project pricing override (admin)\r\n */\r\nexport async function getProjectPricingOverride(projectId: string): Promise<{\r\n  override: PricingConfig | null;\r\n  using_global: boolean;\r\n  global_config: PricingConfig | null;\r\n}> {\r\n  try {\r\n    const response = await http.get<{\r\n      success: boolean;\r\n      override: PricingConfig | null;\r\n      using_global: boolean;\r\n      global_config: PricingConfig | null;\r\n    }>(`/api/admin/billing/projects/${projectId}/pricing`);\r\n    return {\r\n      override: response.data?.override || null,\r\n      using_global: response.data?.using_global ?? true,\r\n      global_config: response.data?.global_config || null\r\n    };\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting project pricing override:', error);\r\n    return { override: null, using_global: true, global_config: null };\r\n  }\r\n}\r\n\r\n/**\r\n * Set project pricing override (admin)\r\n */\r\nexport async function setProjectPricingOverride(projectId: string, config: {\r\n  fixed_markup_percent?: number;\r\n  period_type?: 'monthly' | 'weekly';\r\n  usd_to_eur_rate?: number;\r\n  tiers?: Array<{\r\n    token_limit: number | null;\r\n    markup_percent: number;\r\n    name?: string;\r\n  }>;\r\n}): Promise<{ success: boolean; config_id?: string; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; config_id?: string; error?: string }>(\r\n      `/api/admin/billing/projects/${projectId}/pricing`,\r\n      config\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting project pricing override:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete project pricing override (admin)\r\n */\r\nexport async function deleteProjectPricingOverride(projectId: string): Promise<boolean> {\r\n  try {\r\n    const response = await http.delete<{ success: boolean }>(\r\n      `/api/admin/billing/projects/${projectId}/pricing`\r\n    );\r\n    return response.data?.success || false;\r\n  } catch (error) {\r\n    console.error('[Billing] Error deleting project pricing override:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// PROJECT FUNCTIONS (For project members)\r\n// ============================================\r\n\r\n/**\r\n * Get billing summary for current project\r\n */\r\nexport async function getProjectBillingSummary(projectId: string): Promise<ProjectBillingSummary | null> {\r\n  try {\r\n    const response = await http.get<{ success: boolean; summary: ProjectBillingSummary }>(\r\n      `/api/projects/${projectId}/billing`\r\n    );\r\n    return response.data?.summary || null;\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting project billing summary:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// ============================================\r\n// UTILITIES\r\n// ============================================\r\n\r\n/**\r\n * Format currency in EUR\r\n */\r\nexport function formatEur(amount: number): string {\r\n  return new Intl.NumberFormat('pt-PT', {\r\n    style: 'currency',\r\n    currency: 'EUR',\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2\r\n  }).format(amount);\r\n}\r\n\r\n/**\r\n * Format large numbers (tokens)\r\n */\r\nexport function formatTokens(count: number): string {\r\n  if (count >= 1_000_000) {\r\n    return `${(count / 1_000_000).toFixed(1)}M`;\r\n  }\r\n  if (count >= 1_000) {\r\n    return `${(count / 1_000).toFixed(1)}K`;\r\n  }\r\n  return count.toString();\r\n}\r\n\r\n/**\r\n * Get tier display info\r\n */\r\nexport function getTierDisplayInfo(tiers: PricingTier[]): string {\r\n  if (!tiers || tiers.length === 0) {\r\n    return 'No tiers configured';\r\n  }\r\n  \r\n  return tiers.map((tier, index) => {\r\n    const prevLimit = index > 0 ? tiers[index - 1].token_limit : 0;\r\n    const fromStr = formatTokens(prevLimit || 0);\r\n    const toStr = tier.token_limit ? formatTokens(tier.token_limit) : '';\r\n    return `${fromStr}-${toStr}: +${tier.markup_percent}%`;\r\n  }).join(' | ');\r\n}\r\n\r\n// ============================================\r\n// SERVICE EXPORT\r\n// ============================================\r\n\r\n// ============================================\r\n// EXCHANGE RATE\r\n// ============================================\r\n\r\nexport interface ExchangeRateConfig {\r\n  auto: boolean;\r\n  manualRate: number;\r\n  currentRate: number;\r\n  source: string;\r\n  lastUpdated: string | null;\r\n  defaultRate: number;\r\n}\r\n\r\n/**\r\n * Get exchange rate configuration\r\n */\r\nexport async function getExchangeRateConfig(): Promise<ExchangeRateConfig | null> {\r\n  try {\r\n    const response = await http.get<{ success: boolean } & ExchangeRateConfig>(\r\n      '/api/admin/billing/exchange-rate'\r\n    );\r\n    if (!response.data?.success) return null;\r\n    return {\r\n      auto: response.data.auto,\r\n      manualRate: response.data.manualRate,\r\n      currentRate: response.data.currentRate,\r\n      source: response.data.source,\r\n      lastUpdated: response.data.lastUpdated,\r\n      defaultRate: response.data.defaultRate\r\n    };\r\n  } catch (error) {\r\n    console.error('[Billing] Error getting exchange rate config:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Set exchange rate mode\r\n */\r\nexport async function setExchangeRateMode(\r\n  auto: boolean,\r\n  manualRate?: number\r\n): Promise<{ success: boolean; error?: string }> {\r\n  try {\r\n    const response = await http.post<{ success: boolean; error?: string }>(\r\n      '/api/admin/billing/exchange-rate',\r\n      { auto, manualRate }\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error setting exchange rate mode:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\n/**\r\n * Refresh exchange rate from API\r\n */\r\nexport async function refreshExchangeRate(): Promise<{ \r\n  success: boolean; \r\n  rate?: number; \r\n  source?: string;\r\n  error?: string \r\n}> {\r\n  try {\r\n    const response = await http.post<{ \r\n      success: boolean; \r\n      rate: number; \r\n      source: string;\r\n      error?: string \r\n    }>(\r\n      '/api/admin/billing/exchange-rate/refresh',\r\n      {}\r\n    );\r\n    return response.data || { success: false };\r\n  } catch (error) {\r\n    console.error('[Billing] Error refreshing exchange rate:', error);\r\n    return { success: false, error: String(error) };\r\n  }\r\n}\r\n\r\nexport const billingService = {\r\n  // Admin functions\r\n  getAllProjectsBilling,\r\n  getGlobalPricingConfig,\r\n  setGlobalPricingConfig,\r\n  getGlobalPricingTiers,\r\n  setGlobalPricingTiers,\r\n  getProjectBillingSummaryAdmin,\r\n  getProjectBalance,\r\n  creditProjectBalance,\r\n  setProjectUnlimited,\r\n  getBalanceTransactions,\r\n  getProjectPricingOverride,\r\n  setProjectPricingOverride,\r\n  deleteProjectPricingOverride,\r\n  \r\n  // Exchange rate\r\n  getExchangeRateConfig,\r\n  setExchangeRateMode,\r\n  refreshExchangeRate,\r\n  \r\n  // Project functions\r\n  getProjectBillingSummary,\r\n  \r\n  // Utilities\r\n  formatEur,\r\n  formatTokens,\r\n  getTierDisplayInfo\r\n};\r\n\r\nexport default billingService;\r\n","/**\n * Costs Dashboard Component\n * LLM costs tracking and visualization\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { createModal, openModal, closeModal } from './Modal';\nimport { costsService, CostSummary, RecentCostRequest } from '../services/graph';\nimport { formatCurrency, formatNumber } from '../utils/format';\nimport { toast } from '../services/toast';\nimport { billingService, type ProjectBillingSummary, formatEur, formatTokens } from '../services/billing';\nimport { appStore } from '../stores/app';\nimport { fetchWithProject } from '../services/api';\n\n// Billing state\nlet billingSummary: ProjectBillingSummary | null = null;\n\nconst BUDGET_MODAL_ID = 'costs-budget-modal';\n\nexport interface CostsDashboardProps {\n  period?: 'day' | 'week' | 'month' | 'all';\n}\n\n/**\n * Create costs dashboard component\n */\nexport function createCostsDashboard(props: CostsDashboardProps = {}): HTMLElement {\n  const { period = 'month' } = props;\n\n  const container = createElement('div', { className: 'costs-dashboard' });\n\n  container.innerHTML = `\n    <div class=\"costs-header\">\n      <div class=\"costs-header-title\">\n        <h3>LLM Costs</h3>\n        <span class=\"costs-period-range\" id=\"costs-period-range\" aria-live=\"polite\"></span>\n      </div>\n      <div class=\"costs-header-actions\">\n        <select id=\"costs-period\" class=\"filter-select\" aria-label=\"Time period\">\n          <option value=\"day\" ${period === 'day' ? 'selected' : ''}>Today</option>\n          <option value=\"week\" ${period === 'week' ? 'selected' : ''}>This Week</option>\n          <option value=\"month\" ${period === 'month' ? 'selected' : ''}>This Month</option>\n          <option value=\"all\" ${period === 'all' ? 'selected' : ''}>All Time</option>\n        </select>\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-export-btn\" title=\"Export CSV or JSON\">Export</button>\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-pricing-btn\" title=\"View pricing table\">Pricing</button>\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"costs-budget-btn\" title=\"Set budget and alert\">Budget</button>\n      </div>\n    </div>\n    <div class=\"costs-content\" id=\"costs-content\">\n      <div class=\"loading\">Loading costs...</div>\n    </div>\n    <div id=\"costs-pricing-panel\" class=\"costs-pricing-panel hidden\" aria-hidden=\"true\"></div>\n  `;\n\n  // Bind events\n  const periodSelect = container.querySelector('#costs-period') as HTMLSelectElement;\n  on(periodSelect, 'change', () => {\n    loadCosts(container, periodSelect.value as 'day' | 'week' | 'month' | 'all');\n  });\n  const exportBtn = container.querySelector('#costs-export-btn');\n  if (exportBtn) {\n    on(exportBtn, 'click', () => handleExport(periodSelect.value as 'day' | 'week' | 'month' | 'all'));\n  }\n  const pricingBtn = container.querySelector('#costs-pricing-btn');\n  const pricingPanel = container.querySelector('#costs-pricing-panel') as HTMLElement;\n  if (pricingBtn && pricingPanel) {\n    on(pricingBtn, 'click', () => togglePricingPanel(pricingPanel));\n  }\n  on(container, 'click', (e: Event) => {\n    if ((e.target as HTMLElement).id === 'costs-pricing-close') {\n      pricingPanel?.classList.add('hidden');\n      pricingPanel?.setAttribute('aria-hidden', 'true');\n    }\n  });\n  const budgetBtn = container.querySelector('#costs-budget-btn');\n  if (budgetBtn) {\n    on(budgetBtn, 'click', () => showBudgetModal(container, periodSelect));\n  }\n\n  // Initial load\n  loadCosts(container, period);\n\n  return container;\n}\n\n/**\n * Load costs data\n */\nasync function loadCosts(container: HTMLElement, period: 'day' | 'week' | 'month' | 'all'): Promise<void> {\n  const content = container.querySelector('#costs-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    // Get current project ID\n    const state = appStore.getState();\n    const projectId = state.currentProject?.id;\n    \n    const [data, recentRequests, billing] = await Promise.all([\n      costsService.getSummary(period),\n      costsService.getRecentRequests(20),\n      projectId ? billingService.getProjectBillingSummary(projectId) : Promise.resolve(null)\n    ]);\n    \n    billingSummary = billing;\n    renderCosts(content, data, recentRequests);\n    const periodRangeEl = container.querySelector('#costs-period-range');\n    if (periodRangeEl) periodRangeEl.textContent = formatPeriod(data.period ?? { start: '', end: '' });\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load costs</div>';\n  }\n}\n\n/**\n * Render costs\n */\nfunction renderCosts(\n  container: HTMLElement,\n  data: CostSummary,\n  recentRequests: RecentCostRequest[] = []\n): void {\n  const dailyBreakdown = data.dailyBreakdown ?? [];\n  const byProvider = data.byProvider ?? {};\n  const byModel = data.byModel ?? {};\n  const totalCalls = dailyBreakdown.reduce((sum, d) => sum + (d.calls ?? 0), 0);\n  const avgPerCall = totalCalls > 0 ? data.total / totalCalls : 0;\n\n  // Convert records to arrays for rendering (normalize empty operation keys to \"other\")\n  const byProviderArray = Object.entries(byProvider)\n    .map(([provider, cost]) => ({ provider, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  const byModelArray = Object.entries(byModel)\n    .map(([model, cost]) => ({ model, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  const byOperationMap = new Map<string, number>();\n  for (const [op, cost] of Object.entries(data.byOperation || {})) {\n    const key = (op && String(op).trim()) ? String(op).trim() : 'other';\n    byOperationMap.set(key, (byOperationMap.get(key) ?? 0) + cost);\n  }\n  const byOperationArray = Array.from(byOperationMap.entries())\n    .map(([operation, cost]) => ({ operation, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  // By context: sort by cost desc, show \"unknown\" as \"Other\"\n  const byContextArray = Object.entries(data.byContext || {})\n    .map(([ctx, cost]) => ({ context: (ctx === 'unknown' || !ctx?.trim()) ? 'Other' : ctx, cost }))\n    .sort((a, b) => b.cost - a.cost);\n  const totalInput = data.totalInputTokens ?? 0;\n  const totalOutput = data.totalOutputTokens ?? 0;\n  const hasNoData =\n    (data.total ?? 0) === 0 &&\n    dailyBreakdown.length === 0 &&\n    Object.keys(byProvider).length === 0 &&\n    Object.keys(byModel).length === 0;\n  const periodChangeHtml =\n    data.previousPeriodCost != null && data.percentChange != null\n      ? `<div class=\"card-sub period-change ${data.percentChange >= 0 ? 'up' : 'down'}\">vs previous period: ${data.percentChange >= 0 ? '+' : ''}${data.percentChange.toFixed(1)}%</div>`\n      : '';\n\n  const budgetHtml =\n    data.budgetLimit != null && data.budgetUsedPercent != null\n      ? `\n    <div class=\"costs-budget-bar ${data.budgetAlertTriggered ? 'alert' : ''}\">\n      <div class=\"costs-budget-bar-fill\" style=\"--budget-width: ${Math.min(100, data.budgetUsedPercent)}%\"></div>\n      <span class=\"costs-budget-label\">${formatCurrency(data.total)} / ${formatCurrency(data.budgetLimit)} (${data.budgetUsedPercent}%)</span>\n      ${data.budgetAlertTriggered ? '<span class=\"costs-budget-alert\">Alert threshold reached</span>' : ''}\n    </div>`\n      : !hasNoData\n      ? '<div class=\"costs-budget-bar costs-budget-bar-empty\"><span class=\"costs-budget-label\">No budget set</span><span class=\"costs-budget-set-hint\">Use the Budget button above to set a limit.</span></div>'\n      : '';\n\n  const emptyStateHtml =\n    hasNoData\n      ? '<div class=\"costs-empty-state\">No cost data for this period. LLM usage from Chat, document processing, and other features will appear here.</div>'\n      : '';\n\n  // Build billing banner HTML\n  let billingBannerHtml = '';\n  if (billingSummary) {\n    const balanceDisplay = billingSummary.unlimited_balance \n      ? '<span class=\"costs-unlimited\"> Unlimited</span>'\n      : formatEur(billingSummary.balance_eur);\n    \n    const statusBadge = billingSummary.unlimited_balance\n      ? '<span class=\"badge badge-success costs-badge-sm\">Unlimited</span>'\n      : billingSummary.balance_eur <= 0\n        ? '<span class=\"badge badge-danger costs-badge-sm\">Blocked</span>'\n        : billingSummary.balance_percent_used >= 80\n          ? '<span class=\"badge badge-warning costs-badge-sm\">Low Balance</span>'\n          : '<span class=\"badge badge-primary costs-badge-sm\">Active</span>';\n    \n    billingBannerHtml = `\n      <div class=\"billing-summary-banner\">\n        <div class=\"billing-summary-row\">\n          <div>\n            <div class=\"billing-summary-label\">Project Balance</div>\n            <div class=\"billing-summary-value\">${balanceDisplay}</div>\n          </div>\n          <div>\n            <div class=\"billing-summary-label\">Status</div>\n            <div>${statusBadge}</div>\n          </div>\n          ${billingSummary.current_tier_name ? `\n          <div>\n            <div class=\"billing-summary-label\">Current Tier</div>\n            <div class=\"billing-summary-tier\">${billingSummary.current_tier_name} (+${billingSummary.current_markup_percent}%)</div>\n          </div>\n          ` : ''}\n        </div>\n        <div class=\"billing-summary-meta\">\n          <div>\n            <strong>${formatTokens(billingSummary.tokens_this_period)}</strong> tokens this period\n          </div>\n          <div>\n            <strong>${formatEur(billingSummary.billable_cost_this_period)}</strong> billed (${billingSummary.period_key})\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  container.innerHTML = `\n    ${billingBannerHtml}\n    <div class=\"costs-dashboard-row\">\n      <div class=\"costs-stats-grid stats-grid\">\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-total\">\n          <div class=\"stat-value\">${formatCurrency(data.total)}</div>\n          <div class=\"stat-label\">Total Cost</div>\n          ${periodChangeHtml}\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-calls\">\n          <div class=\"stat-value\">${formatNumber(totalCalls)}</div>\n          <div class=\"stat-label\">API Calls</div>\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-avg\">\n          <div class=\"stat-value\">${formatCurrency(avgPerCall)}</div>\n          <div class=\"stat-label\">Avg per Call</div>\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-input\">\n          <div class=\"stat-value\">${formatNumber(totalInput)}</div>\n          <div class=\"stat-label\">Input Tokens</div>\n        </div>\n        <div class=\"costs-stat-card stat-card\" data-stat-id=\"cost-output\">\n          <div class=\"stat-value\">${formatNumber(totalOutput)}</div>\n          <div class=\"stat-label\">Output Tokens</div>\n        </div>\n      </div>\n    </div>\n    ${budgetHtml}\n    ${emptyStateHtml}\n\n    <div class=\"costs-chart-section chart-container\">\n      <h4 class=\"costs-chart-title\">Daily Costs</h4>\n      <div class=\"costs-chart-inner\">\n        ${renderDailyChart(dailyBreakdown, data.period ?? { start: '', end: '' })}\n      </div>\n    </div>\n\n    <div class=\"costs-breakdown\">\n      <div class=\"breakdown-section\">\n        <h4>By Provider</h4>\n        <div class=\"breakdown-list\">\n          ${byProviderArray.length > 0 ? byProviderArray.map(p => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(p.provider)}</span>\n              <span class=\"item-value\">${formatCurrency(p.cost)}</span>\n            </div>\n          `).join('') : '<div class=\"empty\">No data</div>'}\n        </div>\n      </div>\n\n      <div class=\"breakdown-section\">\n        <h4>By Model</h4>\n        <div class=\"breakdown-list\">\n          ${byModelArray.length > 0 ? byModelArray.map(m => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(m.model)}</span>\n              <span class=\"item-value\">${formatCurrency(m.cost)}</span>\n            </div>\n          `).join('') : '<div class=\"empty\">No data</div>'}\n        </div>\n      </div>\n\n      <div class=\"breakdown-section\">\n        <h4>By Operation</h4>\n        <div class=\"breakdown-list\">\n          ${byOperationArray.length > 0 ? byOperationArray.map(o => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(o.operation)}</span>\n              <span class=\"item-value\">${formatCurrency(o.cost)}</span>\n            </div>\n          `).join('') : '<div class=\"empty\">No data</div>'}\n        </div>\n      </div>\n\n      ${byContextArray.length > 0 ? `\n      <div class=\"breakdown-section\">\n        <h4>By Context</h4>\n        <div class=\"breakdown-list\">\n          ${byContextArray.map(c => `\n            <div class=\"breakdown-item\">\n              <span class=\"item-name\">${escapeHtml(c.context)}</span>\n              <span class=\"item-value\">${formatCurrency(c.cost)}</span>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n      ` : ''}\n    </div>\n\n    <div class=\"costs-recent-section\">\n      <h4>Recent Requests <span class=\"costs-recent-caption\">(last 20, all time)</span></h4>\n      ${renderRecentRequests(recentRequests)}\n    </div>\n  `;\n}\n\n/**\n * Render recent requests table\n */\nfunction renderRecentRequests(requests: RecentCostRequest[]): string {\n  if (!requests.length) {\n    return '<div class=\"empty-recent\">No recent requests</div>';\n  }\n  return `\n    <div class=\"costs-recent-table-wrap\">\n      <table class=\"costs-recent-table\" aria-label=\"Recent LLM requests\">\n        <thead>\n          <tr>\n            <th>Time</th>\n            <th>Provider / Model</th>\n            <th>Operation</th>\n            <th>Tokens</th>\n            <th>Cost</th>\n            <th>Latency</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${requests\n            .slice(0, 20)\n            .map(\n              (r) => `\n            <tr>\n              <td>${formatRequestTime(r.timestamp)}</td>\n              <td>${escapeHtml(r.provider)} / ${escapeHtml(r.model)}</td>\n              <td>${escapeHtml(r.request_type || r.operation || '')}</td>\n              <td>${(r.input_tokens ?? 0)}+${r.output_tokens ?? 0}</td>\n              <td>${r.cost != null ? formatCurrency(r.cost) : ''}</td>\n              <td>${r.latency_ms != null ? `${r.latency_ms}ms` : ''}</td>\n            </tr>\n          `\n            )\n            .join('')}\n        </tbody>\n      </table>\n    </div>\n  `;\n}\n\nfunction formatRequestTime(iso: string): string {\n  const d = new Date(iso);\n  const now = new Date();\n  const diffMs = now.getTime() - d.getTime();\n  if (diffMs < 60000) return 'Just now';\n  if (diffMs < 3600000) return `${Math.floor(diffMs / 60000)}m ago`;\n  if (diffMs < 86400000) return `${Math.floor(diffMs / 3600000)}h ago`;\n  return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });\n}\n\n/**\n * Export costs as CSV or JSON (user chooses via prompt)\n */\nasync function handleExport(period: 'day' | 'week' | 'month' | 'all'): Promise<void> {\n  const format = window.confirm('Download as JSON?\\n\\nCancel = CSV, OK = JSON') ? 'json' : 'csv';\n  const ext = format === 'json' ? 'json' : 'csv';\n  const url = `/api/costs/export?period=${period}&format=${format}`;\n  try {\n    const res = await fetchWithProject(url);\n    if (!res.ok) throw new Error(res.statusText);\n    const blob = await res.blob();\n    const name = `llm-costs-${period}-${new Date().toISOString().split('T')[0]}.${ext}`;\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = name;\n    a.click();\n    URL.revokeObjectURL(a.href);\n  } catch (e) {\n    console.error('Export failed:', e);\n    alert('Export failed. Try again.');\n  }\n}\n\n/**\n * Toggle pricing panel (fetch on first open)\n */\nasync function togglePricingPanel(panel: HTMLElement): Promise<void> {\n  const isHidden = panel.classList.contains('hidden');\n  if (isHidden && !panel.innerHTML.trim()) {\n    panel.innerHTML = '<div class=\"loading\">Loading pricing...</div>';\n    panel.classList.remove('hidden');\n    panel.setAttribute('aria-hidden', 'false');\n    try {\n      const pricing = await costsService.getPricing();\n      panel.innerHTML = renderPricingTable(pricing);\n    } catch {\n      panel.innerHTML = '<div class=\"error\">Failed to load pricing</div>';\n    }\n  } else {\n    panel.classList.toggle('hidden');\n    panel.setAttribute('aria-hidden', String(panel.classList.contains('hidden')));\n  }\n}\n\nasync function showBudgetModal(container: HTMLElement, periodSelect: HTMLSelectElement): Promise<void> {\n  const period = periodSelect.value as 'day' | 'week' | 'month' | 'all';\n  const budgetPeriod: 'week' | 'month' =\n    period === 'week' ? 'week' : period === 'month' ? 'month' : 'month';\n\n  const existing = document.querySelector(`[data-modal-id=\"${BUDGET_MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  let currentLimit = 100;\n  let currentThreshold = 80;\n  try {\n    const budget = await costsService.getBudget(budgetPeriod);\n    if (budget?.limitUsd != null && budget.limitUsd > 0) currentLimit = budget.limitUsd;\n    if (budget?.alertThresholdPercent != null) currentThreshold = Math.min(100, Math.max(0, budget.alertThresholdPercent));\n  } catch {\n    // use defaults\n  }\n\n  const body = createElement('div', { className: 'costs-budget-modal-body' });\n  body.innerHTML = `\n    <p class=\"costs-budget-modal-desc\">Set a ${budgetPeriod}ly spending limit and get an alert when usage reaches a percentage of that limit.</p>\n    <div class=\"form-group\">\n      <label for=\"costs-budget-limit\">Budget limit (USD)</label>\n      <input type=\"number\" id=\"costs-budget-limit\" class=\"form-input\" min=\"1\" max=\"999999\" step=\"0.01\" value=\"${currentLimit}\" placeholder=\"e.g. 100\" aria-label=\"Budget limit in USD\">\n      <span class=\"form-hint\">Min 1 USD</span>\n    </div>\n    <div class=\"form-group\">\n      <label for=\"costs-budget-threshold\">Alert when usage reaches (%)</label>\n      <input type=\"number\" id=\"costs-budget-threshold\" class=\"form-input\" min=\"0\" max=\"100\" value=\"${currentThreshold}\" placeholder=\"e.g. 80\" aria-label=\"Alert threshold percentage\">\n      <span class=\"form-hint\">0100%</span>\n    </div>\n    <p class=\"costs-budget-modal-hint\" role=\"status\">You will be notified when LLM costs reach this percentage of your budget.</p>\n  `;\n\n  const footer = createElement('div', { className: 'modal-footer' });\n  const cancelBtn = createElement('button', { className: 'btn btn-secondary', textContent: 'Cancel' });\n  const saveBtn = createElement('button', { className: 'btn btn-primary', textContent: 'Save budget' });\n\n  const modal = createModal({\n    id: BUDGET_MODAL_ID,\n    title: `Set ${budgetPeriod === 'week' ? 'weekly' : 'monthly'} budget`,\n    content: body,\n    size: 'md',\n    closable: true,\n    footer,\n  });\n\n  modal.classList.add('costs-budget-modal');\n\n  const hintEl = body.querySelector('.costs-budget-modal-hint') as HTMLElement;\n\n  on(cancelBtn, 'click', () => closeModal(BUDGET_MODAL_ID));\n  on(saveBtn, 'click', async () => {\n    const limitEl = body.querySelector('#costs-budget-limit') as HTMLInputElement;\n    const thresholdEl = body.querySelector('#costs-budget-threshold') as HTMLInputElement;\n    const limitUsd = limitEl ? parseFloat(limitEl.value) : NaN;\n    const thresholdRaw = thresholdEl != null ? parseInt(thresholdEl.value, 10) : NaN;\n    const threshold = Number.isFinite(thresholdRaw) ? Math.min(100, Math.max(0, thresholdRaw)) : 80;\n\n    hintEl.textContent = 'You will be notified when LLM costs reach this percentage of your budget.';\n    if (!Number.isFinite(limitUsd) || limitUsd < 1) {\n      hintEl.textContent = 'Enter a valid budget (min 1 USD).';\n      hintEl.classList.add('costs-budget-modal-hint-error');\n      limitEl?.focus();\n      return;\n    }\n    if (!Number.isFinite(thresholdRaw) || thresholdRaw < 0 || thresholdRaw > 100) {\n      hintEl.textContent = 'Alert threshold must be between 0 and 100%.';\n      hintEl.classList.add('costs-budget-modal-hint-error');\n      thresholdEl?.focus();\n      return;\n    }\n    hintEl.classList.remove('costs-budget-modal-hint-error');\n    saveBtn.setAttribute('disabled', 'true');\n    saveBtn.textContent = 'Saving';\n    try {\n      await costsService.setBudget(budgetPeriod, limitUsd, threshold);\n      closeModal(BUDGET_MODAL_ID);\n      loadCosts(container, periodSelect.value as 'day' | 'week' | 'month' | 'all');\n      toast.success('Budget saved');\n    } catch (e) {\n      console.error('Set budget failed:', e);\n      hintEl.textContent = 'Failed to save. Please try again.';\n      hintEl.classList.add('costs-budget-modal-hint-error');\n      toast.error('Failed to save budget');\n    } finally {\n      saveBtn.removeAttribute('disabled');\n      saveBtn.textContent = 'Save budget';\n    }\n  });\n\n  footer.append(cancelBtn, saveBtn);\n  document.body.appendChild(modal);\n  openModal(BUDGET_MODAL_ID);\n}\n\nfunction renderPricingTable(rows: Array<{ model: string; inputPer1M: number; outputPer1M: number }>): string {\n  if (!rows.length) return '<div class=\"empty\">No pricing data</div>';\n  return `\n    <div class=\"costs-pricing-header\">\n      <h4>Model pricing (USD per 1M tokens)</h4>\n      <button type=\"button\" class=\"btn btn-sm\" id=\"costs-pricing-close\" aria-label=\"Close\"></button>\n    </div>\n    <div class=\"costs-pricing-table-wrap\">\n      <table class=\"costs-pricing-table\">\n        <thead>\n          <tr>\n            <th>Model</th>\n            <th>Input</th>\n            <th>Output</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${rows\n            .map(\n              (r) => `\n            <tr>\n              <td>${escapeHtml(r.model)}</td>\n              <td>$${r.inputPer1M.toFixed(2)}</td>\n              <td>$${r.outputPer1M.toFixed(2)}</td>\n            </tr>\n          `\n            )\n            .join('')}\n        </tbody>\n      </table>\n    </div>\n  `;\n}\n\n/**\n * Build skeleton daily array for period so chart always shows structure\n */\nfunction skeletonDailyForPeriod(period: { start: string; end: string }): Array<{ date: string; cost: number; calls: number }> {\n  const days = 14;\n  const result: Array<{ date: string; cost: number; calls: number }> = [];\n  const d = new Date();\n  for (let i = days - 1; i >= 0; i--) {\n    const date = new Date(d);\n    date.setDate(date.getDate() - i);\n    result.push({\n      date: date.toISOString().split('T')[0],\n      cost: 0,\n      calls: 0,\n    });\n  }\n  return result;\n}\n\n/**\n * Render daily costs chart. When no data, show skeleton bars so chart area is visible.\n */\nfunction renderDailyChart(\n  daily: Array<{ date: string; cost: number; calls: number }>,\n  period?: { start: string; end: string }\n): string {\n  const chartDaily = daily.length > 0 ? daily : skeletonDailyForPeriod(period ?? { start: '', end: '' });\n  const maxCost = Math.max(1e-9, ...chartDaily.map(d => d.cost));\n  const isPlaceholder = daily.length === 0;\n\n  return `\n    <div class=\"daily-chart\">\n      <div class=\"chart-bars\">\n        ${chartDaily.map(d => {\n          const height = maxCost > 0 ? Math.max(2, (d.cost / maxCost) * 100) : 2;\n          return `\n            <div class=\"bar-column\" title=\"${d.date}: ${formatCurrency(d.cost)} (${d.calls} calls)\">\n              <div class=\"bar ${isPlaceholder && d.cost === 0 ? 'bar-placeholder' : ''}\" style=\"--bar-height: ${height}%\"></div>\n              <div class=\"bar-label\">${formatDateShort(d.date)}</div>\n            </div>\n          `;\n        }).join('')}\n      </div>\n      ${isPlaceholder ? '<p class=\"chart-placeholder-hint\">No cost data for this period. Usage will appear here as you use LLM features.</p>' : ''}\n    </div>\n  `;\n}\n\n/**\n * Format period display\n */\nfunction formatPeriod(period: { start: string; end: string }): string {\n  if (!period.start || !period.end) return 'All time';\n  \n  const start = new Date(period.start);\n  const end = new Date(period.end);\n  \n  const formatDate = (d: Date) => d.toLocaleDateString(undefined, { \n    month: 'short', \n    day: 'numeric' \n  });\n  \n  return `${formatDate(start)} - ${formatDate(end)}`;\n}\n\n/**\n * Format date short\n */\nfunction formatDateShort(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createCostsDashboard;\n","/**\r\n * Global Search Component\r\n * Command palette style search (Cmd+K / Ctrl+K)\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { shortcuts } from '../services/shortcuts';\r\n\r\nexport interface GlobalSearchProps {\r\n  onResultClick?: (result: SearchResult) => void;\r\n}\r\n\r\nexport interface SearchResult {\r\n  id: string;\r\n  type: 'question' | 'risk' | 'action' | 'decision' | 'contact' | 'document' | 'email' | 'fact';\r\n  title: string;\r\n  subtitle?: string;\r\n  icon?: string;\r\n  url?: string;\r\n}\r\n\r\ninterface SearchResponse {\r\n  results: SearchResult[];\r\n  total: number;\r\n}\r\n\r\nlet isOpen = false;\r\nlet currentQuery = '';\r\nlet selectedIndex = 0;\r\nlet results: SearchResult[] = [];\r\n\r\nconst TYPE_ICONS: Record<string, string> = {\r\n  question: '',\r\n  risk: '',\r\n  action: '',\r\n  decision: '',\r\n  contact: '',\r\n  document: '',\r\n  email: '',\r\n  fact: '',\r\n};\r\n\r\n/**\r\n * Initialize global search\r\n */\r\nexport function initGlobalSearch(props: GlobalSearchProps = {}): void {\r\n  // Create modal if not exists\r\n  let modal = document.getElementById('global-search-modal');\r\n  if (!modal) {\r\n    modal = createSearchModal(props);\r\n    document.body.appendChild(modal);\r\n  }\r\n\r\n  // Register keyboard shortcut\r\n  shortcuts.register('mod+k', (e) => {\r\n    e.preventDefault();\r\n    toggleSearch();\r\n  });\r\n\r\n  // Also register / for quick search\r\n  shortcuts.register('/', (e) => {\r\n    // Only if not in an input\r\n    if (document.activeElement?.tagName !== 'INPUT' && \r\n        document.activeElement?.tagName !== 'TEXTAREA') {\r\n      e.preventDefault();\r\n      toggleSearch();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Create search modal\r\n */\r\nfunction createSearchModal(props: GlobalSearchProps): HTMLElement {\r\n  const modal = createElement('div', {\r\n    id: 'global-search-modal',\r\n    className: 'global-search-modal hidden',\r\n  });\r\n\r\n  modal.innerHTML = `\r\n    <div class=\"search-backdrop\"></div>\r\n    <div class=\"search-dialog\">\r\n      <div class=\"search-input-wrapper\">\r\n        <span class=\"search-icon\"></span>\r\n        <input type=\"text\" id=\"global-search-input\" class=\"search-input\" \r\n               placeholder=\"Search questions, risks, contacts...\" autocomplete=\"off\">\r\n        <kbd class=\"search-shortcut\">ESC</kbd>\r\n      </div>\r\n      <div class=\"search-results\" id=\"search-results\">\r\n        <div class=\"search-hint\">\r\n          <p>Start typing to search...</p>\r\n          <div class=\"search-tips\">\r\n            <span><kbd></kbd> Navigate</span>\r\n            <span><kbd>Enter</kbd> Select</span>\r\n            <span><kbd>ESC</kbd> Close</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"search-footer\">\r\n        <span>Type to search</span>\r\n        <span>Press <kbd>?</kbd> for more shortcuts</span>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  const backdrop = modal.querySelector('.search-backdrop') as HTMLElement;\r\n  const input = modal.querySelector('#global-search-input') as HTMLInputElement;\r\n  const resultsContainer = modal.querySelector('#search-results') as HTMLElement;\r\n\r\n  // Close on backdrop click\r\n  on(backdrop, 'click', closeSearch);\r\n\r\n  // Input events\r\n  on(input, 'input', () => {\r\n    currentQuery = input.value;\r\n    selectedIndex = 0;\r\n    debounceSearch(resultsContainer, props);\r\n  });\r\n\r\n  on(input, 'keydown', (e) => {\r\n    handleKeydown(e, resultsContainer, props);\r\n  });\r\n\r\n  return modal;\r\n}\r\n\r\n/**\r\n * Toggle search visibility\r\n */\r\nexport function toggleSearch(): void {\r\n  if (isOpen) {\r\n    closeSearch();\r\n  } else {\r\n    openSearch();\r\n  }\r\n}\r\n\r\n/**\r\n * Open search\r\n */\r\nexport function openSearch(): void {\r\n  const modal = document.getElementById('global-search-modal');\r\n  if (!modal) return;\r\n\r\n  isOpen = true;\r\n  modal.classList.remove('hidden');\r\n  \r\n  const input = modal.querySelector('#global-search-input') as HTMLInputElement;\r\n  input.value = '';\r\n  input.focus();\r\n  \r\n  currentQuery = '';\r\n  results = [];\r\n  selectedIndex = 0;\r\n\r\n  // Reset results\r\n  const resultsContainer = modal.querySelector('#search-results') as HTMLElement;\r\n  resultsContainer.innerHTML = `\r\n    <div class=\"search-hint\">\r\n      <p>Start typing to search...</p>\r\n      <div class=\"search-tips\">\r\n        <span><kbd></kbd> Navigate</span>\r\n        <span><kbd>Enter</kbd> Select</span>\r\n        <span><kbd>ESC</kbd> Close</span>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Add escape listener\r\n  document.addEventListener('keydown', handleEscape);\r\n}\r\n\r\n/**\r\n * Close search\r\n */\r\nexport function closeSearch(): void {\r\n  const modal = document.getElementById('global-search-modal');\r\n  if (!modal) return;\r\n\r\n  isOpen = false;\r\n  modal.classList.add('hidden');\r\n  \r\n  document.removeEventListener('keydown', handleEscape);\r\n}\r\n\r\n/**\r\n * Handle escape key\r\n */\r\nfunction handleEscape(e: KeyboardEvent): void {\r\n  if (e.key === 'Escape') {\r\n    closeSearch();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle keyboard navigation\r\n */\r\nfunction handleKeydown(e: KeyboardEvent, container: HTMLElement, props: GlobalSearchProps): void {\r\n  switch (e.key) {\r\n    case 'ArrowDown':\r\n      e.preventDefault();\r\n      selectedIndex = Math.min(selectedIndex + 1, results.length - 1);\r\n      updateSelection(container);\r\n      break;\r\n    case 'ArrowUp':\r\n      e.preventDefault();\r\n      selectedIndex = Math.max(selectedIndex - 1, 0);\r\n      updateSelection(container);\r\n      break;\r\n    case 'Enter':\r\n      e.preventDefault();\r\n      const selected = results[selectedIndex];\r\n      if (selected) {\r\n        selectResult(selected, props);\r\n      }\r\n      break;\r\n    case 'Escape':\r\n      closeSearch();\r\n      break;\r\n  }\r\n}\r\n\r\n/**\r\n * Update selection highlight\r\n */\r\nfunction updateSelection(container: HTMLElement): void {\r\n  const items = container.querySelectorAll('.search-result');\r\n  items.forEach((item, i) => {\r\n    item.classList.toggle('selected', i === selectedIndex);\r\n    if (i === selectedIndex) {\r\n      item.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Debounced search\r\n */\r\nlet searchTimeout: number;\r\nfunction debounceSearch(container: HTMLElement, props: GlobalSearchProps): void {\r\n  clearTimeout(searchTimeout);\r\n  searchTimeout = window.setTimeout(() => {\r\n    performSearch(container, props);\r\n  }, 200);\r\n}\r\n\r\n/**\r\n * Perform search\r\n */\r\nasync function performSearch(container: HTMLElement, props: GlobalSearchProps): Promise<void> {\r\n  if (!currentQuery.trim()) {\r\n    container.innerHTML = `\r\n      <div class=\"search-hint\">\r\n        <p>Start typing to search...</p>\r\n        <div class=\"search-tips\">\r\n          <span><kbd></kbd> Navigate</span>\r\n          <span><kbd>Enter</kbd> Select</span>\r\n          <span><kbd>ESC</kbd> Close</span>\r\n        </div>\r\n      </div>\r\n    `;\r\n    results = [];\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = '<div class=\"search-loading\">Searching...</div>';\r\n\r\n  try {\r\n    const response = await http.get<SearchResponse>(\r\n      `/api/search?q=${encodeURIComponent(currentQuery)}&limit=10`\r\n    );\r\n    results = response.data.results || [];\r\n    \r\n    renderResults(container, results, props);\r\n  } catch {\r\n    // Fallback to local search if API fails\r\n    results = performLocalSearch(currentQuery);\r\n    renderResults(container, results, props);\r\n  }\r\n}\r\n\r\n/**\r\n * Local fallback search\r\n */\r\nfunction performLocalSearch(query: string): SearchResult[] {\r\n  // TODO: Search local stores\r\n  return [];\r\n}\r\n\r\n/**\r\n * Render results\r\n */\r\nfunction renderResults(container: HTMLElement, results: SearchResult[], props: GlobalSearchProps): void {\r\n  if (results.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"search-empty\">\r\n        <p>No results found for \"${escapeHtml(currentQuery)}\"</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  // Group by type\r\n  const grouped = groupByType(results);\r\n\r\n  container.innerHTML = Object.entries(grouped).map(([type, items]) => `\r\n    <div class=\"search-group\">\r\n      <div class=\"group-label\">${capitalize(type)}s</div>\r\n      ${items.map((result, i) => `\r\n        <div class=\"search-result ${i === selectedIndex ? 'selected' : ''}\" data-index=\"${results.indexOf(result)}\">\r\n          <span class=\"result-icon\">${TYPE_ICONS[result.type] || ''}</span>\r\n          <div class=\"result-content\">\r\n            <div class=\"result-title\">${escapeHtml(result.title)}</div>\r\n            ${result.subtitle ? `<div class=\"result-subtitle\">${escapeHtml(result.subtitle)}</div>` : ''}\r\n          </div>\r\n          <span class=\"result-type\">${result.type}</span>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.search-result').forEach(el => {\r\n    on(el as HTMLElement, 'click', () => {\r\n      const index = parseInt(el.getAttribute('data-index') || '0');\r\n      const result = results[index];\r\n      if (result) {\r\n        selectResult(result, props);\r\n      }\r\n    });\r\n\r\n    on(el as HTMLElement, 'mouseenter', () => {\r\n      const index = parseInt(el.getAttribute('data-index') || '0');\r\n      selectedIndex = index;\r\n      updateSelection(container);\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Select result\r\n */\r\nfunction selectResult(result: SearchResult, props: GlobalSearchProps): void {\r\n  closeSearch();\r\n  \r\n  if (props.onResultClick) {\r\n    props.onResultClick(result);\r\n  } else {\r\n    // Default navigation\r\n    navigateToResult(result);\r\n  }\r\n}\r\n\r\n/**\r\n * Navigate to result\r\n */\r\nfunction navigateToResult(result: SearchResult): void {\r\n  // Dispatch custom event for navigation\r\n  window.dispatchEvent(new CustomEvent('godmode:navigate', {\r\n    detail: { type: result.type, id: result.id }\r\n  }));\r\n}\r\n\r\n/**\r\n * Group results by type\r\n */\r\nfunction groupByType(results: SearchResult[]): Record<string, SearchResult[]> {\r\n  const grouped: Record<string, SearchResult[]> = {};\r\n  results.forEach(r => {\r\n    if (!grouped[r.type]) grouped[r.type] = [];\r\n    grouped[r.type].push(r);\r\n  });\r\n  return grouped;\r\n}\r\n\r\n/**\r\n * Capitalize\r\n */\r\nfunction capitalize(str: string): string {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default initGlobalSearch;\r\n","/**\n * Bulk Actions Component\n * Selection management and bulk operations\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { undoManager } from '../services/undo';\n\nexport interface BulkActionsProps {\n  type: 'questions' | 'risks' | 'actions' | 'decisions' | 'contacts' | 'documents';\n  onComplete?: () => void;\n}\n\ninterface BulkOperation {\n  type: string;\n  ids: string[];\n  action: string;\n  data?: Record<string, unknown>;\n}\n\nlet selectedIds: Set<string> = new Set();\n\n/**\n * Create bulk actions bar\n */\nexport function createBulkActionsBar(props: BulkActionsProps): HTMLElement {\n  const bar = createElement('div', { className: 'bulk-actions-bar hidden' });\n\n  bar.innerHTML = `\n    <div class=\"bulk-info\">\n      <span class=\"bulk-count\">0</span> selected\n    </div>\n    <div class=\"bulk-buttons\">\n      ${getActionsForType(props.type)}\n      <button class=\"btn btn-sm btn-secondary\" id=\"bulk-clear\">Clear</button>\n    </div>\n  `;\n\n  // Bind clear\n  const clearBtn = bar.querySelector('#bulk-clear');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', () => {\n      clearSelection();\n      updateBar(bar);\n    });\n  }\n\n  // Bind actions\n  bindActionButtons(bar, props);\n\n  return bar;\n}\n\n/**\n * Get action buttons for type\n */\nfunction getActionsForType(type: string): string {\n  const common = `\n    <button class=\"btn btn-sm btn-danger\" id=\"bulk-delete\">Delete</button>\n  `;\n\n  switch (type) {\n    case 'questions':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"resolved\">Mark Resolved</button>\n        <button class=\"btn btn-sm\" id=\"bulk-assign\">Assign To...</button>\n        ${common}\n      `;\n    case 'actions':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"completed\">Mark Complete</button>\n        <button class=\"btn btn-sm\" id=\"bulk-assign\">Assign To...</button>\n        ${common}\n      `;\n    case 'risks':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"mitigated\">Mark Mitigated</button>\n        ${common}\n      `;\n    case 'decisions':\n      return `\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"approved\">Approve</button>\n        <button class=\"btn btn-sm\" id=\"bulk-status\" data-status=\"rejected\">Reject</button>\n        ${common}\n      `;\n    default:\n      return common;\n  }\n}\n\n/**\n * Bind action buttons\n */\nfunction bindActionButtons(bar: HTMLElement, props: BulkActionsProps): void {\n  // Delete\n  const deleteBtn = bar.querySelector('#bulk-delete');\n  if (deleteBtn) {\n    on(deleteBtn as HTMLElement, 'click', async () => {\n      if (!confirm(`Delete ${selectedIds.size} items?`)) return;\n      \n      await performBulkAction({\n        type: props.type,\n        ids: Array.from(selectedIds),\n        action: 'delete',\n      }, props);\n    });\n  }\n\n  // Status change\n  const statusBtns = bar.querySelectorAll('[id^=\"bulk-status\"]');\n  statusBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const status = btn.getAttribute('data-status');\n      if (!status) return;\n\n      await performBulkAction({\n        type: props.type,\n        ids: Array.from(selectedIds),\n        action: 'status',\n        data: { status },\n      }, props);\n    });\n  });\n\n  // Assign\n  const assignBtn = bar.querySelector('#bulk-assign');\n  if (assignBtn) {\n    on(assignBtn as HTMLElement, 'click', () => {\n      const assignee = prompt('Assign to:');\n      if (!assignee) return;\n\n      performBulkAction({\n        type: props.type,\n        ids: Array.from(selectedIds),\n        action: 'assign',\n        data: { assignee },\n      }, props);\n    });\n  }\n}\n\n/**\n * Perform bulk action\n */\nasync function performBulkAction(operation: BulkOperation, props: BulkActionsProps): Promise<void> {\n  try {\n    let endpoint = '';\n    let body: Record<string, unknown> = { type: operation.type, ids: operation.ids };\n\n    switch (operation.action) {\n      case 'delete':\n        endpoint = '/api/bulk/delete';\n        break;\n      case 'status':\n        endpoint = '/api/bulk/status';\n        body = { ...body, status: operation.data?.status };\n        break;\n      case 'assign':\n        endpoint = '/api/bulk/assign';\n        body = { ...body, assignee: operation.data?.assignee };\n        break;\n    }\n\n    const response = await http.post<{ actionId?: string; affected: number }>(endpoint, body);\n    \n    // Register for undo if supported\n    if (response.data.actionId) {\n      undoManager.push({\n        type: `bulk-${operation.action}`,\n        description: `${operation.action} ${operation.ids.length} items`,\n        undo: async () => {\n          await http.post(`/api/undo/${response.data.actionId}`);\n          props.onComplete?.();\n        },\n      });\n    }\n\n    toast.success(`Updated ${response.data.affected || operation.ids.length} items`);\n    clearSelection();\n    props.onComplete?.();\n  } catch {\n    toast.error('Bulk operation failed');\n  }\n}\n\n/**\n * Toggle item selection\n */\nexport function toggleSelection(id: string, bar: HTMLElement): void {\n  if (selectedIds.has(id)) {\n    selectedIds.delete(id);\n  } else {\n    selectedIds.add(id);\n  }\n  updateBar(bar);\n}\n\n/**\n * Select item\n */\nexport function selectItem(id: string, bar: HTMLElement): void {\n  selectedIds.add(id);\n  updateBar(bar);\n}\n\n/**\n * Deselect item\n */\nexport function deselectItem(id: string, bar: HTMLElement): void {\n  selectedIds.delete(id);\n  updateBar(bar);\n}\n\n/**\n * Clear selection\n */\nexport function clearSelection(): void {\n  selectedIds.clear();\n  // Update checkboxes in DOM\n  document.querySelectorAll('.bulk-checkbox:checked').forEach(cb => {\n    (cb as HTMLInputElement).checked = false;\n  });\n}\n\n/**\n * Get selected IDs\n */\nexport function getSelectedIds(): string[] {\n  return Array.from(selectedIds);\n}\n\n/**\n * Is item selected\n */\nexport function isSelected(id: string): boolean {\n  return selectedIds.has(id);\n}\n\n/**\n * Update bar visibility and count\n */\nfunction updateBar(bar: HTMLElement): void {\n  const count = selectedIds.size;\n  \n  bar.classList.toggle('hidden', count === 0);\n  \n  const countEl = bar.querySelector('.bulk-count');\n  if (countEl) {\n    countEl.textContent = String(count);\n  }\n}\n\n/**\n * Create checkbox for bulk selection\n */\nexport function createBulkCheckbox(id: string, bar: HTMLElement): HTMLElement {\n  const checkbox = createElement('input', {\n    type: 'checkbox',\n    className: 'bulk-checkbox',\n  }) as HTMLInputElement;\n  checkbox.setAttribute('data-id', id);\n  checkbox.checked = isSelected(id);\n\n  on(checkbox, 'change', (e) => {\n    e.stopPropagation();\n    toggleSelection(id, bar);\n    checkbox.checked = isSelected(id);\n  });\n\n  return checkbox;\n}\n\nexport default createBulkActionsBar;\n","/**\r\n * Sync Status Component\r\n * Shows synchronization status and dead letters\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface SyncStatusProps {\r\n  showDetails?: boolean;\r\n}\r\n\r\ninterface SyncState {\r\n  connected: boolean;\r\n  lastSync: string | null;\r\n  pendingCount: number;\r\n  errorCount: number;\r\n}\r\n\r\ninterface DeadLetter {\r\n  id: string;\r\n  type: string;\r\n  payload: unknown;\r\n  error: string;\r\n  failedAt: string;\r\n  retryCount: number;\r\n}\r\n\r\n/**\r\n * Create sync status component\r\n */\r\nexport function createSyncStatus(props: SyncStatusProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'sync-status' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"sync-indicator\" id=\"sync-indicator\">\r\n      <span class=\"sync-icon\"></span>\r\n      <span class=\"sync-text\">Checking...</span>\r\n    </div>\r\n    ${props.showDetails ? `\r\n      <div class=\"sync-details hidden\" id=\"sync-details\">\r\n        <div class=\"sync-info\"></div>\r\n        <div class=\"dead-letters\"></div>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  const indicator = container.querySelector('#sync-indicator') as HTMLElement;\r\n  \r\n  // Toggle details on click\r\n  if (props.showDetails) {\r\n    on(indicator, 'click', () => {\r\n      const details = container.querySelector('#sync-details') as HTMLElement;\r\n      const wasHidden = details.classList.contains('hidden');\r\n      details.classList.toggle('hidden');\r\n      if (wasHidden) {\r\n        loadSyncDetails(container);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initial check\r\n  checkSyncStatus(container);\r\n\r\n  // Periodic refresh\r\n  setInterval(() => checkSyncStatus(container), 30000);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Check sync status\r\n */\r\nasync function checkSyncStatus(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<SyncState>('/api/sync/status');\r\n    updateIndicator(container, response.data);\r\n  } catch {\r\n    updateIndicator(container, {\r\n      connected: false,\r\n      lastSync: null,\r\n      pendingCount: 0,\r\n      errorCount: 0,\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Update indicator\r\n */\r\nfunction updateIndicator(container: HTMLElement, state: SyncState): void {\r\n  const icon = container.querySelector('.sync-icon') as HTMLElement;\r\n  const text = container.querySelector('.sync-text') as HTMLElement;\r\n  const indicator = container.querySelector('.sync-indicator') as HTMLElement;\r\n\r\n  if (!state.connected) {\r\n    icon.textContent = '';\r\n    text.textContent = 'Disconnected';\r\n    indicator.classList.remove('synced', 'syncing');\r\n    indicator.classList.add('error');\r\n  } else if (state.pendingCount > 0) {\r\n    icon.textContent = '';\r\n    text.textContent = `Syncing (${state.pendingCount})`;\r\n    indicator.classList.remove('synced', 'error');\r\n    indicator.classList.add('syncing');\r\n  } else if (state.errorCount > 0) {\r\n    icon.textContent = '!';\r\n    text.textContent = `${state.errorCount} errors`;\r\n    indicator.classList.remove('synced', 'syncing');\r\n    indicator.classList.add('error');\r\n  } else {\r\n    icon.textContent = '';\r\n    text.textContent = state.lastSync ? formatRelativeTime(state.lastSync) : 'Synced';\r\n    indicator.classList.remove('syncing', 'error');\r\n    indicator.classList.add('synced');\r\n  }\r\n}\r\n\r\n/**\r\n * Load sync details\r\n */\r\nasync function loadSyncDetails(container: HTMLElement): Promise<void> {\r\n  const infoContainer = container.querySelector('.sync-info') as HTMLElement;\r\n  const deadLettersContainer = container.querySelector('.dead-letters') as HTMLElement;\r\n\r\n  infoContainer.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    // Get sync status\r\n    const statusResponse = await http.get<SyncState>('/api/sync/status');\r\n    const state = statusResponse.data;\r\n\r\n    infoContainer.innerHTML = `\r\n      <div class=\"info-grid\">\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Status</span>\r\n          <span class=\"info-value ${state.connected ? 'success' : 'error'}\">\r\n            ${state.connected ? 'Connected' : 'Disconnected'}\r\n          </span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Last Sync</span>\r\n          <span class=\"info-value\">${state.lastSync ? formatRelativeTime(state.lastSync) : 'Never'}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Pending</span>\r\n          <span class=\"info-value\">${state.pendingCount}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"info-label\">Errors</span>\r\n          <span class=\"info-value ${state.errorCount > 0 ? 'error' : ''}\">${state.errorCount}</span>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Get dead letters\r\n    const deadLettersResponse = await http.get<{ deadLetters: DeadLetter[] }>('/api/sync/dead-letters');\r\n    const deadLetters = deadLettersResponse.data.deadLetters || [];\r\n\r\n    if (deadLetters.length > 0) {\r\n      deadLettersContainer.innerHTML = `\r\n        <h4>Failed Operations</h4>\r\n        <div class=\"dead-letters-list\">\r\n          ${deadLetters.map(dl => `\r\n            <div class=\"dead-letter\" data-id=\"${dl.id}\">\r\n              <div class=\"dl-header\">\r\n                <span class=\"dl-type\">${dl.type}</span>\r\n                <span class=\"dl-time\">${formatRelativeTime(dl.failedAt)}</span>\r\n              </div>\r\n              <div class=\"dl-error\">${escapeHtml(dl.error)}</div>\r\n              <div class=\"dl-actions\">\r\n                <button class=\"btn btn-sm retry-btn\" data-id=\"${dl.id}\">Retry</button>\r\n                <span class=\"dl-retries\">${dl.retryCount} attempts</span>\r\n              </div>\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      `;\r\n\r\n      // Bind retry buttons\r\n      deadLettersContainer.querySelectorAll('.retry-btn').forEach(btn => {\r\n        on(btn as HTMLElement, 'click', async () => {\r\n          const id = btn.getAttribute('data-id');\r\n          if (!id) return;\r\n\r\n          try {\r\n            await http.post(`/api/sync/retry/${id}`);\r\n            toast.success('Retry scheduled');\r\n            loadSyncDetails(container);\r\n          } catch {\r\n            toast.error('Retry failed');\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      deadLettersContainer.innerHTML = '';\r\n    }\r\n  } catch {\r\n    infoContainer.innerHTML = '<div class=\"error\">Failed to load details</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Create mini sync indicator for header\r\n */\r\nexport function createSyncIndicator(): HTMLElement {\r\n  const indicator = createElement('div', { className: 'sync-indicator-mini' });\r\n  indicator.innerHTML = '<span class=\"sync-dot\"></span>';\r\n\r\n  // Initial check\r\n  checkMiniStatus(indicator);\r\n\r\n  // Periodic refresh\r\n  setInterval(() => checkMiniStatus(indicator), 30000);\r\n\r\n  return indicator;\r\n}\r\n\r\n/**\r\n * Check mini status\r\n */\r\nasync function checkMiniStatus(indicator: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<SyncState>('/api/sync/status');\r\n    const dot = indicator.querySelector('.sync-dot') as HTMLElement;\r\n    \r\n    if (!response.data.connected) {\r\n      dot.className = 'sync-dot error';\r\n      indicator.title = 'Disconnected';\r\n    } else if (response.data.errorCount > 0) {\r\n      dot.className = 'sync-dot warning';\r\n      indicator.title = `${response.data.errorCount} sync errors`;\r\n    } else {\r\n      dot.className = 'sync-dot success';\r\n      indicator.title = 'Synced';\r\n    }\r\n  } catch {\r\n    const dot = indicator.querySelector('.sync-dot') as HTMLElement;\r\n    dot.className = 'sync-dot error';\r\n    indicator.title = 'Connection error';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createSyncStatus;\r\n","/**\r\n * Companies Modal - List, create, edit, analyze company profiles and templates (A4/PPT)\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { toast } from '../../services/toast';\r\nimport {\r\n  listCompanies,\r\n  getCompany,\r\n  createCompany,\r\n  updateCompany,\r\n  deleteCompany,\r\n  analyzeCompany,\r\n  getTemplate,\r\n  updateTemplate,\r\n  generateTemplate,\r\n  type Company,\r\n  type CreateCompanyRequest,\r\n  type TemplateType,\r\n} from '../../services/companies';\r\n\r\nconst MODAL_ID = 'companies-modal';\r\n\r\n/** UI strings - centralised for i18n */\r\nconst S = {\r\n  title: 'Companies',\r\n  close: 'Close',\r\n  newCompany: '+ New company',\r\n  noCompanies: 'No companies yet. Create one to use in projects.',\r\n  edit: 'Edit',\r\n  analyze: 'Analyze',\r\n  reAnalyze: 'Re-analyze',\r\n  viewDetail: 'View',\r\n  detail: 'Company detail',\r\n  analyzedOn: 'Analyzed',\r\n  notAnalyzed: 'Not analyzed',\r\n  delete: 'Delete',\r\n  backToList: ' Back to list',\r\n  name: 'Name *',\r\n  description: 'Description',\r\n  logoUrl: 'Logo URL',\r\n  website: 'Website',\r\n  linkedIn: 'LinkedIn',\r\n  save: 'Save',\r\n  create: 'Create',\r\n  cancel: 'Cancel',\r\n  invalidUrl: 'Please enter a valid URL',\r\n  updateFailed: 'Update failed',\r\n  createFailed: 'Create failed',\r\n  loadFailed: 'Failed to load company',\r\n  analysisComplete: 'Analysis complete',\r\n  analysisFailed: 'Analysis failed',\r\n  deleteConfirm: 'Delete this company? Projects using it must be reassigned first.',\r\n  companyDeleted: 'Company deleted',\r\n  templates: 'Templates (A4 / PPT)',\r\n  templateA4: 'A4 document',\r\n  templatePPT: 'Presentation',\r\n  generateWithAI: 'Generate base with AI',\r\n  loadCurrent: 'Load current',\r\n  saveTemplate: 'Save template',\r\n  templateLoaded: 'Template loaded',\r\n  templateSaved: 'Template saved',\r\n  templateGenerated: 'Template generated',\r\n  templateLoadFailed: 'Failed to load template',\r\n  templateSaveFailed: 'Failed to save template',\r\n  templateGenerateFailed: 'Generation failed',\r\n};\r\n\r\nfunction escapeHtml(s: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = s;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction isValidUrl(value: string): boolean {\r\n  if (!value || !value.trim()) return true;\r\n  try {\r\n    const u = new URL(value.trim());\r\n    return u.protocol === 'http:' || u.protocol === 'https:';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function showCompaniesModal(): void {\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  overlay.setAttribute('data-modal-id', MODAL_ID);\r\n\r\n  const container = createElement('div', { className: 'modal-container', style: 'max-width: 640px;' });\r\n  container.innerHTML = `\r\n    <div class=\"modal-header\" style=\"display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid var(--border-color, #e2e8f0);\">\r\n      <h2 style=\"margin: 0; font-size: 1.25rem;\">${escapeHtml(S.title)}</h2>\r\n      <button type=\"button\" class=\"btn-icon\" id=\"companies-close-btn\" title=\"${escapeHtml(S.close)}\"></button>\r\n    </div>\r\n    <div class=\"modal-body\" style=\"padding: 20px; max-height: 60vh; overflow-y: auto;\">\r\n      <button type=\"button\" class=\"btn btn-primary\" id=\"companies-new-btn\" style=\"margin-bottom: 16px;\">${escapeHtml(S.newCompany)}</button>\r\n      <div id=\"companies-list\">Loading...</div>\r\n    </div>\r\n  `;\r\n\r\n  overlay.appendChild(container);\r\n  document.body.appendChild(overlay);\r\n\r\n  function close() {\r\n    overlay.remove();\r\n  }\r\n\r\n  function renderList(items: Company[]) {\r\n    const listEl = overlay.querySelector('#companies-list') as HTMLElement;\r\n    if (!listEl) return;\r\n    const list = Array.isArray(items) ? items : [];\r\n    try {\r\n      if (list.length === 0) {\r\n        listEl.innerHTML = `<p style=\"color: var(--text-secondary);\">${escapeHtml(S.noCompanies)}</p>`;\r\n        return;\r\n      }\r\n      const analyzedAt = (c: Company) => c.brand_assets?.analyzed_at;\r\n      listEl.innerHTML = list\r\n      .map(\r\n        (c) => {\r\n          const analyzed = !!analyzedAt(c);\r\n          const analyzeLabel = analyzed ? S.reAnalyze : S.analyze;\r\n          const analyzedBadge = analyzed\r\n            ? `<span class=\"companies-analyzed-badge\" title=\"${escapeHtml(analyzedAt(c) || '')}\" style=\"font-size: 11px; color: var(--text-secondary); margin-left: 6px;\">${escapeHtml(S.analyzedOn)}</span>`\r\n            : `<span class=\"companies-not-analyzed-badge\" style=\"font-size: 11px; color: var(--text-muted, #94a3b8); margin-left: 6px;\">${escapeHtml(S.notAnalyzed)}</span>`;\r\n          return `\r\n      <div class=\"companies-row\" data-id=\"${c.id}\" style=\"display: flex; align-items: center; justify-content: space-between; padding: 12px 14px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 8px;\">\r\n        <div style=\"display: flex; align-items: center; gap: 12px;\">\r\n          ${c.logo_url ? `<img src=\"${escapeHtml(c.logo_url)}\" alt=\"\" style=\"width: 36px; height: 36px; object-fit: contain; border-radius: 6px;\">` : '<span style=\"width: 36px; height: 36px; background: var(--bg-secondary); border-radius: 6px; display: inline-flex; align-items: center; justify-content: center; font-size: 18px;\"></span>'}\r\n          <div>\r\n            <strong>${escapeHtml(c.name)}</strong>${analyzedBadge}\r\n            ${(c.brand_assets?.primary_color && c.brand_assets?.secondary_color) ? `<span style=\"display: inline-flex; gap: 4px; margin-left: 8px;\"><i style=\"width: 12px; height: 12px; border-radius: 2px; background: ${escapeHtml(c.brand_assets.primary_color)};\"></i><i style=\"width: 12px; height: 12px; border-radius: 2px; background: ${escapeHtml(c.brand_assets.secondary_color)};\"></i></span>` : ''}\r\n          </div>\r\n        </div>\r\n        <div style=\"display: flex; gap: 8px;\">\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-detail-btn\" data-id=\"${c.id}\" title=\"View analysis\">${escapeHtml(S.viewDetail)}</button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-edit-btn\" data-id=\"${c.id}\">${escapeHtml(S.edit)}</button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary companies-analyze-btn\" data-id=\"${c.id}\" title=\"Analyze with AI\">${escapeHtml(analyzeLabel)}</button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-outline-danger companies-delete-btn\" data-id=\"${c.id}\">${escapeHtml(S.delete)}</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n        }\r\n      )\r\n      .join('');\r\n    } catch {\r\n      listEl.innerHTML = `<p class=\"text-error\">${escapeHtml(S.loadFailed)}</p>`;\r\n    }\r\n  }\r\n\r\n  function loadList() {\r\n    const listEl = overlay.querySelector('#companies-list') as HTMLElement;\r\n    if (listEl) listEl.innerHTML = 'Loading...';\r\n    listCompanies()\r\n      .then((list) => renderList(Array.isArray(list) ? list : []))\r\n      .catch(() => {\r\n        try {\r\n          const el = overlay.querySelector('#companies-list') as HTMLElement;\r\n          if (el) el.innerHTML = `<p class=\"text-error\">${escapeHtml(S.loadFailed)}</p>`;\r\n        } catch {\r\n          // overlay may be gone\r\n        }\r\n      });\r\n  }\r\n\r\n  const listViewBodyHtml = `\r\n    <button type=\"button\" class=\"btn btn-primary\" id=\"companies-new-btn\" style=\"margin-bottom: 16px;\">${escapeHtml(S.newCompany)}</button>\r\n    <div id=\"companies-list\">Loading...</div>\r\n  `;\r\n\r\n  function showListView() {\r\n    const body = overlay.querySelector('.modal-body') as HTMLElement;\r\n    if (!body) return;\r\n    body.innerHTML = listViewBodyHtml;\r\n    loadList();\r\n    bindListEvents();\r\n  }\r\n\r\n  function showForm(company?: Company) {\r\n    const body = overlay.querySelector('.modal-body') as HTMLElement;\r\n    if (!body) return;\r\n    const isEdit = !!company;\r\n    body.innerHTML = `\r\n      <div style=\"margin-bottom: 16px;\">\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"companies-back-btn\">${escapeHtml(S.backToList)}</button>\r\n      </div>\r\n      <form id=\"company-form\" style=\"display: flex; flex-direction: column; gap: 14px;\">\r\n        <div>\r\n          <label>${escapeHtml(S.name)}</label>\r\n          <input type=\"text\" name=\"name\" required value=\"${company ? escapeHtml(company.name) : ''}\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\">\r\n        </div>\r\n        <div>\r\n          <label>${escapeHtml(S.description)}</label>\r\n          <textarea name=\"description\" rows=\"2\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\">${company?.description ? escapeHtml(company.description) : ''}</textarea>\r\n        </div>\r\n        <div>\r\n          <label>${escapeHtml(S.logoUrl)}</label>\r\n          <input type=\"url\" name=\"logo_url\" value=\"${company?.logo_url ? escapeHtml(company.logo_url) : ''}\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\" placeholder=\"https://...\">\r\n        </div>\r\n        <div>\r\n          <label>${escapeHtml(S.website)}</label>\r\n          <input type=\"url\" name=\"website_url\" value=\"${company?.website_url ? escapeHtml(company.website_url) : ''}\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\" placeholder=\"https://...\">\r\n        </div>\r\n        <div>\r\n          <label>${escapeHtml(S.linkedIn)}</label>\r\n          <input type=\"url\" name=\"linkedin_url\" value=\"${company?.linkedin_url ? escapeHtml(company.linkedin_url) : ''}\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color);\" placeholder=\"https://linkedin.com/...\">\r\n        </div>\r\n        <div style=\"display: flex; gap: 8px;\">\r\n          <button type=\"submit\" class=\"btn btn-primary\">${isEdit ? escapeHtml(S.save) : escapeHtml(S.create)}</button>\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"company-form-cancel\">${escapeHtml(S.cancel)}</button>\r\n        </div>\r\n        ${isEdit && company ? `\r\n        <div style=\"margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);\">\r\n          <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"companies-templates-btn\">${escapeHtml(S.templates)}</button>\r\n        </div>\r\n        ` : ''}\r\n      </form>\r\n    `;\r\n\r\n    on(body.querySelector('#companies-back-btn') as HTMLElement, 'click', showListView);\r\n\r\n    on(body.querySelector('#company-form') as HTMLFormElement, 'submit', async (e) => {\r\n      e.preventDefault();\r\n      const form = body.querySelector('#company-form') as HTMLFormElement;\r\n      const fd = new FormData(form);\r\n      const logoUrl = (fd.get('logo_url') as string)?.trim() || undefined;\r\n      const websiteUrl = (fd.get('website_url') as string)?.trim() || undefined;\r\n      const linkedinUrl = (fd.get('linkedin_url') as string)?.trim() || undefined;\r\n      if (logoUrl && !isValidUrl(logoUrl)) { toast.error(S.invalidUrl + ' (Logo)'); return; }\r\n      if (websiteUrl && !isValidUrl(websiteUrl)) { toast.error(S.invalidUrl + ' (Website)'); return; }\r\n      if (linkedinUrl && !isValidUrl(linkedinUrl)) { toast.error(S.invalidUrl + ' (LinkedIn)'); return; }\r\n      const data: CreateCompanyRequest = {\r\n        name: (fd.get('name') as string).trim(),\r\n        description: (fd.get('description') as string)?.trim() || undefined,\r\n        logo_url: logoUrl,\r\n        website_url: websiteUrl,\r\n        linkedin_url: linkedinUrl,\r\n      };\r\n      try {\r\n        if (isEdit && company) {\r\n          await updateCompany(company.id, data);\r\n          toast.success('Company updated');\r\n        } else {\r\n          await createCompany(data);\r\n          toast.success('Company created');\r\n        }\r\n        showListView();\r\n      } catch {\r\n        toast.error(isEdit ? S.updateFailed : S.createFailed);\r\n      }\r\n    });\r\n\r\n    on(body.querySelector('#company-form-cancel') as HTMLElement, 'click', showListView);\r\n\r\n    if (isEdit && company) {\r\n      const templatesBtn = body.querySelector('#companies-templates-btn');\r\n      if (templatesBtn) on(templatesBtn as HTMLElement, 'click', () => showTemplateEditor(company));\r\n    }\r\n  }\r\n\r\n  function showTemplateEditor(company: Company) {\r\n    const body = overlay.querySelector('.modal-body') as HTMLElement;\r\n    if (!body) return;\r\n    let currentType: TemplateType = 'a4';\r\n    body.innerHTML = `\r\n      <div style=\"margin-bottom: 16px;\">\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"templates-back-btn\">${escapeHtml(S.backToList)}</button>\r\n      </div>\r\n      <h3 style=\"margin: 0 0 12px 0; font-size: 1rem;\">${escapeHtml(company.name)}  ${escapeHtml(S.templates)}</h3>\r\n      <div style=\"display: flex; gap: 8px; margin-bottom: 12px;\">\r\n        <button type=\"button\" class=\"btn btn-sm btn-secondary template-type-btn active\" data-type=\"a4\">${escapeHtml(S.templateA4)}</button>\r\n        <button type=\"button\" class=\"btn btn-sm btn-secondary template-type-btn\" data-type=\"ppt\">${escapeHtml(S.templatePPT)}</button>\r\n      </div>\r\n      <div style=\"display: flex; gap: 8px; margin-bottom: 8px;\">\r\n        <button type=\"button\" class=\"btn btn-sm btn-secondary\" id=\"template-load-btn\">${escapeHtml(S.loadCurrent)}</button>\r\n        <button type=\"button\" class=\"btn btn-sm btn-primary\" id=\"template-generate-btn\">${escapeHtml(S.generateWithAI)}</button>\r\n        <button type=\"button\" class=\"btn btn-sm btn-primary\" id=\"template-save-btn\">${escapeHtml(S.saveTemplate)}</button>\r\n      </div>\r\n      <textarea id=\"template-html-editor\" rows=\"14\" style=\"width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border-color); font-family: monospace; font-size: 12px;\" placeholder=\"HTML template...\"></textarea>\r\n    `;\r\n\r\n    const editor = body.querySelector('#template-html-editor') as HTMLTextAreaElement;\r\n    const loadBtn = body.querySelector('#template-load-btn') as HTMLButtonElement;\r\n    const genBtn = body.querySelector('#template-generate-btn') as HTMLButtonElement;\r\n    const saveBtn = body.querySelector('#template-save-btn') as HTMLButtonElement;\r\n\r\n    function setType(type: TemplateType) {\r\n      currentType = type;\r\n      body.querySelectorAll('.template-type-btn').forEach((b) => b.classList.toggle('active', (b as HTMLElement).getAttribute('data-type') === type));\r\n    }\r\n\r\n    on(body.querySelector('#templates-back-btn') as HTMLElement, 'click', () => showForm(company));\r\n    body.querySelectorAll('.template-type-btn').forEach((btn) => {\r\n      on(btn as HTMLElement, 'click', () => setType((btn.getAttribute('data-type') as TemplateType) || 'a4'));\r\n    });\r\n    on(loadBtn, 'click', async () => {\r\n      loadBtn.disabled = true;\r\n      try {\r\n        const html = await getTemplate(company.id, currentType);\r\n        editor.value = html;\r\n        toast.success(S.templateLoaded);\r\n      } catch {\r\n        toast.error(S.templateLoadFailed);\r\n      } finally {\r\n        loadBtn.disabled = false;\r\n      }\r\n    });\r\n    on(genBtn, 'click', async () => {\r\n      genBtn.disabled = true;\r\n      genBtn.textContent = '...';\r\n      try {\r\n        const { html } = await generateTemplate(company.id, currentType);\r\n        editor.value = html;\r\n        toast.success(S.templateGenerated);\r\n      } catch {\r\n        toast.error(S.templateGenerateFailed);\r\n      } finally {\r\n        genBtn.disabled = false;\r\n        genBtn.textContent = S.generateWithAI;\r\n      }\r\n    });\r\n    on(saveBtn, 'click', async () => {\r\n      saveBtn.disabled = true;\r\n      try {\r\n        await updateTemplate(company.id, currentType, editor.value);\r\n        toast.success(S.templateSaved);\r\n      } catch {\r\n        toast.error(S.templateSaveFailed);\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n      }\r\n    });\r\n    getTemplate(company.id, currentType).then((html) => { editor.value = html; }).catch(() => {});\r\n  }\r\n\r\n  const REPORT_SECTION_LABELS: Record<string, string> = {\r\n    ficha_identidade: '1. Ficha de Identidade',\r\n    visao_geral: '2. Viso Geral e Posicionamento',\r\n    produtos_servicos: '3. Produtos e Servios',\r\n    publico_alvo: '4. Pblico-Alvo e Clientes',\r\n    equipa_lideranca: '5. Equipa e Liderana',\r\n    presenca_digital: '6. Presena Digital e Marketing',\r\n    analise_competitiva: '7. Anlise Competitiva',\r\n    indicadores_crescimento: '8. Indicadores de Crescimento',\r\n    swot: '9. Anlise SWOT',\r\n    conclusoes: '10. Concluses e Insights',\r\n  };\r\n\r\n  function showDetailView(company: Company) {\r\n    const body = overlay.querySelector('.modal-body') as HTMLElement;\r\n    if (!body) return;\r\n    const ba = company.brand_assets;\r\n    const analyzedAt = ba?.analyzed_at ? new Date(ba.analyzed_at).toLocaleString() : '';\r\n    const aiContext = (ba?.ai_context || '').trim() || '';\r\n    const primaryColor = ba?.primary_color || '';\r\n    const secondaryColor = ba?.secondary_color || '';\r\n    const report = ba?.analysis_report || {};\r\n    const hasReport = Object.keys(report).length > 0;\r\n    const reportSectionKeys = Object.keys(REPORT_SECTION_LABELS);\r\n    const reportHtml = hasReport\r\n      ? reportSectionKeys\r\n          .map((key) => {\r\n            const label = REPORT_SECTION_LABELS[key];\r\n            const text = (report[key as keyof typeof report] || '').trim() || '';\r\n            return `<div class=\"companies-report-section\"><strong>${escapeHtml(label)}</strong><div class=\"companies-report-text\">${escapeHtml(text)}</div></div>`;\r\n          })\r\n          .join('')\r\n      : `<div><strong>AI context</strong><div class=\"companies-report-text\">${escapeHtml(aiContext)}</div></div>\r\n        <div><strong>Primary color</strong> <span style=\"display: inline-flex; align-items: center; gap: 6px;\">${primaryColor !== '' ? `<span style=\"width: 20px; height: 20px; border-radius: 4px; background: ${escapeHtml(primaryColor)};\"></span><code>${escapeHtml(primaryColor)}</code>` : ''}</span></div>\r\n        <div><strong>Secondary color</strong> <span style=\"display: inline-flex; align-items: center; gap: 6px;\">${secondaryColor !== '' ? `<span style=\"width: 20px; height: 20px; border-radius: 4px; background: ${escapeHtml(secondaryColor)};\"></span><code>${escapeHtml(secondaryColor)}</code>` : ''}</span></div>`;\r\n\r\n    const logoBlock = company.logo_url\r\n      ? `<img src=\"${escapeHtml(company.logo_url)}\" alt=\"\" class=\"companies-detail-logo\" onerror=\"this.style.display='none'\">`\r\n      : '<span class=\"companies-detail-logo-placeholder\"></span>';\r\n\r\n    body.innerHTML = `\r\n      <div style=\"margin-bottom: 16px;\">\r\n        <button type=\"button\" class=\"btn btn-secondary btn-sm\" id=\"companies-detail-back-btn\">${escapeHtml(S.backToList)}</button>\r\n      </div>\r\n      <div class=\"companies-detail-header\" style=\"display: flex; align-items: center; gap: 16px; margin-bottom: 16px;\">\r\n        ${logoBlock}\r\n        <div>\r\n          <h3 style=\"margin: 0 0 4px 0; font-size: 1.25rem;\">${escapeHtml(company.name)}</h3>\r\n          <div style=\"font-size: 12px; color: var(--text-secondary);\">${escapeHtml(S.analyzedOn)} ${escapeHtml(analyzedAt)}</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"companies-detail-report\" style=\"display: flex; flex-direction: column; gap: 14px; max-height: 55vh; overflow-y: auto;\">\r\n        ${reportHtml}\r\n      </div>\r\n      ${hasReport ? `<div style=\"margin-top: 8px;\"><strong>Primary color</strong> ${primaryColor !== '' ? `<span style=\"display: inline-flex; align-items: center; gap: 6px;\"><span style=\"width: 16px; height: 16px; border-radius: 4px; background: ${escapeHtml(primaryColor)};\"></span><code>${escapeHtml(primaryColor)}</code></span>` : ''} &nbsp; <strong>Secondary</strong> ${secondaryColor !== '' ? `<span style=\"display: inline-flex; align-items: center; gap: 6px;\"><span style=\"width: 16px; height: 16px; border-radius: 4px; background: ${escapeHtml(secondaryColor)};\"></span><code>${escapeHtml(secondaryColor)}</code></span>` : ''}</div>` : ''}\r\n      <div style=\"margin-top: 16px; display: flex; gap: 8px;\">\r\n        <button type=\"button\" class=\"btn btn-primary\" id=\"companies-detail-reanalyze-btn\" data-id=\"${escapeHtml(company.id)}\">${escapeHtml(S.reAnalyze)}</button>\r\n        <button type=\"button\" class=\"btn btn-secondary\" id=\"companies-detail-edit-btn\" data-id=\"${escapeHtml(company.id)}\">${escapeHtml(S.edit)}</button>\r\n      </div>\r\n    `;\r\n    on(body.querySelector('#companies-detail-back-btn') as HTMLElement, 'click', showListView);\r\n    on(body.querySelector('#companies-detail-edit-btn') as HTMLElement, 'click', () => showForm(company));\r\n    const reanalyzeBtn = body.querySelector('#companies-detail-reanalyze-btn') as HTMLButtonElement;\r\n    on(reanalyzeBtn, 'click', async () => {\r\n      reanalyzeBtn.disabled = true;\r\n      reanalyzeBtn.textContent = '...';\r\n      try {\r\n        const updated = await analyzeCompany(company.id);\r\n        toast.success(S.analysisComplete);\r\n        showDetailView(updated);\r\n      } catch {\r\n        toast.error(S.analysisFailed);\r\n      } finally {\r\n        reanalyzeBtn.disabled = false;\r\n        reanalyzeBtn.textContent = S.reAnalyze;\r\n      }\r\n    });\r\n  }\r\n\r\n  function bindListEvents() {\r\n    on(overlay.querySelector('#companies-close-btn') as HTMLElement, 'click', close);\r\n    on(overlay, 'click', (e) => { if (e.target === overlay) close(); });\r\n    on(container, 'click', (e) => e.stopPropagation());\r\n\r\n    /* Event delegation: list buttons and New are re-created when body is replaced, so bind once on container */\r\n    on(container, 'click', async (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (target.closest('#companies-new-btn')) {\r\n        showForm();\r\n        return;\r\n      }\r\n      const editBtn = target.closest('.companies-edit-btn');\r\n      const analyzeBtn = target.closest('.companies-analyze-btn');\r\n      const detailBtn = target.closest('.companies-detail-btn');\r\n      const deleteBtn = target.closest('.companies-delete-btn');\r\n      const id = (editBtn || analyzeBtn || detailBtn || deleteBtn)?.getAttribute('data-id');\r\n      if (!id) return;\r\n\r\n      if (detailBtn) {\r\n        try {\r\n          const c = await getCompany(id);\r\n          if (c) showDetailView(c);\r\n        } catch {\r\n          toast.error(S.loadFailed);\r\n        }\r\n        return;\r\n      }\r\n      if (editBtn) {\r\n        try {\r\n          const c = await getCompany(id);\r\n          if (c) showForm(c);\r\n        } catch {\r\n          toast.error(S.loadFailed);\r\n        }\r\n        return;\r\n      }\r\n      if (analyzeBtn) {\r\n        const btn = analyzeBtn as HTMLButtonElement;\r\n        btn.disabled = true;\r\n        const origText = btn.textContent;\r\n        btn.textContent = '...';\r\n        try {\r\n          await analyzeCompany(id);\r\n          toast.success(S.analysisComplete);\r\n          loadList();\r\n        } catch {\r\n          toast.error(S.analysisFailed);\r\n        } finally {\r\n          btn.disabled = false;\r\n          btn.textContent = origText || S.analyze;\r\n        }\r\n        return;\r\n      }\r\n      if (deleteBtn) {\r\n        if (!confirm(S.deleteConfirm)) return;\r\n        try {\r\n          await deleteCompany(id);\r\n          toast.success(S.companyDeleted);\r\n          loadList();\r\n        } catch {\r\n          // API client already shows error toast\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  loadList();\r\n  bindListEvents();\r\n}\r\n","/**\r\n * Settings Modal Component - User Preferences\r\n * Simplified modal for user settings (Theme, Language, Data & Privacy)\r\n * Admin/LLM settings are now in the Admin panel (sidebar)\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { appStore } from '../../stores/app';\r\nimport { theme } from '../../services/theme';\r\nimport { toast } from '../../services/toast';\r\nimport { showCompaniesModal } from './CompaniesModal';\r\n\r\nconst MODAL_ID = 'settings-modal';\r\n\r\nexport interface SettingsModalProps {\r\n  onSave?: (settings: Record<string, unknown>) => void;\r\n  initialTab?: 'general' | 'data';\r\n}\r\n\r\nexport interface SettingsBindOptions {\r\n  onClose?: () => void;\r\n  onManageCompanies?: () => void;\r\n  onSaveSuccess?: () => void;\r\n  onSave?: (settings: Record<string, unknown>) => void;\r\n}\r\n\r\n/**\r\n * Get settings card + styles HTML (shared by modal and full page).\r\n * When pageMode is true, header shows \"Back to Dashboard\" instead of close X.\r\n */\r\nexport function getSettingsMarkup(\r\n  state: ReturnType<typeof appStore.getState>,\r\n  currentTheme: string,\r\n  initialTab: 'general' | 'data',\r\n  options?: { pageMode?: boolean }\r\n): string {\r\n  const pageMode = options?.pageMode ?? false;\r\n  const closeButtonHtml = pageMode\r\n    ? `<button class=\"settings-close settings-back\" id=\"close-settings-btn\" type=\"button\">\r\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" style=\"width:18px;height:18px;margin-right:6px;\"><path d=\"M19 12H5M12 19l-7-7 7-7\"/></svg>\r\n        Back to Dashboard\r\n      </button>`\r\n    : `<button class=\"settings-close\" id=\"close-settings-btn\">\r\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <path d=\"M18 6L6 18M6 6l12 12\"/>\r\n        </svg>\r\n      </button>`;\r\n\r\n  return `\r\n    <style>\r\n      .settings-modal-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0, 0, 0, 0.5);\r\n        backdrop-filter: blur(4px);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 1000;\r\n        padding: 20px;\r\n      }\r\n      \r\n      .settings-modal-container {\r\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n        width: 100%;\r\n        max-width: 520px;\r\n      }\r\n      \r\n      .settings-card {\r\n        background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(248,250,252,0.98) 100%);\r\n        backdrop-filter: blur(20px);\r\n        border-radius: 20px;\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\r\n          0 0 0 1px rgba(255, 255, 255, 0.8);\r\n        overflow: hidden;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-card {\r\n        background: linear-gradient(135deg, rgba(30,41,59,0.98) 0%, rgba(15,23,42,0.98) 100%);\r\n        box-shadow: \r\n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\r\n          0 0 0 1px rgba(255, 255, 255, 0.1);\r\n      }\r\n      \r\n      .settings-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        padding: 24px 28px;\r\n        position: relative;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .settings-header::before {\r\n        content: '';\r\n        position: absolute;\r\n        top: -50%;\r\n        right: -50%;\r\n        width: 100%;\r\n        height: 200%;\r\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\r\n        pointer-events: none;\r\n      }\r\n      \r\n      .settings-header-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 14px;\r\n        position: relative;\r\n        z-index: 1;\r\n      }\r\n      \r\n      .settings-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        border-radius: 12px;\r\n        background: rgba(255,255,255,0.2);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        border: 2px solid rgba(255,255,255,0.3);\r\n      }\r\n      \r\n      .settings-icon svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        stroke: white;\r\n        fill: none;\r\n      }\r\n      \r\n      .settings-title {\r\n        flex: 1;\r\n      }\r\n      \r\n      .settings-title h2 {\r\n        color: white;\r\n        font-size: 1.4rem;\r\n        font-weight: 600;\r\n        margin: 0;\r\n        text-shadow: 0 1px 2px rgba(0,0,0,0.1);\r\n      }\r\n      \r\n      .settings-title p {\r\n        color: rgba(255,255,255,0.85);\r\n        font-size: 0.85rem;\r\n        margin: 4px 0 0;\r\n      }\r\n      \r\n      .settings-close {\r\n        position: absolute;\r\n        top: 16px;\r\n        right: 16px;\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        transition: background 0.2s;\r\n        z-index: 2;\r\n      }\r\n      \r\n      .settings-close:hover {\r\n        background: rgba(255,255,255,0.3);\r\n      }\r\n      \r\n      .settings-close svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        stroke: white;\r\n      }\r\n      \r\n      .settings-tabs {\r\n        display: flex;\r\n        gap: 8px;\r\n        padding: 16px 24px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-tabs {\r\n        background: rgba(30,41,59,0.5);\r\n        border-bottom-color: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .settings-tab {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 10px 16px;\r\n        border: none;\r\n        background: transparent;\r\n        color: var(--text-secondary, #64748b);\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        border-radius: 10px;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .settings-tab:hover {\r\n        background: var(--bg-hover, rgba(0,0,0,0.05));\r\n        color: var(--text-primary, #1e293b);\r\n      }\r\n      \r\n      .settings-tab.active {\r\n        background: white;\r\n        color: #e11d48;\r\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-tab.active {\r\n        background: rgba(225,29,72,0.15);\r\n        color: #fb7185;\r\n      }\r\n      \r\n      .settings-tab svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        stroke: currentColor;\r\n        fill: none;\r\n      }\r\n      \r\n      .settings-body {\r\n        padding: 24px;\r\n        max-height: 400px;\r\n        overflow-y: auto;\r\n      }\r\n      \r\n      .settings-section {\r\n        display: none;\r\n      }\r\n      \r\n      .settings-section.active {\r\n        display: block;\r\n      }\r\n      \r\n      .settings-section h3 {\r\n        font-size: 0.85rem;\r\n        font-weight: 600;\r\n        color: var(--text-secondary, #64748b);\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n        margin: 0 0 16px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n      }\r\n      \r\n      .settings-section h3 svg {\r\n        width: 16px;\r\n        height: 16px;\r\n        stroke: currentColor;\r\n      }\r\n      \r\n      .form-group {\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .form-group:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .form-group label {\r\n        display: block;\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        color: var(--text-primary, #1e293b);\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .form-group p.hint {\r\n        font-size: 0.8rem;\r\n        color: var(--text-secondary, #64748b);\r\n        margin: 6px 0 0;\r\n      }\r\n      \r\n      .form-select {\r\n        width: 100%;\r\n        padding: 12px 14px;\r\n        border: 1px solid var(--border-color, #e2e8f0);\r\n        border-radius: 10px;\r\n        background: var(--bg-primary, white);\r\n        color: var(--text-primary, #1e293b);\r\n        font-size: 0.9rem;\r\n        transition: border-color 0.2s, box-shadow 0.2s;\r\n        appearance: none;\r\n        background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2364748b' d='M2.5 4.5L6 8l3.5-3.5'/%3E%3C/svg%3E\");\r\n        background-repeat: no-repeat;\r\n        background-position: right 12px center;\r\n        cursor: pointer;\r\n      }\r\n      \r\n      .form-select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .form-select {\r\n        background-color: rgba(30,41,59,0.8);\r\n        border-color: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .toggle-group {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding: 14px 16px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-radius: 10px;\r\n        margin-bottom: 12px;\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .toggle-group {\r\n        background: rgba(30,41,59,0.5);\r\n      }\r\n      \r\n      .toggle-group:last-child {\r\n        margin-bottom: 0;\r\n      }\r\n      \r\n      .toggle-info {\r\n        flex: 1;\r\n      }\r\n      \r\n      .toggle-info strong {\r\n        display: block;\r\n        font-size: 0.9rem;\r\n        color: var(--text-primary, #1e293b);\r\n        margin-bottom: 2px;\r\n      }\r\n      \r\n      .toggle-info span {\r\n        font-size: 0.8rem;\r\n        color: var(--text-secondary, #64748b);\r\n      }\r\n      \r\n      .toggle-switch {\r\n        position: relative;\r\n        width: 48px;\r\n        height: 26px;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .toggle-switch input {\r\n        opacity: 0;\r\n        width: 0;\r\n        height: 0;\r\n      }\r\n      \r\n      .toggle-slider {\r\n        position: absolute;\r\n        cursor: pointer;\r\n        inset: 0;\r\n        background: var(--bg-tertiary, #cbd5e1);\r\n        border-radius: 26px;\r\n        transition: 0.3s;\r\n      }\r\n      \r\n      .toggle-slider::before {\r\n        content: '';\r\n        position: absolute;\r\n        width: 20px;\r\n        height: 20px;\r\n        left: 3px;\r\n        bottom: 3px;\r\n        background: white;\r\n        border-radius: 50%;\r\n        transition: 0.3s;\r\n        box-shadow: 0 2px 4px rgba(0,0,0,0.2);\r\n      }\r\n      \r\n      .toggle-switch input:checked + .toggle-slider {\r\n        background: #e11d48;\r\n      }\r\n      \r\n      .toggle-switch input:checked + .toggle-slider::before {\r\n        transform: translateX(22px);\r\n      }\r\n      \r\n      .settings-footer {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 12px;\r\n        padding: 20px 24px;\r\n        background: var(--bg-secondary, #f8fafc);\r\n        border-top: 1px solid var(--border-color, #e2e8f0);\r\n      }\r\n      \r\n      [data-theme=\"dark\"] .settings-footer {\r\n        background: rgba(30,41,59,0.5);\r\n        border-top-color: rgba(255,255,255,0.1);\r\n      }\r\n      \r\n      .btn-cancel {\r\n        padding: 10px 20px;\r\n        border: 1px solid var(--border-color, #e2e8f0);\r\n        border-radius: 10px;\r\n        background: var(--bg-primary, white);\r\n        color: var(--text-primary, #1e293b);\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: background 0.2s;\r\n      }\r\n      \r\n      .btn-cancel:hover {\r\n        background: var(--bg-hover, #f1f5f9);\r\n      }\r\n      \r\n      .btn-save {\r\n        padding: 10px 24px;\r\n        border: none;\r\n        border-radius: 10px;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        transition: transform 0.2s, box-shadow 0.2s;\r\n      }\r\n      \r\n      .btn-save:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .btn-save svg {\r\n        width: 18px;\r\n        height: 18px;\r\n        stroke: white;\r\n      }\r\n      \r\n      .admin-notice {\r\n        background: linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(37,99,235,0.1) 100%);\r\n        border: 1px solid rgba(59,130,246,0.3);\r\n        border-radius: 10px;\r\n        padding: 14px 16px;\r\n        margin-top: 20px;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .admin-notice svg {\r\n        width: 20px;\r\n        height: 20px;\r\n        stroke: #3b82f6;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .admin-notice p {\r\n        font-size: 0.85rem;\r\n        color: var(--text-secondary, #64748b);\r\n        margin: 0;\r\n      }\r\n      \r\n      .admin-notice strong {\r\n        color: #3b82f6;\r\n      }\r\n      .settings-back {\r\n        position: static;\r\n        display: inline-flex;\r\n        align-items: center;\r\n        padding: 8px 14px;\r\n        font-size: 0.9rem;\r\n        font-weight: 500;\r\n        color: rgba(255,255,255,0.95);\r\n      }\r\n      .settings-back:hover {\r\n        background: rgba(255,255,255,0.15);\r\n      }\r\n      .settings-page-card .settings-body {\r\n        max-height: none;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"settings-card ${pageMode ? 'settings-page-card' : ''}\">\r\n      <!-- Header -->\r\n      <div class=\"settings-header\">\r\n        ${closeButtonHtml}\r\n        <div class=\"settings-header-content\">\r\n          <div class=\"settings-icon\">\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n              <path d=\"M12 15a3 3 0 100-6 3 3 0 000 6z\"/>\r\n              <path d=\"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z\"/>\r\n            </svg>\r\n          </div>\r\n          <div class=\"settings-title\">\r\n            <h2>Settings</h2>\r\n            <p>Your personal preferences</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Tabs -->\r\n      <div class=\"settings-tabs\">\r\n        <button class=\"settings-tab ${initialTab === 'general' ? 'active' : ''}\" data-tab=\"general\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"3\"/>\r\n            <path d=\"M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41\"/>\r\n          </svg>\r\n          General\r\n        </button>\r\n        <button class=\"settings-tab ${initialTab === 'data' ? 'active' : ''}\" data-tab=\"data\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\"/>\r\n          </svg>\r\n          Data & Privacy\r\n        </button>\r\n      </div>\r\n      \r\n      <!-- Body -->\r\n      <div class=\"settings-body\">\r\n        <!-- General Section -->\r\n        <div class=\"settings-section ${initialTab === 'general' ? 'active' : ''}\" id=\"section-general\">\r\n          <h3>\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n              <path d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707\"/>\r\n            </svg>\r\n            Appearance\r\n          </h3>\r\n          \r\n          <div class=\"form-group\">\r\n            <label>Theme</label>\r\n            <select class=\"form-select\" id=\"setting-theme\">\r\n              <option value=\"system\" ${currentTheme === 'system' ? 'selected' : ''}>System (Auto)</option>\r\n              <option value=\"light\" ${currentTheme === 'light' ? 'selected' : ''}>Light</option>\r\n              <option value=\"dark\" ${currentTheme === 'dark' ? 'selected' : ''}>Dark</option>\r\n            </select>\r\n            <p class=\"hint\">Choose your preferred color scheme</p>\r\n          </div>\r\n          \r\n          <div class=\"form-group\">\r\n            <label>Language</label>\r\n            <select class=\"form-select\" id=\"setting-language\">\r\n              <option value=\"en\" ${state.config.language === 'en' ? 'selected' : ''}>English</option>\r\n              <option value=\"pt\" ${state.config.language === 'pt' ? 'selected' : ''}>Portugues</option>\r\n              <option value=\"es\" ${state.config.language === 'es' ? 'selected' : ''}>Espanol</option>\r\n            </select>\r\n            <p class=\"hint\">Interface language preference</p>\r\n          </div>\r\n          \r\n          <h3 style=\"margin-top: 20px;\">\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\" style=\"width: 16px; height: 16px;\">\r\n              <path d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\r\n            </svg>\r\n            Companies\r\n          </h3>\r\n          <p class=\"hint\" style=\"margin-bottom: 10px;\">Manage company profiles for branding and document templates.</p>\r\n          <button type=\"button\" class=\"btn-save\" id=\"settings-manage-companies-btn\" style=\"margin-top: 0;\">\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\" style=\"width: 18px; height: 18px;\"><path d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/></svg>\r\n            Manage companies\r\n          </button>\r\n          \r\n          ${state.currentUser?.role === 'superadmin' ? `\r\n            <div class=\"admin-notice\">\r\n              <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n                <path d=\"M12 16v-4M12 8h.01\"/>\r\n              </svg>\r\n              <p>For <strong>LLM configuration</strong>, <strong>Graph</strong>, and other platform settings, use the <strong>Admin</strong> section in the sidebar menu.</p>\r\n            </div>\r\n          ` : ''}\r\n        </div>\r\n        \r\n        <!-- Data & Privacy Section -->\r\n        <div class=\"settings-section ${initialTab === 'data' ? 'active' : ''}\" id=\"section-data\">\r\n          <h3>\r\n            <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n              <path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\"/>\r\n            </svg>\r\n            Privacy Settings\r\n          </h3>\r\n          \r\n          <div class=\"toggle-group\">\r\n            <div class=\"toggle-info\">\r\n              <strong>Analytics</strong>\r\n              <span>Help improve GodMode with anonymous usage data</span>\r\n            </div>\r\n            <label class=\"toggle-switch\">\r\n              <input type=\"checkbox\" id=\"setting-analytics\" ${state.config.analyticsEnabled !== false ? 'checked' : ''}>\r\n              <span class=\"toggle-slider\"></span>\r\n            </label>\r\n          </div>\r\n          \r\n          <div class=\"toggle-group\">\r\n            <div class=\"toggle-info\">\r\n              <strong>Error Reporting</strong>\r\n              <span>Automatically report errors to help fix bugs</span>\r\n            </div>\r\n            <label class=\"toggle-switch\">\r\n              <input type=\"checkbox\" id=\"setting-error-reporting\" ${state.config.errorReportingEnabled !== false ? 'checked' : ''}>\r\n              <span class=\"toggle-slider\"></span>\r\n            </label>\r\n          </div>\r\n          \r\n          <div class=\"toggle-group\">\r\n            <div class=\"toggle-info\">\r\n              <strong>AI Data Improvement</strong>\r\n              <span>Allow anonymized data to improve AI responses</span>\r\n            </div>\r\n            <label class=\"toggle-switch\">\r\n              <input type=\"checkbox\" id=\"setting-ai-improvement\" ${state.config.aiImprovementEnabled === true ? 'checked' : ''}>\r\n              <span class=\"toggle-slider\"></span>\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Footer -->\r\n      <div class=\"settings-footer\">\r\n        <button class=\"btn-cancel\" id=\"cancel-settings-btn\">Cancel</button>\r\n        <button class=\"btn-save\" id=\"save-settings-btn\">\r\n          <svg viewBox=\"0 0 24 24\" stroke-width=\"2\">\r\n            <polyline points=\"20 6 9 17 4 12\"/>\r\n          </svg>\r\n          Save Settings\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Create and show settings modal\r\n */\r\nexport function showSettingsModal(props: SettingsModalProps = {}): void {\r\n  // Remove existing modal if any\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const state = appStore.getState();\r\n  const currentTheme = theme.getMode();\r\n  const initialTab = props.initialTab || 'general';\r\n\r\n  const modalOverlay = createElement('div', { className: 'settings-modal-overlay' });\r\n  modalOverlay.setAttribute('data-modal-id', MODAL_ID);\r\n  const container = createElement('div', { className: 'settings-modal-container' });\r\n  container.innerHTML = getSettingsMarkup(state, currentTheme, initialTab, { pageMode: false });\r\n  modalOverlay.appendChild(container);\r\n  document.body.appendChild(modalOverlay);\r\n\r\n  const closeModal = () => modalOverlay.remove();\r\n  bindSettingsEvents(modalOverlay, {\r\n    ...props,\r\n    onClose: closeModal,\r\n    onSaveSuccess: closeModal,\r\n    onManageCompanies: () => {\r\n      closeModal();\r\n      showCompaniesModal();\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Bind event handlers (shared by modal and full page).\r\n */\r\nexport function bindSettingsEvents(\r\n  root: HTMLElement,\r\n  props: SettingsModalProps & SettingsBindOptions\r\n): void {\r\n  const closeBtn = root.querySelector('#close-settings-btn');\r\n  const cancelBtn = root.querySelector('#cancel-settings-btn');\r\n  const isOverlay = root.classList.contains('settings-modal-overlay');\r\n\r\n  const closeAction = () => {\r\n    if (props.onClose) props.onClose();\r\n    else if (isOverlay) root.remove();\r\n  };\r\n\r\n  if (closeBtn) on(closeBtn as HTMLElement, 'click', closeAction);\r\n  if (cancelBtn) on(cancelBtn as HTMLElement, 'click', closeAction);\r\n\r\n  if (isOverlay) {\r\n    on(root, 'click', (e) => {\r\n      if (e.target === root) closeAction();\r\n    });\r\n  }\r\n\r\n  const manageCompaniesBtn = root.querySelector('#settings-manage-companies-btn');\r\n  if (manageCompaniesBtn) {\r\n    on(manageCompaniesBtn as HTMLElement, 'click', () => {\r\n      if (props.onManageCompanies) props.onManageCompanies();\r\n      else {\r\n        closeAction();\r\n        showCompaniesModal();\r\n      }\r\n    });\r\n  }\r\n\r\n  // Tab switching\r\n  const tabs = root.querySelectorAll('.settings-tab');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      const tabId = tab.getAttribute('data-tab');\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      root.querySelectorAll('.settings-section').forEach(section => {\r\n        section.classList.remove('active');\r\n      });\r\n      const targetSection = root.querySelector(`#section-${tabId}`);\r\n      if (targetSection) targetSection.classList.add('active');\r\n    });\r\n  });\r\n\r\n  const themeSelect = root.querySelector('#setting-theme') as HTMLSelectElement;\r\n  if (themeSelect) {\r\n    on(themeSelect, 'change', () => {\r\n      theme.set(themeSelect.value as 'light' | 'dark' | 'system');\r\n    });\r\n  }\r\n\r\n  const saveBtn = root.querySelector('#save-settings-btn');\r\n  if (saveBtn) {\r\n    on(saveBtn as HTMLElement, 'click', () => {\r\n      const settings = {\r\n        theme: (root.querySelector('#setting-theme') as HTMLSelectElement)?.value,\r\n        language: (root.querySelector('#setting-language') as HTMLSelectElement)?.value,\r\n        analyticsEnabled: (root.querySelector('#setting-analytics') as HTMLInputElement)?.checked,\r\n        errorReportingEnabled: (root.querySelector('#setting-error-reporting') as HTMLInputElement)?.checked,\r\n        aiImprovementEnabled: (root.querySelector('#setting-ai-improvement') as HTMLInputElement)?.checked,\r\n      };\r\n      appStore.setConfig({\r\n        ...appStore.getState().config,\r\n        ...settings,\r\n      });\r\n      props.onSave?.(settings);\r\n      toast.success('Settings saved');\r\n      props.onSaveSuccess?.();\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Close settings modal\r\n */\r\nexport function closeSettingsModal(): void {\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) modal.remove();\r\n}\r\n\r\nexport default showSettingsModal;\r\n","/**\r\n * Processing Modal Component\r\n * Shows progress for file processing operations\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal, updateModalContent } from '../Modal';\r\n\r\nconst MODAL_ID = 'processing-modal';\r\n\r\nexport interface ProcessingStep {\r\n  id: string;\r\n  label: string;\r\n  status: 'pending' | 'running' | 'completed' | 'error';\r\n  progress?: number;\r\n  message?: string;\r\n}\r\n\r\nexport interface ProcessingModalProps {\r\n  title?: string;\r\n  steps?: ProcessingStep[];\r\n  onCancel?: () => void;\r\n  allowCancel?: boolean;\r\n}\r\n\r\nlet currentSteps: ProcessingStep[] = [];\r\nlet cancelCallback: (() => void) | undefined;\r\n\r\n/**\r\n * Show processing modal\r\n */\r\nexport function showProcessingModal(props: ProcessingModalProps = {}): void {\r\n  const {\r\n    title = 'Processing',\r\n    steps = [],\r\n    onCancel,\r\n    allowCancel = true,\r\n  } = props;\r\n\r\n  currentSteps = steps;\r\n  cancelCallback = onCancel;\r\n\r\n  // Remove existing modal if any\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'processing-content' });\r\n  renderContent(content);\r\n\r\n  const footer = allowCancel ? createFooter() : null;\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    content,\r\n    size: 'md',\r\n    closable: false,\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Render processing content\r\n */\r\nfunction renderContent(container: HTMLElement): void {\r\n  container.innerHTML = `\r\n    <div class=\"processing-steps\">\r\n      ${currentSteps.map(step => renderStep(step)).join('')}\r\n    </div>\r\n    <div class=\"processing-overall\">\r\n      <div class=\"progress-bar\">\r\n        <div class=\"progress-fill\" style=\"--progress: ${calculateOverallProgress()}\"></div>\r\n      </div>\r\n      <div class=\"progress-text\">${calculateOverallProgress()}% complete</div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render a single step\r\n */\r\nfunction renderStep(step: ProcessingStep): string {\r\n  const statusIcon = {\r\n    pending: '',\r\n    running: '',\r\n    completed: '',\r\n    error: '',\r\n  }[step.status];\r\n\r\n  const statusClass = step.status;\r\n\r\n  return `\r\n    <div class=\"processing-step ${statusClass}\" data-step-id=\"${step.id}\">\r\n      <span class=\"step-icon\">${statusIcon}</span>\r\n      <div class=\"step-content\">\r\n        <div class=\"step-label\">${step.label}</div>\r\n        ${step.message ? `<div class=\"step-message\">${step.message}</div>` : ''}\r\n        ${step.status === 'running' && step.progress !== undefined ? `\r\n          <div class=\"step-progress\">\r\n            <div class=\"progress-bar small\">\r\n              <div class=\"progress-fill\" style=\"--progress: ${step.progress}\"></div>\r\n            </div>\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Calculate overall progress\r\n */\r\nfunction calculateOverallProgress(): number {\r\n  if (currentSteps.length === 0) return 0;\r\n\r\n  const completed = currentSteps.filter(s => s.status === 'completed').length;\r\n  const running = currentSteps.find(s => s.status === 'running');\r\n  const runningProgress = running?.progress || 0;\r\n\r\n  return Math.round(\r\n    ((completed + (running ? runningProgress / 100 : 0)) / currentSteps.length) * 100\r\n  );\r\n}\r\n\r\n/**\r\n * Create footer with cancel button\r\n */\r\nfunction createFooter(): HTMLElement {\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => {\r\n    cancelCallback?.();\r\n    closeProcessingModal();\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  return footer;\r\n}\r\n\r\n/**\r\n * Update processing step\r\n */\r\nexport function updateProcessingStep(\r\n  stepId: string,\r\n  updates: Partial<ProcessingStep>\r\n): void {\r\n  const stepIndex = currentSteps.findIndex(s => s.id === stepId);\r\n  if (stepIndex === -1) return;\r\n\r\n  currentSteps[stepIndex] = { ...currentSteps[stepIndex], ...updates };\r\n\r\n  // Re-render\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) {\r\n    const content = modal.querySelector('.processing-content');\r\n    if (content) {\r\n      renderContent(content as HTMLElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Add a new step\r\n */\r\nexport function addProcessingStep(step: ProcessingStep): void {\r\n  currentSteps.push(step);\r\n\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) {\r\n    const content = modal.querySelector('.processing-content');\r\n    if (content) {\r\n      renderContent(content as HTMLElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Set all steps at once\r\n */\r\nexport function setProcessingSteps(steps: ProcessingStep[]): void {\r\n  currentSteps = steps;\r\n\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (modal) {\r\n    const content = modal.querySelector('.processing-content');\r\n    if (content) {\r\n      renderContent(content as HTMLElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Close processing modal\r\n */\r\nexport function closeProcessingModal(): void {\r\n  closeModal(MODAL_ID);\r\n  currentSteps = [];\r\n  cancelCallback = undefined;\r\n}\r\n\r\n/**\r\n * Check if processing modal is open\r\n */\r\nexport function isProcessingModalOpen(): boolean {\r\n  const modal = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  return modal?.classList.contains('open') || false;\r\n}\r\n\r\nexport default showProcessingModal;\r\n","/**\n * Auth Modal Component\n * Login, registration, and password reset dialogs\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { auth } from '../../services/auth';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'auth-modal';\n\nexport type AuthMode = 'login' | 'register' | 'forgot' | 'reset' | 'otp-request' | 'otp-verify' | 'email-confirm';\n\nexport interface AuthModalProps {\n  initialMode?: AuthMode;\n  resetToken?: string; // For password reset flow\n  email?: string; // For OTP flows\n  onSuccess?: (user: { id: string; email: string; name?: string }) => void;\n  onClose?: () => void;\n  required?: boolean; // If true, modal cannot be closed without logging in\n}\n\nlet currentMode: AuthMode = 'login';\nlet currentProps: AuthModalProps = {};\nlet otpEmail: string = '';\nlet resendCooldown: number = 0;\nlet resendTimer: NodeJS.Timeout | null = null;\n\n/**\n * Show auth modal\n */\nexport function showAuthModal(props: AuthModalProps = {}): void {\n  currentMode = props.initialMode || 'login';\n  currentProps = props;\n\n  // Remove existing modal if any\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'auth-content' });\n  renderAuthContent(content);\n\n  const modal = createModal({\n    id: MODAL_ID,\n    title: getTitle(),\n    content,\n    size: 'sm',\n    closable: !props.required, // Can't close if login is required\n    onClose: props.onClose,\n    footer: null,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Focus first input\n  setTimeout(() => {\n    const firstInput = content.querySelector('input') as HTMLInputElement;\n    if (firstInput) firstInput.focus();\n  }, 100);\n}\n\n/**\n * Get modal title based on mode\n */\nfunction getTitle(): string {\n  switch (currentMode) {\n    case 'login': return 'Sign In';\n    case 'register': return 'Create Account';\n    case 'forgot': return 'Reset Password';\n    case 'reset': return 'Set New Password';\n    case 'otp-request': return 'Sign In with Code';\n    case 'otp-verify': return 'Enter Code';\n    case 'email-confirm': return 'Confirm Email';\n  }\n}\n\n/**\n * Render auth content\n */\nfunction renderAuthContent(container: HTMLElement): void {\n  // Clear any existing timers\n  if (resendTimer) {\n    clearInterval(resendTimer);\n    resendTimer = null;\n  }\n  \n  switch (currentMode) {\n    case 'login':\n      renderLoginForm(container);\n      break;\n    case 'register':\n      renderRegisterForm(container);\n      break;\n    case 'forgot':\n      renderForgotForm(container);\n      break;\n    case 'reset':\n      renderResetForm(container);\n      break;\n    case 'otp-request':\n      renderOTPRequestForm(container);\n      break;\n    case 'otp-verify':\n      renderOTPVerifyForm(container);\n      break;\n    case 'email-confirm':\n      renderEmailConfirmForm(container);\n      break;\n  }\n}\n\n/**\n * Render login form\n */\nfunction renderLoginForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"login-form\" class=\"auth-form\">\n      <div class=\"form-group\">\n        <label for=\"login-email\">Email</label>\n        <input type=\"email\" id=\"login-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\n      </div>\n      <div class=\"form-group\">\n        <label for=\"login-password\">Password</label>\n        <input type=\"password\" id=\"login-password\" required autocomplete=\"current-password\" placeholder=\"\">\n      </div>\n      <div class=\"form-error hidden\" id=\"login-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Sign In</span>\n          <span class=\"btn-loading hidden\">Signing in...</span>\n        </button>\n      </div>\n      <div class=\"auth-divider\">\n        <span>or</span>\n      </div>\n      <div class=\"form-group\">\n        <button type=\"button\" class=\"btn btn-secondary btn-block\" data-action=\"otp-request\">\n          Sign in with email code\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"forgot\">Forgot password?</button>\n        <span class=\"separator\">|</span>\n        <button type=\"button\" class=\"btn-link\" data-action=\"register\">Create account</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#login-form') as HTMLFormElement;\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleLogin(form);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render registration form\n */\nfunction renderRegisterForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"register-form\" class=\"auth-form\">\n      <div class=\"form-group\">\n        <label for=\"register-email\">Email <span class=\"required\">*</span></label>\n        <input type=\"email\" id=\"register-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-username\">Username</label>\n        <input type=\"text\" id=\"register-username\" autocomplete=\"username\" placeholder=\"username (optional)\" \n               pattern=\"^[a-zA-Z0-9_]+$\" minlength=\"3\">\n        <small class=\"form-hint\">Letters, numbers, and underscores only. Min 3 characters.</small>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-display-name\">Display Name</label>\n        <input type=\"text\" id=\"register-display-name\" autocomplete=\"name\" placeholder=\"Your Name (optional)\">\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-password\">Password <span class=\"required\">*</span></label>\n        <input type=\"password\" id=\"register-password\" required autocomplete=\"new-password\" \n               minlength=\"12\" placeholder=\"Min. 12 characters\">\n        <div class=\"password-strength\" id=\"password-strength\"></div>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"register-confirm\">Confirm Password <span class=\"required\">*</span></label>\n        <input type=\"password\" id=\"register-confirm\" required autocomplete=\"new-password\" placeholder=\"\">\n      </div>\n      <div class=\"form-error hidden\" id=\"register-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Create Account</span>\n          <span class=\"btn-loading hidden\">Creating account...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Already have an account? Sign in</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#register-form') as HTMLFormElement;\n  \n  // Password strength indicator\n  const passwordInput = form.querySelector('#register-password') as HTMLInputElement;\n  on(passwordInput, 'input', () => {\n    updatePasswordStrength(passwordInput.value);\n  });\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleRegister(form);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render forgot password form\n */\nfunction renderForgotForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"forgot-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter your email address and we'll send you a link to reset your password.\n      </p>\n      <div class=\"form-group\">\n        <label for=\"forgot-email\">Email</label>\n        <input type=\"email\" id=\"forgot-email\" required autocomplete=\"email\" placeholder=\"your@email.com\">\n      </div>\n      <div class=\"form-error hidden\" id=\"forgot-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Send Reset Link</span>\n          <span class=\"btn-loading hidden\">Sending...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Back to sign in</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#forgot-form') as HTMLFormElement;\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleForgot(form);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render reset password form\n */\nfunction renderResetForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"reset-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter your new password below.\n      </p>\n      <div class=\"form-group\">\n        <label for=\"reset-password\">New Password</label>\n        <input type=\"password\" id=\"reset-password\" required autocomplete=\"new-password\" \n               minlength=\"12\" placeholder=\"Min. 12 characters\">\n        <div class=\"password-strength\" id=\"reset-password-strength\"></div>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"reset-confirm\">Confirm Password</label>\n        <input type=\"password\" id=\"reset-confirm\" required autocomplete=\"new-password\" placeholder=\"\">\n      </div>\n      <div class=\"form-error hidden\" id=\"reset-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Reset Password</span>\n          <span class=\"btn-loading hidden\">Resetting...</span>\n        </button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#reset-form') as HTMLFormElement;\n  \n  // Password strength indicator\n  const passwordInput = form.querySelector('#reset-password') as HTMLInputElement;\n  on(passwordInput, 'input', () => {\n    updatePasswordStrength(passwordInput.value, 'reset-password-strength');\n  });\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleReset(form);\n  });\n}\n\n/**\n * Render OTP request form (enter email to receive code)\n */\nfunction renderOTPRequestForm(container: HTMLElement): void {\n  container.innerHTML = `\n    <form id=\"otp-request-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter your email address and we'll send you a one-time code to sign in.\n      </p>\n      <div class=\"form-group\">\n        <label for=\"otp-email\">Email</label>\n        <input type=\"email\" id=\"otp-email\" required autocomplete=\"email\" placeholder=\"your@email.com\" value=\"${otpEmail}\">\n      </div>\n      <div class=\"form-error hidden\" id=\"otp-request-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\">\n          <span class=\"btn-text\">Send Code</span>\n          <span class=\"btn-loading hidden\">Sending...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Sign in with password</button>\n        <span class=\"separator\">|</span>\n        <button type=\"button\" class=\"btn-link\" data-action=\"register\">Create account</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#otp-request-form') as HTMLFormElement;\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleOTPRequest(form, container);\n  });\n\n  bindModeLinks(container);\n}\n\n/**\n * Render OTP verify form (enter 6-digit code)\n */\nfunction renderOTPVerifyForm(container: HTMLElement): void {\n  const maskedEmail = otpEmail ? \n    otpEmail.replace(/(.{2})(.*)(@.*)/, '$1***$3') : \n    'your email';\n  \n  container.innerHTML = `\n    <form id=\"otp-verify-form\" class=\"auth-form\">\n      <p class=\"form-description\">\n        Enter the 6-digit code sent to <strong>${maskedEmail}</strong>\n      </p>\n      <div class=\"form-group otp-input-group\">\n        <div class=\"otp-inputs\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" autocomplete=\"one-time-code\" data-index=\"0\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"1\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"2\">\n          <span class=\"otp-separator\">-</span>\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"3\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"4\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"5\">\n        </div>\n        <input type=\"hidden\" id=\"otp-code\" name=\"code\">\n      </div>\n      <div class=\"form-error hidden\" id=\"otp-verify-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\" id=\"otp-verify-btn\" disabled>\n          <span class=\"btn-text\">Verify Code</span>\n          <span class=\"btn-loading hidden\">Verifying...</span>\n        </button>\n      </div>\n      <div class=\"otp-resend\">\n        <button type=\"button\" class=\"btn-link\" id=\"resend-code-btn\" ${resendCooldown > 0 ? 'disabled' : ''}>\n          ${resendCooldown > 0 ? `Resend code in ${resendCooldown}s` : 'Resend code'}\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"otp-request\">Use different email</button>\n        <span class=\"separator\">|</span>\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Sign in with password</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#otp-verify-form') as HTMLFormElement;\n  const inputs = container.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n  const hiddenInput = container.querySelector('#otp-code') as HTMLInputElement;\n  const verifyBtn = container.querySelector('#otp-verify-btn') as HTMLButtonElement;\n  const resendBtn = container.querySelector('#resend-code-btn') as HTMLButtonElement;\n\n  // Setup OTP input handlers\n  setupOTPInputs(inputs, hiddenInput, verifyBtn);\n\n  // Setup resend cooldown timer\n  if (resendCooldown > 0) {\n    startResendCooldown(resendBtn);\n  }\n\n  // Resend handler\n  on(resendBtn, 'click', async () => {\n    await handleResendCode(container);\n  });\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleOTPVerify(form, container);\n  });\n\n  bindModeLinks(container);\n\n  // Focus first input\n  setTimeout(() => inputs[0]?.focus(), 100);\n}\n\n/**\n * Render email confirmation form\n */\nfunction renderEmailConfirmForm(container: HTMLElement): void {\n  const email = currentProps.email || otpEmail || '';\n  \n  container.innerHTML = `\n    <form id=\"email-confirm-form\" class=\"auth-form\">\n      <div class=\"confirm-icon\"></div>\n      <p class=\"form-description\">\n        Enter the confirmation code sent to <strong>${email || 'your email'}</strong>\n      </p>\n      <div class=\"form-group otp-input-group\">\n        <div class=\"otp-inputs\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"0\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"1\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"2\">\n          <span class=\"otp-separator\">-</span>\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"3\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"4\">\n          <input type=\"text\" class=\"otp-digit\" maxlength=\"1\" pattern=\"[0-9]\" inputmode=\"numeric\" data-index=\"5\">\n        </div>\n        <input type=\"hidden\" id=\"confirm-code\" name=\"code\">\n      </div>\n      <div class=\"form-error hidden\" id=\"email-confirm-error\"></div>\n      <div class=\"form-group\">\n        <button type=\"submit\" class=\"btn btn-primary btn-block\" id=\"confirm-btn\" disabled>\n          <span class=\"btn-text\">Confirm Email</span>\n          <span class=\"btn-loading hidden\">Confirming...</span>\n        </button>\n      </div>\n      <div class=\"auth-links\">\n        <button type=\"button\" class=\"btn-link\" data-action=\"login\">Back to sign in</button>\n      </div>\n    </form>\n  `;\n\n  const form = container.querySelector('#email-confirm-form') as HTMLFormElement;\n  const inputs = container.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n  const hiddenInput = container.querySelector('#confirm-code') as HTMLInputElement;\n  const confirmBtn = container.querySelector('#confirm-btn') as HTMLButtonElement;\n\n  setupOTPInputs(inputs, hiddenInput, confirmBtn);\n\n  on(form, 'submit', async (e) => {\n    e.preventDefault();\n    await handleEmailConfirm(form, container, email);\n  });\n\n  bindModeLinks(container);\n  setTimeout(() => inputs[0]?.focus(), 100);\n}\n\n/**\n * Setup OTP digit inputs with auto-advance and paste support\n */\nfunction setupOTPInputs(\n  inputs: NodeListOf<HTMLInputElement>, \n  hiddenInput: HTMLInputElement, \n  submitBtn: HTMLButtonElement\n): void {\n  const updateHiddenValue = () => {\n    const code = Array.from(inputs).map(i => i.value).join('');\n    hiddenInput.value = code;\n    submitBtn.disabled = code.length !== 6 || !/^\\d{6}$/.test(code);\n  };\n\n  inputs.forEach((input, index) => {\n    // Handle input\n    on(input, 'input', (e) => {\n      const value = (e.target as HTMLInputElement).value;\n      \n      // Only allow digits\n      if (!/^\\d*$/.test(value)) {\n        input.value = value.replace(/\\D/g, '');\n        return;\n      }\n      \n      // If multiple digits pasted, distribute them\n      if (value.length > 1) {\n        const digits = value.split('');\n        inputs.forEach((inp, i) => {\n          inp.value = digits[i] || '';\n        });\n        const nextIndex = Math.min(digits.length, 5);\n        inputs[nextIndex]?.focus();\n        updateHiddenValue();\n        return;\n      }\n      \n      // Auto-advance to next input\n      if (value && index < inputs.length - 1) {\n        inputs[index + 1].focus();\n      }\n      \n      updateHiddenValue();\n    });\n\n    // Handle keydown for backspace navigation\n    on(input, 'keydown', (e) => {\n      const key = (e as KeyboardEvent).key;\n      \n      if (key === 'Backspace' && !input.value && index > 0) {\n        inputs[index - 1].focus();\n        inputs[index - 1].value = '';\n        updateHiddenValue();\n      }\n      \n      // Arrow navigation\n      if (key === 'ArrowLeft' && index > 0) {\n        inputs[index - 1].focus();\n      }\n      if (key === 'ArrowRight' && index < inputs.length - 1) {\n        inputs[index + 1].focus();\n      }\n    });\n\n    // Handle paste\n    on(input, 'paste', (e) => {\n      e.preventDefault();\n      const pasted = (e as ClipboardEvent).clipboardData?.getData('text') || '';\n      const digits = pasted.replace(/\\D/g, '').slice(0, 6);\n      \n      if (digits) {\n        digits.split('').forEach((digit, i) => {\n          if (inputs[i]) inputs[i].value = digit;\n        });\n        const nextIndex = Math.min(digits.length, 5);\n        inputs[nextIndex]?.focus();\n        updateHiddenValue();\n      }\n    });\n\n    // Select all on focus\n    on(input, 'focus', () => input.select());\n  });\n}\n\n/**\n * Start resend cooldown timer\n */\nfunction startResendCooldown(button: HTMLButtonElement): void {\n  if (resendTimer) clearInterval(resendTimer);\n  \n  const updateButton = () => {\n    if (resendCooldown > 0) {\n      button.disabled = true;\n      button.textContent = `Resend code in ${resendCooldown}s`;\n      resendCooldown--;\n    } else {\n      button.disabled = false;\n      button.textContent = 'Resend code';\n      if (resendTimer) {\n        clearInterval(resendTimer);\n        resendTimer = null;\n      }\n    }\n  };\n  \n  updateButton();\n  resendTimer = setInterval(updateButton, 1000);\n}\n\n/**\n * Handle OTP request\n */\nasync function handleOTPRequest(form: HTMLFormElement, container: HTMLElement): Promise<void> {\n  const email = (form.querySelector('#otp-email') as HTMLInputElement).value.trim();\n  const errorEl = form.querySelector('#otp-request-error') as HTMLElement;\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const result = await auth.requestLoginCode(email);\n    \n    // Store email for verify step\n    otpEmail = email;\n    \n    // Set cooldown for resend\n    resendCooldown = 60;\n    \n    toast.success(result.message || 'Code sent! Check your email.');\n    \n    // Switch to verify mode\n    currentMode = 'otp-verify';\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n    \n  } catch (error: unknown) {\n    const err = error as { message?: string; response?: { data?: { retryAfter?: number } } };\n    const message = err.message || 'Failed to send code';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle OTP verification\n */\nasync function handleOTPVerify(form: HTMLFormElement, container: HTMLElement): Promise<void> {\n  const code = (form.querySelector('#otp-code') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#otp-verify-error') as HTMLElement;\n\n  if (!code || code.length !== 6) {\n    showError(errorEl, 'Please enter the 6-digit code');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const user = await auth.verifyLoginCode(otpEmail, code);\n    \n    toast.success('Signed in successfully');\n    currentProps.onSuccess?.(user);\n    closeModal(MODAL_ID);\n    \n    // Trigger data refresh\n    window.dispatchEvent(new CustomEvent('godmode:auth-success'));\n    \n  } catch (error: unknown) {\n    const err = error as { \n      message?: string; \n      attemptsRemaining?: number;\n      needsEmailVerification?: boolean;\n      fallbackToPassword?: boolean;\n    };\n    \n    let message = err.message || 'Verification failed';\n    \n    if (err.attemptsRemaining !== undefined && err.attemptsRemaining > 0) {\n      message += ` (${err.attemptsRemaining} attempts remaining)`;\n    }\n    \n    if (err.needsEmailVerification) {\n      message = 'Please confirm your email address first.';\n      // Could switch to email-confirm mode here\n    }\n    \n    if (err.fallbackToPassword) {\n      message = 'Please sign in with your password instead.';\n    }\n    \n    showError(errorEl, message);\n    \n    // Clear inputs on error\n    const inputs = form.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n    inputs.forEach(i => i.value = '');\n    inputs[0]?.focus();\n    \n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle resend code\n */\nasync function handleResendCode(container: HTMLElement): Promise<void> {\n  if (resendCooldown > 0) return;\n  \n  const resendBtn = container.querySelector('#resend-code-btn') as HTMLButtonElement;\n  resendBtn.disabled = true;\n  resendBtn.textContent = 'Sending...';\n  \n  try {\n    await auth.requestLoginCode(otpEmail);\n    toast.success('New code sent!');\n    resendCooldown = 60;\n    startResendCooldown(resendBtn);\n  } catch (error: unknown) {\n    const err = error as { message?: string };\n    toast.error(err.message || 'Failed to resend code');\n    resendBtn.disabled = false;\n    resendBtn.textContent = 'Resend code';\n  }\n}\n\n/**\n * Handle email confirmation\n */\nasync function handleEmailConfirm(form: HTMLFormElement, container: HTMLElement, email: string): Promise<void> {\n  const code = (form.querySelector('#confirm-code') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#email-confirm-error') as HTMLElement;\n\n  if (!code || code.length !== 6) {\n    showError(errorEl, 'Please enter the 6-digit code');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    await auth.confirmEmail(email, code);\n    \n    toast.success('Email confirmed! You can now sign in.');\n    \n    // Switch to login mode\n    currentMode = 'login';\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n    \n  } catch (error: unknown) {\n    const err = error as { message?: string };\n    showError(errorEl, err.message || 'Confirmation failed');\n    \n    // Clear inputs\n    const inputs = form.querySelectorAll('.otp-digit') as NodeListOf<HTMLInputElement>;\n    inputs.forEach(i => i.value = '');\n    inputs[0]?.focus();\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Bind mode switch links\n */\nfunction bindModeLinks(container: HTMLElement): void {\n  const links = container.querySelectorAll('[data-action]');\n  links.forEach(link => {\n    on(link as HTMLElement, 'click', () => {\n      const action = link.getAttribute('data-action') as AuthMode;\n      currentMode = action;\n\n      // Update modal title\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n      if (titleEl) titleEl.textContent = getTitle();\n\n      // Re-render content\n      renderAuthContent(container);\n    });\n  });\n}\n\n/**\n * Handle login submission\n */\nasync function handleLogin(form: HTMLFormElement): Promise<void> {\n  const email = (form.querySelector('#login-email') as HTMLInputElement).value.trim();\n  const password = (form.querySelector('#login-password') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#login-error') as HTMLElement;\n  \n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const user = await auth.login({ email, password });\n    \n    toast.success('Signed in successfully');\n    currentProps.onSuccess?.(user);\n    closeModal(MODAL_ID);\n    \n    // Trigger data refresh\n    window.dispatchEvent(new CustomEvent('godmode:auth-success'));\n  } catch (error: unknown) {\n    const err = error as Error & { \n      response?: { data?: { needsEmailVerification?: boolean; email?: string } } \n    };\n    \n    // Check if email verification is needed\n    const responseData = err.response?.data;\n    if (responseData?.needsEmailVerification) {\n      // Switch to email confirmation mode\n      otpEmail = responseData.email || email;\n      currentProps.email = otpEmail;\n      resendCooldown = 60; // Just sent a new code\n      \n      toast.info('Please verify your email to continue.');\n      \n      currentMode = 'email-confirm';\n      const container = form.parentElement as HTMLElement;\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n      if (titleEl) titleEl.textContent = getTitle();\n      renderAuthContent(container);\n      return;\n    }\n    \n    const message = err.message || 'Login failed';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle registration submission\n */\nasync function handleRegister(form: HTMLFormElement): Promise<void> {\n  const email = (form.querySelector('#register-email') as HTMLInputElement).value.trim();\n  const username = (form.querySelector('#register-username') as HTMLInputElement).value.trim();\n  const displayName = (form.querySelector('#register-display-name') as HTMLInputElement).value.trim();\n  const password = (form.querySelector('#register-password') as HTMLInputElement).value;\n  const confirm = (form.querySelector('#register-confirm') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#register-error') as HTMLElement;\n\n  // Validate passwords match\n  if (password !== confirm) {\n    showError(errorEl, 'Passwords do not match');\n    return;\n  }\n\n  // Validate password length\n  if (password.length < 12) {\n    showError(errorEl, 'Password must be at least 12 characters');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    const result = await auth.register({\n      email,\n      password,\n      username: username || undefined,\n      display_name: displayName || undefined,\n    });\n\n    if (result.needsEmailVerification) {\n      toast.success('Account created! Please check your email to verify.');\n      // Switch to login mode\n      currentMode = 'login';\n      const container = form.parentElement as HTMLElement;\n      const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n      if (titleEl) titleEl.textContent = getTitle();\n      renderAuthContent(container);\n    } else {\n      toast.success('Account created successfully');\n      currentProps.onSuccess?.(result.user);\n      closeModal(MODAL_ID);\n      window.dispatchEvent(new CustomEvent('godmode:auth-success'));\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Registration failed';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle forgot password submission\n */\nasync function handleForgot(form: HTMLFormElement): Promise<void> {\n  const email = (form.querySelector('#forgot-email') as HTMLInputElement).value.trim();\n  const errorEl = form.querySelector('#forgot-error') as HTMLElement;\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    await auth.forgotPassword(email);\n    toast.success('If an account exists with this email, you will receive a reset link.');\n    \n    // Switch back to login\n    currentMode = 'login';\n    const container = form.parentElement as HTMLElement;\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n  } catch (error) {\n    // Always show success message to not reveal if email exists\n    toast.success('If an account exists with this email, you will receive a reset link.');\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Handle password reset submission\n */\nasync function handleReset(form: HTMLFormElement): Promise<void> {\n  const password = (form.querySelector('#reset-password') as HTMLInputElement).value;\n  const confirm = (form.querySelector('#reset-confirm') as HTMLInputElement).value;\n  const errorEl = form.querySelector('#reset-error') as HTMLElement;\n\n  if (password !== confirm) {\n    showError(errorEl, 'Passwords do not match');\n    return;\n  }\n\n  if (password.length < 12) {\n    showError(errorEl, 'Password must be at least 12 characters');\n    return;\n  }\n\n  if (!currentProps.resetToken) {\n    showError(errorEl, 'Invalid reset token. Please request a new reset link.');\n    return;\n  }\n\n  setFormLoading(form, true);\n  hideError(errorEl);\n\n  try {\n    await auth.resetPassword(password, currentProps.resetToken);\n    toast.success('Password reset successfully. You can now sign in.');\n    \n    // Switch to login\n    currentMode = 'login';\n    const container = form.parentElement as HTMLElement;\n    const titleEl = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"] .modal-header h3`);\n    if (titleEl) titleEl.textContent = getTitle();\n    renderAuthContent(container);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Password reset failed';\n    showError(errorEl, message);\n  } finally {\n    setFormLoading(form, false);\n  }\n}\n\n/**\n * Set form loading state\n */\nfunction setFormLoading(form: HTMLFormElement, loading: boolean): void {\n  const submitBtn = form.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\n  const inputs = form.querySelectorAll('input');\n  const btnText = submitBtn.querySelector('.btn-text') as HTMLElement;\n  const btnLoading = submitBtn.querySelector('.btn-loading') as HTMLElement;\n\n  submitBtn.disabled = loading;\n  inputs.forEach(input => input.disabled = loading);\n  \n  if (btnText && btnLoading) {\n    btnText.classList.toggle('hidden', !!loading);\n    btnLoading.classList.toggle('hidden', !loading);\n  }\n}\n\n/**\n * Show error message\n */\nfunction showError(errorEl: HTMLElement, message: string): void {\n  errorEl.textContent = message;\n  errorEl.classList.remove('hidden');\n}\n\n/**\n * Hide error message\n */\nfunction hideError(errorEl: HTMLElement): void {\n  errorEl.classList.add('hidden');\n  errorEl.textContent = '';\n}\n\n/**\n * Update password strength indicator\n */\nfunction updatePasswordStrength(password: string, elementId = 'password-strength'): void {\n  const strengthEl = document.getElementById(elementId);\n  if (!strengthEl) return;\n\n  const strength = calculatePasswordStrength(password);\n  \n  strengthEl.className = `password-strength strength-${strength.level}`;\n  strengthEl.innerHTML = `\n    <div class=\"strength-bar\">\n      <div class=\"strength-fill\" style=\"--strength-width: ${strength.score}%\"></div>\n    </div>\n    <span class=\"strength-label\">${strength.label}</span>\n  `;\n}\n\n/**\n * Calculate password strength\n */\nfunction calculatePasswordStrength(password: string): { level: string; score: number; label: string } {\n  let score = 0;\n\n  if (password.length >= 12) score += 25;\n  if (password.length >= 16) score += 15;\n  if (/[a-z]/.test(password)) score += 15;\n  if (/[A-Z]/.test(password)) score += 15;\n  if (/[0-9]/.test(password)) score += 15;\n  if (/[^a-zA-Z0-9]/.test(password)) score += 15;\n\n  if (score < 30) return { level: 'weak', score, label: 'Weak' };\n  if (score < 60) return { level: 'fair', score, label: 'Fair' };\n  if (score < 80) return { level: 'good', score, label: 'Good' };\n  return { level: 'strong', score: Math.min(score, 100), label: 'Strong' };\n}\n\n/**\n * Close auth modal\n */\nexport function closeAuthModal(): void {\n  closeModal(MODAL_ID);\n}\n\nexport default showAuthModal;\n","/**\r\n * Contact Modal Component - SOTA Design\r\n * Create and edit contacts with tabs for Info, Projects, Relations, Activity\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal, confirm } from '../Modal';\r\nimport { Contact } from '../../stores/data';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'contact-modal';\r\n\r\n// Types\r\ninterface RoleTemplate {\r\n  id: string;\r\n  name: string;\r\n  display_name: string;\r\n  description?: string;\r\n  prompt_template?: string;\r\n  is_active: boolean;\r\n}\r\n\r\ninterface ContactRelation {\r\n  id: string;\r\n  from_contact_id: string;\r\n  to_contact_id: string;\r\n  relationship_type: string;\r\n  to_contact?: {\r\n    id: string;\r\n    name: string;\r\n    role?: string;\r\n    organization?: string;\r\n    avatar_url?: string;\r\n  };\r\n}\r\n\r\ninterface ContactActivity {\r\n  id: string;\r\n  activity_type: string;\r\n  description: string;\r\n  occurred_at: string;\r\n  source_type?: string;\r\n}\r\n\r\ninterface ContactProject {\r\n  id: string;\r\n  name: string;\r\n  role?: string;\r\n  is_primary?: boolean;\r\n}\r\n\r\nexport interface ContactModalProps {\r\n  mode: 'create' | 'edit' | 'view';\r\n  contact?: Contact;\r\n  onSave?: (contact: Contact) => void;\r\n  onDelete?: (contactId: string) => void;\r\n}\r\n\r\n// State\r\nlet currentContact: Contact | null = null;\r\nlet contactProjects: ContactProject[] = [];\r\nlet contactRelations: ContactRelation[] = [];\r\nlet contactActivity: ContactActivity[] = [];\r\nlet allProjects: { id: string; name: string }[] = [];\r\nlet roleTemplates: RoleTemplate[] = [];\r\n\r\n/**\r\n * Show contact modal\r\n */\r\nexport function showContactModal(props: ContactModalProps): void {\r\n  const { mode, contact } = props;\r\n  currentContact = contact || null;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createModalContent(mode, contact);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: '',\r\n    content,\r\n    size: 'lg',\r\n  });\r\n\r\n  // Remove default modal styling for custom design\r\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\r\n  if (modalContent) {\r\n    modalContent.classList.add('modal-content-transparent');\r\n  }\r\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\r\n  if (modalHeader) {\r\n    modalHeader.classList.add('hidden');\r\n  }\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load data for edit mode\r\n  if (mode === 'edit' && contact?.id) {\r\n    loadContactData(content, contact.id);\r\n  } else {\r\n    loadRoleTemplates(content);\r\n    loadAllProjects(content);\r\n    loadTimezones(content);\r\n  }\r\n\r\n  // Bind events\r\n  bindEvents(content, props);\r\n}\r\n\r\n/**\r\n * Create modal content\r\n */\r\nfunction createModalContent(mode: 'create' | 'edit' | 'view', contact?: Contact): HTMLElement {\r\n  const container = createElement('div', { className: 'contact-modal-sota' });\r\n  const isEdit = mode === 'edit';\r\n  const initials = contact ? getInitials(contact.name) : '?';\r\n  const hasPhoto = !!(contact?.photoUrl || contact?.avatarUrl);\r\n  const photoUrl = contact?.photoUrl || contact?.avatarUrl;\r\n\r\n  container.innerHTML = `\r\n    <style>\r\n      .contact-modal-sota {\r\n        background: var(--bg-primary);\r\n        border-radius: 20px;\r\n        overflow: hidden;\r\n        box-shadow: 0 25px 60px rgba(0,0,0,0.3);\r\n      }\r\n\r\n      /* Header */\r\n      .contact-modal-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 50%, #9f1239 100%);\r\n        padding: 32px 32px 24px;\r\n        position: relative;\r\n      }\r\n\r\n      .contact-modal-close {\r\n        position: absolute;\r\n        top: 16px;\r\n        right: 16px;\r\n        width: 36px;\r\n        height: 36px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        color: white;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .contact-modal-close:hover {\r\n        background: rgba(255,255,255,0.3);\r\n        transform: scale(1.1);\r\n      }\r\n\r\n      .contact-modal-close svg {\r\n        width: 20px;\r\n        height: 20px;\r\n      }\r\n\r\n      .contact-header-content {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 20px;\r\n      }\r\n\r\n      .contact-avatar-large {\r\n        width: 90px;\r\n        height: 90px;\r\n        border-radius: 50%;\r\n        background: rgba(255,255,255,0.2);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 32px;\r\n        font-weight: 700;\r\n        color: white;\r\n        border: 4px solid rgba(255,255,255,0.3);\r\n        overflow: hidden;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        position: relative;\r\n      }\r\n\r\n      .contact-avatar-large:hover {\r\n        border-color: rgba(255,255,255,0.5);\r\n      }\r\n\r\n      .contact-avatar-large img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n\r\n      .contact-avatar-large .avatar-upload-hint {\r\n        position: absolute;\r\n        inset: 0;\r\n        background: rgba(0,0,0,0.5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        opacity: 0;\r\n        transition: opacity 0.2s;\r\n      }\r\n\r\n      .contact-avatar-large:hover .avatar-upload-hint {\r\n        opacity: 1;\r\n      }\r\n\r\n      .contact-avatar-large .avatar-upload-hint svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        color: white;\r\n      }\r\n\r\n      .contact-header-info {\r\n        flex: 1;\r\n        color: white;\r\n      }\r\n\r\n      .contact-header-info h2 {\r\n        margin: 0 0 4px 0;\r\n        font-size: 26px;\r\n        font-weight: 700;\r\n      }\r\n\r\n      .contact-header-info p {\r\n        margin: 0;\r\n        font-size: 15px;\r\n        opacity: 0.85;\r\n      }\r\n\r\n      .contact-header-actions {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .header-action-btn {\r\n        padding: 10px 16px;\r\n        border-radius: 10px;\r\n        background: rgba(255,255,255,0.15);\r\n        border: 1px solid rgba(255,255,255,0.2);\r\n        color: white;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .header-action-btn:hover {\r\n        background: rgba(255,255,255,0.25);\r\n      }\r\n\r\n      .header-action-btn svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      /* Tabs */\r\n      .contact-tabs {\r\n        display: flex;\r\n        border-bottom: 1px solid var(--border-color);\r\n        padding: 0 32px;\r\n        background: var(--bg-secondary);\r\n      }\r\n\r\n      .contact-tab-btn {\r\n        padding: 14px 20px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        background: none;\r\n        border: none;\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        position: relative;\r\n        transition: color 0.2s;\r\n      }\r\n\r\n      .contact-tab-btn:hover {\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .contact-tab-btn.active {\r\n        color: #e11d48;\r\n      }\r\n\r\n      .contact-tab-btn.active::after {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: -1px;\r\n        left: 0;\r\n        right: 0;\r\n        height: 3px;\r\n        background: linear-gradient(90deg, #e11d48, #f59e0b);\r\n        border-radius: 3px 3px 0 0;\r\n      }\r\n\r\n      .contact-tab-btn svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      .contact-tab-btn .tab-count {\r\n        background: rgba(225,29,72,0.1);\r\n        color: #e11d48;\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        font-size: 11px;\r\n      }\r\n\r\n      /* Tab Content */\r\n      .contact-tab-content {\r\n        padding: 28px 32px;\r\n        min-height: 400px;\r\n        max-height: 500px;\r\n        overflow-y: auto;\r\n      }\r\n\r\n      .contact-section {\r\n        display: none;\r\n      }\r\n\r\n      .contact-section.active {\r\n        display: block;\r\n      }\r\n\r\n      /* Form Styles */\r\n      .form-grid {\r\n        display: grid;\r\n        grid-template-columns: 1fr 1fr;\r\n        gap: 20px;\r\n      }\r\n\r\n      .form-grid.full {\r\n        grid-template-columns: 1fr;\r\n      }\r\n\r\n      .form-field {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 6px;\r\n      }\r\n\r\n      .form-field.full-width {\r\n        grid-column: 1 / -1;\r\n      }\r\n\r\n      .form-field label {\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n\r\n      .form-field label svg {\r\n        width: 14px;\r\n        height: 14px;\r\n        color: #e11d48;\r\n      }\r\n\r\n      .form-field input,\r\n      .form-field textarea,\r\n      .form-field select {\r\n        padding: 12px 14px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .form-field input:focus,\r\n      .form-field textarea:focus,\r\n      .form-field select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225,29,72,0.1);\r\n      }\r\n\r\n      .form-field textarea {\r\n        resize: vertical;\r\n        min-height: 100px;\r\n      }\r\n\r\n      .form-hint {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n      }\r\n\r\n      /* Projects Section */\r\n      .projects-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 10px;\r\n      }\r\n\r\n      .project-item {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 14px;\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .project-item:hover {\r\n        border-color: rgba(225,29,72,0.3);\r\n      }\r\n\r\n      .project-checkbox {\r\n        width: 20px;\r\n        height: 20px;\r\n        accent-color: #e11d48;\r\n      }\r\n\r\n      .project-item label {\r\n        flex: 1;\r\n        font-size: 14px;\r\n        color: var(--text-primary);\r\n        cursor: pointer;\r\n      }\r\n\r\n      .project-item .primary-badge {\r\n        padding: 3px 8px;\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        color: white;\r\n        border-radius: 4px;\r\n        font-size: 10px;\r\n        font-weight: 600;\r\n      }\r\n\r\n      /* Relations Section */\r\n      .relations-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n\r\n      .relation-card {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 14px;\r\n        padding: 14px;\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .relation-card:hover {\r\n        border-color: rgba(225,29,72,0.3);\r\n        transform: translateX(4px);\r\n      }\r\n\r\n      .relation-avatar {\r\n        width: 44px;\r\n        height: 44px;\r\n        border-radius: 50%;\r\n        background: linear-gradient(135deg, #6366f1, #4f46e5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 16px;\r\n        font-weight: 600;\r\n        color: white;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .relation-avatar img {\r\n        width: 100%;\r\n        height: 100%;\r\n        object-fit: cover;\r\n      }\r\n\r\n      .relation-info {\r\n        flex: 1;\r\n      }\r\n\r\n      .relation-info h4 {\r\n        margin: 0 0 2px 0;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n\r\n      .relation-info p {\r\n        margin: 0;\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .relation-type {\r\n        padding: 4px 10px;\r\n        background: rgba(99,102,241,0.1);\r\n        color: #6366f1;\r\n        border-radius: 6px;\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n      }\r\n\r\n      .add-relation-btn {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        gap: 8px;\r\n        padding: 14px;\r\n        background: var(--bg-secondary);\r\n        border: 2px dashed var(--border-color);\r\n        border-radius: 12px;\r\n        color: var(--text-secondary);\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .add-relation-btn:hover {\r\n        border-color: #e11d48;\r\n        color: #e11d48;\r\n      }\r\n\r\n      .add-relation-btn svg {\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n\r\n      /* Activity Section */\r\n      .activity-timeline {\r\n        position: relative;\r\n        padding-left: 28px;\r\n      }\r\n\r\n      .activity-timeline::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: 8px;\r\n        top: 0;\r\n        bottom: 0;\r\n        width: 2px;\r\n        background: var(--border-color);\r\n      }\r\n\r\n      .activity-item {\r\n        position: relative;\r\n        padding-bottom: 20px;\r\n      }\r\n\r\n      .activity-item::before {\r\n        content: '';\r\n        position: absolute;\r\n        left: -24px;\r\n        top: 4px;\r\n        width: 12px;\r\n        height: 12px;\r\n        border-radius: 50%;\r\n        background: #e11d48;\r\n        border: 2px solid var(--bg-primary);\r\n      }\r\n\r\n      .activity-item.email::before { background: #3b82f6; }\r\n      .activity-item.meeting::before { background: #10b981; }\r\n      .activity-item.note::before { background: #f59e0b; }\r\n\r\n      .activity-time {\r\n        font-size: 11px;\r\n        color: var(--text-tertiary);\r\n        margin-bottom: 4px;\r\n      }\r\n\r\n      .activity-content {\r\n        font-size: 14px;\r\n        color: var(--text-primary);\r\n        line-height: 1.5;\r\n      }\r\n\r\n      .activity-empty {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .activity-empty svg {\r\n        width: 48px;\r\n        height: 48px;\r\n        opacity: 0.4;\r\n        margin-bottom: 12px;\r\n      }\r\n\r\n      /* Footer */\r\n      .contact-modal-footer {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        padding: 20px 32px;\r\n        border-top: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n\r\n      .footer-left {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .footer-right {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .btn-sota {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 12px 20px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n\r\n      .btn-sota.primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n\r\n      .btn-sota.primary:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 6px 16px rgba(225,29,72,0.4);\r\n      }\r\n\r\n      .btn-sota.secondary {\r\n        background: var(--bg-primary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n\r\n      .btn-sota.secondary:hover {\r\n        background: var(--bg-tertiary);\r\n        border-color: #e11d48;\r\n      }\r\n\r\n      .btn-sota.danger {\r\n        background: transparent;\r\n        color: #dc2626;\r\n        border: 1px solid #dc2626;\r\n      }\r\n\r\n      .btn-sota.danger:hover {\r\n        background: #dc2626;\r\n        color: white;\r\n      }\r\n\r\n      .btn-sota svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      .btn-sota:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n      }\r\n\r\n      /* Loading */\r\n      .loading-spinner {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 40px;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      .loading-spinner::after {\r\n        content: '';\r\n        width: 24px;\r\n        height: 24px;\r\n        border: 3px solid var(--border-color);\r\n        border-top-color: #e11d48;\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n        margin-left: 12px;\r\n      }\r\n\r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n    </style>\r\n\r\n    <!-- Header -->\r\n    <div class=\"contact-modal-header\">\r\n      <button class=\"contact-modal-close\" id=\"close-contact-btn\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\r\n        </svg>\r\n      </button>\r\n\r\n      <div class=\"contact-header-content\">\r\n        <div class=\"contact-avatar-large\" id=\"contact-avatar-upload\">\r\n          ${hasPhoto \r\n            ? `<img src=\"${photoUrl}\" alt=\"\">`\r\n            : `<span>${initials}</span>`\r\n          }\r\n          <div class=\"avatar-upload-hint\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n            </svg>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"contact-header-info\">\r\n          <h2 id=\"header-contact-name\">${isEdit ? escapeHtml(contact?.name || '') : 'New Contact'}</h2>\r\n          <p id=\"header-contact-org\">${isEdit && contact?.organization ? escapeHtml(contact.organization) : 'Add organization'}</p>\r\n        </div>\r\n\r\n        ${isEdit ? `\r\n          <div class=\"contact-header-actions\">\r\n            <button class=\"header-action-btn\" id=\"enrich-ai-btn\" title=\"Enrich with AI\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n              </svg>\r\n              Enrich with AI\r\n            </button>\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Tabs -->\r\n    <div class=\"contact-tabs\">\r\n      <button class=\"contact-tab-btn active\" data-tab=\"info\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n        </svg>\r\n        Info\r\n      </button>\r\n      <button class=\"contact-tab-btn\" data-tab=\"projects\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\r\n        </svg>\r\n        Projects\r\n        <span class=\"tab-count\" id=\"projects-count\">0</span>\r\n      </button>\r\n      <button class=\"contact-tab-btn\" data-tab=\"relations\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\r\n        </svg>\r\n        Relations\r\n        <span class=\"tab-count\" id=\"relations-count\">0</span>\r\n      </button>\r\n      <button class=\"contact-tab-btn\" data-tab=\"activity\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n        </svg>\r\n        Activity\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Tab Content -->\r\n    <div class=\"contact-tab-content\">\r\n      <!-- Info Section -->\r\n      <div class=\"contact-section active\" id=\"section-info\">\r\n        <form id=\"contact-form\">\r\n          <div class=\"form-grid\">\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\r\n                </svg>\r\n                Name *\r\n              </label>\r\n              <input type=\"text\" id=\"contact-name\" required value=\"${escapeHtml(contact?.name || '')}\" placeholder=\"Full name\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Role\r\n              </label>\r\n              <select id=\"contact-role\">\r\n                <option value=\"\">-- Select role --</option>\r\n                <option value=\"__custom__\">Custom role...</option>\r\n              </select>\r\n              <input type=\"text\" id=\"contact-role-custom\" class=\"contact-role-custom hidden\" placeholder=\"Enter custom role\" value=\"${contact?.role && !roleTemplates.some(r => r.display_name === contact.role) ? escapeHtml(contact.role) : ''}\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Email\r\n              </label>\r\n              <input type=\"email\" id=\"contact-email\" value=\"${escapeHtml(contact?.email || '')}\" placeholder=\"email@example.com\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"/>\r\n                </svg>\r\n                Phone\r\n              </label>\r\n              <input type=\"tel\" id=\"contact-phone\" value=\"${escapeHtml(contact?.phone || '')}\" placeholder=\"+1 234 567 890\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\r\n                </svg>\r\n                Organization\r\n              </label>\r\n              <input type=\"text\" id=\"contact-organization\" value=\"${escapeHtml(contact?.organization || contact?.company || '')}\" placeholder=\"Company name\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9\"/>\r\n                </svg>\r\n                LinkedIn\r\n              </label>\r\n              <input type=\"url\" id=\"contact-linkedin\" value=\"${escapeHtml(contact?.linkedin || '')}\" placeholder=\"https://linkedin.com/in/...\">\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\r\n                </svg>\r\n                Avatar URL\r\n              </label>\r\n              <input type=\"url\" id=\"contact-avatar-url\" value=\"${escapeHtml(contact?.photoUrl || contact?.avatarUrl || contact?.photo_url || contact?.avatar_url || '')}\" placeholder=\"https://example.com/photo.jpg\">\r\n              <div class=\"form-hint\">Enter a URL to set the contact's profile picture</div>\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\r\n                </svg>\r\n                Department\r\n              </label>\r\n              <input type=\"text\" id=\"contact-department\" value=\"${escapeHtml(contact?.department || '')}\" placeholder=\"Engineering, Sales, etc.\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"/>\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n                </svg>\r\n                Location\r\n              </label>\r\n              <input type=\"text\" id=\"contact-location\" value=\"${escapeHtml(contact?.location || '')}\" placeholder=\"City, Country\">\r\n            </div>\r\n\r\n            <div class=\"form-field\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n                </svg>\r\n                Timezone\r\n              </label>\r\n              <select id=\"contact-timezone\" data-current=\"${escapeHtml(contact?.timezone || '')}\">\r\n                <option value=\"\">Select timezone...</option>\r\n              </select>\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n                </svg>\r\n                Aliases\r\n              </label>\r\n              <input type=\"text\" id=\"contact-aliases\" value=\"${contact?.aliases?.join(', ') || ''}\" placeholder=\"Alternative names (comma separated)\">\r\n              <div class=\"form-hint\">Names used to identify this person in documents (e.g., \"Luuc\" for \"Luuk\")</div>\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\r\n                </svg>\r\n                Notes\r\n              </label>\r\n              <textarea id=\"contact-notes\" placeholder=\"Additional notes about this contact...\">${escapeHtml(contact?.notes || '')}</textarea>\r\n            </div>\r\n\r\n            <div class=\"form-field full-width\">\r\n              <label>\r\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\"/>\r\n                </svg>\r\n                Tags\r\n              </label>\r\n              <input type=\"text\" id=\"contact-tags\" value=\"${contact?.tags?.join(', ') || ''}\" placeholder=\"client, vip, technical (comma separated)\">\r\n              <div class=\"form-hint\">Separate tags with commas</div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n\r\n      <!-- Projects Section -->\r\n      <div class=\"contact-section\" id=\"section-projects\">\r\n        <div class=\"projects-list\" id=\"projects-list\">\r\n          <div class=\"loading-spinner\">Loading projects</div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Relations Section -->\r\n      <div class=\"contact-section\" id=\"section-relations\">\r\n        <div class=\"relations-list\" id=\"relations-list\">\r\n          <div class=\"loading-spinner\">Loading relations</div>\r\n        </div>\r\n        <button class=\"add-relation-btn\" id=\"add-relation-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Add Relationship\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Activity Section -->\r\n      <div class=\"contact-section\" id=\"section-activity\">\r\n        <div class=\"activity-timeline\" id=\"activity-timeline\">\r\n          <div class=\"loading-spinner\">Loading activity</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Footer -->\r\n    <div class=\"contact-modal-footer\">\r\n      <div class=\"footer-left\">\r\n        ${isEdit ? `\r\n          <button class=\"btn-sota danger\" id=\"delete-contact-btn\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\r\n            </svg>\r\n            Delete\r\n          </button>\r\n        ` : ''}\r\n      </div>\r\n      <div class=\"footer-right\">\r\n        <button class=\"btn-sota secondary\" id=\"cancel-contact-btn\">Cancel</button>\r\n        <button class=\"btn-sota primary\" id=\"save-contact-btn\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n          </svg>\r\n          ${isEdit ? 'Save Changes' : 'Create Contact'}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load contact data for edit mode\r\n */\r\nasync function loadContactData(container: HTMLElement, contactId: string): Promise<void> {\r\n  try {\r\n    const [projectsRes, relationsRes, activityRes, rolesRes, allProjectsRes, timezonesRes] = await Promise.all([\r\n      http.get<{ projects: ContactProject[] }>(`/api/contacts/${contactId}/projects`).catch(() => ({ data: { projects: [] } })),\r\n      http.get<{ relationships: ContactRelation[] }>(`/api/contacts/${contactId}/relationships`).catch(() => ({ data: { relationships: [] } })),\r\n      http.get<{ activities: ContactActivity[] }>(`/api/contacts/${contactId}/activity`).catch(() => ({ data: { activities: [] } })),\r\n      http.get<{ roles: RoleTemplate[] }>('/api/role-templates').catch(() => ({ data: { roles: [] } })),\r\n      http.get<{ projects: { id: string; name: string }[] }>('/api/projects').catch(() => ({ data: { projects: [] } })),\r\n      http.get<{ timezones: { code: string; name: string; utc_offset: string }[] }>('/api/timezones').catch(() => ({ data: { timezones: [] } })),\r\n    ]);\r\n\r\n    contactProjects = projectsRes.data?.projects || [];\r\n    contactRelations = relationsRes.data?.relationships || [];\r\n    contactActivity = activityRes.data?.activities || [];\r\n    roleTemplates = rolesRes.data?.roles || [];\r\n    allProjects = allProjectsRes.data?.projects || [];\r\n    const timezones = timezonesRes.data?.timezones || [];\r\n\r\n    // Render timezone dropdown\r\n    renderTimezoneDropdown(container, timezones);\r\n\r\n    // Render sections\r\n    renderRoleDropdown(container);\r\n    renderProjectsList(container);\r\n    renderRelationsList(container);\r\n    renderActivityTimeline(container);\r\n    \r\n    // Update counts\r\n    updateTabCounts(container);\r\n  } catch (error) {\r\n    console.error('Failed to load contact data:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Load role templates\r\n */\r\nasync function loadRoleTemplates(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ roles: RoleTemplate[] }>('/api/role-templates');\r\n    roleTemplates = response.data?.roles || [];\r\n    renderRoleDropdown(container);\r\n  } catch {\r\n    roleTemplates = [];\r\n  }\r\n}\r\n\r\n/**\r\n * Load timezones for new contact\r\n */\r\nasync function loadTimezones(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ timezones: { code: string; name: string; utc_offset: string }[] }>('/api/timezones');\r\n    const timezones = response.data?.timezones || [];\r\n    renderTimezoneDropdown(container, timezones);\r\n  } catch {\r\n    // Leave empty\r\n  }\r\n}\r\n\r\n/**\r\n * Load all projects\r\n */\r\nasync function loadAllProjects(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const response = await http.get<{ projects: { id: string; name: string }[] }>('/api/projects');\r\n    allProjects = response.data?.projects || [];\r\n    renderProjectsList(container);\r\n  } catch {\r\n    allProjects = [];\r\n  }\r\n}\r\n\r\n/**\r\n * Render timezone dropdown\r\n */\r\nfunction renderTimezoneDropdown(container: HTMLElement, timezones: { code: string; name: string; utc_offset: string }[]): void {\r\n  const tzSelect = container.querySelector('#contact-timezone') as HTMLSelectElement;\r\n  if (!tzSelect) return;\r\n\r\n  const currentTz = tzSelect.dataset.current || '';\r\n  \r\n  // Group timezones by region\r\n  const grouped: Record<string, typeof timezones> = {};\r\n  for (const tz of timezones) {\r\n    const region = tz.code.includes('/') ? tz.code.split('/')[0] : 'Other';\r\n    if (!grouped[region]) grouped[region] = [];\r\n    grouped[region].push(tz);\r\n  }\r\n\r\n  // Sort regions\r\n  const sortedRegions = Object.keys(grouped).sort();\r\n\r\n  tzSelect.innerHTML = `\r\n    <option value=\"\">Select timezone...</option>\r\n    ${sortedRegions.map(region => `\r\n      <optgroup label=\"${region}\">\r\n        ${grouped[region].map(tz => `\r\n          <option value=\"${escapeHtml(tz.code)}\" ${currentTz === tz.code ? 'selected' : ''}>\r\n            ${escapeHtml(tz.name || tz.code)} (${tz.utc_offset})\r\n          </option>\r\n        `).join('')}\r\n      </optgroup>\r\n    `).join('')}\r\n  `;\r\n}\r\n\r\n/**\r\n * Render role dropdown\r\n */\r\nfunction renderRoleDropdown(container: HTMLElement): void {\r\n  const roleSelect = container.querySelector('#contact-role') as HTMLSelectElement;\r\n  const customInput = container.querySelector('#contact-role-custom') as HTMLInputElement;\r\n  if (!roleSelect) return;\r\n\r\n  const currentRole = currentContact?.role;\r\n  const isCustomRole = currentRole && !roleTemplates.some(r => r.display_name === currentRole || r.name === currentRole);\r\n\r\n  roleSelect.innerHTML = `\r\n    <option value=\"\">-- Select role --</option>\r\n    ${roleTemplates.filter(r => r.is_active).map(r => `\r\n      <option value=\"${escapeHtml(r.display_name || r.name)}\" ${currentRole === r.display_name || currentRole === r.name ? 'selected' : ''}>\r\n        ${escapeHtml(r.display_name || r.name)}\r\n      </option>\r\n    `).join('')}\r\n    <option value=\"__custom__\" ${isCustomRole ? 'selected' : ''}>Custom role...</option>\r\n  `;\r\n\r\n  // Show custom input if custom is selected\r\n  if (isCustomRole && customInput) {\r\n    customInput.classList.remove('hidden');\r\n    customInput.value = currentRole;\r\n  }\r\n\r\n  // Handle role change\r\n  on(roleSelect, 'change', () => {\r\n    const isCustom = roleSelect.value === '__custom__';\r\n    customInput.classList.toggle('hidden', !isCustom);\r\n    if (isCustom) {\r\n      customInput.focus();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render projects list\r\n */\r\nfunction renderProjectsList(container: HTMLElement): void {\r\n  const listContainer = container.querySelector('#projects-list') as HTMLElement;\r\n  if (!listContainer) return;\r\n\r\n  if (allProjects.length === 0) {\r\n    listContainer.innerHTML = '<p class=\"contact-no-projects-hint\">No projects available</p>';\r\n    return;\r\n  }\r\n\r\n  const associatedIds = new Set(contactProjects.map(p => p.id));\r\n\r\n  listContainer.innerHTML = allProjects.map(project => `\r\n    <div class=\"project-item\">\r\n      <input type=\"checkbox\" class=\"project-checkbox\" name=\"contact-project\" value=\"${project.id}\" \r\n             ${associatedIds.has(project.id) ? 'checked' : ''}>\r\n      <label>${escapeHtml(project.name)}</label>\r\n      ${contactProjects.find(p => p.id === project.id)?.is_primary ? '<span class=\"primary-badge\">Primary</span>' : ''}\r\n    </div>\r\n  `).join('');\r\n\r\n  container.querySelector('#projects-count')!.textContent = String(associatedIds.size);\r\n}\r\n\r\n/**\r\n * Render relations list\r\n */\r\nfunction renderRelationsList(container: HTMLElement): void {\r\n  const listContainer = container.querySelector('#relations-list') as HTMLElement;\r\n  if (!listContainer) return;\r\n\r\n  if (contactRelations.length === 0) {\r\n    listContainer.innerHTML = `\r\n      <div class=\"activity-empty\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n        </svg>\r\n        <p>No relationships yet</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  listContainer.innerHTML = contactRelations.map(relation => {\r\n    const contact = relation.to_contact;\r\n    const initials = contact ? getInitials(contact.name) : '?';\r\n\r\n    return `\r\n      <div class=\"relation-card\" data-id=\"${relation.id}\">\r\n        <div class=\"relation-avatar\">\r\n          ${contact?.avatar_url \r\n            ? `<img src=\"${contact.avatar_url}\" alt=\"\">`\r\n            : initials\r\n          }\r\n        </div>\r\n        <div class=\"relation-info\">\r\n          <h4>${escapeHtml(contact?.name || 'Unknown')}</h4>\r\n          <p>${escapeHtml(contact?.organization || contact?.role || '')}</p>\r\n        </div>\r\n        <span class=\"relation-type\">${formatRelationType(relation.relationship_type)}</span>\r\n      </div>\r\n    `;\r\n  }).join('');\r\n\r\n  container.querySelector('#relations-count')!.textContent = String(contactRelations.length);\r\n}\r\n\r\n/**\r\n * Render activity timeline\r\n */\r\nfunction renderActivityTimeline(container: HTMLElement): void {\r\n  const timeline = container.querySelector('#activity-timeline') as HTMLElement;\r\n  if (!timeline) return;\r\n\r\n  if (contactActivity.length === 0) {\r\n    timeline.innerHTML = `\r\n      <div class=\"activity-empty\">\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\r\n        </svg>\r\n        <p>No activity recorded yet</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  timeline.innerHTML = contactActivity.map(activity => `\r\n    <div class=\"activity-item ${activity.activity_type}\">\r\n      <div class=\"activity-time\">${formatDate(activity.occurred_at)}</div>\r\n      <div class=\"activity-content\">${escapeHtml(activity.description)}</div>\r\n    </div>\r\n  `).join('');\r\n}\r\n\r\n/**\r\n * Update tab counts\r\n */\r\nfunction updateTabCounts(container: HTMLElement): void {\r\n  const projectsCount = container.querySelector('#projects-count');\r\n  const relationsCount = container.querySelector('#relations-count');\r\n\r\n  if (projectsCount) projectsCount.textContent = String(contactProjects.length);\r\n  if (relationsCount) relationsCount.textContent = String(contactRelations.length);\r\n}\r\n\r\n/**\r\n * Bind events\r\n */\r\nfunction bindEvents(container: HTMLElement, props: ContactModalProps): void {\r\n  const { mode, contact, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit';\r\n\r\n  // Close button\r\n  const closeBtn = container.querySelector('#close-contact-btn');\r\n  if (closeBtn) {\r\n    on(closeBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n  }\r\n\r\n  // Cancel button\r\n  const cancelBtn = container.querySelector('#cancel-contact-btn');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => closeModal(MODAL_ID));\r\n  }\r\n\r\n  // Tab switching\r\n  const tabs = container.querySelectorAll('.contact-tab-btn');\r\n  tabs.forEach(tab => {\r\n    on(tab as HTMLElement, 'click', () => {\r\n      tabs.forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n\r\n      const tabId = tab.getAttribute('data-tab');\r\n      container.querySelectorAll('.contact-section').forEach(section => {\r\n        section.classList.toggle('active', section.id === `section-${tabId}`);\r\n      });\r\n    });\r\n  });\r\n\r\n  // Save button\r\n  const saveBtn = container.querySelector('#save-contact-btn') as HTMLButtonElement;\r\n  if (saveBtn) {\r\n    on(saveBtn, 'click', async () => {\r\n      const form = container.querySelector('#contact-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const getValue = (id: string) => (container.querySelector(`#${id}`) as HTMLInputElement)?.value.trim() || '';\r\n      \r\n      // Get role value\r\n      const roleSelect = container.querySelector('#contact-role') as HTMLSelectElement;\r\n      const customRoleInput = container.querySelector('#contact-role-custom') as HTMLInputElement;\r\n      const role = roleSelect.value === '__custom__' ? customRoleInput.value.trim() : roleSelect.value;\r\n\r\n      const tagsInput = getValue('contact-tags');\r\n      const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(Boolean) : [];\r\n\r\n      // Get aliases\r\n      const aliasesInput = getValue('contact-aliases');\r\n      const aliases = aliasesInput ? aliasesInput.split(',').map(a => a.trim()).filter(Boolean) : [];\r\n\r\n      const contactData: Contact = {\r\n        id: contact?.id || `contact-${Date.now()}`,\r\n        name: getValue('contact-name'),\r\n        email: getValue('contact-email') || undefined,\r\n        phone: getValue('contact-phone') || undefined,\r\n        organization: getValue('contact-organization') || undefined,\r\n        company: getValue('contact-organization') || undefined,\r\n        role: role || undefined,\r\n        department: getValue('contact-department') || undefined,\r\n        linkedin: getValue('contact-linkedin') || undefined,\r\n        location: getValue('contact-location') || undefined,\r\n        timezone: getValue('contact-timezone') || undefined,\r\n        photoUrl: getValue('contact-avatar-url') || undefined,\r\n        avatarUrl: getValue('contact-avatar-url') || undefined,\r\n        aliases: aliases.length > 0 ? aliases : undefined,\r\n        notes: getValue('contact-notes') || undefined,\r\n        tags: tags.length > 0 ? tags : undefined,\r\n      };\r\n\r\n      // Get selected projects\r\n      const selectedProjects: string[] = [];\r\n      container.querySelectorAll('input[name=\"contact-project\"]:checked').forEach(input => {\r\n        selectedProjects.push((input as HTMLInputElement).value);\r\n      });\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        let savedContactId = contact?.id;\r\n        \r\n        if (isEdit) {\r\n          await http.put(`/api/contacts/${contact!.id}`, contactData);\r\n          toast.success('Contact updated');\r\n        } else {\r\n          const response = await http.post<{ id: string }>('/api/contacts', contactData);\r\n          contactData.id = response.data.id;\r\n          savedContactId = response.data.id;\r\n          toast.success('Contact created');\r\n        }\r\n\r\n        // Save project associations\r\n        if (savedContactId && selectedProjects.length >= 0) {\r\n          try {\r\n            await http.post(`/api/contacts/${savedContactId}/projects/sync`, {\r\n              projectIds: selectedProjects\r\n            });\r\n          } catch (err) {\r\n            console.warn('Failed to sync project associations:', err);\r\n          }\r\n        }\r\n\r\n        onSave?.(contactData);\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        toast.error('Failed to save contact');\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.innerHTML = `\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\r\n          </svg>\r\n          ${isEdit ? 'Save Changes' : 'Create Contact'}\r\n        `;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete button\r\n  const deleteBtn = container.querySelector('#delete-contact-btn');\r\n  if (deleteBtn && isEdit) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      const confirmed = await confirm(\r\n        `Are you sure you want to delete \"${contact!.name}\"?`,\r\n        {\r\n          title: 'Delete Contact',\r\n          confirmText: 'Delete',\r\n          confirmClass: 'btn-danger',\r\n        }\r\n      );\r\n\r\n      if (confirmed) {\r\n        try {\r\n          await http.delete(`/api/contacts/${contact!.id}`);\r\n          toast.success('Contact deleted');\r\n          onDelete?.(contact!.id);\r\n          closeModal(MODAL_ID);\r\n        } catch {\r\n          toast.error('Failed to delete contact');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI Enrich button\r\n  const enrichBtn = container.querySelector('#enrich-ai-btn');\r\n  if (enrichBtn && isEdit) {\r\n    on(enrichBtn as HTMLElement, 'click', async () => {\r\n      toast.info('AI enrichment is processing...');\r\n      try {\r\n        await http.post(`/api/contacts/${contact!.id}/enrich`);\r\n        toast.success('Contact enriched! Refreshing...');\r\n        // Reload modal with updated data\r\n        closeModal(MODAL_ID);\r\n        const response = await http.get<{ contact: Contact }>(`/api/contacts/${contact!.id}`);\r\n        showContactModal({ ...props, contact: response.data.contact });\r\n      } catch {\r\n        toast.error('AI enrichment failed');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Add relation button\r\n  const addRelationBtn = container.querySelector('#add-relation-btn');\r\n  if (addRelationBtn && contact?.id) {\r\n    on(addRelationBtn as HTMLElement, 'click', () => {\r\n      showAddRelationDialog(container, contact.id, props);\r\n    });\r\n  }\r\n\r\n  // Update header on name/org input change\r\n  const nameInput = container.querySelector('#contact-name') as HTMLInputElement;\r\n  const orgInput = container.querySelector('#contact-organization') as HTMLInputElement;\r\n  const headerName = container.querySelector('#header-contact-name');\r\n  const headerOrg = container.querySelector('#header-contact-org');\r\n\r\n  if (nameInput && headerName) {\r\n    on(nameInput, 'input', () => {\r\n      headerName.textContent = nameInput.value || 'New Contact';\r\n      // Update avatar initials\r\n      const avatar = container.querySelector('.contact-avatar-large');\r\n      if (avatar && !avatar.querySelector('img')) {\r\n        const span = avatar.querySelector('span');\r\n        if (span) span.textContent = getInitials(nameInput.value || '?');\r\n      }\r\n    });\r\n  }\r\n\r\n  if (orgInput && headerOrg) {\r\n    on(orgInput, 'input', () => {\r\n      headerOrg.textContent = orgInput.value || 'Add organization';\r\n    });\r\n  }\r\n\r\n  // Update avatar preview on URL input change\r\n  const avatarUrlInput = container.querySelector('#contact-avatar-url') as HTMLInputElement;\r\n  const avatarContainer = container.querySelector('.contact-avatar-large');\r\n  \r\n  if (avatarUrlInput && avatarContainer) {\r\n    on(avatarUrlInput, 'input', () => {\r\n      const url = avatarUrlInput.value.trim();\r\n      if (url) {\r\n        // Test if image loads\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          avatarContainer.innerHTML = `\r\n            <img src=\"${url}\" alt=\"\">\r\n            <div class=\"avatar-upload-hint\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n              </svg>\r\n            </div>\r\n          `;\r\n        };\r\n        img.onerror = () => {\r\n          // Keep initials if image fails\r\n          const currentName = (container.querySelector('#contact-name') as HTMLInputElement)?.value || '?';\r\n          avatarContainer.innerHTML = `\r\n            <span>${getInitials(currentName)}</span>\r\n            <div class=\"avatar-upload-hint\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n              </svg>\r\n            </div>\r\n          `;\r\n        };\r\n        img.src = url;\r\n      } else {\r\n        // No URL - show initials\r\n        const currentName = (container.querySelector('#contact-name') as HTMLInputElement)?.value || '?';\r\n        avatarContainer.innerHTML = `\r\n          <span>${getInitials(currentName)}</span>\r\n          <div class=\"avatar-upload-hint\">\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n            </svg>\r\n          </div>\r\n        `;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Show dialog to add a relationship to another contact\r\n */\r\nasync function showAddRelationDialog(parentContainer: HTMLElement, contactId: string, props: ContactModalProps): Promise<void> {\r\n  // Fetch all contacts for selection\r\n  let availableContacts: { id: string; name: string; organization?: string }[] = [];\r\n  try {\r\n    const response = await http.get<{ contacts: { id: string; name: string; organization?: string }[] }>('/api/contacts');\r\n    availableContacts = (response.data?.contacts || []).filter(c => c.id !== contactId);\r\n  } catch {\r\n    toast.error('Failed to load contacts');\r\n    return;\r\n  }\r\n\r\n  if (availableContacts.length === 0) {\r\n    toast.info('No other contacts available to create a relationship');\r\n    return;\r\n  }\r\n\r\n  // Create overlay dialog\r\n  const overlay = createElement('div', { className: 'relation-dialog-overlay' });\r\n  overlay.innerHTML = `\r\n    <style>\r\n      .relation-dialog-overlay {\r\n        position: fixed;\r\n        inset: 0;\r\n        background: rgba(0,0,0,0.5);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 10000;\r\n        animation: fadeIn 0.2s ease;\r\n      }\r\n      \r\n      @keyframes fadeIn {\r\n        from { opacity: 0; }\r\n        to { opacity: 1; }\r\n      }\r\n      \r\n      .relation-dialog {\r\n        background: var(--bg-primary);\r\n        border-radius: 16px;\r\n        padding: 24px;\r\n        width: 400px;\r\n        max-width: 90vw;\r\n        box-shadow: 0 25px 50px rgba(0,0,0,0.25);\r\n        animation: slideUp 0.2s ease;\r\n      }\r\n      \r\n      @keyframes slideUp {\r\n        from { transform: translateY(20px); opacity: 0; }\r\n        to { transform: translateY(0); opacity: 1; }\r\n      }\r\n      \r\n      .relation-dialog h3 {\r\n        margin: 0 0 20px 0;\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 10px;\r\n      }\r\n      \r\n      .relation-dialog h3 svg {\r\n        width: 22px;\r\n        height: 22px;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .relation-dialog-field {\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      .relation-dialog-field label {\r\n        display: block;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 6px;\r\n      }\r\n      \r\n      .relation-dialog-field select {\r\n        width: 100%;\r\n        padding: 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 10px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        font-size: 14px;\r\n      }\r\n      \r\n      .relation-dialog-field select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n      }\r\n      \r\n      .relation-dialog-actions {\r\n        display: flex;\r\n        justify-content: flex-end;\r\n        gap: 10px;\r\n        margin-top: 24px;\r\n      }\r\n      \r\n      .relation-dialog-actions button {\r\n        padding: 10px 20px;\r\n        border-radius: 8px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n      \r\n      .relation-dialog-actions .cancel-btn {\r\n        background: var(--bg-secondary);\r\n        border: 1px solid var(--border-color);\r\n        color: var(--text-primary);\r\n      }\r\n      \r\n      .relation-dialog-actions .cancel-btn:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .relation-dialog-actions .save-btn {\r\n        background: linear-gradient(135deg, #e11d48, #be123c);\r\n        border: none;\r\n        color: white;\r\n      }\r\n      \r\n      .relation-dialog-actions .save-btn:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\r\n      }\r\n      \r\n      .relation-dialog-actions .save-btn:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n        transform: none;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"relation-dialog\">\r\n      <h3>\r\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\r\n        </svg>\r\n        Add Relationship\r\n      </h3>\r\n      \r\n      <div class=\"relation-dialog-field\">\r\n        <label>Related Contact</label>\r\n        <select id=\"rel-contact-select\">\r\n          <option value=\"\">-- Select contact --</option>\r\n          ${availableContacts.map(c => `\r\n            <option value=\"${c.id}\">${escapeHtml(c.name)}${c.organization ? ` (${escapeHtml(c.organization)})` : ''}</option>\r\n          `).join('')}\r\n        </select>\r\n      </div>\r\n      \r\n      <div class=\"relation-dialog-field\">\r\n        <label>Relationship Type</label>\r\n        <select id=\"rel-type-select\">\r\n          <option value=\"\">-- Select type --</option>\r\n          <option value=\"reports_to\">Reports to</option>\r\n          <option value=\"manages\">Manages</option>\r\n          <option value=\"works_with\">Works with</option>\r\n          <option value=\"knows\">Knows</option>\r\n          <option value=\"referred_by\">Referred by</option>\r\n        </select>\r\n      </div>\r\n      \r\n      <div class=\"relation-dialog-actions\">\r\n        <button class=\"cancel-btn\" id=\"rel-cancel-btn\">Cancel</button>\r\n        <button class=\"save-btn\" id=\"rel-save-btn\">Add Relationship</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Bind events\r\n  const cancelBtn = overlay.querySelector('#rel-cancel-btn');\r\n  const saveBtn = overlay.querySelector('#rel-save-btn') as HTMLButtonElement;\r\n  const contactSelect = overlay.querySelector('#rel-contact-select') as HTMLSelectElement;\r\n  const typeSelect = overlay.querySelector('#rel-type-select') as HTMLSelectElement;\r\n\r\n  // Close on cancel or overlay click\r\n  const closeDialog = () => overlay.remove();\r\n  \r\n  on(cancelBtn as HTMLElement, 'click', closeDialog);\r\n  on(overlay, 'click', (e: Event) => {\r\n    if (e.target === overlay) closeDialog();\r\n  });\r\n\r\n  // Save relationship\r\n  on(saveBtn, 'click', async () => {\r\n    const toContactId = contactSelect.value;\r\n    const relationType = typeSelect.value;\r\n\r\n    if (!toContactId || !relationType) {\r\n      toast.error('Please select both a contact and relationship type');\r\n      return;\r\n    }\r\n\r\n    saveBtn.disabled = true;\r\n    saveBtn.textContent = 'Saving...';\r\n\r\n    try {\r\n      await http.post(`/api/contacts/${contactId}/relationships`, {\r\n        toContactId,\r\n        type: relationType\r\n      });\r\n\r\n      toast.success('Relationship added');\r\n      closeDialog();\r\n\r\n      // Reload contact data to show new relationship\r\n      const relationsRes = await http.get<{ relationships: ContactRelation[] }>(`/api/contacts/${contactId}/relationships`);\r\n      contactRelations = relationsRes.data?.relationships || [];\r\n      renderRelationsList(parentContainer);\r\n      updateTabCounts(parentContainer);\r\n    } catch (error: unknown) {\r\n      const message = error instanceof Error ? error.message : 'Failed to add relationship';\r\n      toast.error(message);\r\n      saveBtn.disabled = false;\r\n      saveBtn.textContent = 'Add Relationship';\r\n    }\r\n  });\r\n}\r\n\r\n// Helpers\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2) || '?';\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nfunction formatRelationType(type: string): string {\r\n  const types: Record<string, string> = {\r\n    reports_to: 'Reports to',\r\n    manages: 'Manages',\r\n    works_with: 'Works with',\r\n    knows: 'Knows',\r\n    referred_by: 'Referred by',\r\n  };\r\n  return types[type] || type.replace(/_/g, ' ');\r\n}\r\n\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - date.getTime();\r\n  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n\r\n  if (diffDays === 0) return 'Today';\r\n  if (diffDays === 1) return 'Yesterday';\r\n  if (diffDays < 7) return `${diffDays} days ago`;\r\n  \r\n  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });\r\n}\r\n\r\nexport default showContactModal;\r\n","/**\r\n * Team Modal Component\r\n * Manage project team members\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'team-modal';\r\n\r\nexport interface TeamMember {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  role: 'superadmin' | 'admin' | 'member';\r\n  joinedAt: string;\r\n  avatarUrl?: string;\r\n}\r\n\r\nexport interface TeamModalProps {\r\n  projectId?: string;\r\n  mode?: 'view' | 'edit' | 'manage' | 'create';\r\n  team?: { id: string; name: string };\r\n  onInvite?: () => void;\r\n  onSave?: (team: { name: string; description?: string }) => void;\r\n  onRemove?: (memberId: string) => void;\r\n  onRoleChange?: (memberId: string, role: TeamMember['role']) => void;\r\n}\r\n\r\nlet currentMembers: TeamMember[] = [];\r\n\r\n/**\r\n * Show team modal\r\n */\r\nexport async function showTeamModal(props: TeamModalProps): Promise<void> {\r\n  const { projectId, onInvite, onRemove, onRoleChange } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'team-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading team members...</div>';\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const inviteBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Invite Member',\r\n  });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  on(inviteBtn, 'click', () => {\r\n    closeModal(MODAL_ID);\r\n    onInvite?.();\r\n  });\r\n\r\n  footer.appendChild(closeBtn);\r\n  footer.appendChild(inviteBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Team Members',\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load team members\r\n  try {\r\n    const response = await http.get<TeamMember[]>(`/api/projects/${projectId}/members`);\r\n    currentMembers = response.data;\r\n    renderMembers(content, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load team members</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render team members list\r\n */\r\nfunction renderMembers(container: HTMLElement, props: TeamModalProps): void {\r\n  if (currentMembers.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No team members yet</p>\r\n        <p class=\"text-muted\">Invite members to collaborate on this project</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"team-list\">\r\n      ${currentMembers.map(member => renderMemberCard(member)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind actions\r\n  container.querySelectorAll('.member-card').forEach(card => {\r\n    const memberId = card.getAttribute('data-member-id');\r\n    if (!memberId) return;\r\n\r\n    const member = currentMembers.find(m => m.id === memberId);\r\n    if (!member) return;\r\n\r\n    // Role change\r\n    const roleSelect = card.querySelector('.role-select') as HTMLSelectElement;\r\n    if (roleSelect) {\r\n      on(roleSelect, 'change', async () => {\r\n        const newRole = roleSelect.value as TeamMember['role'];\r\n        try {\r\n          await http.patch(`/api/projects/${props.projectId}/members/${memberId}`, { role: newRole });\r\n          member.role = newRole;\r\n          toast.success('Role updated');\r\n          props.onRoleChange?.(memberId, newRole);\r\n        } catch {\r\n          roleSelect.value = member.role;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Remove member\r\n    const removeBtn = card.querySelector('.btn-remove');\r\n    if (removeBtn) {\r\n      on(removeBtn as HTMLElement, 'click', async () => {\r\n        const { confirm } = await import('../Modal');\r\n        const confirmed = await confirm(\r\n          `Remove ${member.name} from this project?`,\r\n          {\r\n            title: 'Remove Member',\r\n            confirmText: 'Remove',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await http.delete(`/api/projects/${props.projectId}/members/${memberId}`);\r\n            currentMembers = currentMembers.filter(m => m.id !== memberId);\r\n            renderMembers(container, props);\r\n            toast.success('Member removed');\r\n            props.onRemove?.(memberId);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Render individual member card\r\n */\r\nfunction renderMemberCard(member: TeamMember): string {\r\n  const initials = member.name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n\r\n  const isSuperadmin = member.role === 'superadmin';\r\n\r\n  return `\r\n    <div class=\"member-card\" data-member-id=\"${member.id}\">\r\n      <div class=\"member-avatar\">\r\n        ${member.avatarUrl \r\n          ? `<img src=\"${member.avatarUrl}\" alt=\"${escapeHtml(member.name)}\">`\r\n          : initials\r\n        }\r\n      </div>\r\n      <div class=\"member-info\">\r\n        <div class=\"member-name\">${escapeHtml(member.name)}</div>\r\n        <div class=\"member-email\">${escapeHtml(member.email)}</div>\r\n      </div>\r\n      <div class=\"member-role\">\r\n        ${isSuperadmin \r\n          ? `<span class=\"role-badge superadmin\">Owner</span>`\r\n          : `<select class=\"role-select form-control\">\r\n              <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\r\n              <option value=\"member\" ${member.role === 'member' ? 'selected' : ''}>Member</option>\r\n            </select>`\r\n        }\r\n      </div>\r\n      <div class=\"member-actions\">\r\n        ${!isSuperadmin \r\n          ? `<button class=\"btn btn-sm btn-danger btn-remove\" title=\"Remove member\"></button>`\r\n          : ''\r\n        }\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showTeamModal;\r\n","/**\n * Invite Modal Component\n * Invite new team members\n */\n\nimport { createElement, on } from '../../utils/dom';\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\n\nconst MODAL_ID = 'invite-modal';\n\ninterface Contact {\n  id: string;\n  name: string;\n  email?: string;\n  avatar_url?: string;\n  photo_url?: string;\n  organization?: string;\n  role?: string;\n}\n\ninterface ProjectMember {\n  user_id: string;\n  linked_contact_id?: string;\n}\n\nexport interface InviteModalProps {\n  projectId: string;\n  onInvite?: () => void;\n  onInviteSent?: (email: string) => void;\n}\n\n// Cache for loaded data\nlet cachedMembers: ProjectMember[] = [];\n\n/**\n * Show invite modal\n */\nexport function showInviteModal(props: InviteModalProps): void {\n  const { projectId, onInviteSent } = props;\n\n  // Remove existing modal\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\n  if (existing) existing.remove();\n\n  const content = createElement('div', { className: 'invite-modal-content' });\n\n  content.innerHTML = `\n    <style>\n      .invite-tabs {\n        display: flex;\n        gap: 0;\n        margin-bottom: 20px;\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\n      }\n      \n      .invite-tab-btn {\n        flex: 1;\n        padding: 12px 16px;\n        background: transparent;\n        border: none;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-secondary, #64748b);\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n      }\n      \n      .invite-tab-btn:hover {\n        color: var(--text-primary, #1e293b);\n      }\n      \n      .invite-tab-btn.active {\n        color: #e11d48;\n      }\n      \n      .invite-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: -1px;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: #e11d48;\n      }\n      \n      .invite-tab-content {\n        display: none;\n      }\n      \n      .invite-tab-content.active {\n        display: block;\n      }\n      \n      .contacts-list {\n        max-height: 300px;\n        overflow-y: auto;\n        border: 1px solid var(--border-color, #e2e8f0);\n        border-radius: 8px;\n        margin-bottom: 16px;\n      }\n      \n      .contact-option {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 12px 16px;\n        cursor: pointer;\n        transition: background 0.2s;\n        border-bottom: 1px solid var(--border-color, #e2e8f0);\n      }\n      \n      .contact-option:last-child {\n        border-bottom: none;\n      }\n      \n      .contact-option:hover {\n        background: var(--bg-secondary, #f8fafc);\n      }\n      \n      .contact-option.selected {\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.04) 100%);\n      }\n      \n      .contact-option input[type=\"radio\"] {\n        display: none;\n      }\n      \n      .contact-option .radio-circle {\n        width: 18px;\n        height: 18px;\n        border: 2px solid var(--border-color, #cbd5e1);\n        border-radius: 50%;\n        flex-shrink: 0;\n        position: relative;\n        transition: all 0.2s;\n      }\n      \n      .contact-option.selected .radio-circle {\n        border-color: #e11d48;\n      }\n      \n      .contact-option.selected .radio-circle::after {\n        content: '';\n        position: absolute;\n        top: 3px;\n        left: 3px;\n        width: 8px;\n        height: 8px;\n        background: #e11d48;\n        border-radius: 50%;\n      }\n      \n      .contact-avatar {\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #667eea, #764ba2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-size: 14px;\n        font-weight: 600;\n        flex-shrink: 0;\n        overflow: hidden;\n      }\n      \n      .contact-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .contact-info {\n        flex: 1;\n        min-width: 0;\n      }\n      \n      .contact-name {\n        font-weight: 500;\n        color: var(--text-primary, #1e293b);\n        margin-bottom: 2px;\n      }\n      \n      .contact-email {\n        font-size: 12px;\n        color: var(--text-secondary, #64748b);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      \n      .no-contacts-msg {\n        padding: 24px;\n        text-align: center;\n        color: var(--text-secondary, #64748b);\n      }\n      \n      .email-status {\n        margin-top: 8px;\n        padding: 8px 12px;\n        background: #f0fdf4;\n        border: 1px solid #bbf7d0;\n        border-radius: 8px;\n        font-size: 12px;\n        color: #166534;\n        display: none;\n      }\n      \n      .email-status.show {\n        display: block;\n      }\n      \n      .email-status.error {\n        background: #fef2f2;\n        border-color: #fecaca;\n        color: #991b1b;\n      }\n    </style>\n    \n    <!-- Tabs -->\n    <div class=\"invite-tabs\">\n      <button type=\"button\" class=\"invite-tab-btn active\" data-tab=\"new\">\n        New Email\n      </button>\n      <button type=\"button\" class=\"invite-tab-btn\" data-tab=\"contacts\">\n        Existing Contacts\n      </button>\n    </div>\n    \n    <!-- Tab: New Email -->\n    <div class=\"invite-tab-content active\" id=\"tab-new\">\n      <form id=\"invite-form\" class=\"invite-form\">\n        <div class=\"form-group\">\n          <label for=\"invite-email\">Email Address *</label>\n          <input type=\"email\" id=\"invite-email\" required \n                 placeholder=\"colleague@example.com\">\n          <div class=\"form-hint\">They will receive an email invitation to join this project</div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"invite-role\">Access Level</label>\n          <select id=\"invite-role\">\n            <option value=\"read\">Viewer - Can view data only</option>\n            <option value=\"write\" selected>Member - Can view and edit data</option>\n            <option value=\"admin\">Admin - Can manage team and settings</option>\n          </select>\n          <div class=\"form-hint invite-form-hint\">You can assign a project role after they join.</div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"invite-message\">Personal Message (optional)</label>\n          <textarea id=\"invite-message\" rows=\"2\" \n                    placeholder=\"Add a personal note to the invitation...\"></textarea>\n        </div>\n        \n        <div class=\"email-status\" id=\"email-status\"></div>\n      </form>\n    </div>\n    \n    <!-- Tab: Existing Contacts -->\n    <div class=\"invite-tab-content\" id=\"tab-contacts\">\n      <div id=\"contacts-list\" class=\"contacts-list\">\n        <div class=\"no-contacts-msg\">Loading contacts...</div>\n      </div>\n      \n      <div class=\"form-group\">\n        <label for=\"invite-role-contact\">Access Level</label>\n        <select id=\"invite-role-contact\">\n          <option value=\"read\">Viewer - Can view data only</option>\n          <option value=\"write\" selected>Member - Can view and edit data</option>\n          <option value=\"admin\">Admin - Can manage team and settings</option>\n        </select>\n      </div>\n      \n      <div class=\"add-options\">\n        <button type=\"button\" id=\"btn-add-direct\" class=\"btn btn-primary invite-btn-flex\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"invite-btn-icon\">\n            <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n            <circle cx=\"8.5\" cy=\"7\" r=\"4\"/>\n            <line x1=\"20\" y1=\"8\" x2=\"20\" y2=\"14\"/>\n            <line x1=\"23\" y1=\"11\" x2=\"17\" y2=\"11\"/>\n          </svg>\n          Add to Team\n        </button>\n        <button type=\"button\" id=\"btn-send-invite\" class=\"btn btn-secondary invite-btn-flex\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"invite-btn-icon\">\n            <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"/>\n            <polyline points=\"22,6 12,13 2,6\"/>\n          </svg>\n          Send Invitation\n        </button>\n      </div>\n      <div class=\"form-hint invite-form-hint-sm\">\n        <strong>Add to Team:</strong> Adds contact as team member directly (no email sent)<br>\n        <strong>Send Invitation:</strong> Sends an email invitation to join\n      </div>\n      \n      <div class=\"email-status\" id=\"email-status-contact\"></div>\n    </div>\n    \n    <div class=\"invite-link-section\">\n      <h4 class=\"invite-link-title\">Or share invite link</h4>\n      <div class=\"input-group invite-input-group\">\n        <input type=\"text\" id=\"invite-link\" readonly \n               value=\"Generating link...\" class=\"form-control invite-link-input\">\n        <button type=\"button\" id=\"btn-copy-link\" class=\"btn btn-secondary\">Copy</button>\n      </div>\n    </div>\n  `;\n\n  // State\n  let activeTab = 'new';\n  let selectedContact: Contact | null = null;\n\n  // Footer\n  const footer = createElement('div', { className: 'modal-footer' });\n\n  const cancelBtn = createElement('button', {\n    className: 'btn btn-secondary',\n    textContent: 'Cancel',\n  });\n\n  const sendBtn = createElement('button', {\n    className: 'btn btn-primary',\n    textContent: 'Send Invitation',\n  });\n\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\n\n  // Handler for sending email invitation (New Email tab)\n  on(sendBtn, 'click', async () => {\n    if (activeTab !== 'new') return; // Only for new email tab\n    \n    const form = content.querySelector('#invite-form') as HTMLFormElement;\n    if (!form.checkValidity()) {\n      form.reportValidity();\n      return;\n    }\n    const email = (content.querySelector('#invite-email') as HTMLInputElement).value.trim();\n    const role = (content.querySelector('#invite-role') as HTMLSelectElement).value;\n    const message = (content.querySelector('#invite-message') as HTMLTextAreaElement).value.trim();\n\n    sendBtn.disabled = true;\n    sendBtn.textContent = 'Sending...';\n\n    const statusEl = content.querySelector('#email-status') as HTMLElement;\n\n    try {\n      const response = await http.post<{ success: boolean; email_sent: boolean }>(`/api/projects/${projectId}/invites`, {\n        email,\n        role,\n        message: message || undefined,\n      });\n\n      if (response.data.email_sent) {\n        statusEl.textContent = ` Invitation email sent to ${email}`;\n        statusEl.classList.remove('error');\n        statusEl.classList.add('show');\n      } else {\n        statusEl.textContent = `Invitation created, but email could not be sent. Share the link manually.`;\n        statusEl.classList.add('error', 'show');\n      }\n\n      toast.success(`Invitation sent to ${email}`);\n      onInviteSent?.(email);\n      setTimeout(() => closeModal(MODAL_ID), 1500);\n    } catch {\n      statusEl.textContent = 'Failed to create invitation';\n      statusEl.classList.add('error', 'show');\n    } finally {\n      sendBtn.disabled = false;\n      sendBtn.textContent = 'Send Invitation';\n    }\n  });\n\n  footer.appendChild(cancelBtn);\n  footer.appendChild(sendBtn);\n\n  // Bind contacts tab buttons after modal is created\n  setTimeout(() => {\n    const btnAddDirect = content.querySelector('#btn-add-direct') as HTMLButtonElement;\n    const btnSendInvite = content.querySelector('#btn-send-invite') as HTMLButtonElement;\n    const statusEl = content.querySelector('#email-status-contact') as HTMLElement;\n\n    // Add directly without email\n    if (btnAddDirect) {\n      on(btnAddDirect, 'click', async () => {\n        if (!selectedContact) {\n          toast.error('Please select a contact');\n          return;\n        }\n        \n        const role = (content.querySelector('#invite-role-contact') as HTMLSelectElement).value;\n        \n        btnAddDirect.disabled = true;\n        btnAddDirect.innerHTML = '<span class=\"spinner\"></span> Adding...';\n\n        try {\n          // Add contact as team member directly (without email)\n          await http.post(`/api/projects/${projectId}/members/add-contact`, {\n            contact_id: selectedContact.id,\n            role,\n          });\n\n          statusEl.textContent = ` ${selectedContact.name} added to team`;\n          statusEl.classList.remove('error');\n          statusEl.classList.add('show');\n\n          toast.success(`${selectedContact.name} added to team`);\n          onInviteSent?.(selectedContact.email || selectedContact.name);\n          setTimeout(() => closeModal(MODAL_ID), 1000);\n        } catch (error: any) {\n          const msg = error?.response?.data?.error || 'Failed to add member';\n          statusEl.textContent = msg;\n          statusEl.classList.add('error', 'show');\n          toast.error(msg);\n        } finally {\n          btnAddDirect.disabled = false;\n          btnAddDirect.innerHTML = `\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"invite-btn-icon\">\n              <path d=\"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2\"/>\n              <circle cx=\"8.5\" cy=\"7\" r=\"4\"/>\n              <line x1=\"20\" y1=\"8\" x2=\"20\" y2=\"14\"/>\n              <line x1=\"23\" y1=\"11\" x2=\"17\" y2=\"11\"/>\n            </svg>\n            Add to Team\n          `;\n        }\n      });\n    }\n\n    // Send invitation email\n    if (btnSendInvite) {\n      on(btnSendInvite, 'click', async () => {\n        if (!selectedContact || !selectedContact.email) {\n          toast.error('Please select a contact with an email address');\n          return;\n        }\n\n        const role = (content.querySelector('#invite-role-contact') as HTMLSelectElement).value;\n\n        btnSendInvite.disabled = true;\n        btnSendInvite.innerHTML = '<span class=\"spinner\"></span> Sending...';\n\n        try {\n          const response = await http.post<{ success: boolean; email_sent: boolean }>(`/api/projects/${projectId}/invites`, {\n            email: selectedContact.email,\n            role,\n          });\n\n          if (response.data.email_sent) {\n            statusEl.textContent = ` Invitation email sent to ${selectedContact.email}`;\n            statusEl.classList.remove('error');\n            statusEl.classList.add('show');\n          } else {\n            statusEl.textContent = `Invitation created, but email could not be sent.`;\n            statusEl.classList.add('error', 'show');\n          }\n\n          toast.success(`Invitation sent to ${selectedContact.name}`);\n          onInviteSent?.(selectedContact.email);\n          setTimeout(() => closeModal(MODAL_ID), 1500);\n        } catch {\n          statusEl.textContent = 'Failed to send invitation';\n          statusEl.classList.add('error', 'show');\n        } finally {\n          btnSendInvite.disabled = false;\n          btnSendInvite.innerHTML = `\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" class=\"invite-btn-icon\">\n              <path d=\"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z\"/>\n              <polyline points=\"22,6 12,13 2,6\"/>\n            </svg>\n            Send Invitation\n          `;\n        }\n      });\n    }\n  }, 0);\n\n  // Create modal\n  const modal = createModal({\n    id: MODAL_ID,\n    title: 'Invite Team Member',\n    content,\n    size: 'md',\n    footer,\n  });\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n\n  // Generate invite link\n  generateInviteLink(content, projectId);\n\n  // Tab switching\n  const tabBtns = content.querySelectorAll('.invite-tab-btn');\n  tabBtns.forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const tabId = btn.getAttribute('data-tab') || 'new';\n      activeTab = tabId;\n      \n      tabBtns.forEach(b => b.classList.remove('active'));\n      btn.classList.add('active');\n      \n      content.querySelectorAll('.invite-tab-content').forEach(tab => {\n        tab.classList.toggle('active', tab.id === `tab-${tabId}`);\n      });\n    });\n  });\n\n  // Load contacts for the contacts tab (pass projectId to filter already-linked contacts)\n  loadContacts(content, projectId, (contact) => {\n    selectedContact = contact;\n  });\n\n  // Bind copy button\n  setTimeout(() => {\n    const copyBtn = content.querySelector('#btn-copy-link');\n    if (copyBtn) {\n      on(copyBtn as HTMLElement, 'click', () => {\n        const linkInput = content.querySelector('#invite-link') as HTMLInputElement;\n        navigator.clipboard.writeText(linkInput.value).then(() => {\n          toast.success('Link copied to clipboard');\n        }).catch(() => {\n          // Fallback\n          linkInput.select();\n          document.execCommand('copy');\n          toast.success('Link copied');\n        });\n      });\n    }\n  }, 0);\n}\n\n/**\n * Generate invite link\n */\nasync function generateInviteLink(container: HTMLElement, projectId: string): Promise<void> {\n  const linkInput = container.querySelector('#invite-link') as HTMLInputElement;\n\n  try {\n    const response = await http.get<{ link?: string; invite_url?: string }>(`/api/projects/${projectId}/invites/link`);\n    linkInput.value = response.data.link || response.data.invite_url || 'Link not available';\n  } catch {\n    // Try alternate endpoint\n    try {\n      const response = await http.post<{ invite_url?: string; token?: string }>(`/api/projects/${projectId}/invites`, {\n        email: '',\n        role: 'member',\n        generate_link_only: true,\n      });\n      if (response.data.invite_url) {\n        linkInput.value = response.data.invite_url;\n      } else {\n        linkInput.value = 'Use email invitation instead';\n      }\n    } catch {\n      linkInput.value = 'Use email invitation instead';\n    }\n  }\n}\n\n/**\n * Load project members to filter out already-linked contacts\n */\nasync function loadProjectMembers(projectId: string): Promise<void> {\n  try {\n    const response = await http.get<{ members: ProjectMember[] }>(`/api/projects/${projectId}/members`);\n    cachedMembers = response.data.members || [];\n  } catch (error) {\n    console.warn('[InviteModal] Failed to load project members:', error);\n    cachedMembers = [];\n  }\n}\n\n/**\n * Load contacts for selection\n */\nasync function loadContacts(container: HTMLElement, projectId: string, onSelect: (contact: Contact | null) => void): Promise<void> {\n  const listEl = container.querySelector('#contacts-list') as HTMLElement;\n  if (!listEl) return;\n\n  try {\n    // Load members first to know which contacts are already linked\n    await loadProjectMembers(projectId);\n    \n    const response = await http.get<{ contacts: Contact[] }>('/api/contacts');\n    const contacts = response.data.contacts || [];\n    \n    // Get IDs of contacts already linked to project members\n    const linkedContactIds = new Set(\n      cachedMembers\n        .filter(m => m.linked_contact_id)\n        .map(m => m.linked_contact_id)\n    );\n    \n    // Filter to contacts not already linked to a member\n    // Note: For \"Add to Team\" we don't require email, only for \"Send Invitation\"\n    const availableContacts = contacts.filter(c => !linkedContactIds.has(c.id));\n\n    if (availableContacts.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"no-contacts-msg\">\n          ${linkedContactIds.size > 0 \n            ? 'All contacts are already team members.' \n            : 'No contacts found.'}\n          <br>\n          <small class=\"invite-no-contacts-hint\">Add contacts in the Contacts panel.</small>\n        </div>\n      `;\n      return;\n    }\n\n    listEl.innerHTML = availableContacts.map(contact => {\n      const initials = contact.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n      const avatarUrl = contact.avatar_url || contact.photo_url;\n      const hasEmail = !!contact.email;\n      const subtitle = [contact.email, contact.organization].filter(Boolean).join('  ') || contact.role || 'No email';\n      \n      return `\n        <label class=\"contact-option\" data-id=\"${contact.id}\" data-has-email=\"${hasEmail}\">\n          <input type=\"radio\" name=\"contact-select\" value=\"${contact.id}\">\n          <span class=\"radio-circle\"></span>\n          <div class=\"contact-avatar\">\n            ${avatarUrl ? `<img src=\"${avatarUrl}\" alt=\"${escapeHtml(contact.name)}\">` : initials}\n          </div>\n          <div class=\"contact-info\">\n            <div class=\"contact-name\">${escapeHtml(contact.name)}</div>\n            <div class=\"contact-email\">${escapeHtml(subtitle)}${!hasEmail ? ' <span class=\"contact-no-email\">(no email)</span>' : ''}</div>\n          </div>\n        </label>\n      `;\n    }).join('');\n\n    // Bind selection events\n    const options = listEl.querySelectorAll('.contact-option');\n    options.forEach(option => {\n      on(option as HTMLElement, 'click', () => {\n        options.forEach(o => o.classList.remove('selected'));\n        option.classList.add('selected');\n        \n        const contactId = option.getAttribute('data-id');\n        const selectedContact = availableContacts.find(c => c.id === contactId) || null;\n        onSelect(selectedContact);\n      });\n    });\n  } catch (error) {\n    listEl.innerHTML = `\n      <div class=\"no-contacts-msg\">\n        Failed to load contacts\n      </div>\n    `;\n  }\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default showInviteModal;\n","/**\r\n * Role Modal Component\r\n * Manage user roles and permissions\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'role-modal';\r\n\r\nexport interface Role {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  permissions: string[];\r\n  color?: string;\r\n  isDefault?: boolean;\r\n}\r\n\r\nexport interface RoleModalProps {\r\n  mode: 'view' | 'edit' | 'create';\r\n  role?: Role;\r\n  availablePermissions?: string[];\r\n  onSave?: (role: Role) => void;\r\n  onDelete?: (roleId: string) => void;\r\n}\r\n\r\nconst defaultPermissions = [\r\n  'view:dashboard',\r\n  'view:chat',\r\n  'view:sot',\r\n  'view:contacts',\r\n  'edit:questions',\r\n  'edit:risks',\r\n  'edit:actions',\r\n  'edit:decisions',\r\n  'edit:contacts',\r\n  'manage:team',\r\n  'manage:settings',\r\n  'manage:roles',\r\n  'delete:data',\r\n  'export:data',\r\n];\r\n\r\n/**\r\n * Show role modal\r\n */\r\nexport function showRoleModal(props: RoleModalProps): void {\r\n  const { mode, role, availablePermissions = defaultPermissions, onSave, onDelete } = props;\r\n  const isEdit = mode === 'edit' && role?.id;\r\n  const isView = mode === 'view';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'role-modal-content' });\r\n\r\n  if (isView && role) {\r\n    content.innerHTML = `\r\n      <div class=\"role-view\">\r\n        <div class=\"role-header-info\">\r\n          <div class=\"role-color-badge\" style=\"--role-color: ${role.color || '#e94560'}\"></div>\r\n          <div>\r\n            <h3>${escapeHtml(role.name)}</h3>\r\n            ${role.description ? `<p class=\"text-muted\">${escapeHtml(role.description)}</p>` : ''}\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"role-permissions\">\r\n          <h4>Permissions (${role.permissions.length})</h4>\r\n          <div class=\"permissions-list\">\r\n            ${role.permissions.map(p => `\r\n              <span class=\"permission-tag\">${formatPermission(p)}</span>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n        \r\n        ${role.isDefault ? '<p class=\"text-muted\"><em>This is a system role and cannot be modified.</em></p>' : ''}\r\n      </div>\r\n    `;\r\n  } else {\r\n    const rolePermissions = role?.permissions || [];\r\n    \r\n    content.innerHTML = `\r\n      <form id=\"role-form\" class=\"role-form\">\r\n        <div class=\"form-row\">\r\n          <div class=\"form-group role-form-flex-1\">\r\n            <label for=\"role-name\">Role Name *</label>\r\n            <input type=\"text\" id=\"role-name\" required \r\n                   value=\"${role?.name || ''}\" \r\n                   placeholder=\"e.g., Project Manager\">\r\n          </div>\r\n          <div class=\"form-group role-form-w-80\">\r\n            <label for=\"role-color\">Color</label>\r\n            <input type=\"color\" id=\"role-color\" \r\n                   value=\"${role?.color || '#e94560'}\">\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"role-description\">Description</label>\r\n          <textarea id=\"role-description\" rows=\"2\" \r\n                    placeholder=\"Brief description of this role...\">${role?.description || ''}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Permissions</label>\r\n          <div class=\"permissions-grid\">\r\n            ${availablePermissions.map(p => `\r\n              <label class=\"permission-checkbox\">\r\n                <input type=\"checkbox\" name=\"permissions\" value=\"${p}\" \r\n                       ${rolePermissions.includes(p) ? 'checked' : ''}>\r\n                <span>${formatPermission(p)}</span>\r\n              </label>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary\" data-action=\"select-all\">Select All</button>\r\n          <button type=\"button\" class=\"btn btn-sm btn-secondary\" data-action=\"select-none\">Select None</button>\r\n        </div>\r\n      </form>\r\n    `;\r\n\r\n    // Bind select all/none\r\n    setTimeout(() => {\r\n      const selectAll = content.querySelector('[data-action=\"select-all\"]');\r\n      const selectNone = content.querySelector('[data-action=\"select-none\"]');\r\n\r\n      if (selectAll) {\r\n        on(selectAll as HTMLElement, 'click', () => {\r\n          content.querySelectorAll('[name=\"permissions\"]').forEach(cb => {\r\n            (cb as HTMLInputElement).checked = true;\r\n          });\r\n        });\r\n      }\r\n\r\n      if (selectNone) {\r\n        on(selectNone as HTMLElement, 'click', () => {\r\n          content.querySelectorAll('[name=\"permissions\"]').forEach(cb => {\r\n            (cb as HTMLInputElement).checked = false;\r\n          });\r\n        });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (isView) {\r\n    const editBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Edit',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    if (!role?.isDefault) {\r\n      on(editBtn, 'click', () => {\r\n        closeModal(MODAL_ID);\r\n        showRoleModal({ ...props, mode: 'edit' });\r\n      });\r\n      footer.appendChild(editBtn);\r\n    }\r\n\r\n    footer.appendChild(closeBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const saveBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: isEdit ? 'Save Changes' : 'Create Role',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(saveBtn, 'click', async () => {\r\n      const form = content.querySelector('#role-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const name = (content.querySelector('#role-name') as HTMLInputElement).value.trim();\r\n      const description = (content.querySelector('#role-description') as HTMLTextAreaElement).value.trim();\r\n      const color = (content.querySelector('#role-color') as HTMLInputElement).value;\r\n      \r\n      const permissions: string[] = [];\r\n      content.querySelectorAll('[name=\"permissions\"]:checked').forEach(cb => {\r\n        permissions.push((cb as HTMLInputElement).value);\r\n      });\r\n\r\n      const roleData: Role = {\r\n        id: role?.id || `role-${Date.now()}`,\r\n        name,\r\n        description: description || undefined,\r\n        color,\r\n        permissions,\r\n      };\r\n\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = 'Saving...';\r\n\r\n      try {\r\n        if (isEdit) {\r\n          await http.put(`/api/roles/${role!.id}`, roleData);\r\n          toast.success('Role updated');\r\n        } else {\r\n          const response = await http.post<{ id: string }>('/api/roles', roleData);\r\n          roleData.id = response.data.id;\r\n          toast.success('Role created');\r\n        }\r\n\r\n        onSave?.(roleData);\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        saveBtn.disabled = false;\r\n        saveBtn.textContent = isEdit ? 'Save Changes' : 'Create Role';\r\n      }\r\n    });\r\n\r\n    if (isEdit && !role?.isDefault) {\r\n      const deleteBtn = createElement('button', {\r\n        className: 'btn btn-danger',\r\n        textContent: 'Delete',\r\n      });\r\n\r\n      on(deleteBtn, 'click', async () => {\r\n        const { confirm } = await import('../Modal');\r\n        const confirmed = await confirm(\r\n          `Are you sure you want to delete the \"${role!.name}\" role?`,\r\n          {\r\n            title: 'Delete Role',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          }\r\n        );\r\n\r\n        if (confirmed) {\r\n          try {\r\n            await http.delete(`/api/roles/${role!.id}`);\r\n            toast.success('Role deleted');\r\n            onDelete?.(role!.id);\r\n            closeModal(MODAL_ID);\r\n          } catch {\r\n            // Error shown by API service\r\n          }\r\n        }\r\n      });\r\n\r\n      footer.appendChild(deleteBtn);\r\n    }\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(saveBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: isView ? 'Role Details' : (isEdit ? 'Edit Role' : 'New Role'),\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Format permission for display\r\n */\r\nfunction formatPermission(permission: string): string {\r\n  return permission\r\n    .replace(':', ': ')\r\n    .split(/[_:]/)\r\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\r\n    .join(' ');\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showRoleModal;\r\n","/**\r\n * Export Modal Component\r\n * Export project data in various formats\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { appStore } from '../../stores/app';\r\n\r\nconst MODAL_ID = 'export-modal';\r\n\r\nexport type ExportFormat = 'json' | 'csv' | 'pdf' | 'markdown';\r\nexport type ExportScope = 'all' | 'questions' | 'risks' | 'actions' | 'decisions' | 'contacts';\r\n\r\nexport interface ExportModalProps {\r\n  defaultFormat?: ExportFormat;\r\n  defaultScope?: ExportScope;\r\n  onExport?: (format: ExportFormat, scope: ExportScope) => void;\r\n}\r\n\r\n/**\r\n * Show export modal\r\n */\r\nexport function showExportModal(props: ExportModalProps = {}): void {\r\n  const { defaultFormat = 'json', defaultScope = 'all' } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'export-modal-content' });\r\n\r\n  content.innerHTML = `\r\n    <div class=\"export-options\">\r\n      <div class=\"form-group\">\r\n        <label>What to Export</label>\r\n        <div class=\"scope-options\">\r\n          <label class=\"radio-card ${defaultScope === 'all' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"all\" ${defaultScope === 'all' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Everything</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'questions' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"questions\" ${defaultScope === 'questions' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Questions</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'risks' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"risks\" ${defaultScope === 'risks' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Risks</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'actions' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"actions\" ${defaultScope === 'actions' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Actions</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'decisions' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"decisions\" ${defaultScope === 'decisions' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Decisions</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultScope === 'contacts' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-scope\" value=\"contacts\" ${defaultScope === 'contacts' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Contacts</span>\r\n            </div>\r\n          </label>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <label>Format</label>\r\n        <div class=\"format-options\">\r\n          <label class=\"radio-card ${defaultFormat === 'json' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"json\" ${defaultFormat === 'json' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\">{ }</span>\r\n              <span class=\"label\">JSON</span>\r\n              <span class=\"hint\">Full data backup</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultFormat === 'csv' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"csv\" ${defaultFormat === 'csv' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">CSV</span>\r\n              <span class=\"hint\">Spreadsheet</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultFormat === 'markdown' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"markdown\" ${defaultFormat === 'markdown' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">Markdown</span>\r\n              <span class=\"hint\">Documentation</span>\r\n            </div>\r\n          </label>\r\n          <label class=\"radio-card ${defaultFormat === 'pdf' ? 'selected' : ''}\">\r\n            <input type=\"radio\" name=\"export-format\" value=\"pdf\" ${defaultFormat === 'pdf' ? 'checked' : ''}>\r\n            <div class=\"radio-card-content\">\r\n              <span class=\"icon\"></span>\r\n              <span class=\"label\">PDF</span>\r\n              <span class=\"hint\">Report</span>\r\n            </div>\r\n          </label>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Handle radio card selection styling\r\n  content.querySelectorAll('.radio-card input').forEach(input => {\r\n    on(input as HTMLElement, 'change', () => {\r\n      const group = (input as HTMLInputElement).name;\r\n      content.querySelectorAll(`[name=\"${group}\"]`).forEach(radio => {\r\n        const card = radio.closest('.radio-card');\r\n        if (card) {\r\n          if ((radio as HTMLInputElement).checked) {\r\n            addClass(card as HTMLElement, 'selected');\r\n          } else {\r\n            removeClass(card as HTMLElement, 'selected');\r\n          }\r\n        }\r\n      });\r\n    });\r\n  });\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  const exportBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Export',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n  on(exportBtn, 'click', async () => {\r\n    const format = (content.querySelector('[name=\"export-format\"]:checked') as HTMLInputElement)?.value as ExportFormat;\r\n    const scope = (content.querySelector('[name=\"export-scope\"]:checked') as HTMLInputElement)?.value as ExportScope;\r\n\r\n    exportBtn.disabled = true;\r\n    exportBtn.textContent = 'Exporting...';\r\n\r\n    try {\r\n      await performExport(format, scope);\r\n      props.onExport?.(format, scope);\r\n      closeModal(MODAL_ID);\r\n    } catch {\r\n      // Error handled in performExport\r\n    } finally {\r\n      exportBtn.disabled = false;\r\n      exportBtn.textContent = 'Export';\r\n    }\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  footer.appendChild(exportBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Export Data',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Perform the export\r\n */\r\nasync function performExport(format: ExportFormat, scope: ExportScope): Promise<void> {\r\n  const projectId = appStore.getState().currentProjectId;\r\n  if (!projectId) {\r\n    toast.error('No project selected');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const response = await http.get<unknown>(`/api/projects/${projectId}/export`, {\r\n      headers: {\r\n        'Accept': getContentType(format),\r\n      },\r\n    });\r\n\r\n    // Create download\r\n    const blob = createBlob(response.data, format);\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `godmode-${scope}-${new Date().toISOString().split('T')[0]}.${getExtension(format)}`;\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n\r\n    toast.success('Export completed');\r\n  } catch {\r\n    toast.error('Export failed');\r\n    throw new Error('Export failed');\r\n  }\r\n}\r\n\r\n/**\r\n * Get content type for format\r\n */\r\nfunction getContentType(format: ExportFormat): string {\r\n  switch (format) {\r\n    case 'json': return 'application/json';\r\n    case 'csv': return 'text/csv';\r\n    case 'markdown': return 'text/markdown';\r\n    case 'pdf': return 'application/pdf';\r\n  }\r\n}\r\n\r\n/**\r\n * Get file extension for format\r\n */\r\nfunction getExtension(format: ExportFormat): string {\r\n  switch (format) {\r\n    case 'json': return 'json';\r\n    case 'csv': return 'csv';\r\n    case 'markdown': return 'md';\r\n    case 'pdf': return 'pdf';\r\n  }\r\n}\r\n\r\n/**\r\n * Create blob from data\r\n */\r\nfunction createBlob(data: unknown, format: ExportFormat): Blob {\r\n  let content: string;\r\n  let type: string;\r\n\r\n  switch (format) {\r\n    case 'json':\r\n      content = JSON.stringify(data, null, 2);\r\n      type = 'application/json';\r\n      break;\r\n    case 'csv':\r\n      content = typeof data === 'string' ? data : JSON.stringify(data);\r\n      type = 'text/csv';\r\n      break;\r\n    case 'markdown':\r\n      content = typeof data === 'string' ? data : JSON.stringify(data, null, 2);\r\n      type = 'text/markdown';\r\n      break;\r\n    case 'pdf':\r\n      // PDF would need special handling\r\n      content = typeof data === 'string' ? data : '';\r\n      type = 'application/pdf';\r\n      break;\r\n  }\r\n\r\n  return new Blob([content], { type });\r\n}\r\n\r\nexport default showExportModal;\r\n","/**\r\n * File Upload Modal Component\r\n * Handle file uploads with progress\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { toast } from '../../services/toast';\r\nimport { formatFileSize } from '../../utils/format';\r\nimport { getSprints } from '../../services/sprints';\r\nimport { getActions } from '../../services/actions';\r\nimport type { Sprint } from '../../services/sprints';\r\nimport type { Action } from '../../services/actions';\r\n\r\nconst MODAL_ID = 'file-upload-modal';\r\n\r\nexport interface UploadFile {\r\n  id: string;\r\n  file: File;\r\n  progress: number;\r\n  status: 'pending' | 'uploading' | 'completed' | 'error';\r\n  error?: string;\r\n}\r\n\r\nexport interface FileUploadModalProps {\r\n  accept?: string;\r\n  multiple?: boolean;\r\n  maxSize?: number; // bytes\r\n  onUpload?: (files: File[]) => Promise<void>;\r\n  onComplete?: (results: UploadFile[]) => void;\r\n}\r\n\r\nlet uploadQueue: UploadFile[] = [];\r\nlet isUploading = false;\r\nlet sprintsList: Sprint[] = [];\r\nlet actionsList: Action[] = [];\r\nlet selectedSprintId = '';\r\nlet selectedActionId = '';\r\n\r\n/**\r\n * Show file upload modal\r\n */\r\nexport function showFileUploadModal(props: FileUploadModalProps = {}): void {\r\n  const {\r\n    accept = '*/*',\r\n    multiple = true,\r\n    maxSize = 50 * 1024 * 1024, // 50MB default\r\n    onUpload,\r\n    onComplete,\r\n  } = props;\r\n\r\n  uploadQueue = [];\r\n  isUploading = false;\r\n  selectedSprintId = '';\r\n  selectedActionId = '';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'file-upload-modal-content' });\r\n\r\n  function render(): void {\r\n    const sprintOptions = sprintsList.map(s => `<option value=\"${s.id}\" ${s.id === selectedSprintId ? 'selected' : ''}>${escapeHtml(s.name)}</option>`).join('');\r\n    const actionOptions = actionsList.map(a => `<option value=\"${a.id}\" ${a.id === selectedActionId ? 'selected' : ''}>${escapeHtml((a.content || a.task || String(a.id)).slice(0, 60))}${(a.content || a.task || '').length > 60 ? '' : ''}</option>`).join('');\r\n\r\n    content.innerHTML = `\r\n      <div class=\"drop-zone\" id=\"drop-zone\">\r\n        <div class=\"drop-zone-icon\"></div>\r\n        <div class=\"drop-zone-text\">\r\n          <strong>Drop files here</strong> or click to browse\r\n        </div>\r\n        <div class=\"drop-zone-hint\">\r\n          ${multiple ? 'You can upload multiple files' : 'Single file only'}\r\n          ${maxSize ? `  Max ${formatFileSize(maxSize)}` : ''}\r\n        </div>\r\n        <input type=\"file\" id=\"file-input\" ${accept !== '*/*' ? `accept=\"${accept}\"` : ''} ${multiple ? 'multiple' : ''} hidden>\r\n      </div>\r\n\r\n      <div class=\"upload-association\" style=\"margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color, #e2e8f0);\">\r\n        <label class=\"form-label\" style=\"display: block; margin-bottom: 0.5rem; font-weight: 500;\">Associate with (optional)</label>\r\n        <div style=\"display: flex; gap: 12px; flex-wrap: wrap;\">\r\n          <div style=\"flex: 1; min-width: 140px;\">\r\n            <select id=\"upload-sprint-select\" class=\"form-select\" style=\"width: 100%;\">\r\n              <option value=\"\">No sprint</option>\r\n              ${sprintOptions}\r\n            </select>\r\n            <span class=\"form-hint\" style=\"font-size: 0.75rem; color: var(--text-tertiary);\">Sprint</span>\r\n          </div>\r\n          <div style=\"flex: 1; min-width: 180px;\">\r\n            <select id=\"upload-action-select\" class=\"form-select\" style=\"width: 100%;\">\r\n              <option value=\"\">No task</option>\r\n              ${actionOptions}\r\n            </select>\r\n            <span class=\"form-hint\" style=\"font-size: 0.75rem; color: var(--text-tertiary);\">Task</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      ${uploadQueue.length > 0 ? `\r\n        <div class=\"upload-list\">\r\n          <h4>Files (${uploadQueue.length})</h4>\r\n          ${uploadQueue.map(f => renderFileItem(f)).join('')}\r\n        </div>\r\n      ` : ''}\r\n    `;\r\n\r\n    bindDropZone();\r\n    bindFileItems();\r\n    bindSprintTaskSelectors();\r\n  }\r\n\r\n  function bindDropZone(): void {\r\n    const dropZone = content.querySelector('#drop-zone') as HTMLElement;\r\n    const fileInput = content.querySelector('#file-input') as HTMLInputElement;\r\n\r\n    if (!dropZone || !fileInput) return;\r\n\r\n    // Click to browse\r\n    on(dropZone, 'click', () => fileInput.click());\r\n\r\n    // File input change\r\n    on(fileInput, 'change', () => {\r\n      if (fileInput.files) {\r\n        addFiles(Array.from(fileInput.files), maxSize);\r\n        render();\r\n      }\r\n    });\r\n\r\n    // Drag and drop\r\n    on(dropZone, 'dragover', (e) => {\r\n      e.preventDefault();\r\n      addClass(dropZone, 'drag-over');\r\n    });\r\n\r\n    on(dropZone, 'dragleave', () => {\r\n      removeClass(dropZone, 'drag-over');\r\n    });\r\n\r\n    on(dropZone, 'drop', (e) => {\r\n      e.preventDefault();\r\n      removeClass(dropZone, 'drag-over');\r\n      \r\n      const dt = (e as DragEvent).dataTransfer;\r\n      if (dt?.files) {\r\n        addFiles(Array.from(dt.files), maxSize);\r\n        render();\r\n      }\r\n    });\r\n  }\r\n\r\n  function bindFileItems(): void {\r\n    content.querySelectorAll('[data-action=\"remove\"]').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => {\r\n        const fileId = btn.getAttribute('data-file-id');\r\n        if (fileId) {\r\n          uploadQueue = uploadQueue.filter(f => f.id !== fileId);\r\n          render();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  async function loadSprints(): Promise<void> {\r\n    try {\r\n      sprintsList = await getSprints();\r\n    } catch {\r\n      sprintsList = [];\r\n    }\r\n  }\r\n\r\n  async function loadActionsForSprint(sprintId: string): Promise<void> {\r\n    try {\r\n      actionsList = await getActions(undefined, sprintId || undefined);\r\n    } catch {\r\n      actionsList = [];\r\n    }\r\n  }\r\n\r\n  function bindSprintTaskSelectors(): void {\r\n    const sprintSelect = content.querySelector('#upload-sprint-select') as HTMLSelectElement;\r\n    const actionSelect = content.querySelector('#upload-action-select') as HTMLSelectElement;\r\n    if (sprintSelect) {\r\n      on(sprintSelect, 'change', async () => {\r\n        selectedSprintId = sprintSelect.value || '';\r\n        selectedActionId = '';\r\n        await loadActionsForSprint(selectedSprintId);\r\n        render();\r\n      });\r\n    }\r\n    if (actionSelect) {\r\n      on(actionSelect, 'change', () => {\r\n        selectedActionId = actionSelect.value || '';\r\n      });\r\n    }\r\n  }\r\n\r\n  render();\r\n  loadSprints().then(() => render());\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const cancelBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Cancel',\r\n  });\r\n\r\n  const uploadBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Upload',\r\n  });\r\n\r\n  on(cancelBtn, 'click', () => {\r\n    if (isUploading) {\r\n      toast.warning('Upload in progress');\r\n      return;\r\n    }\r\n    closeModal(MODAL_ID);\r\n  });\r\n\r\n  on(uploadBtn, 'click', async () => {\r\n    if (uploadQueue.length === 0) {\r\n      toast.warning('No files selected');\r\n      return;\r\n    }\r\n\r\n    if (isUploading) return;\r\n\r\n    isUploading = true;\r\n    uploadBtn.disabled = true;\r\n    uploadBtn.textContent = 'Uploading...';\r\n\r\n    try {\r\n      if (onUpload) {\r\n        const files = uploadQueue.map(f => f.file);\r\n        await onUpload(files);\r\n        \r\n        // Mark all as completed\r\n        uploadQueue.forEach(f => {\r\n          f.status = 'completed';\r\n          f.progress = 100;\r\n        });\r\n      } else {\r\n        // Default upload behavior\r\n        await uploadFiles(uploadQueue, render);\r\n      }\r\n\r\n      toast.success('Upload complete');\r\n      onComplete?.(uploadQueue);\r\n      closeModal(MODAL_ID);\r\n    } catch (error) {\r\n      toast.error('Upload failed');\r\n    } finally {\r\n      isUploading = false;\r\n      uploadBtn.disabled = false;\r\n      uploadBtn.textContent = 'Upload';\r\n      render();\r\n    }\r\n  });\r\n\r\n  footer.appendChild(cancelBtn);\r\n  footer.appendChild(uploadBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Upload Files',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Add files to queue\r\n */\r\nfunction addFiles(files: File[], maxSize: number): void {\r\n  files.forEach(file => {\r\n    if (file.size > maxSize) {\r\n      toast.error(`${file.name} exceeds max size`);\r\n      return;\r\n    }\r\n\r\n    // Check for duplicates\r\n    if (uploadQueue.some(f => f.file.name === file.name && f.file.size === file.size)) {\r\n      return;\r\n    }\r\n\r\n    uploadQueue.push({\r\n      id: `file-${Date.now()}-${Math.random().toString(36).slice(2)}`,\r\n      file,\r\n      progress: 0,\r\n      status: 'pending',\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render file item\r\n */\r\nfunction renderFileItem(item: UploadFile): string {\r\n  const icon = getFileIcon(item.file.type);\r\n  const statusClass = item.status;\r\n\r\n  return `\r\n    <div class=\"upload-item ${statusClass}\" data-file-id=\"${item.id}\">\r\n      <span class=\"file-icon\">${icon}</span>\r\n      <div class=\"file-info\">\r\n        <div class=\"file-name\">${escapeHtml(item.file.name)}</div>\r\n        <div class=\"file-size\">${formatFileSize(item.file.size)}</div>\r\n        ${item.status === 'uploading' ? `\r\n          <div class=\"progress-bar\">\r\n            <div class=\"progress-fill\" style=\"--progress: ${item.progress}\"></div>\r\n          </div>\r\n        ` : ''}\r\n        ${item.error ? `<div class=\"file-error\">${escapeHtml(item.error)}</div>` : ''}\r\n      </div>\r\n      <div class=\"file-status\">\r\n        ${item.status === 'completed' ? '' : ''}\r\n        ${item.status === 'error' ? '' : ''}\r\n        ${item.status === 'pending' ? `\r\n          <button class=\"btn-sm btn-danger\" data-action=\"remove\" data-file-id=\"${item.id}\"></button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Default upload handler\r\n */\r\nasync function uploadFiles(\r\n  files: UploadFile[],\r\n  rerender: () => void\r\n): Promise<void> {\r\n  for (const file of files) {\r\n    file.status = 'uploading';\r\n    rerender();\r\n\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('file', file.file);\r\n      if (selectedSprintId) formData.append('sprintId', selectedSprintId);\r\n      if (selectedActionId) formData.append('actionId', selectedActionId);\r\n\r\n      const xhr = new XMLHttpRequest();\r\n      \r\n      await new Promise<void>((resolve, reject) => {\r\n        xhr.upload.addEventListener('progress', (e) => {\r\n          if (e.lengthComputable) {\r\n            file.progress = Math.round((e.loaded / e.total) * 100);\r\n            rerender();\r\n          }\r\n        });\r\n\r\n        xhr.addEventListener('load', () => {\r\n          if (xhr.status >= 200 && xhr.status < 300) {\r\n            file.status = 'completed';\r\n            file.progress = 100;\r\n            resolve();\r\n          } else {\r\n            file.status = 'error';\r\n            file.error = 'Upload failed';\r\n            reject(new Error('Upload failed'));\r\n          }\r\n        });\r\n\r\n        xhr.addEventListener('error', () => {\r\n          file.status = 'error';\r\n          file.error = 'Network error';\r\n          reject(new Error('Network error'));\r\n        });\r\n\r\n        xhr.open('POST', '/api/upload');\r\n        xhr.send(formData);\r\n      });\r\n    } catch {\r\n      file.status = 'error';\r\n    }\r\n\r\n    rerender();\r\n  }\r\n}\r\n\r\n/**\r\n * Get icon for file type\r\n */\r\nfunction getFileIcon(mimeType: string): string {\r\n  if (mimeType.startsWith('image/')) return '';\r\n  if (mimeType.startsWith('video/')) return '';\r\n  if (mimeType.startsWith('audio/')) return '';\r\n  if (mimeType.includes('pdf')) return '';\r\n  if (mimeType.includes('word') || mimeType.includes('document')) return '';\r\n  if (mimeType.includes('sheet') || mimeType.includes('excel')) return '';\r\n  if (mimeType.includes('presentation') || mimeType.includes('powerpoint')) return '';\r\n  if (mimeType.includes('zip') || mimeType.includes('archive')) return '';\r\n  if (mimeType.includes('text')) return '';\r\n  return '';\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showFileUploadModal;\r\n","/**\r\n * Developer Modal Component\r\n * Developer tools and debugging options\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { appStore } from '../../stores/app';\r\nimport { dataStore } from '../../stores/data';\r\nimport { uiStore } from '../../stores/ui';\r\nimport { http, fetchWithProject } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'developer-modal';\r\n\r\ntype DevTab = 'info' | 'logs' | 'cache' | 'api';\r\n\r\n/**\r\n * Show developer modal\r\n */\r\nexport function showDeveloperModal(): void {\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'developer-modal-content' });\r\n  \r\n  let currentTab: DevTab = 'info';\r\n\r\n  function render(): void {\r\n    content.innerHTML = `\r\n      <div class=\"dev-tabs\">\r\n        <button class=\"dev-tab ${currentTab === 'info' ? 'active' : ''}\" data-tab=\"info\">Info</button>\r\n        <button class=\"dev-tab ${currentTab === 'logs' ? 'active' : ''}\" data-tab=\"logs\">Logs</button>\r\n        <button class=\"dev-tab ${currentTab === 'cache' ? 'active' : ''}\" data-tab=\"cache\">Cache</button>\r\n        <button class=\"dev-tab ${currentTab === 'api' ? 'active' : ''}\" data-tab=\"api\">API Test</button>\r\n      </div>\r\n      <div class=\"dev-content\">\r\n        ${renderTabContent(currentTab)}\r\n      </div>\r\n    `;\r\n\r\n    // Bind tab clicks\r\n    content.querySelectorAll('.dev-tab').forEach(tab => {\r\n      on(tab as HTMLElement, 'click', () => {\r\n        currentTab = tab.getAttribute('data-tab') as DevTab;\r\n        render();\r\n      });\r\n    });\r\n\r\n    // Bind actions\r\n    bindActions(content);\r\n  }\r\n\r\n  render();\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Close',\r\n  });\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Developer Tools',\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Render tab content\r\n */\r\nfunction renderTabContent(tab: DevTab): string {\r\n  switch (tab) {\r\n    case 'info':\r\n      return renderInfoTab();\r\n    case 'logs':\r\n      return renderLogsTab();\r\n    case 'cache':\r\n      return renderCacheTab();\r\n    case 'api':\r\n      return renderApiTab();\r\n  }\r\n}\r\n\r\n/**\r\n * Render info tab\r\n */\r\nfunction renderInfoTab(): string {\r\n  const appState = appStore.getState();\r\n  const dataState = dataStore.getState();\r\n  const uiState = uiStore.getState();\r\n\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>Application State</h4>\r\n      <pre class=\"code-block\">${JSON.stringify({\r\n        projectId: appState.currentProjectId,\r\n        user: appState.currentUser?.email,\r\n        authConfigured: appState.authConfigured,\r\n      }, null, 2)}</pre>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Data Counts</h4>\r\n      <table class=\"dev-table\">\r\n        <tr><td>Questions</td><td>${dataState.questions.length}</td></tr>\r\n        <tr><td>Risks</td><td>${dataState.risks.length}</td></tr>\r\n        <tr><td>Actions</td><td>${dataState.actions.length}</td></tr>\r\n        <tr><td>Decisions</td><td>${dataState.decisions.length}</td></tr>\r\n        <tr><td>Contacts</td><td>${dataState.contacts.length}</td></tr>\r\n        <tr><td>Chat Messages</td><td>${dataState.chatHistory.length}</td></tr>\r\n      </table>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>UI State</h4>\r\n      <pre class=\"code-block\">${JSON.stringify({\r\n        currentTab: uiState.currentTab,\r\n        sotView: uiState.sotCurrentView,\r\n        sidebarOpen: uiState.sidebarOpen,\r\n        modalOpen: uiState.modalOpen,\r\n      }, null, 2)}</pre>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Environment</h4>\r\n      <table class=\"dev-table\">\r\n        <tr><td>User Agent</td><td>${navigator.userAgent.slice(0, 50)}...</td></tr>\r\n        <tr><td>Screen</td><td>${window.innerWidth}x${window.innerHeight}</td></tr>\r\n        <tr><td>Theme</td><td>${document.documentElement.getAttribute('data-theme')}</td></tr>\r\n      </table>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render logs tab\r\n */\r\nfunction renderLogsTab(): string {\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>Console Logs</h4>\r\n      <p class=\"text-muted\">Open browser DevTools (F12) to view console logs.</p>\r\n      <div class=\"dev-actions\">\r\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"clear-console\">Clear Console</button>\r\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"log-state\">Log State</button>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Performance</h4>\r\n      <table class=\"dev-table\">\r\n        <tr><td>Page Load</td><td>${Math.round(performance.now())}ms</td></tr>\r\n        <tr><td>Memory</td><td>${getMemoryUsage()}</td></tr>\r\n      </table>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render cache tab\r\n */\r\nfunction renderCacheTab(): string {\r\n  const keys = Object.keys(localStorage);\r\n  const totalSize = keys.reduce((acc, key) => acc + (localStorage.getItem(key)?.length || 0), 0);\r\n\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>LocalStorage</h4>\r\n      <p>Items: ${keys.length} | Size: ${formatBytes(totalSize * 2)}</p>\r\n      <div class=\"dev-actions\">\r\n        <button class=\"btn btn-danger btn-sm\" data-action=\"clear-storage\">Clear All Storage</button>\r\n        <button class=\"btn btn-secondary btn-sm\" data-action=\"export-storage\">Export Storage</button>\r\n      </div>\r\n      <div class=\"storage-list\">\r\n        ${keys.map(key => `\r\n          <div class=\"storage-item\">\r\n            <span class=\"storage-key\">${key}</span>\r\n            <span class=\"storage-size\">${formatBytes((localStorage.getItem(key)?.length || 0) * 2)}</span>\r\n            <button class=\"btn-sm btn-danger\" data-action=\"delete-key\" data-key=\"${key}\"></button>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render API tab\r\n */\r\nfunction renderApiTab(): string {\r\n  return `\r\n    <div class=\"dev-section\">\r\n      <h4>API Test</h4>\r\n      <div class=\"form-group\">\r\n        <label>Endpoint</label>\r\n        <div class=\"input-group\">\r\n          <select id=\"api-method\" class=\"form-control api-method-select\">\r\n            <option value=\"GET\">GET</option>\r\n            <option value=\"POST\">POST</option>\r\n            <option value=\"PUT\">PUT</option>\r\n            <option value=\"DELETE\">DELETE</option>\r\n          </select>\r\n          <input type=\"text\" id=\"api-endpoint\" class=\"form-control\" value=\"/api/health\" placeholder=\"/api/...\">\r\n        </div>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Body (JSON)</label>\r\n        <textarea id=\"api-body\" class=\"form-control\" rows=\"3\" placeholder='{\"key\": \"value\"}'></textarea>\r\n      </div>\r\n      <button class=\"btn btn-primary\" data-action=\"test-api\">Send Request</button>\r\n    </div>\r\n    \r\n    <div class=\"dev-section\">\r\n      <h4>Response</h4>\r\n      <pre id=\"api-response\" class=\"code-block\">No request sent yet</pre>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind action handlers\r\n */\r\nfunction bindActions(container: HTMLElement): void {\r\n  container.querySelectorAll('[data-action]').forEach(el => {\r\n    const action = el.getAttribute('data-action');\r\n    \r\n    on(el as HTMLElement, 'click', async () => {\r\n      switch (action) {\r\n        case 'clear-console':\r\n          console.clear();\r\n          toast.success('Console cleared');\r\n          break;\r\n          \r\n        case 'log-state':\r\n          console.group('Application State');\r\n          console.log('App:', appStore.getState());\r\n          console.log('Data:', dataStore.getState());\r\n          console.log('UI:', uiStore.getState());\r\n          console.groupEnd();\r\n          toast.success('State logged to console');\r\n          break;\r\n          \r\n        case 'clear-storage':\r\n          localStorage.clear();\r\n          toast.success('Storage cleared');\r\n          location.reload();\r\n          break;\r\n          \r\n        case 'export-storage':\r\n          const data = { ...localStorage };\r\n          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\r\n          const url = URL.createObjectURL(blob);\r\n          const a = document.createElement('a');\r\n          a.href = url;\r\n          a.download = 'localstorage-backup.json';\r\n          a.click();\r\n          toast.success('Storage exported');\r\n          break;\r\n          \r\n        case 'delete-key':\r\n          const key = el.getAttribute('data-key');\r\n          if (key) {\r\n            localStorage.removeItem(key);\r\n            toast.success(`Removed: ${key}`);\r\n            showDeveloperModal(); // Refresh\r\n          }\r\n          break;\r\n          \r\n        case 'test-api':\r\n          await testApi(container);\r\n          break;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Test API endpoint\r\n */\r\nasync function testApi(container: HTMLElement): Promise<void> {\r\n  const method = (container.querySelector('#api-method') as HTMLSelectElement).value;\r\n  const endpoint = (container.querySelector('#api-endpoint') as HTMLInputElement).value;\r\n  const bodyText = (container.querySelector('#api-body') as HTMLTextAreaElement).value;\r\n  const responseEl = container.querySelector('#api-response') as HTMLPreElement;\r\n\r\n  responseEl.textContent = 'Loading...';\r\n\r\n  try {\r\n    const options: RequestInit = { method };\r\n    if (bodyText && method !== 'GET') {\r\n      options.body = bodyText;\r\n      options.headers = { 'Content-Type': 'application/json' };\r\n    }\r\n\r\n    const start = performance.now();\r\n    const response = await fetchWithProject(endpoint, options);\r\n    const elapsed = Math.round(performance.now() - start);\r\n    const data = await response.json().catch(() => response.text());\r\n\r\n    responseEl.textContent = `Status: ${response.status} (${elapsed}ms)\\n\\n${JSON.stringify(data, null, 2)}`;\r\n  } catch (error) {\r\n    responseEl.textContent = `Error: ${error instanceof Error ? error.message : 'Unknown error'}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Get memory usage\r\n */\r\nfunction getMemoryUsage(): string {\r\n  const perf = performance as Performance & { memory?: { usedJSHeapSize: number } };\r\n  if (perf.memory) {\r\n    return formatBytes(perf.memory.usedJSHeapSize);\r\n  }\r\n  return 'N/A';\r\n}\r\n\r\n/**\r\n * Format bytes\r\n */\r\nfunction formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\r\n}\r\n\r\nexport default showDeveloperModal;\r\n","/**\r\n * Shortcuts Modal Component\r\n * Display keyboard shortcuts reference\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { shortcuts } from '../../services/shortcuts';\r\n\r\nconst MODAL_ID = 'shortcuts-modal';\r\n\r\ninterface ShortcutGroup {\r\n  title: string;\r\n  shortcuts: Array<{\r\n    keys: string[];\r\n    description: string;\r\n  }>;\r\n}\r\n\r\nconst shortcutGroups: ShortcutGroup[] = [\r\n  {\r\n    title: 'General',\r\n    shortcuts: [\r\n      { keys: ['Ctrl', 'Z'], description: 'Undo last action' },\r\n      { keys: ['Ctrl', 'Shift', 'Z'], description: 'Redo' },\r\n      { keys: ['Ctrl', 'S'], description: 'Save current item' },\r\n      { keys: ['Esc'], description: 'Close modal / Cancel' },\r\n      { keys: ['?'], description: 'Show this help' },\r\n    ],\r\n  },\r\n  {\r\n    title: 'Navigation',\r\n    shortcuts: [\r\n      { keys: ['Ctrl', '1'], description: 'Go to Dashboard' },\r\n      { keys: ['Ctrl', '2'], description: 'Go to Chat' },\r\n      { keys: ['Ctrl', '3'], description: 'Go to Source of Truth' },\r\n      { keys: ['Ctrl', '4'], description: 'Go to Timeline' },\r\n      { keys: ['Ctrl', '5'], description: 'Go to Contacts' },\r\n    ],\r\n  },\r\n  {\r\n    title: 'Actions',\r\n    shortcuts: [\r\n      { keys: ['Ctrl', 'K'], description: 'Quick search' },\r\n      { keys: ['Ctrl', 'N'], description: 'New item' },\r\n      { keys: ['Ctrl', 'E'], description: 'Export data' },\r\n      { keys: ['Ctrl', 'Shift', 'T'], description: 'Toggle theme' },\r\n    ],\r\n  },\r\n  {\r\n    title: 'Chat',\r\n    shortcuts: [\r\n      { keys: ['Enter'], description: 'Send message' },\r\n      { keys: ['Shift', 'Enter'], description: 'New line' },\r\n      { keys: [''], description: 'Previous message' },\r\n    ],\r\n  },\r\n];\r\n\r\n/**\r\n * Show shortcuts modal\r\n */\r\nexport function showShortcutsModal(): void {\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'shortcuts-modal-content' });\r\n\r\n  // Get registered shortcuts from service\r\n  const registeredShortcuts = shortcuts.getAll();\r\n\r\n  content.innerHTML = `\r\n    <div class=\"shortcuts-grid\">\r\n      ${shortcutGroups.map(group => `\r\n        <div class=\"shortcut-group\">\r\n          <h4>${group.title}</h4>\r\n          <div class=\"shortcut-list\">\r\n            ${group.shortcuts.map(s => `\r\n              <div class=\"shortcut-item\">\r\n                <div class=\"shortcut-keys\">\r\n                  ${s.keys.map(k => `<kbd>${k}</kbd>`).join(' + ')}\r\n                </div>\r\n                <div class=\"shortcut-desc\">${s.description}</div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    \r\n    ${registeredShortcuts.length > 0 ? `\r\n      <div class=\"shortcuts-custom\">\r\n        <h4>Active Shortcuts</h4>\r\n        <div class=\"shortcut-list\">\r\n          ${registeredShortcuts.map(s => {\r\n            const keys: string[] = [];\r\n            if (s.ctrl) keys.push('Ctrl');\r\n            if (s.shift) keys.push('Shift');\r\n            if (s.alt) keys.push('Alt');\r\n            if (s.meta) keys.push('Cmd');\r\n            keys.push(s.key.toUpperCase());\r\n            \r\n            return `\r\n              <div class=\"shortcut-item\">\r\n                <div class=\"shortcut-keys\">\r\n                  ${keys.map(k => `<kbd>${k}</kbd>`).join(' + ')}\r\n                </div>\r\n                <div class=\"shortcut-desc\">${s.description}</div>\r\n              </div>\r\n            `;\r\n          }).join('')}\r\n        </div>\r\n      </div>\r\n    ` : ''}\r\n    \r\n    <div class=\"shortcuts-tip\">\r\n      <p class=\"text-muted\">\r\n         Tip: Most shortcuts use Ctrl on Windows/Linux or Cmd on Mac.\r\n      </p>\r\n    </div>\r\n  `;\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Got it',\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Keyboard Shortcuts',\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\nexport default showShortcutsModal;\r\n","/**\r\n * Notifications Modal Component\r\n * Display and manage notifications\r\n */\r\n\r\nimport { createElement, on, addClass, removeClass } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'notifications-modal';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  type: 'info' | 'success' | 'warning' | 'error' | 'mention' | 'update';\r\n  title: string;\r\n  message: string;\r\n  read: boolean;\r\n  createdAt: string;\r\n  link?: string;\r\n  actor?: {\r\n    name: string;\r\n    avatar?: string;\r\n  };\r\n}\r\n\r\nexport interface NotificationsModalProps {\r\n  onMarkAllRead?: () => void;\r\n  onNotificationClick?: (notification: Notification) => void;\r\n}\r\n\r\nlet notifications: Notification[] = [];\r\nlet filter: 'all' | 'unread' = 'all';\r\n\r\n/**\r\n * Show notifications modal\r\n */\r\nexport async function showNotificationsModal(props: NotificationsModalProps = {}): Promise<void> {\r\n  filter = 'all';\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'notifications-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading notifications...</div>';\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const markAllBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Mark All Read',\r\n  });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(markAllBtn, 'click', async () => {\r\n    try {\r\n      await http.post('/api/notifications/mark-all-read');\r\n      notifications.forEach(n => n.read = true);\r\n      render();\r\n      toast.success('All marked as read');\r\n      props.onMarkAllRead?.();\r\n    } catch {\r\n      // Error shown by API service\r\n    }\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n  footer.appendChild(markAllBtn);\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: 'Notifications',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load notifications\r\n  try {\r\n    const response = await http.get<Notification[]>('/api/notifications');\r\n    notifications = response.data;\r\n    render();\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load notifications</div>';\r\n  }\r\n\r\n  function render(): void {\r\n    const filtered = filter === 'unread' \r\n      ? notifications.filter(n => !n.read) \r\n      : notifications;\r\n\r\n    const unreadCount = notifications.filter(n => !n.read).length;\r\n\r\n    content.innerHTML = `\r\n      <div class=\"notifications-header\">\r\n        <div class=\"filter-tabs\">\r\n          <button class=\"filter-tab ${filter === 'all' ? 'active' : ''}\" data-filter=\"all\">\r\n            All (${notifications.length})\r\n          </button>\r\n          <button class=\"filter-tab ${filter === 'unread' ? 'active' : ''}\" data-filter=\"unread\">\r\n            Unread (${unreadCount})\r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      ${filtered.length === 0 ? `\r\n        <div class=\"empty-state\">\r\n          <span class=\"empty-icon\"></span>\r\n          <p>${filter === 'unread' ? 'No unread notifications' : 'No notifications yet'}</p>\r\n        </div>\r\n      ` : `\r\n        <div class=\"notifications-list\">\r\n          ${filtered.map(n => renderNotification(n)).join('')}\r\n        </div>\r\n      `}\r\n    `;\r\n\r\n    // Bind filter tabs\r\n    content.querySelectorAll('.filter-tab').forEach(tab => {\r\n      on(tab as HTMLElement, 'click', () => {\r\n        filter = tab.getAttribute('data-filter') as 'all' | 'unread';\r\n        render();\r\n      });\r\n    });\r\n\r\n    // Bind notification clicks\r\n    content.querySelectorAll('.notification-item').forEach(item => {\r\n      const id = item.getAttribute('data-notification-id');\r\n      const notification = notifications.find(n => n.id === id);\r\n      \r\n      if (notification) {\r\n        on(item as HTMLElement, 'click', async () => {\r\n          // Mark as read\r\n          if (!notification.read) {\r\n            try {\r\n              await http.patch(`/api/notifications/${id}/read`);\r\n              notification.read = true;\r\n              removeClass(item as HTMLElement, 'unread');\r\n            } catch {\r\n              // Silent fail\r\n            }\r\n          }\r\n\r\n          props.onNotificationClick?.(notification);\r\n\r\n          // Navigate if link exists\r\n          if (notification.link) {\r\n            closeModal(MODAL_ID);\r\n            // Handle navigation\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Render single notification\r\n */\r\nfunction renderNotification(notification: Notification): string {\r\n  const icon = getNotificationIcon(notification.type);\r\n\r\n  return `\r\n    <div class=\"notification-item ${notification.read ? '' : 'unread'}\" \r\n         data-notification-id=\"${notification.id}\">\r\n      <div class=\"notification-icon ${notification.type}\">${icon}</div>\r\n      <div class=\"notification-content\">\r\n        <div class=\"notification-title\">${escapeHtml(notification.title)}</div>\r\n        <div class=\"notification-message\">${escapeHtml(notification.message)}</div>\r\n        <div class=\"notification-meta\">\r\n          ${notification.actor ? `<span class=\"notification-actor\">${escapeHtml(notification.actor.name)}</span>  ` : ''}\r\n          <span class=\"notification-time\">${formatRelativeTime(notification.createdAt)}</span>\r\n        </div>\r\n      </div>\r\n      ${!notification.read ? '<div class=\"notification-dot\"></div>' : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get icon for notification type\r\n */\r\nfunction getNotificationIcon(type: Notification['type']): string {\r\n  switch (type) {\r\n    case 'info': return '';\r\n    case 'success': return '';\r\n    case 'warning': return '';\r\n    case 'error': return '';\r\n    case 'mention': return '';\r\n    case 'update': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showNotificationsModal;\r\n","/**\r\n * Email Modal Component\r\n * View and compose emails\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'email-modal';\r\n\r\nexport interface Email {\r\n  id: string;\r\n  from: { name: string; email: string };\r\n  to: Array<{ name: string; email: string }>;\r\n  cc?: Array<{ name: string; email: string }>;\r\n  subject: string;\r\n  body: string;\r\n  bodyHtml?: string;\r\n  date: string;\r\n  read: boolean;\r\n  attachments?: Array<{ name: string; size: number; type: string }>;\r\n  thread?: Email[];\r\n}\r\n\r\nexport interface EmailModalProps {\r\n  mode: 'view' | 'compose' | 'reply';\r\n  email?: Email;\r\n  onSend?: (email: Partial<Email>) => Promise<void>;\r\n}\r\n\r\n/**\r\n * Show email modal\r\n */\r\nexport function showEmailModal(props: EmailModalProps): void {\r\n  const { mode, email, onSend } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'email-modal-content' });\r\n\r\n  if (mode === 'view' && email) {\r\n    content.innerHTML = `\r\n      <div class=\"email-view\">\r\n        <div class=\"email-header\">\r\n          <div class=\"email-subject\">${escapeHtml(email.subject)}</div>\r\n          <div class=\"email-meta\">\r\n            <div class=\"email-from\">\r\n              <strong>${escapeHtml(email.from.name)}</strong>\r\n              <span class=\"text-muted\">&lt;${escapeHtml(email.from.email)}&gt;</span>\r\n            </div>\r\n            <div class=\"email-to\">\r\n              To: ${email.to.map(r => escapeHtml(r.name || r.email)).join(', ')}\r\n            </div>\r\n            ${email.cc?.length ? `\r\n              <div class=\"email-cc\">\r\n                Cc: ${email.cc.map(r => escapeHtml(r.name || r.email)).join(', ')}\r\n              </div>\r\n            ` : ''}\r\n            <div class=\"email-date\">${formatRelativeTime(email.date)}</div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"email-body\">\r\n          ${email.bodyHtml || escapeHtml(email.body).replace(/\\n/g, '<br>')}\r\n        </div>\r\n        \r\n        ${email.attachments?.length ? `\r\n          <div class=\"email-attachments\">\r\n            <h4>Attachments (${email.attachments.length})</h4>\r\n            <div class=\"attachments-list\">\r\n              ${email.attachments.map(a => `\r\n                <div class=\"attachment-item\">\r\n                  <span class=\"attachment-icon\"></span>\r\n                  <span class=\"attachment-name\">${escapeHtml(a.name)}</span>\r\n                  <span class=\"attachment-size\">${formatBytes(a.size)}</span>\r\n                </div>\r\n              `).join('')}\r\n            </div>\r\n          </div>\r\n        ` : ''}\r\n        \r\n        ${email.thread?.length ? `\r\n          <div class=\"email-thread\">\r\n            <h4>Thread (${email.thread.length} messages)</h4>\r\n            ${email.thread.map(t => `\r\n              <div class=\"thread-message\">\r\n                <div class=\"thread-header\">\r\n                  <strong>${escapeHtml(t.from.name)}</strong>\r\n                  <span>${formatRelativeTime(t.date)}</span>\r\n                </div>\r\n                <div class=\"thread-preview\">${escapeHtml(t.body.slice(0, 100))}...</div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n  } else {\r\n    // Compose / Reply mode\r\n    const isReply = mode === 'reply' && email;\r\n    const replyTo = isReply ? email.from.email : '';\r\n    const replySubject = isReply ? `Re: ${email.subject}` : '';\r\n\r\n    content.innerHTML = `\r\n      <form id=\"email-form\" class=\"email-form\">\r\n        <div class=\"form-group\">\r\n          <label for=\"email-to\">To *</label>\r\n          <input type=\"text\" id=\"email-to\" required \r\n                 value=\"${replyTo}\" \r\n                 placeholder=\"recipient@example.com\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"email-cc\">Cc</label>\r\n          <input type=\"text\" id=\"email-cc\" \r\n                 placeholder=\"cc@example.com\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"email-subject\">Subject *</label>\r\n          <input type=\"text\" id=\"email-subject\" required \r\n                 value=\"${escapeHtml(replySubject)}\" \r\n                 placeholder=\"Email subject\">\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label for=\"email-body\">Message *</label>\r\n          <textarea id=\"email-body\" rows=\"10\" required \r\n                    placeholder=\"Write your message...\">${isReply ? `\\n\\n---\\nOn ${email.date}, ${email.from.name} wrote:\\n${email.body}` : ''}</textarea>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Attachments</label>\r\n          <div class=\"attachment-dropzone\" id=\"attachment-zone\">\r\n            <span>Drop files here or click to attach</span>\r\n            <input type=\"file\" id=\"attachment-input\" multiple hidden>\r\n          </div>\r\n          <div id=\"attachments-preview\"></div>\r\n        </div>\r\n      </form>\r\n    `;\r\n\r\n    // Bind attachment zone\r\n    setTimeout(() => {\r\n      const zone = content.querySelector('#attachment-zone') as HTMLElement;\r\n      const input = content.querySelector('#attachment-input') as HTMLInputElement;\r\n\r\n      if (zone && input) {\r\n        on(zone, 'click', () => input.click());\r\n        on(input, 'change', () => {\r\n          // Handle file selection\r\n          if (input.files) {\r\n            const preview = content.querySelector('#attachments-preview') as HTMLElement;\r\n            preview.innerHTML = Array.from(input.files)\r\n              .map(f => `<div class=\"attachment-item\">${escapeHtml(f.name)}</div>`)\r\n              .join('');\r\n          }\r\n        });\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  if (mode === 'view') {\r\n    const replyBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Reply',\r\n    });\r\n\r\n    const forwardBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Forward',\r\n    });\r\n\r\n    const closeBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Close',\r\n    });\r\n\r\n    on(replyBtn, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showEmailModal({ ...props, mode: 'reply' });\r\n    });\r\n\r\n    on(forwardBtn, 'click', () => {\r\n      // Forward logic\r\n      toast.info('Forward not implemented');\r\n    });\r\n\r\n    on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    footer.appendChild(closeBtn);\r\n    footer.appendChild(forwardBtn);\r\n    footer.appendChild(replyBtn);\r\n  } else {\r\n    const cancelBtn = createElement('button', {\r\n      className: 'btn btn-secondary',\r\n      textContent: 'Cancel',\r\n    });\r\n\r\n    const sendBtn = createElement('button', {\r\n      className: 'btn btn-primary',\r\n      textContent: 'Send',\r\n    });\r\n\r\n    on(cancelBtn, 'click', () => closeModal(MODAL_ID));\r\n\r\n    on(sendBtn, 'click', async () => {\r\n      const form = content.querySelector('#email-form') as HTMLFormElement;\r\n      if (!form.checkValidity()) {\r\n        form.reportValidity();\r\n        return;\r\n      }\r\n\r\n      const to = (content.querySelector('#email-to') as HTMLInputElement).value;\r\n      const cc = (content.querySelector('#email-cc') as HTMLInputElement).value;\r\n      const subject = (content.querySelector('#email-subject') as HTMLInputElement).value;\r\n      const body = (content.querySelector('#email-body') as HTMLTextAreaElement).value;\r\n\r\n      const emailData: Partial<Email> = {\r\n        to: to.split(',').map(e => ({ name: '', email: e.trim() })),\r\n        cc: cc ? cc.split(',').map(e => ({ name: '', email: e.trim() })) : undefined,\r\n        subject,\r\n        body,\r\n      };\r\n\r\n      sendBtn.disabled = true;\r\n      sendBtn.textContent = 'Sending...';\r\n\r\n      try {\r\n        if (onSend) {\r\n          await onSend(emailData);\r\n        } else {\r\n          await http.post('/api/emails/send', emailData);\r\n        }\r\n        toast.success('Email sent');\r\n        closeModal(MODAL_ID);\r\n      } catch {\r\n        // Error shown by API service\r\n      } finally {\r\n        sendBtn.disabled = false;\r\n        sendBtn.textContent = 'Send';\r\n      }\r\n    });\r\n\r\n    footer.appendChild(cancelBtn);\r\n    footer.appendChild(sendBtn);\r\n  }\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: mode === 'view' ? 'Email' : (mode === 'reply' ? 'Reply' : 'Compose Email'),\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Format bytes\r\n */\r\nfunction formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showEmailModal;\r\n","/**\r\n * Charts Store\r\n * Chart instances and visualization state\r\n */\r\n\r\nimport type { Chart } from 'chart.js';\r\n\r\n// Types\r\nexport interface ChartInstance {\r\n  id: string;\r\n  chart: Chart | null;\r\n  container: string;\r\n  type: 'bar' | 'line' | 'pie' | 'doughnut' | 'radar';\r\n}\r\n\r\nexport interface NetworkInstance {\r\n  id: string;\r\n  network: unknown | null;\r\n  container: string;\r\n}\r\n\r\nexport interface ChartsState {\r\n  charts: Map<string, ChartInstance>;\r\n  networks: Map<string, NetworkInstance>;\r\n  activeChart: string | null;\r\n}\r\n\r\n// State\r\nconst state: ChartsState = {\r\n  charts: new Map(),\r\n  networks: new Map(),\r\n  activeChart: null,\r\n};\r\n\r\n// Listeners\r\nconst listeners: Set<() => void> = new Set();\r\n\r\n/**\r\n * Notify listeners\r\n */\r\nfunction notify(): void {\r\n  listeners.forEach(fn => fn());\r\n}\r\n\r\n/**\r\n * Register a chart instance\r\n */\r\nexport function registerChart(id: string, chart: Chart, container: string, type: ChartInstance['type']): void {\r\n  state.charts.set(id, { id, chart, container, type });\r\n  notify();\r\n}\r\n\r\n/**\r\n * Get a chart instance\r\n */\r\nexport function getChart(id: string): Chart | null {\r\n  return state.charts.get(id)?.chart ?? null;\r\n}\r\n\r\n/**\r\n * Destroy and remove a chart\r\n */\r\nexport function destroyChart(id: string): void {\r\n  const instance = state.charts.get(id);\r\n  if (instance?.chart) {\r\n    instance.chart.destroy();\r\n  }\r\n  state.charts.delete(id);\r\n  notify();\r\n}\r\n\r\n/**\r\n * Update chart data\r\n */\r\nexport function updateChartData(id: string, data: unknown): void {\r\n  const instance = state.charts.get(id);\r\n  if (instance?.chart) {\r\n    instance.chart.data = data as Chart['data'];\r\n    instance.chart.update();\r\n  }\r\n}\r\n\r\n/**\r\n * Register a network visualization\r\n */\r\nexport function registerNetwork(id: string, network: unknown, container: string): void {\r\n  state.networks.set(id, { id, network, container });\r\n  notify();\r\n}\r\n\r\n/**\r\n * Get a network instance\r\n */\r\nexport function getNetwork(id: string): unknown | null {\r\n  return state.networks.get(id)?.network ?? null;\r\n}\r\n\r\n/**\r\n * Destroy and remove a network\r\n */\r\nexport function destroyNetwork(id: string): void {\r\n  const instance = state.networks.get(id);\r\n  if (instance?.network && typeof (instance.network as { destroy?: () => void }).destroy === 'function') {\r\n    (instance.network as { destroy: () => void }).destroy();\r\n  }\r\n  state.networks.delete(id);\r\n  notify();\r\n}\r\n\r\n/**\r\n * Set active chart for highlighting\r\n */\r\nexport function setActiveChart(id: string | null): void {\r\n  state.activeChart = id;\r\n  notify();\r\n}\r\n\r\n/**\r\n * Get all chart IDs\r\n */\r\nexport function getChartIds(): string[] {\r\n  return Array.from(state.charts.keys());\r\n}\r\n\r\n/**\r\n * Get all network IDs\r\n */\r\nexport function getNetworkIds(): string[] {\r\n  return Array.from(state.networks.keys());\r\n}\r\n\r\n/**\r\n * Destroy all charts and networks\r\n */\r\nexport function destroyAll(): void {\r\n  state.charts.forEach((instance) => {\r\n    if (instance.chart) {\r\n      instance.chart.destroy();\r\n    }\r\n  });\r\n  state.networks.forEach((instance) => {\r\n    if (instance.network && typeof (instance.network as { destroy?: () => void }).destroy === 'function') {\r\n      (instance.network as { destroy: () => void }).destroy();\r\n    }\r\n  });\r\n  state.charts.clear();\r\n  state.networks.clear();\r\n  state.activeChart = null;\r\n  notify();\r\n}\r\n\r\n/**\r\n * Subscribe to changes\r\n */\r\nexport function subscribe(callback: () => void): () => void {\r\n  listeners.add(callback);\r\n  return () => listeners.delete(callback);\r\n}\r\n\r\n// Export as namespace\r\nexport const chartsStore = {\r\n  registerChart,\r\n  getChart,\r\n  destroyChart,\r\n  updateChartData,\r\n  registerNetwork,\r\n  getNetwork,\r\n  destroyNetwork,\r\n  setActiveChart,\r\n  getChartIds,\r\n  getNetworkIds,\r\n  destroyAll,\r\n  subscribe,\r\n};\r\n","/**\r\n * Graph Modal Component\r\n * Display graph/network visualizations\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { chartsStore } from '../../stores/charts';\r\n\r\nconst MODAL_ID = 'graph-modal';\r\n\r\nexport interface GraphNode {\r\n  id: string;\r\n  label: string;\r\n  type?: string;\r\n  color?: string;\r\n  size?: number;\r\n  data?: Record<string, unknown>;\r\n}\r\n\r\nexport interface GraphEdge {\r\n  id: string;\r\n  from: string;\r\n  to: string;\r\n  label?: string;\r\n  type?: string;\r\n  color?: string;\r\n}\r\n\r\nexport interface GraphModalProps {\r\n  title?: string;\r\n  nodes: GraphNode[];\r\n  edges: GraphEdge[];\r\n  onNodeClick?: (node: GraphNode) => void;\r\n  onEdgeClick?: (edge: GraphEdge) => void;\r\n}\r\n\r\n/**\r\n * Show graph modal\r\n */\r\nexport function showGraphModal(props: GraphModalProps): void {\r\n  const { title = 'Graph View', nodes, edges, onNodeClick, onEdgeClick } = props;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'graph-modal-content' });\r\n\r\n  content.innerHTML = `\r\n    <div class=\"graph-toolbar\">\r\n      <div class=\"graph-info\">\r\n        <span>Nodes: ${nodes.length}</span>\r\n        <span>Edges: ${edges.length}</span>\r\n      </div>\r\n      <div class=\"graph-controls\">\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"zoom-in\" title=\"Zoom In\">+</button>\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"zoom-out\" title=\"Zoom Out\"></button>\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"fit\" title=\"Fit to View\"></button>\r\n        <button class=\"btn btn-sm btn-secondary\" data-action=\"fullscreen\" title=\"Fullscreen\"></button>\r\n      </div>\r\n    </div>\r\n    <div id=\"graph-container\" class=\"graph-container\">\r\n      <div class=\"graph-placeholder\">\r\n        <p>Loading graph visualization...</p>\r\n        <p class=\"text-muted\">Requires vis-network library</p>\r\n      </div>\r\n    </div>\r\n    <div class=\"graph-legend\">\r\n      ${getUniqueTypes(nodes).map(type => `\r\n        <span class=\"legend-item\">\r\n          <span class=\"legend-color\" style=\"--legend-color: ${getTypeColor(type)}\"></span>\r\n          ${type}\r\n        </span>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const exportBtn = createElement('button', {\r\n    className: 'btn btn-secondary',\r\n    textContent: 'Export Image',\r\n  });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(exportBtn, 'click', () => {\r\n    // Export graph as image\r\n    const canvas = content.querySelector('canvas') as HTMLCanvasElement;\r\n    if (canvas) {\r\n      const link = document.createElement('a');\r\n      link.download = 'graph.png';\r\n      link.href = canvas.toDataURL();\r\n      link.click();\r\n    } else {\r\n      toast.warning('Graph not rendered');\r\n    }\r\n  });\r\n\r\n  on(closeBtn, 'click', () => {\r\n    // Destroy network before closing\r\n    chartsStore.destroyNetwork('modal-graph');\r\n    closeModal(MODAL_ID);\r\n  });\r\n\r\n  footer.appendChild(exportBtn);\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    content,\r\n    size: 'xl',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Initialize graph after modal is visible\r\n  setTimeout(() => {\r\n    initializeGraph(content, nodes, edges, onNodeClick, onEdgeClick);\r\n    bindControls(content);\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Initialize graph visualization\r\n */\r\nfunction initializeGraph(\r\n  container: HTMLElement,\r\n  nodes: GraphNode[],\r\n  edges: GraphEdge[],\r\n  onNodeClick?: (node: GraphNode) => void,\r\n  onEdgeClick?: (edge: GraphEdge) => void\r\n): void {\r\n  const graphContainer = container.querySelector('#graph-container') as HTMLElement;\r\n  \r\n  // Check if vis-network is available\r\n  if (typeof (window as unknown as { vis?: unknown }).vis === 'undefined') {\r\n    graphContainer.innerHTML = `\r\n      <div class=\"graph-fallback\">\r\n        <h4>Graph Data</h4>\r\n        <div class=\"graph-data\">\r\n          <strong>Nodes (${nodes.length}):</strong>\r\n          <ul>${nodes.slice(0, 10).map(n => `<li>${n.label} (${n.type || 'default'})</li>`).join('')}</ul>\r\n          ${nodes.length > 10 ? `<p class=\"text-muted\">...and ${nodes.length - 10} more</p>` : ''}\r\n        </div>\r\n        <div class=\"graph-data\">\r\n          <strong>Edges (${edges.length}):</strong>\r\n          <ul>${edges.slice(0, 10).map(e => `<li>${e.from}  ${e.to}${e.label ? ` (${e.label})` : ''}</li>`).join('')}</ul>\r\n          ${edges.length > 10 ? `<p class=\"text-muted\">...and ${edges.length - 10} more</p>` : ''}\r\n        </div>\r\n        <p class=\"text-muted\"><em>vis-network library not loaded</em></p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  const vis = (window as unknown as { vis: typeof import('vis-network') }).vis;\r\n\r\n  // Prepare data\r\n  const visNodes = new vis.DataSet(\r\n    nodes.map(n => ({\r\n      id: n.id,\r\n      label: n.label,\r\n      color: n.color || getTypeColor(n.type),\r\n      size: n.size || 20,\r\n    }))\r\n  );\r\n\r\n  const visEdges = new vis.DataSet(\r\n    edges.map(e => ({\r\n      id: e.id,\r\n      from: e.from,\r\n      to: e.to,\r\n      label: e.label,\r\n      color: e.color,\r\n    }))\r\n  );\r\n\r\n  const options = {\r\n    nodes: {\r\n      shape: 'dot',\r\n      font: { color: '#eaeaea', size: 12 },\r\n      borderWidth: 2,\r\n    },\r\n    edges: {\r\n      arrows: 'to',\r\n      color: { color: '#2a2a4a', highlight: '#e94560' },\r\n      font: { color: '#a0a0a0', size: 10 },\r\n    },\r\n    physics: {\r\n      enabled: true,\r\n      stabilization: { iterations: 100 },\r\n    },\r\n    interaction: {\r\n      hover: true,\r\n      tooltipDelay: 200,\r\n    },\r\n  };\r\n\r\n  graphContainer.innerHTML = '';\r\n  const network = new vis.Network(graphContainer, { nodes: visNodes, edges: visEdges }, options);\r\n\r\n  // Store reference\r\n  chartsStore.registerNetwork('modal-graph', network, '#graph-container');\r\n\r\n  // Bind events\r\n  if (onNodeClick) {\r\n    network.on('click', (params: { nodes: string[] }) => {\r\n      if (params.nodes.length > 0) {\r\n        const node = nodes.find(n => n.id === params.nodes[0]);\r\n        if (node) onNodeClick(node);\r\n      }\r\n    });\r\n  }\r\n\r\n  if (onEdgeClick) {\r\n    network.on('click', (params: { edges: string[] }) => {\r\n      if (params.edges.length > 0) {\r\n        const edge = edges.find(e => e.id === params.edges[0]);\r\n        if (edge) onEdgeClick(edge);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Bind control buttons\r\n */\r\nfunction bindControls(container: HTMLElement): void {\r\n  const network = chartsStore.getNetwork('modal-graph') as { \r\n    moveTo?: (options: object) => void;\r\n    fit?: () => void;\r\n  } | null;\r\n  \r\n  if (!network) return;\r\n\r\n  container.querySelectorAll('[data-action]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const action = btn.getAttribute('data-action');\r\n      \r\n      switch (action) {\r\n        case 'zoom-in':\r\n          network.moveTo?.({ scale: 1.2 });\r\n          break;\r\n        case 'zoom-out':\r\n          network.moveTo?.({ scale: 0.8 });\r\n          break;\r\n        case 'fit':\r\n          network.fit?.();\r\n          break;\r\n        case 'fullscreen':\r\n          const graphContainer = container.querySelector('.graph-container') as HTMLElement;\r\n          if (graphContainer) {\r\n            graphContainer.requestFullscreen?.();\r\n          }\r\n          break;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get unique node types\r\n */\r\nfunction getUniqueTypes(nodes: GraphNode[]): string[] {\r\n  const types = new Set(nodes.map(n => n.type || 'default'));\r\n  return Array.from(types);\r\n}\r\n\r\n/**\r\n * Get color for type\r\n */\r\nfunction getTypeColor(type?: string): string {\r\n  const colors: Record<string, string> = {\r\n    person: '#4ecdc4',\r\n    organization: '#e94560',\r\n    document: '#ffe66d',\r\n    event: '#ff6b6b',\r\n    location: '#45b7d1',\r\n    default: '#a0a0a0',\r\n  };\r\n  return colors[type || 'default'] || colors.default;\r\n}\r\n\r\n// Toast import for export feedback\r\nimport { toast } from '../../services/toast';\r\n\r\nexport default showGraphModal;\r\n","/**\r\n * History Modal Component\r\n * Display change history / audit log\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { http } from '../../services/api';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'history-modal';\r\n\r\nexport interface HistoryEntry {\r\n  id: string;\r\n  action: 'create' | 'update' | 'delete' | 'restore';\r\n  entityType: string;\r\n  entityId: string;\r\n  entityName?: string;\r\n  changes?: Record<string, { old: unknown; new: unknown }>;\r\n  actor: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n  };\r\n  timestamp: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface HistoryModalProps {\r\n  entityType?: string;\r\n  entityId?: string;\r\n  title?: string;\r\n  onRestore?: (entry: HistoryEntry) => void;\r\n}\r\n\r\nlet entries: HistoryEntry[] = [];\r\nlet page = 1;\r\nlet hasMore = true;\r\nlet loading = false;\r\n\r\n/**\r\n * Show history modal\r\n */\r\nexport async function showHistoryModal(props: HistoryModalProps = {}): Promise<void> {\r\n  const { entityType, entityId, title = 'History', onRestore } = props;\r\n\r\n  entries = [];\r\n  page = 1;\r\n  hasMore = true;\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'history-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading history...</div>';\r\n\r\n  // Footer\r\n  const footer = createElement('div', { className: 'modal-footer' });\r\n\r\n  const closeBtn = createElement('button', {\r\n    className: 'btn btn-primary',\r\n    textContent: 'Close',\r\n  });\r\n\r\n  on(closeBtn, 'click', () => closeModal(MODAL_ID));\r\n  footer.appendChild(closeBtn);\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    content,\r\n    size: 'lg',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Load initial data\r\n  await loadHistory(content, entityType, entityId, onRestore);\r\n}\r\n\r\n/**\r\n * Load history entries\r\n */\r\nasync function loadHistory(\r\n  container: HTMLElement,\r\n  entityType?: string,\r\n  entityId?: string,\r\n  onRestore?: (entry: HistoryEntry) => void\r\n): Promise<void> {\r\n  if (loading || !hasMore) return;\r\n\r\n  loading = true;\r\n\r\n  try {\r\n    const params = new URLSearchParams({ page: String(page), limit: '20' });\r\n    if (entityType) params.set('entityType', entityType);\r\n    if (entityId) params.set('entityId', entityId);\r\n\r\n    const response = await http.get<{ entries: HistoryEntry[]; hasMore: boolean }>(\r\n      `/api/history?${params}`\r\n    );\r\n\r\n    entries = [...entries, ...response.data.entries];\r\n    hasMore = response.data.hasMore;\r\n    page++;\r\n\r\n    render(container, onRestore);\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to load history</div>';\r\n  } finally {\r\n    loading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Render history\r\n */\r\nfunction render(container: HTMLElement, onRestore?: (entry: HistoryEntry) => void): void {\r\n  if (entries.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <span class=\"empty-icon\"></span>\r\n        <p>No history entries</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  // Group by date\r\n  const grouped = groupByDate(entries);\r\n\r\n  container.innerHTML = `\r\n    <div class=\"history-timeline\">\r\n      ${Object.entries(grouped).map(([date, items]) => `\r\n        <div class=\"history-date-group\">\r\n          <div class=\"history-date\">${date}</div>\r\n          ${items.map(entry => renderEntry(entry)).join('')}\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    ${hasMore ? `\r\n      <div class=\"history-load-more\">\r\n        <button class=\"btn btn-secondary\" data-action=\"load-more\">Load More</button>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n\r\n  // Bind load more\r\n  const loadMoreBtn = container.querySelector('[data-action=\"load-more\"]');\r\n  if (loadMoreBtn) {\r\n    on(loadMoreBtn as HTMLElement, 'click', async () => {\r\n      await loadHistory(container, undefined, undefined, onRestore);\r\n    });\r\n  }\r\n\r\n  // Bind restore buttons\r\n  if (onRestore) {\r\n    container.querySelectorAll('[data-action=\"restore\"]').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', async () => {\r\n        const entryId = btn.getAttribute('data-entry-id');\r\n        const entry = entries.find(e => e.id === entryId);\r\n        if (entry) {\r\n          const { confirm } = await import('../Modal');\r\n          const confirmed = await confirm(\r\n            'Are you sure you want to restore this version?',\r\n            { title: 'Restore', confirmText: 'Restore' }\r\n          );\r\n          if (confirmed) {\r\n            onRestore(entry);\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  // Bind expand buttons\r\n  container.querySelectorAll('[data-action=\"expand\"]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const changesEl = btn.closest('.history-entry')?.querySelector('.history-changes');\r\n      if (changesEl) {\r\n        changesEl.classList.toggle('expanded');\r\n        btn.textContent = changesEl.classList.contains('expanded') ? 'Hide details' : 'Show details';\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Render single entry\r\n */\r\nfunction renderEntry(entry: HistoryEntry): string {\r\n  const actionIcons: Record<string, string> = {\r\n    create: '',\r\n    update: '',\r\n    delete: '',\r\n    restore: '',\r\n  };\r\n\r\n  const actionColors: Record<string, string> = {\r\n    create: 'success',\r\n    update: 'info',\r\n    delete: 'danger',\r\n    restore: 'warning',\r\n  };\r\n\r\n  const hasChanges = entry.changes && Object.keys(entry.changes).length > 0;\r\n\r\n  return `\r\n    <div class=\"history-entry ${actionColors[entry.action]}\" data-entry-id=\"${entry.id}\">\r\n      <div class=\"history-icon\">${actionIcons[entry.action]}</div>\r\n      <div class=\"history-content\">\r\n        <div class=\"history-summary\">\r\n          <strong>${entry.actor.name}</strong>\r\n          ${entry.action}d\r\n          <span class=\"entity-type\">${entry.entityType}</span>\r\n          ${entry.entityName ? `\"${escapeHtml(entry.entityName)}\"` : ''}\r\n        </div>\r\n        <div class=\"history-time\">${formatRelativeTime(entry.timestamp)}</div>\r\n        \r\n        ${hasChanges ? `\r\n          <div class=\"history-changes\">\r\n            ${Object.entries(entry.changes!).map(([field, change]) => `\r\n              <div class=\"change-item\">\r\n                <span class=\"change-field\">${field}:</span>\r\n                <span class=\"change-old\">${formatValue(change.old)}</span>\r\n                <span class=\"change-arrow\"></span>\r\n                <span class=\"change-new\">${formatValue(change.new)}</span>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n          <button class=\"btn-link\" data-action=\"expand\">Show details</button>\r\n        ` : ''}\r\n        \r\n        ${entry.action === 'delete' ? `\r\n          <button class=\"btn btn-sm btn-secondary\" data-action=\"restore\" data-entry-id=\"${entry.id}\">\r\n            Restore\r\n          </button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Group entries by date\r\n */\r\nfunction groupByDate(items: HistoryEntry[]): Record<string, HistoryEntry[]> {\r\n  const groups: Record<string, HistoryEntry[]> = {};\r\n\r\n  items.forEach(item => {\r\n    const date = new Date(item.timestamp).toLocaleDateString();\r\n    if (!groups[date]) {\r\n      groups[date] = [];\r\n    }\r\n    groups[date].push(item);\r\n  });\r\n\r\n  return groups;\r\n}\r\n\r\n/**\r\n * Format value for display\r\n */\r\nfunction formatValue(value: unknown): string {\r\n  if (value === null || value === undefined) return '(empty)';\r\n  if (typeof value === 'object') return JSON.stringify(value);\r\n  return String(value);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showHistoryModal;\r\n","/**\r\n * Comment Modal Component\r\n * Add and view comments on entities\r\n */\r\n\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { appStore } from '../../stores/app';\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nconst MODAL_ID = 'comment-modal';\r\n\r\nexport interface Comment {\r\n  id: string;\r\n  content: string;\r\n  author: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n    avatar?: string;\r\n  };\r\n  createdAt: string;\r\n  updatedAt?: string;\r\n  edited?: boolean;\r\n  replies?: Comment[];\r\n}\r\n\r\nexport interface CommentModalProps {\r\n  entityType: string;\r\n  entityId: string;\r\n  entityName?: string;\r\n  onCommentAdded?: (comment: Comment) => void;\r\n}\r\n\r\nlet comments: Comment[] = [];\r\n\r\n/**\r\n * Show comment modal\r\n */\r\nexport async function showCommentModal(props: CommentModalProps): Promise<void> {\r\n  const { entityType, entityId, entityName, onCommentAdded } = props;\r\n\r\n  comments = [];\r\n\r\n  // Remove existing modal\r\n  const existing = document.querySelector(`[data-modal-id=\"${MODAL_ID}\"]`);\r\n  if (existing) existing.remove();\r\n\r\n  const content = createElement('div', { className: 'comment-modal-content' });\r\n  content.innerHTML = '<div class=\"loading\">Loading comments...</div>';\r\n\r\n  // Footer with comment input\r\n  const footer = createElement('div', { className: 'modal-footer comment-footer' });\r\n  footer.innerHTML = `\r\n    <div class=\"comment-input-wrapper\">\r\n      <textarea id=\"comment-input\" placeholder=\"Write a comment...\" rows=\"2\"></textarea>\r\n      <button id=\"submit-comment\" class=\"btn btn-primary\">Post</button>\r\n    </div>\r\n  `;\r\n\r\n  // Create modal\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title: entityName ? `Comments on \"${entityName}\"` : 'Comments',\r\n    content,\r\n    size: 'md',\r\n    footer,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n\r\n  // Bind submit\r\n  const submitBtn = footer.querySelector('#submit-comment') as HTMLButtonElement;\r\n  const input = footer.querySelector('#comment-input') as HTMLTextAreaElement;\r\n\r\n  on(submitBtn, 'click', async () => {\r\n    const text = input.value.trim();\r\n    if (!text) {\r\n      toast.warning('Please write a comment');\r\n      return;\r\n    }\r\n\r\n    submitBtn.disabled = true;\r\n    submitBtn.textContent = 'Posting...';\r\n\r\n    try {\r\n      const response = await http.post<Comment>(`/api/${entityType}/${entityId}/comments`, {\r\n        content: text,\r\n      });\r\n\r\n      comments.unshift(response.data);\r\n      input.value = '';\r\n      render(content, props);\r\n      onCommentAdded?.(response.data);\r\n      toast.success('Comment added');\r\n    } catch {\r\n      // Error shown by API service\r\n    } finally {\r\n      submitBtn.disabled = false;\r\n      submitBtn.textContent = 'Post';\r\n    }\r\n  });\r\n\r\n  // Ctrl+Enter to submit\r\n  on(input, 'keydown', (e) => {\r\n    if (e.key === 'Enter' && e.ctrlKey) {\r\n      submitBtn.click();\r\n    }\r\n  });\r\n\r\n  // Load comments\r\n  try {\r\n    const response = await http.get<Comment[]>(`/api/${entityType}/${entityId}/comments`);\r\n    comments = response.data;\r\n    render(content, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load comments</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render comments\r\n */\r\nfunction render(container: HTMLElement, props: CommentModalProps): void {\r\n  if (comments.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <span class=\"empty-icon\"></span>\r\n        <p>No comments yet</p>\r\n        <p class=\"text-muted\">Be the first to comment!</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"comments-list\">\r\n      ${comments.map(c => renderComment(c, props)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind actions\r\n  bindCommentActions(container, props);\r\n}\r\n\r\n/**\r\n * Render single comment\r\n */\r\nfunction renderComment(comment: Comment, props: CommentModalProps, depth = 0): string {\r\n  const currentUser = appStore.getState().currentUser;\r\n  const isAuthor = currentUser?.id === comment.author.id;\r\n  const initials = comment.author.name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n\r\n  return `\r\n    <div class=\"comment ${depth > 0 ? 'reply' : ''}\" data-comment-id=\"${comment.id}\" style=\"--reply-offset: ${depth * 20}px\">\r\n      <div class=\"comment-avatar\">\r\n        ${comment.author.avatar \r\n          ? `<img src=\"${comment.author.avatar}\" alt=\"${escapeHtml(comment.author.name)}\">`\r\n          : initials\r\n        }\r\n      </div>\r\n      <div class=\"comment-body\">\r\n        <div class=\"comment-header\">\r\n          <strong class=\"comment-author\">${escapeHtml(comment.author.name)}</strong>\r\n          <span class=\"comment-time\">${formatRelativeTime(comment.createdAt)}</span>\r\n          ${comment.edited ? '<span class=\"comment-edited\">(edited)</span>' : ''}\r\n        </div>\r\n        <div class=\"comment-content\">${escapeHtml(comment.content)}</div>\r\n        <div class=\"comment-actions\">\r\n          <button class=\"btn-link\" data-action=\"reply\" data-comment-id=\"${comment.id}\">Reply</button>\r\n          ${isAuthor ? `\r\n            <button class=\"btn-link\" data-action=\"edit\" data-comment-id=\"${comment.id}\">Edit</button>\r\n            <button class=\"btn-link text-danger\" data-action=\"delete\" data-comment-id=\"${comment.id}\">Delete</button>\r\n          ` : ''}\r\n        </div>\r\n      </div>\r\n    </div>\r\n    ${comment.replies?.map(r => renderComment(r, props, depth + 1)).join('') || ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Bind comment action handlers\r\n */\r\nfunction bindCommentActions(container: HTMLElement, props: CommentModalProps): void {\r\n  container.querySelectorAll('[data-action]').forEach(btn => {\r\n    const action = btn.getAttribute('data-action');\r\n    const commentId = btn.getAttribute('data-comment-id');\r\n\r\n    on(btn as HTMLElement, 'click', async () => {\r\n      const comment = findComment(comments, commentId!);\r\n      if (!comment) return;\r\n\r\n      switch (action) {\r\n        case 'reply':\r\n          // Show reply input\r\n          const replyContainer = btn.closest('.comment')?.querySelector('.comment-body');\r\n          if (replyContainer && !replyContainer.querySelector('.reply-input')) {\r\n            const replyInput = createElement('div', { className: 'reply-input' });\r\n            replyInput.innerHTML = `\r\n              <textarea placeholder=\"Write a reply...\" rows=\"2\"></textarea>\r\n              <div class=\"reply-actions\">\r\n                <button class=\"btn btn-sm btn-secondary cancel-reply\">Cancel</button>\r\n                <button class=\"btn btn-sm btn-primary submit-reply\">Reply</button>\r\n              </div>\r\n            `;\r\n\r\n            replyContainer.appendChild(replyInput);\r\n\r\n            const cancelBtn = replyInput.querySelector('.cancel-reply');\r\n            const submitBtn = replyInput.querySelector('.submit-reply');\r\n            const textarea = replyInput.querySelector('textarea') as HTMLTextAreaElement;\r\n\r\n            on(cancelBtn as HTMLElement, 'click', () => replyInput.remove());\r\n            on(submitBtn as HTMLElement, 'click', async () => {\r\n              const text = textarea.value.trim();\r\n              if (!text) return;\r\n\r\n              try {\r\n                const response = await http.post<Comment>(\r\n                  `/api/${props.entityType}/${props.entityId}/comments/${commentId}/replies`,\r\n                  { content: text }\r\n                );\r\n\r\n                if (!comment.replies) comment.replies = [];\r\n                comment.replies.push(response.data);\r\n                render(container, props);\r\n              } catch {\r\n                // Error shown by API service\r\n              }\r\n            });\r\n\r\n            textarea.focus();\r\n          }\r\n          break;\r\n\r\n        case 'edit':\r\n          // Inline edit\r\n          const contentEl = btn.closest('.comment')?.querySelector('.comment-content');\r\n          if (contentEl) {\r\n            const originalText = comment.content;\r\n            contentEl.innerHTML = `\r\n              <textarea class=\"edit-textarea\">${escapeHtml(originalText)}</textarea>\r\n              <div class=\"edit-actions\">\r\n                <button class=\"btn btn-sm btn-secondary cancel-edit\">Cancel</button>\r\n                <button class=\"btn btn-sm btn-primary save-edit\">Save</button>\r\n              </div>\r\n            `;\r\n\r\n            const textarea = contentEl.querySelector('textarea') as HTMLTextAreaElement;\r\n            const cancelBtn = contentEl.querySelector('.cancel-edit');\r\n            const saveBtn = contentEl.querySelector('.save-edit');\r\n\r\n            on(cancelBtn as HTMLElement, 'click', () => {\r\n              contentEl.textContent = originalText;\r\n            });\r\n\r\n            on(saveBtn as HTMLElement, 'click', async () => {\r\n              const newText = textarea.value.trim();\r\n              if (!newText) return;\r\n\r\n              try {\r\n                await http.patch(\r\n                  `/api/${props.entityType}/${props.entityId}/comments/${commentId}`,\r\n                  { content: newText }\r\n                );\r\n                comment.content = newText;\r\n                comment.edited = true;\r\n                render(container, props);\r\n              } catch {\r\n                // Error shown by API service\r\n              }\r\n            });\r\n\r\n            textarea.focus();\r\n          }\r\n          break;\r\n\r\n        case 'delete':\r\n          const { confirm } = await import('../Modal');\r\n          const confirmed = await confirm('Delete this comment?', {\r\n            title: 'Delete Comment',\r\n            confirmText: 'Delete',\r\n            confirmClass: 'btn-danger',\r\n          });\r\n\r\n          if (confirmed) {\r\n            try {\r\n              await http.delete(\r\n                `/api/${props.entityType}/${props.entityId}/comments/${commentId}`\r\n              );\r\n              removeComment(comments, commentId!);\r\n              render(container, props);\r\n              toast.success('Comment deleted');\r\n            } catch {\r\n              // Error shown by API service\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Find comment by ID (recursive)\r\n */\r\nfunction findComment(list: Comment[], id: string): Comment | undefined {\r\n  for (const comment of list) {\r\n    if (comment.id === id) return comment;\r\n    if (comment.replies) {\r\n      const found = findComment(comment.replies, id);\r\n      if (found) return found;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * Remove comment by ID (recursive)\r\n */\r\nfunction removeComment(list: Comment[], id: string): boolean {\r\n  const index = list.findIndex(c => c.id === id);\r\n  if (index !== -1) {\r\n    list.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  for (const comment of list) {\r\n    if (comment.replies && removeComment(comment.replies, id)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showCommentModal;\r\n","/**\n * Profile Modal - SOTA Design\n * View and edit user profile with modern glassmorphism design\n */\n\nimport { createModal, openModal, closeModal } from '../Modal';\nimport { createElement, on } from '../../utils/dom';\nimport { profileService, UserProfile } from '../../services/profile';\nimport { appStore } from '../../stores/app';\nimport { toast } from '../../services/toast';\nimport { http } from '../../services/api';\nimport * as krispService from '../../services/krisp';\n\nconst MODAL_ID = 'profile-modal';\n\ninterface Timezone {\n  code: string;\n  name: string;\n  region?: string;\n  utc_offset: string;\n  abbreviation?: string;\n}\n\nexport interface ProfileModalProps {\n  onClose?: () => void;\n  onUpdate?: (profile: UserProfile) => void;\n}\n\nlet currentProps: ProfileModalProps = {};\nlet currentProfile: UserProfile | null = null;\nlet cachedTimezones: Timezone[] | null = null;\n\n/**\n * Show profile modal\n */\nexport function showProfileModal(props: ProfileModalProps = {}): void {\n  currentProps = props;\n\n  const content = createModalContent();\n  \n  const modal = createModal({\n    id: MODAL_ID,\n    title: '',\n    size: 'lg',\n    content: content,\n    onClose: props.onClose,\n  });\n\n  modal.classList.add('profile-modal-overlay');\n\n  const modalContent = modal.querySelector('.modal-content') as HTMLElement;\n  if (modalContent) {\n    modalContent.classList.add('profile-modal-content');\n  }\n  const modalHeader = modal.querySelector('.modal-header') as HTMLElement;\n  if (modalHeader) {\n    modalHeader.classList.add('hidden');\n  }\n\n  document.body.appendChild(modal);\n  openModal(MODAL_ID);\n  \n  loadProfile(content);\n}\n\n/**\n * Create modal content\n */\nfunction createModalContent(): HTMLElement {\n  const container = createElement('div', { className: 'profile-modal-sota' });\n\n  container.innerHTML = `\n    <style>\n      .profile-modal-sota {\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n      \n      .profile-card {\n        background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\n        backdrop-filter: blur(20px);\n        border-radius: 24px;\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.15),\n          0 0 0 1px rgba(255, 255, 255, 0.8),\n          inset 0 1px 0 rgba(255, 255, 255, 0.9);\n        overflow: hidden;\n      }\n      \n      [data-theme=\"dark\"] .profile-card {\n        background: linear-gradient(135deg, rgba(30,41,59,0.95) 0%, rgba(15,23,42,0.95) 100%);\n        box-shadow: \n          0 25px 50px -12px rgba(0, 0, 0, 0.5),\n          0 0 0 1px rgba(255, 255, 255, 0.1),\n          inset 0 1px 0 rgba(255, 255, 255, 0.05);\n      }\n      \n      .profile-header {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        padding: 32px;\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .profile-header::before {\n        content: '';\n        position: absolute;\n        top: -50%;\n        right: -50%;\n        width: 100%;\n        height: 200%;\n        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);\n        pointer-events: none;\n      }\n      \n      .profile-header-content {\n        display: flex;\n        align-items: center;\n        gap: 24px;\n        position: relative;\n        z-index: 1;\n      }\n      \n      .profile-avatar-large {\n        width: 100px;\n        height: 100px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 36px;\n        font-weight: 600;\n        color: white;\n        border: 4px solid rgba(255,255,255,0.3);\n        overflow: hidden;\n        flex-shrink: 0;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        position: relative;\n      }\n      \n      .profile-avatar-large:hover {\n        border-color: rgba(255,255,255,0.5);\n        transform: scale(1.05);\n      }\n      \n      .profile-avatar-large img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      \n      .avatar-overlay {\n        position: absolute;\n        inset: 0;\n        background: rgba(0,0,0,0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        opacity: 0;\n        transition: opacity 0.2s;\n        border-radius: 50%;\n      }\n      \n      .profile-avatar-large:hover .avatar-overlay {\n        opacity: 1;\n      }\n      \n      .avatar-overlay svg {\n        width: 28px;\n        height: 28px;\n        color: white;\n      }\n      \n      .profile-user-info h2 {\n        margin: 0 0 4px 0;\n        font-size: 28px;\n        font-weight: 700;\n        color: white;\n      }\n      \n      .profile-user-info .email {\n        color: rgba(255,255,255,0.8);\n        font-size: 14px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .profile-user-info .role-badge {\n        display: inline-flex;\n        align-items: center;\n        gap: 4px;\n        background: rgba(255,255,255,0.2);\n        padding: 4px 10px;\n        border-radius: 20px;\n        font-size: 11px;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n        color: white;\n      }\n      \n      .profile-close-btn {\n        position: absolute;\n        top: 16px;\n        right: 16px;\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: rgba(255,255,255,0.2);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n        z-index: 10;\n      }\n      \n      .profile-close-btn:hover {\n        background: rgba(255,255,255,0.3);\n        transform: rotate(90deg);\n      }\n      \n      .profile-close-btn svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n      \n      .profile-tabs-nav {\n        display: flex;\n        gap: 0;\n        padding: 0 24px;\n        background: rgba(0,0,0,0.02);\n        border-bottom: 1px solid rgba(0,0,0,0.06);\n      }\n      \n      [data-theme=\"dark\"] .profile-tabs-nav {\n        background: rgba(255,255,255,0.02);\n        border-bottom-color: rgba(255,255,255,0.06);\n      }\n      \n      .profile-tab-btn {\n        padding: 16px 24px;\n        background: transparent;\n        border: none;\n        font-size: 14px;\n        font-weight: 500;\n        color: #64748b;\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n      }\n      \n      .profile-tab-btn:hover {\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .profile-tab-btn:hover {\n        color: #e2e8f0;\n      }\n      \n      .profile-tab-btn.active {\n        color: #e11d48;\n      }\n      \n      .profile-tab-btn.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 24px;\n        right: 24px;\n        height: 2px;\n        background: #e11d48;\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .profile-tab-icon {\n        width: 18px;\n        height: 18px;\n        margin-right: 8px;\n        vertical-align: middle;\n      }\n      \n      .profile-body {\n        padding: 32px;\n      }\n      \n      .profile-section {\n        display: none;\n      }\n      \n      .profile-section.active {\n        display: block;\n      }\n      \n      .form-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 20px;\n      }\n      \n      .form-grid .full-width {\n        grid-column: 1 / -1;\n      }\n      \n      .form-field {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n      }\n      \n      .form-field label {\n        font-size: 13px;\n        font-weight: 600;\n        color: #475569;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n      \n      [data-theme=\"dark\"] .form-field label {\n        color: #94a3b8;\n      }\n      \n      .form-field input,\n      .form-field select,\n      .form-field textarea {\n        padding: 12px 16px;\n        border: 1px solid #e2e8f0;\n        border-radius: 12px;\n        font-size: 14px;\n        background: #f8fafc;\n        color: #1e293b;\n        transition: all 0.2s;\n        outline: none;\n      }\n      \n      [data-theme=\"dark\"] .form-field input,\n      [data-theme=\"dark\"] .form-field select,\n      [data-theme=\"dark\"] .form-field textarea {\n        background: rgba(255,255,255,0.05);\n        border-color: rgba(255,255,255,0.1);\n        color: #f1f5f9;\n      }\n      \n      .form-field input:focus,\n      .form-field select:focus,\n      .form-field textarea:focus {\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n      \n      .form-field input:disabled {\n        background: #f1f5f9;\n        color: #94a3b8;\n        cursor: not-allowed;\n      }\n      \n      [data-theme=\"dark\"] .form-field input:disabled {\n        background: rgba(255,255,255,0.02);\n        color: #64748b;\n      }\n      \n      .form-field textarea {\n        resize: vertical;\n        min-height: 100px;\n      }\n      \n      .form-hint {\n        font-size: 12px;\n        color: #94a3b8;\n      }\n      \n      .form-actions {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        margin-top: 24px;\n        padding-top: 24px;\n        border-top: 1px solid rgba(0,0,0,0.06);\n      }\n      \n      [data-theme=\"dark\"] .form-actions {\n        border-top-color: rgba(255,255,255,0.06);\n      }\n      \n      .btn-sota {\n        padding: 12px 24px;\n        border-radius: 12px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      .btn-sota.primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\n      }\n      \n      .btn-sota.primary:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\n      }\n      \n      .btn-sota.secondary {\n        background: #f1f5f9;\n        color: #475569;\n      }\n      \n      [data-theme=\"dark\"] .btn-sota.secondary {\n        background: rgba(255,255,255,0.1);\n        color: #e2e8f0;\n      }\n      \n      .btn-sota.secondary:hover {\n        background: #e2e8f0;\n      }\n      \n      [data-theme=\"dark\"] .btn-sota.secondary:hover {\n        background: rgba(255,255,255,0.15);\n      }\n      \n      .btn-sota.danger {\n        background: transparent;\n        color: #dc2626;\n        border: 1px solid #fecaca;\n      }\n      \n      .btn-sota.danger:hover {\n        background: #fef2f2;\n        border-color: #dc2626;\n      }\n      \n      /* Security Section */\n      .security-section {\n        margin-bottom: 32px;\n      }\n      \n      .security-section h3 {\n        font-size: 16px;\n        font-weight: 600;\n        color: #1e293b;\n        margin: 0 0 16px 0;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      \n      [data-theme=\"dark\"] .security-section h3 {\n        color: #f1f5f9;\n      }\n      \n      .danger-zone {\n        background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);\n        border: 1px solid #fecaca;\n        border-radius: 16px;\n        padding: 24px;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone {\n        background: linear-gradient(135deg, rgba(220,38,38,0.1) 0%, rgba(220,38,38,0.05) 100%);\n        border-color: rgba(220,38,38,0.3);\n      }\n      \n      .danger-zone h3 {\n        color: #dc2626 !important;\n      }\n      \n      .danger-zone p {\n        color: #991b1b;\n        font-size: 14px;\n        margin: 0 0 16px 0;\n      }\n      \n      [data-theme=\"dark\"] .danger-zone p {\n        color: #fca5a5;\n      }\n      \n      /* Sessions */\n      .sessions-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      \n      .session-card {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 16px 20px;\n        background: #f8fafc;\n        border-radius: 12px;\n        border: 1px solid transparent;\n      }\n      \n      [data-theme=\"dark\"] .session-card {\n        background: rgba(255,255,255,0.03);\n      }\n      \n      .session-card.current {\n        border-color: #e11d48;\n        background: linear-gradient(135deg, rgba(225,29,72,0.05) 0%, rgba(225,29,72,0.02) 100%);\n      }\n      \n      .session-info {\n        display: flex;\n        align-items: center;\n        gap: 16px;\n      }\n      \n      .session-icon {\n        width: 44px;\n        height: 44px;\n        background: #e2e8f0;\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      \n      [data-theme=\"dark\"] .session-icon {\n        background: rgba(255,255,255,0.1);\n      }\n      \n      .session-icon svg {\n        width: 22px;\n        height: 22px;\n        color: #64748b;\n      }\n      \n      .session-details h4 {\n        margin: 0 0 4px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #1e293b;\n      }\n      \n      [data-theme=\"dark\"] .session-details h4 {\n        color: #f1f5f9;\n      }\n      \n      .session-details p {\n        margin: 0;\n        font-size: 12px;\n        color: #64748b;\n      }\n      \n      .session-badge {\n        font-size: 11px;\n        font-weight: 600;\n        padding: 4px 10px;\n        border-radius: 20px;\n        background: #e11d48;\n        color: white;\n      }\n      \n      .empty-state {\n        text-align: center;\n        padding: 48px 24px;\n        color: #94a3b8;\n      }\n      \n      .empty-state svg {\n        width: 48px;\n        height: 48px;\n        margin-bottom: 16px;\n        opacity: 0.5;\n      }\n      \n      .loading-spinner {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 48px;\n      }\n      \n      .loading-spinner::after {\n        content: '';\n        width: 32px;\n        height: 32px;\n        border: 3px solid #e2e8f0;\n        border-top-color: #e11d48;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n      }\n      \n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n    </style>\n    \n    <div class=\"profile-card\">\n      <div class=\"loading-spinner\"></div>\n    </div>\n  `;\n\n  return container;\n}\n\n/**\n * Load profile data\n * @param bindOptions - When onBack is set (page mode), close button calls it instead of closeModal\n */\nasync function loadProfile(container: HTMLElement, bindOptions?: { onBack?: () => void }): Promise<void> {\n  const card = container.querySelector('.profile-card') as HTMLElement;\n  if (!card) return;\n\n  try {\n    // Load profile and timezones in parallel\n    const [apiProfile, timezones] = await Promise.all([\n      profileService.get(),\n      loadTimezones()\n    ]);\n    \n    if (apiProfile) {\n      currentProfile = apiProfile;\n      renderProfile(card, currentProfile, timezones, bindOptions);\n    } else {\n      // Fallback to current user from store\n      const currentUser = appStore.getState().currentUser;\n      if (currentUser) {\n        currentProfile = {\n          id: currentUser.id,\n          email: currentUser.email,\n          display_name: currentUser.name || currentUser.email?.split('@')[0] || 'User',\n          avatar_url: currentUser.avatar,\n          created_at: new Date().toISOString(),\n        };\n        renderProfile(card, currentProfile, timezones, bindOptions);\n      } else {\n        card.innerHTML = '<div class=\"empty-state\">Please log in to view your profile</div>';\n      }\n    }\n  } catch {\n    // Fallback to current user\n    const currentUser = appStore.getState().currentUser;\n    if (currentUser) {\n      currentProfile = {\n        id: currentUser.id,\n        email: currentUser.email,\n        display_name: currentUser.name || 'User',\n        avatar_url: currentUser.avatar,\n        created_at: new Date().toISOString(),\n      };\n      renderProfile(card, currentProfile, undefined, bindOptions);\n    } else {\n      card.innerHTML = '<div class=\"empty-state\">Failed to load profile</div>';\n    }\n  }\n}\n\n/**\n * Render profile\n */\nfunction renderProfile(container: HTMLElement, profile: UserProfile, timezones?: Timezone[], bindOptions?: { onBack?: () => void }): void {\n  const initials = getInitials(profile.display_name || profile.email);\n  const currentUser = appStore.getState().currentUser;\n  const role = currentUser?.role || profile.role || 'user';\n  \n  container.innerHTML = `\n    <!-- Header -->\n    <div class=\"profile-header\">\n      <button class=\"profile-close-btn\" id=\"close-profile-btn\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n        </svg>\n      </button>\n      \n      <div class=\"profile-header-content\">\n        <label class=\"profile-avatar-large\" for=\"avatar-input-hidden\" id=\"profile-avatar-display\">\n          <img src=\"${profile.avatar_url || generateFallbackAvatar(profile.display_name || profile.email)}\" alt=\"Avatar\" onerror=\"this.src='${generateFallbackAvatar(profile.display_name || profile.email)}'\">\n          <div class=\"avatar-overlay\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n            </svg>\n          </div>\n          <input type=\"file\" id=\"avatar-input-hidden\" accept=\"image/*\" hidden>\n        </label>\n        \n        <div class=\"profile-user-info\">\n          <h2>${escapeHtml(profile.display_name || profile.username || 'User')}</h2>\n          <div class=\"email\">\n            ${escapeHtml(profile.email)}\n            <span class=\"role-badge\">\n              <svg width=\"12\" height=\"12\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                ${role === 'superadmin' \n                  ? '<path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clip-rule=\"evenodd\"/>'\n                  : '<path fill-rule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clip-rule=\"evenodd\"/>'\n                }\n              </svg>\n              ${role === 'superadmin' ? 'Super Admin' : 'User'}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Tabs Navigation -->\n    <nav class=\"profile-tabs-nav\">\n      <button class=\"profile-tab-btn active\" data-tab=\"general\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n        </svg>\n        General\n      </button>\n      <button class=\"profile-tab-btn\" data-tab=\"security\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\"/>\n        </svg>\n        Security\n      </button>\n      <button class=\"profile-tab-btn\" data-tab=\"sessions\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n        </svg>\n        Sessions\n      </button>\n      <button class=\"profile-tab-btn\" data-tab=\"integrations\">\n        <svg class=\"profile-tab-icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"/>\n        </svg>\n        Integrations\n      </button>\n    </nav>\n    \n    <!-- Tab Content -->\n    <div class=\"profile-body\">\n      <!-- General Tab -->\n      <div class=\"profile-section active\" id=\"section-general\">\n        <form id=\"profile-form\">\n          <div class=\"form-grid\">\n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n                </svg>\n                Email\n              </label>\n              <input type=\"email\" value=\"${escapeHtml(profile.email)}\" disabled>\n              <span class=\"form-hint\">Email cannot be changed</span>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207\"/>\n                </svg>\n                Username\n              </label>\n              <input type=\"text\" name=\"username\" value=\"${escapeHtml(profile.username || '')}\" placeholder=\"Enter username\">\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                </svg>\n                Display Name\n              </label>\n              <input type=\"text\" name=\"display_name\" value=\"${escapeHtml(profile.display_name || '')}\" placeholder=\"Your display name\">\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h7\"/>\n                </svg>\n                Bio\n              </label>\n              <textarea name=\"bio\" placeholder=\"Tell us a bit about yourself\">${escapeHtml(profile.bio || '')}</textarea>\n            </div>\n            \n            <div class=\"form-field full-width\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"/>\n                </svg>\n                Avatar URL\n              </label>\n              <input type=\"url\" name=\"avatar_url\" id=\"avatar-url-input\" value=\"${escapeHtml(profile.avatar_url || '')}\" placeholder=\"https://example.com/avatar.jpg\">\n              <span class=\"form-hint\">Enter an image URL or upload using the avatar above. Leave empty for auto-generated avatar.</span>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                </svg>\n                Timezone\n              </label>\n              <select name=\"timezone\">\n                ${generateTimezoneOptions(profile.timezone, timezones)}\n              </select>\n            </div>\n            \n            <div class=\"form-field\">\n              <label>\n                <svg width=\"14\" height=\"14\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129\"/>\n                </svg>\n                Language\n              </label>\n              <select name=\"locale\">\n                <option value=\"en\" ${profile.locale === 'en' ? 'selected' : ''}>English</option>\n                <option value=\"pt\" ${profile.locale === 'pt' ? 'selected' : ''}>Portugus</option>\n                <option value=\"es\" ${profile.locale === 'es' ? 'selected' : ''}>Espaol</option>\n                <option value=\"fr\" ${profile.locale === 'fr' ? 'selected' : ''}>Franais</option>\n              </select>\n            </div>\n          </div>\n          \n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-sota primary\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n              </svg>\n              Save Changes\n            </button>\n          </div>\n        </form>\n      </div>\n      \n      <!-- Security Tab -->\n      <div class=\"profile-section\" id=\"section-security\">\n        <div class=\"security-section\">\n          <h3>\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z\"/>\n            </svg>\n            Change Password\n          </h3>\n          \n          <form id=\"password-form\">\n            <div class=\"form-grid\">\n              <div class=\"form-field full-width\">\n                <label>Current Password</label>\n                <input type=\"password\" name=\"current_password\" required>\n              </div>\n              \n              <div class=\"form-field\">\n                <label>New Password</label>\n                <input type=\"password\" name=\"new_password\" minlength=\"12\" required>\n                <span class=\"form-hint\">Minimum 12 characters</span>\n              </div>\n              \n              <div class=\"form-field\">\n                <label>Confirm Password</label>\n                <input type=\"password\" name=\"confirm_password\" required>\n              </div>\n            </div>\n            \n            <div class=\"form-actions\">\n              <button type=\"submit\" class=\"btn-sota primary\">Update Password</button>\n            </div>\n          </form>\n        </div>\n        \n        <div class=\"danger-zone\">\n          <h3>\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n            </svg>\n            Danger Zone\n          </h3>\n          <p>Permanently delete your account and all associated data. This action cannot be undone.</p>\n          <button type=\"button\" class=\"btn-sota danger\" id=\"delete-account-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"/>\n            </svg>\n            Delete Account\n          </button>\n        </div>\n      </div>\n      \n      <!-- Sessions Tab -->\n      <div class=\"profile-section\" id=\"section-sessions\">\n        <div id=\"sessions-list\" class=\"sessions-list\">\n          <div class=\"loading-spinner\"></div>\n        </div>\n        \n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"revoke-all-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\"/>\n            </svg>\n            Sign out all other sessions\n          </button>\n        </div>\n      </div>\n      \n      <!-- Integrations Tab -->\n      <div class=\"profile-section\" id=\"section-integrations\">\n        <div class=\"security-section\">\n          <h3>\n            <svg width=\"18\" height=\"18\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"/>\n            </svg>\n            Krisp AI Meeting Assistant\n          </h3>\n          <p class=\"form-hint form-hint-mb\">\n            Connect your Krisp account to automatically import meeting transcriptions into GodMode.\n          </p>\n          \n          <div id=\"krisp-integration-content\">\n            <div class=\"loading-spinner\"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n\n  bindEvents(container, bindOptions);\n}\n\n/**\n * Bind event handlers\n * @param container - Root profile view container\n * @param options - When onBack is set (page mode), close button calls it instead of closeModal\n */\nfunction bindEvents(container: HTMLElement, options?: { onBack?: () => void }): void {\n  // Close button\n  const closeBtn = container.querySelector('#close-profile-btn');\n  if (closeBtn) {\n    on(closeBtn as HTMLElement, 'click', () => {\n      if (options?.onBack) {\n        options.onBack();\n      } else {\n        closeModal(MODAL_ID);\n        currentProps.onClose?.();\n      }\n    });\n  }\n\n  // Tab switching\n  const tabs = container.querySelectorAll('.profile-tab-btn');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n\n      const tabId = tab.getAttribute('data-tab');\n      container.querySelectorAll('.profile-section').forEach(section => {\n        section.classList.toggle('active', section.id === `section-${tabId}`);\n      });\n\n      if (tabId === 'sessions') {\n        loadSessions();\n      }\n      if (tabId === 'integrations') {\n        loadKrispIntegration(container);\n      }\n    });\n  });\n\n  // Avatar upload\n  const avatarInput = container.querySelector('#avatar-input-hidden') as HTMLInputElement;\n  if (avatarInput) {\n    on(avatarInput, 'change', async () => {\n      const file = avatarInput.files?.[0];\n      if (file) {\n        try {\n          const avatarUrl = await profileService.uploadAvatar(file);\n          const avatarEl = container.querySelector('.profile-avatar-large') as HTMLElement;\n          if (avatarEl) {\n            const img = avatarEl.querySelector('img');\n            if (img) {\n              img.src = avatarUrl;\n            } else {\n              avatarEl.innerHTML = `\n                <img src=\"${avatarUrl}\" alt=\"Avatar\">\n                <div class=\"avatar-overlay\">\n                  <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\"/>\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                  </svg>\n                </div>\n                <input type=\"file\" id=\"avatar-input-hidden\" accept=\"image/*\" hidden>\n              `;\n            }\n          }\n          toast.success('Avatar updated');\n        } catch {\n          toast.error('Failed to upload avatar');\n        }\n      }\n    });\n  }\n\n  // Avatar URL input - live preview\n  const avatarUrlInput = container.querySelector('#avatar-url-input') as HTMLInputElement;\n  const avatarDisplay = container.querySelector('#profile-avatar-display img') as HTMLImageElement;\n  if (avatarUrlInput && avatarDisplay) {\n    on(avatarUrlInput, 'input', () => {\n      const url = avatarUrlInput.value.trim();\n      if (url) {\n        avatarDisplay.src = url;\n      } else if (currentProfile) {\n        // Use fallback if empty\n        avatarDisplay.src = generateFallbackAvatar(currentProfile.display_name || currentProfile.email);\n      }\n    });\n  }\n\n  // Profile form submit\n  const profileForm = container.querySelector('#profile-form') as HTMLFormElement;\n  if (profileForm) {\n    on(profileForm, 'submit', async (e) => {\n      e.preventDefault();\n      const formData = new FormData(profileForm);\n      const avatarUrl = (formData.get('avatar_url') as string)?.trim();\n      const displayName = formData.get('display_name') as string || undefined;\n      \n      const data = {\n        username: formData.get('username') as string || undefined,\n        display_name: displayName,\n        bio: formData.get('bio') as string || undefined,\n        timezone: formData.get('timezone') as string || undefined,\n        locale: formData.get('locale') as string || undefined,\n        avatar_url: avatarUrl || (displayName ? generateFallbackAvatar(displayName) : undefined),\n      };\n\n      try {\n        const updated = await profileService.update(data);\n        currentProfile = updated;\n        toast.success('Profile updated');\n        currentProps.onUpdate?.(updated);\n        \n        // Update the avatar display\n        if (avatarDisplay) {\n          avatarDisplay.src = updated.avatar_url || generateFallbackAvatar(updated.display_name || updated.email);\n        }\n      } catch {\n        toast.error('Failed to update profile');\n      }\n    });\n  }\n\n  // Password form submit\n  const passwordForm = container.querySelector('#password-form') as HTMLFormElement;\n  if (passwordForm) {\n    on(passwordForm, 'submit', async (e) => {\n      e.preventDefault();\n      const formData = new FormData(passwordForm);\n      const currentPassword = formData.get('current_password') as string;\n      const newPassword = formData.get('new_password') as string;\n      const confirmPassword = formData.get('confirm_password') as string;\n\n      if (newPassword !== confirmPassword) {\n        toast.error('Passwords do not match');\n        return;\n      }\n\n      try {\n        await profileService.changePassword({\n          current_password: currentPassword,\n          new_password: newPassword,\n        });\n        toast.success('Password changed');\n        passwordForm.reset();\n      } catch (error) {\n        toast.error(error instanceof Error ? error.message : 'Failed to change password');\n      }\n    });\n  }\n\n  // Delete account\n  const deleteAccountBtn = container.querySelector('#delete-account-btn');\n  if (deleteAccountBtn) {\n    on(deleteAccountBtn as HTMLElement, 'click', async () => {\n      const password = prompt('Enter your password to confirm account deletion:');\n      if (!password) return;\n\n      if (!confirm('Are you sure? This action cannot be undone.')) return;\n\n      try {\n        await profileService.deleteAccount(password);\n        closeModal(MODAL_ID);\n        toast.success('Account deleted');\n        window.location.reload();\n      } catch {\n        toast.error('Failed to delete account');\n      }\n    });\n  }\n\n  // Revoke all sessions\n  const revokeAllBtn = container.querySelector('#revoke-all-btn');\n  if (revokeAllBtn) {\n    on(revokeAllBtn as HTMLElement, 'click', async () => {\n      if (!confirm('Sign out from all other devices?')) return;\n\n      try {\n        await profileService.revokeAllSessions();\n        toast.success('All other sessions signed out');\n        loadSessions();\n      } catch {\n        toast.error('Failed to revoke sessions');\n      }\n    });\n  }\n}\n\n/**\n * Load sessions\n */\nasync function loadSessions(): Promise<void> {\n  const container = document.querySelector('#sessions-list');\n  if (!container) return;\n\n  try {\n    const sessions = await profileService.getSessions();\n\n    if (!sessions || sessions.length === 0) {\n      container.innerHTML = `\n        <div class=\"empty-state\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n          </svg>\n          <p>No active sessions found</p>\n        </div>\n      `;\n      return;\n    }\n\n    container.innerHTML = sessions.map(session => `\n      <div class=\"session-card ${session.is_current ? 'current' : ''}\">\n        <div class=\"session-info\">\n          <div class=\"session-icon\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              ${session.device?.toLowerCase().includes('mobile') \n                ? '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z\"/>'\n                : '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>'\n              }\n            </svg>\n          </div>\n          <div class=\"session-details\">\n            <h4>${escapeHtml(session.device || 'Unknown device')}</h4>\n            <p>${session.location ? `${escapeHtml(session.location)}  ` : ''}${escapeHtml(session.ip_address || 'Unknown IP')}  Last active: ${formatDate(session.last_active)}</p>\n          </div>\n        </div>\n        ${session.is_current \n          ? '<span class=\"session-badge\">Current</span>'\n          : `<button class=\"btn-sota secondary revoke-session-btn\" data-id=\"${session.id}\">Revoke</button>`\n        }\n      </div>\n    `).join('');\n\n    // Bind revoke buttons\n    container.querySelectorAll('.revoke-session-btn').forEach(btn => {\n      on(btn as HTMLElement, 'click', async () => {\n        const sessionId = btn.getAttribute('data-id');\n        if (!sessionId) return;\n\n        try {\n          await profileService.revokeSession(sessionId);\n          toast.success('Session revoked');\n          loadSessions();\n        } catch {\n          toast.error('Failed to revoke session');\n        }\n      });\n    });\n  } catch {\n    container.innerHTML = `\n      <div class=\"empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n        </svg>\n        <p>Session management requires authentication</p>\n      </div>\n    `;\n  }\n}\n\n/**\n * Helper functions\n */\nfunction getInitials(name: string): string {\n  return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\n}\n\n/**\n * Generate a fallback avatar URL using UI Avatars\n */\nfunction generateFallbackAvatar(name: string): string {\n  const encoded = encodeURIComponent(name || 'User');\n  return `https://ui-avatars.com/api/?name=${encoded}&background=e11d48&color=fff&size=200&font-size=0.4&bold=true`;\n}\n\n/**\n * Load timezones from API\n */\nasync function loadTimezones(): Promise<Timezone[]> {\n  if (cachedTimezones) {\n    return cachedTimezones;\n  }\n  \n  try {\n    const response = await http.get<{ timezones: Timezone[] }>('/api/timezones');\n    cachedTimezones = response.data.timezones;\n    return cachedTimezones;\n  } catch {\n    // Fallback to minimal list\n    return [\n      { code: 'UTC', name: 'Coordinated Universal Time', utc_offset: '+00:00' },\n      { code: 'Europe/Lisbon', name: 'Lisbon, Portugal', utc_offset: '+00:00' },\n      { code: 'Europe/London', name: 'London, United Kingdom', utc_offset: '+00:00' },\n    ];\n  }\n}\n\n/**\n * Generate timezone options HTML - uses cached timezones or fallback\n */\nfunction generateTimezoneOptions(selected?: string, timezones?: Timezone[]): string {\n  const tzList = timezones || cachedTimezones || [\n    { code: 'UTC', name: 'Coordinated Universal Time', utc_offset: '+00:00' },\n  ];\n\n  // Group by region for better UX\n  const grouped = tzList.reduce((acc, tz) => {\n    const region = tz.region || 'Other';\n    if (!acc[region]) acc[region] = [];\n    acc[region].push(tz);\n    return acc;\n  }, {} as Record<string, Timezone[]>);\n\n  // Sort regions\n  const regionOrder = ['Europe', 'Americas', 'Asia', 'Oceania', 'Africa', 'Atlantic', 'UTC', 'Other'];\n  const sortedRegions = Object.keys(grouped).sort((a, b) => {\n    const aIdx = regionOrder.indexOf(a);\n    const bIdx = regionOrder.indexOf(b);\n    return (aIdx === -1 ? 999 : aIdx) - (bIdx === -1 ? 999 : bIdx);\n  });\n\n  let html = '';\n  for (const region of sortedRegions) {\n    html += `<optgroup label=\"${region}\">`;\n    for (const tz of grouped[region]) {\n      const label = `${tz.name} (${tz.utc_offset})`;\n      html += `<option value=\"${tz.code}\" ${selected === tz.code ? 'selected' : ''}>${label}</option>`;\n    }\n    html += '</optgroup>';\n  }\n\n  return html;\n}\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  const now = new Date();\n  const diff = now.getTime() - date.getTime();\n  \n  if (diff < 60000) return 'Just now';\n  if (diff < 3600000) return `${Math.floor(diff / 60000)} min ago`;\n  if (diff < 86400000) return `${Math.floor(diff / 3600000)} hours ago`;\n  if (diff < 604800000) return `${Math.floor(diff / 86400000)} days ago`;\n  \n  return date.toLocaleDateString();\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Load Krisp integration content\n */\nasync function loadKrispIntegration(container: HTMLElement): Promise<void> {\n  const contentEl = container.querySelector('#krisp-integration-content');\n  if (!contentEl) return;\n\n  // Check if user is superadmin (has MCP access)\n  const currentUser = appStore.getState().currentUser;\n  const isSuperAdmin = currentUser?.role === 'superadmin';\n\n  try {\n    const webhook = await krispService.getWebhook();\n    const summary = await krispService.getTranscriptsSummary();\n\n    if (!webhook) {\n      contentEl.innerHTML = `\n        <div class=\"krisp-not-configured\">\n          <p>Krisp integration is not configured yet.</p>\n          <button type=\"button\" class=\"btn-sota primary\" id=\"enable-krisp-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\"/>\n            </svg>\n            Enable Krisp Integration\n          </button>\n        </div>\n      `;\n\n      const enableBtn = contentEl.querySelector('#enable-krisp-btn');\n      if (enableBtn) {\n        on(enableBtn as HTMLElement, 'click', async () => {\n          try {\n            await krispService.getWebhook(); // This creates the webhook if it doesn't exist\n            loadKrispIntegration(container);\n            toast.success('Krisp integration enabled');\n          } catch {\n            toast.error('Failed to enable Krisp integration');\n          }\n        });\n      }\n      return;\n    }\n\n    // Show webhook configuration\n    contentEl.innerHTML = `\n      <div class=\"krisp-config\">\n        ${isSuperAdmin ? `\n        <div class=\"krisp-mcp-banner\">\n          <div class=\"mcp-icon\">\n            <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\n            </svg>\n          </div>\n          <div class=\"mcp-info\">\n            <strong>MCP Direct Access</strong>\n            <span>As a Super Admin, you can import meetings directly via MCP without webhook configuration.</span>\n          </div>\n          <button type=\"button\" class=\"btn-sota primary\" id=\"mcp-import-btn\">\n            Import via MCP\n          </button>\n        </div>\n        ` : ''}\n        \n        <div class=\"krisp-status\">\n          <span class=\"status-indicator ${webhook.is_active ? 'active' : 'inactive'}\"></span>\n          <span>${webhook.is_active ? 'Active' : 'Inactive'}</span>\n          <button type=\"button\" class=\"btn-sota small ${webhook.is_active ? 'secondary' : 'primary'}\" id=\"toggle-krisp-btn\">\n            ${webhook.is_active ? 'Disable' : 'Enable'}\n          </button>\n        </div>\n\n        <div class=\"form-field\">\n          <label>Webhook URL</label>\n          <div class=\"input-with-copy\">\n            <input type=\"text\" value=\"${escapeHtml(webhook.webhook_url)}\" readonly>\n            <button type=\"button\" class=\"btn-copy\" data-copy=\"${escapeHtml(webhook.webhook_url)}\" title=\"Copy URL\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        <div class=\"form-field\">\n          <label>Authorization Token</label>\n          <div class=\"input-with-copy\">\n            <input type=\"password\" value=\"${escapeHtml(webhook.webhook_secret)}\" readonly id=\"krisp-secret-input\">\n            <button type=\"button\" class=\"btn-toggle-visibility\" id=\"toggle-secret-btn\" title=\"Show/Hide\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"/>\n              </svg>\n            </button>\n            <button type=\"button\" class=\"btn-copy\" data-copy=\"${escapeHtml(webhook.webhook_secret)}\" title=\"Copy Token\">\n              <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z\"/>\n              </svg>\n            </button>\n          </div>\n          <span class=\"form-hint\">Use this token in the Authorization header when configuring Krisp webhook.</span>\n        </div>\n\n        <div class=\"krisp-stats\">\n          <div class=\"stat\">\n            <span class=\"stat-value\">${summary?.total_count || 0}</span>\n            <span class=\"stat-label\">Total Transcripts</span>\n          </div>\n          <div class=\"stat\">\n            <span class=\"stat-value\">${summary?.processed_count || 0}</span>\n            <span class=\"stat-label\">Processed</span>\n          </div>\n          <div class=\"stat ${(summary?.quarantine_count || 0) + (summary?.ambiguous_count || 0) > 0 ? 'warning' : ''}\">\n            <span class=\"stat-value\">${(summary?.quarantine_count || 0) + (summary?.ambiguous_count || 0)}</span>\n            <span class=\"stat-label\">Need Attention</span>\n          </div>\n        </div>\n\n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"btn-sota secondary\" id=\"regenerate-krisp-btn\">\n            <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/>\n            </svg>\n            Regenerate Credentials\n          </button>\n          <a href=\"#\" class=\"btn-sota primary\" id=\"view-transcripts-btn\">\n            View Transcripts\n          </a>\n        </div>\n      </div>\n      \n      <style>\n        .krisp-config { padding: 16px 0; }\n        .krisp-status { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }\n        .status-indicator { width: 8px; height: 8px; border-radius: 50%; }\n        .status-indicator.active { background: #22c55e; }\n        .status-indicator.inactive { background: #94a3b8; }\n        .input-with-copy { display: flex; gap: 8px; }\n        .input-with-copy input { flex: 1; }\n        .btn-copy, .btn-toggle-visibility { padding: 8px; background: var(--bg-secondary, #f1f5f9); border: 1px solid var(--border-color, #e2e8f0); border-radius: 6px; cursor: pointer; }\n        .btn-copy:hover, .btn-toggle-visibility:hover { background: var(--bg-tertiary, #e2e8f0); }\n        .krisp-stats { display: flex; gap: 16px; margin: 24px 0; padding: 16px; background: var(--bg-secondary, #f8fafc); border-radius: 12px; }\n        .stat { flex: 1; text-align: center; }\n        .stat-value { display: block; font-size: 24px; font-weight: 600; color: var(--text-primary, #1e293b); }\n        .stat-label { font-size: 12px; color: var(--text-secondary, #64748b); }\n        .stat.warning .stat-value { color: #f59e0b; }\n        .btn-sota.small { padding: 4px 12px; font-size: 12px; }\n        .krisp-not-configured { text-align: center; padding: 32px; }\n        .krisp-not-configured p { margin-bottom: 16px; color: var(--text-secondary, #64748b); }\n        .krisp-mcp-banner {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 16px;\n          background: linear-gradient(135deg, #dbeafe 0%, #e0f2fe 100%);\n          border: 1px solid #93c5fd;\n          border-radius: 12px;\n          margin-bottom: 20px;\n        }\n        .mcp-icon {\n          width: 40px;\n          height: 40px;\n          background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);\n          border-radius: 10px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-shrink: 0;\n        }\n        .mcp-icon svg { color: white; }\n        .mcp-info {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          gap: 2px;\n        }\n        .mcp-info strong {\n          font-size: 14px;\n          color: #1e40af;\n        }\n        .mcp-info span {\n          font-size: 12px;\n          color: #3b82f6;\n        }\n        .krisp-mcp-banner .btn-sota {\n          flex-shrink: 0;\n        }\n        [data-theme=\"dark\"] .krisp-mcp-banner {\n          background: linear-gradient(135deg, rgba(59,130,246,0.15) 0%, rgba(29,78,216,0.1) 100%);\n          border-color: rgba(59,130,246,0.3);\n        }\n        [data-theme=\"dark\"] .mcp-info strong { color: #93c5fd; }\n        [data-theme=\"dark\"] .mcp-info span { color: #60a5fa; }\n        [data-theme=\"dark\"] .krisp-stats { background: rgba(30,41,59,0.5); }\n        [data-theme=\"dark\"] .btn-copy, [data-theme=\"dark\"] .btn-toggle-visibility { background: rgba(30,41,59,0.8); border-color: rgba(255,255,255,0.1); }\n      </style>\n    `;\n\n    // Bind copy buttons\n    contentEl.querySelectorAll('.btn-copy').forEach(btn => {\n      on(btn as HTMLElement, 'click', () => {\n        const text = btn.getAttribute('data-copy') || '';\n        navigator.clipboard.writeText(text);\n        toast.success('Copied to clipboard');\n      });\n    });\n\n    // Toggle secret visibility\n    const toggleSecretBtn = contentEl.querySelector('#toggle-secret-btn');\n    const secretInput = contentEl.querySelector('#krisp-secret-input') as HTMLInputElement;\n    if (toggleSecretBtn && secretInput) {\n      on(toggleSecretBtn as HTMLElement, 'click', () => {\n        secretInput.type = secretInput.type === 'password' ? 'text' : 'password';\n      });\n    }\n\n    // MCP Import button (superadmin only)\n    const mcpImportBtn = contentEl.querySelector('#mcp-import-btn');\n    if (mcpImportBtn) {\n      on(mcpImportBtn as HTMLElement, 'click', async () => {\n        closeModal(MODAL_ID);\n        // Open KrispManager directly on the Import tab\n        const { showKrispManager } = await import('./KrispManager');\n        showKrispManager('import');\n      });\n    }\n\n    // Toggle webhook\n    const toggleBtn = contentEl.querySelector('#toggle-krisp-btn');\n    if (toggleBtn) {\n      on(toggleBtn as HTMLElement, 'click', async () => {\n        const newState = !webhook.is_active;\n        const success = await krispService.toggleWebhook(newState);\n        if (success) {\n          toast.success(newState ? 'Krisp integration enabled' : 'Krisp integration disabled');\n          loadKrispIntegration(container);\n        } else {\n          toast.error('Failed to update integration');\n        }\n      });\n    }\n\n    // Regenerate credentials\n    const regenerateBtn = contentEl.querySelector('#regenerate-krisp-btn');\n    if (regenerateBtn) {\n      on(regenerateBtn as HTMLElement, 'click', async () => {\n        if (!confirm('Are you sure? You will need to update the webhook URL in Krisp.')) return;\n        \n        const newWebhook = await krispService.regenerateWebhook();\n        if (newWebhook) {\n          toast.success('Credentials regenerated');\n          loadKrispIntegration(container);\n        } else {\n          toast.error('Failed to regenerate credentials');\n        }\n      });\n    }\n\n    // View transcripts link\n    const viewTranscriptsBtn = contentEl.querySelector('#view-transcripts-btn');\n    if (viewTranscriptsBtn) {\n      on(viewTranscriptsBtn as HTMLElement, 'click', async (e) => {\n        e.preventDefault();\n        closeModal(MODAL_ID);\n        // Open KrispManager modal\n        const { showKrispManager } = await import('./KrispManager');\n        showKrispManager();\n      });\n    }\n\n  } catch (error) {\n    console.error('[ProfileModal] Krisp integration error:', error);\n    contentEl.innerHTML = `\n      <div class=\"error-message\">\n        <p>Failed to load Krisp integration. Please try again.</p>\n        <button type=\"button\" class=\"btn-sota secondary\" id=\"retry-krisp-btn\">Retry</button>\n      </div>\n    `;\n\n    const retryBtn = contentEl.querySelector('#retry-krisp-btn');\n    if (retryBtn) {\n      on(retryBtn as HTMLElement, 'click', () => loadKrispIntegration(container));\n    }\n  }\n}\n\nexport function closeProfileModal(): void {\n  closeModal(MODAL_ID);\n}\n\n/**\n * Create the profile view root element (same content as modal, no wrapper).\n * Used for embedding profile in a tab/page.\n */\nexport function createProfileView(): HTMLElement {\n  return createModalContent();\n}\n\n/**\n * Initialize profile as a full page inside the given container (no modal).\n * Use when showing Profile in a tab; close button will call onBack.\n */\nexport function initProfilePage(container: HTMLElement, options: { onBack?: () => void } = {}): void {\n  container.innerHTML = '';\n  const view = createModalContent();\n  container.appendChild(view);\n  loadProfile(view, { onBack: options.onBack });\n}\n","/**\r\n * Fact Modal\r\n * CRUD modal for facts\r\n */\r\n\r\nimport { createModal, openModal, closeModal } from '../Modal';\r\nimport { createElement, on } from '../../utils/dom';\r\nimport { factsService, Fact, CreateFactRequest } from '../../services/facts';\r\nimport { toast } from '../../services/toast';\r\n\r\nconst MODAL_ID = 'fact-modal';\r\n\r\nexport interface FactModalProps {\r\n  mode: 'view' | 'create' | 'edit';\r\n  fact?: Fact;\r\n  onSave?: (fact: Fact) => void;\r\n  onDelete?: (factId: string | number) => void;\r\n  onClose?: () => void;\r\n}\r\n\r\nlet currentProps: FactModalProps = { mode: 'create' };\r\n\r\n/**\r\n * Show fact modal\r\n */\r\nexport function showFactModal(props: FactModalProps): void {\r\n  currentProps = props;\r\n\r\n  const title = props.mode === 'create' \r\n    ? 'Add Fact' \r\n    : props.mode === 'edit' \r\n      ? 'Edit Fact' \r\n      : 'View Fact';\r\n\r\n  const modal = createModal({\r\n    id: MODAL_ID,\r\n    title,\r\n    size: 'md',\r\n    content: createModalContent(props),\r\n    onClose: props.onClose,\r\n  });\r\n\r\n  document.body.appendChild(modal);\r\n  openModal(MODAL_ID);\r\n}\r\n\r\n/**\r\n * Create modal content\r\n */\r\nfunction createModalContent(props: FactModalProps): HTMLElement {\r\n  const container = createElement('div', { className: 'fact-modal-content' });\r\n  const fact = props.fact;\r\n  const isViewMode = props.mode === 'view';\r\n\r\n  container.innerHTML = `\r\n    <form id=\"fact-form\" class=\"fact-form\">\r\n      <div class=\"form-group\">\r\n        <label for=\"content\">Fact Content *</label>\r\n        <textarea id=\"content\" name=\"content\" rows=\"4\" required \r\n                  ${isViewMode ? 'disabled' : ''}\r\n                  placeholder=\"Enter the fact...\">${escapeHtml(fact?.content || '')}</textarea>\r\n      </div>\r\n\r\n      <div class=\"form-row\">\r\n        <div class=\"form-group\">\r\n          <label for=\"source\">Source</label>\r\n          <input type=\"text\" id=\"source\" name=\"source\" \r\n                 ${isViewMode ? 'disabled' : ''}\r\n                 value=\"${escapeHtml(fact?.source || '')}\"\r\n                 placeholder=\"Document, conversation, etc.\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"category\">Category</label>\r\n          <input type=\"text\" id=\"category\" name=\"category\" \r\n                 ${isViewMode ? 'disabled' : ''}\r\n                 value=\"${escapeHtml(fact?.category || '')}\"\r\n                 placeholder=\"Technical, Business, etc.\">\r\n        </div>\r\n      </div>\r\n\r\n      ${fact?.verified ? `\r\n        <div class=\"verified-info\">\r\n          <span class=\"verified-badge\"> Verified</span>\r\n          ${fact.verified_by ? `<span>by ${escapeHtml(fact.verified_by)}</span>` : ''}\r\n          ${fact.verified_at ? `<span>on ${formatDate(fact.verified_at)}</span>` : ''}\r\n        </div>\r\n      ` : ''}\r\n\r\n      ${fact?.source_file ? `\r\n        <div class=\"source-file\">\r\n          <span class=\"label\">Source File:</span>\r\n          <span class=\"value\">${escapeHtml(fact.source_file)}</span>\r\n        </div>\r\n      ` : ''}\r\n\r\n      ${fact ? `\r\n        <div class=\"metadata\">\r\n          <span>Created: ${formatDate(fact.created_at)}</span>\r\n          ${fact.updated_at ? `<span>Updated: ${formatDate(fact.updated_at)}</span>` : ''}\r\n        </div>\r\n      ` : ''}\r\n\r\n      <div class=\"form-actions\">\r\n        ${props.mode === 'view' ? `\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"edit-btn\">Edit</button>\r\n          ${!fact?.verified ? `<button type=\"button\" class=\"btn btn-success\" id=\"verify-btn\">Verify</button>` : ''}\r\n          <button type=\"button\" class=\"btn btn-danger\" id=\"delete-btn\">Delete</button>\r\n        ` : `\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\r\n          <button type=\"submit\" class=\"btn btn-primary\">\r\n            ${props.mode === 'create' ? 'Add Fact' : 'Save Changes'}\r\n          </button>\r\n        `}\r\n      </div>\r\n    </form>\r\n  `;\r\n\r\n  bindEvents(container, props);\r\n  return container;\r\n}\r\n\r\n/**\r\n * Bind event handlers\r\n */\r\nfunction bindEvents(container: HTMLElement, props: FactModalProps): void {\r\n  const form = container.querySelector('#fact-form') as HTMLFormElement;\r\n\r\n  // Form submit\r\n  if (form) {\r\n    on(form, 'submit', async (e) => {\r\n      e.preventDefault();\r\n\r\n      const formData = new FormData(form);\r\n      const data: CreateFactRequest = {\r\n        content: formData.get('content') as string,\r\n        source: formData.get('source') as string || undefined,\r\n        category: formData.get('category') as string || undefined,\r\n      };\r\n\r\n      if (!data.content.trim()) {\r\n        toast.error('Fact content is required');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        let savedFact: Fact;\r\n\r\n        if (props.mode === 'create') {\r\n          savedFact = await factsService.create(data);\r\n          toast.success('Fact added');\r\n        } else {\r\n          savedFact = await factsService.update(props.fact!.id, data);\r\n          toast.success('Fact updated');\r\n        }\r\n\r\n        closeModal(MODAL_ID);\r\n        props.onSave?.(savedFact);\r\n      } catch {\r\n        toast.error('Failed to save fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Cancel button\r\n  const cancelBtn = container.querySelector('#cancel-btn');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n    });\r\n  }\r\n\r\n  // Edit button (in view mode)\r\n  const editBtn = container.querySelector('#edit-btn');\r\n  if (editBtn) {\r\n    on(editBtn as HTMLElement, 'click', () => {\r\n      closeModal(MODAL_ID);\r\n      showFactModal({\r\n        ...props,\r\n        mode: 'edit',\r\n      });\r\n    });\r\n  }\r\n\r\n  // Verify button\r\n  const verifyBtn = container.querySelector('#verify-btn');\r\n  if (verifyBtn && props.fact) {\r\n    on(verifyBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        const verifiedFact = await factsService.verify(props.fact!.id);\r\n        toast.success('Fact verified');\r\n        closeModal(MODAL_ID);\r\n        props.onSave?.(verifiedFact);\r\n      } catch {\r\n        toast.error('Failed to verify fact');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete button\r\n  const deleteBtn = container.querySelector('#delete-btn');\r\n  if (deleteBtn && props.fact) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm('Are you sure you want to delete this fact?')) return;\r\n\r\n      try {\r\n        await factsService.delete(props.fact!.id);\r\n        toast.success('Fact deleted');\r\n        closeModal(MODAL_ID);\r\n        props.onDelete?.(props.fact!.id);\r\n      } catch {\r\n        toast.error('Failed to delete fact');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Format date\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString();\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport function closeFactModal(): void {\r\n  closeModal(MODAL_ID);\r\n}\r\n","/**\r\n * Conversation Preview Modal - SOTA\r\n * Full conversation preview with AI extraction results, entities, notes\r\n */\r\n\r\nimport { http } from '../../services/api';\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nexport interface Conversation {\r\n  id: string;\r\n  title: string;\r\n  conversation_type: string;\r\n  participants: string[];\r\n  messages: Array<{ speaker: string; text: string; timestamp?: string }>;\r\n  metadata?: {\r\n    extraction_result?: ExtractionResult;\r\n    extractedEntities?: Entity[];\r\n    extractedRelationships?: Relationship[];\r\n    aiProcessedAt?: string;\r\n  };\r\n  summary?: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface Entity {\r\n  id: string;\r\n  type: string;\r\n  name: string;\r\n  properties?: Record<string, unknown>;\r\n  confidence?: number;\r\n}\r\n\r\ninterface Relationship {\r\n  id: string;\r\n  from_id: string;\r\n  to_id: string;\r\n  relation: string;\r\n}\r\n\r\ninterface ExtractionResult {\r\n  summary?: string;\r\n  entities?: Entity[];\r\n  relationships?: Relationship[];\r\n  facts?: Array<{ id: string; content: string; category?: string; confidence?: number }>;\r\n  decisions?: Array<{ id: string; content: string; owner_id?: string; confidence?: number }>;\r\n  action_items?: Array<{ id: string; task: string; owner?: string; status?: string }>;\r\n  questions?: Array<{ id: string; content: string }>;\r\n  notes_rendered_text?: string;\r\n  notes?: {\r\n    key_points?: Array<{ text: string }>;\r\n    outline?: Array<{ topic: string; bullets: Array<{ text: string }> }>;\r\n  };\r\n}\r\n\r\nlet currentTab = 'messages';\r\n\r\n/**\r\n * Show conversation preview modal\r\n */\r\nexport function showConversationPreviewModal(conversation: Conversation, onClose?: () => void): void {\r\n  const existing = document.querySelector('.conversation-preview-overlay');\r\n  if (existing) existing.remove();\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'conversation-preview-modal';\r\n  content.innerHTML = `\r\n    <style>\r\n      .conversation-preview-modal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 80vh;\r\n        max-height: 800px;\r\n        width: 900px;\r\n        max-width: 95vw;\r\n      }\r\n      .conv-preview-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n      }\r\n      .conv-preview-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n      }\r\n      .conv-preview-title {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin: 0 0 4px 0;\r\n      }\r\n      .conv-preview-meta {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        display: flex;\r\n        gap: 16px;\r\n      }\r\n      .conv-preview-tabs {\r\n        display: flex;\r\n        gap: 4px;\r\n        padding: 0 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      .conv-preview-tab {\r\n        padding: 12px 16px;\r\n        background: none;\r\n        border: none;\r\n        border-bottom: 2px solid transparent;\r\n        color: var(--text-secondary);\r\n        cursor: pointer;\r\n        font-size: 14px;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .conv-preview-tab:hover {\r\n        color: var(--text-primary);\r\n      }\r\n      .conv-preview-tab.active {\r\n        color: var(--primary);\r\n        border-bottom-color: var(--primary);\r\n      }\r\n      .conv-preview-tab-badge {\r\n        background: var(--bg-tertiary);\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        font-size: 11px;\r\n        margin-left: 6px;\r\n      }\r\n      .conv-preview-body {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 20px 24px;\r\n      }\r\n      .conv-preview-section {\r\n        display: none;\r\n      }\r\n      .conv-preview-section.active {\r\n        display: block;\r\n      }\r\n      .messages-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      .message-item {\r\n        padding: 12px 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n      }\r\n      .message-speaker {\r\n        font-weight: 600;\r\n        color: var(--primary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .message-text {\r\n        color: var(--text-primary);\r\n        line-height: 1.5;\r\n      }\r\n      .message-time {\r\n        font-size: 11px;\r\n        color: var(--text-tertiary);\r\n        margin-top: 4px;\r\n      }\r\n      .entity-card {\r\n        padding: 12px 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .entity-type {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .entity-content {\r\n        color: var(--text-primary);\r\n      }\r\n      .entity-meta {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n        margin-top: 4px;\r\n      }\r\n      .section-title {\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 12px;\r\n        text-transform: uppercase;\r\n      }\r\n      .empty-section {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      .notes-rendered {\r\n        padding: 20px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 12px;\r\n        line-height: 1.7;\r\n      }\r\n      .notes-header {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin-bottom: 4px;\r\n      }\r\n      .notes-meta {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 20px;\r\n        padding-bottom: 16px;\r\n        border-bottom: 1px solid var(--border-color);\r\n      }\r\n      .notes-topic {\r\n        margin-bottom: 20px;\r\n      }\r\n      .notes-topic-title {\r\n        font-size: 15px;\r\n        font-weight: 600;\r\n        margin-bottom: 10px;\r\n        padding-left: 8px;\r\n        border-left: 3px solid var(--primary);\r\n      }\r\n      .notes-bullet {\r\n        padding: 10px 12px;\r\n        background: var(--bg-primary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n        font-size: 14px;\r\n        line-height: 1.6;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"conv-preview-header\">\r\n      <div class=\"conv-preview-icon\"></div>\r\n      <div class=\"conv-preview-header-fill\">\r\n        <h2 class=\"conv-preview-title\">${escapeHtml(conversation.title || 'Untitled Conversation')}</h2>\r\n        <div class=\"conv-preview-meta\">\r\n          <span>${conversation.participants?.length || 0} participants</span>\r\n          <span>${conversation.messages?.length || 0} messages</span>\r\n          <span>${formatRelativeTime(conversation.created_at)}</span>\r\n        </div>\r\n      </div>\r\n      <button class=\"btn btn-sm conv-preview-close-btn\"></button>\r\n    </div>\r\n    \r\n    <div class=\"conv-preview-tabs\">\r\n      <button class=\"conv-preview-tab active\" data-tab=\"messages\">Messages</button>\r\n      <button class=\"conv-preview-tab\" data-tab=\"entities\">\r\n        Entities\r\n        <span class=\"conv-preview-tab-badge\" id=\"entities-count\">0</span>\r\n      </button>\r\n      <button class=\"conv-preview-tab\" data-tab=\"extraction\">\r\n        Extraction\r\n        <span class=\"conv-preview-tab-badge\" id=\"extraction-count\">0</span>\r\n      </button>\r\n      <button class=\"conv-preview-tab hidden\" data-tab=\"notes\" id=\"notes-tab\">\r\n        Notes\r\n      </button>\r\n    </div>\r\n    \r\n    <div class=\"conv-preview-body\">\r\n      <div class=\"conv-preview-section active\" data-section=\"messages\" id=\"messages-container\">\r\n        <div class=\"messages-list\">\r\n          ${(conversation.messages || []).map(m => `\r\n            <div class=\"message-item\">\r\n              <div class=\"message-speaker\">${escapeHtml(m.speaker || 'Unknown')}</div>\r\n              <div class=\"message-text\">${escapeHtml(m.text || '')}</div>\r\n              ${m.timestamp ? `<div class=\"message-time\">${m.timestamp}</div>` : ''}\r\n            </div>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"conv-preview-section\" data-section=\"entities\" id=\"entities-container\">\r\n        <div class=\"empty-section\">Loading entities...</div>\r\n      </div>\r\n      \r\n      <div class=\"conv-preview-section\" data-section=\"extraction\" id=\"extraction-container\">\r\n        <div class=\"empty-section\">Loading extraction results...</div>\r\n      </div>\r\n      \r\n      <div class=\"conv-preview-section\" data-section=\"notes\" id=\"notes-container\">\r\n        <div class=\"empty-section\">No notes available</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Tab switching\r\n  content.querySelectorAll('.conv-preview-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      const tabName = (tab as HTMLElement).dataset.tab;\r\n      content.querySelectorAll('.conv-preview-tab').forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      content.querySelectorAll('.conv-preview-section').forEach(s => s.classList.remove('active'));\r\n      content.querySelector(`[data-section=\"${tabName}\"]`)?.classList.add('active');\r\n    });\r\n  });\r\n\r\n  // Close button\r\n  content.querySelector('.close-btn')?.addEventListener('click', () => {\r\n    overlay.remove();\r\n    onClose?.();\r\n  });\r\n\r\n  // Load extraction data\r\n  loadExtractionData(content, conversation);\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'modal-overlay overlay-preview conversation-preview-overlay';\r\n\r\n  const modal = document.createElement('div');\r\n  modal.className = 'modal-preview-box';\r\n  modal.appendChild(content);\r\n  overlay.appendChild(modal);\r\n\r\n  // Close on backdrop click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      overlay.remove();\r\n      onClose?.();\r\n    }\r\n  });\r\n\r\n  // Close on escape\r\n  const handleEsc = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      overlay.remove();\r\n      onClose?.();\r\n      document.removeEventListener('keydown', handleEsc);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', handleEsc);\r\n\r\n  document.body.appendChild(overlay);\r\n}\r\n\r\n/**\r\n * Load extraction data from conversation metadata\r\n */\r\nfunction loadExtractionData(container: HTMLElement, conversation: Conversation): void {\r\n  const meta = conversation.metadata;\r\n  const extraction = meta?.extraction_result;\r\n  \r\n  // Update entities tab\r\n  const entities = meta?.extractedEntities || extraction?.entities || [];\r\n  const entitiesContainer = container.querySelector('#entities-container') as HTMLElement;\r\n  const entitiesCount = container.querySelector('#entities-count') as HTMLElement;\r\n  \r\n  if (entitiesCount) entitiesCount.textContent = String(entities.length);\r\n  \r\n  if (entities.length > 0) {\r\n    entitiesContainer.innerHTML = entities.map(e => `\r\n      <div class=\"entity-card\">\r\n        <div class=\"entity-type\">${escapeHtml(e.type)}</div>\r\n        <div class=\"entity-content\">${escapeHtml(e.name)}</div>\r\n        ${e.confidence ? `<div class=\"entity-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\r\n      </div>\r\n    `).join('');\r\n  } else {\r\n    entitiesContainer.innerHTML = '<div class=\"empty-section\">No entities extracted</div>';\r\n  }\r\n  \r\n  // Update extraction tab\r\n  const extractionContainer = container.querySelector('#extraction-container') as HTMLElement;\r\n  const facts = extraction?.facts || [];\r\n  const decisions = extraction?.decisions || [];\r\n  const actions = extraction?.action_items || [];\r\n  const questions = extraction?.questions || [];\r\n  \r\n  const extractionCount = container.querySelector('#extraction-count') as HTMLElement;\r\n  const totalItems = facts.length + decisions.length + actions.length + questions.length;\r\n  if (extractionCount) extractionCount.textContent = String(totalItems);\r\n  \r\n  if (totalItems > 0) {\r\n    let html = '';\r\n    \r\n    if (facts.length > 0) {\r\n      html += `<div class=\"section-title\">Facts (${facts.length})</div>`;\r\n      html += facts.map(f => `\r\n        <div class=\"entity-card\">\r\n          <div class=\"entity-type\">${f.category || 'fact'}</div>\r\n          <div class=\"entity-content\">${escapeHtml(f.content)}</div>\r\n        </div>\r\n      `).join('');\r\n    }\r\n    \r\n    if (decisions.length > 0) {\r\n      html += `<div class=\"section-title section-title-mt\">Decisions (${decisions.length})</div>`;\r\n      html += decisions.map(d => `\r\n        <div class=\"entity-card\">\r\n          <div class=\"entity-content\">${escapeHtml(d.content)}</div>\r\n        </div>\r\n      `).join('');\r\n    }\r\n    \r\n    if (actions.length > 0) {\r\n      html += `<div class=\"section-title section-title-mt\">Action Items (${actions.length})</div>`;\r\n      html += actions.map(a => `\r\n        <div class=\"entity-card\">\r\n          <div class=\"entity-content\">${escapeHtml(a.task)}</div>\r\n          ${a.owner ? `<div class=\"entity-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\r\n        </div>\r\n      `).join('');\r\n    }\r\n    \r\n    if (questions.length > 0) {\r\n      html += `<div class=\"section-title section-title-mt\">Questions (${questions.length})</div>`;\r\n      html += questions.map(q => `\r\n        <div class=\"entity-card\">\r\n          <div class=\"entity-content\">${escapeHtml(q.content)}</div>\r\n        </div>\r\n      `).join('');\r\n    }\r\n    \r\n    extractionContainer.innerHTML = html;\r\n  } else {\r\n    extractionContainer.innerHTML = '<div class=\"empty-section\">No extraction results available</div>';\r\n  }\r\n  \r\n  // Update notes tab\r\n  const notesContainer = container.querySelector('#notes-container') as HTMLElement;\r\n  const notesTab = container.querySelector('#notes-tab') as HTMLElement;\r\n  const notesText = extraction?.notes_rendered_text;\r\n  \r\n  if (notesText) {\r\n    if (notesTab) notesTab.classList.remove('hidden');\r\n    notesContainer.innerHTML = `\r\n      <div class=\"notes-rendered\">\r\n        ${renderNotesAsHtml(notesText)}\r\n        <div class=\"conv-notes-actions-mt\">\r\n          <button class=\"btn btn-secondary btn-sm\" id=\"copy-notes-btn\"> Copy Notes</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    container.querySelector('#copy-notes-btn')?.addEventListener('click', () => {\r\n      navigator.clipboard.writeText(notesText);\r\n      toast.success('Notes copied to clipboard');\r\n    });\r\n  } else if (extraction?.notes?.outline?.length) {\r\n    if (notesTab) notesTab.classList.remove('hidden');\r\n    const outline = extraction.notes.outline;\r\n    notesContainer.innerHTML = `\r\n      <div class=\"notes-rendered\">\r\n        ${outline.map(t => `\r\n          <div class=\"notes-topic\">\r\n            <div class=\"notes-topic-title\">${escapeHtml(t.topic)}</div>\r\n            ${t.bullets?.map(b => `<div class=\"notes-bullet\">${escapeHtml(b.text)}</div>`).join('') || ''}\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n\r\n/**\r\n * Render notes text as HTML\r\n */\r\nfunction renderNotesAsHtml(text: string): string {\r\n  const lines = text.split('\\n');\r\n  let html = '';\r\n  let currentTopic = '';\r\n  let bulletsHtml = '';\r\n  let headerDone = false;\r\n  let metaDone = false;\r\n  \r\n  const flushTopic = () => {\r\n    if (currentTopic && bulletsHtml) {\r\n      html += `\r\n        <div class=\"notes-topic\">\r\n          <div class=\"notes-topic-title\">${escapeHtml(currentTopic)}</div>\r\n          ${bulletsHtml}\r\n        </div>\r\n      `;\r\n    }\r\n    currentTopic = '';\r\n    bulletsHtml = '';\r\n  };\r\n  \r\n  for (const line of lines) {\r\n    const trimmed = line.trim();\r\n    if (!trimmed) continue;\r\n    \r\n    if (!headerDone && trimmed.startsWith('')) {\r\n      html += `<div class=\"notes-header\">${escapeHtml(trimmed)}</div>`;\r\n      headerDone = true;\r\n      continue;\r\n    }\r\n    \r\n    if (!metaDone && trimmed.startsWith('')) {\r\n      html += `<div class=\"notes-meta\">${escapeHtml(trimmed)}</div>`;\r\n      metaDone = true;\r\n      continue;\r\n    }\r\n    \r\n    if (trimmed.startsWith('-')) {\r\n      const bulletText = trimmed.substring(1).trim();\r\n      bulletsHtml += `<div class=\"notes-bullet\">${escapeHtml(bulletText)}</div>`;\r\n      continue;\r\n    }\r\n    \r\n    flushTopic();\r\n    currentTopic = trimmed;\r\n  }\r\n  \r\n  flushTopic();\r\n  \r\n  if (!html.includes('notes-topic')) {\r\n    return `<pre class=\"conv-notes-pre\">${escapeHtml(text)}</pre>`;\r\n  }\r\n  \r\n  return html;\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showConversationPreviewModal;\r\n","/**\r\n * Email Preview Modal - SOTA\r\n * Full email preview with AI extraction results, entities, analysis\r\n */\r\n\r\nimport { toast } from '../../services/toast';\r\nimport { formatRelativeTime } from '../../utils/format';\r\n\r\nexport interface EmailData {\r\n  id: string;\r\n  subject: string;\r\n  from: { name: string; email: string };\r\n  to: Array<{ name: string; email: string }>;\r\n  cc?: Array<{ name: string; email: string }>;\r\n  body: string;\r\n  body_html?: string;\r\n  date: string;\r\n  attachments?: Array<{ name: string; size: number }>;\r\n  // AI extraction fields\r\n  extracted_entities?: ExtractionResult;\r\n  ai_summary?: string;\r\n  detected_intent?: string;\r\n  sentiment?: string;\r\n  requires_response?: boolean;\r\n  processed_at?: string;\r\n}\r\n\r\ninterface ExtractionResult {\r\n  summary?: string;\r\n  intent?: string;\r\n  sentiment?: string;\r\n  key_points?: string[];\r\n  action_items?: Array<{ task: string; owner?: string }>;\r\n  questions?: string[];\r\n  entities?: Array<{ type: string; name: string; confidence?: number }>;\r\n  contacts?: Array<{ name: string; email?: string; title?: string; organization?: string }>;\r\n}\r\n\r\nlet currentTab = 'content';\r\n\r\n/**\r\n * Show email preview modal\r\n */\r\nexport function showEmailPreviewModal(email: EmailData, onClose?: () => void): void {\r\n  const existing = document.querySelector('.email-preview-overlay');\r\n  if (existing) existing.remove();\r\n\r\n  const extraction = email.extracted_entities;\r\n  const hasExtraction = extraction && (\r\n    extraction.key_points?.length || \r\n    extraction.action_items?.length || \r\n    extraction.entities?.length\r\n  );\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'email-preview-modal';\r\n  content.innerHTML = `\r\n    <style>\r\n      .email-preview-modal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 80vh;\r\n        max-height: 800px;\r\n        width: 900px;\r\n        max-width: 95vw;\r\n      }\r\n      .email-preview-header {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n      }\r\n      .email-preview-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n        flex-shrink: 0;\r\n      }\r\n      .email-preview-title {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin: 0 0 8px 0;\r\n        line-height: 1.3;\r\n      }\r\n      .email-preview-meta {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .email-preview-meta-row {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-bottom: 4px;\r\n      }\r\n      .email-preview-meta-label {\r\n        color: var(--text-tertiary);\r\n        min-width: 40px;\r\n      }\r\n      .email-preview-badges {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-top: 8px;\r\n        flex-wrap: wrap;\r\n      }\r\n      .email-badge {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n        padding: 4px 10px;\r\n        border-radius: 12px;\r\n        font-size: 12px;\r\n        font-weight: 500;\r\n      }\r\n      .email-badge.intent {\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        color: var(--primary);\r\n      }\r\n      .email-badge.sentiment-positive {\r\n        background: rgba(46, 160, 67, 0.1);\r\n        color: #2ea043;\r\n      }\r\n      .email-badge.sentiment-negative {\r\n        background: rgba(248, 81, 73, 0.1);\r\n        color: #f85149;\r\n      }\r\n      .email-badge.sentiment-neutral {\r\n        background: var(--bg-tertiary);\r\n        color: var(--text-secondary);\r\n      }\r\n      .email-badge.response-needed {\r\n        background: rgba(248, 81, 73, 0.1);\r\n        color: #f85149;\r\n      }\r\n      .email-preview-tabs {\r\n        display: flex;\r\n        gap: 4px;\r\n        padding: 0 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      .email-preview-tab {\r\n        padding: 12px 16px;\r\n        background: none;\r\n        border: none;\r\n        border-bottom: 2px solid transparent;\r\n        color: var(--text-secondary);\r\n        cursor: pointer;\r\n        font-size: 14px;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .email-preview-tab:hover {\r\n        color: var(--text-primary);\r\n      }\r\n      .email-preview-tab.active {\r\n        color: var(--primary);\r\n        border-bottom-color: var(--primary);\r\n      }\r\n      .email-preview-tab-badge {\r\n        background: var(--bg-tertiary);\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        font-size: 11px;\r\n        margin-left: 6px;\r\n      }\r\n      .email-preview-body {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 20px 24px;\r\n      }\r\n      .email-preview-section {\r\n        display: none;\r\n      }\r\n      .email-preview-section.active {\r\n        display: block;\r\n      }\r\n      .email-content-body {\r\n        background: var(--bg-secondary);\r\n        padding: 20px;\r\n        border-radius: 12px;\r\n        line-height: 1.7;\r\n      }\r\n      .extraction-card {\r\n        padding: 12px 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .extraction-type {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .extraction-content {\r\n        color: var(--text-primary);\r\n      }\r\n      .extraction-meta {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n        margin-top: 4px;\r\n      }\r\n      .section-title {\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 12px;\r\n        text-transform: uppercase;\r\n      }\r\n      .empty-section {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      .ai-summary-box {\r\n        padding: 16px;\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n        border-left: 3px solid var(--primary);\r\n        border-radius: 8px;\r\n        margin-bottom: 20px;\r\n      }\r\n      .ai-summary-label {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 8px;\r\n      }\r\n      .key-points-list {\r\n        list-style: none;\r\n        padding: 0;\r\n        margin: 0;\r\n      }\r\n      .key-points-list li {\r\n        padding: 8px 0;\r\n        border-bottom: 1px solid var(--border-color);\r\n        display: flex;\r\n        gap: 8px;\r\n      }\r\n      .key-points-list li:last-child {\r\n        border-bottom: none;\r\n      }\r\n      .key-points-list li::before {\r\n        content: \"\";\r\n        color: var(--primary);\r\n      }\r\n      .contact-card {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 12px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .contact-avatar {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 50%;\r\n        background: var(--bg-tertiary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n      }\r\n      .contact-info {\r\n        flex: 1;\r\n      }\r\n      .contact-name {\r\n        font-weight: 600;\r\n      }\r\n      .contact-details {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"email-preview-header\">\r\n      <div class=\"email-preview-icon\"></div>\r\n      <div class=\"email-preview-header-fill\">\r\n        <h2 class=\"email-preview-title\">${escapeHtml(email.subject || 'No Subject')}</h2>\r\n        <div class=\"email-preview-meta\">\r\n          <div class=\"email-preview-meta-row\">\r\n            <span class=\"email-preview-meta-label\">From:</span>\r\n            <span><strong>${escapeHtml(email.from?.name || '')}</strong> &lt;${escapeHtml(email.from?.email || '')}&gt;</span>\r\n          </div>\r\n          <div class=\"email-preview-meta-row\">\r\n            <span class=\"email-preview-meta-label\">To:</span>\r\n            <span>${(email.to || []).map(r => escapeHtml(r.name || r.email)).join(', ')}</span>\r\n          </div>\r\n          <div class=\"email-preview-meta-row\">\r\n            <span class=\"email-preview-meta-label\">Date:</span>\r\n            <span>${formatRelativeTime(email.date)}</span>\r\n          </div>\r\n        </div>\r\n        <div class=\"email-preview-badges\">\r\n          ${extraction?.intent ? `<span class=\"email-badge intent\"> ${escapeHtml(extraction.intent)}</span>` : ''}\r\n          ${extraction?.sentiment ? `<span class=\"email-badge sentiment-${extraction.sentiment}\">${getSentimentEmoji(extraction.sentiment)} ${escapeHtml(extraction.sentiment)}</span>` : ''}\r\n          ${email.requires_response ? `<span class=\"email-badge response-needed\"> Response Needed</span>` : ''}\r\n        </div>\r\n      </div>\r\n      <button class=\"btn btn-sm email-preview-close-btn\"></button>\r\n    </div>\r\n    \r\n    <div class=\"email-preview-tabs\">\r\n      <button class=\"email-preview-tab active\" data-tab=\"content\">Content</button>\r\n      <button class=\"email-preview-tab ${!hasExtraction ? 'hidden' : ''}\" data-tab=\"analysis\">\r\n        Analysis\r\n      </button>\r\n      <button class=\"email-preview-tab ${!extraction?.entities?.length ? 'hidden' : ''}\" data-tab=\"entities\">\r\n        Entities\r\n        <span class=\"email-preview-tab-badge\">${extraction?.entities?.length || 0}</span>\r\n      </button>\r\n      <button class=\"email-preview-tab ${!extraction?.contacts?.length ? 'hidden' : ''}\" data-tab=\"contacts\">\r\n        Contacts\r\n        <span class=\"email-preview-tab-badge\">${extraction?.contacts?.length || 0}</span>\r\n      </button>\r\n    </div>\r\n    \r\n    <div class=\"email-preview-body\">\r\n      <div class=\"email-preview-section active\" data-section=\"content\">\r\n        ${extraction?.summary || email.ai_summary ? `\r\n          <div class=\"ai-summary-box\">\r\n            <div class=\"ai-summary-label\"> AI Summary</div>\r\n            <div>${escapeHtml(extraction?.summary || email.ai_summary || '')}</div>\r\n          </div>\r\n        ` : ''}\r\n        <div class=\"email-content-body\">\r\n          ${email.body_html || escapeHtml(email.body || '').replace(/\\n/g, '<br>')}\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"email-preview-section\" data-section=\"analysis\">\r\n        ${extraction?.key_points?.length ? `\r\n          <div class=\"section-title\">Key Points</div>\r\n          <ul class=\"key-points-list\">\r\n            ${extraction.key_points.map(p => `<li>${escapeHtml(p)}</li>`).join('')}\r\n          </ul>\r\n        ` : ''}\r\n        \r\n        ${extraction?.action_items?.length ? `\r\n          <div class=\"section-title section-title-mt\">Action Items</div>\r\n          ${extraction.action_items.map(a => `\r\n            <div class=\"extraction-card\">\r\n              <div class=\"extraction-content\"> ${escapeHtml(a.task)}</div>\r\n              ${a.owner ? `<div class=\"extraction-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\r\n            </div>\r\n          `).join('')}\r\n        ` : ''}\r\n        \r\n        ${extraction?.questions?.length ? `\r\n          <div class=\"section-title section-title-mt\">Questions</div>\r\n          ${extraction.questions.map(q => `\r\n            <div class=\"extraction-card\">\r\n              <div class=\"extraction-content\"> ${escapeHtml(q)}</div>\r\n            </div>\r\n          `).join('')}\r\n        ` : ''}\r\n        \r\n        ${!extraction?.key_points?.length && !extraction?.action_items?.length && !extraction?.questions?.length ? `\r\n          <div class=\"empty-section\">No analysis available</div>\r\n        ` : ''}\r\n      </div>\r\n      \r\n      <div class=\"email-preview-section\" data-section=\"entities\">\r\n        ${extraction?.entities?.length ? extraction.entities.map(e => `\r\n          <div class=\"extraction-card\">\r\n            <div class=\"extraction-type\">${escapeHtml(e.type)}</div>\r\n            <div class=\"extraction-content\">${escapeHtml(e.name)}</div>\r\n            ${e.confidence ? `<div class=\"extraction-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\r\n          </div>\r\n        `).join('') : '<div class=\"empty-section\">No entities extracted</div>'}\r\n      </div>\r\n      \r\n      <div class=\"email-preview-section\" data-section=\"contacts\">\r\n        ${extraction?.contacts?.length ? extraction.contacts.map(c => `\r\n          <div class=\"contact-card\">\r\n            <div class=\"contact-avatar\">${getInitials(c.name)}</div>\r\n            <div class=\"contact-info\">\r\n              <div class=\"contact-name\">${escapeHtml(c.name)}</div>\r\n              <div class=\"contact-details\">\r\n                ${c.title ? escapeHtml(c.title) + (c.organization ? ' at ' : '') : ''}\r\n                ${c.organization ? escapeHtml(c.organization) : ''}\r\n                ${c.email ? `<br>${escapeHtml(c.email)}` : ''}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        `).join('') : '<div class=\"empty-section\">No contacts extracted</div>'}\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Tab switching\r\n  content.querySelectorAll('.email-preview-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      const tabName = (tab as HTMLElement).dataset.tab;\r\n      content.querySelectorAll('.email-preview-tab').forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      content.querySelectorAll('.email-preview-section').forEach(s => s.classList.remove('active'));\r\n      content.querySelector(`[data-section=\"${tabName}\"]`)?.classList.add('active');\r\n    });\r\n  });\r\n\r\n  // Close button\r\n  content.querySelector('.close-btn')?.addEventListener('click', () => {\r\n    overlay.remove();\r\n    onClose?.();\r\n  });\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'modal-overlay overlay-preview email-preview-overlay';\r\n\r\n  const modal = document.createElement('div');\r\n  modal.className = 'modal-preview-box';\r\n  modal.appendChild(content);\r\n  overlay.appendChild(modal);\r\n\r\n  // Close on backdrop click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      overlay.remove();\r\n      onClose?.();\r\n    }\r\n  });\r\n\r\n  // Close on escape\r\n  const handleEsc = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      overlay.remove();\r\n      onClose?.();\r\n      document.removeEventListener('keydown', handleEsc);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', handleEsc);\r\n\r\n  document.body.appendChild(overlay);\r\n}\r\n\r\nfunction getSentimentEmoji(sentiment: string): string {\r\n  switch (sentiment?.toLowerCase()) {\r\n    case 'positive': return '';\r\n    case 'negative': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(p => p[0])\r\n    .slice(0, 2)\r\n    .join('')\r\n    .toUpperCase();\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showEmailPreviewModal;\r\n","/**\r\n * Briefing Panel Component\r\n * Displays daily AI-generated briefing with history\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { chatService, Briefing, BriefingHistoryItem } from '../services/chat';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface BriefingPanelProps {\r\n  onActionClick?: (action: { type: string; id: string }) => void;\r\n}\r\n\r\nlet currentBriefing: Briefing | null = null;\r\nlet showHistory = false;\r\n\r\n/**\r\n * Create briefing panel\r\n */\r\nexport function createBriefingPanel(props: BriefingPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'briefing-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"briefing-header\">\r\n      <h2>Daily Briefing</h2>\r\n      <div class=\"briefing-actions\">\r\n        <button class=\"btn btn-sm\" id=\"toggle-history-btn\">History</button>\r\n        <button class=\"btn btn-sm btn-primary\" id=\"refresh-briefing-btn\">Refresh</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"briefing-content\" id=\"briefing-content\">\r\n      <div class=\"loading\">Generating briefing...</div>\r\n    </div>\r\n    <div class=\"briefing-history hidden\" id=\"briefing-history\"></div>\r\n  `;\r\n\r\n  // Bind events\r\n  const refreshBtn = panel.querySelector('#refresh-briefing-btn');\r\n  if (refreshBtn) {\r\n    on(refreshBtn as HTMLElement, 'click', () => loadBriefing(panel, true, props));\r\n  }\r\n\r\n  const historyBtn = panel.querySelector('#toggle-history-btn');\r\n  if (historyBtn) {\r\n    on(historyBtn as HTMLElement, 'click', () => {\r\n      showHistory = !showHistory;\r\n      const historyContainer = panel.querySelector('#briefing-history') as HTMLElement;\r\n      historyContainer.classList.toggle('hidden', !showHistory);\r\n      if (showHistory) {\r\n        loadHistory(historyContainer);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadBriefing(panel, false, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load briefing\r\n */\r\nasync function loadBriefing(\r\n  panel: HTMLElement, \r\n  refresh: boolean,\r\n  props: BriefingPanelProps\r\n): Promise<void> {\r\n  const content = panel.querySelector('#briefing-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Generating briefing...</div>';\r\n\r\n  try {\r\n    const briefing = await chatService.getBriefing(refresh);\r\n    currentBriefing = briefing;\r\n    renderBriefing(content, briefing, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to generate briefing</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render briefing content\r\n */\r\nfunction renderBriefing(\r\n  container: HTMLElement, \r\n  briefing: Briefing,\r\n  props: BriefingPanelProps\r\n): void {\r\n  container.innerHTML = `\r\n    <div class=\"briefing-meta\">\r\n      <span class=\"briefing-date\">${formatDate(briefing.generated_at)}</span>\r\n      ${briefing.cached ? `<span class=\"cached-badge\">Cached</span>` : ''}\r\n    </div>\r\n\r\n    <div class=\"briefing-text\">\r\n      ${renderMarkdown(briefing.briefing)}\r\n    </div>\r\n\r\n    ${briefing.analysis ? `\r\n      <div class=\"briefing-analysis\">\r\n        <h4>Analysis</h4>\r\n        <div class=\"analysis-content\">${renderMarkdown(briefing.analysis)}</div>\r\n      </div>\r\n    ` : ''}\r\n\r\n  `;\r\n}\r\n\r\n/**\r\n * Load briefing history\r\n */\r\nasync function loadHistory(container: HTMLElement): Promise<void> {\r\n  container.innerHTML = '<div class=\"loading\">Loading history...</div>';\r\n\r\n  try {\r\n    const history = await chatService.getBriefingHistory(10);\r\n    \r\n    if (!history || history.length === 0) {\r\n      container.innerHTML = '<p class=\"empty\">No previous briefings</p>';\r\n      return;\r\n    }\r\n\r\n    container.innerHTML = `\r\n      <h4>Previous Briefings</h4>\r\n      <div class=\"history-list\">\r\n        ${history.map((item: BriefingHistoryItem) => `\r\n          <div class=\"history-item\" data-id=\"${item.id}\">\r\n            <div class=\"history-date\">${formatDate(item.generated_at)}</div>\r\n            <div class=\"history-preview\">${escapeHtml(item.briefing.substring(0, 150))}...</div>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    `;\r\n\r\n    // Bind click events\r\n    container.querySelectorAll('.history-item').forEach(item => {\r\n      on(item as HTMLElement, 'click', () => {\r\n        const id = item.getAttribute('data-id');\r\n        const historyItem = history.find((h: BriefingHistoryItem) => h.id === id);\r\n        if (historyItem) {\r\n          showHistoryDetail(container.closest('.briefing-panel') as HTMLElement, historyItem);\r\n        }\r\n      });\r\n    });\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to load history</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Show history detail\r\n */\r\nfunction showHistoryDetail(panel: HTMLElement, item: BriefingHistoryItem): void {\r\n  const content = panel.querySelector('#briefing-content') as HTMLElement;\r\n  \r\n  content.innerHTML = `\r\n    <div class=\"history-detail\">\r\n      <button class=\"btn btn-sm back-btn\" id=\"back-to-current\"> Back to current</button>\r\n      <div class=\"briefing-meta\">\r\n        <span class=\"briefing-date\">${formatDate(item.generated_at)}</span>\r\n        <span class=\"history-badge\">Historical</span>\r\n      </div>\r\n      <div class=\"briefing-text\">${renderMarkdown(item.briefing)}</div>\r\n    </div>\r\n  `;\r\n\r\n  const backBtn = content.querySelector('#back-to-current');\r\n  if (backBtn && currentBriefing) {\r\n    on(backBtn as HTMLElement, 'click', () => {\r\n      renderBriefing(content, currentBriefing!, {});\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Simple markdown renderer\r\n */\r\nfunction renderMarkdown(text: string): string {\r\n  return text\r\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\r\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\r\n    .replace(/^### (.*$)/gm, '<h5>$1</h5>')\r\n    .replace(/^## (.*$)/gm, '<h4>$1</h4>')\r\n    .replace(/^# (.*$)/gm, '<h3>$1</h3>')\r\n    .replace(/^- (.*$)/gm, '<li>$1</li>')\r\n    .replace(/(<li>.*<\\/li>)/gs, '<ul>$1</ul>')\r\n    .replace(/\\n\\n/g, '</p><p>')\r\n    .replace(/^(.+)$/gm, '<p>$1</p>')\r\n    .replace(/<p><\\/p>/g, '')\r\n    .replace(/<p>(<[hul])/g, '$1')\r\n    .replace(/(<\\/[hul][^>]*>)<\\/p>/g, '$1');\r\n}\r\n\r\n/**\r\n * Format date\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString(undefined, {\r\n    weekday: 'long',\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n  });\r\n}\r\n\r\n/**\r\n * Format label\r\n */\r\nfunction formatLabel(key: string): string {\r\n  return key\r\n    .replace(/_/g, ' ')\r\n    .replace(/([A-Z])/g, ' $1')\r\n    .replace(/^./, str => str.toUpperCase());\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createBriefingPanel;\r\n","/**\n * Reports Panel Component\n * Weekly reports and executive summaries with export\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { chatService } from '../services/chat';\nimport { toast } from '../services/toast';\n\nexport interface ReportsPanelProps {\n  onExport?: (type: 'pdf' | 'md', content: string) => void;\n}\n\ntype ReportType = 'weekly' | 'executive';\n\nlet currentReport: string = '';\nlet currentType: ReportType = 'weekly';\n\n/**\n * Create reports panel\n */\nexport function createReportsPanel(props: ReportsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'reports-panel' });\n\n  panel.innerHTML = `\n    <div class=\"reports-header\">\n      <h2>Reports</h2>\n      <div class=\"reports-actions\">\n        <button class=\"btn btn-sm\" id=\"export-md-btn\">Export MD</button>\n        <button class=\"btn btn-sm btn-primary\" id=\"export-pdf-btn\">Export PDF</button>\n      </div>\n    </div>\n    <div class=\"reports-tabs\">\n      <button class=\"report-tab active\" data-type=\"weekly\">Weekly Report</button>\n      <button class=\"report-tab\" data-type=\"executive\">Executive Summary</button>\n    </div>\n    <div class=\"reports-content\" id=\"reports-content\">\n      <div class=\"loading\">Generating report...</div>\n    </div>\n  `;\n\n  // Bind tab events\n  const tabs = panel.querySelectorAll('.report-tab');\n  tabs.forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentType = tab.getAttribute('data-type') as ReportType;\n      loadReport(panel, currentType);\n    });\n  });\n\n  // Export buttons\n  const exportMdBtn = panel.querySelector('#export-md-btn');\n  if (exportMdBtn) {\n    on(exportMdBtn as HTMLElement, 'click', () => exportReport('md', props));\n  }\n\n  const exportPdfBtn = panel.querySelector('#export-pdf-btn');\n  if (exportPdfBtn) {\n    on(exportPdfBtn as HTMLElement, 'click', () => exportReport('pdf', props));\n  }\n\n  // Initial load\n  loadReport(panel, 'weekly');\n\n  return panel;\n}\n\n/**\n * Load report\n */\nasync function loadReport(panel: HTMLElement, type: ReportType): Promise<void> {\n  const content = panel.querySelector('#reports-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Generating report...</div>';\n\n  try {\n    let report: string;\n\n    if (type === 'weekly') {\n      report = await chatService.getWeeklyReport();\n    } else {\n      report = await chatService.generateExecutiveSummary();\n    }\n\n    currentReport = report;\n    renderReport(content, report);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to generate report</div>';\n  }\n}\n\n/**\n * Render report\n */\nfunction renderReport(container: HTMLElement, markdown: string): void {\n  container.innerHTML = `\n    <div class=\"report-preview\">\n      ${renderMarkdown(markdown)}\n    </div>\n  `;\n}\n\n/**\n * Export report\n */\nasync function exportReport(format: 'pdf' | 'md', props: ReportsPanelProps): Promise<void> {\n  if (!currentReport) {\n    toast.error('No report to export');\n    return;\n  }\n\n  if (props.onExport) {\n    props.onExport(format, currentReport);\n    return;\n  }\n\n  if (format === 'md') {\n    downloadFile(`${currentType}-report.md`, currentReport, 'text/markdown');\n    toast.success('Report downloaded');\n  } else if (format === 'pdf') {\n    await exportToPdf(currentReport, `${currentType}-report`);\n  }\n}\n\n/**\n * Download file\n */\nfunction downloadFile(filename: string, content: string, mimeType: string): void {\n  const blob = new Blob([content], { type: mimeType });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  document.body.removeChild(a);\n  URL.revokeObjectURL(url);\n}\n\n/**\n * Export to PDF using html2pdf.js\n */\nasync function exportToPdf(markdown: string, filename: string): Promise<void> {\n  // Check if html2pdf is available\n  const html2pdf = (window as unknown as { html2pdf?: unknown }).html2pdf;\n  \n  if (!html2pdf) {\n    // Fallback: download as HTML\n    const html = `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset=\"utf-8\">\n        <title>${filename}</title>\n        <style>\n          body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 40px; }\n          h1 { color: #1a1a2e; }\n          h2 { color: #16213e; border-bottom: 1px solid #eee; padding-bottom: 10px; }\n          h3 { color: #0f3460; }\n          ul { padding-left: 20px; }\n          li { margin: 5px 0; }\n        </style>\n      </head>\n      <body>\n        ${renderMarkdown(markdown)}\n      </body>\n      </html>\n    `;\n    downloadFile(`${filename}.html`, html, 'text/html');\n    toast.info('Downloaded as HTML (PDF library not available)');\n    return;\n  }\n\n  // Create temporary element for PDF generation\n  const tempDiv = document.createElement('div');\n  tempDiv.className = 'report-pdf-container';\n  tempDiv.innerHTML = renderMarkdown(markdown);\n  document.body.appendChild(tempDiv);\n\n  try {\n    await (html2pdf as (element: HTMLElement) => { save: (filename: string) => Promise<void> })(tempDiv)\n      .save(`${filename}.pdf`);\n    toast.success('PDF exported');\n  } catch {\n    toast.error('Failed to export PDF');\n  } finally {\n    document.body.removeChild(tempDiv);\n  }\n}\n\n/**\n * Simple markdown renderer\n */\nfunction renderMarkdown(text: string): string {\n  return text\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n    .replace(/^### (.*$)/gm, '<h3>$1</h3>')\n    .replace(/^## (.*$)/gm, '<h2>$1</h2>')\n    .replace(/^# (.*$)/gm, '<h1>$1</h1>')\n    .replace(/^- (.*$)/gm, '<li>$1</li>')\n    .replace(/(<li>.*<\\/li>)/gs, '<ul>$1</ul>')\n    .replace(/\\n\\n/g, '</p><p>')\n    .replace(/^(.+)$/gm, '<p>$1</p>')\n    .replace(/<p><\\/p>/g, '')\n    .replace(/<p>(<[hul])/g, '$1')\n    .replace(/(<\\/[hul][^>]*>)<\\/p>/g, '$1');\n}\n\nexport default createReportsPanel;\n","/**\n * Contacts Panel Component - SOTA Design\n * Contact list with search, filters, favorites, and management\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { contactsService, Contact } from '../services/contacts';\nimport { showContactModal } from './modals/ContactModal';\nimport { toast } from '../services/toast';\nimport { http } from '../services/api';\n\nexport interface ContactsPanelProps {\n  onContactClick?: (contact: Contact) => void;\n}\n\nlet currentSearch = '';\nlet currentFilter: { organization?: string; tag?: string; favorites?: boolean } = {};\nlet allContacts: Contact[] = [];\nlet selectedContactIds: Set<string> = new Set();\n\n/**\n * Create contacts panel\n */\nexport function createContactsPanel(props: ContactsPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'contacts-panel-sota' });\n\n  panel.innerHTML = `\n    <style>\n      .contacts-panel-sota {\n        padding: 24px;\n        min-height: 100%;\n      }\n\n      /* Header */\n      .contacts-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 24px;\n        flex-wrap: wrap;\n        gap: 16px;\n      }\n\n      .contacts-title {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n\n      .contacts-title-icon {\n        width: 48px;\n        height: 48px;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        border-radius: 14px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 4px 12px rgba(225, 29, 72, 0.3);\n      }\n\n      .contacts-title-icon svg {\n        width: 26px;\n        height: 26px;\n        color: white;\n      }\n\n      .contacts-title h1 {\n        margin: 0;\n        font-size: 28px;\n        font-weight: 700;\n        color: var(--text-primary);\n      }\n\n      .contacts-count {\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        color: white;\n        padding: 4px 12px;\n        border-radius: 20px;\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .contacts-actions {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n\n      /* Search Bar */\n      .contacts-search-wrapper {\n        position: relative;\n        flex: 1;\n        max-width: 400px;\n        min-width: 200px;\n      }\n\n      .contacts-search-wrapper svg {\n        position: absolute;\n        left: 14px;\n        top: 50%;\n        transform: translateY(-50%);\n        width: 18px;\n        height: 18px;\n        color: var(--text-tertiary);\n        pointer-events: none;\n        transition: color 0.2s;\n      }\n\n      .contacts-search {\n        width: 100%;\n        padding: 12px 14px 12px 44px;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        font-size: 14px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        transition: all 0.2s;\n      }\n\n      .contacts-search:focus {\n        outline: none;\n        border-color: #e11d48;\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\n      }\n\n      .contacts-search:focus + svg {\n        color: #e11d48;\n      }\n\n      /* SOTA Buttons */\n      .btn-sota {\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 10px 18px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n        border: none;\n      }\n\n      .btn-sota.primary {\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        color: white;\n        box-shadow: 0 4px 12px rgba(225, 29, 72, 0.3);\n      }\n\n      .btn-sota.primary:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 6px 16px rgba(225, 29, 72, 0.4);\n      }\n\n      .btn-sota.secondary {\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n\n      .btn-sota.secondary:hover {\n        background: var(--bg-tertiary);\n        border-color: #e11d48;\n      }\n\n      .btn-sota svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* Filters */\n      .contacts-filters {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        margin-bottom: 20px;\n        flex-wrap: wrap;\n      }\n\n      .filter-chip {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        padding: 8px 14px;\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        border-radius: 20px;\n        font-size: 13px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n\n      .filter-chip:hover {\n        background: var(--bg-tertiary);\n        border-color: #e11d48;\n        color: #e11d48;\n      }\n\n      .filter-chip.active {\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\n        border-color: #e11d48;\n        color: #e11d48;\n      }\n\n      .filter-chip svg {\n        width: 14px;\n        height: 14px;\n      }\n\n      .filter-select {\n        padding: 8px 32px 8px 12px;\n        border: 1px solid var(--border-color);\n        border-radius: 20px;\n        font-size: 13px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        cursor: pointer;\n        appearance: none;\n        background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E\");\n        background-repeat: no-repeat;\n        background-position: right 12px center;\n      }\n\n      .filter-select:focus {\n        outline: none;\n        border-color: #e11d48;\n      }\n\n      /* Alerts */\n      .contacts-alerts {\n        margin-bottom: 20px;\n      }\n\n      .alert-sota {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 14px 18px;\n        background: linear-gradient(135deg, rgba(245,158,11,0.1) 0%, rgba(245,158,11,0.05) 100%);\n        border: 1px solid rgba(245,158,11,0.3);\n        border-radius: 12px;\n        color: #d97706;\n      }\n\n      .alert-sota svg {\n        width: 20px;\n        height: 20px;\n        flex-shrink: 0;\n      }\n\n      .alert-sota span {\n        flex: 1;\n        font-size: 14px;\n      }\n\n      .alert-sota .btn-sota {\n        padding: 6px 12px;\n        font-size: 12px;\n      }\n\n      /* Favorites Section */\n      .favorites-section {\n        margin-bottom: 28px;\n      }\n\n      .section-header {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        margin-bottom: 14px;\n        color: var(--text-secondary);\n        font-size: 13px;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n\n      .section-header svg {\n        width: 16px;\n        height: 16px;\n        color: #f59e0b;\n      }\n\n      .favorites-grid {\n        display: flex;\n        gap: 12px;\n        overflow-x: auto;\n        padding-bottom: 8px;\n      }\n\n      .favorite-card {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        padding: 12px 16px;\n        background: linear-gradient(135deg, rgba(245,158,11,0.08) 0%, rgba(245,158,11,0.02) 100%);\n        border: 1px solid rgba(245,158,11,0.2);\n        border-radius: 12px;\n        cursor: pointer;\n        transition: all 0.2s;\n        white-space: nowrap;\n      }\n\n      .favorite-card:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(245,158,11,0.15);\n        border-color: #f59e0b;\n      }\n\n      .favorite-avatar {\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #f59e0b, #d97706);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 13px;\n        font-weight: 600;\n        color: white;\n        flex-shrink: 0;\n        overflow: hidden;\n      }\n\n      .favorite-avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .favorite-info h4 {\n        margin: 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n\n      .favorite-info p {\n        margin: 2px 0 0 0;\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n\n      /* Contacts Grid */\n      .contacts-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n        gap: 16px;\n      }\n\n      .contact-card-sota {\n        background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.5) 100%);\n        border: 1px solid var(--border-color);\n        border-radius: 16px;\n        padding: 20px;\n        cursor: pointer;\n        transition: all 0.25s ease;\n        position: relative;\n        overflow: hidden;\n      }\n\n      [data-theme=\"dark\"] .contact-card-sota {\n        background: linear-gradient(135deg, rgba(30,41,59,0.9) 0%, rgba(30,41,59,0.5) 100%);\n      }\n\n      .contact-card-sota:hover {\n        transform: translateY(-4px);\n        box-shadow: 0 12px 32px rgba(0,0,0,0.1);\n        border-color: rgba(225,29,72,0.3);\n      }\n\n      .contact-card-sota::before {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        height: 4px;\n        background: linear-gradient(90deg, #e11d48, #f59e0b);\n        opacity: 0;\n        transition: opacity 0.2s;\n      }\n\n      .contact-card-sota:hover::before {\n        opacity: 1;\n      }\n\n      .contact-card-header {\n        display: flex;\n        align-items: flex-start;\n        gap: 14px;\n        margin-bottom: 14px;\n      }\n\n      .contact-avatar-sota {\n        width: 56px;\n        height: 56px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 20px;\n        font-weight: 700;\n        color: white;\n        flex-shrink: 0;\n        overflow: hidden;\n        box-shadow: 0 4px 12px rgba(225,29,72,0.25);\n      }\n\n      .contact-avatar-sota img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n\n      .contact-main-info {\n        flex: 1;\n        min-width: 0;\n      }\n\n      .contact-name-sota {\n        margin: 0 0 4px 0;\n        font-size: 17px;\n        font-weight: 700;\n        color: var(--text-primary);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n\n      .contact-role-badge {\n        display: inline-flex;\n        align-items: center;\n        gap: 4px;\n        padding: 4px 10px;\n        background: linear-gradient(135deg, rgba(225,29,72,0.1) 0%, rgba(225,29,72,0.05) 100%);\n        border-radius: 6px;\n        font-size: 12px;\n        font-weight: 600;\n        color: #e11d48;\n        margin-bottom: 4px;\n      }\n\n      .contact-org-sota {\n        font-size: 13px;\n        color: var(--text-secondary);\n        display: flex;\n        align-items: center;\n        gap: 4px;\n      }\n\n      .contact-org-sota svg {\n        width: 14px;\n        height: 14px;\n        opacity: 0.6;\n      }\n\n      .contact-details-sota {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n        padding-top: 12px;\n        border-top: 1px solid var(--border-color);\n      }\n\n      .contact-detail-item {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 13px;\n        color: var(--text-secondary);\n      }\n\n      .contact-detail-item svg {\n        width: 14px;\n        height: 14px;\n        color: #e11d48;\n        flex-shrink: 0;\n      }\n\n      .contact-detail-item span {\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n\n      .contact-tags-sota {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n        margin-top: 12px;\n      }\n\n      .contact-tag {\n        padding: 3px 8px;\n        background: var(--bg-tertiary);\n        border-radius: 4px;\n        font-size: 11px;\n        font-weight: 500;\n        color: var(--text-secondary);\n      }\n\n      .contact-quick-actions {\n        position: absolute;\n        top: 12px;\n        right: 12px;\n        display: flex;\n        gap: 6px;\n        opacity: 0;\n        transition: opacity 0.2s;\n      }\n\n      .contact-card-sota:hover .contact-quick-actions {\n        opacity: 1;\n      }\n\n      .quick-action-btn {\n        width: 32px;\n        height: 32px;\n        border-radius: 8px;\n        background: var(--bg-primary);\n        border: 1px solid var(--border-color);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n\n      .quick-action-btn:hover {\n        background: #e11d48;\n        border-color: #e11d48;\n        color: white;\n      }\n\n      .quick-action-btn.favorite {\n        color: #f59e0b;\n      }\n\n      .quick-action-btn.favorite.active {\n        background: #f59e0b;\n        border-color: #f59e0b;\n        color: white;\n      }\n\n      .quick-action-btn svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* Selection Checkbox */\n      .contact-select-checkbox {\n        position: absolute;\n        top: 12px;\n        left: 12px;\n        width: 22px;\n        height: 22px;\n        border-radius: 6px;\n        border: 2px solid var(--border-color);\n        background: var(--bg-primary);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: all 0.2s;\n        z-index: 5;\n        opacity: 0;\n      }\n\n      .contact-card-sota:hover .contact-select-checkbox,\n      .contact-card-sota.selected .contact-select-checkbox {\n        opacity: 1;\n      }\n\n      .contact-select-checkbox:hover {\n        border-color: #e11d48;\n      }\n\n      .contact-select-checkbox.checked {\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        border-color: #e11d48;\n      }\n\n      .contact-select-checkbox svg {\n        width: 14px;\n        height: 14px;\n        color: white;\n        display: none;\n      }\n\n      .contact-select-checkbox.checked svg {\n        display: block;\n      }\n\n      .contact-card-sota.selected {\n        border-color: #e11d48;\n        box-shadow: 0 0 0 2px rgba(225,29,72,0.2);\n      }\n\n      /* Selection Bar */\n      .selection-bar {\n        position: fixed;\n        bottom: 24px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: linear-gradient(135deg, #1e293b, #0f172a);\n        padding: 12px 24px;\n        border-radius: 50px;\n        display: flex;\n        align-items: center;\n        gap: 16px;\n        box-shadow: 0 10px 40px rgba(0,0,0,0.3);\n        z-index: 1000;\n        animation: slideUp 0.3s ease;\n      }\n\n      @keyframes slideUp {\n        from { transform: translateX(-50%) translateY(100px); opacity: 0; }\n        to { transform: translateX(-50%) translateY(0); opacity: 1; }\n      }\n\n      .selection-bar-count {\n        color: white;\n        font-size: 14px;\n        font-weight: 600;\n      }\n\n      .selection-bar-count span {\n        color: #f59e0b;\n      }\n\n      .selection-bar-btn {\n        padding: 10px 20px;\n        border-radius: 25px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        transition: all 0.2s;\n        border: none;\n      }\n\n      .selection-bar-btn.merge {\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        color: white;\n      }\n\n      .selection-bar-btn.merge:hover {\n        transform: scale(1.05);\n        box-shadow: 0 4px 12px rgba(225,29,72,0.4);\n      }\n\n      .selection-bar-btn.cancel {\n        background: rgba(255,255,255,0.1);\n        color: white;\n        border: 1px solid rgba(255,255,255,0.2);\n      }\n\n      .selection-bar-btn.cancel:hover {\n        background: rgba(255,255,255,0.2);\n      }\n\n      .selection-bar-btn svg {\n        width: 16px;\n        height: 16px;\n      }\n\n      /* Empty State */\n      .contacts-empty-state {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 80px 24px;\n        text-align: center;\n      }\n\n      .contacts-empty-state svg {\n        width: 80px;\n        height: 80px;\n        color: #e11d48;\n        opacity: 0.4;\n        margin-bottom: 24px;\n      }\n\n      .contacts-empty-state h3 {\n        margin: 0 0 8px 0;\n        font-size: 20px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n\n      .contacts-empty-state p {\n        margin: 0 0 24px 0;\n        font-size: 14px;\n        color: var(--text-secondary);\n      }\n\n      /* Loading */\n      .contacts-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: 60px;\n        color: var(--text-secondary);\n      }\n\n      .contacts-loading::after {\n        content: '';\n        width: 24px;\n        height: 24px;\n        border: 3px solid var(--border-color);\n        border-top-color: #e11d48;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n        margin-left: 12px;\n      }\n\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n\n      /* Projects indicator */\n      .contact-projects-indicator {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        margin-top: 10px;\n        font-size: 12px;\n        color: var(--text-tertiary);\n      }\n\n      .contact-projects-indicator svg {\n        width: 14px;\n        height: 14px;\n      }\n\n      .project-dot {\n        width: 8px;\n        height: 8px;\n        border-radius: 50%;\n        background: #e11d48;\n      }\n    </style>\n\n    <!-- Header -->\n    <div class=\"contacts-header\">\n      <div class=\"contacts-title\">\n        <div class=\"contacts-title-icon\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n          </svg>\n        </div>\n        <h1>Contacts</h1>\n        <span class=\"contacts-count\" id=\"contacts-count\">0</span>\n      </div>\n\n      <div class=\"contacts-actions\">\n        <div class=\"contacts-search-wrapper\">\n          <input type=\"search\" class=\"contacts-search\" id=\"contacts-search\" placeholder=\"Search contacts...\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\"/>\n          </svg>\n        </div>\n        <button class=\"btn-sota secondary\" id=\"import-contacts-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12\"/>\n          </svg>\n          Import\n        </button>\n        <button class=\"btn-sota secondary\" id=\"export-contacts-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"/>\n          </svg>\n          Export\n        </button>\n        <button class=\"btn-sota primary\" id=\"add-contact-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Add Contact\n        </button>\n      </div>\n    </div>\n\n    <!-- Filters -->\n    <div class=\"contacts-filters\">\n      <div class=\"filter-chip\" id=\"filter-favorites\" data-filter=\"favorites\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\n        </svg>\n        Favorites\n      </div>\n      <select class=\"filter-select\" id=\"org-filter\">\n        <option value=\"\">All Organizations</option>\n      </select>\n      <select class=\"filter-select\" id=\"tag-filter\">\n        <option value=\"\">All Tags</option>\n      </select>\n    </div>\n\n    <!-- Alerts -->\n    <div class=\"contacts-alerts\" id=\"contacts-alerts\"></div>\n\n    <!-- Favorites Section -->\n    <div class=\"favorites-section hidden\" id=\"favorites-section\">\n      <div class=\"section-header\">\n        <svg fill=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\n        </svg>\n        Favorites\n      </div>\n      <div class=\"favorites-grid\" id=\"favorites-grid\"></div>\n    </div>\n\n    <!-- Main Content -->\n    <div id=\"contacts-content\">\n      <div class=\"contacts-loading\">Loading contacts</div>\n    </div>\n  `;\n\n  // Bind events\n  bindEvents(panel, props);\n\n  // Initial load\n  loadContacts(panel, props);\n  checkDuplicates(panel);\n\n  return panel;\n}\n\n/**\n * Bind panel events\n */\nfunction bindEvents(panel: HTMLElement, props: ContactsPanelProps): void {\n  // Search\n  const searchInput = panel.querySelector('#contacts-search') as HTMLInputElement;\n  let searchTimeout: number;\n  on(searchInput, 'input', () => {\n    clearTimeout(searchTimeout);\n    searchTimeout = window.setTimeout(() => {\n      currentSearch = searchInput.value;\n      loadContacts(panel, props);\n    }, 300);\n  });\n\n  // Organization filter\n  const orgFilter = panel.querySelector('#org-filter') as HTMLSelectElement;\n  on(orgFilter, 'change', () => {\n    currentFilter.organization = orgFilter.value || undefined;\n    loadContacts(panel, props);\n  });\n\n  // Tag filter\n  const tagFilter = panel.querySelector('#tag-filter') as HTMLSelectElement;\n  on(tagFilter, 'change', () => {\n    currentFilter.tag = tagFilter.value || undefined;\n    loadContacts(panel, props);\n  });\n\n  // Favorites filter\n  const favoritesChip = panel.querySelector('#filter-favorites');\n  if (favoritesChip) {\n    on(favoritesChip as HTMLElement, 'click', () => {\n      favoritesChip.classList.toggle('active');\n      currentFilter.favorites = favoritesChip.classList.contains('active');\n      loadContacts(panel, props);\n    });\n  }\n\n  // Add contact\n  const addBtn = panel.querySelector('#add-contact-btn');\n  if (addBtn) {\n    on(addBtn as HTMLElement, 'click', () => {\n      showContactModal({\n        mode: 'create',\n        onSave: () => loadContacts(panel, props),\n      });\n    });\n  }\n\n  // Export\n  const exportBtn = panel.querySelector('#export-contacts-btn');\n  if (exportBtn) {\n    on(exportBtn as HTMLElement, 'click', () => exportContacts());\n  }\n\n  // Import\n  const importBtn = panel.querySelector('#import-contacts-btn');\n  if (importBtn) {\n    on(importBtn as HTMLElement, 'click', () => {\n      toast.info('Import functionality coming soon');\n    });\n  }\n}\n\n/**\n * Load contacts\n */\nasync function loadContacts(panel: HTMLElement, props?: ContactsPanelProps): Promise<void> {\n  const content = panel.querySelector('#contacts-content') as HTMLElement;\n  content.innerHTML = '<div class=\"contacts-loading\">Loading contacts</div>';\n\n  try {\n    const { contacts, total } = await contactsService.getAll({\n      search: currentSearch || undefined,\n      organization: currentFilter.organization,\n      tag: currentFilter.tag,\n    });\n\n    // Filter favorites if needed\n    let filteredContacts = contacts;\n    if (currentFilter.favorites) {\n      filteredContacts = contacts.filter(c => c.isFavorite);\n    }\n\n    allContacts = contacts;\n\n    renderContacts(content, filteredContacts, props);\n    renderFavorites(panel, contacts.filter(c => c.isFavorite), props);\n    updateCount(panel, total);\n    updateFilters(panel, contacts);\n  } catch {\n    content.innerHTML = `\n      <div class=\"contacts-empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n        </svg>\n        <h3>Failed to load contacts</h3>\n        <p>Please try again later</p>\n      </div>\n    `;\n  }\n}\n\n/**\n * Render contacts grid\n */\nfunction renderContacts(container: HTMLElement, contacts: Contact[], props?: ContactsPanelProps): void {\n  if (contacts.length === 0) {\n    container.innerHTML = `\n      <div class=\"contacts-empty-state\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"/>\n        </svg>\n        <h3>${currentSearch ? 'No contacts match your search' : 'No contacts yet'}</h3>\n        <p>${currentSearch ? 'Try a different search term' : 'Add your first contact to get started'}</p>\n        <button class=\"btn-sota primary\" id=\"empty-add-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Add Contact\n        </button>\n      </div>\n    `;\n    \n    const addBtn = container.querySelector('#empty-add-btn');\n    if (addBtn) {\n      on(addBtn as HTMLElement, 'click', () => {\n        showContactModal({ mode: 'create' });\n      });\n    }\n    return;\n  }\n\n  container.innerHTML = `\n    <div class=\"contacts-grid\">\n      ${contacts.map(contact => createContactCard(contact)).join('')}\n    </div>\n  `;\n\n  bindContactCardEvents(container, contacts, props);\n}\n\n/**\n * Create contact card HTML\n */\nfunction createContactCard(contact: Contact): string {\n  const initials = getInitials(contact.name);\n  const hasPhoto = !!(contact.photoUrl || contact.avatarUrl);\n  const photoUrl = contact.photoUrl || contact.avatarUrl;\n  const isSelected = selectedContactIds.has(contact.id);\n\n  return `\n    <div class=\"contact-card-sota ${isSelected ? 'selected' : ''}\" data-id=\"${contact.id}\">\n      <div class=\"contact-select-checkbox ${isSelected ? 'checked' : ''}\" data-action=\"select\" data-id=\"${contact.id}\">\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M5 13l4 4L19 7\"/>\n        </svg>\n      </div>\n      <div class=\"contact-quick-actions\">\n        <button class=\"quick-action-btn favorite ${contact.isFavorite ? 'active' : ''}\" data-action=\"favorite\" data-id=\"${contact.id}\" title=\"Toggle favorite\">\n          <svg fill=\"${contact.isFavorite ? 'currentColor' : 'none'}\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"/>\n          </svg>\n        </button>\n        <button class=\"quick-action-btn\" data-action=\"edit\" data-id=\"${contact.id}\" title=\"Edit contact\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"/>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"contact-card-header\">\n        <div class=\"contact-avatar-sota\">\n          ${hasPhoto \n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\">`\n            : initials\n          }\n        </div>\n        <div class=\"contact-main-info\">\n          <h3 class=\"contact-name-sota\">${escapeHtml(contact.name)}</h3>\n          ${contact.role ? `<span class=\"contact-role-badge\">${escapeHtml(contact.role)}</span>` : ''}\n          ${contact.organization ? `\n            <div class=\"contact-org-sota\">\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4\"/>\n              </svg>\n              ${escapeHtml(contact.organization)}\n            </div>\n          ` : ''}\n        </div>\n      </div>\n\n      <div class=\"contact-details-sota\">\n        ${contact.email ? `\n          <div class=\"contact-detail-item\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\"/>\n            </svg>\n            <span>${escapeHtml(contact.email)}</span>\n          </div>\n        ` : ''}\n        ${contact.phone ? `\n          <div class=\"contact-detail-item\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\"/>\n            </svg>\n            <span>${escapeHtml(contact.phone)}</span>\n          </div>\n        ` : ''}\n      </div>\n\n      ${contact.tags && contact.tags.length > 0 ? `\n        <div class=\"contact-tags-sota\">\n          ${contact.tags.slice(0, 4).map(tag => `<span class=\"contact-tag\">${escapeHtml(tag)}</span>`).join('')}\n          ${contact.tags.length > 4 ? `<span class=\"contact-tag\">+${contact.tags.length - 4}</span>` : ''}\n        </div>\n      ` : ''}\n    </div>\n  `;\n}\n\n/**\n * Bind contact card events\n */\nfunction bindContactCardEvents(container: HTMLElement, contacts: Contact[], props?: ContactsPanelProps): void {\n  const panel = container.closest('.contacts-panel-sota') as HTMLElement;\n\n  // Selection checkbox click\n  container.querySelectorAll('.contact-select-checkbox').forEach(checkbox => {\n    on(checkbox as HTMLElement, 'click', (e) => {\n      e.stopPropagation();\n      const id = checkbox.getAttribute('data-id');\n      if (!id) return;\n\n      const card = checkbox.closest('.contact-card-sota') as HTMLElement;\n      \n      if (selectedContactIds.has(id)) {\n        selectedContactIds.delete(id);\n        checkbox.classList.remove('checked');\n        card.classList.remove('selected');\n      } else {\n        selectedContactIds.add(id);\n        checkbox.classList.add('checked');\n        card.classList.add('selected');\n      }\n\n      if (props) updateSelectionBar(panel, contacts, props);\n    });\n  });\n\n  // Card click (open modal)\n  container.querySelectorAll('.contact-card-sota').forEach(card => {\n    on(card as HTMLElement, 'click', (e) => {\n      // Ignore if clicking quick action buttons or checkbox\n      if ((e.target as HTMLElement).closest('.quick-action-btn')) return;\n      if ((e.target as HTMLElement).closest('.contact-select-checkbox')) return;\n\n      const id = card.getAttribute('data-id');\n      const contact = contacts.find(c => String(c.id) === id);\n      if (contact) {\n        if (props?.onContactClick) {\n          props.onContactClick(contact);\n        } else {\n          showContactModal({\n            mode: 'edit',\n            contact,\n            onSave: () => loadContacts(panel, props),\n          });\n        }\n      }\n    });\n  });\n\n  // Quick action buttons\n  container.querySelectorAll('.quick-action-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async (e) => {\n      e.stopPropagation();\n      const action = btn.getAttribute('data-action');\n      const id = btn.getAttribute('data-id');\n      const contact = contacts.find(c => String(c.id) === id);\n\n      if (!contact) return;\n\n      if (action === 'favorite') {\n        if (props) await toggleFavorite(contact, btn as HTMLElement, panel, props);\n      } else if (action === 'edit') {\n        showContactModal({\n          mode: 'edit',\n          contact,\n          onSave: () => loadContacts(panel, props),\n        });\n      }\n    });\n  });\n}\n\n/**\n * Update selection bar visibility and content\n */\nfunction updateSelectionBar(panel: HTMLElement, contacts: Contact[], props: ContactsPanelProps): void {\n  // Remove existing selection bar\n  const existingBar = document.querySelector('.selection-bar');\n  if (existingBar) existingBar.remove();\n\n  if (selectedContactIds.size < 2) return;\n\n  // Create selection bar\n  const bar = createElement('div', { className: 'selection-bar' });\n  bar.innerHTML = `\n    <span class=\"selection-bar-count\"><span>${selectedContactIds.size}</span> contacts selected</span>\n    <button class=\"selection-bar-btn merge\" id=\"merge-selected-btn\">\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n      </svg>\n      Merge Selected\n    </button>\n    <button class=\"selection-bar-btn cancel\" id=\"cancel-selection-btn\">\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n      </svg>\n      Cancel\n    </button>\n  `;\n\n  document.body.appendChild(bar);\n\n  // Bind events\n  const mergeBtn = bar.querySelector('#merge-selected-btn');\n  const cancelBtn = bar.querySelector('#cancel-selection-btn');\n\n  on(cancelBtn as HTMLElement, 'click', () => {\n    clearSelection(panel);\n  });\n\n  on(mergeBtn as HTMLElement, 'click', async () => {\n    const ids = Array.from(selectedContactIds);\n    \n    // Get selected contacts for confirmation\n    const selectedContacts = contacts.filter(c => selectedContactIds.has(c.id));\n\n    const confirmed = await showMergeConfirmModal(selectedContacts);\n    if (!confirmed) {\n      return;\n    }\n\n    (mergeBtn as HTMLButtonElement).disabled = true;\n    (mergeBtn as HTMLButtonElement).textContent = 'Merging...';\n\n    try {\n      await contactsService.mergeContacts(ids);\n      toast.success(`Merged ${ids.length} contacts successfully`);\n      clearSelection(panel);\n      await loadContacts(panel, props);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Failed to merge contacts';\n      toast.error(message);\n      (mergeBtn as HTMLButtonElement).disabled = false;\n      (mergeBtn as HTMLButtonElement).innerHTML = `\n        <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n        </svg>\n        Merge Selected\n      `;\n    }\n  });\n}\n\n/**\n * Show styled merge confirmation modal\n */\nfunction showMergeConfirmModal(contacts: Contact[]): Promise<boolean> {\n  return new Promise((resolve) => {\n    const overlay = createElement('div', { className: 'merge-confirm-overlay' });\n    \n    const primaryContact = contacts[0];\n    const otherContacts = contacts.slice(1);\n    \n    overlay.innerHTML = `\n      <style>\n        .merge-confirm-overlay {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background: rgba(0, 0, 0, 0.6);\n          backdrop-filter: blur(4px);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          z-index: 10000;\n          animation: fadeIn 0.2s ease;\n        }\n        \n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        \n        .merge-confirm-modal {\n          background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.95) 100%);\n          border-radius: 16px;\n          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n          max-width: 480px;\n          width: 90%;\n          overflow: hidden;\n          animation: slideUp 0.3s ease;\n        }\n        \n        @keyframes slideUp {\n          from { transform: translateY(20px); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        \n        .merge-confirm-header {\n          background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n          color: white;\n          padding: 20px 24px;\n          display: flex;\n          align-items: center;\n          gap: 12px;\n        }\n        \n        .merge-confirm-header svg {\n          width: 24px;\n          height: 24px;\n        }\n        \n        .merge-confirm-header h3 {\n          margin: 0;\n          font-size: 18px;\n          font-weight: 600;\n        }\n        \n        .merge-confirm-body {\n          padding: 24px;\n        }\n        \n        .merge-confirm-body p {\n          margin: 0 0 16px 0;\n          color: #64748b;\n          font-size: 14px;\n        }\n        \n        .merge-contact-list {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n          margin-bottom: 16px;\n        }\n        \n        .merge-contact-item {\n          display: flex;\n          align-items: center;\n          gap: 12px;\n          padding: 12px;\n          background: #f8fafc;\n          border-radius: 10px;\n          border: 1px solid #e2e8f0;\n        }\n        \n        .merge-contact-item.primary {\n          background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);\n          border-color: #f59e0b;\n        }\n        \n        .merge-contact-avatar {\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-weight: 600;\n          font-size: 14px;\n          flex-shrink: 0;\n        }\n        \n        .merge-contact-avatar img {\n          width: 100%;\n          height: 100%;\n          border-radius: 50%;\n          object-fit: cover;\n        }\n        \n        .merge-contact-info {\n          flex: 1;\n          min-width: 0;\n        }\n        \n        .merge-contact-name {\n          font-weight: 600;\n          color: #1e293b;\n          font-size: 14px;\n          margin-bottom: 2px;\n        }\n        \n        .merge-contact-details {\n          font-size: 12px;\n          color: #64748b;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .merge-contact-badge {\n          background: #f59e0b;\n          color: white;\n          font-size: 10px;\n          font-weight: 600;\n          padding: 4px 8px;\n          border-radius: 6px;\n          text-transform: uppercase;\n        }\n        \n        .merge-warning {\n          display: flex;\n          align-items: flex-start;\n          gap: 10px;\n          padding: 12px;\n          background: #fef3c7;\n          border-radius: 10px;\n          margin-top: 16px;\n        }\n        \n        .merge-warning svg {\n          width: 18px;\n          height: 18px;\n          color: #d97706;\n          flex-shrink: 0;\n          margin-top: 1px;\n        }\n        \n        .merge-warning p {\n          margin: 0;\n          color: #92400e;\n          font-size: 13px;\n          line-height: 1.5;\n        }\n        \n        .merge-confirm-footer {\n          display: flex;\n          gap: 12px;\n          padding: 16px 24px 24px;\n          justify-content: flex-end;\n        }\n        \n        .merge-confirm-btn {\n          padding: 10px 20px;\n          border-radius: 10px;\n          font-size: 14px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.2s ease;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n        \n        .merge-confirm-btn.cancel {\n          background: #f1f5f9;\n          border: 1px solid #e2e8f0;\n          color: #64748b;\n        }\n        \n        .merge-confirm-btn.cancel:hover {\n          background: #e2e8f0;\n        }\n        \n        .merge-confirm-btn.confirm {\n          background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);\n          border: none;\n          color: white;\n          box-shadow: 0 4px 14px rgba(245, 158, 11, 0.4);\n        }\n        \n        .merge-confirm-btn.confirm:hover {\n          transform: translateY(-1px);\n          box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5);\n        }\n        \n        .merge-confirm-btn svg {\n          width: 16px;\n          height: 16px;\n        }\n      </style>\n      \n      <div class=\"merge-confirm-modal\">\n        <div class=\"merge-confirm-header\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n          </svg>\n          <h3>Merge Contacts</h3>\n        </div>\n        \n        <div class=\"merge-confirm-body\">\n          <p>The following contacts will be merged into one:</p>\n          \n          <div class=\"merge-contact-list\">\n            ${contacts.map((c, i) => {\n              const avatar = c.photoUrl || c.avatarUrl || c.photo_url || c.avatar_url;\n              const initials = (c.name || '?').split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n              const detail = c.email || c.organization || c.company || '';\n              \n              return `\n                <div class=\"merge-contact-item ${i === 0 ? 'primary' : ''}\">\n                  <div class=\"merge-contact-avatar\">\n                    ${avatar ? `<img src=\"${avatar}\" alt=\"${c.name}\">` : initials}\n                  </div>\n                  <div class=\"merge-contact-info\">\n                    <div class=\"merge-contact-name\">${c.name || 'Unknown'}</div>\n                    <div class=\"merge-contact-details\">${detail}</div>\n                  </div>\n                  ${i === 0 ? '<span class=\"merge-contact-badge\">Primary</span>' : ''}\n                </div>\n              `;\n            }).join('')}\n          </div>\n          \n          <div class=\"merge-warning\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n            </svg>\n            <p>All information will be combined into the primary contact. Other contacts will be archived. This action cannot be undone.</p>\n          </div>\n        </div>\n        \n        <div class=\"merge-confirm-footer\">\n          <button class=\"merge-confirm-btn cancel\" id=\"merge-cancel-btn\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n            </svg>\n            Cancel\n          </button>\n          <button class=\"merge-confirm-btn confirm\" id=\"merge-confirm-btn\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\"/>\n            </svg>\n            Merge Contacts\n          </button>\n        </div>\n      </div>\n    `;\n    \n    document.body.appendChild(overlay);\n    \n    const cancelBtn = overlay.querySelector('#merge-cancel-btn');\n    const confirmBtn = overlay.querySelector('#merge-confirm-btn');\n    \n    const close = (result: boolean) => {\n      overlay.remove();\n      resolve(result);\n    };\n    \n    on(cancelBtn as HTMLElement, 'click', () => close(false));\n    on(confirmBtn as HTMLElement, 'click', () => close(true));\n    on(overlay, 'click', (e) => {\n      if (e.target === overlay) close(false);\n    });\n    \n    // ESC to close\n    const handleEsc = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        document.removeEventListener('keydown', handleEsc);\n        close(false);\n      }\n    };\n    document.addEventListener('keydown', handleEsc);\n  });\n}\n\n/**\n * Clear selection\n */\nfunction clearSelection(panel: HTMLElement): void {\n  selectedContactIds.clear();\n  \n  // Remove selected class from cards\n  panel.querySelectorAll('.contact-card-sota.selected').forEach(card => {\n    card.classList.remove('selected');\n  });\n  panel.querySelectorAll('.contact-select-checkbox.checked').forEach(checkbox => {\n    checkbox.classList.remove('checked');\n  });\n\n  // Remove selection bar\n  const bar = document.querySelector('.selection-bar');\n  if (bar) bar.remove();\n}\n\n/**\n * Toggle favorite\n */\nasync function toggleFavorite(contact: Contact, btn: HTMLElement, panel: HTMLElement, props: ContactsPanelProps): Promise<void> {\n  const newValue = !contact.isFavorite;\n  \n  try {\n    await http.put(`/api/contacts/${contact.id}`, { is_favorite: newValue });\n    contact.isFavorite = newValue;\n    \n    // Update button visually\n    btn.classList.toggle('active', newValue);\n    const svg = btn.querySelector('svg');\n    if (svg) {\n      svg.setAttribute('fill', newValue ? 'currentColor' : 'none');\n    }\n\n    // Refresh favorites section\n    renderFavorites(panel, allContacts.filter(c => c.isFavorite || (c.id === contact.id && newValue)), props);\n    \n    toast.success(newValue ? 'Added to favorites' : 'Removed from favorites');\n  } catch {\n    toast.error('Failed to update favorite');\n  }\n}\n\n/**\n * Render favorites section\n */\nfunction renderFavorites(panel: HTMLElement, favorites: Contact[], props?: ContactsPanelProps): void {\n  const section = panel.querySelector('#favorites-section') as HTMLElement;\n  const grid = panel.querySelector('#favorites-grid') as HTMLElement;\n\n  if (favorites.length === 0) {\n    section.classList.add('hidden');\n    return;\n  }\n\n  section.classList.remove('hidden');\n  grid.innerHTML = favorites.map(contact => {\n    const initials = getInitials(contact.name);\n    const hasPhoto = !!(contact.photoUrl || contact.avatarUrl);\n    const photoUrl = contact.photoUrl || contact.avatarUrl;\n\n    return `\n      <div class=\"favorite-card\" data-id=\"${contact.id}\">\n        <div class=\"favorite-avatar\">\n          ${hasPhoto \n            ? `<img src=\"${photoUrl}\" alt=\"${escapeHtml(contact.name)}\">`\n            : initials\n          }\n        </div>\n        <div class=\"favorite-info\">\n          <h4>${escapeHtml(contact.name)}</h4>\n          ${contact.organization ? `<p>${escapeHtml(contact.organization)}</p>` : ''}\n        </div>\n      </div>\n    `;\n  }).join('');\n\n  // Bind click events\n  grid.querySelectorAll('.favorite-card').forEach(card => {\n    on(card as HTMLElement, 'click', () => {\n      const id = card.getAttribute('data-id');\n      const contact = favorites.find(c => String(c.id) === id);\n      if (contact) {\n        showContactModal({\n          mode: 'edit',\n          contact,\n          onSave: () => loadContacts(panel, props),\n        });\n      }\n    });\n  });\n}\n\n/**\n * Check for duplicates\n */\nasync function checkDuplicates(panel: HTMLElement): Promise<void> {\n  const alertsContainer = panel.querySelector('#contacts-alerts') as HTMLElement;\n\n  try {\n    const { duplicates } = await contactsService.getDuplicates();\n    \n    if (duplicates.length > 0) {\n      alertsContainer.innerHTML = `\n        <div class=\"alert-sota\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n          </svg>\n          <span><strong>${duplicates.length}</strong> potential duplicate contacts found</span>\n          <button class=\"btn-sota secondary\" id=\"review-duplicates-btn\">Review Duplicates</button>\n        </div>\n      `;\n\n      const reviewBtn = alertsContainer.querySelector('#review-duplicates-btn');\n      if (reviewBtn) {\n        on(reviewBtn as HTMLElement, 'click', () => {\n          showDuplicatesReviewModal(duplicates, panel);\n        });\n      }\n    }\n  } catch {\n    // Ignore errors\n  }\n}\n\n/**\n * Show duplicates review modal\n */\nfunction showDuplicatesReviewModal(duplicateGroups: Contact[][], panel: HTMLElement): void {\n  // Create overlay\n  const overlay = createElement('div', { className: 'duplicates-review-overlay' });\n  \n  overlay.innerHTML = `\n    <style>\n      .duplicates-review-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,0.6);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        animation: fadeIn 0.2s ease;\n      }\n      \n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      \n      .duplicates-modal {\n        background: var(--bg-primary);\n        border-radius: 16px;\n        width: 700px;\n        max-width: 95vw;\n        max-height: 85vh;\n        display: flex;\n        flex-direction: column;\n        box-shadow: 0 25px 60px rgba(0,0,0,0.3);\n        animation: slideUp 0.2s ease;\n      }\n      \n      @keyframes slideUp {\n        from { transform: translateY(20px); opacity: 0; }\n        to { transform: translateY(0); opacity: 1; }\n      }\n      \n      .duplicates-header {\n        padding: 24px;\n        border-bottom: 1px solid var(--border-color);\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n      \n      .duplicates-header h2 {\n        margin: 0;\n        font-size: 20px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n      \n      .duplicates-header h2 svg {\n        width: 24px;\n        height: 24px;\n        color: #f59e0b;\n      }\n      \n      .duplicates-header .close-btn {\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n      }\n      \n      .duplicates-header .close-btn:hover {\n        background: var(--bg-tertiary);\n        border-color: #e11d48;\n      }\n      \n      .duplicates-header .close-btn svg {\n        width: 18px;\n        height: 18px;\n        color: var(--text-secondary);\n      }\n      \n      .duplicates-content {\n        flex: 1;\n        overflow-y: auto;\n        padding: 24px;\n      }\n      \n      .duplicate-group {\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        padding: 16px;\n        margin-bottom: 16px;\n      }\n      \n      .duplicate-group:last-child {\n        margin-bottom: 0;\n      }\n      \n      .duplicate-group-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        margin-bottom: 12px;\n        padding-bottom: 12px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      \n      .duplicate-group-header h4 {\n        margin: 0;\n        font-size: 14px;\n        color: var(--text-secondary);\n      }\n      \n      .merge-group-btn {\n        padding: 8px 16px;\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        color: white;\n        border: none;\n        border-radius: 8px;\n        font-size: 13px;\n        font-weight: 600;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        transition: all 0.2s;\n      }\n      \n      .merge-group-btn:hover {\n        transform: translateY(-1px);\n        box-shadow: 0 4px 12px rgba(225,29,72,0.3);\n      }\n      \n      .merge-group-btn svg {\n        width: 16px;\n        height: 16px;\n      }\n      \n      .duplicate-contacts {\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n      }\n      \n      .duplicate-contact-row {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        padding: 10px 12px;\n        background: var(--bg-primary);\n        border-radius: 8px;\n        border: 1px solid var(--border-color);\n      }\n      \n      .duplicate-contact-row input[type=\"radio\"] {\n        width: 18px;\n        height: 18px;\n        accent-color: #e11d48;\n      }\n      \n      .duplicate-avatar {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #e11d48, #be123c);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 14px;\n        font-weight: 600;\n        color: white;\n        flex-shrink: 0;\n      }\n      \n      .duplicate-info {\n        flex: 1;\n        min-width: 0;\n      }\n      \n      .duplicate-info h5 {\n        margin: 0 0 2px 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n      \n      .duplicate-info p {\n        margin: 0;\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n      \n      .duplicate-aliases {\n        margin-top: 4px;\n        display: flex;\n        gap: 4px;\n        flex-wrap: wrap;\n      }\n      \n      .alias-tag {\n        padding: 2px 6px;\n        background: rgba(99,102,241,0.1);\n        color: #6366f1;\n        border-radius: 4px;\n        font-size: 10px;\n        font-weight: 500;\n      }\n      \n      .duplicates-footer {\n        padding: 16px 24px;\n        border-top: 1px solid var(--border-color);\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n      }\n      \n      .duplicates-footer button {\n        padding: 10px 20px;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n      \n      .duplicates-footer .close-review-btn {\n        background: var(--bg-secondary);\n        border: 1px solid var(--border-color);\n        color: var(--text-primary);\n      }\n      \n      .duplicates-footer .close-review-btn:hover {\n        background: var(--bg-tertiary);\n      }\n      \n      .no-duplicates-msg {\n        text-align: center;\n        padding: 40px;\n        color: var(--text-secondary);\n      }\n      \n      .no-duplicates-msg svg {\n        width: 48px;\n        height: 48px;\n        opacity: 0.4;\n        margin-bottom: 12px;\n      }\n    </style>\n    \n    <div class=\"duplicates-modal\">\n      <div class=\"duplicates-header\">\n        <h2>\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z\"/>\n          </svg>\n          Review Duplicate Contacts\n        </h2>\n        <button class=\"close-btn\" id=\"close-duplicates-btn\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"/>\n          </svg>\n        </button>\n      </div>\n      \n      <div class=\"duplicates-content\" id=\"duplicates-content\">\n        ${duplicateGroups.length === 0 ? `\n          <div class=\"no-duplicates-msg\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n            </svg>\n            <p>No duplicate contacts found</p>\n          </div>\n        ` : duplicateGroups.map((group, groupIndex) => `\n          <div class=\"duplicate-group\" data-group-index=\"${groupIndex}\">\n            <div class=\"duplicate-group-header\">\n              <h4>Potential duplicates (${group.length} contacts)</h4>\n              <button class=\"merge-group-btn\" data-group-index=\"${groupIndex}\">\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n                </svg>\n                Merge All\n              </button>\n            </div>\n            <div class=\"duplicate-contacts\">\n              ${group.map((contact, idx) => `\n                <div class=\"duplicate-contact-row\">\n                  <input type=\"radio\" name=\"primary-${groupIndex}\" value=\"${contact.id}\" ${idx === 0 ? 'checked' : ''}>\n                  <div class=\"duplicate-avatar\">${getInitials(contact.name)}</div>\n                  <div class=\"duplicate-info\">\n                    <h5>${escapeHtml(contact.name)}${idx === 0 ? ' (Primary)' : ''}</h5>\n                    <p>${escapeHtml(contact.email || '')}${contact.organization ? `  ${escapeHtml(contact.organization)}` : ''}</p>\n                    ${(contact.aliases && contact.aliases.length > 0) ? `\n                      <div class=\"duplicate-aliases\">\n                        ${contact.aliases.map(alias => `<span class=\"alias-tag\">${escapeHtml(alias)}</span>`).join('')}\n                      </div>\n                    ` : ''}\n                  </div>\n                </div>\n              `).join('')}\n            </div>\n          </div>\n        `).join('')}\n      </div>\n      \n      <div class=\"duplicates-footer\">\n        <button class=\"close-review-btn\" id=\"close-review-btn\">Close</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  // Close handlers\n  const closeOverlay = () => overlay.remove();\n  \n  const closeBtn = overlay.querySelector('#close-duplicates-btn');\n  const closeReviewBtn = overlay.querySelector('#close-review-btn');\n  \n  if (closeBtn) on(closeBtn as HTMLElement, 'click', closeOverlay);\n  if (closeReviewBtn) on(closeReviewBtn as HTMLElement, 'click', closeOverlay);\n  on(overlay, 'click', (e: Event) => {\n    if (e.target === overlay) closeOverlay();\n  });\n\n  // Merge handlers\n  overlay.querySelectorAll('.merge-group-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const groupIndex = parseInt(btn.getAttribute('data-group-index') || '0');\n      const group = duplicateGroups[groupIndex];\n      \n      if (!group || group.length < 2) return;\n\n      // Get selected primary contact\n      const selectedRadio = overlay.querySelector(`input[name=\"primary-${groupIndex}\"]:checked`) as HTMLInputElement;\n      const primaryId = selectedRadio?.value || group[0].id;\n      \n      // Reorder so primary is first\n      const orderedIds = [primaryId, ...group.filter(c => c.id !== primaryId).map(c => c.id)];\n      \n      (btn as HTMLButtonElement).disabled = true;\n      (btn as HTMLButtonElement).textContent = 'Merging...';\n      \n      try {\n        await contactsService.mergeContacts(orderedIds);\n        toast.success(`Merged ${group.length} contacts successfully`);\n        \n        // Remove this group from the UI\n        const groupEl = overlay.querySelector(`.duplicate-group[data-group-index=\"${groupIndex}\"]`);\n        if (groupEl) groupEl.remove();\n        \n        // Check if no more groups\n        const remainingGroups = overlay.querySelectorAll('.duplicate-group');\n        if (remainingGroups.length === 0) {\n          const content = overlay.querySelector('#duplicates-content');\n          if (content) {\n            content.innerHTML = `\n              <div class=\"no-duplicates-msg\">\n                <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                </svg>\n                <p>All duplicates have been merged!</p>\n              </div>\n            `;\n          }\n        }\n        \n        // Refresh contacts list\n        await loadContacts(panel);\n        \n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'Failed to merge contacts';\n        toast.error(message);\n        (btn as HTMLButtonElement).disabled = false;\n        (btn as HTMLButtonElement).innerHTML = `\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\"/>\n          </svg>\n          Merge All\n        `;\n      }\n    });\n  });\n}\n\n/**\n * Update filters\n */\nfunction updateFilters(panel: HTMLElement, contacts: Contact[]): void {\n  // Organizations\n  const orgFilter = panel.querySelector('#org-filter') as HTMLSelectElement;\n  const orgs = [...new Set(contacts.map(c => c.organization).filter(Boolean))].sort();\n  \n  const currentOrg = orgFilter.value;\n  orgFilter.innerHTML = `\n    <option value=\"\">All Organizations</option>\n    ${orgs.map(org => `<option value=\"${escapeHtml(org!)}\" ${currentOrg === org ? 'selected' : ''}>${escapeHtml(org!)}</option>`).join('')}\n  `;\n\n  // Tags\n  const tagFilter = panel.querySelector('#tag-filter') as HTMLSelectElement;\n  const allTags = contacts.flatMap(c => c.tags || []);\n  const uniqueTags = [...new Set(allTags)].sort();\n  \n  const currentTag = tagFilter.value;\n  tagFilter.innerHTML = `\n    <option value=\"\">All Tags</option>\n    ${uniqueTags.map(tag => `<option value=\"${escapeHtml(tag)}\" ${currentTag === tag ? 'selected' : ''}>${escapeHtml(tag)}</option>`).join('')}\n  `;\n}\n\n/**\n * Export contacts\n */\nasync function exportContacts(): Promise<void> {\n  try {\n    await contactsService.export('json');\n    toast.success('Contacts exported');\n  } catch {\n    toast.error('Failed to export contacts');\n  }\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#contacts-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Get initials\n */\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createContactsPanel;\n","/**\r\n * Teams Panel Component\r\n * Team list with members management\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { teamsService, Team } from '../services/contacts';\r\nimport { showTeamModal } from './modals/TeamModal';\r\nimport { toast } from '../services/toast';\r\n\r\nexport interface TeamsPanelProps {\r\n  onTeamClick?: (team: Team) => void;\r\n}\r\n\r\n/**\r\n * Create teams panel\r\n */\r\nexport function createTeamsPanel(props: TeamsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'teams-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Teams</h2>\r\n        <span class=\"panel-count\" id=\"teams-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-team-btn\">+ Add Team</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"teams-content\">\r\n      <div class=\"loading\">Loading teams...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const addBtn = panel.querySelector('#add-team-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', () => {\r\n      showTeamModal({\r\n        mode: 'create',\r\n        onSave: () => loadTeams(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadTeams(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load teams\r\n */\r\nasync function loadTeams(panel: HTMLElement, props: TeamsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#teams-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const teams = await teamsService.getAll();\r\n    renderTeams(content, teams, props);\r\n    updateCount(panel, teams.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load teams</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render teams\r\n */\r\nfunction renderTeams(container: HTMLElement, teams: Team[], props: TeamsPanelProps): void {\r\n  if (teams.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No teams yet</p>\r\n        <button class=\"btn btn-primary\" id=\"empty-add-btn\">Create Team</button>\r\n      </div>\r\n    `;\r\n    const addBtn = container.querySelector('#empty-add-btn');\r\n    if (addBtn) {\r\n      on(addBtn as HTMLElement, 'click', () => {\r\n        showTeamModal({ mode: 'create' });\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"teams-grid\">\r\n      ${teams.map(team => createTeamCard(team)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.team-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const id = card.getAttribute('data-id');\r\n      const team = teams.find(t => String(t.id) === id);\r\n      if (team) {\r\n        if (props.onTeamClick) {\r\n          props.onTeamClick(team);\r\n        } else {\r\n          showTeamModal({\r\n            mode: 'edit',\r\n            team,\r\n            onSave: () => loadTeams(card.closest('.teams-panel') as HTMLElement, props),\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Create team card HTML\r\n */\r\nfunction createTeamCard(team: Team): string {\r\n  const memberCount = team.memberCount || 0;\r\n  const leadMember = team.memberDetails?.find(m => m.isLead);\r\n\r\n  return `\r\n    <div class=\"team-card\" data-id=\"${team.id}\">\r\n      <div class=\"team-header\">\r\n        <div class=\"team-color\" style=\"--team-color: ${team.color || '#6366f1'}\"></div>\r\n        <div class=\"team-name\">${escapeHtml(team.name)}</div>\r\n        ${team.team_type ? `<span class=\"team-type\">${team.team_type}</span>` : ''}\r\n      </div>\r\n      ${team.description ? `<div class=\"team-description\">${escapeHtml(team.description)}</div>` : ''}\r\n      <div class=\"team-stats\">\r\n        <span class=\"member-count\">${memberCount} member${memberCount !== 1 ? 's' : ''}</span>\r\n        ${leadMember ? `<span class=\"team-lead\">Lead: ${escapeHtml(leadMember.name)}</span>` : ''}\r\n      </div>\r\n      ${team.memberDetails && team.memberDetails.length > 0 ? `\r\n        <div class=\"team-members-preview\">\r\n          ${team.memberDetails.slice(0, 5).map(member => `\r\n            <div class=\"member-avatar\" title=\"${escapeHtml(member.name)}\">\r\n              ${getInitials(member.name)}\r\n            </div>\r\n          `).join('')}\r\n          ${team.memberDetails.length > 5 ? `<div class=\"more-members\">+${team.memberDetails.length - 5}</div>` : ''}\r\n        </div>\r\n      ` : ''}\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#teams-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createTeamsPanel;\r\n","/**\r\n * Org Chart Component\r\n * Interactive organization chart using vis-network\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { contactsService, Contact } from '../services/contacts';\r\nimport { showContactModal } from './modals/ContactModal';\r\n\r\nexport interface OrgChartProps {\r\n  onNodeClick?: (contact: Contact) => void;\r\n}\r\n\r\ninterface OrgNode {\r\n  id: string;\r\n  label: string;\r\n  title: string;\r\n  level: number;\r\n  color?: string;\r\n}\r\n\r\ninterface OrgEdge {\r\n  from: string;\r\n  to: string;\r\n  arrows: string;\r\n}\r\n\r\n// vis.js types - using any for callback params to avoid conflicts with other vis.js declarations\r\ninterface VisNetworkOrgChart {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  on: (event: string, callback: (params: any) => void) => void;\r\n  fit: () => void;\r\n  destroy: () => void;\r\n}\r\n\r\n// Helper to get vis module from window\r\nfunction getVisOrgChart(): { Network: new (container: HTMLElement, data: unknown, options: unknown) => VisNetworkOrgChart; DataSet: new (data: unknown[]) => unknown } | undefined {\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  return (window as any).vis;\r\n}\r\n\r\n/**\r\n * Create org chart\r\n */\r\nexport function createOrgChart(props: OrgChartProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'org-chart' });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"chart-toolbar\">\r\n      <button class=\"btn btn-sm\" id=\"fit-chart-btn\">Fit</button>\r\n      <button class=\"btn btn-sm\" id=\"refresh-chart-btn\">Refresh</button>\r\n    </div>\r\n    <div class=\"chart-container\" id=\"org-chart-container\">\r\n      <div class=\"loading\">Loading org chart...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind toolbar events\r\n  const fitBtn = container.querySelector('#fit-chart-btn');\r\n  if (fitBtn) {\r\n    on(fitBtn as HTMLElement, 'click', () => {\r\n      const network = (container as unknown as { _network?: { fit: () => void } })._network;\r\n      network?.fit();\r\n    });\r\n  }\r\n\r\n  const refreshBtn = container.querySelector('#refresh-chart-btn');\r\n  if (refreshBtn) {\r\n    on(refreshBtn as HTMLElement, 'click', () => loadOrgChart(container, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadOrgChart(container, props);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Load org chart data\r\n */\r\nasync function loadOrgChart(container: HTMLElement, props: OrgChartProps): Promise<void> {\r\n  const chartContainer = container.querySelector('#org-chart-container') as HTMLElement;\r\n  chartContainer.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    // Get contacts with relationships\r\n    const { contacts } = await contactsService.getAll({});\r\n    \r\n    if (contacts.length === 0) {\r\n      chartContainer.innerHTML = `\r\n        <div class=\"empty-state\">\r\n          <p>No contacts to display</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    // Build org chart data\r\n    const { nodes, edges } = buildOrgData(contacts);\r\n\r\n    // Check if vis-network is available\r\n    if (!getVisOrgChart()) {\r\n      renderFallbackChart(chartContainer, contacts, props);\r\n      return;\r\n    }\r\n\r\n    // Create vis-network\r\n    renderVisNetwork(chartContainer, nodes, edges, contacts, props);\r\n  } catch {\r\n    chartContainer.innerHTML = '<div class=\"error\">Failed to load org chart</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Build org chart data from contacts\r\n */\r\nfunction buildOrgData(contacts: Contact[]): { nodes: OrgNode[]; edges: OrgEdge[] } {\r\n  const nodes: OrgNode[] = [];\r\n  const edges: OrgEdge[] = [];\r\n  const levels: Map<string, number> = new Map();\r\n\r\n  // First pass: identify hierarchy\r\n  contacts.forEach(contact => {\r\n    const reportsTo = contact.relationships?.find(r => r.type === 'reports_to');\r\n    if (reportsTo) {\r\n      // Has a manager\r\n      const managerLevel = levels.get(reportsTo.contactId) || 0;\r\n      levels.set(String(contact.id), managerLevel + 1);\r\n    } else {\r\n      // Top level\r\n      levels.set(String(contact.id), 0);\r\n    }\r\n  });\r\n\r\n  // Build nodes\r\n  contacts.forEach(contact => {\r\n    nodes.push({\r\n      id: String(contact.id),\r\n      label: contact.name,\r\n      title: `${contact.name}${contact.role ? `\\n${contact.role}` : ''}${contact.organization ? `\\n${contact.organization}` : ''}`,\r\n      level: levels.get(String(contact.id)) || 0,\r\n      color: contact.teams?.[0]?.color,\r\n    });\r\n  });\r\n\r\n  // Build edges (reports_to relationships)\r\n  contacts.forEach(contact => {\r\n    contact.relationships?.forEach(rel => {\r\n      if (rel.type === 'reports_to') {\r\n        edges.push({\r\n          from: rel.contactId,\r\n          to: String(contact.id),\r\n          arrows: 'to',\r\n        });\r\n      }\r\n    });\r\n  });\r\n\r\n  return { nodes, edges };\r\n}\r\n\r\n/**\r\n * Render vis-network\r\n */\r\nfunction renderVisNetwork(\r\n  container: HTMLElement,\r\n  nodes: OrgNode[],\r\n  edges: OrgEdge[],\r\n  contacts: Contact[],\r\n  props: OrgChartProps\r\n): void {\r\n  container.innerHTML = '';\r\n\r\n  const visNodes = nodes.map(n => ({\r\n    id: n.id,\r\n    label: n.label,\r\n    title: n.title,\r\n    level: n.level,\r\n    color: {\r\n      background: n.color || '#6366f1',\r\n      border: n.color || '#4f46e5',\r\n      highlight: { background: '#818cf8', border: '#6366f1' },\r\n    },\r\n    font: { color: '#ffffff' },\r\n    shape: 'box',\r\n    margin: 10,\r\n  }));\r\n\r\n  const options = {\r\n    layout: {\r\n      hierarchical: {\r\n        direction: 'UD',\r\n        sortMethod: 'directed',\r\n        levelSeparation: 100,\r\n        nodeSpacing: 150,\r\n      },\r\n    },\r\n    nodes: {\r\n      borderWidth: 2,\r\n      shadow: true,\r\n    },\r\n    edges: {\r\n      color: { color: '#9ca3af', highlight: '#6366f1' },\r\n      width: 2,\r\n      smooth: { type: 'cubicBezier' },\r\n    },\r\n    physics: false,\r\n    interaction: {\r\n      hover: true,\r\n      tooltipDelay: 200,\r\n    },\r\n  };\r\n\r\n  const vis = getVisOrgChart()!;\r\n  const network = new vis.Network(container, {\r\n    nodes: new vis.DataSet(visNodes),\r\n    edges: new vis.DataSet(edges),\r\n  }, options);\r\n\r\n  // Store reference for fit button\r\n  (container.closest('.org-chart') as unknown as { _network: typeof network })._network = network;\r\n\r\n  // Node click handler\r\n  network.on('click', (params) => {\r\n    if (params.nodes.length > 0) {\r\n      const nodeId = params.nodes[0];\r\n      const contact = contacts.find(c => String(c.id) === nodeId);\r\n      if (contact) {\r\n        if (props.onNodeClick) {\r\n          props.onNodeClick(contact);\r\n        } else {\r\n          showContactModal({ mode: 'view', contact });\r\n        }\r\n      }\r\n    }\r\n  });\r\n\r\n  network.fit();\r\n}\r\n\r\n/**\r\n * Render fallback chart (when vis-network not available)\r\n */\r\nfunction renderFallbackChart(container: HTMLElement, contacts: Contact[], props: OrgChartProps): void {\r\n  // Group by organization\r\n  const byOrg: Record<string, Contact[]> = {};\r\n  contacts.forEach(c => {\r\n    const org = c.organization || 'Other';\r\n    if (!byOrg[org]) byOrg[org] = [];\r\n    byOrg[org].push(c);\r\n  });\r\n\r\n  container.innerHTML = `\r\n    <div class=\"fallback-org-chart\">\r\n      ${Object.entries(byOrg).map(([org, members]) => `\r\n        <div class=\"org-group\">\r\n          <h4 class=\"org-name\">${escapeHtml(org)}</h4>\r\n          <div class=\"org-members\">\r\n            ${members.map(contact => `\r\n              <div class=\"org-member\" data-id=\"${contact.id}\">\r\n                <div class=\"member-avatar\">${getInitials(contact.name)}</div>\r\n                <div class=\"member-info\">\r\n                  <div class=\"member-name\">${escapeHtml(contact.name)}</div>\r\n                  ${contact.role ? `<div class=\"member-role\">${escapeHtml(contact.role)}</div>` : ''}\r\n                </div>\r\n              </div>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.org-member').forEach(el => {\r\n    on(el as HTMLElement, 'click', () => {\r\n      const id = el.getAttribute('data-id');\r\n      const contact = contacts.find(c => String(c.id) === id);\r\n      if (contact) {\r\n        if (props.onNodeClick) {\r\n          props.onNodeClick(contact);\r\n        } else {\r\n          showContactModal({ mode: 'view', contact });\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get initials\r\n */\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(n => n[0])\r\n    .join('')\r\n    .toUpperCase()\r\n    .slice(0, 2);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createOrgChart;\r\n","/**\r\n * Documents Panel Component - Clean Minimal Design\r\n * Document list with elegant search, filters, and cards\r\n */\r\n\r\nimport { createElement } from '../utils/dom';\r\nimport { documentsService, Document } from '../services/documents';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime, formatFileSize } from '../utils/format';\r\nimport { http } from '../services/api';\r\n\r\nexport interface DocumentsPanelProps {\r\n  onDocumentClick?: (document: Document) => void;\r\n}\r\n\r\ntype StatusFilter = 'processed' | 'pending' | 'failed' | 'deleted' | 'all';\r\ntype TypeFilter = 'all' | 'documents' | 'transcripts' | 'emails' | 'images';\r\ntype SortOption = 'date' | 'name' | 'size';\r\ntype ViewMode = 'grid' | 'list';\r\n\r\nlet currentStatus: StatusFilter = 'processed';\r\nlet currentType: TypeFilter = 'all';\r\nlet currentSort: SortOption = 'date';\r\nlet currentViewMode: ViewMode = 'grid';\r\nlet currentSearch = '';\r\nlet selectedDocuments: Set<string> = new Set();\r\nlet allDocuments: Document[] = [];\r\n\r\n/**\r\n * Create documents panel - Clean Minimal\r\n */\r\nexport function createDocumentsPanel(props: DocumentsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'documents-panel-minimal' });\r\n\r\n  panel.innerHTML = `\r\n    <style>\r\n      .documents-panel-minimal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 100%;\r\n        background: var(--bg-primary);\r\n        padding: 32px;\r\n      }\r\n\r\n      /* Header - Minimal */\r\n      .docs-header-minimal {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        margin-bottom: 32px;\r\n      }\r\n      .docs-title-section {\r\n        display: flex;\r\n        align-items: baseline;\r\n        gap: 16px;\r\n      }\r\n      .docs-title-section h1 {\r\n        margin: 0;\r\n        font-size: 32px;\r\n        font-weight: 700;\r\n        color: var(--text-primary);\r\n      }\r\n      .docs-total-count {\r\n        font-size: 16px;\r\n        color: var(--text-tertiary);\r\n        font-weight: 400;\r\n      }\r\n      .docs-header-actions {\r\n        display: flex;\r\n        gap: 12px;\r\n        align-items: center;\r\n      }\r\n      \r\n      /* View Mode Toggle */\r\n      .view-mode-toggle {\r\n        display: flex;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        padding: 4px;\r\n        gap: 2px;\r\n      }\r\n      .view-mode-btn {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        width: 36px;\r\n        height: 32px;\r\n        border: none;\r\n        background: transparent;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        color: var(--text-tertiary);\r\n        transition: all 0.15s ease;\r\n      }\r\n      .view-mode-btn:hover {\r\n        color: var(--text-primary);\r\n        background: var(--bg-tertiary);\r\n      }\r\n      .view-mode-btn.active {\r\n        background: var(--primary);\r\n        color: white;\r\n      }\r\n      .view-mode-btn svg {\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n\r\n      .btn-minimal {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 10px 20px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n        border: none;\r\n      }\r\n      .btn-minimal.primary {\r\n        background: var(--primary);\r\n        color: white;\r\n      }\r\n      .btn-minimal.primary:hover {\r\n        opacity: 0.9;\r\n        transform: translateY(-1px);\r\n      }\r\n      .btn-minimal.secondary {\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      .btn-minimal.secondary:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      .btn-minimal svg {\r\n        width: 16px;\r\n        height: 16px;\r\n      }\r\n\r\n      /* Search and Filters - Single Line */\r\n      .docs-controls {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        margin-bottom: 24px;\r\n        flex-wrap: wrap;\r\n      }\r\n      .docs-search-minimal {\r\n        flex: 1;\r\n        min-width: 280px;\r\n        max-width: 400px;\r\n        position: relative;\r\n      }\r\n      .docs-search-minimal input {\r\n        width: 100%;\r\n        padding: 12px 16px 12px 44px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        transition: all 0.15s ease;\r\n      }\r\n      .docs-search-minimal input:focus {\r\n        outline: none;\r\n        border-color: var(--primary);\r\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\r\n      }\r\n      .docs-search-minimal input::placeholder {\r\n        color: var(--text-tertiary);\r\n      }\r\n      .docs-search-minimal svg {\r\n        position: absolute;\r\n        left: 14px;\r\n        top: 50%;\r\n        transform: translateY(-50%);\r\n        color: var(--text-tertiary);\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n\r\n      /* Filter Chips */\r\n      .docs-filters {\r\n        display: flex;\r\n        gap: 8px;\r\n        flex-wrap: wrap;\r\n      }\r\n      .filter-chip-minimal {\r\n        padding: 8px 16px;\r\n        border-radius: 20px;\r\n        font-size: 13px;\r\n        font-weight: 500;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-secondary);\r\n        border: 1px solid transparent;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .filter-chip-minimal:hover {\r\n        background: var(--bg-tertiary);\r\n        color: var(--text-primary);\r\n      }\r\n      .filter-chip-minimal.active {\r\n        background: var(--primary);\r\n        color: white;\r\n      }\r\n\r\n      /* Divider with status */\r\n      .docs-status-bar {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 16px 0;\r\n        border-bottom: 1px solid var(--border-color);\r\n        margin-bottom: 24px;\r\n      }\r\n      .status-chip {\r\n        padding: 6px 14px;\r\n        border-radius: 8px;\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n        background: transparent;\r\n        border: none;\r\n        color: var(--text-secondary);\r\n      }\r\n      .status-chip:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      .status-chip.active {\r\n        background: var(--bg-tertiary);\r\n        color: var(--text-primary);\r\n      }\r\n      .status-chip.active.processed { color: #10b981; background: rgba(16, 185, 129, 0.1); }\r\n      .status-chip.active.pending { color: #f59e0b; background: rgba(245, 158, 11, 0.1); }\r\n      .status-chip.active.failed { color: #ef4444; background: rgba(239, 68, 68, 0.1); }\r\n      .status-chip.active.deleted { color: #6b7280; background: rgba(107, 114, 128, 0.1); }\r\n      .status-chip .chip-count {\r\n        margin-left: 6px;\r\n        padding: 2px 6px;\r\n        font-size: 10px;\r\n        background: rgba(0,0,0,0.05);\r\n        border-radius: 6px;\r\n      }\r\n      [data-theme=\"dark\"] .status-chip .chip-count {\r\n        background: rgba(255,255,255,0.1);\r\n      }\r\n      .status-chip.active .chip-count {\r\n        background: rgba(0,0,0,0.1);\r\n      }\r\n      .docs-sort-minimal {\r\n        margin-left: auto;\r\n        padding: 8px 12px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 8px;\r\n        background: var(--bg-secondary);\r\n        font-size: 13px;\r\n        color: var(--text-primary);\r\n        cursor: pointer;\r\n      }\r\n\r\n      /* Documents Grid - Larger Cards */\r\n      .docs-content-minimal {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n      }\r\n      .docs-grid-minimal {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));\r\n        gap: 20px;\r\n      }\r\n      \r\n      /* List View Mode */\r\n      .docs-grid-minimal.list-view {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 8px;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-card-minimal {\r\n        flex-direction: row;\r\n        align-items: center;\r\n        padding: 12px 20px;\r\n        gap: 16px;\r\n        border-radius: 12px;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-card-header {\r\n        flex-shrink: 0;\r\n        gap: 12px;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-card-header .doc-icon {\r\n        width: 40px;\r\n        height: 40px;\r\n        font-size: 18px;\r\n        border-radius: 8px;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-info {\r\n        flex: 1;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 24px;\r\n        min-width: 0;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-filename {\r\n        flex: 1;\r\n        min-width: 0;\r\n        margin: 0;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-meta {\r\n        display: flex;\r\n        gap: 16px;\r\n        color: var(--text-tertiary);\r\n        font-size: 13px;\r\n        flex-shrink: 0;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-status-badge {\r\n        margin: 0;\r\n        flex-shrink: 0;\r\n      }\r\n      .docs-grid-minimal.list-view .doc-summary-section,\r\n      .docs-grid-minimal.list-view .doc-entities-mini,\r\n      .docs-grid-minimal.list-view .doc-card-hover {\r\n        display: none;\r\n      }\r\n\r\n      /* Document Card - Clean Design */\r\n      .doc-card-minimal {\r\n        background: var(--bg-secondary);\r\n        border-radius: 16px;\r\n        border: 1px solid var(--border-color);\r\n        padding: 20px;\r\n        cursor: pointer;\r\n        transition: all 0.2s ease;\r\n        position: relative;\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 16px;\r\n      }\r\n      .doc-card-minimal:hover {\r\n        border-color: rgba(var(--primary-rgb), 0.4);\r\n        box-shadow: 0 8px 24px rgba(0,0,0,0.08);\r\n        transform: translateY(-2px);\r\n      }\r\n      .doc-card-minimal.selected {\r\n        border-color: var(--primary);\r\n        background: rgba(var(--primary-rgb), 0.02);\r\n      }\r\n\r\n      /* Card Header */\r\n      .doc-card-top {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 16px;\r\n      }\r\n      .doc-icon-minimal {\r\n        width: 52px;\r\n        height: 52px;\r\n        border-radius: 14px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n        flex-shrink: 0;\r\n      }\r\n      .doc-icon-minimal.pdf { background: linear-gradient(135deg, #fef2f2, #fee2e2); }\r\n      .doc-icon-minimal.doc { background: linear-gradient(135deg, #eff6ff, #dbeafe); }\r\n      .doc-icon-minimal.img { background: linear-gradient(135deg, #f0fdf4, #dcfce7); }\r\n      .doc-icon-minimal.txt { background: linear-gradient(135deg, #fefce8, #fef9c3); }\r\n      .doc-icon-minimal.default { background: linear-gradient(135deg, #f5f5f5, #e5e5e5); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.pdf { background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.1)); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.doc { background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(59,130,246,0.1)); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.img { background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.1)); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.txt { background: linear-gradient(135deg, rgba(234,179,8,0.15), rgba(234,179,8,0.1)); }\r\n      [data-theme=\"dark\"] .doc-icon-minimal.default { background: linear-gradient(135deg, rgba(107,114,128,0.15), rgba(107,114,128,0.1)); }\r\n\r\n      .doc-info-minimal {\r\n        flex: 1;\r\n        min-width: 0;\r\n      }\r\n      .doc-filename-minimal {\r\n        font-size: 15px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        margin-bottom: 6px;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n      .doc-meta-minimal {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        font-size: 13px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      .doc-meta-minimal .sep {\r\n        color: var(--border-color);\r\n      }\r\n      .doc-status-badge {\r\n        padding: 4px 10px;\r\n        font-size: 11px;\r\n        font-weight: 600;\r\n        border-radius: 6px;\r\n        text-transform: capitalize;\r\n      }\r\n      .doc-status-badge.processed { background: rgba(16, 185, 129, 0.1); color: #10b981; }\r\n      .doc-status-badge.pending { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }\r\n      .doc-status-badge.failed { background: rgba(239, 68, 68, 0.1); color: #ef4444; }\r\n      .doc-status-badge.deleted { background: rgba(107, 114, 128, 0.1); color: #6b7280; }\r\n\r\n      /* Card Summary */\r\n      .doc-summary-minimal {\r\n        font-size: 14px;\r\n        line-height: 1.6;\r\n        color: var(--text-secondary);\r\n        display: -webkit-box;\r\n        -webkit-line-clamp: 2;\r\n        -webkit-box-orient: vertical;\r\n        overflow: hidden;\r\n      }\r\n\r\n      /* Card Footer */\r\n      .doc-card-footer {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding-top: 16px;\r\n        border-top: 1px solid var(--border-color);\r\n      }\r\n      .doc-entities {\r\n        display: flex;\r\n        gap: 16px;\r\n      }\r\n      .doc-entity-item {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .doc-entity-item .icon {\r\n        width: 20px;\r\n        height: 20px;\r\n        border-radius: 6px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 11px;\r\n      }\r\n      .doc-entity-item.facts .icon { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }\r\n      .doc-entity-item.decisions .icon { background: rgba(16, 185, 129, 0.1); color: #10b981; }\r\n      .doc-entity-item.risks .icon { background: rgba(239, 68, 68, 0.1); color: #ef4444; }\r\n\r\n      .doc-actions-minimal {\r\n        display: flex;\r\n        gap: 4px;\r\n        opacity: 0;\r\n        transition: opacity 0.15s ease;\r\n      }\r\n      .doc-card-minimal:hover .doc-actions-minimal {\r\n        opacity: 1;\r\n      }\r\n      .doc-action-btn {\r\n        width: 32px;\r\n        height: 32px;\r\n        border-radius: 8px;\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        cursor: pointer;\r\n        transition: all 0.15s ease;\r\n        color: var(--text-secondary);\r\n        font-size: 14px;\r\n      }\r\n      .doc-action-btn:hover {\r\n        background: var(--primary);\r\n        border-color: var(--primary);\r\n        color: white;\r\n      }\r\n      .doc-action-btn.favorite.active {\r\n        color: #f59e0b;\r\n      }\r\n      .doc-action-btn.favorite:hover {\r\n        background: #f59e0b;\r\n        border-color: #f59e0b;\r\n        color: white;\r\n      }\r\n\r\n      /* Selection */\r\n      .doc-select-checkbox {\r\n        position: absolute;\r\n        top: 16px;\r\n        left: 16px;\r\n        width: 22px;\r\n        height: 22px;\r\n        border-radius: 6px;\r\n        border: 2px solid var(--border-color);\r\n        background: var(--bg-primary);\r\n        cursor: pointer;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        opacity: 0;\r\n        transition: all 0.15s ease;\r\n        font-size: 12px;\r\n        color: white;\r\n      }\r\n      .doc-card-minimal:hover .doc-select-checkbox,\r\n      .doc-card-minimal.selected .doc-select-checkbox {\r\n        opacity: 1;\r\n      }\r\n      .doc-card-minimal.selected .doc-select-checkbox {\r\n        background: var(--primary);\r\n        border-color: var(--primary);\r\n      }\r\n\r\n      /* Selection Bar */\r\n      .selection-bar-minimal {\r\n        position: fixed;\r\n        bottom: 32px;\r\n        left: 50%;\r\n        transform: translateX(-50%);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n        padding: 16px 24px;\r\n        background: #1e293b;\r\n        border-radius: 16px;\r\n        box-shadow: 0 12px 40px rgba(0,0,0,0.25);\r\n        z-index: 100;\r\n        animation: slideUp 0.25s ease;\r\n      }\r\n      @keyframes slideUp {\r\n        from { transform: translateX(-50%) translateY(100px); opacity: 0; }\r\n        to { transform: translateX(-50%) translateY(0); opacity: 1; }\r\n      }\r\n      .selection-bar-minimal.hidden { display: none; }\r\n      .selection-count-minimal {\r\n        color: white;\r\n        font-weight: 600;\r\n        padding-right: 16px;\r\n        border-right: 1px solid rgba(255,255,255,0.2);\r\n      }\r\n      .selection-count-minimal span { color: #60a5fa; }\r\n      .selection-bar-minimal .btn-minimal {\r\n        padding: 8px 16px;\r\n        font-size: 13px;\r\n      }\r\n      .selection-bar-minimal .btn-minimal.secondary {\r\n        background: rgba(255,255,255,0.1);\r\n        color: white;\r\n        border-color: transparent;\r\n      }\r\n      .selection-bar-minimal .btn-minimal.secondary:hover {\r\n        background: rgba(255,255,255,0.2);\r\n      }\r\n      .selection-bar-minimal .btn-minimal.danger {\r\n        background: #ef4444;\r\n        color: white;\r\n        border: none;\r\n      }\r\n\r\n      /* Empty State */\r\n      .docs-empty-minimal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 80px 40px;\r\n        text-align: center;\r\n        grid-column: 1 / -1;\r\n      }\r\n      .docs-empty-minimal .empty-icon {\r\n        width: 80px;\r\n        height: 80px;\r\n        border-radius: 24px;\r\n        background: var(--bg-tertiary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 36px;\r\n        margin-bottom: 24px;\r\n      }\r\n      .docs-empty-minimal h3 {\r\n        margin: 0 0 8px 0;\r\n        font-size: 20px;\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n      }\r\n      .docs-empty-minimal p {\r\n        margin: 0 0 24px 0;\r\n        color: var(--text-secondary);\r\n      }\r\n\r\n      /* Loading */\r\n      .docs-loading {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        padding: 60px;\r\n        grid-column: 1 / -1;\r\n        color: var(--text-secondary);\r\n        gap: 12px;\r\n      }\r\n      .docs-loading::after {\r\n        content: '';\r\n        width: 20px;\r\n        height: 20px;\r\n        border: 2px solid var(--border-color);\r\n        border-top-color: var(--primary);\r\n        border-radius: 50%;\r\n        animation: spin 0.8s linear infinite;\r\n      }\r\n      @keyframes spin {\r\n        to { transform: rotate(360deg); }\r\n      }\r\n      \r\n      /* Accessibility: Screen reader only content */\r\n      .visually-hidden {\r\n        position: absolute;\r\n        width: 1px;\r\n        height: 1px;\r\n        padding: 0;\r\n        margin: -1px;\r\n        overflow: hidden;\r\n        clip: rect(0, 0, 0, 0);\r\n        white-space: nowrap;\r\n        border: 0;\r\n      }\r\n      \r\n      /* Focus styles for keyboard navigation */\r\n      .doc-card-minimal:focus {\r\n        outline: 2px solid var(--primary);\r\n        outline-offset: 2px;\r\n      }\r\n      .doc-card-minimal:focus-visible {\r\n        outline: 2px solid var(--primary);\r\n        outline-offset: 2px;\r\n      }\r\n    </style>\r\n    \r\n    <!-- Header -->\r\n    <div class=\"docs-header-minimal\">\r\n      <div class=\"docs-title-section\">\r\n        <h1>Files</h1>\r\n        <span class=\"docs-total-count\"><span id=\"total-count\">0</span> documents</span>\r\n      </div>\r\n      <div class=\"docs-header-actions\">\r\n        <!-- View Mode Toggle -->\r\n        <div class=\"view-mode-toggle\">\r\n          <button class=\"view-mode-btn active\" data-view=\"grid\" title=\"Grid view\">\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\"/>\r\n              <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\"/>\r\n              <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\"/>\r\n              <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\"/>\r\n            </svg>\r\n          </button>\r\n          <button class=\"view-mode-btn\" data-view=\"list\" title=\"List view\">\r\n            <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <line x1=\"8\" y1=\"6\" x2=\"21\" y2=\"6\"/>\r\n              <line x1=\"8\" y1=\"12\" x2=\"21\" y2=\"12\"/>\r\n              <line x1=\"8\" y1=\"18\" x2=\"21\" y2=\"18\"/>\r\n              <line x1=\"3\" y1=\"6\" x2=\"3.01\" y2=\"6\"/>\r\n              <line x1=\"3\" y1=\"12\" x2=\"3.01\" y2=\"12\"/>\r\n              <line x1=\"3\" y1=\"18\" x2=\"3.01\" y2=\"18\"/>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n        <button class=\"btn-minimal primary\" id=\"upload-btn\">\r\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n            <polyline points=\"17 8 12 3 7 8\"/>\r\n            <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\r\n          </svg>\r\n          Upload\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Controls -->\r\n    <div class=\"docs-controls\" role=\"search\">\r\n      <div class=\"docs-search-minimal\">\r\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" aria-hidden=\"true\">\r\n          <circle cx=\"11\" cy=\"11\" r=\"8\"/>\r\n          <path d=\"m21 21-4.3-4.3\"/>\r\n        </svg>\r\n        <input type=\"text\" id=\"docs-search-input\" placeholder=\"Search files...\" \r\n               aria-label=\"Search files\" autocomplete=\"off\">\r\n      </div>\r\n      <div class=\"docs-filters\" role=\"tablist\" aria-label=\"Filter by document type\">\r\n        <button class=\"filter-chip-minimal active\" data-type=\"all\" role=\"tab\" aria-selected=\"true\">All</button>\r\n        <button class=\"filter-chip-minimal\" data-type=\"documents\" role=\"tab\" aria-selected=\"false\">Documents</button>\r\n        <button class=\"filter-chip-minimal\" data-type=\"transcripts\" role=\"tab\" aria-selected=\"false\">Transcripts</button>\r\n        <button class=\"filter-chip-minimal\" data-type=\"emails\" role=\"tab\" aria-selected=\"false\">Emails</button>\r\n        <button class=\"filter-chip-minimal\" data-type=\"images\" role=\"tab\" aria-selected=\"false\">Images</button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Status Bar -->\r\n    <div class=\"docs-status-bar\" role=\"tablist\" aria-label=\"Filter by status\">\r\n      <button class=\"status-chip active processed\" data-status=\"processed\" role=\"tab\" aria-selected=\"true\">\r\n        Processed <span class=\"chip-count\" id=\"count-processed\" aria-label=\"count\">0</span>\r\n      </button>\r\n      <button class=\"status-chip pending\" data-status=\"pending\" role=\"tab\" aria-selected=\"false\">\r\n        Pending <span class=\"chip-count\" id=\"count-pending\" aria-label=\"count\">0</span>\r\n      </button>\r\n      <button class=\"status-chip failed\" data-status=\"failed\" role=\"tab\" aria-selected=\"false\">\r\n        Failed <span class=\"chip-count\" id=\"count-failed\" aria-label=\"count\">0</span>\r\n      </button>\r\n      <button class=\"status-chip deleted\" data-status=\"deleted\" role=\"tab\" aria-selected=\"false\">\r\n        Deleted <span class=\"chip-count\" id=\"count-deleted\" aria-label=\"count\">0</span>\r\n      </button>\r\n      <label for=\"sort-select\" class=\"visually-hidden\">Sort order</label>\r\n      <select class=\"docs-sort-minimal\" id=\"sort-select\" aria-label=\"Sort files\">\r\n        <option value=\"date\">Newest first</option>\r\n        <option value=\"name\">Name A-Z</option>\r\n        <option value=\"size\">Largest first</option>\r\n      </select>\r\n    </div>\r\n\r\n    <!-- Content -->\r\n    <div class=\"docs-content-minimal\" role=\"main\">\r\n      <div class=\"docs-grid-minimal\" id=\"docs-grid\" role=\"list\" aria-label=\"Document list\" tabindex=\"0\">\r\n        <div class=\"docs-loading\" aria-live=\"polite\">Loading files</div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Selection Bar -->\r\n    <div class=\"selection-bar-minimal hidden\" id=\"selection-bar\" role=\"toolbar\" aria-label=\"Bulk actions\">\r\n      <span class=\"selection-count-minimal\" aria-live=\"polite\"><span id=\"selected-count\">0</span> selected</span>\r\n      <button class=\"btn-minimal secondary\" id=\"bulk-export-btn\" aria-label=\"Export selected files\">Export</button>\r\n      <button class=\"btn-minimal secondary\" id=\"bulk-reprocess-btn\" aria-label=\"Reprocess selected files\">Reprocess</button>\r\n      <button class=\"btn-minimal danger\" id=\"bulk-delete-btn\" aria-label=\"Delete selected files\">Delete</button>\r\n      <button class=\"btn-minimal secondary\" id=\"cancel-selection-btn\" aria-label=\"Cancel selection\">Cancel</button>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  bindPanelEvents(panel, props);\r\n  \r\n  // Initial load\r\n  loadDocuments(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Bind panel events\r\n */\r\nfunction bindPanelEvents(panel: HTMLElement, props: DocumentsPanelProps): void {\r\n  // Upload button\r\n  panel.querySelector('#upload-btn')?.addEventListener('click', async () => {\r\n    const { showFileUploadModal } = await import('./modals/FileUploadModal');\r\n    showFileUploadModal({ onComplete: () => loadDocuments(panel, props) });\r\n  });\r\n\r\n  // Search with server-side filtering and 500ms debounce\r\n  const searchInput = panel.querySelector('#docs-search-input') as HTMLInputElement;\r\n  let searchTimeout: ReturnType<typeof setTimeout>;\r\n  searchInput?.addEventListener('input', () => {\r\n    clearTimeout(searchTimeout);\r\n    searchTimeout = setTimeout(() => {\r\n      const newSearch = searchInput.value.trim();\r\n      if (newSearch !== currentSearch) {\r\n        currentSearch = newSearch;\r\n        // Trigger server-side search if query is 2+ chars or empty\r\n        if (currentSearch.length >= 2 || currentSearch.length === 0) {\r\n          loadDocuments(panel, props);\r\n        }\r\n      }\r\n    }, 500); // Increased debounce for better UX\r\n  });\r\n\r\n  // Sort select\r\n  panel.querySelector('#sort-select')?.addEventListener('change', (e) => {\r\n    currentSort = (e.target as HTMLSelectElement).value as SortOption;\r\n    renderFilteredDocuments(panel, props);\r\n  });\r\n\r\n  // Type filters\r\n  panel.querySelectorAll('.filter-chip-minimal').forEach(chip => {\r\n    chip.addEventListener('click', () => {\r\n      panel.querySelectorAll('.filter-chip-minimal').forEach(c => c.classList.remove('active'));\r\n      chip.classList.add('active');\r\n      currentType = chip.getAttribute('data-type') as TypeFilter;\r\n      renderFilteredDocuments(panel, props);\r\n    });\r\n  });\r\n\r\n  // Status chips\r\n  panel.querySelectorAll('.status-chip').forEach(chip => {\r\n    chip.addEventListener('click', () => {\r\n      panel.querySelectorAll('.status-chip').forEach(c => c.classList.remove('active'));\r\n      chip.classList.add('active');\r\n      currentStatus = chip.getAttribute('data-status') as StatusFilter;\r\n      loadDocuments(panel, props);\r\n    });\r\n  });\r\n\r\n  // View mode toggle\r\n  panel.querySelectorAll('.view-mode-btn').forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      panel.querySelectorAll('.view-mode-btn').forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n      currentViewMode = btn.getAttribute('data-view') as ViewMode;\r\n      \r\n      const grid = panel.querySelector('#docs-grid');\r\n      if (grid) {\r\n        if (currentViewMode === 'list') {\r\n          grid.classList.add('list-view');\r\n        } else {\r\n          grid.classList.remove('list-view');\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bulk actions\r\n  panel.querySelector('#bulk-delete-btn')?.addEventListener('click', () => bulkDelete(panel, props));\r\n  panel.querySelector('#bulk-export-btn')?.addEventListener('click', () => bulkExport());\r\n  panel.querySelector('#bulk-reprocess-btn')?.addEventListener('click', () => bulkReprocess(panel, props));\r\n  panel.querySelector('#cancel-selection-btn')?.addEventListener('click', () => {\r\n    selectedDocuments.clear();\r\n    updateSelection(panel);\r\n  });\r\n}\r\n\r\n/**\r\n * Load documents\r\n */\r\nasync function loadDocuments(panel: HTMLElement, props: DocumentsPanelProps): Promise<void> {\r\n  const grid = panel.querySelector('#docs-grid') as HTMLElement;\r\n  grid.innerHTML = '<div class=\"docs-loading\" aria-live=\"polite\">Loading files</div>';\r\n\r\n  try {\r\n    // Use server-side filtering for better performance\r\n    const result = await documentsService.getAll({\r\n      status: currentStatus === 'all' ? undefined : currentStatus,\r\n      type: currentType === 'all' ? undefined : currentType,\r\n      search: currentSearch || undefined,\r\n      sort: currentSort === 'date' ? 'created_at' : currentSort === 'name' ? 'filename' : undefined,\r\n      order: currentSort === 'date' ? 'desc' : 'asc',\r\n      limit: 100 // Load more items for better UX\r\n    });\r\n    \r\n    allDocuments = result.documents || [];\r\n    \r\n    console.log('%c[DocumentsPanel] Load result:', 'color: green; font-weight: bold', { \r\n      total: result.total, \r\n      docsCount: allDocuments.length,\r\n      firstDoc: allDocuments[0],\r\n      currentStatus,\r\n      currentType\r\n    });\r\n    \r\n    // Update counts\r\n    const statuses = result.statuses || {};\r\n    panel.querySelector('#total-count')!.textContent = String(result.total || allDocuments.length);\r\n    panel.querySelector('#count-processed')!.textContent = String(statuses.processed || 0);\r\n    panel.querySelector('#count-pending')!.textContent = String((statuses.pending || 0) + (statuses.processing || 0));\r\n    panel.querySelector('#count-failed')!.textContent = String(statuses.failed || 0);\r\n    panel.querySelector('#count-deleted')!.textContent = String(statuses.deleted || 0);\r\n    \r\n    renderFilteredDocuments(panel, props);\r\n  } catch (err) {\r\n    console.error('[DocumentsPanel] Failed to load:', err);\r\n    grid.innerHTML = '<div class=\"docs-empty-minimal\"><div class=\"empty-icon\">!</div><h3>Failed to load files</h3><p>Please try again</p></div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render filtered documents\r\n * Note: Server-side filtering is used for status, type, and search.\r\n * This function now handles only local sorting for size (server doesn't support size sort).\r\n */\r\nfunction renderFilteredDocuments(panel: HTMLElement, props: DocumentsPanelProps): void {\r\n  let filtered = [...allDocuments];\r\n  \r\n  // Only need to handle size sorting locally (server handles date and name)\r\n  if (currentSort === 'size') {\r\n    filtered.sort((a, b) => (b.size || 0) - (a.size || 0));\r\n  }\r\n  \r\n  renderDocumentsGrid(panel, filtered, props);\r\n}\r\n\r\n/**\r\n * Get document type from filename\r\n */\r\nfunction getDocType(filename: string): string {\r\n  const ext = filename.split('.').pop()?.toLowerCase();\r\n  if (['pdf', 'doc', 'docx', 'txt', 'md', 'rtf'].includes(ext || '')) return 'document';\r\n  if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp'].includes(ext || '')) return 'image';\r\n  if (['eml', 'msg'].includes(ext || '')) return 'email';\r\n  return 'document';\r\n}\r\n\r\n/**\r\n * Render documents grid\r\n */\r\nfunction renderDocumentsGrid(panel: HTMLElement, documents: Document[], props: DocumentsPanelProps): void {\r\n  const grid = panel.querySelector('#docs-grid') as HTMLElement;\r\n  \r\n  if (documents.length === 0) {\r\n    grid.innerHTML = `\r\n      <div class=\"docs-empty-minimal\">\r\n        <div class=\"empty-icon\"></div>\r\n        <h3>No files found</h3>\r\n        <p>Upload files to get started</p>\r\n        <button class=\"btn-minimal primary\" id=\"empty-upload-btn\">Upload Files</button>\r\n      </div>\r\n    `;\r\n    \r\n    grid.querySelector('#empty-upload-btn')?.addEventListener('click', async () => {\r\n      const { showFileUploadModal } = await import('./modals/FileUploadModal');\r\n      showFileUploadModal({ onComplete: () => loadDocuments(panel, props) });\r\n    });\r\n    return;\r\n  }\r\n\r\n  // Add data-index for potential virtual scrolling\r\n  grid.innerHTML = documents.map((doc, index) => createDocumentCard(doc, index)).join('');\r\n  \r\n  // Add total count and scroll height data for virtual scrolling\r\n  grid.setAttribute('data-total', String(documents.length));\r\n\r\n  // Bind card events\r\n  grid.querySelectorAll('.doc-card-minimal').forEach(card => {\r\n    const id = card.getAttribute('data-id')!;\r\n    const doc = documents.find(d => String(d.id) === id);\r\n    \r\n    // Click to preview\r\n    card.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if (target.closest('.doc-select-checkbox') || target.closest('.doc-action-btn')) return;\r\n      \r\n      if (doc && props.onDocumentClick) {\r\n        props.onDocumentClick(doc);\r\n      }\r\n    });\r\n    \r\n    // Keyboard navigation\r\n    card.addEventListener('keydown', (e: KeyboardEvent) => {\r\n      const cards = Array.from(grid.querySelectorAll('.doc-card-minimal'));\r\n      const currentIndex = cards.indexOf(card);\r\n      \r\n      switch (e.key) {\r\n        case 'Enter':\r\n        case ' ':\r\n          e.preventDefault();\r\n          if (doc && props.onDocumentClick) {\r\n            props.onDocumentClick(doc);\r\n          }\r\n          break;\r\n        case 'ArrowDown':\r\n        case 'ArrowRight':\r\n          e.preventDefault();\r\n          if (currentIndex < cards.length - 1) {\r\n            (cards[currentIndex + 1] as HTMLElement).focus();\r\n          }\r\n          break;\r\n        case 'ArrowUp':\r\n        case 'ArrowLeft':\r\n          e.preventDefault();\r\n          if (currentIndex > 0) {\r\n            (cards[currentIndex - 1] as HTMLElement).focus();\r\n          }\r\n          break;\r\n        case 's':\r\n          e.preventDefault();\r\n          // Toggle selection\r\n          if (selectedDocuments.has(id)) {\r\n            selectedDocuments.delete(id);\r\n          } else {\r\n            selectedDocuments.add(id);\r\n          }\r\n          updateSelection(panel);\r\n          break;\r\n        case 'Delete':\r\n        case 'Backspace':\r\n          e.preventDefault();\r\n          if (doc && confirm(`Delete \"${doc.filename}\"?`)) {\r\n            documentsService.delete(id, { softDelete: true }).then(() => {\r\n              toast.success('File deleted');\r\n              loadDocuments(panel, props);\r\n            }).catch(() => toast.error('Failed to delete'));\r\n          }\r\n          break;\r\n      }\r\n    });\r\n    \r\n    // Checkbox for selection\r\n    card.querySelector('.doc-select-checkbox')?.addEventListener('click', (e) => {\r\n      e.stopPropagation();\r\n      if (selectedDocuments.has(id)) {\r\n        selectedDocuments.delete(id);\r\n      } else {\r\n        selectedDocuments.add(id);\r\n      }\r\n      updateSelection(panel);\r\n    });\r\n    \r\n    // Favorite toggle\r\n    card.querySelector('.doc-action-btn.favorite')?.addEventListener('click', async (e) => {\r\n      e.stopPropagation();\r\n      try {\r\n        await http.post(`/api/documents/${id}/favorite`);\r\n        (e.target as HTMLElement).classList.toggle('active');\r\n        toast.success('Updated favorites');\r\n      } catch {\r\n        toast.error('Failed to update favorite');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Create document card HTML\r\n */\r\nfunction createDocumentCard(doc: Document, index = 0): string {\r\n  const iconClass = getIconClass(doc.filename || '');\r\n  const icon = getDocumentIcon(doc.filename || '');\r\n  const isSelected = selectedDocuments.has(doc.id);\r\n  const factsCount = doc.facts_count || 0;\r\n  const decisionsCount = (doc as any).decisions_count || 0;\r\n  const risksCount = (doc as any).risks_count || 0;\r\n\r\n  const entitiesLabel = [\r\n    factsCount > 0 ? `${factsCount} facts` : '',\r\n    decisionsCount > 0 ? `${decisionsCount} decisions` : '',\r\n    risksCount > 0 ? `${risksCount} risks` : ''\r\n  ].filter(Boolean).join(', ') || 'No entities';\r\n  \r\n  return `\r\n    <div class=\"doc-card-minimal ${isSelected ? 'selected' : ''}\" \r\n         data-id=\"${doc.id}\"\r\n         data-index=\"${index}\"\r\n         role=\"listitem\"\r\n         tabindex=\"0\"\r\n         aria-label=\"${escapeHtml(doc.filename || 'Untitled')}. Status: ${doc.status}. ${entitiesLabel}\">\r\n      <div class=\"doc-select-checkbox\" role=\"checkbox\" aria-checked=\"${isSelected}\" aria-label=\"Select document\">${isSelected ? '' : ''}</div>\r\n      \r\n      <div class=\"doc-card-top\">\r\n        <div class=\"doc-icon-minimal ${iconClass}\" aria-hidden=\"true\">${icon}</div>\r\n        <div class=\"doc-info-minimal\">\r\n          <div class=\"doc-filename-minimal\">${escapeHtml(doc.filename || 'Untitled')}</div>\r\n          <div class=\"doc-meta-minimal\">\r\n            <span>${formatFileSize((doc as any).file_size || doc.size || 0)}</span>\r\n            <span class=\"sep\" aria-hidden=\"true\"></span>\r\n            <span>${formatRelativeTime(doc.created_at)}</span>\r\n          </div>\r\n        </div>\r\n        <span class=\"doc-status-badge ${doc.status}\" aria-label=\"Status: ${doc.status}\">${doc.status}</span>\r\n      </div>\r\n      \r\n      ${doc.summary ? `<div class=\"doc-summary-minimal\">${escapeHtml(doc.summary)}</div>` : ''}\r\n      \r\n      <div class=\"doc-card-footer\">\r\n        <div class=\"doc-entities\" aria-label=\"Extracted entities\">\r\n          ${factsCount > 0 ? `<span class=\"doc-entity-item facts\"><span class=\"icon\" aria-hidden=\"true\"></span> ${factsCount} facts</span>` : ''}\r\n          ${decisionsCount > 0 ? `<span class=\"doc-entity-item decisions\"><span class=\"icon\" aria-hidden=\"true\"></span> ${decisionsCount}</span>` : ''}\r\n          ${risksCount > 0 ? `<span class=\"doc-entity-item risks\"><span class=\"icon\" aria-hidden=\"true\"></span> ${risksCount}</span>` : ''}\r\n          ${factsCount === 0 && decisionsCount === 0 && risksCount === 0 ? '<span class=\"doc-entity-item text-muted\">No entities</span>' : ''}\r\n        </div>\r\n        <div class=\"doc-actions-minimal\">\r\n          <button class=\"doc-action-btn favorite ${(doc as any).is_favorite ? 'active' : ''}\" \r\n                  title=\"Favorite\" aria-label=\"${(doc as any).is_favorite ? 'Remove from favorites' : 'Add to favorites'}\"\r\n                  aria-pressed=\"${(doc as any).is_favorite ? 'true' : 'false'}\"></button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get icon class based on file type\r\n */\r\nfunction getIconClass(filename: string): string {\r\n  const ext = filename.split('.').pop()?.toLowerCase();\r\n  switch (ext) {\r\n    case 'pdf': return 'pdf';\r\n    case 'doc':\r\n    case 'docx': return 'doc';\r\n    case 'jpg':\r\n    case 'jpeg':\r\n    case 'png':\r\n    case 'gif': return 'img';\r\n    case 'txt':\r\n    case 'md': return 'txt';\r\n    default: return 'default';\r\n  }\r\n}\r\n\r\n/**\r\n * Update selection state\r\n */\r\nfunction updateSelection(panel: HTMLElement): void {\r\n  const count = selectedDocuments.size;\r\n  const selectionBar = panel.querySelector('#selection-bar') as HTMLElement;\r\n  \r\n  selectionBar.classList.toggle('hidden', count === 0);\r\n  panel.querySelector('#selected-count')!.textContent = String(count);\r\n  \r\n  // Update card states\r\n  panel.querySelectorAll('.doc-card-minimal').forEach(card => {\r\n    const id = card.getAttribute('data-id')!;\r\n    const isSelected = selectedDocuments.has(id);\r\n    card.classList.toggle('selected', isSelected);\r\n    const checkbox = card.querySelector('.doc-select-checkbox');\r\n    if (checkbox) checkbox.textContent = isSelected ? '' : '';\r\n  });\r\n}\r\n\r\n/**\r\n * Show loading overlay on panel\r\n */\r\nfunction showLoadingOverlay(panel: HTMLElement, message: string): HTMLElement {\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'bulk-loading-overlay';\r\n  overlay.innerHTML = `\r\n    <div class=\"bulk-loading-content\">\r\n      <div class=\"bulk-loading-spinner\"></div>\r\n      <div class=\"bulk-loading-message\">${message}</div>\r\n      <div class=\"bulk-loading-progress\" id=\"bulk-progress\"></div>\r\n    </div>\r\n  `;\r\n  const content = overlay.querySelector('.bulk-loading-content') as HTMLElement;\r\n  panel.classList.add('position-relative');\r\n  panel.appendChild(overlay);\r\n  return overlay;\r\n}\r\n\r\n/**\r\n * Hide loading overlay\r\n */\r\nfunction hideLoadingOverlay(overlay: HTMLElement): void {\r\n  overlay?.remove();\r\n}\r\n\r\n/**\r\n * Disable bulk action buttons\r\n */\r\nfunction setBulkButtonsDisabled(panel: HTMLElement, disabled: boolean): void {\r\n  const buttons = panel.querySelectorAll('#bulk-delete-btn, #bulk-export-btn, #bulk-reprocess-btn');\r\n  buttons.forEach(btn => {\r\n    (btn as HTMLButtonElement).disabled = disabled;\r\n  });\r\n}\r\n\r\n/**\r\n * Bulk delete\r\n */\r\nasync function bulkDelete(panel: HTMLElement, props: DocumentsPanelProps): Promise<void> {\r\n  const count = selectedDocuments.size;\r\n  if (!confirm(`Delete ${count} files? This action can be undone from the Deleted tab.`)) return;\r\n  \r\n  const overlay = showLoadingOverlay(panel, `Deleting ${count} files...`);\r\n  setBulkButtonsDisabled(panel, true);\r\n  \r\n  try {\r\n    const ids = Array.from(selectedDocuments);\r\n    const response = await http.post<{ success: boolean; deleted: number; errors: Array<{ id: string; error: string }> }>(\r\n      '/api/documents/bulk/delete',\r\n      { ids }\r\n    );\r\n    \r\n    const result = response.data;\r\n    if (result.errors && result.errors.length > 0) {\r\n      toast.warning(`Deleted ${result.deleted} files, ${result.errors.length} failed`);\r\n    } else {\r\n      toast.success(`Deleted ${result.deleted} files`);\r\n    }\r\n    \r\n    selectedDocuments.clear();\r\n    loadDocuments(panel, props);\r\n  } catch (err) {\r\n    console.error('[BulkDelete] Error:', err);\r\n    toast.error('Failed to delete files');\r\n  } finally {\r\n    hideLoadingOverlay(overlay);\r\n    setBulkButtonsDisabled(panel, false);\r\n  }\r\n}\r\n\r\n/**\r\n * Bulk export\r\n */\r\nasync function bulkExport(): Promise<void> {\r\n  const count = selectedDocuments.size;\r\n  toast.info(`Preparing export of ${count} files...`);\r\n  \r\n  try {\r\n    const ids = Array.from(selectedDocuments);\r\n    \r\n    // Trigger download via form submission (for ZIP file)\r\n    const response = await http.post<Blob>(\r\n      '/api/documents/bulk/export',\r\n      { ids, format: 'original' },\r\n      { responseType: 'blob' }\r\n    );\r\n    \r\n    // Create download link\r\n    const blob = response.data;\r\n    const url = window.URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `documents-export-${new Date().toISOString().split('T')[0]}.zip`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    window.URL.revokeObjectURL(url);\r\n    \r\n    toast.success(`Exported ${count} files`);\r\n  } catch (err) {\r\n    console.error('[BulkExport] Error:', err);\r\n    toast.error('Failed to export files');\r\n  }\r\n}\r\n\r\n/**\r\n * Bulk reprocess\r\n */\r\nasync function bulkReprocess(panel: HTMLElement, props: DocumentsPanelProps): Promise<void> {\r\n  const count = selectedDocuments.size;\r\n  if (!confirm(`Reprocess ${count} files? This will use AI tokens.`)) return;\r\n  \r\n  const overlay = showLoadingOverlay(panel, `Queuing ${count} files for reprocessing...`);\r\n  setBulkButtonsDisabled(panel, true);\r\n  \r\n  try {\r\n    const ids = Array.from(selectedDocuments);\r\n    const response = await http.post<{ success: boolean; queued: string[]; failed: Array<{ id: string; error: string }> }>(\r\n      '/api/documents/bulk/reprocess',\r\n      { ids }\r\n    );\r\n    \r\n    const result = response.data;\r\n    if (result.failed && result.failed.length > 0) {\r\n      toast.warning(`Queued ${result.queued?.length || 0} files, ${result.failed.length} failed`);\r\n    } else {\r\n      toast.success(`Queued ${result.queued?.length || count} files for reprocessing`);\r\n    }\r\n    \r\n    selectedDocuments.clear();\r\n    updateSelection(panel);\r\n    \r\n    // Reload after a short delay to show updated statuses\r\n    setTimeout(() => loadDocuments(panel, props), 1000);\r\n  } catch (err) {\r\n    console.error('[BulkReprocess] Error:', err);\r\n    toast.error('Failed to queue files for reprocessing');\r\n  } finally {\r\n    hideLoadingOverlay(overlay);\r\n    setBulkButtonsDisabled(panel, false);\r\n  }\r\n}\r\n\r\n/**\r\n * Get document icon\r\n */\r\nfunction getDocumentIcon(filename: string): string {\r\n  const ext = filename.split('.').pop()?.toLowerCase();\r\n  switch (ext) {\r\n    case 'pdf': return '';\r\n    case 'doc':\r\n    case 'docx': return '';\r\n    case 'xls':\r\n    case 'xlsx': return '';\r\n    case 'ppt':\r\n    case 'pptx': return '';\r\n    case 'txt':\r\n    case 'md': return '';\r\n    case 'jpg':\r\n    case 'jpeg':\r\n    case 'png':\r\n    case 'gif': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createDocumentsPanel;\r\n","/**\r\n * Knowledge Panel Component\r\n * Knowledge base management with export, regenerate, status\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { knowledgeService, EmbeddingStatus } from '../services/documents';\r\nimport { toast } from '../services/toast';\r\n\r\nexport interface KnowledgePanelProps {\r\n  onExport?: (format: 'md' | 'json') => void;\r\n}\r\n\r\n/**\r\n * Create knowledge panel\r\n */\r\nexport function createKnowledgePanel(props: KnowledgePanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'knowledge-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <h2>Knowledge Base</h2>\r\n    </div>\r\n    <div class=\"panel-content\">\r\n      <div class=\"knowledge-status\" id=\"knowledge-status\">\r\n        <div class=\"loading\">Loading status...</div>\r\n      </div>\r\n      <div class=\"knowledge-actions\">\r\n        <div class=\"action-group\">\r\n          <h4>Export</h4>\r\n          <div class=\"action-buttons\">\r\n            <button class=\"btn btn-sm\" id=\"export-md-btn\">Export Markdown</button>\r\n            <button class=\"btn btn-sm\" id=\"export-json-btn\">Export JSON</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"action-group\">\r\n          <h4>Maintenance</h4>\r\n          <div class=\"action-buttons\">\r\n            <button class=\"btn btn-sm\" id=\"regenerate-btn\">Regenerate Files</button>\r\n            <button class=\"btn btn-sm\" id=\"synthesize-btn\">Synthesize Facts</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const exportMdBtn = panel.querySelector('#export-md-btn');\r\n  if (exportMdBtn) {\r\n    on(exportMdBtn as HTMLElement, 'click', () => exportKnowledge('md', props));\r\n  }\r\n\r\n  const exportJsonBtn = panel.querySelector('#export-json-btn');\r\n  if (exportJsonBtn) {\r\n    on(exportJsonBtn as HTMLElement, 'click', () => exportKnowledge('json', props));\r\n  }\r\n\r\n  const regenerateBtn = panel.querySelector('#regenerate-btn');\r\n  if (regenerateBtn) {\r\n    on(regenerateBtn as HTMLElement, 'click', () => regenerateKnowledge(panel));\r\n  }\r\n\r\n  const synthesizeBtn = panel.querySelector('#synthesize-btn');\r\n  if (synthesizeBtn) {\r\n    on(synthesizeBtn as HTMLElement, 'click', () => synthesizeFacts(panel));\r\n  }\r\n\r\n  // Load status\r\n  loadStatus(panel);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load embedding status\r\n */\r\nasync function loadStatus(panel: HTMLElement): Promise<void> {\r\n  const container = panel.querySelector('#knowledge-status') as HTMLElement;\r\n\r\n  try {\r\n    const status = await knowledgeService.getStatus();\r\n    renderStatus(container, status);\r\n  } catch {\r\n    container.innerHTML = '<div class=\"error\">Failed to load status</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render status\r\n */\r\nfunction renderStatus(container: HTMLElement, status: EmbeddingStatus): void {\r\n  container.innerHTML = `\r\n    <div class=\"status-grid\">\r\n      <div class=\"status-item\">\r\n        <span class=\"status-label\">Documents Embedded</span>\r\n        <span class=\"status-value\">${status.embedded}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <span class=\"status-label\">Total Chunks</span>\r\n        <span class=\"status-value\">${status.totalChunks}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <span class=\"status-label\">Embedding Model</span>\r\n        <span class=\"status-value\">${status.model || 'Default'}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <span class=\"status-label\">Last Updated</span>\r\n        <span class=\"status-value\">${status.lastUpdated ? formatDate(status.lastUpdated) : 'Never'}</span>\r\n      </div>\r\n    </div>\r\n    ${status.available_embedding_models && status.available_embedding_models.length > 0 ? `\r\n      <div class=\"available-models\">\r\n        <h5>Available Models</h5>\r\n        <div class=\"model-list\">\r\n          ${status.available_embedding_models.map((model: string) => `\r\n            <span class=\"model-badge\">${model}</span>\r\n          `).join('')}\r\n        </div>\r\n      </div>\r\n    ` : ''}\r\n  `;\r\n}\r\n\r\n/**\r\n * Export knowledge base\r\n */\r\nasync function exportKnowledge(format: 'md' | 'json', props: KnowledgePanelProps): Promise<void> {\r\n  if (props.onExport) {\r\n    props.onExport(format);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    if (format === 'md') {\r\n      await knowledgeService.exportMarkdown();\r\n    } else {\r\n      await knowledgeService.exportJson();\r\n    }\r\n    toast.success(`Knowledge base exported as ${format.toUpperCase()}`);\r\n  } catch {\r\n    toast.error('Failed to export knowledge base');\r\n  }\r\n}\r\n\r\n/**\r\n * Regenerate knowledge files\r\n */\r\nasync function regenerateKnowledge(panel: HTMLElement): Promise<void> {\r\n  if (!confirm('This will regenerate all knowledge files. Continue?')) return;\r\n\r\n  const btn = panel.querySelector('#regenerate-btn') as HTMLButtonElement;\r\n  btn.disabled = true;\r\n  btn.textContent = 'Regenerating...';\r\n\r\n  try {\r\n    await knowledgeService.regenerate();\r\n    toast.success('Knowledge files regenerated');\r\n    loadStatus(panel);\r\n  } catch {\r\n    toast.error('Failed to regenerate knowledge files');\r\n  } finally {\r\n    btn.disabled = false;\r\n    btn.textContent = 'Regenerate Files';\r\n  }\r\n}\r\n\r\n/**\r\n * Synthesize facts\r\n */\r\nasync function synthesizeFacts(panel: HTMLElement): Promise<void> {\r\n  if (!confirm('This will consolidate and synthesize facts using AI. This may take a while. Continue?')) return;\r\n\r\n  const btn = panel.querySelector('#synthesize-btn') as HTMLButtonElement;\r\n  btn.disabled = true;\r\n  btn.textContent = 'Synthesizing...';\r\n\r\n  try {\r\n    await knowledgeService.synthesize();\r\n    toast.success('Facts synthesized');\r\n    loadStatus(panel);\r\n  } catch {\r\n    toast.error('Failed to synthesize facts');\r\n  } finally {\r\n    btn.disabled = false;\r\n    btn.textContent = 'Synthesize Facts';\r\n  }\r\n}\r\n\r\n/**\r\n * Format date\r\n */\r\nfunction formatDate(dateStr: string): string {\r\n  const date = new Date(dateStr);\r\n  return date.toLocaleDateString();\r\n}\r\n\r\nexport default createKnowledgePanel;\r\n","/**\n * Conversation Composer Component - SOTA UI\n * Multi-mode conversation/transcript input\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { conversationsService } from '../services/documents';\nimport { toast } from '../services/toast';\n\nexport interface ConversationComposerProps {\n  onImport?: (conversation: unknown) => void;\n  onClose?: () => void;\n}\n\ntype InputMode = 'paste' | 'upload';\nlet currentMode: InputMode = 'paste';\n\n/**\n * Show conversation composer modal\n */\nexport function showConversationComposer(props: ConversationComposerProps = {}): void {\n  const existing = document.getElementById('conversation-composer-overlay');\n  if (existing) existing.remove();\n\n  const overlay = createElement('div', { \n    id: 'conversation-composer-overlay',\n    className: 'composer-overlay' \n  });\n\n  const dialog = createConversationComposer(props);\n  overlay.appendChild(dialog);\n  document.body.appendChild(overlay);\n\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) {\n      closeConversationComposer();\n      props.onClose?.();\n    }\n  });\n\n  requestAnimationFrame(() => overlay.classList.add('visible'));\n}\n\n/**\n * Close conversation composer\n */\nexport function closeConversationComposer(): void {\n  const overlay = document.getElementById('conversation-composer-overlay');\n  if (overlay) {\n    overlay.classList.remove('visible');\n    setTimeout(() => overlay.remove(), 200);\n  }\n}\n\n/**\n * Create conversation composer\n */\nfunction createConversationComposer(props: ConversationComposerProps): HTMLElement {\n  const container = createElement('div', { className: 'composer-modal' });\n\n  container.innerHTML = `\n    <style>\n      .composer-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.5);\n        backdrop-filter: blur(8px);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n      }\n      .composer-overlay.visible {\n        opacity: 1;\n      }\n      .composer-overlay.visible .composer-modal {\n        transform: translateY(0) scale(1);\n        opacity: 1;\n      }\n      .composer-modal {\n        width: 640px;\n        max-width: 95vw;\n        max-height: 85vh;\n        background: var(--bg-primary);\n        border-radius: 16px;\n        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        transform: translateY(20px) scale(0.98);\n        opacity: 0;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n      \n      .composer-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      .composer-header h2 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n      .composer-close {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: var(--text-secondary);\n        transition: all 0.15s ease;\n      }\n      .composer-close:hover {\n        background: var(--bg-tertiary);\n        color: var(--text-primary);\n      }\n      \n      .composer-tabs {\n        display: flex;\n        padding: 0 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-tab {\n        padding: 14px 20px;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        background: none;\n        border: none;\n        cursor: pointer;\n        position: relative;\n        transition: color 0.15s ease;\n      }\n      .composer-tab:hover { color: var(--text-primary); }\n      .composer-tab.active { color: var(--primary); }\n      .composer-tab.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: var(--primary);\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .composer-body {\n        flex: 1;\n        padding: 24px;\n        overflow-y: auto;\n      }\n      \n      .paste-section label {\n        display: block;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 12px;\n      }\n      .paste-section textarea {\n        width: 100%;\n        min-height: 280px;\n        padding: 16px;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-family: 'SF Mono', Monaco, monospace;\n        font-size: 13px;\n        line-height: 1.6;\n        resize: vertical;\n        transition: border-color 0.15s ease, box-shadow 0.15s ease;\n      }\n      .paste-section textarea:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\n      }\n      .paste-section textarea::placeholder { color: var(--text-tertiary); }\n      .paste-hint {\n        margin-top: 12px;\n        font-size: 13px;\n        color: var(--text-tertiary);\n      }\n      \n      .format-row {\n        margin-top: 20px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n      .format-row label {\n        font-size: 13px;\n        color: var(--text-secondary);\n        white-space: nowrap;\n      }\n      .format-row select {\n        flex: 1;\n        max-width: 200px;\n        padding: 10px 14px;\n        border: 1px solid var(--border-color);\n        border-radius: 8px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-size: 13px;\n      }\n      \n      .upload-section .dropzone {\n        border: 2px dashed var(--border-color);\n        border-radius: 16px;\n        padding: 60px 40px;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        background: var(--bg-secondary);\n      }\n      .upload-section .dropzone:hover,\n      .upload-section .dropzone.dragover {\n        border-color: var(--primary);\n        background: rgba(var(--primary-rgb), 0.03);\n      }\n      .dropzone-icon { font-size: 48px; margin-bottom: 16px; }\n      .dropzone-title {\n        font-size: 16px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 8px;\n      }\n      .dropzone-hint { font-size: 13px; color: var(--text-tertiary); }\n      \n      .selected-file {\n        display: none;\n        align-items: center;\n        gap: 16px;\n        margin-top: 20px;\n        padding: 16px;\n        background: var(--bg-secondary);\n        border-radius: 12px;\n        border: 1px solid var(--border-color);\n      }\n      .selected-file.visible { display: flex; }\n      .file-icon {\n        width: 48px;\n        height: 48px;\n        background: linear-gradient(135deg, var(--primary), color-mix(in srgb, var(--primary) 70%, white));\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n      }\n      .file-info { flex: 1; min-width: 0; }\n      .file-name {\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .file-size { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }\n      .file-remove {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: transparent;\n        border-radius: 8px;\n        cursor: pointer;\n        color: var(--text-tertiary);\n        font-size: 18px;\n        transition: all 0.15s ease;\n      }\n      .file-remove:hover {\n        background: rgba(239, 68, 68, 0.1);\n        color: #ef4444;\n      }\n      \n      .preview-area {\n        margin-top: 20px;\n        padding: 16px;\n        background: var(--bg-tertiary);\n        border-radius: 12px;\n        display: none;\n      }\n      .preview-area.visible { display: block; }\n      .preview-area h4 {\n        margin: 0 0 12px 0;\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n      .preview-stats {\n        display: flex;\n        gap: 24px;\n        font-size: 14px;\n      }\n      .preview-stats span { color: var(--text-secondary); }\n      .preview-stats strong { color: var(--text-primary); }\n      \n      .composer-footer {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        padding: 16px 24px;\n        border-top: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-footer .btn {\n        padding: 10px 20px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        border: none;\n      }\n      .composer-footer .btn-secondary {\n        background: var(--bg-primary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      .composer-footer .btn-secondary:hover { background: var(--bg-tertiary); }\n      .composer-footer .btn-outline {\n        background: transparent;\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      .composer-footer .btn-outline:hover { background: var(--bg-tertiary); }\n      .composer-footer .btn-primary {\n        background: var(--primary);\n        color: white;\n      }\n      .composer-footer .btn-primary:hover:not(:disabled) {\n        opacity: 0.9;\n        transform: translateY(-1px);\n      }\n      .composer-footer .btn-primary:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n    </style>\n    \n    <div class=\"composer-header\">\n      <h2>Import Conversation</h2>\n      <button class=\"composer-close\" id=\"close-btn\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M18 6L6 18M6 6l12 12\"/>\n        </svg>\n      </button>\n    </div>\n    \n    <div class=\"composer-tabs\">\n      <button class=\"composer-tab active\" data-mode=\"paste\">Paste Text</button>\n      <button class=\"composer-tab\" data-mode=\"upload\">Upload File</button>\n    </div>\n    \n    <div class=\"composer-body\" id=\"composer-body\">\n      ${renderPasteMode()}\n    </div>\n    \n    <div class=\"composer-footer\">\n      <button class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\n      <button class=\"btn btn-outline\" id=\"preview-btn\" disabled>Preview</button>\n      <button class=\"btn btn-primary\" id=\"import-btn\" disabled>Import</button>\n    </div>\n  `;\n\n  // Bind tabs\n  container.querySelectorAll('.composer-tab').forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      container.querySelectorAll('.composer-tab').forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentMode = tab.getAttribute('data-mode') as InputMode;\n      renderMode(container);\n    });\n  });\n\n  on(container.querySelector('#close-btn') as HTMLElement, 'click', () => {\n    closeConversationComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#cancel-btn') as HTMLElement, 'click', () => {\n    closeConversationComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#preview-btn') as HTMLElement, 'click', () => handlePreview(container));\n  on(container.querySelector('#import-btn') as HTMLElement, 'click', () => handleImport(container, props));\n\n  bindPasteMode(container);\n\n  return container;\n}\n\nfunction renderMode(container: HTMLElement): void {\n  const body = container.querySelector('#composer-body') as HTMLElement;\n  body.innerHTML = currentMode === 'paste' ? renderPasteMode() : renderUploadMode();\n  \n  if (currentMode === 'paste') bindPasteMode(container);\n  else bindUploadMode(container);\n}\n\nfunction renderPasteMode(): string {\n  return `\n    <div class=\"paste-section\">\n      <label>Paste conversation or transcript:</label>\n      <textarea id=\"conversation-input\" placeholder=\"Paste your conversation here...\n\nSupported formats:\n WhatsApp, Slack, Teams, Discord chats\n Meeting transcripts (Zoom, Google Meet)\n Email threads\n Any text with speaker names\n\nExample:\n[10:30] John: Hello everyone\n[10:31] Jane: Hi John!\n[10:32] John: Let's discuss the project...\"></textarea>\n      <p class=\"paste-hint\">Include timestamps and speaker names for better parsing.</p>\n      <div class=\"format-row\">\n        <label>Format:</label>\n        <select id=\"format-select\">\n          <option value=\"\">Auto-detect</option>\n          <option value=\"whatsapp\">WhatsApp</option>\n          <option value=\"slack\">Slack</option>\n          <option value=\"teams\">Microsoft Teams</option>\n          <option value=\"discord\">Discord</option>\n          <option value=\"zoom\">Zoom Transcript</option>\n          <option value=\"generic\">Generic Chat</option>\n        </select>\n      </div>\n    </div>\n    <div class=\"preview-area\" id=\"preview-area\"></div>\n  `;\n}\n\nfunction bindPasteMode(container: HTMLElement): void {\n  const textarea = container.querySelector('#conversation-input') as HTMLTextAreaElement;\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n\n  if (textarea) {\n    on(textarea, 'input', () => {\n      const hasContent = textarea.value.trim().length > 10;\n      previewBtn.disabled = !hasContent;\n      importBtn.disabled = !hasContent;\n    });\n  }\n}\n\nfunction renderUploadMode(): string {\n  return `\n    <div class=\"upload-section\">\n      <div class=\"dropzone\" id=\"file-dropzone\">\n        <div class=\"dropzone-icon\"></div>\n        <p class=\"dropzone-title\">Drop chat file here</p>\n        <p class=\"dropzone-hint\">or click to browse  .txt, .json</p>\n        <input type=\"file\" id=\"file-input\" accept=\".txt,.md,.srt,.vtt,.json\" hidden>\n      </div>\n      <div class=\"selected-file\" id=\"selected-file\">\n        <div class=\"file-icon\"></div>\n        <div class=\"file-info\">\n          <div class=\"file-name\" id=\"file-name\"></div>\n          <div class=\"file-size\" id=\"file-size\"></div>\n        </div>\n        <button class=\"file-remove\" id=\"file-remove\"></button>\n      </div>\n    </div>\n    <div class=\"preview-area\" id=\"preview-area\"></div>\n  `;\n}\n\nfunction bindUploadMode(container: HTMLElement): void {\n  const dropzone = container.querySelector('#file-dropzone') as HTMLElement;\n  const input = container.querySelector('#file-input') as HTMLInputElement;\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n\n  on(dropzone, 'click', () => input.click());\n  on(dropzone, 'dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });\n  on(dropzone, 'dragleave', () => dropzone.classList.remove('dragover'));\n  on(dropzone, 'drop', (e) => {\n    e.preventDefault();\n    dropzone.classList.remove('dragover');\n    if (e.dataTransfer?.files[0]) selectFile(e.dataTransfer.files[0], container);\n  });\n  on(input, 'change', () => { if (input.files?.[0]) selectFile(input.files[0], container); });\n  on(container.querySelector('#file-remove') as HTMLElement, 'click', () => {\n    selectedFile.classList.remove('visible');\n    (container as any)._fileContent = null;\n    previewBtn.disabled = true;\n    importBtn.disabled = true;\n  });\n}\n\nfunction selectFile(file: File, container: HTMLElement): void {\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n  \n  container.querySelector('#file-name')!.textContent = file.name;\n  container.querySelector('#file-size')!.textContent = formatFileSize(file.size);\n  selectedFile.classList.add('visible');\n\n  const reader = new FileReader();\n  reader.onload = () => {\n    (container as any)._fileContent = reader.result;\n    previewBtn.disabled = false;\n    importBtn.disabled = false;\n  };\n  reader.readAsText(file);\n}\n\nfunction getContent(container: HTMLElement): string {\n  if (currentMode === 'paste') {\n    return (container.querySelector('#conversation-input') as HTMLTextAreaElement)?.value || '';\n  }\n  return (container as any)._fileContent || '';\n}\n\nasync function handlePreview(container: HTMLElement): Promise<void> {\n  const previewBtn = container.querySelector('#preview-btn') as HTMLButtonElement;\n  const previewArea = container.querySelector('#preview-area') as HTMLElement;\n  const content = getContent(container);\n  if (!content) return;\n\n  previewBtn.disabled = true;\n  previewBtn.textContent = 'Parsing...';\n\n  try {\n    const result = await conversationsService.parsePreview(content);\n    previewArea.classList.add('visible');\n    previewArea.innerHTML = `\n      <h4>Preview</h4>\n      <div class=\"preview-stats\">\n        <span>Messages: <strong>${result.message_count || 0}</strong></span>\n        <span>Participants: <strong>${result.participants?.length || 0}</strong></span>\n        <span>Format: <strong>${result.format || 'Unknown'}</strong></span>\n      </div>\n    `;\n  } catch {\n    toast.error('Failed to parse conversation');\n  } finally {\n    previewBtn.disabled = false;\n    previewBtn.textContent = 'Preview';\n  }\n}\n\nasync function handleImport(container: HTMLElement, props: ConversationComposerProps): Promise<void> {\n  const importBtn = container.querySelector('#import-btn') as HTMLButtonElement;\n  const content = getContent(container);\n  const formatSelect = container.querySelector('#format-select') as HTMLSelectElement;\n  if (!content) return;\n\n  importBtn.disabled = true;\n  importBtn.textContent = 'Importing...';\n\n  try {\n    const result = await conversationsService.import(content, { formatHint: formatSelect?.value });\n    toast.success('Conversation imported');\n    props.onImport?.(result);\n    closeConversationComposer();\n  } catch {\n    toast.error('Failed to import conversation');\n  } finally {\n    importBtn.disabled = false;\n    importBtn.textContent = 'Import';\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n\nexport default showConversationComposer;\n","/**\r\n * Conversations Panel Component\r\n * Conversation list with import and re-embed\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { conversationsService } from '../services/documents';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\nimport { showConversationComposer } from './ConversationComposer';\r\nimport { showConversationPreviewModal } from './modals/ConversationPreviewModal';\r\n\r\nexport interface ConversationsPanelProps {\r\n  onConversationClick?: (conversation: Conversation) => void;\r\n}\r\n\r\ninterface Conversation {\r\n  id: string;\r\n  title?: string;\r\n  participants?: string[];\r\n  message_count?: number;\r\n  source?: string;\r\n  created_at: string;\r\n  embedded?: boolean;\r\n}\r\n\r\n/**\r\n * Create conversations panel\r\n */\r\nexport function createConversationsPanel(props: ConversationsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'conversations-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Conversations</h2>\r\n        <span class=\"panel-count\" id=\"conversations-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"import-conv-btn\">Import</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"conversations-content\">\r\n      <div class=\"loading\">Loading conversations...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind import button\r\n  const importBtn = panel.querySelector('#import-conv-btn');\r\n  if (importBtn) {\r\n    on(importBtn as HTMLElement, 'click', () => showImportDialog(panel, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadConversations(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load conversations\r\n */\r\nasync function loadConversations(panel: HTMLElement, props: ConversationsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#conversations-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const conversations = await conversationsService.getAll();\r\n    renderConversations(content, conversations, props);\r\n    updateCount(panel, conversations.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load conversations</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render conversations\r\n */\r\nfunction renderConversations(\r\n  container: HTMLElement, \r\n  conversations: Conversation[], \r\n  props: ConversationsPanelProps\r\n): void {\r\n  if (conversations.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No conversations imported</p>\r\n        <p class=\"text-muted\">Import chat transcripts, meeting notes, or message threads</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"conversations-list\">\r\n      ${conversations.map(conv => createConversationCard(conv)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  container.querySelectorAll('.conversation-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', async (e) => {\r\n      if ((e.target as HTMLElement).closest('.conv-actions')) return;\r\n      \r\n      const id = card.getAttribute('data-id');\r\n      const conv = conversations.find(c => c.id === id);\r\n      if (conv) {\r\n        // Fetch full conversation with metadata\r\n        try {\r\n          const fullConv = await conversationsService.getById(id!);\r\n          showConversationPreviewModal(fullConv as any);\r\n        } catch {\r\n          // Fallback to basic data\r\n          showConversationPreviewModal(conv as any);\r\n        }\r\n        \r\n        if (props.onConversationClick) {\r\n          props.onConversationClick(conv);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Re-embed button\r\n    const reembedBtn = card.querySelector('.reembed-btn');\r\n    if (reembedBtn) {\r\n      on(reembedBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        const btn = reembedBtn as HTMLButtonElement;\r\n        btn.disabled = true;\r\n        btn.textContent = 'Processing...';\r\n\r\n        try {\r\n          await conversationsService.reembed(id);\r\n          toast.success('Conversation re-embedded');\r\n          loadConversations(container.closest('.conversations-panel') as HTMLElement, props);\r\n        } catch {\r\n          toast.error('Failed to re-embed conversation');\r\n          btn.disabled = false;\r\n          btn.textContent = 'Re-embed';\r\n        }\r\n      });\r\n    }\r\n\r\n    // Delete button\r\n    const deleteBtn = card.querySelector('.delete-conv-btn');\r\n    if (deleteBtn) {\r\n      on(deleteBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        if (!confirm('Delete this conversation?')) return;\r\n\r\n        try {\r\n          await conversationsService.delete(id);\r\n          toast.success('Conversation deleted');\r\n          loadConversations(container.closest('.conversations-panel') as HTMLElement, props);\r\n        } catch {\r\n          toast.error('Failed to delete conversation');\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Create conversation card HTML\r\n */\r\nfunction createConversationCard(conv: Conversation): string {\r\n  return `\r\n    <div class=\"conversation-card\" data-id=\"${conv.id}\">\r\n      <div class=\"conv-icon\"></div>\r\n      <div class=\"conv-info\">\r\n        <div class=\"conv-title\">${escapeHtml(conv.title || 'Untitled Conversation')}</div>\r\n        <div class=\"conv-meta\">\r\n          ${conv.participants ? `<span>${conv.participants.length} participants</span>` : ''}\r\n          ${conv.message_count ? `<span>${conv.message_count} messages</span>` : ''}\r\n          <span>${formatRelativeTime(conv.created_at)}</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"conv-status\">\r\n        ${conv.embedded \r\n          ? '<span class=\"embedded-badge\">Embedded</span>'\r\n          : '<span class=\"not-embedded-badge\">Not embedded</span>'\r\n        }\r\n      </div>\r\n      <div class=\"conv-actions\">\r\n        <button class=\"btn btn-sm reembed-btn\">Re-embed</button>\r\n        <button class=\"btn btn-sm btn-danger delete-conv-btn\">Delete</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Show import dialog using ConversationComposer\r\n */\r\nfunction showImportDialog(panel: HTMLElement, props: ConversationsPanelProps): void {\r\n  showConversationComposer({\r\n    onImport: () => {\r\n      loadConversations(panel, props);\r\n    },\r\n    onClose: () => {\r\n      // Nothing to do on close\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#conversations-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createConversationsPanel;\r\n","/**\r\n * Emails Panel Component\r\n * Email list with filters and management\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { emailsService, Email } from '../services/emails';\r\nimport { showEmailModal } from './modals/EmailModal';\r\nimport { showEmailPreviewModal } from './modals/EmailPreviewModal';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface EmailsPanelProps {\r\n  onEmailClick?: (email: Email) => void;\r\n}\r\n\r\ntype DirectionFilter = 'all' | 'inbound' | 'outbound' | 'internal';\r\nlet currentDirection: DirectionFilter = 'all';\r\nlet showNeedsResponse = false;\r\n\r\n/**\r\n * Create emails panel\r\n */\r\nexport function createEmailsPanel(props: EmailsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'emails-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Emails</h2>\r\n        <span class=\"panel-count\" id=\"emails-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"direction-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"inbound\">Inbound</option>\r\n          <option value=\"outbound\">Outbound</option>\r\n          <option value=\"internal\">Internal</option>\r\n        </select>\r\n        <label class=\"checkbox-label\">\r\n          <input type=\"checkbox\" id=\"needs-response-filter\"> Needs Response\r\n        </label>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-email-btn\">+ Add Email</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"emails-content\">\r\n      <div class=\"loading\">Loading emails...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const directionFilter = panel.querySelector('#direction-filter') as HTMLSelectElement;\r\n  on(directionFilter, 'change', () => {\r\n    currentDirection = directionFilter.value as DirectionFilter;\r\n    loadEmails(panel, props);\r\n  });\r\n\r\n  const needsResponseFilter = panel.querySelector('#needs-response-filter') as HTMLInputElement;\r\n  on(needsResponseFilter, 'change', () => {\r\n    showNeedsResponse = needsResponseFilter.checked;\r\n    loadEmails(panel, props);\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-email-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', async () => {\r\n      const { createEmailComposer, showEmailComposer } = await import('./EmailComposer');\r\n      showEmailComposer({\r\n        onSave: () => loadEmails(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadEmails(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load emails\r\n */\r\nasync function loadEmails(panel: HTMLElement, props: EmailsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#emails-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    let emails: Email[];\r\n\r\n    if (showNeedsResponse) {\r\n      emails = await emailsService.getNeedingResponse();\r\n    } else {\r\n      const result = await emailsService.getAll({\r\n        direction: currentDirection === 'all' ? undefined : currentDirection,\r\n      });\r\n      emails = result.emails;\r\n    }\r\n\r\n    renderEmails(content, emails, props);\r\n    updateCount(panel, emails.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load emails</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render emails\r\n */\r\nfunction renderEmails(container: HTMLElement, emails: Email[], props: EmailsPanelProps): void {\r\n  if (emails.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No emails found</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"emails-list\">\r\n      ${emails.map(email => createEmailCard(email)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  container.querySelectorAll('.email-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', async (e) => {\r\n      if ((e.target as HTMLElement).closest('.email-actions')) return;\r\n      \r\n      const id = card.getAttribute('data-id');\r\n      const email = emails.find(e => String(e.id) === id);\r\n      if (email) {\r\n        // Fetch full email data with extraction results\r\n        try {\r\n          const fullEmail = await emailsService.getById(id!);\r\n          showEmailPreviewModal(fullEmail as any);\r\n        } catch {\r\n          // Fallback to basic modal\r\n          showEmailPreviewModal(email as any);\r\n        }\r\n        \r\n        if (props.onEmailClick) {\r\n          props.onEmailClick(email);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Mark responded\r\n    const respondedBtn = card.querySelector('.mark-responded-btn');\r\n    if (respondedBtn) {\r\n      on(respondedBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        try {\r\n          await emailsService.markResponded(id);\r\n          toast.success('Marked as responded');\r\n          loadEmails(container.closest('.emails-panel') as HTMLElement, props);\r\n        } catch {\r\n          toast.error('Failed to update email');\r\n        }\r\n      });\r\n    }\r\n\r\n    // Generate response\r\n    const generateBtn = card.querySelector('.generate-response-btn');\r\n    if (generateBtn) {\r\n      on(generateBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        const btn = generateBtn as HTMLButtonElement;\r\n        btn.disabled = true;\r\n        btn.textContent = 'Generating...';\r\n\r\n        try {\r\n          const suggestions = await emailsService.generateResponse(id);\r\n          const draft = suggestions[0]?.response || '';\r\n          toast.success('Response generated');\r\n          \r\n          // Show the generated draft\r\n          const email = emails.find(e => String(e.id) === id);\r\n          if (email) {\r\n            email.draft_response = draft;\r\n            // Open email modal with draft\r\n            showEmailModal({ mode: 'view', email: email as unknown as Parameters<typeof showEmailModal>[0]['email'] });\r\n          }\r\n        } catch {\r\n          toast.error('Failed to generate response');\r\n        } finally {\r\n          btn.disabled = false;\r\n          btn.textContent = 'AI Response';\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Create email card HTML\r\n */\r\nfunction createEmailCard(email: Email): string {\r\n  const directionIcon = email.direction === 'inbound' ? '' : email.direction === 'outbound' ? '' : '';\r\n  const needsResponse = email.requires_response && !email.response_sent;\r\n\r\n  return `\r\n    <div class=\"email-card ${needsResponse ? 'needs-response' : ''}\" data-id=\"${email.id}\">\r\n      <div class=\"email-direction\">${directionIcon}</div>\r\n      <div class=\"email-info\">\r\n        <div class=\"email-header\">\r\n          <span class=\"email-from\">${escapeHtml(email.from_name || email.from_email || email.from || '')}</span>\r\n          <span class=\"email-date\">${formatRelativeTime(email.created_at || email.date || new Date().toISOString())}</span>\r\n        </div>\r\n        <div class=\"email-subject\">${escapeHtml(email.subject || '(No subject)')}</div>\r\n        <div class=\"email-preview\">${escapeHtml(getPreview(email.body_text || ''))}</div>\r\n      </div>\r\n      <div class=\"email-badges\">\r\n        ${needsResponse ? '<span class=\"needs-response-badge\">Needs Response</span>' : ''}\r\n        ${email.response_drafted ? '<span class=\"draft-badge\">Draft Ready</span>' : ''}\r\n        ${email.response_sent ? '<span class=\"responded-badge\">Responded</span>' : ''}\r\n        ${email.ai_summary ? '<span class=\"ai-badge\">AI Analyzed</span>' : ''}\r\n      </div>\r\n      <div class=\"email-actions\">\r\n        ${needsResponse ? `\r\n          <button class=\"btn btn-sm generate-response-btn\">AI Response</button>\r\n          <button class=\"btn btn-sm mark-responded-btn\">Mark Responded</button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get preview text\r\n */\r\nfunction getPreview(text: string, maxLength = 100): string {\r\n  const cleaned = text.replace(/\\s+/g, ' ').trim();\r\n  return cleaned.length > maxLength ? cleaned.slice(0, maxLength) + '...' : cleaned;\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#emails-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createEmailsPanel;\r\n","/**\n * Email Composer Component - SOTA UI\n * Multi-mode email input: paste, upload .eml/.msg, manual entry\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { getSprints } from '../services/sprints';\nimport { getActions } from '../services/actions';\n\nexport interface EmailComposerProps {\n  onSave?: (email: unknown) => void;\n  onClose?: () => void;\n}\n\ntype InputMode = 'paste' | 'upload' | 'manual';\nlet currentMode: InputMode = 'paste';\nlet composerContainer: HTMLElement | null = null;\n\n/**\n * Show email composer\n */\nexport function showEmailComposer(props: EmailComposerProps = {}): void {\n  const existing = document.getElementById('email-composer-overlay');\n  if (existing) existing.remove();\n\n  const overlay = createElement('div', { \n    id: 'email-composer-overlay',\n    className: 'composer-overlay' \n  });\n\n  const dialog = createEmailComposer(props);\n  overlay.appendChild(dialog);\n  document.body.appendChild(overlay);\n\n  on(overlay, 'click', (e) => {\n    if (e.target === overlay) {\n      closeEmailComposer();\n      props.onClose?.();\n    }\n  });\n\n  requestAnimationFrame(() => overlay.classList.add('visible'));\n  composerContainer = dialog;\n}\n\n/**\n * Close email composer\n */\nexport function closeEmailComposer(): void {\n  const overlay = document.getElementById('email-composer-overlay');\n  if (overlay) {\n    overlay.classList.remove('visible');\n    setTimeout(() => overlay.remove(), 200);\n  }\n  composerContainer = null;\n}\n\n/**\n * Create email composer\n */\nexport function createEmailComposer(props: EmailComposerProps = {}): HTMLElement {\n  const container = createElement('div', { className: 'composer-modal' });\n\n  container.innerHTML = `\n    <style>\n      .composer-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0, 0, 0, 0.5);\n        backdrop-filter: blur(8px);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n      }\n      .composer-overlay.visible { opacity: 1; }\n      .composer-overlay.visible .composer-modal {\n        transform: translateY(0) scale(1);\n        opacity: 1;\n      }\n      .composer-modal {\n        width: 640px;\n        max-width: 95vw;\n        max-height: 85vh;\n        background: var(--bg-primary);\n        border-radius: 16px;\n        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        transform: translateY(20px) scale(0.98);\n        opacity: 0;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n      \n      .composer-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 20px 24px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      .composer-header h2 {\n        margin: 0;\n        font-size: 18px;\n        font-weight: 600;\n        color: var(--text-primary);\n      }\n      .composer-close {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: var(--text-secondary);\n        transition: all 0.15s ease;\n      }\n      .composer-close:hover {\n        background: var(--bg-tertiary);\n        color: var(--text-primary);\n      }\n      \n      .composer-tabs {\n        display: flex;\n        padding: 0 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-tab {\n        padding: 14px 20px;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        background: none;\n        border: none;\n        cursor: pointer;\n        position: relative;\n        transition: color 0.15s ease;\n      }\n      .composer-tab:hover { color: var(--text-primary); }\n      .composer-tab.active { color: var(--primary); }\n      .composer-tab.active::after {\n        content: '';\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: var(--primary);\n        border-radius: 2px 2px 0 0;\n      }\n      \n      .composer-body {\n        flex: 1;\n        padding: 24px;\n        overflow-y: auto;\n      }\n      \n      /* Paste Mode */\n      .paste-section label {\n        display: block;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 12px;\n      }\n      .paste-section textarea {\n        width: 100%;\n        min-height: 280px;\n        padding: 16px;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-family: 'SF Mono', Monaco, monospace;\n        font-size: 13px;\n        line-height: 1.6;\n        resize: vertical;\n        transition: border-color 0.15s ease, box-shadow 0.15s ease;\n      }\n      .paste-section textarea:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\n      }\n      .paste-section textarea::placeholder { color: var(--text-tertiary); }\n      .paste-hint {\n        margin-top: 12px;\n        font-size: 13px;\n        color: var(--text-tertiary);\n      }\n      \n      /* Upload Mode */\n      .upload-section .dropzone {\n        border: 2px dashed var(--border-color);\n        border-radius: 16px;\n        padding: 60px 40px;\n        text-align: center;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        background: var(--bg-secondary);\n      }\n      .upload-section .dropzone:hover,\n      .upload-section .dropzone.dragover {\n        border-color: var(--primary);\n        background: rgba(var(--primary-rgb), 0.03);\n      }\n      .dropzone-icon { font-size: 48px; margin-bottom: 16px; }\n      .dropzone-title {\n        font-size: 16px;\n        font-weight: 500;\n        color: var(--text-primary);\n        margin-bottom: 8px;\n      }\n      .dropzone-hint { font-size: 13px; color: var(--text-tertiary); }\n      \n      .selected-file {\n        display: none;\n        align-items: center;\n        gap: 16px;\n        margin-top: 20px;\n        padding: 16px;\n        background: var(--bg-secondary);\n        border-radius: 12px;\n        border: 1px solid var(--border-color);\n      }\n      .selected-file.visible { display: flex; }\n      .file-icon {\n        width: 48px;\n        height: 48px;\n        background: linear-gradient(135deg, #3b82f6, #60a5fa);\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n      }\n      .file-info { flex: 1; min-width: 0; }\n      .file-name {\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-primary);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .file-size { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }\n      .file-remove {\n        width: 32px;\n        height: 32px;\n        border: none;\n        background: transparent;\n        border-radius: 8px;\n        cursor: pointer;\n        color: var(--text-tertiary);\n        font-size: 18px;\n        transition: all 0.15s ease;\n      }\n      .file-remove:hover {\n        background: rgba(239, 68, 68, 0.1);\n        color: #ef4444;\n      }\n      \n      /* Manual Mode */\n      .manual-form {\n        display: flex;\n        flex-direction: column;\n        gap: 20px;\n      }\n      .form-row {\n        display: flex;\n        gap: 16px;\n      }\n      .form-row > .form-group { flex: 1; }\n      .form-group label {\n        display: block;\n        font-size: 13px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        margin-bottom: 8px;\n      }\n      .form-group label .required { color: var(--primary); }\n      .form-group input,\n      .form-group textarea {\n        width: 100%;\n        padding: 12px 14px;\n        border: 1px solid var(--border-color);\n        border-radius: 10px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-size: 14px;\n        transition: border-color 0.15s ease, box-shadow 0.15s ease;\n      }\n      .form-group input:focus,\n      .form-group textarea:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);\n      }\n      .form-group textarea {\n        min-height: 120px;\n        resize: vertical;\n      }\n      .form-group input::placeholder,\n      .form-group textarea::placeholder { color: var(--text-tertiary); }\n      \n      .composer-footer {\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        padding: 16px 24px;\n        border-top: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .composer-footer .btn {\n        padding: 10px 20px;\n        border-radius: 10px;\n        font-size: 14px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.15s ease;\n        border: none;\n      }\n      .composer-footer .btn-secondary {\n        background: var(--bg-primary);\n        color: var(--text-primary);\n        border: 1px solid var(--border-color);\n      }\n      .composer-footer .btn-secondary:hover { background: var(--bg-tertiary); }\n      .composer-footer .btn-primary {\n        background: var(--primary);\n        color: white;\n      }\n      .composer-footer .btn-primary:hover:not(:disabled) {\n        opacity: 0.9;\n        transform: translateY(-1px);\n      }\n      .composer-footer .btn-primary:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n    </style>\n    \n    <div class=\"composer-header\">\n      <h2>Add Email</h2>\n      <button class=\"composer-close\" id=\"close-btn\">\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M18 6L6 18M6 6l12 12\"/>\n        </svg>\n      </button>\n    </div>\n    \n    <div class=\"composer-tabs\">\n      <button class=\"composer-tab active\" data-mode=\"paste\">Paste Text</button>\n      <button class=\"composer-tab\" data-mode=\"upload\">Upload .eml/.msg</button>\n      <button class=\"composer-tab\" data-mode=\"manual\">Manual Entry</button>\n    </div>\n    \n    <div class=\"composer-body\" id=\"composer-body\">\n      ${renderPasteMode()}\n    </div>\n    \n    <div class=\"composer-association\" style=\"padding: 12px 24px; border-top: 1px solid var(--border-color); display: flex; flex-wrap: wrap; gap: 12px; align-items: center;\">\n      <span style=\"font-size: 13px; font-weight: 500; color: var(--text-secondary);\">Associate with (optional)</span>\n      <select id=\"email-sprint-select\" class=\"form-select\" style=\"min-width: 140px;\"><option value=\"\">No sprint</option></select>\n      <select id=\"email-action-select\" class=\"form-select\" style=\"min-width: 180px;\"><option value=\"\">No task</option></select>\n    </div>\n    \n    <div class=\"composer-footer\">\n      <button class=\"btn btn-secondary\" id=\"cancel-btn\">Cancel</button>\n      <button class=\"btn btn-primary\" id=\"save-btn\" disabled>Add Email</button>\n    </div>\n  `;\n\n  // Bind tabs\n  container.querySelectorAll('.composer-tab').forEach(tab => {\n    on(tab as HTMLElement, 'click', () => {\n      container.querySelectorAll('.composer-tab').forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      currentMode = tab.getAttribute('data-mode') as InputMode;\n      renderMode(container);\n    });\n  });\n\n  on(container.querySelector('#close-btn') as HTMLElement, 'click', () => {\n    closeEmailComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#cancel-btn') as HTMLElement, 'click', () => {\n    closeEmailComposer();\n    props.onClose?.();\n  });\n\n  on(container.querySelector('#save-btn') as HTMLElement, 'click', () => saveEmail(container, props));\n\n  bindPasteMode(container);\n  initEmailSprintTask(container);\n\n  return container;\n}\n\nasync function initEmailSprintTask(container: HTMLElement): Promise<void> {\n  const sprintSelect = container.querySelector('#email-sprint-select') as HTMLSelectElement;\n  const actionSelect = container.querySelector('#email-action-select') as HTMLSelectElement;\n  if (!sprintSelect || !actionSelect) return;\n  try {\n    const sprints = await getSprints();\n    sprints.forEach(s => {\n      const opt = document.createElement('option');\n      opt.value = s.id;\n      opt.textContent = s.name;\n      sprintSelect.appendChild(opt);\n    });\n    on(sprintSelect, 'change', async () => {\n      const sprintId = sprintSelect.value || '';\n      actionSelect.innerHTML = '<option value=\"\">No task</option>';\n      if (!sprintId) return;\n      try {\n        const actions = await getActions(undefined, sprintId);\n        actions.forEach(a => {\n          const opt = document.createElement('option');\n          opt.value = String(a.id);\n          opt.textContent = (a.content || a.task || String(a.id)).slice(0, 60) + ((a.content || a.task || '').length > 60 ? '' : '');\n          actionSelect.appendChild(opt);\n        });\n      } catch {\n        // ignore\n      }\n    });\n  } catch {\n    // ignore\n  }\n}\n\nfunction renderMode(container: HTMLElement): void {\n  const body = container.querySelector('#composer-body') as HTMLElement;\n  \n  switch (currentMode) {\n    case 'paste':\n      body.innerHTML = renderPasteMode();\n      bindPasteMode(container);\n      break;\n    case 'upload':\n      body.innerHTML = renderUploadMode();\n      bindUploadMode(container);\n      break;\n    case 'manual':\n      body.innerHTML = renderManualMode();\n      bindManualMode(container);\n      break;\n  }\n}\n\nfunction renderPasteMode(): string {\n  return `\n    <div class=\"paste-section\">\n      <label>Paste email content:</label>\n      <textarea id=\"email-paste\" placeholder=\"Paste the full email content here...\n\nInclude headers if available:\nFrom: sender@example.com\nTo: recipient@example.com\nSubject: Meeting notes\nDate: Jan 31, 2026\n\nEmail body text...\"></textarea>\n      <p class=\"paste-hint\">Include headers (From, To, Subject, Date) for better parsing.</p>\n    </div>\n  `;\n}\n\nfunction bindPasteMode(container: HTMLElement): void {\n  const textarea = container.querySelector('#email-paste') as HTMLTextAreaElement;\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n\n  if (textarea) {\n    on(textarea, 'input', () => {\n      saveBtn.disabled = textarea.value.trim().length < 10;\n    });\n  }\n}\n\nfunction renderUploadMode(): string {\n  return `\n    <div class=\"upload-section\">\n      <div class=\"dropzone\" id=\"file-dropzone\">\n        <div class=\"dropzone-icon\"></div>\n        <p class=\"dropzone-title\">Drop email file here</p>\n        <p class=\"dropzone-hint\">or click to browse  .eml, .msg</p>\n        <input type=\"file\" id=\"file-input\" accept=\".eml,.msg\" hidden>\n      </div>\n      <div class=\"selected-file\" id=\"selected-file\">\n        <div class=\"file-icon\"></div>\n        <div class=\"file-info\">\n          <div class=\"file-name\" id=\"file-name\"></div>\n          <div class=\"file-size\" id=\"file-size\"></div>\n        </div>\n        <button class=\"file-remove\" id=\"file-remove\"></button>\n      </div>\n    </div>\n  `;\n}\n\nfunction bindUploadMode(container: HTMLElement): void {\n  const dropzone = container.querySelector('#file-dropzone') as HTMLElement;\n  const input = container.querySelector('#file-input') as HTMLInputElement;\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n\n  on(dropzone, 'click', () => input.click());\n  on(dropzone, 'dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });\n  on(dropzone, 'dragleave', () => dropzone.classList.remove('dragover'));\n  on(dropzone, 'drop', (e) => {\n    e.preventDefault();\n    dropzone.classList.remove('dragover');\n    if (e.dataTransfer?.files[0]) handleFileSelect(e.dataTransfer.files[0], container);\n  });\n  on(input, 'change', () => { if (input.files?.[0]) handleFileSelect(input.files[0], container); });\n  on(container.querySelector('#file-remove') as HTMLElement, 'click', () => {\n    selectedFile.classList.remove('visible');\n    (container as any)._emlFile = null;\n    saveBtn.disabled = true;\n  });\n}\n\nfunction handleFileSelect(file: File, container: HTMLElement): void {\n  const selectedFile = container.querySelector('#selected-file') as HTMLElement;\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n  \n  container.querySelector('#file-name')!.textContent = file.name;\n  container.querySelector('#file-size')!.textContent = formatFileSize(file.size);\n  selectedFile.classList.add('visible');\n  \n  (container as any)._emlFile = file;\n  saveBtn.disabled = false;\n}\n\nfunction renderManualMode(): string {\n  return `\n    <form class=\"manual-form\" id=\"manual-form\">\n      <div class=\"form-row\">\n        <div class=\"form-group\">\n          <label>From <span class=\"required\">*</span></label>\n          <input type=\"email\" name=\"from\" placeholder=\"sender@example.com\" required>\n        </div>\n        <div class=\"form-group\">\n          <label>Date</label>\n          <input type=\"datetime-local\" name=\"date\">\n        </div>\n      </div>\n      <div class=\"form-group\">\n        <label>To <span class=\"required\">*</span></label>\n        <input type=\"text\" name=\"to\" placeholder=\"recipient@example.com (comma-separated)\" required>\n      </div>\n      <div class=\"form-group\">\n        <label>CC</label>\n        <input type=\"text\" name=\"cc\" placeholder=\"cc@example.com (comma-separated)\">\n      </div>\n      <div class=\"form-group\">\n        <label>Subject</label>\n        <input type=\"text\" name=\"subject\" placeholder=\"Email subject\">\n      </div>\n      <div class=\"form-group\">\n        <label>Body <span class=\"required\">*</span></label>\n        <textarea name=\"body\" placeholder=\"Email content...\" required></textarea>\n      </div>\n    </form>\n  `;\n}\n\nfunction bindManualMode(container: HTMLElement): void {\n  const form = container.querySelector('#manual-form') as HTMLFormElement;\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n\n  const checkValidity = () => {\n    const from = form.querySelector('[name=\"from\"]') as HTMLInputElement;\n    const to = form.querySelector('[name=\"to\"]') as HTMLInputElement;\n    const body = form.querySelector('[name=\"body\"]') as HTMLTextAreaElement;\n    saveBtn.disabled = !from.value || !to.value || !body.value;\n  };\n\n  form.querySelectorAll('input, textarea').forEach(el => {\n    on(el as HTMLElement, 'input', checkValidity);\n  });\n}\n\nasync function fileToBase64(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      const base64 = (reader.result as string).split(',')[1];\n      resolve(base64);\n    };\n    reader.onerror = reject;\n    reader.readAsDataURL(file);\n  });\n}\n\nasync function saveEmail(container: HTMLElement, props: EmailComposerProps): Promise<void> {\n  const saveBtn = container.querySelector('#save-btn') as HTMLButtonElement;\n  saveBtn.disabled = true;\n  saveBtn.textContent = 'Processing...';\n\n  try {\n    let data: Record<string, unknown>;\n\n    switch (currentMode) {\n      case 'paste': {\n        const text = (container.querySelector('#email-paste') as HTMLTextAreaElement).value;\n        data = { emailText: text };\n        break;\n      }\n      case 'upload': {\n        const file = (container as any)._emlFile as File;\n        if (!file) throw new Error('No file selected');\n        \n        const base64 = await fileToBase64(file);\n        if (file.name.toLowerCase().endsWith('.msg')) {\n          data = { msgBase64: base64, filename: file.name };\n        } else {\n          data = { emlBase64: base64, filename: file.name };\n        }\n        break;\n      }\n      case 'manual': {\n        const form = container.querySelector('#manual-form') as HTMLFormElement;\n        const formData = new FormData(form);\n        data = {\n          from: formData.get('from'),\n          to: (formData.get('to') as string).split(',').map(e => e.trim()),\n          cc: formData.get('cc') ? (formData.get('cc') as string).split(',').map(e => e.trim()) : undefined,\n          subject: formData.get('subject'),\n          body: formData.get('body'),\n          date: formData.get('date') || undefined,\n        };\n        break;\n      }\n    }\n\n    const sprintId = (container.querySelector('#email-sprint-select') as HTMLSelectElement)?.value || '';\n    const actionId = (container.querySelector('#email-action-select') as HTMLSelectElement)?.value || '';\n    if (sprintId) data.sprint_id = sprintId;\n    if (actionId) data.action_id = actionId;\n\n    const result = await http.post('/api/emails', data);\n    toast.success('Email added successfully');\n    props.onSave?.(result);\n    closeEmailComposer();\n  } catch (err) {\n    toast.error('Failed to add email');\n    console.error('[EmailComposer] Error:', err);\n  } finally {\n    saveBtn.disabled = false;\n    saveBtn.textContent = 'Add Email';\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`;\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n}\n\nexport default showEmailComposer;\n","/**\r\n * Notifications Dropdown Component\r\n * Bell icon with notification list in header\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { notificationsService, Notification } from '../services/notifications';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface NotificationsDropdownProps {\r\n  onNotificationClick?: (notification: Notification) => void;\r\n}\r\n\r\nlet isOpen = false;\r\nlet unreadCount = 0;\r\n\r\n/**\r\n * Create notifications dropdown\r\n */\r\nexport function createNotificationsDropdown(props: NotificationsDropdownProps = {}): HTMLElement {\r\n  const container = createElement('div', { className: 'notifications-dropdown' });\r\n\r\n  container.innerHTML = `\r\n    <button class=\"notifications-trigger\" id=\"notifications-trigger\">\r\n      <span class=\"bell-icon\"></span>\r\n      <span class=\"notification-badge hidden\" id=\"notification-badge\">0</span>\r\n    </button>\r\n    <div class=\"notifications-panel hidden\" id=\"notifications-panel\">\r\n      <div class=\"notifications-header\">\r\n        <h3>Notifications</h3>\r\n        <button class=\"btn-link\" id=\"mark-all-read\">Mark all read</button>\r\n      </div>\r\n      <div class=\"notifications-list\" id=\"notifications-list\">\r\n        <div class=\"loading\">Loading...</div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind trigger click\r\n  const trigger = container.querySelector('#notifications-trigger');\r\n  if (trigger) {\r\n    on(trigger as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      toggleDropdown(container, props);\r\n    });\r\n  }\r\n\r\n  // Mark all as read\r\n  const markAllBtn = container.querySelector('#mark-all-read');\r\n  if (markAllBtn) {\r\n    on(markAllBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        await notificationsService.markAllRead();\r\n        toast.success('All notifications marked as read');\r\n        loadNotifications(container, props);\r\n        updateBadge(container, 0);\r\n      } catch {\r\n        toast.error('Failed to mark notifications as read');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Close on outside click\r\n  document.addEventListener('click', () => {\r\n    closeDropdown(container);\r\n  });\r\n\r\n  // Initial count load\r\n  loadUnreadCount(container);\r\n\r\n  // Periodic refresh\r\n  setInterval(() => loadUnreadCount(container), 60000);\r\n\r\n  return container;\r\n}\r\n\r\n/**\r\n * Toggle dropdown\r\n */\r\nfunction toggleDropdown(container: HTMLElement, props: NotificationsDropdownProps): void {\r\n  isOpen = !isOpen;\r\n  const panel = container.querySelector('#notifications-panel');\r\n  \r\n  if (panel) {\r\n    panel.classList.toggle('hidden', !isOpen);\r\n    \r\n    if (isOpen) {\r\n      loadNotifications(container, props);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Close dropdown\r\n */\r\nfunction closeDropdown(container: HTMLElement): void {\r\n  isOpen = false;\r\n  const panel = container.querySelector('#notifications-panel');\r\n  if (panel) {\r\n    panel.classList.add('hidden');\r\n  }\r\n}\r\n\r\n/**\r\n * Load unread count\r\n */\r\nasync function loadUnreadCount(container: HTMLElement): Promise<void> {\r\n  try {\r\n    const count = await notificationsService.getUnreadCount();\r\n    unreadCount = count;\r\n    updateBadge(container, count);\r\n  } catch {\r\n    // Ignore\r\n  }\r\n}\r\n\r\n/**\r\n * Update badge\r\n */\r\nfunction updateBadge(container: HTMLElement, count: number): void {\r\n  const badge = container.querySelector('#notification-badge') as HTMLElement;\r\n  if (badge) {\r\n    badge.textContent = count > 99 ? '99+' : String(count);\r\n    badge.classList.toggle('hidden', count === 0);\r\n  }\r\n}\r\n\r\n/**\r\n * Load notifications\r\n */\r\nasync function loadNotifications(container: HTMLElement, props: NotificationsDropdownProps): Promise<void> {\r\n  const list = container.querySelector('#notifications-list') as HTMLElement;\r\n  list.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const notifications = await notificationsService.getAll({ limit: 20 });\r\n    renderNotifications(list, notifications, container, props);\r\n  } catch {\r\n    list.innerHTML = '<div class=\"error\">Failed to load</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render notifications\r\n */\r\nfunction renderNotifications(\r\n  container: HTMLElement, \r\n  notifications: Notification[],\r\n  dropdown: HTMLElement,\r\n  props: NotificationsDropdownProps\r\n): void {\r\n  if (notifications.length === 0) {\r\n    container.innerHTML = '<div class=\"empty\">No notifications</div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = notifications.map(n => `\r\n    <div class=\"notification-item ${n.read ? '' : 'unread'}\" data-id=\"${n.id}\">\r\n      <div class=\"notification-icon\">${getIcon(n.type)}</div>\r\n      <div class=\"notification-content\">\r\n        <div class=\"notification-title\">${escapeHtml(n.title)}</div>\r\n        ${n.message ? `<div class=\"notification-message\">${escapeHtml(n.message)}</div>` : ''}\r\n        <div class=\"notification-time\">${formatRelativeTime(n.created_at)}</div>\r\n      </div>\r\n      <button class=\"btn-icon dismiss-btn\" title=\"Dismiss\"></button>\r\n    </div>\r\n  `).join('');\r\n\r\n  // Bind click events\r\n  container.querySelectorAll('.notification-item').forEach(item => {\r\n    on(item as HTMLElement, 'click', async (e) => {\r\n      if ((e.target as HTMLElement).closest('.dismiss-btn')) return;\r\n      \r\n      const id = item.getAttribute('data-id');\r\n      const notification = notifications.find(n => n.id === id);\r\n      if (notification) {\r\n        // Mark as read\r\n        if (!notification.read) {\r\n          await notificationsService.markRead(id!);\r\n          item.classList.remove('unread');\r\n          unreadCount = Math.max(0, unreadCount - 1);\r\n          updateBadge(dropdown, unreadCount);\r\n        }\r\n        \r\n        closeDropdown(dropdown);\r\n        props.onNotificationClick?.(notification);\r\n      }\r\n    });\r\n\r\n    // Dismiss button\r\n    const dismissBtn = item.querySelector('.dismiss-btn');\r\n    if (dismissBtn) {\r\n      on(dismissBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = item.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        try {\r\n          await notificationsService.delete(id);\r\n          item.remove();\r\n          if (!item.classList.contains('unread')) return;\r\n          unreadCount = Math.max(0, unreadCount - 1);\r\n          updateBadge(dropdown, unreadCount);\r\n        } catch {\r\n          // Ignore\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Get icon by type\r\n */\r\nfunction getIcon(type: string): string {\r\n  switch (type) {\r\n    case 'question': return '';\r\n    case 'risk': return '';\r\n    case 'action': return '';\r\n    case 'decision': return '';\r\n    case 'mention': return '@';\r\n    case 'comment': return '';\r\n    case 'assignment': return '';\r\n    default: return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Initialize notifications in header\r\n */\r\nexport function initNotificationsDropdown(\r\n  container: HTMLElement,\r\n  props: NotificationsDropdownProps = {}\r\n): HTMLElement {\r\n  const dropdown = createNotificationsDropdown(props);\r\n  container.appendChild(dropdown);\r\n  return dropdown;\r\n}\r\n\r\nexport default createNotificationsDropdown;\r\n","/**\n * Members Panel Component\n * Project members management with invites\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { membersService, ProjectMember } from '../services/notifications';\nimport { appStore } from '../stores/app';\nimport { showInviteModal } from './modals/InviteModal';\nimport { showMemberPermissionsModal } from './modals/MemberPermissionsModal';\nimport { toast } from '../services/toast';\nimport { formatRelativeTime } from '../utils/format';\n\nexport interface MembersPanelProps {\n  projectId?: string;\n  onMemberClick?: (member: ProjectMember) => void;\n}\n\n/**\n * Create members panel\n */\nexport function createMembersPanel(props: MembersPanelProps = {}): HTMLElement {\n  const panel = createElement('div', { className: 'members-panel' });\n\n  panel.innerHTML = `\n    <div class=\"panel-header\">\n      <div class=\"panel-title\">\n        <h2>Team Members</h2>\n        <span class=\"panel-count\" id=\"members-count\">0</span>\n      </div>\n      <div class=\"panel-actions\">\n        <button class=\"btn btn-primary btn-sm\" id=\"invite-member-btn\">+ Invite</button>\n      </div>\n    </div>\n    <div class=\"panel-content\" id=\"members-content\">\n      <div class=\"loading\">Loading members...</div>\n    </div>\n    <div class=\"pending-invites\" id=\"pending-invites\"></div>\n  `;\n\n  // Bind invite button\n  const inviteBtn = panel.querySelector('#invite-member-btn');\n  if (inviteBtn) {\n    on(inviteBtn as HTMLElement, 'click', () => {\n      const projectId = props.projectId || appStore.getState().currentProject?.id;\n      if (!projectId) {\n        toast.error('No project selected');\n        return;\n      }\n      showInviteModal({\n        projectId,\n        onInvite: () => loadPendingInvites(panel, projectId),\n      });\n    });\n  }\n\n  // Initial load\n  const projectId = props.projectId || appStore.getState().currentProject?.id;\n  if (projectId) {\n    loadMembers(panel, projectId, props);\n    loadPendingInvites(panel, projectId);\n  }\n\n  return panel;\n}\n\n/**\n * Load members\n */\nasync function loadMembers(\n  panel: HTMLElement, \n  projectId: string,\n  props: MembersPanelProps\n): Promise<void> {\n  const content = panel.querySelector('#members-content') as HTMLElement;\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\n\n  try {\n    const members = await membersService.getAll(projectId);\n    renderMembers(content, members, projectId, props);\n    updateCount(panel, members.length);\n  } catch {\n    content.innerHTML = '<div class=\"error\">Failed to load members</div>';\n  }\n}\n\n/**\n * Render members\n */\nfunction renderMembers(\n  container: HTMLElement, \n  members: ProjectMember[],\n  projectId: string,\n  props: MembersPanelProps\n): void {\n  if (members.length === 0) {\n    container.innerHTML = '<div class=\"empty\">No team members</div>';\n    return;\n  }\n\n  const currentUser = appStore.getState().currentUser;\n\n  container.innerHTML = `\n    <div class=\"members-list\">\n      ${members.map(member => `\n        <div class=\"member-card\" data-id=\"${member.user_id}\">\n          <div class=\"member-avatar\">\n            ${member.avatar_url \n              ? `<img src=\"${member.avatar_url}\" alt=\"\">`\n              : `<span>${getInitials(member.name || member.email)}</span>`\n            }\n          </div>\n          <div class=\"member-info\">\n            <div class=\"member-name\">${escapeHtml(member.name || member.email)}</div>\n            <div class=\"member-email\">${escapeHtml(member.email)}</div>\n          </div>\n          <div class=\"member-role\">\n            <select class=\"role-select\" data-user-id=\"${member.user_id}\" ${member.user_id === currentUser?.id ? 'disabled' : ''}>\n              <option value=\"viewer\" ${member.role === 'viewer' ? 'selected' : ''}>Viewer</option>\n              <option value=\"editor\" ${member.role === 'editor' ? 'selected' : ''}>Editor</option>\n              <option value=\"admin\" ${member.role === 'admin' ? 'selected' : ''}>Admin</option>\n              <option value=\"owner\" ${member.role === 'owner' ? 'selected' : ''}>Owner</option>\n            </select>\n          </div>\n          <button class=\"btn-icon permissions-btn permissions-btn-icon\" data-user-id=\"${member.user_id}\" title=\"Permissions\"></button>\n          ${member.user_id !== currentUser?.id ? `\n            <button class=\"btn-icon remove-member-btn\" data-user-id=\"${member.user_id}\" title=\"Remove\"></button>\n          ` : ''}\n        </div>\n      `).join('')}\n    </div>\n  `;\n\n  // Bind role change\n  container.querySelectorAll('.role-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const userId = select.getAttribute('data-user-id');\n      const role = (select as HTMLSelectElement).value as 'admin' | 'editor' | 'viewer';\n      if (!userId) return;\n\n      try {\n        await membersService.updateRole(userId, role, projectId);\n        toast.success('Role updated');\n      } catch {\n        toast.error('Failed to update role');\n        loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\n      }\n    });\n  });\n\n  // Bind remove buttons\n  container.querySelectorAll('.remove-member-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const userId = btn.getAttribute('data-user-id');\n      if (!userId || !confirm('Remove this member from the project?')) return;\n\n      try {\n        await membersService.remove(projectId, userId);\n        toast.success('Member removed');\n        loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\n      } catch {\n        toast.error('Failed to remove member');\n      }\n    });\n  });\n\n  // Bind permissions buttons\n  container.querySelectorAll('.permissions-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const userId = btn.getAttribute('data-user-id');\n      const member = members.find(m => m.user_id === userId);\n      if (!member) return;\n\n      showMemberPermissionsModal({\n        projectId,\n        userId: member.user_id,\n        userName: member.name || '',\n        userEmail: member.email,\n        avatarUrl: member.avatar_url,\n        currentRole: member.role,\n        currentPermissions: (member as { permissions?: string[] }).permissions,\n        onSave: () => {\n          loadMembers(container.closest('.members-panel') as HTMLElement, projectId, props);\n        },\n      });\n    });\n  });\n\n  // Bind member clicks\n  container.querySelectorAll('.member-card').forEach(card => {\n    on(card as HTMLElement, 'click', (e) => {\n      if ((e.target as HTMLElement).closest('.role-select, .remove-member-btn')) return;\n      \n      const userId = card.getAttribute('data-id');\n      const member = members.find(m => m.user_id === userId);\n      if (member && props.onMemberClick) {\n        props.onMemberClick(member);\n      }\n    });\n  });\n}\n\n/**\n * Load pending invites\n */\nasync function loadPendingInvites(panel: HTMLElement, projectId: string): Promise<void> {\n  const container = panel.querySelector('#pending-invites') as HTMLElement;\n\n  try {\n    const invites = await membersService.getInvites(projectId);\n    \n    if (invites.length === 0) {\n      container.innerHTML = '';\n      return;\n    }\n\n    container.innerHTML = `\n      <div class=\"invites-section\">\n        <h4>Pending Invites</h4>\n        <div class=\"invites-list\">\n          ${invites.map(invite => `\n            <div class=\"invite-card\" data-id=\"${invite.id}\">\n              <div class=\"invite-info\">\n                <span class=\"invite-email\">${escapeHtml(invite.email)}</span>\n                <span class=\"invite-role\">${invite.role}</span>\n                <span class=\"invite-time\">Sent ${formatRelativeTime(invite.invited_at || invite.created_at || new Date().toISOString())}</span>\n              </div>\n              <button class=\"btn btn-sm cancel-invite-btn\" data-id=\"${invite.id}\">Cancel</button>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    `;\n\n    // Bind cancel buttons\n    container.querySelectorAll('.cancel-invite-btn').forEach(btn => {\n      on(btn as HTMLElement, 'click', async () => {\n        const inviteId = btn.getAttribute('data-id');\n        if (!inviteId) return;\n\n        try {\n          // TODO: Implement cancel invite in service\n          toast.info('Invite cancellation not implemented');\n        } catch {\n          toast.error('Failed to cancel invite');\n        }\n      });\n    });\n  } catch {\n    // Ignore\n  }\n}\n\n/**\n * Update count\n */\nfunction updateCount(panel: HTMLElement, count: number): void {\n  const countEl = panel.querySelector('#members-count');\n  if (countEl) countEl.textContent = String(count);\n}\n\n/**\n * Get initials\n */\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\nexport default createMembersPanel;\n","/**\r\n * API Keys Panel Component\r\n * Manage API keys with create, copy, revoke\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface ApiKeysPanelProps {\r\n  projectId?: string;\r\n}\r\n\r\ninterface ApiKey {\r\n  id: string;\r\n  name: string;\r\n  key_prefix: string;\r\n  created_at: string;\r\n  last_used?: string;\r\n  expires_at?: string;\r\n  scopes: string[];\r\n}\r\n\r\n/**\r\n * Create API keys panel\r\n */\r\nexport function createApiKeysPanel(props: ApiKeysPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'api-keys-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>API Keys</h2>\r\n        <span class=\"panel-count\" id=\"keys-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"create-key-btn\">+ Create Key</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"keys-content\">\r\n      <div class=\"loading\">Loading API keys...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind create button\r\n  const createBtn = panel.querySelector('#create-key-btn');\r\n  if (createBtn) {\r\n    on(createBtn as HTMLElement, 'click', () => showCreateKeyModal(panel, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadApiKeys(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load API keys\r\n */\r\nasync function loadApiKeys(panel: HTMLElement, props: ApiKeysPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#keys-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const response = await http.get<{ keys: ApiKey[] }>('/api/keys');\r\n    renderApiKeys(content, response.data.keys || [], panel, props);\r\n    updateCount(panel, response.data.keys?.length || 0);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load API keys</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render API keys\r\n */\r\nfunction renderApiKeys(\r\n  container: HTMLElement, \r\n  keys: ApiKey[],\r\n  panel: HTMLElement,\r\n  props: ApiKeysPanelProps\r\n): void {\r\n  if (keys.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No API keys created yet</p>\r\n        <p class=\"hint\">Create an API key to access the GodMode API programmatically</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"keys-list\">\r\n      ${keys.map(key => `\r\n        <div class=\"key-card\" data-id=\"${key.id}\">\r\n          <div class=\"key-info\">\r\n            <div class=\"key-name\">${escapeHtml(key.name)}</div>\r\n            <div class=\"key-preview\">${key.key_prefix}</div>\r\n            <div class=\"key-meta\">\r\n              Created ${formatRelativeTime(key.created_at)}\r\n              ${key.last_used ? ` Last used ${formatRelativeTime(key.last_used)}` : ' Never used'}\r\n              ${key.expires_at ? ` Expires ${formatRelativeTime(key.expires_at)}` : ''}\r\n            </div>\r\n            ${key.scopes.length > 0 ? `\r\n              <div class=\"key-scopes\">\r\n                ${key.scopes.map(s => `<span class=\"scope-badge\">${s}</span>`).join('')}\r\n              </div>\r\n            ` : ''}\r\n          </div>\r\n          <div class=\"key-actions\">\r\n            <button class=\"btn btn-sm revoke-key-btn\" data-id=\"${key.id}\">Revoke</button>\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind revoke buttons\r\n  container.querySelectorAll('.revoke-key-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      if (!id || !confirm('Revoke this API key? This action cannot be undone.')) return;\r\n\r\n      try {\r\n        await http.delete(`/api/keys/${id}`);\r\n        toast.success('API key revoked');\r\n        loadApiKeys(panel, props);\r\n      } catch {\r\n        toast.error('Failed to revoke API key');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show create key modal\r\n */\r\nfunction showCreateKeyModal(panel: HTMLElement, props: ApiKeysPanelProps): void {\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>Create API Key</h2>\r\n        <button class=\"btn-icon close-modal\"></button>\r\n      </div>\r\n      <form id=\"create-key-form\" class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label for=\"key-name\">Key Name *</label>\r\n          <input type=\"text\" id=\"key-name\" required placeholder=\"e.g., My Integration\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"key-expiry\">Expires</label>\r\n          <select id=\"key-expiry\">\r\n            <option value=\"\">Never</option>\r\n            <option value=\"30\">30 days</option>\r\n            <option value=\"90\">90 days</option>\r\n            <option value=\"365\">1 year</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Scopes</label>\r\n          <div class=\"scopes-grid\">\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"scopes\" value=\"read\" checked> Read\r\n            </label>\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"scopes\" value=\"write\"> Write\r\n            </label>\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"scopes\" value=\"chat\"> Chat\r\n            </label>\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"scopes\" value=\"admin\"> Admin\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </form>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary close-modal\">Cancel</button>\r\n        <button class=\"btn btn-primary\" id=\"submit-key-btn\">Create Key</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Bind events\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n\r\n  const submitBtn = overlay.querySelector('#submit-key-btn');\r\n  if (submitBtn) {\r\n    on(submitBtn as HTMLElement, 'click', async () => {\r\n      const form = overlay.querySelector('#create-key-form') as HTMLFormElement;\r\n      const nameInput = form.querySelector('#key-name') as HTMLInputElement;\r\n      const expirySelect = form.querySelector('#key-expiry') as HTMLSelectElement;\r\n      const scopeCheckboxes = form.querySelectorAll('input[name=\"scopes\"]:checked');\r\n\r\n      if (!nameInput.value.trim()) {\r\n        toast.error('Key name is required');\r\n        return;\r\n      }\r\n\r\n      const scopes = Array.from(scopeCheckboxes).map(cb => (cb as HTMLInputElement).value);\r\n\r\n      const btn = submitBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.textContent = 'Creating...';\r\n\r\n      try {\r\n        const response = await http.post<{ key: string; id: string }>('/api/keys', {\r\n          name: nameInput.value.trim(),\r\n          expires_in_days: expirySelect.value ? parseInt(expirySelect.value) : null,\r\n          scopes,\r\n        });\r\n\r\n        // Show the generated key\r\n        showNewKeyModal(response.data.key);\r\n        overlay.remove();\r\n        loadApiKeys(panel, props);\r\n      } catch {\r\n        toast.error('Failed to create API key');\r\n        btn.disabled = false;\r\n        btn.textContent = 'Create Key';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Show new key modal with copy button\r\n */\r\nfunction showNewKeyModal(key: string): void {\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>API Key Created</h2>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <p class=\"warning-text\"> Copy this key now! You won't be able to see it again.</p>\r\n        <div class=\"key-display\">\r\n          <code id=\"new-key-value\">${escapeHtml(key)}</code>\r\n          <button class=\"btn btn-sm\" id=\"copy-key-btn\">Copy</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-primary close-modal\">Done</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Copy button\r\n  const copyBtn = overlay.querySelector('#copy-key-btn');\r\n  if (copyBtn) {\r\n    on(copyBtn as HTMLElement, 'click', async () => {\r\n      try {\r\n        await navigator.clipboard.writeText(key);\r\n        toast.success('Key copied to clipboard');\r\n        copyBtn.textContent = 'Copied!';\r\n      } catch {\r\n        toast.error('Failed to copy');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Close button\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#keys-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createApiKeysPanel;\r\n","/**\r\n * Webhooks Panel Component\r\n * Manage webhooks with CRUD and test functionality\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface WebhooksPanelProps {\r\n  projectId?: string;\r\n}\r\n\r\ninterface Webhook {\r\n  id: string;\r\n  name: string;\r\n  url: string;\r\n  events: string[];\r\n  active: boolean;\r\n  secret?: string;\r\n  created_at: string;\r\n  last_triggered?: string;\r\n  last_status?: number;\r\n}\r\n\r\nconst AVAILABLE_EVENTS = [\r\n  'question.created',\r\n  'question.updated',\r\n  'question.answered',\r\n  'risk.created',\r\n  'risk.updated',\r\n  'risk.mitigated',\r\n  'action.created',\r\n  'action.completed',\r\n  'decision.created',\r\n  'decision.approved',\r\n  'decision.rejected',\r\n  'document.uploaded',\r\n  'document.processed',\r\n  'chat.message',\r\n];\r\n\r\n/**\r\n * Create webhooks panel\r\n */\r\nexport function createWebhooksPanel(props: WebhooksPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'webhooks-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Webhooks</h2>\r\n        <span class=\"panel-count\" id=\"webhooks-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-primary btn-sm\" id=\"create-webhook-btn\">+ Add Webhook</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"webhooks-content\">\r\n      <div class=\"loading\">Loading webhooks...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind create button\r\n  const createBtn = panel.querySelector('#create-webhook-btn');\r\n  if (createBtn) {\r\n    on(createBtn as HTMLElement, 'click', () => showWebhookModal(panel, props));\r\n  }\r\n\r\n  // Initial load\r\n  loadWebhooks(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load webhooks\r\n */\r\nasync function loadWebhooks(panel: HTMLElement, props: WebhooksPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#webhooks-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const response = await http.get<{ webhooks: Webhook[] }>('/api/webhooks');\r\n    renderWebhooks(content, response.data.webhooks || [], panel, props);\r\n    updateCount(panel, response.data.webhooks?.length || 0);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load webhooks</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render webhooks\r\n */\r\nfunction renderWebhooks(\r\n  container: HTMLElement, \r\n  webhooks: Webhook[],\r\n  panel: HTMLElement,\r\n  props: WebhooksPanelProps\r\n): void {\r\n  if (webhooks.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No webhooks configured</p>\r\n        <p class=\"hint\">Webhooks allow you to receive real-time notifications when events occur</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"webhooks-list\">\r\n      ${webhooks.map(webhook => `\r\n        <div class=\"webhook-card ${webhook.active ? '' : 'inactive'}\" data-id=\"${webhook.id}\">\r\n          <div class=\"webhook-status\">\r\n            <span class=\"status-indicator ${webhook.active ? 'active' : 'inactive'}\"></span>\r\n          </div>\r\n          <div class=\"webhook-info\">\r\n            <div class=\"webhook-name\">${escapeHtml(webhook.name)}</div>\r\n            <div class=\"webhook-url\">${escapeHtml(webhook.url)}</div>\r\n            <div class=\"webhook-events\">\r\n              ${webhook.events.slice(0, 3).map(e => `<span class=\"event-badge\">${e}</span>`).join('')}\r\n              ${webhook.events.length > 3 ? `<span class=\"more-events\">+${webhook.events.length - 3}</span>` : ''}\r\n            </div>\r\n            <div class=\"webhook-meta\">\r\n              Created ${formatRelativeTime(webhook.created_at)}\r\n              ${webhook.last_triggered \r\n                ? ` Last triggered ${formatRelativeTime(webhook.last_triggered)} (${webhook.last_status})` \r\n                : ' Never triggered'\r\n              }\r\n            </div>\r\n          </div>\r\n          <div class=\"webhook-actions\">\r\n            <button class=\"btn btn-sm test-webhook-btn\" data-id=\"${webhook.id}\">Test</button>\r\n            <button class=\"btn btn-sm edit-webhook-btn\" data-id=\"${webhook.id}\">Edit</button>\r\n            <button class=\"btn btn-sm btn-danger delete-webhook-btn\" data-id=\"${webhook.id}\">Delete</button>\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  container.querySelectorAll('.test-webhook-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      if (!id) return;\r\n\r\n      const button = btn as HTMLButtonElement;\r\n      button.disabled = true;\r\n      button.textContent = 'Testing...';\r\n\r\n      try {\r\n        await http.post(`/api/webhooks/${id}/test`);\r\n        toast.success('Test webhook sent');\r\n      } catch {\r\n        toast.error('Failed to send test webhook');\r\n      } finally {\r\n        button.disabled = false;\r\n        button.textContent = 'Test';\r\n      }\r\n    });\r\n  });\r\n\r\n  container.querySelectorAll('.edit-webhook-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      const webhook = webhooks.find(w => w.id === id);\r\n      if (webhook) {\r\n        showWebhookModal(panel, props, webhook);\r\n      }\r\n    });\r\n  });\r\n\r\n  container.querySelectorAll('.delete-webhook-btn').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', async (e) => {\r\n      e.stopPropagation();\r\n      const id = btn.getAttribute('data-id');\r\n      if (!id || !confirm('Delete this webhook?')) return;\r\n\r\n      try {\r\n        await http.delete(`/api/webhooks/${id}`);\r\n        toast.success('Webhook deleted');\r\n        loadWebhooks(panel, props);\r\n      } catch {\r\n        toast.error('Failed to delete webhook');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show webhook modal (create/edit)\r\n */\r\nfunction showWebhookModal(panel: HTMLElement, props: WebhooksPanelProps, webhook?: Webhook): void {\r\n  const isEdit = !!webhook;\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>${isEdit ? 'Edit Webhook' : 'Create Webhook'}</h2>\r\n        <button class=\"btn-icon close-modal\"></button>\r\n      </div>\r\n      <form id=\"webhook-form\" class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label for=\"webhook-name\">Name *</label>\r\n          <input type=\"text\" id=\"webhook-name\" required value=\"${escapeHtml(webhook?.name || '')}\" placeholder=\"e.g., Slack Notifications\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"webhook-url\">URL *</label>\r\n          <input type=\"url\" id=\"webhook-url\" required value=\"${escapeHtml(webhook?.url || '')}\" placeholder=\"https://your-endpoint.com/webhook\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label for=\"webhook-secret\">Secret (Optional)</label>\r\n          <input type=\"text\" id=\"webhook-secret\" value=\"${escapeHtml(webhook?.secret || '')}\" placeholder=\"Used to sign payloads\">\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Events *</label>\r\n          <div class=\"events-grid\">\r\n            ${AVAILABLE_EVENTS.map(event => `\r\n              <label class=\"checkbox-label\">\r\n                <input type=\"checkbox\" name=\"events\" value=\"${event}\" ${webhook?.events.includes(event) ? 'checked' : ''}>\r\n                ${event}\r\n              </label>\r\n            `).join('')}\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label class=\"checkbox-label\">\r\n            <input type=\"checkbox\" id=\"webhook-active\" ${webhook?.active !== false ? 'checked' : ''}>\r\n            Active\r\n          </label>\r\n        </div>\r\n      </form>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary close-modal\">Cancel</button>\r\n        <button class=\"btn btn-primary\" id=\"submit-webhook-btn\">${isEdit ? 'Save' : 'Create'}</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  // Bind events\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n\r\n  const submitBtn = overlay.querySelector('#submit-webhook-btn');\r\n  if (submitBtn) {\r\n    on(submitBtn as HTMLElement, 'click', async () => {\r\n      const form = overlay.querySelector('#webhook-form') as HTMLFormElement;\r\n      const nameInput = form.querySelector('#webhook-name') as HTMLInputElement;\r\n      const urlInput = form.querySelector('#webhook-url') as HTMLInputElement;\r\n      const secretInput = form.querySelector('#webhook-secret') as HTMLInputElement;\r\n      const activeCheckbox = form.querySelector('#webhook-active') as HTMLInputElement;\r\n      const eventCheckboxes = form.querySelectorAll('input[name=\"events\"]:checked');\r\n\r\n      if (!nameInput.value.trim() || !urlInput.value.trim()) {\r\n        toast.error('Name and URL are required');\r\n        return;\r\n      }\r\n\r\n      const events = Array.from(eventCheckboxes).map(cb => (cb as HTMLInputElement).value);\r\n      if (events.length === 0) {\r\n        toast.error('Select at least one event');\r\n        return;\r\n      }\r\n\r\n      const data = {\r\n        name: nameInput.value.trim(),\r\n        url: urlInput.value.trim(),\r\n        secret: secretInput.value.trim() || undefined,\r\n        events,\r\n        active: activeCheckbox.checked,\r\n      };\r\n\r\n      const btn = submitBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.textContent = isEdit ? 'Saving...' : 'Creating...';\r\n\r\n      try {\r\n        if (isEdit) {\r\n          await http.put(`/api/webhooks/${webhook!.id}`, data);\r\n          toast.success('Webhook updated');\r\n        } else {\r\n          await http.post('/api/webhooks', data);\r\n          toast.success('Webhook created');\r\n        }\r\n        overlay.remove();\r\n        loadWebhooks(panel, props);\r\n      } catch {\r\n        toast.error(`Failed to ${isEdit ? 'update' : 'create'} webhook`);\r\n        btn.disabled = false;\r\n        btn.textContent = isEdit ? 'Save' : 'Create';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#webhooks-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createWebhooksPanel;\r\n","/**\r\n * Audit Panel Component\r\n * Audit logs viewer with export wizard\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http, fetchWithProject } from '../services/api';\r\nimport { toast } from '../services/toast';\r\nimport { formatRelativeTime } from '../utils/format';\r\n\r\nexport interface AuditPanelProps {\r\n  projectId?: string;\r\n}\r\n\r\ninterface AuditLog {\r\n  id: string;\r\n  action: string;\r\n  entity_type: string;\r\n  entity_id?: string;\r\n  user_id?: string;\r\n  user_email?: string;\r\n  user_name?: string;\r\n  ip_address?: string;\r\n  details?: Record<string, unknown>;\r\n  created_at: string;\r\n}\r\n\r\ninterface AuditFilters {\r\n  action?: string;\r\n  entity_type?: string;\r\n  user_id?: string;\r\n  from_date?: string;\r\n  to_date?: string;\r\n}\r\n\r\nlet currentFilters: AuditFilters = {};\r\nlet currentPage = 1;\r\nconst PAGE_SIZE = 50;\r\n\r\n/**\r\n * Create audit panel\r\n */\r\nexport function createAuditPanel(props: AuditPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'audit-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Audit Log</h2>\r\n        <span class=\"panel-count\" id=\"audit-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <button class=\"btn btn-sm\" id=\"export-audit-btn\">Export</button>\r\n        <button class=\"btn btn-sm\" id=\"filter-audit-btn\">Filter</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"audit-filters hidden\" id=\"audit-filters\">\r\n      <div class=\"filter-row\">\r\n        <select id=\"filter-action\" class=\"filter-select\">\r\n          <option value=\"\">All Actions</option>\r\n          <option value=\"create\">Create</option>\r\n          <option value=\"update\">Update</option>\r\n          <option value=\"delete\">Delete</option>\r\n          <option value=\"login\">Login</option>\r\n          <option value=\"logout\">Logout</option>\r\n          <option value=\"export\">Export</option>\r\n        </select>\r\n        <select id=\"filter-entity\" class=\"filter-select\">\r\n          <option value=\"\">All Entities</option>\r\n          <option value=\"question\">Questions</option>\r\n          <option value=\"risk\">Risks</option>\r\n          <option value=\"action\">Actions</option>\r\n          <option value=\"decision\">Decisions</option>\r\n          <option value=\"contact\">Contacts</option>\r\n          <option value=\"document\">Documents</option>\r\n          <option value=\"user\">Users</option>\r\n          <option value=\"project\">Projects</option>\r\n        </select>\r\n        <input type=\"date\" id=\"filter-from\" class=\"filter-date\" placeholder=\"From\">\r\n        <input type=\"date\" id=\"filter-to\" class=\"filter-date\" placeholder=\"To\">\r\n        <button class=\"btn btn-sm\" id=\"apply-filters-btn\">Apply</button>\r\n        <button class=\"btn btn-sm\" id=\"clear-filters-btn\">Clear</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"audit-content\">\r\n      <div class=\"loading\">Loading audit logs...</div>\r\n    </div>\r\n    <div class=\"audit-pagination\" id=\"audit-pagination\"></div>\r\n  `;\r\n\r\n  // Bind filter toggle\r\n  const filterBtn = panel.querySelector('#filter-audit-btn');\r\n  if (filterBtn) {\r\n    on(filterBtn as HTMLElement, 'click', () => {\r\n      const filters = panel.querySelector('#audit-filters');\r\n      filters?.classList.toggle('hidden');\r\n    });\r\n  }\r\n\r\n  // Bind apply filters\r\n  const applyBtn = panel.querySelector('#apply-filters-btn');\r\n  if (applyBtn) {\r\n    on(applyBtn as HTMLElement, 'click', () => {\r\n      currentFilters = {\r\n        action: (panel.querySelector('#filter-action') as HTMLSelectElement).value || undefined,\r\n        entity_type: (panel.querySelector('#filter-entity') as HTMLSelectElement).value || undefined,\r\n        from_date: (panel.querySelector('#filter-from') as HTMLInputElement).value || undefined,\r\n        to_date: (panel.querySelector('#filter-to') as HTMLInputElement).value || undefined,\r\n      };\r\n      currentPage = 1;\r\n      loadAuditLogs(panel, props);\r\n    });\r\n  }\r\n\r\n  // Bind clear filters\r\n  const clearBtn = panel.querySelector('#clear-filters-btn');\r\n  if (clearBtn) {\r\n    on(clearBtn as HTMLElement, 'click', () => {\r\n      currentFilters = {};\r\n      currentPage = 1;\r\n      (panel.querySelector('#filter-action') as HTMLSelectElement).value = '';\r\n      (panel.querySelector('#filter-entity') as HTMLSelectElement).value = '';\r\n      (panel.querySelector('#filter-from') as HTMLInputElement).value = '';\r\n      (panel.querySelector('#filter-to') as HTMLInputElement).value = '';\r\n      loadAuditLogs(panel, props);\r\n    });\r\n  }\r\n\r\n  // Bind export\r\n  const exportBtn = panel.querySelector('#export-audit-btn');\r\n  if (exportBtn) {\r\n    on(exportBtn as HTMLElement, 'click', () => showExportWizard(props));\r\n  }\r\n\r\n  // Initial load\r\n  loadAuditLogs(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load audit logs\r\n */\r\nasync function loadAuditLogs(panel: HTMLElement, props: AuditPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#audit-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    const params = new URLSearchParams();\r\n    params.set('page', String(currentPage));\r\n    params.set('limit', String(PAGE_SIZE));\r\n    \r\n    if (currentFilters.action) params.set('action', currentFilters.action);\r\n    if (currentFilters.entity_type) params.set('entity_type', currentFilters.entity_type);\r\n    if (currentFilters.from_date) params.set('from_date', currentFilters.from_date);\r\n    if (currentFilters.to_date) params.set('to_date', currentFilters.to_date);\r\n\r\n    const response = await http.get<{ logs: AuditLog[]; total: number }>(`/api/audit?${params}`);\r\n    renderAuditLogs(content, response.data.logs || []);\r\n    updateCount(panel, response.data.total);\r\n    renderPagination(panel, response.data.total, props);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load audit logs</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render audit logs\r\n */\r\nfunction renderAuditLogs(container: HTMLElement, logs: AuditLog[]): void {\r\n  if (logs.length === 0) {\r\n    container.innerHTML = '<div class=\"empty\">No audit logs found</div>';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"audit-table\">\r\n      <div class=\"audit-header\">\r\n        <span class=\"audit-col time\">Time</span>\r\n        <span class=\"audit-col user\">User</span>\r\n        <span class=\"audit-col action\">Action</span>\r\n        <span class=\"audit-col entity\">Entity</span>\r\n        <span class=\"audit-col details\">Details</span>\r\n      </div>\r\n      <div class=\"audit-body\">\r\n        ${logs.map(log => `\r\n          <div class=\"audit-row\" data-id=\"${log.id}\">\r\n            <span class=\"audit-col time\" title=\"${new Date(log.created_at).toLocaleString()}\">\r\n              ${formatRelativeTime(log.created_at)}\r\n            </span>\r\n            <span class=\"audit-col user\">\r\n              ${log.user_name || log.user_email || 'System'}\r\n              ${log.ip_address ? `<span class=\"ip-address\">${log.ip_address}</span>` : ''}\r\n            </span>\r\n            <span class=\"audit-col action\">\r\n              <span class=\"action-badge ${getActionClass(log.action)}\">${log.action}</span>\r\n            </span>\r\n            <span class=\"audit-col entity\">\r\n              ${log.entity_type}${log.entity_id ? ` #${log.entity_id.slice(0, 8)}` : ''}\r\n            </span>\r\n            <span class=\"audit-col details\">\r\n              ${log.details ? `<button class=\"btn-link view-details-btn\">View</button>` : '-'}\r\n            </span>\r\n          </div>\r\n        `).join('')}\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind view details buttons\r\n  container.querySelectorAll('.view-details-btn').forEach((btn, index) => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const log = logs[index];\r\n      if (log?.details) {\r\n        showDetailsModal(log);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Get action class for styling\r\n */\r\nfunction getActionClass(action: string): string {\r\n  if (action.includes('create')) return 'create';\r\n  if (action.includes('update')) return 'update';\r\n  if (action.includes('delete')) return 'delete';\r\n  if (action.includes('login')) return 'login';\r\n  if (action.includes('export')) return 'export';\r\n  return '';\r\n}\r\n\r\n/**\r\n * Render pagination\r\n */\r\nfunction renderPagination(panel: HTMLElement, total: number, props: AuditPanelProps): void {\r\n  const container = panel.querySelector('#audit-pagination') as HTMLElement;\r\n  const totalPages = Math.ceil(total / PAGE_SIZE);\r\n\r\n  if (totalPages <= 1) {\r\n    container.innerHTML = '';\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <button class=\"btn btn-sm\" id=\"prev-page\" ${currentPage === 1 ? 'disabled' : ''}>Previous</button>\r\n    <span class=\"page-info\">Page ${currentPage} of ${totalPages}</span>\r\n    <button class=\"btn btn-sm\" id=\"next-page\" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>\r\n  `;\r\n\r\n  const prevBtn = container.querySelector('#prev-page');\r\n  if (prevBtn) {\r\n    on(prevBtn as HTMLElement, 'click', () => {\r\n      if (currentPage > 1) {\r\n        currentPage--;\r\n        loadAuditLogs(panel, props);\r\n      }\r\n    });\r\n  }\r\n\r\n  const nextBtn = container.querySelector('#next-page');\r\n  if (nextBtn) {\r\n    on(nextBtn as HTMLElement, 'click', () => {\r\n      if (currentPage < totalPages) {\r\n        currentPage++;\r\n        loadAuditLogs(panel, props);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Show details modal\r\n */\r\nfunction showDetailsModal(log: AuditLog): void {\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>Audit Log Details</h2>\r\n        <button class=\"btn-icon close-modal\"></button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">ID:</span>\r\n          <span class=\"detail-value\">${log.id}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Time:</span>\r\n          <span class=\"detail-value\">${new Date(log.created_at).toLocaleString()}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Action:</span>\r\n          <span class=\"detail-value\">${log.action}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Entity:</span>\r\n          <span class=\"detail-value\">${log.entity_type} ${log.entity_id || ''}</span>\r\n        </div>\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">User:</span>\r\n          <span class=\"detail-value\">${log.user_name || log.user_email || 'System'}</span>\r\n        </div>\r\n        ${log.ip_address ? `\r\n          <div class=\"detail-row\">\r\n            <span class=\"detail-label\">IP Address:</span>\r\n            <span class=\"detail-value\">${log.ip_address}</span>\r\n          </div>\r\n        ` : ''}\r\n        <div class=\"detail-row\">\r\n          <span class=\"detail-label\">Details:</span>\r\n          <pre class=\"detail-json\">${JSON.stringify(log.details, null, 2)}</pre>\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-primary close-modal\">Close</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n}\r\n\r\n/**\r\n * Show export wizard\r\n */\r\nfunction showExportWizard(props: AuditPanelProps): void {\r\n  const overlay = createElement('div', { className: 'modal-overlay' });\r\n  \r\n  overlay.innerHTML = `\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h2>Export Audit Logs</h2>\r\n        <button class=\"btn-icon close-modal\"></button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        <div class=\"form-group\">\r\n          <label>Date Range</label>\r\n          <div class=\"date-range\">\r\n            <input type=\"date\" id=\"export-from\" placeholder=\"From\">\r\n            <span>to</span>\r\n            <input type=\"date\" id=\"export-to\" placeholder=\"To\">\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Format</label>\r\n          <select id=\"export-format\">\r\n            <option value=\"csv\">CSV</option>\r\n            <option value=\"json\">JSON</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <label>Include</label>\r\n          <div class=\"checkbox-group\">\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"include\" value=\"details\" checked> Details\r\n            </label>\r\n            <label class=\"checkbox-label\">\r\n              <input type=\"checkbox\" name=\"include\" value=\"ip\"> IP Addresses\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button class=\"btn btn-secondary close-modal\">Cancel</button>\r\n        <button class=\"btn btn-primary\" id=\"export-btn\">Export</button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(overlay);\r\n\r\n  overlay.querySelectorAll('.close-modal').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => overlay.remove());\r\n  });\r\n\r\n  on(overlay, 'click', (e) => {\r\n    if (e.target === overlay) overlay.remove();\r\n  });\r\n\r\n  const exportBtn = overlay.querySelector('#export-btn');\r\n  if (exportBtn) {\r\n    on(exportBtn as HTMLElement, 'click', async () => {\r\n      const fromDate = (overlay.querySelector('#export-from') as HTMLInputElement).value;\r\n      const toDate = (overlay.querySelector('#export-to') as HTMLInputElement).value;\r\n      const format = (overlay.querySelector('#export-format') as HTMLSelectElement).value;\r\n      const includeCheckboxes = overlay.querySelectorAll('input[name=\"include\"]:checked');\r\n      const include = Array.from(includeCheckboxes).map(cb => (cb as HTMLInputElement).value);\r\n\r\n      const btn = exportBtn as HTMLButtonElement;\r\n      btn.disabled = true;\r\n      btn.textContent = 'Exporting...';\r\n\r\n      try {\r\n        const params = new URLSearchParams();\r\n        params.set('format', format);\r\n        if (fromDate) params.set('from_date', fromDate);\r\n        if (toDate) params.set('to_date', toDate);\r\n        include.forEach(i => params.append('include', i));\r\n\r\n        const response = await fetchWithProject(`/api/audit/export?${params}`);\r\n        if (!response.ok) throw new Error('Export failed');\r\n\r\n        const blob = await response.blob();\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = `audit-logs-${new Date().toISOString().split('T')[0]}.${format}`;\r\n        a.click();\r\n        URL.revokeObjectURL(url);\r\n\r\n        toast.success('Audit logs exported');\r\n        overlay.remove();\r\n      } catch {\r\n        toast.error('Failed to export audit logs');\r\n        btn.disabled = false;\r\n        btn.textContent = 'Export';\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#audit-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\nexport default createAuditPanel;\r\n","/**\r\n * Roles Panel - SOTA Design\r\n * Manage role templates with AI-enhanced context\r\n * Note: User permissions are managed separately per member in MembersPanel\r\n */\r\n\r\nimport { on } from '../utils/dom';\r\nimport { http } from '../services/api';\r\nimport { toast } from '../services/toast';\r\n\r\ninterface Role {\r\n  id: string;\r\n  name: string;\r\n  display_name?: string;\r\n  description?: string;\r\n  role_context?: string;\r\n  color?: string;\r\n  category?: string;\r\n  is_template?: boolean;\r\n  is_system?: boolean;\r\n  created_at?: string;\r\n}\r\n\r\nconst ROLE_CATEGORIES = [\r\n  { id: 'project', name: 'Project', icon: '', examples: 'Project Manager, Scrum Master, Product Owner' },\r\n  { id: 'technical', name: 'Technical', icon: '', examples: 'Developer, Architect, DevOps, QA' },\r\n  { id: 'management', name: 'Management', icon: '', examples: 'Director, VP, C-Level' },\r\n  { id: 'stakeholder', name: 'Stakeholder', icon: '', examples: 'Client, Sponsor, External Partner' },\r\n  { id: 'custom', name: 'Custom', icon: '', examples: 'Custom roles for your team' },\r\n];\r\n\r\nlet currentRoles: Role[] = [];\r\nlet editingRole: Role | null = null;\r\n\r\n/**\r\n * Render Roles Panel\r\n */\r\nexport async function renderRolesPanel(container: HTMLElement): Promise<void> {\r\n  container.innerHTML = `\r\n    <style>\r\n      .roles-panel-sota {\r\n        padding: 24px;\r\n        max-width: 1200px;\r\n        margin: 0 auto;\r\n      }\r\n      \r\n      .roles-header {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        margin-bottom: 24px;\r\n      }\r\n      \r\n      .roles-header h2 {\r\n        margin: 0;\r\n        font-size: 24px;\r\n        font-weight: 700;\r\n        color: var(--text-primary);\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .roles-header h2 svg {\r\n        width: 28px;\r\n        height: 28px;\r\n        color: #e11d48;\r\n      }\r\n      \r\n      .roles-header-subtitle {\r\n        font-size: 14px;\r\n        color: var(--text-secondary);\r\n        margin-top: 4px;\r\n        font-weight: 400;\r\n      }\r\n      \r\n      .btn-create-role {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        padding: 12px 24px;\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        border: none;\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-create-role:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n      \r\n      .roles-layout {\r\n        display: grid;\r\n        grid-template-columns: 320px 1fr;\r\n        gap: 24px;\r\n      }\r\n      \r\n      @media (max-width: 900px) {\r\n        .roles-layout {\r\n          grid-template-columns: 1fr;\r\n        }\r\n      }\r\n      \r\n      .roles-list {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      }\r\n      \r\n      .role-card {\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 16px;\r\n        padding: 16px;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        position: relative;\r\n      }\r\n      \r\n      .role-card:hover {\r\n        border-color: #e11d48;\r\n        transform: translateX(4px);\r\n      }\r\n      \r\n      .role-card.active {\r\n        border-color: #e11d48;\r\n        background: linear-gradient(135deg, rgba(225,29,72,0.08) 0%, rgba(225,29,72,0.03) 100%);\r\n      }\r\n      \r\n      .role-card-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .role-color-dot {\r\n        width: 12px;\r\n        height: 12px;\r\n        border-radius: 50%;\r\n        flex-shrink: 0;\r\n      }\r\n      \r\n      .role-card-name {\r\n        font-weight: 600;\r\n        color: var(--text-primary);\r\n        flex: 1;\r\n      }\r\n      \r\n      .role-card-badges {\r\n        display: flex;\r\n        gap: 4px;\r\n      }\r\n      \r\n      .role-badge {\r\n        font-size: 10px;\r\n        padding: 2px 6px;\r\n        border-radius: 4px;\r\n        font-weight: 500;\r\n      }\r\n      \r\n      .role-badge.template {\r\n        background: #dbeafe;\r\n        color: #1d4ed8;\r\n      }\r\n      \r\n      .role-badge.system {\r\n        background: #fef3c7;\r\n        color: #92400e;\r\n      }\r\n      \r\n      .role-card-category {\r\n        font-size: 11px;\r\n        color: var(--text-muted);\r\n        margin-bottom: 4px;\r\n      }\r\n      \r\n      .role-card-desc {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n        line-height: 1.5;\r\n        display: -webkit-box;\r\n        -webkit-line-clamp: 2;\r\n        -webkit-box-orient: vertical;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      /* Editor Panel */\r\n      .role-editor {\r\n        background: var(--bg-primary);\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 20px;\r\n        overflow: hidden;\r\n      }\r\n      \r\n      .role-editor-header {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        padding: 24px;\r\n        color: white;\r\n      }\r\n      \r\n      .role-editor-header h3 {\r\n        margin: 0;\r\n        font-size: 20px;\r\n        font-weight: 700;\r\n      }\r\n      \r\n      .role-editor-body {\r\n        padding: 24px;\r\n      }\r\n      \r\n      .form-row {\r\n        display: flex;\r\n        gap: 16px;\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .form-group {\r\n        flex: 1;\r\n      }\r\n      \r\n      .form-group label {\r\n        display: block;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 8px;\r\n      }\r\n      \r\n      .form-group input,\r\n      .form-group textarea,\r\n      .form-group select {\r\n        width: 100%;\r\n        padding: 12px 16px;\r\n        border: 1px solid var(--border-color);\r\n        border-radius: 12px;\r\n        font-size: 14px;\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        transition: all 0.2s;\r\n        box-sizing: border-box;\r\n      }\r\n      \r\n      .form-group input:focus,\r\n      .form-group textarea:focus,\r\n      .form-group select:focus {\r\n        outline: none;\r\n        border-color: #e11d48;\r\n        box-shadow: 0 0 0 3px rgba(225, 29, 72, 0.1);\r\n      }\r\n      \r\n      .form-group textarea {\r\n        resize: vertical;\r\n        min-height: 80px;\r\n      }\r\n      \r\n      .form-hint {\r\n        font-size: 12px;\r\n        color: var(--text-muted);\r\n        margin-top: 6px;\r\n      }\r\n      \r\n      .ai-enhance-section {\r\n        display: flex;\r\n        gap: 12px;\r\n        align-items: flex-start;\r\n        margin-top: 12px;\r\n      }\r\n      \r\n      .ai-enhance-btn {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n        padding: 10px 16px;\r\n        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);\r\n        color: white;\r\n        border: none;\r\n        border-radius: 10px;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        white-space: nowrap;\r\n      }\r\n      \r\n      .ai-enhance-btn:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\r\n      }\r\n      \r\n      .ai-enhance-btn:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n        transform: none;\r\n      }\r\n      \r\n      .ai-enhance-btn svg {\r\n        width: 14px;\r\n        height: 14px;\r\n      }\r\n      \r\n      @keyframes spin {\r\n        from { transform: rotate(0deg); }\r\n        to { transform: rotate(360deg); }\r\n      }\r\n      \r\n      .spin {\r\n        animation: spin 1s linear infinite;\r\n      }\r\n      \r\n      /* Actions */\r\n      .role-editor-actions {\r\n        display: flex;\r\n        gap: 12px;\r\n        justify-content: flex-end;\r\n        margin-top: 24px;\r\n        padding-top: 24px;\r\n        border-top: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .btn {\r\n        padding: 12px 24px;\r\n        border-radius: 10px;\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        border: none;\r\n      }\r\n      \r\n      .btn-secondary {\r\n        background: var(--bg-secondary);\r\n        color: var(--text-primary);\r\n        border: 1px solid var(--border-color);\r\n      }\r\n      \r\n      .btn-secondary:hover {\r\n        background: var(--bg-tertiary);\r\n      }\r\n      \r\n      .btn-primary {\r\n        background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);\r\n        color: white;\r\n        box-shadow: 0 4px 14px rgba(225, 29, 72, 0.3);\r\n      }\r\n      \r\n      .btn-primary:hover {\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 6px 20px rgba(225, 29, 72, 0.4);\r\n      }\r\n      \r\n      .btn-danger {\r\n        background: #fee2e2;\r\n        color: #dc2626;\r\n      }\r\n      \r\n      .btn-danger:hover {\r\n        background: #fecaca;\r\n      }\r\n      \r\n      .template-toggle {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 8px;\r\n        margin-top: 20px;\r\n        padding: 14px 16px;\r\n        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);\r\n        border: 1px solid #86efac;\r\n        border-radius: 12px;\r\n      }\r\n      \r\n      .template-toggle label {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: #166534;\r\n        font-weight: 500;\r\n      }\r\n      \r\n      .template-toggle input {\r\n        accent-color: #16a34a;\r\n        width: 18px;\r\n        height: 18px;\r\n      }\r\n      \r\n      .empty-state {\r\n        text-align: center;\r\n        padding: 48px;\r\n        color: var(--text-muted);\r\n      }\r\n      \r\n      .empty-state svg {\r\n        width: 64px;\r\n        height: 64px;\r\n        opacity: 0.3;\r\n        margin-bottom: 16px;\r\n      }\r\n      \r\n      .info-card {\r\n        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);\r\n        border: 1px solid #93c5fd;\r\n        border-radius: 12px;\r\n        padding: 16px;\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .info-card h4 {\r\n        margin: 0 0 8px;\r\n        font-size: 14px;\r\n        color: #1e40af;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 6px;\r\n      }\r\n      \r\n      .info-card p {\r\n        margin: 0;\r\n        font-size: 13px;\r\n        color: #3b82f6;\r\n        line-height: 1.5;\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"roles-panel-sota\">\r\n      <div class=\"roles-header\">\r\n        <div>\r\n          <h2>\r\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\"/>\r\n            </svg>\r\n            Role Templates\r\n          </h2>\r\n          <div class=\"roles-header-subtitle\">Define roles to assign to team members and contacts. The AI uses role context to adapt responses.</div>\r\n        </div>\r\n        <button class=\"btn-create-role\" id=\"btn-create-role\">\r\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\r\n          </svg>\r\n          Create Role\r\n        </button>\r\n      </div>\r\n      \r\n      <div class=\"roles-layout\">\r\n        <div class=\"roles-list\" id=\"roles-list\">\r\n          <div class=\"empty-state\">Loading roles...</div>\r\n        </div>\r\n        \r\n        <div class=\"role-editor hidden\" id=\"role-editor\">\r\n          <!-- Editor content will be rendered here -->\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Load roles\r\n  await loadRoles(container);\r\n\r\n  // Bind create button\r\n  const createBtn = container.querySelector('#btn-create-role');\r\n  if (createBtn) {\r\n    on(createBtn as HTMLElement, 'click', () => {\r\n      editingRole = null;\r\n      showRoleEditor(container, null);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Load roles from API\r\n */\r\nasync function loadRoles(container: HTMLElement): Promise<void> {\r\n  const listEl = container.querySelector('#roles-list') as HTMLElement;\r\n  if (!listEl) return;\r\n\r\n  try {\r\n    // Load role templates\r\n    const response = await http.get<{ roles: Role[] }>('/api/role-templates');\r\n    currentRoles = response.data.roles || [];\r\n\r\n    if (currentRoles.length === 0) {\r\n      listEl.innerHTML = `\r\n        <div class=\"empty-state\">\r\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197\"/>\r\n          </svg>\r\n          <p>No roles defined yet</p>\r\n          <p class=\"empty-state-hint\">Click \"Create Role\" to get started</p>\r\n        </div>\r\n      `;\r\n      return;\r\n    }\r\n\r\n    renderRolesList(listEl, container);\r\n  } catch (error) {\r\n    console.error('[RolesPanel] Failed to load roles:', error);\r\n    listEl.innerHTML = `<div class=\"empty-state\">Failed to load roles</div>`;\r\n  }\r\n}\r\n\r\n/**\r\n * Render roles list\r\n */\r\nfunction renderRolesList(listEl: HTMLElement, container: HTMLElement): void {\r\n  const categoryMap = Object.fromEntries(ROLE_CATEGORIES.map(c => [c.id, c]));\r\n  \r\n  listEl.innerHTML = currentRoles.map(role => {\r\n    const cat = categoryMap[role.category || 'custom'];\r\n    return `\r\n      <div class=\"role-card${editingRole?.id === role.id ? ' active' : ''}\" data-id=\"${role.id}\">\r\n        <div class=\"role-card-header\">\r\n          <div class=\"role-color-dot\" style=\"--role-color: ${role.color || '#e11d48'}\"></div>\r\n          <div class=\"role-card-name\">${escapeHtml(role.display_name || role.name)}</div>\r\n          <div class=\"role-card-badges\">\r\n            ${role.is_template ? '<span class=\"role-badge template\">Template</span>' : ''}\r\n            ${role.is_system ? '<span class=\"role-badge system\">System</span>' : ''}\r\n          </div>\r\n        </div>\r\n        <div class=\"role-card-category\">${cat?.icon || ''} ${cat?.name || 'Custom'}</div>\r\n        ${role.description ? `<div class=\"role-card-desc\">${escapeHtml(role.description)}</div>` : ''}\r\n      </div>\r\n    `;\r\n  }).join('');\r\n\r\n  // Bind click events\r\n  listEl.querySelectorAll('.role-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', () => {\r\n      const roleId = card.getAttribute('data-id');\r\n      const role = currentRoles.find(r => r.id === roleId);\r\n      if (role) {\r\n        editingRole = role;\r\n        listEl.querySelectorAll('.role-card').forEach(c => c.classList.remove('active'));\r\n        card.classList.add('active');\r\n        showRoleEditor(container, role);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Show role editor\r\n */\r\nfunction showRoleEditor(container: HTMLElement, role: Role | null): void {\r\n  const editorEl = container.querySelector('#role-editor') as HTMLElement;\r\n  if (!editorEl) return;\r\n\r\n  editorEl.classList.remove('hidden');\r\n\r\n  const isNew = !role;\r\n\r\n  editorEl.innerHTML = `\r\n    <div class=\"role-editor-header\">\r\n      <h3>${isNew ? 'Create New Role' : 'Edit Role'}</h3>\r\n    </div>\r\n    \r\n    <div class=\"role-editor-body\">\r\n      <div class=\"info-card\">\r\n        <h4> How Role Templates Work</h4>\r\n        <p>Role templates define job titles and context that helps the AI understand each person's perspective. When you assign a role to a team member or contact, the AI adapts its responses to be more relevant to their responsibilities.</p>\r\n      </div>\r\n      \r\n      <form id=\"role-form\">\r\n        <div class=\"form-row\">\r\n          <div class=\"form-group role-form-flex-2\">\r\n            <label>Role Name *</label>\r\n            <input type=\"text\" id=\"role-name\" required value=\"${escapeHtml(role?.display_name || role?.name || '')}\" placeholder=\"e.g., Project Manager, Senior Developer\">\r\n          </div>\r\n          <div class=\"form-group role-form-flex-1\">\r\n            <label>Category</label>\r\n            <select id=\"role-category\">\r\n              ${ROLE_CATEGORIES.map(cat => `\r\n                <option value=\"${cat.id}\" ${role?.category === cat.id ? 'selected' : ''}>${cat.icon} ${cat.name}</option>\r\n              `).join('')}\r\n            </select>\r\n          </div>\r\n          <div class=\"form-group role-form-w-80\">\r\n            <label>Color</label>\r\n            <input type=\"color\" id=\"role-color\" class=\"role-color-input\" value=\"${role?.color || '#e11d48'}\">\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Description</label>\r\n          <textarea id=\"role-description\" rows=\"2\" placeholder=\"Brief description of this role's main responsibilities...\">${escapeHtml(role?.description || '')}</textarea>\r\n          <div class=\"form-hint\">A short summary shown in role lists and dropdowns.</div>\r\n        </div>\r\n        \r\n        <div class=\"form-group\">\r\n          <label>Role Context (for AI)</label>\r\n          <textarea id=\"role-context\" rows=\"6\" placeholder=\"Describe this role in detail for the AI:&#10;&#10; What are their main responsibilities?&#10; What decisions do they typically make?&#10; What information is most relevant to them?&#10; How should the AI adapt its tone and detail level?\">${escapeHtml(role?.role_context || '')}</textarea>\r\n          <div class=\"form-hint\">This context helps the AI provide more relevant and targeted responses when interacting with people in this role.</div>\r\n          <div class=\"ai-enhance-section\">\r\n            <button type=\"button\" class=\"ai-enhance-btn\" id=\"btn-ai-enhance\">\r\n              <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/>\r\n              </svg>\r\n              Enhance with AI\r\n            </button>\r\n            <span class=\"form-hint role-form-hint-ai\">Let AI generate or improve the role context based on the role name.</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"template-toggle\">\r\n          <input type=\"checkbox\" id=\"is-template\" ${role?.is_template !== false ? 'checked' : ''}>\r\n          <label for=\"is-template\">Save as template (reusable across all projects)</label>\r\n        </div>\r\n        \r\n        <div class=\"role-editor-actions\">\r\n          ${!isNew && !role?.is_system ? `\r\n            <button type=\"button\" class=\"btn btn-danger\" id=\"btn-delete-role\">Delete</button>\r\n          ` : ''}\r\n          <button type=\"button\" class=\"btn btn-secondary\" id=\"btn-cancel\">Cancel</button>\r\n          <button type=\"submit\" class=\"btn btn-primary\">${isNew ? 'Create Role' : 'Save Changes'}</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  `;\r\n\r\n  bindEditorEvents(container, role);\r\n}\r\n\r\n/**\r\n * Bind editor events\r\n */\r\nfunction bindEditorEvents(container: HTMLElement, role: Role | null): void {\r\n  const editorEl = container.querySelector('#role-editor') as HTMLElement;\r\n  if (!editorEl) return;\r\n\r\n  // Cancel button\r\n  const cancelBtn = editorEl.querySelector('#btn-cancel');\r\n  if (cancelBtn) {\r\n    on(cancelBtn as HTMLElement, 'click', () => {\r\n      editorEl.classList.add('hidden');\r\n      editingRole = null;\r\n      const listEl = container.querySelector('#roles-list') as HTMLElement;\r\n      if (listEl) {\r\n        listEl.querySelectorAll('.role-card').forEach(c => c.classList.remove('active'));\r\n      }\r\n    });\r\n  }\r\n\r\n  // Delete button\r\n  const deleteBtn = editorEl.querySelector('#btn-delete-role');\r\n  if (deleteBtn && role) {\r\n    on(deleteBtn as HTMLElement, 'click', async () => {\r\n      if (!confirm(`Are you sure you want to delete \"${role.display_name || role.name}\"?`)) return;\r\n\r\n      try {\r\n        await http.delete(`/api/role-templates/${role.id}`);\r\n        toast.success('Role deleted');\r\n        editorEl.classList.add('hidden');\r\n        editingRole = null;\r\n        await loadRoles(container);\r\n      } catch {\r\n        toast.error('Failed to delete role');\r\n      }\r\n    });\r\n  }\r\n\r\n  // AI Enhance button\r\n  const aiBtn = editorEl.querySelector('#btn-ai-enhance');\r\n  if (aiBtn) {\r\n    on(aiBtn as HTMLElement, 'click', async () => {\r\n      const nameInput = editorEl.querySelector('#role-name') as HTMLInputElement;\r\n      const contextInput = editorEl.querySelector('#role-context') as HTMLTextAreaElement;\r\n      const descInput = editorEl.querySelector('#role-description') as HTMLTextAreaElement;\r\n\r\n      const roleName = nameInput.value.trim();\r\n      if (!roleName) {\r\n        toast.error('Please enter a role name first');\r\n        return;\r\n      }\r\n\r\n      (aiBtn as HTMLButtonElement).disabled = true;\r\n      aiBtn.innerHTML = `<svg class=\"spin\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"/></svg> Enhancing...`;\r\n\r\n      try {\r\n        const response = await http.post<{ prompt: string; description?: string }>('/api/roles/generate', {\r\n          title: roleName,\r\n          currentContext: contextInput.value,\r\n        });\r\n\r\n        if (response.data.prompt) {\r\n          contextInput.value = response.data.prompt;\r\n        }\r\n        if (response.data.description && !descInput.value) {\r\n          descInput.value = response.data.description;\r\n        }\r\n        toast.success('Role context enhanced with AI');\r\n      } catch {\r\n        toast.error('Failed to enhance with AI');\r\n      } finally {\r\n        (aiBtn as HTMLButtonElement).disabled = false;\r\n        aiBtn.innerHTML = `<svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13 10V3L4 14h7v7l9-11h-7z\"/></svg> Enhance with AI`;\r\n      }\r\n    });\r\n  }\r\n\r\n  // Form submit\r\n  const form = editorEl.querySelector('#role-form') as HTMLFormElement;\r\n  if (form) {\r\n    on(form, 'submit', async (e) => {\r\n      e.preventDefault();\r\n\r\n      const name = (editorEl.querySelector('#role-name') as HTMLInputElement).value.trim();\r\n      const category = (editorEl.querySelector('#role-category') as HTMLSelectElement).value;\r\n      const color = (editorEl.querySelector('#role-color') as HTMLInputElement).value;\r\n      const description = (editorEl.querySelector('#role-description') as HTMLTextAreaElement).value.trim();\r\n      const roleContext = (editorEl.querySelector('#role-context') as HTMLTextAreaElement).value.trim();\r\n      const isTemplate = (editorEl.querySelector('#is-template') as HTMLInputElement).checked;\r\n\r\n      const roleData = {\r\n        name: name.toLowerCase().replace(/\\s+/g, '_'),\r\n        display_name: name,\r\n        description,\r\n        role_context: roleContext,\r\n        category,\r\n        color,\r\n        is_template: isTemplate,\r\n      };\r\n\r\n      try {\r\n        if (role) {\r\n          await http.put(`/api/role-templates/${role.id}`, roleData);\r\n          toast.success('Role updated');\r\n        } else {\r\n          await http.post('/api/role-templates', roleData);\r\n          toast.success('Role created');\r\n        }\r\n\r\n        editorEl.classList.add('hidden');\r\n        editingRole = null;\r\n        await loadRoles(container);\r\n      } catch {\r\n        toast.error('Failed to save role');\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default renderRolesPanel;\r\n","/**\n * AdminPanel Component\n * Platform administration for superadmin users\n * Includes: LLM Config, Graph, Prompts, Processing, Audit Log\n */\n\nimport { createElement, on } from '../utils/dom';\nimport { http } from '../services/api';\nimport { toast } from '../services/toast';\nimport { appStore } from '../stores/app';\nimport { \n  billingService, \n  type ProjectBillingOverview, \n  type PricingConfig, \n  type PricingTier,\n  type ExchangeRateConfig,\n  formatEur, \n  formatTokens \n} from '../services/billing';\n\n// Types\ninterface SystemConfig {\n  id?: string;\n  key: string;\n  value: unknown;\n  category: string;\n  description?: string;\n}\n\ninterface LLMProvider {\n  id: string;\n  name: string;\n  enabled: boolean;\n  models: string[];\n  status?: 'healthy' | 'degraded' | 'offline';\n}\n\ninterface AuditLogEntry {\n  id: string;\n  table_name: string;\n  operation: string;\n  old_values?: Record<string, unknown>;\n  new_values?: Record<string, unknown>;\n  changed_by_email?: string;\n  changed_at: string;\n}\n\ninterface SystemPrompt {\n  id: string;\n  key: string;\n  name: string;\n  description: string;\n  category: string;\n  prompt_template: string;\n  uses_ontology: boolean;\n}\n\n// Ontology state (for Admin Ontology tab)\ninterface OntologyEntityType {\n  name: string;\n  properties?: string[];\n  searchable?: string[];\n  required?: string[];\n  sharedEntity?: boolean;\n}\ninterface OntologyRelationType {\n  name: string;\n  sourceType?: string;\n  targetType?: string;\n}\nlet ontologyEntities: OntologyEntityType[] = [];\nlet ontologyRelations: OntologyRelationType[] = [];\nlet ontologyLoaded = false;\nlet ontologyLoading = false;\n\n// Graph overview state (for Graph section)\ninterface GraphListItem {\n  graphName: string;\n  projectId?: string | null;\n  projectName?: string | null;\n}\nlet graphList: GraphListItem[] = [];\nlet graphStatus: { enabled?: boolean; graphName?: string; stats?: { nodes?: number; relationships?: number } } | null = null;\nlet graphOverviewLoaded = false;\nlet graphOverviewLoading = false;\nlet graphPasswordSet = false; // Track if GRAPH_PASSWORD secret exists\n\n// State\nlet currentSection = 'llm';\nlet systemConfig: Record<string, SystemConfig[]> = {};\nlet providers: LLMProvider[] = [];\nlet auditLogs: AuditLogEntry[] = [];\nlet systemPrompts: SystemPrompt[] = [];\nlet isLoading = false;\n\n// Team Analysis settings state (per-project, loaded on demand)\ninterface TeamAnalysisSettings {\n  enabled: boolean;\n  access: 'admin_only' | 'all';\n}\nlet teamAnalysisSettings: TeamAnalysisSettings = { enabled: true, access: 'admin_only' };\nlet teamAnalysisLoaded = false;\nlet teamAnalysisLoading = false;\n\n// Billing state\nlet billingProjects: ProjectBillingOverview[] = [];\nlet globalPricingConfig: PricingConfig | null = null;\nlet globalPricingTiers: PricingTier[] = [];\nlet exchangeRateConfig: ExchangeRateConfig | null = null;\nlet billingLoaded = false;\nlet billingLoading = false;\n\n// Google Drive state\ninterface GoogleDriveState {\n  enabled: boolean;\n  rootFolderId: string;\n  hasSystemCredentials: boolean;\n  bootstrappedAt: string | null;\n}\nlet googleDriveState: GoogleDriveState | null = null;\nlet googleDriveLoading = false;\nlet googleDriveLoaded = false;\n\n/**\n * Load system configuration\n */\nasync function loadSystemConfig(): Promise<void> {\n  try {\n    const response = await http.get<{ \n      llm_pertask?: { text?: { provider: string; model: string }; vision?: { provider: string; model: string }; embeddings?: { provider: string; model: string } };\n      prompts?: Record<string, unknown>;\n      processing?: Record<string, unknown>;\n      graph?: Record<string, unknown>;\n    }>('/api/system/config');\n    \n    // Convert to internal format grouped by category\n    systemConfig = {};\n    \n    // LLM per-task configs\n    if (response.data?.llm_pertask) {\n      systemConfig['llm'] = [];\n      const perTask = response.data.llm_pertask;\n      if (perTask.text) {\n        systemConfig['llm'].push({ key: 'text_provider', value: perTask.text, category: 'llm' });\n      }\n      if (perTask.vision) {\n        systemConfig['llm'].push({ key: 'vision_provider', value: perTask.vision, category: 'llm' });\n      }\n      if (perTask.embeddings) {\n        systemConfig['llm'].push({ key: 'embeddings_provider', value: perTask.embeddings, category: 'llm' });\n      }\n    }\n    \n    // Processing config\n    if (response.data?.processing) {\n      systemConfig['processing'] = [{ key: 'processing', value: response.data.processing, category: 'processing' }];\n    }\n    \n    // Graph config\n    if (response.data?.graph) {\n      systemConfig['graph'] = [{ key: 'graph', value: response.data.graph, category: 'graph' }];\n    }\n    \n    console.log('[AdminPanel] Loaded system config:', systemConfig);\n  } catch (error) {\n    console.warn('Failed to load system config:', error);\n    systemConfig = {};\n  }\n}\n\n/**\n * Load secrets to check if graph password is set\n */\nasync function loadSecrets(): Promise<void> {\n  try {\n    const response = await http.get<{ secrets: Array<{ name: string; masked_value?: string }> }>('/api/secrets');\n    const secrets = response.data?.secrets || [];\n    graphPasswordSet = secrets.some(s => s.name === 'GRAPH_PASSWORD');\n    console.log('[AdminPanel] Graph password set:', graphPasswordSet);\n  } catch (error) {\n    console.warn('Failed to load secrets:', error);\n    graphPasswordSet = false;\n  }\n}\n\n/** Fallback provider list when API fails (no hardcoded models; models loaded via API per provider) */\nconst DEFAULT_PROVIDER_IDS: Array<{ id: string; name: string }> = [\n  { id: 'openai', name: 'OpenAI' },\n  { id: 'anthropic', name: 'Anthropic (Claude)' },\n  { id: 'google', name: 'Google AI (Gemini)' },\n  { id: 'xai', name: 'xAI (Grok)' },\n  { id: 'deepseek', name: 'DeepSeek' },\n  { id: 'kimi', name: 'Kimi (Moonshot)' },\n  { id: 'minimax', name: 'MiniMax' },\n  { id: 'ollama', name: 'Ollama (Local)' },\n];\n\n/**\n * Load LLM providers from API (central source of truth). Normalizes response to LLMProvider shape.\n */\nasync function loadProviders(): Promise<void> {\n  const defaultProviders: LLMProvider[] = DEFAULT_PROVIDER_IDS.map(p => ({\n    id: p.id,\n    name: p.name,\n    enabled: false,\n    models: [],\n  }));\n\n  try {\n    const response = await http.get<{ providers: Array<{ id: string; name?: string; label?: string; enabled?: boolean; models?: string[] }> }>('/api/llm/providers');\n    const apiProviders = response.data?.providers;\n    if (Array.isArray(apiProviders) && apiProviders.length > 0) {\n      providers = apiProviders.map(p => ({\n        id: p.id,\n        name: p.name ?? p.label ?? p.id,\n        enabled: p.enabled ?? false,\n        models: Array.isArray(p.models) ? p.models : [],\n      }));\n    } else {\n      providers = defaultProviders;\n    }\n  } catch (error) {\n    console.warn('Failed to load providers, using defaults:', error);\n    providers = defaultProviders;\n  }\n}\n\n/**\n * Load audit logs\n */\nasync function loadAuditLogs(): Promise<void> {\n  try {\n    const response = await http.get<{ logs: AuditLogEntry[] }>('/api/system/audit?limit=50');\n    auditLogs = Array.isArray(response.data?.logs) ? response.data.logs : [];\n  } catch (error) {\n    console.warn('Failed to load audit logs:', error);\n    auditLogs = [];\n  }\n}\n\n/**\n * Load system prompts\n */\nasync function loadSystemPrompts(): Promise<void> {\n  try {\n    const response = await http.get<{ prompts: SystemPrompt[] }>('/api/system/prompts');\n    systemPrompts = Array.isArray(response.data?.prompts) ? response.data.prompts : [];\n  } catch (error) {\n    console.warn('Failed to load system prompts:', error);\n    // Use default prompts structure\n    systemPrompts = [\n      { id: '1', key: 'document', name: 'Document Extraction', description: 'Extract information from PDFs and text files', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '2', key: 'transcript', name: 'Transcript Extraction', description: 'Extract information from meeting transcripts', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '3', key: 'vision', name: 'Vision/Image Extraction', description: 'Extract information from images and diagrams', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '4', key: 'conversation', name: 'Conversation Extraction', description: 'Extract information from chat conversations', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '5', key: 'email', name: 'Email Extraction', description: 'Extract information from emails', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '6', key: 'summary', name: 'Content Summary', description: 'Generate concise summaries', category: 'analysis', prompt_template: '', uses_ontology: false },\n    ];\n  }\n}\n\n/**\n * Load ontology data (entities and relations) for Admin Ontology tab\n */\nasync function loadOntologyData(): Promise<void> {\n  ontologyLoading = true;\n  try {\n    const [entitiesRes, relationsRes] = await Promise.all([\n      http.get<{ ok: boolean; entityTypes?: OntologyEntityType[] }>('/api/ontology/entities'),\n      http.get<{ ok: boolean; relationTypes?: OntologyRelationType[] }>('/api/ontology/relations'),\n    ]);\n    ontologyEntities = entitiesRes.data?.entityTypes ?? [];\n    ontologyRelations = relationsRes.data?.relationTypes ?? [];\n    ontologyLoaded = true;\n  } catch (error) {\n    console.warn('Failed to load ontology:', error);\n    ontologyEntities = [];\n    ontologyRelations = [];\n  } finally {\n    ontologyLoading = false;\n  }\n}\n\n/**\n * Load graph overview (list + status) for Graph section\n */\nasync function loadGraphOverview(): Promise<void> {\n  graphOverviewLoading = true;\n  try {\n    const [listRes, statusRes] = await Promise.all([\n      http.get<{ ok: boolean; graphs?: GraphListItem[]; error?: string }>('/api/graph/list'),\n      http.get<{ enabled?: boolean; graphName?: string; stats?: { nodes?: number; relationships?: number } }>('/api/graph/status').catch(() => ({ data: {} })),\n    ]);\n    graphList = listRes.data?.graphs ?? [];\n    if (listRes.data?.error) {\n      graphList = [];\n    }\n    graphStatus = statusRes.data ?? null;\n    graphOverviewLoaded = true;\n  } catch (error) {\n    console.warn('Failed to load graph overview:', error);\n    graphList = [];\n    graphStatus = null;\n  } finally {\n    graphOverviewLoading = false;\n  }\n}\n\n/**\n * Save a config value\n */\nasync function saveConfig(key: string, value: unknown, category: string): Promise<void> {\n  try {\n    await http.post('/api/system/config', { key, value, category });\n    toast.success('Configuration saved');\n    await loadSystemConfig();\n  } catch (error) {\n    toast.error('Failed to save configuration');\n  }\n}\n\n/**\n * Test provider connection\n */\nasync function testProvider(providerId: string): Promise<void> {\n  try {\n    const response = await http.post<{ ok: boolean; error?: { message: string }; models?: number }>(`/api/llm/test/${providerId}`);\n    if (response.data.ok) {\n      const models = response.data.models ? ` (${response.data.models} models)` : '';\n      toast.success(`${providerId} connection successful${models}`);\n    } else {\n      toast.error(response.data.error?.message || 'Connection failed');\n    }\n  } catch (error) {\n    toast.error('Connection test failed');\n  }\n}\n\n/**\n * Get config value by key\n */\nfunction getConfigValue(category: string, key: string, defaultValue: unknown = ''): unknown {\n  const configs = systemConfig[category] || [];\n  \n  // For graph category, the config is stored as { key: 'graph', value: { enabled, graphName, provider } }\n  if (category === 'graph') {\n    const graphConfigEntry = configs.find(c => c.key === 'graph');\n    if (graphConfigEntry?.value && typeof graphConfigEntry.value === 'object') {\n      const graphValue = graphConfigEntry.value as Record<string, unknown>;\n      return graphValue[key] ?? defaultValue;\n    }\n  }\n  \n  const config = configs.find(c => c.key === key);\n  return config?.value ?? defaultValue;\n}\n\n/**\n * Render section navigation\n */\nfunction renderNav(): string {\n  const sections = [\n    { id: 'llm', label: 'LLM Providers', icon: 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z' },\n    { id: 'models', label: 'Model Metadata', icon: 'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10' },\n    { id: 'queue', label: 'LLM Queue', icon: 'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15' },\n    { id: 'graph', label: 'Graph', icon: 'M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4' },\n    { id: 'ontology', label: 'Ontology', icon: 'M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z' },\n    { id: 'prompts', label: 'Prompts', icon: 'M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z' },\n    { id: 'processing', label: 'Processing', icon: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z' },\n    { id: 'team-analysis', label: 'Team Analysis', icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' },\n    { id: 'google-drive', label: 'Google Drive', icon: 'M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12' },\n    { id: 'billing', label: 'Billing', icon: 'M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z' },\n    { id: 'audit', label: 'Audit Log', icon: 'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01' },\n  ];\n\n  return sections.map(s => `\n    <button class=\"admin-nav-btn ${currentSection === s.id ? 'active' : ''}\" data-section=\"${s.id}\">\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"20\" height=\"20\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"${s.icon}\"/>\n      </svg>\n      <span>${s.label}</span>\n    </button>\n  `).join('');\n}\n\n/**\n * Render LLM Providers section\n */\nfunction renderLLMSection(): string {\n  const taskTypes = ['text', 'vision', 'embeddings'];\n  \n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>LLM Provider Configuration</h3>\n        <p>Configure AI providers for different task types</p>\n      </div>\n\n      <!-- Provider Status -->\n      <div class=\"admin-card\">\n        <h4>Provider Health</h4>\n        <div class=\"provider-grid\">\n          ${providers.map(p => `\n            <div class=\"provider-card ${p.enabled ? 'enabled' : 'disabled'}\">\n              <div class=\"provider-header\">\n                <span class=\"provider-name\">${p.name}</span>\n                <span class=\"provider-status ${p.status || 'unknown'}\">${p.status || 'unknown'}</span>\n              </div>\n              <div class=\"provider-models\">${(p.models && p.models.length > 0) ? p.models.slice(0, 3).join(', ') : ''}</div>\n              <div class=\"provider-actions\">\n                <button class=\"btn-sm\" data-test-provider=\"${p.id}\">Test</button>\n                <label class=\"toggle-switch\">\n                  <input type=\"checkbox\" ${p.enabled ? 'checked' : ''} data-toggle-provider=\"${p.id}\">\n                  <span class=\"slider\"></span>\n                </label>\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n\n      <!-- Task Configuration -->\n      <div class=\"admin-card\">\n        <h4>Task-Specific AI Configuration</h4>\n        <p class=\"text-muted\">Configure which provider and model to use for each AI task. These settings apply globally to the platform and are persisted in Supabase.</p>\n        \n        ${taskTypes.map(task => {\n          const taskConfig = getConfigValue('llm', task + '_provider', { provider: '', model: '' }) as { provider: string; model: string };\n          const icons: Record<string, string> = { text: '', vision: '', embeddings: '' };\n          const labels: Record<string, string> = { text: 'Text / Chat', vision: 'Vision / Images', embeddings: 'Embeddings' };\n          const descs: Record<string, string> = { \n            text: 'Document analysis, chat, briefings, Q&A, extraction',\n            vision: 'Image analysis, scanned documents, diagrams, charts',\n            embeddings: 'Semantic search, similarity matching, RAG'\n          };\n          const icon = icons[task] || '';\n          const label = labels[task] || task;\n          const desc = descs[task] || '';\n          const providerOpts = ['openai', 'anthropic', 'google', 'deepseek', 'grok', 'kimi', 'minimax', 'ollama'];\n          const providerNames: Record<string, string> = {\n            openai: 'OpenAI', anthropic: 'Anthropic (Claude)', google: 'Google AI (Gemini)',\n            deepseek: 'DeepSeek', grok: 'xAI (Grok)', kimi: 'Kimi (Moonshot)', \n            minimax: 'MiniMax', ollama: 'Ollama (Local)'\n          };\n          \n          return '<div class=\"task-config-row admin-task-config-row\" data-task-row=\"' + task + '\">' +\n            '<div class=\"task-label admin-task-label\">' +\n              '<span class=\"admin-task-label-icon\">' + icon + '</span>' +\n              '<strong class=\"admin-task-label-strong\">' + label + '</strong>' +\n              '<span class=\"text-muted admin-task-desc\">' + desc + '</span>' +\n            '</div>' +\n            '<div class=\"task-selects admin-task-selects\">' +\n              '<div>' +\n                '<label class=\"admin-field-label\">Provider</label>' +\n                '<select class=\"form-select provider-select\" data-task=\"' + task + '\" data-field=\"provider\">' +\n                  '<option value=\"\"' + (!taskConfig.provider ? ' selected' : '') + '>-- Select Provider --</option>' +\n                  providerOpts.map(p => '<option value=\"' + p + '\"' + (taskConfig.provider === p ? ' selected' : '') + '>' + providerNames[p] + '</option>').join('') +\n                '</select>' +\n              '</div>' +\n              '<div>' +\n                '<label class=\"admin-field-label\">Model</label>' +\n                '<select class=\"form-select model-select\" data-task=\"' + task + '\" data-field=\"model\">' +\n                  '<option value=\"\">-- Select Provider First --</option>' +\n                  (taskConfig.model ? '<option value=\"' + taskConfig.model + '\" selected>' + taskConfig.model + '</option>' : '') +\n                '</select>' +\n                '<span class=\"model-loading hidden\" data-task=\"' + task + '\">Loading models...</span>' +\n              '</div>' +\n            '</div>' +\n            '<div class=\"model-status admin-model-status\" data-task=\"' + task + '\"></div>' +\n          '</div>';\n        }).join('')}\n        \n        <div class=\"admin-llm-save-row\">\n          <button class=\"btn-primary\" id=\"save-llm-config\">Save LLM Configuration</button>\n          <span class=\"text-muted admin-llm-warning\"> Changes apply immediately to all AI processing</span>\n        </div>\n      </div>\n\n      <!-- API Keys - LLM Providers -->\n      <div class=\"admin-card\">\n        <h4>LLM API Keys</h4>\n        <p class=\"text-muted\">System-level API keys (stored encrypted in Supabase)</p>\n        \n        <div class=\"api-keys-grid\" id=\"api-keys-container\">\n          <div class=\"form-group\" data-secret-name=\"OPENAI_API_KEY\">\n            <label>OpenAI <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"openai-key\" name=\"llm_key_openai_${Date.now()}\" placeholder=\"sk-proj-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"openai-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"CLAUDE_API_KEY\">\n            <label>Anthropic (Claude) <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"anthropic-key\" name=\"llm_key_claude_${Date.now()}\" placeholder=\"sk-ant-api03-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"anthropic-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"GOOGLE_API_KEY\">\n            <label>Google AI (Gemini) <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"google-key\" name=\"llm_key_google_${Date.now()}\" placeholder=\"AIza...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"google-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"XAI_API_KEY\">\n            <label>xAI (Grok) <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"xai-key\" name=\"llm_key_xai_${Date.now()}\" placeholder=\"xai-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"xai-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"DEEPSEEK_API_KEY\">\n            <label>DeepSeek <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"deepseek-key\" name=\"llm_key_deepseek_${Date.now()}\" placeholder=\"sk-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"deepseek-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"KIMI_API_KEY\">\n            <label>Kimi (Moonshot) <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"kimi-key\" name=\"llm_key_kimi_${Date.now()}\" placeholder=\"sk-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"kimi-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"MINIMAX_API_KEY\">\n            <label>MiniMax <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"minimax-key\" name=\"llm_key_minimax_${Date.now()}\" placeholder=\"MINIMAX-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn-icon\" data-toggle-visibility=\"minimax-key\">Show</button>\n            </div>\n          </div>\n        </div>\n        \n        <div id=\"api-keys-loading\" class=\"admin-keys-loading\">Loading configured keys...</div>\n        <button class=\"btn-primary mt-4\" id=\"save-api-keys\">Save LLM API Keys</button>\n      </div>\n\n      <!-- Service API Keys -->\n      <div class=\"admin-card\">\n        <h4>Service API Keys</h4>\n        <p class=\"text-muted\">Keys for email, notifications and other services</p>\n        \n        <div class=\"form-group\" data-secret-name=\"RESEND_API_KEY\">\n          <label>Resend API Key (Email Service) <span class=\"key-status admin-key-status\"></span></label>\n          <div class=\"input-group\">\n            <input type=\"text\" id=\"resend-key\" name=\"service_key_resend_${Date.now()}\" placeholder=\"re_...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n            <button class=\"btn-icon\" data-toggle-visibility=\"resend-key\">Show</button>\n          </div>\n        </div>\n        \n        <div class=\"form-group\" data-secret-name=\"BRAVE_API_KEY\">\n          <label>Brave Search API Key (Company analysis) <span class=\"key-status admin-key-status\"></span></label>\n          <div class=\"input-group\">\n            <input type=\"password\" id=\"brave-key\" name=\"service_key_brave_${Date.now()}\" placeholder=\"Optional  for richer company reports\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n            <button class=\"btn-icon\" data-toggle-visibility=\"brave-key\">Show</button>\n          </div>\n          <p class=\"text-muted text-sm\">Get key at <a href=\"https://api-dashboard.search.brave.com/documentation\" target=\"_blank\" rel=\"noopener\">Brave Search API</a>. Used to enrich company analysis with web search.</p>\n        </div>\n        \n        <button class=\"btn-primary mt-4\" id=\"save-service-keys\">Save Service Keys</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Graph section (Supabase Graph)\n */\nfunction renderGraphSection(): string {\n  const graphConfig = {\n    enabled: getConfigValue('graph', 'enabled', false) as boolean,\n    graphName: getConfigValue('graph', 'graphName', 'godmode') as string,\n  };\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Graph Database Configuration</h3>\n        <p>Supabase Graph for knowledge graph and GraphRAG</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <div class=\"form-group\">\n          <label class=\"toggle-label\">\n            <input type=\"checkbox\" id=\"graph-enabled\" ${graphConfig.enabled ? 'checked' : ''}>\n            <span>Enable Graph Database</span>\n          </label>\n        </div>\n\n        <div class=\"form-group admin-form-group-box\">\n          <p class=\"admin-form-group-p\">\n            <strong>Provider:</strong> Supabase Graph (PostgreSQL-based)\n          </p>\n          <p class=\"admin-form-group-p-sm\">\n            Uses your existing Supabase connection. No additional configuration needed.\n          </p>\n        </div>\n\n        <div class=\"form-group\">\n          <label>Graph Name</label>\n          <input type=\"text\" id=\"graph-name\" value=\"${graphConfig.graphName}\" class=\"form-input\" placeholder=\"godmode\">\n        </div>\n\n        <div class=\"btn-group mt-4\">\n          <button class=\"btn-primary\" id=\"save-graph-config\">Save Configuration</button>\n          <button class=\"btn-secondary\" id=\"test-graph-connection\">Test Connection</button>\n        </div>\n      </div>\n\n      <div class=\"admin-card\" id=\"graph-overview-card\">\n        <h4>Graph overview</h4>\n        <p class=\"text-muted\">Current graph status. Enable and save configuration above first.</p>\n        <div id=\"graph-overview-content\">\n          ${graphOverviewLoading ? '<p class=\"text-muted\">Loading...</p>' : !graphOverviewLoaded ? '<button class=\"btn-secondary\" id=\"load-graph-overview\">Load overview</button>' : (graphList.length === 0 && !graphStatus?.enabled ? '<p class=\"text-muted\">Graph not enabled or not connected. Enable and save configuration.</p><button class=\"btn-secondary mt-4\" id=\"refresh-graph-overview\">Refresh</button>' : `\n            ${graphStatus?.enabled && (graphStatus.stats != null || graphStatus.graphName) ? `\n              <div class=\"graph-status-row admin-graph-status-row\">\n                <strong>Current graph:</strong> ${graphStatus.graphName ?? ''}\n                ${graphStatus.stats?.nodes !== undefined ? `  Nodes: ${graphStatus.stats.nodes}` : ''}\n                ${graphStatus.stats?.relationships !== undefined ? `  Edges: ${graphStatus.stats.relationships}` : ''}\n              </div>\n            ` : ''}\n            ${graphList.length > 0 ? `\n              <table class=\"admin-table admin-table-full\">\n                <thead><tr><th>Graph name</th><th>Project</th></tr></thead>\n                <tbody>\n                  ${graphList.map(g => `<tr><td><code>${g.graphName}</code></td><td>${g.projectName ?? ''}</td></tr>`).join('')}\n                </tbody>\n              </table>\n            ` : ''}\n            <div class=\"btn-group mt-4\">\n              <button class=\"btn-secondary\" id=\"open-graph-tab\">Open in Graph tab</button>\n              <button class=\"btn-secondary\" id=\"refresh-graph-overview\">Refresh</button>\n            </div>\n          `)}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Ontology section\n */\nfunction renderOntologySection(): string {\n  if (ontologyLoading || !ontologyLoaded) {\n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Ontology</h3>\n        <p>Entity types and relation types used by extraction and GraphRAG</p>\n      </div>\n      <div class=\"admin-card\">\n        <p class=\"text-muted\">${ontologyLoading ? 'Loading ontology...' : 'Click Load to fetch entity and relation types from the API.'}</p>\n        ${!ontologyLoading ? '<button class=\"btn-primary\" id=\"load-ontology\">Load ontology</button>' : ''}\n      </div>\n    </div>\n    `;\n  }\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Ontology</h3>\n        <p>Entity types and relation types used by extraction and GraphRAG</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Entity types</h4>\n        <p class=\"text-muted\">Types of entities that can be extracted and stored in the graph.</p>\n        ${ontologyEntities.length === 0 ? '<p class=\"text-muted\">No entity types returned.</p>' : `\n          <ul class=\"ontology-list\">\n            ${ontologyEntities.map(e => `\n              <li><code>${e.name}</code>\n                ${e.sharedEntity ? ' <span class=\"badge badge-info\">shared</span>' : ''}\n                ${e.properties?.length ? `  properties: ${e.properties.join(', ')}` : ''}\n              </li>\n            `).join('')}\n          </ul>\n        `}\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Relation types</h4>\n        <p class=\"text-muted\">Allowed relationships between entity types.</p>\n        ${ontologyRelations.length === 0 ? '<p class=\"text-muted\">No relation types returned.</p>' : `\n          <ul class=\"ontology-list\">\n            ${ontologyRelations.map(r => `\n              <li><code>${r.name}</code>\n                ${(r as { sourceType?: string; targetType?: string }).sourceType ? ` (${(r as { sourceType?: string; targetType?: string }).sourceType}  ${(r as { sourceType?: string; targetType?: string }).targetType})` : ''}\n              </li>\n            `).join('')}\n          </ul>\n        `}\n      </div>\n\n      <div class=\"btn-group mt-4\">\n        <button class=\"btn-secondary\" id=\"reload-ontology\">Reload ontology</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Prompts section\n */\nfunction renderPromptsSection(): string {\n  // Group prompts by category\n  const extractionPrompts = systemPrompts.filter(p => p.category === 'extraction');\n  const analysisPrompts = systemPrompts.filter(p => p.category === 'analysis');\n  const templatePrompts = systemPrompts.filter(p => p.category === 'template');\n  const sprintPrompts = systemPrompts.filter(p => p.category === 'sprint');\n  const reportPrompts = systemPrompts.filter(p => p.category === 'report');\n\n  const renderPromptCard = (p: SystemPrompt) => `\n    <div class=\"admin-card prompt-card\" data-prompt-id=\"${p.id}\">\n      <div class=\"prompt-header\">\n        <div>\n          <h4>${p.name}</h4>\n          <p class=\"text-muted\">${p.description}</p>\n        </div>\n        <div class=\"prompt-badges\">\n          ${p.uses_ontology ? '<span class=\"badge badge-info\">Ontology-Aware</span>' : ''}\n          <span class=\"badge badge-secondary\">${p.key}</span>\n        </div>\n      </div>\n      <textarea class=\"form-textarea prompt-editor\" data-prompt-key=\"${p.key}\" rows=\"12\" \n                placeholder=\"Enter prompt template...\n\nAvailable placeholders:\n{{CONTENT}} - The document/transcript content\n{{FILENAME}} - The file/document name\n{{TODAY}} - Current date\n{{ONTOLOGY_SECTION}} - Ontology context (if uses_ontology=true)\n{{ROLE_CONTEXT}} - User role context\n{{PROJECT_CONTEXT}} - Project context\">${p.prompt_template || ''}</textarea>\n      <div class=\"prompt-actions\">\n        <button class=\"btn-sm btn-secondary\" data-view-versions=\"${p.key}\">\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n            <polyline points=\"12,6 12,12 16,14\"/>\n          </svg>\n          Version History\n        </button>\n        <span class=\"prompt-status\" id=\"status-${p.key}\"></span>\n      </div>\n      <div class=\"version-history hidden\" id=\"versions-${p.key}\">\n        <div class=\"version-list\"></div>\n      </div>\n    </div>\n  `;\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>AI Prompts Configuration</h3>\n        <p>Customize ontology-aware prompts for AI extraction. All prompts support template variables.</p>\n      </div>\n\n      <div class=\"prompt-info admin-card\">\n        <h4>Template Variables</h4>\n        <div class=\"variables-grid\">\n          <code>{{CONTENT}}</code> <span>Document/transcript content</span>\n          <code>{{FILENAME}}</code> <span>File or document name</span>\n          <code>{{TODAY}}</code> <span>Current date (YYYY-MM-DD)</span>\n          <code>{{ONTOLOGY_SECTION}}</code> <span>Injected ontology context</span>\n          <code>{{ROLE_CONTEXT}}</code> <span>User role context line</span>\n          <code>{{PROJECT_CONTEXT}}</code> <span>Project context line</span>\n          <code>{{CONTENT_LENGTH}}</code> <span>Content length in characters</span>\n        </div>\n      </div>\n\n      <h4 class=\"section-subtitle\">Extraction Prompts</h4>\n      ${extractionPrompts.length > 0 ? extractionPrompts.map(renderPromptCard).join('') : '<p class=\"text-muted\">Run migration 031 to create default prompts</p>'}\n\n      ${analysisPrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Analysis Prompts</h4>\n        ${analysisPrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      ${templatePrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Template Sections</h4>\n        ${templatePrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      ${sprintPrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Sprint / Task prompts</h4>\n        <p class=\"text-muted\">Prompts for task description from rules, user stories, and dependencies. Used when adding tasks manually and in sprint flows.</p>\n        ${sprintPrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      ${reportPrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Report prompts (Relatrios)</h4>\n        <p class=\"text-muted\">Prompts for generating sprint reports as A4 document or PPT-style presentation. Placeholders: {{REPORT_DATA}}, {{STYLE_VARIANT}} (document only).</p>\n        ${reportPrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      <div class=\"btn-group mt-4\">\n        <button class=\"btn-primary\" id=\"save-prompts\">Save All Prompts</button>\n        <button class=\"btn-secondary\" id=\"reload-prompts\">Reload from Database</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Processing section\n */\nfunction renderProcessingSection(): string {\n  const processing = {\n    chunkSize: getConfigValue('processing', 'chunk_size', 1000) as number,\n    chunkOverlap: getConfigValue('processing', 'chunk_overlap', 200) as number,\n    maxTokens: getConfigValue('processing', 'max_tokens', 4096) as number,\n    temperature: getConfigValue('processing', 'temperature', 0.7) as number,\n    autoProcess: getConfigValue('processing', 'auto_process', true) as boolean,\n    parallelJobs: getConfigValue('processing', 'parallel_jobs', 3) as number,\n  };\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Document Processing Settings</h3>\n        <p>Configure how documents are processed and analyzed</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Chunking Settings</h4>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label>Chunk Size (tokens)</label>\n            <input type=\"number\" id=\"proc-chunk-size\" value=\"${processing.chunkSize}\" class=\"form-input\" min=\"100\" max=\"8000\">\n          </div>\n          <div class=\"form-group\">\n            <label>Chunk Overlap (tokens)</label>\n            <input type=\"number\" id=\"proc-chunk-overlap\" value=\"${processing.chunkOverlap}\" class=\"form-input\" min=\"0\" max=\"1000\">\n          </div>\n        </div>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Generation Settings</h4>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label>Max Tokens</label>\n            <input type=\"number\" id=\"proc-max-tokens\" value=\"${processing.maxTokens}\" class=\"form-input\" min=\"256\" max=\"32000\">\n          </div>\n          <div class=\"form-group\">\n            <label>Temperature</label>\n            <input type=\"number\" id=\"proc-temperature\" value=\"${processing.temperature}\" class=\"form-input\" min=\"0\" max=\"2\" step=\"0.1\">\n          </div>\n        </div>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Job Settings</h4>\n        \n        <div class=\"form-group\">\n          <label class=\"toggle-label\">\n            <input type=\"checkbox\" id=\"proc-auto-process\" ${processing.autoProcess ? 'checked' : ''}>\n            <span>Auto-process uploaded documents</span>\n          </label>\n        </div>\n        \n        <div class=\"form-group\">\n          <label>Parallel Jobs</label>\n          <input type=\"number\" id=\"proc-parallel-jobs\" value=\"${processing.parallelJobs}\" class=\"form-input\" min=\"1\" max=\"10\">\n        </div>\n      </div>\n\n      <button class=\"btn-primary\" id=\"save-processing\">Save Processing Settings</button>\n    </div>\n  `;\n}\n\n/**\n * Load Team Analysis settings for current project\n */\nasync function loadTeamAnalysisSettings(): Promise<void> {\n  const state = appStore.getState();\n  const projectId = state.currentProject?.id;\n  \n  if (!projectId) {\n    teamAnalysisSettings = { enabled: true, access: 'admin_only' };\n    teamAnalysisLoaded = true;\n    return;\n  }\n  \n  teamAnalysisLoading = true;\n  \n  try {\n    const response = await http.get<{ ok: boolean; config: { enabled: boolean; access: string } }>('/api/team-analysis/config');\n    teamAnalysisSettings = {\n      enabled: response?.config?.enabled ?? true,\n      access: (response?.config?.access as 'admin_only' | 'all') ?? 'admin_only'\n    };\n    teamAnalysisLoaded = true;\n  } catch (error) {\n    console.error('[AdminPanel] Error loading team analysis settings:', error);\n    teamAnalysisSettings = { enabled: true, access: 'admin_only' };\n    teamAnalysisLoaded = true;\n  } finally {\n    teamAnalysisLoading = false;\n  }\n}\n\n/**\n * Save Team Analysis settings\n */\nasync function saveTeamAnalysisSettings(enabled: boolean, access: string): Promise<void> {\n  const state = appStore.getState();\n  const projectId = state.currentProject?.id;\n  \n  if (!projectId) {\n    toast.error('No project selected');\n    return;\n  }\n  \n  try {\n    await http.put('/api/team-analysis/config', {\n      enabled,\n      access\n    });\n    \n    teamAnalysisSettings = { enabled, access: access as 'admin_only' | 'all' };\n    toast.success('Team Analysis settings saved');\n  } catch (error) {\n    console.error('[AdminPanel] Error saving team analysis settings:', error);\n    toast.error('Failed to save settings');\n  }\n}\n\n/**\n * Load Google Drive config (GET /api/system/google-drive)\n */\nasync function loadGoogleDriveState(): Promise<void> {\n  googleDriveLoading = true;\n  try {\n    const response = await http.get<GoogleDriveState>('/api/system/google-drive');\n    googleDriveState = {\n      enabled: response?.enabled ?? false,\n      rootFolderId: response?.rootFolderId ?? '',\n      hasSystemCredentials: response?.hasSystemCredentials ?? false,\n      bootstrappedAt: response?.bootstrappedAt ?? null\n    };\n    googleDriveLoaded = true;\n  } catch (error) {\n    console.error('[AdminPanel] Error loading Google Drive config:', error);\n    googleDriveState = { enabled: false, rootFolderId: '', hasSystemCredentials: false, bootstrappedAt: null };\n    googleDriveLoaded = true;\n  } finally {\n    googleDriveLoading = false;\n  }\n}\n\n/**\n * Render Google Drive section\n */\nfunction renderGoogleDriveSection(): string {\n  if (googleDriveLoading || !googleDriveLoaded) {\n    if (!googleDriveLoading && !googleDriveLoaded) loadGoogleDriveState();\n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Google Drive</h3>\n        <p>Store uploads and transcripts in Google Drive</p>\n      </div>\n      <div class=\"admin-card\">\n        <div class=\"admin-empty-state\"><div class=\"loading-spinner\"></div><p>Loading...</p></div>\n      </div>\n    </div>`;\n  }\n  const gd = googleDriveState!;\n  return `\n  <div class=\"admin-section\">\n    <div class=\"admin-section-header\">\n      <h3>Google Drive</h3>\n      <p>Store uploads and transcripts in Google Drive. Configure system account and root folder, then bootstrap projects.</p>\n    </div>\n    <div class=\"admin-card\">\n      <h4>Integration</h4>\n      <div class=\"form-group admin-form-group-box\">\n        <label class=\"admin-checkbox-label\">\n          <input type=\"checkbox\" id=\"google-drive-enabled\" ${gd.enabled ? 'checked' : ''}>\n          Enable Google Drive for uploads\n        </label>\n      </div>\n      <div class=\"form-group admin-form-group-box\">\n        <label class=\"admin-field-label-block\">Root Folder ID</label>\n        <input type=\"text\" id=\"google-drive-root-folder\" class=\"form-input\" placeholder=\"Google Drive folder ID\" value=\"${(gd.rootFolderId || '').replace(/\"/g, '&quot;')}\">\n        <p class=\"text-muted admin-field-hint\">Create a folder in Google Drive and paste its ID here. All project folders will be created under it.</p>\n      </div>\n      <div class=\"form-group admin-form-group-box\">\n        <label class=\"admin-field-label-block\">System Service Account JSON</label>\n        <textarea id=\"google-drive-service-json\" class=\"form-input\" rows=\"4\" placeholder=\"${gd.hasSystemCredentials ? 'Already configured. Paste new JSON to replace.' : 'Paste the full JSON key file content'}\"></textarea>\n        ${gd.hasSystemCredentials ? '<p class=\"text-muted\">Credentials are stored. Paste new JSON only to replace.</p>' : ''}\n      </div>\n      <button type=\"button\" class=\"btn-primary\" id=\"save-google-drive\">Save Google Drive config</button>\n    </div>\n    <div class=\"admin-card\">\n      <h4>Bootstrap projects</h4>\n      <p class=\"text-muted admin-mb-4\">Create folder structure (uploads, newtranscripts, archived, exports) for all projects under the root folder.</p>\n      <button type=\"button\" class=\"btn-secondary\" id=\"bootstrap-google-drive\">Bootstrap all projects</button>\n      ${gd.bootstrappedAt ? `<p class=\"text-muted admin-mt-2\">Last run: ${gd.bootstrappedAt}</p>` : ''}\n    </div>\n  </div>`;\n}\n\n/**\n * Render Team Analysis section\n */\nfunction renderTeamAnalysisSection(): string {\n  const state = appStore.getState();\n  const projectId = state.currentProject?.id;\n  const projectName = state.currentProject?.name || 'Unknown';\n  \n  if (!projectId) {\n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Team Analysis Settings</h3>\n        <p>Configure access control for behavioral analysis features</p>\n      </div>\n      \n      <div class=\"admin-card\">\n        <div class=\"admin-empty-state\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"48\" height=\"48\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n          </svg>\n          <p>Please select a project to configure Team Analysis settings.</p>\n        </div>\n      </div>\n    </div>\n    `;\n  }\n  \n  if (teamAnalysisLoading || !teamAnalysisLoaded) {\n    // Trigger load and show loading state\n    if (!teamAnalysisLoading && !teamAnalysisLoaded) {\n      loadTeamAnalysisSettings();\n    }\n    \n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Team Analysis Settings</h3>\n        <p>Configure access control for behavioral analysis features</p>\n      </div>\n      \n      <div class=\"admin-card\">\n        <div class=\"admin-empty-state\">\n          <div class=\"loading-spinner\"></div>\n          <p>Loading settings...</p>\n        </div>\n      </div>\n    </div>\n    `;\n  }\n  \n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Team Analysis Settings</h3>\n        <p>Configure access control for behavioral analysis features</p>\n      </div>\n\n      <!-- Current Project Info -->\n      <div class=\"admin-card\">\n        <h4>Current Project</h4>\n        <div class=\"admin-project-preview\">\n          <div class=\"admin-project-preview-icon\">${projectName.charAt(0).toUpperCase()}</div>\n          <div>\n            <div class=\"admin-project-name\">${projectName}</div>\n            <div class=\"admin-project-id\">ID: ${projectId}</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Feature Toggle -->\n      <div class=\"admin-card\">\n        <h4>Feature Status</h4>\n        <p class=\"text-muted admin-mb-4\">Enable or disable Team Analysis for this project</p>\n        \n        <div class=\"form-group\">\n          <label class=\"toggle-label admin-toggle-label\">\n            <input type=\"checkbox\" id=\"team-analysis-enabled\" ${teamAnalysisSettings.enabled ? 'checked' : ''} class=\"admin-checkbox\">\n            <div>\n              <span class=\"admin-toggle-title\">Enable Team Analysis</span>\n              <p class=\"admin-toggle-desc\">When enabled, users with access can analyze team member behavior from meeting transcripts</p>\n            </div>\n          </label>\n        </div>\n      </div>\n\n      <!-- Access Control -->\n      <div class=\"admin-card\">\n        <h4>Access Control</h4>\n        <p class=\"text-muted admin-mb-4\">Define who can access Team Analysis features</p>\n        \n        <div class=\"form-group\">\n          <label class=\"admin-field-label-block\">Access Level</label>\n          <select id=\"team-analysis-access\" class=\"form-input admin-select-max\">\n            <option value=\"admin_only\" ${teamAnalysisSettings.access === 'admin_only' ? 'selected' : ''}>Admins Only - Only project owner and admins can access</option>\n            <option value=\"all\" ${teamAnalysisSettings.access === 'all' ? 'selected' : ''}>All Members - All project members can access</option>\n          </select>\n          <p class=\"admin-field-hint\">\n            <strong>Admins Only:</strong> Restricts access to sensitive behavioral analysis to project owner and administrators.<br>\n            <strong>All Members:</strong> Allows all project collaborators to view and run team analysis.\n          </p>\n        </div>\n      </div>\n\n      <!-- Analysis Scope Info -->\n      <div class=\"admin-card\">\n        <h4>How It Works</h4>\n        <div class=\"admin-steps-grid\">\n          <div class=\"admin-step-row\">\n            <div class=\"admin-step-num\">1</div>\n            <div>\n              <div class=\"admin-step-title\">Contact-Based Analysis</div>\n              <div class=\"admin-step-desc\">Analysis is performed on contacts defined in the project. Contacts can have aliases to match different name variations in transcripts.</div>\n            </div>\n          </div>\n          <div class=\"admin-step-row\">\n            <div class=\"admin-step-num\">2</div>\n            <div>\n              <div class=\"admin-step-title\">Incremental Learning</div>\n              <div class=\"admin-step-desc\">Profiles are refined iteratively as more transcripts are processed, building evidence over time.</div>\n            </div>\n          </div>\n          <div class=\"admin-step-row\">\n            <div class=\"admin-step-num\">3</div>\n            <div>\n              <div class=\"admin-step-title\">Privacy Consideration</div>\n              <div class=\"admin-step-desc\">Behavioral analysis may contain sensitive insights. Configure access carefully.</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <button class=\"btn-primary admin-mt-2\" id=\"save-team-analysis\">Save Team Analysis Settings</button>\n    </div>\n  `;\n}\n\n/**\n * Render LLM Queue section\n */\nfunction renderQueueSection(): string {\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>LLM Processing Queue</h3>\n        <p>Monitor and control AI request processing - All requests are persisted in database</p>\n      </div>\n\n      <!-- Queue Status -->\n      <div class=\"admin-card\" id=\"queue-status-card\">\n        <div class=\"admin-card-header\">\n          <h4>Queue Status</h4>\n          <div class=\"admin-card-actions\">\n            <span id=\"db-status-badge\" class=\"badge admin-badge-sm\">DB: Checking...</span>\n            <button class=\"btn-sm\" id=\"refresh-queue-status\"> Refresh</button>\n          </div>\n        </div>\n        \n        <div id=\"queue-status-content\" class=\"admin-placeholder\">\n          Loading queue status...\n        </div>\n      </div>\n\n      <!-- Queue Controls -->\n      <div class=\"admin-card\">\n        <h4>Queue Controls</h4>\n        <p class=\"text-muted\">Control queue processing behavior</p>\n        \n        <div class=\"admin-actions-row\">\n          <button class=\"btn-primary\" id=\"queue-pause-btn\"> Pause Queue</button>\n          <button class=\"btn-primary\" id=\"queue-resume-btn\"> Resume Queue</button>\n          <button class=\"btn-secondary admin-btn-warning\" id=\"queue-clear-btn\"> Clear Queue</button>\n        </div>\n      </div>\n\n      <!-- Statistics -->\n      <div class=\"admin-card\">\n        <h4>Queue Statistics (Today)</h4>\n        <div id=\"queue-stats-content\" class=\"admin-stats-grid\">\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-primary\" id=\"stat-pending\">-</div>\n            <div class=\"admin-stat-label\">Pending</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-info\" id=\"stat-processing\">-</div>\n            <div class=\"admin-stat-label\">Processing</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-success\" id=\"stat-success\">-</div>\n            <div class=\"admin-stat-label\">Completed</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-error\" id=\"stat-failed\">-</div>\n            <div class=\"admin-stat-label\">Failed</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-warning\" id=\"stat-retry\">-</div>\n            <div class=\"admin-stat-label\">Retry Pending</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value\" id=\"stat-avg-time\">-</div>\n            <div class=\"admin-stat-label\">Avg Time (ms)</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-success\" id=\"stat-cost\">$-</div>\n            <div class=\"admin-stat-label\">Cost Today</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Queue Items -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Pending Items</h4>\n          <span id=\"pending-count\" class=\"text-muted\">0 items</span>\n        </div>\n        \n        <div id=\"queue-items-content\" class=\"admin-scroll-content admin-scroll-300\">\n          <div class=\"admin-placeholder\">\n            No items in queue\n          </div>\n        </div>\n      </div>\n\n      <!-- Failed Items (Retryable) -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Failed Items</h4>\n          <div class=\"admin-card-actions\">\n            <button class=\"btn-sm btn-primary\" id=\"retry-all-btn\"> Retry All</button>\n            <button class=\"btn-sm\" id=\"refresh-failed-btn\"> Refresh</button>\n          </div>\n        </div>\n        \n        <div id=\"failed-items-content\" class=\"admin-scroll-content admin-scroll-300\">\n          <div class=\"admin-placeholder\">\n            No failed items\n          </div>\n        </div>\n      </div>\n\n      <!-- Recent History -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Recent Processing History</h4>\n          <button class=\"btn-sm\" id=\"refresh-queue-history\"> Refresh</button>\n        </div>\n        \n        <div id=\"queue-history-content\" class=\"admin-scroll-content admin-scroll-400\">\n          <div class=\"admin-placeholder\">\n            Loading history...\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Load billing data\n */\nasync function loadBillingData(): Promise<void> {\n  // Guard is now in bindSectionEvents, so we just proceed with loading\n  // billingLoading is already set to true by caller\n  console.log('[AdminPanel] loadBillingData() starting...');\n  \n  try {\n    // Load all data in parallel\n    console.log('[AdminPanel] Calling billing API...');\n    const [projects, config, tiersData, exchangeRate] = await Promise.all([\n      billingService.getAllProjectsBilling(),\n      billingService.getGlobalPricingConfig(),\n      billingService.getGlobalPricingTiers(),\n      billingService.getExchangeRateConfig()\n    ]);\n    \n    console.log('[AdminPanel] API responses:', { projects, config, tiersData, exchangeRate });\n    \n    billingProjects = projects;\n    globalPricingConfig = config;\n    globalPricingTiers = tiersData.tiers;\n    exchangeRateConfig = exchangeRate;\n    billingLoaded = true;\n    \n    console.log('[AdminPanel] Loaded billing data:', { \n      projects: projects.length, \n      config: !!config,\n      tiers: tiersData.tiers.length,\n      exchangeRate: exchangeRate?.currentRate\n    });\n  } catch (error) {\n    console.error('[AdminPanel] Error loading billing data:', error);\n    toast.error('Failed to load billing data');\n  } finally {\n    billingLoading = false;\n  }\n}\n\n/**\n * Render Billing section\n */\nfunction renderBillingSection(): string {\n  // Show loading state\n  if (billingLoading && !billingLoaded) {\n    return `\n      <div class=\"admin-section\">\n        <div class=\"admin-section-header\">\n          <h3>Billing & Cost Control</h3>\n          <p>Manage project balances, pricing, and cost limits</p>\n        </div>\n        <div class=\"admin-card admin-loading-card\">\n          <div class=\"spinner\"></div>\n          <p class=\"admin-loading-p\">Loading billing data...</p>\n        </div>\n      </div>\n    `;\n  }\n  \n  // Format tier display\n  const tiersDisplay = globalPricingTiers.length > 0 \n    ? globalPricingTiers.map((tier, i) => {\n        const prevLimit = i > 0 ? globalPricingTiers[i - 1].token_limit : 0;\n        const fromStr = formatTokens(prevLimit || 0);\n        const toStr = tier.token_limit ? formatTokens(tier.token_limit) : '';\n        return `${tier.name || `Tier ${i + 1}`}: ${fromStr}-${toStr} tokens  +${tier.markup_percent}%`;\n      }).join('<br>')\n    : 'No tiers configured (using fixed markup)';\n  \n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Billing & Cost Control</h3>\n        <p>Manage project balances, pricing, and cost limits</p>\n      </div>\n\n      <!-- Exchange Rate Configuration -->\n      <div class=\"admin-card\">\n        <h4 class=\"admin-h4-mb\">Exchange Rate (USD to EUR)</h4>\n        \n        <div class=\"admin-exchange-grid\">\n          <div>\n            <div class=\"form-group\">\n              <label class=\"admin-checkbox-label\">\n                <input type=\"checkbox\" id=\"exchange-rate-auto\" ${exchangeRateConfig?.auto !== false ? 'checked' : ''}>\n                <span>Automatic rate from API</span>\n              </label>\n              <small class=\"text-muted\">Fetches live USD/EUR rate daily</small>\n            </div>\n            \n            <div class=\"form-group ${exchangeRateConfig?.auto !== false ? 'hidden' : ''}\" id=\"manual-rate-group\">\n              <label>Manual Rate</label>\n              <input type=\"number\" id=\"exchange-rate-manual\" class=\"form-input\" \n                     value=\"${exchangeRateConfig?.manualRate ?? 0.92}\" min=\"0.01\" max=\"2\" step=\"0.001\">\n            </div>\n          </div>\n          \n          <div class=\"admin-rate-block\">\n            <div class=\"admin-rate-label\">Current Rate</div>\n            <div class=\"admin-rate-value\" id=\"current-rate-display\">\n              ${exchangeRateConfig?.currentRate?.toFixed(4) ?? '0.9200'}\n            </div>\n            <div class=\"admin-rate-meta\">\n              Source: <span id=\"rate-source\">${exchangeRateConfig?.source ?? 'default'}</span>\n              ${exchangeRateConfig?.lastUpdated ? `<br>Updated: ${new Date(exchangeRateConfig.lastUpdated).toLocaleString()}` : ''}\n            </div>\n            <button class=\"btn-sm btn-secondary admin-rate-refresh\" id=\"refresh-rate-btn\" ${exchangeRateConfig?.auto === false ? 'disabled' : ''}>\n              Refresh Rate\n            </button>\n          </div>\n        </div>\n        \n        <div class=\"admin-actions-end\">\n          <button class=\"btn-primary\" id=\"save-exchange-rate-btn\">Save Exchange Rate Settings</button>\n        </div>\n      </div>\n\n      <!-- Global Pricing Configuration -->\n      <div class=\"admin-card\">\n        <h4 class=\"admin-h4-mb\">Global Pricing Configuration</h4>\n        \n        <div class=\"admin-form-grid admin-form-grid-2\">\n          <div class=\"form-group\">\n            <label>Fixed Markup (%)</label>\n            <input type=\"number\" id=\"global-markup-percent\" class=\"form-input\" \n                   value=\"${globalPricingConfig?.fixed_markup_percent ?? 0}\" min=\"0\" max=\"500\" step=\"0.1\">\n            <small class=\"text-muted\">Applied when no tier matches</small>\n          </div>\n          \n          <div class=\"form-group\">\n            <label>Period Type</label>\n            <select id=\"global-period-type\" class=\"form-input\">\n              <option value=\"monthly\" ${globalPricingConfig?.period_type === 'monthly' ? 'selected' : ''}>Monthly</option>\n              <option value=\"weekly\" ${globalPricingConfig?.period_type === 'weekly' ? 'selected' : ''}>Weekly</option>\n            </select>\n            <small class=\"text-muted\">Tier reset period</small>\n          </div>\n        </div>\n        \n        <div class=\"admin-actions-end\">\n          <button class=\"btn-primary\" id=\"save-global-pricing-btn\">Save Global Pricing</button>\n        </div>\n      </div>\n      \n      <!-- Pricing Tiers -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <div>\n            <h4>Pricing Tiers (Volume Discount)</h4>\n            <p class=\"text-muted admin-subtitle\">\n              Lower markup as projects consume more tokens per period\n            </p>\n          </div>\n          <button class=\"btn-sm btn-primary\" id=\"add-tier-btn\">+ Add Tier</button>\n        </div>\n        \n        <div id=\"pricing-tiers-list\">\n          ${globalPricingTiers.length > 0 ? globalPricingTiers.map((tier, i) => `\n            <div class=\"tier-row admin-tier-row\" data-tier-index=\"${i}\">\n              <input type=\"text\" class=\"form-input tier-name\" placeholder=\"Tier Name\" value=\"${tier.name || `Tier ${i + 1}`}\">\n              <input type=\"number\" class=\"form-input tier-limit\" placeholder=\"Token Limit\" value=\"${tier.token_limit || ''}\" min=\"0\" ${tier.token_limit === null ? 'disabled' : ''}>\n              <div class=\"admin-tier-markup-wrap\">\n                <input type=\"number\" class=\"form-input tier-markup\" placeholder=\"Markup %\" value=\"${tier.markup_percent}\" min=\"0\" step=\"0.1\">\n                <span>%</span>\n              </div>\n              <div class=\"admin-tier-actions\">\n                <label class=\"admin-tier-unlimited-label\">\n                  <input type=\"checkbox\" class=\"tier-unlimited\" ${tier.token_limit === null ? 'checked' : ''}>\n                  Unlimited\n                </label>\n                <button class=\"btn-sm btn-danger remove-tier-btn\" data-index=\"${i}\"></button>\n              </div>\n            </div>\n          `).join('') : `\n            <div class=\"admin-placeholder\">\n              No tiers configured. Using fixed markup of ${globalPricingConfig?.fixed_markup_percent ?? 0}% for all usage.\n            </div>\n          `}\n        </div>\n        \n        ${globalPricingTiers.length > 0 ? `\n          <div class=\"admin-actions-end admin-mt-4\">\n            <button class=\"btn-primary\" id=\"save-tiers-btn\">Save Tiers</button>\n          </div>\n        ` : ''}\n      </div>\n\n      <!-- Projects Billing Overview -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <div>\n            <h4>Projects Billing</h4>\n            <p class=\"text-muted admin-subtitle\">\n              ${billingProjects.length} projects | \n              ${billingProjects.filter(p => p.is_blocked).length} blocked | \n              ${billingProjects.filter(p => p.unlimited_balance).length} unlimited\n            </p>\n          </div>\n          <button class=\"btn-sm\" id=\"refresh-billing-btn\"> Refresh</button>\n        </div>\n        \n        <div class=\"admin-table-wrap\">\n          <table class=\"data-table admin-data-table\">\n            <thead>\n              <tr>\n                <th class=\"admin-th-left\">Project</th>\n                <th class=\"admin-th-right\">Balance</th>\n                <th class=\"admin-th-center\">Status</th>\n                <th class=\"admin-th-right\">Tokens (Period)</th>\n                <th class=\"admin-th-right\">Cost (Period)</th>\n                <th class=\"admin-th-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${billingProjects.length > 0 ? billingProjects.map(p => `\n                <tr class=\"admin-tr\">\n                  <td class=\"admin-td admin-td-project\">\n                    <div class=\"admin-td-project-name\">${escapeHtml(p.project_name)}</div>\n                    ${p.current_tier_name ? `<small class=\"text-muted\">Tier: ${p.current_tier_name}</small>` : ''}\n                  </td>\n                  <td class=\"admin-td admin-td-right\">\n                    ${p.unlimited_balance \n                      ? '<span class=\"admin-unlimited\"> Unlimited</span>' \n                      : formatEur(p.balance_eur)}\n                  </td>\n                  <td class=\"admin-td admin-td-center\">\n                    ${p.is_blocked \n                      ? '<span class=\"badge badge-danger\">Blocked</span>' \n                      : p.unlimited_balance\n                        ? '<span class=\"badge badge-success\">Unlimited</span>'\n                        : '<span class=\"badge badge-primary\">Active</span>'}\n                  </td>\n                  <td class=\"admin-td admin-td-right\">${formatTokens(p.tokens_this_period)}</td>\n                  <td class=\"admin-td admin-td-right\">${formatEur(p.billable_cost_this_period)}</td>\n                  <td class=\"admin-td admin-td-center\">\n                    <div class=\"admin-td-actions\">\n                      <button class=\"btn-sm add-balance-btn\" data-project-id=\"${p.project_id}\" data-project-name=\"${escapeHtml(p.project_name)}\" title=\"Add Balance\"></button>\n                      <button class=\"btn-sm toggle-unlimited-btn\" data-project-id=\"${p.project_id}\" data-unlimited=\"${p.unlimited_balance}\" title=\"${p.unlimited_balance ? 'Disable Unlimited' : 'Enable Unlimited'}\">\n                        ${p.unlimited_balance ? '' : ''}\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              `).join('') : `\n                <tr>\n                  <td colspan=\"6\" class=\"admin-placeholder\">\n                    No projects found\n                  </td>\n                </tr>\n              `}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Escape HTML for safe rendering\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Render Audit Log section\n */\nfunction renderAuditSection(): string {\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Configuration Audit Log</h3>\n        <p>Track all configuration changes</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <div class=\"audit-filters\">\n          <select id=\"audit-filter-table\" class=\"form-select\">\n            <option value=\"\">All Tables</option>\n            <option value=\"system_config\">System Config</option>\n            <option value=\"project_config\">Project Config</option>\n            <option value=\"secrets\">Secrets</option>\n          </select>\n          <button class=\"btn-secondary\" id=\"refresh-audit\">Refresh</button>\n        </div>\n\n        <div class=\"audit-log-list\">\n          ${auditLogs.length === 0 ? `\n            <div class=\"empty-state\">\n              <p>No audit logs found</p>\n            </div>\n          ` : auditLogs.map(log => `\n            <div class=\"audit-log-item\">\n              <div class=\"audit-log-header\">\n                <span class=\"audit-operation ${log.operation.toLowerCase()}\">${log.operation}</span>\n                <span class=\"audit-table\">${log.table_name}</span>\n                <span class=\"audit-time\">${new Date(log.changed_at).toLocaleString()}</span>\n              </div>\n              <div class=\"audit-log-details\">\n                <span class=\"audit-user\">${log.changed_by_email || 'System'}</span>\n                ${log.new_values ? `<pre class=\"audit-values\">${JSON.stringify(log.new_values, null, 2)}</pre>` : ''}\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Model Metadata section\n */\nfunction renderModelsSection(): string {\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>LLM Model Metadata</h3>\n        <p>Manage model information, pricing, and capabilities from database</p>\n      </div>\n      \n      <!-- Sync Controls -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Sync Model Metadata</h4>\n          <button class=\"btn btn-primary\" id=\"sync-all-metadata-btn\">\n             Sync All Providers\n          </button>\n        </div>\n        <p class=\"admin-desc admin-mb-4\">\n          Fetch the latest model list from each configured provider API and update the database with current models and capabilities.\n          Pricing information is updated from known sources.\n        </p>\n        \n        <div id=\"metadata-sync-status\" class=\"admin-mb-4\">\n          <div class=\"admin-placeholder\">\n            Loading sync status...\n          </div>\n        </div>\n        \n        <div id=\"metadata-sync-result\" class=\"hidden\"></div>\n      </div>\n      \n      <!-- Provider Status -->\n      <div class=\"admin-card\">\n        <h4 class=\"admin-h4-mb\">Provider Model Count</h4>\n        <div id=\"provider-model-counts\">\n          <div class=\"admin-placeholder\">\n            Loading...\n          </div>\n        </div>\n      </div>\n      \n      <!-- Model Browser -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Browse Models</h4>\n          <div class=\"admin-card-actions\">\n            <select id=\"browse-provider-select\" class=\"form-select admin-select-min\">\n              <option value=\"\">Select Provider</option>\n              <option value=\"openai\">OpenAI</option>\n              <option value=\"anthropic\">Anthropic</option>\n              <option value=\"google\">Google</option>\n              <option value=\"grok\">Grok (xAI)</option>\n              <option value=\"deepseek\">DeepSeek</option>\n            </select>\n            <button class=\"btn btn-secondary\" id=\"browse-models-btn\">Load Models</button>\n          </div>\n        </div>\n        \n        <div id=\"models-browser-content\">\n          <div class=\"admin-empty-state\">\n            Select a provider to browse available models\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render current section content\n */\nfunction renderSectionContent(): string {\n  switch (currentSection) {\n    case 'llm':\n      return renderLLMSection();\n    case 'models':\n      return renderModelsSection();\n    case 'graph':\n      return renderGraphSection();\n    case 'ontology':\n      return renderOntologySection();\n    case 'queue':\n      return renderQueueSection();\n    case 'prompts':\n      return renderPromptsSection();\n    case 'processing':\n      return renderProcessingSection();\n    case 'team-analysis':\n      return renderTeamAnalysisSection();\n    case 'google-drive':\n      return renderGoogleDriveSection();\n    case 'billing':\n      return renderBillingSection();\n    case 'audit':\n      return renderAuditSection();\n    default:\n      return renderLLMSection();\n  }\n}\n\n/**\n * Bind section-specific events\n */\nfunction bindSectionEvents(container: HTMLElement): void {\n  // Nav buttons\n  container.querySelectorAll('.admin-nav-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const newSection = btn.getAttribute('data-section') || 'llm';\n      currentSection = newSection;\n      \n      // Load Team Analysis settings when switching to that section\n      if (newSection === 'team-analysis') {\n        teamAnalysisLoaded = false;\n        teamAnalysisLoading = false;\n        renderAdminPanel(container);\n        await loadTeamAnalysisSettings();\n        renderAdminPanel(container);\n      } else if (newSection === 'google-drive') {\n        googleDriveLoaded = false;\n        renderAdminPanel(container);\n        await loadGoogleDriveState();\n        renderAdminPanel(container);\n      } else if (newSection === 'billing') {\n        // Load billing data\n        if (!billingLoaded && !billingLoading) {\n          billingLoading = true;        // Set loading flag BEFORE rendering\n          renderAdminPanel(container);  // Show loading state\n          await loadBillingData();      // Load data (guard removed, just loads)\n          renderAdminPanel(container);  // Re-render with data\n        } else {\n          renderAdminPanel(container);\n        }\n      } else {\n        renderAdminPanel(container);\n      }\n    });\n  });\n\n  // Toggle visibility buttons\n  container.querySelectorAll('[data-toggle-visibility]').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const inputId = btn.getAttribute('data-toggle-visibility');\n      if (inputId) {\n        const input = container.querySelector(`#${inputId}`) as HTMLInputElement;\n        if (input) {\n          input.type = input.type === 'password' ? 'text' : 'password';\n          (btn as HTMLElement).textContent = input.type === 'password' ? 'Show' : 'Hide';\n        }\n      }\n    });\n  });\n\n  // Test provider buttons\n  container.querySelectorAll('[data-test-provider]').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const providerId = btn.getAttribute('data-test-provider');\n      if (providerId) {\n        (btn as HTMLElement).textContent = 'Testing...';\n        await testProvider(providerId);\n        (btn as HTMLElement).textContent = 'Test';\n      }\n    });\n  });\n\n  // Cache for loaded models by provider\n  const modelsCache: Record<string, { textModels: string[]; visionModels: string[]; embeddingModels: string[] }> = {};\n  \n  // Load models for a provider\n  async function loadModelsForProvider(providerId: string, taskType: string): Promise<void> {\n    const modelSelect = container.querySelector(`select.model-select[data-task=\"${taskType}\"]`) as HTMLSelectElement;\n    const loadingSpan = container.querySelector(`.model-loading[data-task=\"${taskType}\"]`) as HTMLElement;\n    const statusDiv = container.querySelector(`.model-status[data-task=\"${taskType}\"]`) as HTMLElement;\n    \n    if (!modelSelect || !providerId) {\n      if (modelSelect) {\n        modelSelect.innerHTML = '<option value=\"\">-- Select Provider First --</option>';\n      }\n      return;\n    }\n    \n    // Show loading state\n    if (loadingSpan) loadingSpan.classList.remove('hidden');\n    modelSelect.disabled = true;\n    \n    try {\n      // Check cache first\n      if (!modelsCache[providerId]) {\n        const response = await http.get<{ textModels: Array<{id: string; name?: string}>; visionModels: Array<{id: string; name?: string}>; embeddingModels: Array<{id: string; name?: string}> }>(`/api/llm/models?provider=${providerId}`);\n        modelsCache[providerId] = {\n          textModels: (response.data.textModels || []).map(m => m.id || m.name || '').filter(Boolean),\n          visionModels: (response.data.visionModels || []).map(m => m.id || m.name || '').filter(Boolean),\n          embeddingModels: (response.data.embeddingModels || []).map(m => m.id || m.name || '').filter(Boolean)\n        };\n      }\n      \n      // Determine which models to show based on task type\n      let models: string[] = [];\n      if (taskType === 'text') models = modelsCache[providerId].textModels;\n      else if (taskType === 'vision') models = modelsCache[providerId].visionModels;\n      else if (taskType === 'embeddings') models = modelsCache[providerId].embeddingModels;\n      \n      // Get current selected value\n      const currentValue = modelSelect.value;\n      \n      // Populate dropdown\n      modelSelect.innerHTML = '<option value=\"\">-- Select Model --</option>' +\n        models.map(m => `<option value=\"${m}\"${m === currentValue ? ' selected' : ''}>${m}</option>`).join('');\n      \n      // Update status\n      if (statusDiv) {\n        statusDiv.textContent = models.length > 0 \n          ? `${models.length} model(s) available` \n          : 'No models found for this task type. Check provider configuration.';\n        statusDiv.classList.remove('admin-status-success', 'admin-status-warning', 'admin-status-error');\n        statusDiv.classList.add(models.length > 0 ? 'admin-status-success' : 'admin-status-warning');\n      }\n      \n    } catch (error) {\n      console.error(`Failed to load models for ${providerId}:`, error);\n      modelSelect.innerHTML = '<option value=\"\">Error loading models</option>';\n      if (statusDiv) {\n        statusDiv.textContent = 'Failed to load models. Check API key configuration.';\n        statusDiv.classList.remove('admin-status-success', 'admin-status-warning');\n        statusDiv.classList.add('admin-status-error');\n      }\n    } finally {\n      if (loadingSpan) loadingSpan.classList.add('hidden');\n      modelSelect.disabled = false;\n    }\n  }\n  \n  // Provider change handler - load models dynamically\n  container.querySelectorAll('select.provider-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const task = select.getAttribute('data-task');\n      const provider = (select as HTMLSelectElement).value;\n      if (task) {\n        await loadModelsForProvider(provider, task);\n      }\n    });\n    \n    // Initial load if provider is already selected\n    const task = select.getAttribute('data-task');\n    const provider = (select as HTMLSelectElement).value;\n    if (task && provider) {\n      loadModelsForProvider(provider, task);\n    }\n  });\n\n  // Save LLM config\n  const saveLLMBtn = container.querySelector('#save-llm-config');\n  if (saveLLMBtn) {\n    on(saveLLMBtn as HTMLElement, 'click', async () => {\n      const taskConfigs: Record<string, { provider: string; model: string }> = {};\n      \n      container.querySelectorAll('select[data-task]').forEach(el => {\n        const task = el.getAttribute('data-task')!;\n        const field = el.getAttribute('data-field')!;\n        \n        if (!taskConfigs[task]) {\n          taskConfigs[task] = { provider: '', model: '' };\n        }\n        \n        taskConfigs[task][field as 'provider' | 'model'] = (el as HTMLSelectElement).value;\n      });\n\n      try {\n        for (const [task, config] of Object.entries(taskConfigs)) {\n          if (config.provider) {\n            await saveConfig(`${task}_provider`, config, 'llm');\n          }\n        }\n        toast.success('LLM configuration saved to Supabase');\n      } catch (error) {\n        toast.error('Failed to save LLM configuration');\n      }\n    });\n  }\n\n  // Load existing API keys status\n  async function loadApiKeysStatus(): Promise<void> {\n    const loadingEl = container.querySelector('#api-keys-loading') as HTMLElement;\n    try {\n      const response = await http.get<{ success: boolean; secrets: Array<{ name: string; masked_value: string; is_valid: boolean }> }>('/api/secrets');\n      if (response.data?.success && response.data.secrets) {\n        for (const secret of response.data.secrets) {\n          const formGroup = container.querySelector(`[data-secret-name=\"${secret.name}\"]`);\n          if (formGroup) {\n            const statusSpan = formGroup.querySelector('.key-status') as HTMLElement;\n            const input = formGroup.querySelector('input') as HTMLInputElement;\n            if (statusSpan) {\n              if (secret.masked_value) {\n                statusSpan.textContent = ' Configured';\n                statusSpan.classList.add('admin-status-success');\n                if (input) {\n                  input.placeholder = secret.masked_value;\n                }\n              }\n            }\n          }\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to load API keys status:', error);\n    } finally {\n      if (loadingEl) loadingEl.classList.add('hidden');\n    }\n  }\n  \n  // Load API keys status on render\n  loadApiKeysStatus();\n\n  // Save LLM API keys\n  const saveKeysBtn = container.querySelector('#save-api-keys');\n  if (saveKeysBtn) {\n    on(saveKeysBtn as HTMLElement, 'click', async () => {\n      const keys = [\n        { id: 'openai-key', name: 'OPENAI_API_KEY' },\n        { id: 'anthropic-key', name: 'CLAUDE_API_KEY' },\n        { id: 'google-key', name: 'GOOGLE_API_KEY' },\n        { id: 'xai-key', name: 'XAI_API_KEY' },\n        { id: 'deepseek-key', name: 'DEEPSEEK_API_KEY' },\n        { id: 'kimi-key', name: 'KIMI_API_KEY' },\n        { id: 'minimax-key', name: 'MINIMAX_API_KEY' },\n      ];\n\n      try {\n        let savedCount = 0;\n        for (const key of keys) {\n          const value = (container.querySelector(`#${key.id}`) as HTMLInputElement)?.value;\n          if (value && value.trim()) {\n            await http.post('/api/secrets', { name: key.name, value: value.trim(), scope: 'system' });\n            savedCount++;\n          }\n        }\n        if (savedCount > 0) {\n          toast.success(`${savedCount} API key(s) saved securely`);\n        } else {\n          toast.info('No API keys to save');\n        }\n      } catch (error) {\n        toast.error('Failed to save API keys');\n      }\n    });\n  }\n\n  // Save service API keys\n  const saveServiceKeysBtn = container.querySelector('#save-service-keys');\n  if (saveServiceKeysBtn) {\n    on(saveServiceKeysBtn as HTMLElement, 'click', async () => {\n      const resendKey = (container.querySelector('#resend-key') as HTMLInputElement)?.value;\n      const braveKey = (container.querySelector('#brave-key') as HTMLInputElement)?.value;\n\n      try {\n        let saved = 0;\n        if (resendKey && resendKey.trim()) {\n          await http.post('/api/secrets', { name: 'RESEND_API_KEY', value: resendKey.trim(), scope: 'system' });\n          saved++;\n        }\n        if (braveKey && braveKey.trim()) {\n          await http.post('/api/secrets', { name: 'BRAVE_API_KEY', value: braveKey.trim(), scope: 'system' });\n          saved++;\n        }\n        if (saved > 0) {\n          toast.success('Service API key(s) saved securely');\n        } else {\n          toast.info('No service keys to save');\n        }\n      } catch (error: unknown) {\n        const msg = (error as { message?: string })?.message;\n        toast.error(msg && typeof msg === 'string' ? msg : 'Failed to save service keys');\n      }\n    });\n  }\n\n  // ============ Queue Section Handlers ============\n  \n  // Load queue status\n  // Interface for queue data\n  interface QueueStatusData {\n    isProcessing: boolean;\n    isPaused: boolean;\n    queueLength: number;\n    currentRequest: { id: string; context: string; priority: string; startedAt: string } | null;\n    stats: { total: number; successful: number; failed: number; avgProcessingTime: number };\n    pendingItems: Array<{ id: string; context: string; priority: string; queuedAt: string }>;\n    database?: {\n      pendingCount: number;\n      processingCount: number;\n      retryPendingCount: number;\n      completedToday: number;\n      failedToday: number;\n      avgProcessingTimeMs: number;\n      totalCostTodayUsd: number;\n    };\n  }\n\n  async function loadQueueStatus(): Promise<void> {\n    const statusContent = container.querySelector('#queue-status-content');\n    const itemsContent = container.querySelector('#queue-items-content');\n    const pendingCount = container.querySelector('#pending-count');\n    const dbStatusBadge = container.querySelector('#db-status-badge');\n    \n    try {\n      const response = await http.get<QueueStatusData>('/api/llm/queue/status');\n      const data = response.data;\n      \n      // Update DB status badge\n      if (dbStatusBadge) {\n        if (data.database) {\n          dbStatusBadge.className = 'badge badge-success';\n          dbStatusBadge.textContent = 'DB: Connected';\n        } else {\n          dbStatusBadge.className = 'badge badge-warning';\n          dbStatusBadge.textContent = 'DB: Memory Only';\n        }\n      }\n      \n      // Update status\n      if (statusContent) {\n        const statusColor = data.isPaused ? 'var(--warning)' : (data.isProcessing ? 'var(--success)' : 'var(--text-tertiary)');\n        const statusText = data.isPaused ? ' PAUSED' : (data.isProcessing ? ' PROCESSING' : ' IDLE');\n        \n        statusContent.innerHTML = `\n          <div class=\"admin-queue-status-grid\">\n            <div class=\"admin-queue-stat\">\n              <div class=\"admin-queue-stat-value\" style=\"--queue-stat-color: ${statusColor}\">${statusText}</div>\n              <div class=\"admin-queue-stat-label\">Queue Status</div>\n            </div>\n            <div class=\"admin-queue-stat\">\n              <div class=\"admin-queue-stat-value\">${data.queueLength}</div>\n              <div class=\"admin-queue-stat-label\">Items in Queue</div>\n            </div>\n            <div class=\"admin-queue-stat\">\n              <div class=\"admin-queue-stat-value admin-queue-stat-primary\">${data.isProcessing ? '1' : '0'}</div>\n              <div class=\"admin-queue-stat-label\">Processing Now</div>\n            </div>\n          </div>\n          ${data.currentRequest ? `\n            <div class=\"admin-queue-current-box\">\n              <strong>Currently Processing:</strong> ${data.currentRequest.context || 'Unknown'} \n              <span class=\"admin-queue-current-meta\">(Priority: ${data.currentRequest.priority})</span>\n              <span class=\"admin-queue-current-meta admin-queue-current-time\">Started: ${new Date(data.currentRequest.startedAt).toLocaleTimeString()}</span>\n            </div>\n          ` : ''}\n        `;\n      }\n      \n      // Update pending items\n      if (itemsContent && pendingCount) {\n        const pendingLen = data.pendingItems?.length || 0;\n        pendingCount.textContent = `${pendingLen} items`;\n        \n        if (pendingLen > 0) {\n          itemsContent.innerHTML = `\n            <table class=\"admin-queue-table admin-queue-table-sm\">\n              <thead>\n                <tr>\n                  <th class=\"admin-queue-th\">Context</th>\n                  <th class=\"admin-queue-th\">Priority</th>\n                  <th class=\"admin-queue-th\">Queued</th>\n                  <th class=\"admin-queue-th\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${data.pendingItems.map(item => `\n                  <tr>\n                    <td class=\"admin-queue-td\">${item.context || 'Unknown'}</td>\n                    <td class=\"admin-queue-td\"><span class=\"badge badge-${item.priority}\">${item.priority}</span></td>\n                    <td class=\"admin-queue-td\">${new Date(item.queuedAt).toLocaleTimeString()}</td>\n                    <td class=\"admin-queue-td\"><button class=\"btn-sm btn-danger\" data-cancel-item=\"${item.id}\">Cancel</button></td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          itemsContent.innerHTML = '<div class=\"admin-placeholder\">No items in queue</div>';\n        }\n      }\n      \n      // Update stats\n      const db = data.database;\n      const statPending = container.querySelector('#stat-pending');\n      const statProcessing = container.querySelector('#stat-processing');\n      const statSuccess = container.querySelector('#stat-success');\n      const statFailed = container.querySelector('#stat-failed');\n      const statRetry = container.querySelector('#stat-retry');\n      const statAvgTime = container.querySelector('#stat-avg-time');\n      const statCost = container.querySelector('#stat-cost');\n      \n      if (statPending) statPending.textContent = String(db?.pendingCount || data.queueLength || 0);\n      if (statProcessing) statProcessing.textContent = String(db?.processingCount || (data.isProcessing ? 1 : 0));\n      if (statSuccess) statSuccess.textContent = String(db?.completedToday || data.stats?.successful || 0);\n      if (statFailed) statFailed.textContent = String(db?.failedToday || data.stats?.failed || 0);\n      if (statRetry) statRetry.textContent = String(db?.retryPendingCount || 0);\n      if (statAvgTime) statAvgTime.textContent = String(Math.round(db?.avgProcessingTimeMs || data.stats?.avgProcessingTime || 0));\n      if (statCost) statCost.textContent = `$${(db?.totalCostTodayUsd || 0).toFixed(4)}`;\n      \n    } catch (error) {\n      console.error('Failed to load queue status:', error);\n      if (statusContent) {\n        statusContent.innerHTML = '<div class=\"admin-error-msg\">Failed to load queue status</div>';\n      }\n    }\n  }\n  \n  // Load queue history\n  async function loadQueueHistory(): Promise<void> {\n    const historyContent = container.querySelector('#queue-history-content');\n    \n    try {\n      const response = await http.get<{\n        history: Array<{\n          id: string;\n          context: string;\n          priority: string;\n          status: string;\n          processingTime: number;\n          completedAt: string;\n          provider?: string;\n          model?: string;\n          inputTokens?: number;\n          outputTokens?: number;\n          estimatedCost?: number;\n          error?: string;\n        }>;\n      }>('/api/llm/queue/history?limit=50');\n      \n      const history = response.data?.history || [];\n      \n      if (historyContent) {\n        if (history.length > 0) {\n          historyContent.innerHTML = `\n            <table class=\"admin-queue-table\">\n              <thead>\n                <tr>\n                  <th class=\"admin-queue-th\">Context</th>\n                  <th class=\"admin-queue-th\">Provider/Model</th>\n                  <th class=\"admin-queue-th\">Status</th>\n                  <th class=\"admin-queue-th\">Tokens</th>\n                  <th class=\"admin-queue-th\">Time</th>\n                  <th class=\"admin-queue-th\">Completed</th>\n                  <th class=\"admin-queue-th\">Details</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${history.map(item => `\n                  <tr>\n                    <td class=\"admin-queue-td admin-queue-td-ellipsis\" title=\"${item.context || ''}\">${item.context || 'Unknown'}</td>\n                    <td class=\"admin-queue-td admin-queue-td-sm\">${item.provider || '-'}/${item.model || '-'}</td>\n                    <td class=\"admin-queue-td\">\n                      <span class=\"admin-queue-status-dot admin-queue-status-${item.status === 'completed' ? 'ok' : 'err'}\">${item.status === 'completed' ? '' : ''}</span>\n                      ${item.error ? `<span class=\"admin-queue-error-hint\" title=\"${item.error}\">Error</span>` : ''}\n                    </td>\n                    <td class=\"admin-queue-td admin-queue-td-sm\">${item.inputTokens || '-'}/${item.outputTokens || '-'}</td>\n                    <td class=\"admin-queue-td\">${item.processingTime || '-'}ms</td>\n                    <td class=\"admin-queue-td admin-queue-td-sm\">${item.completedAt ? new Date(item.completedAt).toLocaleString() : '-'}</td>\n                    <td class=\"admin-queue-td\"><button class=\"btn-sm\" data-view-request=\"${item.id}\">View</button></td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          historyContent.innerHTML = '<div class=\"admin-placeholder\">No processing history yet</div>';\n        }\n      }\n    } catch (error) {\n      console.error('Failed to load queue history:', error);\n      if (historyContent) {\n        historyContent.innerHTML = '<div class=\"admin-error-msg\">Failed to load history</div>';\n      }\n    }\n  }\n  \n  // Show request details modal\n  async function showRequestDetails(requestId: string): Promise<void> {\n    try {\n      const response = await http.get<{\n        success: boolean;\n        request: {\n          id: string;\n          context: string;\n          request_type: string;\n          provider: string;\n          model: string;\n          status: string;\n          priority: string;\n          input_data: Record<string, unknown>;\n          output_data: Record<string, unknown> | null;\n          output_text: string | null;\n          input_tokens: number | null;\n          output_tokens: number | null;\n          total_tokens: number | null;\n          estimated_cost_usd: number | null;\n          processing_time_ms: number | null;\n          attempt_count: number;\n          max_attempts: number;\n          last_error: string | null;\n          error_details: Record<string, unknown> | null;\n          queued_at: string;\n          started_at: string | null;\n          completed_at: string | null;\n        };\n      }>(`/api/llm/queue/${requestId}`);\n      \n      if (!response.data.success || !response.data.request) {\n        toast.error('Request not found');\n        return;\n      }\n      \n      const req = response.data.request;\n      \n      // Escape HTML in strings to prevent XSS and template breaking\n      const escapeHtml = (str: string | null | undefined): string => {\n        if (!str) return '';\n        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n      };\n      \n      // Format JSON with syntax highlighting\n      const formatJsonHtml = (obj: unknown): string => {\n        const json = JSON.stringify(obj, null, 2);\n        return escapeHtml(json)\n          .replace(/\"([^\"]+)\":/g, '<span class=\"hl-json-key\">\"$1\"</span>:')\n          .replace(/: \"([^\"]*)\"/g, ': <span class=\"hl-json-string\">\"$1\"</span>')\n          .replace(/: (\\d+)/g, ': <span class=\"hl-json-num\">$1</span>')\n          .replace(/: (true|false|null)/g, ': <span class=\"hl-json-bool\">$1</span>');\n      };\n      \n      // Format prompt text for readability\n      const formatPromptText = (text: string | null | undefined): string => {\n        if (!text) return '<span class=\"hl-prompt-empty\">(No content)</span>';\n        return escapeHtml(text)\n          .replace(/\\\\n/g, '\\n')\n          .replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>')\n          .replace(/^(#{1,3})\\s*(.+)$/gm, '<span class=\"hl-prompt-heading\">$2</span>')\n          .replace(/^[-]\\s*(.+)$/gm, '   $1')\n          .replace(/---+/g, '<hr class=\"hl-prompt-hr\">');\n      };\n      \n      // Get status color and icon\n      const getStatusInfo = (status: string) => {\n        const statusMap: Record<string, { color: string; icon: string; bg: string }> = {\n          completed: { color: 'var(--success)', icon: '', bg: 'rgba(34, 197, 94, 0.1)' },\n          failed: { color: 'var(--error)', icon: '', bg: 'rgba(239, 68, 68, 0.1)' },\n          processing: { color: 'var(--warning)', icon: '', bg: 'rgba(234, 179, 8, 0.1)' },\n          pending: { color: 'var(--text-secondary)', icon: '', bg: 'var(--bg-tertiary)' },\n          retry_pending: { color: 'var(--warning)', icon: '', bg: 'rgba(234, 179, 8, 0.1)' },\n          cancelled: { color: 'var(--text-tertiary)', icon: '', bg: 'var(--bg-tertiary)' }\n        };\n        return statusMap[status] || { color: 'var(--text-primary)', icon: '?', bg: 'var(--bg-secondary)' };\n      };\n      \n      const statusInfo = getStatusInfo(req.status);\n      const inputData = (req.input_data || {}) as Record<string, unknown>;\n      const messages = inputData.messages as Array<{ content?: string }> | undefined;\n      const promptText = (inputData.prompt as string) || messages?.[0]?.content || '';\n      \n      // Create modal - using unique ID to avoid duplicates\n      const existingModal = document.getElementById('llm-request-details-modal');\n      if (existingModal) {\n        existingModal.remove();\n      }\n      \n      const modal = document.createElement('div');\n      modal.id = 'llm-request-details-modal';\n      modal.className = 'modal open';\n      modal.className = 'modal open admin-llm-modal-overlay';\n      modal.innerHTML = `\n        <div class=\"modal-content admin-llm-modal-content\">\n          <div class=\"modal-header\">\n            <div class=\"admin-llm-modal-header-inner\">\n              <span class=\"admin-llm-modal-icon\" style=\"--status-bg: ${statusInfo.bg}; --status-color: ${statusInfo.color}\">${statusInfo.icon}</span>\n              <div>\n                <h3 class=\"admin-llm-modal-title\">LLM Request Details</h3>\n                <span class=\"admin-llm-modal-id\">ID: ${req.id}</span>\n              </div>\n            </div>\n            <button class=\"modal-close\">&times;</button>\n          </div>\n          \n          <div class=\"modal-body admin-llm-modal-body\">\n            <div class=\"admin-llm-status-bar\">\n              <div class=\"admin-llm-status-item\">\n                <div class=\"admin-llm-status-label\">Context</div>\n                <div class=\"admin-llm-status-value admin-llm-status-accent\">${req.context || 'Unknown'}</div>\n              </div>\n              <div class=\"admin-llm-status-item\">\n                <div class=\"admin-llm-status-label\">Provider</div>\n                <div class=\"admin-llm-status-value\">${req.provider || '-'}</div>\n              </div>\n              <div class=\"admin-llm-status-item\">\n                <div class=\"admin-llm-status-label\">Model</div>\n                <div class=\"admin-llm-status-value admin-llm-status-mono\">${req.model || '-'}</div>\n              </div>\n              <div class=\"admin-llm-status-item\">\n                <div class=\"admin-llm-status-label\">Status</div>\n                <div class=\"admin-llm-status-badge\" style=\"--status-bg: ${statusInfo.bg}; --status-color: ${statusInfo.color}\">${statusInfo.icon} ${req.status}</div>\n              </div>\n            </div>\n            \n            <div class=\"admin-llm-metrics-grid\">\n              <div class=\"admin-llm-metric-box\">\n                <div class=\"admin-llm-metric-value\">${req.input_tokens?.toLocaleString() || '-'}</div>\n                <div class=\"admin-llm-metric-label\">Input Tokens</div>\n              </div>\n              <div class=\"admin-llm-metric-box\">\n                <div class=\"admin-llm-metric-value\">${req.output_tokens?.toLocaleString() || '-'}</div>\n                <div class=\"admin-llm-metric-label\">Output Tokens</div>\n              </div>\n              <div class=\"admin-llm-metric-box\">\n                <div class=\"admin-llm-metric-value\">${req.processing_time_ms ? `${(req.processing_time_ms / 1000).toFixed(1)}s` : '-'}</div>\n                <div class=\"admin-llm-metric-label\">Duration</div>\n              </div>\n              <div class=\"admin-llm-metric-box\">\n                <div class=\"admin-llm-metric-value admin-llm-metric-cost${req.estimated_cost_usd ? ' admin-llm-metric-has-cost' : ''}\">$${req.estimated_cost_usd?.toFixed(4) || '-'}</div>\n                <div class=\"admin-llm-metric-label\">Est. Cost</div>\n              </div>\n            </div>\n            \n            <div class=\"admin-llm-timeline\">\n              <div><strong class=\"admin-llm-timeline-label\">Queued:</strong> ${req.queued_at ? new Date(req.queued_at).toLocaleString() : '-'}</div>\n              <div><strong class=\"admin-llm-timeline-label\">Started:</strong> ${req.started_at ? new Date(req.started_at).toLocaleString() : '-'}</div>\n              <div><strong class=\"admin-llm-timeline-label\">Completed:</strong> ${req.completed_at ? new Date(req.completed_at).toLocaleString() : '-'}</div>\n            </div>\n            \n            ${req.last_error ? `\n              <div class=\"admin-llm-error-box\">\n                <div class=\"admin-llm-error-header\">\n                  <span class=\"admin-llm-error-icon\"></span>\n                  <strong>Error</strong>\n                  <span class=\"admin-llm-error-attempt\">(Attempt ${req.attempt_count}/${req.max_attempts})</span>\n                </div>\n                <div class=\"admin-llm-error-body\">${escapeHtml(req.last_error)}</div>\n              </div>\n            ` : ''}\n            \n            <!-- Prompt / Input -->\n            <div class=\"admin-llm-section\">\n              <div class=\"admin-llm-section-header\">\n                <h4 class=\"admin-llm-section-title\"><span class=\"admin-llm-section-emoji\"></span> Prompt / Input</h4>\n                <button class=\"btn btn-sm btn-secondary\" id=\"copy-input-btn\">Copy</button>\n              </div>\n              <div class=\"admin-llm-code-block\" id=\"input-display\">${formatPromptText(promptText as string)}</div>\n            </div>\n            \n            <!-- Output -->\n            <div class=\"admin-llm-section\">\n              <div class=\"admin-llm-section-header\">\n                <h4 class=\"admin-llm-section-title\"><span class=\"admin-llm-section-emoji\"></span> Response</h4>\n                <button class=\"btn btn-sm btn-secondary\" id=\"copy-output-btn\">Copy</button>\n              </div>\n              <div class=\"admin-llm-code-block admin-llm-code-block-tall\" id=\"output-display\">${formatPromptText(req.output_text)}</div>\n            </div>\n            \n            <!-- Raw Data Toggle -->\n            <details class=\"admin-llm-details\">\n              <summary class=\"admin-llm-details-summary\">\n                <span class=\"admin-llm-details-summary-inner\"> Raw Data (JSON)</span>\n              </summary>\n              <div class=\"admin-llm-details-content\">\n                <div class=\"admin-llm-json-block\">\n                  <div class=\"admin-llm-json-header\">\n                    <span class=\"admin-llm-json-label\">Input Data</span>\n                    <button class=\"btn btn-xs btn-secondary\" id=\"copy-input-json-btn\">Copy JSON</button>\n                  </div>\n                  <pre class=\"admin-llm-pre\">${formatJsonHtml(req.input_data)}</pre>\n                </div>\n                ${req.output_data ? `\n                  <div class=\"admin-llm-json-block\">\n                    <div class=\"admin-llm-json-header\">\n                      <span class=\"admin-llm-json-label\">Output Data</span>\n                      <button class=\"btn btn-xs btn-secondary\" id=\"copy-output-json-btn\">Copy JSON</button>\n                    </div>\n                    <pre class=\"admin-llm-pre\">${formatJsonHtml(req.output_data)}</pre>\n                  </div>\n                ` : ''}\n              </div>\n            </details>\n          </div>\n          \n          <div class=\"modal-footer\">\n            <button class=\"btn btn-secondary modal-close-btn\">Close</button>\n          </div>\n        </div>\n      `;\n      \n      document.body.appendChild(modal);\n      \n      // Close handlers\n      modal.querySelector('.modal-close')?.addEventListener('click', () => modal.remove());\n      modal.querySelector('.modal-close-btn')?.addEventListener('click', () => modal.remove());\n      modal.addEventListener('click', (e) => {\n        if (e.target === modal) modal.remove();\n      });\n      \n      // ESC key to close\n      const handleEsc = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n          modal.remove();\n          document.removeEventListener('keydown', handleEsc);\n        }\n      };\n      document.addEventListener('keydown', handleEsc);\n      \n      // Copy handlers\n      modal.querySelector('#copy-input-btn')?.addEventListener('click', () => {\n        const text = promptText || JSON.stringify(req.input_data, null, 2);\n        navigator.clipboard.writeText(text as string);\n        toast.success('Input copied to clipboard');\n      });\n      modal.querySelector('#copy-output-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(req.output_text || '');\n        toast.success('Response copied to clipboard');\n      });\n      modal.querySelector('#copy-input-json-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(JSON.stringify(req.input_data, null, 2));\n        toast.success('Input JSON copied to clipboard');\n      });\n      modal.querySelector('#copy-output-json-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(JSON.stringify(req.output_data, null, 2));\n        toast.success('Output JSON copied to clipboard');\n      });\n      \n    } catch (error) {\n      console.error('Failed to load request details:', error);\n      toast.error('Failed to load request details');\n    }\n  }\n  \n  // Load failed items\n  async function loadFailedItems(): Promise<void> {\n    const failedContent = container.querySelector('#failed-items-content');\n    \n    try {\n      const response = await http.get<{\n        items: Array<{\n          id: string;\n          context: string;\n          priority: string;\n          provider?: string;\n          model?: string;\n          attemptCount: number;\n          maxAttempts: number;\n          canRetry: boolean;\n          error?: string;\n          completedAt?: string;\n        }>;\n      }>('/api/llm/queue/retryable?limit=20');\n      \n      const items = response.data?.items || [];\n      \n      if (failedContent) {\n        if (items.length > 0) {\n          failedContent.innerHTML = `\n            <table class=\"admin-queue-table\">\n              <thead>\n                <tr>\n                  <th class=\"admin-queue-th\">Context</th>\n                  <th class=\"admin-queue-th\">Provider</th>\n                  <th class=\"admin-queue-th\">Attempts</th>\n                  <th class=\"admin-queue-th\">Error</th>\n                  <th class=\"admin-queue-th\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${items.map(item => `\n                  <tr>\n                    <td class=\"admin-queue-td\">${item.context || 'Unknown'}</td>\n                    <td class=\"admin-queue-td admin-queue-td-sm\">${item.provider || '-'}</td>\n                    <td class=\"admin-queue-td\">${item.attemptCount}/${item.maxAttempts}</td>\n                    <td class=\"admin-queue-td admin-queue-td-ellipsis admin-queue-td-error\" title=\"${item.error || ''}\">${item.error || '-'}</td>\n                    <td class=\"admin-queue-td\">\n                      <button class=\"btn-sm btn-primary\" data-retry-item=\"${item.id}\" ${!item.canRetry ? 'disabled' : ''}> Retry</button>\n                      <button class=\"btn-sm admin-ml-1\" data-retry-reset-item=\"${item.id}\">Reset & Retry</button>\n                    </td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          failedContent.innerHTML = '<div class=\"admin-placeholder\">No failed items</div>';\n        }\n      }\n    } catch (error) {\n      console.error('Failed to load failed items:', error);\n      if (failedContent) {\n        failedContent.innerHTML = '<div class=\"admin-error-msg\">Failed to load failed items</div>';\n      }\n    }\n  }\n  \n  // Refresh queue status button\n  const refreshStatusBtn = container.querySelector('#refresh-queue-status');\n  if (refreshStatusBtn) {\n    on(refreshStatusBtn as HTMLElement, 'click', loadQueueStatus);\n  }\n  \n  // Refresh history button\n  const refreshHistoryBtn = container.querySelector('#refresh-queue-history');\n  if (refreshHistoryBtn) {\n    on(refreshHistoryBtn as HTMLElement, 'click', loadQueueHistory);\n  }\n  \n  // Refresh failed button\n  const refreshFailedBtn = container.querySelector('#refresh-failed-btn');\n  if (refreshFailedBtn) {\n    on(refreshFailedBtn as HTMLElement, 'click', loadFailedItems);\n  }\n  \n  // Retry all failed items\n  const retryAllBtn = container.querySelector('#retry-all-btn');\n  if (retryAllBtn) {\n    on(retryAllBtn as HTMLElement, 'click', async () => {\n      try {\n        // Get all retryable items and retry them\n        const response = await http.get<{ items: Array<{ id: string; canRetry: boolean }> }>('/api/llm/queue/retryable?limit=50');\n        const items = (response.data?.items || []).filter(i => i.canRetry);\n        \n        let successCount = 0;\n        for (const item of items) {\n          try {\n            await http.post(`/api/llm/queue/${item.id}/retry`, { resetAttempts: false });\n            successCount++;\n          } catch {\n            // Continue with others\n          }\n        }\n        \n        toast.success(`Queued ${successCount} items for retry`);\n        loadQueueStatus();\n        loadFailedItems();\n      } catch (error) {\n        toast.error('Failed to retry items');\n      }\n    });\n  }\n  \n  // Pause queue button\n  const pauseBtn = container.querySelector('#queue-pause-btn');\n  if (pauseBtn) {\n    on(pauseBtn as HTMLElement, 'click', async () => {\n      try {\n        await http.post('/api/llm/queue/pause');\n        toast.success('Queue paused');\n        loadQueueStatus();\n      } catch (error) {\n        toast.error('Failed to pause queue');\n      }\n    });\n  }\n  \n  // Resume queue button\n  const resumeBtn = container.querySelector('#queue-resume-btn');\n  if (resumeBtn) {\n    on(resumeBtn as HTMLElement, 'click', async () => {\n      try {\n        await http.post('/api/llm/queue/resume');\n        toast.success('Queue resumed');\n        loadQueueStatus();\n      } catch (error) {\n        toast.error('Failed to resume queue');\n      }\n    });\n  }\n  \n  // Clear queue button\n  const clearBtn = container.querySelector('#queue-clear-btn');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', async () => {\n      if (confirm('Are you sure you want to clear all pending items from the queue?')) {\n        try {\n          await http.post('/api/llm/queue/clear');\n          toast.success('Queue cleared');\n          loadQueueStatus();\n        } catch (error) {\n          toast.error('Failed to clear queue');\n        }\n      }\n    });\n  }\n  \n  // Cancel individual item, retry handlers, and view details\n  container.addEventListener('click', async (e) => {\n    const target = e.target as HTMLElement;\n    \n    // View request details - use closest to handle click on button or its content\n    const viewBtn = target.closest('[data-view-request]') as HTMLElement | null;\n    if (viewBtn) {\n      e.preventDefault();\n      e.stopPropagation();\n      const viewId = viewBtn.getAttribute('data-view-request');\n      if (viewId) {\n        showRequestDetails(viewId);\n      }\n      return;\n    }\n    \n    // Cancel pending item\n    const cancelBtn = target.closest('[data-cancel-item]') as HTMLElement | null;\n    if (cancelBtn) {\n      const cancelId = cancelBtn.getAttribute('data-cancel-item');\n      if (cancelId) {\n        try {\n          await http.delete(`/api/llm/queue/${cancelId}`);\n          toast.success('Item cancelled');\n          loadQueueStatus();\n        } catch (error) {\n          toast.error('Failed to cancel item');\n        }\n        return;\n      }\n    }\n    \n    // Retry failed item\n    const retryBtn = target.closest('[data-retry-item]') as HTMLElement | null;\n    if (retryBtn) {\n      const retryId = retryBtn.getAttribute('data-retry-item');\n      if (retryId) {\n        try {\n          await http.post(`/api/llm/queue/${retryId}/retry`, { resetAttempts: false });\n          toast.success('Item queued for retry');\n          loadQueueStatus();\n          loadFailedItems();\n        } catch (error) {\n          toast.error('Failed to retry item');\n        }\n        return;\n      }\n    }\n    \n    // Retry with reset\n    const retryResetBtn = target.closest('[data-retry-reset-item]') as HTMLElement | null;\n    if (retryResetBtn) {\n      const retryResetId = retryResetBtn.getAttribute('data-retry-reset-item');\n      if (retryResetId) {\n        try {\n          await http.post(`/api/llm/queue/${retryResetId}/retry`, { resetAttempts: true });\n          toast.success('Item queued for retry (attempts reset)');\n          loadQueueStatus();\n          loadFailedItems();\n        } catch (error) {\n          toast.error('Failed to retry item');\n        }\n        return;\n      }\n    }\n  });\n  \n  // ============ Models Section Handlers ============\n  \n  // Load metadata sync status\n  async function loadMetadataSyncStatus(): Promise<void> {\n    const statusDiv = container.querySelector('#metadata-sync-status');\n    const countsDiv = container.querySelector('#provider-model-counts');\n    \n    try {\n      const response = await http.get<{\n        success: boolean;\n        providers: Array<{\n          provider: string;\n          active_models: number;\n          text_models: number;\n          embedding_models: number;\n          vision_models: number;\n          last_synced: string | null;\n        }>;\n      }>('/api/llm/metadata/status');\n      \n      const providers = response.data?.providers || [];\n      \n      if (statusDiv) {\n        if (providers.length > 0) {\n          statusDiv.innerHTML = `\n            <table class=\"admin-queue-table admin-queue-table-sm\">\n              <thead>\n                <tr>\n                  <th class=\"admin-queue-th\">Provider</th>\n                  <th class=\"admin-queue-th\">Text</th>\n                  <th class=\"admin-queue-th\">Vision</th>\n                  <th class=\"admin-queue-th\">Embeddings</th>\n                  <th class=\"admin-queue-th\">Total</th>\n                  <th class=\"admin-queue-th\">Last Synced</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${providers.map(p => `\n                  <tr>\n                    <td class=\"admin-queue-td admin-queue-td-bold admin-queue-td-cap\">${p.provider}</td>\n                    <td class=\"admin-queue-td\">${p.text_models || 0}</td>\n                    <td class=\"admin-queue-td\">${p.vision_models || 0}</td>\n                    <td class=\"admin-queue-td\">${p.embedding_models || 0}</td>\n                    <td class=\"admin-queue-td admin-queue-td-bold\">${p.active_models || 0}</td>\n                    <td class=\"admin-queue-td admin-queue-td-sm admin-queue-td-muted\">${p.last_synced ? new Date(p.last_synced).toLocaleString() : 'Never'}</td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          statusDiv.innerHTML = '<div class=\"admin-placeholder\">No metadata found. Click \"Sync All Providers\" to fetch model data.</div>';\n        }\n      }\n      \n      // Update counts display\n      if (countsDiv && providers.length > 0) {\n        const total = providers.reduce((sum, p) => sum + (p.active_models || 0), 0);\n        countsDiv.innerHTML = `\n          <div class=\"admin-provider-counts-grid\">\n            ${providers.map(p => `\n              <div class=\"admin-provider-count-card\">\n                <div class=\"admin-provider-count-value\">${p.active_models || 0}</div>\n                <div class=\"admin-provider-count-label\">${p.provider}</div>\n              </div>\n            `).join('')}\n            <div class=\"admin-provider-count-total\">\n              <div class=\"admin-provider-count-value\">${total}</div>\n              <div class=\"admin-provider-count-label\">Total Models</div>\n            </div>\n          </div>\n        `;\n      }\n    } catch (error) {\n      console.error('Failed to load metadata status:', error);\n      if (statusDiv) {\n        statusDiv.innerHTML = '<div class=\"admin-error-msg\">Failed to load metadata status</div>';\n      }\n    }\n  }\n  \n  // Sync all metadata\n  const syncAllBtn = container.querySelector('#sync-all-metadata-btn');\n  if (syncAllBtn) {\n    on(syncAllBtn as HTMLElement, 'click', async () => {\n      const resultDiv = container.querySelector('#metadata-sync-result');\n      (syncAllBtn as HTMLButtonElement).disabled = true;\n      (syncAllBtn as HTMLButtonElement).textContent = 'Syncing...';\n      \n      try {\n        const response = await http.post<{\n          success: boolean;\n          providers: Record<string, { status: string; models?: number; synced?: number; error?: string; reason?: string }>;\n          totalModels: number;\n          errors: Array<{ provider: string; error: string }>;\n        }>('/api/llm/metadata/sync', {});\n        \n        if (resultDiv) {\n          (resultDiv as HTMLElement).classList.remove('hidden');\n          const providers = response.data?.providers || {};\n          const entries = Object.entries(providers);\n          \n          resultDiv.innerHTML = `\n            <div class=\"admin-sync-result-box\">\n              <div class=\"admin-sync-result-title\">Sync Results</div>\n              <div class=\"admin-sync-result-chips\">\n                ${entries.map(([provider, result]) => `\n                  <div class=\"admin-sync-chip admin-sync-chip-${result.status}\">\n                    <span class=\"admin-sync-chip-provider\">${provider}</span>\n                    ${result.status === 'success' ? `<span class=\"admin-sync-chip-ok\">  ${result.synced} models</span>` : ''}\n                    ${result.status === 'skipped' ? `<span class=\"admin-sync-chip-skip\"> - ${result.reason}</span>` : ''}\n                    ${result.status === 'error' ? `<span class=\"admin-sync-chip-err\">  ${result.error}</span>` : ''}\n                  </div>\n                `).join('')}\n              </div>\n              <div class=\"admin-sync-result-total\">\n                Total: ${response.data?.totalModels || 0} models synced\n              </div>\n            </div>\n          `;\n        }\n        \n        toast.success(`Synced ${response.data?.totalModels || 0} models`);\n        loadMetadataSyncStatus();\n        \n      } catch (error) {\n        toast.error('Failed to sync metadata');\n        if (resultDiv) {\n          (resultDiv as HTMLElement).classList.remove('hidden');\n          resultDiv.innerHTML = '<div class=\"admin-error-msg\">Sync failed. Check console for details.</div>';\n        }\n      } finally {\n        (syncAllBtn as HTMLButtonElement).disabled = false;\n        (syncAllBtn as HTMLButtonElement).textContent = ' Sync All Providers';\n      }\n    });\n  }\n  \n  // Browse models by provider\n  const browseModelsBtn = container.querySelector('#browse-models-btn');\n  if (browseModelsBtn) {\n    on(browseModelsBtn as HTMLElement, 'click', async () => {\n      const providerSelect = container.querySelector('#browse-provider-select') as HTMLSelectElement;\n      const contentDiv = container.querySelector('#models-browser-content');\n      const provider = providerSelect?.value;\n      \n      if (!provider) {\n        toast.info('Please select a provider');\n        return;\n      }\n      \n      if (contentDiv) {\n        contentDiv.innerHTML = '<div class=\"admin-placeholder\">Loading models...</div>';\n      }\n      \n      try {\n        const response = await http.get<{\n          success: boolean;\n          textModels: Array<{ model_id: string; display_name: string; context_tokens: number; price_input: number; price_output: number }>;\n          visionModels: Array<{ model_id: string; display_name: string }>;\n          embeddingModels: Array<{ model_id: string; display_name: string }>;\n        }>(`/api/llm/metadata/${provider}`);\n        \n        const { textModels = [], visionModels = [], embeddingModels = [] } = response.data || {};\n        \n        if (contentDiv) {\n          if (textModels.length === 0 && embeddingModels.length === 0) {\n            contentDiv.innerHTML = '<div class=\"admin-empty-state\">No models found for this provider. Try syncing first.</div>';\n          } else {\n            contentDiv.innerHTML = `\n              <div class=\"admin-models-browser-grid\">\n                ${textModels.length > 0 ? `\n                  <div>\n                    <h5 class=\"admin-models-section-title\">Text Models (${textModels.length})</h5>\n                    <div class=\"admin-models-cards\">\n                      ${textModels.map(m => `\n                        <div class=\"admin-model-card\">\n                          <div class=\"admin-model-card-name\">${m.display_name || m.model_id}</div>\n                          <div class=\"admin-model-card-id\">${m.model_id}</div>\n                          <div class=\"admin-model-card-meta\">\n                            <span title=\"Context Window\"> ${m.context_tokens ? (m.context_tokens / 1000).toFixed(0) + 'K' : '-'}</span>\n                            <span title=\"Input Price\"> $${m.price_input?.toFixed(2) || '-'}/1M</span>\n                            <span title=\"Output Price\"> $${m.price_output?.toFixed(2) || '-'}/1M</span>\n                          </div>\n                        </div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : ''}\n                ${embeddingModels.length > 0 ? `\n                  <div>\n                    <h5 class=\"admin-models-section-title\">Embedding Models (${embeddingModels.length})</h5>\n                    <div class=\"admin-models-chips\">\n                      ${embeddingModels.map(m => `\n                        <div class=\"admin-model-chip\">${m.display_name || m.model_id}</div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : ''}\n              </div>\n            `;\n          }\n        }\n      } catch (error) {\n        if (contentDiv) {\n          contentDiv.innerHTML = '<div class=\"admin-error-msg\">Failed to load models</div>';\n        }\n      }\n    });\n  }\n  \n  // Auto-load metadata status if on models section\n  if (currentSection === 'models') {\n    loadMetadataSyncStatus();\n  }\n  \n  // Auto-load queue data if on queue section\n  if (currentSection === 'queue') {\n    loadQueueStatus();\n    loadQueueHistory();\n    loadFailedItems();\n  }\n\n  // Save graph config (Supabase Graph)\n  const saveGraphBtn = container.querySelector('#save-graph-config');\n  if (saveGraphBtn) {\n    on(saveGraphBtn as HTMLElement, 'click', async () => {\n      // Build the graph config object for Supabase Graph\n      const graphConfigValue = {\n        enabled: (container.querySelector('#graph-enabled') as HTMLInputElement)?.checked ?? true,\n        provider: 'supabase', // Always use Supabase graph\n        graphName: (container.querySelector('#graph-name') as HTMLInputElement)?.value || 'godmode',\n      };\n\n      try {\n        // Save as a single 'graph' key with the config object\n        await saveConfig('graph', graphConfigValue, 'graph');\n        \n        toast.success('Graph configuration saved!');\n        console.log('[AdminPanel] Saved graph config:', graphConfigValue);\n      } catch (error) {\n        console.error('[AdminPanel] Error saving graph config:', error);\n        toast.error('Failed to save graph configuration');\n      }\n    });\n  }\n\n  // Test graph connection (Supabase Graph)\n  const testGraphBtn = container.querySelector('#test-graph-connection');\n  if (testGraphBtn) {\n    on(testGraphBtn as HTMLElement, 'click', async () => {\n      (testGraphBtn as HTMLElement).textContent = 'Testing...';\n      try {\n        // Supabase graph uses existing Supabase connection\n        const testConfig = {\n          provider: 'supabase',\n          graphName: (container.querySelector('#graph-name') as HTMLInputElement)?.value || 'godmode',\n        };\n        \n        console.log('[AdminPanel] Testing Supabase graph connection');\n        \n        const response = await http.post<{ success: boolean; ok?: boolean; message?: string; error?: string }>('/api/graph/test', testConfig);\n        if (response.data.success || response.data.ok) {\n          toast.success('Supabase graph connection successful!');\n        } else {\n          toast.error(response.data.message || response.data.error || 'Connection failed');\n        }\n      } catch (error) {\n        console.error('[AdminPanel] Graph test error:', error);\n        toast.error('Graph connection test failed');\n      }\n      (testGraphBtn as HTMLElement).textContent = 'Test Connection';\n    });\n  }\n\n  // Load graph overview\n  const loadGraphOverviewBtn = container.querySelector('#load-graph-overview');\n  if (loadGraphOverviewBtn) {\n    on(loadGraphOverviewBtn as HTMLElement, 'click', async () => {\n      await loadGraphOverview();\n      renderAdminPanel(container);\n    });\n  }\n  const refreshGraphOverviewBtn = container.querySelector('#refresh-graph-overview');\n  if (refreshGraphOverviewBtn) {\n    on(refreshGraphOverviewBtn as HTMLElement, 'click', async () => {\n      await loadGraphOverview();\n      renderAdminPanel(container);\n      toast.info('Graph overview refreshed');\n    });\n  }\n  const openGraphTabBtn = container.querySelector('#open-graph-tab');\n  if (openGraphTabBtn) {\n    on(openGraphTabBtn as HTMLElement, 'click', () => {\n      document.querySelector('.nav-item[data-tab=\"graph\"]')?.dispatchEvent(new MouseEvent('click', { bubbles: true }));\n    });\n  }\n\n  // Load ontology\n  const loadOntologyBtn = container.querySelector('#load-ontology');\n  if (loadOntologyBtn) {\n    on(loadOntologyBtn as HTMLElement, 'click', async () => {\n      await loadOntologyData();\n      renderAdminPanel(container);\n    });\n  }\n  const reloadOntologyBtn = container.querySelector('#reload-ontology');\n  if (reloadOntologyBtn) {\n    on(reloadOntologyBtn as HTMLElement, 'click', async () => {\n      ontologyLoaded = false;\n      await loadOntologyData();\n      renderAdminPanel(container);\n      toast.info('Ontology reloaded');\n    });\n  }\n\n  // Save prompts\n  const savePromptsBtn = container.querySelector('#save-prompts');\n  if (savePromptsBtn) {\n    on(savePromptsBtn as HTMLElement, 'click', async () => {\n      const promptElements = container.querySelectorAll('[data-prompt-key]');\n      let savedCount = 0;\n      \n      for (const textarea of promptElements) {\n        const key = textarea.getAttribute('data-prompt-key')!;\n        const value = (textarea as HTMLTextAreaElement).value;\n        \n        if (value && value.trim()) {\n          try {\n            await http.put(`/api/system/prompts/${key}`, { prompt_template: value.trim() });\n            savedCount++;\n            \n            // Update status indicator\n            const statusEl = container.querySelector(`#status-${key}`);\n            if (statusEl) {\n              statusEl.textContent = ' Saved';\n              statusEl.className = 'prompt-status saved';\n            }\n          } catch (error) {\n            console.warn(`Failed to save prompt ${key}:`, error);\n            const statusEl = container.querySelector(`#status-${key}`);\n            if (statusEl) {\n              statusEl.textContent = ' Error';\n              statusEl.className = 'prompt-status error';\n            }\n          }\n        }\n      }\n      \n      if (savedCount > 0) {\n        toast.success(`${savedCount} prompt(s) saved successfully`);\n      } else {\n        toast.info('No prompts to save');\n      }\n    });\n  }\n\n  // Reload prompts\n  const reloadPromptsBtn = container.querySelector('#reload-prompts');\n  if (reloadPromptsBtn) {\n    on(reloadPromptsBtn as HTMLElement, 'click', async () => {\n      await loadSystemPrompts();\n      renderAdminPanel(container);\n      toast.info('Prompts reloaded from database');\n    });\n  }\n\n  // View version history\n  container.querySelectorAll('[data-view-versions]').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const key = btn.getAttribute('data-view-versions')!;\n      const historyDiv = container.querySelector(`#versions-${key}`) as HTMLElement;\n      const listDiv = historyDiv?.querySelector('.version-list') as HTMLElement;\n      \n      if (!historyDiv || !listDiv) return;\n      \n      // Toggle visibility\n      if (!historyDiv.classList.contains('hidden')) {\n        historyDiv.classList.add('hidden');\n        return;\n      }\n      \n      // Load versions\n      listDiv.innerHTML = '<p class=\"text-muted\">Loading versions...</p>';\n      historyDiv.classList.remove('hidden');\n      \n      try {\n        const response = await http.get<{ current_version: number; versions: Array<{ id: string; version: number; created_at: string }> }>(`/api/system/prompts/${key}/versions`);\n        const versions = response.data?.versions || [];\n        const currentVersion = response.data?.current_version || 1;\n        \n        if (versions.length === 0) {\n          listDiv.innerHTML = `\n            <p class=\"text-muted\">No previous versions. Current version: ${currentVersion}</p>\n            <p class=\"text-sm text-muted\">Versions are saved automatically when you edit a prompt.</p>\n          `;\n          return;\n        }\n        \n        listDiv.innerHTML = `\n          <p class=\"text-sm\"><strong>Current version:</strong> ${currentVersion}</p>\n          <div class=\"version-items\">\n            ${versions.map(v => `\n              <div class=\"version-item\">\n                <div class=\"version-info\">\n                  <span class=\"version-number\">v${v.version}</span>\n                  <span class=\"version-date\">${new Date(v.created_at).toLocaleString()}</span>\n                </div>\n                <div class=\"version-actions\">\n                  <button class=\"btn-sm\" data-preview-version=\"${key}:${v.version}\">Preview</button>\n                  <button class=\"btn-sm btn-primary\" data-restore-version=\"${key}:${v.version}\">Restore</button>\n                </div>\n              </div>\n            `).join('')}\n          </div>\n        `;\n        \n        // Bind restore buttons\n        listDiv.querySelectorAll('[data-restore-version]').forEach(restoreBtn => {\n          on(restoreBtn as HTMLElement, 'click', async () => {\n            const [promptKey, versionStr] = restoreBtn.getAttribute('data-restore-version')!.split(':');\n            const version = parseInt(versionStr, 10);\n            \n            if (!confirm(`Restore prompt \"${promptKey}\" to version ${version}? The current version will be saved in history.`)) {\n              return;\n            }\n            \n            try {\n              await http.post(`/api/system/prompts/${promptKey}/restore`, { version });\n              toast.success(`Restored to version ${version}`);\n              await loadSystemPrompts();\n              renderAdminPanel(container);\n            } catch (error) {\n              toast.error('Failed to restore version');\n            }\n          });\n        });\n        \n        // Bind preview buttons\n        listDiv.querySelectorAll('[data-preview-version]').forEach(previewBtn => {\n          on(previewBtn as HTMLElement, 'click', async () => {\n            const [promptKey, versionStr] = previewBtn.getAttribute('data-preview-version')!.split(':');\n            const version = parseInt(versionStr, 10);\n            \n            try {\n              const response = await http.get<{ version: { prompt_template: string } }>(`/api/system/prompts/${promptKey}/versions/${version}`);\n              const template = response.data?.version?.prompt_template || '';\n              \n              // Show in a modal or alert for now\n              const previewModal = document.createElement('div');\n              previewModal.className = 'modal-overlay';\n              previewModal.innerHTML = `\n                <div class=\"modal-content admin-prompt-preview-modal\">\n                  <div class=\"modal-header\">\n                    <h3>Version ${version} Preview</h3>\n                    <button class=\"modal-close\">&times;</button>\n                  </div>\n                  <div class=\"modal-body\">\n                    <pre class=\"admin-prompt-preview-pre\">${template.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>\n                  </div>\n                </div>\n              `;\n              document.body.appendChild(previewModal);\n              \n              previewModal.querySelector('.modal-close')?.addEventListener('click', () => {\n                previewModal.remove();\n              });\n              previewModal.addEventListener('click', (e) => {\n                if (e.target === previewModal) previewModal.remove();\n              });\n            } catch (error) {\n              toast.error('Failed to load version preview');\n            }\n          });\n        });\n        \n      } catch (error) {\n        listDiv.innerHTML = '<p class=\"text-error\">Failed to load version history</p>';\n      }\n    });\n  });\n\n  // Save processing\n  const saveProcBtn = container.querySelector('#save-processing');\n  if (saveProcBtn) {\n    on(saveProcBtn as HTMLElement, 'click', async () => {\n      await saveConfig('chunk_size', parseInt((container.querySelector('#proc-chunk-size') as HTMLInputElement)?.value || '1000'), 'processing');\n      await saveConfig('chunk_overlap', parseInt((container.querySelector('#proc-chunk-overlap') as HTMLInputElement)?.value || '200'), 'processing');\n      await saveConfig('max_tokens', parseInt((container.querySelector('#proc-max-tokens') as HTMLInputElement)?.value || '4096'), 'processing');\n      await saveConfig('temperature', parseFloat((container.querySelector('#proc-temperature') as HTMLInputElement)?.value || '0.7'), 'processing');\n      await saveConfig('auto_process', (container.querySelector('#proc-auto-process') as HTMLInputElement)?.checked, 'processing');\n      await saveConfig('parallel_jobs', parseInt((container.querySelector('#proc-parallel-jobs') as HTMLInputElement)?.value || '3'), 'processing');\n    });\n  }\n\n  // Save Team Analysis settings\n  const saveTeamAnalysisBtn = container.querySelector('#save-team-analysis');\n  if (saveTeamAnalysisBtn) {\n    on(saveTeamAnalysisBtn as HTMLElement, 'click', async () => {\n      const enabled = (container.querySelector('#team-analysis-enabled') as HTMLInputElement)?.checked ?? true;\n      const access = (container.querySelector('#team-analysis-access') as HTMLSelectElement)?.value || 'admin_only';\n      await saveTeamAnalysisSettings(enabled, access);\n      renderAdminPanel(container);\n    });\n  }\n\n  // Google Drive: use delegation so buttons work when section is rendered later\n  on(container, 'click', async (e: Event) => {\n    const target = (e.target as HTMLElement).closest?.('[id]') as HTMLElement | null;\n    if (!target?.id) return;\n    if (target.id === 'save-google-drive') {\n      e.preventDefault();\n      const enabled = (container.querySelector('#google-drive-enabled') as HTMLInputElement)?.checked ?? false;\n      const rootFolderId = (container.querySelector('#google-drive-root-folder') as HTMLInputElement)?.value?.trim() ?? '';\n      const serviceJson = (container.querySelector('#google-drive-service-json') as HTMLTextAreaElement)?.value?.trim() ?? '';\n      try {\n        await http.post('/api/system/google-drive', { enabled, rootFolderId, serviceAccountJson: serviceJson || undefined });\n        toast.success('Google Drive config saved');\n        googleDriveLoaded = false;\n        await loadGoogleDriveState();\n        renderAdminPanel(container);\n      } catch (err: unknown) {\n        toast.error(err && typeof err === 'object' && 'message' in err ? String((err as { message: string }).message) : 'Failed to save');\n      }\n    } else if (target.id === 'bootstrap-google-drive') {\n      e.preventDefault();\n      const btn = container.querySelector('#bootstrap-google-drive') as HTMLButtonElement;\n      if (btn) { btn.disabled = true; btn.textContent = 'Running...'; }\n      try {\n        const res = await http.post<{ success: boolean; message?: string; projectsCount?: number }>('/api/system/google-drive/bootstrap-all');\n        toast.success(res?.message ?? `Bootstrap complete: ${res?.projectsCount ?? 0} projects`);\n        googleDriveLoaded = false;\n        await loadGoogleDriveState();\n        renderAdminPanel(container);\n      } catch (err: unknown) {\n        toast.error(err && typeof err === 'object' && 'message' in err ? String((err as { message: string }).message) : 'Bootstrap failed');\n      } finally {\n        if (btn) { btn.disabled = false; btn.textContent = 'Bootstrap all projects'; }\n      }\n    }\n  });\n\n  // =========================\n  // BILLING SECTION EVENTS\n  // =========================\n  \n  // Exchange rate auto toggle\n  const exchangeRateAutoCheckbox = container.querySelector('#exchange-rate-auto');\n  if (exchangeRateAutoCheckbox) {\n    on(exchangeRateAutoCheckbox as HTMLElement, 'change', () => {\n      const isAuto = (exchangeRateAutoCheckbox as HTMLInputElement).checked;\n      const manualGroup = container.querySelector('#manual-rate-group') as HTMLElement;\n      const refreshBtn = container.querySelector('#refresh-rate-btn') as HTMLButtonElement;\n      if (manualGroup) {\n        manualGroup.classList.toggle('hidden', !!isAuto);\n      }\n      if (refreshBtn) {\n        refreshBtn.disabled = !isAuto;\n      }\n    });\n  }\n  \n  // Refresh exchange rate button\n  const refreshRateBtn = container.querySelector('#refresh-rate-btn');\n  if (refreshRateBtn) {\n    on(refreshRateBtn as HTMLElement, 'click', async () => {\n      const btn = refreshRateBtn as HTMLButtonElement;\n      btn.disabled = true;\n      btn.textContent = 'Refreshing...';\n      \n      try {\n        const result = await billingService.refreshExchangeRate();\n        if (result.success && result.rate) {\n          const rateDisplay = container.querySelector('#current-rate-display');\n          const sourceDisplay = container.querySelector('#rate-source');\n          if (rateDisplay) rateDisplay.textContent = result.rate.toFixed(4);\n          if (sourceDisplay) sourceDisplay.textContent = result.source || 'api';\n          toast.success(`Rate updated: ${result.rate.toFixed(4)}`);\n        } else {\n          toast.error(result.error || 'Failed to refresh rate');\n        }\n      } catch (e) {\n        toast.error('Failed to refresh rate');\n      } finally {\n        btn.disabled = false;\n        btn.textContent = 'Refresh Rate';\n      }\n    });\n  }\n  \n  // Save exchange rate settings\n  const saveExchangeRateBtn = container.querySelector('#save-exchange-rate-btn');\n  if (saveExchangeRateBtn) {\n    on(saveExchangeRateBtn as HTMLElement, 'click', async () => {\n      const isAuto = (container.querySelector('#exchange-rate-auto') as HTMLInputElement)?.checked ?? true;\n      const manualRate = parseFloat((container.querySelector('#exchange-rate-manual') as HTMLInputElement)?.value || '0.92');\n      \n      const result = await billingService.setExchangeRateMode(isAuto, manualRate);\n      \n      if (result.success) {\n        toast.success('Exchange rate settings saved');\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to save');\n      }\n    });\n  }\n  \n  // Save global pricing config\n  const saveGlobalPricingBtn = container.querySelector('#save-global-pricing-btn');\n  if (saveGlobalPricingBtn) {\n    on(saveGlobalPricingBtn as HTMLElement, 'click', async () => {\n      const fixedMarkup = parseFloat((container.querySelector('#global-markup-percent') as HTMLInputElement)?.value || '0');\n      const periodType = (container.querySelector('#global-period-type') as HTMLSelectElement)?.value || 'monthly';\n      \n      const result = await billingService.setGlobalPricingConfig({\n        fixed_markup_percent: fixedMarkup,\n        period_type: periodType as 'monthly' | 'weekly'\n      });\n      \n      if (result.success) {\n        toast.success('Global pricing saved');\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to save');\n      }\n    });\n  }\n  \n  // Add tier button\n  const addTierBtn = container.querySelector('#add-tier-btn');\n  if (addTierBtn) {\n    on(addTierBtn as HTMLElement, 'click', () => {\n      // Add a new tier to the list\n      globalPricingTiers.push({\n        id: '',\n        pricing_config_id: globalPricingConfig?.id || '',\n        token_limit: 100000,\n        markup_percent: 20,\n        name: `Tier ${globalPricingTiers.length + 1}`,\n        tier_order: globalPricingTiers.length\n      });\n      renderAdminPanel(container);\n    });\n  }\n  \n  // Remove tier buttons\n  container.querySelectorAll('.remove-tier-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const index = parseInt(btn.getAttribute('data-index') || '0', 10);\n      globalPricingTiers.splice(index, 1);\n      renderAdminPanel(container);\n    });\n  });\n  \n  // Tier unlimited checkboxes\n  container.querySelectorAll('.tier-unlimited').forEach(checkbox => {\n    on(checkbox as HTMLElement, 'change', () => {\n      const row = (checkbox as HTMLElement).closest('.tier-row') as HTMLElement;\n      const limitInput = row?.querySelector('.tier-limit') as HTMLInputElement;\n      if (limitInput) {\n        limitInput.disabled = (checkbox as HTMLInputElement).checked;\n        if ((checkbox as HTMLInputElement).checked) {\n          limitInput.value = '';\n        }\n      }\n    });\n  });\n  \n  // Save tiers button\n  const saveTiersBtn = container.querySelector('#save-tiers-btn');\n  if (saveTiersBtn) {\n    on(saveTiersBtn as HTMLElement, 'click', async () => {\n      const tiers: Array<{ token_limit: number | null; markup_percent: number; name?: string }> = [];\n      container.querySelectorAll('.tier-row').forEach(row => {\n        const name = (row.querySelector('.tier-name') as HTMLInputElement)?.value || '';\n        const limitValue = (row.querySelector('.tier-limit') as HTMLInputElement)?.value;\n        const markup = parseFloat((row.querySelector('.tier-markup') as HTMLInputElement)?.value || '0');\n        const unlimited = (row.querySelector('.tier-unlimited') as HTMLInputElement)?.checked;\n        \n        tiers.push({\n          token_limit: unlimited ? null : (limitValue ? parseInt(limitValue, 10) : null),\n          markup_percent: markup,\n          name: name || undefined\n        });\n      });\n      \n      const result = await billingService.setGlobalPricingTiers(tiers);\n      if (result.success) {\n        toast.success('Pricing tiers saved');\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to save tiers');\n      }\n    });\n  }\n  \n  // Refresh billing button\n  const refreshBillingBtn = container.querySelector('#refresh-billing-btn');\n  if (refreshBillingBtn) {\n    on(refreshBillingBtn as HTMLElement, 'click', async () => {\n      billingLoaded = false;\n      await loadBillingData();\n      renderAdminPanel(container);\n      toast.info('Billing data refreshed');\n    });\n  }\n  \n  // Add balance buttons\n  container.querySelectorAll('.add-balance-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const projectId = btn.getAttribute('data-project-id');\n      const projectName = btn.getAttribute('data-project-name');\n      if (!projectId) return;\n      \n      const amount = prompt(`Enter amount in EUR to add to \"${projectName}\":`);\n      if (!amount || isNaN(parseFloat(amount))) return;\n      \n      const result = await billingService.creditProjectBalance(projectId, parseFloat(amount));\n      if (result.success) {\n        toast.success(`Added ${parseFloat(amount).toFixed(2)} to ${projectName}. New balance: ${result.new_balance?.toFixed(2)}`);\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to add balance');\n      }\n    });\n  });\n  \n  // Toggle unlimited buttons\n  container.querySelectorAll('.toggle-unlimited-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const projectId = btn.getAttribute('data-project-id');\n      const isUnlimited = btn.getAttribute('data-unlimited') === 'true';\n      if (!projectId) return;\n      \n      const action = isUnlimited ? 'disable unlimited mode' : 'enable unlimited mode';\n      if (!confirm(`Are you sure you want to ${action} for this project?`)) return;\n      \n      const result = await billingService.setProjectUnlimited(projectId, !isUnlimited);\n      if (result.success) {\n        toast.success(`Unlimited mode ${isUnlimited ? 'disabled' : 'enabled'}`);\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to update');\n      }\n    });\n  });\n\n  // Refresh audit\n  const refreshAuditBtn = container.querySelector('#refresh-audit');\n  if (refreshAuditBtn) {\n    on(refreshAuditBtn as HTMLElement, 'click', async () => {\n      await loadAuditLogs();\n      renderAdminPanel(container);\n    });\n  }\n}\n\n/**\n * Render admin panel\n */\nfunction renderAdminPanel(container: HTMLElement): void {\n  container.innerHTML = `\n    <div class=\"admin-panel\">\n      <div class=\"admin-header\">\n        <div class=\"admin-header-content\">\n          <div class=\"admin-icon\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"32\" height=\"32\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/>\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\n            </svg>\n          </div>\n          <div class=\"admin-title\">\n            <h2>Platform Administration</h2>\n            <p>System configuration for superadmins</p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"admin-body\">\n        <nav class=\"admin-nav\">\n          ${renderNav()}\n        </nav>\n\n        <main class=\"admin-content\">\n          ${isLoading ? '<div class=\"loading-spinner\">Loading...</div>' : renderSectionContent()}\n        </main>\n      </div>\n    </div>\n  `;\n\n  bindSectionEvents(container);\n}\n\n/**\n * Initialize and mount admin panel\n */\nexport async function initAdminPanel(container: HTMLElement): Promise<void> {\n  // Check if user is superadmin\n  const state = appStore.getState();\n  if (state.currentUser?.role !== 'superadmin') {\n    container.innerHTML = `\n      <div class=\"admin-panel\">\n        <div class=\"admin-header\">\n          <h2>Access Denied</h2>\n          <p>You need superadmin privileges to access this section.</p>\n        </div>\n      </div>\n    `;\n    return;\n  }\n\n  isLoading = true;\n  renderAdminPanel(container);\n\n  // Load data\n  await Promise.all([\n    loadSystemConfig(),\n    loadProviders(),\n    loadAuditLogs(),\n    loadSystemPrompts(),\n    loadSecrets(),\n  ]);\n\n  isLoading = false;\n  renderAdminPanel(container);\n}\n\nexport default initAdminPanel;\n","/**\r\n * History Panel Component\r\n * Display processing history timeline\r\n */\r\n\r\nimport { createElement, on } from '../utils/dom';\r\nimport { http, fetchWithProject } from '../services/api';\r\nimport { formatRelativeTime, formatDate } from '../utils/format';\r\nimport { toast } from '../services/toast';\r\n\r\nexport interface HistoryEntry {\r\n  id: string;\r\n  action: 'create' | 'update' | 'delete' | 'restore' | 'process' | 'upload';\r\n  entityType: string;\r\n  entityId: string;\r\n  entityName?: string;\r\n  changes?: Record<string, { old: unknown; new: unknown }>;\r\n  actor: {\r\n    id: string;\r\n    name: string;\r\n    email?: string;\r\n  };\r\n  timestamp: string;\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\nexport interface HistoryPanelProps {\r\n  onRestore?: (entry: HistoryEntry) => void;\r\n  onExport?: () => void;\r\n}\r\n\r\nlet entries: HistoryEntry[] = [];\r\nlet page = 1;\r\nlet hasMore = true;\r\nlet loading = false;\r\nlet currentFilters = {\r\n  action: '' as string,\r\n  entityType: '' as string,\r\n  dateFrom: '' as string,\r\n  dateTo: '' as string,\r\n};\r\n\r\n/**\r\n * Create history panel\r\n */\r\nexport function createHistoryPanel(props: HistoryPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'history-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"history-filters\">\r\n      <select id=\"history-action-filter\" class=\"filter-select\">\r\n        <option value=\"\">All Actions</option>\r\n        <option value=\"create\">Created</option>\r\n        <option value=\"update\">Updated</option>\r\n        <option value=\"delete\">Deleted</option>\r\n        <option value=\"restore\">Restored</option>\r\n        <option value=\"process\">Processed</option>\r\n        <option value=\"upload\">Uploaded</option>\r\n      </select>\r\n      <select id=\"history-entity-filter\" class=\"filter-select\">\r\n        <option value=\"\">All Types</option>\r\n        <option value=\"document\">Documents</option>\r\n        <option value=\"fact\">Facts</option>\r\n        <option value=\"question\">Questions</option>\r\n        <option value=\"risk\">Risks</option>\r\n        <option value=\"action\">Actions</option>\r\n        <option value=\"decision\">Decisions</option>\r\n        <option value=\"contact\">Contacts</option>\r\n        <option value=\"email\">Emails</option>\r\n      </select>\r\n      <input type=\"date\" id=\"history-date-from\" class=\"filter-date\" placeholder=\"From\">\r\n      <input type=\"date\" id=\"history-date-to\" class=\"filter-date\" placeholder=\"To\">\r\n      <button class=\"btn btn-sm\" id=\"history-clear-filters\">Clear</button>\r\n    </div>\r\n    <div class=\"history-content\" id=\"history-content\">\r\n      <div class=\"loading\">Loading history...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind filter events\r\n  bindFilters(panel, props);\r\n\r\n  // Initial load\r\n  loadHistory(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Bind filter event handlers\r\n */\r\nfunction bindFilters(panel: HTMLElement, props: HistoryPanelProps): void {\r\n  const actionFilter = panel.querySelector('#history-action-filter') as HTMLSelectElement;\r\n  const entityFilter = panel.querySelector('#history-entity-filter') as HTMLSelectElement;\r\n  const dateFromInput = panel.querySelector('#history-date-from') as HTMLInputElement;\r\n  const dateToInput = panel.querySelector('#history-date-to') as HTMLInputElement;\r\n  const clearBtn = panel.querySelector('#history-clear-filters') as HTMLButtonElement;\r\n\r\n  const applyFilters = () => {\r\n    currentFilters = {\r\n      action: actionFilter.value,\r\n      entityType: entityFilter.value,\r\n      dateFrom: dateFromInput.value,\r\n      dateTo: dateToInput.value,\r\n    };\r\n    entries = [];\r\n    page = 1;\r\n    hasMore = true;\r\n    loadHistory(panel, props);\r\n  };\r\n\r\n  on(actionFilter, 'change', applyFilters);\r\n  on(entityFilter, 'change', applyFilters);\r\n  on(dateFromInput, 'change', applyFilters);\r\n  on(dateToInput, 'change', applyFilters);\r\n\r\n  on(clearBtn, 'click', () => {\r\n    actionFilter.value = '';\r\n    entityFilter.value = '';\r\n    dateFromInput.value = '';\r\n    dateToInput.value = '';\r\n    applyFilters();\r\n  });\r\n}\r\n\r\n/**\r\n * Load history entries\r\n */\r\nasync function loadHistory(panel: HTMLElement, props: HistoryPanelProps): Promise<void> {\r\n  if (loading) return;\r\n\r\n  const content = panel.querySelector('#history-content') as HTMLElement;\r\n  \r\n  if (page === 1) {\r\n    content.innerHTML = '<div class=\"loading\">Loading history...</div>';\r\n  }\r\n\r\n  loading = true;\r\n\r\n  try {\r\n    const params = new URLSearchParams({ page: String(page), limit: '30' });\r\n    if (currentFilters.action) params.set('action', currentFilters.action);\r\n    if (currentFilters.entityType) params.set('entityType', currentFilters.entityType);\r\n    if (currentFilters.dateFrom) params.set('dateFrom', currentFilters.dateFrom);\r\n    if (currentFilters.dateTo) params.set('dateTo', currentFilters.dateTo);\r\n\r\n    const response = await http.get<{ entries: HistoryEntry[]; hasMore: boolean }>(\r\n      `/api/history?${params}`\r\n    );\r\n\r\n    entries = page === 1 ? response.data.entries : [...entries, ...response.data.entries];\r\n    hasMore = response.data.hasMore;\r\n    page++;\r\n\r\n    renderHistory(content, props);\r\n  } catch {\r\n    if (page === 1) {\r\n      content.innerHTML = '<div class=\"error\">Failed to load history</div>';\r\n    }\r\n  } finally {\r\n    loading = false;\r\n  }\r\n}\r\n\r\n/**\r\n * Render history timeline\r\n */\r\nfunction renderHistory(container: HTMLElement, props: HistoryPanelProps): void {\r\n  if (entries.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <span class=\"empty-icon\"></span>\r\n        <p>No history entries found</p>\r\n        <span class=\"empty-hint\">Processing and editing activity will appear here</span>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  // Group by date\r\n  const grouped = groupByDate(entries);\r\n\r\n  container.innerHTML = `\r\n    <div class=\"history-timeline\">\r\n      ${Object.entries(grouped).map(([date, items]) => `\r\n        <div class=\"history-date-group\">\r\n          <div class=\"history-date-header\">${date}</div>\r\n          <div class=\"history-items\">\r\n            ${items.map(entry => renderEntry(entry, props)).join('')}\r\n          </div>\r\n        </div>\r\n      `).join('')}\r\n    </div>\r\n    ${hasMore ? `\r\n      <div class=\"history-load-more\">\r\n        <button class=\"btn btn-secondary\" id=\"load-more-history\">Load More</button>\r\n      </div>\r\n    ` : `\r\n      <div class=\"history-end\">\r\n        <span>End of history</span>\r\n      </div>\r\n    `}\r\n  `;\r\n\r\n  // Bind load more\r\n  const loadMoreBtn = container.querySelector('#load-more-history');\r\n  if (loadMoreBtn) {\r\n    on(loadMoreBtn as HTMLElement, 'click', async () => {\r\n      const panel = container.closest('.history-panel') as HTMLElement;\r\n      await loadHistory(panel, props);\r\n    });\r\n  }\r\n\r\n  // Bind expand buttons\r\n  container.querySelectorAll('[data-action=\"expand\"]').forEach(btn => {\r\n    on(btn as HTMLElement, 'click', () => {\r\n      const changesEl = btn.closest('.history-entry')?.querySelector('.history-changes');\r\n      if (changesEl) {\r\n        changesEl.classList.toggle('expanded');\r\n        btn.textContent = changesEl.classList.contains('expanded') ? 'Hide details' : 'Show details';\r\n      }\r\n    });\r\n  });\r\n\r\n  // Bind restore buttons\r\n  if (props.onRestore) {\r\n    container.querySelectorAll('[data-action=\"restore\"]').forEach(btn => {\r\n      on(btn as HTMLElement, 'click', () => {\r\n        const entryId = btn.getAttribute('data-entry-id');\r\n        const entry = entries.find(e => e.id === entryId);\r\n        if (entry && props.onRestore) {\r\n          props.onRestore(entry);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Render single entry\r\n */\r\nfunction renderEntry(entry: HistoryEntry, props: HistoryPanelProps): string {\r\n  const actionIcons: Record<string, string> = {\r\n    create: '',\r\n    update: '',\r\n    delete: '',\r\n    restore: '',\r\n    process: '',\r\n    upload: '',\r\n  };\r\n\r\n  const actionColors: Record<string, string> = {\r\n    create: 'success',\r\n    update: 'info',\r\n    delete: 'danger',\r\n    restore: 'warning',\r\n    process: 'info',\r\n    upload: 'success',\r\n  };\r\n\r\n  const hasChanges = entry.changes && Object.keys(entry.changes).length > 0;\r\n\r\n  return `\r\n    <div class=\"history-entry ${actionColors[entry.action] || 'info'}\" data-entry-id=\"${entry.id}\">\r\n      <div class=\"history-icon\">${actionIcons[entry.action] || ''}</div>\r\n      <div class=\"history-content\">\r\n        <div class=\"history-summary\">\r\n          <strong>${escapeHtml(entry.actor.name)}</strong>\r\n          ${getActionVerb(entry.action)}\r\n          <span class=\"entity-type\">${entry.entityType}</span>\r\n          ${entry.entityName ? `\"${escapeHtml(entry.entityName)}\"` : ''}\r\n        </div>\r\n        <div class=\"history-time\">${formatRelativeTime(entry.timestamp)}</div>\r\n        \r\n        ${hasChanges ? `\r\n          <div class=\"history-changes\">\r\n            ${Object.entries(entry.changes!).slice(0, 5).map(([field, change]) => `\r\n              <div class=\"change-item\">\r\n                <span class=\"change-field\">${formatFieldName(field)}:</span>\r\n                <span class=\"change-old\">${formatValue(change.old)}</span>\r\n                <span class=\"change-arrow\"></span>\r\n                <span class=\"change-new\">${formatValue(change.new)}</span>\r\n              </div>\r\n            `).join('')}\r\n            ${Object.keys(entry.changes!).length > 5 ? `<div class=\"change-more\">+${Object.keys(entry.changes!).length - 5} more changes</div>` : ''}\r\n          </div>\r\n          <button class=\"btn-link\" data-action=\"expand\">Show details</button>\r\n        ` : ''}\r\n        \r\n        ${entry.action === 'delete' && props.onRestore ? `\r\n          <button class=\"btn btn-sm btn-secondary\" data-action=\"restore\" data-entry-id=\"${entry.id}\">\r\n            Restore\r\n          </button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get action verb\r\n */\r\nfunction getActionVerb(action: string): string {\r\n  const verbs: Record<string, string> = {\r\n    create: 'created',\r\n    update: 'updated',\r\n    delete: 'deleted',\r\n    restore: 'restored',\r\n    process: 'processed',\r\n    upload: 'uploaded',\r\n  };\r\n  return verbs[action] || action;\r\n}\r\n\r\n/**\r\n * Group entries by date\r\n */\r\nfunction groupByDate(items: HistoryEntry[]): Record<string, HistoryEntry[]> {\r\n  const groups: Record<string, HistoryEntry[]> = {};\r\n  const today = new Date().toDateString();\r\n  const yesterday = new Date(Date.now() - 86400000).toDateString();\r\n\r\n  items.forEach(item => {\r\n    const itemDate = new Date(item.timestamp);\r\n    let dateLabel: string;\r\n    \r\n    if (itemDate.toDateString() === today) {\r\n      dateLabel = 'Today';\r\n    } else if (itemDate.toDateString() === yesterday) {\r\n      dateLabel = 'Yesterday';\r\n    } else {\r\n      dateLabel = itemDate.toLocaleDateString(undefined, { \r\n        weekday: 'long', \r\n        month: 'long', \r\n        day: 'numeric' \r\n      });\r\n    }\r\n\r\n    if (!groups[dateLabel]) {\r\n      groups[dateLabel] = [];\r\n    }\r\n    groups[dateLabel].push(item);\r\n  });\r\n\r\n  return groups;\r\n}\r\n\r\n/**\r\n * Format field name\r\n */\r\nfunction formatFieldName(field: string): string {\r\n  return field\r\n    .replace(/_/g, ' ')\r\n    .replace(/([A-Z])/g, ' $1')\r\n    .replace(/^./, str => str.toUpperCase());\r\n}\r\n\r\n/**\r\n * Format value for display\r\n */\r\nfunction formatValue(value: unknown): string {\r\n  if (value === null || value === undefined) return '(empty)';\r\n  if (typeof value === 'boolean') return value ? 'Yes' : 'No';\r\n  if (typeof value === 'object') {\r\n    const str = JSON.stringify(value);\r\n    return str.length > 50 ? str.substring(0, 47) + '...' : str;\r\n  }\r\n  const str = String(value);\r\n  return str.length > 50 ? str.substring(0, 47) + '...' : str;\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Export history\r\n */\r\nexport async function exportHistory(format: 'json' | 'csv' = 'json'): Promise<void> {\r\n  try {\r\n    const params = new URLSearchParams({ format, limit: '1000' });\r\n    if (currentFilters.action) params.set('action', currentFilters.action);\r\n    if (currentFilters.entityType) params.set('entityType', currentFilters.entityType);\r\n    if (currentFilters.dateFrom) params.set('dateFrom', currentFilters.dateFrom);\r\n    if (currentFilters.dateTo) params.set('dateTo', currentFilters.dateTo);\r\n\r\n    const response = await fetchWithProject(`/api/history/export?${params}`);\r\n    const blob = await response.blob();\r\n    \r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `history-export.${format}`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n    \r\n    toast.success('History exported successfully');\r\n  } catch {\r\n    toast.error('Failed to export history');\r\n  }\r\n}\r\n\r\nexport default createHistoryPanel;\r\n","/**\r\n * Team Analysis Store\r\n * State management for behavioral profiles and team dynamics\r\n */\r\n\r\nimport { fetchWithProject } from '../services/api';\r\n\r\n// Types\r\nexport interface BehavioralProfile {\r\n    id: string;\r\n    person_id: string;\r\n    person?: {\r\n        id: string;\r\n        name: string;\r\n        role?: string;\r\n        organization?: string;\r\n        email?: string;\r\n    };\r\n    profile_data: ProfileData;\r\n    confidence_level: 'low' | 'medium' | 'high' | 'very_high';\r\n    communication_style?: string;\r\n    dominant_motivation?: string;\r\n    risk_tolerance?: 'low' | 'medium' | 'high';\r\n    influence_score: number;\r\n    transcripts_analyzed: string[];\r\n    transcript_count: number;\r\n    total_speaking_time_seconds: number;\r\n    limitations: string[];\r\n    recommended_update_after?: string;\r\n    last_analysis_at: string;\r\n    created_at: string;\r\n    updated_at: string;\r\n}\r\n\r\nexport interface ProfileData {\r\n    target_name?: string;\r\n    analysis_date?: string;\r\n    confidence_level?: string;\r\n    communication_identity?: {\r\n        dominant_style?: string;\r\n        intervention_rhythm?: string;\r\n        textual_body_language?: string;\r\n        evidence?: Evidence[];\r\n    };\r\n    motivations_and_priorities?: {\r\n        values_most?: string[];\r\n        avoids?: string[];\r\n        based_on?: string;\r\n        confidence?: string;\r\n        evidence?: Evidence[];\r\n    };\r\n    behavior_under_pressure?: PressureBehavior[];\r\n    influence_tactics?: InfluenceTactic[];\r\n    vulnerabilities?: {\r\n        discourse_action_inconsistencies?: { description: string; evidence: string }[];\r\n        defense_triggers?: { trigger: string; evidence: string }[];\r\n        blind_spots?: { description: string; evidence: string }[];\r\n        risk_patterns?: { pattern: string; evidence: string }[];\r\n    };\r\n    interaction_strategy?: {\r\n        ideal_format?: {\r\n            channel?: string;\r\n            structure?: string;\r\n            timing?: string;\r\n        };\r\n        framing_that_works?: string[];\r\n        what_to_avoid?: string[];\r\n        cooperation_triggers?: string[];\r\n    };\r\n    early_warning_signs?: EarlyWarningSign[];\r\n    power_analysis?: PowerAnalysis[];\r\n    limitations?: string[];\r\n    recommended_update_after?: string;\r\n}\r\n\r\nexport interface Evidence {\r\n    timestamp?: string;\r\n    quote?: string;\r\n    observation?: string;\r\n}\r\n\r\nexport interface PressureBehavior {\r\n    situation: string;\r\n    observed_behavior: string;\r\n    timestamp?: string;\r\n    quote?: string;\r\n}\r\n\r\nexport interface InfluenceTactic {\r\n    objective: string;\r\n    tactic: string;\r\n    timestamp?: string;\r\n    example?: string;\r\n}\r\n\r\nexport interface EarlyWarningSign {\r\n    signal: string;\r\n    indicates: string;\r\n    comparison_evidence?: string;\r\n}\r\n\r\nexport interface PowerAnalysis {\r\n    factor: string;\r\n    assessment: string;\r\n    strategic_implication?: string;\r\n}\r\n\r\nexport interface TeamAnalysis {\r\n    id: string;\r\n    project_id: string;\r\n    analysis_data: TeamAnalysisData;\r\n    team_size: number;\r\n    cohesion_score: number;\r\n    tension_level: 'low' | 'medium' | 'high';\r\n    dominant_communication_pattern?: string;\r\n    influence_map: InfluenceRelation[];\r\n    alliances: Alliance[];\r\n    tensions: Tension[];\r\n    members_included: string[];\r\n    transcripts_analyzed: string[];\r\n    last_analysis_at: string;\r\n}\r\n\r\nexport interface TeamAnalysisData {\r\n    analysis_date?: string;\r\n    team_size?: number;\r\n    cohesion_score?: number;\r\n    tension_level?: string;\r\n    dominant_communication_pattern?: string;\r\n    power_centers?: PowerCenter[];\r\n    communication_flow?: {\r\n        central_nodes?: string[];\r\n        bottlenecks?: string[];\r\n        isolated_members?: string[];\r\n        information_brokers?: string[];\r\n    };\r\n    recommendations?: string[];\r\n    risk_factors?: string[];\r\n}\r\n\r\nexport interface InfluenceRelation {\r\n    from_person?: string;\r\n    to_person?: string;\r\n    influence_type?: string;\r\n    strength?: number;\r\n    evidence?: string;\r\n}\r\n\r\nexport interface Alliance {\r\n    members?: string[];\r\n    alliance_type?: string;\r\n    shared_values?: string[];\r\n    strength?: number;\r\n    evidence?: string;\r\n}\r\n\r\nexport interface Tension {\r\n    between?: string[];\r\n    tension_type?: string;\r\n    level?: string;\r\n    triggers?: string[];\r\n    evidence?: string;\r\n}\r\n\r\nexport interface PowerCenter {\r\n    person?: string;\r\n    power_type?: string;\r\n    influence_reach?: number;\r\n    dependencies?: string[];\r\n}\r\n\r\nexport interface BehavioralRelationship {\r\n    id: string;\r\n    from_person_id: string;\r\n    to_person_id: string;\r\n    from_person?: { id: string; name: string };\r\n    to_person?: { id: string; name: string };\r\n    relationship_type: string;\r\n    strength: number;\r\n    confidence: string;\r\n    evidence: any[];\r\n    evidence_count: number;\r\n}\r\n\r\nexport interface GraphNode {\r\n    id: string;\r\n    label: string;\r\n    group: string;\r\n    size: number;\r\n    title?: string;\r\n    color?: string;\r\n    properties?: Record<string, any>;\r\n}\r\n\r\nexport interface GraphEdge {\r\n    from: string;\r\n    to: string;\r\n    type: string;\r\n    label?: string;\r\n    width?: number;\r\n    dashes?: boolean;\r\n    color?: string;\r\n    arrows?: string;\r\n    title?: string;\r\n    properties?: Record<string, any>;\r\n}\r\n\r\nexport interface TeamAnalysisState {\r\n    profiles: BehavioralProfile[];\r\n    selectedProfile: BehavioralProfile | null;\r\n    teamAnalysis: TeamAnalysis | null;\r\n    relationships: BehavioralRelationship[];\r\n    graphData: { nodes: GraphNode[]; edges: GraphEdge[] } | null;\r\n    loading: boolean;\r\n    analyzing: boolean;\r\n    error: string | null;\r\n    currentSubtab: 'profiles' | 'team' | 'graph';\r\n}\r\n\r\n// Initial state\r\nconst initialState: TeamAnalysisState = {\r\n    profiles: [],\r\n    selectedProfile: null,\r\n    teamAnalysis: null,\r\n    relationships: [],\r\n    graphData: null,\r\n    loading: false,\r\n    analyzing: false,\r\n    error: null,\r\n    currentSubtab: 'profiles',\r\n};\r\n\r\n// State\r\nlet state: TeamAnalysisState = { ...initialState };\r\n\r\n// Listeners\r\nconst listeners: Set<(state: TeamAnalysisState) => void> = new Set();\r\n\r\n/**\r\n * Notify all listeners\r\n */\r\nfunction notify(): void {\r\n    listeners.forEach(fn => fn(state));\r\n}\r\n\r\n/**\r\n * Get current state\r\n */\r\nexport function getState(): TeamAnalysisState {\r\n    return state;\r\n}\r\n\r\n/**\r\n * Subscribe to state changes\r\n */\r\nexport function subscribe(callback: (state: TeamAnalysisState) => void): () => void {\r\n    listeners.add(callback);\r\n    return () => listeners.delete(callback);\r\n}\r\n\r\n/**\r\n * Set loading state\r\n */\r\nexport function setLoading(loading: boolean): void {\r\n    state = { ...state, loading };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set analyzing state\r\n */\r\nexport function setAnalyzing(analyzing: boolean): void {\r\n    state = { ...state, analyzing };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set error\r\n */\r\nexport function setError(error: string | null): void {\r\n    state = { ...state, error };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set profiles\r\n */\r\nexport function setProfiles(profiles: BehavioralProfile[]): void {\r\n    state = { ...state, profiles };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set selected profile\r\n */\r\nexport function setSelectedProfile(profile: BehavioralProfile | null): void {\r\n    state = { ...state, selectedProfile: profile };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set team analysis\r\n */\r\nexport function setTeamAnalysis(analysis: TeamAnalysis | null): void {\r\n    state = { ...state, teamAnalysis: analysis };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set relationships\r\n */\r\nexport function setRelationships(relationships: BehavioralRelationship[]): void {\r\n    state = { ...state, relationships };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set graph data\r\n */\r\nexport function setGraphData(data: { nodes: GraphNode[]; edges: GraphEdge[] } | null): void {\r\n    state = { ...state, graphData: data };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Set current subtab\r\n */\r\nexport function setSubtab(subtab: 'profiles' | 'team' | 'graph'): void {\r\n    state = { ...state, currentSubtab: subtab };\r\n    notify();\r\n}\r\n\r\n/**\r\n * Load profiles from API\r\n */\r\nexport async function loadProfiles(): Promise<void> {\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        const response = await fetchWithProject('/api/team-analysis/profiles');\r\n        const data = await response.json();\r\n        \r\n        if (data.ok) {\r\n            setProfiles(data.profiles || []);\r\n        } else {\r\n            setError(data.error || 'Failed to load profiles');\r\n        }\r\n    } catch (error: any) {\r\n        setError(error.message || 'Failed to load profiles');\r\n    } finally {\r\n        setLoading(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Load a specific profile\r\n */\r\nexport async function loadProfile(personId: string): Promise<BehavioralProfile | null> {\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        const response = await fetchWithProject(`/api/team-analysis/profiles/${personId}`);\r\n        const data = await response.json();\r\n        \r\n        if (data.ok && data.profile) {\r\n            setSelectedProfile(data.profile);\r\n            return data.profile;\r\n        } else {\r\n            setError(data.error || 'Profile not found');\r\n            return null;\r\n        }\r\n    } catch (error: any) {\r\n        setError(error.message || 'Failed to load profile');\r\n        return null;\r\n    } finally {\r\n        setLoading(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Analyze a person's profile\r\n */\r\nexport async function analyzeProfile(personId: string, options: {\r\n    relationshipContext?: string;\r\n    objective?: string;\r\n    forceReanalysis?: boolean;\r\n} = {}): Promise<BehavioralProfile | null> {\r\n    setAnalyzing(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        const response = await fetchWithProject(`/api/team-analysis/profiles/${personId}/analyze`, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(options)\r\n        });\r\n        const data = await response.json();\r\n        \r\n        if (data.ok && data.profile) {\r\n            // Update profiles list\r\n            const updatedProfiles = state.profiles.map(p => \r\n                p.person_id === personId ? data.profile : p\r\n            );\r\n            if (!updatedProfiles.find(p => p.person_id === personId)) {\r\n                updatedProfiles.push(data.profile);\r\n            }\r\n            setProfiles(updatedProfiles);\r\n            setSelectedProfile(data.profile);\r\n            return data.profile;\r\n        } else {\r\n            setError(data.error || 'Failed to analyze profile');\r\n            return null;\r\n        }\r\n    } catch (error: any) {\r\n        setError(error.message || 'Failed to analyze profile');\r\n        return null;\r\n    } finally {\r\n        setAnalyzing(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Load team analysis\r\n */\r\nexport async function loadTeamAnalysis(): Promise<void> {\r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        console.log('[TeamAnalysisStore] Loading team analysis...');\r\n        const response = await fetchWithProject('/api/team-analysis/team');\r\n        const data = await response.json();\r\n        console.log('[TeamAnalysisStore] Team analysis response:', data);\r\n        \r\n        if (data.ok) {\r\n            console.log('[TeamAnalysisStore] Setting team analysis:', data.analysis);\r\n            setTeamAnalysis(data.analysis);\r\n        } else {\r\n            console.error('[TeamAnalysisStore] Error:', data.error);\r\n            setError(data.error || 'Failed to load team analysis');\r\n        }\r\n    } catch (error: any) {\r\n        console.error('[TeamAnalysisStore] Exception:', error);\r\n        setError(error.message || 'Failed to load team analysis');\r\n    } finally {\r\n        setLoading(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Analyze team dynamics\r\n */\r\nexport async function analyzeTeam(forceReanalysis: boolean = false): Promise<TeamAnalysis | null> {\r\n    setAnalyzing(true);\r\n    setError(null);\r\n    \r\n    try {\r\n        const response = await fetchWithProject('/api/team-analysis/team/analyze', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ forceReanalysis })\r\n        });\r\n        const data = await response.json();\r\n        \r\n        if (data.ok && data.analysis) {\r\n            setTeamAnalysis(data.analysis);\r\n            return data.analysis;\r\n        } else {\r\n            setError(data.error || 'Failed to analyze team');\r\n            return null;\r\n        }\r\n    } catch (error: any) {\r\n        setError(error.message || 'Failed to analyze team');\r\n        return null;\r\n    } finally {\r\n        setAnalyzing(false);\r\n    }\r\n}\r\n\r\n/**\r\n * Load relationships\r\n */\r\nexport async function loadRelationships(): Promise<void> {\r\n    try {\r\n        const response = await fetchWithProject('/api/team-analysis/relationships');\r\n        const data = await response.json();\r\n        \r\n        if (data.ok) {\r\n            setRelationships(data.relationships || []);\r\n        }\r\n    } catch (error) {\r\n        console.error('Failed to load relationships:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Load graph visualization data\r\n */\r\nexport async function loadGraphData(): Promise<void> {\r\n    try {\r\n        console.log('[TeamAnalysisStore] Loading graph data...');\r\n        const response = await fetchWithProject('/api/team-analysis/graph');\r\n        const data = await response.json();\r\n        console.log('[TeamAnalysisStore] Graph data response:', data);\r\n        \r\n        if (data.ok) {\r\n            console.log('[TeamAnalysisStore] Setting graph data:', data.nodes?.length, 'nodes,', data.edges?.length, 'edges');\r\n            setGraphData({ nodes: data.nodes || [], edges: data.edges || [] });\r\n        }\r\n    } catch (error) {\r\n        console.error('[TeamAnalysisStore] Failed to load graph data:', error);\r\n    }\r\n}\r\n\r\n/**\r\n * Load all data\r\n */\r\nexport async function loadAll(): Promise<void> {\r\n    await Promise.all([\r\n        loadProfiles(),\r\n        loadTeamAnalysis(),\r\n        loadRelationships(),\r\n        loadGraphData()\r\n    ]);\r\n}\r\n\r\n/**\r\n * Reset to initial state\r\n */\r\nexport function reset(): void {\r\n    state = { ...initialState };\r\n    notify();\r\n}\r\n\r\n// Export as namespace\r\nexport const teamAnalysisStore = {\r\n    getState,\r\n    subscribe,\r\n    setLoading,\r\n    setAnalyzing,\r\n    setError,\r\n    setProfiles,\r\n    setSelectedProfile,\r\n    setTeamAnalysis,\r\n    setRelationships,\r\n    setGraphData,\r\n    setSubtab,\r\n    loadProfiles,\r\n    loadProfile,\r\n    analyzeProfile,\r\n    loadTeamAnalysis,\r\n    analyzeTeam,\r\n    loadRelationships,\r\n    loadGraphData,\r\n    loadAll,\r\n    reset,\r\n};\r\n","/**\r\n * Legacy Bridge\r\n * Provides compatibility layer for legacy index.html code\r\n * \r\n * This module exposes the new modular services and stores as global\r\n * variables that match the original monolithic code's expectations.\r\n */\r\n\r\nimport { appStore, Project, User } from '../stores/app';\r\nimport { uiStore } from '../stores/ui';\r\nimport { dataStore, Question, Risk, Action, Decision, Contact } from '../stores/data';\r\nimport { chartsStore } from '../stores/charts';\r\nimport { http, api } from '../services/api';\r\nimport type { ChatMessage } from '../stores/data';\r\nimport type { MainTab } from '../stores/ui';\r\nimport { toast } from '../services/toast';\r\nimport { theme } from '../services/theme';\r\nimport { storage } from '../services/storage';\r\nimport { shortcuts } from '../services/shortcuts';\r\nimport { undoManager } from '../services/undo';\r\n\r\n// ============================================================================\r\n// Global Variable Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy global variable getters/setters\r\n * These provide compatibility with code that expects global variables\r\n */\r\n\r\n// Current project (was: currentProject)\r\nObject.defineProperty(window, 'currentProject', {\r\n  get: () => appStore.getState().currentProject,\r\n  set: (value: Project | null) => appStore.setCurrentProject(value),\r\n  configurable: true,\r\n});\r\n\r\n// Current project ID (was: currentProjectId)\r\nObject.defineProperty(window, 'currentProjectId', {\r\n  get: () => appStore.getState().currentProjectId,\r\n  set: (value: string | null) => appStore.setCurrentProjectId(value),\r\n  configurable: true,\r\n});\r\n\r\n// Current user (was: currentUser)\r\nObject.defineProperty(window, 'currentUser', {\r\n  get: () => appStore.getState().currentUser,\r\n  set: (value: User | null) => appStore.setCurrentUser(value),\r\n  configurable: true,\r\n});\r\n\r\n// Auth configured (was: authConfigured)\r\nObject.defineProperty(window, 'authConfigured', {\r\n  get: () => appStore.getState().authConfigured,\r\n  set: (value: boolean) => appStore.setAuthConfigured(value),\r\n  configurable: true,\r\n});\r\n\r\n// Current tab (was: currentTab)\r\nObject.defineProperty(window, 'currentTab', {\r\n  get: () => uiStore.getState().currentTab,\r\n  set: (value: MainTab) => uiStore.setTab(value),\r\n  configurable: true,\r\n});\r\n\r\n// Questions (was: questions)\r\nObject.defineProperty(window, 'questions', {\r\n  get: () => dataStore.getState().questions,\r\n  set: (value: Question[]) => dataStore.setQuestions(value),\r\n  configurable: true,\r\n});\r\n\r\n// Risks (was: risks)\r\nObject.defineProperty(window, 'risks', {\r\n  get: () => dataStore.getState().risks,\r\n  set: (value: Risk[]) => dataStore.setRisks(value),\r\n  configurable: true,\r\n});\r\n\r\n// Actions (was: actions)\r\nObject.defineProperty(window, 'actions', {\r\n  get: () => dataStore.getState().actions,\r\n  set: (value: Action[]) => dataStore.setActions(value),\r\n  configurable: true,\r\n});\r\n\r\n// Decisions (was: decisions)\r\nObject.defineProperty(window, 'decisions', {\r\n  get: () => dataStore.getState().decisions,\r\n  set: (value: Decision[]) => dataStore.setDecisions(value),\r\n  configurable: true,\r\n});\r\n\r\n// Contacts (was: contacts)\r\nObject.defineProperty(window, 'contacts', {\r\n  get: () => dataStore.getState().contacts,\r\n  set: (value: Contact[]) => dataStore.setContacts(value),\r\n  configurable: true,\r\n});\r\n\r\n// Chat history (was: chatHistory)\r\nObject.defineProperty(window, 'chatHistory', {\r\n  get: () => dataStore.getState().chatHistory,\r\n  set: (value: ChatMessage[]) => dataStore.setChatHistory(value),\r\n  configurable: true,\r\n});\r\n\r\n// ============================================================================\r\n// Legacy Function Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy API function\r\n * Maps to new http service\r\n */\r\n(window as unknown as Record<string, unknown>).api = async function legacyApi(\r\n  endpoint: string,\r\n  method = 'GET',\r\n  body?: unknown\r\n): Promise<unknown> {\r\n  try {\r\n    let response;\r\n    switch (method.toUpperCase()) {\r\n      case 'GET':\r\n        response = await http.get(endpoint);\r\n        break;\r\n      case 'POST':\r\n        response = await http.post(endpoint, body);\r\n        break;\r\n      case 'PUT':\r\n        response = await http.put(endpoint, body);\r\n        break;\r\n      case 'PATCH':\r\n        response = await http.patch(endpoint, body);\r\n        break;\r\n      case 'DELETE':\r\n        response = await http.delete(endpoint);\r\n        break;\r\n      default:\r\n        response = await api(endpoint, { method, body: body ? JSON.stringify(body) : undefined });\r\n    }\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error('API Error:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Legacy showToast function\r\n */\r\n(window as unknown as Record<string, unknown>).showToast = function legacyShowToast(\r\n  message: string,\r\n  type: 'success' | 'error' | 'warning' | 'info' = 'info'\r\n): void {\r\n  toast[type](message);\r\n};\r\n\r\n/**\r\n * Legacy setTheme function\r\n */\r\n(window as unknown as Record<string, unknown>).setTheme = function legacySetTheme(\r\n  newTheme: 'light' | 'dark' | 'system'\r\n): void {\r\n  theme.set(newTheme);\r\n};\r\n\r\n/**\r\n * Legacy toggleTheme function\r\n */\r\n(window as unknown as Record<string, unknown>).toggleTheme = function legacyToggleTheme(): void {\r\n  theme.toggle();\r\n};\r\n\r\n/**\r\n * Legacy localStorage wrappers\r\n */\r\n(window as unknown as Record<string, unknown>).getStorageItem = function legacyGetItem(\r\n  key: string,\r\n  defaultValue: unknown = null\r\n): unknown {\r\n  return storage.get(key, defaultValue);\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).setStorageItem = function legacySetItem(\r\n  key: string,\r\n  value: unknown\r\n): void {\r\n  storage.set(key, value);\r\n};\r\n\r\n/**\r\n * Legacy switchTab function\r\n */\r\n(window as unknown as Record<string, unknown>).switchTab = function legacySwitchTab(\r\n  tabName: MainTab\r\n): void {\r\n  uiStore.setTab(tabName);\r\n};\r\n\r\n/**\r\n * Legacy refreshData function\r\n */\r\n(window as unknown as Record<string, unknown>).refreshData = async function legacyRefreshData(): Promise<void> {\r\n  const projectId = appStore.getState().currentProjectId;\r\n  if (!projectId) return;\r\n\r\n  try {\r\n    const [questionsRes, risksRes, actionsRes, decisionsRes, contactsRes] = await Promise.all([\r\n      http.get<Question[]>(`/api/projects/${projectId}/questions`),\r\n      http.get<Risk[]>(`/api/projects/${projectId}/risks`),\r\n      http.get<Action[]>(`/api/projects/${projectId}/actions`),\r\n      http.get<Decision[]>(`/api/projects/${projectId}/decisions`),\r\n      http.get<Contact[]>(`/api/projects/${projectId}/contacts`),\r\n    ]);\r\n\r\n    dataStore.setQuestions(questionsRes.data);\r\n    dataStore.setRisks(risksRes.data);\r\n    dataStore.setActions(actionsRes.data);\r\n    dataStore.setDecisions(decisionsRes.data);\r\n    dataStore.setContacts(contactsRes.data);\r\n  } catch (error) {\r\n    console.error('Failed to refresh data:', error);\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// Chart Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy chart management\r\n */\r\n(window as unknown as Record<string, unknown>).registerChart = function(\r\n  id: string,\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  chart: any,\r\n  selector: string,\r\n  type: 'bar' | 'line' | 'pie' | 'doughnut' | 'radar' = 'bar'\r\n): void {\r\n  chartsStore.registerChart(id, chart, selector, type);\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).destroyChart = function(id: string): void {\r\n  chartsStore.destroyChart(id);\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).getChart = function(id: string): unknown {\r\n  return chartsStore.getChart(id);\r\n};\r\n\r\n// ============================================================================\r\n// Keyboard Shortcuts Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy keyboard shortcut registration\r\n */\r\n(window as unknown as Record<string, unknown>).registerShortcut = function(\r\n  key: string,\r\n  callback: () => void,\r\n  options: { ctrl?: boolean; shift?: boolean; alt?: boolean; description?: string } = {}\r\n): void {\r\n  shortcuts.register({\r\n    key,\r\n    ctrl: options.ctrl,\r\n    shift: options.shift,\r\n    alt: options.alt,\r\n    handler: callback,\r\n    description: options.description || 'Custom shortcut',\r\n  });\r\n};\r\n\r\n// ============================================================================\r\n// Undo/Redo Compatibility\r\n// ============================================================================\r\n\r\n/**\r\n * Legacy undo/redo\r\n */\r\n(window as unknown as Record<string, unknown>).pushUndoAction = function(\r\n  description: string,\r\n  undo: () => void | Promise<void>,\r\n  redo: () => void | Promise<void>\r\n): void {\r\n  undoManager.push({\r\n    id: `undo-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\r\n    description,\r\n    undo,\r\n    redo,\r\n  });\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).undoLastAction = function(): Promise<boolean> {\r\n  return undoManager.undo();\r\n};\r\n\r\n(window as unknown as Record<string, unknown>).redoLastAction = function(): Promise<boolean> {\r\n  return undoManager.redo();\r\n};\r\n\r\n// ============================================================================\r\n// Export for direct imports\r\n// ============================================================================\r\n\r\nexport function initLegacyBridge(): void {\r\n  console.log('[GodMode] Legacy bridge initialized');\r\n  \r\n  // Initialize app store listeners\r\n  appStore.init();\r\n  \r\n  // Log compatibility mode\r\n  if (process.env.NODE_ENV === 'development') {\r\n    console.log('[GodMode] Running in compatibility mode for legacy code');\r\n  }\r\n}\r\n\r\nexport default initLegacyBridge;\r\n","/**\n * GodMode Frontend - Main Entry Point\n * \n * This file initializes the application and loads all necessary modules.\n * Currently in transition phase - gradually migrating from monolithic\n * index.html to modular TypeScript structure.\n */\n\n// Import styles\nimport './styles/main.css';\nimport './styles/graph.css';\n\n// Import services\nimport {\n  theme, toast, shortcuts, undoManager, storage, http, api, configureApi, auth, projects,\n  addRequestInterceptor, setProjectIdGetter,\n  dashboardService, questionsService, risksService, actionsService, decisionsService,\n  chatService, contactsService, teamsService, documentsService, knowledgeService,\n  emailsService, graphService, timelineService, costsService, notificationsService,\n  commentsService, membersService, profileService, userSettingsService, projectSettingsService,\n  apiKeysService, webhooksService, auditService, factsService\n} from './services';\n\n// Import components\nimport { initGlobalSearch, initNotificationsDropdown } from './components';\nimport * as components from './components';\nimport { createQuestionDetailView } from './components/questions/QuestionDetailView';\nimport { createQuestionsPanel, createFactsPanel, createDecisionsPanel, createRisksPanel, createActionsPanel } from './components/sot';\n\n// Import stores\nimport { appStore, uiStore, dataStore, chartsStore, teamAnalysisStore } from './stores';\nimport type { Question } from './stores/data';\n\n// Import legacy bridge for backwards compatibility\nimport { initLegacyBridge } from './utils/legacy-bridge';\n\n// Make services and stores available globally for gradual migration\ndeclare global {\n  interface Window {\n    godmode: {\n      // Core Services\n      theme: typeof theme;\n      toast: typeof toast;\n      shortcuts: typeof shortcuts;\n      undo: typeof undoManager;\n      storage: typeof storage;\n      http: typeof http;\n      api: typeof api;\n      configureApi: typeof configureApi;\n      auth: typeof auth;\n      projects: typeof projects;\n      // Domain Services\n      dashboard: typeof dashboardService;\n      questions: typeof questionsService;\n      risks: typeof risksService;\n      actions: typeof actionsService;\n      decisions: typeof decisionsService;\n      chat: typeof chatService;\n      contacts: typeof contactsService;\n      teams: typeof teamsService;\n      documents: typeof documentsService;\n      knowledge: typeof knowledgeService;\n      emails: typeof emailsService;\n      graph: typeof graphService;\n      timeline: typeof timelineService;\n      costs: typeof costsService;\n      notifications: typeof notificationsService;\n      comments: typeof commentsService;\n      members: typeof membersService;\n      profile: typeof profileService;\n      userSettings: typeof userSettingsService;\n      projectSettings: typeof projectSettingsService;\n      apiKeys: typeof apiKeysService;\n      webhooks: typeof webhooksService;\n      audit: typeof auditService;\n      facts: typeof factsService;\n      // Stores\n      appStore: typeof appStore;\n      uiStore: typeof uiStore;\n      dataStore: typeof dataStore;\n      chartsStore: typeof chartsStore;\n      // Version\n      version: string;\n    };\n  }\n}\n\nwindow.godmode = {\n  // Core Services\n  theme,\n  toast,\n  shortcuts,\n  undo: undoManager,\n  storage,\n  http,\n  api,\n  configureApi,\n  auth,\n  projects,\n  // Domain Services\n  dashboard: dashboardService,\n  questions: questionsService,\n  risks: risksService,\n  actions: actionsService,\n  decisions: decisionsService,\n  chat: chatService,\n  contacts: contactsService,\n  teams: teamsService,\n  documents: documentsService,\n  knowledge: knowledgeService,\n  emails: emailsService,\n  graph: graphService,\n  timeline: timelineService,\n  costs: costsService,\n  notifications: notificationsService,\n  comments: commentsService,\n  members: membersService,\n  profile: profileService,\n  userSettings: userSettingsService,\n  projectSettings: projectSettingsService,\n  apiKeys: apiKeysService,\n  webhooks: webhooksService,\n  audit: auditService,\n  facts: factsService,\n  // Stores\n  appStore,\n  uiStore,\n  dataStore,\n  chartsStore,\n  // Version\n  version: '2.0.0',\n};\n\n// Ensure API requests include current project ID for project-scoped endpoints\nsetProjectIdGetter(() => appStore.getState().currentProjectId);\naddRequestInterceptor((opts) => {\n  const projectId = appStore.getState().currentProjectId;\n  if (projectId && opts.headers) {\n    (opts.headers as Record<string, string>)['X-Project-Id'] = projectId;\n  }\n  return opts;\n});\n\n/**\n * Register default keyboard shortcuts\n */\nfunction registerShortcuts(): void {\n  // Undo: Ctrl+Z\n  shortcuts.register({\n    key: 'z',\n    ctrl: true,\n    description: 'Undo last action',\n    handler: async () => {\n      if (undoManager.canUndo()) {\n        await undoManager.undo();\n        toast.info('Undo: ' + (undoManager.getRedoDescription() || 'Action undone'));\n      }\n    },\n  });\n\n  // Redo: Ctrl+Shift+Z or Ctrl+Y\n  shortcuts.register({\n    key: 'z',\n    ctrl: true,\n    shift: true,\n    description: 'Redo last action',\n    handler: async () => {\n      if (undoManager.canRedo()) {\n        await undoManager.redo();\n        toast.info('Redo: ' + (undoManager.getUndoDescription() || 'Action redone'));\n      }\n    },\n  });\n\n  // Theme toggle: Ctrl+Shift+T\n  shortcuts.register({\n    key: 't',\n    ctrl: true,\n    shift: true,\n    description: 'Cycle theme (light/dark/system)',\n    handler: () => {\n      const newMode = theme.cycle();\n      toast.info(`Theme: ${theme.getLabel()}`);\n    },\n  });\n\n  // Help: ?\n  shortcuts.register({\n    key: '?',\n    description: 'Show keyboard shortcuts',\n    handler: () => {\n      shortcuts.showHelp();\n    },\n  });\n}\n\n/**\n * Configure API client\n */\nfunction configureApiClient(): void {\n  // Setup 401 handler for auth redirect\n  configureApi({\n    onUnauthorized: () => {\n      appStore.setCurrentUser(null);\n      toast.error('Session expired. Please log in again.');\n      // Trigger auth modal via event\n      window.dispatchEvent(new CustomEvent('godmode:auth-required'));\n    },\n    onForbidden: () => {\n      toast.error('You do not have permission to perform this action.');\n    },\n  });\n}\n\n/**\n * Initialize UI event handlers\n */\nfunction initializeUI(): void {\n  // Theme toggle button\n  const themeToggle = document.getElementById('theme-toggle');\n  if (themeToggle) {\n    themeToggle.addEventListener('click', () => {\n      theme.cycle();\n      updateThemeButton();\n      toast.info(`Theme: ${theme.getLabel()}`);\n    });\n    updateThemeButton();\n  }\n\n  // User menu dropdown\n  const userAvatar = document.getElementById('user-avatar');\n  const userDropdown = document.getElementById('user-dropdown');\n  if (userAvatar && userDropdown) {\n    userAvatar.addEventListener('click', (e) => {\n      e.stopPropagation();\n      userDropdown.classList.toggle('hidden');\n    });\n    document.addEventListener('click', () => {\n      userDropdown.classList.add('hidden');\n    });\n  }\n\n  // Login button\n  const loginBtn = document.getElementById('login-btn');\n  if (loginBtn) {\n    loginBtn.addEventListener('click', () => {\n      components.showAuthModal({\n        onSuccess: () => {\n          updateAuthUI();\n          refreshData();\n        }\n      });\n    });\n  }\n\n  // Logout button\n  const logoutBtn = document.getElementById('logout-btn');\n  if (logoutBtn) {\n    logoutBtn.addEventListener('click', async () => {\n      await auth.logout();\n\n      // Clear all project-scoped data and project list\n      clearProjectScopedState();\n      dataStore.setProjects([]);\n      appStore.setCurrentProject(null);\n      appStore.setCurrentProjectId(null);\n      \n      // Update UI\n      updateAuthUI();\n      updateDashboard();\n      \n      // Redirect to landing page if auth is configured\n      if (appStore.getState().authConfigured) {\n        toast.info('Signed out successfully');\n        window.location.href = '/';\n      } else {\n        toast.info('Signed out');\n      }\n    });\n  }\n\n  // Settings button  open Settings tab (content area), never modal\n  const settingsBtn = document.getElementById('settings-btn');\n  if (settingsBtn) {\n    settingsBtn.addEventListener('click', () => {\n      switchTab('settings');\n    });\n  }\n\n  // Shortcuts button\n  const shortcutsBtn = document.getElementById('shortcuts-btn');\n  if (shortcutsBtn) {\n    shortcutsBtn.addEventListener('click', () => {\n      components.showShortcutsModal();\n    });\n  }\n\n  // Dev tools button\n  const devToolsBtn = document.getElementById('dev-tools-btn');\n  if (devToolsBtn) {\n    devToolsBtn.addEventListener('click', () => {\n      components.showDeveloperModal();\n    });\n  }\n\n  // Profile button  open Profile tab (direct view, no modal)\n  const profileBtn = document.getElementById('profile-btn');\n  if (profileBtn) {\n    profileBtn.addEventListener('click', () => {\n      userDropdown?.classList.add('hidden');\n      switchTab('profile');\n    });\n  }\n\n  // Initialize notifications dropdown in header\n  const notificationsContainer = document.getElementById('notifications-container');\n  if (notificationsContainer) {\n    initNotificationsDropdown(notificationsContainer, {\n      onNotificationClick: (notification) => {\n        console.log('Notification clicked:', notification);\n        // Navigate based on notification type\n        if (notification.entity_type && notification.entity_id) {\n          window.dispatchEvent(new CustomEvent('godmode:navigate', { \n            detail: { type: notification.entity_type, id: notification.entity_id }\n          }));\n        }\n      }\n    });\n  }\n\n  // Sidebar navigation\n  const navItems = document.querySelectorAll('.nav-item[data-tab]');\n  navItems.forEach(item => {\n    item.addEventListener('click', () => {\n      const tab = item.getAttribute('data-tab');\n      if (tab) {\n        switchTab(tab);\n      }\n    });\n  });\n\n  // SOT tabs\n  const sotTabs = document.querySelectorAll('.sot-tab');\n  sotTabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n      const view = tab.getAttribute('data-view');\n      if (view) {\n        sotTabs.forEach(t => t.classList.remove('active'));\n        tab.classList.add('active');\n        uiStore.setSotView(view as 'questions' | 'facts' | 'risks' | 'actions' | 'decisions');\n        loadSotContent(view);\n      }\n    });\n  });\n\n  // Mobile menu toggle\n  const menuToggle = document.getElementById('menu-toggle');\n  const sidebar = document.getElementById('app-sidebar');\n  if (menuToggle && sidebar) {\n    menuToggle.addEventListener('click', () => {\n      sidebar.classList.toggle('open');\n    });\n  }\n\n  // Chat panel is mounted in initializePanels\n\n  // New contact button\n  const newContactBtn = document.getElementById('new-contact-btn');\n  if (newContactBtn) {\n    newContactBtn.addEventListener('click', () => {\n      components.showContactModal({ mode: 'create' });\n    });\n  }\n\n  // Upload buttons\n  const uploadBtns = document.querySelectorAll('#new-upload-btn, #upload-files-btn');\n  uploadBtns.forEach(btn => {\n    btn.addEventListener('click', () => {\n      components.showFileUploadModal();\n    });\n  });\n\n  // Initialize sidebar action buttons\n  initializeSidebarActions();\n\n  // Project selector\n  const projectSelector = document.getElementById('project-selector') as HTMLSelectElement;\n  const newProjectBtn = document.getElementById('new-project-btn');\n  const editProjectBtn = document.getElementById('edit-project-btn');\n  \n  if (projectSelector) {\n    projectSelector.addEventListener('change', async () => {\n      const projectId = projectSelector.value;\n      console.log(' Project selector changed, value:', projectId);\n      \n      if (projectId) {\n        await selectProject(projectId);\n        if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n      } else {\n        console.log(' Clearing project - starting...');\n\n        // No project selected - clear everything IMMEDIATELY\n        if (editProjectBtn) editProjectBtn.classList.add('hidden');\n\n        // Clear current project in store\n        appStore.setCurrentProject(null);\n        appStore.setCurrentProjectId(null);\n        console.log(' Store cleared');\n\n        // Clear all project-scoped data (no reference to previous project)\n        clearProjectScopedState();\n        console.log(' Data store cleared');\n        \n        // IMMEDIATELY show empty state (no async import needed)\n        console.log(' Calling showNoProjectState...');\n        showNoProjectState();\n        console.log(' showNoProjectState called');\n        \n        // Switch to Dashboard tab so user sees the empty state\n        switchTab('dashboard');\n        \n        loadSotContent(uiStore.getState().sotCurrentView);\n        \n        // Also deactivate on server side (fire and forget)\n        http.post('/api/projects/deactivate').catch(() => {});\n        \n        console.log(' Project deselected - ALL DONE');\n      }\n    });\n    loadProjects();\n  }\n\n  // New project button  open Projects tab and show create form inline\n  if (newProjectBtn) {\n    newProjectBtn.addEventListener('click', () => {\n      (window as unknown as { __godmodeProjectsOpen?: string })['__godmodeProjectsOpen'] = 'create';\n      switchTab('projects');\n    });\n  }\n\n  // Edit project button  open Projects tab and show edit form inline\n  if (editProjectBtn) {\n    editProjectBtn.addEventListener('click', () => {\n      const currentProject = appStore.getState().currentProject;\n      if (currentProject) {\n        (window as unknown as { __godmodeProjectsOpen?: string })['__godmodeProjectsOpen'] = 'edit:' + currentProject.id;\n        switchTab('projects');\n      }\n    });\n  }\n\n  // Contacts subtabs\n  const contactsSubtabs = document.querySelectorAll('#contacts-subtabs .subtab');\n  contactsSubtabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n      contactsSubtabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      const subtab = tab.getAttribute('data-subtab');\n      document.querySelectorAll('[id^=\"contacts-subtab-\"]').forEach(content => {\n        content.classList.toggle('hidden', content.id !== `contacts-subtab-${subtab}`);\n      });\n    });\n  });\n\n  // Refresh dashboard button\n  const refreshDashboardBtn = document.getElementById('refresh-dashboard-btn');\n  if (refreshDashboardBtn) {\n    refreshDashboardBtn.addEventListener('click', () => {\n      initializePanels();\n      toast.info('Dashboard refreshed');\n    });\n  }\n\n  // Mount panels on tab switch\n  initializePanels();\n  \n  // Initialize drop zones\n  initializeDropZones();\n}\n\n/**\n * Show \"No Project Selected\" state immediately (sync, no imports)\n */\nfunction showNoProjectState(): void {\n  console.log(' showNoProjectState() called');\n  const dashboardContainer = document.getElementById('dashboard-container');\n  console.log(' dashboardContainer:', dashboardContainer ? 'FOUND' : 'NOT FOUND');\n  if (!dashboardContainer) return;\n  \n  console.log(' Setting innerHTML NOW...');\n  \n  dashboardContainer.innerHTML = `\n    <div class=\"dashboard gm-p-5\">\n      <div class=\"no-project-state gm-empty-state\">\n        <svg class=\"gm-empty-state-icon\" width=\"96\" height=\"96\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n        </svg>\n        <h2 class=\"gm-empty-state-title\">No Project Selected</h2>\n        <p class=\"gm-empty-state-desc\">\n          Select a project from the dropdown above, or create a new one to get started with your data management.\n        </p>\n        <button id=\"create-project-empty-cta\" class=\"btn btn-primary gm-empty-state-cta\">\n          <svg width=\"20\" height=\"20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create New Project\n        </button>\n      </div>\n    </div>\n  `;\n  \n  console.log(' innerHTML SET! Container visible:', dashboardContainer.offsetParent !== null);\n  console.log(' Container display:', window.getComputedStyle(dashboardContainer).display);\n  \n  // Bind create project button  open Projects tab with create form inline\n  const createBtn = document.getElementById('create-project-empty-cta');\n  if (createBtn) {\n    createBtn.addEventListener('click', () => {\n      (window as unknown as { __godmodeProjectsOpen?: string })['__godmodeProjectsOpen'] = 'create';\n      switchTab('projects');\n    });\n  }\n}\n\n/**\n * Refresh/recreate the dashboard\n */\nasync function refreshDashboardPanel(): Promise<void> {\n  const dashboardContainer = document.getElementById('dashboard-container');\n  if (!dashboardContainer) return;\n  \n  // Check if project is selected - if not, show empty state immediately\n  const currentProject = appStore.getState().currentProject;\n  const currentProjectId = appStore.getState().currentProjectId;\n  \n  if (!currentProject && !currentProjectId) {\n    showNoProjectState();\n    return;\n  }\n  \n  // Clear and recreate with loading state\n  dashboardContainer.innerHTML = '<div class=\"gm-loading-placeholder\">Loading dashboard...</div>';\n  \n  try {\n    const { createDashboard } = await import('./components/Dashboard');\n    dashboardContainer.innerHTML = '';\n    const dashboard = createDashboard({\n      onStatClick: (statId) => {\n        console.log('Stat clicked:', statId);\n        // Navigate to appropriate view\n        if (statId === 'questions') switchTab('sot');\n        else if (statId === 'facts') {\n          switchTab('sot');\n          uiStore.setSotView('facts');\n          document.querySelectorAll('.sot-tab').forEach(t => {\n            t.classList.toggle('active', t.getAttribute('data-view') === 'facts');\n          });\n          loadSotContent('facts');\n        }\n        else if (statId === 'risks') { switchTab('sot'); uiStore.setSotView('risks'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'risks'); }); loadSotContent('risks'); }\n        else if (statId === 'actions') { switchTab('sot'); uiStore.setSotView('actions'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'actions'); }); loadSotContent('actions'); }\n        else if (statId === 'decisions') { switchTab('sot'); uiStore.setSotView('decisions'); document.querySelectorAll('.sot-tab').forEach(t => { t.classList.toggle('active', t.getAttribute('data-view') === 'decisions'); }); loadSotContent('decisions'); }\n        else if (statId === 'contacts') switchTab('contacts');\n      }\n    });\n    dashboardContainer.appendChild(dashboard);\n  } catch (err) {\n    console.error('Failed to load Dashboard:', err);\n    dashboardContainer.innerHTML = '<div class=\"gm-error-placeholder\">Failed to load dashboard</div>';\n  }\n}\n\n/**\n * Initialize and mount panels\n */\nfunction initializePanels(): void {\n  // Dashboard - Main dashboard with all widgets\n  refreshDashboardPanel();\n\n  // Chat panel (sessions, contact pills, RAG)\n  const chatContainer = document.getElementById('chat-panel-container');\n  if (chatContainer && chatContainer.children.length === 0) {\n    import('./components/Chat').then(({ createChat }) => {\n      const panel = createChat({ showSources: true, showSessions: true });\n      chatContainer.appendChild(panel);\n    }).catch((err) => {\n      console.error('[Chat] Failed to load Chat:', err);\n      chatContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-secondary\">Failed to load chat</div>';\n    });\n  }\n\n  // EmailsPanel\n  const emailsContainer = document.getElementById('emails-panel-container');\n  if (emailsContainer && emailsContainer.children.length === 0) {\n    import('./components/EmailsPanel').then(({ createEmailsPanel }) => {\n      const panel = createEmailsPanel();\n      emailsContainer.appendChild(panel);\n    });\n  }\n\n  // ContactsPanel\n  const contactsContainer = document.getElementById('contacts-panel-container');\n  if (contactsContainer && contactsContainer.querySelectorAll('.contacts-panel-sota').length === 0) {\n    import('./components/ContactsPanel').then(({ createContactsPanel }) => {\n      contactsContainer.innerHTML = ''; // Clear comments and whitespace\n      const panel = createContactsPanel();\n      contactsContainer.appendChild(panel);\n    });\n  }\n\n  // TeamsPanel\n  const teamsContainer = document.getElementById('teams-panel-container');\n  if (teamsContainer && teamsContainer.children.length === 0) {\n    import('./components/TeamsPanel').then(({ createTeamsPanel }) => {\n      const panel = createTeamsPanel();\n      teamsContainer.appendChild(panel);\n    });\n  }\n\n  // RolesPanel\n  const rolesContainer = document.getElementById('roles-panel-container');\n  if (rolesContainer && rolesContainer.children.length === 0) {\n    import('./components/RolesPanel').then(({ renderRolesPanel }) => {\n      renderRolesPanel(rolesContainer);\n    });\n  }\n\n  // FilesPanel (DocumentsPanel)\n  const filesContainer = document.getElementById('files-panel-container');\n  if (filesContainer && filesContainer.querySelectorAll('.documents-panel-minimal').length === 0) {\n    filesContainer.innerHTML = ''; // Clear comments and whitespace\n    import('./components/DocumentsPanel').then(({ default: createDocumentsPanel }) => {\n      const panel = createDocumentsPanel({\n        onDocumentClick: async (doc) => {\n          // Open document preview modal\n          const { showDocumentPreviewModal } = await import('./components/modals/DocumentPreviewModal');\n          showDocumentPreviewModal({ document: doc });\n        }\n      });\n      filesContainer.appendChild(panel);\n    }).catch(err => {\n      console.error('[FilesPanel] Failed to load DocumentsPanel:', err);\n      filesContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-secondary\">Failed to load files panel</div>';\n    });\n  }\n\n  // OrgChart\n  const orgChartContainer = document.getElementById('org-chart-container');\n  if (orgChartContainer && orgChartContainer.children.length === 0) {\n    import('./components/OrgChart').then(({ createOrgChart }) => {\n      const panel = createOrgChart();\n      orgChartContainer.appendChild(panel);\n    });\n  }\n\n  // CostsDashboard (mount if no element children; container may have comment nodes)\n  const costsContainer = document.getElementById('costs-container');\n  if (costsContainer && costsContainer.children.length === 0) {\n    import('./components/CostsDashboard').then(({ createCostsDashboard }) => {\n      const panel = createCostsDashboard();\n      costsContainer.appendChild(panel);\n    });\n  }\n\n  // HistoryPanel\n  const historyContainer = document.getElementById('history-container');\n  if (historyContainer && historyContainer.children.length === 0) {\n    import('./components/HistoryPanel').then(({ createHistoryPanel, exportHistory }) => {\n      const panel = createHistoryPanel({\n        onRestore: (entry) => {\n          toast.info(`Restoring ${entry.entityType} \"${entry.entityName || entry.entityId}\"`);\n          // Trigger restore via API\n        }\n      });\n      historyContainer.appendChild(panel);\n\n      // Bind export button\n      const exportBtn = document.getElementById('export-history-btn');\n      if (exportBtn) {\n        exportBtn.addEventListener('click', () => exportHistory('json'));\n      }\n    });\n  }\n}\n\n/**\n * Initialize sidebar drop zones\n */\nfunction initializeDropZones(): void {\n  const dropzones = document.querySelectorAll('.dropzone-card[data-type]');\n  console.log('[DropZones] Found', dropzones.length, 'dropzones');\n  \n  dropzones.forEach(zone => {\n    const type = zone.getAttribute('data-type');\n    console.log('[DropZones] Adding click handler for:', type);\n    \n    // Click handler - open appropriate modal or file picker\n    zone.addEventListener('click', async (e) => {\n      console.log('[DropZones] Click on:', type);\n      e.preventDefault();\n      e.stopPropagation();\n      \n      try {\n        switch (type) {\n          case 'emails':\n            // Open EmailComposer modal\n            console.log('[DropZones] Opening EmailComposer...');\n            const { showEmailComposer } = await import('./components/EmailComposer');\n            showEmailComposer({\n              onSave: () => {\n                toast.success('Email imported');\n              }\n            });\n            return;\n            \n          case 'conversations':\n            // Open ConversationComposer modal\n            console.log('[DropZones] Opening ConversationComposer...');\n            const { showConversationComposer } = await import('./components/ConversationComposer');\n            showConversationComposer({\n              onImport: () => {\n                toast.success('Conversation imported');\n              }\n            });\n            return;\n            \n          case 'transcripts':\n            // Open TranscriptComposer modal\n            console.log('[DropZones] Opening TranscriptComposer...');\n            const { showTranscriptComposer } = await import('./components/TranscriptComposer');\n            showTranscriptComposer({\n              onImport: () => {\n                toast.success('Transcript imported');\n              }\n            });\n            return;\n            \n          case 'documents':\n          default:\n            // Open file picker for documents\n            console.log('[DropZones] Opening file picker for documents...');\n            const input = document.createElement('input');\n            input.type = 'file';\n            input.multiple = true;\n            input.accept = '.pdf,.doc,.docx,.txt,.md,.rtf,.odt,.xls,.xlsx,.ppt,.pptx,.csv,.json';\n            \n            input.onchange = () => {\n              if (input.files && input.files.length > 0) {\n                handleDroppedFiles(Array.from(input.files), 'documents');\n              }\n            };\n            \n            input.click();\n            return;\n        }\n      } catch (err) {\n        console.error('[DropZones] Error:', err);\n        toast.error('Failed to open import dialog');\n      }\n    });\n    \n    // Drag and drop handlers\n    zone.addEventListener('dragover', (e) => {\n      e.preventDefault();\n      zone.classList.add('drag-over');\n    });\n    \n    zone.addEventListener('dragleave', () => {\n      zone.classList.remove('drag-over');\n    });\n    \n    zone.addEventListener('drop', (e) => {\n      e.preventDefault();\n      zone.classList.remove('drag-over');\n      \n      const dataTransfer = (e as DragEvent).dataTransfer;\n      if (dataTransfer?.files && dataTransfer.files.length > 0) {\n        handleDroppedFiles(Array.from(dataTransfer.files), type || 'documents');\n      }\n    });\n  });\n}\n\n/**\n * Handle dropped or selected files\n */\nasync function handleDroppedFiles(files: File[], type: string): Promise<void> {\n  // Add files to pending list\n  addPendingFiles(files);\n  \n  const fileNames = files.map(f => f.name).join(', ');\n  toast.info(`Added ${files.length} ${type} to queue: ${fileNames.substring(0, 50)}${fileNames.length > 50 ? '...' : ''}`);\n}\n\n/**\n * Update theme button icon\n */\nfunction updateThemeButton(): void {\n  const themeToggle = document.getElementById('theme-toggle');\n  if (themeToggle) {\n    themeToggle.textContent = theme.getIcon();\n    themeToggle.title = `Theme: ${theme.getLabel()}`;\n  }\n}\n\n// ==================== CLIENT-SIDE ROUTING ====================\n\n/** Valid tab names for routing */\nconst VALID_TABS = ['dashboard', 'chat', 'sot', 'timeline', 'contacts', 'team-analysis', 'files', 'graph', 'emails', 'costs', 'history', 'roles', 'profile', 'settings', 'admin', 'org', 'projects'];\n\n/**\n * Get current tab from URL pathname\n */\nfunction getTabFromUrl(): string {\n  const pathname = window.location.pathname;\n  // Match /app/tabname or /app/tabname/\n  const match = pathname.match(/^\\/app\\/([^/]+)/);\n  if (match && VALID_TABS.includes(match[1])) {\n    return match[1];\n  }\n  // Default to dashboard for /app or /app/\n  return 'dashboard';\n}\n\n/**\n * Update browser URL for current tab (without page reload)\n */\nfunction updateUrlForTab(tabName: string, replace = false): void {\n  const newPath = tabName === 'dashboard' ? '/app' : `/app/${tabName}`;\n  const currentPath = window.location.pathname;\n  \n  // Only update if path is different\n  if (currentPath !== newPath) {\n    if (replace) {\n      window.history.replaceState({ tab: tabName }, '', newPath);\n    } else {\n      window.history.pushState({ tab: tabName }, '', newPath);\n    }\n  }\n}\n\n/**\n * Initialize URL-based routing\n */\nfunction initRouting(): void {\n  // Handle browser back/forward buttons\n  window.addEventListener('popstate', (event) => {\n    const tab = event.state?.tab || getTabFromUrl();\n    switchTab(tab, false); // false = don't update URL again\n  });\n  \n  // On initial load, read tab from URL\n  const initialTab = getTabFromUrl();\n  if (initialTab !== 'dashboard') {\n    // If URL has a specific tab, switch to it (will happen after UI init)\n    setTimeout(() => switchTab(initialTab, true), 0); // true = replace URL state\n  }\n}\n\n/**\n * Switch to a tab\n * @param tabName - The tab to switch to\n * @param updateUrl - Whether to update the browser URL (default: true)\n */\nfunction switchTab(tabName: string, updateUrl = true): void {\n  // Update sidebar nav items\n  document.querySelectorAll('.nav-item[data-tab]').forEach(item => {\n    item.classList.toggle('active', item.getAttribute('data-tab') === tabName);\n  });\n\n  // Update tab content\n  document.querySelectorAll('.tab-content').forEach(tab => {\n    tab.classList.toggle('active', tab.id === `tab-${tabName}`);\n    tab.classList.toggle('hidden', tab.id !== `tab-${tabName}`);\n  });\n\n  // Close mobile sidebar\n  const sidebar = document.getElementById('app-sidebar');\n  if (sidebar) {\n    sidebar.classList.remove('open');\n  }\n  \n  // Update browser URL (client-side routing)\n  if (updateUrl) {\n    updateUrlForTab(tabName);\n  }\n\n  // Update store\n  uiStore.setTab(tabName as 'dashboard' | 'chat' | 'sot' | 'timeline' | 'contacts' | 'team-analysis' | 'files' | 'graph' | 'emails' | 'costs' | 'history' | 'roles' | 'profile' | 'settings' | 'admin' | 'org' | 'projects');\n  \n  // Load profile page when switching to profile tab (direct view, no modal)\n  if (tabName === 'profile') {\n    const profileContainer = document.getElementById('profile-page-container');\n    if (profileContainer) {\n      import('./components/modals/ProfileModal').then(({ initProfilePage }) => {\n        initProfilePage(profileContainer, {\n          onBack: () => switchTab('dashboard'),\n        });\n      });\n    }\n  }\n\n  // Load projects page when switching to projects tab (list + inline form, no modal)\n  if (tabName === 'projects') {\n    const projectsContainer = document.getElementById('projects-page-container');\n    if (projectsContainer) {\n      import('./components/ProjectsPage').then(({ initProjectsPage }) => {\n        initProjectsPage(projectsContainer, {\n          onBack: () => switchTab('dashboard'),\n        });\n      });\n    }\n  }\n\n  // Load settings page when switching to settings tab\n  if (tabName === 'settings') {\n    const settingsContainer = document.getElementById('settings-page-container');\n    if (settingsContainer) {\n      import('./components/SettingsPage').then(({ initSettingsPage }) => {\n        initSettingsPage(settingsContainer, {\n          onBack: () => switchTab('dashboard'),\n        });\n      });\n    }\n  }\n\n  // Load admin panel when switching to admin tab\n  if (tabName === 'admin') {\n    const adminContainer = document.getElementById('tab-admin');\n    if (adminContainer) {\n      import('./components/AdminPanel').then(({ initAdminPanel }) => {\n        initAdminPanel(adminContainer);\n      });\n    }\n  }\n  \n  // Load Graph Explorer when switching to graph tab\n  if (tabName === 'graph') {\n    const graphContainer = document.getElementById('graph-container');\n    // Check for actual element children, not just comments or text nodes\n    const hasContent = graphContainer?.querySelector('.graph-explorer');\n    if (graphContainer && !hasContent) {\n      console.log('[Graph] Loading GraphExplorer...');\n      import('./components/graph/GraphExplorer').then(({ createGraphExplorer }) => {\n        graphContainer.innerHTML = ''; // Clear any placeholder\n        const explorer = createGraphExplorer({\n          onNodeSelect: (node) => {\n            console.log('Graph node selected:', node);\n          },\n          onQueryExecute: (cypher) => {\n            console.log('Query executed:', cypher);\n          },\n        });\n        graphContainer.appendChild(explorer);\n        console.log('[Graph] GraphExplorer loaded successfully');\n      }).catch(err => {\n        console.error('[Graph] Failed to load GraphExplorer:', err);\n        graphContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-center\">Failed to load Graph Explorer</div>';\n      });\n    }\n  }\n\n  // Load Timeline Panel when switching to timeline tab\n  if (tabName === 'timeline') {\n    const timelineContainer = document.getElementById('timeline-content');\n    const hasContent = timelineContainer?.querySelector('.timeline-panel');\n    if (timelineContainer && !hasContent) {\n      console.log('[Timeline] Loading TimelinePanel...');\n      import('./components/TimelinePanel').then(({ createTimelinePanel }) => {\n        timelineContainer.innerHTML = ''; // Clear any placeholder\n        const panel = createTimelinePanel({\n          onEventClick: (event) => {\n            console.log('Timeline event clicked:', event);\n            // Navigate to entity if possible\n            if (event.entity_type && event.entity_id) {\n              const entityType = event.entity_type;\n              if (entityType === 'question') {\n                import('./components/questions/QuestionDetailView').then(({ createQuestionDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createQuestionDetailView({\n                      questionId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else if (entityType === 'decision') {\n                import('./components/decisions/DecisionDetailView').then(({ createDecisionDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createDecisionDetailView({\n                      decisionId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else if (entityType === 'fact') {\n                import('./components/facts/FactDetailView').then(({ createFactDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createFactDetailView({\n                      factId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else if (entityType === 'risk') {\n                import('./components/risks/RiskDetailView').then(({ createRiskDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createRiskDetailView({\n                      riskId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else if (entityType === 'action') {\n                import('./components/actions/ActionDetailView').then(({ createActionDetailView }) => {\n                  const container = document.getElementById('timeline-content');\n                  if (container) {\n                    container.innerHTML = '';\n                    const detailView = createActionDetailView({\n                      actionId: event.entity_id!,\n                      onBack: () => switchTab('timeline'),\n                    });\n                    container.appendChild(detailView);\n                  }\n                });\n              } else {\n                toast.info(`Event: ${event.title}`);\n              }\n            }\n          },\n        });\n        timelineContainer.appendChild(panel);\n        console.log('[Timeline] TimelinePanel loaded successfully');\n      }).catch(err => {\n        console.error('[Timeline] Failed to load TimelinePanel:', err);\n        timelineContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-center\">Failed to load Timeline</div>';\n      });\n    }\n  }\n\n  // Load Team Analysis when switching to team-analysis tab\n  if (tabName === 'team-analysis') {\n    const teamAnalysisContainer = document.getElementById('team-analysis-container');\n    const hasContent = teamAnalysisContainer?.querySelector('.team-analysis-panel');\n    if (teamAnalysisContainer && !hasContent) {\n      console.log('[TeamAnalysis] Loading TeamAnalysis component...');\n      import('./components/TeamAnalysis').then(({ createTeamAnalysis }) => {\n        teamAnalysisContainer.innerHTML = ''; // Clear any placeholder\n        const panel = createTeamAnalysis();\n        teamAnalysisContainer.appendChild(panel);\n        console.log('[TeamAnalysis] TeamAnalysis loaded successfully');\n        \n        // Setup subtab switching after component is loaded\n        setupTeamAnalysisSubtabs();\n      }).catch(err => {\n        console.error('[TeamAnalysis] Failed to load TeamAnalysis:', err);\n        teamAnalysisContainer.innerHTML = '<div class=\"gm-loading-placeholder gm-text-center\">Failed to load Team Analysis</div>';\n      });\n    } else {\n      // Component already loaded, just setup subtabs\n      setupTeamAnalysisSubtabs();\n    }\n  }\n}\n\n/**\n * Setup Team Analysis subtab switching\n */\nfunction setupTeamAnalysisSubtabs(): void {\n  // Import the store to control subtab switching\n  import('./stores/teamAnalysis').then(({ teamAnalysisStore }) => {\n    document.querySelectorAll('#team-analysis-subtabs .subtab').forEach(btn => {\n      // Remove existing listeners to prevent duplicates\n      const newBtn = btn.cloneNode(true);\n      btn.parentNode?.replaceChild(newBtn, btn);\n      \n      newBtn.addEventListener('click', (e) => {\n        const subtab = (e.target as HTMLElement).dataset.subtab as 'profiles' | 'team' | 'graph';\n        if (subtab) {\n          console.log('[TeamAnalysis] Switching to subtab:', subtab);\n          // Update active state in UI\n          document.querySelectorAll('#team-analysis-subtabs .subtab').forEach(b => {\n            b.classList.toggle('active', b.getAttribute('data-subtab') === subtab);\n          });\n          // Update the store which triggers re-render\n          teamAnalysisStore.setSubtab(subtab);\n        }\n      });\n    });\n  });\n}\n\n/**\n * Load projects\n */\nasync function loadProjects(): Promise<void> {\n  const selector = document.getElementById('project-selector') as HTMLSelectElement;\n  if (!selector) return;\n\n  try {\n    const projectList = await projects.getAll();\n\n    selector.innerHTML = '<option value=\"\">Select Project...</option>';\n    projectList.forEach(project => {\n      const option = document.createElement('option');\n      option.value = project.id;\n      option.textContent = project.name + (project.isDefault ? ' (default)' : '');\n      selector.appendChild(option);\n    });\n\n    // Select current project if any; when none persisted (e.g. storage blocked), auto-select first or default\n    const currentProjectId = appStore.getState().currentProjectId;\n    const editProjectBtn = document.getElementById('edit-project-btn');\n\n    if (currentProjectId) {\n      selector.value = currentProjectId;\n      if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n    } else if (projectList.length > 0) {\n      const firstOrDefault = projectList.find((p: { isDefault?: boolean }) => p.isDefault) || projectList[0];\n      selector.value = firstOrDefault.id;\n      appStore.setCurrentProject(firstOrDefault);\n      appStore.setCurrentProjectId(firstOrDefault.id);\n      if (editProjectBtn) editProjectBtn.classList.remove('hidden');\n    } else {\n      if (editProjectBtn) editProjectBtn.classList.add('hidden');\n    }\n  } catch (error) {\n    // Projects API may not be available yet\n    console.warn('Projects not available:', error);\n  }\n}\n\n/**\n * Clear all project-scoped state so no data from another project can leak into the UI.\n */\nfunction clearProjectScopedState(): void {\n  dataStore.setQuestions([]);\n  dataStore.setRisks([]);\n  dataStore.setActions([]);\n  dataStore.setDecisions([]);\n  dataStore.setFacts([]);\n  dataStore.setContacts([]);\n  dataStore.clearChatHistory();\n  teamAnalysisStore.reset();\n  chartsStore.destroyAll();\n  try {\n    localStorage.removeItem('copilot_session');\n  } catch {\n    // ignore if localStorage unavailable\n  }\n  // Clear URL hash and project-scoped query params so no ID from previous project remains\n  if (typeof window !== 'undefined' && (window.location.hash || window.location.search)) {\n    const base = window.location.pathname || '/app';\n    window.history.replaceState(null, '', base);\n  }\n}\n\n/**\n * Select a project\n */\nasync function selectProject(projectId: string): Promise<void> {\n  try {\n    clearProjectScopedState();\n    const project = await projects.activate(projectId);\n\n    if (project) {\n      toast.success(`Switched to: ${project.name}`);\n      await refreshData();\n    }\n  } catch {\n    toast.error('Failed to load project');\n  }\n}\n\n/**\n * Refresh all data for current project\n */\nasync function refreshData(): Promise<void> {\n  try {\n    // First, reload projects list (may auto-select first/default if store was empty)\n    await loadProjects();\n\n    let currentProject = appStore.getState().currentProject;\n    let currentProjectId = appStore.getState().currentProjectId;\n\n    // If store still empty but selector has a value (e.g. user picked one), sync store from selector\n    if (!currentProject && !currentProjectId) {\n      const selector = document.getElementById('project-selector') as HTMLSelectElement;\n      if (selector?.value) {\n        try {\n          const project = await projects.activate(selector.value);\n          if (project) {\n            appStore.setCurrentProject(project);\n            appStore.setCurrentProjectId(project.id);\n            currentProject = project;\n            currentProjectId = project.id;\n          }\n        } catch {\n          // ignore\n        }\n      }\n    }\n\n    if (!currentProject && !currentProjectId) {\n      // No project selected - show empty state and ensure dashboard tab is visible\n      console.log(' No project selected - showing empty state');\n      switchTab('dashboard');\n      clearProjectScopedState();\n      await refreshDashboardPanel();\n      loadSotContent(uiStore.getState().sotCurrentView);\n      return;\n    }\n    \n    // API endpoints don't use projectId in path - project context is server-side\n    const [questionsRes, risksRes, actionsRes, decisionsRes, contactsRes] = await Promise.all([\n      http.get<{ questions: unknown[] }>('/api/questions').catch(() => ({ data: { questions: [] } })),\n      http.get<{ risks: unknown[] }>('/api/risks').catch(() => ({ data: { risks: [] } })),\n      http.get<{ actions: unknown[] }>('/api/actions').catch(() => ({ data: { actions: [] } })),\n      http.get<{ decisions: unknown[] }>('/api/decisions').catch(() => ({ data: { decisions: [] } })),\n      http.get<{ contacts: unknown[] }>('/api/contacts').catch(() => ({ data: { contacts: [] } })),\n    ]);\n\n    dataStore.setQuestions((questionsRes.data.questions || []) as []);\n    dataStore.setRisks((risksRes.data.risks || []) as []);\n    dataStore.setActions((actionsRes.data.actions || []) as []);\n    dataStore.setDecisions((decisionsRes.data.decisions || []) as []);\n    dataStore.setContacts((contactsRes.data.contacts || []) as []);\n\n    // Re-render dashboard with new data\n    await refreshDashboardPanel();\n    loadSotContent(uiStore.getState().sotCurrentView);\n  } catch {\n    console.error('Failed to refresh data');\n  }\n}\n\n/**\n * Update dashboard stats\n */\nfunction updateDashboard(): void {\n  const statsGrid = document.getElementById('dashboard-stats');\n  const dashboardContent = document.getElementById('dashboard-content');\n  if (!statsGrid) return;\n\n  // Check if project is selected\n  const currentProject = appStore.getState().currentProject;\n  const currentProjectId = appStore.getState().currentProjectId;\n  \n  if (!currentProject && !currentProjectId) {\n    // No project selected - show empty state\n    statsGrid.innerHTML = `\n      <div class=\"no-project-message gm-grid-col-all gm-empty-state gm-p-6\">\n        <svg class=\"gm-empty-state-icon\" width=\"64\" height=\"64\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n          <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\"/>\n        </svg>\n        <h3 class=\"gm-empty-state-title gm-text-lg\">No Project Selected</h3>\n        <p class=\"gm-empty-state-desc\">\n          Select an existing project from the dropdown above or create a new one to start managing your data.\n        </p>\n        <button id=\"create-project-cta\" class=\"btn btn-primary gm-empty-state-cta\">\n          <svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 4v16m8-8H4\"/>\n          </svg>\n          Create New Project\n        </button>\n      </div>\n    `;\n\n    if (dashboardContent) {\n      dashboardContent.classList.add('gm-none');\n    }\n    \n    // Bind create project button  open Projects tab with create form inline\n    const createBtn = document.getElementById('create-project-cta');\n    if (createBtn) {\n      createBtn.addEventListener('click', () => {\n        (window as unknown as { __godmodeProjectsOpen?: string })['__godmodeProjectsOpen'] = 'create';\n        switchTab('projects');\n      });\n    }\n\n    return;\n  }\n\n  if (dashboardContent) {\n    dashboardContent.classList.remove('gm-none');\n  }\n\n  const state = dataStore.getState();\n  \n  // Count only active questions (exclude dismissed/resolved/answered)\n  const activeQuestions = state.questions.filter(q => \n    q.status !== 'dismissed' && q.status !== 'resolved' && q.status !== 'answered'\n  );\n  \n  statsGrid.innerHTML = `\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${activeQuestions.length}</div>\n      <div class=\"stat-label\">Questions</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.risks.length}</div>\n      <div class=\"stat-label\">Risks</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.actions.length}</div>\n      <div class=\"stat-label\">Actions</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.decisions.length}</div>\n      <div class=\"stat-label\">Decisions</div>\n    </div>\n    <div class=\"stat-card\">\n      <div class=\"stat-value\">${state.contacts.length}</div>\n      <div class=\"stat-label\">Contacts</div>\n    </div>\n  `;\n}\n\n/**\n * Load SOT content\n */\nfunction loadSotContent(view: string): void {\n  const container = document.getElementById('sot-content');\n  if (!container) return;\n\n  const state = dataStore.getState();\n  let items: Array<{ id: string; [key: string]: unknown }> = [];\n  let template: (item: { id: string; [key: string]: unknown }) => string;\n\n  switch (view) {\n    case 'questions':\n      // Use the full QuestionsPanel with Generate button, filters and detail view\n      container.innerHTML = '';\n      const questionsPanel = createQuestionsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(questionsPanel);\n      return; // Exit early since we're using the full component\n    case 'facts':\n      container.innerHTML = '';\n      const factsPanel = createFactsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(factsPanel);\n      return;\n    case 'decisions':\n      container.innerHTML = '';\n      const decisionsPanel = createDecisionsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(decisionsPanel);\n      return;\n    case 'risks':\n      container.innerHTML = '';\n      const risksPanel = createRisksPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(risksPanel);\n      return;\n    case 'actions':\n      container.innerHTML = '';\n      const actionsPanel = createActionsPanel({\n        useDetailView: true,\n        containerElement: container\n      });\n      container.appendChild(actionsPanel);\n      return;\n    default:\n      container.innerHTML = '<p class=\"text-muted\">Select a view</p>';\n      return;\n  }\n}\n\n/**\n * Show question detail view\n */\nfunction showQuestionDetail(question: Question, container: HTMLElement): void {\n  // Store original content for restoration\n  const originalContent = container.innerHTML;\n  \n  // Transform question to match the expected interface\n  const questionData = {\n    id: question.id,\n    content: String(question.content || question.question || ''),\n    context: question.context as string | undefined,\n    priority: (question.priority || 'medium') as 'low' | 'medium' | 'high' | 'critical',\n    status: (question.status || 'pending') as 'pending' | 'assigned' | 'resolved' | 'reopened' | 'dismissed',\n    assigned_to: question.assigned_to as string | undefined,\n    answer: question.answer as string | undefined,\n    answer_source: question.answer_source as 'manual' | 'manual-edit' | 'auto-detected' | 'document' | 'ai' | undefined,\n    category: question.category as string | undefined,\n    source_file: question.source_file as string | undefined,\n    created_at: String(question.created_at || question.createdAt || new Date().toISOString()),\n    updated_at: question.updated_at as string | undefined,\n    follow_up_to: question.follow_up_to as string | undefined,\n    answered_by_contact_id: question.answered_by_contact_id as string | undefined,\n    answered_by_name: question.answered_by_name as string | undefined,\n    sla_hours: question.sla_hours as number | undefined,\n    sla_breached: question.sla_breached as boolean | undefined,\n    extracted_entities: question.extracted_entities as Array<{ type: string; name: string }> | undefined,\n    extracted_topics: question.extracted_topics as Array<{ name: string }> | undefined,\n  };\n  \n  // Create detail view\n  const detailView = createQuestionDetailView({\n    question: questionData,\n    onClose: () => {\n      // Restore original content\n      container.innerHTML = originalContent;\n      // Re-bind click handlers\n      loadSotContent('questions');\n    },\n    onUpdate: (updatedQuestion) => {\n      // Update question in data store\n      const state = dataStore.getState();\n      const updatedQuestions = state.questions.map((q) => \n        q.id === updatedQuestion.id ? { ...q, ...updatedQuestion } as Question : q\n      );\n      dataStore.setQuestions(updatedQuestions);\n    },\n    onNavigateToQuestion: (questionId) => {\n      // Find and show the target question\n      const state = dataStore.getState();\n      const targetQuestion = state.questions.find((q) => q.id === questionId);\n      if (targetQuestion) {\n        showQuestionDetail(targetQuestion, container);\n      }\n    }\n  });\n  \n  // Replace content with detail view\n  container.innerHTML = '';\n  container.appendChild(detailView);\n}\n\n/**\n * Escape HTML\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Format markdown (basic)\n */\nfunction formatMarkdown(text: string): string {\n  return escapeHtml(text)\n    .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n    .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n    .replace(/`(.*?)`/g, '<code>$1</code>')\n    .replace(/\\n/g, '<br>');\n}\n\n/**\n * Pending files manager\n */\nconst pendingFiles: File[] = [];\n\nfunction updatePendingFilesUI(): void {\n  const countEl = document.getElementById('pending-count');\n  const listEl = document.getElementById('pending-files-list');\n  \n  if (countEl) {\n    countEl.textContent = `${pendingFiles.length} file${pendingFiles.length !== 1 ? 's' : ''}`;\n  }\n  \n  if (listEl) {\n    if (pendingFiles.length === 0) {\n      listEl.innerHTML = '<div class=\"empty-hint\">No files pending</div>';\n    } else {\n      listEl.innerHTML = pendingFiles.map((file, index) => `\n        <div class=\"pending-file-item\" data-index=\"${index}\">\n          <div class=\"pending-file-info\">\n            <div class=\"pending-file-name\" title=\"${escapeHtml(file.name)}\">${escapeHtml(file.name)}</div>\n            <div class=\"pending-file-size\">${formatFileSize(file.size)}</div>\n          </div>\n          <button class=\"pending-file-remove\" data-index=\"${index}\" title=\"Remove\"></button>\n        </div>\n      `).join('');\n      \n      // Bind remove buttons\n      listEl.querySelectorAll('.pending-file-remove').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n          e.stopPropagation();\n          const idx = parseInt((btn as HTMLElement).dataset.index || '0');\n          pendingFiles.splice(idx, 1);\n          updatePendingFilesUI();\n        });\n      });\n    }\n  }\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes < 1024) return bytes + ' B';\n  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n}\n\nfunction addPendingFiles(files: FileList | File[]): void {\n  Array.from(files).forEach(file => {\n    if (!pendingFiles.some(f => f.name === file.name && f.size === file.size)) {\n      pendingFiles.push(file);\n    }\n  });\n  updatePendingFilesUI();\n}\n\n/**\n * Initialize sidebar action buttons\n */\nfunction initializeSidebarActions(): void {\n  // Process Files button\n  const processBtn = document.getElementById('process-files-btn');\n  if (processBtn) {\n    processBtn.addEventListener('click', async () => {\n      if (pendingFiles.length === 0) {\n        toast.warning('No files to process. Add files first.');\n        return;\n      }\n      \n      processBtn.setAttribute('disabled', 'true');\n      processBtn.innerHTML = '<span class=\"btn-icon\"></span> Processing...';\n      \n      try {\n        const result = await documentsService.upload(pendingFiles);\n        if (result.success) {\n          toast.success(`Processed ${result.files.length} files successfully`);\n          pendingFiles.length = 0; // Clear array\n          updatePendingFilesUI();\n          refreshData();\n        }\n      } catch (error) {\n        toast.error('Failed to process files');\n        console.error('Process error:', error);\n      } finally {\n        processBtn.removeAttribute('disabled');\n        processBtn.innerHTML = '<span class=\"btn-icon\"></span> Process Files';\n      }\n    });\n  }\n  \n  // Export Knowledge button\n  const exportKnowledgeBtn = document.getElementById('export-knowledge-btn');\n  if (exportKnowledgeBtn) {\n    exportKnowledgeBtn.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const knowledge = {\n          facts: data.facts || [],\n          decisions: data.decisions || [],\n          exportedAt: new Date().toISOString()\n        };\n        \n        const blob = new Blob([JSON.stringify(knowledge, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'godmode-knowledge-export.json';\n        a.click();\n        URL.revokeObjectURL(url);\n        \n        toast.success('Knowledge exported');\n      } catch (error) {\n        toast.error('Export failed');\n      }\n    });\n  }\n  \n  // Export Knowledge to clipboard\n  const exportKnowledgeClipboard = document.getElementById('export-knowledge-clipboard');\n  if (exportKnowledgeClipboard) {\n    exportKnowledgeClipboard.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const knowledge = {\n          facts: data.facts || [],\n          decisions: data.decisions || []\n        };\n        await navigator.clipboard.writeText(JSON.stringify(knowledge, null, 2));\n        toast.success('Copied to clipboard');\n      } catch (error) {\n        toast.error('Copy failed');\n      }\n    });\n  }\n  \n  // Export Questions button\n  const exportQuestionsBtn = document.getElementById('export-questions-btn');\n  if (exportQuestionsBtn) {\n    exportQuestionsBtn.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const questions = data.questions || [];\n        \n        const blob = new Blob([JSON.stringify(questions, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'godmode-questions-export.json';\n        a.click();\n        URL.revokeObjectURL(url);\n        \n        toast.success('Questions exported');\n      } catch (error) {\n        toast.error('Export failed');\n      }\n    });\n  }\n  \n  // Export Questions to clipboard\n  const exportQuestionsClipboard = document.getElementById('export-questions-clipboard');\n  if (exportQuestionsClipboard) {\n    exportQuestionsClipboard.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const questions = data.questions || [];\n        await navigator.clipboard.writeText(JSON.stringify(questions, null, 2));\n        toast.success('Copied to clipboard');\n      } catch (error) {\n        toast.error('Copy failed');\n      }\n    });\n  }\n  \n  // Copy Overdue Items button\n  const copyOverdueBtn = document.getElementById('copy-overdue-btn');\n  if (copyOverdueBtn) {\n    copyOverdueBtn.addEventListener('click', async () => {\n      try {\n        const data = dataStore.getState();\n        const now = new Date();\n        \n        const overdueActions = (data.actions || []).filter(a => {\n          if (a.status === 'completed') return false;\n          const dueDate = a.dueDate;\n          if (!dueDate) return false;\n          return new Date(dueDate) < now;\n        });\n        \n        const overdueQuestions = (data.questions || []).filter(q => {\n          if (q.status === 'resolved') return false;\n          const createdAt = q.created_at || q.createdAt;\n          if (!createdAt) return false;\n          const created = new Date(createdAt);\n          const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n          return created < sevenDaysAgo;\n        });\n        \n        const overdue = {\n          actions: overdueActions,\n          questions: overdueQuestions,\n          exportedAt: now.toISOString()\n        };\n        \n        await navigator.clipboard.writeText(JSON.stringify(overdue, null, 2));\n        toast.success(`Copied ${overdueActions.length} actions and ${overdueQuestions.length} questions`);\n      } catch (error) {\n        toast.error('Copy failed');\n      }\n    });\n  }\n  \n  // Clean Orphan Data button\n  const cleanOrphanBtn = document.getElementById('clean-orphan-btn');\n  if (cleanOrphanBtn) {\n    cleanOrphanBtn.addEventListener('click', async () => {\n      const confirmed = await components.confirm(\n        'This will remove orphaned data entries that are not linked to any documents. Continue?',\n        { title: 'Clean Orphan Data', confirmText: 'Clean', confirmClass: 'btn-warning' }\n      );\n      \n      if (confirmed) {\n        try {\n          const response = await http.post('/api/cleanup/orphans');\n          toast.success('Orphan data cleaned');\n          refreshData();\n        } catch (error) {\n          toast.error('Cleanup failed');\n        }\n      }\n    });\n  }\n  \n  // Reset Data button (clears knowledge; keeps team, contacts, cost)\n  const resetDataBtn = document.getElementById('reset-data-btn');\n  if (resetDataBtn) {\n    resetDataBtn.addEventListener('click', async () => {\n      const confirmed = await components.confirm(\n        'This will clear all knowledge data (facts, decisions, questions, risks, actions, documents, etc.) for the current project. Team, contacts, and cost data will be kept. Continue?',\n        { title: 'Reset Project Data', confirmText: 'Reset Knowledge Data', confirmClass: 'btn-danger' }\n      );\n\n      if (confirmed) {\n        try {\n          await http.post('/api/reset');\n          toast.success('Project data reset; team, contacts and cost preserved.');\n          refreshData();\n        } catch (error) {\n          toast.error('Reset failed');\n        }\n      }\n    });\n  }\n  \n  // Initialize pending files UI\n  updatePendingFilesUI();\n}\n\n/**\n * Initialize the application\n */\nasync function init(): Promise<void> {\n  console.log(' GodMode Frontend initializing...');\n  \n  // Initialize legacy bridge for backwards compatibility\n  initLegacyBridge();\n  console.log(' Legacy bridge initialized');\n  \n  // Configure API client\n  configureApiClient();\n  console.log(' API client configured');\n  \n  // Initialize authentication\n  await initAuth();\n  console.log(' Auth initialized');\n  \n  // Theme is already initialized via its constructor\n  console.log(` Theme: ${theme.getMode()} (effective: ${theme.getEffective()})`);\n  \n  // Register keyboard shortcuts\n  registerShortcuts();\n  console.log(' Keyboard shortcuts registered');\n  \n  // Initialize global search (Cmd+K / Ctrl+K)\n  initGlobalSearch({\n    onResultClick: (result) => {\n      console.log('Search result clicked:', result);\n      // Navigate to the result based on type\n      window.dispatchEvent(new CustomEvent('godmode:navigate', { detail: result }));\n    }\n  });\n  console.log(' Global search initialized');\n\n  // Listen for projects list changed (e.g. from Projects tab create/edit/delete)\n  window.addEventListener('godmode:projects-changed', () => {\n    loadProjects();\n  });\n\n  // Listen for godmode:navigate (e.g. \"View source document\" from Fact/Decision/Risk detail)\n  window.addEventListener('godmode:navigate', async (e: Event) => {\n    const d = (e as CustomEvent).detail;\n    if (!d || d.tab !== 'files' || !d.documentId) return;\n    switchTab('files');\n    await new Promise(r => setTimeout(r, 400)); // allow Files panel to mount\n    const doc = await documentsService.get(d.documentId);\n    if (doc) {\n      const { showDocumentPreviewModal } = await import('./components/modals/DocumentPreviewModal');\n      showDocumentPreviewModal({ document: doc });\n    }\n  });\n\n  // Initialize UI\n  initializeUI();\n  console.log(' UI initialized');\n  \n  // Initialize client-side routing (reads URL and activates correct tab)\n  initRouting();\n  console.log(' Client-side routing initialized');\n\n  // Load initial data (only if authenticated or auth not required)\n  if (auth.isAuthenticated()) {\n    refreshData();\n    console.log(' Data loading started');\n  } else if (appStore.getState().authConfigured) {\n    // Auth required but not logged in - redirect to landing page\n    console.log(' Authentication required - redirecting to landing page');\n    window.location.href = '/';\n    return;\n  } else {\n    // Auth not configured - guest mode\n    console.log(' Guest mode - loading data');\n    refreshData();\n  }\n  \n  const loading = document.getElementById('app-loading');\n  if (loading) {\n    loading.classList.add('fade-out');\n    setTimeout(() => loading.classList.add('hidden'), 300);\n  }\n  \n  // Log successful initialization\n  console.log(' GodMode Frontend ready');\n  console.log(` Version: ${window.godmode.version}`);\n  console.log(' Press ? for keyboard shortcuts');\n}\n\n/**\n * Initialize authentication\n */\nasync function initAuth(): Promise<void> {\n  // Check auth status and session\n  const isAuthenticated = await auth.init();\n  \n  // Update UI based on auth state\n  updateAuthUI();\n  \n  // Listen for auth required events (e.g., 401 from API)\n  auth.onAuthRequired(() => {\n    components.showAuthModal({\n      required: true, // Session expired, must re-authenticate\n      onSuccess: () => {\n        updateAuthUI();\n        refreshData();\n        toast.success('Session restored! Refreshing data...');\n      }\n    });\n  });\n\n  // Listen for auth success to refresh data\n  window.addEventListener('godmode:auth-success', () => {\n    updateAuthUI();\n    refreshData();\n  });\n}\n\n/**\n * Show full-screen authentication blocker with integrated login form\n * Completely blocks access to the app until login\n */\nfunction showAuthRequiredMessage(): void {\n  // Remove any existing overlay\n  const existing = document.getElementById('auth-blocker-overlay');\n  if (existing) existing.remove();\n  \n  // Create full-screen blocker overlay\n  const authBlocker = document.createElement('div');\n  authBlocker.id = 'auth-blocker-overlay';\n  authBlocker.innerHTML = `\n    <div class=\"auth-card\">\n      <div class=\"auth-logo\">\n        <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M12 2L2 7l10 5 10-5-10-5z\"/>\n          <path d=\"M2 17l10 5 10-5\"/>\n          <path d=\"M2 12l10 5 10-5\"/>\n        </svg>\n      </div>\n      <h1 class=\"auth-title\">Welcome to GodMode</h1>\n      <p class=\"auth-subtitle\">Your AI-powered knowledge management platform</p>\n      \n      <div class=\"auth-tabs\">\n        <button class=\"auth-tab active\" data-tab=\"login\">Sign In</button>\n        <button class=\"auth-tab\" data-tab=\"register\">Create Account</button>\n      </div>\n      \n      <!-- Login Form -->\n      <form id=\"login-form\" class=\"auth-form\">\n        <div class=\"form-group\">\n          <label class=\"form-label\">Email</label>\n          <input type=\"email\" class=\"form-input\" id=\"login-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Password</label>\n          <div class=\"input-wrapper\">\n            <input type=\"password\" class=\"form-input\" id=\"login-password\" placeholder=\"Enter your password\" required autocomplete=\"current-password\">\n          </div>\n        </div>\n        <div class=\"form-error\" id=\"login-error\"></div>\n        <button type=\"submit\" class=\"auth-submit\" id=\"login-submit\">Sign In</button>\n        <div class=\"auth-footer\">\n          <button type=\"button\" class=\"auth-link\" id=\"forgot-link\">Forgot your password?</button>\n        </div>\n      </form>\n      \n      <!-- Register Form -->\n      <form id=\"register-form\" class=\"auth-form hidden\">\n        <div class=\"form-group\">\n          <label class=\"form-label\">Email *</label>\n          <input type=\"email\" class=\"form-input\" id=\"register-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Display Name</label>\n          <input type=\"text\" class=\"form-input\" id=\"register-name\" placeholder=\"Your name (optional)\" autocomplete=\"name\">\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Password *</label>\n          <input type=\"password\" class=\"form-input\" id=\"register-password\" placeholder=\"Min. 12 characters\" required minlength=\"12\" autocomplete=\"new-password\">\n          <span class=\"form-hint\">Use at least 12 characters with mixed case, numbers, and symbols</span>\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Confirm Password *</label>\n          <input type=\"password\" class=\"form-input\" id=\"register-confirm\" placeholder=\"Confirm your password\" required autocomplete=\"new-password\">\n        </div>\n        <div class=\"form-error\" id=\"register-error\"></div>\n        <button type=\"submit\" class=\"auth-submit\" id=\"register-submit\">Create Account</button>\n      </form>\n      \n      <!-- Forgot Password Form -->\n      <form id=\"forgot-form\" class=\"auth-form hidden\">\n        <p class=\"auth-forgot-intro\">\n          Enter your email and we'll send you a link to reset your password.\n        </p>\n        <div class=\"form-group\">\n          <label class=\"form-label\">Email</label>\n          <input type=\"email\" class=\"form-input\" id=\"forgot-email\" placeholder=\"you@example.com\" required autocomplete=\"email\">\n        </div>\n        <div class=\"form-error\" id=\"forgot-error\"></div>\n        <button type=\"submit\" class=\"auth-submit\">Send Reset Link</button>\n        <div class=\"auth-footer\">\n          <button type=\"button\" class=\"auth-link\" id=\"back-to-login\">Back to Sign In</button>\n        </div>\n      </form>\n    </div>\n  `;\n  \n  document.body.appendChild(authBlocker);\n  \n  // Tab switching\n  const tabs = authBlocker.querySelectorAll('.auth-tab');\n  const loginForm = authBlocker.querySelector('#login-form') as HTMLFormElement;\n  const registerForm = authBlocker.querySelector('#register-form') as HTMLFormElement;\n  const forgotForm = authBlocker.querySelector('#forgot-form') as HTMLFormElement;\n  \n  tabs.forEach(tab => {\n    tab.addEventListener('click', () => {\n      tabs.forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n      \n      const tabId = tab.getAttribute('data-tab');\n      loginForm.classList.toggle('hidden', tabId !== 'login');\n      registerForm.classList.toggle('hidden', tabId !== 'register');\n      forgotForm.classList.add('hidden');\n    });\n  });\n  \n  // Forgot password link\n  const forgotLink = authBlocker.querySelector('#forgot-link');\n  forgotLink?.addEventListener('click', () => {\n    loginForm.classList.add('hidden');\n    registerForm.classList.add('hidden');\n    forgotForm.classList.remove('hidden');\n    tabs.forEach(t => t.classList.remove('active'));\n  });\n  \n  // Back to login\n  const backToLogin = authBlocker.querySelector('#back-to-login');\n  backToLogin?.addEventListener('click', () => {\n    forgotForm.classList.add('hidden');\n    loginForm.classList.remove('hidden');\n    tabs[0].classList.add('active');\n  });\n  \n  // Handle Login\n  loginForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = (authBlocker.querySelector('#login-email') as HTMLInputElement).value;\n    const password = (authBlocker.querySelector('#login-password') as HTMLInputElement).value;\n    const errorEl = authBlocker.querySelector('#login-error') as HTMLElement;\n    const submitBtn = authBlocker.querySelector('#login-submit') as HTMLButtonElement;\n    \n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Signing in...';\n    errorEl.classList.remove('visible');\n    \n    try {\n      await auth.login({ email, password });\n      authBlocker.remove();\n      updateAuthUI();\n      refreshData();\n      toast.success('Welcome back!');\n    } catch (err) {\n      errorEl.textContent = err instanceof Error ? err.message : 'Login failed. Please try again.';\n      errorEl.classList.add('visible');\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Sign In';\n    }\n  });\n  \n  // Handle Register\n  registerForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = (authBlocker.querySelector('#register-email') as HTMLInputElement).value;\n    const name = (authBlocker.querySelector('#register-name') as HTMLInputElement).value;\n    const password = (authBlocker.querySelector('#register-password') as HTMLInputElement).value;\n    const confirm = (authBlocker.querySelector('#register-confirm') as HTMLInputElement).value;\n    const errorEl = authBlocker.querySelector('#register-error') as HTMLElement;\n    const submitBtn = authBlocker.querySelector('#register-submit') as HTMLButtonElement;\n    \n    if (password !== confirm) {\n      errorEl.textContent = 'Passwords do not match';\n      errorEl.classList.add('visible');\n      return;\n    }\n    \n    if (password.length < 12) {\n      errorEl.textContent = 'Password must be at least 12 characters';\n      errorEl.classList.add('visible');\n      return;\n    }\n    \n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Creating account...';\n    errorEl.classList.remove('visible');\n    \n    try {\n      const result = await auth.register({ email, password, display_name: name || undefined });\n      \n      if (result.needsEmailVerification) {\n        toast.success('Account created! Check your email to verify.');\n        // Switch to login tab\n        tabs.forEach(t => t.classList.remove('active'));\n        tabs[0].classList.add('active');\n        registerForm.classList.add('hidden');\n        loginForm.classList.remove('hidden');\n      } else {\n        authBlocker.remove();\n        updateAuthUI();\n        refreshData();\n        toast.success('Account created! Welcome to GodMode.');\n      }\n    } catch (err) {\n      errorEl.textContent = err instanceof Error ? err.message : 'Registration failed. Please try again.';\n      errorEl.classList.add('visible');\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Create Account';\n    }\n  });\n  \n  // Handle Forgot Password\n  forgotForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const email = (authBlocker.querySelector('#forgot-email') as HTMLInputElement).value;\n    const submitBtn = forgotForm.querySelector('.auth-submit') as HTMLButtonElement;\n    \n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Sending...';\n    \n    try {\n      await auth.forgotPassword(email);\n      toast.success('If an account exists, you will receive a reset link.');\n      // Go back to login\n      forgotForm.classList.add('hidden');\n      loginForm.classList.remove('hidden');\n      tabs[0].classList.add('active');\n    } catch {\n      toast.success('If an account exists, you will receive a reset link.');\n    } finally {\n      submitBtn.disabled = false;\n      submitBtn.textContent = 'Send Reset Link';\n    }\n  });\n  \n  // Focus email input\n  setTimeout(() => {\n    const emailInput = authBlocker.querySelector('#login-email') as HTMLInputElement;\n    emailInput?.focus();\n  }, 100);\n}\n\n/**\n * Update UI based on auth state\n */\nfunction updateAuthUI(): void {\n  const user = auth.getCurrentUser();\n  const userAvatar = document.getElementById('user-avatar');\n  const userDropdown = document.getElementById('user-dropdown');\n  const loginBtn = document.getElementById('login-btn');\n  \n  // Remove auth blocker if it exists\n  const authBlocker = document.getElementById('auth-blocker-overlay');\n  if (authBlocker && user) {\n    authBlocker.remove();\n  }\n  \n  // Admin nav button - only visible for superadmin\n  const adminNavBtn = document.getElementById('nav-admin-btn');\n  \n  if (user) {\n    // Show user info\n    if (userAvatar) {\n      const displayName = user.name || user.email.split('@')[0] || 'User';\n      const initials = (user.name?.[0] || user.email[0]).toUpperCase();\n      \n      // Generate fallback avatar URL using UI Avatars\n      const fallbackAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=e11d48&color=fff&size=80&font-size=0.4&bold=true`;\n      const avatarUrl = user.avatar || fallbackAvatar;\n      \n      // Use image for avatar\n      userAvatar.innerHTML = `<img src=\"${avatarUrl}\" alt=\"${escapeHtml(initials)}\" class=\"gm-avatar-img\" onerror=\"this.classList.add('gm-none');this.parentElement.textContent=this.alt\">`;\n      userAvatar.title = user.name || user.email;\n      userAvatar.classList.remove('hidden');\n    }\n    if (loginBtn) {\n      loginBtn.classList.add('hidden');\n    }\n    // Update dropdown content\n    if (userDropdown) {\n      const userName = userDropdown.querySelector('.user-name');\n      const userEmail = userDropdown.querySelector('.user-email');\n      if (userName) userName.textContent = user.name || 'User';\n      if (userEmail) userEmail.textContent = user.email;\n    }\n    \n    // Show/hide Admin nav based on role\n    if (adminNavBtn) {\n      if (user.role === 'superadmin') {\n        adminNavBtn.classList.remove('hidden');\n        console.log(' Admin nav enabled for superadmin:', user.email);\n      } else {\n        adminNavBtn.classList.add('hidden');\n      }\n    }\n  } else {\n    // Show login button\n    if (userAvatar) {\n      userAvatar.classList.add('hidden');\n    }\n    if (loginBtn) {\n      loginBtn.classList.remove('hidden');\n    }\n    // Hide admin nav when logged out\n    if (adminNavBtn) {\n      adminNavBtn.classList.add('hidden');\n    }\n  }\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n\n// Add components to global\nObject.assign(window.godmode, { components });\n\n// Export for potential use in other modules\nexport { \n  theme, toast, shortcuts, undoManager, storage, http, api, configureApi, auth, projects,\n  dashboardService, questionsService, risksService, actionsService, decisionsService,\n  chatService, contactsService, teamsService, documentsService, knowledgeService,\n  emailsService, graphService, timelineService, costsService, notificationsService,\n  commentsService, membersService, profileService, userSettingsService, projectSettingsService,\n  apiKeysService, webhooksService, auditService\n};\nexport { appStore, uiStore, dataStore, chartsStore };\nexport { components };\n"],"file":"main-DsXjfhBM.js"}