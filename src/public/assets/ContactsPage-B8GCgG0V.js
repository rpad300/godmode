import{c as te,r as i,j as e,h as Gt,d as Vt,a as pe,b as xe,ag as oe,b4 as ue,$ as Ce,a0 as ze,I as L,C as Ne,b0 as _,b5 as We,b6 as Bt,b7 as Kt,b8 as qt,b9 as Wt,ba as Ht,N as _e,O as h,H as Yt,a1 as Fe,au as Te,a2 as we,K as Jt,T as $e,ad as Qt,o as Zt,bb as Xt,bc as es,bd as ts,be as ss,bf as as,bg as rs,bh as ns,bi as is,bj as os,bk as ls,J as cs,b2 as ds,a3 as ms,U as xs,g as He}from"./main-DPJZnN-g.js";import{I as Oe}from"./input-CbHr_mul.js";import{c as us,P as ne,a as q,b as Ye,u as ps,d as Je}from"./index-Cd-aIfCY.js";import{S as le,a as ce,b as de,c as me,d as Q,e as hs,u as Qe,U as Ie}from"./select-DUlAOpxc.js";import{I as gs,A as fs}from"./AvatarUpload-CsfKCySe.js";import{P as Me}from"./plus-D_qMNj9L.js";import{S as vs}from"./save-BmzQhvxt.js";import{u as Ze,a as bs,P as js}from"./index-D4HbvI6D.js";import{C as ys}from"./CommentsPanel-BDpgh2Pb.js";import{S as Xe}from"./sparkles-B7v1H-ZZ.js";import{L as et}from"./link-2-BbBFDDRu.js";import{G as Ns}from"./globe-pZEYczaD.js";import{A as ws}from"./arrow-right-BrYOnItf.js";import{U as Ge}from"./user-plus-CgA2QXux.js";import{S as Ve}from"./square-check-big-grc8ESP1.js";import{C as Cs}from"./chevron-down-DvtyaUz8.js";import{F as Ss}from"./file-braces-AIP1E2es.js";import{U as ks}from"./upload-C1xl8nMH.js";import{F as As}from"./funnel-DXgEGOkL.js";import{S as ye}from"./star-Dro_83QX.js";import"./index-C1otBg8B.js";import"./chevron-up-CuIutfHG.js";import"./send-YzE2e0_Q.js";import"./pen-EvlKYdM2.js";import"./circle-BenonAoa.js";const Es=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],Rs=te("file-spreadsheet",Es);const Fs=[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]],tt=te("linkedin",Fs);const Ts=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],st=te("map-pin",Ts);const Is=[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]],Be=te("merge",Is);const Ps=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Ue=te("phone",Ps);const _s=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],$s=te("square",_s);const Ds=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],at=te("sticky-note",Ds);var zs=Symbol.for("react.lazy"),Se=Gt[" use ".trim().toString()];function Ms(t){return typeof t=="object"&&t!==null&&"then"in t}function rt(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===zs&&"_payload"in t&&Ms(t._payload)}function Us(t){const r=Ls(t),n=i.forwardRef((c,o)=>{let{children:m,...x}=c;rt(m)&&typeof Se=="function"&&(m=Se(m._payload));const p=i.Children.toArray(m),v=p.find(Gs);if(v){const N=v.props.children,u=p.map(b=>b===v?i.Children.count(N)>1?i.Children.only(null):i.isValidElement(N)?N.props.children:null:b);return e.jsx(r,{...x,ref:o,children:i.isValidElement(N)?i.cloneElement(N,void 0,u):null})}return e.jsx(r,{...x,ref:o,children:m})});return n.displayName=`${t}.Slot`,n}function Ls(t){const r=i.forwardRef((n,c)=>{let{children:o,...m}=n;if(rt(o)&&typeof Se=="function"&&(o=Se(o._payload)),i.isValidElement(o)){const x=Bs(o),p=Vs(m,o.props);return o.type!==i.Fragment&&(p.ref=c?us(c,x):x),i.cloneElement(o,p)}return i.Children.count(o)>1?i.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var Os=Symbol("radix.slottable");function Gs(t){return i.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Os}function Vs(t,r){const n={...r};for(const c in r){const o=t[c],m=r[c];/^on[A-Z]/.test(c)?o&&m?n[c]=(...p)=>{const v=m(...p);return o(...p),v}:o&&(n[c]=o):c==="style"?n[c]={...o,...m}:c==="className"&&(n[c]=[o,m].filter(Boolean).join(" "))}return{...t,...n}}function Bs(t){let r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=r&&"isReactWarning"in r&&r.isReactWarning;return n?t.ref:(r=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=r&&"isReactWarning"in r&&r.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Ks=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],qs=Ks.reduce((t,r)=>{const n=Us(`Primitive.${r}`),c=i.forwardRef((o,m)=>{const{asChild:x,...p}=o,v=x?n:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(v,{...p,ref:m})});return c.displayName=`Primitive.${r}`,{...t,[r]:c}},{}),Ws="Label",nt=i.forwardRef((t,r)=>e.jsx(qs.label,{...t,ref:r,onMouseDown:n=>{n.target.closest("button, input, select, textarea")||(t.onMouseDown?.(n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));nt.displayName=Ws;var it=nt;const Hs=Vt,Ys=(t,r)=>n=>Hs(t,n?.class,n?.className),Js=Ys("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ee=i.forwardRef(({className:t,...r},n)=>e.jsx(it,{ref:n,className:pe(Js(),t),...r}));ee.displayName=it.displayName;const ot=i.forwardRef(({className:t,...r},n)=>e.jsx("textarea",{className:pe("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...r}));ot.displayName="Textarea";const Qs=({contact:t,onSubmit:r,onCancel:n,mode:c})=>{const[o,m]=i.useState({name:"",role:"",organization:"",email:"",phone:"",linkedin:"",avatarUrl:"",department:"",location:"",timezone:"",notes:"",aliases:[]}),[x,p]=i.useState(""),[v,N]=i.useState([]),[u,b]=i.useState([]),[f,$]=i.useState([]);i.useEffect(()=>{(async()=>{try{const[j,F,D]=await Promise.all([_.get("/api/role-templates"),_.get("/api/timezones"),_.get("/api/contacts/metadata/companies")]),O=j.roles||[],A=F.timezones||[],G=D.companies||[];N(O),b(A),$(G)}catch(j){console.error("Failed to load metadata",j)}})(),t&&m({name:t.name,role:t.role,organization:t.organization,email:t.email||"",phone:t.phone||"",linkedin:t.linkedin||"",avatarUrl:xe(t)||"",department:t.department||"",location:t.location||"",timezone:t.timezone||"",notes:t.notes||"",aliases:t.aliases||[]})},[t]);const P=()=>{!o.name.trim()||!o.role.trim()||r({name:o.name.trim(),role:o.role.trim(),organization:o.organization.trim()||"Unknown",email:o.email.trim()||void 0,phone:o.phone.trim()||void 0,linkedin:o.linkedin.trim()||void 0,avatarUrl:o.avatarUrl.trim()||void 0,department:o.department.trim()||void 0,location:o.location.trim()||void 0,timezone:o.timezone.trim()||void 0,notes:o.notes.trim()||void 0,aliases:o.aliases})},T=(l,j)=>m(F=>({...F,[l]:j})),g=()=>{x.trim()&&!o.aliases.includes(x.trim())&&(m(l=>({...l,aliases:[...l.aliases,x.trim()]})),p(""))},R=l=>{m(j=>({...j,aliases:j.aliases.filter(F=>F!==l)}))},k=({icon:l,label:j,id:F,placeholder:D,value:O,type:A="text",required:G=!1})=>e.jsxs("div",{children:[e.jsxs(ee,{htmlFor:F,className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(l,{className:"w-3.5 h-3.5"})," ",j," ",G&&"*"]}),e.jsx(Oe,{id:F,type:A,placeholder:D,value:O,onChange:z=>T(F,z.target.value)})]});return e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:[e.jsx("div",{className:"col-span-2 sm:col-span-1",children:e.jsx(k,{icon:oe,label:"Name",id:"name",placeholder:"Full name",value:o.name,required:!0})}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs(ee,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Role *"]}),e.jsxs(le,{value:o.role,onValueChange:l=>T("role",l),children:[e.jsx(ce,{className:"w-full",children:e.jsx(de,{placeholder:"Select role..."})}),e.jsx(me,{children:v.filter(l=>l&&(l.name||l.display_name)).map(l=>e.jsx(Q,{value:l.display_name||l.name||"Unknown",children:l.display_name||l.name||"Unknown Role"},l.id||l.name))})]})]}),e.jsx(k,{icon:Ce,label:"Email",id:"email",placeholder:"email@example.com",value:o.email,type:"email"}),e.jsx(k,{icon:Ue,label:"Phone",id:"phone",placeholder:"+351 900 000 000",value:o.phone,type:"tel"}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs(ee,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(ze,{className:"w-3.5 h-3.5"})," Organization"]}),e.jsxs(le,{value:o.organization,onValueChange:l=>T("organization",l),children:[e.jsx(ce,{className:"w-full",children:e.jsx(de,{placeholder:"Select organization..."})}),e.jsx(me,{children:f.filter(l=>l&&l.name).map(l=>e.jsx(Q,{value:l.name||"Unknown",children:l.name||"Unknown Company"},l.id||l.name))})]})]}),e.jsx(k,{icon:tt,label:"LinkedIn",id:"linkedin",placeholder:"https://linkedin.com/in/...",value:o.linkedin}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs(ee,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Aliases"]}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(Oe,{value:x,onChange:l=>p(l.target.value),placeholder:"Add alias (e.g. nickname, alternate name)",onKeyDown:l=>l.key==="Enter"&&(l.preventDefault(),g())}),e.jsx(L,{type:"button",size:"sm",onClick:g,variant:"secondary",children:"Add"})]}),o.aliases.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:o.aliases.map(l=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-secondary text-xs",children:[l,e.jsx("button",{onClick:()=>R(l),className:"hover:text-destructive",children:"×"})]},l))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(k,{icon:gs,label:"Avatar URL",id:"avatarUrl",placeholder:"https://...",value:o.avatarUrl}),!o.avatarUrl&&e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Enter a URL to set the contact's profile picture"})]}),e.jsx(k,{icon:ue,label:"Department",id:"department",placeholder:"Engineering, Sales, etc.",value:o.department}),e.jsx(k,{icon:st,label:"Location",id:"location",placeholder:"e.g. Lisbon, Portugal",value:o.location}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs(ee,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"})," Timezone"]}),e.jsxs(le,{value:o.timezone,onValueChange:l=>T("timezone",l),children:[e.jsx(ce,{className:"w-full",children:e.jsx(de,{placeholder:"Select timezone..."})}),e.jsx(me,{children:u.filter(l=>l&&l.name).map(l=>e.jsxs(Q,{value:l.code||l.name,children:[l.name||"Unknown Timezone"," (",l.code,")"]},l.id||l.code||l.name))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs(ee,{htmlFor:"notes",className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(at,{className:"w-3.5 h-3.5"})," Notes"]}),e.jsx(ot,{id:"notes",placeholder:"Additional notes...",value:o.notes,onChange:l=>T("notes",l.target.value),rows:2})]})]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(L,{variant:"outline",onClick:n,className:"flex-1",children:"Cancel"}),e.jsx(L,{onClick:P,disabled:!o.name.trim()||!o.role.trim(),className:"flex-1 gap-1.5",children:c==="add"?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4"})," Add Contact"]}):e.jsxs(e.Fragment,{children:[e.jsx(vs,{className:"w-4 h-4"})," Save Changes"]})})]})]})};var Pe="rovingFocusGroup.onEntryFocus",Zs={bubbles:!1,cancelable:!0},he="RovingFocusGroup",[De,lt,Xs]=hs(he),[ea,ct]=Ye(he,[Xs]),[ta,sa]=ea(he),dt=i.forwardRef((t,r)=>e.jsx(De.Provider,{scope:t.__scopeRovingFocusGroup,children:e.jsx(De.Slot,{scope:t.__scopeRovingFocusGroup,children:e.jsx(aa,{...t,ref:r})})}));dt.displayName=he;var aa=i.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,orientation:c,loop:o=!1,dir:m,currentTabStopId:x,defaultCurrentTabStopId:p,onCurrentTabStopIdChange:v,onEntryFocus:N,preventScrollOnEntryFocus:u=!1,...b}=t,f=i.useRef(null),$=ps(r,f),P=Qe(m),[T,g]=Je({prop:x,defaultProp:p??null,onChange:v,caller:he}),[R,k]=i.useState(!1),l=bs(N),j=lt(n),F=i.useRef(!1),[D,O]=i.useState(0);return i.useEffect(()=>{const A=f.current;if(A)return A.addEventListener(Pe,l),()=>A.removeEventListener(Pe,l)},[l]),e.jsx(ta,{scope:n,orientation:c,dir:P,loop:o,currentTabStopId:T,onItemFocus:i.useCallback(A=>g(A),[g]),onItemShiftTab:i.useCallback(()=>k(!0),[]),onFocusableItemAdd:i.useCallback(()=>O(A=>A+1),[]),onFocusableItemRemove:i.useCallback(()=>O(A=>A-1),[]),children:e.jsx(ne.div,{tabIndex:R||D===0?-1:0,"data-orientation":c,...b,ref:$,style:{outline:"none",...t.style},onMouseDown:q(t.onMouseDown,()=>{F.current=!0}),onFocus:q(t.onFocus,A=>{const G=!F.current;if(A.target===A.currentTarget&&G&&!R){const z=new CustomEvent(Pe,Zs);if(A.currentTarget.dispatchEvent(z),!z.defaultPrevented){const W=j().filter(U=>U.focusable),H=W.find(U=>U.active),M=W.find(U=>U.id===T),B=[H,M,...W].filter(Boolean).map(U=>U.ref.current);ut(B,u)}}F.current=!1}),onBlur:q(t.onBlur,()=>k(!1))})})}),mt="RovingFocusGroupItem",xt=i.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:n,focusable:c=!0,active:o=!1,tabStopId:m,children:x,...p}=t,v=Ze(),N=m||v,u=sa(mt,n),b=u.currentTabStopId===N,f=lt(n),{onFocusableItemAdd:$,onFocusableItemRemove:P,currentTabStopId:T}=u;return i.useEffect(()=>{if(c)return $(),()=>P()},[c,$,P]),e.jsx(De.ItemSlot,{scope:n,id:N,focusable:c,active:o,children:e.jsx(ne.span,{tabIndex:b?0:-1,"data-orientation":u.orientation,...p,ref:r,onMouseDown:q(t.onMouseDown,g=>{c?u.onItemFocus(N):g.preventDefault()}),onFocus:q(t.onFocus,()=>u.onItemFocus(N)),onKeyDown:q(t.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){u.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const R=ia(g,u.orientation,u.dir);if(R!==void 0){if(g.metaKey||g.ctrlKey||g.altKey||g.shiftKey)return;g.preventDefault();let l=f().filter(j=>j.focusable).map(j=>j.ref.current);if(R==="last")l.reverse();else if(R==="prev"||R==="next"){R==="prev"&&l.reverse();const j=l.indexOf(g.currentTarget);l=u.loop?oa(l,j+1):l.slice(j+1)}setTimeout(()=>ut(l))}}),children:typeof x=="function"?x({isCurrentTabStop:b,hasTabStop:T!=null}):x})})});xt.displayName=mt;var ra={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function na(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function ia(t,r,n){const c=na(t.key,n);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(c))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(c)))return ra[c]}function ut(t,r=!1){const n=document.activeElement;for(const c of t)if(c===n||(c.focus({preventScroll:r}),document.activeElement!==n))return}function oa(t,r){return t.map((n,c)=>t[(r+c)%t.length])}var la=dt,ca=xt,ke="Tabs",[da]=Ye(ke,[ct]),pt=ct(),[ma,Le]=da(ke),ht=i.forwardRef((t,r)=>{const{__scopeTabs:n,value:c,onValueChange:o,defaultValue:m,orientation:x="horizontal",dir:p,activationMode:v="automatic",...N}=t,u=Qe(p),[b,f]=Je({prop:c,onChange:o,defaultProp:m??"",caller:ke});return e.jsx(ma,{scope:n,baseId:Ze(),value:b,onValueChange:f,orientation:x,dir:u,activationMode:v,children:e.jsx(ne.div,{dir:u,"data-orientation":x,...N,ref:r})})});ht.displayName=ke;var gt="TabsList",ft=i.forwardRef((t,r)=>{const{__scopeTabs:n,loop:c=!0,...o}=t,m=Le(gt,n),x=pt(n);return e.jsx(la,{asChild:!0,...x,orientation:m.orientation,dir:m.dir,loop:c,children:e.jsx(ne.div,{role:"tablist","aria-orientation":m.orientation,...o,ref:r})})});ft.displayName=gt;var vt="TabsTrigger",bt=i.forwardRef((t,r)=>{const{__scopeTabs:n,value:c,disabled:o=!1,...m}=t,x=Le(vt,n),p=pt(n),v=Nt(x.baseId,c),N=wt(x.baseId,c),u=c===x.value;return e.jsx(ca,{asChild:!0,...p,focusable:!o,active:u,children:e.jsx(ne.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":N,"data-state":u?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:v,...m,ref:r,onMouseDown:q(t.onMouseDown,b=>{!o&&b.button===0&&b.ctrlKey===!1?x.onValueChange(c):b.preventDefault()}),onKeyDown:q(t.onKeyDown,b=>{[" ","Enter"].includes(b.key)&&x.onValueChange(c)}),onFocus:q(t.onFocus,()=>{const b=x.activationMode!=="manual";!u&&!o&&b&&x.onValueChange(c)})})})});bt.displayName=vt;var jt="TabsContent",yt=i.forwardRef((t,r)=>{const{__scopeTabs:n,value:c,forceMount:o,children:m,...x}=t,p=Le(jt,n),v=Nt(p.baseId,c),N=wt(p.baseId,c),u=c===p.value,b=i.useRef(u);return i.useEffect(()=>{const f=requestAnimationFrame(()=>b.current=!1);return()=>cancelAnimationFrame(f)},[]),e.jsx(js,{present:o||u,children:({present:f})=>e.jsx(ne.div,{"data-state":u?"active":"inactive","data-orientation":p.orientation,role:"tabpanel","aria-labelledby":v,hidden:!f,id:N,tabIndex:0,...x,ref:r,style:{...t.style,animationDuration:b.current?"0s":void 0},children:f&&m})})});yt.displayName=jt;function Nt(t,r){return`${t}-trigger-${r}`}function wt(t,r){return`${t}-content-${r}`}var xa=ht,Ct=ft,St=bt,kt=yt;const ua=xa,At=i.forwardRef(({className:t,...r},n)=>e.jsx(Ct,{ref:n,className:pe("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...r}));At.displayName=Ct.displayName;const Et=i.forwardRef(({className:t,...r},n)=>e.jsx(St,{ref:n,className:pe("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...r}));Et.displayName=St.displayName;const re=i.forwardRef(({className:t,...r},n)=>e.jsx(kt,{ref:n,className:pe("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r}));re.displayName=kt.displayName;const Ke=["from-rose-400 to-pink-500","from-violet-400 to-purple-500","from-blue-400 to-cyan-500","from-emerald-400 to-teal-500","from-amber-400 to-orange-500","from-fuchsia-400 to-pink-500"],pa=t=>{let r=0;for(let n=0;n<t.length;n++)r=t.charCodeAt(n)+((r<<5)-r);return Ke[Math.abs(r)%Ke.length]},V=({icon:t,label:r,value:n})=>n?e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-2.5 border-b border-white/10 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(t,{className:"w-4 h-4 text-blue-400"})," ",r]}),e.jsx("p",{className:"text-sm text-white break-all",children:n})]}):null,ha=({contact:t,open:r,onClose:n,onEdit:c,onDelete:o,onUpdateProjects:m})=>{const[x,p]=i.useState("info"),[v,N]=i.useState(!1),[u,b]=i.useState([]),[f,$]=i.useState([]),[P,T]=i.useState(null),[g,R]=i.useState([]),[k,l]=i.useState([]),[j,F]=i.useState([]),[D,O]=i.useState([]),A=We(),G=Bt(),z=Kt(),[W,H]=i.useState(!1),[M,se]=i.useState(""),[B,U]=i.useState("works_with"),[K,Ae]=i.useState(null),[ge,Y]=i.useState(null);i.useEffect(()=>{t&&r&&(Z(),Y(xe(t)))},[t,r]);const Z=async()=>{if(t){N(!0);try{const a=await _.get("/api/projects");b(Array.isArray(a)?a:a.projects||[]);const S=(await _.get(`/api/contacts/${t.id}/projects`)).projects||[],E=S.map(I=>I.id);$(E);const ae=S.find(I=>I.is_primary);T(ae?ae.id:E[0]||null);const be=await _.get(`/api/contacts/${t.id}/relationships`);R(be.relationships||[]);const J=await _.get(`/api/contacts/${t.id}/activity`);l(J.activities||[]);try{const I=await _.get(`/api/contacts/${t.id}/mentions`);F(I.mentions||[])}catch(I){console.error("Error loading mentions",I)}const X=(await _.get("/api/contacts")).contacts||[];O(X.filter(I=>I.id!==t.id))}catch(a){console.error("Error loading contact details:",a)}finally{N(!1)}}};if(!t)return null;const fe=async a=>{const C=f.includes(a);try{C?(await _.delete(`/api/contacts/${t.id}/projects/${a}`),$(S=>S.filter(E=>E!==a)),P===a&&T(null)):(await _.post(`/api/contacts/${t.id}/projects`,{projectId:a}),$(S=>[...S,a]),P||T(a)),m?.(t.id,f,P)}catch(S){console.error("Error toggling project:",S)}},ve=async a=>{try{f.includes(a)?await _.post(`/api/contacts/${t.id}/projects`,{projectId:a,isPrimary:!0}):(await _.post(`/api/contacts/${t.id}/projects`,{projectId:a,isPrimary:!0}),$(C=>[...C,a])),T(a)}catch(C){console.error("Error setting primary project",C)}},Ee=async()=>{if(M)try{const a=D.find(E=>E.id===M);if(!a)return;const S=(await _.post(`/api/contacts/${t.id}/relationships`,{toContactId:a.id,type:B})).relationship;R(E=>[...E,{id:S.id,type:B,direction:"forward",other_contact:{id:a.id,name:a.name,role:a.role,avatarUrl:a.avatarUrl}}]),se(""),H(!1)}catch(a){console.error("Error adding relationship:",a)}};return e.jsx(qt,{open:r,onOpenChange:a=>!a&&n(),children:e.jsxs(Wt,{className:"max-w-2xl p-0 overflow-hidden",children:[e.jsx(Ht,{className:"sr-only",children:"Contact Details"}),e.jsxs("div",{className:`bg-gradient-to-r ${pa(t.name)} p-6 pb-12 relative`,children:[e.jsx("button",{onClick:n,className:"absolute top-3 right-3 text-white/80 hover:text-white transition-colors",children:e.jsx("span",{className:"sr-only",children:"Close"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsxs(L,{variant:"secondary",size:"sm",className:"gap-1.5 bg-white/20 text-white border-0 hover:bg-white/30 backdrop-blur-sm",disabled:A.isPending,onClick:()=>{A.mutate(t.id,{onSuccess:a=>{if(h.success("AI enrichment complete"),a?.suggestions){const C=a.suggestions,S=[];C.role&&S.push(`Role: ${C.role}`),C.department&&S.push(`Dept: ${C.department}`),C.tags&&S.push(`Tags: ${C.tags.join(", ")}`),S.length&&h.info(S.join(" | "))}Z()},onError:()=>h.error("Enrichment failed")})},children:[A.isPending?e.jsx(_e,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Xe,{className:"w-3.5 h-3.5"})," Enrich AI"]}),e.jsxs(L,{variant:"secondary",size:"sm",className:"gap-1.5 bg-white/20 text-white border-0 hover:bg-white/30 backdrop-blur-sm",disabled:z.isPending,onClick:()=>{const a=t.display_name||t.name||"";if(!a){h.error("No participant name to unlink");return}z.mutate(a,{onSuccess:()=>h.success(`Unlinked participant "${a}"`),onError:()=>h.error("Unlink failed")})},children:[z.isPending?e.jsx(_e,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(et,{className:"w-3.5 h-3.5"})," Unlink"]}),e.jsx(L,{variant:"secondary",size:"sm",className:"gap-1.5 bg-white/20 text-white border-0 hover:bg-white/30 backdrop-blur-sm",onClick:()=>c(t),children:"Edit"})]})]}),e.jsx("div",{className:"px-6 -mt-10 relative z-10",children:e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsx(fs,{currentUrl:ge,name:t.name,uploadEndpoint:`/api/contacts/${t.id}/avatar`,deleteEndpoint:`/api/contacts/${t.id}/avatar`,onUploaded:a=>{Y(a),Z()},onRemoved:()=>{Y(null),Z()},size:"md",showUrlInput:!1,className:"!gap-0"}),e.jsxs("div",{className:"pb-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:t.name||"(unnamed)"}),e.jsxs("p",{className:"text-sm text-slate-300",children:[t.role||t.cargo||"—",(t.organization||t.empresa)&&` · ${t.organization||t.empresa}`]})]})]})}),e.jsx("div",{className:"px-6 mt-4",children:e.jsxs(ua,{value:x,onValueChange:p,children:[e.jsx(At,{className:"w-full justify-start bg-transparent border-b border-white/10 rounded-none h-auto p-0 gap-0",children:[{id:"info",label:"Info",icon:oe,count:void 0},{id:"projects",label:"Projects",icon:Yt,count:f.length},{id:"relations",label:"Relations",icon:Ie,count:g.length},{id:"mentions",label:"Mentions",icon:Fe,count:j.length},{id:"activity",label:"Activity",icon:Ne,count:k.length>0?k.length:void 0}].map(a=>e.jsxs(Et,{value:a.id,className:"rounded-none border-b-2 border-transparent data-[state=active]:border-blue-500 data-[state=active]:text-blue-400 data-[state=active]:shadow-none bg-transparent text-slate-400 hover:text-slate-200 px-4 py-2.5 text-sm gap-1.5",children:[e.jsx(a.icon,{className:"w-3.5 h-3.5"}),a.label,a.count!==void 0&&e.jsx("span",{className:"ml-1 text-[10px] px-1.5 py-0.5 rounded-full bg-blue-500/10 text-blue-400 font-semibold",children:a.count})]},a.id))}),e.jsx(re,{value:"info",className:"mt-4 pb-0",children:e.jsxs("div",{className:"divide-y divide-white/10",children:[e.jsx(V,{icon:oe,label:"Name *",value:t.name}),e.jsx(V,{icon:ue,label:"Role",value:t.role}),e.jsx(V,{icon:Ce,label:"Email",value:t.email}),e.jsx(V,{icon:Ue,label:"Phone",value:t.phone}),e.jsx(V,{icon:ze,label:"Organization",value:t.organization}),e.jsx(V,{icon:tt,label:"LinkedIn",value:t.linkedin}),e.jsx(V,{icon:ue,label:"Department",value:t.department}),e.jsx(V,{icon:st,label:"Location",value:t.location}),e.jsx(V,{icon:Ns,label:"Timezone",value:t.timezone}),t.aliases&&t.aliases.length>0&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-2.5 border-b border-white/10 last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(oe,{className:"w-4 h-4 text-blue-400"})," Aliases"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.aliases.map(a=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-white/5 rounded text-slate-400",children:a},a))})]}),t.notes&&e.jsx(V,{icon:at,label:"Notes",value:t.notes})]})}),e.jsx(re,{value:"projects",className:"mt-4 pb-0",children:e.jsx("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:u.map(a=>{const C=f.includes(a.id),S=P===a.id;return e.jsxs("div",{className:"flex items-center justify-between py-2.5 border-b border-white/10 last:border-0 hover:bg-white/5 px-2 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1",onClick:()=>fe(a.id),children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${C?"border-blue-500 bg-blue-600":"border-white/20 hover:border-slate-400"}`,children:C&&e.jsx(Te,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm ${C?"text-white":"text-slate-400"}`,children:a.name}),a.description&&e.jsx("span",{className:"text-[10px] text-slate-400 truncate max-w-[200px]",children:a.description})]})]}),S?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-blue-600 text-white font-semibold",children:"Primary"}):C?e.jsx("button",{onClick:E=>{E.stopPropagation(),ve(a.id)},className:"text-[10px] px-2 py-0.5 rounded bg-white/5 text-slate-400 hover:text-white transition-colors",children:"Set Primary"}):null]},a.id)})})}),e.jsxs(re,{value:"relations",className:"mt-4 pb-0",children:[g.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:g.map((a,C)=>{const S=(a.type||"").replace("_"," "),E=a.other_contact?.name||"Unknown";return e.jsxs("div",{className:"flex items-center gap-3 py-2.5 border-b border-white/10 last:border-0 group/rel",children:[e.jsx(Ie,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"flex-1 flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-white",children:t.name}),e.jsx("span",{className:"text-slate-400 text-xs px-1 bg-white/5 rounded",children:S}),e.jsx("span",{className:"font-medium text-white",children:E})]}),e.jsx("button",{className:"opacity-0 group-hover/rel:opacity-100 transition-opacity text-red-400/60 hover:text-red-400",title:"Remove relationship",onClick:()=>{a.other_contact?.id&&G.mutate({contactId:t.id,toContactId:a.other_contact.id,type:a.type},{onSuccess:()=>{R(ae=>ae.filter((be,J)=>J!==C)),h.success("Relationship removed")},onError:()=>h.error("Failed to remove relationship")})},children:e.jsx(we,{className:"w-3.5 h-3.5"})})]},C)})}):e.jsxs("div",{className:"flex flex-col items-center py-8 text-slate-400",children:[e.jsx(Ie,{className:"w-10 h-10 mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No relationships yet"})]}),W?e.jsxs("div",{className:"mt-3 p-3 rounded-lg border border-white/10 bg-white/5 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(le,{value:M,onValueChange:se,children:[e.jsx(ce,{className:"text-sm",children:e.jsx(de,{placeholder:"Select contact"})}),e.jsx(me,{children:D.map(a=>e.jsx(Q,{value:a.id,children:a.name},a.id))})]}),e.jsxs(le,{value:B,onValueChange:U,children:[e.jsx(ce,{className:"text-sm",children:e.jsx(de,{})}),e.jsxs(me,{children:[e.jsx(Q,{value:"reports_to",children:"Reports to"}),e.jsx(Q,{value:"manages",children:"Manages"}),e.jsx(Q,{value:"leads",children:"Leads"}),e.jsx(Q,{value:"works_with",children:"Works with"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{H(!1),se("")},children:"Cancel"}),e.jsx(L,{size:"sm",className:"flex-1",disabled:!M,onClick:Ee,children:"Add"})]})]}):e.jsxs("button",{onClick:()=>H(!0),className:"flex items-center gap-1.5 text-sm text-slate-400 hover:text-white mt-4 transition-colors",children:[e.jsx(Me,{className:"w-4 h-4"})," Add Relationship"]})]}),e.jsx(re,{value:"mentions",className:"mt-4 pb-0",children:j.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 pb-2 overflow-x-auto",children:["all","document","email","conversation"].map(a=>e.jsxs("button",{onClick:()=>Ae(a==="all"?null:a),className:`text-xs px-2.5 py-1 rounded-full border transition-colors ${K===a||K===null&&a==="all"?"bg-blue-500/10 text-blue-400 border-blue-500/20":"bg-white/5 text-slate-400 border-transparent hover:bg-white/10 hover:text-slate-200"}`,children:[a.charAt(0).toUpperCase()+a.slice(1),"s"]},a))}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:[j.filter(a=>!K||a.type===K).map(a=>e.jsxs("div",{className:"flex gap-3 py-3 border-b border-white/10 last:border-0 group",children:[e.jsx("div",{className:"mt-0.5",children:a.type==="email"?e.jsx(Ce,{className:"w-3.5 h-3.5 text-blue-400"}):a.type==="conversation"?e.jsx(Fe,{className:"w-3.5 h-3.5 text-violet-400"}):e.jsx(Jt,{className:"w-3.5 h-3.5 text-amber-400"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-xs font-medium text-slate-400 uppercase tracking-wider",children:a.source||"—"}),e.jsx("span",{className:"text-[10px] text-slate-400 whitespace-nowrap ml-2",children:a.date?new Date(a.date).toLocaleDateString():"—"})]}),e.jsxs("p",{className:"text-sm text-white line-clamp-2 bg-white/5 p-2 rounded border border-white/10 italic",children:['"',a.text,'"']}),a.link&&e.jsxs("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-400 hover:underline inline-flex items-center gap-1 mt-1 font-medium transition-colors",children:["View Context ",e.jsx(ws,{className:"w-3 h-3"})]})]})]},a.id)),j.filter(a=>!K||a.type===K).length===0&&e.jsx("p",{className:"text-center text-sm text-slate-400 py-8",children:"No mentions found for this filter"})]})]}):e.jsxs("div",{className:"flex flex-col items-center py-8 text-slate-400",children:[e.jsx(Fe,{className:"w-10 h-10 mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No mentions found"})]})}),e.jsx(re,{value:"activity",className:"mt-4 pb-0",children:k.length>0?e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:k.map(a=>e.jsxs("div",{className:"flex items-center gap-3 py-2.5 border-b border-white/10 last:border-0",children:[a.status==="completed"||a.status==="approved"?e.jsx(Te,{className:"w-4 h-4 text-emerald-500 shrink-0"}):a.status==="overdue"||a.status==="rejected"?e.jsx($e,{className:"w-4 h-4 text-red-400 shrink-0"}):e.jsx(Ne,{className:"w-4 h-4 text-slate-400 shrink-0"}),e.jsx("span",{className:"text-sm text-white flex-1 truncate",children:a.description}),e.jsx("span",{className:"text-[10px] text-slate-400 shrink-0",children:a.date?new Date(a.date).toLocaleDateString():"—"})]},`${a.type}-${a.id}`))}):e.jsxs("div",{className:"flex flex-col items-center py-8 text-slate-400",children:[e.jsx(Ne,{className:"w-10 h-10 mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No activity recorded yet"})]})})]})}),e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-white/10 mt-4",children:[e.jsxs(L,{variant:"outline",size:"sm",className:"text-red-400 border-red-400/30 hover:bg-red-500/10 gap-1.5",onClick:()=>o(t.id),children:[e.jsx(Qt,{className:"w-3.5 h-3.5"})," Delete"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",className:"text-slate-300 border-white/20 hover:bg-white/10",onClick:n,children:"Cancel"}),e.jsxs(L,{size:"sm",className:"gap-1.5 bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>c(t),children:[e.jsx(Te,{className:"w-3.5 h-3.5"})," Save Changes"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(ys,{targetType:"contact",targetId:t.id})})]})})},qe=["from-rose-400 to-pink-500","from-violet-400 to-purple-500","from-blue-400 to-cyan-500","from-emerald-400 to-teal-500","from-amber-400 to-orange-500","from-fuchsia-400 to-pink-500"],Rt=t=>{let r=0;for(let n=0;n<t.length;n++)r=t.charCodeAt(n)+((r<<5)-r);return qe[Math.abs(r)%qe.length]};function ga({contact:t,size:r="md"}){const n=String(t.name||"?"),c=xe(t),o=r==="sm"?"w-7 h-7":r==="lg"?"w-16 h-16":"w-10 h-10",m=r==="sm"?"text-[9px]":r==="lg"?"text-lg":"text-xs";return e.jsx("div",{className:`${o} rounded-full bg-gradient-to-br ${Rt(n)} flex items-center justify-center flex-shrink-0 overflow-hidden`,children:c?e.jsx("img",{src:c,alt:n,className:"w-full h-full rounded-full object-cover",onError:x=>{x.target.style.display="none"}}):e.jsx("span",{className:`${m} font-bold text-white`,children:He(n)})})}function Ga(){const[t,r]=i.useState(""),[n,c]=i.useState(!1),[o,m]=i.useState(null),[x,p]=i.useState(null),[v,N]=i.useState(""),[u,b]=i.useState(""),[f,$]=i.useState(!1),[P,T]=i.useState(!1),[g,R]=i.useState(new Set),[k,l]=i.useState(!1),[j,F]=i.useState(!1),[D,O]=i.useState({}),[A,G]=i.useState(!1),z=i.useRef(null),[W,H]=i.useState(!1),[M,se]=i.useState({}),B=Zt({search:t||void 0,organization:v||void 0}),U=Xt(),K=es(),Ae=ts(),ge=ss(),Y=as(),Z=We(),fe=rs(),ve=ns(),Ee=is(),a=os(),C=ls(),S=B.data,E=Array.isArray(S)?S:S?.contacts??[],ae=i.useMemo(()=>{const s=new Set;return E.forEach(d=>{d.organization&&s.add(d.organization)}),Array.from(s).sort()},[E]),be=i.useMemo(()=>{const s=new Set;return E.forEach(d=>{const y=d.tags;Array.isArray(y)&&y.forEach(w=>s.add(w))}),Array.from(s).sort()},[E]),J=i.useMemo(()=>{let s=E;return u&&(s=s.filter(d=>Array.isArray(d.tags)&&d.tags.includes(u))),f&&(s=s.filter(d=>d.is_favorite||d.isFavorite)),s},[E,u,f]),ie=i.useMemo(()=>E.filter(s=>s.is_favorite||s.isFavorite),[E]),X=ge.data?.duplicates||[],I=Ee.data?.unmatched||[],Ft=s=>{U.mutate(s,{onSuccess:()=>{h.success("Contact created"),c(!1)},onError:()=>h.error("Failed to create contact")})},Tt=s=>{o&&K.mutate({id:o.id,...s},{onSuccess:()=>{h.success("Contact updated"),m(null),c(!1)},onError:()=>h.error("Failed to update contact")})},It=s=>{Ae.mutate(s,{onSuccess:()=>{h.success("Contact deleted"),p(null)},onError:()=>h.error("Failed to delete contact")})},Pt=s=>{p(null),m(s),c(!0)},_t=s=>{const d=s.is_favorite||s.isFavorite;K.mutate({id:s.id,is_favorite:!d},{onSuccess:()=>h.success(d?"Removed from favorites":"Added to favorites"),onError:()=>h.error("Failed to update")})},$t=s=>{R(d=>{const y=new Set(d);return y.has(s)?y.delete(s):y.add(s),y})},Dt=()=>{if(g.size<2){h.error("Select at least 2 contacts to merge");return}Y.mutate(Array.from(g),{onSuccess:()=>{h.success("Contacts merged"),R(new Set),l(!1)},onError:()=>h.error("Merge failed")})},zt=(s,d)=>{if(!D[s]){h.error("Select a primary contact");return}const w=d.map(je=>je.id);Y.mutate(w,{onSuccess:()=>{h.success("Duplicates merged"),ge.refetch()},onError:()=>h.error("Merge failed")})},Mt=s=>{Z.mutate(s,{onSuccess:d=>{if(h.success("AI enrichment complete"),d?.suggestions){const y=d.suggestions,w=[];y.role&&w.push(`Role: ${y.role}`),y.department&&w.push(`Dept: ${y.department}`),y.tags&&w.push(`Tags: ${y.tags.join(", ")}`),w.length&&h.info(w.join(" | "))}B.refetch()},onError:()=>h.error("Enrichment failed")})},Ut=s=>{const d=s.target.files?.[0];if(!d)return;const y=new FileReader;y.onload=()=>{const w=y.result;if(d.name.endsWith(".csv"))ve.mutate({format:"csv",data:w},{onSuccess:Re=>{h.success(`Imported ${Re?.added||0} contacts`),G(!1)},onError:()=>h.error("Import failed")});else try{const Re=JSON.parse(w);ve.mutate({format:"json",data:Re},{onSuccess:Ot=>{h.success(`Imported ${Ot?.added||0} contacts`),G(!1)},onError:()=>h.error("Import failed")})}catch{h.error("Invalid JSON file")}},y.readAsText(d),s.target.value=""},Lt=(s,d)=>{a.mutate({participantName:s,contactId:d},{onSuccess:()=>h.success(`Linked "${s}"`),onError:()=>h.error("Link failed")})};return n?e.jsxs("div",{className:"p-6 max-w-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:()=>{c(!1),m(null)},className:"w-8 h-8 rounded-lg bg-[var(--gm-bg-tertiary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(we,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsx("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:o?"Edit Contact":"Add Contact"})]}),e.jsx("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-5",children:e.jsx(Qs,{contact:o,mode:o?"edit":"add",onSubmit:o?Tt:Ft,onCancel:()=>{c(!1),m(null)}})})]}):e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:"Contacts"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>C.mutate(void 0,{onSuccess:s=>h.success(`Synced: ${s?.added||0} added`),onError:()=>h.error("Sync failed")}),className:"px-2.5 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",title:"Sync people from documents to contacts",children:[e.jsx(cs,{className:`w-3.5 h-3.5 ${C.isPending?"animate-spin":""}`})," Sync People"]}),I.length>0&&e.jsxs("button",{onClick:()=>H(!W),className:"px-2.5 py-1.5 rounded-lg bg-amber-500/10 text-amber-600 text-xs hover:bg-amber-500/20 flex items-center gap-1.5",children:[e.jsx(Ge,{className:"w-3.5 h-3.5"})," ",I.length," Unmatched"]}),X.length>0&&e.jsxs("button",{onClick:()=>F(!j),className:"px-2.5 py-1.5 rounded-lg bg-orange-500/10 text-orange-600 text-xs hover:bg-orange-500/20 flex items-center gap-1.5",children:[e.jsx($e,{className:"w-3.5 h-3.5"})," ",X.length," Duplicate groups"]}),e.jsxs("button",{onClick:()=>{l(!k),R(new Set)},className:`px-2.5 py-1.5 rounded-lg text-xs flex items-center gap-1.5 ${k?"bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)]":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsx(Ve,{className:"w-3.5 h-3.5"})," Select"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"px-2.5 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ds,{className:"w-3.5 h-3.5"})," Export ",e.jsx(Cs,{className:"w-3 h-3"})]}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-20 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>fe.mutate("json"),className:"w-full px-3 py-2 text-xs text-left hover:bg-[var(--gm-surface-hover)] flex items-center gap-2 rounded-t-lg",children:[e.jsx(Ss,{className:"w-3.5 h-3.5"})," JSON"]}),e.jsxs("button",{onClick:()=>fe.mutate("csv"),className:"w-full px-3 py-2 text-xs text-left hover:bg-[var(--gm-surface-hover)] flex items-center gap-2 rounded-b-lg",children:[e.jsx(Rs,{className:"w-3.5 h-3.5"})," CSV"]})]})]}),e.jsxs("button",{onClick:()=>z.current?.click(),className:"px-2.5 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ks,{className:"w-3.5 h-3.5"})," Import"]}),e.jsx("input",{ref:z,type:"file",accept:".json,.csv",className:"hidden",onChange:Ut}),e.jsxs("button",{onClick:()=>{m(null),c(!0)},className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-xs font-medium hover:bg-[var(--gm-interactive-primary-hover)] flex items-center gap-1.5",children:[e.jsx(Me,{className:"w-3.5 h-3.5"})," Add Contact"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"relative max-w-sm flex-1 min-w-[200px]",children:[e.jsx(ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{value:t,onChange:s=>r(s.target.value),placeholder:"Search contacts...",className:"w-full pl-9 pr-3 py-1.5 bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg text-xs text-[var(--gm-text-primary)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)]"})]}),e.jsxs("button",{onClick:()=>T(!P),className:`px-2.5 py-1.5 rounded-lg text-xs flex items-center gap-1.5 ${v||u||f?"bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)] border border-[var(--gm-accent-primary)]/30":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsx(As,{className:"w-3.5 h-3.5"})," Filters",(v||u||f)&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-[10px]",children:[v,u,f].filter(Boolean).length})]}),e.jsxs("button",{onClick:()=>$(!f),className:`px-2.5 py-1.5 rounded-lg text-xs flex items-center gap-1.5 ${f?"bg-amber-500/10 text-amber-500 border border-amber-500/30":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsx(ye,{className:`w-3.5 h-3.5 ${f?"fill-amber-500":""}`})," Favorites ",ie.length>0&&`(${ie.length})`]})]}),P&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Organization:"}),e.jsxs("select",{value:v,onChange:s=>N(s.target.value),className:"px-2 py-1 bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)] rounded text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"",children:"All"}),ae.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Tag:"}),e.jsxs("select",{value:u,onChange:s=>b(s.target.value),className:"px-2 py-1 bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)] rounded text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"",children:"All"}),be.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),(v||u)&&e.jsx("button",{onClick:()=>{N(""),b("")},className:"text-xs text-[var(--gm-accent-primary)] hover:underline",children:"Clear filters"})]}),k&&g.size>0&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-[var(--gm-interactive-primary)]/5 border border-[var(--gm-accent-primary)]/20",children:[e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] font-medium",children:[g.size," selected"]}),e.jsxs("button",{onClick:Dt,disabled:g.size<2||Y.isPending,className:"px-2.5 py-1 rounded bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-xs flex items-center gap-1.5 disabled:opacity-50",children:[e.jsx(Be,{className:"w-3.5 h-3.5"})," Merge Selected"]}),e.jsx("button",{onClick:()=>{R(new Set),l(!1)},className:"text-xs text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:"Cancel"})]}),W&&I.length>0&&e.jsxs("div",{className:"p-4 rounded-xl border border-amber-500/30 bg-amber-500/5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-amber-500"})," Unmatched Participants (",I.length,")"]}),e.jsx("button",{onClick:()=>H(!1),className:"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-[11px] text-[var(--gm-text-tertiary)]",children:"These names were found in documents but don't match any contact. Link them to existing contacts."}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:I.map(s=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)]",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)] flex-1",children:s.name}),s.count&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[s.count," mentions"]}),e.jsxs("select",{value:M[s.name]||"",onChange:d=>se(y=>({...y,[s.name]:d.target.value})),className:"px-2 py-1 bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded text-xs max-w-[150px]",children:[e.jsx("option",{value:"",children:"Link to..."}),E.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]}),e.jsxs("button",{disabled:!M[s.name],onClick:()=>M[s.name]&&Lt(s.name,M[s.name]),className:"px-2 py-1 rounded bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-[10px] disabled:opacity-40 flex items-center gap-1",children:[e.jsx(et,{className:"w-3 h-3"})," Link"]})]},s.name))})]}),j&&X.length>0&&e.jsxs("div",{className:"p-4 rounded-xl border border-orange-500/30 bg-orange-500/5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-orange-500"})," Duplicate Groups (",X.length,")"]}),e.jsx("button",{onClick:()=>F(!1),className:"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(we,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:X.map((s,d)=>{const y=Array.isArray(s)?s:s.contacts||[s];return e.jsxs("div",{className:"p-3 rounded-lg bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)] space-y-2",children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:["Group ",d+1," — Select primary"]}),y.map(w=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1 rounded hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("input",{type:"radio",name:`merge-group-${d}`,checked:D[d]===w.id,onChange:()=>O(je=>({...je,[d]:w.id})),className:"accent-primary"}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:w.name}),w.email&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["(",w.email,")"]})]},w.id)),e.jsxs("button",{onClick:()=>zt(d,y),disabled:!D[d]||Y.isPending,className:"px-2.5 py-1 rounded bg-orange-500 text-white text-xs disabled:opacity-50 flex items-center gap-1",children:[e.jsx(Be,{className:"w-3 h-3"})," Merge Group"]})]},d)})})]}),ie.length>0&&!f&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-2 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3 fill-amber-500 text-amber-500"})," Favorites"]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:ie.map(s=>e.jsxs("button",{onClick:()=>p(s),className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] hover:border-[var(--gm-accent-primary)]/30 flex-shrink-0",children:[e.jsx(ga,{contact:s,size:"sm"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:s.name}),s.role&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:s.role})]})]},s.id))})]}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:[J.length," contact",J.length!==1?"s":""]}),B.isLoading?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(_e,{className:"h-8 w-8 animate-spin text-[var(--gm-accent-primary)]"})}):J.length===0?e.jsxs("div",{className:"rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] p-8 text-center text-[var(--gm-text-tertiary)]",children:[e.jsx(xs,{className:"h-12 w-12 mx-auto mb-4 text-[var(--gm-text-tertiary)]/40"}),t||v||u?"No contacts match your filters.":"No contacts found. Add one to get started."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:J.map(s=>{const d=s.is_favorite||s.isFavorite,y=g.has(s.id);return e.jsxs("div",{className:`bg-[var(--gm-surface-primary)] border rounded-xl p-4 hover:border-[var(--gm-accent-primary)]/30 transition-colors cursor-pointer group relative ${y?"border-[var(--gm-accent-primary)] bg-[var(--gm-interactive-primary)]/5":"border-[var(--gm-border-primary)]"}`,onClick:()=>k?$t(s.id):p(s),children:[k&&e.jsx("div",{className:"absolute top-3 left-3 z-10",children:y?e.jsx(Ve,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}):e.jsx($s,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsx("button",{className:"absolute top-3 right-3 z-10 opacity-0 group-hover:opacity-100 transition-opacity",onClick:w=>{w.stopPropagation(),_t(s)},title:d?"Remove from favorites":"Add to favorites",children:e.jsx(ye,{className:`w-4 h-4 ${d?"fill-amber-500 text-amber-500":"text-[var(--gm-text-tertiary)] hover:text-amber-500"}`})}),e.jsx("button",{className:"absolute top-3 right-9 z-10 opacity-0 group-hover:opacity-100 transition-opacity",onClick:w=>{w.stopPropagation(),Mt(s.id)},title:"Enrich with AI",children:e.jsx(Xe,{className:`w-4 h-4 text-violet-400 hover:text-violet-300 ${Z.isPending?"animate-pulse":""}`})}),e.jsxs("div",{className:`flex items-center gap-3 ${k?"ml-5":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${Rt(s.name)} flex items-center justify-center flex-shrink-0 overflow-hidden`,children:xe(s)?e.jsx("img",{src:xe(s),alt:s.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-xs font-bold text-white",children:He(s.name)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate group-hover:text-[var(--gm-accent-primary)] transition-colors",children:[s.name||"(unnamed)",d&&e.jsx(ye,{className:"w-3 h-3 inline ml-1 fill-amber-500 text-amber-500"})]}),s.role&&e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(ue,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] truncate",children:s.role})]})]})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[s.organization&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx(ze,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.organization})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx(Ce,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx(Ue,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.phone})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.tags.slice(0,4).map(w=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:w},w)),s.tags.length>4&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:["+",s.tags.length-4]})]})]})]},s.id)})}),e.jsx(ha,{contact:x,open:!!x,onClose:()=>p(null),onEdit:Pt,onDelete:It})]})}export{Ga as default};
//# sourceMappingURL=ContactsPage-B8GCgG0V.js.map
