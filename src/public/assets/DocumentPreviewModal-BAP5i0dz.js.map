{"version":3,"file":"DocumentPreviewModal-BAP5i0dz.js","sources":["../../frontend/components/modals/DocumentPreviewModal.ts"],"sourcesContent":["/**\n * Document Preview Modal - SOTA\n * Full document preview with AI analysis, versions, activity, sharing\n */\n\nimport { Document, documentsService } from '../../services/documents';\nimport { http } from '../../services/api';\nimport { toast } from '../../services/toast';\nimport { formatRelativeTime, formatFileSize, formatDateTime } from '../../utils/format';\n\nexport interface DocumentPreviewProps {\n  document: Document;\n  onClose?: () => void;\n  onUpdate?: () => void;\n}\n\ninterface DocumentVersion {\n  id: string;\n  version_number: number;\n  is_current: boolean;\n  filename: string;\n  file_size: number;\n  change_notes?: string;\n  ai_change_summary?: string;\n  uploaded_by?: string;\n  created_at: string;\n}\n\ninterface DocumentActivity {\n  id: string;\n  action: string;\n  user_id?: string;\n  user_name?: string;\n  user_avatar?: string;\n  details?: Record<string, unknown>;\n  created_at: string;\n}\n\ninterface AIAnalysis {\n  id: string;\n  document_id: string;\n  analysis_type: string;\n  provider: string;\n  model: string;\n  status: string;\n  entities_extracted?: number;\n  input_tokens?: number;\n  output_tokens?: number;\n  cost?: number;\n  latency_ms?: number;\n  result?: Record<string, unknown>;\n  created_at: string;\n}\n\n// State\nlet currentTab = 'preview';\nlet isFavorite = false;\nlet activeReprocessInterval: ReturnType<typeof setInterval> | null = null;\n\n/**\n * Show document preview modal\n */\nexport function showDocumentPreviewModal(props: DocumentPreviewProps): void {\n  const { document: doc } = props;\n\n  const content = document.createElement('div');\n  content.className = 'document-preview-modal';\n  content.innerHTML = `\n    <style>\n      .document-preview-modal {\n        display: flex;\n        flex-direction: column;\n        height: 80vh;\n        max-height: 800px;\n        width: 900px;\n        max-width: 95vw;\n      }\n      .preview-header {\n        display: flex;\n        align-items: center;\n        gap: 16px;\n        padding: 20px 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\n      }\n      .preview-icon {\n        width: 48px;\n        height: 48px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n        background: rgba(var(--primary-rgb), 0.1);\n        border-radius: 12px;\n      }\n      .preview-title-section {\n        flex: 1;\n        min-width: 0;\n      }\n      .preview-title {\n        font-size: 18px;\n        font-weight: 600;\n        margin: 0 0 4px 0;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .preview-meta {\n        display: flex;\n        gap: 12px;\n        font-size: 13px;\n        color: var(--text-secondary);\n      }\n      .preview-meta span {\n        display: flex;\n        align-items: center;\n        gap: 4px;\n      }\n      .preview-actions {\n        display: flex;\n        gap: 8px;\n      }\n      .preview-actions .btn {\n        padding: 8px 12px;\n        font-size: 13px;\n        border-radius: 8px;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n      }\n      .btn-favorite {\n        background: transparent;\n        border: 1px solid var(--border-color);\n        color: var(--text-secondary);\n      }\n      .btn-favorite.active {\n        background: rgba(255, 193, 7, 0.1);\n        border-color: #ffc107;\n        color: #ffc107;\n      }\n      .preview-tabs {\n        display: flex;\n        gap: 0;\n        padding: 0 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: var(--bg-secondary);\n      }\n      .preview-tab {\n        padding: 12px 20px;\n        font-size: 14px;\n        font-weight: 500;\n        color: var(--text-secondary);\n        background: transparent;\n        border: none;\n        cursor: pointer;\n        position: relative;\n        transition: all 0.2s;\n      }\n      .preview-tab:hover {\n        color: var(--text-primary);\n        background: rgba(var(--primary-rgb), 0.05);\n      }\n      .preview-tab.active {\n        color: var(--primary);\n      }\n      .preview-tab.active::after {\n        content: '';\n        position: absolute;\n        bottom: -1px;\n        left: 0;\n        right: 0;\n        height: 2px;\n        background: var(--primary);\n        border-radius: 2px 2px 0 0;\n      }\n      .preview-tab-badge {\n        margin-left: 6px;\n        padding: 2px 6px;\n        font-size: 11px;\n        background: rgba(var(--primary-rgb), 0.1);\n        border-radius: 10px;\n        color: var(--primary);\n      }\n      .preview-content {\n        flex: 1;\n        overflow-y: auto;\n        padding: 24px;\n      }\n      .preview-section {\n        display: none;\n      }\n      .preview-section.active {\n        display: block;\n      }\n      \n      /* Content Preview */\n      .content-preview {\n        background: var(--bg-secondary);\n        border-radius: 12px;\n        padding: 20px;\n        font-family: var(--font-mono, monospace);\n        font-size: 13px;\n        line-height: 1.6;\n        white-space: pre-wrap;\n        max-height: 500px;\n        overflow-y: auto;\n      }\n      .content-empty, .content-loading {\n        text-align: center;\n        padding: 60px 20px;\n        color: var(--text-secondary);\n      }\n      .content-loading::after {\n        content: '';\n        display: inline-block;\n        width: 16px;\n        height: 16px;\n        border: 2px solid var(--border-color);\n        border-top-color: var(--primary);\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n        margin-left: 8px;\n        vertical-align: middle;\n      }\n      .content-empty svg {\n        width: 48px;\n        height: 48px;\n        opacity: 0.5;\n        margin-bottom: 16px;\n      }\n      \n      /* Summary Section */\n      .summary-card {\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), rgba(var(--primary-rgb), 0.02));\n        border: 1px solid rgba(var(--primary-rgb), 0.1);\n        border-radius: 12px;\n        padding: 20px;\n        margin-bottom: 20px;\n      }\n      .summary-card h4 {\n        margin: 0 0 12px 0;\n        font-size: 14px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      .summary-card p {\n        margin: 0;\n        font-size: 14px;\n        line-height: 1.6;\n        color: var(--text-secondary);\n      }\n      \n      /* Entities Grid */\n      .entities-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n        gap: 12px;\n        margin-top: 20px;\n      }\n      .entity-card {\n        background: var(--bg-secondary);\n        border-radius: 10px;\n        padding: 16px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        transition: background 0.3s ease, transform 0.2s ease;\n      }\n      .entity-card.updated {\n        animation: pulse-highlight 1.5s ease;\n      }\n      @keyframes pulse-highlight {\n        0% { background: rgba(var(--primary-rgb), 0.3); transform: scale(1.02); }\n        50% { background: rgba(var(--primary-rgb), 0.15); }\n        100% { background: var(--bg-secondary); transform: scale(1); }\n      }\n      .entity-icon {\n        width: 40px;\n        height: 40px;\n        border-radius: 10px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 18px;\n      }\n      .entity-icon.facts { background: rgba(59, 130, 246, 0.1); }\n      .entity-icon.decisions { background: rgba(16, 185, 129, 0.1); }\n      .entity-icon.risks { background: rgba(239, 68, 68, 0.1); }\n      .entity-icon.actions { background: rgba(245, 158, 11, 0.1); }\n      .entity-icon.questions { background: rgba(139, 92, 246, 0.1); }\n      .entity-icon.people { background: rgba(6, 182, 212, 0.1); }\n      .entity-info h5 {\n        margin: 0 0 2px 0;\n        font-size: 20px;\n        font-weight: 600;\n      }\n      .entity-info span {\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n      \n      /* Analysis List */\n      .analysis-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      .analysis-item {\n        display: flex;\n        align-items: center;\n        gap: 16px;\n        padding: 16px;\n        background: var(--bg-secondary);\n        border-radius: 10px;\n        transition: all 0.2s;\n      }\n      .analysis-item:hover {\n        background: rgba(var(--primary-rgb), 0.05);\n      }\n      .analysis-version {\n        width: 36px;\n        height: 36px;\n        border-radius: 8px;\n        background: var(--primary);\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-weight: 600;\n        font-size: 14px;\n      }\n      .analysis-info {\n        flex: 1;\n        min-width: 0;\n      }\n      .analysis-title {\n        font-weight: 500;\n        margin-bottom: 4px;\n      }\n      .analysis-meta {\n        font-size: 12px;\n        color: var(--text-secondary);\n        display: flex;\n        gap: 12px;\n      }\n      .analysis-actions {\n        display: flex;\n        gap: 8px;\n      }\n      \n      /* Activity Timeline */\n      .activity-timeline {\n        position: relative;\n        padding-left: 24px;\n      }\n      .activity-timeline::before {\n        content: '';\n        position: absolute;\n        left: 8px;\n        top: 0;\n        bottom: 0;\n        width: 2px;\n        background: var(--border-color);\n      }\n      .activity-item {\n        position: relative;\n        padding: 12px 0 12px 20px;\n      }\n      .activity-item::before {\n        content: '';\n        position: absolute;\n        left: -20px;\n        top: 18px;\n        width: 10px;\n        height: 10px;\n        border-radius: 50%;\n        background: var(--primary);\n        border: 2px solid var(--bg-primary);\n      }\n      .activity-content {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n      .activity-avatar {\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        background: var(--bg-secondary);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 12px;\n      }\n      .activity-text {\n        flex: 1;\n      }\n      .activity-text strong {\n        font-weight: 500;\n      }\n      .activity-time {\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n      \n      /* Versions List */\n      .versions-list {\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n      .version-item {\n        display: flex;\n        align-items: flex-start;\n        gap: 16px;\n        padding: 16px;\n        background: var(--bg-secondary);\n        border-radius: 10px;\n        border: 1px solid transparent;\n      }\n      .version-item.current {\n        border-color: var(--primary);\n        background: rgba(var(--primary-rgb), 0.05);\n      }\n      .version-badge {\n        width: 40px;\n        height: 40px;\n        border-radius: 8px;\n        background: var(--bg-tertiary);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-weight: 600;\n        font-size: 14px;\n      }\n      .version-item.current .version-badge {\n        background: var(--primary);\n        color: white;\n      }\n      .version-info {\n        flex: 1;\n        min-width: 0;\n      }\n      .version-title {\n        font-weight: 500;\n        margin-bottom: 4px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      .version-title .current-tag {\n        font-size: 10px;\n        padding: 2px 6px;\n        background: var(--primary);\n        color: white;\n        border-radius: 4px;\n        text-transform: uppercase;\n      }\n      .version-notes {\n        font-size: 13px;\n        color: var(--text-secondary);\n        margin-bottom: 4px;\n      }\n      .version-meta {\n        font-size: 12px;\n        color: var(--text-tertiary);\n      }\n      .version-ai-summary {\n        margin-top: 8px;\n        padding: 10px;\n        background: rgba(var(--primary-rgb), 0.05);\n        border-radius: 6px;\n        font-size: 13px;\n        color: var(--text-secondary);\n      }\n      .version-ai-summary strong {\n        color: var(--primary);\n      }\n      \n      /* Tags Section */\n      .tags-section {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        margin-top: 16px;\n      }\n      .doc-tag {\n        padding: 4px 10px;\n        background: rgba(var(--primary-rgb), 0.1);\n        border-radius: 12px;\n        font-size: 12px;\n        color: var(--primary);\n      }\n      \n      /* Share Panel */\n      .share-panel {\n        background: var(--bg-secondary);\n        border-radius: 12px;\n        padding: 20px;\n      }\n      .share-link-container {\n        display: flex;\n        gap: 8px;\n        margin-bottom: 16px;\n      }\n      .share-link-input {\n        flex: 1;\n        padding: 10px 12px;\n        border: 1px solid var(--border-color);\n        border-radius: 8px;\n        font-size: 13px;\n        background: var(--bg-primary);\n      }\n      .share-options {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 12px;\n      }\n      .share-option {\n        display: flex;\n        flex-direction: column;\n        gap: 4px;\n      }\n      .share-option label {\n        font-size: 12px;\n        color: var(--text-secondary);\n      }\n      .share-option input, .share-option select {\n        padding: 8px 10px;\n        border: 1px solid var(--border-color);\n        border-radius: 6px;\n        font-size: 13px;\n        background: var(--bg-primary);\n      }\n      \n      /* Empty State */\n      .empty-section {\n        text-align: center;\n        padding: 40px 20px;\n        color: var(--text-secondary);\n      }\n      .empty-section svg {\n        width: 48px;\n        height: 48px;\n        opacity: 0.4;\n        margin-bottom: 12px;\n      }\n      \n      /* Spinner for button loading state */\n      .spinner {\n        display: inline-block;\n        width: 14px;\n        height: 14px;\n        border: 2px solid rgba(255,255,255,0.3);\n        border-top-color: white;\n        border-radius: 50%;\n        animation: spin 0.8s linear infinite;\n        margin-right: 6px;\n        vertical-align: middle;\n      }\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n      #reprocess-btn:disabled {\n        opacity: 0.7;\n        cursor: wait;\n      }\n    </style>\n    \n    <div class=\"preview-header\">\n      <div class=\"preview-icon\">${getDocIcon(doc.filename || '')}</div>\n      <div class=\"preview-title-section\">\n        <h3 class=\"preview-title\">${escapeHtml(doc.filename || doc.originalName || 'Untitled')}</h3>\n        <div class=\"preview-meta\">\n          <span>${formatFileSize(doc.size || 0)}</span>\n          <span>${formatRelativeTime(doc.created_at)}</span>\n          <span class=\"status-badge status-${doc.status}\">${doc.status}</span>\n        </div>\n      </div>\n      <div class=\"preview-actions\">\n        <button class=\"btn btn-favorite ${isFavorite ? 'active' : ''}\" id=\"favorite-btn\" title=\"Favorite\">\n          ${isFavorite ? '‚òÖ' : '‚òÜ'}\n        </button>\n        <button class=\"btn btn-secondary\" id=\"share-btn\">\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8\"/>\n            <polyline points=\"16 6 12 2 8 6\"/>\n            <line x1=\"12\" y1=\"2\" x2=\"12\" y2=\"15\"/>\n          </svg>\n          Share\n        </button>\n        <button class=\"btn btn-secondary\" id=\"download-btn\">\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\n            <polyline points=\"7 10 12 15 17 10\"/>\n            <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>\n          </svg>\n          Download\n        </button>\n        <button class=\"btn btn-primary\" id=\"reprocess-btn\">\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <polyline points=\"23 4 23 10 17 10\"/>\n            <path d=\"M20.49 15a9 9 0 1 1-2.12-9.36L23 10\"/>\n          </svg>\n          Reprocess\n        </button>\n      </div>\n    </div>\n    \n    <div class=\"preview-tabs\">\n      <button class=\"preview-tab active\" data-tab=\"preview\">Preview</button>\n      <button class=\"preview-tab hidden\" data-tab=\"entities\" id=\"entities-tab\">\n        Entities\n        <span class=\"preview-tab-badge\" id=\"entities-count\">0</span>\n      </button>\n      <button class=\"preview-tab\" data-tab=\"analysis\">\n        AI Analysis\n        <span class=\"preview-tab-badge\" id=\"analysis-count\">0</span>\n      </button>\n      <button class=\"preview-tab hidden\" data-tab=\"notes\" id=\"notes-tab\">\n        Meeting Notes\n      </button>\n      <button class=\"preview-tab\" data-tab=\"versions\">\n        Versions\n        <span class=\"preview-tab-badge\" id=\"versions-count\">1</span>\n      </button>\n      <button class=\"preview-tab\" data-tab=\"activity\">Activity</button>\n      <button class=\"preview-tab\" data-tab=\"share\">Share</button>\n    </div>\n    \n    <div class=\"preview-content\">\n      <!-- Preview Tab -->\n      <div class=\"preview-section active\" data-section=\"preview\">\n        <div class=\"summary-card${doc.summary ? '' : ' hidden'}\" id=\"summary-card\">\n            <h4>\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n                <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\"/>\n                <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\n              </svg>\n              AI Summary\n            </h4>\n            <p id=\"doc-summary\">${doc.summary ? escapeHtml(doc.summary) : ''}</p>\n          </div>\n        \n        <div class=\"entities-grid\" id=\"entities-grid\">\n          <div class=\"entity-card\" data-entity=\"facts\">\n            <div class=\"entity-icon facts\">üìã</div>\n            <div class=\"entity-info\">\n              <h5 class=\"entity-count\">${doc.facts_count || 0}</h5>\n              <span>Facts</span>\n            </div>\n          </div>\n          <div class=\"entity-card\" data-entity=\"decisions\">\n            <div class=\"entity-icon decisions\">‚úì</div>\n            <div class=\"entity-info\">\n              <h5 class=\"entity-count\">${(doc as any).decisions_count || 0}</h5>\n              <span>Decisions</span>\n            </div>\n          </div>\n          <div class=\"entity-card\" data-entity=\"risks\">\n            <div class=\"entity-icon risks\">‚ö†Ô∏è</div>\n            <div class=\"entity-info\">\n              <h5 class=\"entity-count\">${(doc as any).risks_count || 0}</h5>\n              <span>Risks</span>\n            </div>\n          </div>\n          <div class=\"entity-card\" data-entity=\"actions\">\n            <div class=\"entity-icon actions\">üìå</div>\n            <div class=\"entity-info\">\n              <h5 class=\"entity-count\">${(doc as any).actions_count || 0}</h5>\n              <span>Actions</span>\n            </div>\n          </div>\n          <div class=\"entity-card\" data-entity=\"questions\">\n            <div class=\"entity-icon questions\">‚ùì</div>\n            <div class=\"entity-info\">\n              <h5 class=\"entity-count\">${doc.questions_count || 0}</h5>\n              <span>Questions</span>\n            </div>\n          </div>\n          <div class=\"entity-card\" data-entity=\"people\">\n            <div class=\"entity-icon people\">üë•</div>\n            <div class=\"entity-info\">\n              <h5 class=\"entity-count\" id=\"people-count\">${(doc as any).people_count || 0}</h5>\n              <span>People</span>\n            </div>\n          </div>\n        </div>\n        \n        ${(doc as any).tags?.length ? `\n          <div class=\"tags-section\">\n            ${((doc as any).tags as string[]).map(tag => `<span class=\"doc-tag\">#${escapeHtml(tag)}</span>`).join('')}\n          </div>\n        ` : ''}\n        \n        <h4 class=\"document-preview-content-heading\">Content Preview</h4>\n        <div class=\"content-preview\" id=\"content-preview\">\n          <div class=\"content-loading\">Loading content...</div>\n        </div>\n      </div>\n      \n      <!-- Entities Tab (full extraction results) -->\n      <div class=\"preview-section\" data-section=\"entities\">\n        <div class=\"entities-full-list\" id=\"entities-full-list\">\n          <div class=\"empty-section\">Loading entities...</div>\n        </div>\n      </div>\n      \n      <!-- AI Analysis Tab -->\n      <div class=\"preview-section\" data-section=\"analysis\">\n        <div class=\"analysis-list\" id=\"analysis-list\">\n          <div class=\"empty-section\">Loading analysis history...</div>\n        </div>\n      </div>\n      \n      <!-- Versions Tab -->\n      <div class=\"preview-section\" data-section=\"versions\">\n        <div class=\"document-preview-actions-row\">\n          <button class=\"btn btn-primary\" id=\"upload-version-btn\">\n            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\n              <polyline points=\"17 8 12 3 7 8\"/>\n              <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\n            </svg>\n            Upload New Version\n          </button>\n        </div>\n        <div class=\"versions-list\" id=\"versions-list\">\n          <div class=\"empty-section\">Loading versions...</div>\n        </div>\n      </div>\n      \n      <!-- Meeting Notes Tab -->\n      <div class=\"preview-section\" data-section=\"notes\">\n        <div class=\"notes-container\" id=\"notes-container\">\n          <div class=\"empty-section\">No meeting notes available</div>\n        </div>\n      </div>\n      \n      <!-- Activity Tab -->\n      <div class=\"preview-section\" data-section=\"activity\">\n        <div class=\"activity-timeline\" id=\"activity-timeline\">\n          <div class=\"empty-section\">Loading activity...</div>\n        </div>\n      </div>\n      \n      <!-- Share Tab -->\n      <div class=\"preview-section\" data-section=\"share\">\n        <div class=\"share-panel\">\n          <h4 class=\"document-preview-share-heading\">Create Share Link</h4>\n          <div class=\"share-link-container\">\n            <input type=\"text\" class=\"share-link-input\" id=\"share-link-input\" placeholder=\"Generate a link to share...\" readonly>\n            <button class=\"btn btn-primary\" id=\"generate-link-btn\">Generate</button>\n            <button class=\"btn btn-secondary hidden\" id=\"copy-link-btn\">Copy</button>\n          </div>\n          <div class=\"share-options\">\n            <div class=\"share-option\">\n              <label>Expires</label>\n              <select id=\"share-expires\">\n                <option value=\"1d\">1 day</option>\n                <option value=\"7d\" selected>7 days</option>\n                <option value=\"30d\">30 days</option>\n                <option value=\"never\">Never</option>\n              </select>\n            </div>\n            <div class=\"share-option\">\n              <label>Max Views</label>\n              <input type=\"number\" id=\"share-max-views\" placeholder=\"Unlimited\" min=\"1\">\n            </div>\n            <div class=\"share-option\">\n              <label>Password (optional)</label>\n              <input type=\"password\" id=\"share-password\" placeholder=\"No password\">\n            </div>\n            <div class=\"share-option\">\n              <label>Permissions</label>\n              <select id=\"share-permissions\">\n                <option value=\"view\">View only</option>\n                <option value=\"download\">View & Download</option>\n              </select>\n            </div>\n          </div>\n        </div>\n        <div class=\"document-preview-active-shares\" id=\"active-shares\"></div>\n      </div>\n    </div>\n  `;\n\n  // Bind tab events\n  content.querySelectorAll('.preview-tab').forEach(tab => {\n    tab.addEventListener('click', () => {\n      const tabName = tab.getAttribute('data-tab')!;\n      switchTab(content, tabName);\n    });\n  });\n\n  // Bind action buttons\n  content.querySelector('#favorite-btn')?.addEventListener('click', () => toggleFavorite(content, doc));\n  content.querySelector('#share-btn')?.addEventListener('click', () => switchTab(content, 'share'));\n  content.querySelector('#download-btn')?.addEventListener('click', () => downloadDocument(doc));\n  content.querySelector('#reprocess-btn')?.addEventListener('click', () => reprocessDocument(doc, props.onUpdate));\n  content.querySelector('#upload-version-btn')?.addEventListener('click', () => uploadNewVersion(doc, content, props.onUpdate));\n  content.querySelector('#generate-link-btn')?.addEventListener('click', () => generateShareLink(content, doc));\n  content.querySelector('#copy-link-btn')?.addEventListener('click', () => copyShareLink(content));\n\n  // Load data\n  loadContentPreview(content, doc.id);\n  loadEntities(content, doc.id);\n  loadAnalysisHistory(content, doc.id);\n  loadVersions(content, doc.id);\n  loadActivity(content, doc.id);\n  loadMeetingNotes(content, doc.id);\n  checkFavoriteStatus(doc.id).then(fav => {\n    isFavorite = fav;\n    updateFavoriteButton(content);\n  });\n\n  // Create overlay\n  const overlay = document.createElement('div');\n  overlay.className = 'modal-overlay document-preview-overlay';\n\n  const modalContainer = document.createElement('div');\n  modalContainer.className = 'modal-container document-preview-modal-container';\n\n  const closeBtn = document.createElement('button');\n  closeBtn.className = 'document-preview-close-btn';\n  closeBtn.innerHTML = '√ó';\n  closeBtn.onclick = () => closePreviewModal(overlay, props.onClose);\n\n  content.classList.add('position-relative');\n  content.appendChild(closeBtn);\n  modalContainer.appendChild(content);\n  overlay.appendChild(modalContainer);\n\n  // Close on backdrop click\n  overlay.addEventListener('click', (e) => {\n    if (e.target === overlay) {\n      closePreviewModal(overlay, props.onClose);\n    }\n  });\n\n  // Close on Escape\n  const handleEscape = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      closePreviewModal(overlay, props.onClose);\n      document.removeEventListener('keydown', handleEscape);\n    }\n  };\n  document.addEventListener('keydown', handleEscape);\n\n  document.body.appendChild(overlay);\n}\n\nfunction closePreviewModal(overlay: HTMLElement, onClose?: () => void): void {\n  // Clear any active reprocess polling interval\n  if (activeReprocessInterval) {\n    clearInterval(activeReprocessInterval);\n    activeReprocessInterval = null;\n  }\n  \n  overlay.style.animation = 'fadeOut 0.2s ease-out';\n  setTimeout(() => {\n    overlay.remove();\n    onClose?.();\n  }, 200);\n}\n\nfunction switchTab(container: HTMLElement, tabName: string): void {\n  currentTab = tabName;\n  \n  container.querySelectorAll('.preview-tab').forEach(t => {\n    t.classList.toggle('active', t.getAttribute('data-tab') === tabName);\n  });\n  \n  container.querySelectorAll('.preview-section').forEach(s => {\n    s.classList.toggle('active', s.getAttribute('data-section') === tabName);\n  });\n}\n\n/**\n * Load document content preview\n */\nasync function loadContentPreview(container: HTMLElement, docId: string): Promise<void> {\n  const contentEl = container.querySelector('#content-preview') as HTMLElement;\n  \n  try {\n    // Fetch full document with content\n    const response = await http.get<{ document?: { content?: string } } | { content?: string }>(`/api/documents/${docId}`);\n    const doc = (response.data as { document?: { content?: string } }).document || response.data;\n    const content = doc?.content;\n    \n    if (content) {\n      const truncated = content.length > 5000;\n      contentEl.innerHTML = `<pre class=\"conv-notes-pre\">${escapeHtml(content.substring(0, 5000))}${truncated ? '\\n\\n... (truncated)' : ''}</pre>`;\n    } else {\n      contentEl.innerHTML = '<div class=\"content-empty\">No content extracted</div>';\n    }\n  } catch (err) {\n    console.error('[Preview] Failed to load content:', err);\n    contentEl.innerHTML = '<div class=\"content-empty\">Failed to load content</div>';\n  }\n}\n\n/**\n * Load full entities from extraction_result\n */\nasync function loadEntities(container: HTMLElement, docId: string): Promise<void> {\n  const listEl = container.querySelector('#entities-full-list') as HTMLElement;\n  const entitiesTab = container.querySelector('#entities-tab') as HTMLElement;\n  const entitiesCount = container.querySelector('#entities-count') as HTMLElement;\n  const peopleCountEl = container.querySelector('#people-count') as HTMLElement;\n  \n  try {\n    const response = await http.get<{ extraction?: { \n      entities?: Array<{ id: string; type: string; name: string; confidence?: number }>;\n      facts?: Array<{ id: string; content: string; category?: string; confidence?: number }>;\n      decisions?: Array<{ id: string; content: string }>;\n      action_items?: Array<{ id: string; task: string; owner?: string; status?: string }>;\n      questions?: Array<{ id: string; content: string }>;\n      risks?: Array<{ id: string; content: string; severity?: string }>;\n      participants?: Array<{ name: string; role?: string; organization?: string; contact_id?: string; contact_name?: string }>;\n    } }>(`/api/documents/${docId}/extraction`);\n    \n    const extraction = response.data.extraction;\n    if (!extraction) {\n      listEl.innerHTML = '<div class=\"empty-section\">No extraction data available</div>';\n      return;\n    }\n    \n    const entities = extraction.entities || [];\n    const facts = extraction.facts || [];\n    const decisions = extraction.decisions || [];\n    const actions = extraction.action_items || [];\n    const questions = extraction.questions || [];\n    const risks = extraction.risks || [];\n    const participants = extraction.participants || [];\n    \n    // Also get Person entities from graph entities\n    const personEntities = entities.filter(e => e.type?.toLowerCase() === 'person');\n    \n    // Merge participants and person entities (deduplicated by name)\n    const allPeople = [...participants];\n    for (const pe of personEntities) {\n      if (!allPeople.some(p => p.name?.toLowerCase() === pe.name?.toLowerCase())) {\n        allPeople.push({ name: pe.name, role: undefined, organization: undefined });\n      }\n    }\n    \n    // Update people count in the grid\n    if (peopleCountEl) {\n      peopleCountEl.textContent = String(allPeople.length);\n    }\n    \n    const totalItems = entities.length + facts.length + decisions.length + actions.length + questions.length + risks.length + allPeople.length;\n    \n    if (totalItems === 0) {\n      listEl.innerHTML = '<div class=\"empty-section\">No entities extracted</div>';\n      return;\n    }\n    \n    // Show tab\n    if (entitiesTab) entitiesTab.classList.remove('hidden');\n    if (entitiesCount) entitiesCount.textContent = String(totalItems);\n    \n    // Build HTML\n    let html = `<style>\n      .entity-section { margin-bottom: 24px; }\n      .entity-section-title { \n        font-size: 14px; \n        font-weight: 600; \n        color: var(--text-secondary); \n        margin-bottom: 12px; \n        text-transform: uppercase;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n      .entity-section-count {\n        font-size: 11px;\n        background: rgba(var(--primary-rgb), 0.1);\n        padding: 2px 8px;\n        border-radius: 10px;\n        color: var(--primary);\n      }\n      .entity-item {\n        padding: 12px 16px;\n        background: var(--bg-secondary);\n        border-radius: 8px;\n        margin-bottom: 8px;\n      }\n      .entity-item-type {\n        font-size: 11px;\n        text-transform: uppercase;\n        color: var(--text-tertiary);\n        margin-bottom: 4px;\n      }\n      .entity-item-content {\n        color: var(--text-primary);\n      }\n      .entity-item-meta {\n        font-size: 12px;\n        color: var(--text-tertiary);\n        margin-top: 4px;\n      }\n    </style>`;\n    \n    // Graph entities\n    if (entities.length > 0) {\n      html += `<div class=\"entity-section\">\n        <div class=\"entity-section-title\">\n          üîó Graph Entities\n          <span class=\"entity-section-count\">${entities.length}</span>\n        </div>\n        ${entities.map(e => `\n          <div class=\"entity-item\">\n            <div class=\"entity-item-type\">${escapeHtml(e.type)}</div>\n            <div class=\"entity-item-content\">${escapeHtml(e.name)}</div>\n            ${e.confidence ? `<div class=\"entity-item-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\n          </div>\n        `).join('')}\n      </div>`;\n    }\n    \n    // Facts\n    if (facts.length > 0) {\n      html += `<div class=\"entity-section\">\n        <div class=\"entity-section-title\">\n          üìã Facts\n          <span class=\"entity-section-count\">${facts.length}</span>\n        </div>\n        ${facts.map(f => `\n          <div class=\"entity-item\">\n            ${f.category ? `<div class=\"entity-item-type\">${escapeHtml(f.category)}</div>` : ''}\n            <div class=\"entity-item-content\">${escapeHtml(f.content)}</div>\n            ${f.confidence ? `<div class=\"entity-item-meta\">Confidence: ${Math.round(f.confidence * 100)}%</div>` : ''}\n          </div>\n        `).join('')}\n      </div>`;\n    }\n    \n    // Decisions\n    if (decisions.length > 0) {\n      html += `<div class=\"entity-section\">\n        <div class=\"entity-section-title\">\n          ‚úì Decisions\n          <span class=\"entity-section-count\">${decisions.length}</span>\n        </div>\n        ${decisions.map(d => `\n          <div class=\"entity-item\">\n            <div class=\"entity-item-content\">${escapeHtml(d.content)}</div>\n          </div>\n        `).join('')}\n      </div>`;\n    }\n    \n    // Action Items\n    if (actions.length > 0) {\n      html += `<div class=\"entity-section\">\n        <div class=\"entity-section-title\">\n          üìå Action Items\n          <span class=\"entity-section-count\">${actions.length}</span>\n        </div>\n        ${actions.map(a => `\n          <div class=\"entity-item\">\n            <div class=\"entity-item-content\">‚òê ${escapeHtml(a.task)}</div>\n            ${a.owner ? `<div class=\"entity-item-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\n            ${a.status ? `<div class=\"entity-item-meta\">Status: ${escapeHtml(a.status)}</div>` : ''}\n          </div>\n        `).join('')}\n      </div>`;\n    }\n    \n    // Questions\n    if (questions.length > 0) {\n      html += `<div class=\"entity-section\">\n        <div class=\"entity-section-title\">\n          ‚ùì Questions\n          <span class=\"entity-section-count\">${questions.length}</span>\n        </div>\n        ${questions.map(q => `\n          <div class=\"entity-item\">\n            <div class=\"entity-item-content\">${escapeHtml(q.content)}</div>\n          </div>\n        `).join('')}\n      </div>`;\n    }\n    \n    // Risks\n    if (risks.length > 0) {\n      html += `<div class=\"entity-section\">\n        <div class=\"entity-section-title\">\n          ‚ö†Ô∏è Risks\n          <span class=\"entity-section-count\">${risks.length}</span>\n        </div>\n        ${risks.map(r => `\n          <div class=\"entity-item\">\n            <div class=\"entity-item-content\">${escapeHtml(r.content)}</div>\n            ${r.severity ? `<div class=\"entity-item-meta\">Severity: ${escapeHtml(r.severity)}</div>` : ''}\n          </div>\n        `).join('')}\n      </div>`;\n    }\n    \n    // People/Participants\n    if (allPeople.length > 0) {\n      html += `<div class=\"entity-section\" id=\"people-section\">\n        <div class=\"entity-section-title\">\n          üë• People\n          <span class=\"entity-section-count\">${allPeople.length}</span>\n        </div>\n        <style>\n          .person-item {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            padding: 12px 16px;\n            background: var(--bg-secondary);\n            border-radius: 8px;\n            margin-bottom: 8px;\n            gap: 12px;\n          }\n          .person-info {\n            flex: 1;\n            min-width: 0;\n          }\n          .person-name {\n            font-weight: 500;\n            color: var(--text-primary);\n          }\n          .person-role {\n            font-size: 12px;\n            color: var(--text-tertiary);\n            margin-top: 2px;\n          }\n          .person-linked {\n            display: flex;\n            align-items: center;\n            gap: 6px;\n            font-size: 12px;\n            color: var(--success);\n          }\n          .person-linked svg {\n            width: 14px;\n            height: 14px;\n          }\n          .person-unlinked {\n            display: flex;\n            align-items: center;\n            gap: 6px;\n          }\n          .person-link-btn {\n            font-size: 12px;\n            padding: 4px 10px;\n            border-radius: 4px;\n            border: 1px solid var(--border-color);\n            background: var(--bg-primary);\n            color: var(--text-secondary);\n            cursor: pointer;\n            transition: all 0.15s ease;\n          }\n          .person-link-btn:hover {\n            border-color: var(--primary);\n            color: var(--primary);\n            background: rgba(var(--primary-rgb), 0.05);\n          }\n          .person-create-btn {\n            font-size: 12px;\n            padding: 4px 10px;\n            border-radius: 4px;\n            border: none;\n            background: var(--primary);\n            color: white;\n            cursor: pointer;\n            transition: all 0.15s ease;\n          }\n          .person-create-btn:hover {\n            opacity: 0.9;\n          }\n        </style>\n        ${allPeople.map((p, idx) => `\n          <div class=\"person-item\" data-person-index=\"${idx}\" data-person-name=\"${escapeHtml(p.name || '')}\">\n            <div class=\"person-info\">\n              <div class=\"person-name\">${escapeHtml(p.name || 'Unknown')}</div>\n              ${p.role || p.organization ? `\n                <div class=\"person-role\">\n                  ${p.role ? escapeHtml(p.role) : ''}${p.role && p.organization ? ' at ' : ''}${p.organization ? escapeHtml(p.organization) : ''}\n                </div>\n              ` : ''}\n            </div>\n            ${p.contact_id ? `\n              <div class=\"person-linked\">\n                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                  <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\n                  <polyline points=\"22 4 12 14.01 9 11.01\"/>\n                </svg>\n                Linked to ${escapeHtml(p.contact_name || 'contact')}\n              </div>\n            ` : `\n              <div class=\"person-unlinked\">\n                <button class=\"person-link-btn\" data-action=\"link\" data-name=\"${escapeHtml(p.name || '')}\">\n                  Link to Contact\n                </button>\n                <button class=\"person-create-btn\" data-action=\"create\" data-name=\"${escapeHtml(p.name || '')}\" data-role=\"${escapeHtml(p.role || '')}\" data-org=\"${escapeHtml(p.organization || '')}\">\n                  + Create Contact\n                </button>\n              </div>\n            `}\n          </div>\n        `).join('')}\n      </div>`;\n    }\n    \n    listEl.innerHTML = html;\n    \n    // Setup people link handlers\n    setupPeopleLinkHandlers(container, docId);\n  } catch (err) {\n    listEl.innerHTML = '<div class=\"empty-section\">Failed to load entities</div>';\n  }\n}\n\n/**\n * Setup event handlers for linking people to contacts\n */\nfunction setupPeopleLinkHandlers(container: HTMLElement, docId: string): void {\n  const peopleSection = container.querySelector('#people-section');\n  if (!peopleSection) return;\n  \n  // Get project ID from URL or data attribute\n  const projectId = (window as any).currentProjectId || \n    document.body.dataset.projectId || \n    container.closest('[data-project-id]')?.getAttribute('data-project-id') ||\n    '';\n  \n  // Handle Link to Contact buttons\n  peopleSection.querySelectorAll('.person-link-btn').forEach(btn => {\n    btn.addEventListener('click', async (e) => {\n      e.stopPropagation();\n      const personName = (btn as HTMLElement).dataset.name || '';\n      await showContactLinkDropdown(btn as HTMLElement, personName, projectId, container, docId);\n    });\n  });\n  \n  // Handle Create Contact buttons\n  peopleSection.querySelectorAll('.person-create-btn').forEach(btn => {\n    btn.addEventListener('click', async (e) => {\n      e.stopPropagation();\n      const personName = (btn as HTMLElement).dataset.name || '';\n      const personRole = (btn as HTMLElement).dataset.role || '';\n      const personOrg = (btn as HTMLElement).dataset.org || '';\n      \n      await createContactFromPerson(personName, personRole, personOrg, projectId, btn as HTMLElement, container, docId);\n    });\n  });\n}\n\n/**\n * Show dropdown to select existing contact for linking\n */\nasync function showContactLinkDropdown(\n  btnEl: HTMLElement, \n  personName: string, \n  projectId: string, \n  container: HTMLElement, \n  docId: string\n): Promise<void> {\n  // Remove any existing dropdown\n  document.querySelectorAll('.contact-link-dropdown').forEach(d => d.remove());\n  \n  // Create dropdown\n  const dropdown = document.createElement('div');\n  dropdown.className = 'contact-link-dropdown';\n  dropdown.innerHTML = `\n    <style>\n      .contact-link-dropdown {\n        position: absolute;\n        z-index: 10000;\n        background: var(--bg-primary);\n        border: 1px solid var(--border-color);\n        border-radius: 8px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        min-width: 280px;\n        max-height: 300px;\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n      }\n      .contact-link-search {\n        padding: 12px;\n        border-bottom: 1px solid var(--border-color);\n      }\n      .contact-link-search input {\n        width: 100%;\n        padding: 8px 12px;\n        border: 1px solid var(--border-color);\n        border-radius: 6px;\n        background: var(--bg-secondary);\n        color: var(--text-primary);\n        font-size: 13px;\n      }\n      .contact-link-search input:focus {\n        outline: none;\n        border-color: var(--primary);\n      }\n      .contact-link-list {\n        overflow-y: auto;\n        max-height: 220px;\n        padding: 8px;\n      }\n      .contact-link-item {\n        padding: 10px 12px;\n        border-radius: 6px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n      .contact-link-item:hover {\n        background: var(--bg-secondary);\n      }\n      .contact-link-avatar {\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, var(--primary), var(--primary-dark, var(--primary)));\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-size: 13px;\n        font-weight: 500;\n      }\n      .contact-link-info {\n        flex: 1;\n        min-width: 0;\n      }\n      .contact-link-name {\n        font-weight: 500;\n        color: var(--text-primary);\n        font-size: 13px;\n      }\n      .contact-link-email {\n        font-size: 11px;\n        color: var(--text-tertiary);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .contact-link-empty {\n        padding: 20px;\n        text-align: center;\n        color: var(--text-tertiary);\n        font-size: 13px;\n      }\n      .contact-link-loading {\n        padding: 20px;\n        text-align: center;\n        color: var(--text-tertiary);\n      }\n    </style>\n    <div class=\"contact-link-search\">\n      <input type=\"text\" placeholder=\"Search contacts...\" autofocus>\n    </div>\n    <div class=\"contact-link-list\">\n      <div class=\"contact-link-loading\">Loading contacts...</div>\n    </div>\n  `;\n  \n  // Position dropdown near button\n  const rect = btnEl.getBoundingClientRect();\n  dropdown.style.position = 'fixed';\n  dropdown.style.top = `${rect.bottom + 4}px`;\n  dropdown.style.left = `${Math.max(10, rect.left - 100)}px`;\n  \n  document.body.appendChild(dropdown);\n  \n  // Focus search input\n  const searchInput = dropdown.querySelector('input') as HTMLInputElement;\n  searchInput?.focus();\n  \n  // Load contacts\n  try {\n    const response = await http.get<{ contacts: Array<{ id: string; name: string; email?: string }> }>(\n      `/api/contacts?project_id=${projectId}&limit=100`\n    );\n    const contacts = response.data.contacts || [];\n    \n    const listEl = dropdown.querySelector('.contact-link-list') as HTMLElement;\n    \n    if (contacts.length === 0) {\n      listEl.innerHTML = '<div class=\"contact-link-empty\">No contacts found</div>';\n    } else {\n      renderContactList(listEl, contacts, personName, projectId, container, docId, dropdown);\n    }\n    \n    // Setup search filter\n    searchInput?.addEventListener('input', () => {\n      const query = searchInput.value.toLowerCase();\n      const filtered = contacts.filter(c => \n        c.name?.toLowerCase().includes(query) || \n        c.email?.toLowerCase().includes(query)\n      );\n      renderContactList(listEl, filtered, personName, projectId, container, docId, dropdown);\n    });\n    \n  } catch (err) {\n    console.error('[People] Failed to load contacts:', err);\n    const listEl = dropdown.querySelector('.contact-link-list') as HTMLElement;\n    listEl.innerHTML = '<div class=\"contact-link-empty\">Failed to load contacts</div>';\n  }\n  \n  // Close on click outside\n  const closeHandler = (e: MouseEvent) => {\n    if (!dropdown.contains(e.target as Node) && e.target !== btnEl) {\n      dropdown.remove();\n      document.removeEventListener('click', closeHandler);\n    }\n  };\n  setTimeout(() => document.addEventListener('click', closeHandler), 100);\n  \n  // Close on Escape\n  const escHandler = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      dropdown.remove();\n      document.removeEventListener('keydown', escHandler);\n    }\n  };\n  document.addEventListener('keydown', escHandler);\n}\n\n/**\n * Render list of contacts in dropdown\n */\nfunction renderContactList(\n  listEl: HTMLElement,\n  contacts: Array<{ id: string; name: string; email?: string }>,\n  personName: string,\n  projectId: string,\n  container: HTMLElement,\n  docId: string,\n  dropdown: HTMLElement\n): void {\n  if (contacts.length === 0) {\n    listEl.innerHTML = '<div class=\"contact-link-empty\">No matching contacts</div>';\n    return;\n  }\n  \n  listEl.innerHTML = contacts.map(c => {\n    const initials = (c.name || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();\n    return `\n      <div class=\"contact-link-item\" data-contact-id=\"${c.id}\" data-contact-name=\"${escapeHtml(c.name || '')}\">\n        <div class=\"contact-link-avatar\">${initials}</div>\n        <div class=\"contact-link-info\">\n          <div class=\"contact-link-name\">${escapeHtml(c.name || 'Unknown')}</div>\n          ${c.email ? `<div class=\"contact-link-email\">${escapeHtml(c.email)}</div>` : ''}\n        </div>\n      </div>\n    `;\n  }).join('');\n  \n  // Add click handlers\n  listEl.querySelectorAll('.contact-link-item').forEach(item => {\n    item.addEventListener('click', async () => {\n      const contactId = (item as HTMLElement).dataset.contactId || '';\n      const contactName = (item as HTMLElement).dataset.contactName || '';\n      \n      try {\n        await http.post('/api/contacts/link-participant', {\n          projectId,\n          participantName: personName,\n          contactId\n        });\n        \n        toast.success(`Linked \"${personName}\" to ${contactName}`);\n        dropdown.remove();\n        \n        // Reload entities to show updated status\n        loadEntities(container, docId);\n      } catch (err) {\n        console.error('[People] Failed to link:', err);\n        toast.error('Failed to link contact');\n      }\n    });\n  });\n}\n\n/**\n * Create a new contact from a person detected in document\n */\nasync function createContactFromPerson(\n  name: string,\n  role: string,\n  organization: string,\n  projectId: string,\n  btnEl: HTMLElement,\n  container: HTMLElement,\n  docId: string\n): Promise<void> {\n  const originalText = btnEl.textContent;\n  btnEl.textContent = 'Creating...';\n  (btnEl as HTMLButtonElement).disabled = true;\n  \n  try {\n    const response = await http.post<{ ok: boolean; contact?: { id: string; name: string }; error?: string }>(\n      '/api/contacts',\n      {\n        project_id: projectId,\n        name,\n        role: role || undefined,\n        organization: organization || undefined,\n        source: 'document_extraction'\n      }\n    );\n    \n    if (response.data.ok && response.data.contact) {\n      toast.success(`Created contact: ${response.data.contact.name}`);\n      \n      // Reload entities to show updated status\n      loadEntities(container, docId);\n    } else {\n      toast.error(response.data.error || 'Failed to create contact');\n      btnEl.textContent = originalText;\n      (btnEl as HTMLButtonElement).disabled = false;\n    }\n  } catch (err) {\n    console.error('[People] Failed to create contact:', err);\n    toast.error('Failed to create contact');\n    btnEl.textContent = originalText;\n    (btnEl as HTMLButtonElement).disabled = false;\n  }\n}\n\nasync function loadAnalysisHistory(container: HTMLElement, docId: string): Promise<void> {\n  const listEl = container.querySelector('#analysis-list') as HTMLElement;\n  \n  try {\n    const response = await http.get<{ analyses: AIAnalysis[] }>(`/api/documents/${docId}/analysis`);\n    const analyses = response.data.analyses || [];\n    \n    container.querySelector('#analysis-count')!.textContent = String(analyses.length);\n    \n    if (analyses.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"empty-section\">\n          <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n            <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3\"/>\n            <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\n          </svg>\n          <p>No AI analyses yet</p>\n          <button class=\"btn btn-primary btn-sm\" id=\"run-analysis-btn\">Run Analysis</button>\n        </div>\n      `;\n      \n      // Add click handler for Run Analysis button\n      const runAnalysisBtn = listEl.querySelector('#run-analysis-btn');\n      if (runAnalysisBtn) {\n        runAnalysisBtn.addEventListener('click', async () => {\n          const btn = runAnalysisBtn as HTMLButtonElement;\n          const originalText = btn.textContent;\n          btn.disabled = true;\n          btn.textContent = 'Analyzing...';\n          \n          try {\n            // Trigger reprocess via API\n            const response = await http.post(`/api/documents/${docId}/reprocess`, {});\n            if (response.data.success) {\n              toast.success('Analysis started');\n              // Poll for completion and reload\n              setTimeout(() => loadAnalysisHistory(container, docId), 3000);\n            } else {\n              toast.error(response.data.error || 'Failed to start analysis');\n              btn.disabled = false;\n              btn.textContent = originalText;\n            }\n          } catch (err: any) {\n            toast.error(err.message || 'Failed to run analysis');\n            btn.disabled = false;\n            btn.textContent = originalText;\n          }\n        });\n      }\n      return;\n    }\n    \n    listEl.innerHTML = analyses.map((a, i) => `\n      <div class=\"analysis-item\" data-id=\"${a.id}\">\n        <div class=\"analysis-version\">v${analyses.length - i}</div>\n        <div class=\"analysis-info\">\n          <div class=\"analysis-title\">${capitalizeFirst(a.analysis_type)}</div>\n          <div class=\"analysis-meta\">\n            <span>${a.provider}/${a.model}</span>\n            <span>${a.entities_extracted || 0} entities</span>\n            <span>${(a.input_tokens || 0) + (a.output_tokens || 0)} tokens</span>\n            ${a.cost ? `<span>$${a.cost.toFixed(4)}</span>` : ''}\n          </div>\n          <div class=\"analysis-timestamp\">\n            ${formatDateTime(a.created_at)} (${formatRelativeTime(a.created_at)})\n          </div>\n        </div>\n        <div class=\"analysis-actions\">\n          <button class=\"btn btn-sm view-analysis-btn\">View</button>\n          <button class=\"btn btn-sm compare-analysis-btn\">Compare</button>\n        </div>\n      </div>\n    `).join('');\n    \n    // Add click handlers for View buttons\n    listEl.querySelectorAll('.view-analysis-btn').forEach((btn, idx) => {\n      btn.addEventListener('click', () => {\n        const analysis = analyses[idx];\n        showAnalysisDetail(container, analysis);\n      });\n    });\n    \n    // Add click handlers for Compare buttons\n    listEl.querySelectorAll('.compare-analysis-btn').forEach((btn, idx) => {\n      btn.addEventListener('click', () => {\n        if (analyses.length < 2) {\n          toast.info('Need at least 2 analyses to compare');\n          return;\n        }\n        toast.info('Compare feature coming soon');\n      });\n    });\n  } catch {\n    listEl.innerHTML = '<div class=\"empty-section\">No analysis history available</div>';\n  }\n}\n\n/**\n * Show analysis detail in a modal overlay\n * Fetches extraction_result from the document if not available in analysis\n * Uses /extraction endpoint to get enriched participant data with contact linking\n */\nasync function showAnalysisDetail(container: HTMLElement, analysis: AIAnalysis): Promise<void> {\n  // Try to get the full result with enriched participants\n  let fullResult = analysis.result;\n  if (analysis.document_id) {\n    try {\n      // Use /extraction endpoint which enriches participants with contact info\n      const extractionResponse = await http.get<{ extraction?: Record<string, unknown> }>(`/api/documents/${analysis.document_id}/extraction`);\n      if (extractionResponse.data.extraction) {\n        fullResult = extractionResponse.data.extraction;\n        console.log('[Analysis] Loaded enriched extraction from /extraction endpoint');\n      }\n    } catch (err) {\n      console.warn('[Analysis] Could not load extraction:', err);\n      // Fallback to document API\n      if (!fullResult) {\n        try {\n          const docResponse = await http.get<{ document?: { extraction_result?: Record<string, unknown> }, extraction_result?: Record<string, unknown> }>(`/api/documents/${analysis.document_id}`);\n          fullResult = docResponse.data.document?.extraction_result || docResponse.data.extraction_result;\n        } catch {\n          // ignore\n        }\n      }\n    }\n  }\n  // Create overlay\n  const overlay = document.createElement('div');\n  overlay.className = 'analysis-detail-overlay';\n\n  // Format the result JSON nicely\n  const resultJson = fullResult \n    ? JSON.stringify(fullResult, null, 2) \n    : 'No detailed result available';\n  \n  // Build summary from result if available\n  let summary = '';\n  let peopleDetected: Array<{\n    name: string; \n    role?: string; \n    organization?: string;\n    contact_id?: string;\n    contact_name?: string;\n    contact_email?: string;\n    contact_avatar?: string;\n    contact_role?: string;\n  }> = [];\n  if (fullResult) {\n    const r = fullResult as any;\n    if (r.summary) summary = r.summary;\n    else if (r.meeting?.title) summary = `Meeting: ${r.meeting.title}`;\n    \n    // Extract people from participants and entities\n    const participants = r.participants || [];\n    const entities = r.entities || [];\n    const personEntities = entities.filter((e: any) => e.type?.toLowerCase() === 'person');\n    \n    // Merge and deduplicate\n    const peopleNames = new Set<string>();\n    for (const p of participants) {\n      if (p.name && !peopleNames.has(p.name.toLowerCase())) {\n        peopleNames.add(p.name.toLowerCase());\n        peopleDetected.push({ \n          name: p.name, \n          role: p.role, \n          organization: p.organization,\n          contact_id: p.contact_id,\n          contact_name: p.contact_name,\n          contact_email: p.contact_email,\n          contact_avatar: p.contact_avatar,\n          contact_role: p.contact_role\n        });\n      }\n    }\n    for (const pe of personEntities) {\n      if (pe.name && !peopleNames.has(pe.name.toLowerCase())) {\n        peopleNames.add(pe.name.toLowerCase());\n        peopleDetected.push({ \n          name: pe.name,\n          contact_id: pe.contact_id,\n          contact_name: pe.contact_name,\n          contact_email: pe.contact_email,\n          contact_avatar: pe.contact_avatar,\n          contact_role: pe.contact_role\n        });\n      }\n    }\n  }\n  \n  // Separate linked and unlinked people\n  const linkedPeople = peopleDetected.filter(p => p.contact_id);\n  const unlinkedPeople = peopleDetected.filter(p => !p.contact_id);\n  \n  // Build people section HTML with separate linked and unlinked sections\n  const peopleSectionHtml = peopleDetected.length > 0 ? `\n    <div class=\"analysis-people-section\">\n      <h4 class=\"analysis-people-title\">\n        <span class=\"analysis-people-title-emoji\">üë•</span> People Detected\n        <span class=\"analysis-people-badge\">${peopleDetected.length}</span>\n        ${linkedPeople.length > 0 ? `<span class=\"analysis-people-badge analysis-people-badge-linked\">‚úì ${linkedPeople.length} linked</span>` : ''}\n      </h4>\n      \n      ${linkedPeople.length > 0 ? `\n        <div class=\"analysis-people-linked-wrap\">\n          <div class=\"analysis-people-section-label\">Linked to Contacts</div>\n          <div class=\"analysis-people-chips\">\n            ${linkedPeople.map(p => `\n              <div class=\"person-chip linked entity-chip entity-chip-linked\" data-name=\"${escapeHtml(p.name)}\" data-contact-id=\"${escapeHtml(p.contact_id || '')}\" data-contact-name=\"${escapeHtml(p.contact_name || '')}\">\n                ${p.contact_avatar ? `\n                  <img class=\"entity-chip-avatar\" src=\"${escapeHtml(p.contact_avatar)}\" alt=\"\">\n                ` : `\n                  <div class=\"entity-chip-avatar-placeholder\">${(p.contact_name || p.name || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase()}</div>\n                `}\n                <div class=\"entity-chip-body\">\n                  <div class=\"entity-chip-linked-row\">\n                    <span class=\"entity-chip-name\">${escapeHtml(p.name)}</span>\n                    <svg class=\"entity-chip-linked-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\">\n                      <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\n                      <polyline points=\"22 4 12 14.01 9 11.01\"/>\n                    </svg>\n                  </div>\n                  <div class=\"entity-chip-meta entity-chip-meta-ellipsis\">\n                    ‚Üí ${escapeHtml(p.contact_name || 'Contact')}${p.contact_role ? ` ‚Ä¢ ${escapeHtml(p.contact_role)}` : ''}\n                  </div>\n                </div>\n              </div>\n            `).join('')}\n          </div>\n        </div>\n      ` : ''}\n      \n      ${unlinkedPeople.length > 0 ? `\n        <div>\n          <div class=\"analysis-people-section-label\">\n            ${linkedPeople.length > 0 ? 'Not Yet Linked' : 'Click to Link or Create Contact'}\n          </div>\n          <div class=\"analysis-people-chips\">\n            ${unlinkedPeople.map(p => `\n              <div class=\"person-chip unlinked entity-chip entity-chip-unlinked\" data-name=\"${escapeHtml(p.name)}\" data-role=\"${escapeHtml(p.role || '')}\" data-org=\"${escapeHtml(p.organization || '')}\">\n                <div class=\"entity-chip-avatar-placeholder\">${(p.name || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase()}</div>\n                <div class=\"entity-chip-body\">\n                  <div class=\"entity-chip-name\">${escapeHtml(p.name)}</div>\n                  ${p.role || p.organization ? `<div class=\"entity-chip-meta\">${p.role || ''}${p.role && p.organization ? ' ‚Ä¢ ' : ''}${p.organization || ''}</div>` : ''}\n                </div>\n              </div>\n            `).join('')}\n          </div>\n        </div>\n      ` : ''}\n      \n      <p class=\"analysis-people-hint\">\n        üí° Click on any person to ${linkedPeople.length > 0 ? 'view/change the link' : 'link them to a contact or create a new one'}\n      </p>\n    </div>\n  ` : '';\n  \n  const content = document.createElement('div');\n  content.className = 'analysis-detail-content';\n\n  content.innerHTML = `\n    <div class=\"analysis-detail-header\">\n      <div>\n        <h3 class=\"analysis-detail-title\">${capitalizeFirst(analysis.analysis_type)} Analysis</h3>\n        <p class=\"analysis-detail-meta\">\n          ${analysis.provider}/${analysis.model} ‚Ä¢ ${analysis.entities_extracted || 0} entities ‚Ä¢ ${formatRelativeTime(analysis.created_at)}\n        </p>\n      </div>\n      <button type=\"button\" class=\"close-analysis-btn analysis-detail-close-btn\">&times;</button>\n    </div>\n    ${summary ? `\n      <div class=\"analysis-detail-summary-block\">\n        <strong class=\"analysis-detail-summary-label\">Summary:</strong>\n        <p class=\"analysis-detail-summary-text\">${escapeHtml(summary)}</p>\n      </div>\n    ` : ''}\n    <div class=\"analysis-detail-body\">\n      <div class=\"analysis-detail-stats\">\n        <div class=\"analysis-detail-stat\">\n          <div class=\"analysis-detail-stat-value\">${analysis.entities_extracted || 0}</div>\n          <div class=\"analysis-detail-stat-label\">Entities</div>\n        </div>\n        <div class=\"analysis-detail-stat\">\n          <div class=\"analysis-detail-stat-value\">${analysis.input_tokens || 0}</div>\n          <div class=\"analysis-detail-stat-label\">Input Tokens</div>\n        </div>\n        <div class=\"analysis-detail-stat\">\n          <div class=\"analysis-detail-stat-value\">${analysis.output_tokens || 0}</div>\n          <div class=\"analysis-detail-stat-label\">Output Tokens</div>\n        </div>\n        <div class=\"analysis-detail-stat\">\n          <div class=\"analysis-detail-stat-value\">${analysis.latency_ms ? `${(analysis.latency_ms / 1000).toFixed(1)}s` : '-'}</div>\n          <div class=\"analysis-detail-stat-label\">Latency</div>\n        </div>\n      </div>\n      ${peopleSectionHtml}\n      <details class=\"analysis-detail-raw-wrap\">\n        <summary class=\"analysis-detail-raw-summary\">Raw Result JSON</summary>\n        <pre class=\"analysis-detail-raw-pre\">${escapeHtml(resultJson)}</pre>\n      </details>\n    </div>\n  `;\n  \n  overlay.appendChild(content);\n  document.body.appendChild(overlay);\n  \n  // Close handlers\n  const closeBtn = content.querySelector('.close-analysis-btn');\n  closeBtn?.addEventListener('click', () => overlay.remove());\n  overlay.addEventListener('click', (e) => {\n    if (e.target === overlay) overlay.remove();\n  });\n  \n  // Person chip click handlers\n  const projectId = (window as any).currentProjectId || \n    document.body.dataset.projectId || \n    container.closest('[data-project-id]')?.getAttribute('data-project-id') ||\n    '';\n  \n  content.querySelectorAll('.person-chip').forEach(chip => {\n    const el = chip as HTMLElement;\n    chip.addEventListener('click', async (e) => {\n      e.stopPropagation();\n      const personName = el.dataset.name || '';\n      const personRole = el.dataset.role || '';\n      const personOrg = el.dataset.org || '';\n      const currentContactId = el.dataset.contactId || '';\n      const currentContactName = el.dataset.contactName || '';\n      \n      await showPersonLinkMenu(el, personName, personRole, personOrg, projectId, currentContactId, currentContactName);\n    });\n    \n    /* Hover is handled via .entity-chip-linked:hover and .entity-chip-unlinked:hover in modals.css */\n  });\n}\n\n/**\n * Show menu to link a person to contact or create new\n */\nasync function showPersonLinkMenu(\n  chipEl: HTMLElement,\n  personName: string,\n  personRole: string,\n  personOrg: string,\n  projectId: string,\n  currentContactId: string = '',\n  currentContactName: string = ''\n): Promise<void> {\n  // Remove any existing menu\n  document.querySelectorAll('.person-link-menu').forEach(m => m.remove());\n  \n  const isLinked = !!currentContactId;\n  \n  const menu = document.createElement('div');\n  menu.className = 'person-link-menu';\n  menu.innerHTML = `\n    <style>\n      .person-link-menu {\n        position: fixed;\n        z-index: 10002;\n        background: var(--bg-primary, #1a1a2e);\n        border: 1px solid var(--border-color, #333);\n        border-radius: 12px;\n        box-shadow: 0 8px 24px rgba(0,0,0,0.3);\n        min-width: 320px;\n        max-height: 450px;\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n      }\n      .person-link-menu-header {\n        padding: 16px;\n        border-bottom: 1px solid var(--border-color, #333);\n      }\n      .person-link-menu-header h4 {\n        margin: 0 0 4px 0;\n        color: var(--text-primary, #fff);\n        font-size: 14px;\n      }\n      .person-link-menu-header p {\n        margin: 0;\n        color: var(--text-tertiary, #666);\n        font-size: 12px;\n      }\n      .person-link-menu-current {\n        padding: 12px 16px;\n        background: rgba(16, 185, 129, 0.1);\n        border-bottom: 1px solid var(--border-color, #333);\n      }\n      .person-link-menu-current-label {\n        font-size: 11px;\n        color: #10b981;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n        margin-bottom: 8px;\n      }\n      .person-link-menu-current-contact {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        padding: 8px 12px;\n        background: var(--bg-secondary, #252542);\n        border-radius: 8px;\n      }\n      .person-link-menu-current-avatar {\n        width: 36px;\n        height: 36px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #10b981, #059669);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-size: 13px;\n        font-weight: 600;\n      }\n      .person-link-menu-current-info {\n        flex: 1;\n      }\n      .person-link-menu-current-name {\n        font-weight: 500;\n        font-size: 14px;\n        color: var(--text-primary, #fff);\n      }\n      .person-link-menu-current-badge {\n        font-size: 11px;\n        color: #10b981;\n        display: flex;\n        align-items: center;\n        gap: 4px;\n      }\n      .person-link-menu-unlink-btn {\n        padding: 6px 12px;\n        font-size: 12px;\n        background: rgba(239, 68, 68, 0.1);\n        color: #ef4444;\n        border: 1px solid rgba(239, 68, 68, 0.3);\n        border-radius: 6px;\n        cursor: pointer;\n        transition: all 0.15s ease;\n      }\n      .person-link-menu-unlink-btn:hover {\n        background: rgba(239, 68, 68, 0.2);\n        border-color: rgba(239, 68, 68, 0.5);\n      }\n      .person-link-menu-divider {\n        padding: 8px 16px;\n        font-size: 11px;\n        color: var(--text-tertiary, #666);\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n        border-bottom: 1px solid var(--border-color, #333);\n      }\n      .person-link-menu-search {\n        padding: 12px 16px;\n        border-bottom: 1px solid var(--border-color, #333);\n      }\n      .person-link-menu-search input {\n        width: 100%;\n        padding: 10px 12px;\n        border: 1px solid var(--border-color, #333);\n        border-radius: 8px;\n        background: var(--bg-secondary, #252542);\n        color: var(--text-primary, #fff);\n        font-size: 13px;\n      }\n      .person-link-menu-search input:focus {\n        outline: none;\n        border-color: var(--accent-color, #6366f1);\n      }\n      .person-link-menu-list {\n        overflow-y: auto;\n        max-height: 180px;\n        padding: 8px;\n      }\n      .person-link-menu-item {\n        padding: 10px 12px;\n        border-radius: 8px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        color: var(--text-primary, #fff);\n      }\n      .person-link-menu-item:hover {\n        background: var(--bg-secondary, #252542);\n      }\n      .person-link-menu-item.selected {\n        background: rgba(16, 185, 129, 0.1);\n        border: 1px solid rgba(16, 185, 129, 0.3);\n      }\n      .person-link-menu-avatar {\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, var(--accent-color, #6366f1), #8b5cf6);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-size: 12px;\n        font-weight: 600;\n      }\n      .person-link-menu-info {\n        flex: 1;\n        min-width: 0;\n      }\n      .person-link-menu-name {\n        font-weight: 500;\n        font-size: 13px;\n      }\n      .person-link-menu-email {\n        font-size: 11px;\n        color: var(--text-tertiary, #666);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .person-link-menu-actions {\n        padding: 12px 16px;\n        border-top: 1px solid var(--border-color, #333);\n        display: flex;\n        gap: 8px;\n      }\n      .person-link-menu-btn {\n        flex: 1;\n        padding: 10px;\n        border-radius: 8px;\n        font-size: 13px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.15s ease;\n      }\n      .person-link-menu-btn.primary {\n        background: var(--accent-color, #6366f1);\n        color: white;\n        border: none;\n      }\n      .person-link-menu-btn.primary:hover {\n        opacity: 0.9;\n      }\n      .person-link-menu-btn.secondary {\n        background: transparent;\n        color: var(--text-secondary, #888);\n        border: 1px solid var(--border-color, #333);\n      }\n      .person-link-menu-btn.secondary:hover {\n        border-color: var(--text-secondary, #888);\n      }\n      .person-link-menu-empty {\n        padding: 20px;\n        text-align: center;\n        color: var(--text-tertiary, #666);\n        font-size: 13px;\n      }\n      .person-link-menu-loading {\n        padding: 20px;\n        text-align: center;\n        color: var(--text-tertiary, #666);\n      }\n    </style>\n    <div class=\"person-link-menu-header\">\n      <h4>${isLinked ? 'Change Link' : 'Link'} \"${escapeHtml(personName)}\"</h4>\n      <p>${isLinked ? 'Change the linked contact or unlink' : 'Select an existing contact or create a new one'}</p>\n    </div>\n    ${isLinked ? `\n      <div class=\"person-link-menu-current\">\n        <div class=\"person-link-menu-current-label\">Currently Linked To</div>\n        <div class=\"person-link-menu-current-contact\">\n          <div class=\"person-link-menu-current-avatar\">${(currentContactName || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase()}</div>\n          <div class=\"person-link-menu-current-info\">\n            <div class=\"person-link-menu-current-name\">${escapeHtml(currentContactName)}</div>\n            <div class=\"person-link-menu-current-badge\">\n              <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\">\n                <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\n                <polyline points=\"22 4 12 14.01 9 11.01\"/>\n              </svg>\n              Linked\n            </div>\n          </div>\n          <button class=\"person-link-menu-unlink-btn unlink-btn\">Unlink</button>\n        </div>\n      </div>\n      <div class=\"person-link-menu-divider\">Or change to another contact</div>\n    ` : ''}\n    <div class=\"person-link-menu-search\">\n      <input type=\"text\" placeholder=\"Search contacts...\" autofocus>\n    </div>\n    <div class=\"person-link-menu-list\">\n      <div class=\"person-link-menu-loading\">Loading contacts...</div>\n    </div>\n    <div class=\"person-link-menu-actions\">\n      <button class=\"person-link-menu-btn secondary cancel-btn\">Cancel</button>\n      <button class=\"person-link-menu-btn primary create-btn\">+ Create New Contact</button>\n    </div>\n  `;\n  \n  // Position menu near chip\n  const rect = chipEl.getBoundingClientRect();\n  menu.style.position = 'fixed';\n  menu.style.top = `${Math.min(rect.bottom + 8, window.innerHeight - 420)}px`;\n  menu.style.left = `${Math.min(rect.left, window.innerWidth - 320)}px`;\n  \n  document.body.appendChild(menu);\n  \n  // Focus search input\n  const searchInput = menu.querySelector('input') as HTMLInputElement;\n  searchInput?.focus();\n  \n  // Load contacts\n  try {\n    const response = await http.get<{ contacts: Array<{ id: string; name: string; email?: string }> }>(\n      `/api/contacts?project_id=${projectId}&limit=100`\n    );\n    const contacts = response.data.contacts || [];\n    \n    const listEl = menu.querySelector('.person-link-menu-list') as HTMLElement;\n    \n    const renderContacts = (filtered: typeof contacts) => {\n      if (filtered.length === 0) {\n        listEl.innerHTML = '<div class=\"person-link-menu-empty\">No matching contacts</div>';\n        return;\n      }\n      \n      listEl.innerHTML = filtered.map(c => {\n        const initials = (c.name || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();\n        const avatar = (c as any).avatar_url || (c as any).photo_url || '';\n        const role = (c as any).role || '';\n        return `\n          <div class=\"person-link-menu-item\" \n               data-contact-id=\"${c.id}\" \n               data-contact-name=\"${escapeHtml(c.name || '')}\"\n               data-contact-email=\"${escapeHtml(c.email || '')}\"\n               data-contact-avatar=\"${escapeHtml(avatar)}\"\n               data-contact-role=\"${escapeHtml(role)}\">\n            ${avatar ? `\n              <img src=\"${escapeHtml(avatar)}\" alt=\"\" class=\"person-link-menu-avatar person-link-menu-avatar-img\">\n            ` : `\n              <div class=\"person-link-menu-avatar\">${initials}</div>\n            `}\n            <div class=\"person-link-menu-info\">\n              <div class=\"person-link-menu-name\">${escapeHtml(c.name || 'Unknown')}</div>\n              ${role ? `<div class=\"person-link-menu-email\">${escapeHtml(role)}</div>` : ''}\n              ${c.email ? `<div class=\"person-link-menu-email\">${escapeHtml(c.email)}</div>` : ''}\n            </div>\n          </div>\n        `;\n      }).join('');\n      \n      // Add click handlers\n      listEl.querySelectorAll('.person-link-menu-item').forEach(item => {\n        item.addEventListener('click', async () => {\n          const contactId = (item as HTMLElement).dataset.contactId || '';\n          const contactName = (item as HTMLElement).dataset.contactName || '';\n          const contactEmail = (item as HTMLElement).dataset.contactEmail || '';\n          const contactAvatar = (item as HTMLElement).dataset.contactAvatar || '';\n          const contactRole = (item as HTMLElement).dataset.contactRole || '';\n          \n          try {\n            await http.post('/api/contacts/link-participant', {\n              projectId,\n              participantName: personName,\n              contactId\n            });\n            \n            toast.success(`Linked \"${personName}\" to ${contactName}`);\n            menu.remove();\n            \n            // Transform chip to show linked status with contact info\n            updateChipToLinked(chipEl, personName, contactId, contactName, contactEmail, contactAvatar, contactRole);\n          } catch (err) {\n            console.error('[People] Failed to link:', err);\n            toast.error('Failed to link contact');\n          }\n        });\n      });\n    };\n    \n    renderContacts(contacts);\n    \n    // Search filter\n    searchInput?.addEventListener('input', () => {\n      const query = searchInput.value.toLowerCase();\n      const filtered = contacts.filter(c => \n        c.name?.toLowerCase().includes(query) || \n        c.email?.toLowerCase().includes(query)\n      );\n      renderContacts(filtered);\n    });\n    \n  } catch (err) {\n    console.error('[People] Failed to load contacts:', err);\n    const listEl = menu.querySelector('.person-link-menu-list') as HTMLElement;\n    listEl.innerHTML = '<div class=\"person-link-menu-empty\">Failed to load contacts</div>';\n  }\n  \n  // Cancel button\n  menu.querySelector('.cancel-btn')?.addEventListener('click', () => menu.remove());\n  \n  // Unlink button (only if currently linked)\n  menu.querySelector('.unlink-btn')?.addEventListener('click', async () => {\n    try {\n      await http.post('/api/contacts/unlink-participant', {\n        projectId,\n        participantName: personName\n      });\n      \n      toast.success(`Unlinked \"${personName}\"`);\n      menu.remove();\n      \n      // Transform chip back to unlinked state\n      updateChipToUnlinked(chipEl, personName, personRole, personOrg);\n    } catch (err) {\n      console.error('[People] Failed to unlink:', err);\n      toast.error('Failed to unlink contact');\n    }\n  });\n  \n  // Create new contact button\n  menu.querySelector('.create-btn')?.addEventListener('click', async () => {\n    try {\n      const response = await http.post<{ ok: boolean; contact?: { id: string; name: string; role?: string; avatar_url?: string }; error?: string }>(\n        '/api/contacts',\n        {\n          project_id: projectId,\n          name: personName,\n          role: personRole || undefined,\n          organization: personOrg || undefined,\n          source: 'document_extraction'\n        }\n      );\n      \n      if (response.data.ok && response.data.contact) {\n        toast.success(`Created contact: ${response.data.contact.name}`);\n        menu.remove();\n        \n        // Transform chip to show linked status\n        updateChipToLinked(\n          chipEl, \n          personName, \n          response.data.contact.id, \n          response.data.contact.name,\n          '',\n          response.data.contact.avatar_url || '',\n          response.data.contact.role || personRole\n        );\n      } else {\n        toast.error(response.data.error || 'Failed to create contact');\n      }\n    } catch (err) {\n      console.error('[People] Failed to create contact:', err);\n      toast.error('Failed to create contact');\n    }\n  });\n  \n  // Close on click outside\n  const closeHandler = (e: MouseEvent) => {\n    if (!menu.contains(e.target as Node) && e.target !== chipEl) {\n      menu.remove();\n      document.removeEventListener('click', closeHandler);\n    }\n  };\n  setTimeout(() => document.addEventListener('click', closeHandler), 100);\n  \n  // Close on Escape\n  const escHandler = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      menu.remove();\n      document.removeEventListener('keydown', escHandler);\n    }\n  };\n  document.addEventListener('keydown', escHandler);\n}\n\n/**\n * Update a person chip to show unlinked status\n */\nfunction updateChipToUnlinked(\n  chipEl: HTMLElement,\n  personName: string,\n  personRole: string,\n  personOrg: string\n): void {\n  const initials = (personName || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();\n  \n  chipEl.classList.remove('linked');\n  chipEl.classList.add('unlinked', 'entity-chip', 'entity-chip-unlinked');\n  delete chipEl.dataset.contactId;\n  delete chipEl.dataset.contactName;\n\n  chipEl.innerHTML = `\n    <div class=\"entity-chip-avatar-placeholder\">${initials}</div>\n    <div class=\"entity-chip-body\">\n      <div class=\"entity-chip-name\">${escapeHtml(personName)}</div>\n      ${personRole || personOrg ? `<div class=\"entity-chip-meta\">${personRole || ''}${personRole && personOrg ? ' ‚Ä¢ ' : ''}${personOrg || ''}</div>` : ''}\n    </div>\n  `;\n}\n\n/**\n * Update a person chip to show linked status with contact info\n */\nfunction updateChipToLinked(\n  chipEl: HTMLElement,\n  personName: string,\n  contactId: string,\n  contactName: string,\n  contactEmail: string,\n  contactAvatar: string,\n  contactRole: string\n): void {\n  const initials = (contactName || personName || '?').split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();\n  \n  chipEl.classList.remove('entity-chip-unlinked');\n  chipEl.classList.add('linked', 'entity-chip', 'entity-chip-linked');\n  chipEl.dataset.contactId = contactId;\n  chipEl.dataset.contactName = contactName;\n\n  chipEl.innerHTML = `\n    ${contactAvatar ? `\n      <img class=\"entity-chip-avatar\" src=\"${escapeHtml(contactAvatar)}\" alt=\"\">\n    ` : `\n      <div class=\"entity-chip-avatar-placeholder\">${initials}</div>\n    `}\n    <div class=\"entity-chip-body\">\n      <div class=\"entity-chip-linked-row\">\n        <span class=\"entity-chip-name\">${escapeHtml(personName)}</span>\n        <svg class=\"entity-chip-linked-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\">\n          <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\n          <polyline points=\"22 4 12 14.01 9 11.01\"/>\n        </svg>\n      </div>\n      <div class=\"entity-chip-meta entity-chip-meta-ellipsis\">\n        ‚Üí ${escapeHtml(contactName)}${contactRole ? ` ‚Ä¢ ${escapeHtml(contactRole)}` : ''}\n      </div>\n    </div>\n  `;\n}\n\nasync function loadVersions(container: HTMLElement, docId: string): Promise<void> {\n  const listEl = container.querySelector('#versions-list') as HTMLElement;\n  \n  try {\n    const response = await http.get<{ versions: DocumentVersion[] }>(`/api/documents/${docId}/versions`);\n    const versions = response.data.versions || [];\n    \n    container.querySelector('#versions-count')!.textContent = String(versions.length || 1);\n    \n    if (versions.length === 0) {\n      listEl.innerHTML = `\n        <div class=\"version-item current\">\n          <div class=\"version-badge\">v1</div>\n          <div class=\"version-info\">\n            <div class=\"version-title\">Current Version <span class=\"current-tag\">Current</span></div>\n            <div class=\"version-notes\">Initial upload</div>\n          </div>\n        </div>\n      `;\n      return;\n    }\n    \n    listEl.innerHTML = versions.map(v => `\n      <div class=\"version-item ${v.is_current ? 'current' : ''}\" data-id=\"${v.id}\">\n        <div class=\"version-badge\">v${v.version_number}</div>\n        <div class=\"version-info\">\n          <div class=\"version-title\">\n            ${escapeHtml(v.filename)}\n            ${v.is_current ? '<span class=\"current-tag\">Current</span>' : ''}\n          </div>\n          ${v.change_notes ? `<div class=\"version-notes\">\"${escapeHtml(v.change_notes)}\"</div>` : ''}\n          <div class=\"version-meta\">\n            ${formatFileSize(v.file_size)} ‚Ä¢ ${formatRelativeTime(v.created_at)}\n          </div>\n          ${v.ai_change_summary ? `\n            <div class=\"version-ai-summary\">\n              <strong>AI:</strong> ${escapeHtml(v.ai_change_summary)}\n            </div>\n          ` : ''}\n        </div>\n        <div class=\"version-actions version-actions-row\">\n          <button class=\"btn btn-sm view-version-btn\">View</button>\n          ${!v.is_current ? '<button class=\"btn btn-sm restore-version-btn\">Restore</button>' : ''}\n          ${v.version_number > 1 ? '<button class=\"btn btn-sm diff-version-btn\">Diff</button>' : ''}\n        </div>\n      </div>\n    `).join('');\n  } catch {\n    listEl.innerHTML = '<div class=\"empty-section\">Version history not available</div>';\n  }\n}\n\nasync function loadActivity(container: HTMLElement, docId: string): Promise<void> {\n  const timelineEl = container.querySelector('#activity-timeline') as HTMLElement;\n  \n  try {\n    const response = await http.get<{ activities: DocumentActivity[] }>(`/api/documents/${docId}/activity`);\n    const activities = response.data.activities || [];\n    \n    if (activities.length === 0) {\n      timelineEl.innerHTML = '<div class=\"empty-section\">No activity recorded</div>';\n      return;\n    }\n    \n    timelineEl.innerHTML = activities.map(a => `\n      <div class=\"activity-item\">\n        <div class=\"activity-content\">\n          <div class=\"activity-avatar\">\n            ${a.user_avatar ? `<img src=\"${a.user_avatar}\" alt=\"\">` : getInitials(a.user_name || 'System')}\n          </div>\n          <div class=\"activity-text\">\n            <strong>${escapeHtml(a.user_name || 'System')}</strong> ${getActionText(a.action)}\n          </div>\n          <div class=\"activity-time\">${formatRelativeTime(a.created_at)}</div>\n        </div>\n      </div>\n    `).join('');\n  } catch {\n    timelineEl.innerHTML = '<div class=\"empty-section\">Activity not available</div>';\n  }\n}\n\n/**\n * Load meeting notes (v1.6 notes_rendered_text from extraction)\n */\nasync function loadMeetingNotes(container: HTMLElement, docId: string): Promise<void> {\n  const notesContainer = container.querySelector('#notes-container') as HTMLElement;\n  const notesTab = container.querySelector('#notes-tab') as HTMLElement;\n  \n  try {\n    // Fetch extraction data to get notes_rendered_text\n    const response = await http.get<{ extraction?: { notes_rendered_text?: string; notes?: { key_points?: unknown[]; outline?: unknown[] } } }>(`/api/documents/${docId}/extraction`);\n    const extraction = response.data.extraction;\n    \n    // Check if notes exist\n    const hasNotes = extraction?.notes_rendered_text || (extraction?.notes?.key_points?.length || 0) > 0;\n    \n    if (!hasNotes) {\n      // Hide notes tab if no notes\n      if (notesTab) notesTab.classList.add('hidden');\n      return;\n    }\n    \n    // Show notes tab\n    if (notesTab) notesTab.classList.remove('hidden');\n    \n    // Render notes\n    const notesText = extraction?.notes_rendered_text || '';\n    const notes = extraction?.notes;\n    \n    if (notesText) {\n      // Render with rich formatting\n      notesContainer.innerHTML = `\n        <style>\n          .notes-rendered {\n            padding: 20px;\n            background: var(--bg-secondary);\n            border-radius: 12px;\n            line-height: 1.7;\n          }\n          .notes-header {\n            font-size: 18px;\n            font-weight: 600;\n            margin-bottom: 4px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n          }\n          .notes-meta {\n            font-size: 13px;\n            color: var(--text-secondary);\n            margin-bottom: 20px;\n            padding-bottom: 16px;\n            border-bottom: 1px solid var(--border-color);\n          }\n          .notes-topic {\n            margin-bottom: 20px;\n          }\n          .notes-topic-title {\n            font-size: 15px;\n            font-weight: 600;\n            color: var(--text-primary);\n            margin-bottom: 10px;\n            padding-left: 8px;\n            border-left: 3px solid var(--primary);\n          }\n          .notes-bullet {\n            padding: 10px 12px;\n            background: var(--bg-primary);\n            border-radius: 8px;\n            margin-bottom: 8px;\n            font-size: 14px;\n            color: var(--text-primary);\n            line-height: 1.6;\n          }\n          .notes-bullet:last-child {\n            margin-bottom: 0;\n          }\n          .notes-actions {\n            margin-top: 20px;\n            padding-top: 16px;\n            border-top: 1px solid var(--border-color);\n            display: flex;\n            gap: 8px;\n          }\n        </style>\n        <div class=\"notes-rendered\">\n          ${renderNotesAsHtml(notesText)}\n          <div class=\"notes-actions\">\n            <button class=\"btn btn-secondary btn-sm\" id=\"copy-notes-btn\">\n              üìã Copy Notes\n            </button>\n          </div>\n        </div>\n      `;\n      \n      // Add copy handler\n      container.querySelector('#copy-notes-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(notesText);\n        toast.success('Notes copied to clipboard');\n      });\n    } else if (notes) {\n      // Fallback: render from structured notes\n      const keyPoints = (notes.key_points as Array<{ text: string }>)?.map(kp => `‚Ä¢ ${kp.text}`).join('\\n') || '';\n      const outline = (notes.outline as Array<{ topic: string; bullets: Array<{ text: string }> }>)?.map(\n        o => `**${o.topic}**\\n${o.bullets?.map(b => `  ‚Ä¢ ${b.text}`).join('\\n') || ''}`\n      ).join('\\n\\n') || '';\n      \n      notesContainer.innerHTML = `\n        <div class=\"notes-structured\">\n          ${keyPoints ? `<div class=\"notes-section\"><h4>Key Points</h4><pre class=\"conv-notes-pre\">${escapeHtml(keyPoints)}</pre></div>` : ''}\n          ${outline ? `<div class=\"notes-section\"><h4>Outline</h4><pre class=\"conv-notes-pre\">${escapeHtml(outline)}</pre></div>` : ''}\n        </div>\n      `;\n    }\n  } catch {\n    notesContainer.innerHTML = '<div class=\"empty-section\">Meeting notes not available</div>';\n    if (notesTab) notesTab.classList.add('hidden');\n  }\n}\n\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Render notes_rendered_text as styled HTML\n * Parses the text format:\n * - üìù GodMode Notes (header)\n * - üïû Started at... (meta)\n * - Topic Name (topic titles - lines without leading -)\n * - - Bullet text (bullets - lines starting with -)\n */\nfunction renderNotesAsHtml(text: string): string {\n  const lines = text.split('\\n');\n  let html = '';\n  let currentTopic = '';\n  let bulletsHtml = '';\n  let headerDone = false;\n  let metaDone = false;\n  \n  const flushTopic = () => {\n    if (currentTopic && bulletsHtml) {\n      html += `\n        <div class=\"notes-topic\">\n          <div class=\"notes-topic-title\">${escapeHtml(currentTopic)}</div>\n          ${bulletsHtml}\n        </div>\n      `;\n    }\n    currentTopic = '';\n    bulletsHtml = '';\n  };\n  \n  for (const line of lines) {\n    const trimmed = line.trim();\n    if (!trimmed) continue;\n    \n    // Header line (üìù GodMode Notes)\n    if (!headerDone && trimmed.startsWith('üìù')) {\n      html += `<div class=\"notes-header\">${escapeHtml(trimmed)}</div>`;\n      headerDone = true;\n      continue;\n    }\n    \n    // Meta line (üïû Started at...)\n    if (!metaDone && trimmed.startsWith('üïû')) {\n      html += `<div class=\"notes-meta\">${escapeHtml(trimmed)}</div>`;\n      metaDone = true;\n      continue;\n    }\n    \n    // Bullet line (starts with -)\n    if (trimmed.startsWith('-')) {\n      const bulletText = trimmed.substring(1).trim();\n      bulletsHtml += `<div class=\"notes-bullet\">${escapeHtml(bulletText)}</div>`;\n      continue;\n    }\n    \n    // Topic title (any other non-empty line)\n    flushTopic();\n    currentTopic = trimmed;\n  }\n  \n  // Flush last topic\n  flushTopic();\n  \n  // If no structured content found, fallback to pre\n  if (!html.includes('notes-topic')) {\n    return `<pre class=\"conv-notes-pre\">${escapeHtml(text)}</pre>`;\n  }\n  \n  return html;\n}\n\nasync function checkFavoriteStatus(docId: string): Promise<boolean> {\n  try {\n    const response = await http.get<{ is_favorite: boolean }>(`/api/documents/${docId}/favorite`);\n    return response.data.is_favorite || false;\n  } catch {\n    return false;\n  }\n}\n\nfunction updateFavoriteButton(container: HTMLElement): void {\n  const btn = container.querySelector('#favorite-btn') as HTMLButtonElement;\n  if (btn) {\n    btn.classList.toggle('active', isFavorite);\n    btn.innerHTML = isFavorite ? '‚òÖ' : '‚òÜ';\n  }\n}\n\nasync function toggleFavorite(container: HTMLElement, doc: Document): Promise<void> {\n  try {\n    await http.post(`/api/documents/${doc.id}/favorite`);\n    isFavorite = !isFavorite;\n    updateFavoriteButton(container);\n    toast.success(isFavorite ? 'Added to favorites' : 'Removed from favorites');\n  } catch {\n    toast.error('Failed to update favorite');\n  }\n}\n\nfunction downloadDocument(doc: Document): void {\n  window.open(`/api/documents/${doc.id}/download`, '_blank');\n}\n\n/**\n * Refresh modal content after reprocessing\n * Updates counters, summary, content preview and reloads AI Analysis tab\n */\nasync function refreshModalContent(container: HTMLElement, docId: string): Promise<void> {\n  try {\n    // 1. Fetch updated document data\n    const response = await http.get<Document>(`/api/documents/${docId}`);\n    const updatedDoc = response.data;\n    \n    // 2. Update entity counters\n    const entityTypes = ['facts', 'decisions', 'risks', 'actions', 'questions'];\n    for (const type of entityTypes) {\n      const card = container.querySelector(`[data-entity=\"${type}\"]`);\n      if (card) {\n        const countEl = card.querySelector('.entity-count');\n        if (countEl) {\n          const count = (updatedDoc as any)[`${type}_count`] || 0;\n          countEl.textContent = String(count);\n          \n          // Add highlight animation\n          card.classList.add('updated');\n          setTimeout(() => card.classList.remove('updated'), 1500);\n        }\n      }\n    }\n    \n    // 3. Update summary\n    const summaryCard = container.querySelector('#summary-card') as HTMLElement;\n    const summaryEl = container.querySelector('#doc-summary');\n    if (summaryCard && summaryEl) {\n      if (updatedDoc.summary) {\n        summaryCard.classList.remove('hidden');\n        summaryEl.textContent = updatedDoc.summary;\n      } else {\n        summaryCard.classList.add('hidden');\n      }\n    }\n    \n    // 4. Update content preview\n    const contentPreview = container.querySelector('#content-preview');\n    if (contentPreview && updatedDoc.content) {\n      const truncated = updatedDoc.content.length > 5000;\n      contentPreview.innerHTML = escapeHtml(updatedDoc.content.substring(0, 5000)) + \n        (truncated ? '\\n\\n... (truncated)' : '');\n    }\n    \n    // 5. Update status badge in header\n    const statusBadge = container.querySelector('.status-chip');\n    if (statusBadge) {\n      statusBadge.className = `status-chip ${updatedDoc.status}`;\n      statusBadge.textContent = capitalizeFirst(updatedDoc.status);\n    }\n    \n    // 6. Reload AI Analysis tab\n    loadAnalysisHistory(container, docId);\n    \n    // 7. Reload Activity tab\n    loadActivity(container, docId);\n    \n    console.log('[Modal] Refreshed content for document:', docId);\n  } catch (err) {\n    console.error('[Modal] Failed to refresh content:', err);\n  }\n}\n\nasync function reprocessDocument(doc: Document, onUpdate?: () => void): Promise<void> {\n  const reprocessBtn = document.querySelector('#reprocess-btn') as HTMLButtonElement;\n  const modalContainer = document.querySelector('.document-preview-modal') as HTMLElement;\n  const originalBtnContent = reprocessBtn?.innerHTML || '';\n  \n  try {\n    // Step 1: Check hash and existing entities\n    if (reprocessBtn) {\n      reprocessBtn.disabled = true;\n      reprocessBtn.innerHTML = `<span class=\"spinner\"></span> Checking...`;\n    }\n    \n    const checkResponse = await http.get<{\n      hash_match: boolean;\n      existing_entities: Record<string, number>;\n      total_entities: number;\n      current_hash: string;\n      has_content: boolean;\n    }>(`/api/documents/${doc.id}/reprocess/check`);\n    \n    const check = checkResponse.data;\n    \n    if (!check.has_content) {\n      toast.error('No content available for reprocessing');\n      return;\n    }\n    \n    // Step 2: Confirm if hash matches or has existing entities\n    let shouldProceed = true;\n    \n    if (check.hash_match || check.total_entities > 0) {\n      const hashMsg = check.hash_match ? 'Content has not changed since last processing.\\n' : '';\n      const entitiesMsg = check.total_entities > 0 \n        ? `There are ${check.total_entities} extracted entities that will be replaced.\\n` \n        : '';\n      \n      shouldProceed = confirm(\n        `${hashMsg}${entitiesMsg}\\nAre you sure you want to reprocess?\\n\\nThis will:\\n- Remove all existing entities from this document\\n- Create new entities with AI analysis\\n- Use AI tokens`\n      );\n    }\n    \n    if (!shouldProceed) {\n      toast.info('Reprocessing cancelled');\n      return;\n    }\n    \n    // Step 3: Start reprocessing with progress feedback\n    if (reprocessBtn) {\n      reprocessBtn.innerHTML = `<span class=\"spinner\"></span> Processing...`;\n    }\n    toast.info('Reprocessing started...');\n    \n    await http.post(`/api/documents/${doc.id}/reprocess`, { force: true });\n    \n    // Step 4: Poll for completion\n    let attempts = 0;\n    const maxAttempts = 60; // 2 minutes max\n    \n    const pollStatus = async () => {\n      attempts++;\n      \n      try {\n        const statusResponse = await http.get<{ status: string }>(`/api/documents/${doc.id}`);\n        const status = statusResponse.data.status;\n        \n        if (status === 'processed') {\n          toast.success('Document reprocessed successfully!');\n          // Refresh modal content with updated data\n          if (modalContainer) {\n            await refreshModalContent(modalContainer, doc.id);\n          }\n          onUpdate?.();\n          return true;\n        } else if (status === 'failed') {\n          toast.error('Reprocessing failed');\n          return true;\n        } else if (attempts >= maxAttempts) {\n          toast.warning('Reprocessing still in progress. Check back later.');\n          return true;\n        }\n        \n        // Update button with progress\n        if (reprocessBtn) {\n          reprocessBtn.innerHTML = `<span class=\"spinner\"></span> Processing... (${attempts}s)`;\n        }\n        \n        return false;\n      } catch {\n        return attempts >= maxAttempts;\n      }\n    };\n    \n    // Poll every 2 seconds (track interval for cleanup)\n    activeReprocessInterval = setInterval(async () => {\n      const done = await pollStatus();\n      if (done) {\n        if (activeReprocessInterval) {\n          clearInterval(activeReprocessInterval);\n          activeReprocessInterval = null;\n        }\n        if (reprocessBtn) {\n          reprocessBtn.disabled = false;\n          reprocessBtn.innerHTML = originalBtnContent;\n        }\n      }\n    }, 2000);\n    \n  } catch (err) {\n    console.error('[Reprocess] Error:', err);\n    toast.error('Failed to reprocess document');\n  } finally {\n    if (reprocessBtn) {\n      reprocessBtn.disabled = false;\n      reprocessBtn.innerHTML = originalBtnContent;\n    }\n  }\n}\n\nasync function uploadNewVersion(doc: Document, container: HTMLElement, onUpdate?: () => void): Promise<void> {\n  const input = document.createElement('input');\n  input.type = 'file';\n  input.accept = '.pdf,.doc,.docx,.txt,.md';\n  \n  input.onchange = async () => {\n    const file = input.files?.[0];\n    if (!file) return;\n    \n    const notes = prompt('Change notes (optional):');\n    \n    const formData = new FormData();\n    formData.append('file', file);\n    if (notes) formData.append('change_notes', notes);\n    \n    try {\n      toast.info('Uploading new version...');\n      await fetchWithProject(`/api/documents/${doc.id}/versions`, {\n        method: 'POST',\n        body: formData,\n      });\n      toast.success('New version uploaded');\n      loadVersions(container, doc.id);\n      onUpdate?.();\n    } catch {\n      toast.error('Failed to upload new version');\n    }\n  };\n  \n  input.click();\n}\n\nasync function generateShareLink(container: HTMLElement, doc: Document): Promise<void> {\n  const expires = (container.querySelector('#share-expires') as HTMLSelectElement).value;\n  const maxViews = (container.querySelector('#share-max-views') as HTMLInputElement).value;\n  const password = (container.querySelector('#share-password') as HTMLInputElement).value;\n  const permissions = (container.querySelector('#share-permissions') as HTMLSelectElement).value;\n  \n  try {\n    const response = await http.post<{ url: string; token: string }>(`/api/documents/${doc.id}/share`, {\n      expires,\n      max_views: maxViews ? parseInt(maxViews) : null,\n      password: password || null,\n      permissions: [permissions === 'download' ? 'view' : permissions, ...(permissions === 'download' ? ['download'] : [])]\n    });\n    \n    const input = container.querySelector('#share-link-input') as HTMLInputElement;\n    input.value = response.data.url;\n    \n    (container.querySelector('#generate-link-btn') as HTMLElement)?.classList.add('hidden');\n    (container.querySelector('#copy-link-btn') as HTMLElement)?.classList.remove('hidden');\n    \n    toast.success('Share link generated');\n  } catch {\n    toast.error('Failed to generate share link');\n  }\n}\n\nfunction copyShareLink(container: HTMLElement): void {\n  const input = container.querySelector('#share-link-input') as HTMLInputElement;\n  navigator.clipboard.writeText(input.value);\n  toast.success('Link copied to clipboard');\n}\n\nfunction getDocIcon(filename: string): string {\n  const ext = filename.split('.').pop()?.toLowerCase();\n  switch (ext) {\n    case 'pdf': return 'üìÑ';\n    case 'doc':\n    case 'docx': return 'üìù';\n    case 'xls':\n    case 'xlsx': return 'üìä';\n    case 'ppt':\n    case 'pptx': return 'üìΩÔ∏è';\n    case 'txt':\n    case 'md': return 'üìÉ';\n    case 'jpg':\n    case 'jpeg':\n    case 'png':\n    case 'gif': return 'üñºÔ∏è';\n    default: return 'üìÅ';\n  }\n}\n\nfunction getActionText(action: string): string {\n  const actions: Record<string, string> = {\n    created: 'uploaded this document',\n    viewed: 'viewed this document',\n    downloaded: 'downloaded this document',\n    updated: 'updated this document',\n    version_uploaded: 'uploaded a new version',\n    analyzed: 'ran AI analysis',\n    reprocessed: 'reprocessed this document',\n    shared: 'shared this document',\n    unshared: 'removed share link',\n    deleted: 'deleted this document',\n    restored: 'restored this document',\n    tagged: 'added tags',\n    favorited: 'added to favorites',\n    unfavorited: 'removed from favorites',\n    commented: 'commented on this document'\n  };\n  return actions[action] || action;\n}\n\nfunction getInitials(name: string): string {\n  return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();\n}\n\nfunction capitalizeFirst(str: string): string {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n"],"names":["isFavorite","activeReprocessInterval","showDocumentPreviewModal","props","doc","content","getDocIcon","escapeHtml","formatFileSize","formatRelativeTime","tag","tab","tabName","switchTab","toggleFavorite","downloadDocument","reprocessDocument","uploadNewVersion","generateShareLink","copyShareLink","loadContentPreview","loadEntities","loadAnalysisHistory","loadVersions","loadActivity","loadMeetingNotes","checkFavoriteStatus","fav","updateFavoriteButton","overlay","modalContainer","closeBtn","closePreviewModal","e","handleEscape","onClose","container","s","docId","contentEl","response","http","truncated","err","listEl","entitiesTab","entitiesCount","peopleCountEl","extraction","entities","facts","decisions","actions","questions","risks","participants","personEntities","allPeople","pe","p","totalItems","html","f","d","a","q","r","idx","setupPeopleLinkHandlers","peopleSection","projectId","btn","personName","showContactLinkDropdown","personRole","personOrg","createContactFromPerson","btnEl","dropdown","rect","searchInput","contacts","renderContactList","query","filtered","c","closeHandler","escHandler","initials","n","item","contactId","contactName","toast","name","role","organization","originalText","analyses","runAnalysisBtn","i","capitalizeFirst","formatDateTime","analysis","showAnalysisDetail","fullResult","extractionResponse","docResponse","resultJson","summary","peopleDetected","peopleNames","linkedPeople","unlinkedPeople","peopleSectionHtml","chip","el","currentContactId","currentContactName","showPersonLinkMenu","chipEl","m","isLinked","menu","renderContacts","avatar","contactEmail","contactAvatar","contactRole","updateChipToLinked","updateChipToUnlinked","versions","v","timelineEl","activities","getInitials","getActionText","notesContainer","notesTab","notesText","notes","renderNotesAsHtml","keyPoints","kp","outline","o","b","text","div","lines","currentTopic","bulletsHtml","headerDone","metaDone","flushTopic","line","trimmed","bulletText","refreshModalContent","updatedDoc","entityTypes","type","card","countEl","count","summaryCard","summaryEl","contentPreview","statusBadge","onUpdate","reprocessBtn","originalBtnContent","check","shouldProceed","hashMsg","entitiesMsg","attempts","maxAttempts","pollStatus","status","input","file","formData","expires","maxViews","password","permissions","filename","action","str"],"mappings":"gHAwDA,IAAIA,EAAa,GACbC,EAAiE,KAK9D,SAASC,GAAyBC,EAAmC,CAC1E,KAAM,CAAE,SAAUC,CAAA,EAAQD,EAEpBE,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,yBACpBA,EAAQ,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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"}