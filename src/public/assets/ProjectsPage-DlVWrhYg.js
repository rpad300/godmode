import{c as xe,ce as Fe,r,ed as Oe,ee as Ke,ef as Ue,eg as ze,j as e,N as F,b2 as qe,aj as se,ai as B,a as _,H as re,b0 as T,U as W,P as _e,O as o,ag as pe,dd as ie,T as Be,ad as Z,af as J,g as ne,eh as Ve,ei as Ge,ej as Je,ek as He,el as Ye,$ as Qe,C as We,em as Xe,en as Ze,eo as et,ep as tt,eq as at,er as st,a2 as ge,es as rt,et as it,eu as nt,ev as lt,ew as ct,ex as ot,ey as dt,ez as mt,b8 as he,b9 as ve,eA as ue,ba as ye,b as be}from"./main-DPJZnN-g.js";import{I as U}from"./input-CbHr_mul.js";import{U as xt,S as le,a as ce,b as oe,c as de,d as X,f as fe,g as Ne}from"./select-DUlAOpxc.js";import{A as Pe,a as Ae,b as De,c as Te,d as Ie,e as Me,f as Re,g as Ee}from"./alert-dialog-BmnPb2NC.js";import{U as we}from"./upload-C1xl8nMH.js";import{P as ae}from"./plus-D_qMNj9L.js";import{S as Ce}from"./star-Dro_83QX.js";import{P as gt}from"./play-DFwYGH3G.js";import{P as je}from"./pen-EvlKYdM2.js";import{A as pt}from"./arrow-left-zNkLqbte.js";import{U as me}from"./user-plus-CgA2QXux.js";import{K as Le}from"./key-DrUrK2UH.js";import{L as ht}from"./link-2-BbBFDDRu.js";import{S as vt}from"./square-check-big-grc8ESP1.js";import{T as ut}from"./test-tube-3V1h975P.js";import{S as yt}from"./sparkles-B7v1H-ZZ.js";import"./index-Cd-aIfCY.js";import"./index-D4HbvI6D.js";import"./index-C1otBg8B.js";import"./chevron-down-DvtyaUz8.js";import"./chevron-up-CuIutfHG.js";const jt=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],ke=xe("grip-vertical",jt);const bt=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],ft=xe("settings-2",bt);const Nt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],te=xe("shield-check",Nt);const wt=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],$e=xe("sliders-horizontal",wt),Se=[{id:"1",name:"Project Manager",description:"Oversees project execution and delivery",active:!0},{id:"2",name:"Tech Lead",description:"Technical leadership and architecture decisions",active:!0},{id:"3",name:"Product Owner",description:"Defines product vision and priorities",active:!0},{id:"4",name:"Designer",description:"UI/UX design and prototyping",active:!1},{id:"5",name:"QA Lead",description:"Quality assurance and testing strategy",active:!1},{id:"6",name:"DevOps",description:"Infrastructure and deployment automation",active:!1}],O="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",q="w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] transition-all duration-150",L="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",K="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",Ct="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50",Q="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",$="text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-1 flex items-center gap-1.5",kt=[{id:"general",label:"General",icon:ft},{id:"members",label:"Members",icon:W,count:0},{id:"invites",label:"Invites",icon:me},{id:"teams",label:"Teams",icon:xt},{id:"roles",label:"Roles",icon:te},{id:"categories",label:"Categories",icon:$e},{id:"providers",label:"AI Providers",icon:Le},{id:"activity",label:"Activity",icon:_e}],na=()=>{const{projects:s,refreshProjects:l,currentProjectId:f}=Fe(),[m,p]=r.useState(null),d=Oe(),j=Ke(),u=Ue(),v=ze(),[n,y]=r.useState(!1),[c,w]=r.useState(""),[i,x]=r.useState(""),D=s.find(h=>h.id===m)||null,[A,a]=r.useState(!1),[S,I]=r.useState(""),[C,z]=r.useState(""),[V,k]=r.useState([]),[b,H]=r.useState(""),[t,g]=r.useState(!1),P=h=>{d.mutate(h,{onSuccess:()=>{o.success("Project activated"),l()},onError:()=>o.error("Failed to activate project")})},R=h=>{j.mutate(h,{onSuccess:()=>{o.success("Default project set"),l()},onError:()=>o.error("Failed to set default")})},N=()=>{u.mutate(void 0,{onSuccess:h=>{const E=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),Y=URL.createObjectURL(E),ee=document.createElement("a");ee.href=Y,ee.download=`project-export-${Date.now()}.json`,ee.click(),URL.revokeObjectURL(Y),o.success("Project exported")},onError:()=>o.error("Export failed")})},G=()=>{try{const h=JSON.parse(c);v.mutate({data:h,name:i||void 0},{onSuccess:()=>{o.success("Project imported"),y(!1),w(""),x(""),l()},onError:()=>o.error("Import failed")})}catch{o.error("Invalid JSON data")}};r.useEffect(()=>{(async()=>{try{const E=await T.get("/api/companies");E.companies&&(k(E.companies),E.companies.length>0&&H(E.companies[0].id))}catch(E){console.error("Failed to fetch companies:",E)}})()},[]);const M=async()=>{if(!S.trim()||!b){o.error("Please enter a project name and select a company.");return}try{g(!0),await T.post("/api/projects",{name:S,description:C,company_id:b}),z(""),a(!1),l(),o.success("Project created successfully")}catch(h){console.error("Failed to create project:",h),o.error(h instanceof Error?h.message:"Failed to create project")}finally{g(!1)}};return m&&D?e.jsx(St,{project:D,onBack:()=>p(null),onUpdate:l}):(m&&!D&&p(null),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("h1",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:"Projects"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:N,disabled:u.isPending,className:K,children:[u.isPending?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(qe,{className:"w-3.5 h-3.5"})," Export"]}),e.jsxs("button",{onClick:()=>y(!n),className:K,children:[e.jsx(we,{className:"w-3.5 h-3.5"})," Import"]}),e.jsxs("button",{onClick:()=>a(!A),className:L,children:[e.jsx(ae,{className:"w-3.5 h-3.5"})," New Project"]})]})]}),e.jsx(se,{children:n&&e.jsxs(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:_(O,"p-5"),children:[e.jsx("h3",{className:Q,children:"Import Project"}),e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Project Name (optional)"}),e.jsx("input",{value:i,onChange:h=>x(h.target.value),placeholder:"Project name...",className:q})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"JSON Data"}),e.jsx("textarea",{value:c,onChange:h=>w(h.target.value),placeholder:"Paste exported JSON data here...",rows:5,className:_(q,"resize-none font-mono")})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>y(!1),className:K,children:"Cancel"}),e.jsxs("button",{onClick:G,disabled:v.isPending||!c.trim(),className:L,children:[v.isPending?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(we,{className:"w-3.5 h-3.5"})," Import"]})]})]})]})}),e.jsx(se,{children:A&&e.jsxs(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:_(O,"p-5"),children:[e.jsx("h3",{className:Q,children:"Create New Project"}),e.jsxs("div",{className:"space-y-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Project Name *"}),e.jsx("input",{value:S,onChange:h=>I(h.target.value),placeholder:"Project name...",className:q})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Description"}),e.jsx("textarea",{value:C,onChange:h=>z(h.target.value),placeholder:"Description...",rows:2,className:_(q,"resize-none")})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Company"}),e.jsxs("select",{value:b,onChange:h=>H(h.target.value),className:q,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a company"}),V.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-2",children:[e.jsx("button",{onClick:()=>a(!1),className:K,children:"Cancel"}),e.jsxs("button",{onClick:M,disabled:t,className:L,children:[t?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ae,{className:"w-3.5 h-3.5"}),t?"Creating...":"Create"]})]})]})]})}),e.jsx("div",{className:"space-y-3",children:s.map((h,E)=>{const Y=f===h.id,ee=h.is_default===!0;return e.jsx(B.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{delay:E*.06},className:_(O,"p-5",Y&&"border-[var(--gm-accent-primary)]/40 ring-1 ring-[var(--gm-accent-primary)]/20"),children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:_("w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",Y?"bg-[var(--gm-interactive-primary)]/10":"bg-[var(--gm-bg-tertiary)]"),children:e.jsx(re,{className:_("w-5 h-5",Y?"text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)]")})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:h.name||"(unnamed project)"}),Y&&e.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)]",children:"Active"}),ee&&e.jsxs("span",{className:"text-[9px] font-bold uppercase tracking-wider px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-500 flex items-center gap-0.5",children:[e.jsx(Ce,{className:"w-2.5 h-2.5"})," Default"]})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono",children:h.id}),h.description&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate max-w-md",children:h.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[!Y&&e.jsxs("button",{onClick:()=>P(h.id),disabled:d.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-lg bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)] text-[10px] font-medium hover:bg-[var(--gm-interactive-primary)]/20 transition-colors",children:[e.jsx(gt,{className:"w-3 h-3"})," Switch"]}),!ee&&e.jsx("button",{onClick:()=>R(h.id),disabled:j.isPending,className:K,title:"Set as default project",children:e.jsx(Ce,{className:"w-3 h-3"})}),e.jsxs("button",{onClick:()=>p(h.id),className:K,children:[e.jsx(je,{className:"w-3 h-3"})," Edit"]})]})]})},h.id)})})]}))};function St({project:s,onBack:l,onUpdate:f}){const[m,p]=r.useState("general"),[d,j]=r.useState([]),[u,v]=r.useState(!1),n=async()=>{try{v(!0);const c=await T.get(`/api/projects/${s.id}/members`);c.members&&j(c.members)}catch(c){console.error("Failed to fetch members:",c)}finally{v(!1)}},y=()=>{f(),m==="members"&&n()};return r.useEffect(()=>{n()},[s.id]),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("button",{onClick:l,className:"flex items-center gap-1.5 text-xs text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors mb-2",children:[e.jsx(pt,{className:"w-3.5 h-3.5"})," Back to Projects"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-[var(--gm-interactive-primary)]/10 flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-[var(--gm-accent-primary)]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:s.name||"(unnamed project)"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:s.description||"No description"})]})]}),e.jsx("div",{className:"flex border-b border-[var(--gm-border-primary)] overflow-x-auto",children:kt.map(c=>e.jsxs("button",{onClick:()=>p(c.id),className:`flex items-center gap-1.5 px-3 py-2.5 text-xs font-medium transition-colors border-b-2 whitespace-nowrap ${m===c.id?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent hover:text-[var(--gm-text-primary)]"}`,children:[e.jsx(c.icon,{className:"w-4 h-4"}),c.label,(c.id==="members"?d.length:c.count)!==void 0&&e.jsx("span",{className:"text-[10px] bg-[var(--gm-bg-tertiary)] px-1.5 py-0.5 rounded-full",children:c.id==="members"?d.length:c.count})]},c.id))}),e.jsxs("div",{children:[m==="general"&&e.jsx(Pt,{project:s,onUpdate:f,onBack:l}),m==="members"&&e.jsx(At,{project:s,members:d,loading:u,onUpdate:n}),m==="roles"&&e.jsx(Tt,{project:s,onUpdate:y}),m==="categories"&&e.jsx(Mt,{project:s,members:d,onUpdate:f}),m==="invites"&&e.jsx(Et,{projectId:s.id}),m==="teams"&&e.jsx(Lt,{}),m==="providers"&&e.jsx($t,{projectId:s.id}),m==="activity"&&e.jsx(Ft,{projectId:s.id})]})]})}function _t({projectId:s}){const{data:l,isLoading:f}=mt(s);if(f||!l)return null;const p=Object.entries(l).filter(([,d])=>typeof d=="number").slice(0,8);return p.length===0?null:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4",children:p.map(([d,j])=>e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg px-3 py-2 text-center",children:[e.jsx("p",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:String(j)}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:d.replace(/[_-]/g," ")})]},d))})}function Pt({project:s,onUpdate:l,onBack:f}){const[m,p]=r.useState(s.name),[d,j]=r.useState(s.description),[u,v]=r.useState(s.role||""),[n,y]=r.useState(s.rolePrompt||""),[c,w]=r.useState(s.company_id||s.company||""),[i,x]=r.useState(!1),[D,A]=r.useState(!1),[a,S]=r.useState(!1),[I,C]=r.useState([]);r.useEffect(()=>{T.get("/api/role-templates").then(k=>C(k.roles||[])).catch(()=>{})},[]);const z=async()=>{if(!m.trim()){o.error("Project name is required");return}x(!0);try{await T.put(`/api/projects/${s.id}`,{name:m,description:d,role:u,rolePrompt:n,company_id:c}),o.success("Project updated"),l()}catch(k){o.error(k.message||"Failed to update project")}finally{x(!1)}},V=async()=>{A(!0);try{await T.delete(`/api/projects/${s.id}`),o.success("Project deleted"),l(),f()}catch(k){o.error(k.message||"Failed to delete project")}finally{A(!1),S(!1)}};return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsx(_t,{projectId:s.id}),e.jsxs("div",{className:_(O,"p-5 space-y-5"),children:[e.jsxs("div",{children:[e.jsxs("label",{className:$,children:[e.jsx(re,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})," Project Name *"]}),e.jsx(U,{value:m,onChange:k=>p(k.target.value),className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"â‰¡ Description"}),e.jsx("textarea",{value:d,onChange:k=>j(k.target.value),placeholder:"Brief description of the project",rows:4,className:_(q,"resize-y")})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:$,children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})," Your Role"]}),e.jsxs(le,{value:u,onValueChange:v,children:[e.jsx(ce,{className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm",children:e.jsx(oe,{placeholder:"Select role..."})}),e.jsx(de,{children:I.filter(k=>k.name||k.display_name).map(k=>e.jsx(X,{value:k.display_name||k.name,children:k.display_name||k.name},k.id||k.name))})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Your role in this project (used for AI context)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"ðŸ’¬ Role Prompt"}),e.jsx(U,{value:n,onChange:k=>y(k.target.value),className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Brief description of your responsibilities"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:$,children:[e.jsx(re,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})," Company"]}),e.jsx(U,{value:c,onChange:k=>w(k.target.value),placeholder:"Company this project belongs to...",className:q})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{onClick:z,disabled:i,className:L,children:[i?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(ie,{className:"w-4 h-4"}),i?"Saving...":"Save Changes"]})})]}),e.jsxs("div",{className:"border border-[var(--color-danger-500)]/30 bg-[var(--color-danger-500)]/5 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--color-danger-500)] mb-1 flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"})," Danger Zone"]}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-3",children:"Deleting a project will permanently remove all associated data including questions, decisions, risks, and contacts."}),a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:V,disabled:D,className:Ct,children:[D?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(Z,{className:"w-4 h-4"}),D?"Deleting...":"Confirm Delete"]}),e.jsx("button",{onClick:()=>S(!1),className:K,children:"Cancel"})]}):e.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg border border-[var(--color-danger-500)]/30 text-[var(--color-danger-500)] text-sm font-medium hover:bg-[var(--color-danger-500)]/10 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"})," Delete Project"]})]})]})}function At({project:s,members:l,loading:f,onUpdate:m}){const[p,d]=r.useState(!1),[j,u]=r.useState(null),[v,n]=r.useState(null),[y,c]=r.useState("list"),[w,i]=r.useState([]),[x,D]=r.useState(!1);r.useEffect(()=>{A()},[s.id]);const A=async()=>{try{D(!0);const t=await T.get(`/api/projects/${s.id}/categories`);i(t)}catch(t){console.error("Failed to fetch categories:",t)}finally{D(!1)}},a=async()=>{if(v)try{u(v.user_id),await T.delete(`/api/projects/${s.id}/members/${v.user_id}`),m()}catch(t){console.error("Failed to remove member:",t),o.error("Failed to remove member")}finally{u(null),n(null)}},S=async(t,g)=>{try{await T.put(`/api/projects/${s.id}/members/${t}`,{user_role:g}),m()}catch(P){console.error("Failed to update member role:",P)}},I=t=>l.filter(g=>{const P=g.user_role||g.role;return s.settings?.roles?.find(G=>G.name===P)?.category===t.id}),C=(t,g)=>{t.dataTransfer.setData("text/plain",g),t.dataTransfer.effectAllowed="move"},z=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},V=async(t,g)=>{t.preventDefault();const P=t.dataTransfer.getData("text/plain");if(!P)return;const R=l.find(M=>M.user_id===P);if(!R)return;let N="";if(g){const M=s.settings?.roles?.filter(h=>h.category===g)||[];M.length>0?N=M[0].name:N=(M.find(E=>E.name==="Member")||M[0])?.name||"Member"}else N="";const G=R.user_role||R.role;N!==G&&await S(P,N)},k=()=>l.filter(t=>{const g=t.user_role||t.role,P=s.settings?.roles?.find(N=>N.name===g),R=!P||!P.category||!w.find(N=>N.id===P.category);return R&&t.display_name==="RPAD"&&console.log("Unassigned Debug (RPAD):",{memberRole:g,roleFound:!!P,roleCategory:P?.category,catExists:!!w.find(N=>N.id===P?.category)}),R}),b=async(t,g)=>{try{const P={...s.settings,category_leads:{...s.settings?.category_leads,[t]:g}};await T.put(`/api/projects/${s.id}`,{settings:P}),m()}catch(P){console.error("Failed to set lead:",P),o.error("Failed to set team lead")}},H=l.map(t=>t.linked_contact?.id).filter(t=>!!t);return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:_(O,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"})," TEAM MEMBERS (",l.length,")"]}),e.jsxs("div",{className:"flex bg-[var(--gm-bg-tertiary)] rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>c("list"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${y==="list"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"}`,children:"List"}),e.jsx("button",{onClick:()=>c("teams"),className:`px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${y==="teams"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"}`,children:"Teams"})]})]}),e.jsxs("button",{onClick:()=>d(!0),className:L,children:[e.jsx(W,{className:"w-4 h-4"})," Invite"]})]}),f||x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--gm-accent-primary)] border-t-transparent rounded-full animate-spin"})}):l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center mb-3",children:e.jsx(W,{className:"w-8 h-8 text-[var(--gm-text-tertiary)]"})}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] mb-4",children:"No team members yet"}),e.jsx("button",{onClick:()=>d(!0),className:L,children:"Invite Member"})]}):y==="list"?e.jsx("div",{className:"grid gap-3",children:l.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)]/20 hover:bg-[var(--gm-bg-tertiary)]/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[J(t.avatar_url)||J(t.linked_contact?.avatar_url)?e.jsx("img",{src:J(t.avatar_url)?t.avatar_url:t.linked_contact?.avatar_url,alt:t.display_name||t.linked_contact?.name||"Member",className:"w-10 h-10 rounded-full object-cover bg-[var(--gm-bg-tertiary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-interactive-primary)]/10 flex items-center justify-center text-[var(--gm-accent-primary)] font-bold",children:ne(t.display_name||t.username||t.linked_contact?.name)}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:t.display_name||t.linked_contact?.name||t.username||"Unknown User"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[var(--gm-text-tertiary)]",children:[e.jsx("span",{children:t.user_role||t.role}),t.linked_contact?.organization&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:t.linked_contact.organization})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-right text-[var(--gm-text-tertiary)]",children:e.jsxs("p",{children:["Joined ",t.joined_at?new Date(t.joined_at).toLocaleDateString():"â€”"]})}),e.jsx("button",{onClick:()=>n(t),disabled:j===t.user_id,className:"p-2 text-[var(--gm-text-tertiary)] hover:text-[var(--color-danger-500)] transition-colors disabled:opacity-50",children:j===t.user_id?e.jsx("div",{className:"w-4 h-4 border-2 border-[var(--color-danger-500)] border-t-transparent rounded-full animate-spin"}):e.jsx(Z,{className:"w-4 h-4"})})]})]},t.user_id))}):e.jsxs("div",{className:"space-y-4",children:[w.map(t=>{const g=I(t),P=s.settings?.category_leads?.[t.id],R=l.find(N=>N.user_id===P);return e.jsxs(B.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},className:_(O,"p-5"),onDragOver:z,onDrop:N=>V(N,t.id),children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${t.color||"blue"}-500/10 text-${t.color||"blue"}-500`,children:e.jsx(W,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[t.display_name,e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:g.length})]}),R&&e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)] flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3 text-amber-500"}),"Lead: ",e.jsx("span",{className:"font-medium text-[var(--gm-text-primary)]",children:R.display_name})]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[g.map(N=>{const G=P===N.user_id;return e.jsxs("div",{className:`flex items-center gap-4 p-3 rounded-xl border transition-all cursor-grab active:cursor-grabbing group relative ${G?"bg-amber-500/5 border-amber-500/20":"bg-[var(--gm-bg-primary)] border-[var(--gm-border-primary)] hover:border-[var(--gm-accent-primary)]/30"}`,draggable:!0,onDragStart:M=>C(M,N.user_id),children:[e.jsxs("div",{className:"relative",children:[J(N.avatar_url)||J(N.linked_contact?.avatar_url)?e.jsx("img",{src:J(N.avatar_url)?N.avatar_url:N.linked_contact?.avatar_url,alt:N.display_name,className:"w-10 h-10 rounded-full object-cover border border-[var(--gm-border-primary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center text-sm font-bold text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:ne(N.display_name)}),G&&e.jsx("div",{className:"absolute -bottom-1 -right-1 bg-amber-500 text-white rounded-full p-0.5 border-2 border-[var(--gm-bg-primary)]",children:e.jsx(te,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate",children:N.display_name}),N.linked_contact?.organization&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] truncate max-w-[100px]",children:N.linked_contact.organization})]}),e.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:e.jsxs(le,{value:N.user_role||N.role||"",onValueChange:M=>S(N.user_id,M==="no-role"?"":M),children:[e.jsx(ce,{className:"h-5 text-[11px] bg-transparent border-none p-0 text-[var(--gm-text-tertiary)] focus:ring-0 shadow-none w-auto gap-1 hover:text-[var(--gm-text-primary)]",children:e.jsx(oe,{placeholder:"No Role"})}),e.jsxs(de,{children:[e.jsx(X,{value:"no-role",children:"No Role"}),w.map(M=>{const h=s.settings?.roles?.filter(E=>E.category===M.id)||[];return h.length===0?null:e.jsxs(fe,{children:[e.jsx(Ne,{className:"text-[10px] font-bold text-[var(--gm-text-tertiary)] px-2 py-1.5",children:M.display_name}),h.map(E=>e.jsx(X,{value:E.name,className:"text-[10px]",children:E.name},E.id))]},M.id)})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:M=>{M.preventDefault(),M.stopPropagation(),b(t.id,N.user_id)},className:`p-2 rounded-lg transition-colors ${G?"text-amber-500 bg-amber-500/10 hover:bg-amber-500/20":"text-[var(--gm-text-tertiary)] hover:text-amber-500 hover:bg-amber-500/10"}`,title:G?"Current Team Lead":"Make Team Lead",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-4 bg-[var(--gm-border-primary)] mx-1"}),e.jsx("div",{className:"p-2 text-[var(--gm-text-tertiary)] cursor-grab active:cursor-grabbing",children:e.jsx(ke,{className:"w-4 h-4"})})]})]},N.user_id)}),g.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center border border-dashed border-[var(--gm-border-primary)]/50 rounded-xl bg-[var(--gm-bg-tertiary)]/5",children:[e.jsx(W,{className:"w-8 h-8 text-[var(--gm-text-tertiary)]/30 mb-2"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["Drag members here to assign them to ",t.display_name]})]})]})]},t.id)}),k().length>0&&e.jsxs(B.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] border-dashed rounded-xl p-5",onDragOver:z,onDrop:t=>V(t,null),children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500 animate-pulse"}),"Unassigned Members",e.jsx("span",{className:"text-[10px] bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] px-2 py-0.5 rounded-full",children:k().length})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:k().map(t=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-bg-tertiary)]/10 border border-[var(--gm-border-primary)]/50 hover:border-amber-500/50 rounded-xl p-3 cursor-grab active:cursor-grabbing group relative transition-colors",draggable:!0,onDragStart:g=>C(g,t.user_id),children:[e.jsxs("div",{className:"relative",children:[J(t.avatar_url)||J(t.linked_contact?.avatar_url)?e.jsx("img",{src:J(t.avatar_url)?t.avatar_url:t.linked_contact?.avatar_url,alt:t.display_name,className:"w-10 h-10 rounded-full object-cover border border-[var(--gm-border-primary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center text-sm font-bold text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:(t.display_name?.[0]||"?").toUpperCase()}),e.jsx("div",{className:"absolute -top-1 -right-1 bg-amber-500 text-white rounded-full p-0.5 w-4 h-4 flex items-center justify-center text-[10px]",children:"!"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate",children:t.display_name})}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsxs(le,{value:t.user_role||t.role||"",onValueChange:g=>S(t.user_id,g),children:[e.jsx(ce,{className:"h-6 text-[11px] bg-[var(--gm-bg-primary)] border-[var(--gm-border-primary)] w-full",children:e.jsx(oe,{placeholder:"Select Role..."})}),e.jsxs(de,{children:[e.jsx(X,{value:"no-role",children:"No Role"}),w.map(g=>{const P=s.settings?.roles?.filter(R=>R.category===g.id)||[];return P.length===0?null:e.jsxs(fe,{children:[e.jsx(Ne,{className:"text-[10px] font-bold text-[var(--gm-text-tertiary)] px-2 py-1.5",children:g.display_name}),P.map(R=>e.jsx(X,{value:R.name,className:"text-[10px]",children:R.name},R.id))]},g.id)})]})]})})]}),e.jsx("div",{className:"text-[var(--gm-text-tertiary)] opacity-50 group-hover:opacity-100",children:e.jsx(ke,{className:"w-4 h-4"})})]},t.user_id))})]})]})]}),e.jsx(Dt,{open:p,onClose:()=>d(!1),projectId:s.id,onMemberAdded:m,existingContactIds:H}),e.jsx(Pe,{open:!!v,onOpenChange:t=>!t&&n(null),children:e.jsxs(Ae,{children:[e.jsxs(De,{children:[e.jsx(Te,{children:"Remove Team Member"}),e.jsxs(Ie,{children:["Are you sure you want to remove ",e.jsx("strong",{children:v?.display_name||v?.linked_contact?.name||"this member"})," from the project? This action cannot be undone."]})]}),e.jsxs(Me,{children:[e.jsx(Re,{children:"Cancel"}),e.jsx(Ee,{onClick:a,className:"bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)]",children:"Remove Member"})]})]})})]})}function Dt({open:s,onClose:l,projectId:f,onMemberAdded:m,existingContactIds:p=[]}){const[d,j]=r.useState("contacts"),[u,v]=r.useState(""),[n,y]=r.useState(""),[c,w]=r.useState(null),[i,x]=r.useState([]),[D,A]=r.useState(!1),[a,S]=r.useState(!1),[I,C]=r.useState(!1);r.useEffect(()=>{s&&d==="contacts"&&z()},[s,d]);const z=async()=>{try{A(!0);const b=await T.get("/api/contacts");if(b.contacts){const H=b.contacts.filter(t=>!p.includes(t.id));x(H)}}catch(b){console.error("Failed to fetch contacts:",b)}finally{A(!1)}},V=async()=>{if(!u.trim()){o.error("Please enter an email address");return}C(!0);try{await T.post(`/api/projects/${f}/members/invite`,{email:u.trim(),message:n.trim()||void 0}),o.success("Invitation sent"),v(""),y(""),m(),l()}catch(b){o.error(b.message||"Failed to send invitation")}finally{C(!1)}},k=async()=>{if(c)try{S(!0),await T.post(`/api/projects/${f}/members/add-contact`,{contact_id:c}),m(),l()}catch(b){console.error("Failed to add contact:",b),o.error("Failed to add contact to team")}finally{S(!1)}};return e.jsx(he,{open:s,onOpenChange:l,children:e.jsxs(ve,{className:"sm:max-w-[500px] bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsx(ue,{children:e.jsx(ye,{className:"text-[var(--gm-text-primary)]",children:"Invite Team Member"})}),e.jsxs("div",{className:"flex border-b border-[var(--gm-border-primary)] mb-4",children:[e.jsx("button",{onClick:()=>j("email"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="email"?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent"}`,children:"New Email"}),e.jsx("button",{onClick:()=>j("contacts"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="contacts"?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent"}`,children:"Existing Contacts"})]}),d==="email"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Email Address *"}),e.jsx(U,{value:u,onChange:b=>v(b.target.value),placeholder:"colleague@example.com",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"They will receive an email invitation to join this project"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Access Level"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:"Member - Can view and edit data"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"You can assign a project role after they join."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Personal Message (optional)"}),e.jsx("textarea",{value:n,onChange:b=>y(b.target.value),placeholder:"Add a personal note to the invitation...",rows:3,className:_(q,"resize-none")})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:l,className:K,children:"Cancel"}),e.jsx("button",{onClick:V,disabled:I||!u.trim(),className:L,children:I?"Sending...":"Send Invitation"})]})]}):e.jsxs("div",{className:"space-y-3",children:[D?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--gm-accent-primary)] border-t-transparent rounded-full animate-spin"})}):i.length===0?e.jsx("div",{className:"text-center py-8 text-[var(--gm-text-tertiary)] text-sm",children:"No contacts found."}):e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto scrollbar-thin pr-1",children:i.map(b=>e.jsxs("div",{onClick:()=>w(b.id),className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer border transition-all ${c===b.id?"bg-[var(--gm-interactive-primary)]/10 border-[var(--gm-accent-primary)] shadow-[var(--shadow-sm)]":"bg-[var(--gm-surface-primary)] hover:bg-[var(--gm-surface-hover)] border-[var(--gm-border-primary)] hover:border-[var(--gm-border-primary)]/80"}`,children:[e.jsx("div",{className:`w-4 h-4 rounded-full border flex items-center justify-center transition-colors ${c===b.id?"border-[var(--gm-accent-primary)] bg-[var(--gm-interactive-primary)]":"border-[var(--gm-text-tertiary)]"}`,children:c===b.id&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[var(--gm-text-on-brand)]"})}),be(b)?e.jsx("img",{src:be(b),alt:b.name,className:"w-10 h-10 rounded-full object-cover bg-[var(--gm-bg-tertiary)]"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--gm-interactive-primary)]/10 flex items-center justify-center text-[var(--gm-accent-primary)] font-bold text-sm",children:ne(b.name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${c===b.id?"text-[var(--gm-accent-primary)]":"text-[var(--gm-text-primary)]"}`,children:b.name||"(unnamed)"}),e.jsxs("div",{className:"flex flex-col gap-0.5",children:[b.organization&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-medium",children:b.organization}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] truncate",children:b.email||"No email"})]})]}),b.role&&e.jsx("div",{className:"text-[10px] px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]",children:b.role})]},b.id))}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-primary)] mb-1 block",children:"Access Level"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:"Member - Can view and edit data"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:k,disabled:!c||a,className:_(L,"disabled:cursor-not-allowed"),children:[a?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(W,{className:"w-4 h-4"}),"Add to Team"]})}),e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] space-y-0.5",children:e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-[var(--gm-accent-primary)]",children:"Add to Team:"})," Adds contact as team member directly."]})})]})]})})}function Tt({project:s,onUpdate:l}){const[f,m]=r.useState(!1),[p,d]=r.useState(null),[j,u]=r.useState([]);r.useEffect(()=>{v()},[s.id]);const v=async()=>{try{const i=await T.get(`/api/projects/${s.id}/categories`);u(i)}catch(i){console.error("Failed to fetch categories:",i)}},n=s.settings?.roles||[];[...Se].map(i=>(n.find(x=>x.name===i.name),i));const c=[...n];Se.forEach(i=>{c.find(x=>x.name===i.name)||c.push({...i,active:!1,id:`template-${i.id}`})});const w=async i=>{try{if(d(i.id),i.id.toString().startsWith("template-")){const x={name:i.name,description:i.description,active:!0};await T.post(`/api/projects/${s.id}/roles`,x)}else await T.put(`/api/projects/${s.id}/roles/${i.id}`,{active:!i.active});l()}catch(x){console.error("Error toggling role:",x),o.error("Failed to update role")}finally{d(null)}};return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:_(O,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"})," PROJECT ROLES"]}),e.jsxs("button",{onClick:()=>m(!0),className:L,children:[e.jsx(ae,{className:"w-4 h-4"})," Add Role"]})]}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-4",children:"Define roles and responsibilities for this project."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:c.map(i=>e.jsxs("div",{className:`p-4 rounded-xl border transition-colors ${i.active===!0?"border-[var(--gm-accent-primary)]/30 bg-[var(--gm-interactive-primary)]/5":"border-[var(--gm-border-primary)]"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-9 h-9 rounded-lg flex items-center justify-center flex-shrink-0 ${i.active===!0?"bg-[var(--gm-interactive-primary)]/10":"bg-[var(--gm-bg-tertiary)]"}`,children:e.jsx(pe,{className:`w-4 h-4 ${i.active===!0?"text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)]"}`})}),e.jsx("h4",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:i.name||"(unnamed role)"})]}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-3",children:i.description||"â€”"}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.active===!0,onChange:()=>w(i),disabled:!!p,className:"accent-[var(--gm-accent-primary)] w-4 h-4"}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:p===i.id?"Updating...":i.active===!0?"Active":"Inactive"})]}),i.active&&e.jsxs("select",{className:"max-w-[120px] text-[10px] bg-[var(--gm-bg-tertiary)]/50 border-none rounded px-2 py-1 text-[var(--gm-text-primary)] focus:ring-0",value:i.category||"",onChange:async x=>{const D=x.target.value;try{i.id.toString().startsWith("template-")||(await T.put(`/api/projects/${s.id}/roles/${i.id}`,{category:D}),l())}catch(A){console.error("Failed to update role category",A)}},children:[e.jsx("option",{value:"",children:"No Category"}),j.map(x=>e.jsx("option",{value:x.id,children:x.display_name},x.id))]})]})]},i.id))})]}),e.jsx(It,{open:f,onClose:()=>m(!1),projectId:s.id,onRoleAdded:l})]})}function It({open:s,onClose:l,projectId:f,onRoleAdded:m}){const[p,d]=r.useState(""),[j,u]=r.useState(""),[v,n]=r.useState([]),[y,c]=r.useState(!1),[w,i]=r.useState(""),[x,D]=r.useState(""),[A,a]=r.useState(!1);r.useEffect(()=>{s&&S()},[s]);const S=async()=>{try{c(!0);const C=await T.get(`/api/projects/${f}/categories`);n(C),C.length>0&&!j&&u(C[0].id)}catch(C){console.error("Failed to fetch categories:",C)}finally{c(!1)}},I=async()=>{if(p.trim())try{a(!0),await T.post(`/api/projects/${f}/roles`,{name:p,category:j,description:w,role_context:x,active:!0}),m(),l(),d(""),i(""),D(""),v.length>0&&u(v[0].id)}catch(C){console.error("Error creating role:",C),o.error("Failed to create role")}finally{a(!1)}};return e.jsx(he,{open:s,onOpenChange:l,children:e.jsxs(ve,{className:"sm:max-w-[450px] bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsx(ue,{children:e.jsx(ye,{className:"text-[var(--gm-text-primary)]",children:"Add New Role"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Role Name *"}),e.jsx(U,{value:p,onChange:C=>d(C.target.value),placeholder:"e.g., Senior Developer, Tech Lead",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Category"}),e.jsx("select",{value:j,onChange:C=>u(C.target.value),disabled:y,className:q,children:y?e.jsx("option",{children:"Loading categories..."}):v.map(C=>e.jsx("option",{value:C.id,children:C.display_name},C.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Description"}),e.jsx(U,{value:w,onChange:C=>i(C.target.value),placeholder:"Brief description of this role",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Role Context (for AI)"}),e.jsx("textarea",{value:x,onChange:C=>D(C.target.value),placeholder:"Describe this role's responsibilities, priorities, and how the AI should adapt responses...",rows:4,className:_(q,"resize-y")})]}),e.jsxs("button",{onClick:()=>o.info("AI enhancement will use the project context to suggest role descriptions"),className:"flex items-center gap-2 text-sm text-[var(--gm-accent-primary)] font-medium hover:text-[var(--gm-accent-primary)]/80 transition-colors",children:[e.jsx(yt,{className:"w-4 h-4"})," Enhance with AI"]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:l,className:K,children:"Cancel"}),e.jsx("button",{onClick:I,disabled:A||!p.trim(),className:L,children:A?"Creating...":"Create Role"})]})]})})}function Mt({project:s,members:l,onUpdate:f}){const[m,p]=r.useState([]),[d,j]=r.useState(!1),[u,v]=r.useState(!1),[n,y]=r.useState(null),[c,w]=r.useState(null),i=async()=>{try{j(!0);const a=await T.get(`/api/projects/${s.id}/categories`);p(a)}catch(a){console.error("Failed to fetch categories:",a)}finally{j(!1)}};r.useEffect(()=>{i()},[s.id]);const x=a=>{w(a)},D=async()=>{if(c)try{await T.delete(`/api/projects/${s.id}/categories/${c.id}`),i()}catch(a){console.error("Failed to delete category:",a),o.error("Failed to delete category")}finally{w(null)}},A=async(a,S)=>{try{const I=s.settings?.category_leads||{},C={...s.settings,category_leads:{...I,[a]:S}};await T.put(`/api/projects/${s.id}`,{settings:C}),f()}catch(I){console.error("Failed to set lead:",I),o.error("Failed to set team lead")}};return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4",children:[e.jsxs("div",{className:_(O,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"})," PROJECT CATEGORIES"]}),e.jsxs("button",{onClick:()=>{y(null),v(!0)},className:L,children:[e.jsx(ae,{className:"w-4 h-4"})," Add Category"]})]}),d?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--gm-accent-primary)] border-t-transparent rounded-full animate-spin"})}):m.length===0?e.jsx("div",{className:"text-center py-8 text-[var(--gm-text-tertiary)] text-sm",children:"No categories found."}):e.jsx("div",{className:"grid gap-3",children:m.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)]/20 hover:bg-[var(--gm-bg-tertiary)]/40 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold bg-${a.color||"blue"}-500/10 text-${a.color||"blue"}-500`,children:ne(a.display_name)}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:a.display_name}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:a.description||"No description"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] mb-0.5",children:"Team Lead"}),e.jsxs(le,{value:s.settings?.category_leads?.[a.id]||"",onValueChange:S=>A(a.id,S),children:[e.jsx(ce,{className:"h-6 text-[10px] bg-[var(--gm-bg-primary)] border-[var(--gm-border-primary)] w-[140px]",children:e.jsx(oe,{placeholder:"No Lead"})}),e.jsxs(de,{children:[e.jsx(X,{value:"no-lead",children:"No Lead Assigned"}),l.map(S=>e.jsx(X,{value:S.user_id,className:"text-[10px]",children:S.display_name},S.user_id))]})]})]}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full ${a.project_id?"bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]"}`,children:a.project_id?"Project":"Global"}),a.project_id&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{y(a),v(!0)},className:"p-1.5 text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:e.jsx(je,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>x(a),className:"p-1.5 text-[var(--gm-text-tertiary)] hover:text-[var(--color-danger-500)] transition-colors",children:e.jsx(Z,{className:"w-3.5 h-3.5"})})]})]})]},a.id))})]}),e.jsx(Rt,{open:u,onClose:()=>v(!1),projectId:s.id,onSuccess:i,initialData:n}),e.jsx(Pe,{open:!!c,onOpenChange:a=>!a&&w(null),children:e.jsxs(Ae,{children:[e.jsxs(De,{children:[e.jsx(Te,{children:"Delete Category"}),e.jsxs(Ie,{children:["Are you sure you want to delete the category ",e.jsx("strong",{children:c?.display_name}),"? This action cannot be undone."]})]}),e.jsxs(Me,{children:[e.jsx(Re,{children:"Cancel"}),e.jsx(Ee,{onClick:D,className:"bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)]",children:"Delete"})]})]})})]})}function Rt({open:s,onClose:l,projectId:f,onSuccess:m,initialData:p}){const[d,j]=r.useState(""),[u,v]=r.useState(""),[n,y]=r.useState(""),[c,w]=r.useState(!1);r.useEffect(()=>{s&&(p?(j(p.name),v(p.display_name),y(p.description||"")):(j(""),v(""),y("")))},[s,p]);const i=async()=>{if(!(!d.trim()||!u.trim()))try{w(!0);const x={name:d.toLowerCase().replace(/\s+/g,"_"),display_name:u,description:n,color:"blue"};p?await T.put(`/api/projects/${f}/categories/${p.id}`,x):await T.post(`/api/projects/${f}/categories`,x),m(),l()}catch(x){console.error("Failed to save category:",x),o.error("Failed to save category")}finally{w(!1)}};return e.jsx(he,{open:s,onOpenChange:l,children:e.jsxs(ve,{className:"sm:max-w-[450px] bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsx(ue,{children:e.jsx(ye,{className:"text-[var(--gm-text-primary)]",children:p?"Edit Category":"Add New Category"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Display Name *"}),e.jsx(U,{value:u,onChange:x=>{v(x.target.value),!p&&(!d||d===u.toLowerCase().replace(/\s+/g,"_").slice(0,-1))&&j(x.target.value.toLowerCase().replace(/\s+/g,"_"))},placeholder:"e.g. Frontend Team",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Internal Name (Slug) *"}),e.jsx(U,{value:d,onChange:x=>j(x.target.value),placeholder:"e.g. frontend_team",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm font-mono"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Unique identifier used in system."})]}),e.jsxs("div",{children:[e.jsx("label",{className:$,children:"Description"}),e.jsx(U,{value:n,onChange:x=>y(x.target.value),placeholder:"Description...",className:"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{onClick:l,className:K,children:"Cancel"}),e.jsx("button",{onClick:i,disabled:c,className:L,children:c?"Saving...":p?"Update":"Create"})]})]})]})})}function Et({projectId:s}){const[l,f]=r.useState(""),[m,p]=r.useState("member"),[d,j]=r.useState(""),{data:u,isLoading:v}=Ve(s),n=Ge(),y=Je(),c=He(),w=Ye(),i=u?.invites??[],x=async()=>{if(!l.trim()){o.error("Email is required");return}try{const a=await n.mutateAsync({projectId:s,email:l.trim(),role:m});a.invite_url?(await navigator.clipboard.writeText(a.invite_url),o.success(`Invite sent! Link copied to clipboard.${a.email_sent?" Email sent.":""}`)):o.success("Invite created"),f("")}catch{o.error("Failed to create invite")}},D=async()=>{try{const a=await y.mutateAsync(s);a.link&&(await navigator.clipboard.writeText(a.link),o.success("Invite link copied to clipboard"))}catch{o.error("Failed to generate link")}},A=async()=>{if(!d.trim()){o.error("Token is required");return}try{await w.mutateAsync(d.trim()),o.success("Invite accepted! You have joined the project."),j("")}catch{o.error("Failed to accept invite â€” token may be invalid or expired")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:_(O,"p-5 space-y-4"),children:[e.jsx("h3",{className:Q,children:"Invite Members"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{value:l,onChange:a=>f(a.target.value),placeholder:"Email address...",className:"flex-1",onKeyDown:a=>a.key==="Enter"&&x()}),e.jsxs("select",{value:m,onChange:a=>p(a.target.value),className:q,children:[e.jsx("option",{value:"member",children:"Member"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"read",children:"Read Only"})]}),e.jsxs("button",{onClick:x,disabled:n.isPending,className:L,children:[n.isPending?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(Qe,{className:"w-4 h-4"})," Invite"]})]}),e.jsxs("button",{onClick:D,disabled:y.isPending,className:_(K,"disabled:opacity-50"),children:[y.isPending?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(ht,{className:"w-4 h-4"})," Generate Shareable Link"]})]}),e.jsxs("div",{className:_(O,"p-5 space-y-3"),children:[e.jsx("h3",{className:Q,children:"Accept an Invite"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Paste an invite token to join a project you've been invited to."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{value:d,onChange:a=>j(a.target.value),placeholder:"Paste invite token...",className:"flex-1",onKeyDown:a=>a.key==="Enter"&&A()}),e.jsxs("button",{onClick:A,disabled:w.isPending||!d.trim(),className:L,children:[w.isPending?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(vt,{className:"w-4 h-4"})," Accept"]})]})]}),e.jsxs("div",{className:_(O,"p-5"),children:[e.jsx("h3",{className:_(Q,"mb-3"),children:"Pending Invites"}),v?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):i.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-6",children:"No pending invites"}):e.jsx("div",{className:"space-y-2",children:i.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-[var(--gm-border-primary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:a.email||"Link invite"}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx("span",{className:"capitalize",children:a.role}),a.expires_at&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(We,{className:"w-3 h-3"})," Expires ",new Date(a.expires_at).toLocaleDateString()]})]})]})]}),e.jsx("button",{onClick:()=>c.mutate(a.id),disabled:c.isPending,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:text-red-400 hover:bg-red-500/10 transition-colors",children:e.jsx(Z,{className:"w-4 h-4"})})]},a.id))})]})]})}function Lt(){const[s,l]=r.useState(!1),[f,m]=r.useState(""),[p,d]=r.useState("#3b82f6"),[j,u]=r.useState(null),[v,n]=r.useState(""),[y,c]=r.useState(null),[w,i]=r.useState(""),{data:x,isLoading:D}=Xe(),A=Ze(),a=et(),S=tt(),I=at(),C=st(),z=x?.teams??[],V=async()=>{if(!f.trim()){o.error("Team name is required");return}try{await A.mutateAsync({name:f.trim(),color:p}),o.success("Team created"),m(""),l(!1)}catch{o.error("Failed to create team")}},k=async t=>{if(!v.trim()){o.error("Team name is required");return}try{await S.mutateAsync({id:t,name:v.trim()}),o.success("Team renamed"),u(null)}catch{o.error("Failed to rename team")}},b=async t=>{if(!w.trim()){o.error("Contact ID is required");return}try{await I.mutateAsync({teamId:t,contactId:w.trim()}),o.success("Member added"),i(""),c(null)}catch{o.error("Failed to add member")}},H=async(t,g)=>{try{await C.mutateAsync({teamId:t,contactId:g}),o.success("Member removed")}catch{o.error("Failed to remove member")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:Q,children:["Teams (",z.length,")"]}),e.jsxs("button",{onClick:()=>l(!s),className:L,children:[e.jsx(ae,{className:"w-3.5 h-3.5"})," New Team"]})]}),e.jsx(se,{children:s&&e.jsx(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:_(O,"p-4 space-y-3"),children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{value:f,onChange:t=>m(t.target.value),placeholder:"Team name...",className:"flex-1",onKeyDown:t=>t.key==="Enter"&&V()}),e.jsx("input",{type:"color",value:p,onChange:t=>d(t.target.value),className:"w-10 h-10 rounded-lg border border-[var(--gm-border-primary)] cursor-pointer"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:V,disabled:A.isPending,className:L,children:[A.isPending?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(ie,{className:"w-4 h-4"})," Create"]}),e.jsx("button",{onClick:()=>l(!1),className:K,children:"Cancel"})]})]})})}),D?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):z.length===0?e.jsx("div",{className:"text-center py-8 text-sm text-[var(--gm-text-tertiary)]",children:"No teams yet. Create one to get started."}):e.jsx("div",{className:"space-y-2",children:z.map(t=>e.jsxs(B.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},className:_(O,"p-4 hover:border-[var(--gm-accent-primary)]/20"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color||"#3b82f6"}}),j===t.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{value:v,onChange:g=>n(g.target.value),className:"h-7 text-sm w-48",onKeyDown:g=>{g.key==="Enter"&&k(t.id),g.key==="Escape"&&u(null)},autoFocus:!0}),e.jsx("button",{onClick:()=>k(t.id),disabled:S.isPending,className:"p-1 rounded text-[var(--gm-accent-primary)] hover:bg-[var(--gm-interactive-primary)]/10 transition-colors",children:S.isPending?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>u(null),className:"p-1 rounded text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-colors",children:e.jsx(ge,{className:"w-3.5 h-3.5"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:t.name}),t.description&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:t.description})]}),e.jsx("button",{onClick:()=>{u(t.id),n(t.name)},className:"p-1 rounded text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)] transition-colors",title:"Rename team",children:e.jsx(je,{className:"w-3 h-3"})})]}),e.jsxs(rt,{variant:"secondary",className:"text-[10px]",children:[t.memberCount??0," members"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>c(y===t.id?null:t.id),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:text-[var(--gm-accent-primary)] hover:bg-[var(--gm-interactive-primary)]/10 transition-colors",title:"Add member",children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>a.mutate(t.id),disabled:a.isPending,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:text-red-400 hover:bg-red-500/10 transition-colors",children:e.jsx(Z,{className:"w-4 h-4"})})]})]}),e.jsx(se,{children:y===t.id&&e.jsx(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-[var(--gm-border-primary)]",children:[e.jsx(U,{value:w,onChange:g=>i(g.target.value),placeholder:"Contact ID...",className:"flex-1 h-8 text-sm",onKeyDown:g=>g.key==="Enter"&&b(t.id)}),e.jsxs("button",{onClick:()=>b(t.id),disabled:I.isPending||!w.trim(),className:L,children:[I.isPending?e.jsx(F,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(me,{className:"w-3.5 h-3.5"})," Add"]}),e.jsx("button",{onClick:()=>c(null),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ge,{className:"w-3.5 h-3.5"})})]})})}),t.memberDetails&&t.memberDetails.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1.5",children:t.memberDetails.map((g,P)=>e.jsxs("span",{className:"flex items-center gap-1 px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[10px] text-[var(--gm-text-primary)] group/member",children:[e.jsx(pe,{className:"w-3 h-3"})," ",g.name||g.contactId,g.isLead&&e.jsx("span",{className:"text-amber-400",children:"â˜…"}),g.role&&e.jsxs("span",{className:"text-[var(--gm-text-tertiary)]",children:["(",g.role,")"]}),e.jsx("button",{onClick:()=>H(t.id,g.contactId),disabled:C.isPending,className:"ml-0.5 p-0.5 rounded-full text-[var(--gm-text-tertiary)] hover:text-red-400 hover:bg-red-500/10 opacity-0 group-hover/member:opacity-100 transition-all",title:"Remove member",children:e.jsx(ge,{className:"w-2.5 h-2.5"})})]},P))})]},t.id))})]})}function $t({projectId:s}){const{data:l,isLoading:f,refetch:m}=it(s),p=nt(),d=lt(),j=ct(),[u,v]=r.useState(null),[n,y]=r.useState(""),c=l?.providers??[],w=a=>{n.trim()&&p.mutate({projectId:s,provider:a,apiKey:n.trim()},{onSuccess:()=>{o.success(`${a} key saved`),v(null),y(""),m()},onError:()=>o.error("Failed to save key")})},i=a=>{d.mutate({projectId:s,provider:a},{onSuccess:()=>{o.success(`${a} key removed`),m()},onError:()=>o.error("Failed to remove key")})},x=a=>{j.mutate({projectId:s,provider:a},{onSuccess:()=>o.success(`${a} key is valid`),onError:()=>o.error(`${a} key validation failed`)})},A=["openai","anthropic","google","groq","deepseek","ollama"].map(a=>{const S=c.find(I=>I.provider===a||I.name===a);return{name:a,hasKey:!!S?.has_key,...S||{}}});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:Q,children:"AI Provider Keys (BYOK)"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Bring your own API keys for each provider"})]}),f?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):e.jsx("div",{className:"space-y-2",children:A.map(a=>e.jsxs("div",{className:_(O,"p-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:_("w-8 h-8 rounded-lg flex items-center justify-center",a.hasKey?"bg-green-500/10":"bg-[var(--gm-bg-tertiary)]"),children:e.jsx(Le,{className:_("w-4 h-4",a.hasKey?"text-green-500":"text-[var(--gm-text-tertiary)]")})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)] capitalize",children:a.name}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:a.hasKey?"Key configured":"No key set â€” uses system default"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[a.hasKey&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>x(a.name),disabled:j.isPending,className:K,children:[e.jsx(ut,{className:"w-3 h-3"})," Test"]}),e.jsxs("button",{onClick:()=>i(a.name),disabled:d.isPending,className:"inline-flex items-center gap-1 px-2 py-1 rounded-md text-[10px] text-[var(--gm-text-tertiary)] hover:text-[var(--color-danger-500)] transition-colors",children:[e.jsx(Z,{className:"w-3 h-3"})," Remove"]})]}),e.jsx("button",{onClick:()=>{v(u===a.name?null:a.name),y("")},className:K,children:u===a.name?"Cancel":a.hasKey?"Update":"Set Key"})]})]}),u===a.name&&e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx("input",{value:n,onChange:S=>y(S.target.value),type:"password",placeholder:`Enter ${a.name} API key...`,className:q}),e.jsxs("button",{onClick:()=>w(a.name),disabled:p.isPending||!n.trim(),className:L,children:[p.isPending?e.jsx(F,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"})," Save"]})]})]},a.name))})]})}function Ft({projectId:s}){const[l,f]=r.useState("activity"),{data:m,isLoading:p}=ot(s,{limit:50}),{data:d,isLoading:j}=dt(s,{limit:50}),u=m?.activities??[],v=d?.entries??[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:Q,children:l==="activity"?`Recent Activity (${m?.total??0})`:`Audit Log (${d?.total??0})`}),e.jsxs("div",{className:"flex bg-[var(--gm-bg-tertiary)] rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>f("activity"),className:_("px-3 py-1.5 rounded-md text-xs font-medium transition-colors",l==="activity"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"),children:"Activity"}),e.jsx("button",{onClick:()=>f("audit"),className:_("px-3 py-1.5 rounded-md text-xs font-medium transition-colors",l==="audit"?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-[var(--shadow-sm)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"),children:"Audit Log"})]})]}),l==="activity"?e.jsx(e.Fragment,{children:p?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):u.length===0?e.jsx("div",{className:"text-center py-8 text-xs text-[var(--gm-text-tertiary)]",children:"No activity recorded yet."}):e.jsx("div",{className:"space-y-1",children:u.map((n,y)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx(_e,{className:"w-3.5 h-3.5 text-[var(--gm-accent-primary)] flex-shrink-0"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"text-xs text-[var(--gm-text-primary)]",children:[n.actor_name&&e.jsxs("span",{className:"font-medium",children:[n.actor_name," "]}),n.action?.replace(/[._]/g," "),n.target_type&&e.jsxs("span",{className:"text-[var(--gm-text-tertiary)]",children:[" on ",n.target_type]})]})}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] flex-shrink-0",children:new Date(n.created_at).toLocaleString()})]},n.id||y))})}):e.jsx(e.Fragment,{children:j?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(F,{className:"w-5 h-5 animate-spin text-[var(--gm-accent-primary)]"})}):v.length===0?e.jsx("div",{className:"text-center py-8 text-xs text-[var(--gm-text-tertiary)]",children:"No audit entries yet."}):e.jsx("div",{className:"space-y-1",children:v.map((n,y)=>e.jsxs("div",{className:_(O,"flex items-center gap-3 p-3"),children:[e.jsx(te,{className:"w-3.5 h-3.5 text-amber-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs text-[var(--gm-text-primary)]",children:[n.actor_name&&e.jsxs("span",{className:"font-medium",children:[n.actor_name," "]}),e.jsx("span",{children:(n.action||"").replace(/[._]/g," ")}),n.target_type&&e.jsxs("span",{className:"text-[var(--gm-text-tertiary)]",children:[" on ",n.target_type]})]}),n.details&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate max-w-md",children:typeof n.details=="string"?n.details:JSON.stringify(n.details)})]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] flex-shrink-0",children:n.created_at?new Date(n.created_at).toLocaleString():"â€”"})]},n.id||y))})})]})}export{na as default};
//# sourceMappingURL=ProjectsPage-DlVWrhYg.js.map
