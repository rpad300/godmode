{"version":3,"file":"EmailsPage-CUHlsnUj.js","sources":["../../../node_modules/lucide-react/dist/esm/icons/arrow-down-left.js","../../../node_modules/lucide-react/dist/esm/icons/arrow-left-right.js","../../../node_modules/lucide-react/dist/esm/icons/forward.js","../../frontend/src/components/emails/EmailDetail.tsx","../../frontend/src/components/emails/EmailComposeModal.tsx","../../frontend/src/pages/EmailsPage.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.564.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M17 7 7 17\", key: \"15tmo1\" }],\n  [\"path\", { d: \"M17 17H7V7\", key: \"1org7z\" }]\n];\nconst ArrowDownLeft = createLucideIcon(\"arrow-down-left\", __iconNode);\n\nexport { __iconNode, ArrowDownLeft as default };\n//# sourceMappingURL=arrow-down-left.js.map\n","/**\n * @license lucide-react v0.564.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M8 3 4 7l4 4\", key: \"9rb6wj\" }],\n  [\"path\", { d: \"M4 7h16\", key: \"6tx8e3\" }],\n  [\"path\", { d: \"m16 21 4-4-4-4\", key: \"siv7j2\" }],\n  [\"path\", { d: \"M20 17H4\", key: \"h6l3hr\" }]\n];\nconst ArrowLeftRight = createLucideIcon(\"arrow-left-right\", __iconNode);\n\nexport { __iconNode, ArrowLeftRight as default };\n//# sourceMappingURL=arrow-left-right.js.map\n","/**\n * @license lucide-react v0.564.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m15 17 5-5-5-5\", key: \"nf172w\" }],\n  [\"path\", { d: \"M4 18v-2a4 4 0 0 1 4-4h12\", key: \"jmiej9\" }]\n];\nconst Forward = createLucideIcon(\"forward\", __iconNode);\n\nexport { __iconNode, Forward as default };\n//# sourceMappingURL=forward.js.map\n","import { useState, useEffect } from 'react';\r\nimport {\r\n  Star, Eye, EyeOff, Archive, Trash2, CheckCircle,\r\n  Clock, Sparkles, Loader2, Reply, Forward, ArrowUpRight, ArrowDownLeft,\r\n  ArrowLeftRight, Users, FileText, Brain, Contact, Paperclip,\r\n  AlertTriangle, HelpCircle, Lightbulb, Cpu, Link2, ArrowLeft,\r\n} from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { cn, getInitials, resolveAvatarUrl, isValidAvatarUrl } from '../../lib/utils';\r\nimport {\r\n  useDeleteEmail, useMarkEmailResponded, useGenerateEmailResponse,\r\n  useStarEmail, useArchiveEmail, useMarkEmailRead, useEmailThread,\r\n  useCategorizeEmail, useGenerateEmailSummary,\r\n} from '../../hooks/useGodMode';\r\nimport { CommentsPanel } from '../shared/CommentsPanel';\r\n\r\ntype Tab = 'content' | 'analysis' | 'entities' | 'contacts';\r\n\r\nconst CARD = 'rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200';\r\nconst BTN_DANGER = 'inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50';\r\nconst BTN_SECONDARY = 'inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150';\r\n\r\nconst directionIcon: Record<string, typeof ArrowUpRight> = {\r\n  inbound: ArrowDownLeft, outbound: ArrowUpRight, internal: ArrowLeftRight,\r\n};\r\n\r\nconst sentimentConfig: Record<string, { color: string; emoji: string }> = {\r\n  positive: { color: 'bg-green-500/20 text-green-400', emoji: 'üòä' },\r\n  neutral: { color: 'bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]', emoji: 'üòê' },\r\n  negative: { color: 'bg-red-500/20 text-red-400', emoji: 'üòü' },\r\n  urgent: { color: 'bg-red-500/20 text-red-400', emoji: 'üî•' },\r\n};\r\n\r\ninterface Props {\r\n  email: Record<string, unknown>;\r\n  onBack: () => void;\r\n  onReply?: (email: Record<string, unknown>) => void;\r\n  onForward?: (email: Record<string, unknown>) => void;\r\n}\r\n\r\nexport default function EmailDetail({ email, onBack, onReply, onForward }: Props) {\r\n  const [tab, setTab] = useState<Tab>('content');\r\n  const [draftResponse, setDraftResponse] = useState<string | null>(null);\r\n  const [showThread, setShowThread] = useState(false);\r\n  const [confirmDelete, setConfirmDelete] = useState(false);\r\n\r\n  const deleteEmail = useDeleteEmail();\r\n  const markResponded = useMarkEmailResponded();\r\n  const generateResponse = useGenerateEmailResponse();\r\n  const starEmail = useStarEmail();\r\n  const archiveEmail = useArchiveEmail();\r\n  const markRead = useMarkEmailRead();\r\n  const categorizeEmail = useCategorizeEmail();\r\n  const summarizeEmail = useGenerateEmailSummary();\r\n\r\n  const threadId = email.thread_id ? String(email.thread_id) : null;\r\n  const threadQuery = useEmailThread(showThread ? threadId : null);\r\n  const threadEmails = (threadQuery.data as Record<string, unknown>)?.emails as Array<Record<string, unknown>> | undefined;\r\n\r\n  // Reset state on email change\r\n  useEffect(() => {\r\n    setTab('content');\r\n    setDraftResponse(null);\r\n    setShowThread(false);\r\n    setConfirmDelete(false);\r\n  }, [email.id]);\r\n\r\n  const subject = String(email.subject || 'No subject');\r\n  const from = String(email.from || email.from_name || email.sender || '‚Äî');\r\n  const fromEmail = String(email.from_email || '');\r\n  const to = String(email.to || '');\r\n  const cc = String(email.cc || '');\r\n  const date = email.date ? new Date(String(email.date)).toLocaleString() : '';\r\n  const body = String(email.body || email.body_text || '');\r\n  const isRead = !!email.is_read;\r\n  const isStarred = !!email.is_starred;\r\n  const direction = String(email.direction || '');\r\n  const sentiment = String(email.sentiment || '');\r\n  const intent = String(email.detected_intent || email.ai_category || '');\r\n  const aiSummary = String(email.ai_summary || '');\r\n  const requiresResponse = !!email.requires_response;\r\n\r\n  const extracted = (email.extracted_entities || {}) as Record<string, unknown>;\r\n  const facts = (extracted.facts || []) as Array<Record<string, unknown>>;\r\n  const decisions = (extracted.decisions || []) as Array<Record<string, unknown>>;\r\n  const risks = (extracted.risks || []) as Array<Record<string, unknown>>;\r\n  const actionItems = (extracted.action_items || []) as Array<Record<string, unknown>>;\r\n  const questions = (extracted.questions || []) as Array<Record<string, unknown>>;\r\n  const people = (extracted.people || []) as Array<Record<string, unknown>>;\r\n  const technologies = (extracted.technologies || []) as Array<Record<string, unknown>>;\r\n  const relationships = (extracted.relationships || []) as Array<Record<string, unknown>>;\r\n  const keyTopics = (extracted.key_topics || []) as string[];\r\n  const attachments = (email.attachments || []) as Array<Record<string, unknown>>;\r\n\r\n  const hasAnalysis = facts.length > 0 || decisions.length > 0 || risks.length > 0 || actionItems.length > 0 || questions.length > 0;\r\n  const hasEntities = technologies.length > 0 || relationships.length > 0 || keyTopics.length > 0;\r\n  const hasPeople = people.length > 0;\r\n\r\n  const DirIcon = directionIcon[direction] || null;\r\n  const sentCfg = sentimentConfig[sentiment] || sentimentConfig.neutral;\r\n\r\n  const handleDelete = () => {\r\n    deleteEmail.mutate(String(email.id), {\r\n      onSuccess: () => { toast.success('Email deleted'); onBack(); },\r\n    });\r\n  };\r\n\r\n  const handleGenerateResponse = () => {\r\n    setDraftResponse(null);\r\n    generateResponse.mutate(String(email.id), {\r\n      onSuccess: (data) => { setDraftResponse(data.response || data.draft || 'No response generated.'); toast.success('AI response generated'); },\r\n      onError: () => toast.error('Failed to generate response'),\r\n    });\r\n  };\r\n\r\n  const tabs: { key: Tab; label: string; icon: typeof FileText; count?: number; hidden?: boolean }[] = [\r\n    { key: 'content', label: 'Content', icon: FileText },\r\n    { key: 'analysis', label: 'Analysis', icon: Brain, count: facts.length + actionItems.length + decisions.length + risks.length + questions.length, hidden: !hasAnalysis },\r\n    { key: 'entities', label: 'Entities', icon: Cpu, count: technologies.length + relationships.length + keyTopics.length, hidden: !hasEntities },\r\n    { key: 'contacts', label: 'Contacts', icon: Contact, count: people.length, hidden: !hasPeople },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-4\">\r\n      <button onClick={onBack} className=\"flex items-center gap-1.5 text-xs text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors mb-2\">\r\n        <ArrowLeft className=\"w-3.5 h-3.5\" /> Back to Emails\r\n      </button>\r\n\r\n      <div className={CARD}>\r\n        {/* Header */}\r\n        <div className=\"p-5 rounded-t-xl\" style={{ background: 'linear-gradient(to right, rgba(37,99,235,0.15), rgba(37,99,235,0.04))' }}>\r\n          <div className=\"flex items-start gap-3\">\r\n            <div className=\"w-12 h-12 rounded-xl flex items-center justify-center shrink-0\" style={{ backgroundColor: 'rgba(37,99,235,0.15)' }}>\r\n              {DirIcon ? <DirIcon className=\"w-6 h-6 text-blue-400\" /> : <FileText className=\"w-6 h-6 text-blue-400\" />}\r\n            </div>\r\n            <div className=\"flex-1 min-w-0\">\r\n              <h2 className=\"text-lg font-semibold text-[var(--gm-text-primary)] leading-tight\">{subject}</h2>\r\n              <div className=\"mt-1.5 space-y-0.5 text-xs text-[var(--gm-text-tertiary)]\">\r\n                <div className=\"flex gap-2\"><span className=\"text-[var(--gm-text-tertiary)] w-8\">From</span><span><strong className=\"text-[var(--gm-text-primary)]\">{from}</strong>{fromEmail && ` <${fromEmail}>`}</span></div>\r\n                {to && <div className=\"flex gap-2\"><span className=\"text-[var(--gm-text-tertiary)] w-8\">To</span><span>{to}</span></div>}\r\n                {cc && <div className=\"flex gap-2\"><span className=\"text-[var(--gm-text-tertiary)] w-8\">CC</span><span>{cc}</span></div>}\r\n                {date && <div className=\"flex gap-2\"><span className=\"text-[var(--gm-text-tertiary)] w-8\">Date</span><span>{date}</span></div>}\r\n              </div>\r\n              <div className=\"flex gap-1.5 mt-2 flex-wrap\">\r\n                {intent && <span className=\"text-[10px] px-2 py-0.5 rounded-full bg-blue-500/20 text-blue-400 font-medium capitalize\">{intent.replace(/_/g, ' ')}</span>}\r\n                {sentiment && <span className={cn('text-[10px] px-2 py-0.5 rounded-full font-medium capitalize', sentCfg.color)}>{sentCfg.emoji} {sentiment}</span>}\r\n                {requiresResponse && <span className=\"text-[10px] px-2 py-0.5 rounded-full bg-yellow-500/20 text-yellow-400 font-medium flex items-center gap-1\"><Clock className=\"w-3 h-3\" /> Needs Response</span>}\r\n                {direction && DirIcon && <span className=\"text-[10px] px-2 py-0.5 rounded-full text-[var(--gm-text-tertiary)] capitalize flex items-center gap-1 bg-[var(--gm-bg-tertiary)]\"><DirIcon className=\"w-3 h-3\" /> {direction}</span>}\r\n                {attachments.length > 0 && <span className=\"text-[10px] px-2 py-0.5 rounded-full text-[var(--gm-text-tertiary)] flex items-center gap-1 bg-[var(--gm-bg-tertiary)]\"><Paperclip className=\"w-3 h-3\" /> {attachments.length}</span>}\r\n              </div>\r\n            </div>\r\n            <div className=\"flex items-center gap-1 shrink-0\">\r\n              <button onClick={() => starEmail.mutate({ id: String(email.id), starred: !isStarred })} className=\"p-2 rounded-lg hover:bg-[var(--gm-surface-hover)] transition-colors\" title={isStarred ? 'Unstar' : 'Star'}>\r\n                <Star className={cn('w-4 h-4', isStarred ? 'fill-yellow-400 text-yellow-400' : 'text-[var(--gm-text-tertiary)] hover:text-yellow-400')} />\r\n              </button>\r\n              <button onClick={() => markRead.mutate({ id: String(email.id), read: !isRead })} className=\"p-2 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-colors\" title={isRead ? 'Mark unread' : 'Mark read'}>\r\n                {isRead ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\r\n              </button>\r\n              <button onClick={() => archiveEmail.mutate(String(email.id), { onSuccess: () => { toast.success('Archived'); onBack(); } })} className=\"p-2 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-colors\" title=\"Archive\">\r\n                <Archive className=\"w-4 h-4\" />\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Tabs */}\r\n        <div className=\"flex gap-1 px-5 border-b border-[var(--gm-border-primary)]\">\r\n          {tabs.filter(t => !t.hidden).map(t => {\r\n            const Icon = t.icon;\r\n            return (\r\n              <button key={t.key} onClick={() => setTab(t.key)}\r\n                className={cn('flex items-center gap-1.5 px-4 py-2.5 text-xs font-medium border-b-2 transition-colors',\r\n                  tab === t.key ? 'border-[var(--gm-accent-primary)] text-[var(--gm-accent-primary)]' : 'border-transparent text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]')}>\r\n                <Icon className=\"w-3.5 h-3.5\" /> {t.label}\r\n                {t.count !== undefined && t.count > 0 && <span className=\"text-[10px] px-1.5 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]\">{t.count}</span>}\r\n              </button>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Tab Content */}\r\n        <div className=\"p-5 space-y-4\">\r\n          {tab === 'content' && (\r\n            <>\r\n              {aiSummary && (\r\n                <div className=\"bg-blue-600/5 border-l-[3px] border-[var(--gm-accent-primary)] rounded-r-lg p-4\">\r\n                  <div className=\"text-[10px] uppercase tracking-wider text-[var(--gm-accent-primary)] font-semibold mb-1.5 flex items-center gap-1.5\"><Sparkles className=\"w-3.5 h-3.5\" /> AI Summary</div>\r\n                  <p className=\"text-sm text-[var(--gm-text-primary)] leading-relaxed\">{aiSummary}</p>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"bg-[var(--gm-bg-tertiary)] rounded-xl p-5\">\r\n                <pre className=\"text-sm text-[var(--gm-text-primary)] whitespace-pre-wrap font-sans leading-relaxed\">{body}</pre>\r\n              </div>\r\n\r\n              {attachments.length > 0 && (\r\n                <div>\r\n                  <h4 className=\"text-xs font-semibold text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2 flex items-center gap-1.5\"><Paperclip className=\"w-3.5 h-3.5\" /> Attachments ({attachments.length})</h4>\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    {attachments.map((att, i) => (\r\n                      <div key={i} className=\"flex items-center gap-2 bg-[var(--gm-bg-tertiary)] rounded-lg px-3 py-2 border border-[var(--gm-border-primary)]\">\r\n                        <Paperclip className=\"w-4 h-4 text-[var(--gm-accent-primary)]\" />\r\n                        <span className=\"text-xs text-[var(--gm-text-primary)]\">{String(att.filename || att.name || `Attachment ${i + 1}`)}</span>\r\n                        {att.size && <span className=\"text-[10px] text-[var(--gm-text-tertiary)]\">{formatBytes(Number(att.size))}</span>}\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {threadId && (\r\n                <div className=\"border-t border-[var(--gm-border-primary)] pt-4\">\r\n                  <button onClick={() => setShowThread(!showThread)} className=\"text-xs text-[var(--gm-accent-primary)] hover:underline font-medium\">\r\n                    {showThread ? 'Hide thread' : 'Show thread'}\r\n                  </button>\r\n                  {showThread && threadQuery.isLoading && <Loader2 className=\"w-4 h-4 animate-spin text-[var(--gm-accent-primary)] mt-2\" />}\r\n                  {showThread && threadEmails && threadEmails.length > 0 && (\r\n                    <div className=\"space-y-2 mt-3 ml-4 border-l-2 border-blue-600/20 pl-4\">\r\n                      {threadEmails.filter(te => String(te.id) !== String(email.id)).map((te, i) => (\r\n                        <div key={i} className=\"bg-[var(--gm-surface-hover)] rounded-lg p-3\">\r\n                          <div className=\"flex items-center justify-between mb-1\">\r\n                            <span className=\"text-xs font-medium text-[var(--gm-text-primary)]\">{String(te.from || te.from_name || te.sender || '‚Äî')}</span>\r\n                            {te.date && <span className=\"text-[10px] text-[var(--gm-text-tertiary)]\">{new Date(String(te.date)).toLocaleString()}</span>}\r\n                          </div>\r\n                          <p className=\"text-xs text-[var(--gm-text-tertiary)] line-clamp-3\">{String(te.body || te.body_text || te.ai_summary || '')}</p>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Actions */}\r\n              <div className=\"border-t border-[var(--gm-border-primary)] pt-4 flex flex-wrap gap-2\">\r\n                {onReply && <button onClick={() => onReply(email)} className=\"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-xs font-medium hover:bg-[var(--gm-interactive-primary-hover)] flex items-center gap-1.5 transition-colors\"><Reply className=\"w-3.5 h-3.5\" /> Reply</button>}\r\n                {onForward && <button onClick={() => onForward(email)} className={BTN_SECONDARY}><Forward className=\"w-3.5 h-3.5\" /> Forward</button>}\r\n                {requiresResponse && <button onClick={() => markResponded.mutate(String(email.id), { onSuccess: () => toast.success('Marked as responded') })} disabled={markResponded.isPending} className=\"px-3 py-1.5 rounded-lg bg-green-500/10 text-green-500 text-xs font-medium hover:bg-green-500/20 flex items-center gap-1.5\"><CheckCircle className=\"w-3.5 h-3.5\" /> Mark Responded</button>}\r\n                <button onClick={handleGenerateResponse} disabled={generateResponse.isPending} className=\"px-3 py-1.5 rounded-lg bg-blue-600/10 text-[var(--gm-accent-primary)] text-xs font-medium hover:bg-blue-600/20 flex items-center gap-1.5 transition-colors\">\r\n                  {generateResponse.isPending ? <Loader2 className=\"w-3.5 h-3.5 animate-spin\" /> : <Sparkles className=\"w-3.5 h-3.5\" />} Generate AI Response\r\n                </button>\r\n                <button onClick={() => categorizeEmail.mutate(String(email.id), { onSuccess: (r) => toast.success(`Categorized: ${r?.category ?? 'done'}`) })} disabled={categorizeEmail.isPending} className={BTN_SECONDARY}>\r\n                  {categorizeEmail.isPending ? <Loader2 className=\"w-3.5 h-3.5 animate-spin\" /> : <Brain className=\"w-3.5 h-3.5\" />} AI Categorize\r\n                </button>\r\n                <button onClick={() => summarizeEmail.mutate(String(email.id), { onSuccess: () => toast.success('Summary generated') })} disabled={summarizeEmail.isPending} className={BTN_SECONDARY}>\r\n                  {summarizeEmail.isPending ? <Loader2 className=\"w-3.5 h-3.5 animate-spin\" /> : <Brain className=\"w-3.5 h-3.5\" />} AI Summarize\r\n                </button>\r\n              </div>\r\n\r\n              {draftResponse && (\r\n                <div className=\"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4\">\r\n                  <h4 className=\"text-xs font-semibold text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2\">Draft Response</h4>\r\n                  <pre className=\"text-sm text-[var(--gm-text-primary)] whitespace-pre-wrap font-sans leading-relaxed\">{draftResponse}</pre>\r\n                </div>\r\n              )}\r\n            </>\r\n          )}\r\n\r\n          {tab === 'analysis' && (\r\n            <div className=\"space-y-5\">\r\n              {facts.length > 0 && <AnalysisSection title=\"Facts\" icon={Lightbulb} color=\"text-[var(--gm-accent-primary)]\" count={facts.length}>{facts.map((f, i) => <div key={i} className=\"bg-[var(--gm-surface-hover)] rounded-lg p-3\"><p className=\"text-xs text-[var(--gm-text-primary)]\">{String(f.content)}</p><div className=\"flex gap-2 mt-1.5\">{f.category && <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] capitalize\">{String(f.category)}</span>}{f.confidence && <span className=\"text-[10px] text-[var(--gm-text-tertiary)] capitalize\">{String(f.confidence)} confidence</span>}</div></div>)}</AnalysisSection>}\r\n              {actionItems.length > 0 && <AnalysisSection title=\"Action Items\" icon={CheckCircle} color=\"text-green-500\" count={actionItems.length}>{actionItems.map((a, i) => <div key={i} className=\"bg-[var(--gm-surface-hover)] rounded-lg p-3\"><p className=\"text-xs text-[var(--gm-text-primary)] flex items-start gap-1.5\"><span className=\"text-green-500 mt-0.5\">&#x2610;</span> {String(a.task)}</p><div className=\"flex gap-2 mt-1.5 flex-wrap\">{a.owner && <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]\">Owner: {String(a.owner)}</span>}{a.deadline && <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]\">Due: {String(a.deadline)}</span>}{a.priority && <span className={cn('text-[10px] px-1.5 py-0.5 rounded capitalize', a.priority === 'critical' || a.priority === 'high' ? 'bg-red-500/10 text-red-500' : a.priority === 'medium' ? 'bg-yellow-500/10 text-yellow-500' : 'bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]')}>{String(a.priority)}</span>}</div></div>)}</AnalysisSection>}\r\n              {decisions.length > 0 && <AnalysisSection title=\"Decisions\" icon={Lightbulb} color=\"text-[var(--gm-accent-primary)]\" count={decisions.length}>{decisions.map((d, i) => <div key={i} className=\"bg-[var(--gm-surface-hover)] rounded-lg p-3\"><p className=\"text-xs text-[var(--gm-text-primary)]\">{String(d.content)}</p><div className=\"flex gap-2 mt-1.5\">{d.owner && <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]\">By: {String(d.owner)}</span>}{d.status && <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-blue-600/10 text-[var(--gm-accent-primary)] capitalize\">{String(d.status)}</span>}</div></div>)}</AnalysisSection>}\r\n              {risks.length > 0 && <AnalysisSection title=\"Risks\" icon={AlertTriangle} color=\"text-red-500\" count={risks.length}>{risks.map((r, i) => <div key={i} className=\"bg-[var(--gm-surface-hover)] rounded-lg p-3\"><p className=\"text-xs text-[var(--gm-text-primary)]\">{String(r.content)}</p><div className=\"flex gap-2 mt-1.5\">{r.impact && <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-red-500/10 text-red-500\">Impact: {String(r.impact)}</span>}{r.likelihood && <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-yellow-500/10 text-yellow-500\">Likelihood: {String(r.likelihood)}</span>}</div>{r.mitigation && <p className=\"text-[10px] text-[var(--gm-text-tertiary)] mt-1.5 italic\">Mitigation: {String(r.mitigation)}</p>}</div>)}</AnalysisSection>}\r\n              {questions.length > 0 && <AnalysisSection title=\"Questions\" icon={HelpCircle} color=\"text-yellow-500\" count={questions.length}>{questions.map((q, i) => <div key={i} className=\"bg-[var(--gm-surface-hover)] rounded-lg p-3\"><p className=\"text-xs text-[var(--gm-text-primary)] flex items-start gap-1.5\"><HelpCircle className=\"w-3.5 h-3.5 text-yellow-500 shrink-0 mt-0.5\" /> {String(q.content)}</p>{q.assignee && <span className=\"text-[10px] text-[var(--gm-text-tertiary)] ml-5\">Assigned to: {String(q.assignee)}</span>}</div>)}</AnalysisSection>}\r\n            </div>\r\n          )}\r\n\r\n          {tab === 'entities' && (\r\n            <div className=\"space-y-5\">\r\n              {technologies.length > 0 && <AnalysisSection title=\"Technologies\" icon={Cpu} color=\"text-[var(--gm-accent-primary)]\" count={technologies.length}><div className=\"flex flex-wrap gap-2\">{technologies.map((t, i) => <span key={i} className=\"text-xs px-3 py-1.5 rounded-lg bg-blue-600/10 text-[var(--gm-accent-primary)] font-medium\">{String(t.name)}{t.category && <span className=\"text-[10px] text-blue-500 ml-1.5 capitalize\">({String(t.category)})</span>}</span>)}</div></AnalysisSection>}\r\n              {keyTopics.length > 0 && <AnalysisSection title=\"Key Topics\" icon={FileText} color=\"text-[var(--gm-text-primary)]\" count={keyTopics.length}><div className=\"flex flex-wrap gap-2\">{keyTopics.map((t, i) => <span key={i} className=\"text-xs px-3 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)] border border-[var(--gm-border-primary)]\">{t}</span>)}</div></AnalysisSection>}\r\n              {relationships.length > 0 && <AnalysisSection title=\"Relationships\" icon={Link2} color=\"text-[var(--gm-accent-primary)]\" count={relationships.length}>{relationships.map((r, i) => <div key={i} className=\"flex items-center gap-2 bg-[var(--gm-surface-hover)] rounded-lg p-3\"><span className=\"text-xs font-medium text-[var(--gm-text-primary)]\">{String(r.from)}</span><span className=\"text-[10px] px-2 py-0.5 rounded bg-blue-600/10 text-[var(--gm-accent-primary)]\">{String(r.type || '').replace(/_/g, ' ')}</span><span className=\"text-xs font-medium text-[var(--gm-text-primary)]\">{String(r.to)}</span></div>)}</AnalysisSection>}\r\n            </div>\r\n          )}\r\n\r\n          {tab === 'contacts' && (\r\n            <div className=\"space-y-3\">\r\n              {people.map((p, i) => {\r\n                const name = String(p.name || 'Unknown');\r\n                const avatarSrc = resolveAvatarUrl(p as any);\r\n                return (\r\n                  <div key={i} className=\"flex items-center gap-3 bg-[var(--gm-surface-hover)] rounded-xl p-4\">\r\n                    <div className=\"w-10 h-10 rounded-full bg-blue-600/20 flex items-center justify-center text-sm font-bold text-[var(--gm-accent-primary)] shrink-0 overflow-hidden\">\r\n                      {isValidAvatarUrl(avatarSrc) ? <img src={avatarSrc} alt={name} className=\"w-full h-full object-cover\" onError={(e) => { (e.target as HTMLImageElement).style.display = 'none'; }} /> : null}\r\n                      <span className={isValidAvatarUrl(avatarSrc) ? 'hidden' : ''}>{getInitials(name)}</span>\r\n                    </div>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"text-sm font-medium text-[var(--gm-text-primary)]\">{name}</p>\r\n                      <div className=\"flex flex-wrap gap-2 mt-0.5\">\r\n                        {p.role && <span className=\"text-[10px] text-[var(--gm-text-tertiary)]\">{String(p.role)}</span>}\r\n                        {p.organization && <span className=\"text-[10px] text-[var(--gm-text-tertiary)]\">at {String(p.organization)}</span>}\r\n                      </div>\r\n                      {p.email && <p className=\"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5\">{String(p.email)}</p>}\r\n                      {p.phone && <p className=\"text-[10px] text-[var(--gm-text-tertiary)]\">{String(p.phone)}</p>}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n\r\n          {/* Comments */}\r\n          {email?.id && (\r\n            <div className=\"mt-4\">\r\n              <CommentsPanel targetType=\"email\" targetId={email.id} />\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Danger Zone */}\r\n        <div className=\"px-5 py-4 border-t border-[var(--gm-border-primary)]\">\r\n          <div className=\"p-4 rounded-lg border border-red-500/20 bg-red-500/5\">\r\n            <p className=\"text-xs font-semibold text-red-500 mb-1\">Danger Zone</p>\r\n            <p className=\"text-xs text-[var(--gm-text-tertiary)] mb-3\">Deleting this email will permanently remove all associated data.</p>\r\n            {!confirmDelete ? (\r\n              <button className=\"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-red-500/10 text-red-500 border border-red-500/30 hover:bg-red-500/20 transition-colors\"\r\n                onClick={() => setConfirmDelete(true)}>\r\n                <Trash2 className=\"w-3.5 h-3.5\" /> Delete Email\r\n              </button>\r\n            ) : (\r\n              <div className=\"flex items-center gap-2\">\r\n                <button className={BTN_DANGER} disabled={deleteEmail.isPending} onClick={handleDelete}>\r\n                  {deleteEmail.isPending ? <Loader2 className=\"w-3.5 h-3.5 animate-spin\" /> : <Trash2 className=\"w-3.5 h-3.5\" />} Confirm Delete\r\n                </button>\r\n                <button className={BTN_SECONDARY} onClick={() => setConfirmDelete(false)}>Cancel</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction AnalysisSection({ title, icon: Icon, color, count, children }: {\r\n  title: string; icon: typeof FileText; color: string; count: number; children: React.ReactNode;\r\n}) {\r\n  return (\r\n    <div>\r\n      <h3 className={cn('text-xs font-semibold uppercase tracking-wider mb-3 flex items-center gap-2', color)}>\r\n        <Icon className=\"w-4 h-4\" /> {title}\r\n        <span className=\"text-[10px] px-2 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] ml-auto\">{count}</span>\r\n      </h3>\r\n      <div className=\"space-y-2\">{children}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction formatBytes(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\r\n}\r\n","import { useState, useRef, useCallback } from 'react';\r\nimport {\r\n  X, Send, Loader2, Paperclip, ChevronDown, ChevronUp, Sparkles,\r\n} from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { Dialog, DialogContent, DialogTitle } from '../ui/Dialog';\r\nimport { cn } from '../../lib/utils';\r\nimport { useSendEmail, useImportEmail, useSprints } from '../../hooks/useGodMode';\r\nimport { apiClient } from '../../lib/api-client';\r\n\r\ntype Mode = 'compose' | 'reply' | 'forward';\r\ntype InputTab = 'compose' | 'paste' | 'upload';\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  mode?: Mode;\r\n  replyTo?: Record<string, unknown> | null;\r\n}\r\n\r\nexport default function EmailComposeModal({ open, onClose, mode = 'compose', replyTo }: Props) {\r\n  const isReply = mode === 'reply' && !!replyTo;\r\n  const isForward = mode === 'forward' && !!replyTo;\r\n\r\n  const [inputTab, setInputTab] = useState<InputTab>(isReply || isForward ? 'compose' : 'compose');\r\n  const [to, setTo] = useState(isReply ? String(replyTo?.from_email || replyTo?.from || '') : '');\r\n  const [cc, setCc] = useState('');\r\n  const [subject, setSubject] = useState(\r\n    isReply ? `Re: ${String(replyTo?.subject || '')}` :\r\n    isForward ? `Fwd: ${String(replyTo?.subject || '')}` : ''\r\n  );\r\n  const [body, setBody] = useState(\r\n    isForward ? `\\n\\n---------- Forwarded message ----------\\nFrom: ${String(replyTo?.from || replyTo?.from_name || '')}\\nDate: ${replyTo?.date ? new Date(String(replyTo.date)).toLocaleString() : ''}\\nSubject: ${String(replyTo?.subject || '')}\\n\\n${String(replyTo?.body || replyTo?.body_text || '')}` :\r\n    isReply ? `\\n\\n> On ${replyTo?.date ? new Date(String(replyTo.date)).toLocaleString() : ''}, ${String(replyTo?.from || replyTo?.from_name || '')} wrote:\\n> ${String(replyTo?.body || replyTo?.body_text || '').split('\\n').join('\\n> ')}` : ''\r\n  );\r\n  const [pasteContent, setPasteContent] = useState('');\r\n  const [showCc, setShowCc] = useState(false);\r\n  const [sending, setSending] = useState(false);\r\n  const [fileName, setFileName] = useState('');\r\n  const fileRef = useRef<HTMLInputElement>(null);\r\n  const fileObjRef = useRef<File | null>(null);\r\n  const [aiDraft, setAiDraft] = useState('');\r\n  const [generatingDraft, setGeneratingDraft] = useState(false);\r\n  const [sprintId, setSprintId] = useState('');\r\n\r\n  const sendEmail = useSendEmail();\r\n  const importEmail = useImportEmail();\r\n  const sprints = useSprints();\r\n\r\n  const handleClose = () => {\r\n    setTo(''); setCc(''); setSubject(''); setBody(''); setPasteContent('');\r\n    setFileName(''); fileObjRef.current = null; setAiDraft(''); setSprintId('');\r\n    onClose();\r\n  };\r\n\r\n  const handleSend = async () => {\r\n    if (inputTab === 'compose') {\r\n      if (!to.trim() || !body.trim()) {\r\n        toast.error('To and Body are required');\r\n        return;\r\n      }\r\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n      const emails = to.split(',').map(e => e.trim()).filter(Boolean);\r\n      const invalid = emails.filter(e => !emailRegex.test(e));\r\n      if (invalid.length > 0) {\r\n        toast.error(`Invalid email address: ${invalid[0]}`);\r\n        return;\r\n      }\r\n      setSending(true);\r\n      try {\r\n        await sendEmail.mutateAsync({\r\n          to: to.split(',').map(e => e.trim()).filter(Boolean),\r\n          cc: cc ? cc.split(',').map(e => e.trim()).filter(Boolean) : undefined,\r\n          subject,\r\n          body,\r\n          replyToId: isReply ? String(replyTo?.id || '') : undefined,\r\n        });\r\n        toast.success(isReply ? 'Reply sent' : isForward ? 'Email forwarded' : 'Email sent');\r\n        handleClose();\r\n      } catch {\r\n        toast.error('Failed to send email');\r\n      } finally {\r\n        setSending(false);\r\n      }\r\n    } else if (inputTab === 'paste') {\r\n      if (pasteContent.trim().length < 10) {\r\n        toast.error('Please paste email content (min 10 chars)');\r\n        return;\r\n      }\r\n      setSending(true);\r\n      try {\r\n        await importEmail.mutateAsync({ emailText: pasteContent, ...(sprintId ? { sprintId } : {}) });\r\n        toast.success('Email imported and analyzed');\r\n        handleClose();\r\n      } catch {\r\n        toast.error('Failed to import email');\r\n      } finally {\r\n        setSending(false);\r\n      }\r\n    } else if (inputTab === 'upload') {\r\n      const file = fileObjRef.current;\r\n      if (!file) {\r\n        toast.error('Please select a file');\r\n        return;\r\n      }\r\n      setSending(true);\r\n      try {\r\n        const base64 = await fileToBase64(file);\r\n        const isMsg = file.name.toLowerCase().endsWith('.msg');\r\n        const sprintPayload = sprintId ? { sprintId } : {};\r\n        await importEmail.mutateAsync(\r\n          isMsg ? { msgBase64: base64, filename: file.name, ...sprintPayload } : { emlBase64: base64, filename: file.name, ...sprintPayload }\r\n        );\r\n        toast.success('Email file imported and analyzed');\r\n        handleClose();\r\n      } catch {\r\n        toast.error('Failed to import email file');\r\n      } finally {\r\n        setSending(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleInsertAiDraft = useCallback(() => {\r\n    if (aiDraft) {\r\n      setBody(aiDraft);\r\n      setAiDraft('');\r\n    }\r\n  }, [aiDraft]);\r\n\r\n  const handleGenerateDraft = async () => {\r\n    if (!replyTo?.id) return;\r\n    setGeneratingDraft(true);\r\n    try {\r\n      const data = await apiClient.post<{ ok?: boolean; draft?: string; response?: string }>(`/api/emails/${replyTo.id}/response`, {});\r\n      if (data.ok || data.draft) {\r\n        setAiDraft(data.draft || data.response || '');\r\n        toast.success('AI draft generated');\r\n      } else {\r\n        toast.error('Failed to generate draft');\r\n      }\r\n    } catch {\r\n      toast.error('Failed to generate draft');\r\n    } finally {\r\n      setGeneratingDraft(false);\r\n    }\r\n  };\r\n\r\n  const handleFileDrop = useCallback((e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    const file = e.dataTransfer.files[0];\r\n    if (file && (file.name.endsWith('.eml') || file.name.endsWith('.msg'))) {\r\n      fileObjRef.current = file;\r\n      setFileName(file.name);\r\n    }\r\n  }, []);\r\n\r\n  const title = isReply ? 'Reply' : isForward ? 'Forward' : 'Compose Email';\r\n  const sendLabel = inputTab === 'compose' ? (isReply ? 'Send Reply' : isForward ? 'Forward' : 'Send') : 'Import & Analyze';\r\n\r\n  const inputTabs: { key: InputTab; label: string }[] = isReply || isForward\r\n    ? [{ key: 'compose', label: 'Compose' }]\r\n    : [\r\n        { key: 'compose', label: 'Compose' },\r\n        { key: 'paste', label: 'Paste Text' },\r\n        { key: 'upload', label: 'Upload .eml/.msg' },\r\n      ];\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={o => !o && handleClose()}>\r\n      <DialogContent className=\"max-w-2xl p-0 overflow-hidden max-h-[90vh] flex flex-col\">\r\n        <DialogTitle className=\"sr-only\">{title}</DialogTitle>\r\n\r\n        {/* Header */}\r\n        <div className=\"px-5 py-4 shrink-0\" style={{ background: 'linear-gradient(to right, rgba(37,99,235,0.25), rgba(37,99,235,0.08))' }}>\r\n          <div className=\"flex items-center justify-between\">\r\n            <h2 className=\"text-base font-semibold text-white\">{title}</h2>\r\n            <button onClick={handleClose} className=\"w-8 h-8 rounded-lg flex items-center justify-center text-slate-400 hover:bg-white/10 transition-colors\">\r\n              <X className=\"w-4 h-4\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Input tabs */}\r\n        {inputTabs.length > 1 && (\r\n          <div className=\"flex px-5 border-b border-[var(--gm-border-primary)] shrink-0\" style={{ borderColor: 'var(--gm-border-primary)' }}>\r\n            {inputTabs.map(t => (\r\n              <button key={t.key} onClick={() => setInputTab(t.key)}\r\n                className={cn('px-4 py-2.5 text-xs font-medium border-b-2 transition-colors',\r\n                  inputTab === t.key ? 'border-blue-500 text-blue-400' : 'border-transparent text-slate-400 hover:text-slate-200')}>\r\n                {t.label}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Body */}\r\n        <div className=\"flex-1 overflow-y-auto p-5 space-y-4 bg-[var(--gm-surface-primary)]\" style={{ backgroundColor: 'var(--gm-surface-primary)' }}>\r\n          {inputTab === 'compose' && (\r\n            <>\r\n              <div className=\"space-y-3\">\r\n                <div>\r\n                  <label className=\"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider\">To *</label>\r\n                  <input value={to} onChange={e => setTo(e.target.value)} placeholder=\"recipient@example.com (comma-separated)\"\r\n                    className=\"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus\" />\r\n                </div>\r\n\r\n                <div className=\"flex items-center justify-between\">\r\n                  <button onClick={() => setShowCc(!showCc)} className=\"text-[10px] text-gm-interactive-primary hover:underline flex items-center gap-1\">\r\n                    {showCc ? <ChevronUp className=\"w-3 h-3\" /> : <ChevronDown className=\"w-3 h-3\" />} CC\r\n                  </button>\r\n                </div>\r\n                {showCc && (\r\n                  <div>\r\n                    <label className=\"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider\">CC</label>\r\n                    <input value={cc} onChange={e => setCc(e.target.value)} placeholder=\"cc@example.com\"\r\n                      className=\"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus\" />\r\n                  </div>\r\n                )}\r\n\r\n                <div>\r\n                  <label className=\"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider\">Subject</label>\r\n                  <input value={subject} onChange={e => setSubject(e.target.value)} placeholder=\"Email subject\"\r\n                    className=\"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus\" />\r\n                </div>\r\n\r\n                <div>\r\n                  <div className=\"flex items-center justify-between mb-1\">\r\n                    <label className=\"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider\">Body *</label>\r\n                    {isReply && replyTo?.id && (\r\n                      <button onClick={handleGenerateDraft} disabled={generatingDraft}\r\n                        className=\"text-[10px] text-gm-interactive-primary hover:underline flex items-center gap-1 disabled:opacity-50\">\r\n                        {generatingDraft ? <Loader2 className=\"w-3 h-3 animate-spin\" /> : <Sparkles className=\"w-3 h-3\" />} Generate AI Draft\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                  <textarea value={body} onChange={e => setBody(e.target.value)} placeholder=\"Write your message...\"\r\n                    rows={10}\r\n                    className=\"w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus resize-y leading-relaxed\" />\r\n                </div>\r\n\r\n                {aiDraft && (\r\n                  <div className=\"bg-blue-600/5 border border-blue-600/20 rounded-lg p-3\">\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                      <span className=\"text-[10px] uppercase tracking-wider text-gm-interactive-primary font-semibold flex items-center gap-1\"><Sparkles className=\"w-3 h-3\" /> AI Draft</span>\r\n                      <button onClick={handleInsertAiDraft} className=\"text-[10px] px-2 py-0.5 rounded bg-gm-interactive-primary text-gm-text-on-brand hover:bg-gm-interactive-primary-hover\">\r\n                        Use this draft\r\n                      </button>\r\n                    </div>\r\n                    <pre className=\"text-xs text-gm-text-primary whitespace-pre-wrap font-sans\">{aiDraft}</pre>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {inputTab === 'paste' && (\r\n            <div>\r\n              <label className=\"text-xs font-medium text-gm-text-primary mb-2 block\">Paste email content:</label>\r\n              <textarea value={pasteContent} onChange={e => setPasteContent(e.target.value)}\r\n                placeholder={`Paste the full email content here...\\n\\nInclude headers if available:\\nFrom: sender@example.com\\nTo: recipient@example.com\\nSubject: Meeting notes\\nDate: Jan 31, 2026\\n\\nEmail body text...`}\r\n                rows={12}\r\n                className=\"w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-4 py-3 text-sm text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus resize-y font-mono leading-relaxed\" />\r\n              <p className=\"text-[10px] text-gm-text-tertiary mt-1.5\">Include headers (From, To, Subject, Date) for better parsing. AI will analyze and extract entities.</p>\r\n            </div>\r\n          )}\r\n\r\n          {inputTab === 'upload' && (\r\n            <div>\r\n              <div className=\"border-2 border-dashed border-gm-border-primary rounded-xl p-12 text-center hover:border-blue-600/30 transition-colors cursor-pointer bg-[var(--gm-surface-hover)]\"\r\n                onClick={() => fileRef.current?.click()}\r\n                onDragOver={e => e.preventDefault()}\r\n                onDrop={handleFileDrop}>\r\n                <Paperclip className=\"w-12 h-12 mx-auto mb-3 text-gray-600\" />\r\n                <p className=\"text-sm font-medium text-gm-interactive-primary\">Drop email file here</p>\r\n                <p className=\"text-xs text-gm-text-tertiary mt-1\">or click to browse &middot; .eml, .msg</p>\r\n                <input ref={fileRef} type=\"file\" className=\"hidden\" accept=\".eml,.msg\" onChange={e => {\r\n                  if (e.target.files?.[0]) {\r\n                    fileObjRef.current = e.target.files[0];\r\n                    setFileName(e.target.files[0].name);\r\n                  }\r\n                }} />\r\n              </div>\r\n              {fileName && (\r\n                <div className=\"flex items-center gap-3 mt-4 p-3 bg-gm-surface-secondary rounded-lg border border-gm-border-primary\">\r\n                  <div className=\"w-10 h-10 rounded-lg bg-blue-600/10 flex items-center justify-center\">\r\n                    <Paperclip className=\"w-5 h-5 text-gm-interactive-primary\" />\r\n                  </div>\r\n                  <span className=\"text-sm font-medium text-gm-text-primary flex-1 truncate\">{fileName}</span>\r\n                  <button onClick={() => { fileObjRef.current = null; setFileName(''); }} className=\"text-gm-text-tertiary hover:text-gm-status-danger text-lg\">&times;</button>\r\n                </div>\r\n              )}\r\n              <p className=\"text-[10px] text-gm-text-tertiary mt-3\">Email will be parsed, analyzed with AI, and entities extracted automatically.</p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Sprint association for import tabs */}\r\n          {inputTab !== 'compose' && (sprints.data || []).length > 0 && (\r\n            <div>\r\n              <label className=\"text-xs font-medium text-gm-text-primary mb-1.5 block\">Associate with Sprint</label>\r\n              <select value={sprintId} onChange={e => setSprintId(e.target.value)}\r\n                className=\"w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-sm text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus\">\r\n                <option value=\"\">No sprint</option>\r\n                {(sprints.data || []).map((s: { id: string; name: string }) => (\r\n                  <option key={s.id} value={s.id}>{s.name}</option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex items-center justify-end gap-2 px-5 py-3 border-t border-[var(--gm-border-primary)] shrink-0\" style={{ borderColor: 'var(--gm-border-primary)', backgroundColor: 'var(--gm-surface-secondary)' }}>\r\n          <button onClick={handleClose} className=\"px-4 py-2 rounded-lg text-slate-300 text-sm font-medium hover:bg-white/10 border border-white/20 transition-colors\">\r\n            Cancel\r\n          </button>\r\n          <button onClick={handleSend} disabled={sending}\r\n            className=\"px-4 py-2 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-sm font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors\">\r\n            {sending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Send className=\"w-4 h-4\" />}\r\n            {sendLabel}\r\n          </button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nasync function fileToBase64(file: File): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onload = () => resolve((reader.result as string).split(',')[1]);\r\n    reader.onerror = reject;\r\n    reader.readAsDataURL(file);\r\n  });\r\n}\r\n","import { useState, useMemo } from 'react';\nimport {\n  Mail, Loader2, Search, Clock, Star, Plus,\n  ArrowUpRight, ArrowDownLeft, ArrowLeftRight,\n  Sparkles, BarChart3, Eye, EyeOff, Archive,\n} from 'lucide-react';\nimport { toast } from 'sonner';\nimport {\n  useEmails, useEmailStats, useStarEmail, useMarkEmailRead,\n} from '../hooks/useGodMode';\nimport { EmailsSkeleton } from '../components/shared/PageSkeleton';\nimport { cn } from '../lib/utils';\nimport EmailDetail from '../components/emails/EmailDetail';\nimport EmailComposeModal from '../components/emails/EmailComposeModal';\nimport { ErrorState } from '../components/shared/ErrorState';\n\nconst sentimentColor: Record<string, string> = {\n  positive: 'bg-gm-status-success-bg text-gm-status-success',\n  neutral: 'bg-gm-surface-secondary text-gm-text-tertiary',\n  negative: 'bg-gm-status-danger-bg text-gm-status-danger',\n  urgent: 'bg-gm-status-danger-bg text-gm-status-danger',\n};\n\nconst directionIcon: Record<string, typeof ArrowUpRight> = {\n  inbound: ArrowDownLeft,\n  outbound: ArrowUpRight,\n  internal: ArrowLeftRight,\n};\n\ntype ComposeMode = { open: boolean; mode: 'compose' | 'reply' | 'forward'; replyTo: Record<string, unknown> | null };\n\nexport default function EmailsPage() {\n  const [filter, setFilter] = useState<'' | 'needs_response' | 'starred' | 'unread'>('');\n  const [directionFilter, setDirectionFilter] = useState('');\n  const [search, setSearch] = useState('');\n  const [selectedEmail, setSelectedEmail] = useState<Record<string, unknown> | null>(null);\n  const [compose, setCompose] = useState<ComposeMode>({ open: false, mode: 'compose', replyTo: null });\n\n  const emails = useEmails({ requires_response: filter === 'needs_response' ? true : undefined });\n  const emailStats = useEmailStats();\n  const starEmail = useStarEmail();\n  const markRead = useMarkEmailRead();\n\n  const emailList = useMemo(() => {\n    const raw = (emails.data ?? []) as Array<Record<string, unknown>>;\n    if (Array.isArray(raw)) return raw;\n    const obj = raw as Record<string, unknown>;\n    return (obj.emails ?? []) as Array<Record<string, unknown>>;\n  }, [emails.data]);\n\n  const filtered = useMemo(() => {\n    return emailList.filter(e => {\n      if (search && !JSON.stringify(e).toLowerCase().includes(search.toLowerCase())) return false;\n      if (directionFilter && String(e.direction || '') !== directionFilter) return false;\n      if (filter === 'starred' && !e.is_starred) return false;\n      if (filter === 'unread' && e.is_read) return false;\n      return true;\n    });\n  }, [emailList, search, directionFilter, filter]);\n\n  const stats = emailStats.data as Record<string, unknown> | undefined;\n\n  // Detail view (replaces list)\n  if (selectedEmail) {\n    return (\n      <>\n        <EmailDetail\n          email={selectedEmail}\n          onBack={() => setSelectedEmail(null)}\n          onReply={(email) => { setSelectedEmail(null); setCompose({ open: true, mode: 'reply', replyTo: email }); }}\n          onForward={(email) => { setSelectedEmail(null); setCompose({ open: true, mode: 'forward', replyTo: email }); }}\n        />\n        <EmailComposeModal open={compose.open} onClose={() => setCompose({ open: false, mode: 'compose', replyTo: null })} mode={compose.mode} replyTo={compose.replyTo} />\n      </>\n    );\n  }\n\n  const handleStar = (e: React.MouseEvent, id: string, currentlyStarred: boolean) => {\n    e.stopPropagation();\n    starEmail.mutate({ id, starred: !currentlyStarred });\n  };\n\n  const handleSelectEmail = (email: Record<string, unknown>) => {\n    setSelectedEmail(email);\n    if (!email.is_read) markRead.mutate({ id: String(email.id), read: true });\n  };\n\n  const statCards = [\n    { label: 'Total', value: stats?.total ?? 0, color: 'text-gm-text-primary', icon: Mail },\n    { label: 'Unread', value: stats?.unread ?? 0, color: 'text-gm-interactive-primary', icon: Eye },\n    { label: 'Starred', value: stats?.starred ?? 0, color: 'text-yellow-500', icon: Star },\n    { label: 'Needs Response', value: stats?.needing_response ?? 0, color: 'text-gm-status-warning', icon: Clock },\n  ];\n\n  return (\n    <div className=\"p-6 space-y-4\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gm-text-primary\">Emails</h1>\n          <p className=\"text-xs text-gm-text-tertiary mt-0.5\">{filtered.length} email{filtered.length !== 1 ? 's' : ''}</p>\n        </div>\n        <button onClick={() => setCompose({ open: true, mode: 'compose', replyTo: null })}\n          className=\"px-4 py-2 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-sm font-medium hover:bg-gm-interactive-primary-hover flex items-center gap-2 transition-colors\">\n          <Plus className=\"w-4 h-4\" /> Add Email\n        </button>\n      </div>\n\n      {/* Stats */}\n      {stats && (\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n          {statCards.map(s => {\n            const Icon = s.icon;\n            return (\n              <div key={s.label} className=\"bg-gm-surface-primary border border-gm-border-primary rounded-xl px-4 py-3 flex items-center gap-3 hover:border-blue-600/20 transition-colors cursor-pointer\"\n                role=\"button\" tabIndex={0}\n                onClick={() => {\n                  if (s.label === 'Unread') setFilter(filter === 'unread' ? '' : 'unread');\n                  else if (s.label === 'Starred') setFilter(filter === 'starred' ? '' : 'starred');\n                  else if (s.label === 'Needs Response') setFilter(filter === 'needs_response' ? '' : 'needs_response');\n                  else setFilter('');\n                }}>\n                <div className={cn('w-9 h-9 rounded-lg flex items-center justify-center',\n                  s.label === 'Total' ? 'bg-gm-surface-secondary' :\n                  s.label === 'Unread' ? 'bg-blue-600/10' :\n                  s.label === 'Starred' ? 'bg-yellow-500/10' : 'bg-yellow-500/10')}>\n                  <Icon className={cn('w-4.5 h-4.5', s.color)} />\n                </div>\n                <div>\n                  <span className={cn('text-xl font-bold', s.color)}>{String(s.value)}</span>\n                  <p className=\"text-[10px] text-gm-text-tertiary uppercase tracking-wider\">{s.label}</p>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Filters */}\n      <div className=\"flex items-center gap-2 flex-wrap\">\n        <div className=\"relative flex-1 max-w-sm\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gm-text-tertiary\" />\n          <input value={search} onChange={e => setSearch(e.target.value)} placeholder=\"Search emails...\"\n            aria-label=\"Search emails\"\n            className=\"w-full pl-9 pr-3 py-2 bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus\" />\n        </div>\n\n        {[\n          { key: 'needs_response', label: 'Needs Response', icon: Clock, activeColor: 'bg-gm-status-warning-bg border-yellow-500/30 text-gm-status-warning' },\n          { key: 'starred', label: 'Starred', icon: Star, activeColor: 'bg-yellow-500/10 border-yellow-500/30 text-yellow-500' },\n          { key: 'unread', label: 'Unread', icon: Eye, activeColor: 'bg-blue-600/10 border-blue-600/30 text-gm-interactive-primary' },\n        ].map(f => {\n          const FIcon = f.icon;\n          const isActive = filter === f.key;\n          return (\n            <button key={f.key} onClick={() => setFilter(isActive ? '' : f.key as typeof filter)}\n              aria-pressed={isActive}\n              className={cn('px-2.5 py-2 rounded-lg text-xs font-medium transition-colors border flex items-center gap-1.5',\n                isActive ? f.activeColor : 'bg-gm-surface-secondary border-gm-border-primary text-gm-text-tertiary hover:text-gm-text-primary')}>\n              <FIcon className=\"w-3.5 h-3.5\" /> {f.label}\n            </button>\n          );\n        })}\n\n        <select value={directionFilter} onChange={e => setDirectionFilter(e.target.value)}\n          aria-label=\"Filter by direction\"\n          className=\"bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-2 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus\">\n          <option value=\"\">All directions</option>\n          <option value=\"inbound\">Inbound</option>\n          <option value=\"outbound\">Outbound</option>\n          <option value=\"internal\">Internal</option>\n        </select>\n      </div>\n\n      {/* Email List */}\n      {emails.error ? (\n        <ErrorState message=\"Failed to load emails.\" onRetry={() => emails.refetch()} />\n      ) : emails.isLoading ? (\n        <EmailsSkeleton />\n      ) : filtered.length === 0 ? (\n        <div className=\"rounded-xl border border-gm-border-primary bg-gm-surface-primary p-8 text-center text-gm-text-tertiary\">\n          <Mail className=\"h-12 w-12 mx-auto mb-4 text-gray-500\" />\n          {emailList.length === 0 ? \"No emails imported yet. Click 'Add Email' to get started.\" : 'No emails match your filters.'}\n        </div>\n      ) : (\n        <div className=\"space-y-1.5\">\n          {filtered.map((email) => {\n            const isStarred = !!email.is_starred;\n            const isRead = !!email.is_read;\n            const hasDraft = !!email.response_drafted || !!email.draft_response;\n            const isResponded = !!email.response_sent;\n            const hasAi = !!email.ai_summary;\n            const DirIcon = directionIcon[String(email.direction || '')] || null;\n            const subject = String(email.subject || 'No subject');\n            const from = String(email.from || email.from_name || email.sender || '');\n            const date = email.date ? new Date(String(email.date)).toLocaleDateString() : '';\n            const preview = String(email.ai_summary || email.body_text || email.body || '').substring(0, 120);\n\n            return (\n              <div key={String(email.id)}\n                className={cn(\n                  'bg-gm-surface-primary border border-gm-border-primary rounded-xl p-3.5 hover:border-blue-600/30 transition-all cursor-pointer group',\n                  !isRead && 'border-l-[3px] border-l-gm-interactive-primary',\n                )}\n                onClick={() => handleSelectEmail(email)}>\n                <div className=\"flex items-center gap-3\">\n                  {/* Star */}\n                  <button onClick={(e) => handleStar(e, String(email.id), isStarred)} className=\"flex-shrink-0\">\n                    <Star className={cn('w-4 h-4 transition-colors', isStarred ? 'fill-yellow-400 text-yellow-400' : 'text-gray-600 hover:text-yellow-400')} />\n                  </button>\n\n                  {/* Direction icon */}\n                  {DirIcon ? (\n                    <DirIcon className={cn('w-5 h-5 flex-shrink-0', isRead ? 'text-gm-text-tertiary' : 'text-gm-interactive-primary')} />\n                  ) : (\n                    <Mail className={cn('w-5 h-5 flex-shrink-0', isRead ? 'text-gm-text-tertiary' : 'text-gm-interactive-primary')} />\n                  )}\n\n                  {/* Content */}\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <p className={cn('text-sm truncate transition-colors group-hover:text-gm-interactive-primary',\n                        isRead ? 'text-gm-text-primary' : 'text-gm-text-primary font-semibold')}>\n                        {subject}\n                      </p>\n                    </div>\n                    <div className=\"flex items-center gap-2 mt-0.5\">\n                      <span className=\"text-[10px] text-gm-text-tertiary truncate max-w-[200px]\">{from}</span>\n                      {date && <span className=\"text-[10px] text-gm-text-tertiary\">{date}</span>}\n                    </div>\n                    {preview && (\n                      <p className=\"text-[10px] text-gray-400 mt-0.5 truncate\">{preview}</p>\n                    )}\n                  </div>\n\n                  {/* Badges */}\n                  <div className=\"flex items-center gap-1.5 flex-shrink-0 flex-wrap justify-end\">\n                    {email.requires_response && !isResponded && (\n                      <span className=\"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-warning-bg text-gm-status-warning font-medium flex items-center gap-1\">\n                        <Clock className=\"w-3 h-3\" /> Needs Response\n                      </span>\n                    )}\n                    {isResponded && (\n                      <span className=\"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-success-bg text-gm-status-success font-medium\">Responded</span>\n                    )}\n                    {hasDraft && !isResponded && (\n                      <span className=\"text-[10px] px-2 py-0.5 rounded-full bg-blue-600/10 text-gm-interactive-primary font-medium\">Draft</span>\n                    )}\n                    {email.sentiment && (\n                      <span className={cn('text-[10px] px-2 py-0.5 rounded-full font-medium capitalize', sentimentColor[String(email.sentiment)] || sentimentColor.neutral)}>\n                        {String(email.sentiment)}\n                      </span>\n                    )}\n                    {email.ai_category && (\n                      <span className=\"text-[10px] px-2 py-0.5 rounded-full bg-blue-600/10 text-gm-interactive-primary font-medium capitalize\">\n                        {String(email.ai_category)}\n                      </span>\n                    )}\n                    {hasAi && (\n                      <Sparkles className=\"w-3.5 h-3.5 text-blue-500\" />\n                    )}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Compose Modal */}\n      <EmailComposeModal\n        open={compose.open}\n        onClose={() => setCompose({ open: false, mode: 'compose', replyTo: null })}\n        mode={compose.mode}\n        replyTo={compose.replyTo}\n      />\n    </div>\n  );\n}\n"],"names":["__iconNode","ArrowDownLeft","createLucideIcon","ArrowLeftRight","Forward","CARD","BTN_DANGER","BTN_SECONDARY","directionIcon","ArrowUpRight","sentimentConfig","EmailDetail","email","onBack","onReply","onForward","tab","setTab","useState","draftResponse","setDraftResponse","showThread","setShowThread","confirmDelete","setConfirmDelete","deleteEmail","useDeleteEmail","markResponded","useMarkEmailResponded","generateResponse","useGenerateEmailResponse","starEmail","useStarEmail","archiveEmail","useArchiveEmail","markRead","useMarkEmailRead","categorizeEmail","useCategorizeEmail","summarizeEmail","useGenerateEmailSummary","threadId","threadQuery","useEmailThread","threadEmails","useEffect","subject","from","fromEmail","to","cc","date","body","isRead","isStarred","direction","sentiment","intent","aiSummary","requiresResponse","extracted","facts","decisions","risks","actionItems","questions","people","technologies","relationships","keyTopics","attachments","hasAnalysis","hasEntities","hasPeople","DirIcon","sentCfg","handleDelete","toast","handleGenerateResponse","data","tabs","FileText","Brain","Cpu","Contact","jsxs","jsx","ArrowLeft","cn","Clock","Paperclip","Star","EyeOff","Eye","Archive","Icon","Fragment","Sparkles","att","i","formatBytes","Loader2","te","Reply","CheckCircle","r","AnalysisSection","Lightbulb","f","a","d","AlertTriangle","HelpCircle","q","Link2","p","name","avatarSrc","resolveAvatarUrl","isValidAvatarUrl","e","getInitials","CommentsPanel","Trash2","title","color","count","children","bytes","k","sizes","EmailComposeModal","open","onClose","mode","replyTo","isReply","isForward","inputTab","setInputTab","setTo","setCc","setSubject","setBody","pasteContent","setPasteContent","showCc","setShowCc","sending","setSending","fileName","setFileName","fileRef","useRef","fileObjRef","aiDraft","setAiDraft","generatingDraft","setGeneratingDraft","sprintId","setSprintId","sendEmail","useSendEmail","importEmail","useImportEmail","sprints","useSprints","handleClose","handleSend","emailRegex","invalid","file","base64","fileToBase64","isMsg","sprintPayload","handleInsertAiDraft","useCallback","handleGenerateDraft","apiClient","handleFileDrop","sendLabel","inputTabs","Dialog","o","DialogContent","DialogTitle","X","t","ChevronUp","ChevronDown","s","Send","resolve","reject","reader","sentimentColor","EmailsPage","filter","setFilter","directionFilter","setDirectionFilter","search","setSearch","selectedEmail","setSelectedEmail","compose","setCompose","emails","useEmails","emailStats","useEmailStats","emailList","useMemo","raw","filtered","stats","handleStar","id","currentlyStarred","handleSelectEmail","statCards","Mail","Plus","Search","FIcon","isActive","ErrorState","EmailsSkeleton","hasDraft","isResponded","hasAi","preview"],"mappings":"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","x_google_ignoreList":[0,1,2]}