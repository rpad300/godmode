import{c as Ke,r as u,j as e,P as Ne,M as ys,T as we,a as n,f1 as bs,N as C,O as y,a4 as X,f2 as fs,an as Ns,f3 as ws,U as Ve,f4 as ks,f5 as Qe,f6 as Ye,f7 as Xe,f8 as _s,f9 as Ss,ar as je,aq as ce,Z as Ze,a2 as Cs,K as Ps,v as Ts,av as As,C as Je,am as Ds,G as Es,fa as Rs,fb as Ms,fc as Ls,fd as $s,fe as Bs,ff as Os,fg as Is,fh as Fs,fi as zs,aR as Gs,aQ as qs,$ as es,aj as Ws,ak as $e,a3 as Hs,aw as Us}from"./main-BKbBKYvC.js";import{E as Ks}from"./ErrorState-BgEaU0QT.js";import{O as ss}from"./OwnerBadge-DLxZ5hoF.js";import{C as Te}from"./chart-column-WCU8uNwR.js";import{C as Vs}from"./circle-x-DCC498lp.js";import{C as Z}from"./circle-check-big-BfAZDzfZ.js";import{G as Qs}from"./grip-vertical--qLQuYrG.js";import{S as ie}from"./sparkles-BJxATUBg.js";import{T as Ys,a as Xs}from"./thumbs-up-DdLpgcLK.js";import{L as Zs}from"./list-checks-CRGlPMsc.js";import{P as oe}from"./plus-BG5YpVIb.js";import{A as Js}from"./arrow-right-Bzex713W.js";import{C as ke}from"./circle-DnYbs28l.js";import{P as Be}from"./printer-Y5eU2yM0.js";import{A as et}from"./arrow-left-ZBUT7vL6.js";import{P as st}from"./pen-line-jZzzWq6p.js";import{P as tt}from"./play-BOQB2G_-.js";import{S as at}from"./square-PNiTT1An.js";import{C as rt}from"./copy-nMxDZuon.js";import{L as nt}from"./layout-grid-BBa61xmh.js";const it=[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]],lt=Ke("presentation",it);const ct=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 8h7",key:"kbo1nt"}],["path",{d:"M8 12h6",key:"ikassy"}],["path",{d:"M11 16h5",key:"oq65wt"}]],ts=Ke("square-chart-gantt",ct),P="rounded-xl border border-[var(--border-primary)] bg-[var(--surface-primary)] shadow-[var(--shadow-sm)]",G="rounded-xl border border-[var(--border-primary)] bg-[var(--surface-primary)]",ne="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--interactive-primary)] text-[var(--text-on-brand)] hover:bg-[var(--interactive-primary-hover)] transition-colors disabled:opacity-50",B="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--interactive-secondary)] text-[var(--text-primary)] hover:bg-[var(--interactive-secondary-hover)] border border-[var(--border-primary)] transition-colors disabled:opacity-50",Oe="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--status-danger-bg)] text-[var(--status-danger)] hover:opacity-80 transition-colors disabled:opacity-50",T="bg-[var(--bg-tertiary)] border border-[var(--border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--text-primary)] placeholder:text-[var(--text-placeholder)] focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)]/40",L="text-[10px] font-bold text-[var(--accent-primary)] uppercase tracking-[0.1em]",ye={pending:"var(--color-neutral-500, #64748b)",in_progress:"var(--color-brand-500, #3b82f6)",completed:"var(--color-success-500, #22c55e)",overdue:"var(--color-danger-500, #ef4444)",cancelled:"var(--color-neutral-500, #6b7280)",planning:"var(--color-brand-500, #3b82f6)",active:"var(--color-success-500, #22c55e)",done:"var(--color-success-500, #22c55e)"},Ie=["#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981","#06b6d4","#f43f5e","#84cc16","#6366f1","#14b8a6"];function be({title:t,data:o,colorMap:i}){const c=u.useMemo(()=>{const r=Object.entries(o).filter(([,d])=>d>0);return r.length===0?[]:r.map(([d,h],v)=>({label:d,value:h,color:i?.[d]||ye[d]||Ie[v%Ie.length]}))},[o,i]),p=u.useMemo(()=>Math.max(...c.map(r=>r.value),1),[c]),a=u.useMemo(()=>c.reduce((r,d)=>r+d.value,0),[c]);return c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-6 text-[var(--text-tertiary)]",children:[e.jsx(Te,{className:"w-6 h-6 mb-1.5 opacity-40"}),e.jsx("p",{className:"text-[10px]",children:"No data available"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:L,children:t}),e.jsxs("span",{className:"text-[10px] text-[var(--text-tertiary)]",children:[a," total"]})]}),e.jsx("div",{className:"space-y-2",children:c.map(r=>{const d=Math.round(r.value/p*100),h=Math.round(r.value/a*100);return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("span",{className:"text-xs text-[var(--text-secondary)] capitalize truncate max-w-[60%]",children:r.label.replace(/_/g," ")}),e.jsxs("span",{className:"text-[10px] text-[var(--text-tertiary)] tabular-nums",children:[r.value," (",h,"%)"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-[var(--surface-hover)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${d}%`,backgroundColor:r.color}})})]},r.label)})})]})}function Fe({dailyProgress:t,totalTasks:o,totalPoints:i,usePoints:c=!1}){const p=c?i:o,a=u.useMemo(()=>t?.length?t.map((b,S)=>({...b,remaining:c?b.remaining_points:b.remaining_tasks,idealRemaining:p-p/(t.length-1)*S})):[],[t,p,c]);if(a.length<2)return e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-[var(--text-tertiary)]",children:[e.jsx(Ne,{className:"w-8 h-8 mb-2 opacity-40"}),e.jsx("p",{className:"text-xs",children:"Burndown data will appear as tasks are completed"})]});const r=Math.max(p,...a.map(b=>b.remaining)),d=160,h=100,v=b=>b/(a.length-1)*h,_=b=>d-b/(r||1)*d,f=a.map((b,S)=>`${S===0?"M":"L"}${v(S).toFixed(1)},${_(b.remaining).toFixed(1)}`).join(" "),l=a.map((b,S)=>`${S===0?"M":"L"}${v(S).toFixed(1)},${_(b.idealRemaining).toFixed(1)}`).join(" "),N=f+` L${h},${d} L0,${d} Z`,m=(()=>{const b=new Date().toISOString().slice(0,10),S=a.findIndex(F=>F.date>=b);return S>=0?S:a.length-1})(),j=u.useMemo(()=>{if(a.length<=7)return a.map(S=>S.date.slice(5));const b=Math.ceil(a.length/6);return a.map((S,F)=>F%b===0||F===a.length-1?S.date.slice(5):"")},[a]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:L,children:["Burndown (",c?"Points":"Tasks",")"]}),e.jsxs("span",{className:"text-[10px] text-[var(--text-tertiary)]",children:[a[m]?.remaining??0," remaining of ",p]})]}),e.jsx("div",{className:"relative",style:{paddingBottom:"45%"},children:e.jsxs("svg",{viewBox:`-4 -4 ${h+8} ${d+24}`,className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none",children:[[0,.25,.5,.75,1].map(b=>e.jsx("line",{x1:"0",y1:_(r*b),x2:h,y2:_(r*b),stroke:"var(--surface-hover)",strokeWidth:"0.3"},b)),e.jsx("path",{d:N,fill:"rgba(59,130,246,0.08)"}),e.jsx("path",{d:l,fill:"none",stroke:"var(--border-secondary)",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("path",{d:f,fill:"none",stroke:"var(--color-brand-500, #3b82f6)",strokeWidth:"1",strokeLinejoin:"round"}),m<a.length&&e.jsx("line",{x1:v(m),y1:"0",x2:v(m),y2:d,stroke:"rgba(250,204,21,0.3)",strokeWidth:"0.5",strokeDasharray:"1.5,1.5"}),e.jsx("circle",{cx:v(m),cy:_(a[m]?.remaining??0),r:"2",fill:"var(--color-brand-500, #3b82f6)"}),j.map((b,S)=>b?e.jsx("text",{x:v(S),y:d+10,textAnchor:"middle",className:"fill-[var(--text-tertiary)]",fontSize:"3.5",children:b},S):null)]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 justify-center",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[9px] text-[var(--text-tertiary)]",children:[e.jsx("span",{className:"w-3 h-0.5 bg-[var(--color-brand-500)] rounded"})," Actual"]}),e.jsxs("span",{className:"flex items-center gap-1 text-[9px] text-[var(--text-tertiary)]",children:[e.jsx("span",{className:"w-3 h-0.5 bg-[var(--border-secondary)] rounded border-dashed"})," Ideal"]})]})]})}function ot({history:t}){const o=u.useMemo(()=>t?.length?t.slice(-8):[],[t]),i=u.useMemo(()=>o.length?Math.round(o.reduce((p,a)=>p+a.completed_points,0)/o.length):0,[o]),c=u.useMemo(()=>Math.max(...o.map(p=>Math.max(p.total_points,p.completed_points)),1),[o]);return o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-[var(--text-tertiary)]",children:[e.jsx(Te,{className:"w-8 h-8 mb-2 opacity-40"}),e.jsx("p",{className:"text-xs",children:"Velocity data builds as you complete sprints"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:L,children:"Velocity"}),e.jsxs("span",{className:"text-[10px] text-[var(--text-tertiary)]",children:["Avg: ",i," pts/sprint"]})]}),e.jsx("div",{className:"flex items-end gap-1.5",style:{height:100},children:o.map((p,a)=>{const r=p.total_points/c*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-0.5 group relative",children:[e.jsx("div",{className:"w-full flex flex-col items-center justify-end",style:{height:80},children:e.jsxs("div",{className:"w-full rounded-t relative overflow-hidden",style:{height:`${r}%`,minHeight:2},children:[e.jsx("div",{className:"absolute inset-0 bg-[var(--surface-hover)] rounded-t"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-[var(--color-brand-500)]/80 rounded-t transition-all",style:{height:`${p.total_points>0?p.completed_points/p.total_points*100:0}%`}})]})}),e.jsx("span",{className:"text-[8px] text-[var(--text-tertiary)] truncate max-w-full text-center leading-tight",title:p.sprint_name,children:p.sprint_name.length>8?p.sprint_name.slice(0,7)+"…":p.sprint_name}),e.jsxs("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 bg-[var(--bg-elevated)] border border-[var(--border-primary)] rounded px-1.5 py-0.5 text-[8px] text-[var(--text-primary)] whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:[p.completed_points,"/",p.total_points," pts"]})]},a)})}),i>0&&e.jsxs("div",{className:"mt-2 h-px w-full relative",children:[e.jsx("div",{className:"absolute inset-x-0 border-t border-dashed border-[var(--status-warning)]/30"}),e.jsx("span",{className:"absolute right-0 -top-2 text-[8px] text-[var(--status-warning)]/60",children:"avg"})]})]})}const ze={low:{color:"text-[var(--status-success)]",bg:"bg-[var(--status-success-bg)]",border:"border-[var(--status-success)]/30",icon:Z,label:"Healthy"},medium:{color:"text-[var(--status-warning)]",bg:"bg-[var(--status-warning-bg)]",border:"border-[var(--status-warning)]/30",icon:we,label:"At Risk"},high:{color:"text-orange-400",bg:"bg-orange-500/10",border:"border-orange-500/30",icon:ys,label:"High Risk"},critical:{color:"text-[var(--status-danger)]",bg:"bg-[var(--status-danger-bg)]",border:"border-[var(--status-danger)]/30",icon:Vs,label:"Critical"}},dt={completion_rate:"Completion",time_progress:"Time Elapsed",velocity_trend:"Velocity",overdue_ratio:"On-time",distribution_balance:"Balance"};function Ge({score:t,size:o=64,strokeWidth:i=5,color:c}){const p=(o-i)/2,a=2*Math.PI*p,r=a-t/100*a;return e.jsxs("svg",{width:o,height:o,className:"transform -rotate-90",children:[e.jsx("circle",{cx:o/2,cy:o/2,r:p,fill:"none",stroke:"var(--surface-hover)",strokeWidth:i}),e.jsx("circle",{cx:o/2,cy:o/2,r:p,fill:"none",stroke:c,strokeWidth:i,strokeDasharray:a,strokeDashoffset:r,strokeLinecap:"round",className:"transition-all duration-700 ease-out"})]})}function qe({health:t,isLoading:o,compact:i}){if(o)return e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(Ne,{className:"w-5 h-5 text-[var(--text-tertiary)] animate-pulse"})});if(!t)return null;const c=ze[t.risk_level]||ze.medium,p=c.icon,a=t.score>=75?"#22c55e":t.score>=50?"#eab308":t.score>=25?"#f97316":"#ef4444";return i?e.jsxs("div",{className:n("flex items-center gap-2 px-2.5 py-1.5 rounded-lg border",c.bg,c.border),children:[e.jsxs("div",{className:"relative w-8 h-8",children:[e.jsx(Ge,{score:t.score,size:32,strokeWidth:3,color:a}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[9px] font-bold",style:{color:a},children:t.score})]}),e.jsxs("div",{children:[e.jsx("span",{className:n("text-[10px] font-medium",c.color),children:c.label}),t.alerts.length>0&&e.jsx("p",{className:"text-[9px] text-[var(--text-tertiary)] truncate max-w-[140px]",children:t.alerts[0]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:L,children:"Sprint Health"}),e.jsxs("div",{className:n("flex items-center gap-1 text-[10px] font-medium px-2 py-0.5 rounded-full border",c.bg,c.color,c.border),children:[e.jsx(p,{className:"w-3 h-3"})," ",c.label]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-16 h-16 shrink-0",children:[e.jsx(Ge,{score:t.score,size:64,strokeWidth:5,color:a}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-lg font-bold",style:{color:a},children:t.score})]}),e.jsx("div",{className:"flex-1 space-y-1.5",children:Object.entries(t.factors).map(([r,d])=>{const v=r==="overdue_ratio"?100-d:d,_=v>=70?"#22c55e":v>=40?"#eab308":"#ef4444";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[9px] mb-0.5",children:[e.jsx("span",{className:"text-[var(--text-tertiary)]",children:dt[r]||r}),e.jsxs("span",{className:"text-[var(--text-secondary)] tabular-nums",children:[v,"%"]})]}),e.jsx("div",{className:"h-1 rounded-full bg-[var(--surface-hover)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${v}%`,backgroundColor:_}})})]},r)})})]}),t.alerts.length>0&&e.jsx("div",{className:"space-y-1",children:t.alerts.map((r,d)=>e.jsxs("div",{className:"flex items-start gap-1.5 text-[10px] text-[var(--status-warning)]",children:[e.jsx(we,{className:"w-3 h-3 shrink-0 mt-0.5"}),e.jsx("span",{children:r})]},d))})]})}const xt=[{id:"pending",label:"To Do",color:"border-[var(--text-tertiary)]/30",dotColor:"bg-[var(--text-tertiary)]"},{id:"in_progress",label:"In Progress",color:"border-[var(--status-info)]/30",dotColor:"bg-[var(--status-info)]"},{id:"overdue",label:"Overdue",color:"border-[var(--status-danger)]/30",dotColor:"bg-[var(--status-danger)]"},{id:"completed",label:"Done",color:"border-[var(--status-success)]/30",dotColor:"bg-[var(--status-success)]"}];function mt({actions:t,onStatusChange:o}){const[i,c]=u.useState(null),[p,a]=u.useState(null),r=u.useCallback((l,N)=>{c(N),l.dataTransfer.effectAllowed="move",l.dataTransfer.setData("text/plain",N),l.currentTarget.style.opacity="0.4"},[]),d=u.useCallback(l=>{l.currentTarget.style.opacity="1",c(null),a(null)},[]),h=u.useCallback((l,N)=>{l.preventDefault(),l.dataTransfer.dropEffect="move",a(N)},[]),v=u.useCallback(()=>{a(null)},[]),_=u.useCallback((l,N)=>{l.preventDefault();const m=l.dataTransfer.getData("text/plain");if(m){const j=t.find(b=>b.id===m);j&&j.status!==N&&o(m,N)}c(null),a(null)},[t,o]),f=l=>l==="high"?"bg-[var(--status-danger)]":l==="medium"?"bg-[var(--status-warning)]":"bg-[var(--text-tertiary)]";return e.jsxs("div",{children:[e.jsx("span",{className:n(L,"block mb-3"),children:"Kanban Board"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:xt.map(l=>{const N=t.filter(j=>j.status===l.id),m=p===l.id;return e.jsxs("div",{onDragOver:j=>h(j,l.id),onDragLeave:v,onDrop:j=>_(j,l.id),className:n("rounded-xl border bg-[var(--surface-secondary)] min-h-[200px] transition-colors",l.color,m&&"border-[var(--accent-primary)]/50 bg-[var(--status-info-bg)]"),children:[e.jsxs("div",{className:"px-3 py-2 border-b border-[var(--border-primary)] flex items-center gap-2",children:[e.jsx("span",{className:n("w-2 h-2 rounded-full",l.dotColor)}),e.jsx("span",{className:"text-xs font-medium text-[var(--text-primary)]",children:l.label}),e.jsx("span",{className:"text-[10px] text-[var(--text-tertiary)] ml-auto",children:N.length})]}),e.jsxs("div",{className:"p-2 space-y-1.5",children:[N.map(j=>e.jsx("div",{draggable:!0,onDragStart:b=>r(b,j.id),onDragEnd:d,className:n("bg-[var(--surface-primary)] border border-[var(--border-primary)] rounded-lg p-2.5 cursor-grab active:cursor-grabbing hover:border-[var(--accent-primary)]/30 transition-colors group",i===j.id&&"opacity-40"),children:e.jsxs("div",{className:"flex items-start gap-1.5",children:[e.jsx(Qs,{className:"w-3 h-3 text-[var(--text-tertiary)] opacity-0 group-hover:opacity-100 transition-opacity shrink-0 mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-[11px] font-medium text-[var(--text-primary)] line-clamp-2 leading-tight",children:j.task||j.title||"(untitled)"}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[j.priority&&e.jsx("span",{className:n("w-1.5 h-1.5 rounded-full shrink-0",f(j.priority)),title:j.priority}),j.task_points!=null&&e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-[var(--status-info-bg)] text-[var(--accent-primary)] tabular-nums",children:j.task_points}),j.owner&&e.jsx(ss,{name:j.owner,size:"sm"})]})]})]})},j.id)),N.length===0&&e.jsx("p",{className:"text-[10px] text-[var(--text-tertiary)] text-center py-6",children:m?"Drop here":"No tasks"})]})]},l.id)})})]})}const pt=t=>ye[t]||ye.pending;function ut({actions:t,sprintStart:o,sprintEnd:i}){const c=u.useMemo(()=>{const r=new Date(o).getTime(),d=new Date(i).getTime(),h=Math.max(1,d-r);return t.slice(0,20).map(v=>{const _=v.created_at?new Date(v.created_at).getTime():r,f=v.deadline?new Date(v.deadline).getTime():d,l=Math.max(0,Math.min(100,(_-r)/h*100)),N=Math.max(2,Math.min(100-l,(f-_)/h*100)),m=(v.depends_on?.length??0)>0;return{action:v,left:l,width:N,hasDeps:m}})},[t,o,i]),p=u.useMemo(()=>{const r=new Date(o).getTime(),d=new Date(i).getTime(),h=Date.now();return Math.max(0,Math.min(100,(h-r)/(d-r)*100))},[o,i]),a=u.useMemo(()=>{const r=new Date(o),h=(new Date(i).getTime()-r.getTime())/864e5,v=Math.max(1,Math.ceil(h/6)),_=[];for(let f=0;f<=h;f+=v){const l=new Date(r.getTime()+f*864e5);_.push({label:`${l.getMonth()+1}/${l.getDate()}`,pct:f/h*100})}return _},[o,i]);return c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-[var(--text-tertiary)]",children:[e.jsx(ts,{className:"w-8 h-8 mb-2 opacity-40"}),e.jsx("p",{className:"text-xs",children:"No tasks to display on the timeline"})]}):e.jsxs("div",{children:[e.jsx("span",{className:n(L,"block mb-3"),children:"Timeline"}),e.jsx("div",{className:"relative h-5 mb-1",children:a.map((r,d)=>e.jsx("span",{className:"absolute text-[8px] text-[var(--text-tertiary)] -translate-x-1/2",style:{left:`${r.pct}%`},children:r.label},d))}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-[var(--status-warning)]/30 z-10",style:{left:`${p}%`}}),e.jsx("div",{className:"space-y-1",children:c.map(({action:r,left:d,width:h,hasDeps:v})=>e.jsxs("div",{className:"flex items-center gap-2 group h-7",children:[e.jsxs("div",{className:"w-24 shrink-0 truncate text-[10px] text-[var(--text-secondary)] pr-1",title:r.task||r.title,children:[(r.task||r.title||"").slice(0,18),(r.task||"").length>18?"…":""]}),e.jsxs("div",{className:"flex-1 relative h-full",children:[e.jsx("div",{className:"absolute inset-0 bg-[var(--surface-secondary)] rounded"}),e.jsx("div",{className:n("absolute h-4 top-1.5 rounded-sm transition-all cursor-default",v&&"ring-1 ring-purple-500/40"),style:{left:`${d}%`,width:`${h}%`,backgroundColor:pt(r.status),opacity:r.status==="completed"?.6:.8},title:`${r.task||r.title} (${r.status})${r.owner?` — ${r.owner}`:""}`})]})]},r.id))})]}),e.jsx("div",{className:"flex items-center gap-3 mt-2 justify-center",children:[{label:"Pending",key:"pending"},{label:"In Progress",key:"in_progress"},{label:"Completed",key:"completed"},{label:"Overdue",key:"overdue"}].map(r=>e.jsxs("span",{className:"flex items-center gap-1 text-[8px] text-[var(--text-tertiary)]",children:[e.jsx("span",{className:"w-2 h-2 rounded-sm",style:{backgroundColor:ye[r.key]}})," ",r.label]},r.label))})]})}function Pe({items:t,onAdd:o,onRemove:i,placeholder:c,color:p}){const[a,r]=u.useState(""),d=()=>{a.trim()&&(o(a.trim()),r(""))};return e.jsxs("div",{className:"space-y-1.5",children:[t.map((h,v)=>e.jsxs("div",{className:"flex items-start gap-2 group",children:[e.jsx("span",{className:n("w-1.5 h-1.5 rounded-full mt-1.5 shrink-0",p)}),e.jsx("span",{className:"text-xs text-[var(--text-secondary)] flex-1",children:h}),e.jsx("button",{onClick:()=>i(v),className:"text-[var(--text-tertiary)] hover:text-[var(--status-danger)] opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(X,{className:"w-3 h-3"})})]},v)),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("input",{value:a,onChange:h=>r(h.target.value),onKeyDown:h=>h.key==="Enter"&&d(),className:n(T,"w-full"),placeholder:c}),e.jsx("button",{onClick:d,className:"shrink-0 w-7 h-7 rounded-lg bg-[var(--surface-secondary)] hover:bg-[var(--surface-hover)] flex items-center justify-center",children:e.jsx(oe,{className:"w-3.5 h-3.5 text-[var(--text-tertiary)]"})})]})]})}function ht({sprintId:t}){const o=bs(),[i,c]=u.useState([]),[p,a]=u.useState([]),[r,d]=u.useState([]),[h,v]=u.useState(""),_=()=>{o.mutate({sprintId:t,went_well:i,went_wrong:p,action_items:r},{onSuccess:f=>{v(f?.ai_suggestions||""),y.success("Retrospective generated")},onError:f=>y.error(f.message)})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:L,children:"Sprint Retrospective"}),e.jsxs("button",{onClick:_,disabled:o.isPending,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-purple-500/10 text-purple-400 hover:bg-purple-500/20 disabled:opacity-50",children:[o.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"}),"AI Insights"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:n(G,"p-3"),children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(Ys,{className:"w-3.5 h-3.5 text-[var(--status-success)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--status-success)]",children:"What Went Well"})]}),e.jsx(Pe,{items:i,onAdd:f=>c(l=>[...l,f]),onRemove:f=>c(l=>l.filter((N,m)=>m!==f)),placeholder:"Add positive...",color:"bg-[var(--status-success)]"})]}),e.jsxs("div",{className:n(G,"p-3"),children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(Xs,{className:"w-3.5 h-3.5 text-[var(--status-danger)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--status-danger)]",children:"What Needs Improvement"})]}),e.jsx(Pe,{items:p,onAdd:f=>a(l=>[...l,f]),onRemove:f=>a(l=>l.filter((N,m)=>m!==f)),placeholder:"Add improvement...",color:"bg-[var(--status-danger)]"})]}),e.jsxs("div",{className:n(G,"p-3"),children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(Zs,{className:"w-3.5 h-3.5 text-[var(--accent-primary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--accent-primary)]",children:"Action Items"})]}),e.jsx(Pe,{items:r,onAdd:f=>d(l=>[...l,f]),onRemove:f=>d(l=>l.filter((N,m)=>m!==f)),placeholder:"Add action item...",color:"bg-[var(--accent-primary)]"})]})]}),h&&e.jsxs("div",{className:n(G,"p-4"),children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Insights"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--text-secondary)] whitespace-pre-wrap leading-relaxed",children:h})]})]})}function vt({sprintId:t}){const o=fs(),[i,c]=u.useState(null),p=()=>{o.mutate(t,{onSuccess:a=>{c(a),y.success("Standup generated")},onError:a=>y.error(a.message)})};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:L,children:"Daily Standup"}),e.jsxs("button",{onClick:p,disabled:o.isPending,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-purple-500/10 text-purple-400 hover:bg-purple-500/20 disabled:opacity-50",children:[o.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"}),"Generate Standup"]})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-[10px] text-[var(--text-tertiary)]",children:i.date}),i.ai_summary&&e.jsxs("div",{className:n(G,"p-3"),children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Summary"}),e.jsx("p",{className:"mt-1 text-xs text-[var(--text-secondary)] whitespace-pre-wrap",children:i.ai_summary})]}),e.jsx("div",{className:"space-y-2",children:(i.entries||[]).map((a,r)=>e.jsxs("div",{className:n(G,"p-3"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ns,{className:"w-3.5 h-3.5 text-[var(--accent-primary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--text-primary)]",children:a.person})]}),e.jsxs("div",{className:"space-y-1.5 pl-5",children:[a.done.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] text-[var(--status-success)] uppercase tracking-wider font-medium",children:"Done"}),a.done.map((d,h)=>e.jsxs("div",{className:"flex items-start gap-1.5 mt-0.5",children:[e.jsx(Z,{className:"w-3 h-3 text-[var(--status-success)] shrink-0 mt-0.5"}),e.jsx("span",{className:"text-[11px] text-[var(--text-secondary)]",children:d})]},h))]}),a.doing.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] text-[var(--accent-primary)] uppercase tracking-wider font-medium",children:"Doing"}),a.doing.map((d,h)=>e.jsxs("div",{className:"flex items-start gap-1.5 mt-0.5",children:[e.jsx(Js,{className:"w-3 h-3 text-[var(--accent-primary)] shrink-0 mt-0.5"}),e.jsx("span",{className:"text-[11px] text-[var(--text-secondary)]",children:d})]},h))]}),a.blockers.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] text-[var(--status-danger)] uppercase tracking-wider font-medium",children:"Blockers"}),a.blockers.map((d,h)=>e.jsxs("div",{className:"flex items-start gap-1.5 mt-0.5",children:[e.jsx(we,{className:"w-3 h-3 text-[var(--status-danger)] shrink-0 mt-0.5"}),e.jsx("span",{className:"text-[11px] text-[var(--text-secondary)]",children:d})]},h))]}),a.done.length===0&&a.doing.length===0&&a.blockers.length===0&&e.jsx("span",{className:"text-[10px] text-[var(--text-tertiary)]",children:"No updates"})]})]},r))})]}),!i&&!o.isPending&&e.jsx("p",{className:"text-xs text-[var(--text-tertiary)] text-center py-4",children:`Click "Generate Standup" to get today's team summary`})]})}function gt({sprintId:t,actions:o}){const i=ws(),[c,p]=u.useState({}),[a,r]=u.useState(null),[d,h]=u.useState(""),[v,_]=u.useState(""),f=u.useMemo(()=>{const m=new Set;return o.forEach(j=>{j.owner?.trim()&&m.add(j.owner.trim())}),Object.keys(c).forEach(j=>m.add(j)),Array.from(m).sort()},[o,c]),l=()=>{!d.trim()||!v||(p(m=>({...m,[d.trim()]:Number(v)||0})),h(""),_(""))},N=()=>{if(Object.keys(c).length===0){y.error("Set capacity for at least one person");return}i.mutate({sprintId:t,capacities:c},{onSuccess:m=>{r(m),y.success("Capacity analysis complete")},onError:m=>y.error(m.message)})};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:L,children:"Capacity Planning"}),e.jsxs("button",{onClick:N,disabled:i.isPending,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-purple-500/10 text-purple-400 hover:bg-purple-500/20 disabled:opacity-50",children:[i.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"}),"Analyze Capacity"]})]}),e.jsxs("div",{className:n(G,"p-3 space-y-2"),children:[e.jsx("span",{className:"text-[10px] text-[var(--text-tertiary)] uppercase tracking-wider",children:"Team Capacity (points per sprint)"}),f.map(m=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-3 h-3 text-[var(--text-tertiary)]"}),e.jsx("span",{className:"text-xs text-[var(--text-primary)] flex-1 truncate",children:m}),e.jsx("input",{type:"number",min:"0",value:c[m]??"",onChange:j=>p(b=>({...b,[m]:Number(j.target.value)||0})),placeholder:"pts",className:n(T,"w-16 text-center")}),c[m]!==void 0&&e.jsx("button",{onClick:()=>p(j=>{const b={...j};return delete b[m],b}),className:"text-[var(--text-tertiary)] hover:text-[var(--status-danger)]",children:e.jsx(X,{className:"w-3 h-3"})})]},m)),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsx("input",{value:d,onChange:m=>h(m.target.value),placeholder:"Name",className:n(T,"flex-1")}),e.jsx("input",{type:"number",min:"0",value:v,onChange:m=>_(m.target.value),placeholder:"pts",className:n(T,"w-16 text-center"),onKeyDown:m=>m.key==="Enter"&&l()}),e.jsx("button",{onClick:l,className:"w-7 h-7 rounded-lg bg-[var(--surface-secondary)] hover:bg-[var(--surface-hover)] flex items-center justify-center",children:e.jsx(oe,{className:"w-3.5 h-3.5 text-[var(--text-tertiary)]"})})]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:a.capacity.map(m=>{const j=m.utilization,b=m.over_allocated?"#ef4444":j>80?"#f59e0b":"#22c55e",S=Math.min(100,j);return e.jsxs("div",{className:n(G,"p-3"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--text-primary)]",children:m.person}),e.jsxs("span",{className:"text-[10px] tabular-nums",style:{color:b},children:[m.assigned_points,"/",m.available_points," pts (",j,"%)"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-[var(--surface-hover)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${S}%`,backgroundColor:b}})}),m.over_allocated&&e.jsxs("p",{className:"text-[9px] text-[var(--status-danger)] mt-1",children:["Over-allocated by ",m.assigned_points-m.available_points," points"]})]},m.person)})}),a.ai_recommendation&&e.jsxs("div",{className:n(G,"p-4"),children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Recommendation"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--text-secondary)] whitespace-pre-wrap leading-relaxed",children:a.ai_recommendation})]})]})]})}function jt({sprintId:t,taskDescription:o,onEstimate:i,className:c}){const p=ks(),[a,r]=u.useState(null),d=()=>{if(!o.trim()){y.error("Task description needed");return}p.mutate({sprintId:t,task:o},{onSuccess:v=>{r(v),i?.(v.points),y.success(`Estimated: ${v.points} points (${v.confidence} confidence)`)},onError:v=>y.error(v.message)})},h=a?.confidence==="high"?"text-[var(--status-success)]":a?.confidence==="medium"?"text-[var(--status-warning)]":"text-orange-400";return e.jsxs("div",{className:n("inline-flex items-center gap-2",c),children:[e.jsxs("button",{onClick:d,disabled:p.isPending,className:"inline-flex items-center gap-1 px-2 py-1 text-[10px] font-medium rounded-md bg-purple-500/10 text-purple-400 hover:bg-purple-500/20 disabled:opacity-50 transition-colors",title:"AI estimate story points",children:[p.isPending?e.jsx(C,{className:"w-3 h-3 animate-spin"}):e.jsx(ie,{className:"w-3 h-3"}),"Estimate"]}),a&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs font-bold text-[var(--accent-primary)] tabular-nums",children:[a.points," pts"]}),e.jsxs("span",{className:n("text-[9px]",h),children:["(",a.confidence,")"]}),a.reasoning&&e.jsx("span",{className:"text-[9px] text-[var(--text-tertiary)] max-w-[200px] truncate",title:a.reasoning,children:a.reasoning})]})]})}const K=G,re="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg disabled:opacity-50 transition-colors",We=[{key:"sprint_report_style_corporate_classic",label:"Corporate Classic"},{key:"sprint_report_style_modern_minimal",label:"Modern Minimal"},{key:"sprint_report_style_startup_tech",label:"Startup Tech"},{key:"sprint_report_style_consultancy",label:"Consultancy"}];function He(t,o){const i=new Blob([t],{type:"text/html"}),c=URL.createObjectURL(i),p=document.createElement("a");p.href=c,p.download=o,p.click(),URL.revokeObjectURL(c)}function ge(t){const o=new Blob([t],{type:"text/html"}),i=URL.createObjectURL(o),c=window.open(i,"_blank");c&&c.addEventListener("load",()=>{setTimeout(()=>c.print(),600)})}function yt({open:t,onClose:o,sprint:i}){const{data:c,isLoading:p}=Qe(t?i.id:null),a=Ye(),r=Xe(),d=_s(),h=Ss();u.useEffect(()=>{if(!t)return;const x=q=>{q.key==="Escape"&&o()};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[t,o]);const[v,_]=u.useState(""),[f,l]=u.useState(""),[N,m]=u.useState(!0),[j,b]=u.useState(!0),[S,F]=u.useState(We[0].key),[O,J]=u.useState(null),[H,ee]=u.useState(null),A=c,V=A?.actions??[],le=A?.breakdown??{by_status:{},by_assignee:{}},M=A?.graph_context,$=A?.total_tasks??V.length,Q=A?.completed_tasks??V.filter(x=>x.status==="completed").length,D=A?.total_task_points??0,se=A?.completed_task_points??0,te=$>0?Math.round(Q/$*100):0,de=()=>{a.mutate(i.id,{onSuccess:x=>{_(x?.ai_analysis||x?.analysis||""),y.success("Analysis complete")},onError:x=>y.error(x.message)})},ae=()=>{r.mutate(i.id,{onSuccess:x=>{l(x?.business_report||x?.summary||""),y.success("Business report ready")},onError:x=>y.error(x.message)})},xe=()=>{d.mutate({sprintId:i.id,style:S,include_analysis:N,include_business:j},{onSuccess:x=>{x?.html&&(J(x.html),He(x.html,`sprint-${i.name||i.id}-report.html`),y.success("Document downloaded"))},onError:x=>y.error(x.message)})},me=()=>{h.mutate({sprintId:i.id,include_analysis:N,include_business:j},{onSuccess:x=>{x?.html&&(ee(x.html),He(x.html,`sprint-${i.name||i.id}-presentation.html`),y.success("Presentation downloaded"))},onError:x=>y.error(x.message)})},_e=()=>{O?ge(O):d.mutate({sprintId:i.id,style:S,include_analysis:N,include_business:j},{onSuccess:x=>{x?.html&&(J(x.html),ge(x.html))},onError:x=>y.error(x.message)})},pe=()=>{H?ge(H):h.mutate({sprintId:i.id,include_analysis:N,include_business:j},{onSuccess:x=>{x?.html&&(ee(x.html),ge(x.html))},onError:x=>y.error(x.message)})};return e.jsx(je,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-[var(--bg-overlay)] backdrop-blur-sm z-50",onClick:o}),e.jsx(ce.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{role:"dialog","aria-modal":"true","aria-label":`Sprint Report – ${i.name}`,className:"bg-[var(--bg-elevated)] border border-[var(--border-primary)] rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",style:{backgroundColor:"var(--bg-elevated)",color:"var(--text-primary)"},onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--border-primary)] shrink-0",style:{background:"linear-gradient(to right, rgba(37,99,235,0.18), rgba(37,99,235,0.05))"},children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--text-primary)]",children:"Sprint Report"}),e.jsx("p",{className:"text-xs text-[var(--text-tertiary)]",children:i.name})]}),e.jsx("button",{onClick:o,"aria-label":"Close report",className:"w-8 h-8 rounded-lg hover:bg-[var(--surface-hover)] flex items-center justify-center",children:e.jsx(X,{className:"w-4 h-4 text-[var(--text-tertiary)]"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-5",children:p?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-[var(--accent-primary)]"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{label:"Total Tasks",value:$,sub:""},{label:"Completed",value:Q,sub:`${te}%`},{label:"Total Points",value:D,sub:""},{label:"Done Points",value:se,sub:D>0?`${Math.round(se/D*100)}%`:""}].map(x=>e.jsxs("div",{className:n(K,"p-3 text-center"),children:[e.jsx("p",{className:"text-2xl font-bold text-[var(--text-primary)]",children:x.value}),e.jsx("p",{className:"text-[10px] text-[var(--text-tertiary)] uppercase tracking-wider",children:x.label}),x.sub&&e.jsx("p",{className:"text-xs text-[var(--accent-primary)] mt-0.5",children:x.sub})]},x.label))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:n(K,"p-4"),children:e.jsx(be,{title:"By Status",data:le.by_status})}),e.jsx("div",{className:n(K,"p-4"),children:e.jsx(be,{title:"By Assignee",data:le.by_assignee})})]}),M&&(M.assignees?.length||M.sprint_name)&&e.jsxs("div",{className:n(K,"p-4"),children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"Graph Context"}),e.jsxs("div",{className:"mt-2 space-y-1.5",children:[M.sprint_name&&e.jsxs("p",{className:"text-xs text-[var(--text-secondary)]",children:[e.jsx("span",{className:"text-[var(--text-tertiary)]",children:"Sprint node:"})," ",M.sprint_name,M.sprint_context&&e.jsxs("span",{className:"text-[var(--text-tertiary)]",children:[" — ",M.sprint_context]})]}),M.assignees&&M.assignees.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx("span",{className:"text-[10px] text-[var(--text-tertiary)]",children:"Assignees:"}),M.assignees.map(x=>e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-purple-500/10 text-purple-400",children:x},x))]})]})]}),V.length>0&&e.jsxs("div",{className:n(K,"p-4"),children:[e.jsxs("span",{className:"text-[10px] font-bold text-[var(--accent-primary)] uppercase tracking-[0.1em]",children:["Tasks (",V.length,")"]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-48 overflow-y-auto",children:V.map(x=>{const q=x.status==="completed";return e.jsxs("div",{className:"flex items-center gap-2 py-1 px-2 rounded hover:bg-[var(--surface-hover)]",children:[q?e.jsx(Z,{className:"w-3.5 h-3.5 text-[var(--status-success)] shrink-0"}):e.jsx(ke,{className:"w-3.5 h-3.5 text-[var(--text-tertiary)] shrink-0"}),e.jsx("span",{className:n("text-xs flex-1 truncate",q?"line-through text-[var(--text-tertiary)]":"text-[var(--text-primary)]"),children:x.task||x.title||"(untitled)"}),x.owner&&e.jsx("span",{className:"text-[10px] text-[var(--text-tertiary)] truncate max-w-[100px]",children:x.owner}),e.jsx("span",{className:"text-[9px] text-[var(--text-tertiary)] capitalize shrink-0",children:x.status})]},x.id)})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:de,disabled:a.isPending,className:n(re,"bg-purple-500/10 text-purple-400 hover:bg-purple-500/20"),children:[a.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ze,{className:"w-3.5 h-3.5"}),"AI Analysis"]}),e.jsxs("button",{onClick:ae,disabled:r.isPending,className:n(re,"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20"),children:[r.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Cs,{className:"w-3.5 h-3.5"}),"Business Report"]})]}),v&&e.jsxs("div",{className:n(K,"p-4"),children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Analysis"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--text-secondary)] whitespace-pre-wrap leading-relaxed",children:v})]}),f&&e.jsxs("div",{className:n(K,"p-4"),children:[e.jsx("span",{className:"text-[10px] font-bold text-emerald-400 uppercase tracking-[0.1em]",children:"Business Report"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--text-secondary)] whitespace-pre-wrap leading-relaxed",children:f})]}),e.jsxs("div",{className:n(K,"p-4 space-y-3"),children:[e.jsx("span",{className:"text-[10px] font-bold text-[var(--accent-primary)] uppercase tracking-[0.1em]",children:"Export"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:x=>m(x.target.checked),className:"rounded border-[var(--border-primary)]"}),"Include AI Analysis"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:x=>b(x.target.checked),className:"rounded border-[var(--border-primary)]"}),"Include Business Report"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--text-tertiary)] uppercase tracking-wider block mb-1",children:"Document Style"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:We.map(x=>e.jsx("button",{onClick:()=>F(x.key),className:n("px-2.5 py-1 rounded-md text-[10px] font-medium border transition-colors",S===x.key?"bg-[var(--interactive-primary)]/20 text-[var(--accent-primary)] border-[var(--accent-primary)]/30":"bg-[var(--surface-secondary)] text-[var(--text-tertiary)] border-[var(--border-primary)] hover:text-[var(--text-primary)]"),children:x.label},x.key))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-1",children:[e.jsxs("button",{onClick:xe,disabled:d.isPending,className:n(re,"bg-[var(--interactive-primary)] text-[var(--text-on-brand)] hover:bg-[var(--interactive-primary-hover)]"),children:[d.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ps,{className:"w-3.5 h-3.5"}),"Download A4 Document"]}),e.jsxs("button",{onClick:me,disabled:h.isPending,className:n(re,"bg-orange-500/10 text-orange-400 hover:bg-orange-500/20"),children:[h.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(lt,{className:"w-3.5 h-3.5"}),"Download Presentation"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:_e,disabled:d.isPending,className:n(re,"bg-[var(--surface-secondary)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)] border border-[var(--border-primary)]"),children:[d.isPending&&!O?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Be,{className:"w-3.5 h-3.5"}),"Open Document for PDF"]}),e.jsxs("button",{onClick:pe,disabled:h.isPending,className:n(re,"bg-[var(--surface-secondary)] text-[var(--text-secondary)] hover:bg-[var(--surface-hover)] border border-[var(--border-primary)]"),children:[h.isPending&&!H?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Be,{className:"w-3.5 h-3.5"}),"Open Presentation for PDF"]})]})]})]})})]})})]})})}const fe={planning:{color:"text-[var(--text-tertiary)]",bg:"bg-[var(--surface-secondary)]",border:"border-[var(--border-secondary)]",icon:ke},active:{color:"text-[var(--status-success)]",bg:"bg-[var(--status-success-bg)]",border:"border-[var(--status-success)]/30",icon:Je},completed:{color:"text-[var(--status-info)]",bg:"bg-[var(--status-info-bg)]",border:"border-[var(--status-info)]/30",icon:Z}},Ue=t=>t==="completed"?"bg-[var(--status-success)]":t==="in_progress"?"bg-[var(--status-info)]":t==="overdue"?"bg-[var(--status-danger)]":"bg-[var(--text-tertiary)]";function as(t){return{id:t.id,name:t.name||"",start_date:t.start_date||t.startDate||"",end_date:t.end_date||t.endDate||"",context:t.context||"",goals:t.goals||[],status:t.status||"planning",analysis_start_date:t.analysis_start_date||"",analysis_end_date:t.analysis_end_date||"",project_id:t.project_id||"",created_at:t.created_at||"",updated_at:t.updated_at||""}}function bt({onCreated:t}){const o=Us(),[i,c]=u.useState({name:"",start_date:"",end_date:"",context:"",goals:"",analysis_start_date:"",analysis_end_date:""}),p=a=>{if(a.preventDefault(),!i.name||!i.start_date||!i.end_date){y.error("Name, start date and end date are required");return}o.mutate({name:i.name,start_date:i.start_date,end_date:i.end_date,context:i.context||void 0,goals:i.goals?i.goals.split(`
`).filter(r=>r.trim()):void 0,analysis_start_date:i.analysis_start_date||void 0,analysis_end_date:i.analysis_end_date||void 0},{onSuccess:()=>{y.success("Sprint created"),c({name:"",start_date:"",end_date:"",context:"",goals:"",analysis_start_date:"",analysis_end_date:""}),t()},onError:r=>y.error(r.message)})};return e.jsxs("form",{onSubmit:p,className:n(P,"p-5 space-y-4"),children:[e.jsx("h3",{className:L,children:"New Sprint"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--text-tertiary)] mb-1 uppercase tracking-wider",children:"Name *"}),e.jsx("input",{value:i.name,onChange:a=>c(r=>({...r,name:a.target.value})),className:n(T,"w-full"),placeholder:"Sprint 1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--text-tertiary)] mb-1 uppercase tracking-wider",children:"Start Date *"}),e.jsx("input",{type:"date",value:i.start_date,onChange:a=>c(r=>({...r,start_date:a.target.value})),className:n(T,"w-full"),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--text-tertiary)] mb-1 uppercase tracking-wider",children:"End Date *"}),e.jsx("input",{type:"date",value:i.end_date,onChange:a=>c(r=>({...r,end_date:a.target.value})),className:n(T,"w-full"),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--text-tertiary)] mb-1 uppercase tracking-wider",children:"Context"}),e.jsx("input",{value:i.context,onChange:a=>c(r=>({...r,context:a.target.value})),className:n(T,"w-full"),placeholder:"Focus areas, constraints..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--text-tertiary)] mb-1 uppercase tracking-wider",children:"Goals (one per line)"}),e.jsx("textarea",{value:i.goals,onChange:a=>c(r=>({...r,goals:a.target.value})),rows:3,className:n(T,"w-full resize-none"),placeholder:`Complete feature X
Fix bug Y`})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--text-tertiary)] mb-1 uppercase tracking-wider",children:"Analysis Start Date"}),e.jsx("input",{type:"date",value:i.analysis_start_date,onChange:a=>c(r=>({...r,analysis_start_date:a.target.value})),className:n(T,"w-full")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--text-tertiary)] mb-1 uppercase tracking-wider",children:"Analysis End Date"}),e.jsx("input",{type:"date",value:i.analysis_end_date,onChange:a=>c(r=>({...r,analysis_end_date:a.target.value})),className:n(T,"w-full")})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:o.isPending,className:ne,children:[o.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(oe,{className:"w-3.5 h-3.5"}),"Create Sprint"]})})]})}const ft=[{id:"overview",label:"Overview",icon:Te},{id:"kanban",label:"Kanban",icon:nt},{id:"timeline",label:"Timeline",icon:ts},{id:"burndown",label:"Burndown",icon:Ne},{id:"standup",label:"Standup",icon:Hs},{id:"capacity",label:"Capacity",icon:Ve},{id:"retro",label:"Retro",icon:es}];function Nt({sprintId:t,onBack:o}){const i=Es(),{data:c,isLoading:p}=Rs(t),{data:a,isLoading:r,error:d}=Qe(t),{data:h,error:v}=Ms(t),{data:_,isLoading:f,error:l}=Ls(t),N=$s(),m=Bs(),j=Ye(),b=Xe(),S=Os(),F=Is(),O=Fs(),J=zs(),H=Gs(),ee=qs(),[A,V]=u.useState("overview"),[le,M]=u.useState(!1),[$,Q]=u.useState({task:"",owner:"",priority:"medium"}),[D,se]=u.useState(null),[te,de]=u.useState(new Set),[ae,xe]=u.useState(new Set),[me,_e]=u.useState(""),[pe,x]=u.useState(""),[q,Se]=u.useState(!1),[E,U]=u.useState({name:"",context:"",goals:"",start_date:"",end_date:"",analysis_start_date:"",analysis_end_date:""}),[rs,Ae]=u.useState(!1),[ns,De]=u.useState(!1),k=u.useMemo(()=>{const s=c?.sprint??c;return s?as(s):{id:t,name:"",start_date:"",end_date:"",status:"planning"}},[c,t]),Y=a,W=Y?.actions??[],Ee=Y?.breakdown??{by_status:{},by_assignee:{}},ue=Y?.total_tasks??W.length,z=Y?.graph_context,Re=Y?.completed_tasks??W.filter(s=>s.status==="completed").length,is=u.useMemo(()=>{const s={};return W.forEach(g=>{const w=g.status||"pending";s[w]||(s[w]=[]),s[w].push(g)}),s},[W]),ls=u.useCallback(()=>{U({name:k.name,context:k.context||"",goals:(k.goals||[]).join(`
`),start_date:k.start_date?.slice(0,10)||"",end_date:k.end_date?.slice(0,10)||"",analysis_start_date:k.analysis_start_date?.slice(0,10)||"",analysis_end_date:k.analysis_end_date?.slice(0,10)||""}),Se(!0)},[k]),cs=()=>{S.mutate({id:k.id,name:E.name,context:E.context||void 0,goals:E.goals?E.goals.split(`
`).filter(s=>s.trim()):[],start_date:E.start_date||void 0,end_date:E.end_date||void 0,analysis_start_date:E.analysis_start_date||void 0,analysis_end_date:E.analysis_end_date||void 0},{onSuccess:()=>{y.success("Sprint updated"),Se(!1)},onError:s=>y.error(s.message)})},os=()=>{F.mutate(k.id,{onSuccess:()=>{y.success("Sprint deleted"),o()},onError:s=>y.error(s.message)})},Ce=s=>{O.mutate({sprintId:k.id,status:s},{onSuccess:()=>y.success(`Sprint marked as ${s}`),onError:g=>y.error(g.message)})},ds=()=>{N.mutate(t,{onSuccess:s=>{const g={proposed_new_tasks:s?.proposed_new_tasks??[],existing_action_ids:s?.existing_action_ids??[],existing_details:s?.existing_details??[]};se(g);const w=new Set;g.proposed_new_tasks.forEach((ve,js)=>w.add(js)),de(w);const I=new Set(g.existing_action_ids);xe(I),y.success(`Generated ${g.proposed_new_tasks.length} new tasks, found ${g.existing_action_ids.length} existing`)},onError:s=>y.error(s.message)})},xs=()=>{if(!D)return;const s=D.proposed_new_tasks.filter((w,I)=>te.has(I)),g=D.existing_action_ids.filter(w=>ae.has(w));m.mutate({sprintId:t,new_tasks:s,existing_action_ids:g},{onSuccess:w=>{y.success(`Created ${w?.created??0} tasks, linked ${w?.linked??0} existing`),se(null)},onError:w=>y.error(w.message)})},ms=()=>{j.mutate(t,{onSuccess:s=>{_e(s?.ai_analysis||s?.analysis||""),y.success("Analysis complete")},onError:s=>y.error(s.message)})},ps=()=>{b.mutate(t,{onSuccess:s=>{x(s?.business_report||s?.summary||""),y.success("Business report ready")},onError:s=>y.error(s.message)})},us=()=>{J.mutate({sprintId:k.id},{onSuccess:s=>{y.success(`Sprint cloned: ${s?.sprint?.name||"Copy"}${s?.tasks_cloned?` with ${s.tasks_cloned} tasks`:""}`)},onError:s=>y.error(s.message)})},hs=u.useCallback((s,g)=>{H.mutate({id:s,status:g},{onSuccess:()=>{i.invalidateQueries({queryKey:["sprint",t]}),i.invalidateQueries({queryKey:["sprintReport",t]}),y.success("Task status updated")},onError:()=>y.error("Failed to update status")})},[H,i,t]),Me=()=>{$.task.trim()&&ee.mutate({task:$.task.trim(),owner:$.owner.trim()||void 0,priority:$.priority,status:"pending",sprint_id:t},{onSuccess:()=>{i.invalidateQueries({queryKey:["sprint",t]}),i.invalidateQueries({queryKey:["sprintReport",t]}),y.success("Task added to sprint"),Q({task:"",owner:"",priority:"medium"}),M(!1)},onError:()=>y.error("Failed to add task")})},vs=u.useCallback(s=>{H.mutate({id:s,sprint_id:null},{onSuccess:()=>{i.invalidateQueries({queryKey:["sprint",t]}),i.invalidateQueries({queryKey:["sprintReport",t]}),y.success("Task removed from sprint")},onError:()=>y.error("Failed to remove task")})},[H,i,t]),R=h,Le=_;if(p)return e.jsxs("div",{className:"space-y-5 animate-pulse",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-[var(--surface-hover)]"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-5 w-48 rounded bg-[var(--surface-hover)]"}),e.jsx("div",{className:"h-3 w-32 rounded bg-[var(--surface-hover)]"})]}),e.jsx("div",{className:"h-6 w-20 rounded-full bg-[var(--surface-hover)]"})]}),e.jsxs("div",{className:n(P,"p-4 space-y-2"),children:[e.jsx("div",{className:"h-3 w-16 rounded bg-[var(--surface-hover)]"}),e.jsx("div",{className:"h-3 w-full rounded bg-[var(--surface-hover)]"}),e.jsx("div",{className:"h-3 w-3/4 rounded bg-[var(--surface-hover)]"})]}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4].map(s=>e.jsx("div",{className:"h-8 w-24 rounded-lg bg-[var(--surface-hover)]"},s))}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[1,2,3,4].map(s=>e.jsx("div",{className:n(P,"p-3 h-20")},s))})]});const he=fe[k.status]||fe.planning,gs=he.icon;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:o,className:"mt-1 w-8 h-8 rounded-lg bg-[var(--surface-secondary)] flex items-center justify-center hover:bg-[var(--surface-hover)] shrink-0",children:e.jsx(et,{className:"w-4 h-4 text-[var(--text-tertiary)]"})}),e.jsx("div",{className:"flex-1 min-w-0",children:q?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{value:E.name,onChange:s=>U(g=>({...g,name:s.target.value})),className:n(T,"w-full text-lg font-bold")}),e.jsx("input",{value:E.context,onChange:s=>U(g=>({...g,context:s.target.value})),className:n(T,"w-full"),placeholder:"Context..."}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] text-[var(--text-tertiary)] uppercase",children:"Start Date"}),e.jsx("input",{type:"date",value:E.start_date,onChange:s=>U(g=>({...g,start_date:s.target.value})),className:n(T,"w-full")})]}),e.jsxs("label",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] text-[var(--text-tertiary)] uppercase",children:"End Date"}),e.jsx("input",{type:"date",value:E.end_date,onChange:s=>U(g=>({...g,end_date:s.target.value})),className:n(T,"w-full")})]}),e.jsxs("label",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] text-[var(--text-tertiary)] uppercase",children:"Analysis Start"}),e.jsx("input",{type:"date",value:E.analysis_start_date,onChange:s=>U(g=>({...g,analysis_start_date:s.target.value})),className:n(T,"w-full")})]}),e.jsxs("label",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] text-[var(--text-tertiary)] uppercase",children:"Analysis End"}),e.jsx("input",{type:"date",value:E.analysis_end_date,onChange:s=>U(g=>({...g,analysis_end_date:s.target.value})),className:n(T,"w-full")})]})]}),e.jsx("textarea",{value:E.goals,onChange:s=>U(g=>({...g,goals:s.target.value})),className:n(T,"w-full resize-none"),rows:2,placeholder:"Goals (one per line)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:cs,disabled:S.isPending,className:ne,children:[S.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Z,{className:"w-3.5 h-3.5"})," Save"]}),e.jsxs("button",{onClick:()=>Se(!1),className:B,children:[e.jsx(X,{className:"w-3.5 h-3.5"})," Cancel"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--text-primary)] truncate",children:k.name||"Sprint"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-[var(--text-tertiary)]",children:[k.start_date?new Date(k.start_date).toLocaleDateString():"?"," — ",k.end_date?new Date(k.end_date).toLocaleDateString():"?"]}),k.context&&e.jsxs("span",{className:"text-xs text-[var(--text-tertiary)]",children:["· ",k.context]})]})]})}),!q&&e.jsx("div",{className:"flex items-center gap-2 shrink-0",children:e.jsxs("span",{className:n("text-[10px] font-medium px-2.5 py-1 rounded-full border capitalize",he.bg,he.color,he.border),children:[e.jsx(gs,{className:"w-3 h-3 inline mr-1"}),k.status]})})]}),!q&&k.goals&&k.goals.length>0&&e.jsxs("div",{className:n(P,"p-4"),children:[e.jsx("h3",{className:L,children:"Goals"}),e.jsx("ul",{className:"mt-2 space-y-1.5",children:k.goals.map((s,g)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-[var(--text-secondary)]",children:[e.jsx(es,{className:"w-3.5 h-3.5 text-[var(--accent-primary)] mt-0.5 shrink-0"}),s]},g))})]}),!q&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:ls,className:B,children:[e.jsx(st,{className:"w-3.5 h-3.5"})," Edit"]}),k.status==="planning"&&e.jsxs("button",{onClick:()=>Ce("active"),disabled:O.isPending,className:n(B,"text-[var(--status-success)] border-[var(--status-success)]/30"),children:[O.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(tt,{className:"w-3.5 h-3.5"})," Start Sprint"]}),k.status==="active"&&e.jsxs("button",{onClick:()=>Ce("completed"),disabled:O.isPending,className:n(B,"text-[var(--status-info)] border-[var(--status-info)]/30"),children:[O.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(at,{className:"w-3.5 h-3.5"})," Complete Sprint"]}),k.status==="completed"&&e.jsxs("button",{onClick:()=>Ce("planning"),disabled:O.isPending,className:B,children:[O.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ke,{className:"w-3.5 h-3.5"})," Reopen"]}),e.jsx("div",{className:"w-px h-6 bg-[var(--border-primary)] self-center"}),e.jsxs("button",{onClick:ds,disabled:N.isPending,className:ne,children:[N.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ze,{className:"w-3.5 h-3.5"})," Generate Tasks (AI)"]}),e.jsxs("button",{onClick:ms,disabled:j.isPending,className:n(B,"text-purple-400 border-purple-400/30"),children:[j.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"})," AI Analysis"]}),e.jsxs("button",{onClick:ps,disabled:b.isPending,className:n(B,"text-emerald-400 border-emerald-400/30"),children:[b.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ie,{className:"w-3.5 h-3.5"})," Business Report"]}),e.jsxs("button",{onClick:()=>Ae(!0),className:B,children:[e.jsx(Ws,{className:"w-3.5 h-3.5"})," Full Report & Export"]}),e.jsxs("button",{onClick:us,disabled:J.isPending,className:B,children:[J.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(rt,{className:"w-3.5 h-3.5"})," Clone"]}),e.jsx("div",{className:"flex-1"}),ns?e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:os,disabled:F.isPending,className:Oe,children:[F.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx($e,{className:"w-3.5 h-3.5"})," Confirm Delete"]}),e.jsx("button",{onClick:()=>De(!1),className:B,children:e.jsx(X,{className:"w-3.5 h-3.5"})})]}):e.jsxs("button",{onClick:()=>De(!0),className:Oe,children:[e.jsx($e,{className:"w-3.5 h-3.5"})," Delete"]})]}),D&&e.jsxs("div",{className:n(P,"p-4 space-y-3"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:L,children:"AI Generated Tasks"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:xs,disabled:m.isPending||te.size===0&&ae.size===0,className:ne,children:[m.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Z,{className:"w-3.5 h-3.5"}),"Apply Selected (",te.size+ae.size,")"]}),e.jsxs("button",{onClick:()=>se(null),className:B,children:[e.jsx(X,{className:"w-3.5 h-3.5"})," Dismiss"]})]})]}),D.proposed_new_tasks.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-[var(--text-tertiary)] uppercase tracking-wider mb-1.5",children:["New Tasks (",D.proposed_new_tasks.length,")"]}),e.jsx("div",{className:"space-y-1.5",children:D.proposed_new_tasks.map((s,g)=>e.jsxs("label",{className:"flex items-start gap-2 p-2 rounded-lg bg-[var(--surface-secondary)] hover:bg-[var(--surface-hover)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:te.has(g),onChange:w=>{de(I=>{const ve=new Set(I);return w.target.checked?ve.add(g):ve.delete(g),ve})},className:"mt-0.5 rounded border-[var(--border-primary)]"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--text-primary)]",children:s.task}),s.description&&e.jsx("p",{className:"text-[10px] text-[var(--text-tertiary)] mt-0.5 line-clamp-2",children:s.description})]}),s.size_estimate&&e.jsx("span",{className:"text-[9px] px-2 py-0.5 rounded-full bg-[var(--status-info-bg)] text-[var(--status-info)] shrink-0",children:s.size_estimate}),s.priority&&e.jsx("span",{className:n("text-[9px] px-2 py-0.5 rounded-full shrink-0",s.priority==="high"||s.priority==="urgent"?"bg-[var(--status-danger-bg)] text-[var(--status-danger)]":s.priority==="medium"?"bg-[var(--status-warning-bg)] text-[var(--status-warning)]":"bg-[var(--surface-secondary)] text-[var(--text-tertiary)]"),children:s.priority})]},g))})]}),D.existing_details&&D.existing_details.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-[var(--text-tertiary)] uppercase tracking-wider mb-1.5",children:["Existing Actions to Link (",D.existing_details.length,")"]}),e.jsx("div",{className:"space-y-1.5",children:D.existing_details.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-lg bg-[var(--surface-secondary)] hover:bg-[var(--surface-hover)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:ae.has(s.id),onChange:g=>{xe(w=>{const I=new Set(w);return g.target.checked?I.add(s.id):I.delete(s.id),I})},className:"rounded border-[var(--border-primary)]"}),e.jsx("span",{className:"text-xs text-[var(--text-primary)] flex-1 truncate",children:s.task}),e.jsx("span",{className:"text-[9px] text-[var(--text-tertiary)] capitalize",children:s.status})]},s.id))})]})]}),me&&e.jsxs("div",{className:n(P,"p-4"),children:[e.jsx("h3",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Analysis"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--text-secondary)] whitespace-pre-wrap leading-relaxed",children:me})]}),pe&&e.jsxs("div",{className:n(P,"p-4"),children:[e.jsx("h3",{className:"text-[10px] font-bold text-emerald-400 uppercase tracking-[0.1em]",children:"Business Report"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--text-secondary)] whitespace-pre-wrap leading-relaxed",children:pe})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(qe,{health:Le,isLoading:f,compact:!0}),R?.daily_progress&&e.jsxs("span",{className:"text-[10px] text-[var(--text-tertiary)]",children:[R.completed_tasks,"/",R.total_tasks," tasks · ",R.completed_points,"/",R.total_points," pts"]})]}),e.jsx("div",{className:"flex gap-1 bg-[var(--surface-secondary)] rounded-xl p-1 border border-[var(--border-primary)] overflow-x-auto",children:ft.map(s=>{const g=s.icon;return e.jsxs("button",{onClick:()=>V(s.id),className:n("flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs font-medium transition-colors whitespace-nowrap",A===s.id?"bg-[var(--interactive-primary)]/15 text-[var(--accent-primary)]":"text-[var(--text-tertiary)] hover:text-[var(--text-primary)] hover:bg-[var(--surface-hover)]"),children:[e.jsx(g,{className:"w-3.5 h-3.5"}),s.label]},s.id)})}),e.jsx(je,{mode:"wait",children:e.jsxs(ce.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.15},children:[A==="overview"&&e.jsxs("div",{className:"space-y-5",children:[r&&e.jsxs("div",{className:"flex items-center justify-center py-6 gap-2",children:[e.jsx(C,{className:"w-4 h-4 animate-spin text-[var(--accent-primary)]"}),e.jsx("span",{className:"text-xs text-[var(--text-tertiary)]",children:"Loading report data..."})]}),(d||v||l)&&e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-[var(--status-danger-bg)] border border-[var(--status-danger)]/20",children:[e.jsx(we,{className:"w-4 h-4 text-[var(--status-danger)] shrink-0"}),e.jsx("span",{className:"text-xs text-[var(--status-danger)]",children:"Some report data failed to load. Partial data may be shown."})]}),ue>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{label:"Total Tasks",value:ue},{label:"Completed",value:Re,sub:ue>0?`${Math.round(Re/ue*100)}%`:""},{label:"Total Points",value:Y?.total_task_points??0},{label:"Done Points",value:Y?.completed_task_points??0}].map(s=>e.jsxs("div",{className:n(P,"p-3 text-center"),children:[e.jsx("p",{className:"text-2xl font-bold text-[var(--text-primary)]",children:s.value}),e.jsx("p",{className:"text-[10px] text-[var(--text-tertiary)] uppercase tracking-wider",children:s.label}),s.sub&&e.jsx("p",{className:"text-xs text-[var(--accent-primary)] mt-0.5",children:s.sub})]},s.label))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:n(P,"p-4"),children:e.jsx(be,{title:"By Status",data:Ee.by_status})}),e.jsx("div",{className:n(P,"p-4"),children:e.jsx(be,{title:"By Assignee",data:Ee.by_assignee})})]})]}),e.jsx("div",{className:n(P,"p-4"),children:e.jsx(qe,{health:Le,isLoading:f})}),z&&(z.assignees?.length||z.sprint_name)&&e.jsxs("div",{className:n(P,"p-4"),children:[e.jsx("h3",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"Graph Context"}),e.jsxs("div",{className:"mt-2 space-y-1.5",children:[z.sprint_name&&e.jsxs("p",{className:"text-xs text-[var(--text-secondary)]",children:[e.jsx("span",{className:"text-[var(--text-tertiary)]",children:"Sprint node:"})," ",z.sprint_name,z.sprint_context&&e.jsxs("span",{className:"text-[var(--text-tertiary)]",children:[" — ",z.sprint_context]})]}),z.assignees&&z.assignees.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap",children:[e.jsx("span",{className:"text-[10px] text-[var(--text-tertiary)]",children:"Assignees:"}),z.assignees.map(s=>e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-purple-500/10 text-purple-400",children:s},s))]})]})]}),e.jsxs("div",{className:n(P,"p-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:L,children:["Sprint Tasks (",W.length,")"]}),e.jsxs("button",{onClick:()=>M(!le),className:B,children:[e.jsx(oe,{className:"w-3 h-3"})," Add Task"]})]}),e.jsx(je,{children:le&&e.jsx(ce.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"mt-3 space-y-2 p-3 rounded-lg bg-[var(--surface-secondary)] border border-[var(--border-primary)]",children:[e.jsx("input",{value:$.task,onChange:s=>Q(g=>({...g,task:s.target.value})),className:n(T,"w-full"),placeholder:"Task description...",onKeyDown:s=>s.key==="Enter"&&Me()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:$.owner,onChange:s=>Q(g=>({...g,owner:s.target.value})),className:n(T,"flex-1"),placeholder:"Owner (optional)"}),e.jsxs("select",{value:$.priority,onChange:s=>Q(g=>({...g,priority:s.target.value})),className:n(T,"w-28"),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]}),e.jsx("button",{onClick:Me,disabled:!$.task.trim()||ee.isPending,className:ne,children:ee.isPending?e.jsx(C,{className:"w-3 h-3 animate-spin"}):"Add"})]})]})})})]}),W.length>0&&e.jsx("div",{className:n(P,"p-4"),children:e.jsx("div",{className:"mt-3 space-y-4",children:["in_progress","pending","overdue","completed"].map(s=>{const g=is[s];return!g||g.length===0?null:e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-[var(--text-tertiary)] uppercase tracking-wider mb-1.5 flex items-center gap-1.5",children:[e.jsx("span",{className:n("w-2 h-2 rounded-full",Ue(s))}),s.replace("_"," ")," (",g.length,")"]}),e.jsx("div",{className:"space-y-1",children:g.map(w=>e.jsxs("div",{className:"group flex items-center gap-2 py-1.5 px-2 rounded-lg hover:bg-[var(--surface-hover)]",children:[e.jsx("span",{className:n("w-1.5 h-1.5 rounded-full shrink-0",Ue(w.status))}),e.jsx("span",{className:n("text-xs flex-1 truncate",w.status==="completed"?"line-through text-[var(--text-tertiary)]":"text-[var(--text-primary)]"),children:w.task||w.title||"(untitled)"}),w.owner&&e.jsx(ss,{name:w.owner,size:"sm"}),w.task_points!=null&&e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[var(--status-info-bg)] text-[var(--accent-primary)] tabular-nums",children:[w.task_points,"pt"]}),e.jsx(jt,{sprintId:t,taskDescription:w.task||w.title||""}),e.jsx("button",{onClick:I=>{I.stopPropagation(),vs(w.id)},className:"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-[var(--status-danger-bg)] text-[var(--status-danger)] transition-all",title:"Remove from sprint",children:e.jsx(X,{className:"w-3 h-3"})})]},w.id))})]},s)})})})]}),A==="kanban"&&e.jsx("div",{className:n(P,"p-4"),children:e.jsx(mt,{actions:W,onStatusChange:hs})}),A==="timeline"&&e.jsx("div",{className:n(P,"p-4"),children:e.jsx(ut,{actions:W,sprintStart:k.start_date,sprintEnd:k.end_date})}),A==="burndown"&&e.jsxs("div",{className:"space-y-4",children:[R?.daily_progress?e.jsx("div",{className:n(P,"p-4"),children:e.jsx(Fe,{dailyProgress:R.daily_progress,totalTasks:R.total_tasks,totalPoints:R.total_points})}):e.jsxs("div",{className:n(P,"p-8 text-center"),children:[e.jsx(Ne,{className:"w-8 h-8 mx-auto text-[var(--text-tertiary)] mb-2"}),e.jsx("p",{className:"text-xs text-[var(--text-tertiary)]",children:"Burndown data will appear as tasks are completed"})]}),R?.daily_progress&&e.jsx("div",{className:n(P,"p-4"),children:e.jsx(Fe,{dailyProgress:R.daily_progress,totalTasks:R.total_tasks,totalPoints:R.total_points,usePoints:!0})}),R?.velocity_history?.length>0&&e.jsx("div",{className:n(P,"p-4"),children:e.jsx(ot,{history:R.velocity_history})})]}),A==="standup"&&e.jsx(vt,{sprintId:t}),A==="capacity"&&e.jsx(gt,{sprintId:t,actions:W}),A==="retro"&&e.jsx(ht,{sprintId:t})]},A)}),e.jsx(yt,{open:rs,onClose:()=>Ae(!1),sprint:k})]})}function qt(){const t=Ts(),{data:o,isLoading:i}=t,[c,p]=u.useState(null),[a,r]=u.useState(!1),d=u.useMemo(()=>(o?.sprints??(Array.isArray(o)?o:[])).map(N=>as(N)),[o]),h=d.filter(l=>l.status==="active"),v=d.filter(l=>l.status==="planning"),_=d.filter(l=>l.status==="completed");if(c)return e.jsx("div",{className:"p-6",children:e.jsx(Nt,{sprintId:c,onBack:()=>p(null)})});const f=l=>{const N=fe[l.status]||fe.planning,m=N.icon;return e.jsxs(ce.div,{layout:!0,className:n(P,"p-4 hover:border-[var(--accent-primary)]/30 transition-colors cursor-pointer"),onClick:()=>p(l.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{className:n("w-4 h-4 shrink-0",N.color)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--text-primary)] truncate",children:l.name||"Unnamed Sprint"}),e.jsxs("p",{className:"text-[10px] text-[var(--text-tertiary)]",children:[l.start_date?new Date(l.start_date).toLocaleDateString():"?"," — ",l.end_date?new Date(l.end_date).toLocaleDateString():"?",l.context&&e.jsxs("span",{className:"ml-2",children:["· ",l.context.substring(0,50),l.context.length>50?"...":""]})]})]}),e.jsx("span",{className:n("text-[10px] font-medium px-2.5 py-1 rounded-full border capitalize",N.bg,N.color,N.border),children:l.status}),e.jsx(Ds,{className:"w-4 h-4 text-[var(--text-tertiary)]"})]}),l.goals&&l.goals.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-2 ml-7",children:[l.goals.slice(0,3).map((j,b)=>e.jsx("span",{className:"text-[9px] px-2 py-0.5 rounded-full bg-[var(--surface-secondary)] text-[var(--text-tertiary)]",children:j},b)),l.goals.length>3&&e.jsxs("span",{className:"text-[9px] text-[var(--text-tertiary)]",children:["+",l.goals.length-3," more"]})]})]},l.id)};return e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-[var(--text-primary)]",children:"Sprints"}),e.jsxs("p",{className:"text-xs text-[var(--text-tertiary)]",children:[d.length," sprint",d.length!==1?"s":"",h.length>0&&e.jsxs("span",{className:"text-[var(--status-success)] ml-2",children:["· ",h.length," active"]})]})]}),e.jsxs("button",{onClick:()=>r(!a),className:ne,children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," New Sprint"]})]}),e.jsx(je,{children:a&&e.jsx(ce.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsx(bt,{onCreated:()=>r(!1)})})}),t.error?e.jsx(Ks,{message:"Failed to load sprints.",onRetry:()=>t.refetch()}):i?e.jsx("div",{className:"space-y-3 animate-pulse",children:[1,2,3].map(l=>e.jsx("div",{className:n(P,"p-4"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-[var(--surface-hover)]"}),e.jsxs("div",{className:"flex-1 space-y-1.5",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-[var(--surface-hover)]"}),e.jsx("div",{className:"h-3 w-56 rounded bg-[var(--surface-hover)]"})]}),e.jsx("div",{className:"h-5 w-16 rounded-full bg-[var(--surface-hover)]"})]})},l))}):d.length===0?e.jsxs("div",{className:n(P,"p-12 text-center"),children:[e.jsx(As,{className:"w-10 h-10 mx-auto text-[var(--text-tertiary)] mb-3"}),e.jsx("p",{className:"text-sm text-[var(--text-tertiary)]",children:"No sprints yet. Create your first sprint to get started."})]}):e.jsxs("div",{className:"space-y-6",children:[h.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs font-bold text-[var(--status-success)] uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(Je,{className:"w-3.5 h-3.5"})," Active (",h.length,")"]}),e.jsx("div",{className:"space-y-3",children:h.map(f)})]}),v.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs font-bold text-[var(--text-tertiary)] uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(ke,{className:"w-3.5 h-3.5"})," Planning (",v.length,")"]}),e.jsx("div",{className:"space-y-3",children:v.map(f)})]}),_.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs font-bold text-[var(--accent-primary)] uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(Z,{className:"w-3.5 h-3.5"})," Completed (",_.length,")"]}),e.jsx("div",{className:"space-y-3",children:_.map(f)})]})]})]})}export{qt as default};
//# sourceMappingURL=SprintsPage-CPXeIVWs.js.map
