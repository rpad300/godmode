{"version":3,"file":"teamAnalysis-b6DZM1KK.js","sources":["../../frontend/stores/teamAnalysis.ts"],"sourcesContent":["/**\n * Team Analysis Store\n * State management for behavioral profiles and team dynamics\n */\n\n// Types\nexport interface BehavioralProfile {\n    id: string;\n    person_id: string;\n    person?: {\n        id: string;\n        name: string;\n        role?: string;\n        organization?: string;\n        email?: string;\n    };\n    profile_data: ProfileData;\n    confidence_level: 'low' | 'medium' | 'high' | 'very_high';\n    communication_style?: string;\n    dominant_motivation?: string;\n    risk_tolerance?: 'low' | 'medium' | 'high';\n    influence_score: number;\n    transcripts_analyzed: string[];\n    transcript_count: number;\n    total_speaking_time_seconds: number;\n    limitations: string[];\n    recommended_update_after?: string;\n    last_analysis_at: string;\n    created_at: string;\n    updated_at: string;\n}\n\nexport interface ProfileData {\n    target_name?: string;\n    analysis_date?: string;\n    confidence_level?: string;\n    communication_identity?: {\n        dominant_style?: string;\n        intervention_rhythm?: string;\n        textual_body_language?: string;\n        evidence?: Evidence[];\n    };\n    motivations_and_priorities?: {\n        values_most?: string[];\n        avoids?: string[];\n        based_on?: string;\n        confidence?: string;\n        evidence?: Evidence[];\n    };\n    behavior_under_pressure?: PressureBehavior[];\n    influence_tactics?: InfluenceTactic[];\n    vulnerabilities?: {\n        discourse_action_inconsistencies?: { description: string; evidence: string }[];\n        defense_triggers?: { trigger: string; evidence: string }[];\n        blind_spots?: { description: string; evidence: string }[];\n        risk_patterns?: { pattern: string; evidence: string }[];\n    };\n    interaction_strategy?: {\n        ideal_format?: {\n            channel?: string;\n            structure?: string;\n            timing?: string;\n        };\n        framing_that_works?: string[];\n        what_to_avoid?: string[];\n        cooperation_triggers?: string[];\n    };\n    early_warning_signs?: EarlyWarningSign[];\n    power_analysis?: PowerAnalysis[];\n    limitations?: string[];\n    recommended_update_after?: string;\n}\n\nexport interface Evidence {\n    timestamp?: string;\n    quote?: string;\n    observation?: string;\n}\n\nexport interface PressureBehavior {\n    situation: string;\n    observed_behavior: string;\n    timestamp?: string;\n    quote?: string;\n}\n\nexport interface InfluenceTactic {\n    objective: string;\n    tactic: string;\n    timestamp?: string;\n    example?: string;\n}\n\nexport interface EarlyWarningSign {\n    signal: string;\n    indicates: string;\n    comparison_evidence?: string;\n}\n\nexport interface PowerAnalysis {\n    factor: string;\n    assessment: string;\n    strategic_implication?: string;\n}\n\nexport interface TeamAnalysis {\n    id: string;\n    project_id: string;\n    analysis_data: TeamAnalysisData;\n    team_size: number;\n    cohesion_score: number;\n    tension_level: 'low' | 'medium' | 'high';\n    dominant_communication_pattern?: string;\n    influence_map: InfluenceRelation[];\n    alliances: Alliance[];\n    tensions: Tension[];\n    members_included: string[];\n    transcripts_analyzed: string[];\n    last_analysis_at: string;\n}\n\nexport interface TeamAnalysisData {\n    analysis_date?: string;\n    team_size?: number;\n    cohesion_score?: number;\n    tension_level?: string;\n    dominant_communication_pattern?: string;\n    power_centers?: PowerCenter[];\n    communication_flow?: {\n        central_nodes?: string[];\n        bottlenecks?: string[];\n        isolated_members?: string[];\n        information_brokers?: string[];\n    };\n    recommendations?: string[];\n    risk_factors?: string[];\n}\n\nexport interface InfluenceRelation {\n    from_person?: string;\n    to_person?: string;\n    influence_type?: string;\n    strength?: number;\n    evidence?: string;\n}\n\nexport interface Alliance {\n    members?: string[];\n    alliance_type?: string;\n    shared_values?: string[];\n    strength?: number;\n    evidence?: string;\n}\n\nexport interface Tension {\n    between?: string[];\n    tension_type?: string;\n    level?: string;\n    triggers?: string[];\n    evidence?: string;\n}\n\nexport interface PowerCenter {\n    person?: string;\n    power_type?: string;\n    influence_reach?: number;\n    dependencies?: string[];\n}\n\nexport interface BehavioralRelationship {\n    id: string;\n    from_person_id: string;\n    to_person_id: string;\n    from_person?: { id: string; name: string };\n    to_person?: { id: string; name: string };\n    relationship_type: string;\n    strength: number;\n    confidence: string;\n    evidence: any[];\n    evidence_count: number;\n}\n\nexport interface GraphNode {\n    id: string;\n    label: string;\n    group: string;\n    size: number;\n    title?: string;\n    color?: string;\n    properties?: Record<string, any>;\n}\n\nexport interface GraphEdge {\n    from: string;\n    to: string;\n    type: string;\n    label?: string;\n    width?: number;\n    dashes?: boolean;\n    color?: string;\n    arrows?: string;\n    title?: string;\n    properties?: Record<string, any>;\n}\n\nexport interface TeamAnalysisState {\n    profiles: BehavioralProfile[];\n    selectedProfile: BehavioralProfile | null;\n    teamAnalysis: TeamAnalysis | null;\n    relationships: BehavioralRelationship[];\n    graphData: { nodes: GraphNode[]; edges: GraphEdge[] } | null;\n    loading: boolean;\n    analyzing: boolean;\n    error: string | null;\n    currentSubtab: 'profiles' | 'team' | 'graph';\n}\n\n// Initial state\nconst initialState: TeamAnalysisState = {\n    profiles: [],\n    selectedProfile: null,\n    teamAnalysis: null,\n    relationships: [],\n    graphData: null,\n    loading: false,\n    analyzing: false,\n    error: null,\n    currentSubtab: 'profiles',\n};\n\n// State\nlet state: TeamAnalysisState = { ...initialState };\n\n// Listeners\nconst listeners: Set<(state: TeamAnalysisState) => void> = new Set();\n\n/**\n * Notify all listeners\n */\nfunction notify(): void {\n    listeners.forEach(fn => fn(state));\n}\n\n/**\n * Get current state\n */\nexport function getState(): TeamAnalysisState {\n    return state;\n}\n\n/**\n * Subscribe to state changes\n */\nexport function subscribe(callback: (state: TeamAnalysisState) => void): () => void {\n    listeners.add(callback);\n    return () => listeners.delete(callback);\n}\n\n/**\n * Set loading state\n */\nexport function setLoading(loading: boolean): void {\n    state = { ...state, loading };\n    notify();\n}\n\n/**\n * Set analyzing state\n */\nexport function setAnalyzing(analyzing: boolean): void {\n    state = { ...state, analyzing };\n    notify();\n}\n\n/**\n * Set error\n */\nexport function setError(error: string | null): void {\n    state = { ...state, error };\n    notify();\n}\n\n/**\n * Set profiles\n */\nexport function setProfiles(profiles: BehavioralProfile[]): void {\n    state = { ...state, profiles };\n    notify();\n}\n\n/**\n * Set selected profile\n */\nexport function setSelectedProfile(profile: BehavioralProfile | null): void {\n    state = { ...state, selectedProfile: profile };\n    notify();\n}\n\n/**\n * Set team analysis\n */\nexport function setTeamAnalysis(analysis: TeamAnalysis | null): void {\n    state = { ...state, teamAnalysis: analysis };\n    notify();\n}\n\n/**\n * Set relationships\n */\nexport function setRelationships(relationships: BehavioralRelationship[]): void {\n    state = { ...state, relationships };\n    notify();\n}\n\n/**\n * Set graph data\n */\nexport function setGraphData(data: { nodes: GraphNode[]; edges: GraphEdge[] } | null): void {\n    state = { ...state, graphData: data };\n    notify();\n}\n\n/**\n * Set current subtab\n */\nexport function setSubtab(subtab: 'profiles' | 'team' | 'graph'): void {\n    state = { ...state, currentSubtab: subtab };\n    notify();\n}\n\n/**\n * Load profiles from API\n */\nexport async function loadProfiles(): Promise<void> {\n    setLoading(true);\n    setError(null);\n    \n    try {\n        const response = await fetch('/api/team-analysis/profiles');\n        const data = await response.json();\n        \n        if (data.ok) {\n            setProfiles(data.profiles || []);\n        } else {\n            setError(data.error || 'Failed to load profiles');\n        }\n    } catch (error: any) {\n        setError(error.message || 'Failed to load profiles');\n    } finally {\n        setLoading(false);\n    }\n}\n\n/**\n * Load a specific profile\n */\nexport async function loadProfile(personId: string): Promise<BehavioralProfile | null> {\n    setLoading(true);\n    setError(null);\n    \n    try {\n        const response = await fetch(`/api/team-analysis/profiles/${personId}`);\n        const data = await response.json();\n        \n        if (data.ok && data.profile) {\n            setSelectedProfile(data.profile);\n            return data.profile;\n        } else {\n            setError(data.error || 'Profile not found');\n            return null;\n        }\n    } catch (error: any) {\n        setError(error.message || 'Failed to load profile');\n        return null;\n    } finally {\n        setLoading(false);\n    }\n}\n\n/**\n * Analyze a person's profile\n */\nexport async function analyzeProfile(personId: string, options: {\n    relationshipContext?: string;\n    objective?: string;\n    forceReanalysis?: boolean;\n} = {}): Promise<BehavioralProfile | null> {\n    setAnalyzing(true);\n    setError(null);\n    \n    try {\n        const response = await fetch(`/api/team-analysis/profiles/${personId}/analyze`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(options)\n        });\n        const data = await response.json();\n        \n        if (data.ok && data.profile) {\n            // Update profiles list\n            const updatedProfiles = state.profiles.map(p => \n                p.person_id === personId ? data.profile : p\n            );\n            if (!updatedProfiles.find(p => p.person_id === personId)) {\n                updatedProfiles.push(data.profile);\n            }\n            setProfiles(updatedProfiles);\n            setSelectedProfile(data.profile);\n            return data.profile;\n        } else {\n            setError(data.error || 'Failed to analyze profile');\n            return null;\n        }\n    } catch (error: any) {\n        setError(error.message || 'Failed to analyze profile');\n        return null;\n    } finally {\n        setAnalyzing(false);\n    }\n}\n\n/**\n * Load team analysis\n */\nexport async function loadTeamAnalysis(): Promise<void> {\n    setLoading(true);\n    setError(null);\n    \n    try {\n        console.log('[TeamAnalysisStore] Loading team analysis...');\n        const response = await fetch('/api/team-analysis/team');\n        const data = await response.json();\n        console.log('[TeamAnalysisStore] Team analysis response:', data);\n        \n        if (data.ok) {\n            console.log('[TeamAnalysisStore] Setting team analysis:', data.analysis);\n            setTeamAnalysis(data.analysis);\n        } else {\n            console.error('[TeamAnalysisStore] Error:', data.error);\n            setError(data.error || 'Failed to load team analysis');\n        }\n    } catch (error: any) {\n        console.error('[TeamAnalysisStore] Exception:', error);\n        setError(error.message || 'Failed to load team analysis');\n    } finally {\n        setLoading(false);\n    }\n}\n\n/**\n * Analyze team dynamics\n */\nexport async function analyzeTeam(forceReanalysis: boolean = false): Promise<TeamAnalysis | null> {\n    setAnalyzing(true);\n    setError(null);\n    \n    try {\n        const response = await fetch('/api/team-analysis/team/analyze', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ forceReanalysis })\n        });\n        const data = await response.json();\n        \n        if (data.ok && data.analysis) {\n            setTeamAnalysis(data.analysis);\n            return data.analysis;\n        } else {\n            setError(data.error || 'Failed to analyze team');\n            return null;\n        }\n    } catch (error: any) {\n        setError(error.message || 'Failed to analyze team');\n        return null;\n    } finally {\n        setAnalyzing(false);\n    }\n}\n\n/**\n * Load relationships\n */\nexport async function loadRelationships(): Promise<void> {\n    try {\n        const response = await fetch('/api/team-analysis/relationships');\n        const data = await response.json();\n        \n        if (data.ok) {\n            setRelationships(data.relationships || []);\n        }\n    } catch (error) {\n        console.error('Failed to load relationships:', error);\n    }\n}\n\n/**\n * Load graph visualization data\n */\nexport async function loadGraphData(): Promise<void> {\n    try {\n        console.log('[TeamAnalysisStore] Loading graph data...');\n        const response = await fetch('/api/team-analysis/graph');\n        const data = await response.json();\n        console.log('[TeamAnalysisStore] Graph data response:', data);\n        \n        if (data.ok) {\n            console.log('[TeamAnalysisStore] Setting graph data:', data.nodes?.length, 'nodes,', data.edges?.length, 'edges');\n            setGraphData({ nodes: data.nodes || [], edges: data.edges || [] });\n        }\n    } catch (error) {\n        console.error('[TeamAnalysisStore] Failed to load graph data:', error);\n    }\n}\n\n/**\n * Load all data\n */\nexport async function loadAll(): Promise<void> {\n    await Promise.all([\n        loadProfiles(),\n        loadTeamAnalysis(),\n        loadRelationships(),\n        loadGraphData()\n    ]);\n}\n\n/**\n * Reset to initial state\n */\nexport function reset(): void {\n    state = { ...initialState };\n    notify();\n}\n\n// Export as namespace\nexport const teamAnalysisStore = {\n    getState,\n    subscribe,\n    setLoading,\n    setAnalyzing,\n    setError,\n    setProfiles,\n    setSelectedProfile,\n    setTeamAnalysis,\n    setRelationships,\n    setGraphData,\n    setSubtab,\n    loadProfiles,\n    loadProfile,\n    analyzeProfile,\n    loadTeamAnalysis,\n    analyzeTeam,\n    loadRelationships,\n    loadGraphData,\n    loadAll,\n    reset,\n};\n"],"names":["initialState","state","listeners","notify","fn","getState","subscribe","callback","setLoading","loading","setAnalyzing","analyzing","setError","error","setProfiles","profiles","setSelectedProfile","profile","setTeamAnalysis","analysis","setRelationships","relationships","setGraphData","data","setSubtab","subtab","loadProfiles","loadProfile","personId","analyzeProfile","options","updatedProfiles","p","loadTeamAnalysis","analyzeTeam","forceReanalysis","loadRelationships","loadGraphData","loadAll","reset","teamAnalysisStore"],"mappings":"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"}