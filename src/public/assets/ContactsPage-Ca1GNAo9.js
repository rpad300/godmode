import{r as n,j as e}from"./vendor-react-CZ-WyKWZ.js";import{h as lt,i as ut,t as c}from"./vendor-ui-BS9QKitv.js";import{c as ot,r as xe,ac as le,aZ as Q,a_ as oe,a$ as ce,b0 as me,b1 as de,b2 as P,M as we,N as Ee,B as Oe,C as $e,a9 as Xe,aV as f,b3 as ct,b4 as vt,b5 as ft,L as ne,F as bt,O as Ge,aq as Ve,X as Fe,w as jt,T as qe,a8 as Ye,f as yt,b6 as Nt,b7 as wt,b8 as Ct,b9 as kt,ba as St,bb as At,bc as zt,bd as Ft,be as Et,bf as $t,R as Pt,aX as Dt,H as Rt,P as Ut,U as _t,g as mt}from"./main-B3DZn5B_.js";import{I as Pe}from"./input-Dy89fHlR.js";import{c as Ce}from"./vendor-markdown-Cu8AM8lU.js";import{I as Mt,A as It}from"./AvatarUpload-gChxksHY.js";import{S as Tt}from"./save-Dic_e7Eu.js";import{C as Lt}from"./CommentsPanel-CZdKIoGH.js";import{A as Ot}from"./arrow-left-BUrpeDp8.js";import{S as dt}from"./sparkles-D3iJUPqd.js";import{L as xt}from"./link-2-CvGSt01y.js";import{P as Vt}from"./pencil-BJDfGHvR.js";import{U as Je}from"./users-round--q5NsWjF.js";import{G as Ze}from"./globe-BYeHHetr.js";import{A as Bt}from"./arrow-right-BfPHyTFx.js";import{U as Ke}from"./user-plus-C5QYTMT3.js";import{S as et}from"./square-check-big-DQbkmKDU.js";import{F as Gt}from"./file-braces-CKRIsa3C.js";import{U as qt}from"./upload-C00nhlDV.js";import{F as Jt}from"./funnel-4Z5n8uFe.js";import{S as ze}from"./star-YHn3OJCl.js";import{M as tt}from"./merge-13AMIUb7.js";import{S as Qt}from"./square-CYG0GOOg.js";import"./vendor-supabase-Bpw_79gH.js";import"./vendor-query-DSf7I7Ei.js";import"./vendor-router-D_XeKoA_.js";import"./send-CaMoZtNQ.js";import"./pen-UIQK8jUR.js";import"./circle-6fOsuLxM.js";const Ht=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],Wt=Ce("file-spreadsheet",Ht);const Xt=[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]],Qe=Ce("linkedin",Xt);const Yt=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],He=Ce("map-pin",Yt);const Zt=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],De=Ce("phone",Zt);const Kt=[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]],We=Ce("sticky-note",Kt),ea=ut("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),J=n.forwardRef(({className:a,...d},x)=>e.jsx(lt,{ref:x,className:ot(ea(),a),...d}));J.displayName=lt.displayName;const pt=n.forwardRef(({className:a,...d},x)=>e.jsx("textarea",{className:ot("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:x,...d}));pt.displayName="Textarea";const ta=({contact:a,onSubmit:d,onCancel:x,mode:u})=>{const[l,p]=n.useState({name:"",role:"",organization:"",email:"",phone:"",linkedin:"",avatarUrl:"",department:"",location:"",timezone:"",notes:"",aliases:[]}),[h,b]=n.useState(""),[g,w]=n.useState([]),[v,I]=n.useState([]),[y,pe]=n.useState([]);n.useEffect(()=>{(async()=>{try{const[j,N,D]=await Promise.all([f.get("/api/role-templates"),f.get("/api/timezones"),f.get("/api/contacts/metadata/companies")]),V=j.roles||[],H=N.timezones||[],L=D.companies||[];w(V),I(H),pe(L)}catch(j){console.error("Failed to load metadata",j)}})(),a&&p({name:a.name,role:a.role,organization:a.organization,email:a.email||"",phone:a.phone||"",linkedin:a.linkedin||"",avatarUrl:xe(a)||"",department:a.department||"",location:a.location||"",timezone:a.timezone||"",notes:a.notes||"",aliases:a.aliases||[]})},[a]);const T=()=>{!l.name.trim()||!l.role.trim()||d({name:l.name.trim(),role:l.role.trim(),organization:l.organization.trim()||"Unknown",email:l.email.trim()||void 0,phone:l.phone.trim()||void 0,linkedin:l.linkedin.trim()||void 0,avatarUrl:l.avatarUrl.trim()||void 0,department:l.department.trim()||void 0,location:l.location.trim()||void 0,timezone:l.timezone.trim()||void 0,notes:l.notes.trim()||void 0,aliases:l.aliases})},E=(i,j)=>p(N=>({...N,[i]:j})),A=()=>{h.trim()&&!l.aliases.includes(h.trim())&&(p(i=>({...i,aliases:[...i.aliases,h.trim()]})),b(""))},z=i=>{p(j=>({...j,aliases:j.aliases.filter(N=>N!==i)}))},m=({icon:i,label:j,id:N,placeholder:D,value:V,type:H="text",required:L=!1})=>e.jsxs("div",{children:[e.jsxs(J,{htmlFor:N,className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(i,{className:"w-3.5 h-3.5"})," ",j," ",L&&"*"]}),e.jsx(Pe,{id:N,type:H,placeholder:D,value:V,onChange:W=>E(N,W.target.value)})]});return e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:[e.jsx("div",{className:"col-span-2 sm:col-span-1",children:e.jsx(m,{icon:le,label:"Name",id:"name",placeholder:"Full name",value:l.name,required:!0})}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs(J,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(Q,{className:"w-3.5 h-3.5"})," Role *"]}),e.jsxs(oe,{value:l.role,onValueChange:i=>E("role",i),children:[e.jsx(ce,{className:"w-full",children:e.jsx(me,{placeholder:"Select role..."})}),e.jsx(de,{children:g.filter(i=>i&&(i.name||i.display_name)).map(i=>e.jsx(P,{value:i.display_name||i.name||"Unknown",children:i.display_name||i.name||"Unknown Role"},i.id||i.name))})]})]}),e.jsx(m,{icon:we,label:"Email",id:"email",placeholder:"email@example.com",value:l.email,type:"email"}),e.jsx(m,{icon:De,label:"Phone",id:"phone",placeholder:"+351 900 000 000",value:l.phone,type:"tel"}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs(J,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(Ee,{className:"w-3.5 h-3.5"})," Organization"]}),e.jsxs(oe,{value:l.organization,onValueChange:i=>E("organization",i),children:[e.jsx(ce,{className:"w-full",children:e.jsx(me,{placeholder:"Select organization..."})}),e.jsx(de,{children:y.filter(i=>i&&i.name).map(i=>e.jsx(P,{value:i.name||"Unknown",children:i.name||"Unknown Company"},i.id||i.name))})]})]}),e.jsx(m,{icon:Qe,label:"LinkedIn",id:"linkedin",placeholder:"https://linkedin.com/in/...",value:l.linkedin}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs(J,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(le,{className:"w-3.5 h-3.5"})," Aliases"]}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(Pe,{value:h,onChange:i=>b(i.target.value),placeholder:"Add alias (e.g. nickname, alternate name)",onKeyDown:i=>i.key==="Enter"&&(i.preventDefault(),A())}),e.jsx(Oe,{type:"button",size:"sm",onClick:A,variant:"secondary",children:"Add"})]}),l.aliases.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:l.aliases.map(i=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded bg-secondary text-xs",children:[i,e.jsx("button",{onClick:()=>z(i),className:"hover:text-destructive",children:"×"})]},i))})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(m,{icon:Mt,label:"Avatar URL",id:"avatarUrl",placeholder:"https://...",value:l.avatarUrl}),!l.avatarUrl&&e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Enter a URL to set the contact's profile picture"})]}),e.jsx(m,{icon:Q,label:"Department",id:"department",placeholder:"Engineering, Sales, etc.",value:l.department}),e.jsx(m,{icon:He,label:"Location",id:"location",placeholder:"e.g. Lisbon, Portugal",value:l.location}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs(J,{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx($e,{className:"w-3.5 h-3.5"})," Timezone"]}),e.jsxs(oe,{value:l.timezone,onValueChange:i=>E("timezone",i),children:[e.jsx(ce,{className:"w-full",children:e.jsx(me,{placeholder:"Select timezone..."})}),e.jsx(de,{children:v.filter(i=>i&&i.name).map(i=>e.jsxs(P,{value:i.code||i.name,children:[i.name||"Unknown Timezone"," (",i.code,")"]},i.id||i.code||i.name))})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs(J,{htmlFor:"notes",className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-1.5",children:[e.jsx(We,{className:"w-3.5 h-3.5"})," Notes"]}),e.jsx(pt,{id:"notes",placeholder:"Additional notes...",value:l.notes,onChange:i=>E("notes",i.target.value),rows:2})]})]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsx(Oe,{variant:"outline",onClick:x,className:"flex-1",children:"Cancel"}),e.jsx(Oe,{onClick:T,disabled:!l.name.trim()||!l.role.trim(),className:"flex-1 gap-1.5",children:u==="add"?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4"})," Add Contact"]}):e.jsxs(e.Fragment,{children:[e.jsx(Tt,{className:"w-4 h-4"})," Save Changes"]})})]})]})},at="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",st="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",re="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",rt="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50",it=["from-rose-400 to-pink-500","from-violet-400 to-purple-500","from-blue-400 to-cyan-500","from-emerald-400 to-teal-500","from-amber-400 to-orange-500","from-fuchsia-400 to-pink-500"],aa=a=>{let d=0;for(let x=0;x<a.length;x++)d=a.charCodeAt(x)+((d<<5)-d);return it[Math.abs(d)%it.length]},sa=[{id:"info",label:"Info",icon:le},{id:"projects",label:"Projects",icon:bt},{id:"relations",label:"Relations",icon:Je},{id:"mentions",label:"Mentions",icon:Ge},{id:"activity",label:"Activity",icon:$e}],$=({icon:a,label:d,value:x})=>x?e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-3 py-3 border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--gm-text-tertiary)]",children:[e.jsx(a,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"})," ",d]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)] break-all",children:x})]}):null,ie=({icon:a,label:d,field:x,placeholder:u,value:l,onChange:p,type:h="text"})=>e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--gm-text-tertiary)]",children:[e.jsx(a,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"})," ",d]}),e.jsx(Pe,{value:l,onChange:b=>p(x,b.target.value),placeholder:u,type:h,className:"h-8 text-sm"})]}),Be=({icon:a,label:d,field:x,placeholder:u,value:l,onChange:p,options:h})=>{const b=h.some(g=>g.value===l);return e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--gm-text-tertiary)]",children:[e.jsx(a,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"})," ",d]}),h.length>0?e.jsxs(oe,{value:b?l:void 0,onValueChange:g=>p(x,g),children:[e.jsx(ce,{className:"h-8 text-sm",children:e.jsx(me,{placeholder:l||u})}),e.jsxs(de,{children:[!b&&l&&e.jsx(P,{value:l,children:l}),h.map(g=>e.jsx(P,{value:g.value,children:g.label},g.id))]})]}):e.jsx(Pe,{value:l,onChange:g=>p(x,g.target.value),placeholder:u,className:"h-8 text-sm"})]})};function ra({contact:a,onBack:d,onEdit:x,onDelete:u,onUpdateProjects:l}){const[p,h]=n.useState("info"),[b,g]=n.useState(!1),[w,v]=n.useState(!1),[I,y]=n.useState(!1),[pe,T]=n.useState(!1),[E,A]=n.useState(!1),z=n.useRef(null),[m,i]=n.useState({name:"",role:"",organization:"",email:"",phone:"",linkedin:"",department:"",location:"",timezone:"",notes:""}),[j,N]=n.useState([]),[D,V]=n.useState([]),[H,L]=n.useState([]),[W,ke]=n.useState([]),[R,U]=n.useState([]),[X,_]=n.useState(null),[ge,Y]=n.useState([]),[Z,Se]=n.useState([]),[M,he]=n.useState([]),[ue,ve]=n.useState([]),fe=ct(),Re=vt(),K=ft(),[be,C]=n.useState(!1),[ee,je]=n.useState(""),[O,te]=n.useState("works_with"),[k,B]=n.useState(null),[Ue,ae]=n.useState(null);n.useEffect(()=>{z.current!==a.id&&(z.current=a.id,v(!1),h("info"),T(!1),ae(xe(a)),Ne(),ye())},[a.id]),n.useEffect(()=>{ae(xe(a))},[a]);const ye=n.useCallback(async()=>{try{const[t,s,o]=await Promise.all([f.get("/api/role-templates").catch(()=>({roles:[]})),f.get("/api/timezones").catch(()=>({timezones:[]})),f.get("/api/contacts/metadata/companies").catch(()=>({companies:[]}))]);N((t.roles||[]).filter(r=>r&&(r.name||r.display_name)).map(r=>({id:r.id||r.name,label:r.display_name||r.name,value:r.display_name||r.name}))),L((s.timezones||[]).filter(r=>r&&r.name).map(r=>({id:r.id||r.code||r.name,label:`${r.name} (${r.code||""})`,value:r.code||r.name}))),V((o.companies||[]).filter(r=>r&&r.name).map(r=>({id:r.id||r.name,label:r.name,value:r.name})))}catch(t){console.error("Failed to load dropdown metadata",t)}},[]),_e=n.useCallback(()=>{i({name:a.name||"",role:a.role||"",organization:a.organization||"",email:a.email||"",phone:a.phone||"",linkedin:a.linkedin||"",department:a.department||"",location:a.location||"",timezone:a.timezone||"",notes:a.notes||""}),v(!0),h("info")},[a]),Me=n.useCallback(async()=>{if(m.name.trim()){y(!0);try{const t=await f.put(`/api/contacts/${a.id}`,m);if(t.ok===!1){c.error(t.error||"Failed to save contact");return}c.success("Contact updated"),v(!1),z.current=null,Ne(),ye(),x({...a,...m})}catch(t){c.error(t?.message||"Failed to save contact")}finally{y(!1)}}},[a,m,x,ye]),S=(t,s)=>i(o=>({...o,[t]:s})),Ne=async()=>{g(!0);try{const[t,s,o,r]=await Promise.all([f.get("/api/projects").catch(()=>({projects:[]})),f.get(`/api/contacts/${a.id}/projects`).catch(()=>({projects:[]})),f.get(`/api/contacts/${a.id}/relationships`).catch(()=>({relationships:[]})),f.get(`/api/contacts/${a.id}/activity`).catch(()=>({activities:[]}))]);ke(Array.isArray(t)?t:t.projects||[]);const F=s.projects||[],G=F.map(q=>q.id);U(G);const se=F.find(q=>q.is_primary);_(se?se.id:G[0]||null),Y(o.relationships||[]),Se(r.activities||[]);try{const q=await f.get(`/api/contacts/${a.id}/mentions`);he(q.mentions||[])}catch{he([])}try{const q=await f.get("/api/contacts");ve((q.contacts||[]).filter(ht=>ht.id!==a.id))}catch{ve([])}}catch(t){console.error("Error loading contact details:",t)}finally{g(!1)}},Ie=async t=>{const s=R.includes(t);try{if(s){await f.delete(`/api/contacts/${a.id}/projects/${t}`);const o=R.filter(F=>F!==t),r=X===t?null:X;U(o),_(r),l?.(a.id,o,r)}else{await f.post(`/api/contacts/${a.id}/projects`,{projectId:t});const o=[...R,t],r=X||t;U(o),_(r),l?.(a.id,o,r)}}catch(o){console.error("Error toggling project:",o)}},Te=async t=>{try{await f.post(`/api/contacts/${a.id}/projects`,{projectId:t,isPrimary:!0}),R.includes(t)||U(s=>[...s,t]),_(t)}catch(s){console.error("Error setting primary project",s)}},Le=async()=>{if(ee)try{const t=ue.find(r=>r.id===ee);if(!t)return;const o=(await f.post(`/api/contacts/${a.id}/relationships`,{toContactId:t.id,type:O})).relationship;Y(r=>[...r,{id:o.id,type:O,direction:"forward",other_contact:{id:t.id,name:t.name,role:t.role,avatarUrl:t.avatarUrl}}]),je(""),C(!1)}catch(t){console.error("Error adding relationship:",t)}},Ae={info:void 0,projects:R.length,relations:ge.length,mentions:M.length,activity:Z.length>0?Z.length:void 0};return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("button",{onClick:d,className:"flex items-center gap-1.5 text-xs text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors mb-2",children:[e.jsx(Ot,{className:"w-3.5 h-3.5"})," Back to Contacts"]}),e.jsxs("div",{className:at,children:[e.jsx("div",{className:`bg-gradient-to-r ${aa(a.name)} p-6 pb-14 rounded-t-xl relative`,children:e.jsxs("div",{className:"flex gap-2 absolute top-4 right-4",children:[e.jsxs("button",{className:re+" !bg-white/20 !text-white !border-0 hover:!bg-white/30 backdrop-blur-sm",disabled:fe.isPending,onClick:()=>{fe.mutate(a.id,{onSuccess:t=>{if(c.success("AI enrichment complete"),t?.suggestions){const s=t.suggestions,o=[];s.role&&o.push(`Role: ${s.role}`),s.department&&o.push(`Dept: ${s.department}`),s.tags&&o.push(`Tags: ${s.tags.join(", ")}`),o.length&&c.info(o.join(" | "))}z.current=null,Ne()},onError:()=>c.error("Enrichment failed")})},children:[fe.isPending?e.jsx(ne,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(dt,{className:"w-3.5 h-3.5"})," Enrich AI"]}),e.jsxs("button",{className:re+" !bg-white/20 !text-white !border-0 hover:!bg-white/30 backdrop-blur-sm",disabled:K.isPending,onClick:()=>{const t=a.display_name||a.name||"";if(!t){c.error("No participant name to unlink");return}K.mutate(t,{onSuccess:()=>c.success(`Unlinked participant "${t}"`),onError:()=>c.error("Unlink failed")})},children:[K.isPending?e.jsx(ne,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(xt,{className:"w-3.5 h-3.5"})," Unlink"]}),e.jsxs("button",{className:re+` !border-0 backdrop-blur-sm ${w?"!bg-blue-500/40 !text-white hover:!bg-blue-500/50":"!bg-white/20 !text-white hover:!bg-white/30"}`,onClick:w?()=>v(!1):_e,children:[e.jsx(Vt,{className:"w-3.5 h-3.5"})," ",w?"View":"Edit"]})]})}),e.jsx("div",{className:"px-6 -mt-10 relative z-10",children:e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsx(It,{currentUrl:Ue,name:a.name,uploadEndpoint:`/api/contacts/${a.id}/avatar`,deleteEndpoint:`/api/contacts/${a.id}/avatar`,onUploaded:t=>ae(t),onRemoved:()=>ae(null),size:"md",showUrlInput:!1,className:"!gap-0"}),e.jsxs("div",{className:"pb-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:w?m.name||a.name:a.name||"(unnamed)"}),e.jsxs("p",{className:"text-sm text-slate-300",children:[(w?m.role:a.role)||"—",(w?m.organization:a.organization)&&` · ${w?m.organization:a.organization}`]})]})]})}),e.jsx("div",{className:"flex border-b border-[var(--gm-border-primary)] overflow-x-auto mt-4 px-6",children:sa.map(t=>e.jsxs("button",{onClick:()=>h(t.id),className:`flex items-center gap-1.5 px-3 py-2.5 text-xs font-medium transition-colors border-b-2 whitespace-nowrap ${p===t.id?"text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] border-transparent hover:text-[var(--gm-text-primary)]"}`,children:[e.jsx(t.icon,{className:"w-4 h-4"}),t.label,Ae[t.id]!==void 0&&e.jsx("span",{className:"ml-1 text-[10px] px-1.5 py-0.5 rounded-full bg-[var(--gm-accent-primary)]/10 text-[var(--gm-accent-primary)] font-semibold",children:Ae[t.id]})]},t.id))}),b&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ne,{className:"w-6 h-6 animate-spin text-[var(--gm-accent-primary)]"})}),!b&&e.jsxs("div",{className:"p-6",children:[p==="info"&&e.jsx(e.Fragment,{children:w?e.jsxs("div",{className:"space-y-3",children:[e.jsx(ie,{icon:le,label:"Name *",field:"name",placeholder:"Full name",value:m.name,onChange:S}),e.jsx(Be,{icon:Q,label:"Role",field:"role",options:j,placeholder:"Select role...",value:m.role,onChange:S}),e.jsx(ie,{icon:we,label:"Email",field:"email",placeholder:"email@example.com",type:"email",value:m.email,onChange:S}),e.jsx(ie,{icon:De,label:"Phone",field:"phone",placeholder:"+351 900 000 000",type:"tel",value:m.phone,onChange:S}),e.jsx(Be,{icon:Ee,label:"Organization",field:"organization",options:D,placeholder:"Select organization...",value:m.organization,onChange:S}),e.jsx(ie,{icon:Qe,label:"LinkedIn",field:"linkedin",placeholder:"https://linkedin.com/in/...",value:m.linkedin,onChange:S}),e.jsx(ie,{icon:Q,label:"Department",field:"department",placeholder:"Engineering, Sales...",value:m.department,onChange:S}),e.jsx(ie,{icon:He,label:"Location",field:"location",placeholder:"Lisbon, Portugal",value:m.location,onChange:S}),e.jsx(Be,{icon:Ze,label:"Timezone",field:"timezone",options:H,placeholder:"Select timezone...",value:m.timezone,onChange:S}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-3 items-start",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--gm-text-tertiary)] pt-1.5",children:[e.jsx(We,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"})," Notes"]}),e.jsx("textarea",{value:m.notes,onChange:t=>S("notes",t.target.value),placeholder:"Additional notes...",rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3",children:[e.jsx("button",{className:re,onClick:()=>v(!1),children:"Cancel"}),e.jsxs("button",{className:st,disabled:I||!m.name.trim(),onClick:Me,children:[I?e.jsx(ne,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ve,{className:"w-3.5 h-3.5"}),I?"Saving...":"Save Changes"]})]})]}):e.jsxs("div",{children:[e.jsx($,{icon:le,label:"Name",value:a.name}),e.jsx($,{icon:Q,label:"Role",value:a.role}),e.jsx($,{icon:we,label:"Email",value:a.email}),e.jsx($,{icon:De,label:"Phone",value:a.phone}),e.jsx($,{icon:Ee,label:"Organization",value:a.organization}),e.jsx($,{icon:Qe,label:"LinkedIn",value:a.linkedin}),e.jsx($,{icon:Q,label:"Department",value:a.department}),e.jsx($,{icon:He,label:"Location",value:a.location}),e.jsx($,{icon:Ze,label:"Timezone",value:a.timezone}),a.aliases&&a.aliases.length>0&&e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-3 py-3 border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--gm-text-tertiary)]",children:[e.jsx(le,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"})," Aliases"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.aliases.map(t=>e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-[var(--gm-bg-tertiary)] rounded text-[var(--gm-text-tertiary)]",children:t},t))})]}),a.notes&&e.jsx($,{icon:We,label:"Notes",value:a.notes})]})}),p==="projects"&&e.jsx("div",{className:"space-y-1",children:W.map(t=>{const s=R.includes(t.id),o=X===t.id;return e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)] px-2 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer flex-1",onClick:()=>Ie(t.id),children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${s?"border-[var(--gm-accent-primary)] bg-[var(--gm-interactive-primary)]":"border-[var(--gm-border-primary)] hover:border-[var(--gm-text-tertiary)]"}`,children:s&&e.jsx(Ve,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-sm ${s?"text-[var(--gm-text-primary)]":"text-[var(--gm-text-tertiary)]"}`,children:t.name}),t.description&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] truncate max-w-[300px]",children:t.description})]})]}),o?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] font-semibold",children:"Primary"}):s?e.jsx("button",{onClick:r=>{r.stopPropagation(),Te(t.id)},className:"text-[10px] px-2 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:"Set Primary"}):null]},t.id)})}),p==="relations"&&e.jsxs(e.Fragment,{children:[ge.length>0?e.jsx("div",{className:"space-y-2",children:ge.map((t,s)=>{const o=(t.type||"").replace("_"," "),r=t.other_contact?.name||"Unknown";return e.jsxs("div",{className:"flex items-center gap-3 py-3 border-b border-[var(--gm-border-primary)] last:border-0 group/rel",children:[e.jsx(Je,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsxs("div",{className:"flex-1 flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-[var(--gm-text-primary)]",children:a.name}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)] text-xs px-1 bg-[var(--gm-bg-tertiary)] rounded",children:o}),e.jsx("span",{className:"font-medium text-[var(--gm-text-primary)]",children:r})]}),e.jsx("button",{className:"opacity-0 group-hover/rel:opacity-100 transition-opacity text-red-400/60 hover:text-red-400",title:"Remove relationship",onClick:()=>{t.other_contact?.id&&Re.mutate({contactId:a.id,toContactId:t.other_contact.id,type:t.type},{onSuccess:()=>{Y(F=>F.filter((G,se)=>se!==s)),c.success("Relationship removed")},onError:()=>c.error("Failed to remove relationship")})},children:e.jsx(Fe,{className:"w-3.5 h-3.5"})})]},s)})}):e.jsxs("div",{className:"flex flex-col items-center py-8 text-[var(--gm-text-tertiary)]",children:[e.jsx(Je,{className:"w-10 h-10 mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No relationships yet"})]}),be?e.jsxs("div",{className:"mt-3 p-3 rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-bg-tertiary)] space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(oe,{value:ee,onValueChange:je,children:[e.jsx(ce,{className:"text-sm",children:e.jsx(me,{placeholder:"Select contact"})}),e.jsx(de,{children:ue.map(t=>e.jsx(P,{value:t.id,children:t.name},t.id))})]}),e.jsxs(oe,{value:O,onValueChange:te,children:[e.jsx(ce,{className:"text-sm",children:e.jsx(me,{})}),e.jsxs(de,{children:[e.jsx(P,{value:"reports_to",children:"Reports to"}),e.jsx(P,{value:"manages",children:"Manages"}),e.jsx(P,{value:"leads",children:"Leads"}),e.jsx(P,{value:"works_with",children:"Works with"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:re+" flex-1",onClick:()=>{C(!1),je("")},children:"Cancel"}),e.jsx("button",{className:st+" flex-1",disabled:!ee,onClick:Le,children:"Add"})]})]}):e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-1.5 text-sm text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] mt-4 transition-colors",children:[e.jsx(Xe,{className:"w-4 h-4"})," Add Relationship"]})]}),p==="mentions"&&e.jsx(e.Fragment,{children:M.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 pb-2 overflow-x-auto",children:["all","document","email","conversation"].map(t=>e.jsxs("button",{onClick:()=>B(t==="all"?null:t),className:`text-xs px-2.5 py-1 rounded-full border transition-colors ${k===t||k===null&&t==="all"?"bg-[var(--gm-accent-primary)]/10 text-[var(--gm-accent-primary)] border-[var(--gm-accent-primary)]/20":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border-transparent hover:bg-[var(--gm-surface-hover)] hover:text-[var(--gm-text-primary)]"}`,children:[t.charAt(0).toUpperCase()+t.slice(1),"s"]},t))}),e.jsxs("div",{className:"space-y-2 pr-2",children:[M.filter(t=>!k||t.type===k).map(t=>e.jsxs("div",{className:"flex gap-3 py-3 border-b border-[var(--gm-border-primary)] last:border-0 group",children:[e.jsx("div",{className:"mt-0.5",children:t.type==="email"?e.jsx(we,{className:"w-3.5 h-3.5 text-blue-400"}):t.type==="conversation"?e.jsx(Ge,{className:"w-3.5 h-3.5 text-violet-400"}):e.jsx(jt,{className:"w-3.5 h-3.5 text-amber-400"})}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:t.source||"—"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] whitespace-nowrap ml-2",children:t.date?new Date(t.date).toLocaleDateString():"—"})]}),e.jsxs("p",{className:"text-sm text-[var(--gm-text-primary)] line-clamp-2 bg-[var(--gm-bg-tertiary)] p-2 rounded border border-[var(--gm-border-primary)] italic",children:['"',t.text,'"']}),t.link&&e.jsxs("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-[var(--gm-accent-primary)] hover:underline inline-flex items-center gap-1 mt-1 font-medium transition-colors",children:["View Context ",e.jsx(Bt,{className:"w-3 h-3"})]})]})]},t.id)),M.filter(t=>!k||t.type===k).length===0&&e.jsx("p",{className:"text-center text-sm text-[var(--gm-text-tertiary)] py-8",children:"No mentions found for this filter"})]})]}):e.jsxs("div",{className:"flex flex-col items-center py-8 text-[var(--gm-text-tertiary)]",children:[e.jsx(Ge,{className:"w-10 h-10 mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No mentions found"})]})}),p==="activity"&&e.jsx(e.Fragment,{children:Z.length>0?e.jsx("div",{className:"space-y-2",children:Z.map(t=>e.jsxs("div",{className:"flex items-center gap-3 py-3 border-b border-[var(--gm-border-primary)] last:border-0",children:[t.status==="completed"||t.status==="approved"?e.jsx(Ve,{className:"w-4 h-4 text-emerald-500 shrink-0"}):t.status==="overdue"||t.status==="rejected"?e.jsx(qe,{className:"w-4 h-4 text-red-400 shrink-0"}):e.jsx($e,{className:"w-4 h-4 text-[var(--gm-text-tertiary)] shrink-0"}),e.jsx("span",{className:"text-sm text-[var(--gm-text-primary)] flex-1 truncate",children:t.description}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] shrink-0",children:t.date?new Date(t.date).toLocaleDateString():"—"})]},`${t.type}-${t.id}`))}):e.jsxs("div",{className:"flex flex-col items-center py-8 text-[var(--gm-text-tertiary)]",children:[e.jsx($e,{className:"w-10 h-10 mb-2 opacity-40"}),e.jsx("p",{className:"text-sm",children:"No activity recorded yet"})]})})]}),e.jsx("div",{className:"px-6 py-4 border-t border-[var(--gm-border-primary)]",children:e.jsxs("div",{className:"p-4 rounded-lg border border-red-500/20 bg-red-500/5",children:[e.jsx("p",{className:"text-xs font-semibold text-red-500 mb-1",children:"Danger Zone"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-3",children:"Deleting this contact will remove all associated data."}),pe?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:rt,disabled:E,onClick:()=>{A(!0),u(a.id)},children:[E?e.jsx(ne,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ye,{className:"w-3.5 h-3.5"})," Confirm Delete"]}),e.jsx("button",{className:re,onClick:()=>T(!1),children:"Cancel"})]}):e.jsxs("button",{className:rt.replace("bg-[var(--color-danger-500)]","bg-red-500/10").replace("text-white","text-red-500")+" border border-red-500/30",onClick:()=>T(!0),children:[e.jsx(Ye,{className:"w-3.5 h-3.5"})," Delete Contact"]})]})})]}),e.jsx("div",{className:at,children:e.jsx(Lt,{targetType:"contact",targetId:a.id})})]})}const nt=["from-rose-400 to-pink-500","from-violet-400 to-purple-500","from-blue-400 to-cyan-500","from-emerald-400 to-teal-500","from-amber-400 to-orange-500","from-fuchsia-400 to-pink-500"],gt=a=>{let d=0;for(let x=0;x<a.length;x++)d=a.charCodeAt(x)+((d<<5)-d);return nt[Math.abs(d)%nt.length]};function ia({contact:a,size:d="md"}){const x=String(a.name||"?"),u=xe(a),l=d==="sm"?"w-7 h-7":d==="lg"?"w-16 h-16":"w-10 h-10",p=d==="sm"?"text-[9px]":d==="lg"?"text-lg":"text-xs";return e.jsx("div",{className:`${l} rounded-full bg-gradient-to-br ${gt(x)} flex items-center justify-center flex-shrink-0 overflow-hidden`,children:u?e.jsx("img",{src:u,alt:x,className:"w-full h-full rounded-full object-cover",onError:h=>{h.target.style.display="none"}}):e.jsx("span",{className:`${p} font-bold text-white`,children:mt(x)})})}function Ua(){const[a,d]=n.useState(""),[x,u]=n.useState(!1),[l,p]=n.useState(null),[h,b]=n.useState(null),[g,w]=n.useState(""),[v,I]=n.useState(""),[y,pe]=n.useState(!1),[T,E]=n.useState(!1),[A,z]=n.useState(new Set),[m,i]=n.useState(!1),[j,N]=n.useState(!1),[D,V]=n.useState({}),[H,L]=n.useState(!1),W=n.useRef(null),[ke,R]=n.useState(!1),[U,X]=n.useState({}),_=yt({search:a||void 0,organization:g||void 0}),ge=Nt(),Y=wt(),Z=Ct(),Se=kt(),M=St(),he=ct(),ue=At(),ve=zt(),fe=Ft(),Re=Et(),K=$t(),be=_.data,C=Array.isArray(be)?be:be?.contacts??[],ee=n.useMemo(()=>{const t=new Set;return C.forEach(s=>{s.organization&&t.add(s.organization)}),Array.from(t).sort()},[C]),je=n.useMemo(()=>{const t=new Set;return C.forEach(s=>{const o=s.tags;Array.isArray(o)&&o.forEach(r=>t.add(r))}),Array.from(t).sort()},[C]),O=n.useMemo(()=>{let t=C;return v&&(t=t.filter(s=>Array.isArray(s.tags)&&s.tags.includes(v))),y&&(t=t.filter(s=>s.is_favorite||s.isFavorite)),t},[C,v,y]),te=n.useMemo(()=>C.filter(t=>t.is_favorite||t.isFavorite),[C]),k=Se.data?.duplicates||[],B=fe.data?.unmatched||[],Ue=t=>{ge.mutate(t,{onSuccess:()=>{c.success("Contact created"),u(!1)},onError:()=>c.error("Failed to create contact")})},ae=t=>{l&&Y.mutate({id:l.id,...t},{onSuccess:()=>{c.success("Contact updated"),p(null),u(!1)},onError:()=>c.error("Failed to update contact")})},ye=t=>{Z.mutate(t,{onSuccess:()=>{c.success("Contact deleted"),b(null)},onError:()=>c.error("Failed to delete contact")})},_e=t=>{_.refetch()},Me=t=>{const s=t.is_favorite||t.isFavorite;Y.mutate({id:t.id,is_favorite:!s},{onSuccess:()=>c.success(s?"Removed from favorites":"Added to favorites"),onError:()=>c.error("Failed to update")})},S=t=>{z(s=>{const o=new Set(s);return o.has(t)?o.delete(t):o.add(t),o})},Ne=()=>{if(A.size<2){c.error("Select at least 2 contacts to merge");return}M.mutate(Array.from(A),{onSuccess:()=>{c.success("Contacts merged"),z(new Set),i(!1)},onError:()=>c.error("Merge failed")})},Ie=(t,s)=>{if(!D[t]){c.error("Select a primary contact");return}const r=s.map(F=>F.id);M.mutate(r,{onSuccess:()=>{c.success("Duplicates merged"),Se.refetch()},onError:()=>c.error("Merge failed")})},Te=t=>{he.mutate(t,{onSuccess:s=>{if(c.success("AI enrichment complete"),s?.suggestions){const o=s.suggestions,r=[];o.role&&r.push(`Role: ${o.role}`),o.department&&r.push(`Dept: ${o.department}`),o.tags&&r.push(`Tags: ${o.tags.join(", ")}`),r.length&&c.info(r.join(" | "))}_.refetch()},onError:()=>c.error("Enrichment failed")})},Le=t=>{const s=t.target.files?.[0];if(!s)return;const o=new FileReader;o.onload=()=>{const r=o.result;if(s.name.endsWith(".csv"))ve.mutate({format:"csv",data:r},{onSuccess:G=>{c.success(`Imported ${G?.added||0} contacts`),L(!1)},onError:()=>c.error("Import failed")});else try{const G=JSON.parse(r);ve.mutate({format:"json",data:G},{onSuccess:se=>{c.success(`Imported ${se?.added||0} contacts`),L(!1)},onError:()=>c.error("Import failed")})}catch{c.error("Invalid JSON file")}},o.readAsText(s),t.target.value=""},Ae=(t,s)=>{Re.mutate({participantName:t,contactId:s},{onSuccess:()=>c.success(`Linked "${t}"`),onError:()=>c.error("Link failed")})};return h?e.jsx(ra,{contact:h,onBack:()=>b(null),onEdit:_e,onDelete:ye}):x?e.jsxs("div",{className:"p-6 max-w-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:()=>{u(!1),p(null)},className:"w-8 h-8 rounded-lg bg-[var(--gm-bg-tertiary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(Fe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsx("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:l?"Edit Contact":"Add Contact"})]}),e.jsx("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-5",children:e.jsx(ta,{contact:l,mode:l?"edit":"add",onSubmit:l?ae:Ue,onCancel:()=>{u(!1),p(null)}})})]}):e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:"Contacts"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>K.mutate(void 0,{onSuccess:t=>c.success(`Synced: ${t?.added||0} added`),onError:()=>c.error("Sync failed")}),className:"px-2.5 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",title:"Sync people from documents to contacts",children:[e.jsx(Pt,{className:`w-3.5 h-3.5 ${K.isPending?"animate-spin":""}`})," Sync People"]}),B.length>0&&e.jsxs("button",{onClick:()=>R(!ke),className:"px-2.5 py-1.5 rounded-lg bg-amber-500/10 text-amber-600 text-xs hover:bg-amber-500/20 flex items-center gap-1.5",children:[e.jsx(Ke,{className:"w-3.5 h-3.5"})," ",B.length," Unmatched"]}),k.length>0&&e.jsxs("button",{onClick:()=>N(!j),className:"px-2.5 py-1.5 rounded-lg bg-orange-500/10 text-orange-600 text-xs hover:bg-orange-500/20 flex items-center gap-1.5",children:[e.jsx(qe,{className:"w-3.5 h-3.5"})," ",k.length," Duplicate groups"]}),e.jsxs("button",{onClick:()=>{i(!m),z(new Set)},className:`px-2.5 py-1.5 rounded-lg text-xs flex items-center gap-1.5 ${m?"bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)]":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsx(et,{className:"w-3.5 h-3.5"})," Select"]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"px-2.5 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(Dt,{className:"w-3.5 h-3.5"})," Export ",e.jsx(Rt,{className:"w-3 h-3"})]}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-20 min-w-[120px]",children:[e.jsxs("button",{onClick:()=>ue.mutate("json"),className:"w-full px-3 py-2 text-xs text-left hover:bg-[var(--gm-surface-hover)] flex items-center gap-2 rounded-t-lg",children:[e.jsx(Gt,{className:"w-3.5 h-3.5"})," JSON"]}),e.jsxs("button",{onClick:()=>ue.mutate("csv"),className:"w-full px-3 py-2 text-xs text-left hover:bg-[var(--gm-surface-hover)] flex items-center gap-2 rounded-b-lg",children:[e.jsx(Wt,{className:"w-3.5 h-3.5"})," CSV"]})]})]}),e.jsxs("button",{onClick:()=>W.current?.click(),className:"px-2.5 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(qt,{className:"w-3.5 h-3.5"})," Import"]}),e.jsx("input",{ref:W,type:"file",accept:".json,.csv",className:"hidden",onChange:Le}),e.jsxs("button",{onClick:()=>{p(null),u(!0)},className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-xs font-medium hover:bg-[var(--gm-interactive-primary-hover)] flex items-center gap-1.5",children:[e.jsx(Xe,{className:"w-3.5 h-3.5"})," Add Contact"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("div",{className:"relative max-w-sm flex-1 min-w-[200px]",children:[e.jsx(Ut,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{value:a,onChange:t=>d(t.target.value),placeholder:"Search contacts...",className:"w-full pl-9 pr-3 py-1.5 bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg text-xs text-[var(--gm-text-primary)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)]"})]}),e.jsxs("button",{onClick:()=>E(!T),className:`px-2.5 py-1.5 rounded-lg text-xs flex items-center gap-1.5 ${g||v||y?"bg-[var(--gm-interactive-primary)]/10 text-[var(--gm-accent-primary)] border border-[var(--gm-accent-primary)]/30":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsx(Jt,{className:"w-3.5 h-3.5"})," Filters",(g||v||y)&&e.jsx("span",{className:"px-1.5 py-0.5 rounded-full bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-[10px]",children:[g,v,y].filter(Boolean).length})]}),e.jsxs("button",{onClick:()=>pe(!y),className:`px-2.5 py-1.5 rounded-lg text-xs flex items-center gap-1.5 ${y?"bg-amber-500/10 text-amber-500 border border-amber-500/30":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsx(ze,{className:`w-3.5 h-3.5 ${y?"fill-amber-500":""}`})," Favorites ",te.length>0&&`(${te.length})`]})]}),T&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Organization:"}),e.jsxs("select",{value:g,onChange:t=>w(t.target.value),className:"px-2 py-1 bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)] rounded text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"",children:"All"}),ee.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Tag:"}),e.jsxs("select",{value:v,onChange:t=>I(t.target.value),className:"px-2 py-1 bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)] rounded text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"",children:"All"}),je.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),(g||v)&&e.jsx("button",{onClick:()=>{w(""),I("")},className:"text-xs text-[var(--gm-accent-primary)] hover:underline",children:"Clear filters"})]}),m&&A.size>0&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-[var(--gm-interactive-primary)]/5 border border-[var(--gm-accent-primary)]/20",children:[e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] font-medium",children:[A.size," selected"]}),e.jsxs("button",{onClick:Ne,disabled:A.size<2||M.isPending,className:"px-2.5 py-1 rounded bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-xs flex items-center gap-1.5 disabled:opacity-50",children:[e.jsx(tt,{className:"w-3.5 h-3.5"})," Merge Selected"]}),e.jsx("button",{onClick:()=>{z(new Set),i(!1)},className:"text-xs text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:"Cancel"})]}),ke&&B.length>0&&e.jsxs("div",{className:"p-4 rounded-xl border border-amber-500/30 bg-amber-500/5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-amber-500"})," Unmatched Participants (",B.length,")"]}),e.jsx("button",{onClick:()=>R(!1),className:"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(Fe,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-[11px] text-[var(--gm-text-tertiary)]",children:"These names were found in documents but don't match any contact. Link them to existing contacts."}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:B.map(t=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)]",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)] flex-1",children:t.name}),t.count&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[t.count," mentions"]}),e.jsxs("select",{value:U[t.name]||"",onChange:s=>X(o=>({...o,[t.name]:s.target.value})),className:"px-2 py-1 bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded text-xs max-w-[150px]",children:[e.jsx("option",{value:"",children:"Link to..."}),C.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("button",{disabled:!U[t.name],onClick:()=>U[t.name]&&Ae(t.name,U[t.name]),className:"px-2 py-1 rounded bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-[10px] disabled:opacity-40 flex items-center gap-1",children:[e.jsx(xt,{className:"w-3 h-3"})," Link"]})]},t.name))})]}),j&&k.length>0&&e.jsxs("div",{className:"p-4 rounded-xl border border-orange-500/30 bg-orange-500/5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-orange-500"})," Duplicate Groups (",k.length,")"]}),e.jsx("button",{onClick:()=>N(!1),className:"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(Fe,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:k.map((t,s)=>{const o=Array.isArray(t)?t:t.contacts||[t];return e.jsxs("div",{className:"p-3 rounded-lg bg-[var(--gm-bg-primary)] border border-[var(--gm-border-primary)] space-y-2",children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:["Group ",s+1," — Select primary"]}),o.map(r=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-1 rounded hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("input",{type:"radio",name:`merge-group-${s}`,checked:D[s]===r.id,onChange:()=>V(F=>({...F,[s]:r.id})),className:"accent-primary"}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:r.name}),r.email&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["(",r.email,")"]})]},r.id)),e.jsxs("button",{onClick:()=>Ie(s,o),disabled:!D[s]||M.isPending,className:"px-2.5 py-1 rounded bg-orange-500 text-white text-xs disabled:opacity-50 flex items-center gap-1",children:[e.jsx(tt,{className:"w-3 h-3"})," Merge Group"]})]},s)})})]}),te.length>0&&!y&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)] mb-2 flex items-center gap-1",children:[e.jsx(ze,{className:"w-3 h-3 fill-amber-500 text-amber-500"})," Favorites"]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:te.map(t=>e.jsxs("button",{onClick:()=>b(t),className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] hover:border-[var(--gm-accent-primary)]/30 flex-shrink-0",children:[e.jsx(ia,{contact:t,size:"sm"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:t.name}),t.role&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:t.role})]})]},t.id))})]}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:[O.length," contact",O.length!==1?"s":""]}),_.isLoading?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(ne,{className:"h-8 w-8 animate-spin text-[var(--gm-accent-primary)]"})}):O.length===0?e.jsxs("div",{className:"rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] p-8 text-center text-[var(--gm-text-tertiary)]",children:[e.jsx(_t,{className:"h-12 w-12 mx-auto mb-4 text-[var(--gm-text-tertiary)]/40"}),a||g||v?"No contacts match your filters.":"No contacts found. Add one to get started."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:O.map(t=>{const s=t.is_favorite||t.isFavorite,o=A.has(t.id);return e.jsxs("div",{className:`bg-[var(--gm-surface-primary)] border rounded-xl p-4 hover:border-[var(--gm-accent-primary)]/30 transition-colors cursor-pointer group relative ${o?"border-[var(--gm-accent-primary)] bg-[var(--gm-interactive-primary)]/5":"border-[var(--gm-border-primary)]"}`,onClick:()=>m?S(t.id):b(t),children:[m&&e.jsx("div",{className:"absolute top-3 left-3 z-10",children:o?e.jsx(et,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}):e.jsx(Qt,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsx("button",{className:"absolute top-3 right-3 z-10 opacity-0 group-hover:opacity-100 transition-opacity",onClick:r=>{r.stopPropagation(),Me(t)},title:s?"Remove from favorites":"Add to favorites",children:e.jsx(ze,{className:`w-4 h-4 ${s?"fill-amber-500 text-amber-500":"text-[var(--gm-text-tertiary)] hover:text-amber-500"}`})}),e.jsx("button",{className:"absolute top-3 right-9 z-10 opacity-0 group-hover:opacity-100 transition-opacity",onClick:r=>{r.stopPropagation(),Te(t.id)},title:"Enrich with AI",children:e.jsx(dt,{className:`w-4 h-4 text-violet-400 hover:text-violet-300 ${he.isPending?"animate-pulse":""}`})}),e.jsxs("div",{className:`flex items-center gap-3 ${m?"ml-5":""}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-br ${gt(t.name)} flex items-center justify-center flex-shrink-0 overflow-hidden`,children:xe(t)?e.jsx("img",{src:xe(t),alt:t.name,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-xs font-bold text-white",children:mt(t.name)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate group-hover:text-[var(--gm-accent-primary)] transition-colors",children:[t.name||"(unnamed)",s&&e.jsx(ze,{className:"w-3 h-3 inline ml-1 fill-amber-500 text-amber-500"})]}),t.role&&e.jsxs("div",{className:"flex items-center gap-1 mt-0.5",children:[e.jsx(Q,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] truncate",children:t.role})]})]})]}),e.jsxs("div",{className:"mt-3 space-y-1",children:[t.organization&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx(Ee,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:t.organization})]}),t.email&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx(we,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:t.email})]}),t.phone&&e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-[var(--gm-text-tertiary)]",children:[e.jsx(De,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:t.phone})]}),t.tags&&t.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[t.tags.slice(0,4).map(r=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:r},r)),t.tags.length>4&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:["+",t.tags.length-4]})]})]})]},t.id)})})]})}export{Ua as default};
//# sourceMappingURL=ContactsPage-Ca1GNAo9.js.map
