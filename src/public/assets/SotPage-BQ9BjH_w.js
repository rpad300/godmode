import{r as n,j as e}from"./vendor-react-CZ-WyKWZ.js";import{E as dt}from"./ErrorState-to3SSPKs.js";import{S as mt}from"./PageSkeleton-q10Tfh5l.js";import{f as xt,ac as pe,X as ae,H as xe,c as R,P as pt,ad as gt,g as ut,V as G,ae as ht,L as $,a9 as ge,a8 as oe,a5 as vt,af as bt,w as Oe,C as be,T as yt,a6 as ft,ag as jt,ah as Nt,l as et,ai as tt,J as Ae,aj as wt,ab as Se,ak as kt,al as St,am as Ct,an as At,ao as It,ap as Dt,aq as _t,b as Mt,j as Lt,ar as Et,as as $t,a3 as Ft,a2 as Rt,at as Pt,e as Ot,a4 as zt,au as Tt,av as Ut,aw as Qt,ax as Ht,ay as Vt,az as Bt,aA as Gt,aB as Wt,aC as Jt,aD as Zt,aE as Kt,aF as Xt,aG as Yt,aH as qt,aI as es,aJ as ts,aK as ss,aL as rs,aM as as,aN as is,aO as ns,aP as ls,aQ as cs,aR as os,aS as ds,aT as ms,aU as xs,G as ps,Z as gs,aV as us}from"./main-B3DZn5B_.js";import{t as y,m as M,A as X}from"./vendor-ui-BS9QKitv.js";import{O as ie}from"./OwnerBadge-De84pRkr.js";import{W as re}from"./wand-sparkles-GsBQJb1C.js";import{S as H}from"./sparkles-D3iJUPqd.js";import{A as ye}from"./arrow-left-BUrpeDp8.js";import{P as ue}from"./pen-UIQK8jUR.js";import{B as Ie}from"./book-open-CD3TXH-Z.js";import{L as hs}from"./list-Bt3ZTO_1.js";import{L as vs}from"./layers-Bgf9ppPM.js";import{G as bs}from"./globe-BYeHHetr.js";import{F as ys}from"./file-braces-CKRIsa3C.js";import{H as fs}from"./heart-4_aj9O5X.js";import{H as Ke}from"./history-CfQJo6RW.js";import{A as js}from"./arrow-up-right-Bo3g-__Q.js";import{A as Ns}from"./arrow-down-right-B0obbrFU.js";import{M as ws}from"./minus-Dq-7J-8u.js";import{L as ks}from"./lightbulb-0ivikuj5.js";import{R as Ce}from"./rotate-cw-wbVSlX31.js";import"./skeleton-CD8xV6MY.js";import"./vendor-query-DSf7I7Ei.js";import"./vendor-supabase-Bpw_79gH.js";import"./vendor-router-D_XeKoA_.js";import"./vendor-markdown-Cu8AM8lU.js";const Xe=["from-blue-500 to-cyan-400","from-purple-500 to-pink-400","from-amber-500 to-orange-400","from-emerald-500 to-teal-400","from-rose-500 to-red-400","from-indigo-500 to-violet-400"];function Ss(t){let m=0;for(let f=0;f<t.length;f++)m=(m<<5)-m+t.charCodeAt(f)|0;return Xe[Math.abs(m)%Xe.length]}function Cs({contact:t,size:m="sm"}){const f=m==="sm"?"w-7 h-7":"w-9 h-9",a=m==="sm"?"text-[9px]":"text-[11px]",c=t.avatarUrl||t.avatar||t.photo_url,b=gt(c)?c:null;return b?e.jsx("img",{src:b,alt:t.name,className:R(f,"rounded-full object-cover")}):e.jsx("div",{className:R(f,"rounded-full bg-gradient-to-br flex items-center justify-center shrink-0",Ss(t.name)),children:e.jsx("span",{className:R(a,"font-bold text-white"),children:ut(t.name||"?")})})}function Ye({contact:t,size:m="sm"}){const f=t.cargo||t.role||"",a=t.empresa||t.organization||"";return e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Cs,{contact:t,size:m}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:R("font-medium truncate text-[var(--gm-text-primary)]",m==="sm"?"text-[11px]":"text-xs"),children:t.name}),(f||a)&&e.jsx("div",{className:R("truncate text-[var(--gm-text-tertiary)]",m==="sm"?"text-[9px]":"text-[10px]"),children:[f,a].filter(Boolean).join(" · ")})]})]})}function _e({value:t,onChange:m,placeholder:f="Select owner...",label:a,className:c}){const[b,r]=n.useState(!1),[s,g]=n.useState(""),u=n.useRef(null),w=n.useRef(null),{data:h}=xt(),l=h?.contacts??[],o=l.filter(j=>{if(!s)return!0;const A=s.toLowerCase();return j.name?.toLowerCase().includes(A)||(j.role||j.cargo||"")?.toLowerCase().includes(A)||(j.organization||j.empresa||"")?.toLowerCase().includes(A)||j.email?.toLowerCase().includes(A)}),S=l.find(j=>j.name===t||j.id===t);return n.useEffect(()=>{function j(A){u.current&&!u.current.contains(A.target)&&r(!1)}return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]),n.useEffect(()=>{b&&w.current&&w.current.focus()},[b]),e.jsxs("div",{ref:u,className:R("relative",c),children:[a&&e.jsx("label",{className:"block text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-1.5",children:a}),e.jsxs("button",{type:"button",onClick:()=>r(!b),className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] text-left hover:border-[var(--gm-accent-primary)]/50 transition-colors",children:[S?e.jsx(Ye,{contact:S,size:"sm"}):t?e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-[var(--gm-bg-tertiary)] flex items-center justify-center shrink-0",children:e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})}),e.jsx("span",{className:"text-[11px] text-[var(--gm-text-secondary)] truncate",children:t})]}):e.jsx("span",{className:"text-[11px] text-[var(--gm-text-tertiary)] flex-1",children:f}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[t&&e.jsx("span",{onClick:j=>{j.stopPropagation(),m("")},className:"p-0.5 hover:bg-[var(--gm-bg-tertiary)] rounded cursor-pointer",children:e.jsx(ae,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"})}),e.jsx(xe,{className:R("w-3.5 h-3.5 text-[var(--gm-text-tertiary)] transition-transform",b&&"rotate-180")})]})]}),b&&e.jsxs("div",{className:"absolute z-50 mt-1 w-full rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-xl overflow-hidden",children:[e.jsx("div",{className:"p-2 border-b border-[var(--gm-border-primary)]",children:e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded-lg bg-[var(--gm-bg-tertiary)]",children:[e.jsx(pt,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{ref:w,type:"text",value:s,onChange:j=>g(j.target.value),placeholder:"Search contacts...",className:"flex-1 bg-transparent text-xs text-[var(--gm-text-primary)] outline-none placeholder:text-[var(--gm-text-tertiary)]"})]})}),e.jsx("div",{className:"max-h-64 overflow-y-auto p-1",children:o.length>0?o.map(j=>e.jsx("button",{type:"button",onClick:()=>{m(j.name),r(!1),g("")},className:R("w-full px-2 py-2 rounded-lg flex items-center gap-2 hover:bg-[var(--gm-surface-hover)] transition-colors",(j.name===t||j.id===t)&&"bg-[var(--gm-accent-primary)]/10"),children:e.jsx(Ye,{contact:j,size:"sm"})},j.id)):e.jsxs("div",{className:"px-3 py-4 text-center",children:[e.jsx(pe,{className:"w-5 h-5 text-[var(--gm-text-tertiary)] mx-auto mb-1"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No contacts found"})]})})]})]})}const st=t=>t==="answered"?"bg-green-500/10 text-green-400":t==="dismissed"?"bg-white/5 text-slate-400":"bg-blue-500/10 text-blue-400",rt=t=>t==="high"?"bg-red-500/10 text-red-400":t==="medium"?"bg-yellow-500/10 text-yellow-400":"bg-white/5 text-slate-400",As=({open:t,onClose:m,onSave:f,question:a,mode:c})=>{const b={content:"",priority:"medium",status:"open",source:"",assignee:""},[r,s]=n.useState(b),[g,u]=n.useState(null),w=G();n.useEffect(()=>{if(a&&c==="edit"){const{id:o,...S}=a;s(S)}else s(b)},[a,c,t]);const h=async()=>{u("suggest"),w.mutate({message:"Suggest one important question that should be asked about this project. Return only the question text, no explanation."},{onSuccess:o=>{const S=o?.response;S&&s(j=>({...j,content:S.replace(/^["']|["']$/g,"").trim()})),u(null),y.success("AI suggestion applied")},onError:()=>{u(null),y.error("AI suggestion failed")}})},l=async()=>{if(!r.content){y.error("Add a question first");return}u("answer"),w.mutate({message:`Answer this question based on the project knowledge: "${r.content}". Be concise and factual.`},{onSuccess:o=>{const S=o?.response;S&&s(j=>({...j,answer:S,status:"answered"})),u(null),y.success("AI generated answer")},onError:()=>{u(null),y.error("AI answer failed")}})};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:m}),e.jsx(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:c==="create"?"New Question":"Edit Question"}),e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg hover:bg-[var(--gm-surface-hover)] flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsxs("div",{className:"px-5 pt-4 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:h,disabled:!!g,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 disabled:opacity-50",children:[g==="suggest"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Suggest Question"]}),e.jsxs("button",{type:"button",onClick:l,disabled:!!g,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[g==="answer"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"})," AI Answer"]})]}),e.jsxs("form",{onSubmit:o=>{o.preventDefault(),r.content.trim()&&(f({id:a?.id||String(Date.now()),...r}),m())},className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Question *"}),e.jsx("textarea",{value:r.content,onChange:o=>s({...r,content:o.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[80px] resize-y",placeholder:"Type your question...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Priority"}),e.jsxs("select",{value:r.priority,onChange:o=>s({...r,priority:o.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Status"}),e.jsxs("select",{value:r.status,onChange:o=>s({...r,status:o.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"answered",children:"Answered"}),e.jsx("option",{value:"dismissed",children:"Dismissed"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(_e,{value:r.assignee||"",onChange:o=>s({...r,assignee:o}),label:"Assignee",placeholder:"Select assignee..."}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Source"}),e.jsx("input",{value:r.source,onChange:o=>s({...r,source:o.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Where did this come from?"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Answer"}),e.jsx("textarea",{value:r.answer||"",onChange:o=>s({...r,answer:o.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[60px] resize-y",placeholder:"Answer (if known)..."})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:c==="create"?"Create":"Save"})]})]})]})})]})})},Is=({question:t,onBack:m,onEdit:f,onDelete:a})=>{const[c,b]=n.useState(null),[r,s]=n.useState([]),g=G(),u=async()=>{b("analyze"),g.mutate({message:`Analyze this project question and provide 3 actionable insights:
Question: "${t.content}"
Status: ${t.status}
Priority: ${t.priority}
Assignee: ${t.assignee||"none"}
Source: ${t.source||"unknown"}`},{onSuccess:w=>{const h=w?.response;h&&s(h.split(`
`).filter(l=>l.trim())),b(null),y.success("AI analysis complete")},onError:()=>{b(null),y.error("AI analysis failed")}})};return e.jsxs(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:"Question Detail"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["#",t.id]})]}),e.jsxs("button",{onClick:u,disabled:!!c,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[c==="analyze"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Analyze"]}),e.jsxs("button",{onClick:()=>f(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Edit"]}),a&&e.jsxs("button",{onClick:()=>{a(t.id),m()},className:"px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs hover:bg-red-500/20 flex items-center gap-1.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${st(t.status)}`,children:t.status||"—"}),e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${rt(t.priority)}`,children:t.priority||"—"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Question"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.content||"(no content)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Assignee"})]}),t.assignee?e.jsx(ie,{name:t.assignee,size:"md"}):e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Unassigned"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(vt,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Source"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.source||"—"})]})]}),t.answer&&e.jsxs("div",{className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2",children:"Answer"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.answer})]}),r.length>0&&e.jsxs(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Insights"]}),e.jsx("ul",{className:"space-y-1.5",children:r.map((w,h)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:w},h))})]})]})},Ds=({initialData:t=[],onSave:m,onDelete:f})=>{const[a,c]=n.useState(t),b=G(),r=ht();n.useEffect(()=>{t&&c(t)},[t]);const[s,g]=n.useState("all"),[u,w]=n.useState("all"),[h,l]=n.useState(!1),[o,S]=n.useState("create"),[j,A]=n.useState(null),[E,P]=n.useState(null),[N,k]=n.useState(!1),I=n.useMemo(()=>{let x=a;return s!=="all"&&(x=x.filter(_=>_.status===s)),u!=="all"&&(x=x.filter(_=>_.priority===u)),x},[a,s,u]),O=n.useMemo(()=>({total:a.length,open:a.filter(x=>x.status==="open").length,answered:a.filter(x=>x.status==="answered").length,dismissed:a.filter(x=>x.status==="dismissed").length}),[a]),d=x=>{c(_=>{const T=_.findIndex(U=>U.id===x.id);if(T>=0){const U=[..._];return U[T]=x,U}return[..._,x]}),m?.(x)},D=x=>{c(_=>_.filter(T=>T.id!==x)),f?.(x),y.success("Question deleted")},v=async()=>{k(!0),b.mutate({message:"Based on the current project knowledge, suggest one new important question that should be raised. Return the question text only, and a suggested priority (high/medium/low) on a second line."},{onSuccess:x=>{const _=x?.response;if(_){const U=_.split(`
`).filter(V=>V.trim())[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||_.trim(),Z=_.toLowerCase().match(/(high|medium|low)/),B={id:`ai-${Date.now()}`,content:U,priority:Z?.[1]||"medium",status:"open",source:"AI Analysis"};c(V=>[...V,B]),m?.(B)}k(!1),y.success("AI suggested a new question")},onError:()=>{k(!1),y.error("AI suggestion failed")}})};return E?e.jsx(Is,{question:E,onBack:()=>P(null),onEdit:x=>{P(null),A(x),S("edit"),l(!0)},onDelete:D}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Total",value:O.total,color:"text-[var(--gm-text-primary)]"},{label:"Open",value:O.open,color:"text-primary"},{label:"Answered",value:O.answered,color:"text-green-400"},{label:"Dismissed",value:O.dismissed,color:"text-[var(--gm-text-tertiary)]"}].map(x=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${x.color}`,children:x.value}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:x.label})]},x.label))}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{value:s,onChange:x=>g(x.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"answered",children:"Answered"}),e.jsx("option",{value:"dismissed",children:"Dismissed"})]}),e.jsxs("select",{value:u,onChange:x=>w(x.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>r.mutate(void 0,{onSuccess:x=>y.success(`Enriched ${x?.enriched??0} questions with AI-assigned people`)}),disabled:r.isPending,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[r.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"})," AI Enrich"]}),e.jsxs("button",{onClick:v,disabled:N,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[N?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," AI Suggest"]}),e.jsxs("button",{onClick:()=>{A(null),S("create"),l(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Add Question"]})]}),e.jsx("div",{className:"space-y-2",children:I.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No questions match the current filter"}):I.map(x=>e.jsxs(M.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>P(x),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] group-hover:text-blue-400 transition-colors flex-1",children:x.content||"(no content)"}),e.jsxs("div",{className:"flex gap-1.5 flex-shrink-0",children:[e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${rt(x.priority)}`,children:x.priority||"—"}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${st(x.status)}`,children:x.status||"—"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2.5",children:[x.assignee?e.jsx(ie,{name:x.assignee,size:"sm"}):e.jsx("span",{className:"text-[11px] text-[var(--gm-text-tertiary)]",children:"Unassigned"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:x.source||""})]}),x.answer&&e.jsx("p",{className:"text-xs text-purple-400 mt-2 line-clamp-1",children:x.answer})]},x.id))}),e.jsx(As,{open:h,onClose:()=>l(!1),onSave:d,question:j,mode:o})]})},ze=t=>t==="technical"?"bg-blue-500/10 text-blue-400":t==="process"?"bg-purple-500/10 text-purple-400":t==="policy"?"bg-yellow-500/10 text-yellow-400":t==="people"?"bg-red-500/10 text-red-400":"bg-white/5 text-slate-400",at=t=>t>=.9?"text-green-400":t>=.7?"text-yellow-400":"text-red-400",_s=({open:t,onClose:m,onSave:f,fact:a,mode:c})=>{const b={content:"",category:"technical",source:"",confidence:.8,createdAt:new Date().toISOString().split("T")[0]},[r,s]=n.useState(b),[g,u]=n.useState(null),w=G();n.useEffect(()=>{if(a&&c==="edit"){const{id:l,...o}=a;s(o)}else s(b)},[a,c,t]);const h=async()=>{if(!r.content){y.error("Add content first");return}u("refine"),w.mutate({message:`Refine and verify this fact against project knowledge. Rewrite it more precisely if needed and estimate confidence (0.0-1.0):
"${r.content}"`},{onSuccess:l=>{const o=l?.response;if(o){const S=o.match(/(\d\.\d+)/);s(j=>({...j,content:o.replace(/confidence[:\s]*\d\.\d+/i,"").trim(),confidence:Math.min(S?parseFloat(S[1]):j.confidence+.05,1)}))}u(null),y.success("Fact refined with AI")},onError:()=>{u(null),y.error("AI refinement failed")}})};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:m}),e.jsx(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:c==="create"?"New Fact":"Edit Fact"}),e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg hover:bg-[var(--gm-surface-hover)] flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsx("div",{className:"px-5 pt-4 flex gap-2",children:e.jsxs("button",{type:"button",onClick:h,disabled:!!g,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[g==="refine"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"})," Refine with AI"]})}),e.jsxs("form",{onSubmit:l=>{l.preventDefault(),r.content.trim()&&(f({id:a?.id||String(Date.now()),...r}),m())},className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Content *"}),e.jsx("textarea",{value:r.content,onChange:l=>s({...r,content:l.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[80px] resize-y",placeholder:"State the fact...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Category"}),e.jsxs("select",{value:r.category,onChange:l=>s({...r,category:l.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"technical",children:"Technical"}),e.jsx("option",{value:"process",children:"Process"}),e.jsx("option",{value:"policy",children:"Policy"}),e.jsx("option",{value:"people",children:"People"}),e.jsx("option",{value:"timeline",children:"Timeline"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Confidence"}),e.jsx("input",{type:"number",min:0,max:1,step:.05,value:r.confidence,onChange:l=>s({...r,confidence:parseFloat(l.target.value)}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Source"}),e.jsx("input",{value:r.source,onChange:l=>s({...r,source:l.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Document or meeting source..."})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:c==="create"?"Create":"Save"})]})]})]})})]})})},Ms=({fact:t,onBack:m,onEdit:f,onDelete:a})=>{const[c,b]=n.useState(!1),[r,s]=n.useState([]),g=G(),u=bt(t.id),w=async()=>{b(!0),g.mutate({message:`Verify this fact against the project knowledge base. Check accuracy, find related/conflicting facts, and assess confidence:
Fact: "${t.content}"
Category: ${t.category}
Current confidence: ${Math.round(t.confidence*100)}%
Source: ${t.source}`},{onSuccess:h=>{const l=h?.response;l&&s(l.split(`
`).filter(o=>o.trim())),b(!1),y.success("AI verification complete")},onError:()=>{b(!1),y.error("AI verification failed")}})};return e.jsxs(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:"Fact Detail"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["#",t.id]})]}),e.jsxs("button",{onClick:w,disabled:c,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[c?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Verify"]}),e.jsxs("button",{onClick:()=>f(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Edit"]}),a&&e.jsxs("button",{onClick:()=>{a(t.id),m()},className:"px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs hover:bg-red-500/20 flex items-center gap-1.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${ze(t.category)}`,children:t.category||"—"}),e.jsxs("span",{className:`text-xs px-3 py-1 rounded-full font-medium bg-[var(--gm-interactive-secondary)] ${at(t.confidence)}`,children:[Math.round(t.confidence*100),"% confidence"]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Content"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.content||"(no content)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Source"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.source||"—"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(be,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Extracted"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.createdAt||"—"})]})]}),r.length>0&&e.jsxs(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Verification"]}),e.jsx("ul",{className:"space-y-1.5",children:r.map((h,l)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:h},l))})]}),u.data&&u.data.length>0&&e.jsxs(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," Similar Facts"]}),e.jsx("ul",{className:"space-y-2",children:u.data.map((h,l)=>e.jsxs("li",{className:"text-sm text-[var(--gm-text-primary)] bg-[var(--gm-surface-primary)] rounded-lg p-3 border border-[var(--gm-border-primary)]",children:[e.jsx("p",{children:h.content??"—"}),h.similarity!=null&&e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] mt-1 inline-block",children:[Math.round(Number(h.similarity)*100),"% match"]})]},l))})]}),u.isLoading&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[var(--gm-text-tertiary)]",children:[e.jsx($,{className:"w-3.5 h-3.5 animate-spin"})," Loading similar facts..."]})]})},Ls=({initialData:t=[],onSave:m,onDelete:f})=>{const[a,c]=n.useState(t),b=G();n.useEffect(()=>{t&&c(t)},[t]);const[r,s]=n.useState("all"),[g,u]=n.useState(!1),[w,h]=n.useState("create"),[l,o]=n.useState(null),[S,j]=n.useState(null),[A,E]=n.useState(!1),P=n.useMemo(()=>r==="all"?a:a.filter(d=>d.category===r),[a,r]),N=n.useMemo(()=>{const d={};return a.forEach(D=>{d[D.category]=(d[D.category]||0)+1}),{total:a.length,categories:d,avgConfidence:a.length?a.reduce((D,v)=>D+v.confidence,0)/a.length:0}},[a]),k=d=>{c(D=>{const v=D.findIndex(x=>x.id===d.id);if(v>=0){const x=[...D];return x[v]=d,x}return[...D,d]}),m?.(d)},I=d=>{c(D=>D.filter(v=>v.id!==d)),f?.(d),y.success("Fact deleted")},O=async()=>{E(!0),b.mutate({message:"Based on the project knowledge, extract one important fact that is not yet documented. Return on line 1: the fact text. Line 2: category (technical/process/policy/people/timeline). Line 3: confidence (0.0-1.0)."},{onSuccess:d=>{const D=d?.response;if(D){const x=D.split(`
`).filter(Z=>Z.trim())[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||D.trim(),_=D.toLowerCase().match(/(technical|process|policy|people|timeline)/),T=D.match(/(\d\.\d+)/),U={id:`ai-${Date.now()}`,content:x,category:_?.[1]||"technical",source:"AI Analysis",confidence:T?parseFloat(T[1]):.8,createdAt:new Date().toISOString().split("T")[0]};c(Z=>[...Z,U]),m?.(U)}E(!1),y.success("AI extracted a new fact")},onError:()=>{E(!1),y.error("AI extraction failed")}})};return S?e.jsx(Ms,{fact:S,onBack:()=>j(null),onEdit:d=>{j(null),o(d),h("edit"),u(!0)},onDelete:I}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:N.total}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Total"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-bold text-purple-400",children:[Math.round(N.avgConfidence*100),"%"]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Avg Confidence"})]}),Object.entries(N.categories).map(([d,D])=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${ze(d).split(" ")[1]}`,children:D}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:d})]},d))]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{value:r,onChange:d=>s(d.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All categories"}),e.jsx("option",{value:"technical",children:"Technical"}),e.jsx("option",{value:"process",children:"Process"}),e.jsx("option",{value:"policy",children:"Policy"}),e.jsx("option",{value:"people",children:"People"}),e.jsx("option",{value:"timeline",children:"Timeline"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:O,disabled:A,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[A?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," AI Extract"]}),e.jsxs("button",{onClick:()=>{o(null),h("create"),u(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Add Fact"]})]}),e.jsx("div",{className:"space-y-2",children:P.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No facts match the current filter"}):P.map(d=>e.jsxs(M.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>j(d),children:[e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)] group-hover:text-blue-400 transition-colors",children:d.content||"(no content)"}),e.jsxs("div",{className:"flex items-center gap-2 mt-2.5",children:[e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${ze(d.category)}`,children:d.category||"—"}),e.jsxs("span",{className:`text-[10px] ${at(d.confidence)}`,children:[Math.round(d.confidence*100),"%"]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["· ",d.source||"—"]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] ml-auto",children:d.createdAt||"—"})]})]},d.id))}),e.jsx(_s,{open:g,onClose:()=>u(!1),onSave:k,fact:l,mode:w})]})},it=t=>t==="mitigated"?"bg-green-500/10 text-green-400":t==="accepted"?"bg-yellow-500/10 text-yellow-400":"bg-red-500/10 text-red-400",De=t=>t==="high"?"bg-red-500/10 text-red-400":t==="medium"?"bg-yellow-500/10 text-yellow-400":"bg-white/5 text-slate-400",Es=({open:t,onClose:m,onSave:f,risk:a,mode:c})=>{const b={content:"",impact:"medium",likelihood:"medium",status:"open",owner:"",mitigation:""},[r,s]=n.useState(b),[g,u]=n.useState(null),w=jt();n.useEffect(()=>{if(a&&c==="edit"){const{id:l,...o}=a;s(o)}else s(b)},[a,c,t]);const h=async()=>{if(!r.content){y.error("Add a description first");return}u("mitigate"),w.mutate({content:r.content,impact:r.impact,likelihood:r.likelihood},{onSuccess:l=>{l.suggested_mitigation&&s(o=>({...o,mitigation:l.suggested_mitigation})),l.suggested_owner&&!r.owner&&s(o=>({...o,owner:l.suggested_owner})),u(null),y.success("AI suggested mitigation strategy")},onError:()=>{u(null),y.error("AI mitigation failed")}})};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:m}),e.jsx(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:c==="create"?"New Risk":"Edit Risk"}),e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg hover:bg-[var(--gm-surface-hover)] flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsx("div",{className:"px-5 pt-4 flex gap-2",children:e.jsxs("button",{type:"button",onClick:h,disabled:!!g,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[g==="mitigate"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"})," AI Mitigation"]})}),e.jsxs("form",{onSubmit:l=>{l.preventDefault(),r.content.trim()&&(f({id:a?.id||String(Date.now()),...r}),m())},className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Risk *"}),e.jsx("input",{value:r.content,onChange:l=>s({...r,content:l.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Risk title...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Mitigation Plan"}),e.jsx("textarea",{value:r.mitigation||"",onChange:l=>s({...r,mitigation:l.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[60px] resize-y",placeholder:"Describe the risk..."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Impact"}),e.jsxs("select",{value:r.impact,onChange:l=>s({...r,impact:l.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Likelihood"}),e.jsxs("select",{value:r.likelihood,onChange:l=>s({...r,likelihood:l.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Status"}),e.jsxs("select",{value:r.status,onChange:l=>s({...r,status:l.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"mitigated",children:"Mitigated"}),e.jsx("option",{value:"accepted",children:"Accepted"})]})]})]}),e.jsx(_e,{value:r.owner||"",onChange:l=>s({...r,owner:l}),label:"Owner",placeholder:"Select risk owner..."}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Mitigation"}),e.jsx("textarea",{value:r.mitigation||"",onChange:l=>s({...r,mitigation:l.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[60px] resize-y",placeholder:"Mitigation strategy..."})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:c==="create"?"Create":"Save"})]})]})]})})]})})},$s=({risk:t,onBack:m,onEdit:f,onDelete:a})=>{const[c,b]=n.useState(!1),[r,s]=n.useState([]),g=G(),u=t.impact==="high"&&t.likelihood==="high"?"Critical":t.impact==="high"||t.likelihood==="high"?"High":t.impact==="medium"&&t.likelihood==="medium"?"Medium":"Low",w=async()=>{b(!0),g.mutate({message:`Analyze this project risk and provide insights:
Risk: "${t.content}"
Impact: ${t.impact}, Likelihood: ${t.likelihood}, Status: ${t.status}
Owner: ${t.owner||"none"}
Mitigation: ${t.mitigation||"none"}
Provide: risk assessment, related risks, and recommendations.`},{onSuccess:h=>{const l=h?.response;l&&s(l.split(`
`).filter(o=>o.trim())),b(!1),y.success("AI risk analysis complete")},onError:()=>{b(!1),y.error("AI analysis failed")}})};return e.jsxs(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:t.content||t.description||"(untitled risk)"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["Risk #",t.id?.substring(0,8)]})]}),e.jsxs("button",{onClick:w,disabled:c,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[c?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Analyze"]}),e.jsxs("button",{onClick:()=>f(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Edit"]}),a&&e.jsxs("button",{onClick:()=>{a(t.id),m()},className:"px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs hover:bg-red-500/20 flex items-center gap-1.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Delete"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${it(t.status)}`,children:t.status||"—"}),e.jsxs("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${De(t.impact)}`,children:["Impact: ",t.impact||"—"]}),e.jsxs("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${De(t.likelihood)}`,children:["Likelihood: ",t.likelihood||"—"]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.mitigation||"No mitigation plan defined"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Owner"})]}),t.owner?e.jsx(ie,{name:t.owner,size:"md"}):e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Unassigned"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(yt,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Risk Score"})]}),e.jsx("p",{className:`text-sm font-semibold ${u==="Critical"?"text-red-400":u==="High"?"text-yellow-400":"text-[var(--gm-text-primary)]"}`,children:u})]})]}),t.mitigation&&e.jsxs("div",{className:"bg-green-500/5 border border-green-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-green-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(ft,{className:"w-3.5 h-3.5"})," Mitigation"]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.mitigation})]}),r.length>0&&e.jsxs(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Analysis"]}),e.jsx("ul",{className:"space-y-1.5",children:r.map((h,l)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:h},l))})]})]})},Fs=({initialData:t=[],onSave:m,onDelete:f})=>{const[a,c]=n.useState(t),b=G();n.useEffect(()=>{t&&c(t)},[t]);const[r,s]=n.useState("all"),[g,u]=n.useState("all"),[w,h]=n.useState(!1),[l,o]=n.useState("create"),[S,j]=n.useState(null),[A,E]=n.useState(null),[P,N]=n.useState(!1),k=n.useMemo(()=>{let v=a;return r!=="all"&&(v=v.filter(x=>x.status===r)),g!=="all"&&(v=v.filter(x=>x.impact===g)),v},[a,r,g]),I=n.useMemo(()=>({total:a.length,open:a.filter(v=>v.status==="open").length,mitigated:a.filter(v=>v.status==="mitigated").length,critical:a.filter(v=>v.impact==="high"&&v.likelihood==="high").length}),[a]),O=v=>{c(x=>{const _=x.findIndex(T=>T.id===v.id);if(_>=0){const T=[...x];return T[_]=v,T}return[...x,v]}),m?.(v)},d=v=>{c(x=>x.filter(_=>_.id!==v)),f?.(v),y.success("Risk deleted")},D=async()=>{N(!0),b.mutate({message:"Scan the project for potential risks not yet identified. Return on line 1: risk title. Line 2: brief description. Line 3: impact (high/medium/low). Line 4: likelihood (high/medium/low)."},{onSuccess:v=>{const x=v?.response;if(x){const _=x.split(`
`).filter(Y=>Y.trim()),T=_[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||x.trim(),U=_[1]?.replace(/^["'\-*\d.]+\s*/,"").trim()||"",Z=x.toLowerCase().match(/impact[:\s]*(high|medium|low)/),B=x.toLowerCase().match(/likelihood[:\s]*(high|medium|low)/),V={id:`ai-${Date.now()}`,content:T,mitigation:U,impact:Z?.[1]||"medium",likelihood:B?.[1]||"medium",status:"open",owner:""};c(Y=>[...Y,V]),m?.(V)}N(!1),y.success("AI identified a new risk")},onError:()=>{N(!1),y.error("AI risk scan failed")}})};return A?e.jsx($s,{risk:A,onBack:()=>E(null),onEdit:v=>{E(null),j(v),o("edit"),h(!0)},onDelete:d}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Total",value:I.total,color:"text-[var(--gm-text-primary)]"},{label:"Open",value:I.open,color:"text-red-400"},{label:"Mitigated",value:I.mitigated,color:"text-green-400"},{label:"Critical",value:I.critical,color:"text-red-400"}].map(v=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${v.color}`,children:v.value}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:v.label})]},v.label))}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{value:r,onChange:v=>s(v.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"mitigated",children:"Mitigated"}),e.jsx("option",{value:"accepted",children:"Accepted"})]}),e.jsxs("select",{value:g,onChange:v=>u(v.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All impacts"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:D,disabled:P,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[P?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," AI Risk Scan"]}),e.jsxs("button",{onClick:()=>{j(null),o("create"),h(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Add Risk"]})]}),e.jsx("div",{className:"space-y-2",children:k.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No risks match the current filter"}):k.map(v=>e.jsxs(M.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>E(v),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate group-hover:text-blue-400 transition-colors",children:v.content||v.description||"(untitled risk)"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5 line-clamp-1",children:v.mitigation||""})]}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${it(v.status)}`,children:v.status||"—"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2.5",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${De(v.impact)}`,children:["Impact: ",v.impact||"—"]}),e.jsxs("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${De(v.likelihood)}`,children:["Likelihood: ",v.likelihood||"—"]})]}),v.owner?e.jsx(ie,{name:v.owner,size:"sm"}):e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No owner"})]}),v.mitigation&&e.jsx("p",{className:"text-xs text-green-400 mt-2 line-clamp-1",children:v.mitigation})]},v.id))}),e.jsx(Es,{open:w,onClose:()=>h(!1),onSave:O,risk:S,mode:l})]})},qe={task:"",description:"",owner:"",deadline:"",status:"pending",priority:"medium",sprint_id:"",parent_story_id:""},Rs=({open:t,onClose:m,onSave:f,action:a,mode:c,sprints:b,userStories:r=[]})=>{const[s,g]=n.useState(qe),[u,w]=n.useState(null),h=Nt(),l=G(),{data:o}=et(),S=b??o?.sprints??[];n.useEffect(()=>{if(a&&c==="edit"){const{id:N,...k}=a;g(k)}else g(qe)},[a,c,t]);const j=r.filter(N=>(N.sprint_id||N.sprintId)===s.sprint_id),A=async N=>{if(w(N),N==="title")l.mutate({message:"Suggest one concise action item title for this project. Return only the title text."},{onSuccess:k=>{const I=k?.response;I&&g(O=>({...O,title:I.replace(/^["'\-*\d.]+\s*/,"").trim()})),w(null),y.success("AI suggestion applied to title")},onError:()=>{w(null),y.error("AI suggestion failed")}});else{const k=s.task||"a new project task";h.mutate({user_input:k},{onSuccess:I=>{const O=[];I.description&&O.push(I.description),I.definition_of_done&&O.push(`Definition of Done: ${I.definition_of_done}`),I.acceptance_criteria&&O.push(`Acceptance Criteria: ${I.acceptance_criteria}`),I.size_estimate&&O.push(`Estimate: ${I.size_estimate}`);const d=O.join(`

`);g(D=>({...D,description:D.description?`${D.description}

${d}`:d})),I.task&&!s.task&&g(D=>({...D,task:I.task})),w(null),y.success("AI suggestion applied to description")},onError:()=>{w(null),y.error("AI suggestion failed")}})}},E=async()=>{if(!s.task&&!s.description){y.error("Add a title or description first");return}w("refine"),l.mutate({message:`Refine this action item. Clarify scope, add measurable outcomes, identify blockers:
Task: "${s.task}"
Description: "${s.description}"`},{onSuccess:N=>{const k=N?.response;k&&g(I=>({...I,description:I.description?`${I.description}

${k}`:k})),w(null),y.success("Action refined with AI")},onError:()=>{w(null),y.error("AI refinement failed")}})},P=N=>{N.preventDefault();const k=(s.task||s.title||"").trim();k&&(f({id:a?.id||String(Date.now()),...s,task:k,created_at:a?.created_at||new Date().toISOString(),updated_at:new Date().toISOString()}),m())};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:m}),e.jsx(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",style:{background:"linear-gradient(to right, rgba(37,99,235,0.18), rgba(37,99,235,0.05))"},children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:c==="create"?"New Action":"Edit Action"}),e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-slate-400"})})]}),e.jsxs("div",{className:"px-5 pt-4 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>A("title"),disabled:!!u,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[u==="title"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Suggest Title"]}),e.jsxs("button",{type:"button",onClick:()=>A("description"),disabled:!!u,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[u==="description"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Suggest Description"]}),e.jsxs("button",{type:"button",onClick:E,disabled:!!u,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[u==="refine"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"})," Refine with AI"]})]}),e.jsxs("form",{onSubmit:P,className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Title *"}),e.jsx("input",{value:s.title,onChange:N=>g({...s,title:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Action title...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Description"}),e.jsx("textarea",{value:s.description,onChange:N=>g({...s,description:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[80px] resize-y",placeholder:"Describe the action..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(_e,{value:s.owner||"",onChange:N=>g({...s,owner:N}),label:"Owner",placeholder:"Select assignee..."}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Deadline"}),e.jsx("input",{type:"date",value:s.deadline||"",onChange:N=>g({...s,deadline:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Status"}),e.jsxs("select",{value:s.status,onChange:N=>g({...s,status:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Priority"}),e.jsxs("select",{value:s.priority,onChange:N=>g({...s,priority:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Sprint"}),e.jsxs("select",{value:s.sprint_id||"",onChange:N=>g({...s,sprint_id:N.target.value,parent_story_id:""}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"",children:"No sprint"}),S.map(N=>e.jsx("option",{value:N.id,children:N.name||"(unnamed)"},N.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"User Story"}),e.jsxs("select",{value:s.parent_story_id||"",onChange:N=>g({...s,parent_story_id:N.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",disabled:!s.sprint_id,children:[e.jsx("option",{value:"",children:"No story"}),j.map(N=>e.jsx("option",{value:N.id,children:N.title||"(untitled)"},N.id))]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:c==="create"?"Create Action":"Save Changes"})]})]})]})})]})})},Ps=t=>t==="completed"?"bg-success/10 text-success":t==="overdue"?"bg-destructive/10 text-destructive":t==="in_progress"?"bg-primary/10 text-primary":"bg-muted text-[var(--gm-text-tertiary)]",Os=t=>t==="high"?"bg-destructive/10 text-destructive":t==="medium"?"bg-warning/10 text-warning":"bg-muted text-[var(--gm-text-tertiary)]",zs=({action:t,onBack:m,onEdit:f,onDelete:a})=>{const[c,b]=n.useState(null),[r,s]=n.useState([]),g=G(),u=async()=>{b("analyze"),g.mutate({message:`Analyze this action item and provide insights on urgency, dependencies, and risks:
Title: "${t.title}"
Description: "${t.description}"
Status: ${t.status}
Priority: ${t.priority}
Owner: ${t.owner||"unassigned"}
Deadline: ${t.deadline||"none"}
Sprint: ${t.sprintId||"none"}`},{onSuccess:h=>{const l=h?.response;l&&s(l.split(`
`).filter(o=>o.trim())),b(null),y.success("AI analysis complete")},onError:()=>{b(null),y.error("AI analysis failed")}})},w=async()=>{b("steps"),g.mutate({message:`Suggest 3 concrete next steps for this action:
Title: "${t.title}"
Description: "${t.description}"
Status: ${t.status}
Return each step on a new line.`},{onSuccess:h=>{const l=h?.response;l&&s(o=>[...o,...l.split(`
`).filter(S=>S.trim())]),b(null),y.success("AI suggested next steps")},onError:()=>{b(null),y.error("AI suggestion failed")}})};return e.jsxs(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:t.title||t.task||t.content||"(untitled action)"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["Action #",t.id]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:u,disabled:!!c,className:"px-3 py-1.5 rounded-lg bg-accent/10 text-accent text-xs font-medium hover:bg-accent/20 flex items-center gap-1.5 disabled:opacity-50",children:[c==="analyze"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Analyze"]}),e.jsxs("button",{onClick:w,disabled:!!c,className:"px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs font-medium hover:bg-primary/20 flex items-center gap-1.5 disabled:opacity-50",children:[c==="steps"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"})," Suggest Steps"]}),e.jsxs("button",{onClick:()=>f(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-secondary-foreground text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Edit"]}),a&&e.jsxs("button",{onClick:()=>{a(t.id),m()},className:"px-3 py-1.5 rounded-lg bg-destructive/10 text-destructive text-xs hover:bg-destructive/20 flex items-center gap-1.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Delete"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${Ps(t.status)}`,children:(t.status||"").replace("_"," ")}),e.jsxs("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${Os(t.priority)}`,children:[t.priority," priority"]})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)] whitespace-pre-wrap",children:t.description||"—"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Owner"})]}),t.owner?e.jsx(ie,{name:t.owner,size:"md"}):e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Unassigned"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(tt,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Deadline"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.deadline||"No deadline"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ae,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Sprint"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.sprintId||"No sprint"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"User Story"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.storyId||"No story"})]})]}),r.length>0&&e.jsxs(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-accent/5 border border-accent/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-accent uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Insights"]}),e.jsx("ul",{className:"space-y-1.5",children:r.map((h,l)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:h},l))})]}),e.jsxs("div",{className:"flex gap-4 text-[10px] text-[var(--gm-text-tertiary)]",children:[t.createdAt&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"})," Created: ",t.createdAt]}),t.updatedAt&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"})," Updated: ",t.updatedAt]})]})]})},Ts=({open:t,onClose:m,onSave:f})=>{const[a,c]=n.useState({name:"",start_date:"",end_date:"",context:"",goals:"",analysis_start_date:"",analysis_end_date:""}),b=wt(),r=s=>{s.preventDefault(),!(!a.name.trim()||!a.start_date||!a.end_date)&&b.mutate({name:a.name,start_date:a.start_date,end_date:a.end_date,context:a.context||void 0,goals:a.goals.trim()?a.goals.split(`
`).filter(g=>g.trim()):void 0,analysis_start_date:a.analysis_start_date||void 0,analysis_end_date:a.analysis_end_date||void 0},{onSuccess:g=>{const u=g.sprint;f?.(u),y.success("Sprint created"),c({name:"",start_date:"",end_date:"",context:"",goals:"",analysis_start_date:"",analysis_end_date:""}),m()},onError:()=>y.error("Failed to create sprint")})};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:m}),e.jsx(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-md",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",style:{background:"linear-gradient(to right, rgba(37,99,235,0.18), rgba(37,99,235,0.05))"},children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Create Sprint"}),e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center transition-colors",children:e.jsx(ae,{className:"w-4 h-4 text-slate-400"})})]}),e.jsxs("form",{onSubmit:r,className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Sprint Name *"}),e.jsx("input",{value:a.name,onChange:s=>c({...a,name:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"e.g. Sprint 4 — Analytics",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Start Date *"}),e.jsx("input",{type:"date",value:a.start_date,onChange:s=>c({...a,start_date:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"End Date *"}),e.jsx("input",{type:"date",value:a.end_date,onChange:s=>c({...a,end_date:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Context"}),e.jsx("input",{value:a.context,onChange:s=>c({...a,context:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Sprint context..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Goals (one per line)"}),e.jsx("textarea",{value:a.goals,onChange:s=>c({...a,goals:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[60px] resize-y",placeholder:"Define key goals for this sprint..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Analysis Start"}),e.jsx("input",{type:"date",value:a.analysis_start_date,onChange:s=>c({...a,analysis_start_date:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Analysis End"}),e.jsx("input",{type:"date",value:a.analysis_end_date,onChange:s=>c({...a,analysis_end_date:s.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)] transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:b.isPending,className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[b.isPending&&e.jsx($,{className:"w-4 h-4 animate-spin"}),"Create Sprint"]})]})]})]})})]})})},Us=t=>t==="completed"?"bg-green-500/10 text-green-400":t==="overdue"?"bg-red-500/10 text-red-400":t==="in_progress"?"bg-blue-500/10 text-blue-400":"bg-white/5 text-slate-400",Qs=t=>t==="high"?"bg-red-500/10 text-red-400":t==="medium"?"bg-yellow-500/10 text-yellow-400":"bg-white/5 text-slate-400",Hs=t=>t==="active"?"bg-green-500/10 text-green-400":t==="completed"?"bg-white/5 text-slate-400":"bg-blue-500/10 text-blue-400",Vs=({initialData:t=[],initialSprints:m=[],onSave:f,onDelete:a})=>{const[c,b]=n.useState(t),r=G(),{data:s}=et(),g=s?.sprints??[],u=g.length>0?g:m;n.useEffect(()=>{t&&b(t)},[t]);const[w,h]=n.useState("by_sprint"),[l,o]=n.useState("all"),[S,j]=n.useState(""),[A,E]=n.useState(new Set(["sp-2","sp-1","sp-3","no-sprint"])),[P,N]=n.useState(!1),[k,I]=n.useState("create"),[O,d]=n.useState(null),[D,v]=n.useState(!1),[x,_]=n.useState(null),[T,U]=n.useState(!1),Z=async()=>{U(!0),r.mutate({message:"Based on the project state, suggest one important action item. Return on line 1: the action title. Line 2: description. Line 3: priority (high/medium/low)."},{onSuccess:p=>{const L=p?.response;if(L){const C=L.split(`
`).filter(q=>q.trim()),Q=C[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||L.trim(),W=C[1]?.replace(/^["'\-*\d.]+\s*/,"").trim()||"",J=L.toLowerCase().match(/(high|medium|low)/),de={id:`ai-${Date.now()}`,title:Q,description:W,status:"pending",priority:J?.[1]||"medium",owner:"",deadline:new Date(Date.now()+7*864e5).toISOString().split("T")[0],sprintId:u.find(q=>q.status==="active")?.id,createdAt:new Date().toISOString().split("T")[0]};b(q=>[...q,de]),f?.(de)}U(!1),y.success("AI suggested a new action")},onError:()=>{U(!1),y.error("AI suggestion failed")}})},B=n.useMemo(()=>{let p=c;return l!=="all"&&(p=p.filter(L=>L.status===l)),S&&(p=p.filter(L=>(L.sprint_id||L.sprintId)===S)),p},[c,l,S]),V=n.useMemo(()=>({total:c.length,pending:c.filter(p=>p.status==="pending").length,inProgress:c.filter(p=>p.status==="in_progress").length,completed:c.filter(p=>p.status==="completed").length,overdue:c.filter(p=>p.status==="overdue").length}),[c]),Y=p=>{E(L=>{const C=new Set(L);return C.has(p)?C.delete(p):C.add(p),C})},Me=p=>{b(L=>{const C=L.findIndex(Q=>Q.id===p.id);if(C>=0){const Q=[...L];return Q[C]=p,Q}return[...L,p]}),f?.(p)},fe=p=>{b(L=>L.filter(C=>C.id!==p)),a?.(p),y.success("Action deleted")},Le=p=>{E(L=>new Set([...L,p.id]))},je=p=>{d(p),I("edit"),N(!0)};if(x)return e.jsx(zs,{action:x,onBack:()=>_(null),onEdit:p=>{_(null),je(p)},onDelete:fe});const ne=({action:p})=>e.jsxs(M.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>_(p),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate group-hover:text-blue-400 transition-colors",children:p.task||p.title||p.content||"(no title)"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5 line-clamp-1",children:p.description||""})]}),e.jsxs("div",{className:"flex gap-1.5 flex-shrink-0",children:[p.priority&&e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Qs(p.priority)}`,children:p.priority}),p.status&&e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Us(p.status)}`,children:p.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2.5",children:[p.owner?e.jsx(ie,{name:p.owner,size:"sm"}):e.jsx("span",{className:"text-[11px] text-[var(--gm-text-tertiary)]",children:"Unassigned"}),p.deadline&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["📅 ",p.deadline]})]})]}),Ne=()=>{const p=u.map(C=>({sprint:C,actions:B.filter(Q=>Q.sprintId===C.id)})),L=B.filter(C=>!C.sprintId);return e.jsxs("div",{className:"space-y-3",children:[p.map(({sprint:C,actions:Q})=>e.jsxs("div",{className:"bg-[var(--gm-interactive-secondary)]/30 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>Y(C.id),className:"w-full flex items-center gap-2 px-4 py-3 hover:bg-[var(--gm-interactive-secondary)]/50 transition-colors text-left",children:[A.has(C.id)?e.jsx(xe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}):e.jsx(Se,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx(Ae,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)] flex-1",children:C.name||"(unnamed sprint)"}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Hs(C.status)}`,children:C.status||"—"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[Q.length," actions"]})]}),e.jsx(X,{children:A.has(C.id)&&e.jsxs(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:[C.context&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] px-4 pb-2",children:C.context}),e.jsx("div",{className:"px-3 pb-3 space-y-2",children:Q.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] text-center py-4",children:"No actions in this sprint"}):Q.map(W=>e.jsx(ne,{action:W},W.id))})]})})]},C.id)),L.length>0&&e.jsxs("div",{className:"bg-[var(--gm-interactive-secondary)]/30 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>Y("no-sprint"),className:"w-full flex items-center gap-2 px-4 py-3 hover:bg-[var(--gm-interactive-secondary)]/50 transition-colors text-left",children:[A.has("no-sprint")?e.jsx(xe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}):e.jsx(Se,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-tertiary)] flex-1",children:"No Sprint"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[L.length," actions"]})]}),e.jsx(X,{children:A.has("no-sprint")&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden px-3 pb-3 space-y-2",children:L.map(C=>e.jsx(ne,{action:C},C.id))})})]})]})},Ee=[],we=()=>{const p=Ee.map(C=>({story:C,actions:B.filter(Q=>Q.storyId===C.id)})).filter(C=>C.actions.length>0),L=B.filter(C=>!C.storyId);return e.jsxs("div",{className:"space-y-3",children:[p.map(({story:C,actions:Q})=>{const W=u.find(J=>J.id===C.sprintId);return e.jsxs("div",{className:"bg-[var(--gm-interactive-secondary)]/30 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>Y(C.id),className:"w-full flex items-center gap-2 px-4 py-3 hover:bg-[var(--gm-interactive-secondary)]/50 transition-colors text-left",children:[A.has(C.id)?e.jsx(xe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}):e.jsx(Se,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx(Ie,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)] flex-1 truncate",children:C.title||"(untitled story)"}),W&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:W.name||"—"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:Q.length})]}),e.jsx(X,{children:A.has(C.id)&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden px-3 pb-3 space-y-2",children:Q.map(J=>e.jsx(ne,{action:J},J.id))})})]},C.id)}),L.length>0&&e.jsxs("div",{className:"bg-[var(--gm-interactive-secondary)]/30 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>Y("no-story"),className:"w-full flex items-center gap-2 px-4 py-3 hover:bg-[var(--gm-interactive-secondary)]/50 transition-colors text-left",children:[A.has("no-story")?e.jsx(xe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}):e.jsx(Se,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-tertiary)] flex-1",children:"No Story"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:L.length})]}),e.jsx(X,{children:A.has("no-story")&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden px-3 pb-3 space-y-2",children:L.map(C=>e.jsx(ne,{action:C},C.id))})})]})]})},$e=()=>e.jsx("div",{className:"space-y-2",children:B.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No actions match the current filter"}):B.map(p=>e.jsx(ne,{action:p},p.id))});return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Total",value:V.total,color:"text-[var(--gm-text-primary)]"},{label:"Pending",value:V.pending,color:"text-[var(--gm-text-tertiary)]"},{label:"In Progress",value:V.inProgress,color:"text-primary"},{label:"Completed",value:V.completed,color:"text-success"},{label:"Overdue",value:V.overdue,color:"text-destructive"}].map(p=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${p.color}`,children:p.value}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:p.label})]},p.label))}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"flex bg-[var(--gm-interactive-secondary)] rounded-lg p-0.5",children:[{id:"list",icon:hs,label:"List"},{id:"by_sprint",icon:vs,label:"Sprints"},{id:"by_story",icon:Ie,label:"Stories"}].map(p=>e.jsxs("button",{onClick:()=>h(p.id),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-colors ${w===p.id?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-sm":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]"}`,children:[e.jsx(p.icon,{className:"w-3.5 h-3.5"}),p.label]},p.id))}),w==="list"&&e.jsxs("select",{value:S,onChange:p=>j(p.target.value),className:"bg-[var(--gm-interactive-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"",children:"All sprints"}),u.map(p=>e.jsx("option",{value:p.id,children:p.name||"(unnamed)"},p.id))]}),e.jsxs("select",{value:l,onChange:p=>o(p.target.value),className:"bg-[var(--gm-interactive-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"overdue",children:"Overdue"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>v(!0),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-slate-300 text-xs font-medium hover:bg-[var(--gm-surface-hover)] transition-colors flex items-center gap-1.5",children:[e.jsx(Ae,{className:"w-3.5 h-3.5"})," Sprint"]}),e.jsxs("button",{onClick:Z,disabled:T,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 transition-colors flex items-center gap-1.5 disabled:opacity-50",children:[T?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"}),"AI Suggest"]}),e.jsxs("button",{onClick:()=>{d(null),I("create"),N(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 transition-colors flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Add Action"]})]}),e.jsxs(M.div,{initial:{opacity:0},animate:{opacity:1},children:[w==="list"&&$e(),w==="by_sprint"&&Ne(),w==="by_story"&&we()]},w),e.jsx(Rs,{open:P,onClose:()=>N(!1),onSave:Me,action:O,mode:k}),e.jsx(Ts,{open:D,onClose:()=>v(!1),onSave:Le})]})},nt=t=>t==="approved"?"bg-green-500/10 text-green-400":t==="rejected"?"bg-red-500/10 text-red-400":"bg-blue-500/10 text-blue-400",Bs=({open:t,onClose:m,onSave:f,decision:a,mode:c})=>{const b={content:"",rationale:"",owner:"",decision_date:new Date().toISOString().split("T")[0],status:"pending"},[r,s]=n.useState(b),[g,u]=n.useState(null),w=kt(),h=St();n.useEffect(()=>{if(a&&c==="edit"){const{id:o,...S}=a;s(S)}else s(b)},[a,c,t]);const l=async()=>{if(!r.content){y.error("Add a title first");return}u("impact"),w.mutate({content:r.content,rationale:r.rationale},{onSuccess:o=>{const S=[];if(o.impact_summary&&S.push(o.impact_summary),o.rationale&&r.rationale!==o.rationale&&S.push(o.rationale),o.summary&&S.push(o.summary),S.length>0){const j=S.join(`

`);s(A=>({...A,rationale:A.rationale?`${A.rationale}

${j}`:j}))}u(null),y.success("AI impact analysis added")},onError:()=>{u(null),y.error("AI impact analysis failed")}})};return e.jsx(X,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:m}),e.jsx(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:c==="create"?"New Decision":"Edit Decision"}),e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg hover:bg-[var(--gm-surface-hover)] flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsxs("div",{className:"px-5 pt-4 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:l,disabled:!!g,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-500/10 text-blue-400 text-xs font-medium hover:bg-blue-500/20 disabled:opacity-50",children:[g==="impact"?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"})," AI Impact Analysis"]}),e.jsxs("button",{type:"button",disabled:h.isPending||!r.content.trim(),onClick:()=>h.mutate({content:r.content,rationale:r.rationale},{onSuccess:o=>{const S=o?.suggested_owners;S?.[0]&&(s(j=>({...j,owner:String(S[0].name||S[0].id||"")})),y.success("Owner suggested by AI"))},onError:()=>y.error("Owner suggestion failed")}),className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 disabled:opacity-50",children:[h.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(re,{className:"w-3.5 h-3.5"})," AI Suggest Owner"]})]}),e.jsxs("form",{onSubmit:o=>{o.preventDefault(),r.content.trim()&&(f({id:a?.id||String(Date.now()),...r}),m())},className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Title *"}),e.jsx("input",{value:r.content,onChange:o=>s({...r,content:o.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",placeholder:"Decision title...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Rationale / Description"}),e.jsx("textarea",{value:r.rationale||"",onChange:o=>s({...r,rationale:o.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)] min-h-[80px] resize-y",placeholder:"Describe the decision and rationale..."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(_e,{value:r.owner||"",onChange:o=>s({...r,owner:o}),label:"Owner",placeholder:"Decision maker..."}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Date"}),e.jsx("input",{type:"date",value:r.decision_date||"",onChange:o=>s({...r,decision_date:o.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Status"}),e.jsxs("select",{value:r.status,onChange:o=>s({...r,status:o.target.value}),className:"mt-1 w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"flex-1 px-4 py-2.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-sm font-medium hover:bg-[var(--gm-surface-hover)]",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700",children:c==="create"?"Create":"Save"})]})]})]})})]})})},Gs=({decision:t,onBack:m,onEdit:f,onDelete:a})=>{const[c,b]=n.useState(!1),[r,s]=n.useState([]),g=G(),u=async()=>{b(!0),g.mutate({message:`Analyze this project decision and provide insights:
Title: "${t.content}"
Rationale: "${t.rationale||""}"
Owner: ${t.owner||"unknown"}
Date: ${t.decision_date||""}
Status: ${t.status}
Provide: impact assessment, related actions/risks, and recommendations.`},{onSuccess:w=>{const h=w?.response;h&&s(h.split(`
`).filter(l=>l.trim())),b(!1),y.success("AI analysis complete")},onError:()=>{b(!1),y.error("AI analysis failed")}})};return e.jsxs(M.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:m,className:"w-8 h-8 rounded-lg bg-[var(--gm-interactive-secondary)] flex items-center justify-center hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-[var(--gm-text-primary)]",children:t.content||t.decision||t.summary||"(untitled decision)"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["Decision #",t.id?.substring(0,8)]})]}),e.jsxs("button",{onClick:u,disabled:c,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[c?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," Analyze"]}),e.jsxs("button",{onClick:()=>f(t),className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] text-xs hover:bg-[var(--gm-surface-hover)] flex items-center gap-1.5",children:[e.jsx(ue,{className:"w-3.5 h-3.5"})," Edit"]}),a&&e.jsxs("button",{onClick:()=>{a(t.id),m()},className:"px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs hover:bg-red-500/20 flex items-center gap-1.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Delete"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-medium ${nt(t.status)}`,children:t.status||"—"})}),t.rationale&&e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:"Rationale"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)] whitespace-pre-wrap",children:t.rationale})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Decision Maker"})]}),t.owner?e.jsx(ie,{name:t.owner,size:"md"}):e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"Unknown"})]}),e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(tt,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Date"})]}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:t.decision_date||"—"})]})]}),r.length>0&&e.jsxs(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-purple-500/5 border border-purple-500/20 rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-medium text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," AI Insights"]}),e.jsx("ul",{className:"space-y-1.5",children:r.map((w,h)=>e.jsx("li",{className:"text-sm text-[var(--gm-text-primary)]",children:w},h))})]})]})},Ws=({initialData:t=[],onSave:m,onDelete:f})=>{const[a,c]=n.useState(t),b=G();n.useEffect(()=>{t&&c(t)},[t]);const[r,s]=n.useState("all"),[g,u]=n.useState(!1),[w,h]=n.useState("create"),[l,o]=n.useState(null),[S,j]=n.useState(null),[A,E]=n.useState(!1),P=n.useMemo(()=>r==="all"?a:a.filter(d=>d.status===r),[a,r]),N=n.useMemo(()=>({total:a.length,approved:a.filter(d=>d.status==="approved").length,pending:a.filter(d=>d.status==="pending").length,active:a.filter(d=>d.status==="active").length,rejected:a.filter(d=>d.status==="rejected").length}),[a]),k=d=>{c(D=>{const v=D.findIndex(x=>x.id===d.id);if(v>=0){const x=[...D];return x[v]=d,x}return[...D,d]}),m?.(d)},I=d=>{c(D=>D.filter(v=>v.id!==d)),f?.(d),y.success("Decision deleted")},O=async()=>{E(!0),b.mutate({message:"Based on the current project state, suggest one important decision that should be made. Return on line 1: the decision title. Line 2: brief rationale."},{onSuccess:d=>{const D=d?.response;if(D){const v=D.split(`
`).filter(U=>U.trim()),x=v[0]?.replace(/^["'\-*\d.]+\s*/,"").trim()||D.trim(),_=v.slice(1).join(`
`).trim(),T={id:`ai-${Date.now()}`,content:x,rationale:_,owner:"",decision_date:new Date().toISOString().split("T")[0],status:"pending"};c(U=>[...U,T]),m?.(T)}E(!1),y.success("AI suggested a new decision")},onError:()=>{E(!1),y.error("AI suggestion failed")}})};return S?e.jsx(Gs,{decision:S,onBack:()=>j(null),onEdit:d=>{j(null),o(d),h("edit"),u(!0)},onDelete:I}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{label:"Total",value:N.total,color:"text-[var(--gm-text-primary)]"},{label:"Approved",value:N.approved,color:"text-green-400"},{label:"Pending",value:N.pending,color:"text-primary"},{label:"Active",value:N.active,color:"text-purple-400"},{label:"Rejected",value:N.rejected,color:"text-red-400"}].map(d=>e.jsxs("div",{className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 flex items-center gap-2",children:[e.jsx("span",{className:`text-lg font-bold ${d.color}`,children:d.value}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:d.label})]},d.label))}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("select",{value:r,onChange:d=>s(d.target.value),className:"bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--gm-border-focus)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:O,disabled:A,className:"px-3 py-1.5 rounded-lg bg-purple-500/10 text-purple-400 text-xs font-medium hover:bg-purple-500/20 flex items-center gap-1.5 disabled:opacity-50",children:[A?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(H,{className:"w-3.5 h-3.5"})," AI Suggest"]}),e.jsxs("button",{onClick:()=>{o(null),h("create"),u(!0)},className:"px-3 py-1.5 rounded-lg bg-blue-600 text-white text-xs font-medium hover:bg-blue-700 flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Add Decision"]})]}),e.jsx("div",{className:"space-y-2",children:P.length===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-8",children:"No decisions match the current filter"}):P.map(d=>e.jsxs(M.div,{layout:!0,initial:{opacity:0},animate:{opacity:1},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3.5 hover:border-blue-500/30 transition-colors cursor-pointer group",onClick:()=>j(d),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-[var(--gm-text-primary)] truncate group-hover:text-blue-400 transition-colors",children:d.content||d.decision||d.summary||d.context||"(no title)"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5 line-clamp-1",children:d.rationale||d.context||""})]}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${nt(d.status)}`,children:d.status||"—"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2.5",children:[d.owner?e.jsx(ie,{name:d.owner,size:"sm"}):e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No owner"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:d.decision_date||""})]})]},d.id))}),e.jsx(Bs,{open:g,onClose:()=>u(!1),onSave:k,decision:l,mode:w})]})},Js=t=>t==="done"?"bg-green-500/10 text-green-400":t==="in_progress"?"bg-blue-500/10 text-blue-400":t==="cancelled"?"bg-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]":"bg-amber-500/10 text-amber-400",Zs=t=>t==="high"?"bg-red-500/10 text-red-400":t==="medium"?"bg-amber-500/10 text-amber-400":"bg-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]",Ks=({open:t,onClose:m,story:f,mode:a})=>{const c=It(),b=Dt(),r={title:"",description:"",acceptance_criteria:"",priority:"medium",status:"backlog"},[s,g]=n.useState(r);n.useEffect(()=>{g(f&&a==="edit"?{title:f.title||"",description:f.description||"",acceptance_criteria:f.acceptance_criteria||"",priority:f.priority||"medium",status:f.status||"backlog"}:r)},[f,a,t]);const u=()=>{if(!s.title.trim()){y.error("Title is required");return}a==="edit"&&f?b.mutate({id:f.id,...s},{onSuccess:()=>{y.success("Story updated"),m()},onError:()=>y.error("Failed to update")}):c.mutate(s,{onSuccess:()=>{y.success("Story created"),m()},onError:()=>y.error("Failed to create")})},w=c.isPending||b.isPending;return t?e.jsx(X,{children:e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center",onClick:m,children:e.jsxs(M.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl w-full max-w-lg p-5 shadow-2xl",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:a==="create"?"New User Story":"Edit User Story"}),e.jsx("button",{onClick:m,className:"p-1 rounded text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Title *"}),e.jsx("input",{value:s.title,onChange:h=>g(l=>({...l,title:h.target.value})),className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)]",placeholder:"As a user, I want to..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Description"}),e.jsx("textarea",{value:s.description,onChange:h=>g(l=>({...l,description:h.target.value})),rows:3,className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] resize-y",placeholder:"Detailed description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Acceptance Criteria"}),e.jsx("textarea",{value:s.acceptance_criteria,onChange:h=>g(l=>({...l,acceptance_criteria:h.target.value})),rows:3,className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] resize-y font-mono text-xs",placeholder:"Given... When... Then..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Priority"}),e.jsxs("select",{value:s.priority,onChange:h=>g(l=>({...l,priority:h.target.value})),className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] mb-1 block",children:"Status"}),e.jsxs("select",{value:s.status,onChange:h=>g(l=>({...l,status:h.target.value})),className:"w-full bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"backlog",children:"Backlog"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-5 pt-4 border-t border-[var(--gm-border-primary)]",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 rounded-lg text-sm text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-secondary)]",children:"Cancel"}),e.jsxs("button",{onClick:u,disabled:w,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-[var(--gm-accent-primary)] text-white text-sm font-medium hover:opacity-90 disabled:opacity-50",children:[w?e.jsx($,{className:"w-4 h-4 animate-spin"}):e.jsx(_t,{className:"w-4 h-4"}),w?"Saving...":"Save"]})]})]})})}):null};function Xs(){const{data:t,isLoading:m}=Ct(),f=At(),[a,c]=n.useState(!1),[b,r]=n.useState("create"),[s,g]=n.useState(null),[u,w]=n.useState(""),[h,l]=n.useState("all"),[o,S]=n.useState("all"),j=t?.stories??[],A=n.useMemo(()=>{let k=j;if(h!=="all"&&(k=k.filter(I=>I.status===h)),o!=="all"&&(k=k.filter(I=>I.priority===o)),u){const I=u.toLowerCase();k=k.filter(O=>O.title.toLowerCase().includes(I)||O.description?.toLowerCase().includes(I))}return k},[j,h,o,u]),E=k=>{g(k),r("edit"),c(!0)},P=()=>{g(null),r("create"),c(!0)},N=k=>{confirm("Delete this user story?")&&f.mutate(k,{onSuccess:()=>y.success("Story deleted")})};return m?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx($,{className:"w-6 h-6 animate-spin text-[var(--gm-accent-primary)]"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ks,{open:a,onClose:()=>c(!1),story:s,mode:b}),e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:u,onChange:k=>w(k.target.value),placeholder:"Search stories...",className:"bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] w-48"}),e.jsxs("select",{value:h,onChange:k=>l(k.target.value),className:"bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-2 py-1.5 text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"all",children:"All statuses"}),e.jsx("option",{value:"backlog",children:"Backlog"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"done",children:"Done"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsxs("select",{value:o,onChange:k=>S(k.target.value),className:"bg-[var(--gm-surface-secondary)] border border-[var(--gm-border-primary)] rounded-lg px-2 py-1.5 text-xs text-[var(--gm-text-primary)]",children:[e.jsx("option",{value:"all",children:"All priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]}),e.jsxs("button",{onClick:P,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-[var(--gm-accent-primary)] text-white text-sm font-medium hover:opacity-90 transition-opacity",children:[e.jsx(ge,{className:"w-4 h-4"})," New Story"]})]}),A.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"w-10 h-10 mx-auto text-[var(--gm-text-tertiary)] opacity-40 mb-3"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:j.length===0?"No user stories yet. Create one above.":"No stories match your filters."})]}):e.jsx("div",{className:"space-y-2",children:A.map((k,I)=>e.jsx(M.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:I*.03},className:"bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-4 hover:border-[var(--gm-accent-primary)]/20 transition-colors group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 flex-shrink-0",children:e.jsx(Ae,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:k.title}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Js(k.status)}`,children:(k.status||"backlog").replace("_"," ")}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${Zs(k.priority)}`,children:k.priority||"medium"})]}),k.description&&e.jsx("p",{className:"text-xs text-[var(--gm-text-secondary)] line-clamp-2 mb-1",children:k.description}),k.acceptance_criteria&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono line-clamp-1 mt-1",children:["AC: ",k.acceptance_criteria]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:[e.jsx("button",{onClick:()=>E(k),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-secondary)] hover:text-[var(--gm-text-primary)]",children:e.jsx(ue,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>N(k.id),className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-red-500/10 hover:text-red-400",children:e.jsx(oe,{className:"w-3.5 h-3.5"})})]})]})},k.id))})]})}const ee="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)]",me="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]";function ce(t){return t&&typeof t=="object"?t:{}}function Sr(){const[t,m]=n.useState("overview"),[f,a]=n.useState("questions"),[c,b]=n.useState(""),[r,s]=n.useState(""),[g,u]=n.useState(!0),{data:w}=Mt(),{data:h}=Lt(),{data:l}=Et(),{data:o}=$t(),S=Ft(),j=Rt(),A=Pt(),E=Ot(),P=zt(),N=Tt(),k=Ut(),I=Qt(),O=Ht(),d=Vt(),D=Bt(),v=Gt(),x=Wt(),_=Jt(),T=Zt(),U=Kt(),Z=Xt(),B=Yt(),V=qt(),Y=es(),Me=ts(),fe=ss(),Le=rs(),je=as(),ne=is(),Ne=ns(),Ee=ls(),we=cs(),{data:$e,isLoading:p}=os(100),{data:L}=ds(),C=ms(c,r),Q=xs(),W=ce(w),J=ce(h).alerts??[],de=ce(l).insights??[],q=ce(o),Te=q.changes??[],Fe=ce($e).timeline??[],ke=ce(L).versions??[],Ue=ce(C.data),he=Number(W.score??0),Qe=he>=70?"#22c55e":he>=40?"#f59e0b":"#ef4444",He=Me.data?.facts??[],Ve=Le.data?.decisions??[],Be=ne.data?.risks??[],Ge=Ee.data?.actions??[],Re=He.length+Ve.length+Be.length+Ge.length,We=[{key:"questions",label:"Questions",count:S.data?.length??0},{key:"facts",label:"Facts",count:j.data?.length??0},{key:"risks",label:"Risks",count:A.data?.length??0},{key:"actions",label:"Actions",count:E.data?.length??0},{key:"decisions",label:"Decisions",count:P.data?.length??0},{key:"stories",label:"User Stories",count:0},{key:"trash",label:"Trash",count:Re}],Je=We.reduce((i,F)=>i+F.count,0),lt=S.isLoading||j.isLoading||A.isLoading||E.isLoading||P.isLoading,ct=S.isError||j.isError||A.isError||E.isError||P.isError,ot=()=>{S.refetch(),j.refetch(),A.refetch(),E.refetch(),P.refetch()};function ve(i,F,z){return K=>{if(i?.some(le=>le.id===K.id))z.mutate(K);else{const{id:le,...se}=K;F.mutate(se)}}}const Pe=async i=>{try{const F=await us.get(`/api/sot/export/${i}`),z=typeof F=="string"?F:JSON.stringify(F,null,2),K=i==="json"?"application/json":"text/plain",te=new Blob([z],{type:K}),le=URL.createObjectURL(te),se=document.createElement("a");se.href=le,se.download=`sot-export.${i==="markdown"?"md":i}`,se.click(),URL.revokeObjectURL(le),y.success(`Exported as ${i.toUpperCase()}`)}catch{y.error("Export failed")}};J.filter(i=>i.severity==="critical"||i.severity==="high");const Ze=n.useMemo(()=>{const i={};for(const F of Fe){const z=F.date||F.created_at||F.timestamp,K=z?new Date(z).toLocaleDateString():"Unknown";i[K]||(i[K]=[]),i[K].push(F)}return Object.entries(i)},[Fe]);return e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-[var(--gm-text-primary)]",children:"Source of Truth"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:[Je," entities · ",J.length," alerts · Score ",he,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Pe("markdown"),"aria-label":"Export as Markdown",className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)]",children:[e.jsx(Oe,{className:"w-3 h-3"})," MD"]}),e.jsxs("button",{onClick:()=>Pe("html"),"aria-label":"Export as HTML",className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)]",children:[e.jsx(bs,{className:"w-3 h-3"})," HTML"]}),e.jsxs("button",{onClick:()=>Pe("json"),"aria-label":"Export as JSON",className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)]",children:[e.jsx(ys,{className:"w-3 h-3"})," JSON"]})]})]}),e.jsx("div",{className:R(ee,"p-1 flex gap-1"),role:"tablist",children:[{key:"overview",label:"Overview",icon:fs},{key:"entities",label:`Entities (${Je})`,icon:Oe},{key:"timeline",label:`Timeline (${Fe.length})`,icon:be},{key:"history",label:`History (${ke.length})`,icon:Ke}].map(i=>e.jsxs("button",{onClick:()=>m(i.key),role:"tab","aria-selected":t===i.key,className:R("flex-1 flex items-center justify-center gap-1.5 px-3 py-2 text-[11px] font-medium rounded-lg transition-colors",t===i.key?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:[e.jsx(i.icon,{className:"w-3.5 h-3.5"})," ",i.label]},i.key))}),t==="overview"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:R(ee,"p-5 flex items-center gap-5"),children:[e.jsxs("div",{className:"relative w-20 h-20 shrink-0",children:[e.jsxs("svg",{viewBox:"0 0 36 36",className:"w-full h-full -rotate-90",children:[e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:"var(--gm-bg-tertiary)",strokeWidth:"3"}),e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:Qe,strokeWidth:"3",strokeDasharray:`${he/100*97.4} 97.4`,strokeLinecap:"round",className:"transition-all duration-700"})]}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-lg font-bold tabular-nums",style:{color:Qe},children:he})]}),e.jsxs("div",{children:[e.jsx("div",{className:me,children:"Health Score"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-secondary)] mt-1 capitalize",children:W.status||"—"}),Array.isArray(W.factors)&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:W.factors.slice(0,3).map((i,F)=>e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:i.name||i.label||i.factor},F))})]})]}),e.jsxs("div",{className:R(ee,"p-5"),children:[e.jsx("div",{className:me,children:"Changes Since Last View"}),q.isFirstView?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-2",children:"First view — no prior snapshot"}):Te.length>0?e.jsx("div",{className:"mt-2 space-y-1.5",children:Te.map((i,F)=>{const z=Number(i.change??0);return e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-[var(--gm-text-secondary)] capitalize",children:i.metric||"—"}),e.jsxs("span",{className:R("flex items-center gap-1 font-medium tabular-nums",z>0?"text-green-400":z<0?"text-red-400":"text-[var(--gm-text-tertiary)]"),children:[z>0?e.jsx(js,{className:"w-3 h-3"}):z<0?e.jsx(Ns,{className:"w-3 h-3"}):e.jsx(ws,{className:"w-3 h-3"}),z>0?"+":"",z]})]},F)})}):e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-2",children:"No changes since last view"}),q.summary&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-2",children:q.summary})]}),e.jsxs("div",{className:R(ee,"p-5"),children:[e.jsxs("div",{className:me,children:["Alerts (",J.length,")"]}),J.length>0?e.jsx("div",{className:"mt-2 space-y-2 max-h-40 overflow-y-auto",children:J.slice(0,8).map((i,F)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:R("w-1.5 h-1.5 rounded-full mt-1.5 shrink-0",i.severity==="critical"?"bg-red-500":i.severity==="high"?"bg-orange-500":i.severity==="medium"?"bg-amber-500":"bg-blue-500")}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-primary)] block truncate",children:i.title||i.message||"—"}),i.message&&i.title&&e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] block truncate",children:i.message})]})]},F))}):e.jsx("p",{className:"text-xs text-green-400 mt-2",children:"No active alerts"})]})]}),de.length>0&&e.jsxs("div",{className:R(ee,"overflow-hidden"),children:[e.jsxs("button",{onClick:()=>u(!g),className:"w-full px-5 py-3 flex items-center justify-between border-b border-[var(--gm-border-primary)] hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-3.5 h-3.5 text-[var(--gm-accent-primary)]"}),e.jsxs("span",{className:me,children:["Insights (",de.length,")"]})]}),g?e.jsx(ps,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"}):e.jsx(xe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})]}),g&&e.jsx("div",{className:"divide-y divide-[var(--gm-border-primary)]",children:de.map((i,F)=>e.jsxs("div",{className:"px-5 py-3 flex items-start gap-3 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("span",{className:"text-lg shrink-0",children:i.icon||"💡"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-semibold text-[var(--gm-text-primary)]",children:i.title||"—"}),i.category&&e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] capitalize",children:i.category})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-secondary)] mt-0.5",children:i.message||"—"}),i.suggestion&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-accent-primary)] mt-1",children:["→ ",i.suggestion]})]})]},F))})]}),e.jsxs("div",{className:R(ee,"p-4 flex items-center gap-3"),children:[e.jsxs("button",{onClick:()=>Q.mutate(void 0,{onSuccess:i=>{i?.content||i?.summary?y.success("Executive summary generated"):y.info("No summary content returned")},onError:i=>y.error(i.message)}),disabled:Q.isPending,className:"inline-flex items-center gap-1.5 px-4 py-2 text-xs font-medium rounded-lg bg-[var(--gm-accent-primary)] text-white hover:opacity-90 transition-opacity",children:[Q.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(gs,{className:"w-3.5 h-3.5"}),"Generate Executive Summary"]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"AI-generated summary of health, risks, and key decisions"})]})]}),t==="entities"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1 bg-[var(--gm-bg-tertiary)] rounded-xl p-1",role:"tablist",children:We.map(i=>e.jsxs("button",{onClick:()=>a(i.key),role:"tab","aria-selected":f===i.key,className:R("flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors relative",f===i.key?"bg-[var(--gm-surface-primary)] text-[var(--gm-text-primary)] shadow-sm":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:[i.label,e.jsx("span",{className:"ml-1.5 text-[10px] opacity-60",children:i.count})]},i.key))}),ct?e.jsx(dt,{message:"Failed to load Source of Truth data.",onRetry:ot}):lt?e.jsx(mt,{}):e.jsxs(M.div,{initial:{opacity:0},animate:{opacity:1},children:[f==="questions"&&e.jsx(Ds,{initialData:S.data??[],onSave:ve(S.data,N,k),onDelete:i=>I.mutate(i)}),f==="facts"&&e.jsx(Ls,{initialData:j.data??[],onSave:ve(j.data,O,d),onDelete:i=>D.mutate(i)}),f==="risks"&&e.jsx(Fs,{initialData:A.data??[],onSave:ve(A.data,v,x),onDelete:i=>_.mutate(i)}),f==="actions"&&e.jsx(Vs,{initialData:E.data??[],onSave:ve(E.data,T,U),onDelete:i=>Z.mutate(i)}),f==="decisions"&&e.jsx(Ws,{initialData:P.data??[],onSave:ve(P.data,B,V),onDelete:i=>Y.mutate(i)}),f==="stories"&&e.jsx(Xs,{}),f==="trash"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[var(--gm-text-tertiary)]",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Deleted entities (",Re,")"]})]}),Re===0?e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)] text-center py-12",children:"Trash is empty"}):e.jsxs("div",{className:"space-y-2",children:[He.map(i=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3",children:[e.jsx("span",{className:"text-[9px] font-medium px-2 py-0.5 rounded-full bg-blue-500/10 text-blue-400",children:"fact"}),e.jsx("span",{className:"flex-1 text-sm text-[var(--gm-text-secondary)] truncate",children:i.content||"—"}),e.jsxs("button",{onClick:()=>{fe.mutate(String(i.id)),y.success("Fact restored")},disabled:fe.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 text-[10px] font-medium rounded-lg bg-green-500/10 text-green-400 hover:bg-green-500/20",children:[e.jsx(Ce,{className:"w-3 h-3"})," Restore"]})]},String(i.id))),Ve.map(i=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3",children:[e.jsx("span",{className:"text-[9px] font-medium px-2 py-0.5 rounded-full bg-purple-500/10 text-purple-400",children:"decision"}),e.jsx("span",{className:"flex-1 text-sm text-[var(--gm-text-secondary)] truncate",children:i.content||"—"}),e.jsxs("button",{onClick:()=>{je.mutate(String(i.id)),y.success("Decision restored")},disabled:je.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 text-[10px] font-medium rounded-lg bg-green-500/10 text-green-400 hover:bg-green-500/20",children:[e.jsx(Ce,{className:"w-3 h-3"})," Restore"]})]},String(i.id))),Be.map(i=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3",children:[e.jsx("span",{className:"text-[9px] font-medium px-2 py-0.5 rounded-full bg-red-500/10 text-red-400",children:"risk"}),e.jsx("span",{className:"flex-1 text-sm text-[var(--gm-text-secondary)] truncate",children:i.content||"—"}),e.jsxs("button",{onClick:()=>{Ne.mutate(String(i.id)),y.success("Risk restored")},disabled:Ne.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 text-[10px] font-medium rounded-lg bg-green-500/10 text-green-400 hover:bg-green-500/20",children:[e.jsx(Ce,{className:"w-3 h-3"})," Restore"]})]},String(i.id))),Ge.map(i=>e.jsxs("div",{className:"flex items-center gap-3 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-xl p-3",children:[e.jsx("span",{className:"text-[9px] font-medium px-2 py-0.5 rounded-full bg-amber-500/10 text-amber-400",children:"action"}),e.jsx("span",{className:"flex-1 text-sm text-[var(--gm-text-secondary)] truncate",children:i.task||i.content||"—"}),e.jsxs("button",{onClick:()=>{we.mutate(String(i.id)),y.success("Action restored")},disabled:we.isPending,className:"inline-flex items-center gap-1 px-2.5 py-1 text-[10px] font-medium rounded-lg bg-green-500/10 text-green-400 hover:bg-green-500/20",children:[e.jsx(Ce,{className:"w-3 h-3"})," Restore"]})]},String(i.id)))]})]})]},f)]}),t==="timeline"&&e.jsx("div",{className:"space-y-4",children:p?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx($,{className:"h-8 w-8 animate-spin text-[var(--gm-accent-primary)]"})}):Ze.length>0?e.jsx("div",{className:"space-y-6",children:Ze.map(([i,F])=>e.jsxs("div",{children:[e.jsx("div",{className:"sticky top-0 z-10 py-1.5 px-3 bg-[var(--gm-bg-primary)]",children:e.jsx("span",{className:"text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-wider",children:i})}),e.jsx("div",{className:"relative ml-4 border-l-2 border-[var(--gm-border-primary)] space-y-0",children:F.map((z,K)=>{const te=z.type||z.entity_type||"event",le={decision:"bg-purple-500",risk:"bg-red-500",action:"bg-amber-500",fact:"bg-blue-500",question:"bg-cyan-500",document:"bg-green-500",email:"bg-pink-500",conversation:"bg-indigo-500"},se=z.date||z.created_at||z.timestamp;return e.jsxs("div",{className:"relative pl-6 py-2.5 hover:bg-[var(--gm-surface-hover)] transition-colors rounded-r-lg",children:[e.jsx("span",{className:R("absolute left-[-5px] top-3.5 w-2.5 h-2.5 rounded-full border-2 border-[var(--gm-bg-primary)]",le[te]||"bg-gray-500")}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:R("text-[8px] px-1.5 py-0.5 rounded-full font-medium capitalize border",te==="risk"?"bg-red-500/10 border-red-500/30 text-red-400":te==="decision"?"bg-purple-500/10 border-purple-500/30 text-purple-400":te==="action"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:te}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)] truncate",children:z.title||z.content||z.name||"—"})]}),z.description&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate",children:z.description||z.content})]}),e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums shrink-0 mt-0.5",children:se?new Date(se).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""})]})]},K)})})]},i))}):e.jsxs("div",{className:R(ee,"p-8 text-center"),children:[e.jsx(be,{className:"w-8 h-8 text-[var(--gm-text-tertiary)] mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"No timeline events yet"})]})}),t==="history"&&e.jsxs("div",{className:"space-y-5",children:[ke.length>0?e.jsxs("div",{className:R(ee,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("span",{className:me,children:"Version History"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[ke.length," snapshots"]})]}),e.jsx("div",{className:"max-h-72 overflow-y-auto divide-y divide-[var(--gm-border-primary)]",children:ke.map((i,F)=>e.jsxs("div",{className:"px-5 py-3 flex items-center hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-bold text-[var(--gm-accent-primary)] tabular-nums",children:["v",i.version_number||F+1]}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:i.created_at?new Date(i.created_at).toLocaleString():"—"})]}),e.jsxs("div",{className:"flex gap-3 mt-1 text-[9px] text-[var(--gm-text-tertiary)]",children:[i.facts_count!=null&&e.jsxs("span",{children:[i.facts_count," facts"]}),i.decisions_count!=null&&e.jsxs("span",{children:[i.decisions_count," decisions"]}),i.risks_count!=null&&e.jsxs("span",{children:[i.risks_count," risks"]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>b(String(i.version_number??i.id)),className:R("text-[9px] px-2 py-1 rounded border",c===String(i.version_number??i.id)?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:"V1"}),e.jsx("button",{onClick:()=>s(String(i.version_number??i.id)),className:R("text-[9px] px-2 py-1 rounded border",r===String(i.version_number??i.id)?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:"V2"})]})]},F))})]}):e.jsxs("div",{className:R(ee,"p-8 text-center"),children:[e.jsx(Ke,{className:"w-8 h-8 text-[var(--gm-text-tertiary)] mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"No version history yet"})]}),c&&r&&e.jsxs("div",{className:R(ee,"p-5 space-y-3"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:me,children:["Compare v",c," ↔ v",r]}),C.isFetching&&e.jsx($,{className:"w-3.5 h-3.5 animate-spin text-[var(--gm-accent-primary)]"})]}),Ue.ok?e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] font-mono bg-[var(--gm-bg-tertiary)] p-3 rounded-lg overflow-auto max-h-64 whitespace-pre-wrap",children:JSON.stringify(Ue,null,2)}):C.isError?e.jsx("p",{className:"text-xs text-red-400",children:"Failed to compare versions"}):C.isFetching?null:e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Select V1 and V2 to compare"})]})]})]})}export{Sr as default};
//# sourceMappingURL=SotPage-BQ9BjH_w.js.map
