import{j as e,r as N}from"./vendor-react-CZ-WyKWZ.js";import{t as V}from"./vendor-ui-BS9QKitv.js";import{bg as ke,L as le,w as Ve,O as Ue,C as Xe,J as He,a6 as Ke,T as Ce,Z as Fe,bh as Qe,bi as Je,bj as Ze,bk as et,bl as tt,bm as st,U as fe,R as rt,bn as ce,g as be,ad as K,ai as at,f as nt,bo as it,bp as ct,bq as lt,P as ot,G as ve,H as je}from"./main-B3DZn5B_.js";import{b as dt}from"./vendor-query-DSf7I7Ei.js";import{C as mt}from"./CommentsPanel-CZdKIoGH.js";import{A as xt}from"./arrow-left-BUrpeDp8.js";import{R as Be}from"./rotate-cw-wbVSlX31.js";import{E as gt}from"./eye-RsgK9PvA.js";import{S as pt}from"./star-YHn3OJCl.js";import{E as ut}from"./ErrorState-to3SSPKs.js";import{P as qe}from"./play-BMZi0w5i.js";import{C as We}from"./chart-column-BRODuIXF.js";import{A as Te}from"./arrow-right-BfPHyTFx.js";import{T as Me}from"./trending-up-CGQOSwHs.js";import{C as ht}from"./circle-check-big-Do7NRW-9.js";import"./vendor-supabase-Bpw_79gH.js";import"./vendor-router-D_XeKoA_.js";import"./vendor-markdown-Cu8AM8lU.js";import"./send-CaMoZtNQ.js";import"./pen-UIQK8jUR.js";import"./circle-6fOsuLxM.js";const Pe="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200";function ft({url:a,name:t,initials:r}){const[l,c]=N.useState(!1);return a&&!l?e.jsx("img",{src:a,alt:t,referrerPolicy:"no-referrer",onError:()=>c(!0),className:"w-14 h-14 rounded-full object-cover border-2 border-blue-600/30"}):e.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center text-lg font-bold text-white border-2 border-[var(--gm-border-primary)]",style:{background:`linear-gradient(135deg, ${oe(t)}, ${ye(oe(t),-30)})`},children:r})}function bt({profile:a,onBack:t}){const r=ke(),l=dt(),c=a.contact??{},s=String(c.name||a.person_name||"Unknown"),i=String(c.role||c.organization||""),n=s.split(" ").map(j=>j[0]).join("").substring(0,2).toUpperCase(),x=c.avatar_url||c.photo_url,m=typeof x=="string"&&x.length>0&&x!=="undefined"&&x!=="null"?x:null,g=a.profile_data??{},v=String(a.confidence_level||"low"),f=String(a.contact_id||a.person_id||""),u=Number(a.total_speaking_time_seconds||0),_=a.limitations??[],w=a.last_analysis_at?new Date(String(a.last_analysis_at)).toLocaleString():"â€”",R=()=>{f&&r.mutate({personId:f,forceReanalysis:!0},{onSuccess:()=>{V.success(`Re-analysis started for ${s}`),l.invalidateQueries({queryKey:["team-profiles"]})},onError:()=>V.error("Failed to start re-analysis")})},b=j=>{if(!j)return"â€”";const T=Math.floor(j/60),M=j%60;return T>0?`${T}m ${M}s`:`${M}s`};return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-1.5 text-xs text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors mb-2",children:[e.jsx(xt,{className:"w-3.5 h-3.5"})," Back to Team Analysis"]}),e.jsxs("div",{className:Pe,children:[e.jsxs("div",{className:"p-5 rounded-t-xl",style:{background:"linear-gradient(to right, rgba(37,99,235,0.15), rgba(37,99,235,0.04))"},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ft,{url:m,name:s,initials:n}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:s}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[i&&e.jsx("span",{className:"text-xs text-[var(--gm-text-tertiary)]",children:i}),e.jsxs("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium capitalize ${v==="high"||v==="very_high"?"bg-green-500/20 text-green-400":v==="medium"?"bg-yellow-500/20 text-yellow-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"}`,children:[v.replace("_"," ")," confidence"]})]})]}),e.jsxs("button",{onClick:R,disabled:r.isPending,className:"px-3 py-1.5 rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] text-xs font-medium hover:bg-[var(--gm-interactive-primary-hover)] flex items-center gap-1.5 disabled:opacity-50 transition-colors",children:[r.isPending?e.jsx(le,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Be,{className:"w-3.5 h-3.5"}),"Re-analyze"]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 flex-wrap",children:[e.jsx(ne,{label:"Influence",value:String(a.influence_score||0)}),e.jsx(ne,{label:"Transcripts",value:String(a.transcript_count||0)}),e.jsx(ne,{label:"Risk",value:String(a.risk_tolerance||"â€”")}),e.jsx(ne,{label:"Speaking Time",value:b(u)}),e.jsx(ne,{label:"Last Analysis",value:w})]})]}),e.jsxs("div",{className:"p-5 space-y-4",children:[a.communication_style&&e.jsxs("div",{className:"bg-blue-600/5 border border-blue-600/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-[10px] text-[var(--gm-accent-primary)] font-semibold uppercase tracking-wider mb-1",children:"Communication Style"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:String(a.communication_style)})]}),a.dominant_motivation&&e.jsxs("div",{className:"bg-green-500/5 border border-green-500/10 rounded-xl p-4",children:[e.jsx("h4",{className:"text-[10px] text-green-500 font-semibold uppercase tracking-wider mb-1",children:"Dominant Motivation"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-primary)]",children:String(a.dominant_motivation)})]}),e.jsx(yt,{data:g}),e.jsx(vt,{data:g}),e.jsx(jt,{data:g}),e.jsx(Nt,{data:g}),e.jsx(wt,{data:g}),e.jsx(St,{data:g}),e.jsx(_t,{data:g}),e.jsx(kt,{data:g}),_.length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsx(Q,{icon:Ve,title:"Limitations"}),e.jsx("ul",{className:"space-y-1",children:_.map((j,T)=>e.jsxs("li",{className:"text-xs text-[var(--gm-text-tertiary)] flex items-start gap-2",children:[e.jsx("span",{className:"text-gray-500 mt-0.5",children:"â€¢"})," ",j]},T))})]}),Object.keys(g).length===0&&!a.communication_style&&e.jsxs("div",{className:"text-center py-8 text-[var(--gm-text-tertiary)]",children:[e.jsx(gt,{className:"w-10 h-10 mx-auto mb-3 text-gray-500"}),e.jsx("p",{className:"text-sm",children:"No detailed profile data available yet."}),e.jsx("p",{className:"text-xs mt-1",children:'Click "Re-analyze" to generate AI insights.'})]})]})]}),f&&e.jsx("div",{className:Pe,children:e.jsx(mt,{targetType:"profile",targetId:f})})]})}function ne({label:a,value:t}){return e.jsxs("div",{className:"rounded-lg px-3 py-1.5 text-center bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)]",children:[e.jsx("p",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:t}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:a})]})}function Q({icon:a,title:t}){return e.jsxs("h4",{className:"flex items-center gap-2 text-sm font-semibold text-[var(--gm-text-primary)] mb-3",children:[e.jsx(a,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"})," ",t]})}function yt({data:a}){const t=a.communication_identity;return t?e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsx(Q,{icon:Ue,title:"Communication Identity"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[t.dominant_style&&e.jsx(_e,{label:"Style",value:String(t.dominant_style)}),t.intervention_rhythm&&e.jsx(_e,{label:"Rhythm",value:String(t.intervention_rhythm)}),t.textual_body_language&&e.jsx(_e,{label:"Textual Cues",value:String(t.textual_body_language)})]}),e.jsx(Ge,{evidence:t.evidence})]}):null}function vt({data:a}){const t=a.motivations_and_priorities;if(!t)return null;const r=t.values_most??[],l=t.avoids??[];return e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsx(Q,{icon:pt,title:"Motivations & Priorities"}),r.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-medium",children:"Values most:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:r.map((c,s)=>e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-green-500/10 text-green-500",children:c},s))})]}),l.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-medium",children:"Avoids:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:l.map((c,s)=>e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-red-500/10 text-red-500",children:c},s))})]}),t.based_on&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:["Based on: ",String(t.based_on)]}),t.confidence&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Confidence: ",String(t.confidence)]}),e.jsx(Ge,{evidence:t.evidence})]})}function jt({data:a}){const t=a.behavior_under_pressure;return t?.length?e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsx(Q,{icon:Xe,title:"Behavior Under Pressure"}),e.jsx("div",{className:"space-y-2",children:t.map((r,l)=>e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:String(r.situation)}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5",children:String(r.observed_behavior)}),r.quote&&e.jsxs("p",{className:"text-xs italic text-[var(--gm-text-tertiary)] mt-1 border-l-2 border-blue-600/30 pl-2",children:['"',String(r.quote),'"']}),r.timestamp&&e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:String(r.timestamp)})]},l))})]}):null}function Nt({data:a}){const t=a.influence_tactics;return t?.length?e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsx(Q,{icon:He,title:"Influence Tactics"}),e.jsx("div",{className:"space-y-2",children:t.map((r,l)=>e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:String(r.objective)}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5",children:String(r.tactic)}),r.example&&e.jsx("p",{className:"text-xs italic text-[var(--gm-text-tertiary)] mt-1 border-l-2 border-blue-600/30 pl-2",children:String(r.example)}),r.timestamp&&e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:String(r.timestamp)})]},l))})]}):null}function wt({data:a}){const t=a.vulnerabilities;if(!t)return null;const r=t.defense_triggers??[],l=t.blind_spots??[],c=t.discourse_action_inconsistencies??[],s=t.risk_patterns??[];return!r.length&&!l.length&&!c.length&&!s.length?null:e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsx(Q,{icon:Ke,title:"Vulnerabilities & Friction Points"}),c.length>0&&e.jsx(he,{label:"Discourse-Action Inconsistencies",color:"text-red-500",items:c,field:"description",evidenceField:"evidence"}),r.length>0&&e.jsx(he,{label:"Defense Triggers",color:"text-red-500",items:r,field:"trigger",evidenceField:"evidence"}),l.length>0&&e.jsx(he,{label:"Blind Spots",color:"text-yellow-500",items:l,field:"description",evidenceField:"evidence"}),s.length>0&&e.jsx(he,{label:"Risk Patterns",color:"text-yellow-500",items:s,field:"pattern",evidenceField:"evidence"})]})}function he({label:a,color:t,items:r,field:l,evidenceField:c}){return e.jsxs("div",{className:"mb-3 last:mb-0",children:[e.jsx("p",{className:`text-[10px] font-semibold uppercase tracking-wider mb-1.5 ${t}`,children:a}),e.jsx("div",{className:"space-y-1.5",children:r.map((s,i)=>e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg p-2.5",children:[e.jsx("p",{className:"text-xs text-[var(--gm-text-primary)]",children:String(s[l]||s.text||s)}),s[c]&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 italic",children:String(s[c])})]},i))})]})}function St({data:a}){const t=a.interaction_strategy;if(!t)return null;const r=t.framing_that_works??[],l=t.what_to_avoid??[],c=t.cooperation_triggers??[],s=t.ideal_format;return e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsx(Q,{icon:Ue,title:"Recommended Interaction Strategy"}),s&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[s.channel&&e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-600/10 text-[var(--gm-accent-primary)]",children:["Channel: ",String(s.channel)]}),s.structure&&e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-600/10 text-[var(--gm-accent-primary)]",children:["Structure: ",String(s.structure)]}),s.timing&&e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-600/10 text-[var(--gm-accent-primary)]",children:["Timing: ",String(s.timing)]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[r.length>0&&e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-green-500 font-semibold uppercase tracking-wider mb-1",children:"What Works"}),e.jsx("ul",{className:"space-y-0.5",children:r.map((i,n)=>e.jsxs("li",{className:"text-xs text-[var(--gm-text-primary)]",children:["+ ",i]},n))})]}),l.length>0&&e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-red-500 font-semibold uppercase tracking-wider mb-1",children:"What to Avoid"}),e.jsx("ul",{className:"space-y-0.5",children:l.map((i,n)=>e.jsxs("li",{className:"text-xs text-[var(--gm-text-primary)]",children:["- ",i]},n))})]}),c.length>0&&e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg p-3",children:[e.jsx("p",{className:"text-[10px] text-[var(--gm-accent-primary)] font-semibold uppercase tracking-wider mb-1",children:"Cooperation Triggers"}),e.jsx("ul",{className:"space-y-0.5",children:c.map((i,n)=>e.jsxs("li",{className:"text-xs text-[var(--gm-text-primary)]",children:["â†’ ",i]},n))})]})]})]})}function _t({data:a}){const t=a.early_warning_signs;return t?.length?e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsx(Q,{icon:Ce,title:"Early Warning Signs"}),e.jsx("div",{className:"space-y-2",children:t.map((r,l)=>e.jsxs("div",{className:"bg-yellow-500/5 border border-yellow-500/10 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:String(r.signal)}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5",children:["Indicates: ",String(r.indicates)]}),r.comparison_evidence&&e.jsxs("p",{className:"text-[10px] text-gray-400 mt-1 italic",children:["Evidence: ",String(r.comparison_evidence)]})]},l))})]}):null}function kt({data:a}){const t=a.power_analysis;return t?.length?e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4",children:[e.jsx(Q,{icon:Fe,title:"Power & Dependency Analysis"}),e.jsx("div",{className:"space-y-2",children:t.map((r,l)=>e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:String(r.factor)}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5",children:String(r.assessment)}),r.strategic_implication&&e.jsxs("p",{className:"text-xs text-[var(--gm-accent-primary)] mt-1",children:["â†’ ",String(r.strategic_implication)]})]},l))})]}):null}function _e({label:a,value:t}){return e.jsxs("div",{className:"bg-[var(--gm-bg-tertiary)] rounded-lg p-3",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:a}),e.jsx("p",{className:"text-xs text-[var(--gm-text-primary)] mt-0.5",children:t})]})}function Ge({evidence:a}){return a?.length?e.jsxs("div",{className:"mt-3 space-y-1.5",children:[e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-medium uppercase tracking-wider",children:"Evidence"}),a.slice(0,5).map((t,r)=>e.jsxs("div",{className:"text-xs bg-[var(--gm-bg-tertiary)] rounded p-2",children:[t.quote&&e.jsxs("p",{className:"italic text-[var(--gm-text-tertiary)] border-l-2 border-blue-600/30 pl-2",children:['"',String(t.quote),'"']}),t.observation&&e.jsx("p",{className:"text-[var(--gm-text-tertiary)] mt-0.5",children:String(t.observation)}),t.timestamp&&e.jsx("p",{className:"text-[10px] text-gray-400 mt-0.5",children:String(t.timestamp)})]},r))]}):null}function oe(a){const t=["#9b59b6","#3498db","#e74c3c","#27ae60","#f59e0b","#1abc9c","#e67e22","#34495e"];let r=0;for(let l=0;l<a.length;l++)r=a.charCodeAt(l)+((r<<5)-r);return t[Math.abs(r)%t.length]}function ye(a,t){const r=n=>Math.min(255,Math.max(0,n)),l=a.replace("#",""),c=r(parseInt(l.substring(0,2),16)+t),s=r(parseInt(l.substring(2,4),16)+t),i=r(parseInt(l.substring(4,6),16)+t);return`#${c.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`}function de({url:a,name:t,size:r="md",className:l=""}){const[c,s]=N.useState(!1),i=be(t),n=r==="sm"?"w-5 h-5":r==="lg"?"w-14 h-14":"w-8 h-8",x=r==="sm"?"text-[8px]":r==="lg"?"text-lg":"text-[10px]",m=r==="lg"?"border-2 border-white/20":"";return a&&!c?e.jsx("img",{src:a,alt:t,referrerPolicy:"no-referrer",onError:()=>s(!0),className:`${n} rounded-full object-cover flex-shrink-0 ${l}`}):e.jsx("div",{className:`${n} rounded-full flex items-center justify-center ${x} font-bold text-white flex-shrink-0 ${m} ${l}`,style:{background:`linear-gradient(135deg, ${oe(t)}, ${ye(oe(t),-30)})`},children:i})}function Ct(a){const t={};return a.forEach((r,l)=>{const c=r.contact??{},s=String(c.name||r.person_name||"Unknown"),i=c.avatar_url||c.photo_url,n={name:s,initials:be(s),role:String(c.role||c.organization||""),avatarUrl:i?String(i):void 0};t[`person_${l+1}`]=n,t[`person ${l+1}`]=n,t[s.toLowerCase()]=n;const x=s.split(" ")[0];x&&(t[x.toLowerCase()]=n);const m=String(r.contact_id||r.person_id||"");m&&(t[m]=n)}),r=>{if(!r)return{name:"Unknown",initials:"?",role:""};const l=r.toLowerCase().trim();return t[l]||t[r]||{name:r.replace(/_/g," "),initials:be(r),role:""}}}function se(a,t){return a.replace(/Person_(\d+)/gi,r=>t(r).name)}function Y({name:a,resolve:t}){const r=t(a);return e.jsxs("div",{className:"inline-flex items-center gap-1.5 bg-gm-surface-primary border border-gm-border-primary rounded-full px-2.5 py-1",children:[e.jsx(de,{url:K(r.avatarUrl)?r.avatarUrl:null,name:r.name,size:"sm"}),e.jsx("span",{className:"text-[10px] font-medium text-gm-text-primary whitespace-nowrap",children:r.name})]})}const Re={direct:{color:"#3b82f6",bg:"#eff6ff",icon:"â†’"},technical:{color:"#8b5cf6",bg:"#f5f3ff",icon:"âš™"},political:{color:"#f59e0b",bg:"#fffbeb",icon:"â™Ÿ"},social:{color:"#10b981",bg:"#ecfdf5",icon:"ðŸ¤"},resource:{color:"#ef4444",bg:"#fef2f2",icon:"ðŸ“Š"}},$e={natural:{color:"#10b981",bg:"#ecfdf5",icon:"ðŸŒ±"},circumstantial:{color:"#6366f1",bg:"#eef2ff",icon:"ðŸ”—"},strategic:{color:"#f59e0b",bg:"#fffbeb",icon:"â™Ÿ"},historical:{color:"#8b5cf6",bg:"#f5f3ff",icon:"ðŸ“œ"}},Ie={technical:{color:"#8b5cf6",bg:"#f5f3ff",icon:"âš™"},resource:{color:"#f59e0b",bg:"#fffbeb",icon:"ðŸ“Š"},political:{color:"#ef4444",bg:"#fef2f2",icon:"â™Ÿ"},communication:{color:"#3b82f6",bg:"#eff6ff",icon:"ðŸ’¬"},values:{color:"#10b981",bg:"#ecfdf5",icon:"âš–"}},Ee={technical:{color:"#8b5cf6",bg:"#f5f3ff",icon:"âš™"},formal:{color:"#3b82f6",bg:"#eff6ff",icon:"ðŸ‘”"},informal:{color:"#f59e0b",bg:"#fffbeb",icon:"ðŸ’¬"},social:{color:"#10b981",bg:"#ecfdf5",icon:"ðŸ¤"},resource:{color:"#ef4444",bg:"#fef2f2",icon:"ðŸ“Š"}};function cs(){const[a,t]=N.useState("profiles"),[r,l]=N.useState(null),[c,s]=N.useState(!1),i=Qe(),n=Je(),x=Ze(),m=et(),g=tt(),v=st(),f=N.useMemo(()=>i.data?.profiles??[],[i.data]),u=N.useMemo(()=>Ct(f),[f]);if(i.error)return e.jsx("div",{className:"p-6",children:e.jsx(ut,{message:"Failed to load team profiles.",onRetry:()=>i.refetch()})});if(r)return e.jsx(bt,{profile:r,onBack:()=>l(null)});const _=[{key:"profiles",label:"Profiles",icon:fe},{key:"team",label:"Team Dynamics",icon:We},{key:"relationships",label:"Relationships",icon:Te},{key:"graph",label:"Network Graph",icon:ce}],w=()=>{g.mutate({forceReanalysis:!0},{onSuccess:()=>V.success("Team analysis started"),onError:()=>V.error("Failed to start team analysis")})},R=()=>{v.mutate(void 0,{onSuccess:()=>{V.success("Graph synced"),m.refetch()},onError:()=>V.error("Failed to sync graph")})};return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gm-text-primary",children:"Team Analysis"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>s(!0),className:"px-3 py-1.5 rounded-lg bg-gm-interactive-secondary text-gm-text-primary text-xs font-medium hover:bg-gm-interactive-secondary-hover flex items-center gap-1.5 transition-colors",children:[e.jsx(fe,{className:"w-3.5 h-3.5"})," Analyze Members"]}),e.jsxs("button",{onClick:w,disabled:g.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover flex items-center gap-1.5 disabled:opacity-50 transition-colors",children:[g.isPending?e.jsx(le,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(qe,{className:"w-3.5 h-3.5"}),"Run Team Analysis"]}),e.jsxs("button",{onClick:R,disabled:v.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover flex items-center gap-1.5 disabled:opacity-50 transition-colors border border-gm-border-primary",children:[v.isPending?e.jsx(le,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(rt,{className:"w-3.5 h-3.5"}),"Sync Graph"]})]})]}),e.jsx("div",{className:"flex gap-1 bg-gm-surface-secondary rounded-xl p-1",children:_.map(b=>{const j=b.icon;return e.jsxs("button",{onClick:()=>t(b.key),className:`flex-1 flex items-center justify-center gap-1.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${a===b.key?"bg-gm-surface-primary text-gm-text-primary shadow-sm":"text-gm-text-tertiary hover:text-gm-text-primary"}`,children:[e.jsx(j,{className:"w-3.5 h-3.5"})," ",b.label]},b.key)})}),a==="profiles"&&e.jsx(Tt,{profiles:f,isLoading:i.isLoading,onSelectProfile:l}),a==="team"&&e.jsx(Mt,{data:n.data?.analysis??n.data,isLoading:n.isLoading,profiles:f,resolveName:u}),a==="relationships"&&e.jsx(Et,{data:x.data,isLoading:x.isLoading,profiles:f,resolveName:u}),a==="graph"&&e.jsx(Lt,{data:m.data,isLoading:m.isLoading,profiles:f,resolveName:u}),e.jsx(Ut,{open:c,onClose:()=>s(!1),existingProfileIds:new Set(f.map(b=>String(b.contact_id||b.person_id||"")))})]})}function Tt({profiles:a,isLoading:t,onSelectProfile:r}){const l=ke();if(t)return e.jsx(me,{});if(a.length===0)return e.jsx(Ne,{icon:fe,message:"No team profiles available. Click 'Analyze Members' to generate AI behavioral profiles."});const c=[...a].sort((i,n)=>(Number(n.influence_score)||0)-(Number(i.influence_score)||0)),s=(i,n)=>{i.stopPropagation();const x=String(n.contact_id||n.person_id||"");if(!x)return;const m=n.contact??{},g=String(m.name||n.person_name||"Unknown");l.mutate({personId:x,forceReanalysis:!0},{onSuccess:()=>V.success(`Re-analysis started for ${g}`),onError:()=>V.error("Failed to start re-analysis")})};return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map((i,n)=>{const x=i.contact??{},m=String(x.name||i.person_name||"Unknown"),g=String(x.role||x.organization||""),v=K(x.avatar_url)?x.avatar_url:K(x.photo_url)?x.photo_url:null,f=String(i.confidence_level||"low"),u=String(i.communication_style||""),_=Number(i.total_speaking_time_seconds||0),w=_?`${Math.floor(_/60)}m`:"";return e.jsxs("div",{onClick:()=>r(i),className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4 hover:border-blue-600/30 hover:-translate-y-0.5 transition-all cursor-pointer group shadow-sm hover:shadow-md",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(de,{url:v,name:m,size:"lg",className:"border-2 border-gm-surface-secondary"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gm-text-primary truncate group-hover:text-gm-interactive-primary transition-colors",children:m}),g&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary mt-0.5",children:g}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1.5",children:e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium capitalize ${f==="high"||f==="very_high"?"bg-gm-status-success-bg text-gm-status-success":f==="medium"?"bg-gm-status-warning-bg text-gm-status-warning":"bg-gm-surface-secondary text-gm-text-tertiary"}`,children:f.replace("_"," ")})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 py-3 border-t border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-base font-bold text-gm-text-primary",children:String(i.influence_score||0)}),e.jsx("p",{className:"text-[9px] text-gm-text-tertiary uppercase tracking-wider",children:"Influence"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-base font-bold text-gm-text-primary",children:String(i.transcript_count||0)}),e.jsx("p",{className:"text-[9px] text-gm-text-tertiary uppercase tracking-wider",children:"Transcripts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-base font-bold text-gm-text-primary capitalize",children:String(i.risk_tolerance||"â€”")}),e.jsx("p",{className:"text-[9px] text-gm-text-tertiary uppercase tracking-wider",children:"Risk"})]})]}),u&&e.jsxs("div",{className:"mt-2 bg-gm-surface-secondary rounded-lg p-2.5",children:[e.jsx("p",{className:"text-[9px] text-gm-text-tertiary uppercase tracking-wider mb-0.5",children:"Communication Style"}),e.jsx("p",{className:"text-xs text-gm-text-primary line-clamp-2",children:u})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[w&&e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary",children:[w," speaking time"]}),e.jsxs("button",{onClick:R=>s(R,i),disabled:l.isPending,className:"ml-auto px-2.5 py-1 rounded-lg bg-gm-surface-secondary text-gm-text-primary text-[10px] font-medium hover:bg-gm-surface-hover flex items-center gap-1 transition-colors border border-gm-border-primary disabled:opacity-50",children:[e.jsx(Be,{className:"w-3 h-3"})," Re-analyze"]})]})]},n)})})}function Mt({data:a,isLoading:t,profiles:r,resolveName:l}){if(t)return e.jsx(me,{});const c=a;if(!c)return e.jsx(Ne,{icon:We,message:"No team dynamics data. Click 'Run Team Analysis' to generate insights."});const s=Number(c.cohesion_score??0),i=String(c.tension_level||"unknown"),n=Number(c.team_size??r.length??0),x=c.analysis_data??{},m=String(x.dominant_communication_pattern||c.summary||""),g=c.influence_map??[],v=c.alliances??[],f=c.tensions??[],u=x.power_centers??[],_=x.risk_factors??[],w=x.recommendations??[],R=x.communication_flow??{},b=c.dynamics??[],j=String(x.analysis_date||c.last_analysis_at||""),T=s>=70?"#22c55e":s>=40?"#f59e0b":"#ef4444";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-5 flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-16 h-16",children:[e.jsxs("svg",{viewBox:"0 0 36 36",className:"w-full h-full -rotate-90",children:[e.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:"var(--gm-border-primary)",strokeWidth:"3"}),e.jsx("path",{d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831",fill:"none",stroke:T,strokeWidth:"3",strokeDasharray:`${s}, 100`,strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:e.jsx("span",{className:"text-lg font-bold text-gm-text-primary",children:s})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gm-text-primary",children:"Team Cohesion"}),e.jsxs("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium capitalize ${i==="low"?"bg-gm-status-success-bg text-gm-status-success":i==="medium"?"bg-gm-status-warning-bg text-gm-status-warning":"bg-gm-status-danger-bg text-gm-status-danger"}`,children:[i," tension"]})]})]}),e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-5 flex flex-col items-center justify-center",children:[e.jsx("p",{className:"text-3xl font-bold text-gm-text-primary",children:n}),e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"Team Members"})]}),e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-5 flex items-center gap-3 justify-center",children:[e.jsx(at,{className:"w-5 h-5 text-gm-text-tertiary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"Analysis Date"}),e.jsx("p",{className:"text-sm font-semibold text-gm-text-primary",children:j?new Date(j).toLocaleDateString():"N/A"})]})]})]}),m&&e.jsxs("div",{className:"bg-blue-600/5 border border-blue-600/10 rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-semibold text-gm-interactive-primary uppercase tracking-wider mb-2",children:"Executive Summary"}),e.jsx("p",{className:"text-sm text-gm-text-primary leading-relaxed",children:se(m,l)})]}),r.length>0&&e.jsx(At,{profiles:r}),(R.bottlenecks||R.information_brokers||R.central_nodes||R.isolated_members)&&e.jsx(zt,{flow:R,resolveName:l}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[g.length>0&&e.jsx(Pt,{items:g,resolveName:l}),v.length>0&&e.jsx(Rt,{items:v,resolveName:l}),f.length>0&&e.jsx($t,{items:f,resolveName:l}),u.length>0&&e.jsx(It,{items:u,resolveName:l})]}),b.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:b.map((M,E)=>e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Me,{className:"w-4 h-4 text-gm-interactive-primary"}),e.jsx("span",{className:"text-sm font-medium text-gm-text-primary",children:String(M.aspect||M.name||`Dynamic #${E+1}`)})]}),e.jsx("p",{className:"text-xs text-gm-text-tertiary",children:se(String(M.description||M.summary||""),l)}),M.score!==void 0&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-gm-surface-secondary rounded-full",children:e.jsx("div",{className:"h-1.5 bg-gm-interactive-primary rounded-full",style:{width:`${Math.min(100,Number(M.score))}%`}})}),e.jsxs("span",{className:"text-[10px] font-mono text-gm-text-tertiary",children:[String(M.score),"%"]})]})]},E))}),_.length>0&&e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-status-danger uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"})," Risk Factors",e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-danger-bg text-gm-status-danger ml-auto",children:[_.length," identified"]})]}),e.jsx("div",{className:"space-y-2",children:_.map((M,E)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-[10px] text-gm-status-danger font-bold mt-0.5 flex-shrink-0",children:E+1}),e.jsx("p",{className:"text-xs text-gm-text-primary",children:se(M,l)})]},E))})]}),w.length>0&&e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-status-success uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4"})," Recommendations",e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-success-bg text-gm-status-success ml-auto",children:[w.length," actions"]})]}),e.jsx("div",{className:"space-y-2",children:w.map((M,E)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"text-[10px] text-gm-status-success font-bold mt-0.5 flex-shrink-0",children:["Action ",E+1]}),e.jsx("p",{className:"text-xs text-gm-text-primary",children:se(M,l)})]},E))})]})]})}function At({profiles:a}){const t=[...a].filter(c=>c.influence_score!==void 0).sort((c,s)=>(Number(s.influence_score)||0)-(Number(c.influence_score)||0));if(t.length===0)return null;const r=Math.max(...t.map(c=>Number(c.influence_score)||0),100),l=["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"];return e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-text-primary uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-gm-interactive-primary"})," Influence Scoreboard",e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-warning-bg text-gm-status-warning ml-auto",children:[t.length," ranked"]})]}),e.jsx("div",{className:"space-y-2",children:t.map((c,s)=>{const i=c.contact??{},n=String(i.name||c.person_name||"Unknown"),x=String(i.role||i.organization||""),m=K(i.avatar_url)?i.avatar_url:K(i.photo_url)?i.photo_url:null,g=Number(c.influence_score)||0,v=g/r*100,f=String(c.risk_tolerance||"medium"),_=String(c.communication_style||"").split(";")[0]?.substring(0,50)||"";return e.jsxs("div",{className:`flex items-center gap-3 py-1.5 ${s<3?"bg-[var(--gm-surface-hover)] rounded-lg px-2":""}`,children:[e.jsx("span",{className:"w-6 text-center text-sm",children:l[s]||String(s+1)}),e.jsx(de,{url:m,name:n,size:"md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gm-text-primary truncate",children:n}),x&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary truncate",children:x}),_&&e.jsx("p",{className:"text-[9px] text-gray-400 truncate italic",children:_})]}),e.jsxs("div",{className:"w-32 flex items-center gap-1.5",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-gm-surface-secondary rounded-full",children:e.jsx("div",{className:"h-1.5 bg-gm-interactive-primary rounded-full transition-all",style:{width:`${v}%`}})}),e.jsx("span",{className:"text-[10px] font-mono text-gm-text-tertiary w-6 text-right",children:g})]}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full capitalize ${f==="low"?"bg-gm-status-success-bg text-gm-status-success":f==="high"?"bg-gm-status-danger-bg text-gm-status-danger":"bg-gm-status-warning-bg text-gm-status-warning"}`,children:f})]},s)})})]})}function zt({flow:a,resolveName:t}){const r=a.bottlenecks??[],l=a.information_brokers??[],c=a.central_nodes??[],s=a.isolated_members??[];return e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsx("h3",{className:"text-xs font-semibold text-gm-text-primary uppercase tracking-wider mb-3",children:"Communication Flow"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[r.length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("span",{children:"ðŸš§"}),e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wider text-gm-status-danger",children:"Bottlenecks"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:r.map((i,n)=>e.jsx(Y,{name:i,resolve:t},n))})]}),l.length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("span",{children:"ðŸ”—"}),e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wider text-gm-interactive-primary",children:"Info Brokers"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.map((i,n)=>e.jsx(Y,{name:i,resolve:t},n))}),e.jsx("p",{className:"text-[9px] text-gm-text-tertiary mt-2",children:"Key connectors who bridge information across the team"})]}),c.length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("span",{children:"â­"}),e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wider text-gm-status-success",children:"Central Nodes"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:c.map((i,n)=>e.jsx(Y,{name:i,resolve:t},n))}),e.jsx("p",{className:"text-[9px] text-gm-text-tertiary mt-2",children:"Most connected team members"})]}),s.length>0&&e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx("span",{children:"ðŸï¸"}),e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wider text-gm-status-warning",children:"Isolated"})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.map((i,n)=>e.jsx(Y,{name:i,resolve:t},n))}),e.jsx("p",{className:"text-[9px] text-gm-text-tertiary mt-2",children:"Members with fewer connections â€” may need inclusion"})]})]})]})}function Pt({items:a,resolveName:t}){const[r,l]=N.useState(new Set),c=s=>l(i=>{const n=new Set(i);return n.has(s)?n.delete(s):n.add(s),n});return e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-text-primary uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-gm-interactive-primary"})," Influence Map",e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-surface-secondary text-gm-text-tertiary ml-auto",children:[a.length," connections"]})]}),e.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto",children:a.slice(0,10).map((s,i)=>{const n=String(s.influence_type||"direct").toLowerCase(),x=Re[n]||Re.direct,m=Math.round((Number(s.strength)||.5)*(Number(s.strength)<=1?100:1)),g=!!s.evidence&&String(s.evidence).length>10;return e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Y,{name:String(s.from_person||s.from||"?"),resolve:t}),e.jsx(Te,{className:"w-3.5 h-3.5 text-gm-text-tertiary flex-shrink-0"}),e.jsx(Y,{name:String(s.to_person||s.to||"?"),resolve:t}),e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded capitalize ml-auto",style:{background:x.bg,color:x.color},children:[x.icon," ",n]}),e.jsxs("div",{className:"flex items-center gap-1 w-20",children:[e.jsx("div",{className:"flex-1 h-1 rounded-full bg-gm-surface-secondary",children:e.jsx("div",{className:"h-1 rounded-full transition-all",style:{width:`${m}%`,background:x.color}})}),e.jsxs("span",{className:"text-[10px] font-mono text-gm-text-tertiary",children:[m,"%"]})]}),g&&e.jsx("button",{onClick:()=>c(i),className:"text-gm-text-tertiary hover:text-gm-text-primary",children:r.has(i)?e.jsx(ve,{className:"w-3.5 h-3.5"}):e.jsx(je,{className:"w-3.5 h-3.5"})})]}),r.has(i)&&g&&e.jsx("div",{className:"mt-2 pt-2 border-t border-[var(--gm-border-primary)]",children:e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[e.jsx("strong",{children:"Evidence:"})," ",se(String(s.evidence),t)]})})]},i)})})]})}function Rt({items:a,resolveName:t}){const[r,l]=N.useState(new Set),c=s=>l(i=>{const n=new Set(i);return n.has(s)?n.delete(s):n.add(s),n});return e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-text-primary uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-gm-interactive-primary"})," Alliances",e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-surface-secondary text-gm-text-tertiary ml-auto",children:[a.length," groups"]})]}),e.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto",children:a.slice(0,10).map((s,i)=>{let n=s.members;typeof n=="string"&&(n=n.split(/[\s,]+/).filter(Boolean)),Array.isArray(n)||(n=[]);const x=String(s.alliance_type||"natural").toLowerCase(),m=$e[x]||$e.natural,g=Math.round((Number(s.strength)||.5)*(Number(s.strength)<=1?100:1)),v=s.evidence&&String(s.evidence).length>10||Array.isArray(s.shared_values)&&s.shared_values.length>0;return e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"flex items-center gap-1.5 flex-wrap",children:n.map((f,u)=>e.jsxs("span",{className:"contents",children:[u>0&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary",children:"&"}),e.jsx(Y,{name:f,resolve:t})]},u))}),e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded capitalize ml-auto",style:{background:m.bg,color:m.color},children:[m.icon," ",x]}),e.jsxs("div",{className:"flex items-center gap-1 w-20",children:[e.jsx("div",{className:"flex-1 h-1 rounded-full bg-gm-surface-secondary",children:e.jsx("div",{className:"h-1 rounded-full transition-all",style:{width:`${g}%`,background:m.color}})}),e.jsxs("span",{className:"text-[10px] font-mono text-gm-text-tertiary",children:[g,"%"]})]}),v&&e.jsx("button",{onClick:()=>c(i),className:"text-gm-text-tertiary hover:text-gm-text-primary",children:r.has(i)?e.jsx(ve,{className:"w-3.5 h-3.5"}):e.jsx(je,{className:"w-3.5 h-3.5"})})]}),r.has(i)&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-[var(--gm-border-primary)] space-y-1",children:[Array.isArray(s.shared_values)&&s.shared_values.length>0&&e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[e.jsx("strong",{children:"Shared Values:"})," ",s.shared_values.join(", ")]}),s.evidence&&e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[e.jsx("strong",{children:"Evidence:"})," ",se(String(s.evidence),t)]})]})]},i)})})]})}function $t({items:a,resolveName:t}){const[r,l]=N.useState(new Set),c=s=>l(i=>{const n=new Set(i);return n.has(s)?n.delete(s):n.add(s),n});return e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-text-primary uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-gm-status-danger"})," Tensions",e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-status-danger-bg text-gm-status-danger ml-auto",children:[a.length," identified"]})]}),e.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto",children:a.slice(0,10).map((s,i)=>{let n=s.between;typeof n=="string"&&(n=n.split(/[\s,]+/).filter(Boolean)),Array.isArray(n)||(n=[]);const x=String(s.level||"low").toLowerCase(),m=String(s.tension_type||"communication").toLowerCase(),g=Ie[m]||Ie.communication,v=s.evidence&&String(s.evidence).length>10||Array.isArray(s.triggers)&&s.triggers.length>0;return e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"flex items-center gap-1.5 flex-wrap",children:n.slice(0,2).map((f,u)=>e.jsxs("span",{className:"contents",children:[u>0&&e.jsx("span",{className:"text-[10px] text-gm-text-tertiary",children:"â†”"}),e.jsx(Y,{name:f,resolve:t})]},u))}),e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded capitalize ml-auto",style:{background:g.bg,color:g.color},children:[g.icon," ",m]}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full capitalize ${x==="high"?"bg-gm-status-danger-bg text-gm-status-danger":x==="medium"?"bg-gm-status-warning-bg text-gm-status-warning":"bg-gm-status-success-bg text-gm-status-success"}`,children:x}),v&&e.jsx("button",{onClick:()=>c(i),className:"text-gm-text-tertiary hover:text-gm-text-primary",children:r.has(i)?e.jsx(ve,{className:"w-3.5 h-3.5"}):e.jsx(je,{className:"w-3.5 h-3.5"})})]}),r.has(i)&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-[var(--gm-border-primary)] space-y-1",children:[Array.isArray(s.triggers)&&s.triggers.length>0&&e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[e.jsx("strong",{children:"Triggers:"})," ",s.triggers.join(", ")]}),s.evidence&&e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[e.jsx("strong",{children:"Evidence:"})," ",se(String(s.evidence),t)]})]})]},i)})})]})}function It({items:a,resolveName:t}){const[r,l]=N.useState(new Set),c=s=>l(i=>{const n=new Set(i);return n.has(s)?n.delete(s):n.add(s),n});return e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gm-text-primary uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-gm-interactive-primary"})," Power Centers",e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-surface-secondary text-gm-text-tertiary ml-auto",children:[a.length," key players"]})]}),e.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto",children:a.slice(0,10).map((s,i)=>{const n=String(s.power_type||"informal").toLowerCase(),x=Ee[n]||Ee.informal,m=Math.round(Number(s.influence_reach??50)),g=Array.isArray(s.dependencies)&&s.dependencies.length>0;return e.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Y,{name:String(s.person||"?"),resolve:t}),e.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded capitalize ml-auto",style:{background:x.bg,color:x.color},children:[x.icon," ",n]}),e.jsxs("div",{className:"flex items-center gap-1 w-20",children:[e.jsx("div",{className:"flex-1 h-1 rounded-full bg-gm-surface-secondary",children:e.jsx("div",{className:"h-1 rounded-full transition-all",style:{width:`${m}%`,background:x.color}})}),e.jsxs("span",{className:"text-[10px] font-mono text-gm-text-tertiary",children:[m,"%"]})]}),g&&e.jsx("button",{onClick:()=>c(i),className:"text-gm-text-tertiary hover:text-gm-text-primary",children:r.has(i)?e.jsx(ve,{className:"w-3.5 h-3.5"}):e.jsx(je,{className:"w-3.5 h-3.5"})})]}),r.has(i)&&g&&e.jsx("div",{className:"mt-2 pt-2 border-t border-[var(--gm-border-primary)]",children:e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[e.jsx("strong",{children:"Power Sources:"})," ",s.dependencies.join(", ")]})})]},i)})})]})}function Et({data:a,isLoading:t,profiles:r,resolveName:l}){if(t)return e.jsx(me,{});const c=a?.relationships??[];if(c.length===0)return e.jsx(Ne,{icon:ce,message:"No relationship data. Process documents to discover team relationships."});const s={influences:"#3b82f6",aligned_with:"#22c55e",tension_with:"#ef4444",collaborates:"#8b5cf6"},i=(n,x)=>{const m=n[`${x}_contact`];if(m&&typeof m=="object"&&m.name)return String(m.name);const g=n[`${x}_person`];if(g&&typeof g=="object"&&g.name)return String(g.name);const v=n[x]||n[`${x}_person`]||n[`${x}_contact`];if(v&&typeof v=="string")return v;const f=n[`${x}_contact_id`]||n[`${x}_person_id`];if(f){const u=r.find(_=>String(_.contact_id||_.person_id)===String(f));if(u){const _=u.contact??{};return String(_.name||u.person_name||f)}}return"?"};return e.jsx("div",{className:"space-y-2",children:c.map((n,x)=>{const m=String(n.type||n.relationship_type||n.label||"related"),g=s[m]||"#6b7280",v=i(n,"from"),f=i(n,"to"),u=n.evidence,_=Number(n.evidence_count||(Array.isArray(u)?u.length:0));return e.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0 flex-wrap",children:[e.jsx(Y,{name:v,resolve:l}),e.jsx(Te,{className:"w-4 h-4 flex-shrink-0",style:{color:g}}),e.jsx(Y,{name:f,resolve:l})]}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full capitalize flex-shrink-0",style:{background:g+"15",color:g},children:m.replace(/_/g," ")}),n.strength!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 w-24",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-gm-surface-secondary rounded-full",children:e.jsx("div",{className:"h-1.5 rounded-full",style:{width:`${Math.round(Number(n.strength)*(Number(n.strength)<=1?100:1))}%`,background:g}})}),e.jsxs("span",{className:"text-[10px] font-mono text-gm-text-tertiary",children:[Math.round(Number(n.strength)*(Number(n.strength)<=1?100:1)),"%"]})]}),n.confidence&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-gm-surface-secondary text-gm-text-tertiary capitalize",children:String(n.confidence)})]}),(_>0||typeof u=="string"&&u.length>0)&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-[var(--gm-border-primary)]",children:[typeof u=="string"&&u.length>0&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:u}),Array.isArray(u)&&u.length>0&&e.jsxs("div",{className:"space-y-1",children:[u.slice(0,3).map((w,R)=>e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[w.quote&&e.jsxs("span",{className:"italic",children:['"',String(w.quote),'" ']}),w.observation&&e.jsx("span",{children:String(w.observation)}),w.timestamp&&e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",String(w.timestamp),")"]})]},R)),u.length>3&&e.jsxs("p",{className:"text-[9px] text-gray-500",children:["+",u.length-3," more evidence items"]})]}),_>0&&!u&&e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[_," evidence items"]})]})]},x)})})}const Le={influences:{color:"#3b82f6",dash:!1,label:"influences"},aligned_with:{color:"#22c55e",dash:!1,label:"allied"},tension_with:{color:"#ef4444",dash:!0,label:"tension"},defers_to:{color:"#8b5cf6",dash:!1,label:"defers to"},competes_with:{color:"#f59e0b",dash:!0,label:"competes"},mentors:{color:"#06b6d4",dash:!1,label:"mentors"},supports:{color:"#10b981",dash:!1,label:"supports"}};function De(a,t,r,l,c,s){a.beginPath(),a.moveTo(t+s,r),a.lineTo(t+l-s,r),a.quadraticCurveTo(t+l,r,t+l,r+s),a.lineTo(t+l,r+c-s),a.quadraticCurveTo(t+l,r+c,t+l-s,r+c),a.lineTo(t+s,r+c),a.quadraticCurveTo(t,r+c,t,r+c-s),a.lineTo(t,r+s),a.quadraticCurveTo(t,r,t+s,r),a.closePath()}function ie(a){const t=a.properties??{};return 22+Number(t.influenceScore??a.influence_score??a.size??50)/12}function Lt({data:a,isLoading:t,profiles:r,resolveName:l}){const c=N.useRef(null),s=N.useRef(null),[i,n]=N.useState(null),x=a,m=N.useMemo(()=>x?.nodes??[],[x]),g=N.useMemo(()=>x?.edges??[],[x]),v=N.useMemo(()=>{const y={};return r.forEach(h=>{const o=String(h.contact_id||h.person_id||"");o&&(y[o]=h)}),y},[r]),f=N.useMemo(()=>{const y={};return g.forEach(h=>{const o=String(h.from??h.source),S=String(h.to??h.target),C=String(h.type||h.label||h.relationship_type||"related"),z=Number(h.strength??h.value??.5),O=m.find(Z=>String(Z.id)===o),J=m.find(Z=>String(Z.id)===S);y[o]||(y[o]=[]),y[S]||(y[S]=[]),y[o].push({type:C,target:String(J?.label||J?.name||"?"),targetId:S,direction:"out",strength:z}),y[S].push({type:C,target:String(O?.label||O?.name||"?"),targetId:o,direction:"in",strength:z})}),y},[m,g]),u=N.useRef({pos:[],alpha:1,drag:-1,dragStartX:0,dragStartY:0,hovered:-1,w:800,h:500,frameId:0}),_=N.useRef(null);N.useEffect(()=>{_.current=i?String(i.id):null},[i]),N.useEffect(()=>{if(m.length===0)return;const y=c.current,h=s.current;if(!y||!h)return;const o=u.current;o.w=h.clientWidth||800,o.h=500;const S=m.length;o.pos=m.map((d,$)=>({x:o.w/2+Math.cos(2*Math.PI*$/S)*o.w*.2+(Math.random()-.5)*60,y:o.h/2+Math.sin(2*Math.PI*$/S)*o.h*.25+(Math.random()-.5)*60,vx:0,vy:0})),o.alpha=1;const C=new Map;m.forEach((d,$)=>C.set(String(d.id),$));let z=!0;function O(){if(o.alpha*=.992,o.alpha<.002)return;const d=new Float64Array(S),$=new Float64Array(S),X=5500;for(let p=0;p<S;p++)for(let k=p+1;k<S;k++){const A=o.pos[k].x-o.pos[p].x,L=o.pos[k].y-o.pos[p].y,B=Math.max(A*A+L*L,100),I=Math.sqrt(B),D=X/B,W=A/I*D,U=L/I*D;d[p]-=W,$[p]-=U,d[k]+=W,$[k]+=U}const re=.04,F=Math.min(200,Math.max(120,o.w/(S+1)));g.forEach(p=>{const k=C.get(String(p.from??p.source)),A=C.get(String(p.to??p.target));if(k===void 0||A===void 0)return;const L=o.pos[A].x-o.pos[k].x,B=o.pos[A].y-o.pos[k].y,I=Math.max(Math.sqrt(L*L+B*B),1),D=I-F,W=Number(p.strength??p.value??.5),U=re*D*(.5+W),q=L/I*U,H=B/I*U;d[k]+=q,$[k]+=H,d[A]-=q,$[A]-=H});const xe=.012,ge=o.w/2,P=o.h/2;for(let p=0;p<S;p++)d[p]+=(ge-o.pos[p].x)*xe,$[p]+=(P-o.pos[p].y)*xe;const G=.55;for(let p=0;p<S;p++){if(o.drag===p){o.pos[p].vx=0,o.pos[p].vy=0;continue}o.pos[p].vx=(o.pos[p].vx+d[p]*o.alpha)*G,o.pos[p].vy=(o.pos[p].vy+$[p]*o.alpha)*G,o.pos[p].x+=o.pos[p].vx,o.pos[p].y+=o.pos[p].vy;const k=ie(m[p])+12;o.pos[p].x=Math.max(k,Math.min(o.w-k,o.pos[p].x)),o.pos[p].y=Math.max(k,Math.min(o.h-k-16,o.pos[p].y))}}function J(){if(!y)return;const d=y.getContext("2d");if(!d)return;const $=window.devicePixelRatio||1,X=Math.round(o.w*$),re=Math.round(o.h*$);if((y.width!==X||y.height!==re)&&(y.width=X,y.height=re,y.style.width=`${o.w}px`,y.style.height=`${o.h}px`),d.setTransform($,0,0,$,0,0),d.clearRect(0,0,o.w,o.h),o.pos.length===0)return;const F=_.current,xe=getComputedStyle(document.documentElement).getPropertyValue("--gm-text-primary").trim()||"#e2e8f0",ge=getComputedStyle(document.documentElement).getPropertyValue("--gm-surface-primary").trim()||"#1e293b";g.forEach(P=>{const G=C.get(String(P.from??P.source)),p=C.get(String(P.to??P.target));if(G===void 0||p===void 0||!o.pos[G]||!o.pos[p])return;const k=String(P.type||P.label||P.relationship_type||""),A=Le[k]||{color:"#94a3b8",dash:!1,label:k.replace(/_/g," ")},L=F&&(String(P.from??P.source)===F||String(P.to??P.target)===F),B=F?L?"dd":"18":"70",I=o.pos[G],D=o.pos[p],W=D.x-I.x,U=D.y-I.y,q=Math.sqrt(W*W+U*U)||1,H=ie(m[G]),ae=ie(m[p]),Se=I.x+W/q*H,Ye=I.y+U/q*H,pe=D.x-W/q*ae,ue=D.y-U/q*ae,Oe=Number(P.strength??P.value??.5);if(d.save(),d.beginPath(),A.dash&&d.setLineDash([6,4]),d.moveTo(Se,Ye),d.lineTo(pe,ue),d.strokeStyle=A.color+B,d.lineWidth=Math.max(1.5,Oe*4),d.stroke(),A.dash&&d.setLineDash([]),(k==="influences"||k==="defers_to"||k==="mentors")&&q>H+ae+20){const ee=Math.atan2(U,W),te=10;d.beginPath(),d.moveTo(pe,ue),d.lineTo(pe-te*Math.cos(ee-.45),ue-te*Math.sin(ee-.45)),d.lineTo(pe-te*Math.cos(ee+.45),ue-te*Math.sin(ee+.45)),d.closePath(),d.fillStyle=A.color+B,d.fill()}if(q>90&&(L||!F)){const ee=(I.x+D.x)/2,te=(I.y+D.y)/2;d.font="9px Inter, system-ui, sans-serif",d.textAlign="center",d.textBaseline="middle";const ze=d.measureText(A.label).width+8;d.fillStyle=ge,d.globalAlpha=.85,De(d,ee-ze/2,te-7,ze,14,3),d.fill(),d.globalAlpha=1,d.fillStyle=A.color,d.fillText(A.label,ee,te)}d.restore()}),m.forEach((P,G)=>{if(!o.pos[G])return;const{x:p,y:k}=o.pos[G],A=ie(P),L=String(P.label||P.name||"?"),B=oe(L),I=F===String(P.id),D=o.hovered===G,W=!!F&&!!f[F]?.some(Se=>Se.targetId===String(P.id)),U=!!F&&!I&&!W;d.save(),U&&(d.globalAlpha=.22),I?(d.shadowColor="#f59e0b",d.shadowBlur=18):D?(d.shadowColor=B,d.shadowBlur=14):(d.shadowColor="rgba(0,0,0,0.15)",d.shadowBlur=6,d.shadowOffsetY=2);const q=d.createRadialGradient(p-A*.25,k-A*.25,0,p,k,A);q.addColorStop(0,ye(B,25)),q.addColorStop(1,ye(B,-35)),d.beginPath(),d.arc(p,k,A,0,Math.PI*2),d.fillStyle=q,d.fill(),d.shadowColor="transparent",d.shadowBlur=0,d.shadowOffsetY=0,d.strokeStyle=I?"#f59e0b":D?"#fff":"rgba(255,255,255,0.45)",d.lineWidth=I?3:D?2.5:1.5,d.stroke(),d.fillStyle="#fff",d.font=`bold ${Math.max(11,A*.52)}px Inter, system-ui, sans-serif`,d.textAlign="center",d.textBaseline="middle",d.fillText(be(L),p,k);const H=k+A+14;d.font="600 11px Inter, system-ui, sans-serif";const ae=d.measureText(L).width+10;d.fillStyle=ge,d.globalAlpha=U?.15:.75,De(d,p-ae/2,H-7,ae,14,3),d.fill(),d.globalAlpha=U?.22:1,d.fillStyle=xe,d.fillText(L,p,H),d.restore()})}function Z(){z&&(O(),J(),o.frameId=requestAnimationFrame(Z))}o.frameId=requestAnimationFrame(Z);let we;const Ae=new ResizeObserver(d=>{clearTimeout(we),we=setTimeout(()=>{for(const $ of d){const X=$.contentRect.width;if(X>0&&Math.abs(X-o.w)>5){const re=X/o.w;o.w=X,o.pos.forEach(F=>{F.x*=re}),o.alpha=Math.max(o.alpha,.3)}}},100)});return Ae.observe(h),()=>{z=!1,cancelAnimationFrame(o.frameId),Ae.disconnect(),clearTimeout(we)}},[m,g,f]);const w=N.useCallback((y,h)=>{const o=u.current;for(let S=m.length-1;S>=0;S--){if(!o.pos[S])continue;const C=ie(m[S])+3,z=y-o.pos[S].x,O=h-o.pos[S].y;if(z*z+O*O<=C*C)return S}return-1},[m]),R=N.useCallback(y=>{if(!c.current)return;const h=c.current.getBoundingClientRect(),o=y.clientX-h.left,S=y.clientY-h.top,C=w(o,S);if(C>=0){const z=u.current;z.drag=C,z.dragStartX=o,z.dragStartY=S,z.alpha=Math.max(z.alpha,.08),c.current.style.cursor="grabbing"}},[w]),b=N.useCallback(y=>{if(!c.current)return;const h=c.current.getBoundingClientRect(),o=y.clientX-h.left,S=y.clientY-h.top,C=u.current;if(C.drag>=0&&C.pos[C.drag]){C.pos[C.drag].x=o,C.pos[C.drag].y=S;return}const z=w(o,S);z!==C.hovered&&(C.hovered=z,c.current.style.cursor=z>=0?"grab":"default")},[w]),j=N.useCallback(y=>{if(!c.current)return;const h=u.current,o=h.drag>=0,S=h.drag;h.drag=-1,c.current.style.cursor="default";const C=c.current.getBoundingClientRect(),z=y.clientX-C.left,O=y.clientY-C.top;if(o){Math.sqrt((z-h.dragStartX)**2+(O-h.dragStartY)**2)<6&&n(m[S]||null);return}const J=w(z,O);n(J>=0?m[J]:null)},[w,m]),T=N.useCallback(()=>{u.current.drag=-1,u.current.hovered=-1},[]);if(t)return e.jsx(me,{});if(m.length===0)return e.jsx(Ne,{icon:ce,message:"No network data. Analyze profiles and sync graph to build the network."});const M=i?v[String(i.id)]:null,E=i?f[String(i.id)]??[]:[];return e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("h3",{className:"text-xs font-semibold text-gm-text-primary uppercase tracking-wider flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gm-interactive-primary"})," Team Network",e.jsxs("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-gm-surface-secondary text-gm-text-tertiary",children:[m.length," nodes, ",g.length," edges"]})]})}),e.jsx("div",{className:"flex flex-wrap gap-3 mb-3",children:Object.entries(Le).filter(([y])=>g.some(h=>String(h.type||h.label||h.relationship_type||"")===y)).map(([y,h])=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`w-5 h-0.5 rounded ${h.dash?"border-t-2 border-dashed":""}`,style:h.dash?{borderColor:h.color}:{background:h.color}}),e.jsx("span",{className:"text-[10px] text-gm-text-tertiary capitalize",children:h.label})]},y))}),e.jsx("div",{ref:s,className:"bg-[var(--gm-surface-hover)] rounded-lg overflow-hidden",children:e.jsx("canvas",{ref:c,style:{height:500,width:"100%",display:"block"},onMouseDown:R,onMouseMove:b,onMouseUp:j,onMouseLeave:T})}),e.jsx("p",{className:"text-[9px] text-gm-text-tertiary mt-1.5 text-center",children:"Drag nodes to rearrange Â· Click a node for details"})]}),e.jsx("div",{className:"w-72 bg-gm-surface-primary border border-gm-border-primary rounded-xl p-4 flex-shrink-0",children:i?e.jsx(Dt,{node:i,profile:M,resolveName:l,connections:E}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gm-text-tertiary",children:[e.jsx(ce,{className:"w-10 h-10 mb-3 opacity-40"}),e.jsx("p",{className:"text-xs text-center font-medium mb-1",children:"Select a Team Member"}),e.jsx("p",{className:"text-[10px] text-center text-gray-500",children:"Click on a node to view their profile and connections."})]})})]})}function Dt({node:a,profile:t,resolveName:r,connections:l}){const c=a.properties??{},s=String(a.label||a.name||"Unknown"),i=t?t.contact??{}:{},n=String(i.role||i.organization||c.role||""),x=String(i.organization||c.organization||""),m=Number(t?.influence_score??c.influenceScore??a.influence_score??0),g=String(t?.communication_style||c.communicationStyle||""),v=String(t?.dominant_motivation||c.dominantMotivation||""),f=String(t?.risk_tolerance||c.riskTolerance||""),u=K(i.avatar_url)?String(i.avatar_url):K(i.photo_url)?String(i.photo_url):null,_={influences:"#3b82f6",aligned_with:"#22c55e",tension_with:"#ef4444",defers_to:"#8b5cf6",competes_with:"#f59e0b",mentors:"#06b6d4",supports:"#10b981"};return e.jsxs("div",{className:"space-y-3 overflow-y-auto max-h-[500px]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{url:u,name:s,size:"lg"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-gm-text-primary truncate",children:s}),n&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:n}),x&&x!==n&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:x})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider mb-1",children:"Influence"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-gm-surface-secondary rounded-full",children:e.jsx("div",{className:"h-2 bg-gm-interactive-primary rounded-full transition-all",style:{width:`${Math.min(100,m)}%`}})}),e.jsx("span",{className:"text-xs font-bold text-gm-text-primary",children:m})]})]}),f&&f!=="undefined"&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider",children:"Risk Tolerance"}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full capitalize ${f==="low"?"bg-gm-status-success-bg text-gm-status-success":f==="high"?"bg-gm-status-danger-bg text-gm-status-danger":"bg-gm-status-warning-bg text-gm-status-warning"}`,children:f})]}),g&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider mb-0.5",children:"Communication"}),e.jsxs("p",{className:"text-xs text-gm-text-primary leading-relaxed",children:[g.substring(0,120),g.length>120?"...":""]})]}),v&&e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider mb-0.5",children:"Motivation"}),e.jsx("p",{className:"text-xs text-gm-text-primary",children:v})]}),l.length>0&&e.jsxs("div",{className:"pt-2 border-t border-gm-border-primary",children:[e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider mb-2",children:["Connections ",e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded-full bg-gm-surface-secondary ml-1",children:l.length})]}),e.jsx("div",{className:"space-y-1",children:l.map((w,R)=>{const b=_[w.type]||"#6b7280";return e.jsxs("div",{className:"flex items-center gap-1.5 py-1 px-2 rounded-md bg-[var(--gm-surface-hover)]",children:[e.jsx("span",{className:"text-[10px]",style:{color:b},children:w.direction==="out"?"â†’":"â†"}),e.jsx("span",{className:"text-[10px] text-gm-text-primary flex-1 truncate",children:w.target}),e.jsx("span",{className:"text-[9px] px-1 py-0.5 rounded capitalize",style:{background:b+"15",color:b},children:w.type.replace(/_/g," ")})]},R)})})]})]})}function Ut({open:a,onClose:t,existingProfileIds:r}){const[l,c]=N.useState(""),[s,i]=N.useState(new Set),n=nt(),x=ke(),[m,g]=N.useState(!1),[v,f]=N.useState({done:0,total:0,current:""}),u=N.useMemo(()=>{const j=[...n.data?.contacts??[]].sort((T,M)=>{const E=r.has(String(T.id)),y=r.has(String(M.id));return E!==y?E?1:-1:String(T.name||"").localeCompare(String(M.name||""))});return l?j.filter(T=>JSON.stringify(T).toLowerCase().includes(l.toLowerCase())):j},[n.data,l,r]),_=b=>i(j=>{const T=new Set(j);return T.has(b)?T.delete(b):T.add(b),T}),w=()=>{const b=u.filter(j=>!r.has(String(j.id))).map(j=>String(j.id));i(new Set(b))},R=async()=>{if(s.size===0)return;g(!0);const b=Array.from(s);f({done:0,total:b.length,current:""});let j=0,T=0;for(const M of b){const E=u.find(h=>String(h.id)===M),y=String(E?.name||"Contact");f(h=>({...h,current:y}));try{await x.mutateAsync({personId:M,forceReanalysis:!0}),j++}catch{T++}f(h=>({...h,done:h.done+1}))}g(!1),j>0&&V.success(`Analyzed ${j} member${j>1?"s":""}`),T>0&&V.error(`Failed for ${T} member${T>1?"s":""}`),i(new Set),t()};return e.jsx(it,{open:a,onOpenChange:b=>!b&&!m&&t(),children:e.jsxs(ct,{className:"max-w-lg p-0 overflow-hidden",children:[e.jsx(lt,{className:"sr-only",children:"Analyze Team Members"}),e.jsxs("div",{className:"px-5 pt-5 pb-3",children:[e.jsx("h2",{className:"text-base font-bold text-gm-text-primary",children:"Analyze Team Members"}),e.jsx("p",{className:"text-xs text-gm-text-tertiary mt-1",children:"Select members to analyze with AI behavioral profiling."}),e.jsxs("p",{className:"text-[10px] text-gm-text-tertiary mt-0.5",children:[u.length," contacts Â· ",r.size," analyzed"]})]}),e.jsxs("div",{className:"px-5 pb-3 flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ot,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gm-text-tertiary"}),e.jsx("input",{value:l,onChange:b=>c(b.target.value),placeholder:"Search contacts...",className:"w-full pl-9 pr-3 py-1.5 bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),e.jsx("button",{onClick:w,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary text-gm-text-primary text-xs hover:bg-gm-surface-hover transition-colors border border-gm-border-primary whitespace-nowrap",children:"Select Unanalyzed"})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto px-5 space-y-1",children:[n.isLoading&&e.jsx(me,{}),u.map(b=>{const j=String(b.id),T=String(b.name||"Unknown"),M=String(b.role||b.organization||""),E=K(b.avatar_url)?String(b.avatar_url):K(b.photo_url)?String(b.photo_url):null,y=r.has(j),h=s.has(j);return e.jsxs("label",{className:`flex items-center gap-3 p-2.5 rounded-lg cursor-pointer transition-colors ${h?"bg-blue-600/5 border border-blue-600/20":"hover:bg-gm-surface-hover border border-transparent"}`,children:[e.jsx("input",{type:"checkbox",checked:h,onChange:()=>_(j),className:"w-3.5 h-3.5 rounded accent-gm-interactive-primary"}),e.jsx(de,{url:E,name:T,size:"md"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gm-text-primary truncate",children:T}),M&&e.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:M})]}),e.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-medium ${y?"bg-gm-status-success-bg text-gm-status-success":"bg-gm-surface-secondary text-gm-text-tertiary"}`,children:y?"Analyzed":"Not analyzed"})]},j)}),!n.isLoading&&u.length===0&&e.jsx("p",{className:"text-xs text-gm-text-tertiary text-center py-4",children:"No contacts found."})]}),m&&e.jsxs("div",{className:"px-5 py-3 border-t border-gm-border-primary",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-xs text-gm-text-primary",children:[v.current,"..."]}),e.jsxs("span",{className:"text-[10px] text-gm-text-tertiary",children:[v.done,"/",v.total]})]}),e.jsx("div",{className:"w-full bg-gm-surface-secondary rounded-full h-1.5",children:e.jsx("div",{className:"bg-gm-interactive-primary h-1.5 rounded-full transition-all",style:{width:`${v.done/v.total*100}%`}})})]}),e.jsxs("div",{className:"px-5 py-3 border-t border-gm-border-primary flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gm-text-tertiary",children:[s.size," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:t,disabled:m,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary text-gm-text-primary text-xs hover:bg-gm-surface-hover transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:R,disabled:s.size===0||m,className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[m?e.jsx(le,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(qe,{className:"w-3.5 h-3.5"}),m?`Analyzing ${v.done}/${v.total}...`:`Analyze Selected (${s.size})`]})]})]})]})})}function me(){return e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(le,{className:"h-8 w-8 animate-spin text-gm-interactive-primary"})})}function Ne({icon:a,message:t}){return e.jsxs("div",{className:"rounded-xl border border-gm-border-primary bg-gm-surface-primary p-8 text-center text-gm-text-tertiary",children:[e.jsx(a,{className:"h-12 w-12 mx-auto mb-4 text-gray-500"}),t]})}export{cs as default};
//# sourceMappingURL=TeamAnalysisPage-D9dUJsBR.js.map
