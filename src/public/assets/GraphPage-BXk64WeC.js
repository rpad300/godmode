import{r as B,j as c,g as st}from"./vendor-react-CZ-WyKWZ.js";import{u as at,k as Mi,b as qn,a as Rt}from"./vendor-query-DSf7I7Ei.js";import{ce as Ct,aV as Ke,cf as ot,cg as Wi,c as ce,ch as ft,B as gt,X as it,bC as _t,ci as Hi,cj as qi,G as Pr,H as Fr,L as fe,C as Vn,ck as Vi,cl as $i,cm as Yi,cn as Zi,U as _r,J as Xi,co as Ki,O as Qi,cp as Ji,cq as es,cr as ts,cs as rs,ct as ns,cu as is,cv as ss,cw as as,cx as os,cy as ls,cz as cs,cA as us,cB as hs,cC as ds,cD as $n,Z as fs,R as vr,a6 as gs,T as yr,a8 as St,bn as ms,S as ps,P as vs,aX as ys,x as bs}from"./main-B3DZn5B_.js";import{t as Yn,T as xs,e as ws,r as je,a as lt,G as Es,N as Be,b as Zn,c as At,d as Xn,f as Cs,g as Ss,P as Ts}from"./GraphOntology-DgitACNp.js";import{t as ge,j as Kn,k as Rs,l as _s,n as Qn,o as ks,p as Jn}from"./vendor-ui-BS9QKitv.js";import{c as we}from"./vendor-markdown-Cu8AM8lU.js";import{E as Ns}from"./external-link-XVR2-B8g.js";import{S as Lt}from"./sparkles-D3iJUPqd.js";import{P as ei}from"./play-BMZi0w5i.js";import{C as ti}from"./copy-DJTzHNZE.js";import{C as ri}from"./cpu-DUHk4ipN.js";import{L as ni}from"./link-2-CvGSt01y.js";import{C as ii}from"./chart-column-BRODuIXF.js";import{T as si}from"./trending-up-CGQOSwHs.js";import{L as kr}from"./layers-Bgf9ppPM.js";import{S as js}from"./send-CaMoZtNQ.js";import{D as mt}from"./database-DDPnWHnY.js";import{T as As}from"./test-tube-C-LuB11X.js";import{C as Ls}from"./circle-check-big-Do7NRW-9.js";import{C as Ds}from"./circle-6fOsuLxM.js";import{F as Is}from"./funnel-4Z5n8uFe.js";import{S as Ps}from"./save-Dic_e7Eu.js";import{M as zr,a as Fs}from"./minimize-2-DwBVqABo.js";import"./vendor-supabase-Bpw_79gH.js";import"./vendor-router-D_XeKoA_.js";import"./brain-BD_Z4K1O.js";import"./history-CfQJo6RW.js";import"./eye-RsgK9PvA.js";import"./wand-sparkles-GsBQJb1C.js";import"./circle-x-qKfRTqT4.js";import"./merge-13AMIUb7.js";const zs=[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]],Os=we("bookmark",zs);const Gs=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],kt=we("code",Gs);const Us=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],Bs=we("focus",Us);const Ms=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}],["path",{d:"M2 10h20",key:"1ir3d8"}]],Ws=we("folder-closed",Ms);const Hs=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],qs=we("link",Hs);const Vs=[["path",{d:"M20.341 6.484A10 10 0 0 1 10.266 21.85",key:"1enhxb"}],["path",{d:"M3.659 17.516A10 10 0 0 1 13.74 2.152",key:"1crzgf"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["circle",{cx:"19",cy:"5",r:"2",key:"mhkx31"}],["circle",{cx:"5",cy:"19",r:"2",key:"v8kfzx"}]],$s=we("orbit",Vs);const Ys=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],Zs=we("pin",Ys);const Xs=[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M17 8a1 1 0 0 1 1 1v4a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1z",key:"1xoxul"}],["path",{d:"M9 8V2",key:"14iosj"}]],Or=we("plug",Xs);const Ks=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],Qs=we("route",Ks);const Js=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],Ft=we("server",Js);const ea=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],ta=we("table",ea);const ra=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],na=we("zoom-in",ra);const ia=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],sa=we("zoom-out",ia),aa={toggles:{Project:!0,Company:!0,Person:!0,Team:!0,Sprint:!0,Risk:!0,Document:!0,Action:!0,Fact:!0,Decision:!0,Question:!0,UserStory:!0,Task:!0,CalendarEvent:!0,Email:!1,Contact:!0},searchQuery:"",minTier:2,showSemantic:!1,layout:"force",collapsedTypes:new Set,timeRange:null},ai=B.createContext(void 0);function oa({children:n}){const[i,r]=B.useState(aa),[e,t]=B.useState(null),[s,o]=B.useState(null),[a,l]=B.useState(new Set),[u,d]=B.useState(null),[h,f]=B.useState(null),[b,C]=B.useState([]),[m,w]=B.useState(!1),[p,v]=B.useState(!1),g=B.useCallback(T=>{r(j=>({...j,toggles:{...j.toggles,[T]:!j.toggles[T]}}))},[]),y=B.useCallback(T=>{l(j=>{const N=new Set(j);return N.has(T)?N.delete(T):N.add(T),N})},[]),_=B.useCallback(()=>{l(new Set)},[]),k=B.useCallback(T=>{r(j=>{const N=new Set(j.collapsedTypes);return N.has(T)?N.delete(T):N.add(T),{...j,collapsedTypes:N}})},[]);return c.jsx(ai.Provider,{value:{filters:i,setFilters:r,selectedNodeId:e,setSelectedNodeId:t,hoveredNodeId:s,setHoveredNodeId:o,toggleType:g,selectedNodeIds:a,toggleNodeInSelection:y,clearSelection:_,pathStartId:u,setPathStartId:d,pathEndId:h,setPathEndId:f,pathNodeIds:b,setPathNodeIds:C,communityMode:m,setCommunityMode:w,importanceMode:p,setImportanceMode:v,toggleCollapsedType:k},children:n})}function ct(){const n=B.useContext(ai);if(n===void 0)throw new Error("useGraphState must be used within a GraphProvider");return n}const qe={getSyncStatus:async n=>{const i=await Ke.get("/api/graphrag/sync-status",{params:{project_id:n}});return i.status||i},triggerSync:async n=>Ke.post("/api/graphrag/sync",{project_id:n}),triggerResync:async n=>Ke.post("/api/graphrag/resync",{project_id:n}),getNodes:async(n,i)=>((await Ke.get("/api/graphrag/nodes",{params:{project_id:n}})).nodes||[]).map(t=>({id:t.id,label:t.label,data:{...t.properties,label:t.properties?.name||t.properties?.title||t.label,type:t.label,project_id:t.project_id},position:{x:0,y:0}})),getEdges:async n=>((await Ke.get("/api/graphrag/edges",{params:{project_id:n}})).edges||[]).map(e=>({id:e.id,source:e.from_id,target:e.to_id,label:e.type,data:e.properties})),getSemanticNeighbors:async(n,i,r=.78,e=10)=>{const{data:t,error:s}=await Ct.rpc("find_semantic_neighbors",{p_entity_id:n,p_project_id:i,p_threshold:r,p_limit:e});if(s)throw s;return t||[]}};function Nr(n){const{currentProjectId:i}=ot();return at({queryKey:["graph","nodes",i],queryFn:async()=>i?await qe.getNodes(i):[],enabled:!!i,staleTime:300*1e3,placeholderData:Mi})}function la(){const{currentProjectId:n}=ot();return at({queryKey:["graph","edges",n],queryFn:async()=>n?await qe.getEdges(n):[],enabled:!!n,staleTime:300*1e3})}function oi(){const{filters:n}=ct(),{data:i,isLoading:r,error:e}=Nr(),{data:t,isLoading:s,error:o}=la(),{nodes:a,edges:l}=B.useMemo(()=>{if(!i||!t)return{nodes:[],edges:[]};const{nodes:u,edges:d}=Yn(i,t),h=u.map((y,_)=>y.label==="Project"?_:-1).filter(y=>y!==-1);let f=u;if(h.length>1){const y=new Set(h.slice(1));f=u.filter((_,k)=>!y.has(k))}const b=f.filter(y=>{if(n.toggles[y.label||""]===!1||(y.data.tier??2)>n.minTier)return!1;if(n.searchQuery){const _=n.searchQuery.toLowerCase(),k=y.data.label?.toLowerCase()||"",T=(y.label||"").toLowerCase();if(!k.includes(_)&&!T.includes(_))return!1}if(n.timeRange){const[_,k]=n.timeRange,T=y.data.created_at||y.data.updated_at||y.data.date;if(T){const j=new Date(T).getTime();if(!isNaN(j)&&(j<_||j>k))return!1}}return!0}),C=n.collapsedTypes;let m=b,w=d;const p=new Map;if(C.size>0){const y=[],_=[],k=new Map;for(const I of b){const U=I.label||"";C.has(U)?(k.set(U,(k.get(U)||0)+1),p.set(I.id,`__group_${U}`)):_.push(I)}for(const[I,U]of k){const D=`__group_${I}`;y.push({id:D,label:I,data:{label:`${I} (${U})`,type:I,tier:xs[I]??2,_isGroup:!0,_groupCount:U,_display:{width:200,height:80,colorToken:I.toLowerCase()}}})}m=[..._,...y];const T=new Set(m.map(I=>I.id)),j=new Set,N=[];for(const I of d){let U=p.get(I.source)||I.source,D=p.get(I.target)||I.target;if(U===D||!T.has(U)||!T.has(D))continue;const R=`${U}__${D}__${I.data?.originalLabel||""}`;j.has(R)||(j.add(R),N.push({...I,id:R,source:U,target:D}))}w=N}const v=new Set(m.map(y=>y.id)),g=w.filter(y=>!(!v.has(y.source)||!v.has(y.target)||!n.showSemantic&&(y.data?.originalLabel==="SIMILAR_TO"||y.label==="SIMILAR_TO")));return{nodes:m,edges:g}},[i,t,n]);return{nodes:a,edges:l,isLoading:r||s,error:e||o}}function ca(n,i){if(typeof n!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var e=r.call(n,i);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}function nt(n){var i=ca(n,"string");return typeof i=="symbol"?i:i+""}function ve(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}function Gr(n,i){for(var r=0;r<i.length;r++){var e=i[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,nt(e.key),e)}}function ye(n,i,r){return i&&Gr(n.prototype,i),r&&Gr(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function $e(n){return $e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},$e(n)}function li(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(li=function(){return!!n})()}function ua(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ha(n,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ua(n)}function Ce(n,i,r){return i=$e(i),ha(n,li()?Reflect.construct(i,r||[],$e(n).constructor):i.apply(n,r))}function br(n,i){return br=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},br(n,i)}function Se(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),i&&br(n,i)}function da(n){if(Array.isArray(n))return n}function fa(n,i){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var e,t,s,o,a=[],l=!0,u=!1;try{if(s=(r=r.call(n)).next,i===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(e=s.call(r)).done)&&(a.push(e.value),a.length!==i);l=!0);}catch(d){u=!0,t=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw t}}return a}}function xr(n,i){(i==null||i>n.length)&&(i=n.length);for(var r=0,e=Array(i);r<i;r++)e[r]=n[r];return e}function ci(n,i){if(n){if(typeof n=="string")return xr(n,i);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xr(n,i):void 0}}function ga(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ye(n,i){return da(n)||fa(n,i)||ci(n,i)||ga()}var zt={black:"#000000",silver:"#C0C0C0",gray:"#808080",grey:"#808080",white:"#FFFFFF",maroon:"#800000",red:"#FF0000",purple:"#800080",fuchsia:"#FF00FF",green:"#008000",lime:"#00FF00",olive:"#808000",yellow:"#FFFF00",navy:"#000080",blue:"#0000FF",teal:"#008080",aqua:"#00FFFF",darkblue:"#00008B",mediumblue:"#0000CD",darkgreen:"#006400",darkcyan:"#008B8B",deepskyblue:"#00BFFF",darkturquoise:"#00CED1",mediumspringgreen:"#00FA9A",springgreen:"#00FF7F",cyan:"#00FFFF",midnightblue:"#191970",dodgerblue:"#1E90FF",lightseagreen:"#20B2AA",forestgreen:"#228B22",seagreen:"#2E8B57",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",limegreen:"#32CD32",mediumseagreen:"#3CB371",turquoise:"#40E0D0",royalblue:"#4169E1",steelblue:"#4682B4",darkslateblue:"#483D8B",mediumturquoise:"#48D1CC",indigo:"#4B0082",darkolivegreen:"#556B2F",cadetblue:"#5F9EA0",cornflowerblue:"#6495ED",rebeccapurple:"#663399",mediumaquamarine:"#66CDAA",dimgray:"#696969",dimgrey:"#696969",slateblue:"#6A5ACD",olivedrab:"#6B8E23",slategray:"#708090",slategrey:"#708090",lightslategray:"#778899",lightslategrey:"#778899",mediumslateblue:"#7B68EE",lawngreen:"#7CFC00",chartreuse:"#7FFF00",aquamarine:"#7FFFD4",skyblue:"#87CEEB",lightskyblue:"#87CEFA",blueviolet:"#8A2BE2",darkred:"#8B0000",darkmagenta:"#8B008B",saddlebrown:"#8B4513",darkseagreen:"#8FBC8F",lightgreen:"#90EE90",mediumpurple:"#9370DB",darkviolet:"#9400D3",palegreen:"#98FB98",darkorchid:"#9932CC",yellowgreen:"#9ACD32",sienna:"#A0522D",brown:"#A52A2A",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",lightblue:"#ADD8E6",greenyellow:"#ADFF2F",paleturquoise:"#AFEEEE",lightsteelblue:"#B0C4DE",powderblue:"#B0E0E6",firebrick:"#B22222",darkgoldenrod:"#B8860B",mediumorchid:"#BA55D3",rosybrown:"#BC8F8F",darkkhaki:"#BDB76B",mediumvioletred:"#C71585",indianred:"#CD5C5C",peru:"#CD853F",chocolate:"#D2691E",tan:"#D2B48C",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",thistle:"#D8BFD8",orchid:"#DA70D6",goldenrod:"#DAA520",palevioletred:"#DB7093",crimson:"#DC143C",gainsboro:"#DCDCDC",plum:"#DDA0DD",burlywood:"#DEB887",lightcyan:"#E0FFFF",lavender:"#E6E6FA",darksalmon:"#E9967A",violet:"#EE82EE",palegoldenrod:"#EEE8AA",lightcoral:"#F08080",khaki:"#F0E68C",aliceblue:"#F0F8FF",honeydew:"#F0FFF0",azure:"#F0FFFF",sandybrown:"#F4A460",wheat:"#F5DEB3",beige:"#F5F5DC",whitesmoke:"#F5F5F5",mintcream:"#F5FFFA",ghostwhite:"#F8F8FF",salmon:"#FA8072",antiquewhite:"#FAEBD7",linen:"#FAF0E6",lightgoldenrodyellow:"#FAFAD2",oldlace:"#FDF5E6",magenta:"#FF00FF",deeppink:"#FF1493",orangered:"#FF4500",tomato:"#FF6347",hotpink:"#FF69B4",coral:"#FF7F50",darkorange:"#FF8C00",lightsalmon:"#FFA07A",orange:"#FFA500",lightpink:"#FFB6C1",pink:"#FFC0CB",gold:"#FFD700",peachpuff:"#FFDAB9",navajowhite:"#FFDEAD",moccasin:"#FFE4B5",bisque:"#FFE4C4",mistyrose:"#FFE4E1",blanchedalmond:"#FFEBCD",papayawhip:"#FFEFD5",lavenderblush:"#FFF0F5",seashell:"#FFF5EE",cornsilk:"#FFF8DC",lemonchiffon:"#FFFACD",floralwhite:"#FFFAF0",snow:"#FFFAFA",lightyellow:"#FFFFE0",ivory:"#FFFFF0"},ui=new Int8Array(4),Ot=new Int32Array(ui.buffer,0,1),ma=new Float32Array(ui.buffer,0,1),pa=/^\s*rgba?\s*\(/,va=/^\s*rgba?\s*\(\s*([0-9]*)\s*,\s*([0-9]*)\s*,\s*([0-9]*)(?:\s*,\s*(.*)?)?\)\s*$/;function ya(n){var i=0,r=0,e=0,t=1;if(n[0]==="#")n.length===4?(i=parseInt(n.charAt(1)+n.charAt(1),16),r=parseInt(n.charAt(2)+n.charAt(2),16),e=parseInt(n.charAt(3)+n.charAt(3),16)):(i=parseInt(n.charAt(1)+n.charAt(2),16),r=parseInt(n.charAt(3)+n.charAt(4),16),e=parseInt(n.charAt(5)+n.charAt(6),16)),n.length===9&&(t=parseInt(n.charAt(7)+n.charAt(8),16)/255);else if(pa.test(n)){var s=n.match(va);s&&(i=+s[1],r=+s[2],e=+s[3],s[4]&&(t=+s[4]))}return{r:i,g:r,b:e,a:t}}var Ve={};for(var pt in zt)Ve[pt]=Ze(zt[pt]),Ve[zt[pt]]=Ve[pt];function hi(n,i,r,e,t){return Ot[0]=e<<24|r<<16|i<<8|n,Ot[0]=Ot[0]&4278190079,ma[0]}function Ze(n){if(n=n.toLowerCase(),typeof Ve[n]<"u")return Ve[n];var i=ya(n),r=i.r,e=i.g,t=i.b,s=i.a;s=s*255|0;var o=hi(r,e,t,s);return Ve[n]=o,o}var Gt={};function di(n){if(typeof Gt[n]<"u")return Gt[n];var i=(n&16711680)>>>16,r=(n&65280)>>>8,e=n&255,t=255,s=hi(i,r,e,t);return Gt[n]=s,s}function Ur(n,i,r,e){return r+(i<<8)+(n<<16)}function Br(n,i,r,e,t,s){var o=Math.floor(r/s*t),a=Math.floor(n.drawingBufferHeight/s-e/s*t),l=new Uint8Array(4);n.bindFramebuffer(n.FRAMEBUFFER,i),n.readPixels(o,a,1,1,n.RGBA,n.UNSIGNED_BYTE,l);var u=Ye(l,4),d=u[0],h=u[1],f=u[2],b=u[3];return[d,h,f,b]}function H(n,i,r){return(i=nt(i))in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n}function Mr(n,i){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);i&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),r.push.apply(r,e)}return r}function ee(n){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mr(Object(r),!0).forEach(function(e){H(n,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Mr(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}function ba(n,i){for(;!{}.hasOwnProperty.call(n,i)&&(n=$e(n))!==null;);return n}function wr(){return wr=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,i,r){var e=ba(n,i);if(e){var t=Object.getOwnPropertyDescriptor(e,i);return t.get?t.get.call(arguments.length<3?n:r):t.value}},wr.apply(null,arguments)}function fi(n,i,r,e){var t=wr($e(n.prototype),i,r);return typeof t=="function"?function(s){return t.apply(r,s)}:t}function xa(n){return n.normalized?1:n.size}function Ut(n){var i=0;return n.forEach(function(r){return i+=xa(r)}),i}function gi(n,i,r){var e=n==="VERTEX"?i.VERTEX_SHADER:i.FRAGMENT_SHADER,t=i.createShader(e);if(t===null)throw new Error("loadShader: error while creating the shader");i.shaderSource(t,r),i.compileShader(t);var s=i.getShaderParameter(t,i.COMPILE_STATUS);if(!s){var o=i.getShaderInfoLog(t);throw i.deleteShader(t),new Error(`loadShader: error while compiling the shader:
`.concat(o,`
`).concat(r))}return t}function wa(n,i){return gi("VERTEX",n,i)}function Ea(n,i){return gi("FRAGMENT",n,i)}function Ca(n,i){var r=n.createProgram();if(r===null)throw new Error("loadProgram: error while creating the program.");var e,t;for(e=0,t=i.length;e<t;e++)n.attachShader(r,i[e]);n.linkProgram(r);var s=n.getProgramParameter(r,n.LINK_STATUS);if(!s)throw n.deleteProgram(r),new Error("loadProgram: error while linking the program.");return r}function Wr(n){var i=n.gl,r=n.buffer,e=n.program,t=n.vertexShader,s=n.fragmentShader;i.deleteShader(t),i.deleteShader(s),i.deleteProgram(e),i.deleteBuffer(r)}var Hr=`#define PICKING_MODE
`,Sa=H(H(H(H(H(H(H(H({},WebGL2RenderingContext.BOOL,1),WebGL2RenderingContext.BYTE,1),WebGL2RenderingContext.UNSIGNED_BYTE,1),WebGL2RenderingContext.SHORT,2),WebGL2RenderingContext.UNSIGNED_SHORT,2),WebGL2RenderingContext.INT,4),WebGL2RenderingContext.UNSIGNED_INT,4),WebGL2RenderingContext.FLOAT,4),mi=(function(){function n(i,r,e){ve(this,n),H(this,"array",new Float32Array),H(this,"constantArray",new Float32Array),H(this,"capacity",0),H(this,"verticesCount",0);var t=this.getDefinition();if(this.VERTICES=t.VERTICES,this.VERTEX_SHADER_SOURCE=t.VERTEX_SHADER_SOURCE,this.FRAGMENT_SHADER_SOURCE=t.FRAGMENT_SHADER_SOURCE,this.UNIFORMS=t.UNIFORMS,this.ATTRIBUTES=t.ATTRIBUTES,this.METHOD=t.METHOD,this.CONSTANT_ATTRIBUTES="CONSTANT_ATTRIBUTES"in t?t.CONSTANT_ATTRIBUTES:[],this.CONSTANT_DATA="CONSTANT_DATA"in t?t.CONSTANT_DATA:[],this.isInstanced="CONSTANT_ATTRIBUTES"in t,this.ATTRIBUTES_ITEMS_COUNT=Ut(this.ATTRIBUTES),this.STRIDE=this.VERTICES*this.ATTRIBUTES_ITEMS_COUNT,this.renderer=e,this.normalProgram=this.getProgramInfo("normal",i,t.VERTEX_SHADER_SOURCE,t.FRAGMENT_SHADER_SOURCE,null),this.pickProgram=r?this.getProgramInfo("pick",i,Hr+t.VERTEX_SHADER_SOURCE,Hr+t.FRAGMENT_SHADER_SOURCE,r):null,this.isInstanced){var s=Ut(this.CONSTANT_ATTRIBUTES);if(this.CONSTANT_DATA.length!==this.VERTICES)throw new Error("Program: error while getting constant data (expected ".concat(this.VERTICES," items, received ").concat(this.CONSTANT_DATA.length," instead)"));this.constantArray=new Float32Array(this.CONSTANT_DATA.length*s);for(var o=0;o<this.CONSTANT_DATA.length;o++){var a=this.CONSTANT_DATA[o];if(a.length!==s)throw new Error("Program: error while getting constant data (one vector has ".concat(a.length," items instead of ").concat(s,")"));for(var l=0;l<a.length;l++)this.constantArray[o*s+l]=a[l]}this.STRIDE=this.ATTRIBUTES_ITEMS_COUNT}}return ye(n,[{key:"kill",value:function(){Wr(this.normalProgram),this.pickProgram&&(Wr(this.pickProgram),this.pickProgram=null)}},{key:"getProgramInfo",value:function(r,e,t,s,o){var a=this.getDefinition(),l=e.createBuffer();if(l===null)throw new Error("Program: error while creating the WebGL buffer.");var u=wa(e,t),d=Ea(e,s),h=Ca(e,[u,d]),f={};a.UNIFORMS.forEach(function(m){var w=e.getUniformLocation(h,m);w&&(f[m]=w)});var b={};a.ATTRIBUTES.forEach(function(m){b[m.name]=e.getAttribLocation(h,m.name)});var C;if("CONSTANT_ATTRIBUTES"in a&&(a.CONSTANT_ATTRIBUTES.forEach(function(m){b[m.name]=e.getAttribLocation(h,m.name)}),C=e.createBuffer(),C===null))throw new Error("Program: error while creating the WebGL constant buffer.");return{name:r,program:h,gl:e,frameBuffer:o,buffer:l,constantBuffer:C||{},uniformLocations:f,attributeLocations:b,isPicking:r==="pick",vertexShader:u,fragmentShader:d}}},{key:"bindProgram",value:function(r){var e=this,t=0,s=r.gl,o=r.buffer;this.isInstanced?(s.bindBuffer(s.ARRAY_BUFFER,r.constantBuffer),t=0,this.CONSTANT_ATTRIBUTES.forEach(function(a){return t+=e.bindAttribute(a,r,t,!1)}),s.bufferData(s.ARRAY_BUFFER,this.constantArray,s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,r.buffer),t=0,this.ATTRIBUTES.forEach(function(a){return t+=e.bindAttribute(a,r,t,!0)}),s.bufferData(s.ARRAY_BUFFER,this.array,s.DYNAMIC_DRAW)):(s.bindBuffer(s.ARRAY_BUFFER,o),t=0,this.ATTRIBUTES.forEach(function(a){return t+=e.bindAttribute(a,r,t)}),s.bufferData(s.ARRAY_BUFFER,this.array,s.DYNAMIC_DRAW)),s.bindBuffer(s.ARRAY_BUFFER,null)}},{key:"unbindProgram",value:function(r){var e=this;this.isInstanced?(this.CONSTANT_ATTRIBUTES.forEach(function(t){return e.unbindAttribute(t,r,!1)}),this.ATTRIBUTES.forEach(function(t){return e.unbindAttribute(t,r,!0)})):this.ATTRIBUTES.forEach(function(t){return e.unbindAttribute(t,r)})}},{key:"bindAttribute",value:function(r,e,t,s){var o=Sa[r.type];if(typeof o!="number")throw new Error('Program.bind: yet unsupported attribute type "'.concat(r.type,'"'));var a=e.attributeLocations[r.name],l=e.gl;if(a!==-1){l.enableVertexAttribArray(a);var u=this.isInstanced?(s?this.ATTRIBUTES_ITEMS_COUNT:Ut(this.CONSTANT_ATTRIBUTES))*Float32Array.BYTES_PER_ELEMENT:this.ATTRIBUTES_ITEMS_COUNT*Float32Array.BYTES_PER_ELEMENT;if(l.vertexAttribPointer(a,r.size,r.type,r.normalized||!1,u,t),this.isInstanced&&s)if(l instanceof WebGL2RenderingContext)l.vertexAttribDivisor(a,1);else{var d=l.getExtension("ANGLE_instanced_arrays");d&&d.vertexAttribDivisorANGLE(a,1)}}return r.size*o}},{key:"unbindAttribute",value:function(r,e,t){var s=e.attributeLocations[r.name],o=e.gl;if(s!==-1&&(o.disableVertexAttribArray(s),this.isInstanced&&t))if(o instanceof WebGL2RenderingContext)o.vertexAttribDivisor(s,0);else{var a=o.getExtension("ANGLE_instanced_arrays");a&&a.vertexAttribDivisorANGLE(s,0)}}},{key:"reallocate",value:function(r){r!==this.capacity&&(this.capacity=r,this.verticesCount=this.VERTICES*r,this.array=new Float32Array(this.isInstanced?this.capacity*this.ATTRIBUTES_ITEMS_COUNT:this.verticesCount*this.ATTRIBUTES_ITEMS_COUNT))}},{key:"hasNothingToRender",value:function(){return this.verticesCount===0}},{key:"renderProgram",value:function(r,e){var t=e.gl,s=e.program;t.enable(t.BLEND),t.useProgram(s),this.setUniforms(r,e),this.drawWebGL(this.METHOD,e)}},{key:"render",value:function(r){this.hasNothingToRender()||(this.pickProgram&&(this.pickProgram.gl.viewport(0,0,r.width*r.pixelRatio/r.downSizingRatio,r.height*r.pixelRatio/r.downSizingRatio),this.bindProgram(this.pickProgram),this.renderProgram(ee(ee({},r),{},{pixelRatio:r.pixelRatio/r.downSizingRatio}),this.pickProgram),this.unbindProgram(this.pickProgram)),this.normalProgram.gl.viewport(0,0,r.width*r.pixelRatio,r.height*r.pixelRatio),this.bindProgram(this.normalProgram),this.renderProgram(r,this.normalProgram),this.unbindProgram(this.normalProgram))}},{key:"drawWebGL",value:function(r,e){var t=e.gl,s=e.frameBuffer;if(t.bindFramebuffer(t.FRAMEBUFFER,s),!this.isInstanced)t.drawArrays(r,0,this.verticesCount);else if(t instanceof WebGL2RenderingContext)t.drawArraysInstanced(r,0,this.VERTICES,this.capacity);else{var o=t.getExtension("ANGLE_instanced_arrays");o&&o.drawArraysInstancedANGLE(r,0,this.VERTICES,this.capacity)}}}])})(),Ta=(function(n){function i(){return ve(this,i),Ce(this,i,arguments)}return Se(i,n),ye(i,[{key:"kill",value:function(){fi(i,"kill",this)([])}},{key:"process",value:function(e,t,s){var o=t*this.STRIDE;if(s.hidden){for(var a=o+this.STRIDE;o<a;o++)this.array[o]=0;return}return this.processVisibleItem(di(e),o,s)}}])})(mi),Dt=(function(n){function i(){var r;ve(this,i);for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return r=Ce(this,i,[].concat(t)),H(r,"drawLabel",void 0),r}return Se(i,n),ye(i,[{key:"kill",value:function(){fi(i,"kill",this)([])}},{key:"process",value:function(e,t,s,o,a){var l=t*this.STRIDE;if(a.hidden||s.hidden||o.hidden){for(var u=l+this.STRIDE;l<u;l++)this.array[l]=0;return}return this.processVisibleItem(di(e),l,s,o,a)}}])})(mi);function Ra(n,i){return(function(){function r(e,t,s){ve(this,r),H(this,"drawLabel",i),this.programs=n.map(function(o){return new o(e,t,s)})}return ye(r,[{key:"reallocate",value:function(t){this.programs.forEach(function(s){return s.reallocate(t)})}},{key:"process",value:function(t,s,o,a,l){this.programs.forEach(function(u){return u.process(t,s,o,a,l)})}},{key:"render",value:function(t){this.programs.forEach(function(s){return s.render(t)})}},{key:"kill",value:function(){this.programs.forEach(function(t){return t.kill()})}}])})()}function _a(n,i,r,e,t){var s=t.edgeLabelSize,o=t.edgeLabelFont,a=t.edgeLabelWeight,l=t.edgeLabelColor.attribute?i[t.edgeLabelColor.attribute]||t.edgeLabelColor.color||"#000":t.edgeLabelColor.color,u=i.label;if(u){n.fillStyle=l,n.font="".concat(a," ").concat(s,"px ").concat(o);var d=r.size,h=e.size,f=r.x,b=r.y,C=e.x,m=e.y,w=(f+C)/2,p=(b+m)/2,v=C-f,g=m-b,y=Math.sqrt(v*v+g*g);if(!(y<d+h)){f+=v*d/y,b+=g*d/y,C-=v*h/y,m-=g*h/y,w=(f+C)/2,p=(b+m)/2,v=C-f,g=m-b,y=Math.sqrt(v*v+g*g);var _=n.measureText(u).width;if(_>y){var k="â€¦";for(u=u+k,_=n.measureText(u).width;_>y&&u.length>1;)u=u.slice(0,-2)+k,_=n.measureText(u).width;if(u.length<4)return}var T;v>0?g>0?T=Math.acos(v/y):T=Math.asin(g/y):g>0?T=Math.acos(v/y)+Math.PI:T=Math.asin(v/y)+Math.PI/2,n.save(),n.translate(w,p),n.rotate(T),n.fillText(u,-_/2,i.size/2+s),n.restore()}}}function pi(n,i,r){if(i.label){var e=r.labelSize,t=r.labelFont,s=r.labelWeight,o=r.labelColor.attribute?i[r.labelColor.attribute]||r.labelColor.color||"#000":r.labelColor.color;n.fillStyle=o,n.font="".concat(s," ").concat(e,"px ").concat(t),n.fillText(i.label,i.x+i.size+3,i.y+e/3)}}function ka(n,i,r){var e=r.labelSize,t=r.labelFont,s=r.labelWeight;n.font="".concat(s," ").concat(e,"px ").concat(t),n.fillStyle="#FFF",n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=8,n.shadowColor="#000";var o=2;if(typeof i.label=="string"){var a=n.measureText(i.label).width,l=Math.round(a+5),u=Math.round(e+2*o),d=Math.max(i.size,e/2)+o,h=Math.asin(u/2/d),f=Math.sqrt(Math.abs(Math.pow(d,2)-Math.pow(u/2,2)));n.beginPath(),n.moveTo(i.x+f,i.y+u/2),n.lineTo(i.x+d+l,i.y+u/2),n.lineTo(i.x+d+l,i.y-u/2),n.lineTo(i.x+f,i.y-u/2),n.arc(i.x,i.y,d,h,-h),n.closePath(),n.fill()}else n.beginPath(),n.arc(i.x,i.y,i.size+o,0,Math.PI*2),n.closePath(),n.fill();n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,pi(n,i,r)}var Na=`
precision highp float;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;

uniform float u_correctionRatio;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float border = u_correctionRatio * 2.0;
  float dist = length(v_diffVector) - v_radius + border;

  // No antialiasing for picking mode:
  #ifdef PICKING_MODE
  if (dist > border)
    gl_FragColor = transparent;
  else
    gl_FragColor = v_color;

  #else
  float t = 0.0;
  if (dist > border)
    t = 1.0;
  else if (dist > 0.0)
    t = dist / border;

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,ja=Na,Aa=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_position;
attribute float a_size;
attribute float a_angle;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;

varying vec4 v_color;
varying vec2 v_diffVector;
varying float v_radius;
varying float v_border;

const float bias = 255.0 / 254.0;

void main() {
  float size = a_size * u_correctionRatio / u_sizeRatio * 4.0;
  vec2 diffVector = size * vec2(cos(a_angle), sin(a_angle));
  vec2 position = a_position + diffVector;
  gl_Position = vec4(
    (u_matrix * vec3(position, 1)).xy,
    0,
    1
  );

  v_diffVector = diffVector;
  v_radius = size / 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,La=Aa,vi=WebGLRenderingContext,qr=vi.UNSIGNED_BYTE,Bt=vi.FLOAT,Da=["u_sizeRatio","u_correctionRatio","u_matrix"],It=(function(n){function i(){return ve(this,i),Ce(this,i,arguments)}return Se(i,n),ye(i,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:La,FRAGMENT_SHADER_SOURCE:ja,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Da,ATTRIBUTES:[{name:"a_position",size:2,type:Bt},{name:"a_size",size:1,type:Bt},{name:"a_color",size:4,type:qr,normalized:!0},{name:"a_id",size:4,type:qr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_angle",size:1,type:Bt}],CONSTANT_DATA:[[i.ANGLE_1],[i.ANGLE_2],[i.ANGLE_3]]}}},{key:"processVisibleItem",value:function(e,t,s){var o=this.array,a=Ze(s.color);o[t++]=s.x,o[t++]=s.y,o[t++]=s.size,o[t++]=a,o[t++]=e}},{key:"setUniforms",value:function(e,t){var s=t.gl,o=t.uniformLocations,a=o.u_sizeRatio,l=o.u_correctionRatio,u=o.u_matrix;s.uniform1f(l,e.correctionRatio),s.uniform1f(a,e.sizeRatio),s.uniformMatrix3fv(u,!1,e.matrix)}}])})(Ta);H(It,"ANGLE_1",0);H(It,"ANGLE_2",2*Math.PI/3);H(It,"ANGLE_3",4*Math.PI/3);var Ia=`
precision mediump float;

varying vec4 v_color;

void main(void) {
  gl_FragColor = v_color;
}
`,Pa=Ia,Fa=`
attribute vec2 a_position;
attribute vec2 a_normal;
attribute float a_radius;
attribute vec3 a_barycentric;

#ifdef PICKING_MODE
attribute vec4 a_id;
#else
attribute vec4 a_color;
#endif

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;

varying vec4 v_color;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float normalLength = length(a_normal);
  vec2 unitNormal = a_normal / normalLength;

  // These first computations are taken from edge.vert.glsl and
  // edge.clamped.vert.glsl. Please read it to get better comments on what's
  // happening:
  float pixelsThickness = max(normalLength / u_sizeRatio, minThickness);
  float webGLThickness = pixelsThickness * u_correctionRatio;
  float webGLNodeRadius = a_radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;
  float webGLArrowHeadThickness = webGLThickness * u_widenessToThicknessRatio;

  float da = a_barycentric.x;
  float db = a_barycentric.y;
  float dc = a_barycentric.z;

  vec2 delta = vec2(
      da * (webGLNodeRadius * unitNormal.y)
    + db * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y + webGLArrowHeadThickness * unitNormal.x)
    + dc * ((webGLNodeRadius + webGLArrowHeadLength) * unitNormal.y - webGLArrowHeadThickness * unitNormal.x),

      da * (-webGLNodeRadius * unitNormal.x)
    + db * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x + webGLArrowHeadThickness * unitNormal.y)
    + dc * (-(webGLNodeRadius + webGLArrowHeadLength) * unitNormal.x - webGLArrowHeadThickness * unitNormal.y)
  );

  vec2 position = (u_matrix * vec3(a_position + delta, 1)).xy;

  gl_Position = vec4(position, 0, 1);

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,za=Fa,yi=WebGLRenderingContext,Vr=yi.UNSIGNED_BYTE,vt=yi.FLOAT,Oa=["u_matrix","u_sizeRatio","u_correctionRatio","u_minEdgeThickness","u_lengthToThicknessRatio","u_widenessToThicknessRatio"],Pt={extremity:"target",lengthToThicknessRatio:2.5,widenessToThicknessRatio:2};function bi(n){var i=ee(ee({},Pt),{});return(function(r){function e(){return ve(this,e),Ce(this,e,arguments)}return Se(e,r),ye(e,[{key:"getDefinition",value:function(){return{VERTICES:3,VERTEX_SHADER_SOURCE:za,FRAGMENT_SHADER_SOURCE:Pa,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Oa,ATTRIBUTES:[{name:"a_position",size:2,type:vt},{name:"a_normal",size:2,type:vt},{name:"a_radius",size:1,type:vt},{name:"a_color",size:4,type:Vr,normalized:!0},{name:"a_id",size:4,type:Vr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_barycentric",size:3,type:vt}],CONSTANT_DATA:[[1,0,0],[0,1,0],[0,0,1]]}}},{key:"processVisibleItem",value:function(s,o,a,l,u){if(i.extremity==="source"){var d=[l,a];a=d[0],l=d[1]}var h=u.size||1,f=l.size||1,b=a.x,C=a.y,m=l.x,w=l.y,p=Ze(u.color),v=m-b,g=w-C,y=v*v+g*g,_=0,k=0;y&&(y=1/Math.sqrt(y),_=-g*y*h,k=v*y*h);var T=this.array;T[o++]=m,T[o++]=w,T[o++]=-_,T[o++]=-k,T[o++]=f,T[o++]=p,T[o++]=s}},{key:"setUniforms",value:function(s,o){var a=o.gl,l=o.uniformLocations,u=l.u_matrix,d=l.u_sizeRatio,h=l.u_correctionRatio,f=l.u_minEdgeThickness,b=l.u_lengthToThicknessRatio,C=l.u_widenessToThicknessRatio;a.uniformMatrix3fv(u,!1,s.matrix),a.uniform1f(d,s.sizeRatio),a.uniform1f(h,s.correctionRatio),a.uniform1f(f,s.minEdgeThickness),a.uniform1f(b,i.lengthToThicknessRatio),a.uniform1f(C,i.widenessToThicknessRatio)}}])})(Dt)}bi();var Ga=`
precision mediump float;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  // We only handle antialiasing for normal mode:
  #ifdef PICKING_MODE
  gl_FragColor = v_color;
  #else
  float dist = length(v_normal) * v_thickness;

  float t = smoothstep(
    v_thickness - v_feather,
    v_thickness,
    dist
  );

  gl_FragColor = mix(v_color, transparent, t);
  #endif
}
`,xi=Ga,Ua=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;
attribute float a_radius;
attribute float a_radiusCoef;

uniform mat3 u_matrix;
uniform float u_zoomRatio;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_lengthToThicknessRatio;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  float radius = a_radius * a_radiusCoef;
  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // These first computations are taken from edge.vert.glsl. Please read it to
  // get better comments on what's happening:
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here, we move the point to leave space for the arrow head:
  float direction = sign(radius);
  float webGLNodeRadius = direction * radius * 2.0 * u_correctionRatio / u_sizeRatio;
  float webGLArrowHeadLength = webGLThickness * u_lengthToThicknessRatio * 2.0;

  vec2 compensationVector = vec2(-direction * unitNormal.y, direction * unitNormal.x) * (webGLNodeRadius + webGLArrowHeadLength);

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness + compensationVector, 1)).xy, 0, 1);

  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Ba=Ua,wi=WebGLRenderingContext,$r=wi.UNSIGNED_BYTE,ze=wi.FLOAT,Ma=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness","u_lengthToThicknessRatio"],Wa={lengthToThicknessRatio:Pt.lengthToThicknessRatio};function Ei(n){var i=ee(ee({},Wa),{});return(function(r){function e(){return ve(this,e),Ce(this,e,arguments)}return Se(e,r),ye(e,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Ba,FRAGMENT_SHADER_SOURCE:xi,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Ma,ATTRIBUTES:[{name:"a_positionStart",size:2,type:ze},{name:"a_positionEnd",size:2,type:ze},{name:"a_normal",size:2,type:ze},{name:"a_color",size:4,type:$r,normalized:!0},{name:"a_id",size:4,type:$r,normalized:!0},{name:"a_radius",size:1,type:ze}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:ze},{name:"a_normalCoef",size:1,type:ze},{name:"a_radiusCoef",size:1,type:ze}],CONSTANT_DATA:[[0,1,0],[0,-1,0],[1,1,1],[1,1,1],[0,-1,0],[1,-1,-1]]}}},{key:"processVisibleItem",value:function(s,o,a,l,u){var d=u.size||1,h=a.x,f=a.y,b=l.x,C=l.y,m=Ze(u.color),w=b-h,p=C-f,v=l.size||1,g=w*w+p*p,y=0,_=0;g&&(g=1/Math.sqrt(g),y=-p*g*d,_=w*g*d);var k=this.array;k[o++]=h,k[o++]=f,k[o++]=b,k[o++]=C,k[o++]=y,k[o++]=_,k[o++]=m,k[o++]=s,k[o++]=v}},{key:"setUniforms",value:function(s,o){var a=o.gl,l=o.uniformLocations,u=l.u_matrix,d=l.u_zoomRatio,h=l.u_feather,f=l.u_pixelRatio,b=l.u_correctionRatio,C=l.u_sizeRatio,m=l.u_minEdgeThickness,w=l.u_lengthToThicknessRatio;a.uniformMatrix3fv(u,!1,s.matrix),a.uniform1f(d,s.zoomRatio),a.uniform1f(C,s.sizeRatio),a.uniform1f(b,s.correctionRatio),a.uniform1f(f,s.pixelRatio),a.uniform1f(h,s.antiAliasingFeather),a.uniform1f(m,s.minEdgeThickness),a.uniform1f(w,i.lengthToThicknessRatio)}}])})(Dt)}Ei();function Ha(n){return Ra([Ei(),bi()])}var qa=Ha(),Va=qa,$a=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute vec2 a_normal;
attribute float a_normalCoef;
attribute vec2 a_positionStart;
attribute vec2 a_positionEnd;
attribute float a_positionCoef;

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_zoomRatio;
uniform float u_pixelRatio;
uniform float u_correctionRatio;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_thickness;
varying float v_feather;

const float bias = 255.0 / 254.0;

void main() {
  float minThickness = u_minEdgeThickness;

  vec2 normal = a_normal * a_normalCoef;
  vec2 position = a_positionStart * (1.0 - a_positionCoef) + a_positionEnd * a_positionCoef;

  float normalLength = length(normal);
  vec2 unitNormal = normal / normalLength;

  // We require edges to be at least "minThickness" pixels thick *on screen*
  // (so we need to compensate the size ratio):
  float pixelsThickness = max(normalLength, minThickness * u_sizeRatio);

  // Then, we need to retrieve the normalized thickness of the edge in the WebGL
  // referential (in a ([0, 1], [0, 1]) space), using our "magic" correction
  // ratio:
  float webGLThickness = pixelsThickness * u_correctionRatio / u_sizeRatio;

  // Here is the proper position of the vertex
  gl_Position = vec4((u_matrix * vec3(position + unitNormal * webGLThickness, 1)).xy, 0, 1);

  // For the fragment shader though, we need a thickness that takes the "magic"
  // correction ratio into account (as in webGLThickness), but so that the
  // antialiasing effect does not depend on the zoom level. So here's yet
  // another thickness version:
  v_thickness = webGLThickness / u_zoomRatio;

  v_normal = unitNormal;

  v_feather = u_feather * u_correctionRatio / u_zoomRatio / u_pixelRatio * 2.0;

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`,Ya=$a,Ci=WebGLRenderingContext,Yr=Ci.UNSIGNED_BYTE,Qe=Ci.FLOAT,Za=["u_matrix","u_zoomRatio","u_sizeRatio","u_correctionRatio","u_pixelRatio","u_feather","u_minEdgeThickness"],Xa=(function(n){function i(){return ve(this,i),Ce(this,i,arguments)}return Se(i,n),ye(i,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:Ya,FRAGMENT_SHADER_SOURCE:xi,METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:Za,ATTRIBUTES:[{name:"a_positionStart",size:2,type:Qe},{name:"a_positionEnd",size:2,type:Qe},{name:"a_normal",size:2,type:Qe},{name:"a_color",size:4,type:Yr,normalized:!0},{name:"a_id",size:4,type:Yr,normalized:!0}],CONSTANT_ATTRIBUTES:[{name:"a_positionCoef",size:1,type:Qe},{name:"a_normalCoef",size:1,type:Qe}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[1,1],[0,-1],[1,-1]]}}},{key:"processVisibleItem",value:function(e,t,s,o,a){var l=a.size||1,u=s.x,d=s.y,h=o.x,f=o.y,b=Ze(a.color),C=h-u,m=f-d,w=C*C+m*m,p=0,v=0;w&&(w=1/Math.sqrt(w),p=-m*w*l,v=C*w*l);var g=this.array;g[t++]=u,g[t++]=d,g[t++]=h,g[t++]=f,g[t++]=p,g[t++]=v,g[t++]=b,g[t++]=e}},{key:"setUniforms",value:function(e,t){var s=t.gl,o=t.uniformLocations,a=o.u_matrix,l=o.u_zoomRatio,u=o.u_feather,d=o.u_pixelRatio,h=o.u_correctionRatio,f=o.u_sizeRatio,b=o.u_minEdgeThickness;s.uniformMatrix3fv(a,!1,e.matrix),s.uniform1f(l,e.zoomRatio),s.uniform1f(f,e.sizeRatio),s.uniform1f(h,e.correctionRatio),s.uniform1f(d,e.pixelRatio),s.uniform1f(u,e.antiAliasingFeather),s.uniform1f(b,e.minEdgeThickness)}}])})(Dt),jr=(function(n){function i(){var r;return ve(this,i),r=Ce(this,i),r.rawEmitter=r,r}return Se(i,n),ye(i)})(ws.EventEmitter),Ka=je();const Qa=st(Ka);var Ja=function(i){return i},eo=function(i){return i*i},to=function(i){return i*(2-i)},ro=function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)},no=function(i){return i*i*i},io=function(i){return--i*i*i+1},so=function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)},ao={linear:Ja,quadraticIn:eo,quadraticOut:to,quadraticInOut:ro,cubicIn:no,cubicOut:io,cubicInOut:so},oo={easing:"quadraticInOut",duration:150};function ke(){return Float32Array.of(1,0,0,0,1,0,0,0,1)}function yt(n,i,r){return n[0]=i,n[4]=typeof r=="number"?r:i,n}function Zr(n,i){var r=Math.sin(i),e=Math.cos(i);return n[0]=e,n[1]=r,n[3]=-r,n[4]=e,n}function Xr(n,i,r){return n[6]=i,n[7]=r,n}function Ie(n,i){var r=n[0],e=n[1],t=n[2],s=n[3],o=n[4],a=n[5],l=n[6],u=n[7],d=n[8],h=i[0],f=i[1],b=i[2],C=i[3],m=i[4],w=i[5],p=i[6],v=i[7],g=i[8];return n[0]=h*r+f*s+b*l,n[1]=h*e+f*o+b*u,n[2]=h*t+f*a+b*d,n[3]=C*r+m*s+w*l,n[4]=C*e+m*o+w*u,n[5]=C*t+m*a+w*d,n[6]=p*r+v*s+g*l,n[7]=p*e+v*o+g*u,n[8]=p*t+v*a+g*d,n}function Er(n,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,e=n[0],t=n[1],s=n[3],o=n[4],a=n[6],l=n[7],u=i.x,d=i.y;return{x:u*e+d*s+a*r,y:u*t+d*o+l*r}}function lo(n,i){var r=n.height/n.width,e=i.height/i.width;return r<1&&e>1||r>1&&e<1?1:Math.min(Math.max(e,1/e),Math.max(1/r,r))}function Je(n,i,r,e,t){var s=n.angle,o=n.ratio,a=n.x,l=n.y,u=i.width,d=i.height,h=ke(),f=Math.min(u,d)-2*e,b=lo(i,r);return t?(Ie(h,Xr(ke(),a,l)),Ie(h,yt(ke(),o)),Ie(h,Zr(ke(),s)),Ie(h,yt(ke(),u/f/2/b,d/f/2/b))):(Ie(h,yt(ke(),2*(f/u)*b,2*(f/d)*b)),Ie(h,Zr(ke(),-s)),Ie(h,yt(ke(),1/o)),Ie(h,Xr(ke(),-a,-l))),h}function co(n,i,r){var e=Er(n,{x:Math.cos(i.angle),y:Math.sin(i.angle)},0),t=e.x,s=e.y;return 1/Math.sqrt(Math.pow(t,2)+Math.pow(s,2))/r.width}function uo(n){if(!n.order)return{x:[0,1],y:[0,1]};var i=1/0,r=-1/0,e=1/0,t=-1/0;return n.forEachNode(function(s,o){var a=o.x,l=o.y;a<i&&(i=a),a>r&&(r=a),l<e&&(e=l),l>t&&(t=l)}),{x:[i,r],y:[e,t]}}function ho(n){if(!Qa(n))throw new Error("Sigma: invalid graph instance.");n.forEachNode(function(i,r){if(!Number.isFinite(r.x)||!Number.isFinite(r.y))throw new Error("Sigma: Coordinates of node ".concat(i," are invalid. A node must have a numeric 'x' and 'y' attribute."))})}function fo(n,i,r){var e=document.createElement(n);if(i)for(var t in i)e.style[t]=i[t];if(r)for(var s in r)e.setAttribute(s,r[s]);return e}function Kr(){return typeof window.devicePixelRatio<"u"?window.devicePixelRatio:1}function Qr(n,i,r){return r.sort(function(e,t){var s=i(e)||0,o=i(t)||0;return s<o?-1:s>o?1:0})}function Jr(n){var i=Ye(n.x,2),r=i[0],e=i[1],t=Ye(n.y,2),s=t[0],o=t[1],a=Math.max(e-r,o-s),l=(e+r)/2,u=(o+s)/2;(a===0||Math.abs(a)===1/0||isNaN(a))&&(a=1),isNaN(l)&&(l=0),isNaN(u)&&(u=0);var d=function(f){return{x:.5+(f.x-l)/a,y:.5+(f.y-u)/a}};return d.applyTo=function(h){h.x=.5+(h.x-l)/a,h.y=.5+(h.y-u)/a},d.inverse=function(h){return{x:l+a*(h.x-.5),y:u+a*(h.y-.5)}},d.ratio=a,d}function Cr(n){"@babel/helpers - typeof";return Cr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Cr(n)}function en(n,i){var r=i.size;if(r!==0){var e=n.length;n.length+=r;var t=0;i.forEach(function(s){n[e+t]=s,t++})}}function Mt(n){n=n||{};for(var i=0,r=arguments.length<=1?0:arguments.length-1;i<r;i++){var e=i+1<1||arguments.length<=i+1?void 0:arguments[i+1];e&&Object.assign(n,e)}return n}var Ar={hideEdgesOnMove:!1,hideLabelsOnMove:!1,renderLabels:!0,renderEdgeLabels:!1,enableEdgeEvents:!1,defaultNodeColor:"#999",defaultNodeType:"circle",defaultEdgeColor:"#ccc",defaultEdgeType:"line",labelFont:"Arial",labelSize:14,labelWeight:"normal",labelColor:{color:"#000"},edgeLabelFont:"Arial",edgeLabelSize:14,edgeLabelWeight:"normal",edgeLabelColor:{attribute:"color"},stagePadding:30,defaultDrawEdgeLabel:_a,defaultDrawNodeLabel:pi,defaultDrawNodeHover:ka,minEdgeThickness:1.7,antiAliasingFeather:1,dragTimeout:100,draggedEventsTolerance:3,inertiaDuration:200,inertiaRatio:3,zoomDuration:250,zoomingRatio:1.7,doubleClickTimeout:300,doubleClickZoomingRatio:2.2,doubleClickZoomingDuration:200,tapMoveTolerance:10,zoomToSizeRatioFunction:Math.sqrt,itemSizesReference:"screen",autoRescale:!0,autoCenter:!0,labelDensity:1,labelGridCellSize:100,labelRenderedSizeThreshold:6,nodeReducer:null,edgeReducer:null,zIndex:!1,minCameraRatio:null,maxCameraRatio:null,enableCameraZooming:!0,enableCameraPanning:!0,enableCameraRotation:!0,cameraPanBoundaries:null,allowInvalidContainer:!1,nodeProgramClasses:{},nodeHoverProgramClasses:{},edgeProgramClasses:{}},go={circle:It},mo={arrow:Va,line:Xa};function Wt(n){if(typeof n.labelDensity!="number"||n.labelDensity<0)throw new Error("Settings: invalid `labelDensity`. Expecting a positive number.");var i=n.minCameraRatio,r=n.maxCameraRatio;if(typeof i=="number"&&typeof r=="number"&&r<i)throw new Error("Settings: invalid camera ratio boundaries. Expecting `maxCameraRatio` to be greater than `minCameraRatio`.")}function po(n){var i=Mt({},Ar,n);return i.nodeProgramClasses=Mt({},go,i.nodeProgramClasses),i.edgeProgramClasses=Mt({},mo,i.edgeProgramClasses),i}var bt=1.5,tn=(function(n){function i(){var r;return ve(this,i),r=Ce(this,i),H(r,"x",.5),H(r,"y",.5),H(r,"angle",0),H(r,"ratio",1),H(r,"minRatio",null),H(r,"maxRatio",null),H(r,"enabledZooming",!0),H(r,"enabledPanning",!0),H(r,"enabledRotation",!0),H(r,"clean",null),H(r,"nextFrame",null),H(r,"previousState",null),H(r,"enabled",!0),r.previousState=r.getState(),r}return Se(i,n),ye(i,[{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"getState",value:function(){return{x:this.x,y:this.y,angle:this.angle,ratio:this.ratio}}},{key:"hasState",value:function(e){return this.x===e.x&&this.y===e.y&&this.ratio===e.ratio&&this.angle===e.angle}},{key:"getPreviousState",value:function(){var e=this.previousState;return e?{x:e.x,y:e.y,angle:e.angle,ratio:e.ratio}:null}},{key:"getBoundedRatio",value:function(e){var t=e;return typeof this.minRatio=="number"&&(t=Math.max(t,this.minRatio)),typeof this.maxRatio=="number"&&(t=Math.min(t,this.maxRatio)),t}},{key:"validateState",value:function(e){var t={};return this.enabledPanning&&typeof e.x=="number"&&(t.x=e.x),this.enabledPanning&&typeof e.y=="number"&&(t.y=e.y),this.enabledZooming&&typeof e.ratio=="number"&&(t.ratio=this.getBoundedRatio(e.ratio)),this.enabledRotation&&typeof e.angle=="number"&&(t.angle=e.angle),this.clean?this.clean(ee(ee({},this.getState()),t)):t}},{key:"isAnimated",value:function(){return!!this.nextFrame}},{key:"setState",value:function(e){if(!this.enabled)return this;this.previousState=this.getState();var t=this.validateState(e);return typeof t.x=="number"&&(this.x=t.x),typeof t.y=="number"&&(this.y=t.y),typeof t.ratio=="number"&&(this.ratio=t.ratio),typeof t.angle=="number"&&(this.angle=t.angle),this.hasState(this.previousState)||this.emit("updated",this.getState()),this}},{key:"updateState",value:function(e){return this.setState(e(this.getState())),this}},{key:"animate",value:function(e){var t=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(!o)return new Promise(function(b){return t.animate(e,s,b)});if(this.enabled){var a=ee(ee({},oo),s),l=this.validateState(e),u=typeof a.easing=="function"?a.easing:ao[a.easing],d=Date.now(),h=this.getState(),f=function(){var C=(Date.now()-d)/a.duration;if(C>=1){t.nextFrame=null,t.setState(l),t.animationCallback&&(t.animationCallback.call(null),t.animationCallback=void 0);return}var m=u(C),w={};typeof l.x=="number"&&(w.x=h.x+(l.x-h.x)*m),typeof l.y=="number"&&(w.y=h.y+(l.y-h.y)*m),t.enabledRotation&&typeof l.angle=="number"&&(w.angle=h.angle+(l.angle-h.angle)*m),typeof l.ratio=="number"&&(w.ratio=h.ratio+(l.ratio-h.ratio)*m),t.setState(w),t.nextFrame=requestAnimationFrame(f)};this.nextFrame?(cancelAnimationFrame(this.nextFrame),this.animationCallback&&this.animationCallback.call(null),this.nextFrame=requestAnimationFrame(f)):f(),this.animationCallback=o}}},{key:"animatedZoom",value:function(e){return e?typeof e=="number"?this.animate({ratio:this.ratio/e}):this.animate({ratio:this.ratio/(e.factor||bt)},e):this.animate({ratio:this.ratio/bt})}},{key:"animatedUnzoom",value:function(e){return e?typeof e=="number"?this.animate({ratio:this.ratio*e}):this.animate({ratio:this.ratio*(e.factor||bt)},e):this.animate({ratio:this.ratio*bt})}},{key:"animatedReset",value:function(e){return this.animate({x:.5,y:.5,ratio:1,angle:0},e)}},{key:"copy",value:function(){return i.from(this.getState())}}],[{key:"from",value:function(e){var t=new i;return t.setState(e)}}])})(jr);function Ne(n,i){var r=i.getBoundingClientRect();return{x:n.clientX-r.left,y:n.clientY-r.top}}function Le(n,i){var r=ee(ee({},Ne(n,i)),{},{sigmaDefaultPrevented:!1,preventSigmaDefault:function(){r.sigmaDefaultPrevented=!0},original:n});return r}function et(n){var i="x"in n?n:ee(ee({},n.touches[0]||n.previousTouches[0]),{},{original:n.original,sigmaDefaultPrevented:n.sigmaDefaultPrevented,preventSigmaDefault:function(){n.sigmaDefaultPrevented=!0,i.sigmaDefaultPrevented=!0}});return i}function vo(n,i){return ee(ee({},Le(n,i)),{},{delta:Si(n)})}var yo=2;function Tt(n){for(var i=[],r=0,e=Math.min(n.length,yo);r<e;r++)i.push(n[r]);return i}function tt(n,i,r){var e={touches:Tt(n.touches).map(function(t){return Ne(t,r)}),previousTouches:i.map(function(t){return Ne(t,r)}),sigmaDefaultPrevented:!1,preventSigmaDefault:function(){e.sigmaDefaultPrevented=!0},original:n};return e}function Si(n){if(typeof n.deltaY<"u")return n.deltaY*-3/360;if(typeof n.detail<"u")return n.detail/-9;throw new Error("Captor: could not extract delta from event.")}var Ti=(function(n){function i(r,e){var t;return ve(this,i),t=Ce(this,i),t.container=r,t.renderer=e,t}return Se(i,n),ye(i)})(jr),bo=["doubleClickTimeout","doubleClickZoomingDuration","doubleClickZoomingRatio","dragTimeout","draggedEventsTolerance","inertiaDuration","inertiaRatio","zoomDuration","zoomingRatio"],xo=bo.reduce(function(n,i){return ee(ee({},n),{},H({},i,Ar[i]))},{}),wo=(function(n){function i(r,e){var t;return ve(this,i),t=Ce(this,i,[r,e]),H(t,"enabled",!0),H(t,"draggedEvents",0),H(t,"downStartTime",null),H(t,"lastMouseX",null),H(t,"lastMouseY",null),H(t,"isMouseDown",!1),H(t,"isMoving",!1),H(t,"movingTimeout",null),H(t,"startCameraState",null),H(t,"clicks",0),H(t,"doubleClickTimeout",null),H(t,"currentWheelDirection",0),H(t,"settings",xo),t.handleClick=t.handleClick.bind(t),t.handleRightClick=t.handleRightClick.bind(t),t.handleDown=t.handleDown.bind(t),t.handleUp=t.handleUp.bind(t),t.handleMove=t.handleMove.bind(t),t.handleWheel=t.handleWheel.bind(t),t.handleLeave=t.handleLeave.bind(t),t.handleEnter=t.handleEnter.bind(t),r.addEventListener("click",t.handleClick,{capture:!1}),r.addEventListener("contextmenu",t.handleRightClick,{capture:!1}),r.addEventListener("mousedown",t.handleDown,{capture:!1}),r.addEventListener("wheel",t.handleWheel,{capture:!1}),r.addEventListener("mouseleave",t.handleLeave,{capture:!1}),r.addEventListener("mouseenter",t.handleEnter,{capture:!1}),document.addEventListener("mousemove",t.handleMove,{capture:!1}),document.addEventListener("mouseup",t.handleUp,{capture:!1}),t}return Se(i,n),ye(i,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("click",this.handleClick),e.removeEventListener("contextmenu",this.handleRightClick),e.removeEventListener("mousedown",this.handleDown),e.removeEventListener("wheel",this.handleWheel),e.removeEventListener("mouseleave",this.handleLeave),e.removeEventListener("mouseenter",this.handleEnter),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleUp)}},{key:"handleClick",value:function(e){var t=this;if(this.enabled){if(this.clicks++,this.clicks===2)return this.clicks=0,typeof this.doubleClickTimeout=="number"&&(clearTimeout(this.doubleClickTimeout),this.doubleClickTimeout=null),this.handleDoubleClick(e);setTimeout(function(){t.clicks=0,t.doubleClickTimeout=null},this.settings.doubleClickTimeout),this.draggedEvents<this.settings.draggedEventsTolerance&&this.emit("click",Le(e,this.container))}}},{key:"handleRightClick",value:function(e){this.enabled&&this.emit("rightClick",Le(e,this.container))}},{key:"handleDoubleClick",value:function(e){if(this.enabled){e.preventDefault(),e.stopPropagation();var t=Le(e,this.container);if(this.emit("doubleClick",t),!t.sigmaDefaultPrevented){var s=this.renderer.getCamera(),o=s.getBoundedRatio(s.getState().ratio/this.settings.doubleClickZoomingRatio);s.animate(this.renderer.getViewportZoomedState(Ne(e,this.container),o),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}}},{key:"handleDown",value:function(e){if(this.enabled){if(e.button===0){this.startCameraState=this.renderer.getCamera().getState();var t=Ne(e,this.container),s=t.x,o=t.y;this.lastMouseX=s,this.lastMouseY=o,this.draggedEvents=0,this.downStartTime=Date.now(),this.isMouseDown=!0}this.emit("mousedown",Le(e,this.container))}}},{key:"handleUp",value:function(e){var t=this;if(!(!this.enabled||!this.isMouseDown)){var s=this.renderer.getCamera();this.isMouseDown=!1,typeof this.movingTimeout=="number"&&(clearTimeout(this.movingTimeout),this.movingTimeout=null);var o=Ne(e,this.container),a=o.x,l=o.y,u=s.getState(),d=s.getPreviousState()||{x:0,y:0};this.isMoving?s.animate({x:u.x+this.settings.inertiaRatio*(u.x-d.x),y:u.y+this.settings.inertiaRatio*(u.y-d.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"}):(this.lastMouseX!==a||this.lastMouseY!==l)&&s.setState({x:u.x,y:u.y}),this.isMoving=!1,setTimeout(function(){var h=t.draggedEvents>0;t.draggedEvents=0,h&&t.renderer.getSetting("hideEdgesOnMove")&&t.renderer.refresh()},0),this.emit("mouseup",Le(e,this.container))}}},{key:"handleMove",value:function(e){var t=this;if(this.enabled){var s=Le(e,this.container);if(this.emit("mousemovebody",s),(e.target===this.container||e.composedPath()[0]===this.container)&&this.emit("mousemove",s),!s.sigmaDefaultPrevented&&this.isMouseDown){this.isMoving=!0,this.draggedEvents++,typeof this.movingTimeout=="number"&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){t.movingTimeout=null,t.isMoving=!1},this.settings.dragTimeout);var o=this.renderer.getCamera(),a=Ne(e,this.container),l=a.x,u=a.y,d=this.renderer.viewportToFramedGraph({x:this.lastMouseX,y:this.lastMouseY}),h=this.renderer.viewportToFramedGraph({x:l,y:u}),f=d.x-h.x,b=d.y-h.y,C=o.getState(),m=C.x+f,w=C.y+b;o.setState({x:m,y:w}),this.lastMouseX=l,this.lastMouseY=u,e.preventDefault(),e.stopPropagation()}}}},{key:"handleLeave",value:function(e){this.emit("mouseleave",Le(e,this.container))}},{key:"handleEnter",value:function(e){this.emit("mouseenter",Le(e,this.container))}},{key:"handleWheel",value:function(e){var t=this,s=this.renderer.getCamera();if(!(!this.enabled||!s.enabledZooming)){var o=Si(e);if(o){var a=vo(e,this.container);if(this.emit("wheel",a),a.sigmaDefaultPrevented){e.preventDefault(),e.stopPropagation();return}var l=s.getState().ratio,u=o>0?1/this.settings.zoomingRatio:this.settings.zoomingRatio,d=s.getBoundedRatio(l*u),h=o>0?1:-1,f=Date.now();l!==d&&(e.preventDefault(),e.stopPropagation(),!(this.currentWheelDirection===h&&this.lastWheelTriggerTime&&f-this.lastWheelTriggerTime<this.settings.zoomDuration/5)&&(s.animate(this.renderer.getViewportZoomedState(Ne(e,this.container),d),{easing:"quadraticOut",duration:this.settings.zoomDuration},function(){t.currentWheelDirection=0}),this.currentWheelDirection=h,this.lastWheelTriggerTime=f))}}}},{key:"setSettings",value:function(e){this.settings=e}}])})(Ti),Eo=["dragTimeout","inertiaDuration","inertiaRatio","doubleClickTimeout","doubleClickZoomingRatio","doubleClickZoomingDuration","tapMoveTolerance"],Co=Eo.reduce(function(n,i){return ee(ee({},n),{},H({},i,Ar[i]))},{}),So=(function(n){function i(r,e){var t;return ve(this,i),t=Ce(this,i,[r,e]),H(t,"enabled",!0),H(t,"isMoving",!1),H(t,"hasMoved",!1),H(t,"touchMode",0),H(t,"startTouchesPositions",[]),H(t,"lastTouches",[]),H(t,"lastTap",null),H(t,"settings",Co),t.handleStart=t.handleStart.bind(t),t.handleLeave=t.handleLeave.bind(t),t.handleMove=t.handleMove.bind(t),r.addEventListener("touchstart",t.handleStart,{capture:!1}),r.addEventListener("touchcancel",t.handleLeave,{capture:!1}),document.addEventListener("touchend",t.handleLeave,{capture:!1,passive:!1}),document.addEventListener("touchmove",t.handleMove,{capture:!1,passive:!1}),t}return Se(i,n),ye(i,[{key:"kill",value:function(){var e=this.container;e.removeEventListener("touchstart",this.handleStart),e.removeEventListener("touchcancel",this.handleLeave),document.removeEventListener("touchend",this.handleLeave),document.removeEventListener("touchmove",this.handleMove)}},{key:"getDimensions",value:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},{key:"handleStart",value:function(e){var t=this;if(this.enabled){e.preventDefault();var s=Tt(e.touches);if(this.touchMode=s.length,this.startCameraState=this.renderer.getCamera().getState(),this.startTouchesPositions=s.map(function(b){return Ne(b,t.container)}),this.touchMode===2){var o=Ye(this.startTouchesPositions,2),a=o[0],l=a.x,u=a.y,d=o[1],h=d.x,f=d.y;this.startTouchesAngle=Math.atan2(f-u,h-l),this.startTouchesDistance=Math.sqrt(Math.pow(h-l,2)+Math.pow(f-u,2))}this.emit("touchdown",tt(e,this.lastTouches,this.container)),this.lastTouches=s,this.lastTouchesPositions=this.startTouchesPositions}}},{key:"handleLeave",value:function(e){if(!(!this.enabled||!this.startTouchesPositions.length)){switch(e.cancelable&&e.preventDefault(),this.movingTimeout&&(this.isMoving=!1,clearTimeout(this.movingTimeout)),this.touchMode){case 2:if(e.touches.length===1){this.handleStart(e),e.preventDefault();break}case 1:if(this.isMoving){var t=this.renderer.getCamera(),s=t.getState(),o=t.getPreviousState()||{x:0,y:0};t.animate({x:s.x+this.settings.inertiaRatio*(s.x-o.x),y:s.y+this.settings.inertiaRatio*(s.y-o.y)},{duration:this.settings.inertiaDuration,easing:"quadraticOut"})}this.hasMoved=!1,this.isMoving=!1,this.touchMode=0;break}if(this.emit("touchup",tt(e,this.lastTouches,this.container)),!e.touches.length){var a=Ne(this.lastTouches[0],this.container),l=this.startTouchesPositions[0],u=Math.pow(a.x-l.x,2)+Math.pow(a.y-l.y,2);if(!e.touches.length&&u<Math.pow(this.settings.tapMoveTolerance,2))if(this.lastTap&&Date.now()-this.lastTap.time<this.settings.doubleClickTimeout){var d=tt(e,this.lastTouches,this.container);if(this.emit("doubletap",d),this.lastTap=null,!d.sigmaDefaultPrevented){var h=this.renderer.getCamera(),f=h.getBoundedRatio(h.getState().ratio/this.settings.doubleClickZoomingRatio);h.animate(this.renderer.getViewportZoomedState(a,f),{easing:"quadraticInOut",duration:this.settings.doubleClickZoomingDuration})}}else{var b=tt(e,this.lastTouches,this.container);this.emit("tap",b),this.lastTap={time:Date.now(),position:b.touches[0]||b.previousTouches[0]}}}this.lastTouches=Tt(e.touches),this.startTouchesPositions=[]}}},{key:"handleMove",value:function(e){var t=this;if(!(!this.enabled||!this.startTouchesPositions.length)){e.preventDefault();var s=Tt(e.touches),o=s.map(function(L){return Ne(L,t.container)}),a=this.lastTouches;this.lastTouches=s,this.lastTouchesPositions=o;var l=tt(e,a,this.container);if(this.emit("touchmove",l),!l.sigmaDefaultPrevented&&(this.hasMoved||(this.hasMoved=o.some(function(L,S){var A=t.startTouchesPositions[S];return A&&(L.x!==A.x||L.y!==A.y)})),!!this.hasMoved)){this.isMoving=!0,this.movingTimeout&&clearTimeout(this.movingTimeout),this.movingTimeout=window.setTimeout(function(){t.isMoving=!1},this.settings.dragTimeout);var u=this.renderer.getCamera(),d=this.startCameraState,h=this.renderer.getSetting("stagePadding");switch(this.touchMode){case 1:{var f=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0]),b=f.x,C=f.y,m=this.renderer.viewportToFramedGraph(o[0]),w=m.x,p=m.y;u.setState({x:d.x+b-w,y:d.y+C-p});break}case 2:{var v={x:.5,y:.5,angle:0,ratio:1},g=o[0],y=g.x,_=g.y,k=o[1],T=k.x,j=k.y,N=Math.atan2(j-_,T-y)-this.startTouchesAngle,I=Math.hypot(j-_,T-y)/this.startTouchesDistance,U=u.getBoundedRatio(d.ratio/I);v.ratio=U,v.angle=d.angle+N;var D=this.getDimensions(),R=this.renderer.viewportToFramedGraph((this.startTouchesPositions||[])[0],{cameraState:d}),F=Math.min(D.width,D.height)-2*h,M=F/D.width,G=F/D.height,E=U/F,x=y-F/2/M,V=_-F/2/G,W=[x*Math.cos(-v.angle)-V*Math.sin(-v.angle),V*Math.cos(-v.angle)+x*Math.sin(-v.angle)];x=W[0],V=W[1],v.x=R.x-x*E,v.y=R.y+V*E,u.setState(v);break}}}}}},{key:"setSettings",value:function(e){this.settings=e}}])})(Ti);function To(n){if(Array.isArray(n))return xr(n)}function Ro(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function _o(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rn(n){return To(n)||Ro(n)||ci(n)||_o()}function ko(n,i){if(n==null)return{};var r={};for(var e in n)if({}.hasOwnProperty.call(n,e)){if(i.indexOf(e)!==-1)continue;r[e]=n[e]}return r}function Ht(n,i){if(n==null)return{};var r,e,t=ko(n,i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(e=0;e<s.length;e++)r=s[e],i.indexOf(r)===-1&&{}.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}var nn=(function(){function n(i,r){ve(this,n),this.key=i,this.size=r}return ye(n,null,[{key:"compare",value:function(r,e){return r.size>e.size?-1:r.size<e.size||r.key>e.key?1:-1}}])})(),sn=(function(){function n(){ve(this,n),H(this,"width",0),H(this,"height",0),H(this,"cellSize",0),H(this,"columns",0),H(this,"rows",0),H(this,"cells",{})}return ye(n,[{key:"resizeAndClear",value:function(r,e){this.width=r.width,this.height=r.height,this.cellSize=e,this.columns=Math.ceil(r.width/e),this.rows=Math.ceil(r.height/e),this.cells={}}},{key:"getIndex",value:function(r){var e=Math.floor(r.x/this.cellSize),t=Math.floor(r.y/this.cellSize);return t*this.columns+e}},{key:"add",value:function(r,e,t){var s=new nn(r,e),o=this.getIndex(t),a=this.cells[o];a||(a=[],this.cells[o]=a),a.push(s)}},{key:"organize",value:function(){for(var r in this.cells){var e=this.cells[r];e.sort(nn.compare)}}},{key:"getLabelsToDisplay",value:function(r,e){var t=this.cellSize*this.cellSize,s=t/r/r,o=s*e/t,a=Math.ceil(o),l=[];for(var u in this.cells)for(var d=this.cells[u],h=0;h<Math.min(a,d.length);h++)l.push(d[h].key);return l}}])})();function No(n){var i=n.graph,r=n.hoveredNode,e=n.highlightedNodes,t=n.displayedNodeLabels,s=[];return i.forEachEdge(function(o,a,l,u){(l===r||u===r||e.has(l)||e.has(u)||t.has(l)&&t.has(u))&&s.push(o)}),s}var an=150,on=50,De=Object.prototype.hasOwnProperty;function jo(n,i,r){if(!De.call(r,"x")||!De.call(r,"y"))throw new Error('Sigma: could not find a valid position (x, y) for node "'.concat(i,'". All your nodes must have a number "x" and "y". Maybe your forgot to apply a layout or your "nodeReducer" is not returning the correct data?'));return r.color||(r.color=n.defaultNodeColor),!r.label&&r.label!==""&&(r.label=null),r.label!==void 0&&r.label!==null?r.label=""+r.label:r.label=null,r.size||(r.size=2),De.call(r,"hidden")||(r.hidden=!1),De.call(r,"highlighted")||(r.highlighted=!1),De.call(r,"forceLabel")||(r.forceLabel=!1),(!r.type||r.type==="")&&(r.type=n.defaultNodeType),r.zIndex||(r.zIndex=0),r}function Ao(n,i,r){return r.color||(r.color=n.defaultEdgeColor),r.label||(r.label=""),r.size||(r.size=.5),De.call(r,"hidden")||(r.hidden=!1),De.call(r,"forceLabel")||(r.forceLabel=!1),(!r.type||r.type==="")&&(r.type=n.defaultEdgeType),r.zIndex||(r.zIndex=0),r}var Lo=(function(n){function i(r,e){var t,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(ve(this,i),t=Ce(this,i),H(t,"elements",{}),H(t,"canvasContexts",{}),H(t,"webGLContexts",{}),H(t,"pickingLayers",new Set),H(t,"textures",{}),H(t,"frameBuffers",{}),H(t,"activeListeners",{}),H(t,"labelGrid",new sn),H(t,"nodeDataCache",{}),H(t,"edgeDataCache",{}),H(t,"nodeProgramIndex",{}),H(t,"edgeProgramIndex",{}),H(t,"nodesWithForcedLabels",new Set),H(t,"edgesWithForcedLabels",new Set),H(t,"nodeExtent",{x:[0,1],y:[0,1]}),H(t,"nodeZExtent",[1/0,-1/0]),H(t,"edgeZExtent",[1/0,-1/0]),H(t,"matrix",ke()),H(t,"invMatrix",ke()),H(t,"correctionRatio",1),H(t,"customBBox",null),H(t,"normalizationFunction",Jr({x:[0,1],y:[0,1]})),H(t,"graphToViewportRatio",1),H(t,"itemIDsIndex",{}),H(t,"nodeIndices",{}),H(t,"edgeIndices",{}),H(t,"width",0),H(t,"height",0),H(t,"pixelRatio",Kr()),H(t,"pickingDownSizingRatio",2*t.pixelRatio),H(t,"displayedNodeLabels",new Set),H(t,"displayedEdgeLabels",new Set),H(t,"highlightedNodes",new Set),H(t,"hoveredNode",null),H(t,"hoveredEdge",null),H(t,"renderFrame",null),H(t,"renderHighlightedNodesFrame",null),H(t,"needToProcess",!1),H(t,"checkEdgesEventsFrame",null),H(t,"nodePrograms",{}),H(t,"nodeHoverPrograms",{}),H(t,"edgePrograms",{}),t.settings=po(s),Wt(t.settings),ho(r),!(e instanceof HTMLElement))throw new Error("Sigma: container should be an html element.");t.graph=r,t.container=e,t.createWebGLContext("edges",{picking:s.enableEdgeEvents}),t.createCanvasContext("edgeLabels"),t.createWebGLContext("nodes",{picking:!0}),t.createCanvasContext("labels"),t.createCanvasContext("hovers"),t.createWebGLContext("hoverNodes"),t.createCanvasContext("mouse",{style:{touchAction:"none",userSelect:"none"}}),t.resize();for(var o in t.settings.nodeProgramClasses)t.registerNodeProgram(o,t.settings.nodeProgramClasses[o],t.settings.nodeHoverProgramClasses[o]);for(var a in t.settings.edgeProgramClasses)t.registerEdgeProgram(a,t.settings.edgeProgramClasses[a]);return t.camera=new tn,t.bindCameraHandlers(),t.mouseCaptor=new wo(t.elements.mouse,t),t.mouseCaptor.setSettings(t.settings),t.touchCaptor=new So(t.elements.mouse,t),t.touchCaptor.setSettings(t.settings),t.bindEventHandlers(),t.bindGraphHandlers(),t.handleSettingsUpdate(),t.refresh(),t}return Se(i,n),ye(i,[{key:"registerNodeProgram",value:function(e,t,s){return this.nodePrograms[e]&&this.nodePrograms[e].kill(),this.nodeHoverPrograms[e]&&this.nodeHoverPrograms[e].kill(),this.nodePrograms[e]=new t(this.webGLContexts.nodes,this.frameBuffers.nodes,this),this.nodeHoverPrograms[e]=new(s||t)(this.webGLContexts.hoverNodes,null,this),this}},{key:"registerEdgeProgram",value:function(e,t){return this.edgePrograms[e]&&this.edgePrograms[e].kill(),this.edgePrograms[e]=new t(this.webGLContexts.edges,this.frameBuffers.edges,this),this}},{key:"unregisterNodeProgram",value:function(e){if(this.nodePrograms[e]){var t=this.nodePrograms,s=t[e],o=Ht(t,[e].map(nt));s.kill(),this.nodePrograms=o}if(this.nodeHoverPrograms[e]){var a=this.nodeHoverPrograms,l=a[e],u=Ht(a,[e].map(nt));l.kill(),this.nodePrograms=u}return this}},{key:"unregisterEdgeProgram",value:function(e){if(this.edgePrograms[e]){var t=this.edgePrograms,s=t[e],o=Ht(t,[e].map(nt));s.kill(),this.edgePrograms=o}return this}},{key:"resetWebGLTexture",value:function(e){var t=this.webGLContexts[e],s=this.frameBuffers[e],o=this.textures[e];o&&t.deleteTexture(o);var a=t.createTexture();return t.bindFramebuffer(t.FRAMEBUFFER,s),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0),this.textures[e]=a,this}},{key:"bindCameraHandlers",value:function(){var e=this;return this.activeListeners.camera=function(){e.scheduleRender()},this.camera.on("updated",this.activeListeners.camera),this}},{key:"unbindCameraHandlers",value:function(){return this.camera.removeListener("updated",this.activeListeners.camera),this}},{key:"getNodeAtPosition",value:function(e){var t=e.x,s=e.y,o=Br(this.webGLContexts.nodes,this.frameBuffers.nodes,t,s,this.pixelRatio,this.pickingDownSizingRatio),a=Ur.apply(void 0,rn(o)),l=this.itemIDsIndex[a];return l&&l.type==="node"?l.id:null}},{key:"bindEventHandlers",value:function(){var e=this;this.activeListeners.handleResize=function(){e.scheduleRefresh()},window.addEventListener("resize",this.activeListeners.handleResize),this.activeListeners.handleMove=function(s){var o=et(s),a={event:o,preventSigmaDefault:function(){o.preventSigmaDefault()}},l=e.getNodeAtPosition(o);if(l&&e.hoveredNode!==l&&!e.nodeDataCache[l].hidden){e.hoveredNode&&e.emit("leaveNode",ee(ee({},a),{},{node:e.hoveredNode})),e.hoveredNode=l,e.emit("enterNode",ee(ee({},a),{},{node:l})),e.scheduleHighlightedNodesRender();return}if(e.hoveredNode&&e.getNodeAtPosition(o)!==e.hoveredNode){var u=e.hoveredNode;e.hoveredNode=null,e.emit("leaveNode",ee(ee({},a),{},{node:u})),e.scheduleHighlightedNodesRender();return}if(e.settings.enableEdgeEvents){var d=e.hoveredNode?null:e.getEdgeAtPoint(a.event.x,a.event.y);d!==e.hoveredEdge&&(e.hoveredEdge&&e.emit("leaveEdge",ee(ee({},a),{},{edge:e.hoveredEdge})),d&&e.emit("enterEdge",ee(ee({},a),{},{edge:d})),e.hoveredEdge=d)}},this.activeListeners.handleMoveBody=function(s){var o=et(s);e.emit("moveBody",{event:o,preventSigmaDefault:function(){o.preventSigmaDefault()}})},this.activeListeners.handleLeave=function(s){var o=et(s),a={event:o,preventSigmaDefault:function(){o.preventSigmaDefault()}};e.hoveredNode&&(e.emit("leaveNode",ee(ee({},a),{},{node:e.hoveredNode})),e.scheduleHighlightedNodesRender()),e.settings.enableEdgeEvents&&e.hoveredEdge&&(e.emit("leaveEdge",ee(ee({},a),{},{edge:e.hoveredEdge})),e.scheduleHighlightedNodesRender()),e.emit("leaveStage",ee({},a))},this.activeListeners.handleEnter=function(s){var o=et(s),a={event:o,preventSigmaDefault:function(){o.preventSigmaDefault()}};e.emit("enterStage",ee({},a))};var t=function(o){return function(a){var l=et(a),u={event:l,preventSigmaDefault:function(){l.preventSigmaDefault()}},d=e.getNodeAtPosition(l);if(d)return e.emit("".concat(o,"Node"),ee(ee({},u),{},{node:d}));if(e.settings.enableEdgeEvents){var h=e.getEdgeAtPoint(l.x,l.y);if(h)return e.emit("".concat(o,"Edge"),ee(ee({},u),{},{edge:h}))}return e.emit("".concat(o,"Stage"),u)}};return this.activeListeners.handleClick=t("click"),this.activeListeners.handleRightClick=t("rightClick"),this.activeListeners.handleDoubleClick=t("doubleClick"),this.activeListeners.handleWheel=t("wheel"),this.activeListeners.handleDown=t("down"),this.activeListeners.handleUp=t("up"),this.mouseCaptor.on("mousemove",this.activeListeners.handleMove),this.mouseCaptor.on("mousemovebody",this.activeListeners.handleMoveBody),this.mouseCaptor.on("click",this.activeListeners.handleClick),this.mouseCaptor.on("rightClick",this.activeListeners.handleRightClick),this.mouseCaptor.on("doubleClick",this.activeListeners.handleDoubleClick),this.mouseCaptor.on("wheel",this.activeListeners.handleWheel),this.mouseCaptor.on("mousedown",this.activeListeners.handleDown),this.mouseCaptor.on("mouseup",this.activeListeners.handleUp),this.mouseCaptor.on("mouseleave",this.activeListeners.handleLeave),this.mouseCaptor.on("mouseenter",this.activeListeners.handleEnter),this.touchCaptor.on("touchdown",this.activeListeners.handleDown),this.touchCaptor.on("touchdown",this.activeListeners.handleMove),this.touchCaptor.on("touchup",this.activeListeners.handleUp),this.touchCaptor.on("touchmove",this.activeListeners.handleMove),this.touchCaptor.on("tap",this.activeListeners.handleClick),this.touchCaptor.on("doubletap",this.activeListeners.handleDoubleClick),this.touchCaptor.on("touchmove",this.activeListeners.handleMoveBody),this}},{key:"bindGraphHandlers",value:function(){var e=this,t=this.graph,s=new Set(["x","y","zIndex","type"]);return this.activeListeners.eachNodeAttributesUpdatedGraphUpdate=function(o){var a,l=(a=o.hints)===null||a===void 0?void 0:a.attributes;e.graph.forEachNode(function(d){return e.updateNode(d)});var u=!l||l.some(function(d){return s.has(d)});e.refresh({partialGraph:{nodes:t.nodes()},skipIndexation:!u,schedule:!0})},this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate=function(o){var a,l=(a=o.hints)===null||a===void 0?void 0:a.attributes;e.graph.forEachEdge(function(d){return e.updateEdge(d)});var u=l&&["zIndex","type"].some(function(d){return l?.includes(d)});e.refresh({partialGraph:{edges:t.edges()},skipIndexation:!u,schedule:!0})},this.activeListeners.addNodeGraphUpdate=function(o){var a=o.key;e.addNode(a),e.refresh({partialGraph:{nodes:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.updateNodeGraphUpdate=function(o){var a=o.key;e.refresh({partialGraph:{nodes:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropNodeGraphUpdate=function(o){var a=o.key;e.removeNode(a),e.refresh({schedule:!0})},this.activeListeners.addEdgeGraphUpdate=function(o){var a=o.key;e.addEdge(a),e.refresh({partialGraph:{edges:[a]},schedule:!0})},this.activeListeners.updateEdgeGraphUpdate=function(o){var a=o.key;e.refresh({partialGraph:{edges:[a]},skipIndexation:!1,schedule:!0})},this.activeListeners.dropEdgeGraphUpdate=function(o){var a=o.key;e.removeEdge(a),e.refresh({schedule:!0})},this.activeListeners.clearEdgesGraphUpdate=function(){e.clearEdgeState(),e.clearEdgeIndices(),e.refresh({schedule:!0})},this.activeListeners.clearGraphUpdate=function(){e.clearEdgeState(),e.clearNodeState(),e.clearEdgeIndices(),e.clearNodeIndices(),e.refresh({schedule:!0})},t.on("nodeAdded",this.activeListeners.addNodeGraphUpdate),t.on("nodeDropped",this.activeListeners.dropNodeGraphUpdate),t.on("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),t.on("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),t.on("edgeAdded",this.activeListeners.addEdgeGraphUpdate),t.on("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),t.on("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),t.on("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),t.on("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),t.on("cleared",this.activeListeners.clearGraphUpdate),this}},{key:"unbindGraphHandlers",value:function(){var e=this.graph;e.removeListener("nodeAdded",this.activeListeners.addNodeGraphUpdate),e.removeListener("nodeDropped",this.activeListeners.dropNodeGraphUpdate),e.removeListener("nodeAttributesUpdated",this.activeListeners.updateNodeGraphUpdate),e.removeListener("eachNodeAttributesUpdated",this.activeListeners.eachNodeAttributesUpdatedGraphUpdate),e.removeListener("edgeAdded",this.activeListeners.addEdgeGraphUpdate),e.removeListener("edgeDropped",this.activeListeners.dropEdgeGraphUpdate),e.removeListener("edgeAttributesUpdated",this.activeListeners.updateEdgeGraphUpdate),e.removeListener("eachEdgeAttributesUpdated",this.activeListeners.eachEdgeAttributesUpdatedGraphUpdate),e.removeListener("edgesCleared",this.activeListeners.clearEdgesGraphUpdate),e.removeListener("cleared",this.activeListeners.clearGraphUpdate)}},{key:"getEdgeAtPoint",value:function(e,t){var s=Br(this.webGLContexts.edges,this.frameBuffers.edges,e,t,this.pixelRatio,this.pickingDownSizingRatio),o=Ur.apply(void 0,rn(s)),a=this.itemIDsIndex[o];return a&&a.type==="edge"?a.id:null}},{key:"process",value:function(){var e=this;this.emit("beforeProcess");var t=this.graph,s=this.settings,o=this.getDimensions();if(this.nodeExtent=uo(this.graph),!this.settings.autoRescale){var a=o.width,l=o.height,u=this.nodeExtent,d=u.x,h=u.y;this.nodeExtent={x:[(d[0]+d[1])/2-a/2,(d[0]+d[1])/2+a/2],y:[(h[0]+h[1])/2-l/2,(h[0]+h[1])/2+l/2]}}this.normalizationFunction=Jr(this.customBBox||this.nodeExtent);var f=new tn,b=Je(f.getState(),o,this.getGraphDimensions(),this.getStagePadding());this.labelGrid.resizeAndClear(o,s.labelGridCellSize);for(var C={},m={},w={},p={},v=1,g=t.nodes(),y=0,_=g.length;y<_;y++){var k=g[y],T=this.nodeDataCache[k],j=t.getNodeAttributes(k);T.x=j.x,T.y=j.y,this.normalizationFunction.applyTo(T),typeof T.label=="string"&&!T.hidden&&this.labelGrid.add(k,T.size,this.framedGraphToViewport(T,{matrix:b})),C[T.type]=(C[T.type]||0)+1}this.labelGrid.organize();for(var N in this.nodePrograms){if(!De.call(this.nodePrograms,N))throw new Error('Sigma: could not find a suitable program for node type "'.concat(N,'"!'));this.nodePrograms[N].reallocate(C[N]||0),C[N]=0}this.settings.zIndex&&this.nodeZExtent[0]!==this.nodeZExtent[1]&&(g=Qr(this.nodeZExtent,function(Z){return e.nodeDataCache[Z].zIndex},g));for(var I=0,U=g.length;I<U;I++){var D=g[I];m[D]=v,p[m[D]]={type:"node",id:D},v++;var R=this.nodeDataCache[D];this.addNodeToProgram(D,m[D],C[R.type]++)}for(var F={},M=t.edges(),G=0,E=M.length;G<E;G++){var x=M[G],V=this.edgeDataCache[x];F[V.type]=(F[V.type]||0)+1}this.settings.zIndex&&this.edgeZExtent[0]!==this.edgeZExtent[1]&&(M=Qr(this.edgeZExtent,function(Z){return e.edgeDataCache[Z].zIndex},M));for(var W in this.edgePrograms){if(!De.call(this.edgePrograms,W))throw new Error('Sigma: could not find a suitable program for edge type "'.concat(W,'"!'));this.edgePrograms[W].reallocate(F[W]||0),F[W]=0}for(var L=0,S=M.length;L<S;L++){var A=M[L];w[A]=v,p[w[A]]={type:"edge",id:A},v++;var z=this.edgeDataCache[A];this.addEdgeToProgram(A,w[A],F[z.type]++)}return this.itemIDsIndex=p,this.nodeIndices=m,this.edgeIndices=w,this.emit("afterProcess"),this}},{key:"handleSettingsUpdate",value:function(e){var t=this,s=this.settings;if(this.camera.minRatio=s.minCameraRatio,this.camera.maxRatio=s.maxCameraRatio,this.camera.enabledZooming=s.enableCameraZooming,this.camera.enabledPanning=s.enableCameraPanning,this.camera.enabledRotation=s.enableCameraRotation,s.cameraPanBoundaries?this.camera.clean=function(d){return t.cleanCameraState(d,s.cameraPanBoundaries&&Cr(s.cameraPanBoundaries)==="object"?s.cameraPanBoundaries:{})}:this.camera.clean=null,this.camera.setState(this.camera.validateState(this.camera.getState())),e){if(e.edgeProgramClasses!==s.edgeProgramClasses){for(var o in s.edgeProgramClasses)s.edgeProgramClasses[o]!==e.edgeProgramClasses[o]&&this.registerEdgeProgram(o,s.edgeProgramClasses[o]);for(var a in e.edgeProgramClasses)s.edgeProgramClasses[a]||this.unregisterEdgeProgram(a)}if(e.nodeProgramClasses!==s.nodeProgramClasses||e.nodeHoverProgramClasses!==s.nodeHoverProgramClasses){for(var l in s.nodeProgramClasses)(s.nodeProgramClasses[l]!==e.nodeProgramClasses[l]||s.nodeHoverProgramClasses[l]!==e.nodeHoverProgramClasses[l])&&this.registerNodeProgram(l,s.nodeProgramClasses[l],s.nodeHoverProgramClasses[l]);for(var u in e.nodeProgramClasses)s.nodeProgramClasses[u]||this.unregisterNodeProgram(u)}}return this.mouseCaptor.setSettings(this.settings),this.touchCaptor.setSettings(this.settings),this}},{key:"cleanCameraState",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t.tolerance,o=s===void 0?0:s,a=t.boundaries,l=ee({},e),u=a||this.nodeExtent,d=Ye(u.x,2),h=d[0],f=d[1],b=Ye(u.y,2),C=b[0],m=b[1],w=[this.graphToViewport({x:h,y:C},{cameraState:e}),this.graphToViewport({x:f,y:C},{cameraState:e}),this.graphToViewport({x:h,y:m},{cameraState:e}),this.graphToViewport({x:f,y:m},{cameraState:e})],p=1/0,v=-1/0,g=1/0,y=-1/0;w.forEach(function(F){var M=F.x,G=F.y;p=Math.min(p,M),v=Math.max(v,M),g=Math.min(g,G),y=Math.max(y,G)});var _=v-p,k=y-g,T=this.getDimensions(),j=T.width,N=T.height,I=0,U=0;if(_>=j?v<j-o?I=v-(j-o):p>o&&(I=p-o):v>j+o?I=v-(j+o):p<-o&&(I=p+o),k>=N?y<N-o?U=y-(N-o):g>o&&(U=g-o):y>N+o?U=y-(N+o):g<-o&&(U=g+o),I||U){var D=this.viewportToFramedGraph({x:0,y:0},{cameraState:e}),R=this.viewportToFramedGraph({x:I,y:U},{cameraState:e});I=R.x-D.x,U=R.y-D.y,l.x+=I,l.y+=U}return l}},{key:"renderLabels",value:function(){if(!this.settings.renderLabels)return this;var e=this.camera.getState(),t=this.labelGrid.getLabelsToDisplay(e.ratio,this.settings.labelDensity);en(t,this.nodesWithForcedLabels),this.displayedNodeLabels=new Set;for(var s=this.canvasContexts.labels,o=0,a=t.length;o<a;o++){var l=t[o],u=this.nodeDataCache[l];if(!this.displayedNodeLabels.has(l)&&!u.hidden){var d=this.framedGraphToViewport(u),h=d.x,f=d.y,b=this.scaleSize(u.size);if(!(!u.forceLabel&&b<this.settings.labelRenderedSizeThreshold)&&!(h<-an||h>this.width+an||f<-on||f>this.height+on)){this.displayedNodeLabels.add(l);var C=this.settings.defaultDrawNodeLabel,m=this.nodePrograms[u.type],w=m?.drawLabel||C;w(s,ee(ee({key:l},u),{},{size:b,x:h,y:f}),this.settings)}}}return this}},{key:"renderEdgeLabels",value:function(){if(!this.settings.renderEdgeLabels)return this;var e=this.canvasContexts.edgeLabels;e.clearRect(0,0,this.width,this.height);var t=No({graph:this.graph,hoveredNode:this.hoveredNode,displayedNodeLabels:this.displayedNodeLabels,highlightedNodes:this.highlightedNodes});en(t,this.edgesWithForcedLabels);for(var s=new Set,o=0,a=t.length;o<a;o++){var l=t[o],u=this.graph.extremities(l),d=this.nodeDataCache[u[0]],h=this.nodeDataCache[u[1]],f=this.edgeDataCache[l];if(!s.has(l)&&!(f.hidden||d.hidden||h.hidden)){var b=this.settings.defaultDrawEdgeLabel,C=this.edgePrograms[f.type],m=C?.drawLabel||b;m(e,ee(ee({key:l},f),{},{size:this.scaleSize(f.size)}),ee(ee(ee({key:u[0]},d),this.framedGraphToViewport(d)),{},{size:this.scaleSize(d.size)}),ee(ee(ee({key:u[1]},h),this.framedGraphToViewport(h)),{},{size:this.scaleSize(h.size)}),this.settings),s.add(l)}}return this.displayedEdgeLabels=s,this}},{key:"renderHighlightedNodes",value:function(){var e=this,t=this.canvasContexts.hovers;t.clearRect(0,0,this.width,this.height);var s=function(b){var C=e.nodeDataCache[b],m=e.framedGraphToViewport(C),w=m.x,p=m.y,v=e.scaleSize(C.size),g=e.settings.defaultDrawNodeHover,y=e.nodePrograms[C.type],_=y?.drawHover||g;_(t,ee(ee({key:b},C),{},{size:v,x:w,y:p}),e.settings)},o=[];this.hoveredNode&&!this.nodeDataCache[this.hoveredNode].hidden&&o.push(this.hoveredNode),this.highlightedNodes.forEach(function(f){f!==e.hoveredNode&&o.push(f)}),o.forEach(function(f){return s(f)});var a={};o.forEach(function(f){var b=e.nodeDataCache[f].type;a[b]=(a[b]||0)+1});for(var l in this.nodeHoverPrograms)this.nodeHoverPrograms[l].reallocate(a[l]||0),a[l]=0;o.forEach(function(f){var b=e.nodeDataCache[f];e.nodeHoverPrograms[b.type].process(0,a[b.type]++,b)}),this.webGLContexts.hoverNodes.clear(this.webGLContexts.hoverNodes.COLOR_BUFFER_BIT);var u=this.getRenderParams();for(var d in this.nodeHoverPrograms){var h=this.nodeHoverPrograms[d];h.render(u)}}},{key:"scheduleHighlightedNodesRender",value:function(){var e=this;this.renderHighlightedNodesFrame||this.renderFrame||(this.renderHighlightedNodesFrame=requestAnimationFrame(function(){e.renderHighlightedNodesFrame=null,e.renderHighlightedNodes(),e.renderEdgeLabels()}))}},{key:"render",value:function(){var e=this;this.emit("beforeRender");var t=function(){return e.emit("afterRender"),e};if(this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.resize(),this.needToProcess&&this.process(),this.needToProcess=!1,this.clear(),this.pickingLayers.forEach(function(w){return e.resetWebGLTexture(w)}),!this.graph.order)return t();var s=this.mouseCaptor,o=this.camera.isAnimated()||s.isMoving||s.draggedEvents||s.currentWheelDirection,a=this.camera.getState(),l=this.getDimensions(),u=this.getGraphDimensions(),d=this.getStagePadding();this.matrix=Je(a,l,u,d),this.invMatrix=Je(a,l,u,d,!0),this.correctionRatio=co(this.matrix,a,l),this.graphToViewportRatio=this.getGraphToViewportRatio();var h=this.getRenderParams();for(var f in this.nodePrograms){var b=this.nodePrograms[f];b.render(h)}if(!this.settings.hideEdgesOnMove||!o)for(var C in this.edgePrograms){var m=this.edgePrograms[C];m.render(h)}return this.settings.hideLabelsOnMove&&o||(this.renderLabels(),this.renderEdgeLabels(),this.renderHighlightedNodes()),t()}},{key:"addNode",value:function(e){var t=Object.assign({},this.graph.getNodeAttributes(e));this.settings.nodeReducer&&(t=this.settings.nodeReducer(e,t));var s=jo(this.settings,e,t);this.nodeDataCache[e]=s,this.nodesWithForcedLabels.delete(e),s.forceLabel&&!s.hidden&&this.nodesWithForcedLabels.add(e),this.highlightedNodes.delete(e),s.highlighted&&!s.hidden&&this.highlightedNodes.add(e),this.settings.zIndex&&(s.zIndex<this.nodeZExtent[0]&&(this.nodeZExtent[0]=s.zIndex),s.zIndex>this.nodeZExtent[1]&&(this.nodeZExtent[1]=s.zIndex))}},{key:"updateNode",value:function(e){this.addNode(e);var t=this.nodeDataCache[e];this.normalizationFunction.applyTo(t)}},{key:"removeNode",value:function(e){delete this.nodeDataCache[e],delete this.nodeProgramIndex[e],this.highlightedNodes.delete(e),this.hoveredNode===e&&(this.hoveredNode=null),this.nodesWithForcedLabels.delete(e)}},{key:"addEdge",value:function(e){var t=Object.assign({},this.graph.getEdgeAttributes(e));this.settings.edgeReducer&&(t=this.settings.edgeReducer(e,t));var s=Ao(this.settings,e,t);this.edgeDataCache[e]=s,this.edgesWithForcedLabels.delete(e),s.forceLabel&&!s.hidden&&this.edgesWithForcedLabels.add(e),this.settings.zIndex&&(s.zIndex<this.edgeZExtent[0]&&(this.edgeZExtent[0]=s.zIndex),s.zIndex>this.edgeZExtent[1]&&(this.edgeZExtent[1]=s.zIndex))}},{key:"updateEdge",value:function(e){this.addEdge(e)}},{key:"removeEdge",value:function(e){delete this.edgeDataCache[e],delete this.edgeProgramIndex[e],this.hoveredEdge===e&&(this.hoveredEdge=null),this.edgesWithForcedLabels.delete(e)}},{key:"clearNodeIndices",value:function(){this.labelGrid=new sn,this.nodeExtent={x:[0,1],y:[0,1]},this.nodeDataCache={},this.edgeProgramIndex={},this.nodesWithForcedLabels=new Set,this.nodeZExtent=[1/0,-1/0],this.highlightedNodes=new Set}},{key:"clearEdgeIndices",value:function(){this.edgeDataCache={},this.edgeProgramIndex={},this.edgesWithForcedLabels=new Set,this.edgeZExtent=[1/0,-1/0]}},{key:"clearIndices",value:function(){this.clearEdgeIndices(),this.clearNodeIndices()}},{key:"clearNodeState",value:function(){this.displayedNodeLabels=new Set,this.highlightedNodes=new Set,this.hoveredNode=null}},{key:"clearEdgeState",value:function(){this.displayedEdgeLabels=new Set,this.highlightedNodes=new Set,this.hoveredEdge=null}},{key:"clearState",value:function(){this.clearEdgeState(),this.clearNodeState()}},{key:"addNodeToProgram",value:function(e,t,s){var o=this.nodeDataCache[e],a=this.nodePrograms[o.type];if(!a)throw new Error('Sigma: could not find a suitable program for node type "'.concat(o.type,'"!'));a.process(t,s,o),this.nodeProgramIndex[e]=s}},{key:"addEdgeToProgram",value:function(e,t,s){var o=this.edgeDataCache[e],a=this.edgePrograms[o.type];if(!a)throw new Error('Sigma: could not find a suitable program for edge type "'.concat(o.type,'"!'));var l=this.graph.extremities(e),u=this.nodeDataCache[l[0]],d=this.nodeDataCache[l[1]];a.process(t,s,u,d,o),this.edgeProgramIndex[e]=s}},{key:"getRenderParams",value:function(){return{matrix:this.matrix,invMatrix:this.invMatrix,width:this.width,height:this.height,pixelRatio:this.pixelRatio,zoomRatio:this.camera.ratio,cameraAngle:this.camera.angle,sizeRatio:1/this.scaleSize(),correctionRatio:this.correctionRatio,downSizingRatio:this.pickingDownSizingRatio,minEdgeThickness:this.settings.minEdgeThickness,antiAliasingFeather:this.settings.antiAliasingFeather}}},{key:"getStagePadding",value:function(){var e=this.settings,t=e.stagePadding,s=e.autoRescale;return s&&t||0}},{key:"createLayer",value:function(e,t){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.elements[e])throw new Error('Sigma: a layer named "'.concat(e,'" already exists'));var o=fo(t,{position:"absolute"},{class:"sigma-".concat(e)});return s.style&&Object.assign(o.style,s.style),this.elements[e]=o,"beforeLayer"in s&&s.beforeLayer?this.elements[s.beforeLayer].before(o):"afterLayer"in s&&s.afterLayer?this.elements[s.afterLayer].after(o):this.container.appendChild(o),o}},{key:"createCanvas",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.createLayer(e,"canvas",t)}},{key:"createCanvasContext",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.createCanvas(e,t),o={preserveDrawingBuffer:!1,antialias:!1};return this.canvasContexts[e]=s.getContext("2d",o),this}},{key:"createWebGLContext",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t?.canvas||this.createCanvas(e,t);t.hidden&&s.remove();var o=ee({preserveDrawingBuffer:!1,antialias:!1},t),a;a=s.getContext("webgl2",o),a||(a=s.getContext("webgl",o)),a||(a=s.getContext("experimental-webgl",o));var l=a;if(this.webGLContexts[e]=l,l.blendFunc(l.ONE,l.ONE_MINUS_SRC_ALPHA),t.picking){this.pickingLayers.add(e);var u=l.createFramebuffer();if(!u)throw new Error("Sigma: cannot create a new frame buffer for layer ".concat(e));this.frameBuffers[e]=u}return l}},{key:"killLayer",value:function(e){var t=this.elements[e];if(!t)throw new Error("Sigma: cannot kill layer ".concat(e,", which does not exist"));if(this.webGLContexts[e]){var s,o=this.webGLContexts[e];(s=o.getExtension("WEBGL_lose_context"))===null||s===void 0||s.loseContext(),delete this.webGLContexts[e]}else this.canvasContexts[e]&&delete this.canvasContexts[e];return t.remove(),delete this.elements[e],this}},{key:"getCamera",value:function(){return this.camera}},{key:"setCamera",value:function(e){this.unbindCameraHandlers(),this.camera=e,this.bindCameraHandlers()}},{key:"getContainer",value:function(){return this.container}},{key:"getGraph",value:function(){return this.graph}},{key:"setGraph",value:function(e){e!==this.graph&&(this.hoveredNode&&!e.hasNode(this.hoveredNode)&&(this.hoveredNode=null),this.hoveredEdge&&!e.hasEdge(this.hoveredEdge)&&(this.hoveredEdge=null),this.unbindGraphHandlers(),this.checkEdgesEventsFrame!==null&&(cancelAnimationFrame(this.checkEdgesEventsFrame),this.checkEdgesEventsFrame=null),this.graph=e,this.bindGraphHandlers(),this.refresh())}},{key:"getMouseCaptor",value:function(){return this.mouseCaptor}},{key:"getTouchCaptor",value:function(){return this.touchCaptor}},{key:"getDimensions",value:function(){return{width:this.width,height:this.height}}},{key:"getGraphDimensions",value:function(){var e=this.customBBox||this.nodeExtent;return{width:e.x[1]-e.x[0]||1,height:e.y[1]-e.y[0]||1}}},{key:"getNodeDisplayData",value:function(e){var t=this.nodeDataCache[e];return t?Object.assign({},t):void 0}},{key:"getEdgeDisplayData",value:function(e){var t=this.edgeDataCache[e];return t?Object.assign({},t):void 0}},{key:"getNodeDisplayedLabels",value:function(){return new Set(this.displayedNodeLabels)}},{key:"getEdgeDisplayedLabels",value:function(){return new Set(this.displayedEdgeLabels)}},{key:"getSettings",value:function(){return ee({},this.settings)}},{key:"getSetting",value:function(e){return this.settings[e]}},{key:"setSetting",value:function(e,t){var s=ee({},this.settings);return this.settings[e]=t,Wt(this.settings),this.handleSettingsUpdate(s),this.scheduleRefresh(),this}},{key:"updateSetting",value:function(e,t){return this.setSetting(e,t(this.settings[e])),this}},{key:"setSettings",value:function(e){var t=ee({},this.settings);return this.settings=ee(ee({},this.settings),e),Wt(this.settings),this.handleSettingsUpdate(t),this.scheduleRefresh(),this}},{key:"resize",value:function(e){var t=this.width,s=this.height;if(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.pixelRatio=Kr(),this.width===0)if(this.settings.allowInvalidContainer)this.width=1;else throw new Error("Sigma: Container has no width. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(this.height===0)if(this.settings.allowInvalidContainer)this.height=1;else throw new Error("Sigma: Container has no height. You can set the allowInvalidContainer setting to true to stop seeing this error.");if(!e&&t===this.width&&s===this.height)return this;for(var o in this.elements){var a=this.elements[o];a.style.width=this.width+"px",a.style.height=this.height+"px"}for(var l in this.canvasContexts)this.elements[l].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[l].setAttribute("height",this.height*this.pixelRatio+"px"),this.pixelRatio!==1&&this.canvasContexts[l].scale(this.pixelRatio,this.pixelRatio);for(var u in this.webGLContexts){this.elements[u].setAttribute("width",this.width*this.pixelRatio+"px"),this.elements[u].setAttribute("height",this.height*this.pixelRatio+"px");var d=this.webGLContexts[u];if(d.viewport(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.pickingLayers.has(u)){var h=this.textures[u];h&&d.deleteTexture(h)}}return this.emit("resize"),this}},{key:"clear",value:function(){return this.emit("beforeClear"),this.webGLContexts.nodes.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.nodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.edges.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.webGLContexts.edges.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.webGLContexts.hoverNodes.clear(WebGLRenderingContext.COLOR_BUFFER_BIT),this.canvasContexts.labels.clearRect(0,0,this.width,this.height),this.canvasContexts.hovers.clearRect(0,0,this.width,this.height),this.canvasContexts.edgeLabels.clearRect(0,0,this.width,this.height),this.emit("afterClear"),this}},{key:"refresh",value:function(e){var t=this,s=e?.skipIndexation!==void 0?e?.skipIndexation:!1,o=e?.schedule!==void 0?e.schedule:!1,a=!e||!e.partialGraph;if(a)this.clearEdgeIndices(),this.clearNodeIndices(),this.graph.forEachNode(function(y){return t.addNode(y)}),this.graph.forEachEdge(function(y){return t.addEdge(y)});else{for(var l,u,d=((l=e.partialGraph)===null||l===void 0?void 0:l.nodes)||[],h=0,f=d?.length||0;h<f;h++){var b=d[h];if(this.updateNode(b),s){var C=this.nodeProgramIndex[b];if(C===void 0)throw new Error('Sigma: node "'.concat(b,`" can't be repaint`));this.addNodeToProgram(b,this.nodeIndices[b],C)}}for(var m=(e==null||(u=e.partialGraph)===null||u===void 0?void 0:u.edges)||[],w=0,p=m.length;w<p;w++){var v=m[w];if(this.updateEdge(v),s){var g=this.edgeProgramIndex[v];if(g===void 0)throw new Error('Sigma: edge "'.concat(v,`" can't be repaint`));this.addEdgeToProgram(v,this.edgeIndices[v],g)}}}return(a||!s)&&(this.needToProcess=!0),o?this.scheduleRender():this.render(),this}},{key:"scheduleRender",value:function(){var e=this;return this.renderFrame||(this.renderFrame=requestAnimationFrame(function(){e.render()})),this}},{key:"scheduleRefresh",value:function(e){return this.refresh(ee(ee({},e),{},{schedule:!0}))}},{key:"getViewportZoomedState",value:function(e,t){var s=this.camera.getState(),o=s.ratio,a=s.angle,l=s.x,u=s.y,d=this.settings,h=d.minCameraRatio,f=d.maxCameraRatio;typeof f=="number"&&(t=Math.min(t,f)),typeof h=="number"&&(t=Math.max(t,h));var b=t/o,C={x:this.width/2,y:this.height/2},m=this.viewportToFramedGraph(e),w=this.viewportToFramedGraph(C);return{angle:a,x:(m.x-w.x)*(1-b)+l,y:(m.y-w.y)*(1-b)+u,ratio:t}}},{key:"viewRectangle",value:function(){var e=this.viewportToFramedGraph({x:0,y:0}),t=this.viewportToFramedGraph({x:this.width,y:0}),s=this.viewportToFramedGraph({x:0,y:this.height});return{x1:e.x,y1:e.y,x2:t.x,y2:t.y,height:t.y-s.y}}},{key:"framedGraphToViewport",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=!!t.cameraState||!!t.viewportDimensions||!!t.graphDimensions,o=t.matrix?t.matrix:s?Je(t.cameraState||this.camera.getState(),t.viewportDimensions||this.getDimensions(),t.graphDimensions||this.getGraphDimensions(),t.padding||this.getStagePadding()):this.matrix,a=Er(o,e);return{x:(1+a.x)*this.width/2,y:(1-a.y)*this.height/2}}},{key:"viewportToFramedGraph",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=!!t.cameraState||!!t.viewportDimensions||!t.graphDimensions,o=t.matrix?t.matrix:s?Je(t.cameraState||this.camera.getState(),t.viewportDimensions||this.getDimensions(),t.graphDimensions||this.getGraphDimensions(),t.padding||this.getStagePadding(),!0):this.invMatrix,a=Er(o,{x:e.x/this.width*2-1,y:1-e.y/this.height*2});return isNaN(a.x)&&(a.x=0),isNaN(a.y)&&(a.y=0),a}},{key:"viewportToGraph",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.normalizationFunction.inverse(this.viewportToFramedGraph(e,t))}},{key:"graphToViewport",value:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.framedGraphToViewport(this.normalizationFunction(e),t)}},{key:"getGraphToViewportRatio",value:function(){var e={x:0,y:0},t={x:1,y:1},s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=this.graphToViewport(e),a=this.graphToViewport(t),l=Math.sqrt(Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2));return l/s}},{key:"getBBox",value:function(){return this.nodeExtent}},{key:"getCustomBBox",value:function(){return this.customBBox}},{key:"setCustomBBox",value:function(e){return this.customBBox=e,this.scheduleRender(),this}},{key:"kill",value:function(){this.emit("kill"),this.removeAllListeners(),this.unbindCameraHandlers(),window.removeEventListener("resize",this.activeListeners.handleResize),this.mouseCaptor.kill(),this.touchCaptor.kill(),this.unbindGraphHandlers(),this.clearIndices(),this.clearState(),this.nodeDataCache={},this.edgeDataCache={},this.highlightedNodes.clear(),this.renderFrame&&(cancelAnimationFrame(this.renderFrame),this.renderFrame=null),this.renderHighlightedNodesFrame&&(cancelAnimationFrame(this.renderHighlightedNodesFrame),this.renderHighlightedNodesFrame=null);for(var e=this.container;e.firstChild;)e.removeChild(e.firstChild);for(var t in this.nodePrograms)this.nodePrograms[t].kill();for(var s in this.nodeHoverPrograms)this.nodeHoverPrograms[s].kill();for(var o in this.edgePrograms)this.edgePrograms[o].kill();this.nodePrograms={},this.nodeHoverPrograms={},this.edgePrograms={};for(var a in this.elements)this.killLayer(a);this.canvasContexts={},this.webGLContexts={},this.elements={}}},{key:"scaleSize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.camera.ratio;return e/this.settings.zoomToSizeRatioFunction(t)*(this.getSetting("itemSizesReference")==="positions"?t*this.graphToViewportRatio:1)}},{key:"getCanvases",value:function(){var e={};for(var t in this.elements)this.elements[t]instanceof HTMLCanvasElement&&(e[t]=this.elements[t]);return e}}])})(jr),Do=Lo,qt,ln;function Io(){return ln||(ln=1,qt=function(){var i,r,e={};(function(){var s=0,o=1,a=2,l=3,u=4,d=5,h=6,f=7,b=8,C=9,m=0,w=1,p=2,v=0,g=1,y=2,_=3,k=4,T=5,j=6,N=7,I=8,U=3,D=10,R=3,F=9,M=10;e.exports=function(E,x,V){var W,L,S,A,z,Z,K,re,$,ae,X=x.length,ne=V.length,J=E.adjustSizes,le=E.barnesHutTheta*E.barnesHutTheta,Y,q,P,se,he,te,Q,O=[];for(S=0;S<X;S+=D)x[S+u]=x[S+a],x[S+d]=x[S+l],x[S+a]=0,x[S+l]=0;if(E.outboundAttractionDistribution){for(Y=0,S=0;S<X;S+=D)Y+=x[S+h];Y/=X/D}if(E.barnesHutOptimize){var me=1/0,ie=-1/0,oe=1/0,ue=-1/0,de,pe,xe;for(S=0;S<X;S+=D)me=Math.min(me,x[S+s]),ie=Math.max(ie,x[S+s]),oe=Math.min(oe,x[S+o]),ue=Math.max(ue,x[S+o]);var be=ie-me,Ee=ue-oe;for(be>Ee?(oe-=(be-Ee)/2,ue=oe+be):(me-=(Ee-be)/2,ie=me+Ee),O[0+v]=-1,O[0+g]=(me+ie)/2,O[0+y]=(oe+ue)/2,O[0+_]=Math.max(ie-me,ue-oe),O[0+k]=-1,O[0+T]=-1,O[0+j]=0,O[0+N]=0,O[0+I]=0,W=1,S=0;S<X;S+=D)for(L=0,xe=U;;)if(O[L+T]>=0){x[S+s]<O[L+g]?x[S+o]<O[L+y]?de=O[L+T]:de=O[L+T]+F:x[S+o]<O[L+y]?de=O[L+T]+F*2:de=O[L+T]+F*3,O[L+N]=(O[L+N]*O[L+j]+x[S+s]*x[S+h])/(O[L+j]+x[S+h]),O[L+I]=(O[L+I]*O[L+j]+x[S+o]*x[S+h])/(O[L+j]+x[S+h]),O[L+j]+=x[S+h],L=de;continue}else if(O[L+v]<0){O[L+v]=S;break}else{if(O[L+T]=W*F,re=O[L+_]/2,$=O[L+T],O[$+v]=-1,O[$+g]=O[L+g]-re,O[$+y]=O[L+y]-re,O[$+_]=re,O[$+k]=$+F,O[$+T]=-1,O[$+j]=0,O[$+N]=0,O[$+I]=0,$+=F,O[$+v]=-1,O[$+g]=O[L+g]-re,O[$+y]=O[L+y]+re,O[$+_]=re,O[$+k]=$+F,O[$+T]=-1,O[$+j]=0,O[$+N]=0,O[$+I]=0,$+=F,O[$+v]=-1,O[$+g]=O[L+g]+re,O[$+y]=O[L+y]-re,O[$+_]=re,O[$+k]=$+F,O[$+T]=-1,O[$+j]=0,O[$+N]=0,O[$+I]=0,$+=F,O[$+v]=-1,O[$+g]=O[L+g]+re,O[$+y]=O[L+y]+re,O[$+_]=re,O[$+k]=O[L+k],O[$+T]=-1,O[$+j]=0,O[$+N]=0,O[$+I]=0,W+=4,x[O[L+v]+s]<O[L+g]?x[O[L+v]+o]<O[L+y]?de=O[L+T]:de=O[L+T]+F:x[O[L+v]+o]<O[L+y]?de=O[L+T]+F*2:de=O[L+T]+F*3,O[L+j]=x[O[L+v]+h],O[L+N]=x[O[L+v]+s],O[L+I]=x[O[L+v]+o],O[de+v]=O[L+v],O[L+v]=-1,x[S+s]<O[L+g]?x[S+o]<O[L+y]?pe=O[L+T]:pe=O[L+T]+F:x[S+o]<O[L+y]?pe=O[L+T]+F*2:pe=O[L+T]+F*3,de===pe)if(xe--){L=de;continue}else{xe=U;break}O[pe+v]=S;break}}if(E.barnesHutOptimize)for(q=E.scalingRatio,S=0;S<X;S+=D)for(L=0;;)if(O[L+T]>=0)if(te=Math.pow(x[S+s]-O[L+N],2)+Math.pow(x[S+o]-O[L+I],2),ae=O[L+_],4*ae*ae/te<le){if(P=x[S+s]-O[L+N],se=x[S+o]-O[L+I],J===!0?te>0?(Q=q*x[S+h]*O[L+j]/te,x[S+a]+=P*Q,x[S+l]+=se*Q):te<0&&(Q=-q*x[S+h]*O[L+j]/Math.sqrt(te),x[S+a]+=P*Q,x[S+l]+=se*Q):te>0&&(Q=q*x[S+h]*O[L+j]/te,x[S+a]+=P*Q,x[S+l]+=se*Q),L=O[L+k],L<0)break;continue}else{L=O[L+T];continue}else{if(Z=O[L+v],Z>=0&&Z!==S&&(P=x[S+s]-x[Z+s],se=x[S+o]-x[Z+o],te=P*P+se*se,J===!0?te>0?(Q=q*x[S+h]*x[Z+h]/te,x[S+a]+=P*Q,x[S+l]+=se*Q):te<0&&(Q=-q*x[S+h]*x[Z+h]/Math.sqrt(te),x[S+a]+=P*Q,x[S+l]+=se*Q):te>0&&(Q=q*x[S+h]*x[Z+h]/te,x[S+a]+=P*Q,x[S+l]+=se*Q)),L=O[L+k],L<0)break;continue}else for(q=E.scalingRatio,A=0;A<X;A+=D)for(z=0;z<A;z+=D)P=x[A+s]-x[z+s],se=x[A+o]-x[z+o],J===!0?(te=Math.sqrt(P*P+se*se)-x[A+b]-x[z+b],te>0?(Q=q*x[A+h]*x[z+h]/te/te,x[A+a]+=P*Q,x[A+l]+=se*Q,x[z+a]-=P*Q,x[z+l]-=se*Q):te<0&&(Q=100*q*x[A+h]*x[z+h],x[A+a]+=P*Q,x[A+l]+=se*Q,x[z+a]-=P*Q,x[z+l]-=se*Q)):(te=Math.sqrt(P*P+se*se),te>0&&(Q=q*x[A+h]*x[z+h]/te/te,x[A+a]+=P*Q,x[A+l]+=se*Q,x[z+a]-=P*Q,x[z+l]-=se*Q));for($=E.gravity/E.scalingRatio,q=E.scalingRatio,S=0;S<X;S+=D)Q=0,P=x[S+s],se=x[S+o],te=Math.sqrt(Math.pow(P,2)+Math.pow(se,2)),E.strongGravityMode?te>0&&(Q=q*x[S+h]*$):te>0&&(Q=q*x[S+h]*$/te),x[S+a]-=P*Q,x[S+l]-=se*Q;for(q=1*(E.outboundAttractionDistribution?Y:1),K=0;K<ne;K+=R)A=V[K+m],z=V[K+w],re=V[K+p],he=Math.pow(re,E.edgeWeightInfluence),P=x[A+s]-x[z+s],se=x[A+o]-x[z+o],J===!0?(te=Math.sqrt(P*P+se*se)-x[A+b]-x[z+b],E.linLogMode?E.outboundAttractionDistribution?te>0&&(Q=-q*he*Math.log(1+te)/te/x[A+h]):te>0&&(Q=-q*he*Math.log(1+te)/te):E.outboundAttractionDistribution?te>0&&(Q=-q*he/x[A+h]):te>0&&(Q=-q*he)):(te=Math.sqrt(Math.pow(P,2)+Math.pow(se,2)),E.linLogMode?E.outboundAttractionDistribution?te>0&&(Q=-q*he*Math.log(1+te)/te/x[A+h]):te>0&&(Q=-q*he*Math.log(1+te)/te):E.outboundAttractionDistribution?(te=1,Q=-q*he/x[A+h]):(te=1,Q=-q*he)),te>0&&(x[A+a]+=P*Q,x[A+l]+=se*Q,x[z+a]-=P*Q,x[z+l]-=se*Q);var Te,Xe,ut,Fe,ht,dt;if(J===!0)for(S=0;S<X;S+=D)x[S+C]!==1&&(Te=Math.sqrt(Math.pow(x[S+a],2)+Math.pow(x[S+l],2)),Te>M&&(x[S+a]=x[S+a]*M/Te,x[S+l]=x[S+l]*M/Te),Xe=x[S+h]*Math.sqrt((x[S+u]-x[S+a])*(x[S+u]-x[S+a])+(x[S+d]-x[S+l])*(x[S+d]-x[S+l])),ut=Math.sqrt((x[S+u]+x[S+a])*(x[S+u]+x[S+a])+(x[S+d]+x[S+l])*(x[S+d]+x[S+l]))/2,Fe=.1*Math.log(1+ut)/(1+Math.sqrt(Xe)),ht=x[S+s]+x[S+a]*(Fe/E.slowDown),x[S+s]=ht,dt=x[S+o]+x[S+l]*(Fe/E.slowDown),x[S+o]=dt);else for(S=0;S<X;S+=D)x[S+C]!==1&&(Xe=x[S+h]*Math.sqrt((x[S+u]-x[S+a])*(x[S+u]-x[S+a])+(x[S+d]-x[S+l])*(x[S+d]-x[S+l])),ut=Math.sqrt((x[S+u]+x[S+a])*(x[S+u]+x[S+a])+(x[S+d]+x[S+l])*(x[S+d]+x[S+l]))/2,Fe=x[S+f]*Math.log(1+ut)/(1+Math.sqrt(Xe)),x[S+f]=Math.min(1,Math.sqrt(Fe*(Math.pow(x[S+a],2)+Math.pow(x[S+l],2))/(1+Math.sqrt(Xe)))),ht=x[S+s]+x[S+a]*(Fe/E.slowDown),x[S+s]=ht,dt=x[S+o]+x[S+l]*(Fe/E.slowDown),x[S+o]=dt);return{}}})();var t=e.exports;self.addEventListener("message",function(s){var o=s.data;i=new Float32Array(o.nodes),o.edges&&(r=new Float32Array(o.edges)),t(o.settings,i,r),self.postMessage({nodes:i.buffer},[i.buffer])})}),qt}var Ae={},cn;function Ri(){if(cn)return Ae;cn=1;var n=10,i=3;return Ae.assign=function(r){r=r||{};var e=Array.prototype.slice.call(arguments).slice(1),t,s,o;for(t=0,o=e.length;t<o;t++)if(e[t])for(s in e[t])r[s]=e[t][s];return r},Ae.validateSettings=function(r){return"linLogMode"in r&&typeof r.linLogMode!="boolean"?{message:"the `linLogMode` setting should be a boolean."}:"outboundAttractionDistribution"in r&&typeof r.outboundAttractionDistribution!="boolean"?{message:"the `outboundAttractionDistribution` setting should be a boolean."}:"adjustSizes"in r&&typeof r.adjustSizes!="boolean"?{message:"the `adjustSizes` setting should be a boolean."}:"edgeWeightInfluence"in r&&typeof r.edgeWeightInfluence!="number"?{message:"the `edgeWeightInfluence` setting should be a number."}:"scalingRatio"in r&&!(typeof r.scalingRatio=="number"&&r.scalingRatio>=0)?{message:"the `scalingRatio` setting should be a number >= 0."}:"strongGravityMode"in r&&typeof r.strongGravityMode!="boolean"?{message:"the `strongGravityMode` setting should be a boolean."}:"gravity"in r&&!(typeof r.gravity=="number"&&r.gravity>=0)?{message:"the `gravity` setting should be a number >= 0."}:"slowDown"in r&&!(typeof r.slowDown=="number"||r.slowDown>=0)?{message:"the `slowDown` setting should be a number >= 0."}:"barnesHutOptimize"in r&&typeof r.barnesHutOptimize!="boolean"?{message:"the `barnesHutOptimize` setting should be a boolean."}:"barnesHutTheta"in r&&!(typeof r.barnesHutTheta=="number"&&r.barnesHutTheta>=0)?{message:"the `barnesHutTheta` setting should be a number >= 0."}:null},Ae.graphToByteArrays=function(r,e){var t=r.order,s=r.size,o={},a,l=new Float32Array(t*n),u=new Float32Array(s*i);return a=0,r.forEachNode(function(d,h){o[d]=a,l[a]=h.x,l[a+1]=h.y,l[a+2]=0,l[a+3]=0,l[a+4]=0,l[a+5]=0,l[a+6]=1,l[a+7]=1,l[a+8]=h.size||1,l[a+9]=h.fixed?1:0,a+=n}),a=0,r.forEachEdge(function(d,h,f,b,C,m,w){var p=o[f],v=o[b],g=e(d,h,f,b,C,m,w);l[p+6]+=g,l[v+6]+=g,u[a]=p,u[a+1]=v,u[a+2]=g,a+=i}),{nodes:l,edges:u}},Ae.assignLayoutChanges=function(r,e,t){var s=0;r.updateEachNodeAttributes(function(o,a){return a.x=e[s],a.y=e[s+1],s+=n,t?t(o,a):a})},Ae.readGraphPositions=function(r,e){var t=0;r.forEachNode(function(s,o){e[t]=o.x,e[t+1]=o.y,t+=n})},Ae.collectLayoutChanges=function(r,e,t){for(var s=r.nodes(),o={},a=0,l=0,u=e.length;a<u;a+=n){if(t){var d=Object.assign({},r.getNodeAttributes(s[l]));d.x=e[a],d.y=e[a+1],d=t(s[l],d),o[s[l]]={x:d.x,y:d.y}}else o[s[l]]={x:e[a],y:e[a+1]};l++}return o},Ae.createWorker=function(e){var t=window.URL||window.webkitURL,s=e.toString(),o=t.createObjectURL(new Blob(["("+s+").call(this);"],{type:"text/javascript"})),a=new Worker(o);return t.revokeObjectURL(o),a},Ae}var Vt,un;function _i(){return un||(un=1,Vt={linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:1,scalingRatio:1,strongGravityMode:!1,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5}),Vt}var $t,hn;function Po(){if(hn)return $t;hn=1;var n=Io(),i=je(),r=lt().createEdgeWeightGetter,e=Ri(),t=_i();function s(o,a){if(a=a||{},!i(o))throw new Error("graphology-layout-forceatlas2/worker: the given graph is not a valid graphology instance.");var l=r("getEdgeWeight"in a?a.getEdgeWeight:"weight").fromEntry,u=e.assign({},t,a.settings),d=e.validateSettings(u);if(d)throw new Error("graphology-layout-forceatlas2/worker: "+d.message);this.worker=null,this.graph=o,this.settings=u,this.getEdgeWeight=l,this.matrices=null,this.running=!1,this.killed=!1,this.outputReducer=typeof a.outputReducer=="function"?a.outputReducer:null,this.handleMessage=this.handleMessage.bind(this);var h=void 0,f=this;this.handleGraphUpdate=function(){f.worker&&f.worker.terminate(),h&&clearTimeout(h),h=setTimeout(function(){h=void 0,f.spawnWorker()},0)},o.on("nodeAdded",this.handleGraphUpdate),o.on("edgeAdded",this.handleGraphUpdate),o.on("nodeDropped",this.handleGraphUpdate),o.on("edgeDropped",this.handleGraphUpdate),this.spawnWorker()}return s.prototype.isRunning=function(){return this.running},s.prototype.spawnWorker=function(){this.worker&&this.worker.terminate(),this.worker=e.createWorker(n),this.worker.addEventListener("message",this.handleMessage),this.running&&(this.running=!1,this.start())},s.prototype.handleMessage=function(o){if(this.running){var a=new Float32Array(o.data.nodes);e.assignLayoutChanges(this.graph,a,this.outputReducer),this.outputReducer&&e.readGraphPositions(this.graph,a),this.matrices.nodes=a,this.askForIterations()}},s.prototype.askForIterations=function(o){var a=this.matrices,l={settings:this.settings,nodes:a.nodes.buffer},u=[a.nodes.buffer];return o&&(l.edges=a.edges.buffer,u.push(a.edges.buffer)),this.worker.postMessage(l,u),this},s.prototype.start=function(){if(this.killed)throw new Error("graphology-layout-forceatlas2/worker.start: layout was killed.");return this.running?this:(this.matrices=e.graphToByteArrays(this.graph,this.getEdgeWeight),this.running=!0,this.askForIterations(!0),this)},s.prototype.stop=function(){return this.running=!1,this},s.prototype.kill=function(){if(this.killed)return this;this.running=!1,this.killed=!0,this.matrices=null,this.worker.terminate(),this.graph.removeListener("nodeAdded",this.handleGraphUpdate),this.graph.removeListener("edgeAdded",this.handleGraphUpdate),this.graph.removeListener("nodeDropped",this.handleGraphUpdate),this.graph.removeListener("edgeDropped",this.handleGraphUpdate)},$t=s,$t}var Fo=Po();const zo=st(Fo);var Yt,dn;function Oo(){if(dn)return Yt;dn=1;var n=0,i=1,r=2,e=3,t=4,s=5,o=6,a=7,l=8,u=9,d=0,h=1,f=2,b=0,C=1,m=2,w=3,p=4,v=5,g=6,y=7,_=8,k=3,T=10,j=3,N=9,I=10;return Yt=function(D,R,F){var M,G,E,x,V,W,L,S,A,z,Z=R.length,K=F.length,re=D.adjustSizes,$=D.barnesHutTheta*D.barnesHutTheta,ae,X,ne,J,le,Y,q,P=[];for(E=0;E<Z;E+=T)R[E+t]=R[E+r],R[E+s]=R[E+e],R[E+r]=0,R[E+e]=0;if(D.outboundAttractionDistribution){for(ae=0,E=0;E<Z;E+=T)ae+=R[E+o];ae/=Z/T}if(D.barnesHutOptimize){var se=1/0,he=-1/0,te=1/0,Q=-1/0,O,me,ie;for(E=0;E<Z;E+=T)se=Math.min(se,R[E+n]),he=Math.max(he,R[E+n]),te=Math.min(te,R[E+i]),Q=Math.max(Q,R[E+i]);var oe=he-se,ue=Q-te;for(oe>ue?(te-=(oe-ue)/2,Q=te+oe):(se-=(ue-oe)/2,he=se+ue),P[0+b]=-1,P[0+C]=(se+he)/2,P[0+m]=(te+Q)/2,P[0+w]=Math.max(he-se,Q-te),P[0+p]=-1,P[0+v]=-1,P[0+g]=0,P[0+y]=0,P[0+_]=0,M=1,E=0;E<Z;E+=T)for(G=0,ie=k;;)if(P[G+v]>=0){R[E+n]<P[G+C]?R[E+i]<P[G+m]?O=P[G+v]:O=P[G+v]+N:R[E+i]<P[G+m]?O=P[G+v]+N*2:O=P[G+v]+N*3,P[G+y]=(P[G+y]*P[G+g]+R[E+n]*R[E+o])/(P[G+g]+R[E+o]),P[G+_]=(P[G+_]*P[G+g]+R[E+i]*R[E+o])/(P[G+g]+R[E+o]),P[G+g]+=R[E+o],G=O;continue}else if(P[G+b]<0){P[G+b]=E;break}else{if(P[G+v]=M*N,S=P[G+w]/2,A=P[G+v],P[A+b]=-1,P[A+C]=P[G+C]-S,P[A+m]=P[G+m]-S,P[A+w]=S,P[A+p]=A+N,P[A+v]=-1,P[A+g]=0,P[A+y]=0,P[A+_]=0,A+=N,P[A+b]=-1,P[A+C]=P[G+C]-S,P[A+m]=P[G+m]+S,P[A+w]=S,P[A+p]=A+N,P[A+v]=-1,P[A+g]=0,P[A+y]=0,P[A+_]=0,A+=N,P[A+b]=-1,P[A+C]=P[G+C]+S,P[A+m]=P[G+m]-S,P[A+w]=S,P[A+p]=A+N,P[A+v]=-1,P[A+g]=0,P[A+y]=0,P[A+_]=0,A+=N,P[A+b]=-1,P[A+C]=P[G+C]+S,P[A+m]=P[G+m]+S,P[A+w]=S,P[A+p]=P[G+p],P[A+v]=-1,P[A+g]=0,P[A+y]=0,P[A+_]=0,M+=4,R[P[G+b]+n]<P[G+C]?R[P[G+b]+i]<P[G+m]?O=P[G+v]:O=P[G+v]+N:R[P[G+b]+i]<P[G+m]?O=P[G+v]+N*2:O=P[G+v]+N*3,P[G+g]=R[P[G+b]+o],P[G+y]=R[P[G+b]+n],P[G+_]=R[P[G+b]+i],P[O+b]=P[G+b],P[G+b]=-1,R[E+n]<P[G+C]?R[E+i]<P[G+m]?me=P[G+v]:me=P[G+v]+N:R[E+i]<P[G+m]?me=P[G+v]+N*2:me=P[G+v]+N*3,O===me)if(ie--){G=O;continue}else{ie=k;break}P[me+b]=E;break}}if(D.barnesHutOptimize)for(X=D.scalingRatio,E=0;E<Z;E+=T)for(G=0;;)if(P[G+v]>=0)if(Y=Math.pow(R[E+n]-P[G+y],2)+Math.pow(R[E+i]-P[G+_],2),z=P[G+w],4*z*z/Y<$){if(ne=R[E+n]-P[G+y],J=R[E+i]-P[G+_],re===!0?Y>0?(q=X*R[E+o]*P[G+g]/Y,R[E+r]+=ne*q,R[E+e]+=J*q):Y<0&&(q=-X*R[E+o]*P[G+g]/Math.sqrt(Y),R[E+r]+=ne*q,R[E+e]+=J*q):Y>0&&(q=X*R[E+o]*P[G+g]/Y,R[E+r]+=ne*q,R[E+e]+=J*q),G=P[G+p],G<0)break;continue}else{G=P[G+v];continue}else{if(W=P[G+b],W>=0&&W!==E&&(ne=R[E+n]-R[W+n],J=R[E+i]-R[W+i],Y=ne*ne+J*J,re===!0?Y>0?(q=X*R[E+o]*R[W+o]/Y,R[E+r]+=ne*q,R[E+e]+=J*q):Y<0&&(q=-X*R[E+o]*R[W+o]/Math.sqrt(Y),R[E+r]+=ne*q,R[E+e]+=J*q):Y>0&&(q=X*R[E+o]*R[W+o]/Y,R[E+r]+=ne*q,R[E+e]+=J*q)),G=P[G+p],G<0)break;continue}else for(X=D.scalingRatio,x=0;x<Z;x+=T)for(V=0;V<x;V+=T)ne=R[x+n]-R[V+n],J=R[x+i]-R[V+i],re===!0?(Y=Math.sqrt(ne*ne+J*J)-R[x+l]-R[V+l],Y>0?(q=X*R[x+o]*R[V+o]/Y/Y,R[x+r]+=ne*q,R[x+e]+=J*q,R[V+r]-=ne*q,R[V+e]-=J*q):Y<0&&(q=100*X*R[x+o]*R[V+o],R[x+r]+=ne*q,R[x+e]+=J*q,R[V+r]-=ne*q,R[V+e]-=J*q)):(Y=Math.sqrt(ne*ne+J*J),Y>0&&(q=X*R[x+o]*R[V+o]/Y/Y,R[x+r]+=ne*q,R[x+e]+=J*q,R[V+r]-=ne*q,R[V+e]-=J*q));for(A=D.gravity/D.scalingRatio,X=D.scalingRatio,E=0;E<Z;E+=T)q=0,ne=R[E+n],J=R[E+i],Y=Math.sqrt(Math.pow(ne,2)+Math.pow(J,2)),D.strongGravityMode?Y>0&&(q=X*R[E+o]*A):Y>0&&(q=X*R[E+o]*A/Y),R[E+r]-=ne*q,R[E+e]-=J*q;for(X=1*(D.outboundAttractionDistribution?ae:1),L=0;L<K;L+=j)x=F[L+d],V=F[L+h],S=F[L+f],le=Math.pow(S,D.edgeWeightInfluence),ne=R[x+n]-R[V+n],J=R[x+i]-R[V+i],re===!0?(Y=Math.sqrt(ne*ne+J*J)-R[x+l]-R[V+l],D.linLogMode?D.outboundAttractionDistribution?Y>0&&(q=-X*le*Math.log(1+Y)/Y/R[x+o]):Y>0&&(q=-X*le*Math.log(1+Y)/Y):D.outboundAttractionDistribution?Y>0&&(q=-X*le/R[x+o]):Y>0&&(q=-X*le)):(Y=Math.sqrt(Math.pow(ne,2)+Math.pow(J,2)),D.linLogMode?D.outboundAttractionDistribution?Y>0&&(q=-X*le*Math.log(1+Y)/Y/R[x+o]):Y>0&&(q=-X*le*Math.log(1+Y)/Y):D.outboundAttractionDistribution?(Y=1,q=-X*le/R[x+o]):(Y=1,q=-X*le)),Y>0&&(R[x+r]+=ne*q,R[x+e]+=J*q,R[V+r]-=ne*q,R[V+e]-=J*q);var de,pe,xe,be,Ee,Te;if(re===!0)for(E=0;E<Z;E+=T)R[E+u]!==1&&(de=Math.sqrt(Math.pow(R[E+r],2)+Math.pow(R[E+e],2)),de>I&&(R[E+r]=R[E+r]*I/de,R[E+e]=R[E+e]*I/de),pe=R[E+o]*Math.sqrt((R[E+t]-R[E+r])*(R[E+t]-R[E+r])+(R[E+s]-R[E+e])*(R[E+s]-R[E+e])),xe=Math.sqrt((R[E+t]+R[E+r])*(R[E+t]+R[E+r])+(R[E+s]+R[E+e])*(R[E+s]+R[E+e]))/2,be=.1*Math.log(1+xe)/(1+Math.sqrt(pe)),Ee=R[E+n]+R[E+r]*(be/D.slowDown),R[E+n]=Ee,Te=R[E+i]+R[E+e]*(be/D.slowDown),R[E+i]=Te);else for(E=0;E<Z;E+=T)R[E+u]!==1&&(pe=R[E+o]*Math.sqrt((R[E+t]-R[E+r])*(R[E+t]-R[E+r])+(R[E+s]-R[E+e])*(R[E+s]-R[E+e])),xe=Math.sqrt((R[E+t]+R[E+r])*(R[E+t]+R[E+r])+(R[E+s]+R[E+e])*(R[E+s]+R[E+e]))/2,be=R[E+a]*Math.log(1+xe)/(1+Math.sqrt(pe)),R[E+a]=Math.min(1,Math.sqrt(be*(Math.pow(R[E+r],2)+Math.pow(R[E+e],2))/(1+Math.sqrt(pe)))),Ee=R[E+n]+R[E+r]*(be/D.slowDown),R[E+n]=Ee,Te=R[E+i]+R[E+e]*(be/D.slowDown),R[E+i]=Te);return{}},Yt}var Zt,fn;function Go(){if(fn)return Zt;fn=1;var n=je(),i=lt().createEdgeWeightGetter,r=Oo(),e=Ri(),t=_i();function s(l,u,d){if(!n(u))throw new Error("graphology-layout-forceatlas2: the given graph is not a valid graphology instance.");typeof d=="number"&&(d={iterations:d});var h=d.iterations;if(typeof h!="number")throw new Error("graphology-layout-forceatlas2: invalid number of iterations.");if(h<=0)throw new Error("graphology-layout-forceatlas2: you should provide a positive number of iterations.");var f=i("getEdgeWeight"in d?d.getEdgeWeight:"weight").fromEntry,b=typeof d.outputReducer=="function"?d.outputReducer:null,C=e.assign({},t,d.settings),m=e.validateSettings(C);if(m)throw new Error("graphology-layout-forceatlas2: "+m.message);var w=e.graphToByteArrays(u,f),p;for(p=0;p<h;p++)r(C,w.nodes,w.edges);if(l){e.assignLayoutChanges(u,w.nodes,b);return}return e.collectLayoutChanges(u,w.nodes)}function o(l){var u=typeof l=="number"?l:l.order;return{barnesHutOptimize:u>2e3,strongGravityMode:!0,gravity:.05,scalingRatio:10,slowDown:1+Math.log(u)}}var a=s.bind(null,!1);return a.assign=s.bind(null,!0),a.inferSettings=o,Zt=a,Zt}var Uo=Go();const Bo=st(Uo);var Xt,gn;function Mo(){if(gn)return Xt;gn=1;var n=0,i=1,r=2,e=3;function t(o,a){return o+"Â§"+a}function s(){return .01*(.5-Math.random())}return Xt=function(a,l){var u=a.margin,d=a.ratio,h=a.expansion,f=a.gridSize,b=a.speed,C,m,w,p,v,g,y=!0,_=l.length,k=_/e|0,T=new Float32Array(k),j=new Float32Array(k),N=1/0,I=1/0,U=-1/0,D=-1/0;for(C=0;C<_;C+=e)w=l[C+n],p=l[C+i],g=l[C+r]*d+u,N=Math.min(N,w-g),U=Math.max(U,w+g),I=Math.min(I,p-g),D=Math.max(D,p+g);var R=U-N,F=D-I,M=(N+U)/2,G=(I+D)/2;N=M-h*R/2,U=M+h*R/2,I=G-h*F/2,D=G+h*F/2;var E=new Array(f*f),x=E.length,V;for(V=0;V<x;V++)E[V]=[];var W,L,S,A,z,Z,K,re,$,ae;for(C=0;C<_;C+=e)for(w=l[C+n],p=l[C+i],g=l[C+r]*d+u,W=w-g,L=w+g,S=p-g,A=p+g,z=Math.floor(f*(W-N)/(U-N)),Z=Math.floor(f*(L-N)/(U-N)),K=Math.floor(f*(S-I)/(D-I)),re=Math.floor(f*(A-I)/(D-I)),$=z;$<=Z;$++)for(ae=K;ae<=re;ae++)E[$*f+ae].push(C);var X,ne=new Set,J,le,Y,q,P,se,he,te,Q,O,me,ie,oe;for(V=0;V<x;V++)for(X=E[V],C=0,v=X.length;C<v;C++)for(J=X[C],Y=l[J+n],P=l[J+i],he=l[J+r],m=C+1;m<v;m++)le=X[m],Q=t(J,le),!(x>1&&ne.has(Q))&&(x>1&&ne.add(Q),q=l[le+n],se=l[le+i],te=l[le+r],O=q-Y,me=se-P,ie=Math.sqrt(O*O+me*me),oe=ie<he*d+u+(te*d+u),oe&&(y=!1,le=le/e|0,ie>0?(T[le]+=O/ie*(1+he),j[le]+=me/ie*(1+he)):(T[le]+=R*s(),j[le]+=F*s())));for(C=0,m=0;C<_;C+=e,m++)l[C+n]+=T[m]*.1*b,l[C+i]+=j[m]*.1*b;return{converged:y}},Xt}var Oe={},mn;function Wo(){if(mn)return Oe;mn=1;var n=3;return Oe.validateSettings=function(i){return"gridSize"in i&&typeof i.gridSize!="number"||i.gridSize<=0?{message:"the `gridSize` setting should be a positive number."}:"margin"in i&&typeof i.margin!="number"||i.margin<0?{message:"the `margin` setting should be 0 or a positive number."}:"expansion"in i&&typeof i.expansion!="number"||i.expansion<=0?{message:"the `expansion` setting should be a positive number."}:"ratio"in i&&typeof i.ratio!="number"||i.ratio<=0?{message:"the `ratio` setting should be a positive number."}:"speed"in i&&typeof i.speed!="number"||i.speed<=0?{message:"the `speed` setting should be a positive number."}:null},Oe.graphToByteArray=function(i,r){var e=i.order,t=new Float32Array(e*n),s=0;return i.forEachNode(function(o,a){typeof r=="function"&&(a=r(o,a)),t[s]=a.x,t[s+1]=a.y,t[s+2]=a.size||1,s+=n}),t},Oe.assignLayoutChanges=function(i,r,e){var t=0;i.forEachNode(function(s){var o={x:r[t],y:r[t+1]};typeof e=="function"&&(o=e(s,o)),i.mergeNodeAttributes(s,o),t+=n})},Oe.collectLayoutChanges=function(i,r,e){var t={},s=0;return i.forEachNode(function(o){var a={x:r[s],y:r[s+1]};typeof e=="function"&&(a=e(o,a)),t[o]=a,s+=n}),t},Oe.createWorker=function(r){var e=window.URL||window.webkitURL,t=r.toString(),s=e.createObjectURL(new Blob(["("+t+").call(this);"],{type:"text/javascript"})),o=new Worker(s);return e.revokeObjectURL(s),o},Oe}var Kt,pn;function Ho(){return pn||(pn=1,Kt={gridSize:20,margin:5,expansion:1.1,ratio:1,speed:3}),Kt}var Qt,vn;function qo(){if(vn)return Qt;vn=1;var n=je(),i=Mo(),r=Wo(),e=Ho(),t=500;function s(a,l,u){if(!n(l))throw new Error("graphology-layout-noverlap: the given graph is not a valid graphology instance.");typeof u=="number"?u={maxIterations:u}:u=u||{};var d=u.maxIterations||t;if(typeof d!="number"||d<=0)throw new Error("graphology-layout-force: you should provide a positive number of maximum iterations.");var h=Object.assign({},e,u.settings),f=r.validateSettings(h);if(f)throw new Error("graphology-layout-noverlap: "+f.message);var b=r.graphToByteArray(l,u.inputReducer),C=!1,m;for(m=0;m<d&&!C;m++)C=i(h,b).converged;if(a){r.assignLayoutChanges(l,b,u.outputReducer);return}return r.collectLayoutChanges(l,b,u.outputReducer)}var o=s.bind(null,!1);return o.assign=s.bind(null,!0),Qt=o,Qt}var Vo=qo();const Jt=st(Vo);function $o(n,i){if(typeof n!="object"||!n)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var e=r.call(n,i);if(typeof e!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}function ki(n){var i=$o(n,"string");return typeof i=="symbol"?i:i+""}function Ni(n,i,r){return(i=ki(i))in n?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,n}function yn(n,i){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);i&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),r.push.apply(r,e)}return r}function Nt(n){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yn(Object(r),!0).forEach(function(e){Ni(n,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):yn(Object(r)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(r,e))})}return n}function Yo(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}function Zo(n,i){for(var r=0;r<i.length;r++){var e=i[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,ki(e.key),e)}}function Xo(n,i,r){return i&&Zo(n.prototype,i),Object.defineProperty(n,"prototype",{writable:!1}),n}function jt(n){return jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},jt(n)}function ji(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ji=function(){return!!n})()}function Ai(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Ko(n,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ai(n)}function Qo(n,i,r){return i=jt(i),Ko(n,ji()?Reflect.construct(i,r||[],jt(n).constructor):i.apply(n,r))}function Sr(n,i){return Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,e){return r.__proto__=e,r},Sr(n,i)}function Jo(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),i&&Sr(n,i)}function Tr(n,i){(i==null||i>n.length)&&(i=n.length);for(var r=0,e=Array(i);r<i;r++)e[r]=n[r];return e}function el(n){if(Array.isArray(n))return Tr(n)}function tl(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function rl(n,i){if(n){if(typeof n=="string")return Tr(n,i);var r={}.toString.call(n).slice(8,-1);return r==="Object"&&n.constructor&&(r=n.constructor.name),r==="Map"||r==="Set"?Array.from(n):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Tr(n,i):void 0}}function nl(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function er(n){return el(n)||tl(n)||rl(n)||nl()}function Li(n,i,r,e){var t=Math.pow(1-n,2)*i.x+2*(1-n)*n*r.x+Math.pow(n,2)*e.x,s=Math.pow(1-n,2)*i.y+2*(1-n)*n*r.y+Math.pow(n,2)*e.y;return{x:t,y:s}}function il(n,i,r){for(var e=20,t=0,s=n,o=0;o<e;o++){var a=Li((o+1)/e,n,i,r);t+=Math.sqrt(Math.pow(s.x-a.x,2)+Math.pow(s.y-a.y,2)),s=a}return t}function sl(n){var i=n.curvatureAttribute,r=n.defaultCurvature,e=n.keepLabelUpright,t=e===void 0?!0:e;return function(s,o,a,l,u){var d=u.edgeLabelSize,h=o[i]||r,f=u.edgeLabelFont,b=u.edgeLabelWeight,C=u.edgeLabelColor.attribute?o[u.edgeLabelColor.attribute]||u.edgeLabelColor.color||"#000":u.edgeLabelColor.color,m=o.label;if(m){s.fillStyle=C,s.font="".concat(b," ").concat(d,"px ").concat(f);var w=!t||a.x<l.x,p=w?a.x:l.x,v=w?a.y:l.y,g=w?l.x:a.x,y=w?l.y:a.y,_=(p+g)/2,k=(v+y)/2,T=g-p,j=y-v,N=Math.sqrt(Math.pow(T,2)+Math.pow(j,2)),I=w?1:-1,U=_+j*h*I,D=k-T*h*I,R=o.size*.7+5,F={x:D-v,y:-(U-p)},M=Math.sqrt(Math.pow(F.x,2)+Math.pow(F.y,2)),G={x:y-D,y:-(g-U)},E=Math.sqrt(Math.pow(G.x,2)+Math.pow(G.y,2));p+=R*F.x/M,v+=R*F.y/M,g+=R*G.x/E,y+=R*G.y/E,U+=R*j/N,D-=R*T/N;var x={x:U,y:D},V={x:p,y:v},W={x:g,y},L=il(V,x,W);if(!(L<a.size+l.size)){var S=s.measureText(m).width,A=L-a.size-l.size;if(S>A){var z="â€¦";for(m=m+z,S=s.measureText(m).width;S>A&&m.length>1;)m=m.slice(0,-2)+z,S=s.measureText(m).width;if(m.length<4)return}for(var Z={},K=0,re=m.length;K<re;K++){var $=m[K];Z[$]||(Z[$]=s.measureText($).width*(1+h*.35))}for(var ae=.5-S/L/2,X=0,ne=m.length;X<ne;X++){var J=m[X],le=Li(ae,V,x,W),Y=2*(1-ae)*(U-p)+2*ae*(g-U),q=2*(1-ae)*(D-v)+2*ae*(y-D),P=Math.atan2(q,Y);s.save(),s.translate(le.x,le.y),s.rotate(P),s.fillText(J,0,0),s.restore(),ae+=Z[J]/L}}}}}function al(n){var i=n.arrowHead,r=i?.extremity==="target"||i?.extremity==="both",e=i?.extremity==="source"||i?.extremity==="both",t=`
precision highp float;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`.concat(r?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(e?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(i?`
uniform float u_lengthToThicknessRatio;
uniform float u_widenessToThicknessRatio;`:"",`

float det(vec2 a, vec2 b) {
  return a.x * b.y - b.x * a.y;
}

vec2 getDistanceVector(vec2 b0, vec2 b1, vec2 b2) {
  float a = det(b0, b2), b = 2.0 * det(b1, b0), d = 2.0 * det(b2, b1);
  float f = b * d - a * a;
  vec2 d21 = b2 - b1, d10 = b1 - b0, d20 = b2 - b0;
  vec2 gf = 2.0 * (b * d21 + d * d10 + a * d20);
  gf = vec2(gf.y, -gf.x);
  vec2 pp = -f * gf / dot(gf, gf);
  vec2 d0p = b0 - pp;
  float ap = det(d0p, d20), bp = 2.0 * det(d10, d0p);
  float t = clamp((ap + bp) / (2.0 * a + b + d), 0.0, 1.0);
  return mix(mix(b0, b1, t), mix(b1, b2, t), t);
}

float distToQuadraticBezierCurve(vec2 p, vec2 b0, vec2 b1, vec2 b2) {
  return length(getDistanceVector(b0 - p, b1 - p, b2 - p));
}

const vec4 transparent = vec4(0.0, 0.0, 0.0, 0.0);

void main(void) {
  float dist = distToQuadraticBezierCurve(gl_FragCoord.xy, v_cpA, v_cpB, v_cpC);
  float thickness = v_thickness;
`).concat(r?`
  float distToTarget = length(gl_FragCoord.xy - v_targetPoint);
  float targetArrowLength = v_targetSize + thickness * u_lengthToThicknessRatio;
  if (distToTarget < targetArrowLength) {
    thickness = (distToTarget - v_targetSize) / (targetArrowLength - v_targetSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`
`).concat(e?`
  float distToSource = length(gl_FragCoord.xy - v_sourcePoint);
  float sourceArrowLength = v_sourceSize + thickness * u_lengthToThicknessRatio;
  if (distToSource < sourceArrowLength) {
    thickness = (distToSource - v_sourceSize) / (sourceArrowLength - v_sourceSize) * u_widenessToThicknessRatio * thickness;
  }`:"",`

  float halfThickness = thickness / 2.0;
  if (dist < halfThickness) {
    #ifdef PICKING_MODE
    gl_FragColor = v_color;
    #else
    float t = smoothstep(
      halfThickness - v_feather,
      halfThickness,
      dist
    );

    gl_FragColor = mix(v_color, transparent, t);
    #endif
  } else {
    gl_FragColor = transparent;
  }
}
`);return t}function ol(n){var i=n.arrowHead,r=i?.extremity==="target"||i?.extremity==="both",e=i?.extremity==="source"||i?.extremity==="both",t=`
attribute vec4 a_id;
attribute vec4 a_color;
attribute float a_direction;
attribute float a_thickness;
attribute vec2 a_source;
attribute vec2 a_target;
attribute float a_current;
attribute float a_curvature;
`.concat(r?`attribute float a_targetSize;
`:"",`
`).concat(e?`attribute float a_sourceSize;
`:"",`

uniform mat3 u_matrix;
uniform float u_sizeRatio;
uniform float u_pixelRatio;
uniform vec2 u_dimensions;
uniform float u_minEdgeThickness;
uniform float u_feather;

varying vec4 v_color;
varying float v_thickness;
varying float v_feather;
varying vec2 v_cpA;
varying vec2 v_cpB;
varying vec2 v_cpC;
`).concat(r?`
varying float v_targetSize;
varying vec2 v_targetPoint;`:"",`
`).concat(e?`
varying float v_sourceSize;
varying vec2 v_sourcePoint;`:"",`
`).concat(i?`
uniform float u_widenessToThicknessRatio;`:"",`

const float bias = 255.0 / 254.0;
const float epsilon = 0.7;

vec2 clipspaceToViewport(vec2 pos, vec2 dimensions) {
  return vec2(
    (pos.x + 1.0) * dimensions.x / 2.0,
    (pos.y + 1.0) * dimensions.y / 2.0
  );
}

vec2 viewportToClipspace(vec2 pos, vec2 dimensions) {
  return vec2(
    pos.x / dimensions.x * 2.0 - 1.0,
    pos.y / dimensions.y * 2.0 - 1.0
  );
}

void main() {
  float minThickness = u_minEdgeThickness;

  // Selecting the correct position
  // Branchless "position = a_source if a_current == 1.0 else a_target"
  vec2 position = a_source * max(0.0, a_current) + a_target * max(0.0, 1.0 - a_current);
  position = (u_matrix * vec3(position, 1)).xy;

  vec2 source = (u_matrix * vec3(a_source, 1)).xy;
  vec2 target = (u_matrix * vec3(a_target, 1)).xy;

  vec2 viewportPosition = clipspaceToViewport(position, u_dimensions);
  vec2 viewportSource = clipspaceToViewport(source, u_dimensions);
  vec2 viewportTarget = clipspaceToViewport(target, u_dimensions);

  vec2 delta = viewportTarget.xy - viewportSource.xy;
  float len = length(delta);
  vec2 normal = vec2(-delta.y, delta.x) * a_direction;
  vec2 unitNormal = normal / len;
  float boundingBoxThickness = len * a_curvature;

  float curveThickness = max(minThickness, a_thickness / u_sizeRatio);
  v_thickness = curveThickness * u_pixelRatio;
  v_feather = u_feather;

  v_cpA = viewportSource;
  v_cpB = 0.5 * (viewportSource + viewportTarget) + unitNormal * a_direction * boundingBoxThickness;
  v_cpC = viewportTarget;

  vec2 viewportOffsetPosition = (
    viewportPosition +
    unitNormal * (boundingBoxThickness / 2.0 + sign(boundingBoxThickness) * (`).concat(i?"curveThickness * u_widenessToThicknessRatio":"curveThickness",` + epsilon)) *
    max(0.0, a_direction) // NOTE: cutting the bounding box in half to avoid overdraw
  );

  position = viewportToClipspace(viewportOffsetPosition, u_dimensions);
  gl_Position = vec4(position, 0, 1);
    
`).concat(r?`
  v_targetSize = a_targetSize * u_pixelRatio / u_sizeRatio;
  v_targetPoint = viewportTarget;
`:"",`
`).concat(e?`
  v_sourceSize = a_sourceSize * u_pixelRatio / u_sizeRatio;
  v_sourcePoint = viewportSource;
`:"",`

  #ifdef PICKING_MODE
  // For picking mode, we use the ID as the color:
  v_color = a_id;
  #else
  // For normal mode, we use the color:
  v_color = a_color;
  #endif

  v_color.a *= bias;
}
`);return t}var Di=.25,ll={arrowHead:null,curvatureAttribute:"curvature",defaultCurvature:Di},Ii=WebGLRenderingContext,bn=Ii.UNSIGNED_BYTE,Pe=Ii.FLOAT;function Lr(n){var i=Nt(Nt({},ll),n||{}),r=i,e=r.arrowHead,t=r.curvatureAttribute,s=r.drawLabel,o=e?.extremity==="target"||e?.extremity==="both",a=e?.extremity==="source"||e?.extremity==="both",l=["u_matrix","u_sizeRatio","u_dimensions","u_pixelRatio","u_feather","u_minEdgeThickness"].concat(er(e?["u_lengthToThicknessRatio","u_widenessToThicknessRatio"]:[]));return(function(u){Jo(d,u);function d(){var h;Yo(this,d);for(var f=arguments.length,b=new Array(f),C=0;C<f;C++)b[C]=arguments[C];return h=Qo(this,d,[].concat(b)),Ni(Ai(h),"drawLabel",s||sl(i)),h}return Xo(d,[{key:"getDefinition",value:function(){return{VERTICES:6,VERTEX_SHADER_SOURCE:ol(i),FRAGMENT_SHADER_SOURCE:al(i),METHOD:WebGLRenderingContext.TRIANGLES,UNIFORMS:l,ATTRIBUTES:[{name:"a_source",size:2,type:Pe},{name:"a_target",size:2,type:Pe}].concat(er(o?[{name:"a_targetSize",size:1,type:Pe}]:[]),er(a?[{name:"a_sourceSize",size:1,type:Pe}]:[]),[{name:"a_thickness",size:1,type:Pe},{name:"a_curvature",size:1,type:Pe},{name:"a_color",size:4,type:bn,normalized:!0},{name:"a_id",size:4,type:bn,normalized:!0}]),CONSTANT_ATTRIBUTES:[{name:"a_current",size:1,type:Pe},{name:"a_direction",size:1,type:Pe}],CONSTANT_DATA:[[0,1],[0,-1],[1,1],[0,-1],[1,1],[1,-1]]}}},{key:"processVisibleItem",value:function(f,b,C,m,w){var p,v=w.size||1,g=C.x,y=C.y,_=m.x,k=m.y,T=Ze(w.color),j=(p=w[t])!==null&&p!==void 0?p:Di,N=this.array;N[b++]=g,N[b++]=y,N[b++]=_,N[b++]=k,o&&(N[b++]=m.size),a&&(N[b++]=C.size),N[b++]=v,N[b++]=j,N[b++]=T,N[b++]=f}},{key:"setUniforms",value:function(f,b){var C=b.gl,m=b.uniformLocations,w=m.u_matrix,p=m.u_pixelRatio,v=m.u_feather,g=m.u_sizeRatio,y=m.u_dimensions,_=m.u_minEdgeThickness;if(C.uniformMatrix3fv(w,!1,f.matrix),C.uniform1f(p,f.pixelRatio),C.uniform1f(g,f.sizeRatio),C.uniform1f(v,f.antiAliasingFeather),C.uniform2f(y,f.width*f.pixelRatio,f.height*f.pixelRatio),C.uniform1f(_,f.minEdgeThickness),e){var k=m.u_lengthToThicknessRatio,T=m.u_widenessToThicknessRatio;C.uniform1f(k,e.lengthToThicknessRatio),C.uniform1f(T,e.widenessToThicknessRatio)}}}]),d})(Dt)}var cl=Lr();Lr({arrowHead:Pt});Lr({arrowHead:Nt(Nt({},Pt),{},{extremity:"both"})});const Pi=n=>{const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:{r:100,g:100,b:100}},Fi=(n,i,r)=>"#"+[n,i,r].map(e=>Math.max(0,Math.min(255,Math.round(e))).toString(16).padStart(2,"0")).join(""),Ge=(n,i)=>{const r=Pi(n),e={r:15,g:23,b:42};return Fi(e.r+(r.r-e.r)*i,e.g+(r.g-e.g)*i,e.b+(r.b-e.b)*i)},tr=(n,i)=>{const r=Pi(n);return Fi(r.r+(255-r.r)*(i-1)/i,r.g+(255-r.g)*(i-1)/i,r.b+(255-r.b)*(i-1)/i)},xn=["#f43f5e","#8b5cf6","#06b6d4","#f59e0b","#10b981","#ec4899","#6366f1","#14b8a6","#ef4444","#84cc16","#a855f7","#0ea5e9","#f97316","#22c55e","#e879f9"];function ul(n){return xn[n%xn.length]}const rr={maxIterations:20,ratio:1.1,margin:10,expansion:1.05},hl=n=>{const i=n<100,r=n>=100&&n<500;return{gravity:i?1:r?.6:.3,scalingRatio:i?12:r?25:50,slowDown:i?1:r?2:4,barnesHutOptimize:n>100,barnesHutTheta:.6,strongGravityMode:!1,outboundAttractionDistribution:!0,linLogMode:!1,adjustSizes:!0,edgeWeightInfluence:1}},dl=n=>n>2e3?3e4:n>500?2e4:n>100?15e3:1e4;function fl(n){const i={0:[],1:[],2:[]};n.forEachNode((t,s)=>{const o=s.tier??2;(i[o]??=[]).push(t)});const r=new Map,e=[0,300,600];for(const[t,s]of Object.entries(i)){const o=Number(t),a=e[o]??600;s.forEach((l,u)=>{const d=2*Math.PI*u/Math.max(s.length,1);r.set(l,{x:Math.cos(d)*a,y:Math.sin(d)*a})})}return r}function gl(n){let i=null,r=-1;n.forEachNode(a=>{const l=n.degree(a);l>r&&(r=l,i=a)});const e=new Map;if(!i)return e;const t=new Set,s=[{node:i,depth:0}];t.add(i);const o=new Map;for(;s.length>0;){const{node:a,depth:l}=s.shift();o.has(l)||o.set(l,[]),o.get(l).push(a),n.forEachNeighbor(a,u=>{t.has(u)||(t.add(u),s.push({node:u,depth:l+1}))})}for(const[a,l]of o.entries()){const u=a*250;l.forEach((d,h)=>{const f=2*Math.PI*h/Math.max(l.length,1);e.set(d,{x:Math.cos(f)*u,y:Math.sin(f)*u})})}return e}function ml(n){const i={0:[],1:[],2:[]};n.forEachNode((t,s)=>{const o=s.tier??2;(i[o]??=[]).push(t)});const r=new Map,e=[0,400,800];for(const[t,s]of Object.entries(i)){const o=Number(t),a=e[o]??800,l=s.length*200;s.forEach((u,d)=>{r.set(u,{x:-l/2+d*200,y:a})})}return r}function pl(n,i,r,e){const t=new Map;n.forEachNode((l,u)=>{t.set(l,{x:u.x,y:u.y})});const s=performance.now();let o=!1;function a(){if(o)return;const l=performance.now()-s,u=Math.min(l/r,1),d=1-Math.pow(1-u,3);n.forEachNode(h=>{const f=t.get(h),b=i.get(h);f&&b&&(n.setNodeAttribute(h,"x",f.x+(b.x-f.x)*d),n.setNodeAttribute(h,"y",f.y+(b.y-f.y)*d))}),u<1?requestAnimationFrame(a):e?.()}return requestAnimationFrame(a),()=>{o=!0}}function vl(n,i,r){const e=n.getContext("2d");if(!e)return;const t=n.width,s=n.height;if(e.clearRect(0,0,t,s),e.fillStyle="#0f172a",e.fillRect(0,0,t,s),i.order===0)return;let o=1/0,a=-1/0,l=1/0,u=-1/0;i.forEachNode((R,F)=>{const M=F.x,G=F.y;M<o&&(o=M),M>a&&(a=M),G<l&&(l=G),G>u&&(u=G)});const d=a-o||1,h=u-l||1,f=8,b=(t-f*2)/d,C=(s-f*2)/h,m=Math.min(b,C),w=(t-d*m)/2,p=(s-h*m)/2;i.forEachNode((R,F)=>{const M=w+(F.x-o)*m,G=p+(F.y-l)*m;e.beginPath(),e.arc(M,G,Math.max(1.5,(F.size||6)*m*.02),0,Math.PI*2),e.fillStyle=F.color||"#64748b",e.fill()});const g=r.getCamera().getState(),y=r.getDimensions(),_=y.width*g.ratio,k=y.height*g.ratio,T=g.x-_/2,j=g.y-k/2,N=w+(T*d-o)*m,I=p+(j*h-l)*m,U=_*m,D=k*m;e.strokeStyle="#60a5fa",e.lineWidth=1.5,e.strokeRect(N,I,U,D)}function yl(n,i){const r=B.useRef(null),e=B.useRef(null),t=B.useRef(null),s=B.useRef(null),o=B.useRef(null),a=B.useRef(null),l=B.useRef(null),u=B.useRef(i);u.current=i;const d=B.useRef(null),h=B.useRef(new Set),f=B.useRef(new Set),b=B.useRef(new Set),C=B.useRef(!1),m=B.useRef(null),w=B.useRef(null),[p,v]=B.useState("idle"),[g,y]=B.useState(!1),[_,k]=B.useState(null);B.useEffect(()=>{d.current=i.selectedNodeId??null,t.current?.refresh()},[i.selectedNodeId]),B.useEffect(()=>{h.current=i.selectedNodeIds??new Set,t.current?.refresh()},[i.selectedNodeIds]),B.useEffect(()=>{f.current=i.searchHighlightIds??new Set,t.current?.refresh()},[i.searchHighlightIds]),B.useEffect(()=>{b.current=new Set(i.pathNodeIds??[]),t.current?.refresh()},[i.pathNodeIds]),B.useEffect(()=>{C.current=i.communityMode??!1,t.current?.refresh()},[i.communityMode]),B.useEffect(()=>{if(!r.current)return;const W=new Es;s.current=W;const L=new Do(W,r.current,{renderLabels:!0,labelFont:"Inter, system-ui, sans-serif",labelSize:11,labelWeight:"500",labelColor:{color:"#e2e8f0"},labelRenderedSizeThreshold:6,labelDensity:.15,labelGridCellSize:80,defaultNodeColor:"#64748b",defaultEdgeColor:"#1e293b",defaultEdgeType:"curved",edgeProgramClasses:{curved:cl},defaultDrawNodeHover:(S,A,z)=>{const Z=A.label;if(!Z)return;const K=z.labelSize||11,re=z.labelFont||"Inter, system-ui, sans-serif",$=z.labelWeight||"500";S.font=`${$} ${K}px ${re}`;const ae=S.measureText(Z).width,X=A.size||8,ne=A.x,J=A.y-X-12,le=10,q=K+6*2,P=ae+le*2,se=6;S.fillStyle="#0f172a",S.beginPath(),S.roundRect(ne-P/2,J-q/2,P,q,se),S.fill(),S.strokeStyle=A.color||"#6366f1",S.lineWidth=1.5,S.stroke(),S.fillStyle="#f1f5f9",S.textAlign="center",S.textBaseline="middle",S.fillText(Z,ne,J),S.beginPath(),S.arc(A.x,A.y,X+3,0,Math.PI*2),S.strokeStyle=A.color||"#6366f1",S.lineWidth=2,S.globalAlpha=.6,S.stroke(),S.globalAlpha=1},minCameraRatio:.005,maxCameraRatio:30,hideEdgesOnMove:!0,zIndex:!0,nodeReducer:(S,A)=>{const z={...A},Z=s.current,K=d.current,re=h.current,$=f.current,ae=b.current;if(C.current&&A.community!==void 0&&(z.color=ul(A.community)),ae.size>0&&(ae.has(S)?(z.color="#22c55e",z.size=(A.size||8)*1.6,z.zIndex=3,z.highlighted=!0):!K&&re.size===0&&(z.color=Ge(z.color,.3),z.size=(A.size||8)*.7,z.zIndex=0),ae.size>0&&!K&&re.size===0))return z;if($.size>0&&!K&&re.size===0)return $.has(S)?(z.color="#06b6d4",z.size=(A.size||8)*1.5,z.zIndex=2,z.highlighted=!0):(z.color=Ge(z.color,.3),z.size=(A.size||8)*.7,z.zIndex=0),z;if(re.size>1&&!K&&Z)return re.has(S)?(z.size=(A.size||8)*1.5,z.zIndex=2,z.highlighted=!0):Array.from(re).some(q=>Z.hasEdge(S,q)||Z.hasEdge(q,S))?(z.size=(A.size||8)*1.1,z.zIndex=1):(z.color=Ge(z.color,.3),z.size=(A.size||8)*.7,z.zIndex=0),z;if(!K||!Z)return z;const J=S===K,le=Z.hasEdge(S,K)||Z.hasEdge(K,S);return J?(z.size=(A.size||8)*1.5,z.zIndex=2,z.highlighted=!0):le&&(z.color=tr(z.color,1.3),z.size=(A.size||8)*1.15,z.zIndex=1),z},edgeReducer:(S,A)=>{const z={...A},Z=d.current,K=h.current,re=f.current,$=b.current,ae=w.current,X=s.current;if(ae===S&&A.relationType&&(z.label=A.relationType),$.size>0&&X){const[Y,q]=X.extremities(S);if($.has(Y)&&$.has(q)?(z.color="#22c55e",z.size=Math.max(3,(A.size||1)*3),z.zIndex=3,A.relationType&&(z.label=A.relationType)):!Z&&K.size===0&&(z.color=Ge(A.color,.15),z.size=.4),!Z&&K.size===0)return z}if(re.size>0&&!Z&&K.size===0&&X){const[Y,q]=X.extremities(S);return re.has(Y)&&re.has(q)?(z.color="#06b6d4",z.size=Math.max(2,(A.size||1)*2)):(z.color=Ge(A.color,.15),z.size=.4),z}if(K.size>1&&!Z&&X){const[Y,q]=X.extremities(S),P=K.has(Y)&&K.has(q),se=K.has(Y)||K.has(q);return P?(z.color=tr(A.color,1.5),z.size=Math.max(2.5,(A.size||1)*3),z.zIndex=2,A.relationType&&(z.label=A.relationType)):se?(z.color=Ge(A.color,.35),z.size=(A.size||1)*.7):(z.color=Ge(A.color,.15),z.size=.5,z.zIndex=0),z}if(!Z||!X)return z;const[ne,J]=X.extremities(S);return(ne===Z||J===Z)&&(z.color=tr(A.color,1.5),z.size=Math.max(2,(A.size||1)*2.5),z.zIndex=2,A.relationType&&(z.label=A.relationType)),z}});return t.current=L,L.on("clickNode",({node:S})=>{u.current.onNodeClick?.(S)}),L.on("clickStage",()=>{u.current.onStageClick?.()}),L.on("rightClickNode",S=>{S.event.original.preventDefault();const A=S.node,z=s.current;if(z&&z.hasNode(A)){const Z=z.getNodeAttributes(A),K=L.graphToViewport({x:Z.x,y:Z.y});u.current.onNodeRightClick?.(A,K.x,K.y)}}),L.on("enterNode",({node:S})=>{u.current.onNodeHover?.(S),r.current&&(r.current.style.cursor="pointer");const A=s.current;if(A&&A.hasNode(S)){const z=A.getNodeAttributes(S),Z=L.graphToViewport({x:z.x,y:z.y});k({id:S,label:z.label||S,type:z.nodeType||"",screenX:Z.x,screenY:Z.y})}}),L.on("leaveNode",()=>{u.current.onNodeHover?.(null),r.current&&(r.current.style.cursor="grab"),k(null)}),L.on("enterEdge",({edge:S})=>{w.current=S,L.refresh()}),L.on("leaveEdge",()=>{w.current=null,L.refresh()}),L.on("downNode",({node:S,event:A})=>{const z=s.current;!z||!z.hasNode(S)||(m.current={node:S,startX:A.x,startY:A.y},L.getCamera().disable())}),L.getMouseCaptor().on("mousemovebody",S=>{if(!m.current)return;const A=L.viewportToGraph({x:S.x,y:S.y}),z=s.current;z&&z.hasNode(m.current.node)&&(z.setNodeAttribute(m.current.node,"x",A.x),z.setNodeAttribute(m.current.node,"y",A.y))}),L.getMouseCaptor().on("mouseup",()=>{m.current&&(m.current=null,L.getCamera().enable())}),L.on("afterRender",()=>{const S=e.current,A=s.current;S&&A&&vl(S,A,L)}),v("idle"),()=>{a.current&&clearTimeout(a.current),l.current&&l.current(),o.current?.kill(),L.kill(),t.current=null,s.current=null}},[]);const T=B.useCallback(()=>{o.current&&(o.current.kill(),o.current=null),a.current&&(clearTimeout(a.current),a.current=null),l.current&&(l.current(),l.current=null),y(!1)},[]),j=B.useCallback(W=>{const L=W.order;if(L===0)return;T();const S=Bo.inferSettings(W),A=hl(L),z={...S,...A},Z=new zo(W,{settings:z});o.current=Z,Z.start(),y(!0);const K=dl(L);a.current=setTimeout(()=>{o.current&&(o.current.stop(),o.current=null,Jt.assign(W,rr),t.current?.refresh(),y(!1))},K)},[T]);B.useEffect(()=>{const W=t.current;if(!W){v(n?"initializing":"idle");return}if(!n||n.order===0){v("waiting-data");return}T(),s.current=n,W.setGraph(n),W.getCamera().animatedReset({duration:300}),j(n),v("ready")},[n,j,T]);const N=B.useCallback(()=>{t.current?.getCamera().animatedReset({duration:300})},[]),I=B.useCallback(()=>{t.current?.getCamera().animatedZoom({duration:200})},[]),U=B.useCallback(()=>{t.current?.getCamera().animatedUnzoom({duration:200})},[]),D=B.useCallback(W=>{const L=t.current,S=s.current;if(!L||!S||!S.hasNode(W))return;const A=S.getNodeAttributes(W);L.getCamera().animate({x:A.x,y:A.y,ratio:.4},{duration:400})},[]),R=B.useCallback(()=>{const W=s.current;W&&W.order>0&&j(W)},[j]),F=B.useCallback(()=>{T();const W=s.current;W&&(Jt.assign(W,rr),t.current?.refresh())},[T]),M=B.useCallback(W=>{const L=s.current;if(!L||L.order===0)return;if(T(),W==="forceAtlas2"||W==="force"){j(L);return}let S;switch(W){case"concentric":S=fl(L);break;case"radial":S=gl(L);break;case"dagre":S=ml(L);break;default:j(L);return}l.current=pl(L,S,600,()=>{Jt.assign(L,rr),t.current?.refresh(),l.current=null})},[T,j]),G=B.useCallback(()=>{const W=t.current;if(!W)return;const L=W.getCanvases?.();if(!L)return;const S=Object.keys(L);if(S.length===0)return;const A=L[S[0]],z=A.width,Z=A.height,K=document.createElement("canvas");K.width=z,K.height=Z;const re=K.getContext("2d");re.fillStyle="#020617",re.fillRect(0,0,z,Z);for(const $ of S){const ae=L[$];re.drawImage(ae,0,0)}K.toBlob($=>{if(!$)return;const ae=URL.createObjectURL($),X=document.createElement("a");X.href=ae,X.download=`graph-${new Date().toISOString().slice(0,10)}.png`,document.body.appendChild(X),X.click(),document.body.removeChild(X),setTimeout(()=>URL.revokeObjectURL(ae),1e3)},"image/png")},[]),E=B.useCallback(W=>{const L=s.current;return!L||!L.hasNode(W)?[]:L.neighbors(W)},[]),x=B.useCallback(W=>{const L=s.current;return!L||!L.hasNode(W)?W:L.getNodeAttribute(W,"label")||W},[]),V=B.useCallback(()=>{t.current?.refresh()},[]);return{containerRef:r,minimapRef:e,fitView:N,zoomIn:I,zoomOut:U,focusNode:D,startLayout:R,stopLayout:F,applyLayout:M,exportPNG:G,getNeighborIds:E,getNodeLabel:x,refreshSize:V,isLayoutRunning:g,status:p,hoveredNode:_}}function zi(){const{currentProjectId:n}=ot(),i=qn(),r=at({queryKey:["graph","sync","status",n],queryFn:async()=>{if(!n)return null;const s=await qe.getSyncStatus(n);return{...s,is_connected:!!s?.last_synced_at,node_count:s?.node_count||0,edge_count:s?.edge_count||0,pending_count:s?.pending_count||0}},enabled:!!n,refetchInterval:s=>s?.sync_status==="syncing"?2e3:3e4}),e=Rt({mutationFn:async()=>{if(!n)throw new Error("No project selected");return await qe.triggerSync(n)},onSuccess:()=>{i.invalidateQueries({queryKey:["graph","sync","status"]}),i.invalidateQueries({queryKey:["graph","nodes"]}),i.invalidateQueries({queryKey:["graph","edges"]}),ge.success("Graph sync started")},onError:s=>{ge.error(`Sync failed: ${s.message}`)}}),t=Rt({mutationFn:async()=>{if(!n)throw new Error("No project selected");return await qe.triggerResync(n)},onSuccess:()=>{i.invalidateQueries({queryKey:["graph","sync","status"]}),i.invalidateQueries({queryKey:["graph","nodes"]}),i.invalidateQueries({queryKey:["graph","edges"]}),ge.success("Full graph resync started")},onError:s=>{ge.error(`Resync failed: ${s.message}`)}});return{status:r.data,isLoadingStatus:r.isLoading,isSyncing:r.data?.sync_status==="syncing"||e.isPending||t.isPending,sync:e.mutate,resync:t.mutate,error:r.error||e.error||t.error}}function bl(){const{currentProjectId:n}=ot(),{selectedNodeId:i}=ct(),{data:r}=Nr(),e=r?.find(s=>s.id===i)||null,t=at({queryKey:["graph","neighbors",i,n],queryFn:async()=>!i||!n?[]:await qe.getSemanticNeighbors(i,n),enabled:!!i&&!!n,staleTime:300*1e3});return{node:e,neighbors:t.data||[],isLoadingNeighbors:t.isLoading}}function xl(){const{currentProjectId:n}=ot(),{user:i}=Wi(),r=qn(),e=["graph","bookmarks",n],{data:t=[],isLoading:s}=at({queryKey:e,queryFn:async()=>{if(!n||!i?.id)return[];const{data:u,error:d}=await Ct.from("graph_bookmarks").select("*").eq("project_id",n).eq("user_id",i.id);if(d)throw d;return u},enabled:!!n&&!!i?.id}),o=Rt({mutationFn:async u=>{if(!n||!i?.id)throw new Error("No context");const{error:d}=await Ct.from("graph_bookmarks").insert({project_id:n,user_id:i.id,node_id:u.nodeId,node_type:u.nodeType,node_label:u.nodeLabel});if(d)throw d},onSuccess:()=>{r.invalidateQueries({queryKey:e})}}),a=Rt({mutationFn:async u=>{if(!n||!i?.id)throw new Error("No context");const{error:d}=await Ct.from("graph_bookmarks").delete().eq("project_id",n).eq("user_id",i.id).eq("node_id",u);if(d)throw d},onSuccess:()=>{r.invalidateQueries({queryKey:e})}}),l=u=>t.some(d=>d.node_id===u);return{bookmarks:t,isLoading:s,addBookmark:o.mutate,removeBookmark:a.mutate,isBookmarked:l}}const Oi=B.forwardRef(({className:n,children:i,...r},e)=>c.jsxs(Kn,{ref:e,className:ce("relative overflow-hidden",n),...r,children:[c.jsx(Rs,{className:"h-full w-full rounded-[inherit]",children:i}),c.jsx(Gi,{}),c.jsx(_s,{})]}));Oi.displayName=Kn.displayName;const Gi=B.forwardRef(({className:n,orientation:i="vertical",...r},e)=>c.jsx(Qn,{ref:e,orientation:i,className:ce("flex touch-none select-none transition-colors",i==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",i==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",n),...r,children:c.jsx(ks,{className:"relative flex-1 rounded-full bg-border"})}));Gi.displayName=Qn.displayName;const Rr=B.forwardRef(({className:n,orientation:i="horizontal",decorative:r=!0,...e},t)=>c.jsx(Jn,{ref:t,decorative:r,orientation:i,className:ce("shrink-0 bg-border",i==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",n),...e}));Rr.displayName=Jn.displayName;function wl({edges:n=[]}){const{selectedNodeId:i,setSelectedNodeId:r}=ct(),{node:e,neighbors:t,isLoadingNeighbors:s}=bl(),{isBookmarked:o,addBookmark:a,removeBookmark:l}=xl(),{data:u}=Nr(),d=B.useMemo(()=>{const m=new Map;if(u)for(const w of u)m.set(w.id,w.data?.label||w.label||w.id);return m},[u]),h=B.useMemo(()=>i?n.filter(m=>m.source===i||m.target===i).map(m=>{const w=m.source===i,p=w?m.target:m.source;return{id:m.id,relationship:m.data?.originalLabel||m.label||"related",direction:w?"outgoing":"incoming",targetId:p,targetName:d.get(p)||p.substring(0,12)+"..."}}):[],[i,n,d]);if(!i||!e)return null;const f=e.data,b=i?o(i):!1,C=()=>{i&&(b?l(i):a({nodeId:i,nodeType:e.label||f.type||"unknown",nodeLabel:f.label||"(unnamed)"}))};return c.jsxs("div",{className:"w-[400px] shrink-0 bg-slate-950 border-l border-slate-800 shadow-2xl z-20 flex flex-col overflow-hidden",children:[c.jsxs("div",{className:ce("flex flex-col p-5 border-b border-slate-800 bg-slate-900/50"),children:[c.jsxs("div",{className:"flex items-start justify-between mb-3",children:[c.jsx(ft,{variant:"outline",className:ce("text-xs font-bold uppercase text-slate-200 border-slate-600 bg-slate-800/50"),children:e.label||"â€”"}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(gt,{variant:"ghost",size:"icon",className:ce("h-8 w-8 hover:text-white",b?"text-yellow-500 hover:text-yellow-600":"text-slate-400"),onClick:C,title:b?"Remove Bookmark":"Bookmark this node",children:c.jsx(Zs,{className:ce("h-4 w-4",b&&"fill-current")})}),c.jsx(gt,{variant:"ghost",size:"icon",onClick:()=>r(null),className:"h-8 w-8 text-slate-400 hover:bg-red-500/10 hover:text-red-400",children:c.jsx(it,{className:"h-4 w-4"})})]})]}),c.jsxs("div",{className:"flex gap-4",children:[c.jsx("div",{className:ce("p-3 rounded-xl shadow-inner flex items-center justify-center shrink-0 h-16 w-16 bg-slate-800 text-slate-300"),children:c.jsx("span",{className:"[&>svg]:w-8 [&>svg]:h-8",children:f.icon})}),c.jsxs("div",{className:"min-w-0 flex-1",children:[c.jsx("h2",{className:"text-xl font-bold leading-tight line-clamp-2 tracking-tight text-slate-100",children:f.label||"(unnamed)"}),f.project_id&&c.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-slate-400",children:[c.jsx(_t,{className:"w-3 h-3"}),c.jsxs("span",{className:"truncate",children:["Project ",f.project_id.substring(0,8),"..."]})]})]})]})]}),c.jsx(Oi,{className:"flex-1",children:c.jsxs("div",{className:"p-5 space-y-6",children:[(f.content||f.description)&&c.jsx("div",{className:"prose prose-sm text-sm text-slate-300 leading-relaxed bg-slate-800/50 p-3 rounded-lg border border-slate-700",children:f.content||f.description}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("h3",{className:"section-header",children:"Properties"}),c.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(f).map(([m,w])=>["label","type","tier","color","icon","project_id","metadata","_display","content","description"].includes(m)||!w?null:c.jsxs("div",{className:"flex flex-col p-2 rounded bg-slate-800/50 border border-slate-700 shadow-sm",children:[c.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 mb-1",children:m.replace(/_/g," ")}),c.jsx("span",{className:"text-xs font-medium text-slate-200 truncate",title:String(w),children:String(w)})]},m))})]}),c.jsx(Rr,{}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("h3",{className:"section-header flex items-center justify-between",children:[c.jsx("span",{children:"Direct Connections"}),c.jsx(ft,{variant:"secondary",className:"text-[10px] h-5",children:h.length})]}),h.length===0?c.jsx("p",{className:"text-xs text-slate-400 italic",children:"No direct connections visualized."}):c.jsx("div",{className:"grid gap-2",children:h.map(m=>c.jsx("div",{className:"flex items-center justify-between p-2 rounded-md border border-slate-700 bg-slate-800/50 hover:bg-purple-500/10 cursor-pointer group transition-colors",onClick:()=>r(m.targetId),children:c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c.jsx(ft,{variant:"outline",className:"text-[10px] px-1 h-5 text-slate-400 font-mono",children:m.relationship}),m.direction==="outgoing"?"â†’":"â†",c.jsx("span",{className:"font-medium text-slate-200 group-hover:text-blue-400 transition-colors truncate",children:m.targetName})]})},m.id))})]}),c.jsx(Rr,{}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("h3",{className:"section-header flex items-center justify-between",children:c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx(qs,{className:"h-3.5 w-3.5 text-yellow-500"}),c.jsx("span",{children:"Semantic Related"})]})}),s?c.jsx("div",{className:"space-y-2",children:[1,2,3].map(m=>c.jsx("div",{className:"h-10 bg-slate-800 animate-pulse rounded-md"},m))}):t.length===0?c.jsx("div",{className:"text-xs text-slate-400 p-2 border border-dashed rounded text-center",children:"No similar items found in vector store."}):c.jsx("div",{className:"grid gap-2",children:t.map(m=>c.jsxs("div",{className:"p-3 rounded-lg border border-slate-700 bg-slate-800/50 hover:bg-yellow-500/10 hover:border-yellow-500/30 cursor-pointer transition-colors group relative overflow-hidden",onClick:()=>r(m.entity_id),children:[c.jsx("div",{className:"absolute top-0 right-0 p-1",children:c.jsxs("div",{className:"text-[9px] font-bold text-green-400 bg-green-900/60 px-1 rounded flex items-center gap-0.5",children:[Math.round(m.similarity*100),"%"]})}),c.jsx("div",{className:"flex items-center gap-2 mb-1",children:c.jsx(ft,{variant:"secondary",className:"text-[9px] px-1 h-4",children:m.entity_type})}),c.jsx("p",{className:"text-xs font-medium text-slate-200 line-clamp-2 group-hover:text-blue-400 transition-colors",children:m.content||"(no content)"})]},m.entity_id))})]})]})}),c.jsxs("div",{className:"p-4 border-t border-slate-800 bg-slate-900/50 flex gap-2",children:[c.jsxs(gt,{className:"flex-1",variant:"outline",size:"sm",children:["Open Source",c.jsx(Ns,{className:"ml-2 h-3 w-3"})]}),c.jsxs(gt,{className:"flex-1",size:"sm",children:["Expand",c.jsx(_t,{className:"ml-2 h-3 w-3"})]})]}),c.jsx("style",{children:`
                .section-header {
                    font-size: 0.75rem;
                    font-weight: 700;
                    color: rgb(148 163 184);
                    text-transform: uppercase;
                    letter-spacing: 0.05em;
                    margin-bottom: 0.5rem;
                }
            `})]})}const El=[{label:"All Nodes",query:"MATCH (n) RETURN labels(n) AS type, n.name AS name, n.id AS id LIMIT 50"},{label:"All Relationships",query:"MATCH (a)-[r]->(b) RETURN a.name AS from, type(r) AS rel, b.name AS to LIMIT 50"},{label:"People & Projects",query:"MATCH (p:Person)-[r]->(proj:Project) RETURN p.name, type(r), proj.name"},{label:"Risks",query:"MATCH (r:Risk) RETURN r.name, r.content, r.impact, r.status"},{label:"Action Items",query:"MATCH (a:Action) RETURN a.name, a.task, a.owner, a.status, a.deadline"},{label:"Decisions",query:"MATCH (d:Decision) RETURN d.name, d.content, d.owner, d.status"},{label:"Node Connections",query:'MATCH (n)-[r]-(m) WHERE n.name =~ ".*SEARCH.*" RETURN n.name, type(r), m.name LIMIT 30'},{label:"Graph Stats",query:"MATCH (n) RETURN labels(n)[0] AS type, count(n) AS count ORDER BY count DESC"}];function Cl(){const[n,i]=B.useState(""),[r,e]=B.useState("table"),[t,s]=B.useState(null),[o,a]=B.useState([]),[l,u]=B.useState(!1),[d,h]=B.useState(!0),f=B.useRef(null),b=Hi(),C=qi(),m=B.useCallback(()=>{n.trim()&&b.mutate({query:n.trim()},{onSuccess:k=>{s(k),a(T=>[{query:n.trim(),time:new Date().toLocaleTimeString(),success:!0},...T.slice(0,19)]),ge.success("Query executed")},onError:()=>{a(k=>[{query:n.trim(),time:new Date().toLocaleTimeString(),success:!1},...k.slice(0,19)]),ge.error("Query failed")}})},[n,b]),w=B.useCallback(()=>{if(!n.trim()){ge.error("Describe what you want to query");return}C.mutate({query:n.trim()},{onSuccess:k=>{const T=k;T.cypher&&(i(String(T.cypher)),ge.success("Cypher generated by AI"))},onError:()=>ge.error("Failed to generate query")})},[n,C]),p=B.useCallback(k=>{(k.ctrlKey||k.metaKey)&&k.key==="Enter"&&(k.preventDefault(),m())},[m]),v=t?.nodes||[],g=t?.edges||[],y=t?.records||t?.rows||[],_=y.length>0?Object.keys(y[0]):[];return c.jsxs("div",{className:"h-full flex flex-col",children:[c.jsxs("div",{className:"shrink-0 border-b border-gm-border-primary",children:[c.jsxs("button",{onClick:()=>h(!d),className:"w-full flex items-center justify-between px-4 py-2 text-left",children:[c.jsx("span",{className:"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider",children:"Templates"}),d?c.jsx(Pr,{className:"w-3 h-3 text-gm-text-tertiary"}):c.jsx(Fr,{className:"w-3 h-3 text-gm-text-tertiary"})]}),d&&c.jsx("div",{className:"flex gap-1.5 px-4 pb-3 flex-wrap",children:El.map((k,T)=>c.jsx("button",{onClick:()=>i(k.query),className:"px-2.5 py-1 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-[10px] text-gm-text-primary hover:bg-gm-surface-hover hover:border-blue-600/30 transition-colors",children:k.label},T))})]}),c.jsx("div",{className:"shrink-0 p-4 border-b border-gm-border-primary",children:c.jsxs("div",{className:"relative",children:[c.jsx("textarea",{ref:f,value:n,onChange:k=>i(k.target.value),onKeyDown:p,rows:4,placeholder:"Enter Cypher query... (Ctrl+Enter to execute)\\n\\nOr describe what you want in natural language, then click AI Generate",className:"w-full bg-gm-surface-secondary border border-gm-border-primary rounded-xl px-4 py-3 text-xs text-gm-text-primary font-mono leading-relaxed resize-y focus:outline-none focus:ring-2 focus:ring-gm-border-focus placeholder:text-gray-500"}),c.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-1.5",children:[c.jsxs("button",{onClick:w,disabled:C.isPending||!n.trim(),className:"px-2.5 py-1 rounded-lg bg-blue-600/10 text-gm-interactive-primary text-[10px] font-medium hover:bg-blue-600/20 flex items-center gap-1 disabled:opacity-50 transition-colors",children:[C.isPending?c.jsx(fe,{className:"w-3 h-3 animate-spin"}):c.jsx(Lt,{className:"w-3 h-3"})," AI Generate"]}),c.jsxs("button",{onClick:m,disabled:b.isPending||!n.trim(),className:"px-2.5 py-1 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-[10px] font-medium hover:bg-gm-interactive-primary-hover flex items-center gap-1 disabled:opacity-50 transition-colors",children:[b.isPending?c.jsx(fe,{className:"w-3 h-3 animate-spin"}):c.jsx(ei,{className:"w-3 h-3"})," Execute"]})]})]})}),c.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[t&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-gm-border-primary shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-gm-text-tertiary",children:[y.length>0&&c.jsxs("span",{children:[y.length," records"]}),v.length>0&&c.jsxs("span",{children:[v.length," nodes"]}),g.length>0&&c.jsxs("span",{children:[g.length," edges"]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:()=>e("table"),className:ce("p-1 rounded",r==="table"?"bg-blue-600/10 text-gm-interactive-primary":"text-gm-text-tertiary"),children:c.jsx(ta,{className:"w-3.5 h-3.5"})}),c.jsx("button",{onClick:()=>e("json"),className:ce("p-1 rounded",r==="json"?"bg-blue-600/10 text-gm-interactive-primary":"text-gm-text-tertiary"),children:c.jsx(kt,{className:"w-3.5 h-3.5"})}),c.jsx("button",{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(t,null,2)),ge.success("Copied")},className:"p-1 rounded text-gm-text-tertiary hover:text-gm-text-primary",children:c.jsx(ti,{className:"w-3.5 h-3.5"})})]})]}),c.jsx("div",{className:"flex-1 overflow-auto p-4",children:r==="table"&&y.length>0?c.jsxs("table",{className:"w-full text-xs",children:[c.jsx("thead",{children:c.jsx("tr",{className:"border-b border-gm-border-primary",children:_.map(k=>c.jsx("th",{className:"py-1.5 px-2 text-left font-medium text-gm-text-tertiary text-[10px] uppercase",children:k},k))})}),c.jsx("tbody",{children:y.map((k,T)=>c.jsx("tr",{className:"border-b border-[var(--gm-border-primary)] hover:bg-[var(--gm-surface-hover)]",children:_.map(j=>c.jsx("td",{className:"py-1.5 px-2 text-gm-text-primary max-w-[200px] truncate",children:typeof k[j]=="object"?JSON.stringify(k[j]):String(k[j]??"")},j))},T))})]}):r==="json"||y.length===0?c.jsx("pre",{className:"text-[10px] text-gm-text-primary font-mono whitespace-pre-wrap leading-relaxed",children:JSON.stringify(t,null,2)}):null})]}),!t&&c.jsx("div",{className:"flex-1 flex items-center justify-center text-gm-text-tertiary",children:c.jsxs("div",{className:"text-center",children:[c.jsx(kt,{className:"w-10 h-10 mx-auto mb-3 text-gray-600"}),c.jsx("p",{className:"text-xs",children:"Write a Cypher query or use a template above"}),c.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Ctrl+Enter to execute"})]})})]}),o.length>0&&c.jsxs("div",{className:"shrink-0 border-t border-gm-border-primary",children:[c.jsxs("button",{onClick:()=>u(!l),className:"w-full flex items-center justify-between px-4 py-2",children:[c.jsxs("span",{className:"text-[10px] font-semibold text-gm-text-tertiary uppercase tracking-wider flex items-center gap-1",children:[c.jsx(Vn,{className:"w-3 h-3"})," History (",o.length,")"]}),l?c.jsx(Pr,{className:"w-3 h-3 text-gm-text-tertiary"}):c.jsx(Fr,{className:"w-3 h-3 text-gm-text-tertiary"})]}),l&&c.jsx("div",{className:"px-4 pb-3 max-h-32 overflow-y-auto space-y-1",children:o.map((k,T)=>c.jsxs("button",{onClick:()=>i(k.query),className:"w-full text-left flex items-center gap-2 px-2 py-1 rounded hover:bg-gm-surface-secondary transition-colors",children:[c.jsx("div",{className:ce("w-1.5 h-1.5 rounded-full shrink-0",k.success?"bg-gm-status-success":"bg-gm-status-danger")}),c.jsx("span",{className:"text-[10px] text-gm-text-primary font-mono truncate flex-1",children:k.query}),c.jsx("span",{className:"text-[10px] text-gm-text-tertiary shrink-0",children:k.time})]},T))})]})]})}function Sl(){const n=Vi(),i=$i(),r=Yi(),e=Zi(),t=n.data,s=t?.stats||t,o=Number(s?.nodeCount??s?.node_count??0),a=Number(s?.edgeCount??s?.edge_count??0),l=Number(s?.density??0),u=Number(s?.avgDegree??s?.avg_degree??0),d=s?.entityDistribution??s?.distribution??s?.byLabel??{},h=t?.recommendations||[],f=i.data?.communities||[],b=r.data?.nodes||[],C=e.data?.bridges||[],m=n.isLoading,w=Math.max(...Object.values(d),1);return m?c.jsx("div",{className:"flex items-center justify-center h-64",children:c.jsx(fe,{className:"h-8 w-8 animate-spin text-gm-interactive-primary"})}):c.jsxs("div",{className:"h-full overflow-y-auto p-5 space-y-5",children:[c.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[c.jsx(xt,{icon:ri,label:"Nodes",value:String(o),color:"text-gm-interactive-primary",bgColor:"bg-blue-600/10"}),c.jsx(xt,{icon:ni,label:"Edges",value:String(a),color:"text-purple-500",bgColor:"bg-purple-500/10"}),c.jsx(xt,{icon:ii,label:"Density",value:l.toFixed(4),color:"text-orange-500",bgColor:"bg-orange-500/10"}),c.jsx(xt,{icon:si,label:"Avg Degree",value:u.toFixed(2),color:"text-green-500",bgColor:"bg-green-500/10"})]}),Object.keys(d).length>0&&c.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-5",children:[c.jsxs("h3",{className:"text-xs font-semibold text-gm-text-tertiary uppercase tracking-wider mb-4 flex items-center gap-1.5",children:[c.jsx(kr,{className:"w-3.5 h-3.5"})," Entity Distribution"]}),c.jsx("div",{className:"space-y-2",children:Object.entries(d).sort(([,p],[,v])=>v-p).map(([p,v])=>{const g=v/w*100,y=Be[p]||"#64748b";return c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[c.jsx("span",{className:"font-medium",style:{color:y},children:p}),c.jsx("span",{className:"text-gm-text-tertiary font-mono",children:v})]}),c.jsx("div",{className:"w-full h-2 bg-gm-surface-secondary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${g}%`,backgroundColor:y}})})]},p)})})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-5",children:[c.jsxs("h3",{className:"text-xs font-semibold text-gm-text-tertiary uppercase tracking-wider mb-3 flex items-center gap-1.5",children:[c.jsx(_r,{className:"w-3.5 h-3.5"})," Key People",r.isLoading&&c.jsx(fe,{className:"w-3 h-3 animate-spin"})]}),b.length===0?c.jsx("p",{className:"text-xs text-gm-text-tertiary text-center py-4",children:"No centrality data"}):c.jsx("div",{className:"space-y-2",children:b.slice(0,10).map((p,v)=>{const g=String(p.name||p.label||p.id||""),y=Number(p.score||p.centrality||p.degree||0),_=String(p.type||p.label||"");return c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold text-white shrink-0",style:{backgroundColor:Be[_]||"#ec4899"},children:g.charAt(0).toUpperCase()}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-xs font-medium text-gm-text-primary truncate",children:g}),c.jsx("div",{className:"w-full h-1 bg-gm-surface-secondary rounded-full mt-0.5",children:c.jsx("div",{className:"h-full bg-pink-500 rounded-full",style:{width:`${Math.min(y*100,100)}%`}})})]}),c.jsx("span",{className:"text-[10px] text-gm-text-tertiary font-mono shrink-0",children:y.toFixed(3)})]},v)})})]}),c.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-5",children:[c.jsxs("h3",{className:"text-xs font-semibold text-gm-text-tertiary uppercase tracking-wider mb-3 flex items-center gap-1.5",children:[c.jsx(Zn,{className:"w-3.5 h-3.5"})," Bridge Nodes",e.isLoading&&c.jsx(fe,{className:"w-3 h-3 animate-spin"})]}),C.length===0?c.jsx("p",{className:"text-xs text-gm-text-tertiary text-center py-4",children:"No bridge data"}):c.jsx("div",{className:"space-y-2",children:C.slice(0,10).map((p,v)=>{const g=String(p.name||p.label||p.id||""),y=Number(p.score||p.betweenness||0),_=String(p.type||p.label||"");return c.jsxs("div",{className:"flex items-center gap-2 bg-[var(--gm-surface-hover)] rounded-lg p-2",children:[c.jsx("div",{className:"w-2 h-2 rounded-full shrink-0",style:{backgroundColor:Be[_]||"#64748b"}}),c.jsx("span",{className:"text-xs text-gm-text-primary truncate flex-1",children:g}),c.jsx("span",{className:"text-[10px] text-gm-text-tertiary capitalize",children:_}),c.jsx("span",{className:"text-[10px] text-gm-text-tertiary font-mono",children:y.toFixed(3)})]},v)})})]})]}),f.length>0&&c.jsxs("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl p-5",children:[c.jsxs("h3",{className:"text-xs font-semibold text-gm-text-tertiary uppercase tracking-wider mb-3 flex items-center gap-1.5",children:[c.jsx(Xi,{className:"w-3.5 h-3.5"})," Communities",i.isLoading&&c.jsx(fe,{className:"w-3 h-3 animate-spin"}),c.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-gm-surface-secondary",children:f.length})]}),c.jsx("div",{className:"grid grid-cols-3 gap-2",children:f.map((p,v)=>{const g=p.members||p.nodes||[],y=String(p.name||p.label||`Community ${v+1}`);return c.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-lg p-3",children:[c.jsx("p",{className:"text-xs font-medium text-gm-text-primary mb-1",children:y}),c.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[g.length," members"]}),c.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[g.slice(0,5).map((_,k)=>c.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-gm-surface-secondary text-gm-text-tertiary truncate max-w-[80px]",children:String(_.name||_.label||_.id||"")},k)),g.length>5&&c.jsxs("span",{className:"text-[9px] text-gm-text-tertiary",children:["+",g.length-5]})]})]},v)})})]}),h.length>0&&c.jsxs("div",{className:"bg-blue-600/5 border-l-[3px] border-gm-interactive-primary rounded-r-lg p-4",children:[c.jsxs("h3",{className:"text-[10px] font-semibold text-gm-interactive-primary uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[c.jsx(Lt,{className:"w-3.5 h-3.5"})," AI Recommendations"]}),c.jsx("ul",{className:"space-y-1.5",children:h.map((p,v)=>c.jsxs("li",{className:"text-xs text-gm-text-primary flex items-start gap-2",children:[c.jsx("span",{className:"text-gm-interactive-primary mt-0.5",children:"â€¢"})," ",p]},v))})]})]})}function xt({icon:n,label:i,value:r,color:e,bgColor:t}){return c.jsx("div",{className:"bg-gm-surface-primary border border-gm-border-primary rounded-xl px-4 py-3",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:ce("w-8 h-8 rounded-lg flex items-center justify-center",t),children:c.jsx(n,{className:ce("w-4 h-4",e)})}),c.jsxs("div",{children:[c.jsx("span",{className:ce("text-lg font-bold",e),children:r}),c.jsx("p",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider",children:i})]})]})})}const Tl=["Who are the key people in this project?","What are the main risks identified?","Show me connections between teams and documents","What decisions have been made recently?","Find all action items and their owners","What are the open questions?"];function Rl({open:n,onClose:i}){const[r,e]=B.useState([]),[t,s]=B.useState(""),[o,a]=B.useState(null),l=B.useRef(null),u=B.useRef(null),d=Ki();B.useEffect(()=>{n&&u.current&&u.current.focus()},[n]),B.useEffect(()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)},[r]);const h=B.useCallback(f=>{const b=(f||t).trim();if(!b)return;s("");const C={role:"user",content:b,timestamp:new Date().toLocaleTimeString()};e(m=>[...m,C]),d.mutate({query:b},{onSuccess:m=>{const w=m,p={role:"assistant",content:String(w.answer||w.response||"No answer generated."),cypher:w.cypherUsed?String(w.cypherUsed):void 0,sources:w.sources,reasoning:w.reasoning,timestamp:new Date().toLocaleTimeString()};e(v=>[...v,p])},onError:()=>{e(m=>[...m,{role:"assistant",content:"Failed to query the knowledge graph. Please try again.",timestamp:new Date().toLocaleTimeString()}])}})},[t,d]);return n?c.jsxs("div",{className:"fixed bottom-4 right-4 w-[min(384px,calc(100vw-2rem))] h-[min(600px,calc(100vh-6rem))] bg-gm-surface-primary border border-gm-border-primary rounded-2xl shadow-2xl z-50 flex flex-col overflow-hidden",children:[c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gradient-to-r from-blue-600/10 to-transparent border-b border-gm-border-primary shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-600/20 flex items-center justify-center",children:c.jsx(Lt,{className:"w-4 h-4 text-gm-interactive-primary"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-sm font-semibold text-gm-text-primary",children:"Graph Copilot"}),c.jsx("p",{className:"text-[10px] text-gm-text-tertiary",children:"Ask anything about your knowledge graph"})]})]}),c.jsx("button",{onClick:i,className:"p-1.5 rounded-lg hover:bg-gm-surface-secondary text-gm-text-tertiary hover:text-gm-text-primary transition-colors",children:c.jsx(it,{className:"w-4 h-4"})})]}),c.jsxs("div",{ref:l,className:"flex-1 overflow-y-auto p-4 space-y-3",children:[r.length===0&&c.jsxs("div",{className:"text-center py-6",children:[c.jsx(Qi,{className:"w-10 h-10 mx-auto mb-3 text-gray-600"}),c.jsx("p",{className:"text-xs text-gm-text-tertiary mb-4",children:"Ask me about your knowledge graph"}),c.jsx("div",{className:"space-y-1.5",children:Tl.map((f,b)=>c.jsx("button",{onClick:()=>h(f),className:"w-full text-left px-3 py-2 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-[10px] text-gm-text-primary hover:bg-gm-surface-hover hover:border-blue-600/30 transition-colors",children:f},b))})]}),r.map((f,b)=>c.jsx("div",{className:ce("flex",f.role==="user"?"justify-end":"justify-start"),children:c.jsxs("div",{className:ce("max-w-[85%] rounded-xl px-3 py-2",f.role==="user"?"bg-gm-interactive-primary text-gm-text-on-brand":"bg-gm-surface-secondary border border-gm-border-primary"),children:[c.jsx("p",{className:ce("text-xs leading-relaxed whitespace-pre-wrap",f.role==="user"?"":"text-gm-text-primary"),children:f.content}),f.reasoning&&f.reasoning.length>0&&c.jsxs("div",{className:"mt-2 pt-2 border-t border-[var(--gm-border-primary)]",children:[c.jsx("p",{className:"text-[9px] text-gm-text-tertiary font-semibold uppercase mb-1",children:"Reasoning"}),f.reasoning.map((C,m)=>c.jsxs("p",{className:"text-[10px] text-gm-text-tertiary flex items-start gap-1",children:[c.jsxs("span",{className:"text-gm-interactive-primary",children:[m+1,"."]})," ",C]},m))]}),f.cypher&&c.jsxs("div",{className:"mt-2",children:[c.jsxs("button",{onClick:()=>a(o===b?null:b),className:"text-[9px] text-gm-interactive-primary hover:underline flex items-center gap-1",children:[c.jsx(kt,{className:"w-3 h-3"})," ",o===b?"Hide":"Show"," Cypher"]}),o===b&&c.jsx("pre",{className:"mt-1 p-2 rounded bg-gm-surface-secondary text-[9px] text-gm-text-primary font-mono overflow-x-auto",children:f.cypher})]}),f.sources&&f.sources.length>0&&c.jsxs("div",{className:"mt-2 pt-2 border-t border-[var(--gm-border-primary)]",children:[c.jsxs("p",{className:"text-[9px] text-gm-text-tertiary font-semibold uppercase mb-1",children:["Sources (",f.sources.length,")"]}),f.sources.slice(0,3).map((C,m)=>c.jsx("p",{className:"text-[10px] text-gm-text-tertiary truncate",children:String(C.name||C.title||C.label||JSON.stringify(C).substring(0,60))},m))]}),c.jsx("p",{className:ce("text-[9px] mt-1",f.role==="user"?"text-white/50":"text-gray-500"),children:f.timestamp})]})},b)),d.isPending&&c.jsx("div",{className:"flex justify-start",children:c.jsxs("div",{className:"bg-gm-surface-secondary border border-gm-border-primary rounded-xl px-3 py-2 flex items-center gap-2",children:[c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin text-gm-interactive-primary"}),c.jsx("span",{className:"text-xs text-gm-text-tertiary",children:"Querying knowledge graph..."})]})})]}),c.jsx("div",{className:"shrink-0 px-4 py-3 border-t border-gm-border-primary bg-gm-surface-secondary",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{ref:u,value:t,onChange:f=>s(f.target.value),onKeyDown:f=>f.key==="Enter"&&!f.shiftKey&&h(),placeholder:"Ask about the knowledge graph...",className:"flex-1 bg-gm-surface-primary border border-gm-border-primary rounded-lg px-3 py-2 text-xs text-gm-text-primary placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-gm-border-focus"}),c.jsx("button",{onClick:()=>h(),disabled:d.isPending||!t.trim(),className:"w-8 h-8 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand flex items-center justify-center hover:bg-gm-interactive-primary-hover disabled:opacity-50 transition-colors",children:d.isPending?c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin"}):c.jsx(js,{className:"w-3.5 h-3.5"})})]})})]}):null}function _l(){const[n,i]=B.useState("connection"),[r,e]=B.useState({uri:"",username:"",password:"",database:""}),[t,s]=B.useState(null),o=Ji(),a=es(),l=ts(),u=rs(),d=ns(),h=is(),f=ss(),b=as(),C=os(),m=ls(),w=cs(),p=us(),v=hs(),g=ds(),y=o.data||{},_=a.data||{},k=l.data?.providers||[],T=u.data?.graphs||u.data||[],j=d.data||{},N=h.data||{},I=[{key:"connection",label:"Connection",icon:Or},{key:"management",label:"Management",icon:$n},{key:"graphs",label:"Graphs",icon:mt},{key:"status",label:"Status",icon:Ft}],U=()=>{f.mutate(r,{onSuccess:()=>{ge.success("Connected to graph database"),o.refetch(),a.refetch()},onError:()=>ge.error("Connection failed")})},D=()=>{b.mutate(r.uri?r:{},{onSuccess:F=>{F?.ok?ge.success("Connection test passed"):ge.warning("Connection test returned issues")},onError:()=>ge.error("Connection test failed")})},R=F=>{g.mutate(F,{onSuccess:()=>{ge.success(`Graph "${F}" deleted`),u.refetch(),s(null)},onError:()=>ge.error("Delete failed")})};return c.jsxs("div",{className:"h-full flex flex-col",children:[c.jsx("div",{className:"flex gap-1 px-4 border-b border-gm-border-primary bg-gm-surface-secondary shrink-0",children:I.map(F=>{const M=F.icon;return c.jsxs("button",{onClick:()=>i(F.key),className:ce("flex items-center gap-1.5 px-3 py-2 text-[10px] font-medium border-b-2 transition-colors",n===F.key?"border-gm-interactive-primary text-gm-interactive-primary":"border-transparent text-gm-text-tertiary hover:text-gm-text-primary"),children:[c.jsx(M,{className:"w-3 h-3"})," ",F.label]},F.key)})}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n==="connection"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[c.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary mb-3 flex items-center gap-1.5",children:[c.jsx(Ft,{className:"w-3.5 h-3.5"})," Current Connection"]}),o.isLoading?c.jsx(fe,{className:"w-4 h-4 animate-spin"}):c.jsxs("div",{className:"space-y-1.5 text-xs",children:[Object.entries(y).filter(([F])=>!F.toLowerCase().includes("password")).map(([F,M])=>c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-gm-text-tertiary capitalize",children:F.replace(/_/g," ")}),c.jsx("span",{className:"text-gm-text-primary font-medium",children:String(M??"â€”")})]},F)),Object.keys(y).length===0&&c.jsx("p",{className:"text-gm-text-tertiary",children:"No connection configured"})]})]}),k.length>0&&c.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[c.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary mb-3 flex items-center gap-1.5",children:[c.jsx(kr,{className:"w-3.5 h-3.5"})," Available Providers"]}),c.jsx("div",{className:"space-y-2",children:k.map((F,M)=>c.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c.jsx("div",{className:ce("w-2 h-2 rounded-full",F.available?"bg-gm-status-success":"bg-gm-text-tertiary")}),c.jsx("span",{className:"text-gm-text-primary font-medium",children:String(F.name||F.type||F.provider||"â€”")}),F.version&&c.jsxs("span",{className:"text-gm-text-tertiary",children:["v",String(F.version)]})]},M))})]}),c.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[c.jsx("h4",{className:"text-xs font-semibold text-gm-text-primary mb-3",children:"Connect to Graph Database"}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider",children:"URI"}),c.jsx("input",{value:r.uri,onChange:F=>e(M=>({...M,uri:F.target.value})),placeholder:"bolt://localhost:7687",className:"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider",children:"Username"}),c.jsx("input",{value:r.username,onChange:F=>e(M=>({...M,username:F.target.value})),placeholder:"neo4j",className:"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider",children:"Password"}),c.jsx("input",{type:"password",value:r.password,onChange:F=>e(M=>({...M,password:F.target.value})),className:"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-gm-text-tertiary uppercase tracking-wider",children:"Database"}),c.jsx("input",{value:r.database,onChange:F=>e(M=>({...M,database:F.target.value})),placeholder:"neo4j",className:"mt-1 w-full bg-gm-surface-secondary border border-gm-border-primary rounded-lg px-3 py-1.5 text-xs text-gm-text-primary focus:outline-none focus:ring-2 focus:ring-gm-border-focus"})]}),c.jsxs("div",{className:"flex gap-2 pt-1",children:[c.jsxs("button",{onClick:D,disabled:b.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[b.isPending?c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin"}):c.jsx(As,{className:"w-3.5 h-3.5"})," Test"]}),c.jsxs("button",{onClick:U,disabled:f.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[f.isPending?c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin"}):c.jsx(Or,{className:"w-3.5 h-3.5"})," Connect"]})]})]})]})]}),n==="management"&&c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[c.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary mb-3 flex items-center gap-1.5",children:[c.jsx(fs,{className:"w-3.5 h-3.5"})," Sync & Indexing"]}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsxs("button",{onClick:()=>C.mutate(void 0,{onSuccess:()=>ge.success("Full sync started")}),disabled:C.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[C.isPending?c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin"}):c.jsx(vr,{className:"w-3.5 h-3.5"})," Full Sync"]}),c.jsxs("button",{onClick:()=>w.mutate(void 0,{onSuccess:()=>ge.success("Indexes created")}),disabled:w.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[w.isPending?c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin"}):c.jsx(mt,{className:"w-3.5 h-3.5"})," Create Indexes"]}),c.jsxs("button",{onClick:()=>m.mutate(void 0,{onSuccess:()=>ge.success("Sync cleanup done")}),disabled:m.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[m.isPending?c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin"}):c.jsx(gs,{className:"w-3.5 h-3.5"})," Sync Cleanup"]})]})]}),c.jsxs("div",{className:"bg-[var(--gm-status-danger-bg)] rounded-xl p-4 border border-red-500/20",children:[c.jsxs("h4",{className:"text-xs font-semibold text-gm-status-danger mb-3 flex items-center gap-1.5",children:[c.jsx(yr,{className:"w-3.5 h-3.5"})," Cleanup Operations"]}),c.jsx("p",{className:"text-[10px] text-gm-text-tertiary mb-3",children:"These operations modify graph data. Use with caution."}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsxs("button",{onClick:()=>p.mutate(void 0,{onSuccess:F=>ge.success(`Cleaned ${F?.removed??""} orphan nodes`)}),disabled:p.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-status-warning-bg text-gm-status-warning text-xs font-medium hover:bg-yellow-500/20 disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[p.isPending?c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin"}):c.jsx(St,{className:"w-3.5 h-3.5"})," Clean Orphans"]}),c.jsxs("button",{onClick:()=>v.mutate(void 0,{onSuccess:F=>ge.success(`Merged ${F?.merged??""} duplicates`)}),disabled:v.isPending,className:"px-3 py-1.5 rounded-lg bg-gm-status-warning-bg text-gm-status-warning text-xs font-medium hover:bg-yellow-500/20 disabled:opacity-50 flex items-center gap-1.5 transition-colors",children:[v.isPending?c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin"}):c.jsx(St,{className:"w-3.5 h-3.5"})," Clean Duplicates"]})]})]}),c.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[c.jsx("h4",{className:"text-xs font-semibold text-gm-text-primary mb-3",children:"Sync Status"}),d.isLoading?c.jsx(fe,{className:"w-4 h-4 animate-spin"}):c.jsx("div",{className:"space-y-1.5 text-xs",children:Object.entries(j).filter(([,F])=>F!=null).slice(0,10).map(([F,M])=>c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{className:"text-gm-text-tertiary capitalize",children:F.replace(/_/g," ")}),c.jsx("span",{className:"text-gm-text-primary font-medium",children:typeof M=="boolean"?M?"âœ“":"âœ—":String(M)})]},F))})]})]}),n==="graphs"&&c.jsx("div",{className:"space-y-4",children:u.isLoading?c.jsx(fe,{className:"w-5 h-5 animate-spin text-gm-interactive-primary mx-auto"}):c.jsxs(c.Fragment,{children:[Array.isArray(T)&&T.length>0?c.jsx("div",{className:"space-y-2",children:T.map((F,M)=>{const G=String(F.name||F.graph||F.id||`graph-${M}`),E=Number(F.node_count||F.nodes||0),x=Number(F.edge_count||F.edges||0);return c.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary flex items-center gap-3",children:[c.jsx(mt,{className:"w-5 h-5 text-gm-interactive-primary shrink-0"}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-xs font-semibold text-gm-text-primary",children:G}),c.jsxs("p",{className:"text-[10px] text-gm-text-tertiary",children:[E," nodes Â· ",x," edges"]})]}),t===G?c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:()=>R(G),disabled:g.isPending,className:"px-2 py-1 rounded text-[10px] bg-gm-status-danger text-white font-medium",children:g.isPending?c.jsx(fe,{className:"w-3 h-3 animate-spin"}):"Confirm"}),c.jsx("button",{onClick:()=>s(null),className:"px-2 py-1 rounded text-[10px] bg-gm-surface-secondary text-gm-text-tertiary",children:"Cancel"})]}):c.jsx("button",{onClick:()=>s(G),className:"p-1.5 rounded-lg text-gm-text-tertiary hover:bg-gm-status-danger-bg hover:text-gm-status-danger transition-colors",children:c.jsx(St,{className:"w-3.5 h-3.5"})})]},M)})}):c.jsxs("div",{className:"text-center py-8",children:[c.jsx(mt,{className:"w-10 h-10 mx-auto mb-3 text-gray-600"}),c.jsx("p",{className:"text-xs text-gm-text-tertiary",children:"No graphs found"})]}),Object.keys(N).length>0&&c.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[c.jsx("h4",{className:"text-xs font-semibold text-gm-text-primary mb-3",children:"Multi-Graph Stats"}),c.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.entries(N).filter(([,F])=>typeof F=="number").slice(0,6).map(([F,M])=>c.jsxs("div",{className:"text-center",children:[c.jsx("p",{className:"text-lg font-bold text-gm-text-primary",children:String(M)}),c.jsx("p",{className:"text-[10px] text-gm-text-tertiary capitalize",children:F.replace(/_/g," ")})]},F))})]})]})}),n==="status"&&c.jsx("div",{className:"space-y-4",children:a.isLoading?c.jsx(fe,{className:"w-5 h-5 animate-spin text-gm-interactive-primary mx-auto"}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"bg-[var(--gm-surface-hover)] rounded-xl p-4 border border-gm-border-primary",children:[c.jsxs("h4",{className:"text-xs font-semibold text-gm-text-primary mb-3 flex items-center gap-1.5",children:[c.jsx(Ft,{className:"w-3.5 h-3.5"})," Graph Database Status"]}),c.jsxs("div",{className:"space-y-2 text-xs",children:[Object.entries(_).filter(([,F])=>F!=null).map(([F,M])=>c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-gm-text-tertiary capitalize",children:F.replace(/_/g," ")}),c.jsx("span",{className:ce("font-medium",M==="healthy"||M===!0||M==="connected"?"text-gm-status-success":M==="degraded"||M==="warning"?"text-gm-status-warning":M==="error"||M===!1||M==="disconnected"?"text-gm-status-danger":"text-gm-text-primary"),children:typeof M=="boolean"?M?c.jsx(Ls,{className:"w-3.5 h-3.5 inline"}):c.jsx(yr,{className:"w-3.5 h-3.5 inline"}):String(M)})]},F)),Object.keys(_).length===0&&c.jsx("p",{className:"text-gm-text-tertiary",children:"No status data available"})]})]}),c.jsxs("button",{onClick:()=>{a.refetch(),d.refetch(),o.refetch()},className:"px-3 py-1.5 rounded-lg bg-gm-surface-secondary border border-gm-border-primary text-gm-text-primary text-xs font-medium hover:bg-gm-surface-hover flex items-center gap-1.5 transition-colors",children:[c.jsx(vr,{className:"w-3.5 h-3.5"})," Refresh Status"]})]})})]})]})}var nr,wn;function kl(){if(wn)return nr;wn=1;var n=je();return nr=function(r){if(!n(r))throw new Error("graphology-utils/infer-type: expecting a valid graphology instance.");var e=r.type;return e!=="mixed"?e:r.directedSize===0&&r.undirectedSize===0||r.directedSize>0&&r.undirectedSize>0?"mixed":r.directedSize>0?"directed":"undirected"},nr}var ir,En;function Dr(){if(En)return ir;En=1;function n(i){if(typeof i!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=i}return typeof Symbol<"u"&&(n.prototype[Symbol.iterator]=function(){return this}),n.of=function(){var i=arguments,r=i.length,e=0;return new n(function(){return e>=r?{done:!0}:{done:!1,value:i[e++]}})},n.empty=function(){var i=new n(function(){return{done:!0}});return i},n.fromSequence=function(i){var r=0,e=i.length;return new n(function(){return r>=e?{done:!0}:{done:!1,value:i[r++]}})},n.is=function(i){return i instanceof n?!0:typeof i=="object"&&i!==null&&typeof i.next=="function"},ir=n,ir}var sr,Cn;function Nl(){if(Cn)return sr;Cn=1;var n=Dr(),i=At().getPointerArray;function r(e,t){arguments.length<2&&(t=e,e=Array);var s=i(t);this.size=0,this.length=t,this.dense=new s(t),this.sparse=new s(t),this.vals=new e(t)}return r.prototype.clear=function(){this.size=0},r.prototype.has=function(e){var t=this.sparse[e];return t<this.size&&this.dense[t]===e},r.prototype.get=function(e){var t=this.sparse[e];if(t<this.size&&this.dense[t]===e)return this.vals[t]},r.prototype.set=function(e,t){var s=this.sparse[e];return s<this.size&&this.dense[s]===e?(this.vals[s]=t,this):(this.dense[this.size]=e,this.sparse[e]=this.size,this.vals[this.size]=t,this.size++,this)},r.prototype.delete=function(e){var t=this.sparse[e];return t>=this.size||this.dense[t]!==e?!1:(t=this.dense[this.size-1],this.dense[this.sparse[e]]=t,this.sparse[t]=this.sparse[e],this.size--,!0)},r.prototype.forEach=function(e,t){t=arguments.length>1?t:this;for(var s=0;s<this.size;s++)e.call(t,this.vals[s],this.dense[s])},r.prototype.keys=function(){var e=this.size,t=this.dense,s=0;return new n(function(){if(s<e){var o=t[s];return s++,{value:o}}return{done:!0}})},r.prototype.values=function(){var e=this.size,t=this.vals,s=0;return new n(function(){if(s<e){var o=t[s];return s++,{value:o}}return{done:!0}})},r.prototype.entries=function(){var e=this.size,t=this.dense,s=this.vals,o=0;return new n(function(){if(o<e){var a=[t[o],s[o]];return o++,{value:a}}return{done:!0}})},typeof Symbol<"u"&&(r.prototype[Symbol.iterator]=r.prototype.entries),r.prototype.inspect=function(){for(var e=new Map,t=0;t<this.size;t++)e.set(this.dense[t],this.vals[t]);return Object.defineProperty(e,"constructor",{value:r,enumerable:!1}),e.length=this.length,this.vals.constructor!==Array&&(e.type=this.vals.constructor.name),e},typeof Symbol<"u"&&(r.prototype[Symbol.for("nodejs.util.inspect.custom")]=r.prototype.inspect),sr=r,sr}var ar,Sn;function jl(){if(Sn)return ar;Sn=1;var n=Dr(),i=At().getPointerArray;function r(e){var t=i(e);this.start=0,this.size=0,this.capacity=e,this.dense=new t(e),this.sparse=new t(e)}return r.prototype.clear=function(){this.start=0,this.size=0},r.prototype.has=function(e){if(this.size===0)return!1;var t=this.sparse[e],s=t<this.capacity&&t>=this.start&&t<this.start+this.size||t<(this.start+this.size)%this.capacity;return s&&this.dense[t]===e},r.prototype.enqueue=function(e){var t=this.sparse[e];if(this.size!==0){var s=t<this.capacity&&t>=this.start&&t<this.start+this.size||t<(this.start+this.size)%this.capacity;if(s&&this.dense[t]===e)return this}return t=(this.start+this.size)%this.capacity,this.dense[t]=e,this.sparse[e]=t,this.size++,this},r.prototype.dequeue=function(){if(this.size!==0){var e=this.start;this.size--,this.start++,this.start===this.capacity&&(this.start=0);var t=this.dense[e];return this.sparse[t]=this.capacity,t}},r.prototype.forEach=function(e,t){t=arguments.length>1?t:this;for(var s=this.capacity,o=this.size,a=this.start,l=0;l<o;)e.call(t,this.dense[a],l,this),a++,l++,a===s&&(a=0)},r.prototype.values=function(){var e=this.dense,t=this.capacity,s=this.size,o=this.start,a=0;return new n(function(){if(a>=s)return{done:!0};var l=e[o];return o++,a++,o===t&&(o=0),{value:l,done:!1}})},typeof Symbol<"u"&&(r.prototype[Symbol.iterator]=r.prototype.values),r.prototype.inspect=function(){var e=[];return this.forEach(function(t){e.push(t)}),Object.defineProperty(e,"constructor",{value:r,enumerable:!1}),e.capacity=this.capacity,e},typeof Symbol<"u"&&(r.prototype[Symbol.for("nodejs.util.inspect.custom")]=r.prototype.inspect),ar=r,ar}var or,Tn;function Al(){if(Tn)return or;Tn=1;function n(r){return function(e){return typeof e!="number"&&(e=e.length),Math.floor(r()*e)}}var i=n(Math.random);return i.createRandomIndex=n,or=i,or}var wt={},Rn;function Ll(){if(Rn)return wt;Rn=1;var n=At(),i=Xn(),r=lt().createEdgeWeightGetter,e=Symbol.for("nodejs.util.inspect.custom"),t={getEdgeWeight:"weight",keepDendrogram:!1,resolution:1};function s(a,l){l=i(l,t);var u=l.resolution,d=r(l.getEdgeWeight).fromEntry,h=(a.size-a.selfLoopCount)*2,f=n.getPointerArray(h),b=n.getPointerArray(a.order+1),C=l.getEdgeWeight?Float64Array:n.getPointerArray(a.size*2);this.C=a.order,this.M=0,this.E=h,this.U=0,this.resolution=u,this.level=0,this.graph=a,this.nodes=new Array(a.order),this.keepDendrogram=l.keepDendrogram,this.neighborhood=new b(h),this.weights=new C(h),this.loops=new C(a.order),this.starts=new f(a.order+1),this.belongings=new b(a.order),this.dendrogram=[],this.mapping=null,this.counts=new b(a.order),this.unused=new b(a.order),this.totalWeights=new C(a.order);var m={},w,p=0,v=0,g=this;a.forEachNode(function(y){g.nodes[p]=y,m[y]=p,v+=a.undirectedDegreeWithoutSelfLoops(y),g.starts[p]=v,g.belongings[p]=p,g.counts[p]=1,p++}),a.forEachEdge(function(y,_,k,T,j,N,I){if(w=d(y,_,k,T,j,N,I),k=m[k],T=m[T],g.M+=w,k===T)g.totalWeights[k]+=w*2,g.loops[k]=w*2;else{g.totalWeights[k]+=w,g.totalWeights[T]+=w;var U=--g.starts[k],D=--g.starts[T];g.neighborhood[U]=T,g.neighborhood[D]=k,g.weights[U]=w,g.weights[D]=w}}),this.starts[p]=this.E,this.keepDendrogram?this.dendrogram.push(this.belongings.slice()):this.mapping=this.belongings.slice()}s.prototype.isolate=function(a,l){var u=this.belongings[a];if(this.counts[u]===1)return u;var d=this.unused[--this.U],h=this.loops[a];return this.totalWeights[u]-=l+h,this.totalWeights[d]+=l+h,this.belongings[a]=d,this.counts[u]--,this.counts[d]++,d},s.prototype.move=function(a,l,u){var d=this.belongings[a],h=this.loops[a];this.totalWeights[d]-=l+h,this.totalWeights[u]+=l+h,this.belongings[a]=u;var f=this.counts[d]--===1;this.counts[u]++,f&&(this.unused[this.U++]=d)},s.prototype.computeNodeDegree=function(a){var l,u,d,h=0;for(l=this.starts[a],u=this.starts[a+1];l<u;l++)d=this.weights[l],h+=d;return h},s.prototype.expensiveIsolate=function(a){var l=this.computeNodeDegree(a);return this.isolate(a,l)},s.prototype.expensiveMove=function(a,l){var u=this.computeNodeDegree(a);this.move(a,u,l)},s.prototype.zoomOut=function(){var a=new Array(this.C-this.U),l={},u=this.nodes.length,d=0,h=0,f,b,C,m,w,p,v,g,y;for(f=0,C=this.C;f<C;f++)p=this.belongings[f],p in l||(l[p]=d,a[d]={adj:{},totalWeights:this.totalWeights[p],internalWeights:0},d++),this.belongings[f]=l[p];var _,k;if(this.keepDendrogram){for(_=this.dendrogram[this.level],k=new(n.getPointerArray(d))(u),f=0;f<u;f++)k[f]=this.belongings[_[f]];this.dendrogram.push(k)}else for(f=0;f<u;f++)this.mapping[f]=this.belongings[this.mapping[f]];for(f=0,C=this.C;f<C;f++)for(p=this.belongings[f],g=a[p],y=g.adj,g.internalWeights+=this.loops[f],b=this.starts[f],m=this.starts[f+1];b<m;b++){if(w=this.neighborhood[b],v=this.belongings[w],p===v){g.internalWeights+=this.weights[b];continue}v in y||(y[v]=0),y[v]+=this.weights[b]}for(this.C=d,w=0,p=0;p<d;p++){g=a[p],y=g.adj,p=+p,this.totalWeights[p]=g.totalWeights,this.loops[p]=g.internalWeights,this.counts[p]=1,this.starts[p]=w,this.belongings[p]=p;for(v in y)this.neighborhood[w]=+v,this.weights[w]=y[v],h++,w++}return this.starts[d]=h,this.E=h,this.U=0,this.level++,l},s.prototype.modularity=function(){var a,l,u,d,h,f=0,b=this.M*2,C=new Float64Array(this.C);for(u=0;u<this.C;u++)for(a=this.belongings[u],C[a]+=this.loops[u],d=this.starts[u],h=this.starts[u+1];d<h;d++)l=this.belongings[this.neighborhood[d]],a===l&&(C[a]+=this.weights[d]);for(u=0;u<this.C;u++)f+=C[u]/b-Math.pow(this.totalWeights[u]/b,2)*this.resolution;return f},s.prototype.delta=function(a,l,u,d){var h=this.M,f=this.totalWeights[d];return l+=this.loops[a],u/h-f*l*this.resolution/(2*h*h)},s.prototype.deltaWithOwnCommunity=function(a,l,u,d){var h=this.M,f=this.totalWeights[d];return l+=this.loops[a],u/h-(f-l)*l*this.resolution/(2*h*h)},s.prototype.fastDelta=function(a,l,u,d){var h=this.M,f=this.totalWeights[d];return l+=this.loops[a],u-l*f*this.resolution/(2*h)},s.prototype.fastDeltaWithOwnCommunity=function(a,l,u,d){var h=this.M,f=this.totalWeights[d];return l+=this.loops[a],u-l*(f-l)*this.resolution/(2*h)},s.prototype.bounds=function(a){return[this.starts[a],this.starts[a+1]]},s.prototype.project=function(){var a=this,l={};return a.nodes.slice(0,this.C).forEach(function(u,d){l[u]=Array.from(a.neighborhood.slice(a.starts[d],a.starts[d+1])).map(function(h){return a.nodes[h]})}),l},s.prototype.collect=function(a){arguments.length<1&&(a=this.level);var l={},u=this.keepDendrogram?this.dendrogram[a]:this.mapping,d,h;for(d=0,h=u.length;d<h;d++)l[this.nodes[d]]=u[d];return l},s.prototype.assign=function(a,l){arguments.length<2&&(l=this.level);var u=this.keepDendrogram?this.dendrogram[l]:this.mapping,d,h;for(d=0,h=u.length;d<h;d++)this.graph.setNodeAttribute(this.nodes[d],a,u[d])},s.prototype[e]=function(){var a={};Object.defineProperty(a,"constructor",{value:s,enumerable:!1}),a.C=this.C,a.M=this.M,a.E=this.E,a.U=this.U,a.resolution=this.resolution,a.level=this.level,a.nodes=this.nodes,a.starts=this.starts.slice(0,a.C+1);var l=["neighborhood","weights"],u=["counts","loops","belongings","totalWeights"],d=this;return l.forEach(function(h){a[h]=d[h].slice(0,a.E)}),u.forEach(function(h){a[h]=d[h].slice(0,a.C)}),a.unused=this.unused.slice(0,this.U),this.keepDendrogram?a.dendrogram=this.dendrogram:a.mapping=this.mapping,a};function o(a,l){l=i(l,t);var u=l.resolution,d=r(l.getEdgeWeight).fromEntry,h=(a.size-a.selfLoopCount)*2,f=n.getPointerArray(h),b=n.getPointerArray(a.order+1),C=l.getEdgeWeight?Float64Array:n.getPointerArray(a.size*2);this.C=a.order,this.M=0,this.E=h,this.U=0,this.resolution=u,this.level=0,this.graph=a,this.nodes=new Array(a.order),this.keepDendrogram=l.keepDendrogram,this.neighborhood=new b(h),this.weights=new C(h),this.loops=new C(a.order),this.starts=new f(a.order+1),this.offsets=new f(a.order),this.belongings=new b(a.order),this.dendrogram=[],this.counts=new b(a.order),this.unused=new b(a.order),this.totalInWeights=new C(a.order),this.totalOutWeights=new C(a.order);var m={},w,p=0,v=0,g=this;a.forEachNode(function(y){g.nodes[p]=y,m[y]=p,v+=a.outDegreeWithoutSelfLoops(y),g.starts[p]=v,v+=a.inDegreeWithoutSelfLoops(y),g.offsets[p]=v,g.belongings[p]=p,g.counts[p]=1,p++}),a.forEachEdge(function(y,_,k,T,j,N,I){if(w=d(y,_,k,T,j,N,I),k=m[k],T=m[T],g.M+=w,k===T)g.loops[k]+=w,g.totalInWeights[k]+=w,g.totalOutWeights[k]+=w;else{g.totalOutWeights[k]+=w,g.totalInWeights[T]+=w;var U=--g.starts[k],D=--g.offsets[T];g.neighborhood[U]=T,g.neighborhood[D]=k,g.weights[U]=w,g.weights[D]=w}}),this.starts[p]=this.E,this.keepDendrogram?this.dendrogram.push(this.belongings.slice()):this.mapping=this.belongings.slice()}return o.prototype.bounds=s.prototype.bounds,o.prototype.inBounds=function(a){return[this.offsets[a],this.starts[a+1]]},o.prototype.outBounds=function(a){return[this.starts[a],this.offsets[a]]},o.prototype.project=s.prototype.project,o.prototype.projectIn=function(){var a=this,l={};return a.nodes.slice(0,this.C).forEach(function(u,d){l[u]=Array.from(a.neighborhood.slice(a.offsets[d],a.starts[d+1])).map(function(h){return a.nodes[h]})}),l},o.prototype.projectOut=function(){var a=this,l={};return a.nodes.slice(0,this.C).forEach(function(u,d){l[u]=Array.from(a.neighborhood.slice(a.starts[d],a.offsets[d])).map(function(h){return a.nodes[h]})}),l},o.prototype.isolate=function(a,l,u){var d=this.belongings[a];if(this.counts[d]===1)return d;var h=this.unused[--this.U],f=this.loops[a];return this.totalInWeights[d]-=l+f,this.totalInWeights[h]+=l+f,this.totalOutWeights[d]-=u+f,this.totalOutWeights[h]+=u+f,this.belongings[a]=h,this.counts[d]--,this.counts[h]++,h},o.prototype.move=function(a,l,u,d){var h=this.belongings[a],f=this.loops[a];this.totalInWeights[h]-=l+f,this.totalInWeights[d]+=l+f,this.totalOutWeights[h]-=u+f,this.totalOutWeights[d]+=u+f,this.belongings[a]=d;var b=this.counts[h]--===1;this.counts[d]++,b&&(this.unused[this.U++]=h)},o.prototype.computeNodeInDegree=function(a){var l,u,d,h=0;for(l=this.offsets[a],u=this.starts[a+1];l<u;l++)d=this.weights[l],h+=d;return h},o.prototype.computeNodeOutDegree=function(a){var l,u,d,h=0;for(l=this.starts[a],u=this.offsets[a];l<u;l++)d=this.weights[l],h+=d;return h},o.prototype.expensiveMove=function(a,l){var u=this.computeNodeInDegree(a),d=this.computeNodeOutDegree(a);this.move(a,u,d,l)},o.prototype.zoomOut=function(){var a=new Array(this.C-this.U),l={},u=this.nodes.length,d=0,h=0,f,b,C,m,w,p,v,g,y,_,k,T,j;for(f=0,C=this.C;f<C;f++)p=this.belongings[f],p in l||(l[p]=d,a[d]={inAdj:{},outAdj:{},totalInWeights:this.totalInWeights[p],totalOutWeights:this.totalOutWeights[p],internalWeights:0},d++),this.belongings[f]=l[p];var N,I;if(this.keepDendrogram){for(N=this.dendrogram[this.level],I=new(n.getPointerArray(d))(u),f=0;f<u;f++)I[f]=this.belongings[N[f]];this.dendrogram.push(I)}else for(f=0;f<u;f++)this.mapping[f]=this.belongings[this.mapping[f]];for(f=0,C=this.C;f<C;f++)for(p=this.belongings[f],y=this.offsets[f],g=a[p],T=g.inAdj,j=g.outAdj,g.internalWeights+=this.loops[f],b=this.starts[f],m=this.starts[f+1];b<m;b++){if(w=this.neighborhood[b],v=this.belongings[w],_=b<y,k=_?j:T,p===v){_&&(g.internalWeights+=this.weights[b]);continue}v in k||(k[v]=0),k[v]+=this.weights[b]}for(this.C=d,w=0,p=0;p<d;p++){g=a[p],T=g.inAdj,j=g.outAdj,p=+p,this.totalInWeights[p]=g.totalInWeights,this.totalOutWeights[p]=g.totalOutWeights,this.loops[p]=g.internalWeights,this.counts[p]=1,this.starts[p]=w,this.belongings[p]=p;for(v in j)this.neighborhood[w]=+v,this.weights[w]=j[v],h++,w++;this.offsets[p]=w;for(v in T)this.neighborhood[w]=+v,this.weights[w]=T[v],h++,w++}return this.starts[d]=h,this.E=h,this.U=0,this.level++,l},o.prototype.modularity=function(){var a,l,u,d,h,f=0,b=this.M,C=new Float64Array(this.C);for(u=0;u<this.C;u++)for(a=this.belongings[u],C[a]+=this.loops[u],d=this.starts[u],h=this.offsets[u];d<h;d++)l=this.belongings[this.neighborhood[d]],a===l&&(C[a]+=this.weights[d]);for(u=0;u<this.C;u++)f+=C[u]/b-this.totalInWeights[u]*this.totalOutWeights[u]/Math.pow(b,2)*this.resolution;return f},o.prototype.delta=function(a,l,u,d,h){var f=this.M,b=this.totalInWeights[h],C=this.totalOutWeights[h],m=this.loops[a];return l+=m,u+=m,d/f-(u*b+l*C)*this.resolution/(f*f)},o.prototype.deltaWithOwnCommunity=function(a,l,u,d,h){var f=this.M,b=this.totalInWeights[h],C=this.totalOutWeights[h],m=this.loops[a];return l+=m,u+=m,d/f-(u*(b-l)+l*(C-u))*this.resolution/(f*f)},o.prototype.collect=s.prototype.collect,o.prototype.assign=s.prototype.assign,o.prototype[e]=function(){var a={};Object.defineProperty(a,"constructor",{value:o,enumerable:!1}),a.C=this.C,a.M=this.M,a.E=this.E,a.U=this.U,a.resolution=this.resolution,a.level=this.level,a.nodes=this.nodes,a.starts=this.starts.slice(0,a.C+1);var l=["neighborhood","weights"],u=["counts","offsets","loops","belongings","totalInWeights","totalOutWeights"],d=this;return l.forEach(function(h){a[h]=d[h].slice(0,a.E)}),u.forEach(function(h){a[h]=d[h].slice(0,a.C)}),a.unused=this.unused.slice(0,this.U),this.keepDendrogram?a.dendrogram=this.dendrogram:a.mapping=this.mapping,a},wt.UndirectedLouvainIndex=s,wt.DirectedLouvainIndex=o,wt}var lr,_n;function Dl(){if(_n)return lr;_n=1;var n=Xn(),i=je(),r=kl(),e=Nl(),t=jl(),s=Al().createRandomIndex,o=Ll(),a=o.UndirectedLouvainIndex,l=o.DirectedLouvainIndex,u={nodeCommunityAttribute:"community",getEdgeWeight:"weight",fastLocalMoves:!0,randomWalk:!0,resolution:1,rng:Math.random};function d(p,v,g){var y=p.get(v);typeof y>"u"&&(y=0),y+=g,p.set(v,y)}var h=1e-10;function f(p,v,g,y,_){return Math.abs(y-_)<h?p===v?!1:g>p:y>_}function b(p,v,g){var y=new a(v,{getEdgeWeight:g.getEdgeWeight,keepDendrogram:p,resolution:g.resolution}),_=s(g.rng),k=!0,T=!0,j,N,I=new e(Float64Array,y.C),U,D,R,F,M,G,E,x,V,W,L,S,A,z,Z,K,re=0,$=0,ae=[],X,ne;for(g.fastLocalMoves&&(U=new t(y.C));k;){if(W=y.C,k=!1,T=!0,g.fastLocalMoves){for(ne=0,G=g.randomWalk?_(W):0,E=0;E<W;E++,G++)x=G%W,U.enqueue(x);for(;U.size!==0;){for(x=U.dequeue(),$++,L=0,I.clear(),j=y.belongings[x],D=y.starts[x],R=y.starts[x+1];D<R;D++)V=y.neighborhood[D],F=y.weights[D],N=y.belongings[V],L+=F,d(I,N,F);for(z=y.fastDeltaWithOwnCommunity(x,L,I.get(j)||0,j),A=j,M=0;M<I.size;M++)N=I.dense[M],N!==j&&(S=I.vals[M],re++,K=y.fastDelta(x,L,S,N),Z=f(A,j,N,K,z),Z&&(z=K,A=N));if(z<0){if(A=y.isolate(x,L),A===j)continue}else{if(A===j)continue;y.move(x,L,A)}for(k=!0,ne++,D=y.starts[x],R=y.starts[x+1];D<R;D++)V=y.neighborhood[D],N=y.belongings[V],N!==A&&U.enqueue(V)}ae.push(ne)}else for(X=[],ae.push(X);T;){for(T=!1,ne=0,G=g.randomWalk?_(W):0,E=0;E<W;E++,G++){for(x=G%W,$++,L=0,I.clear(),j=y.belongings[x],D=y.starts[x],R=y.starts[x+1];D<R;D++)V=y.neighborhood[D],F=y.weights[D],N=y.belongings[V],L+=F,d(I,N,F);for(z=y.fastDeltaWithOwnCommunity(x,L,I.get(j)||0,j),A=j,M=0;M<I.size;M++)N=I.dense[M],N!==j&&(S=I.vals[M],re++,K=y.fastDelta(x,L,S,N),Z=f(A,j,N,K,z),Z&&(z=K,A=N));if(z<0){if(A=y.isolate(x,L),A===j)continue}else{if(A===j)continue;y.move(x,L,A)}T=!0,ne++}X.push(ne),k=T||k}k&&y.zoomOut()}var J={index:y,deltaComputations:re,nodesVisited:$,moves:ae};return J}function C(p,v,g){var y=new l(v,{getEdgeWeight:g.getEdgeWeight,keepDendrogram:p,resolution:g.resolution}),_=s(g.rng),k=!0,T=!0,j,N,I=new e(Float64Array,y.C),U,D,R,F,M,G,E,x,V,W,L,S,A,z,Z,K,re,$,ae,X=0,ne=0,J=[],le,Y;for(g.fastLocalMoves&&(U=new t(y.C));k;){if(S=y.C,k=!1,T=!0,g.fastLocalMoves){for(Y=0,x=g.randomWalk?_(S):0,V=0;V<S;V++,x++)W=x%S,U.enqueue(W);for(;U.size!==0;){for(W=U.dequeue(),ne++,A=0,z=0,I.clear(),j=y.belongings[W],D=y.starts[W],R=y.starts[W+1],F=y.offsets[W];D<R;D++)M=D<F,L=y.neighborhood[D],G=y.weights[D],N=y.belongings[L],M?z+=G:A+=G,d(I,N,G);for(re=y.deltaWithOwnCommunity(W,A,z,I.get(j)||0,j),K=j,E=0;E<I.size;E++)N=I.dense[E],N!==j&&(Z=I.vals[E],X++,ae=y.delta(W,A,z,Z,N),$=f(K,j,N,ae,re),$&&(re=ae,K=N));if(re<0){if(K=y.isolate(W,A,z),K===j)continue}else{if(K===j)continue;y.move(W,A,z,K)}for(k=!0,Y++,D=y.starts[W],R=y.starts[W+1];D<R;D++)L=y.neighborhood[D],N=y.belongings[L],N!==K&&U.enqueue(L)}J.push(Y)}else for(le=[],J.push(le);T;){for(T=!1,Y=0,x=g.randomWalk?_(S):0,V=0;V<S;V++,x++){for(W=x%S,ne++,A=0,z=0,I.clear(),j=y.belongings[W],D=y.starts[W],R=y.starts[W+1],F=y.offsets[W];D<R;D++)M=D<F,L=y.neighborhood[D],G=y.weights[D],N=y.belongings[L],M?z+=G:A+=G,d(I,N,G);for(re=y.deltaWithOwnCommunity(W,A,z,I.get(j)||0,j),K=j,E=0;E<I.size;E++)N=I.dense[E],N!==j&&(Z=I.vals[E],X++,ae=y.delta(W,A,z,Z,N),$=f(K,j,N,ae,re),$&&(re=ae,K=N));if(re<0){if(K=y.isolate(W,A,z),K===j)continue}else{if(K===j)continue;y.move(W,A,z,K)}T=!0,Y++}le.push(Y),k=T||k}k&&y.zoomOut()}var q={index:y,deltaComputations:X,nodesVisited:ne,moves:J};return q}function m(p,v,g,y){if(!i(g))throw new Error("graphology-communities-louvain: the given graph is not a valid graphology instance.");var _=r(g);if(_==="mixed")throw new Error("graphology-communities-louvain: cannot run the algorithm on a true mixed graph.");y=n(y,u);var k=0;if(g.size===0){if(p){g.forEachNode(function(D){g.setNodeAttribute(D,y.nodeCommunityAttribute,k++)});return}var T={};return g.forEachNode(function(D){T[D]=k++}),v?{communities:T,count:g.order,deltaComputations:0,dendrogram:null,level:0,modularity:NaN,moves:null,nodesVisited:0,resolution:y.resolution}:T}var j=_==="undirected"?b:C,N=j(v,g,y),I=N.index;if(!v){if(p){I.assign(y.nodeCommunityAttribute);return}return I.collect()}var U={count:I.C,deltaComputations:N.deltaComputations,dendrogram:I.dendrogram,level:I.level,modularity:I.modularity(),moves:N.moves,nodesVisited:N.nodesVisited,resolution:y.resolution};return p?(I.assign(y.nodeCommunityAttribute),U):(U.communities=I.collect(),U)}var w=m.bind(null,!1,!1);return w.assign=m.bind(null,!0,!1),w.detailed=m.bind(null,!1,!0),w.defaults=u,lr=w,lr}var Il=Dl();const Pl=st(Il);var Re={},Ue={},Et={},kn;function Fl(){return kn||(kn=1,Et.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u",Et.SYMBOL_SUPPORT=typeof Symbol<"u"),Et}var cr,Nn;function Ir(){if(Nn)return cr;Nn=1;var n=Fl(),i=n.ARRAY_BUFFER_SUPPORT,r=n.SYMBOL_SUPPORT;return cr=function(t,s){var o,a,l,u,d;if(!t)throw new Error("obliterator/forEach: invalid iterable.");if(typeof s!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(t)||i&&ArrayBuffer.isView(t)||typeof t=="string"||t.toString()==="[object Arguments]"){for(l=0,u=t.length;l<u;l++)s(t[l],l);return}if(typeof t.forEach=="function"){t.forEach(s);return}if(r&&Symbol.iterator in t&&typeof t.next!="function"&&(t=t[Symbol.iterator]()),typeof t.next=="function"){for(o=t,l=0;d=o.next(),d.done!==!0;)s(d.value,l),l++;return}for(a in t)t.hasOwnProperty(a)&&s(t[a],a)},cr}var ur,jn;function zl(){if(jn)return ur;jn=1;var n=Dr(),i=Ir();function r(){this.clear()}return r.prototype.clear=function(){this.items=[],this.offset=0,this.size=0},r.prototype.enqueue=function(e){return this.items.push(e),++this.size},r.prototype.dequeue=function(){if(this.size){var e=this.items[this.offset];return++this.offset*2>=this.items.length&&(this.items=this.items.slice(this.offset),this.offset=0),this.size--,e}},r.prototype.peek=function(){if(this.size)return this.items[this.offset]},r.prototype.forEach=function(e,t){t=arguments.length>1?t:this;for(var s=this.offset,o=0,a=this.items.length;s<a;s++,o++)e.call(t,this.items[s],o,this)},r.prototype.toArray=function(){return this.items.slice(this.offset)},r.prototype.values=function(){var e=this.items,t=this.offset;return new n(function(){if(t>=e.length)return{done:!0};var s=e[t];return t++,{value:s,done:!1}})},r.prototype.entries=function(){var e=this.items,t=this.offset,s=0;return new n(function(){if(t>=e.length)return{done:!0};var o=e[t];return t++,{value:[s++,o],done:!1}})},typeof Symbol<"u"&&(r.prototype[Symbol.iterator]=r.prototype.values),r.prototype.toString=function(){return this.toArray().join(",")},r.prototype.toJSON=function(){return this.toArray()},r.prototype.inspect=function(){var e=this.toArray();return Object.defineProperty(e,"constructor",{value:r,enumerable:!1}),e},typeof Symbol<"u"&&(r.prototype[Symbol.for("nodejs.util.inspect.custom")]=r.prototype.inspect),r.from=function(e){var t=new r;return i(e,function(s){t.enqueue(s)}),t},r.of=function(){return r.from(arguments)},ur=r,ur}var hr,An;function Ol(){return An||(An=1,hr=function(i,r){var e=r.length;if(e!==0){var t=i.length;i.length+=e;for(var s=0;s<e;s++)i[t+s]=r[s]}}),hr}var Ln;function Gl(){if(Ln)return Ue;Ln=1;var n=je(),i=zl(),r=Ol();function e(u,d,h){if(!n(u))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<3)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 3.");if(!u.hasNode(d))throw new Error('graphology-shortest-path: the "'+d+'" source node does not exist in the given graph.');if(!u.hasNode(h))throw new Error('graphology-shortest-path: the "'+h+'" target node does not exist in the given graph.');if(d=""+d,h=""+h,d===h)return[d];var f=u.inboundNeighbors.bind(u),b=u.outboundNeighbors.bind(u),C={},m={};C[d]=null,m[h]=null;var w=[d],p=[h],v,g,y,_,k,T,j,N,I=!1;e:for(;w.length&&p.length;)if(w.length<=p.length){for(v=w,w=[],k=0,j=v.length;k<j;k++)for(g=v[k],y=b(g),T=0,N=y.length;T<N;T++)if(_=y[T],_ in C||(w.push(_),C[_]=g),_ in m){I=!0;break e}}else for(v=p,p=[],k=0,j=v.length;k<j;k++)for(g=v[k],y=f(g),T=0,N=y.length;T<N;T++)if(_=y[T],_ in m||(p.push(_),m[_]=g),_ in C){I=!0;break e}if(!I)return null;for(var U=[];_;)U.unshift(_),_=C[_];for(_=m[U[U.length-1]];_;)U.push(_),_=m[_];return U.length?U:null}function t(u,d){if(!n(u))throw new Error("graphology-shortest-path: invalid graphology instance.");if(arguments.length<2)throw new Error("graphology-shortest-path: invalid number of arguments. Expecting at least 2.");if(!u.hasNode(d))throw new Error('graphology-shortest-path: the "'+d+'" source node does not exist in the given graph.');d=""+d;var h={},f={},b,C,m,w,p,v;for(h[d]=!0,f[d]=[d];Object.keys(h).length;){b=h,h={};for(m in b)for(C=u.outboundNeighbors(m),p=0,v=C.length;p<v;p++)w=C[p],f[w]||(f[w]=f[m].concat(w),h[w]=!0)}return f}function s(u,d,h){if(!n(d))throw new Error("graphology-shortest-path: invalid graphology instance.");if(!d.hasNode(h))throw new Error('graphology-shortest-path: the "'+h+'" source node does not exist in the given graph.');h=""+h;var f=new Set,b={},C=0;b[h]=0;for(var m=[h],w,p,v;m.length!==0;){var g=[];for(w=0,p=m.length;w<p;w++)v=m[w],!f.has(v)&&(f.add(v),r(g,d[u](v)),b[v]=C);C++,m=g}return b}var o=s.bind(null,"outboundNeighbors"),a=s.bind(null,"neighbors");function l(u,d){d=""+d;var h=[],f={},b={},C=u.nodes(),m,w,p,v,g,y,_,k,T;for(y=0,k=C.length;y<k;y++)v=C[y],f[v]=[],b[v]=0;var j={};b[d]=1,j[d]=0;for(var N=i.of(d);N.size;)for(v=N.dequeue(),h.push(v),m=j[v],w=b[v],p=u.outboundNeighbors(v),_=0,T=p.length;_<T;_++)g=p[_],g in j||(N.enqueue(g),j[g]=m+1),j[g]===m+1&&(b[g]+=w,f[g].push(v));return[h,f,b]}return Ue.bidirectional=e,Ue.singleSource=t,Ue.singleSourceLength=o,Ue.undirectedSingleSourceLength=a,Ue.brandes=l,Ue}var dr={},Dn;function Ul(){if(Dn)return dr;Dn=1;var n=function(){return!0};return dr.edgePathFromNodePath=function(i,r){var e=r.length,t,s,o,a;if(e<2)return s=r[0],a=i.multi?i.findEdge(s,s,n):i.edge(s,s),a?[a]:[];e--;var l=new Array(e);for(t=0;t<e;t++){if(s=r[t],o=r[t+1],a=i.multi?i.findOutboundEdge(s,o,n):i.edge(s,o),a===void 0)throw new Error("graphology-shortest-path: given path is impossible in given graph.");l[t]=a}return l},dr}var rt={},Me={},In;function Bl(){if(In)return Me;In=1;var n=function(t,s){return t<s?-1:t>s?1:0},i=function(t,s){return t<s?1:t>s?-1:0};function r(t){return function(s,o){return t(o,s)}}function e(t){return t===2?function(s,o){return s[0]<o[0]?-1:s[0]>o[0]?1:s[1]<o[1]?-1:s[1]>o[1]?1:0}:function(s,o){for(var a=0;a<t;){if(s[a]<o[a])return-1;if(s[a]>o[a])return 1;a++}return 0}}return Me.DEFAULT_COMPARATOR=n,Me.DEFAULT_REVERSE_COMPARATOR=i,Me.reverseComparator=r,Me.createTupleComparator=e,Me}var We={},Pn;function Ml(){if(Pn)return We;Pn=1;var n=Ir(),i=At();function r(o){return Array.isArray(o)||i.isTypedArray(o)}function e(o){if(typeof o.length=="number")return o.length;if(typeof o.size=="number")return o.size}function t(o){var a=e(o),l=typeof a=="number"?new Array(a):[],u=0;return n(o,function(d){l[u++]=d}),l}function s(o){var a=e(o),l=typeof a=="number"?i.getPointerArray(a):Array,u=typeof a=="number"?new Array(a):[],d=typeof a=="number"?new l(a):[],h=0;return n(o,function(f){u[h]=f,d[h]=h++}),[u,d]}return We.isArrayLike=r,We.guessLength=e,We.toArray=t,We.toArrayWithIndices=s,We}var fr,Fn;function Ui(){if(Fn)return fr;Fn=1;var n=Ir(),i=Bl(),r=Ml(),e=i.DEFAULT_COMPARATOR,t=i.reverseComparator;function s(p,v,g,y){for(var _=v[y],k,T;y>g;){if(k=y-1>>1,T=v[k],p(_,T)<0){v[y]=T,y=k;continue}break}v[y]=_}function o(p,v,g){for(var y=v.length,_=g,k=v[g],T=2*g+1,j;T<y;)j=T+1,j<y&&p(v[T],v[j])>=0&&(T=j),v[g]=v[T],g=T,T=2*g+1;v[g]=k,s(p,v,_,g)}function a(p,v,g){v.push(g),s(p,v,0,v.length-1)}function l(p,v){var g=v.pop();if(v.length!==0){var y=v[0];return v[0]=g,o(p,v,0),y}return g}function u(p,v,g){if(v.length===0)throw new Error("mnemonist/heap.replace: cannot pop an empty heap.");var y=v[0];return v[0]=g,o(p,v,0),y}function d(p,v,g){var y;return v.length!==0&&p(v[0],g)<0&&(y=v[0],v[0]=g,g=y,o(p,v,0)),g}function h(p,v){for(var g=v.length,y=g>>1,_=y;--_>=0;)o(p,v,_)}function f(p,v){for(var g=v.length,y=0,_=new Array(g);y<g;)_[y++]=l(p,v);return _}function b(p,v,g){arguments.length===2&&(g=v,v=p,p=e);var y=t(p),_,k,T,j=1/0,N;if(v===1){if(r.isArrayLike(g)){for(_=0,k=g.length;_<k;_++)T=g[_],(j===1/0||p(T,j)<0)&&(j=T);return N=new g.constructor(1),N[0]=j,N}return n(g,function(U){(j===1/0||p(U,j)<0)&&(j=U)}),[j]}if(r.isArrayLike(g)){if(v>=g.length)return g.slice().sort(p);for(N=g.slice(0,v),h(y,N),_=v,k=g.length;_<k;_++)y(g[_],N[0])>0&&u(y,N,g[_]);return N.sort(p)}var I=r.guessLength(g);return I!==null&&I<v&&(v=I),N=new Array(v),_=0,n(g,function(U){_<v?N[_]=U:(_===v&&h(y,N),y(U,N[0])>0&&u(y,N,U)),_++}),N.length>_&&(N.length=_),N.sort(p)}function C(p,v,g){arguments.length===2&&(g=v,v=p,p=e);var y=t(p),_,k,T,j=-1/0,N;if(v===1){if(r.isArrayLike(g)){for(_=0,k=g.length;_<k;_++)T=g[_],(j===-1/0||p(T,j)>0)&&(j=T);return N=new g.constructor(1),N[0]=j,N}return n(g,function(U){(j===-1/0||p(U,j)>0)&&(j=U)}),[j]}if(r.isArrayLike(g)){if(v>=g.length)return g.slice().sort(y);for(N=g.slice(0,v),h(p,N),_=v,k=g.length;_<k;_++)p(g[_],N[0])>0&&u(p,N,g[_]);return N.sort(y)}var I=r.guessLength(g);return I!==null&&I<v&&(v=I),N=new Array(v),_=0,n(g,function(U){_<v?N[_]=U:(_===v&&h(p,N),p(U,N[0])>0&&u(p,N,U)),_++}),N.length>_&&(N.length=_),N.sort(y)}function m(p){if(this.clear(),this.comparator=p||e,typeof this.comparator!="function")throw new Error("mnemonist/Heap.constructor: given comparator should be a function.")}m.prototype.clear=function(){this.items=[],this.size=0},m.prototype.push=function(p){return a(this.comparator,this.items,p),++this.size},m.prototype.peek=function(){return this.items[0]},m.prototype.pop=function(){return this.size!==0&&this.size--,l(this.comparator,this.items)},m.prototype.replace=function(p){return u(this.comparator,this.items,p)},m.prototype.pushpop=function(p){return d(this.comparator,this.items,p)},m.prototype.consume=function(){return this.size=0,f(this.comparator,this.items)},m.prototype.toArray=function(){return f(this.comparator,this.items.slice())},m.prototype.inspect=function(){var p=this.toArray();return Object.defineProperty(p,"constructor",{value:m,enumerable:!1}),p},typeof Symbol<"u"&&(m.prototype[Symbol.for("nodejs.util.inspect.custom")]=m.prototype.inspect);function w(p){if(this.clear(),this.comparator=p||e,typeof this.comparator!="function")throw new Error("mnemonist/MaxHeap.constructor: given comparator should be a function.");this.comparator=t(this.comparator)}return w.prototype=m.prototype,m.from=function(p,v){var g=new m(v),y;return r.isArrayLike(p)?y=p.slice():y=r.toArray(p),h(g.comparator,y),g.items=y,g.size=y.length,g},w.from=function(p,v){var g=new w(v),y;return r.isArrayLike(p)?y=p.slice():y=r.toArray(p),h(g.comparator,y),g.items=y,g.size=y.length,g},m.siftUp=o,m.siftDown=s,m.push=a,m.pop=l,m.replace=u,m.pushpop=d,m.heapify=h,m.consume=f,m.nsmallest=b,m.nlargest=C,m.MinHeap=m,m.MaxHeap=w,fr=m,fr}var zn;function Wl(){if(zn)return rt;zn=1;var n=je(),i=lt().createEdgeWeightGetter,r=Ui(),e="weight";function t(h,f){return h[0]>f[0]?1:h[0]<f[0]?-1:h[1]>f[1]?1:h[1]<f[1]?-1:h[2]>f[2]?1:h[2]<f[2]?-1:0}function s(h,f){return h[0]>f[0]?1:h[0]<f[0]?-1:h[1]>f[1]?1:h[1]<f[1]?-1:h[2]>f[2]?1:h[2]<f[2]?-1:h[3]>f[3]?1:h[3]<f[3]?-1:0}function o(h,f,b,C){if(f=""+f,b=""+b,!n(h))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");if(f&&!h.hasNode(f))throw new Error('graphology-shortest-path/dijkstra: the "'+f+'" source node does not exist in the given graph.');if(b&&!h.hasNode(b))throw new Error('graphology-shortest-path/dijkstra: the "'+b+'" target node does not exist in the given graph.');if(C=i(C||e).fromMinimalEntry,f===b)return[0,[f]];var m=[{},{}],w=[{},{}],p=[new r(t),new r(t)],v=[{},{}];w[0][f]=[f],w[1][b]=[b],v[0][f]=0,v[1][b]=0;var g=[],y=1/0,_=0,k=1,T,j,N,I,U,D,R,F,M;for(p[0].push([0,_++,f]),p[1].push([0,_++,b]);p[0].size&&p[1].size;)if(k=1-k,T=p[k].pop(),I=T[0],U=T[2],!(U in m[k])){if(m[k][U]=I,U in m[1-k])return[y,g];for(j=k===1?h.inboundEdges(U):h.outboundEdges(U),F=0,M=j.length;F<M;F++){if(R=j[F],D=h.opposite(U,R),N=m[k][U]+C(R,h.getEdgeAttributes(R)),D in m[k]&&N<m[k][D])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(D in v[k])||N<v[k][D])&&(v[k][D]=N,p[k].push([N,_++,D]),w[k][D]=w[k][U].concat(D),D in v[0]&&D in v[1]&&(I=v[0][D]+v[1][D],(g.length===0||y>I)&&(y=I,g=w[0][D].concat(w[1][D].slice(0,-1).reverse()))))}}return[1/0,null]}function a(h,f,b,C,m,w){if(!n(h))throw new Error("graphology-shortest-path/dijkstra: invalid graphology instance.");b=i(b||e).fromMinimalEntry;var p={},v={},g=new r(t),y=0,_,k,T,j,N,I,U,D,R,F,M;for(D=0,F=f.length;D<F;D++)j=f[D],v[j]=0,g.push([0,y++,j]),w&&(w[j]=[j]);for(;g.size;)if(k=g.pop(),U=k[0],j=k[2],!(j in p)){if(p[j]=U,j===m)break;for(_=h.outboundEdges(j),R=0,M=_.length;R<M;R++){if(I=_[R],N=h.opposite(j,I),T=b(I,h.getEdgeAttributes(I))+p[j],N in p&&T<p[N])throw Error("graphology-shortest-path/dijkstra: contradictory paths found. Do some of your edges have a negative weight?");(!(N in v)||T<v[N])&&(v[N]=T,g.push([T,y++,N]),w&&(w[N]=w[j].concat(N)))}}return p}function l(h,f,b){var C={};return a(h,[f],b,0,null,C),C}function u(h,f,b,C){return o(h,f,b,C)[1]}function d(h,f,b){f=""+f,b=i(b||e).fromMinimalEntry;var C=[],m={},w={},p=h.nodes(),v,g,y,_,k,T,j,N,I,U;for(I=0,U=p.length;I<U;I++)T=p[I],m[T]=[],w[T]=0;var D={};w[f]=1;var R={};R[f]=0;var F=0,M=new r(s);for(M.push([0,F++,f,f]);M.size;)if(g=M.pop(),_=g[0],y=g[2],T=g[3],!(T in D))for(w[T]+=w[y],C.push(T),D[T]=_,v=h.outboundEdges(T),I=0,U=v.length;I<U;I++)N=v[I],j=h.opposite(T,N),k=_+b(N,h.getEdgeAttributes(N)),!(j in D)&&(!(j in R)||k<R[j])?(R[j]=k,M.push([k,F++,T,j]),w[j]=0,m[j]=[T]):k===R[j]&&(w[j]+=w[T],m[j].push(T));return[C,m,w]}return rt.bidirectional=u,rt.singleSource=l,rt.brandes=d,rt}var gr={},On;function Hl(){if(On)return gr;On=1;var n=je(),i=lt().createEdgeWeightGetter,r=Ui(),e="weight";function t(o,a){return o[0]>a[0]?1:o[0]<a[0]?-1:o[1]>a[1]?1:o[1]<a[1]?-1:0}function s(o,a,l,u,d,h){if(!n(o))throw new Error("graphology-shortest-path/astar: invalid graphology instance.");if(a&&!o.hasNode(a))throw new Error('graphology-shortest-path/astar: the "'+a+'" source node does not exist in the given graph.');if(l&&!o.hasNode(l))throw new Error('graphology-shortest-path/astar: the "'+l+'" target node does not exist in the given graph.');if(u=i(u||e).fromMinimalEntry,a===l)return[a];d=d||function(){return 0},h=h||{};var f=0,b=new r(t);b.push([0,f++,a,0,null]);var C={},m={},w,p,v,g,y,_,k,T,j,N,I,U;function D(R,F,M,G){if(U=p===M?G:M,N=u(R,F),N!==null){if(I=g+N,C.hasOwnProperty(U)){if(v=C[U],T=v[0],j=v[1],T<=I)return}else j=d(U,l);h.cutoff&&I+j>h.cutoff||(C[U]=[I,j],b.push([I+j,f++,U,I,p]))}}for(;b.size!==0;){if(w=b.pop(),p=w[2],g=w[3],y=w[4],p===l){for(_=[p],k=y;k!==null;)_.push(k),k=m[k];return _.reverse(),_}m.hasOwnProperty(p)&&(m[p]===null||(T=C[p][0],T<g))||(m[p]=y,o.forEachOutboundEdge(p,D))}return null}return gr.bidirectional=s,gr}var Gn;function ql(){if(Gn)return Re;Gn=1;var n=Gl(),i=Ul();return Re.unweighted=n,Re.dijkstra=Wl(),Re.astar=Hl(),Re.bidirectional=n.bidirectional,Re.singleSource=n.singleSource,Re.singleSourceLength=n.singleSourceLength,Re.undirectedSingleSourceLength=n.undirectedSingleSourceLength,Re.brandes=n.brandes,Re.edgePathFromNodePath=i.edgePathFromNodePath,Re}var Vl=ql(),_e={},mr={},Un;function $l(){return Un||(Un=1,mr.copyNode=function(n,i,r){return r=Object.assign({},r),n.addNode(i,r)}),mr}var He={},Bn;function Yl(){return Bn||(Bn=1,He.addEdge=function(i,r,e,t,s,o){return r?e==null?i.addUndirectedEdge(t,s,o):i.addUndirectedEdgeWithKey(e,t,s,o):e==null?i.addDirectedEdge(t,s,o):i.addDirectedEdgeWithKey(e,t,s,o)},He.copyEdge=function(i,r,e,t,s,o){return o=Object.assign({},o),r?e==null?i.addUndirectedEdge(t,s,o):i.addUndirectedEdgeWithKey(e,t,s,o):e==null?i.addDirectedEdge(t,s,o):i.addDirectedEdgeWithKey(e,t,s,o)},He.mergeEdge=function(i,r,e,t,s,o){return r?e==null?i.mergeUndirectedEdge(t,s,o):i.mergeUndirectedEdgeWithKey(e,t,s,o):e==null?i.mergeDirectedEdge(t,s,o):i.mergeDirectedEdgeWithKey(e,t,s,o)},He.updateEdge=function(i,r,e,t,s,o){return r?e==null?i.updateUndirectedEdge(t,s,o):i.updateUndirectedEdgeWithKey(e,t,s,o):e==null?i.updateDirectedEdge(t,s,o):i.updateDirectedEdgeWithKey(e,t,s,o)}),He}var pr,Mn;function Zl(){if(Mn)return pr;Mn=1;function n(i){this.graph=i,this.stack=new Array(i.order),this.seen=new Set,this.size=0}return n.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order},n.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size},n.prototype.forEachNodeYetUnseen=function(i){var r=this.seen,e=this.graph;e.someNode(function(t,s){if(r.size===e.order)return!0;if(r.has(t))return!1;var o=i(t,s);return!!o})},n.prototype.has=function(i){return this.seen.has(i)},n.prototype.push=function(i){var r=this.seen.size;return this.seen.add(i),r===this.seen.size?!1:(this.stack[this.size++]=i,!0)},n.prototype.pushWith=function(i,r){var e=this.seen.size;return this.seen.add(i),e===this.seen.size?!1:(this.stack[this.size++]=r,!0)},n.prototype.pop=function(){if(this.size!==0)return this.stack[--this.size]},pr=n,pr}var Wn;function Xl(){if(Wn)return _e;Wn=1;var n=je(),i=$l().copyNode,r=Yl().copyEdge,e=Zl();function t(b,C){if(!n(b))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(b.order){var m=new e(b),w=m.push.bind(m);m.forEachNodeYetUnseen(function(p){var v=[];m.push(p);for(var g;m.size!==0;)g=m.pop(),v.push(g),b.forEachNeighbor(g,w);C(v)})}}function s(b,C){if(!n(b))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(b.order){var m=new e(b),w=m.push.bind(m);m.forEachNodeYetUnseen(function(p){var v=0;m.push(p);for(var g;m.size!==0;)g=m.pop(),v++,b.forEachNeighbor(g,w);C(v)})}}function o(b,C,m){if(!n(b))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(!b.order)return;var w=new e(b),p;function v(g,y,_,k,T,j,N){p===k&&(k=_),C(g,y,_,k,T,j,N)&&w.push(k)}w.forEachNodeYetUnseen(function(g){var y=0;for(w.push(g);w.size!==0;)p=w.pop(),y++,b.forEachEdge(p,v);m(y)})}function a(b){var C=0;return s(b,function(){C++}),C}function l(b){var C=[];return t(b,function(m){C.push(m)}),C}function u(b){if(!n(b))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(!b.order)return[];var C=new e(b),m=C.push.bind(C),w=[],p;return C.forEachNodeYetUnseen(function(v){p=[],C.push(v);for(var g;C.size!==0;)g=C.pop(),p.push(g),b.forEachNeighbor(g,m);return p.length>w.length&&(w=p),w.length>C.countUnseenNodes()}),w}function d(b){var C=u(b),m=b.nullCopy();return C.forEach(function(w){i(m,w,b.getNodeAttributes(w))}),b.forEachEdge(function(w,p,v,g,y,_,k){m.hasNode(v)&&r(m,k,w,v,g,p)}),m}function h(b){var C=new Set(u(b));b.forEachNode(function(m){C.has(m)||b.dropNode(m)})}function f(b){if(!n(b))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(!b.order)return[];if(b.type==="undirected")throw new Error("graphology-components: the given graph is undirected");var C=b.nodes(),m=[],w,p;if(!b.size){for(w=0,p=C.length;w<p;w++)m.push([C[w]]);return m}var v=1,g=[],y=[],_=new Map,k=new Set,T,j,N,I=function(U){var D,R=b.outboundNeighbors(U),F;_.set(U,v++),g.push(U),y.push(U);for(var M=0,G=R.length;M<G;M++)if(D=R[M],_.has(D)){if(F=_.get(D),!k.has(D))for(;_.get(g[g.length-1])>F;)g.pop()}else I(D);if(_.get(g[g.length-1])===_.get(U)){T=[];do j=y.pop(),T.push(j),k.add(j);while(j!==U);m.push(T),g.pop()}};for(w=0,p=C.length;w<p;w++)N=C[w],k.has(N)||I(N);return m}return _e.forEachConnectedComponent=t,_e.forEachConnectedComponentOrder=s,_e.forEachConnectedComponentOrderWithEdgeFilter=o,_e.countConnectedComponents=a,_e.connectedComponents=l,_e.largestConnectedComponent=u,_e.largestConnectedComponentSubgraph=d,_e.cropToLargestConnectedComponent=h,_e.stronglyConnectedComponents=f,_e}var Kl=Xl();const Ql=[{key:"force",label:"Force",icon:ms},{key:"dagre",label:"Hierarchy",icon:Zn},{key:"concentric",label:"Concentric",icon:Ds},{key:"radial",label:"Radial",icon:ps},{key:"forceAtlas2",label:"Atlas",icon:$s}],Jl=[{key:"Esc",action:"Deselect / Close"},{key:"+",action:"Zoom in"},{key:"-",action:"Zoom out"},{key:"0",action:"Reset view"},{key:"F",action:"Fullscreen"},{key:"Shift+Click",action:"Multi-select"},{key:"Right-click",action:"Context menu"}];function ec({menu:n,onClose:i,onCopyLabel:r,onFocus:e,onSelectNeighbors:t,onPathFrom:s}){const o=B.useRef(null);B.useEffect(()=>{const l=d=>{o.current&&!o.current.contains(d.target)&&i()},u=d=>{d.key==="Escape"&&i()};return document.addEventListener("mousedown",l),document.addEventListener("keydown",u),()=>{document.removeEventListener("mousedown",l),document.removeEventListener("keydown",u)}},[i]);const a=[{label:"Copy Label",icon:ti,action:r},{label:"Focus Here",icon:Bs,action:e},{label:"Select Neighbors",icon:_r,action:t},{label:"Find Path From Here",icon:Qs,action:s}];return c.jsx("div",{ref:o,className:"absolute z-30 bg-slate-900 border border-slate-600 rounded-lg shadow-2xl py-1 min-w-[180px]",style:{left:n.x,top:n.y},children:a.map(l=>c.jsxs("button",{onClick:()=>{l.action(),i()},className:"w-full flex items-center gap-2 px-3 py-2 text-xs text-slate-200 hover:bg-slate-700 transition-colors",children:[c.jsx(l.icon,{className:"w-3.5 h-3.5 text-slate-400"}),l.label]},l.label))})}function tc(){const[n,i]=B.useState(!1);return c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:()=>i(r=>!r),className:"p-1.5 bg-slate-900/90 border border-slate-700 rounded-lg text-slate-300 hover:bg-slate-800 hover:text-white transition-colors",title:"Keyboard shortcuts",children:c.jsx(bs,{className:"w-4 h-4"})}),n&&c.jsxs("div",{className:"absolute right-0 top-full mt-1 z-30 bg-slate-900 border border-slate-600 rounded-lg shadow-2xl p-3 min-w-[200px]",children:[c.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2",children:"Keyboard Shortcuts"}),Jl.map(r=>c.jsxs("div",{className:"flex items-center justify-between py-1",children:[c.jsx("kbd",{className:"text-[10px] bg-slate-800 border border-slate-600 rounded px-1.5 py-0.5 text-slate-300 font-mono",children:r.key}),c.jsx("span",{className:"text-[10px] text-slate-400 ml-3",children:r.action})]},r.key))]})]})}function rc(){const{filters:n,selectedNodeId:i,setSelectedNodeId:r,setHoveredNodeId:e,selectedNodeIds:t,toggleNodeInSelection:s,clearSelection:o,pathStartId:a,setPathStartId:l,pathEndId:u,setPathEndId:d,pathNodeIds:h,setPathNodeIds:f,communityMode:b,setCommunityMode:C,importanceMode:m}=ct(),{nodes:w,edges:p,isLoading:v,error:g}=oi(),{sync:y}=zi(),[_,k]=B.useState(null),[T,j]=B.useState(!1),N=B.useRef(null),I=B.useRef(!1),U=B.useRef(()=>{}),D=B.useRef(!1);B.useEffect(()=>{const ie=ue=>{ue.key==="Shift"&&(I.current=!0)},oe=ue=>{ue.key==="Shift"&&(I.current=!1)};return window.addEventListener("keydown",ie),window.addEventListener("keyup",oe),()=>{window.removeEventListener("keydown",ie),window.removeEventListener("keyup",oe)}},[]);const R=B.useMemo(()=>{if(!w.length)return null;const{nodes:ie,edges:oe}=Yn(w,p);return Ss(ie,oe,m)},[w,p,m]),F=B.useMemo(()=>{if(!R)return null;try{Pl.assign(R)}catch{}return R},[R]);B.useEffect(()=>{if(!a||!u||!F){h.length>0&&f([]);return}try{const ie=Vl.bidirectional(F,a,u);f(ie||[])}catch{f([])}},[a,u,F]);const M=B.useMemo(()=>{const ie=new Set,oe=n.searchQuery?.toLowerCase();return!oe||!F||F.forEachNode((ue,de)=>{const pe=(de.label||"").toLowerCase(),xe=(de.nodeType||"").toLowerCase();(pe.includes(oe)||xe.includes(oe))&&ie.add(ue)}),ie},[n.searchQuery,F]);B.useMemo(()=>{const ie=F;if(!ie||ie.order===0)return null;const oe=ie.order,ue=ie.size,de=oe*(oe-1)/2,pe=de>0?ue/de:0;let xe=0;ie.forEachNode(Te=>{xe+=ie.degree(Te)});const be=oe>0?xe/oe:0;let Ee=0;try{Ee=Kl.connectedComponents(ie).length}catch{}return{nodeCount:oe,edgeCount:ue,density:pe,avgDegree:be,components:Ee}},[F]);const G=B.useCallback(ie=>{if(a&&!u){d(ie);return}if(I.current){s(ie);return}D.current&&U.current(),o(),r(oe=>oe===ie?null:ie)},[r,s,o,a,u,d]),E=B.useCallback(()=>{r(null),o(),k(null)},[r,o]),x=B.useCallback((ie,oe,ue)=>{k({nodeId:ie,x:oe,y:ue})},[]),{containerRef:V,minimapRef:W,fitView:L,zoomIn:S,zoomOut:A,focusNode:z,isLayoutRunning:Z,startLayout:K,stopLayout:re,applyLayout:$,exportPNG:ae,getNeighborIds:X,getNodeLabel:ne,refreshSize:J,status:le,hoveredNode:Y}=yl(F,{onNodeClick:G,onNodeRightClick:x,onStageClick:E,onNodeHover:e,selectedNodeId:i,selectedNodeIds:t,searchHighlightIds:M,pathNodeIds:h,communityMode:b});U.current=re,D.current=Z,B.useEffect(()=>{const ie=setTimeout(()=>J(),50);return()=>clearTimeout(ie)},[i,J]),B.useEffect(()=>{le==="ready"&&n.layout&&$(n.layout)},[n.layout]),B.useEffect(()=>{const ie=oe=>{const ue=oe.target;if(!(ue.tagName==="INPUT"||ue.tagName==="TEXTAREA"||ue.isContentEditable))switch(oe.key){case"Escape":r(null),o(),k(null),l(null),d(null),f([]);break;case"+":case"=":S();break;case"-":A();break;case"0":L();break;case"f":case"F":q();break}};return window.addEventListener("keydown",ie),()=>window.removeEventListener("keydown",ie)},[S,A,L,r,o,l,d,f]);const q=B.useCallback(()=>{N.current&&(document.fullscreenElement?document.exitFullscreen().catch(()=>{}):N.current.requestFullscreen().catch(()=>{}))},[]);B.useEffect(()=>{const ie=()=>j(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",ie),()=>document.removeEventListener("fullscreenchange",ie)},[]);const P=B.useCallback(()=>{if(!_)return;const ie=ne(_.nodeId);navigator.clipboard.writeText(ie).catch(()=>{})},[_,ne]),se=B.useCallback(()=>{_&&z(_.nodeId)},[_,z]),he=B.useCallback(()=>{if(!_)return;const ie=X(_.nodeId);s(_.nodeId),ie.forEach(oe=>s(oe))},[_,X,s]),te=B.useCallback(()=>{_&&(l(_.nodeId),d(null),f([]))},[_,l,d,f]),Q=B.useCallback(()=>{l(null),d(null),f([])},[l,d,f]),O=Object.entries(Be).filter(([ie])=>w.some(oe=>(oe.label||oe.data?.type)===ie)),me=v||!!g||w.length===0||le!=="ready"&&w.length>0;return c.jsxs("div",{ref:N,className:"flex-1 flex overflow-hidden bg-slate-950",children:[c.jsxs("div",{className:"flex-1 relative dark",children:[c.jsx("div",{ref:V,className:"w-full h-full bg-slate-950",style:{cursor:"grab"}}),me&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-[5] pointer-events-none",children:c.jsxs("div",{className:"pointer-events-auto text-center",children:[v&&c.jsx(fe,{className:"h-8 w-8 animate-spin text-gm-interactive-primary mx-auto"}),!v&&g&&c.jsxs("div",{className:"bg-slate-900/90 border border-slate-700 rounded-xl p-6",children:[c.jsx(yr,{className:"h-10 w-10 text-gm-status-danger mx-auto mb-3"}),c.jsx("p",{className:"text-xs text-slate-400 mb-3",children:"Failed to load graph. Try syncing."}),c.jsx("button",{onClick:()=>y(),className:"px-3 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium",children:"Sync Graph"})]}),!v&&!g&&w.length===0&&c.jsxs("div",{className:"bg-slate-900/90 border border-slate-700 rounded-xl p-6",children:[c.jsx(_t,{className:"h-12 w-12 mx-auto mb-4 text-gray-600"}),c.jsx("p",{className:"text-sm text-slate-400 mb-1",children:"No graph data yet"}),c.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Process documents and sync to populate the knowledge graph"}),c.jsx("button",{onClick:()=>y(),className:"px-4 py-2 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-xs font-medium hover:bg-gm-interactive-primary-hover transition-colors",children:"Sync Graph"})]}),!v&&!g&&w.length>0&&(le==="initializing"||le==="waiting-data")&&c.jsxs(c.Fragment,{children:[c.jsx(fe,{className:"h-6 w-6 animate-spin text-blue-400 mx-auto mb-2"}),c.jsx("p",{className:"text-xs text-slate-300",children:"Initializing graph engine..."})]})]})}),Y&&!i&&c.jsxs("div",{className:"absolute z-20 pointer-events-none bg-slate-900/95 border border-slate-600 rounded-lg px-3 py-2 shadow-xl",style:{left:Y.screenX+16,top:Y.screenY-10,maxWidth:240},children:[c.jsx("p",{className:"text-xs font-semibold text-slate-100 truncate",children:Y.label}),Y.type&&c.jsx("p",{className:"text-[10px] text-slate-400 mt-0.5",children:Y.type})]}),_&&c.jsx(ec,{menu:_,onClose:()=>k(null),onCopyLabel:P,onFocus:se,onSelectNeighbors:he,onPathFrom:te}),c.jsxs("div",{className:"absolute top-3 right-3 flex flex-col gap-1 z-10",children:[c.jsx("button",{onClick:S,className:"p-1.5 bg-slate-900/90 border border-slate-700 rounded-lg text-slate-300 hover:bg-slate-800 hover:text-white transition-colors",title:"Zoom in (+)",children:c.jsx(na,{className:"w-4 h-4"})}),c.jsx("button",{onClick:A,className:"p-1.5 bg-slate-900/90 border border-slate-700 rounded-lg text-slate-300 hover:bg-slate-800 hover:text-white transition-colors",title:"Zoom out (-)",children:c.jsx(sa,{className:"w-4 h-4"})}),c.jsx("button",{onClick:L,className:"p-1.5 bg-slate-900/90 border border-slate-700 rounded-lg text-slate-300 hover:bg-slate-800 hover:text-white transition-colors",title:"Reset view (0)",children:c.jsx(zr,{className:"w-4 h-4"})}),c.jsx("div",{className:"w-full h-px bg-slate-700 my-0.5"}),c.jsx("button",{onClick:Z?re:K,className:ce("p-1.5 bg-slate-900/90 border border-slate-700 rounded-lg transition-colors",Z?"text-amber-400 hover:text-amber-300":"text-slate-300 hover:text-white hover:bg-slate-800"),title:Z?"Stop layout":"Run layout",children:Z?c.jsx(Ts,{className:"w-4 h-4"}):c.jsx(ei,{className:"w-4 h-4"})}),c.jsx("div",{className:"w-full h-px bg-slate-700 my-0.5"}),c.jsx("button",{onClick:()=>C(!b),className:ce("p-1.5 bg-slate-900/90 border border-slate-700 rounded-lg transition-colors",b?"text-purple-400 hover:text-purple-300 border-purple-500/30":"text-slate-300 hover:text-white hover:bg-slate-800"),title:b?"Disable community colors":"Color by community",children:c.jsx(_r,{className:"w-4 h-4"})}),c.jsx("button",{onClick:q,className:"p-1.5 bg-slate-900/90 border border-slate-700 rounded-lg text-slate-300 hover:bg-slate-800 hover:text-white transition-colors",title:T?"Exit fullscreen (F)":"Fullscreen (F)",children:T?c.jsx(Fs,{className:"w-4 h-4"}):c.jsx(zr,{className:"w-4 h-4"})}),c.jsx("button",{onClick:ae,className:"p-1.5 bg-slate-900/90 border border-slate-700 rounded-lg text-slate-300 hover:bg-slate-800 hover:text-white transition-colors",title:"Export as PNG",children:c.jsx(ys,{className:"w-4 h-4"})}),c.jsx("div",{className:"w-full h-px bg-slate-700 my-0.5"}),c.jsx(tc,{})]}),Z&&c.jsxs("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 z-10 bg-slate-900/90 border border-amber-500/30 rounded-full px-3 py-1 flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-400 animate-pulse"}),c.jsx("span",{className:"text-[10px] text-amber-300 font-medium",children:"Layout optimizing..."})]}),M.size>0&&c.jsx("div",{className:"absolute top-3 left-3 z-10 bg-cyan-900/80 border border-cyan-500/30 rounded-full px-3 py-1",children:c.jsxs("span",{className:"text-[10px] text-cyan-200 font-medium",children:[M.size," matches"]})}),t.size>1&&c.jsxs("div",{className:"absolute top-10 left-3 z-10 bg-indigo-900/80 border border-indigo-500/30 rounded-full px-3 py-1 flex items-center gap-2",children:[c.jsxs("span",{className:"text-[10px] text-indigo-200 font-medium",children:[t.size," selected"]}),c.jsx("button",{onClick:o,className:"text-indigo-300 hover:text-white",children:c.jsx(it,{className:"w-3 h-3"})})]}),a&&c.jsxs("div",{className:"absolute bottom-14 left-3 z-10 bg-green-900/80 border border-green-500/30 rounded-lg px-3 py-2 max-w-[240px]",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{className:"text-[10px] text-green-200 font-bold uppercase",children:"Path Finder"}),c.jsx("button",{onClick:Q,className:"text-green-300 hover:text-white",children:c.jsx(it,{className:"w-3 h-3"})})]}),c.jsxs("p",{className:"text-[10px] text-green-300 truncate",children:["From: ",ne(a)]}),u?c.jsxs("p",{className:"text-[10px] text-green-300 truncate",children:["To: ",ne(u)]}):c.jsx("p",{className:"text-[10px] text-green-400 italic",children:"Click a node to set destination"}),h.length>0&&c.jsxs("p",{className:"text-[10px] text-green-200 mt-1 font-medium",children:[h.length-1," hops"]}),u&&h.length===0&&c.jsx("p",{className:"text-[10px] text-red-400 mt-1",children:"No path found"})]}),O.length>0&&c.jsx("div",{className:"absolute bottom-3 left-3 bg-slate-900/90 backdrop-blur-sm border border-slate-700 rounded-lg p-2.5 flex flex-wrap gap-x-3 gap-y-1.5 max-w-xs z-10",children:O.map(([ie,oe])=>c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:oe}}),c.jsx("span",{className:"text-[10px] text-slate-400",children:ie})]},ie))}),c.jsx("canvas",{ref:W,width:200,height:140,className:"absolute bottom-3 right-3 z-10 rounded-lg border border-slate-700 bg-slate-950/80 backdrop-blur-sm",style:{width:200,height:140}})]}),i&&c.jsx(wl,{edges:p})]})}const Bi="godmode_graph_saved_views";function nc(){try{const n=localStorage.getItem(Bi);return n?JSON.parse(n):[]}catch{return[]}}function Hn(n){localStorage.setItem(Bi,JSON.stringify(n))}function ic({value:n,onChange:i,suggestions:r}){const[e,t]=B.useState(!1),[s,o]=B.useState(!1),a=B.useRef(null),l=B.useRef(null),u=B.useMemo(()=>{if(!n.trim())return[];const h=n.toLowerCase();return r.filter(f=>f.label.toLowerCase().includes(h)||f.type.toLowerCase().includes(h)).slice(0,12)},[n,r]),d=s&&u.length>0;return B.useEffect(()=>{if(!s){const h=setTimeout(()=>t(!1),150);return()=>clearTimeout(h)}t(!0)},[s]),c.jsxs("div",{className:"relative",children:[c.jsx(vs,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gm-text-tertiary"}),c.jsx("input",{ref:a,value:n,onChange:h=>i(h.target.value),onFocus:()=>o(!0),onBlur:()=>o(!1),placeholder:"Search nodes...","aria-label":"Search graph nodes",className:"pl-7 pr-3 py-1.5 bg-gm-surface-secondary border border-gm-border-primary rounded-lg text-[11px] text-gm-text-primary w-44 focus:outline-none focus:ring-2 focus:ring-gm-border-focus"}),e&&d&&c.jsx("div",{ref:l,className:"absolute top-full left-0 mt-1 z-40 bg-slate-900 border border-slate-600 rounded-lg shadow-2xl w-64 max-h-[240px] overflow-y-auto",children:u.map(h=>c.jsxs("button",{onMouseDown:f=>{f.preventDefault(),i(h.label),t(!1)},className:"w-full flex items-center gap-2 px-3 py-1.5 text-[11px] text-slate-200 hover:bg-slate-700 transition-colors",children:[c.jsx("div",{className:"w-2 h-2 rounded-full shrink-0",style:{backgroundColor:Be[h.type]||"#64748b"}}),c.jsx("span",{className:"truncate",children:h.label}),c.jsx("span",{className:"ml-auto text-[9px] text-slate-500",children:h.type})]},h.id))})]})}function sc({min:n,max:i,value:r,onChange:e}){if(i-n<=0)return null;const s=r||[n,i],o=a=>new Date(a).toLocaleDateString("en-GB",{month:"short",year:"2-digit"});return c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Vn,{className:"w-3.5 h-3.5 text-gm-text-tertiary shrink-0"}),c.jsx("span",{className:"text-[10px] text-gm-text-tertiary shrink-0",children:o(s[0])}),c.jsx("input",{type:"range",min:n,max:i,value:s[0],onChange:a=>e([Number(a.target.value),s[1]]),className:"w-20 h-1 accent-blue-500 cursor-pointer",title:"Start date"}),c.jsx("input",{type:"range",min:n,max:i,value:s[1],onChange:a=>e([s[0],Number(a.target.value)]),className:"w-20 h-1 accent-blue-500 cursor-pointer",title:"End date"}),c.jsx("span",{className:"text-[10px] text-gm-text-tertiary shrink-0",children:o(s[1])}),r&&c.jsx("button",{onClick:()=>e(null),className:"text-slate-400 hover:text-white",title:"Clear time filter",children:c.jsx(it,{className:"w-3 h-3"})})]})}function ac(){const{filters:n,setFilters:i,toggleType:r,selectedNodeId:e,communityMode:t,importanceMode:s,setImportanceMode:o,toggleCollapsedType:a}=ct(),{nodes:l,edges:u}=oi(),{sync:d,isSyncing:h,status:f}=zi(),[b,C]=B.useState("explorer"),[m,w]=B.useState(!1),[p,v]=B.useState(!1),[g,y]=B.useState(!1),[_,k]=B.useState(nc),[T,j]=B.useState(""),N=B.useMemo(()=>{if(!l.length)return null;const E=l.length,x=u.length,V=E*(E-1)/2,W=V>0?x/V:0;return{nodeCount:E,edgeCount:x,density:W}},[l,u]),I=B.useMemo(()=>l.map(E=>({id:E.id,label:E.data?.label||E.label||E.id,type:E.label||"unknown"})),[l]),U=B.useMemo(()=>{let E=1/0,x=-1/0;for(const V of l){const W=V.data?.created_at||V.data?.updated_at||V.data?.date;if(W){const L=new Date(W).getTime();isNaN(L)||(L<E&&(E=L),L>x&&(x=L))}}return E<x?{min:E,max:x}:null},[l]),D=B.useMemo(()=>{const E=new Map;for(const x of l){const V=x.label||"";V&&E.set(V,(E.get(V)||0)+1)}return Array.from(E.entries()).filter(([,x])=>x>2).sort((x,V)=>V[1]-x[1]).map(([x,V])=>({type:x,count:V}))},[l]),R=B.useCallback(()=>{if(!T.trim())return;const x=[{id:Date.now().toString(36),name:T.trim(),filters:{toggles:n.toggles,layout:n.layout,searchQuery:n.searchQuery,minTier:n.minTier,showSemantic:n.showSemantic,collapsedTypes:Array.from(n.collapsedTypes),timeRange:n.timeRange},timestamp:Date.now()},..._].slice(0,20);k(x),Hn(x),j("")},[T,n,_]),F=B.useCallback(E=>{const x=E.filters;i(V=>({...V,toggles:x.toggles||V.toggles,layout:x.layout||V.layout,searchQuery:x.searchQuery||"",minTier:x.minTier??V.minTier,showSemantic:x.showSemantic??V.showSemantic,collapsedTypes:new Set(x.collapsedTypes||[]),timeRange:x.timeRange||null})),y(!1)},[i]),M=B.useCallback(E=>{const x=_.filter(V=>V.id!==E);k(x),Hn(x)},[_]),G=[{key:"explorer",label:"Explorer",icon:_t},{key:"query",label:"Query",icon:kt},{key:"analytics",label:"Analytics",icon:ii},{key:"ontology",label:"Ontology",icon:kr},{key:"settings",label:"Settings",icon:$n}];return c.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)]",children:[c.jsxs("div",{className:"flex items-center justify-between px-5 py-2.5 border-b border-gm-border-primary bg-gm-surface-primary shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("h1",{className:"text-sm font-bold text-gm-text-primary",children:"Knowledge Graph"}),c.jsxs("span",{className:"text-[11px] text-gm-text-tertiary bg-gm-surface-secondary px-2 py-0.5 rounded-full",children:[l.length," nodes Â· ",u.length," edges"]}),t&&c.jsx("span",{className:"text-[11px] text-purple-400 bg-purple-500/10 px-2 py-0.5 rounded-full border border-purple-500/20",children:"Communities"}),s&&c.jsx("span",{className:"text-[11px] text-amber-400 bg-amber-500/10 px-2 py-0.5 rounded-full border border-amber-500/20",children:"PageRank"}),n.collapsedTypes.size>0&&c.jsxs("span",{className:"text-[11px] text-indigo-400 bg-indigo-500/10 px-2 py-0.5 rounded-full border border-indigo-500/20",children:[n.collapsedTypes.size," grouped"]}),n.timeRange&&c.jsx("span",{className:"text-[11px] text-cyan-400 bg-cyan-500/10 px-2 py-0.5 rounded-full border border-cyan-500/20",children:"Time filtered"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"flex bg-gm-surface-secondary rounded-lg border border-gm-border-primary overflow-hidden",role:"tablist",children:G.map(E=>{const x=E.icon;return c.jsxs("button",{onClick:()=>C(E.key),role:"tab","aria-selected":b===E.key,className:ce("px-3 py-1.5 text-[11px] font-medium flex items-center gap-1 transition-colors",b===E.key?"bg-gm-interactive-primary text-gm-text-on-brand":"text-gm-text-tertiary hover:text-gm-text-primary"),children:[c.jsx(x,{className:"w-3.5 h-3.5"})," ",E.label]},E.key)})}),b==="explorer"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"flex bg-gm-surface-secondary rounded-lg border border-gm-border-primary overflow-hidden",children:Ql.map(E=>{const x=E.icon;return c.jsxs("button",{onClick:()=>i(V=>({...V,layout:E.key})),title:E.label,className:ce("px-2 py-1.5 text-[11px] font-medium flex items-center gap-1 transition-colors",n.layout===E.key?"bg-blue-600/20 text-blue-400":"text-gm-text-tertiary hover:text-gm-text-primary"),children:[c.jsx(x,{className:"w-3.5 h-3.5"}),c.jsx("span",{className:"hidden xl:inline",children:E.label})]},E.key)})}),c.jsx(ic,{value:n.searchQuery,onChange:E=>i(x=>({...x,searchQuery:E})),suggestions:I}),c.jsxs("button",{onClick:()=>w(!m),"aria-expanded":m,className:ce("px-2.5 py-1.5 rounded-lg text-[11px] font-medium border flex items-center gap-1 transition-colors",m?"bg-blue-600/10 border-blue-600/30 text-gm-interactive-primary":"bg-gm-surface-secondary border-gm-border-primary text-gm-text-tertiary"),children:[c.jsx(Is,{className:"w-3.5 h-3.5"})," Filters"]}),c.jsxs("button",{onClick:()=>o(!s),className:ce("px-2.5 py-1.5 rounded-lg text-[11px] font-medium border flex items-center gap-1 transition-colors",s?"bg-amber-600/10 border-amber-500/30 text-amber-400":"bg-gm-surface-secondary border-gm-border-primary text-gm-text-tertiary"),title:s?"Disable PageRank sizing":"Size nodes by importance (PageRank)",children:[c.jsx(si,{className:"w-3.5 h-3.5"})," Rank"]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>y(!g),className:ce("px-2.5 py-1.5 rounded-lg text-[11px] font-medium border flex items-center gap-1 transition-colors",g?"bg-blue-600/10 border-blue-600/30 text-gm-interactive-primary":"bg-gm-surface-secondary border-gm-border-primary text-gm-text-tertiary"),title:"Saved views",children:[c.jsx(Os,{className:"w-3.5 h-3.5"})," Views"]}),g&&c.jsxs("div",{className:"absolute right-0 top-full mt-1 z-40 bg-slate-900 border border-slate-600 rounded-lg shadow-2xl p-3 min-w-[220px]",children:[c.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase mb-2",children:"Saved Views"}),c.jsxs("div",{className:"flex gap-1 mb-2",children:[c.jsx("input",{value:T,onChange:E=>j(E.target.value),placeholder:"View name...",className:"flex-1 px-2 py-1 bg-slate-800 border border-slate-600 rounded text-[11px] text-slate-200 focus:outline-none",onKeyDown:E=>{E.key==="Enter"&&R()}}),c.jsx("button",{onClick:R,className:"px-2 py-1 bg-blue-600 text-white rounded text-[10px] font-medium hover:bg-blue-500",disabled:!T.trim(),children:c.jsx(Ps,{className:"w-3 h-3"})})]}),_.length===0&&c.jsx("p",{className:"text-[10px] text-slate-500 italic",children:"No saved views yet"}),_.map(E=>c.jsxs("div",{className:"flex items-center justify-between py-1 group",children:[c.jsx("button",{onClick:()=>F(E),className:"text-[11px] text-slate-300 hover:text-white truncate flex-1 text-left",children:E.name}),c.jsx("span",{className:"text-[9px] text-slate-600 mx-1",children:new Date(E.timestamp).toLocaleDateString()}),c.jsx("button",{onClick:()=>M(E.id),className:"text-slate-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",children:c.jsx(St,{className:"w-3 h-3"})})]},E.id))]})]})]}),c.jsxs("button",{onClick:()=>d(),disabled:h,"aria-label":"Sync knowledge graph",className:"px-2.5 py-1.5 rounded-lg bg-gm-interactive-primary text-gm-text-on-brand text-[11px] font-medium hover:bg-gm-interactive-primary-hover flex items-center gap-1 disabled:opacity-50 transition-colors",children:[h?c.jsx(fe,{className:"w-3.5 h-3.5 animate-spin"}):c.jsx(vr,{className:"w-3.5 h-3.5"})," Sync"]}),c.jsxs("button",{onClick:()=>v(!p),"aria-expanded":p,className:ce("px-2.5 py-1.5 rounded-lg text-[11px] font-medium flex items-center gap-1 transition-colors border",p?"bg-blue-600/10 border-blue-600/30 text-gm-interactive-primary":"bg-gm-surface-secondary border-gm-border-primary text-gm-text-tertiary hover:text-gm-text-primary"),children:[c.jsx(Lt,{className:"w-3.5 h-3.5"})," AI Copilot"]})]})]}),m&&b==="explorer"&&c.jsxs("div",{className:"border-b border-gm-border-primary bg-[var(--gm-surface-hover)] shrink-0",children:[c.jsx("div",{className:"flex items-center gap-1.5 px-5 py-2 flex-wrap",children:Object.entries(n.toggles).map(([E,x])=>c.jsx("button",{onClick:()=>r(E),className:ce("px-2.5 py-1 rounded-md text-[11px] font-medium transition-colors border",x?"border-current/20 text-gm-text-primary":"border-gm-border-primary text-gray-500 line-through"),style:{backgroundColor:x?`${Be[E]||"#64748b"}15`:void 0,color:x?Be[E]||"#64748b":void 0},children:E},E))}),c.jsxs("div",{className:"flex items-center gap-3 px-5 py-1.5 border-t border-gm-border-primary/50 flex-wrap",children:[D.length>0&&c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(Ws,{className:"w-3.5 h-3.5 text-gm-text-tertiary"}),c.jsx("span",{className:"text-[10px] text-gm-text-tertiary mr-1",children:"Group:"}),D.map(E=>c.jsxs("button",{onClick:()=>a(E.type),className:ce("px-2 py-0.5 rounded text-[10px] font-medium border transition-colors",n.collapsedTypes.has(E.type)?"bg-indigo-600/20 border-indigo-500/30 text-indigo-300":"bg-gm-surface-secondary border-gm-border-primary text-gm-text-tertiary hover:text-gm-text-primary"),children:[E.type," (",E.count,")"]},E.type))]}),U&&c.jsx(sc,{min:U.min,max:U.max,value:n.timeRange,onChange:E=>i(x=>({...x,timeRange:E}))})]})]}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[b==="explorer"&&c.jsx(rc,{}),b==="query"&&c.jsx("div",{className:"flex-1 bg-gm-surface-primary",children:c.jsx(Cl,{})}),b==="analytics"&&c.jsx("div",{className:"flex-1 bg-gm-surface-primary",children:c.jsx(Sl,{})}),b==="ontology"&&c.jsx("div",{className:"flex-1 bg-gm-surface-primary",children:c.jsx(Cs,{})}),b==="settings"&&c.jsx("div",{className:"flex-1 bg-gm-surface-primary",children:c.jsx(_l,{})})]}),f&&c.jsxs("div",{className:"flex items-center gap-3 px-5 py-1.5 border-t border-gm-border-primary text-[11px] text-gm-text-tertiary bg-gm-surface-secondary shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("div",{className:ce("w-1.5 h-1.5 rounded-full",f.health_status==="healthy"?"bg-gm-status-success":f.health_status==="degraded"?"bg-gm-status-warning":"bg-gm-status-danger")}),c.jsx("span",{className:"capitalize",children:f.health_status})]}),f.last_synced_at&&c.jsxs("span",{children:["Synced: ",new Date(f.last_synced_at).toLocaleString()]}),c.jsxs("span",{className:"flex items-center gap-0.5",children:[c.jsx(ri,{className:"w-3 h-3"})," ",f.node_count," nodes"]}),c.jsxs("span",{className:"flex items-center gap-0.5",children:[c.jsx(ni,{className:"w-3 h-3"})," ",f.edge_count," edges"]}),N&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"text-slate-500",children:"|"}),c.jsxs("span",{children:["Density: ",(N.density*100).toFixed(1),"%"]})]}),e&&c.jsxs("span",{className:"text-blue-400",children:["Selected: ",e.slice(0,8),"..."]}),c.jsxs("span",{className:"ml-auto text-[10px] text-slate-500",children:["Layout: ",n.layout]})]}),c.jsx(Rl,{open:p,onClose:()=>v(!1)})]})}function Oc(){return c.jsx(oa,{children:c.jsx(ac,{})})}export{Oc as default};
//# sourceMappingURL=GraphPage-BXk64WeC.js.map
