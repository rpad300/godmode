import{c as C,r as c,c9 as z,ca as k,j as e,a1 as K,aj as S,ai as R,N,cb as A,cc as F,cd as L,af as O,av as q,ad as B}from"./main-fI1tvvj5.js";import{C as M}from"./chevron-down-Cv_bzBMP.js";import{C as P}from"./chevron-up-CmBp8Ii2.js";import{S as D}from"./send-DbUBalGk.js";import{P as H}from"./pen-COGw609H.js";import{C as W}from"./circle-B13voKcq.js";const G=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],J=C("ellipsis",G);const Q=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],V=C("reply",Q);function X(t){const i=Date.now()-new Date(t).getTime(),a=Math.floor(i/6e4);if(a<1)return"just now";if(a<60)return`${a}m ago`;const n=Math.floor(a/60);return n<24?`${n}h ago`:`${Math.floor(n/24)}d ago`}function E({comment:t,targetType:i,targetId:a,depth:n=0}){const[m,p]=c.useState(!1),[l,v]=c.useState(t.content),[h,g]=c.useState(!1),[o,u]=c.useState(""),[d,f]=c.useState(!0),[r,x]=c.useState(!1),b=A(),_=F(),U=L(),j=k(),$=()=>{l.trim()&&b.mutate({id:t.id,content:l.trim()},{onSuccess:()=>p(!1)})},w=()=>{o.trim()&&j.mutate({targetType:i,targetId:a,content:o.trim(),parent_id:t.id},{onSuccess:()=>{u(""),g(!1)}})},y=t.replies??[];return e.jsxs("div",{className:`${n>0?"ml-6 border-l-2 border-[var(--gm-border-primary)] pl-4":""}`,children:[e.jsxs("div",{className:`group rounded-lg p-3 transition-colors ${t.resolved?"opacity-60":"hover:bg-[var(--gm-surface-hover)]"}`,children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-blue-600/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx(O,{className:"w-3.5 h-3.5 text-[var(--gm-interactive-primary)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:t.author_name||"User"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:X(t.created_at)}),t.resolved&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-green-500/10 text-green-500 font-medium",children:"Resolved"})]}),m?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:l,onChange:s=>v(s.target.value),className:"w-full bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] resize-none focus:outline-none focus:border-[var(--gm-border-focus)]",rows:2}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:$,disabled:b.isPending,className:"px-3 py-1 rounded text-xs bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] disabled:opacity-50",children:b.isPending?"Saving...":"Save"}),e.jsx("button",{onClick:()=>{p(!1),v(t.content)},className:"px-3 py-1 rounded text-xs text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]",children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-[var(--gm-text-secondary)] whitespace-pre-wrap",children:t.content})]}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("button",{onClick:()=>x(!r),className:"p-1 rounded opacity-0 group-hover:opacity-100 text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)] transition-all",children:e.jsx(J,{className:"w-4 h-4"})}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>x(!1)}),e.jsxs("div",{className:"absolute right-0 top-7 z-20 bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg shadow-lg py-1 min-w-[140px]",children:[e.jsxs("button",{onClick:()=>{g(!0),x(!1)},className:"w-full flex items-center gap-2 px-3 py-1.5 text-xs text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)]",children:[e.jsx(V,{className:"w-3.5 h-3.5"})," Reply"]}),e.jsxs("button",{onClick:()=>{p(!0),x(!1)},className:"w-full flex items-center gap-2 px-3 py-1.5 text-xs text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)]",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," Edit"]}),e.jsx("button",{onClick:()=>{U.mutate({id:t.id,resolved:!t.resolved}),x(!1)},className:"w-full flex items-center gap-2 px-3 py-1.5 text-xs text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)]",children:t.resolved?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-3.5 h-3.5"})," Unresolve"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3.5 h-3.5"})," Resolve"]})}),e.jsxs("button",{onClick:()=>{_.mutate(t.id),x(!1)},className:"w-full flex items-center gap-2 px-3 py-1.5 text-xs text-red-400 hover:bg-red-500/10",children:[e.jsx(B,{className:"w-3.5 h-3.5"})," Delete"]})]})]})]})]}),!m&&e.jsxs("div",{className:"flex items-center gap-2 mt-1.5 ml-10",children:[e.jsx("button",{onClick:()=>g(!h),className:"text-[10px] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-interactive-primary)] transition-colors",children:"Reply"}),y.length>0&&e.jsxs("button",{onClick:()=>f(!d),className:"flex items-center gap-0.5 text-[10px] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)]",children:[d?e.jsx(P,{className:"w-3 h-3"}):e.jsx(M,{className:"w-3 h-3"}),y.length," ",y.length===1?"reply":"replies"]})]})]}),e.jsx(S,{children:h&&e.jsx(R.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"ml-10 mt-1 mb-2 overflow-hidden",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:o,onChange:s=>u(s.target.value),placeholder:"Write a reply...",className:"flex-1 bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)]",onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),w())}}),e.jsx("button",{onClick:w,disabled:j.isPending||!o.trim(),className:"p-1.5 rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] disabled:opacity-50",children:j.isPending?e.jsx(N,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(D,{className:"w-3.5 h-3.5"})})]})})}),d&&y.map(s=>e.jsx(E,{comment:s,targetType:i,targetId:a,depth:n+1},s.id))]})}function re({targetType:t,targetId:i,title:a,collapsed:n}){const[m,p]=c.useState(n??!0),[l,v]=c.useState(""),{data:h,isLoading:g}=z(t,i),o=k(),u=h?.comments??[],d=h?.total??0,f=()=>{l.trim()&&o.mutate({targetType:t,targetId:i,content:l.trim()},{onSuccess:()=>v("")})};return e.jsxs("div",{className:"border border-[var(--gm-border-primary)] rounded-xl bg-[var(--gm-surface-primary)] overflow-hidden",style:{backgroundColor:"var(--gm-surface-primary)"},children:[e.jsxs("button",{onClick:()=>p(!m),className:"w-full flex items-center justify-between px-4 py-3 hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-[var(--gm-interactive-primary)]"}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:a||"Comments"}),d>0&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded-full bg-blue-600/10 text-[var(--gm-interactive-primary)] font-medium",children:d})]}),m?e.jsx(M,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}):e.jsx(P,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})]}),e.jsx(S,{children:!m&&e.jsx(R.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"border-t border-[var(--gm-border-primary)]",children:[e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:l,onChange:r=>v(r.target.value),placeholder:"Add a comment...",className:"flex-1 bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)]",onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),f())}}),e.jsx("button",{onClick:f,disabled:o.isPending||!l.trim(),className:"px-3 py-2 rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] disabled:opacity-50 transition-opacity",children:o.isPending?e.jsx(N,{className:"w-4 h-4 animate-spin"}):e.jsx(D,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"max-h-80 overflow-y-auto scrollbar-thin",children:g?e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(N,{className:"w-5 h-5 animate-spin text-[var(--gm-interactive-primary)]"})}):u.length===0?e.jsx("div",{className:"text-center py-6 text-xs text-[var(--gm-text-tertiary)]",children:"No comments yet. Be the first to comment."}):e.jsx("div",{className:"px-2 pb-2 space-y-1",children:u.map(r=>e.jsx(E,{comment:r,targetType:t,targetId:i},r.id))})})]})})})]})}export{re as C,V as R};
//# sourceMappingURL=CommentsPanel-BtBIgwid.js.map
