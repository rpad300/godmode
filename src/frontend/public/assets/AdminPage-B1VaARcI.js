import{c as me,j as e,N as $,T as oe,a as s,r as R,ab as De,U as Re,P as Ie,bt as ke,cK as Ve,K as Pe,ae as He,du as Oe,dv as Qe,dw as Je,dx as We,dy as Ye,O as n,a3 as fe,ad as ye,d9 as Ze,dz as Xe,dA as qe,dB as es,da as ss,dC as ts,dD as as,dE as rs,J as xe,dF as ns,dG as ls,dH as is,dI as cs,dJ as os,cM as ds,cN as xs,cl as ms,cP as ps,cQ as us,cO as hs,cS as gs,dK as vs,cU as js,cW as ys,cX as bs,cY as Ns,cV as fs,cZ as ws,cj as Ss,dL as Cs,Z as ue,cp as ks,cq as Ps,ct as As,cu as Ls,cz as Rs,cw as Es,cv as Ms,cx as _s,cy as Ts,cH as Ds,cF as Is,cA as Os,cB as $s,cG as Fs,cE as Us,cI as zs,cJ as Gs,cC as Bs,cD as Ks,dM as Vs,dN as Hs,dO as Qs,dP as Js,dQ as Ws,bG as Ys,bF as Zs,bI as Xs,dR as qs,dS as et,dT as st,bn as tt,bo as at,bp as rt,dU as nt,br as lt,bm as it,bs as ct,dV as ot,dW as dt,dX as xt,dY as mt,dZ as pt,d_ as ut,d$ as ht,e0 as gt,e1 as vt,e2 as jt,e3 as yt,e4 as bt,e5 as Nt,e6 as ft,dt as wt,a2 as Ce,e7 as St,e8 as Ct,e9 as kt,b9 as Pt,ba as At,ea as Lt,eb as Rt,ec as Et,ed as Mt,ee as _t}from"./main-fI1tvvj5.js";import{K as Tt}from"./key-Ct4KUgKI.js";import{C as Dt}from"./cpu-7Vu7FY3P.js";import{L as It}from"./list-BeJ3MZrH.js";import{L as $e}from"./layers-Bivflnsq.js";import{P as be}from"./plus-B5uVkXEF.js";import{E as Fe}from"./eye-CkHWNw62.js";import{R as ve}from"./rotate-cw-CtFbDYPA.js";import{C as he}from"./circle-check-big-00qMcaeM.js";import{S as le}from"./save-Dku4kEyp.js";import{P as Ot}from"./play-BrIJzO2k.js";import{H as $t}from"./history-D2IPEHm9.js";import{P as Ft}from"./pen-line-D1cINlNF.js";import{L as Ut}from"./link-2-pRFXINl4.js";import{F as zt}from"./file-braces-Dz9QksNk.js";import{U as Gt}from"./upload-PuE9TYGO.js";import{E as Bt}from"./eye-off-B0uidgyu.js";import{D as Kt}from"./database-DuLEfmYc.js";const Vt=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ae=me("ban",Vt);const Ht=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Qt=me("credit-card",Ht);const Jt=[["path",{d:"M9 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v.5",key:"1dkoa9"}],["path",{d:"M12 10v4h4",key:"1czhmt"}],["path",{d:"m12 14 1.535-1.605a5 5 0 0 1 8 1.5",key:"lvuxfi"}],["path",{d:"M22 22v-4h-4",key:"1ewp4q"}],["path",{d:"m22 18-1.535 1.605a5 5 0 0 1-8-1.5",key:"14ync0"}]],Ue=me("folder-sync",Jt);const Wt=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],Ee=me("folder-tree",Wt);const Yt=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],ze=me("gauge",Yt);const Zt=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Xt=me("pause",Zt);const qt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Ge=me("terminal",qt),ne=t=>({width:t,height:t,viewBox:"0 0 24 24"});function ea({size:t=20,...x}){return e.jsx("svg",{...ne(t),fill:"none",xmlns:"http://www.w3.org/2000/svg",...x,children:e.jsx("path",{d:"M22.28 9.37a5.93 5.93 0 0 0-.51-4.89A6.01 6.01 0 0 0 15.3 1.5a5.97 5.97 0 0 0-4.52 2.07A5.93 5.93 0 0 0 6.82 2.2a6.01 6.01 0 0 0-4.01 2.92 5.97 5.97 0 0 0 .74 7.01 5.93 5.93 0 0 0 .51 4.89A6.01 6.01 0 0 0 10.53 20a5.98 5.98 0 0 0 .69 2.5 6.01 6.01 0 0 0 6.47 2.98 5.97 5.97 0 0 0 4.52-2.07 5.93 5.93 0 0 0 3.96 1.37 6.01 6.01 0 0 0 4.01-2.92 5.97 5.97 0 0 0-.74-7.01",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",transform:"scale(0.75) translate(4, 4)"})})}function Me({size:t=20,...x}){return e.jsx("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...x,children:e.jsx("path",{d:"M13.83 3h-3.16L5 21h3.16l1.41-4.51h5.36L16.34 21h3.16L13.83 3Zm-3.16 10.96L12.25 8.6l1.58 5.36h-3.16Z"})})}function Se({size:t=20,...x}){return e.jsx("svg",{...ne(t),fill:"none",xmlns:"http://www.w3.org/2000/svg",...x,children:e.jsx("path",{d:"M21.81 10.26H12.18v3.72h5.51a4.77 4.77 0 0 1-2.05 3.08 6.14 6.14 0 0 1-3.46.96 6.36 6.36 0 0 1-6-4.14 6.29 6.29 0 0 1 0-3.76 6.36 6.36 0 0 1 6-4.14c1.56 0 2.97.56 4.08 1.49l2.79-2.79A10.53 10.53 0 0 0 12.18 2a10.26 10.26 0 0 0-9.19 5.66 10.06 10.06 0 0 0 0 8.68A10.26 10.26 0 0 0 12.18 22c5.2 0 9.87-3.46 9.87-10.26 0-.65-.08-1.31-.24-1.48Z",fill:"currentColor"})})}function sa({size:t=20,...x}){return e.jsxs("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...x,children:[e.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"1.5",fill:"none"}),e.jsx("text",{x:"12",y:"16",textAnchor:"middle",fontSize:"10",fontWeight:"bold",fill:"currentColor",children:"G"})]})}function ta({size:t=20,...x}){return e.jsx("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...x,children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 2c1.85 0 3.55.63 4.9 1.69L7.69 16.9A7.96 7.96 0 0 1 4 12c0-4.42 3.58-8 8-8zm0 16c-1.85 0-3.55-.63-4.9-1.69L16.31 7.1A7.96 7.96 0 0 1 20 12c0 4.42-3.58 8-8 8z"})})}function aa({size:t=20,...x}){return e.jsxs("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...x,children:[e.jsx("path",{d:"M12 3a7 7 0 0 0-7 7v3.5c0 1.93 1.57 3.5 3.5 3.5h1a1.5 1.5 0 0 0 0-3H8.5a.5.5 0 0 1-.5-.5V10a4 4 0 0 1 8 0v3.5a.5.5 0 0 1-.5.5H14.5a1.5 1.5 0 0 0 0 3h1c1.93 0 3.5-1.57 3.5-3.5V10a7 7 0 0 0-7-7z"}),e.jsx("circle",{cx:"9.5",cy:"10.5",r:"1"}),e.jsx("circle",{cx:"14.5",cy:"10.5",r:"1"})]})}function _e({size:t=20,...x}){return e.jsx("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...x,children:e.jsx("path",{d:"M3 3l7.07 10.61L3 21h1.59l6.19-6.47L15.61 21H21l-7.46-11.18L20.1 3h-1.59l-5.76 6.02L8.39 3H3zm2.29 1.25h2.54l10.88 15.5h-2.54L5.29 4.25z"})})}function ra({size:t=20,...x}){return e.jsxs("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...x,children:[e.jsx("rect",{x:"3",y:"8",width:"4",height:"8",rx:"1"}),e.jsx("rect",{x:"10",y:"4",width:"4",height:"16",rx:"1"}),e.jsx("rect",{x:"17",y:"8",width:"4",height:"8",rx:"1"})]})}function na({size:t=20,...x}){return e.jsx("svg",{...ne(t),fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...x,children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14.5v-9l7 4.5-7 4.5z"})})}function la({size:t=20,...x}){return e.jsxs("svg",{...ne(t),fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",xmlns:"http://www.w3.org/2000/svg",...x,children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"3"}),e.jsx("path",{d:"M9 9h6M9 12h6M9 15h4"})]})}const Be={openai:"#10a37f",anthropic:"#d97757",claude:"#d97757",google:"#4285f4",gemini:"#4285f4",google_gemini:"#4285f4",groq:"#f55036",deepseek:"#4d6bfe",ollama:"#ffffff",grok:"#1d9bf0",xai:"#1d9bf0",minimax:"#6c5ce7",kimi:"#615eff"},ia={openai:ea,anthropic:Me,claude:Me,google:Se,gemini:Se,google_gemini:Se,groq:sa,deepseek:ta,ollama:aa,grok:_e,xai:_e,minimax:ra,kimi:na};function je({provider:t,size:x=20,className:u}){const _=(t||"").toLowerCase().replace(/[\s-]/g,"_"),g=ia[_]||la,P=Be[_]||"currentColor";return e.jsx(g,{size:x,className:u,style:{color:P}})}function ca(t){const x=(t||"").toLowerCase().replace(/[\s-]/g,"_");return Be[x]||"var(--gm-accent-primary)"}const b="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)] transition-all duration-200",U="bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-placeholder)] focus:outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] transition-all duration-150",V="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-primary)] text-[var(--gm-text-on-brand)] hover:bg-[var(--gm-interactive-primary-hover)] shadow-sm transition-all duration-150 disabled:opacity-50",G="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--gm-interactive-secondary)] text-[var(--gm-text-primary)] hover:bg-[var(--gm-interactive-secondary-hover)] border border-[var(--gm-border-primary)] transition-all duration-150",Te="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-[var(--color-danger-500)] text-white hover:bg-[var(--color-danger-600)] shadow-sm transition-all duration-150 disabled:opacity-50",L="text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",F="text-[10px] font-bold text-[var(--gm-text-tertiary)] uppercase tracking-wider";function se(){return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx($,{className:"h-6 w-6 animate-spin text-[var(--gm-accent-primary)]"})})}function Le({msg:t}){return e.jsxs("div",{className:s(b,"p-10 text-center flex flex-col items-center gap-3"),children:[e.jsx(oe,{className:"w-5 h-5 text-[var(--color-warning-500)]"}),e.jsx("span",{className:"text-sm text-[var(--gm-text-secondary)]",children:t})]})}function re({msg:t}){return e.jsx("div",{className:s(b,"p-10 text-center text-[var(--gm-text-tertiary)] text-sm"),children:t})}function te({title:t,subtitle:x}){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--gm-text-primary)]",children:t}),x&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-0.5",children:x})]})}function Z({label:t,value:x,color:u}){return e.jsxs("div",{className:s(b,"p-4 text-center"),children:[e.jsx("div",{className:"text-2xl font-bold tabular-nums",style:u?{color:u}:void 0,children:x}),e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mt-1",children:t})]})}function Ne({checked:t,onChange:x,disabled:u}){return e.jsx("button",{onClick:()=>!u&&x(!t),disabled:u,className:"relative inline-flex h-5 w-9 shrink-0 cursor-pointer rounded-full border border-[var(--gm-border-primary)] transition-colors duration-200 disabled:opacity-50",style:{backgroundColor:t?"var(--color-brand-500)":"var(--gm-bg-tertiary)"},children:e.jsx("span",{className:s("pointer-events-none inline-block h-4 w-4 rounded-full bg-white shadow-sm transition-transform duration-200",t?"translate-x-4":"translate-x-0")})})}const M=t=>t??{},oa=[{key:"users",label:"Users",icon:Re},{key:"system",label:"System",icon:Ie},{key:"llm-providers",label:"LLM Providers",icon:Tt},{key:"model-metadata",label:"Model Metadata",icon:Dt},{key:"llm-queue",label:"LLM Queue",icon:It},{key:"graph",label:"Graph",icon:ke},{key:"ontology",label:"Ontology",icon:$e},{key:"prompts",label:"Prompts",icon:Ge},{key:"processing",label:"Processing",icon:Ve},{key:"team-analysis",label:"Team Analysis",icon:Re},{key:"google-drive",label:"Google Drive",icon:Ue},{key:"billing",label:"Billing",icon:Qt},{key:"audit-log",label:"Audit Log",icon:Pe}];function da(){const{data:t}=Oe(),x=t,u=[];return x&&(typeof x.disk=="number"&&x.disk>75&&u.push({msg:`Disk usage at ${x.disk.toFixed(1)}% — consider cleanup of old embeddings`,severity:"warning"}),typeof x.cpu=="number"&&x.cpu>90&&u.push({msg:`CPU usage critical at ${x.cpu.toFixed(1)}%`,severity:"danger"}),typeof x.ram=="number"&&x.ram>85&&u.push({msg:`RAM usage high at ${x.ram.toFixed(1)}%`,severity:"warning"}),typeof x.latency=="number"&&x.latency>200&&u.push({msg:`High latency: ${x.latency.toFixed(0)}ms`,severity:"warning"})),u.length===0?null:e.jsx("div",{className:"space-y-1.5 mb-4",children:u.map((_,g)=>e.jsxs("div",{className:s("flex items-center gap-2 px-4 py-2 rounded-lg text-xs font-medium",_.severity==="danger"?"bg-red-500/10 text-red-400":_.severity==="warning"?"bg-amber-500/10 text-amber-400":"bg-blue-500/10 text-blue-400"),children:[e.jsx(oe,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"flex-1",children:_.msg})]},g))})}function xa(){const{data:t,isLoading:x,error:u}=Qe(),_=Je(),g=We(),P=Ye(),[N,w]=R.useState(!1),[T,j]=R.useState(""),[S,f]=R.useState("all"),[C,m]=R.useState({email:"",name:"",password:"",role:"user"}),[h,c]=R.useState(null),D=M(t),r=D.users??[],i=M(D.stats),p=R.useMemo(()=>r.filter(o=>{if(S!=="all"&&o.role!==S)return!1;if(T){const O=T.toLowerCase();if(!o.name?.toLowerCase().includes(O)&&!o.email?.toLowerCase().includes(O))return!1}return!0}),[r,S,T]),k=R.useCallback(()=>{if(!C.email){n.error("Email is required");return}_.mutate(C,{onSuccess:()=>{n.success("User created"),w(!1),m({email:"",name:"",password:"",role:"user"})},onError:o=>n.error(o.message)})},[C,_]);return x?e.jsx(se,{}):u?e.jsx(Le,{msg:"Unable to load users."}):e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"User Management"}),i.totalUsers!=null&&e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-3",children:[e.jsx(Z,{label:"Total Users",value:i.totalUsers}),e.jsx(Z,{label:"Active",value:i.activeUsers,color:"var(--color-success-500)"}),e.jsx(Z,{label:"Pending",value:i.pendingInvitations,color:"var(--color-warning-500)"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[e.jsx(fe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{placeholder:"Search users...",value:T,onChange:o=>j(o.target.value),className:s(U,"flex-1")})]}),e.jsxs("select",{value:S,onChange:o=>f(o.target.value),className:s(U,"w-32"),children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"Superadmin"})]}),e.jsxs("button",{onClick:()=>w(!N),className:V,children:[e.jsx(be,{className:"w-3 h-3"})," Add User"]})]}),N&&e.jsxs("div",{className:s(b,"p-4 space-y-3"),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{placeholder:"Email",value:C.email,onChange:o=>m(O=>({...O,email:o.target.value})),className:U}),e.jsx("input",{placeholder:"Display Name",value:C.name,onChange:o=>m(O=>({...O,name:o.target.value})),className:U}),e.jsx("input",{placeholder:"Password",type:"password",value:C.password,onChange:o=>m(O=>({...O,password:o.target.value})),className:U}),e.jsxs("select",{value:C.role,onChange:o=>m(O=>({...O,role:o.target.value})),className:U,children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"superadmin",children:"Superadmin"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:k,disabled:_.isPending,className:V,children:[_.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(be,{className:"w-3 h-3"})," Create"]}),e.jsx("button",{onClick:()=>w(!1),className:G,children:"Cancel"})]})]}),e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["USER","EMAIL","ROLE","STATUS","LAST LOGIN","ACTIONS"].map(o=>e.jsx("th",{className:s(F,"px-4 py-3 text-left"),children:o},o))})}),e.jsx("tbody",{children:p.map(o=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[var(--gm-interactive-primary)]/15 text-[var(--gm-accent-primary)] font-bold flex items-center justify-center shrink-0 text-xs",children:(o.name||o.email||"?").substring(0,2).toUpperCase()}),e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)]",children:o.name||"—"})]})}),e.jsx("td",{className:"px-4 py-3 text-xs text-[var(--gm-text-tertiary)]",children:o.email}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("select",{value:o.role,onChange:O=>g.mutate({id:o.id,role:O.target.value},{onSuccess:()=>n.success("Role updated"),onError:Y=>n.error(Y.message)}),className:s("text-[10px] px-2 py-0.5 rounded-full font-medium border-0",o.role==="superadmin"?"bg-red-500/20 text-red-400":o.role==="admin"?"bg-blue-500/20 text-blue-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-primary)]"),children:[e.jsx("option",{value:"user",children:"user"}),e.jsx("option",{value:"admin",children:"admin"}),e.jsx("option",{value:"superadmin",children:"superadmin"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",o.status==="active"?"bg-green-500/15 text-green-400":o.status==="banned"?"bg-red-500/15 text-red-400":"bg-amber-500/15 text-amber-400"),children:o.status})}),e.jsx("td",{className:"px-4 py-3 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o.lastActive?new Date(o.lastActive).toLocaleString():"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>g.mutate({id:o.id,status:o.status==="banned"?"active":"banned"},{onSuccess:()=>n.success(o.status==="banned"?"User unbanned":"User banned"),onError:O=>n.error(O.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:o.status==="banned"?"Unban":"Ban",children:o.status==="banned"?e.jsx(Fe,{className:"w-3.5 h-3.5 text-green-400"}):e.jsx(Ae,{className:"w-3.5 h-3.5 text-amber-400"})}),h===o.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>P.mutate(o.id,{onSuccess:()=>{n.success("User deleted"),c(null)},onError:O=>n.error(O.message)}),className:"px-2 py-0.5 rounded bg-red-500 text-white text-[10px]",children:"Confirm"}),e.jsx("button",{onClick:()=>c(null),className:"px-2 py-0.5 rounded text-[10px] text-[var(--gm-text-tertiary)]",children:"Cancel"})]}):e.jsx("button",{onClick:()=>c(o.id),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",children:e.jsx(ye,{className:"w-3.5 h-3.5 text-red-400"})})]})})]},o.id))})]}),p.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No users found."})]}),e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] text-center",children:["Showing ",p.length," of ",r.length," users"]})]})}function ma(){const{data:t,isLoading:x,error:u,refetch:_}=Oe(),g=t;if(x)return e.jsx(se,{});if(u||!g)return e.jsx(Le,{msg:"Unable to load system stats."});const P=g.server||{},N=g.memory||{},w=g.process||{},T=g.database||"unknown",j=m=>{const h=Math.floor(m/86400),c=Math.floor(m%86400/3600),D=Math.floor(m%3600/60);return[h&&`${h}d`,c&&`${c}h`,`${D}m`].filter(Boolean).join(" ")},S=m=>m>=1024?`${(m/1024).toFixed(1)} GB`:`${m} MB`,f=(m,h,c)=>m>c?"#ef4444":m>h?"#f59e0b":"#22c55e",C=[{label:"CPU",val:g.cpu,unit:"%",color:f(g.cpu,60,80)},{label:"RAM",val:g.ram,unit:"%",color:f(g.ram,60,80)},{label:"Disk",val:g.disk,unit:"%",color:f(g.disk,70,90)},{label:"Event Loop",val:g.latency,unit:"ms",color:f(g.latency,50,200)}];return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{title:"System Health",subtitle:g.timestamp?`Last updated: ${new Date(g.timestamp).toLocaleString()}`:"Real-time system monitoring"}),e.jsxs("button",{onClick:()=>_(),className:G,children:[e.jsx(ve,{className:"w-3 h-3"})," Refresh"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:C.map(m=>e.jsxs("div",{className:s(b,"p-4 text-center"),children:[e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-2",children:m.label}),e.jsxs("div",{className:"relative w-16 h-16 mx-auto mb-2",children:[e.jsxs("svg",{viewBox:"0 0 36 36",className:"w-full h-full -rotate-90",children:[e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:"var(--gm-bg-tertiary)",strokeWidth:"3"}),e.jsx("circle",{cx:"18",cy:"18",r:"15.5",fill:"none",stroke:m.color,strokeWidth:"3",strokeDasharray:`${Math.min((typeof m.val=="number"?m.val:0)/(m.unit==="ms"?500:100)*97.4,97.4)} 97.4`,strokeLinecap:"round",className:"transition-all duration-700"})]}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:typeof m.val=="number"?m.unit==="ms"?m.val:m.val.toFixed(0):m.val})]}),e.jsx("div",{className:"text-[9px] font-medium tabular-nums",style:{color:m.color},children:m.unit})]},m.label))}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(b,"p-4 space-y-2.5"),children:[e.jsx("h3",{className:L,children:"Server"}),[["Node",String(P.nodeVersion||"—")],["Platform",`${P.platform||"—"} / ${P.arch||"—"}`],["Hostname",String(g.hostname||"—")],["PID",String(P.pid||"—")],["Uptime",typeof P.uptime=="number"?j(P.uptime):"—"],["CPU Cores",String(g.cpuCores||"—")]].map(([m,h])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:m}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono tabular-nums",children:h})]},m))]}),e.jsxs("div",{className:s(b,"p-4 space-y-2.5"),children:[e.jsx("h3",{className:L,children:"Runtime"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Database"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",T==="connected"?"bg-green-500/10 text-green-400":T==="error"?"bg-red-500/10 text-red-400":"bg-amber-500/10 text-amber-400"),children:T})]}),[["Heap Used",`${w.heapUsedMB||0} MB`],["Heap Total",`${w.heapTotalMB||0} MB`],["Heap %",`${w.heapPercent||0}%`],["RSS",`${w.rssMB||0} MB`],["System RAM",N.totalMB?`${S(N.usedMB||0)} / ${S(N.totalMB)}`:"—"]].map(([m,h])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:m}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono tabular-nums",children:h})]},m)),w.heapPercent>0&&e.jsx("div",{className:"h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${w.heapPercent}%`,backgroundColor:f(w.heapPercent,60,85)}})})]})]}),g.storageBreakdown&&g.storageBreakdown.length>0&&e.jsxs("div",{className:s(b,"p-5"),children:[e.jsx("h3",{className:s(L,"mb-4"),children:"Storage"}),e.jsx("div",{className:"space-y-4",children:g.storageBreakdown.map((m,h)=>{const c=Number(m.size||0),D=Number(m.free||0),r=c-D,i=c>0?Math.round(r/c*100):0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:String(m.category)}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums font-mono",children:[S(r)," / ",S(c)," (",i,"%)"]})]}),e.jsx("div",{className:"h-2.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${i}%`,backgroundColor:f(i,70,90)}})}),e.jsx("div",{className:"flex justify-between mt-1",children:e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:[S(D)," free"]})})]},h)})})]})]})}function pa({task:t,taskLabel:x,currentProvider:u,currentModel:_,providerList:g,onProviderChange:P,onModelChange:N}){const{data:w,isLoading:T,isError:j}=wt(u||null),[S,f]=R.useState(!1),C=R.useMemo(()=>{if(!w)return[];const h=w,c=h.textModels??[],D=h.visionModels??[],r=h.embeddingModels??[];return t==="vision"?D:t==="embeddings"?r:c},[w,t]),m=C.length>0;return e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-text-primary)] capitalize",children:x}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"PROVIDER"}),e.jsxs("select",{value:u,onChange:h=>{P(h.target.value),f(!1)},className:s(U,"w-full text-xs"),children:[e.jsx("option",{value:"",children:"Select..."}),g.map(h=>e.jsx("option",{value:h.id,children:h.name},h.id))]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-accent-primary)] mt-0.5 block",children:[g.length," provider(s) available"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"MODEL"}),T&&u?e.jsxs("div",{className:s(U,"w-full text-xs flex items-center gap-2"),children:[e.jsx($,{className:"w-3 h-3 animate-spin text-blue-400"}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Loading models..."})]}):m&&!S?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:_,onChange:h=>N(h.target.value),className:s(U,"w-full text-xs"),children:[e.jsx("option",{value:"",children:"Select model..."}),C.map(h=>e.jsxs("option",{value:h.id,children:[h.name||h.id,h.contextTokens?` (${Math.round(Number(h.contextTokens)/1e3)}K ctx)`:""]},h.id))]}),e.jsx("button",{onClick:()=>f(!0),className:"text-[10px] text-blue-400 hover:text-blue-300 mt-0.5 block",children:"or type manually"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{value:_,onChange:h=>N(h.target.value),className:s(U,"w-full text-xs"),placeholder:u?"e.g. gpt-4o":"Select a provider first"}),m&&S&&e.jsx("button",{onClick:()=>f(!1),className:"text-[10px] text-blue-400 hover:text-blue-300 mt-0.5 block",children:"back to dropdown"}),j&&u&&e.jsx("span",{className:"text-[10px] text-amber-400 mt-0.5 block",children:"Could not load models — type manually"})]})]})]})]})}function ua(){const{data:t,isLoading:x}=Ze(),{data:u}=Xe(),{data:_,isLoading:g}=qe(),P=es(),N=ss(),[w,T]=R.useState({}),[j,S]=R.useState({}),[f,C]=R.useState({}),m=M(t),h=M(m.llm),c=M(h.providers),D=M(h.perTask);M(u).providers;const i=M(_),p=i.providers??[],k=R.useCallback(A=>p.find(E=>E.id===A||E.aliases&&E.aliases.includes(A)),[p]),o=R.useMemo(()=>{const A=new Set,E=Object.entries(c).map(([a,y])=>{const I=k(a),l=I?.id||a;return A.add(l),A.add(a),{id:l,name:I?.name||y.name||a,apiKeyMasked:I?.masked||y.apiKeyMasked||null,isConfigured:I?.configured||!!y.isConfigured,keySource:I?.source||null}});return p.forEach(a=>{A.has(a.id)||(A.add(a.id),E.push({id:a.id,name:a.name||(a.id||"unknown").charAt(0).toUpperCase()+(a.id||"unknown").slice(1),apiKeyMasked:a.masked,isConfigured:a.configured,keySource:a.source}))}),E},[c,p,k]),O=R.useCallback(()=>{const A=Object.entries(j).filter(([,y])=>y.trim().length>0);if(A.length===0){n.info("No changes to save");return}let E=0;const a=A.length;for(const[y,I]of A)P.mutate({provider:y,apiKey:I},{onSuccess:()=>{E++,E===a&&(n.success(`${a} API key${a>1?"s":""} saved to encrypted vault`),S({}))},onError:l=>n.error(`Failed to save ${y}: ${l.message}`)})},[j,P]),Y=R.useCallback(()=>{if(Object.keys(f).length===0){n.info("No changes to save");return}N.mutate({llm:{perTask:f}},{onSuccess:()=>{n.success("LLM configuration saved"),C({})},onError:A=>n.error(A.message)})},[f,N]);if(x||g)return e.jsx(se,{});const B=Object.values(j).some(A=>A.trim().length>0);return e.jsxs("div",{className:"space-y-8",children:[e.jsx(te,{title:"LLM Providers",subtitle:"System-level API keys stored encrypted in Supabase vault"}),e.jsxs("div",{className:s(b,"p-4 border-l-2 border-[var(--gm-accent-primary)]"),children:[e.jsx("h4",{className:"text-xs font-semibold text-[var(--gm-accent-primary)] mb-2",children:"Key Resolution & Billing"}),e.jsxs("div",{className:"text-[11px] text-[var(--gm-text-secondary)] space-y-1",children:[e.jsxs("p",{children:["The LLM service resolves API keys in this order: ",e.jsx("strong",{children:"Project key"})," (Supabase secrets, project scope) then ",e.jsx("strong",{children:"System key"})," (Supabase secrets, system scope) then ",e.jsx("strong",{children:"Config file"})," (fallback)."]}),e.jsxs("p",{children:["When a project uses its ",e.jsx("strong",{children:"own API key"})," (BYOK), billing is ",e.jsx("span",{className:"text-green-400 font-medium",children:"skipped"})," — the project pays the provider directly."]}),e.jsxs("p",{children:["When using ",e.jsx("strong",{children:"system keys"}),", the project balance is ",e.jsx("span",{className:"text-amber-400 font-medium",children:"debited"})," with the configured markup."]})]})]}),e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:L,children:"System LLM API Keys"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[o.filter(A=>A.isConfigured).length,"/",o.length," configured"]})]}),o.map(A=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:A.name||"(unnamed)"}),A.isConfigured?e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"})," Configured"]}):e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"}),A.keySource&&e.jsxs("span",{className:s("text-[10px] px-1.5 py-0.5 rounded",A.keySource==="system"?"bg-blue-500/20 text-blue-300":"bg-purple-500/20 text-purple-300"),children:[A.keySource," scope"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:w[A.id]?"text":"password",value:j[A.id]??"",onChange:E=>S(a=>({...a,[A.id]:E.target.value})),placeholder:A.apiKeyMasked||`Enter ${A.name} API key...`,className:s(U,"flex-1 font-mono text-xs")}),e.jsx("button",{onClick:()=>T(E=>({...E,[A.id]:!E[A.id]})),className:G,children:w[A.id]?"Hide":"Show"})]}),A.apiKeyMasked&&!j[A.id]&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono pl-1",children:["Current: ",A.apiKeyMasked]})]},A.id)),e.jsxs("button",{onClick:O,disabled:P.isPending||!B,className:V,children:[P.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(le,{className:"w-3 h-3"})," Save to Encrypted Vault"]})]}),e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsx("h3",{className:L,children:"Service API Keys"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Keys for email, notifications and other services (stored encrypted in Supabase)"}),(()=>{const A=i.services??[],E={resend:{link:"https://resend.com/api-keys"},brave:{link:"https://brave.com/search/api/"}};return A.length>0?A.map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:a.name||"(unnamed)"}),a.configured?e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"})," Configured"]}):e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:w[a.id]?"text":"password",value:j[a.id]??"",onChange:y=>S(I=>({...I,[a.id]:y.target.value})),placeholder:a.masked||`Enter ${a.name} key...`,className:s(U,"flex-1 font-mono text-xs")}),e.jsx("button",{onClick:()=>T(y=>({...y,[a.id]:!y[a.id]})),className:G,children:w[a.id]?"Hide":"Show"}),e.jsxs("button",{onClick:()=>{const y=j[a.id]?.trim();if(!y){n.info("Enter a key first");return}P.mutate({provider:a.id,apiKey:y},{onSuccess:()=>{n.success(`${a.name} key saved`),S(I=>{const l={...I};return delete l[a.id],l})},onError:I=>n.error(I.message)})},disabled:P.isPending||!j[a.id]?.trim(),className:V,children:[e.jsx(le,{className:"w-3 h-3"})," Save"]})]}),a.masked&&!j[a.id]&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono pl-1",children:["Current: ",a.masked]}),E[a.id]?.link&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Get key at ",e.jsx("a",{href:E[a.id].link,target:"_blank",rel:"noreferrer",className:"text-[var(--gm-accent-primary)] underline",children:E[a.id].link})]})]},a.id)):["resend","brave"].map(a=>e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-[var(--gm-accent-primary)]",children:a==="resend"?"Resend (Email)":"Brave Search"}),e.jsx("span",{className:"text-[10px] text-amber-400",children:"Not configured"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:j[a]??"",onChange:y=>S(I=>({...I,[a]:y.target.value})),placeholder:`Enter ${a} API key...`,className:s(U,"flex-1 font-mono text-xs")}),e.jsxs("button",{onClick:()=>{const y=j[a]?.trim();y&&P.mutate({provider:a,apiKey:y},{onSuccess:()=>{n.success(`${a} key saved`),S(I=>{const l={...I};return delete l[a],l})},onError:I=>n.error(I.message)})},disabled:P.isPending||!j[a]?.trim(),className:V,children:[e.jsx(le,{className:"w-3 h-3"})," Save"]})]})]},a))})()]}),e.jsxs("div",{className:s(b,"p-5 space-y-5"),children:[e.jsxs("div",{children:[e.jsx("h3",{className:L,children:"Task-Specific AI Configuration"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] mt-1",children:"Configure which provider and model to use for each AI task. These settings apply globally to the platform."})]}),Object.entries(D).map(([A,E])=>{const a=A.replace(/_/g," ").replace(/([A-Z])/g," $1"),y=f[A]?.provider??E?.provider??"",I=f[A]?.model??E?.model??"";return e.jsx(pa,{task:A,taskLabel:a,currentProvider:y,currentModel:I,providerList:o.filter(l=>l.isConfigured),onProviderChange:l=>C(z=>({...z,[A]:{provider:l,model:""}})),onModelChange:l=>C(z=>({...z,[A]:{provider:z[A]?.provider??E?.provider??"",model:l}}))},A)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Y,disabled:N.isPending||Object.keys(f).length===0,className:V,children:[N.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(le,{className:"w-3 h-3"})," Save LLM Configuration"]}),e.jsxs("span",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Changes apply immediately to all AI processing"]})]})]})]})}function ha(){const{data:t,isLoading:x,refetch:u}=ts(),{data:_,refetch:g}=as(),P=rs(),[N,w]=R.useState("all"),[T,j]=R.useState("all"),[S,f]=R.useState("");if(x)return e.jsx(se,{});const m=M(t).models??[],h=M(_).providers??[],c=M(P.data),D=m.map(a=>({...a,_type:a.model_type||"text",_provider:a.provider||"unknown"})),r=D.reduce((a,y)=>(a[y._provider]||(a[y._provider]=[]),a[y._provider].push(y),a),{}),i=Object.keys(r).sort(),p=i.length,k=a=>{const y=Number(a);return!y||isNaN(y)?"—":y>=1e6?`${(y/1e6).toFixed(1)}M`:y>=1e3?`${Math.round(y/1e3)}K`:String(y)},o=a=>{const y=Number(a);return!y||isNaN(y)?"—":`$${y.toFixed(2)}`},O=D.filter(a=>{if(N!=="all"&&a._provider!==N||T!=="all"&&a._type!==T)return!1;if(S){const y=S.toLowerCase(),I=String(a.display_name||a.model_id||"").toLowerCase(),l=String(a.model_id||"").toLowerCase();if(!I.includes(y)&&!l.includes(y))return!1}return!0}),Y=O.filter(a=>a._type==="text"),B=O.filter(a=>a._type==="embedding"),A=async()=>{try{const a=await P.mutateAsync();await u(),await g();const y=M(a);n.success(`Models synced — ${y.totalSynced??0} updated across all providers`)}catch(a){n.error(a.message||"Sync failed")}},E=D.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"Model Metadata",subtitle:E?`${D.length} models across ${p} provider(s)`:"No models synced yet — click Sync to populate"}),e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:L,children:"Provider Sync"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-1",children:"Fetches models from each provider API and persists to the database."})]}),e.jsxs("button",{onClick:A,disabled:P.isPending,className:V,children:[P.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(xe,{className:"w-3.5 h-3.5"}),P.isPending?"Syncing...":"Sync All Providers"]})]}),c.results&&e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(c.results).map(([a,y])=>e.jsxs("span",{className:s("inline-flex items-center gap-1.5 text-[10px] px-2.5 py-1 rounded-lg font-medium border",y.status==="success"?"bg-green-500/10 border-green-500/30 text-green-400":y.status==="skipped"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-red-500/10 border-red-500/30 text-red-400"),children:[e.jsx(je,{provider:a,size:12}),e.jsx("span",{className:"font-semibold",children:a}),y.status==="success"&&e.jsxs(e.Fragment,{children:[" — ",y.synced," synced"]}),y.status==="skipped"&&e.jsxs(e.Fragment,{children:[" — ",y.reason]}),y.status==="error"&&e.jsx(e.Fragment,{children:" — error"})]},a))}),(h.length>0||i.length>0)&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:(h.length>0?h:i.map(a=>({provider:a}))).map((a,y)=>{const I=a.provider||"",l=a.active_models??a.activeModels??r[I]?.length??0,z=a.last_synced,J=N===I;return e.jsxs("button",{onClick:()=>w(J?"all":I),className:s("flex items-center gap-2.5 px-3 py-2.5 rounded-lg border transition-all text-left","bg-[var(--gm-bg-secondary)] border-[var(--gm-border-primary)] hover:border-[var(--gm-border-secondary)]",J&&"ring-1 ring-[var(--gm-accent-primary)]/50 border-[var(--gm-accent-primary)]/40"),children:[e.jsx(je,{provider:I,size:18}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"text-[11px] font-semibold text-[var(--gm-text-primary)] truncate capitalize",children:I}),e.jsxs("div",{className:"text-[10px] tabular-nums",style:{color:ca(I)},children:[l," models"]}),z&&e.jsx("div",{className:"text-[8px] text-[var(--gm-text-tertiary)] truncate",children:new Date(z).toLocaleDateString()})]})]},y)})})]}),e.jsxs("div",{className:s(b,"p-3 flex items-center gap-3 flex-wrap"),children:[e.jsxs("select",{value:N,onChange:a=>w(a.target.value),className:s(U,"w-auto max-w-[180px]"),children:[e.jsx("option",{value:"all",children:"All Providers"}),i.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{value:T,onChange:a=>j(a.target.value),className:s(U,"w-auto max-w-[140px]"),children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"embedding",children:"Embedding"})]}),e.jsx("input",{value:S,onChange:a=>f(a.target.value),placeholder:"Search models...",className:s(U,"w-auto max-w-[220px]")}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] ml-auto tabular-nums",children:[O.length," of ",D.length]})]}),Y.length>0&&e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:L,children:"Text & Vision Models"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[Y.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Model","Provider","Type","Context","$/1M In","$/1M Out"].map(a=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:a},a))})}),e.jsx("tbody",{children:Y.map((a,y)=>{const I=a.display_name||"",l=a.model_id||"—",z=a._provider,J=!!a.supports_vision;return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[I&&e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:I}),e.jsx("div",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)]",children:l})]}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(je,{provider:z,size:14}),e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] capitalize",children:z})]})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)]",children:"text"}),J&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-medium bg-purple-500/15 text-purple-400",children:"vision"})]})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-primary)] tabular-nums font-semibold",children:k(a.context_tokens)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_input)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_output)})]},y)})})]})})]}),B.length>0&&e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-[var(--gm-border-primary)]",children:[e.jsx("h3",{className:L,children:"Embedding Models"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[B.length," models"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Model","Provider","Context","$/1M In"].map(a=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:a},a))})}),e.jsx("tbody",{children:B.map((a,y)=>{const I=a.display_name||"",l=a.model_id||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[I&&e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:I}),e.jsx("div",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)]",children:l})]}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(je,{provider:a.provider||"",size:14}),e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] capitalize",children:a.provider||""})]})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-primary)] tabular-nums font-semibold",children:k(a.context_tokens)}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:o(a.price_input)})]},y)})})]})})]}),!E&&e.jsx(re,{msg:"No models in database yet. Click 'Sync All Providers' to fetch from APIs."}),E&&O.length===0&&e.jsx(re,{msg:"No models match the current filters."})]})}function ga(){const{data:t,isLoading:x,refetch:u}=ns(),{data:_}=ls(),{data:g}=is(),{data:P}=cs(),N=os(),[w,T]=R.useState(null);if(x)return e.jsx(se,{});const j=M(t),S=M(j.stats),f=M(j.database),C=M(_).items??j.pendingItems??[],m=M(g).items??[],h=M(P).items??M(P).history??[],c=f.totalCostTodayUsd??S.totalCost??S.costToday,D=()=>{confirm("Clear all pending items from the queue? This cannot be undone.")&&N.mutate({action:"clear"},{onSuccess:()=>{n.success("Queue cleared"),u()},onError:r=>n.error(r.message)})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"LLM Processing Queue",subtitle:"Monitor and control AI request processing — All requests are persisted in database"}),e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Queue Status"}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[j.database!=null&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-semibold bg-green-500/15 text-green-400",children:"DB: Connected"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",j.isPaused?"bg-amber-500/15 text-amber-400":j.isProcessing?"bg-blue-500/15 text-blue-400":"bg-green-500/15 text-green-400"),children:j.isPaused?"PAUSED":j.isProcessing?"PROCESSING":"IDLE"}),e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] tabular-nums",children:["Queue: ",j.queueLength??0]}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:["Processing: ",j.isProcessing?1:0]}),e.jsxs("button",{onClick:()=>u(),className:G,children:[e.jsx(xe,{className:"w-3 h-3"})," Refresh"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N.mutate({action:"pause"},{onSuccess:()=>{n.success("Queue paused"),u()},onError:r=>n.error(r.message)}),disabled:N.isPending,className:Te,children:[e.jsx(Xt,{className:"w-3 h-3"})," Pause"]}),e.jsxs("button",{onClick:()=>N.mutate({action:"resume"},{onSuccess:()=>{n.success("Queue resumed"),u()},onError:r=>n.error(r.message)}),disabled:N.isPending,className:V,children:[e.jsx(Ot,{className:"w-3 h-3"})," Resume"]}),e.jsx("button",{onClick:D,disabled:N.isPending,className:G,children:"Clear Queue"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 md:grid-cols-7 gap-3",children:[e.jsx(Z,{label:"Pending",value:f.pendingCount??j.queueLength??C.length??0}),e.jsx(Z,{label:"Processing",value:f.processingCount??(j.isProcessing?1:0)}),e.jsx(Z,{label:"Completed",value:f.completedToday??S.successful??S.completed??0,color:"var(--color-brand-500)"}),e.jsx(Z,{label:"Failed",value:f.failedToday??S.failed??0,color:"var(--color-danger-500)"}),e.jsx(Z,{label:"Retry Pending",value:f.retryPendingCount??m.length}),e.jsx(Z,{label:"Avg Time (ms)",value:f.avgProcessingTimeMs??S.avgProcessingTime?Number(f.avgProcessingTimeMs??S.avgProcessingTime).toLocaleString():"0"}),e.jsx(Z,{label:"Cost Today",value:c!=null?`$${Number(c).toFixed(4)}`:"$0",color:"var(--color-brand-500)"})]}),j.currentRequest&&e.jsxs("div",{className:s(b,"p-4"),children:[e.jsx("h3",{className:s(L,"mb-2"),children:"Currently Processing"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-4 h-4 animate-spin text-blue-400 shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-[var(--gm-text-primary)]",children:j.currentRequest.context||j.currentRequest.id}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5",children:[j.currentRequest.priority&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Priority: ",j.currentRequest.priority]}),j.currentRequest.startedAt&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Started: ",new Date(j.currentRequest.startedAt).toLocaleString()]})]})]})]})]}),e.jsxs("div",{className:s(b,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:L,children:"Pending Items"}),e.jsxs("span",{className:"text-xs text-[var(--gm-accent-primary)] tabular-nums",children:[C.length," items"]})]}),C.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No items in queue"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Priority"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Queued"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Action"})]})}),e.jsx("tbody",{children:C.slice(0,20).map((r,i)=>e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[300px]",children:r.context||r.type||r.task||r.id||"Unknown"}),e.jsx("td",{className:"py-1.5 px-2",children:e.jsx("span",{className:s("text-[10px] px-1.5 py-0.5 rounded font-medium",r.priority==="high"?"bg-amber-500/15 text-amber-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"),children:r.priority||"normal"})}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:r.queuedAt?new Date(r.queuedAt).toLocaleTimeString():"—"}),e.jsx("td",{className:"text-right py-1.5 px-2",children:e.jsx("button",{onClick:()=>N.mutate({action:"cancel",id:r.id},{onSuccess:()=>{n.success("Cancelled"),u()}}),className:"text-[10px] text-red-400 hover:underline",children:"Cancel"})})]},i))})]})]}),e.jsxs("div",{className:s(b,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:L,children:"Failed Items"}),m.length>0&&e.jsxs("button",{onClick:()=>N.mutate({action:"retry-all"},{onSuccess:()=>{n.success("Retrying all"),u()}}),disabled:N.isPending,className:Te,children:[e.jsx(ve,{className:"w-3 h-3"})," Retry All"]})]}),m.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No failed items"}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Provider"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Attempts"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Error"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Actions"})]})}),e.jsx("tbody",{children:m.slice(0,20).map((r,i)=>e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[200px]",children:r.context||r.type||"Unknown"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:r.provider||"—"}),e.jsxs("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 tabular-nums",children:[r.attempts??r.attemptCount??"?","/",r.maxAttempts??r.maxRetries??"3"]}),e.jsx("td",{className:"text-[10px] text-red-400 py-1.5 px-2 truncate max-w-[200px]",children:r.error||r.errorMessage||"Error"}),e.jsxs("td",{className:"text-right py-1.5 px-2 whitespace-nowrap",children:[e.jsx("button",{onClick:()=>N.mutate({action:"retry",id:r.id},{onSuccess:()=>{n.success("Retrying"),u()}}),className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline mr-2",children:"Retry"}),e.jsx("button",{onClick:()=>N.mutate({action:"retry",id:r.id+"?reset=true"},{onSuccess:()=>{n.success("Reset & Retrying"),u()}}),className:"text-[10px] text-amber-400 hover:underline",children:"Reset & Retry"})]})]},i))})]})]}),e.jsxs("div",{className:s(b,"p-5"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:L,children:"Recent Processing History"}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:[h.length," items"]})]}),h.length===0?e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"No processing history yet"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Context"}),e.jsx("th",{className:s(F,"text-left py-2 px-2"),children:"Provider / Model"}),e.jsx("th",{className:s(F,"text-center py-2 px-2"),children:"Status"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Tokens"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Time (ms)"}),e.jsx("th",{className:s(F,"text-right py-2 px-2"),children:"Completed"}),e.jsx("th",{className:s(F,"text-center py-2 px-2")})]})}),e.jsx("tbody",{children:h.slice(0,50).map((r,i)=>{const p=r.status==="completed"||r.status==="success",k=r.inputTokens||r.tokensIn||0,o=r.outputTokens||r.tokensOut||0;return e.jsxs("tr",{className:"hover:bg-[var(--gm-surface-hover)] transition-colors cursor-pointer",onClick:()=>T(r),children:[e.jsx("td",{className:"text-xs text-[var(--gm-text-primary)] py-1.5 px-2 truncate max-w-[200px]",children:r.context||r.type||r.task||r.id||"—"}),e.jsxs("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2",children:[r.provider||"—",r.model?` / ${r.model}`:""]}),e.jsx("td",{className:"text-center py-1.5 px-2",children:e.jsx("span",{className:s("inline-block w-2 h-2 rounded-full",p?"bg-green-400":"bg-red-400")})}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right tabular-nums",children:k>0?`${k}→${o}`:"—"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right tabular-nums",children:r.processingTime??r.durationMs??"—"}),e.jsx("td",{className:"text-[10px] text-[var(--gm-text-tertiary)] py-1.5 px-2 text-right",children:r.completedAt?new Date(r.completedAt).toLocaleTimeString():"—"}),e.jsx("td",{className:"text-center py-1.5 px-2",children:e.jsx("button",{className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline",children:"View"})})]},i)})})]})})]}),w&&e.jsx(va,{request:w,onClose:()=>T(null)})]})}function va({request:t,onClose:x}){const u=t.status==="completed"||t.status==="success",_=t.inputTokens||t.tokensIn||0,g=t.outputTokens||t.tokensOut||0,P=t.processingTime||t.durationMs||0,N=t.estimatedCost||t.cost||0,w=T=>{navigator.clipboard.writeText(T),n.success("Copied to clipboard")};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",onClick:x,children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm"}),e.jsxs("div",{className:s(b,"relative w-[900px] max-w-[90vw] max-h-[85vh] flex flex-col"),onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:s("w-10 h-10 rounded-lg flex items-center justify-center",u?"bg-green-500/15":"bg-red-500/15"),children:u?e.jsx(he,{className:"w-5 h-5 text-green-400"}):e.jsx(oe,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:"LLM Request Details"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono",children:t.id||"—"})]})]}),e.jsx("button",{onClick:x,className:"p-1.5 rounded-lg text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-surface-hover)]",children:e.jsx(Ce,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-5",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Context:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.context||t.type||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Provider:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.provider||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Model:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium ml-1",children:t.model||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Status:"})," ",e.jsx("span",{className:s("font-semibold ml-1",u?"text-green-400":"text-red-400"),children:t.status||"—"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx(Z,{label:"Input Tokens",value:_.toLocaleString()}),e.jsx(Z,{label:"Output Tokens",value:g.toLocaleString()}),e.jsx(Z,{label:"Duration (ms)",value:Number(P).toLocaleString()}),e.jsx(Z,{label:"Est. Cost",value:N?`$${Number(N).toFixed(6)}`:"—"})]}),e.jsxs("div",{className:s(b,"p-4"),children:[e.jsx("h4",{className:s(L,"mb-2"),children:"Timeline"}),e.jsxs("div",{className:"flex flex-wrap gap-6 text-[10px]",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Queued:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.queuedAt?new Date(t.queuedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Started:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.startedAt?new Date(t.startedAt).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Completed:"})," ",e.jsx("span",{className:"text-[var(--gm-text-primary)] ml-1",children:t.completedAt?new Date(t.completedAt).toLocaleString():"—"})]})]})]}),(t.error||t.errorMessage)&&e.jsxs("div",{className:"rounded-lg border border-red-500/30 bg-red-500/5 p-4",children:[e.jsxs("h4",{className:"text-xs font-bold text-red-400 mb-1 flex items-center gap-1.5",children:[e.jsx(oe,{className:"w-3.5 h-3.5"})," Error"]}),e.jsx("p",{className:"text-[10px] text-red-300 font-mono whitespace-pre-wrap",children:t.error||t.errorMessage}),t.attempts&&e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-2",children:["Attempt ",t.attempts,"/",t.maxAttempts||t.maxRetries||3]})]}),(t.prompt||t.input)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:L,children:"Prompt / Input"}),e.jsx("button",{onClick:()=>w(String(t.prompt||t.input)),className:G,children:"Copy"})]}),e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:String(t.prompt||t.input)})]}),(t.response||t.output||t.result)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:L,children:"Response / Output"}),e.jsx("button",{onClick:()=>w(String(t.response||t.output||t.result)),className:G,children:"Copy"})]}),e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:String(t.response||t.output||t.result)})]}),e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer text-[10px] text-[var(--gm-accent-primary)] hover:underline",children:"Show Raw JSON Data"}),e.jsx("pre",{className:"mt-2 text-[10px] text-[var(--gm-text-tertiary)] bg-[var(--gm-bg-tertiary)] rounded-lg p-3 max-h-[300px] overflow-auto whitespace-pre-wrap font-mono",children:JSON.stringify(t,null,2)})]})]})]})]})}function ja(){const{data:t,isLoading:x}=ds(),{data:u,refetch:_}=xs(),{data:g}=ms(),{data:P}=ps(),{data:N}=us(),{data:w}=hs();gs();const T=vs(),j=js(),S=ys(),f=bs(),C=Ns(),m=fs(),h=ws(),c=Ss(),D=Cs(),[r,i]=R.useState("status"),[p,k]=R.useState(""),[o,O]=R.useState(null);if(x)return e.jsx(se,{});const Y=M(t),B=M(Y.config),A=M(u),E=M(g),a=M(P).graphs??[],y=M(N),I=M(w).providers??[],l=A.nodeCount??A.nodes??0,z=A.edgeCount??A.relationships??0,J=!!A.connected,q=M(E.metrics??E),ee=E.recommendations??[];return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Knowledge Graph",subtitle:`${B.provider||"—"} · ${J?`${l} nodes · ${z} edges`:"Not connected"}`}),e.jsx("div",{className:s(b,"p-1 flex gap-1"),children:["status","operations","graphs","query"].map(v=>e.jsx("button",{onClick:()=>i(v),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",r===v?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:v==="status"?"Status & Config":v==="operations"?"Sync & Maintenance":v==="graphs"?`Graphs (${a.length})`:"Query"},v))}),r==="status"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(b,"p-4 space-y-3"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:L,children:"Connection"}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",J?"bg-green-500/15 text-green-400":"bg-red-500/15 text-red-400"),children:J?"Connected":"Disconnected"})]}),[["Provider",B.provider],["Graph Name",B.graphName],["Enabled",B.enabled?"Yes":"No"],["Auto Connect",B.autoConnect?"Yes":"No"],["Config Source",Y.source]].map(([v,K])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:v}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-mono",children:String(K??"—")})]},v)),A.message&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:A.message}),e.jsxs("button",{onClick:()=>_(),className:s(G,"w-full justify-center"),children:[e.jsx(ve,{className:"w-3 h-3"})," Refresh Status"]})]}),e.jsxs("div",{className:s(b,"p-4 space-y-3"),children:[e.jsx("h3",{className:L,children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(Z,{label:"Nodes",value:l,color:"var(--gm-accent-primary)"}),e.jsx(Z,{label:"Edges",value:z,color:"var(--gm-accent-primary)"})]}),(()=>{const v=M(A.stats);return Object.keys(v).length>0?e.jsx("div",{className:"space-y-1.5",children:Object.entries(v).map(([K,Q])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:K}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] tabular-nums",children:String(Q)})]},K))}):null})()]})]}),(Object.keys(q).length>0||ee.length>0)&&e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Graph Insights"}),Object.keys(q).length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(q).map(([v,K])=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase mb-1",children:v.replace(/([A-Z])/g," $1").replace(/_/g," ")}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:typeof K=="number"?K<1?K.toFixed(3):K.toFixed(1):String(K)})]},v))}),ee.length>0&&e.jsxs("div",{className:"space-y-1.5 mt-2",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Recommendations"}),ee.map((v,K)=>e.jsxs("div",{className:"flex items-start gap-2 text-[10px]",children:[e.jsx("span",{className:s("shrink-0 mt-0.5",v.priority==="high"?"text-red-400":v.priority==="medium"?"text-amber-400":"text-blue-400"),children:"●"}),e.jsx("span",{className:"text-[var(--gm-text-secondary)]",children:v.message||v.text||v.description})]},K))]})]}),Object.keys(y).length>0&&y.ok!==void 0&&e.jsxs("div",{className:s(b,"p-4 space-y-2"),children:[e.jsx("h3",{className:L,children:"Sync Status"}),[["Status",y.status??y.syncStatus??"—"],["Last Sync",y.lastSyncAt?new Date(y.lastSyncAt).toLocaleString():"—"],["Pending",y.pending??"—"]].map(([v,K])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:v}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:String(K)})]},v))]}),I.length>0&&e.jsxs("div",{className:s(b,"p-4"),children:[e.jsx("h3",{className:s(L,"mb-2"),children:"Available Providers"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map((v,K)=>e.jsx("span",{className:s("text-[10px] px-2.5 py-1 rounded-lg border font-medium",(v.id||v.name)===B.provider?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:v.name||v.id||"?"},K))})]})]}),r==="operations"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsx("h3",{className:L,children:"Sync"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>T.mutate(void 0,{onSuccess:()=>n.success("Sync complete"),onError:v=>n.error(v.message)}),disabled:T.isPending,className:V,children:[T.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(xe,{className:"w-3.5 h-3.5"})," Quick Sync"]}),e.jsxs("button",{onClick:()=>j.mutate(void 0,{onSuccess:()=>n.success("Full sync complete"),onError:v=>n.error(v.message)}),disabled:j.isPending,className:V,children:[j.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ve,{className:"w-3.5 h-3.5"})," Full Sync"]}),e.jsxs("button",{onClick:()=>D.mutate(void 0,{onSuccess:()=>n.success("All projects synced"),onError:v=>n.error(v.message)}),disabled:D.isPending,className:G,children:[D.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ue,{className:"w-3.5 h-3.5"})," Sync All Projects"]})]})]}),e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsx("h3",{className:L,children:"Indexes & Optimization"}),e.jsx("div",{className:"flex gap-3 flex-wrap",children:e.jsxs("button",{onClick:()=>S.mutate(void 0,{onSuccess:()=>n.success("Indexes created"),onError:v=>n.error(v.message)}),disabled:S.isPending,className:G,children:[S.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx($e,{className:"w-3.5 h-3.5"})," Create Indexes"]})})]}),e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsx("h3",{className:L,children:"Cleanup"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Remove orphaned graphs, duplicate nodes, and stale relationships"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>f.mutate(void 0,{onSuccess:v=>n.success(`Cleaned ${v?.deleted??"?"} orphans`),onError:v=>n.error(v.message)}),disabled:f.isPending,className:G,children:[f.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ye,{className:"w-3.5 h-3.5"})," Cleanup Orphan Graphs"]}),e.jsxs("button",{onClick:()=>C.mutate(void 0,{onSuccess:()=>n.success("Duplicates cleaned"),onError:v=>n.error(v.message)}),disabled:C.isPending,className:G,children:[C.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ae,{className:"w-3.5 h-3.5"})," Cleanup Duplicates"]}),e.jsxs("button",{onClick:()=>m.mutate(void 0,{onSuccess:()=>n.success("Sync cleanup done"),onError:v=>n.error(v.message)}),disabled:m.isPending,className:G,children:[m.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ye,{className:"w-3.5 h-3.5"})," Sync Cleanup"]})]})]})]}),r==="graphs"&&e.jsx("div",{className:"space-y-5",children:a.length>0?e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:L,children:"All Graphs"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Graph","Project","Nodes","Edges","Status",""].map(v=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:v},v))})}),e.jsx("tbody",{children:a.map((v,K)=>{const Q=v.name||v.graphName||"—",ae=Q===B.graphName;return e.jsxs("tr",{className:s("border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",ae&&"bg-[var(--gm-accent-primary)]/5"),children:[e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:Q}),ae&&e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded-full bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)] font-bold",children:"ACTIVE"})]})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)]",children:v.projectName||v.projectId||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-primary)] tabular-nums",children:v.nodeCount??v.nodes??"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-primary)] tabular-nums",children:v.edgeCount??v.edges??"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-1.5 py-0.5 rounded-full font-medium",v.orphan?"bg-amber-500/10 text-amber-400":"bg-green-500/10 text-green-400"),children:v.orphan?"Orphan":"Active"})}),e.jsx("td",{className:"px-4 py-2.5",children:!ae&&e.jsx("button",{onClick:()=>{confirm(`Delete graph "${Q}"?`)&&h.mutate(Q,{onSuccess:()=>n.success(`Deleted ${Q}`),onError:W=>n.error(W.message)})},disabled:h.isPending,className:"text-[9px] text-red-400 hover:underline font-medium",children:"Delete"})})]},K)})})]})})]}):e.jsx(re,{msg:"No graphs found. Connect to a graph provider first."})}),r==="query"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Cypher Query"}),e.jsx("textarea",{value:p,onChange:v=>k(v.target.value),placeholder:"MATCH (n) RETURN n LIMIT 10",rows:4,className:s(U,"w-full font-mono text-xs resize-y")}),e.jsxs("button",{onClick:()=>c.mutate({query:p},{onSuccess:v=>{O(v),n.success("Query executed")},onError:v=>n.error(v.message)}),disabled:c.isPending||!p.trim(),className:V,children:[c.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"})," Execute"]})]}),o&&e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Result"}),(()=>{const v=M(o),K=v.nodes??[],Q=v.edges??v.relationships??[],ae=v.rows??v.data??[];return e.jsxs("div",{className:"space-y-3",children:[K.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:["Nodes (",K.length,")"]}),e.jsx("div",{className:"mt-1 max-h-48 overflow-y-auto",children:K.slice(0,50).map((W,ie)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-accent-primary)] font-medium",children:W.label||W.labels?.[0]||W.type||"?"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] truncate flex-1",children:W.name||W.title||W.id||JSON.stringify(W.properties||W).substring(0,80)})]},ie))})]}),Q.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:["Relationships (",Q.length,")"]}),e.jsx("div",{className:"mt-1 max-h-48 overflow-y-auto",children:Q.slice(0,50).map((W,ie)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:W.source||W.from||"?"}),e.jsxs("span",{className:"text-[var(--gm-accent-primary)] font-medium",children:["→ ",W.type||W.label||"?"," →"]}),e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:W.target||W.to||"?"})]},ie))})]}),ae.length>0&&K.length===0&&Q.length===0&&e.jsx("pre",{className:"text-[10px] text-[var(--gm-text-secondary)] font-mono bg-[var(--gm-bg-tertiary)] p-3 rounded-lg overflow-auto max-h-64",children:JSON.stringify(ae,null,2)}),K.length===0&&Q.length===0&&ae.length===0&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No results returned."})]})})()]})]})]})}function ya(){const{data:t,isLoading:x}=ks(),{data:u}=Ps(),{data:_}=As(),{data:g}=Ls(),{data:P}=Rs(),{data:N}=Es(),w=Ms(),T=_s(),j=Ts(),S=Ds(),f=Is(),C=Os(),m=$s(),h=Fs(),c=Us(),D=zs(),r=Gs(),i=Bs(),p=Ks(),[k,o]=R.useState("schema"),[O,Y]=R.useState(""),[B,A]=R.useState("");if(x)return e.jsx(se,{});const E=M(t),a=E.entityTypes??E.entities??[],y=E.relationTypes??E.relations??[],I=M(u),l=M(I.stats),z=Object.values(l).reduce((d,H)=>d+(typeof H=="number"?H:0),0),J=["#38bdf8","#34d399","#fbbf24","#818cf8","#f472b6","#94a3b8","#fb923c","#a78bfa"],q=M(_).suggestions??[],ee=M(g),v=M(P),K=M(N).changes??[],Q=M(w.data),ae=M(T.data),W=M(j.data),ie=q.filter(d=>d.status==="pending"||!d.status);return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Ontology",subtitle:`${a.length} entity types · ${y.length} relation types · ${z} instances`}),e.jsx("div",{className:s(b,"p-1 flex gap-1"),children:["schema","analysis","maintenance"].map(d=>e.jsx("button",{onClick:()=>o(d),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",k===d?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:d==="schema"?`Schema (${a.length+y.length})`:d==="analysis"?`Analysis (${ie.length} pending)`:"Maintenance"},d))}),k==="schema"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:L,children:"Entity Types"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:O,onChange:d=>Y(d.target.value),placeholder:"New entity type...",className:s(U,"w-40 py-1 text-xs")}),e.jsxs("button",{disabled:!O.trim()||i.isPending,onClick:()=>i.mutate({name:O.trim()},{onSuccess:()=>{n.success(`Entity type "${O}" added`),Y("")},onError:d=>n.error(d.message)}),className:V,children:[i.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(be,{className:"w-3 h-3"})," Add"]})]})]}),a.map((d,H)=>{const X=d.name||d.label||d.type||"Unknown",de=l[X]??d.count??0,ge=Array.isArray(d.properties)?d.properties:[],pe=Array.isArray(d.allowedRelations)?d.allowedRelations.length:d.relationCount??0;return e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)] transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full shrink-0 mr-3",style:{backgroundColor:d.color||J[H%J.length]}}),e.jsx("span",{className:"text-xs font-semibold text-[var(--gm-text-primary)] flex-1",children:X}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums px-2 py-0.5 rounded bg-[var(--gm-bg-tertiary)] mx-1",children:[de," instances"]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums mx-1",children:[ge.length," props"]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums mx-1",children:[pe," rels"]})]}),ge.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1.5 ml-[22px]",children:ge.map((ce,we)=>e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:[ce.name||ce,ce.type?`: ${ce.type}`:""]},we))})]},H)}),a.length===0&&e.jsx(re,{msg:"No entity types defined."})]}),e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:L,children:"Relation Types"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{value:B,onChange:d=>A(d.target.value),placeholder:"New relation type...",className:s(U,"w-40 py-1 text-xs")}),e.jsxs("button",{disabled:!B.trim()||p.isPending,onClick:()=>p.mutate({name:B.trim()},{onSuccess:()=>{n.success(`Relation type "${B}" added`),A("")},onError:d=>n.error(d.message)}),className:V,children:[p.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(be,{className:"w-3 h-3"})," Add"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Relation","From","To","Instances"].map(d=>e.jsx("th",{className:s(F,"px-4 py-2 text-left"),children:d},d))})}),e.jsx("tbody",{children:y.map((d,H)=>{const X=d.name||d.type||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2 text-xs font-medium text-[var(--gm-text-primary)]",children:X}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)]",children:d.from||d.source||"*"}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)]",children:d.to||d.target||"*"}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:l[X]??d.count??0})]},H)})})]})}),y.length===0&&e.jsx(re,{msg:"No relation types defined."})]})]}),k==="analysis"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(b,"p-4 flex items-center gap-3 flex-wrap"),children:[e.jsxs("button",{onClick:()=>S.mutate(void 0,{onSuccess:()=>n.success("Graph analysis complete"),onError:d=>n.error(d.message)}),disabled:S.isPending,className:V,children:[S.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"}),"Analyze Graph"]}),e.jsxs("button",{onClick:()=>f.mutate(void 0,{onSuccess:()=>n.success("Sync complete"),onError:d=>n.error(d.message)}),disabled:f.isPending,className:G,children:[f.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(xe,{className:"w-3.5 h-3.5"}),"Force Sync"]}),e.jsxs("button",{onClick:()=>r.mutate(void 0,{onSuccess:()=>n.success("Relationship inference complete"),onError:d=>n.error(d.message)}),disabled:r.isPending,className:G,children:[r.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ke,{className:"w-3.5 h-3.5"}),"Infer Relationships"]}),ie.length>0&&e.jsxs("button",{onClick:()=>h.mutate({minConfidence:.8},{onSuccess:d=>n.success(`Auto-approved ${d?.approved??"?"} suggestions`),onError:d=>n.error(d.message)}),disabled:h.isPending,className:G,children:[h.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(he,{className:"w-3.5 h-3.5"}),"Auto-Approve (",ie.length,")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:s(b,"p-4 space-y-2"),children:[e.jsx("h3",{className:L,children:"Worker Status"}),[["Running",ee.isRunning?"Yes":"No"],["Last Run",ee.lastRun?new Date(ee.lastRun).toLocaleString():"—"],["Total Runs",String(ee.totalRuns??"—")],["Last Result",String(ee.lastResult??"—")]].map(([d,H])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:d}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:H})]},d)),e.jsx("div",{className:"flex gap-2 pt-1",children:["full_analysis","entity_extraction","relation_inference"].map(d=>e.jsx("button",{onClick:()=>c.mutate({type:d},{onSuccess:()=>n.success(`Worker triggered: ${d}`),onError:H=>n.error(H.message)}),disabled:c.isPending,className:"text-[9px] px-2 py-1 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)] border border-[var(--gm-border-primary)]",children:d.replace(/_/g," ")},d))})]}),e.jsxs("div",{className:s(b,"p-4 space-y-2"),children:[e.jsx("h3",{className:L,children:"Sync Status"}),[["Status",String(v.status??v.syncStatus??"—")],["Last Sync",v.lastSyncAt?new Date(v.lastSyncAt).toLocaleString():"—"],["Entity Count",String(v.entityCount??"—")],["Relation Count",String(v.relationCount??"—")]].map(([d,H])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:d}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)]",children:H})]},d))]})]}),q.length>0&&e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsxs("h3",{className:L,children:["AI Suggestions (",ie.length," pending)"]})}),e.jsx("div",{className:"max-h-72 overflow-y-auto",children:q.slice(0,30).map((d,H)=>{const X=d.status==="pending"||!d.status;return e.jsxs("div",{className:"flex items-center px-5 py-3 border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:s("text-[9px] px-1.5 py-0.5 rounded-full font-medium border capitalize",d.type==="entity"?"bg-blue-500/10 border-blue-500/30 text-blue-400":"bg-purple-500/10 border-purple-500/30 text-purple-400"),children:d.type||"unknown"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)] truncate",children:d.name||d.label||d.suggestion||"—"}),e.jsx("span",{className:s("text-[9px] px-1.5 py-0.5 rounded-full capitalize",X?"bg-amber-500/10 text-amber-400":d.status==="approved"?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"),children:d.status||"pending"}),d.confidence&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[(Number(d.confidence)*100).toFixed(0),"%"]})]}),d.reason&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 truncate",children:d.reason})]}),X&&e.jsxs("div",{className:"flex gap-1.5 ml-3 shrink-0",children:[e.jsx("button",{onClick:()=>C.mutate({id:d.id},{onSuccess:()=>n.success("Approved"),onError:de=>n.error(de.message)}),className:"text-[9px] px-2 py-1 rounded bg-green-500/10 text-green-400 hover:bg-green-500/20 border border-green-500/30",children:"Approve"}),e.jsx("button",{onClick:()=>m.mutate({id:d.id},{onSuccess:()=>n.success("Rejected"),onError:de=>n.error(de.message)}),className:"text-[9px] px-2 py-1 rounded bg-red-500/10 text-red-400 hover:bg-red-500/20 border border-red-500/30",children:"Reject"})]})]},H)})})]}),q.length===0&&e.jsx(re,{msg:"No suggestions. Run 'Analyze Graph' to generate AI suggestions."}),K.length>0&&e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:L,children:"Change History"})}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:K.slice(0,20).map((d,H)=>e.jsxs("div",{className:"flex items-center px-5 py-2 border-b border-[var(--gm-border-primary)] last:border-0 text-[10px]",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)] w-36 shrink-0 tabular-nums",children:d.timestamp?new Date(d.timestamp).toLocaleString():"—"}),e.jsx("span",{className:s("px-1.5 py-0.5 rounded-full mr-2 capitalize font-medium border",d.action==="add"?"bg-green-500/10 border-green-500/30 text-green-400":d.action==="remove"?"bg-red-500/10 border-red-500/30 text-red-400":"bg-blue-500/10 border-blue-500/30 text-blue-400"),children:d.action||"—"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] flex-1 truncate",children:d.description||d.detail||`${d.type}: ${d.name}`})]},H))})]})]}),k==="maintenance"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(b,"p-4 flex items-center gap-3 flex-wrap"),children:[e.jsxs("button",{onClick:()=>w.refetch(),disabled:w.isFetching,className:G,children:[w.isFetching?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(De,{className:"w-3.5 h-3.5"}),"Validate Compliance"]}),e.jsxs("button",{onClick:()=>T.refetch(),disabled:T.isFetching,className:G,children:[T.isFetching?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ze,{className:"w-3.5 h-3.5"}),"Diff Schema vs Graph"]}),e.jsxs("button",{onClick:()=>j.refetch(),disabled:j.isFetching,className:G,children:[j.isFetching?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(fe,{className:"w-3.5 h-3.5"}),"Find Unused Types"]})]}),Q.ok&&e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:L,children:"Compliance"}),e.jsxs("span",{className:s("text-xs font-bold tabular-nums",Number(Q.score)>=80?"text-green-400":Number(Q.score)>=50?"text-amber-400":"text-red-400"),children:[Q.score,"%"]}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full",Q.valid?"bg-green-500/10 text-green-400":"bg-amber-500/10 text-amber-400"),children:Q.valid?"Compliant":"Issues Found"})]}),Array.isArray(Q.issues)&&Q.issues.length>0&&e.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:Q.issues.map((d,H)=>e.jsxs("div",{className:"flex items-start gap-2 text-[10px]",children:[e.jsx("span",{className:s("shrink-0 mt-0.5",d.type==="error"?"text-red-400":"text-amber-400"),children:d.type==="error"?"●":"▲"}),e.jsx("span",{className:"text-[var(--gm-text-secondary)]",children:d.message})]},H))})]}),ae.ok&&e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Schema vs Graph Diff"}),ae.diff&&(()=>{const d=ae.diff;return[{key:"missingInSchema",label:"In graph but not in schema",color:"text-amber-400"},{key:"missingInGraph",label:"In schema but not in graph",color:"text-blue-400"},{key:"matching",label:"Matching",color:"text-green-400"}].map(({key:X,label:de,color:ge})=>{const pe=d[X];return!Array.isArray(pe)||pe.length===0?null:e.jsxs("div",{children:[e.jsxs("span",{className:s("text-[10px] font-medium",ge),children:[de," (",pe.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:pe.map((ce,we)=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border border-[var(--gm-border-primary)]",children:typeof ce=="string"?ce:ce.name||"?"},we))})]},X)})})()]}),W.ok&&e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Unused Types"}),(()=>{const d=W.entities??[],H=W.relations??[];return d.length===0&&H.length===0?e.jsx("p",{className:"text-[10px] text-green-400",children:"All types are in use."}):e.jsxs(e.Fragment,{children:[d.length>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"text-[10px] text-amber-400 font-medium",children:["Unused entity types (",d.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:d.map(X=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-400 border border-amber-500/30",children:X},X))})]}),H.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("span",{className:"text-[10px] text-amber-400 font-medium",children:["Unused relation types (",H.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:H.map(X=>e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-amber-500/10 text-amber-400 border border-amber-500/30",children:X},X))})]}),e.jsxs("button",{onClick:()=>D.mutate({entities:d,relations:H},{onSuccess:()=>n.success("Cleanup complete"),onError:X=>n.error(X.message)}),disabled:D.isPending,className:V,children:[D.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ye,{className:"w-3 h-3"})," Cleanup Unused"]})]})})()]}),!Q.ok&&!ae.ok&&!W.ok&&e.jsx(re,{msg:"Run a check above to see results."})]}),I.message&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:I.message})]})}const Ke={extraction:"bg-blue-500/15 text-blue-400 border-blue-500/30",analysis:"bg-purple-500/15 text-purple-400 border-purple-500/30",template:"bg-amber-500/15 text-amber-400 border-amber-500/30",sprint:"bg-green-500/15 text-green-400 border-green-500/30",report:"bg-rose-500/15 text-rose-400 border-rose-500/30"};function ba(){const{data:t,isLoading:x,error:u}=Vs(),_=Hs(),g=Qs(),[P,N]=R.useState("all"),[w,T]=R.useState(""),[j,S]=R.useState(null),[f,C]=R.useState(null),m=t?.templates??[];if(x)return e.jsx(se,{});if(u)return e.jsx(Le,{msg:"Unable to load prompts."});const h=["all",...Array.from(new Set(m.map(i=>i.category))).sort()],c=m.filter(i=>{if(P!=="all"&&i.category!==P)return!1;if(w){const p=w.toLowerCase();return i.name.toLowerCase().includes(p)||i.id.toLowerCase().includes(p)||(i.description||"").toLowerCase().includes(p)}return!0}),D=m.reduce((i,p)=>(i[p.category]=(i[p.category]||0)+1,i),{}),r=i=>{_.mutate({key:i.id,is_active:!i.isActive},{onSuccess:()=>n.success(`${i.name} ${i.isActive?"deactivated":"activated"}`),onError:p=>n.error(p.message)})};return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Prompt Templates",subtitle:`${m.length} templates with auto-versioning across ${Object.keys(D).length} categories`}),e.jsxs("div",{className:s(b,"p-3 flex items-center gap-2 flex-wrap"),children:[h.map(i=>e.jsx("button",{onClick:()=>N(i),className:s("px-3 py-1.5 text-[11px] font-medium rounded-lg border transition-all capitalize",P===i?"bg-[var(--gm-accent-primary)]/15 border-[var(--gm-accent-primary)]/40 text-[var(--gm-accent-primary)]":"bg-[var(--gm-bg-tertiary)] border-transparent text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:i==="all"?`All (${m.length})`:`${i} (${D[i]||0})`},i)),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{value:w,onChange:i=>T(i.target.value),placeholder:"Search prompts...",className:s(U,"w-48 pl-7 py-1.5 text-xs")})]})})]}),e.jsx("div",{className:"space-y-3",children:c.map(i=>e.jsxs("div",{className:s(b,"overflow-hidden group",!i.isActive&&"opacity-60"),children:[e.jsxs("div",{className:"px-5 py-3 flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:i.name||"(unnamed)"}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",Ke[i.category]||"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border-[var(--gm-border-primary)]"),children:i.category}),e.jsx("button",{onClick:()=>r(i),className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border cursor-pointer transition-colors",i.isActive?"bg-green-500/10 border-green-500/30 text-green-400 hover:bg-green-500/20":"bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20"),children:i.isActive?"Active":"Inactive"})]}),i.description&&e.jsx("p",{className:"text-[11px] text-[var(--gm-text-tertiary)] mt-1 line-clamp-1",children:i.description}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2 flex-wrap",children:[e.jsx("span",{className:"text-[9px] font-mono text-[var(--gm-text-tertiary)]",children:i.id}),e.jsx("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:"·"}),e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:i.lastModified}),e.jsx("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:"·"}),i.variables?.slice(0,5).map(p=>e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] font-mono border border-[var(--gm-border-primary)]",children:`{{${p}}}`},p)),(i.variables?.length||0)>5&&e.jsxs("span",{className:"text-[8px] text-[var(--gm-text-tertiary)]",children:["+",i.variables.length-5," more"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 shrink-0",children:[e.jsx("button",{onClick:()=>C(f===i.id?null:i.id),title:"Version History",className:"p-1.5 rounded-lg hover:bg-[var(--gm-surface-hover)] text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] transition-colors",children:e.jsx($t,{className:"w-3.5 h-3.5"})}),e.jsxs("button",{onClick:()=>S(i),className:V,children:[e.jsx(Ft,{className:"w-3 h-3"})," Edit"]})]})]}),e.jsx("div",{className:"px-5 pb-3",children:e.jsxs("pre",{className:"text-[10px] text-[var(--gm-text-tertiary)]/70 max-h-12 overflow-hidden whitespace-pre-wrap font-mono leading-relaxed",children:[i.prompt.substring(0,300),i.prompt.length>300?"…":""]})}),f===i.id&&e.jsx(fa,{promptKey:i.id,currentPrompt:i.prompt,onRestore:p=>g.mutate({key:i.id,version:p},{onSuccess:()=>{n.success(`Restored v${p}`),C(null)},onError:k=>n.error(k.message)})})]},i.id))}),c.length===0&&e.jsx(re,{msg:w?"No prompts match your search.":"No prompt templates found."}),j&&e.jsx(Na,{prompt:j,onClose:()=>S(null),onSave:(i,p,k)=>{const o={key:j.id};i!==j.prompt&&(o.prompt=i,p&&(o.change_reason=p)),k!==void 0&&k!==j.description&&(o.description=k),_.mutate(o,{onSuccess:()=>{n.success("Prompt saved"),S(null)},onError:O=>n.error(O.message)})},isSaving:_.isPending})]})}function Na({prompt:t,onClose:x,onSave:u,isSaving:_}){const[g,P]=R.useState(t.prompt),[N,w]=R.useState(t.description||""),[T,j]=R.useState(""),[S,f]=R.useState("edit"),C=R.useRef(null),m=["document","transcript","conversation","vision","email"].includes(t.id)?t.id:null,{data:h}=kt(S==="preview"&&m?m:null),c=M(h),D=p=>{const k=C.current;if(!k)return;const o=k.selectionStart,O=k.selectionEnd,Y=`{{${p}}}`,B=g.substring(0,o)+Y+g.substring(O);P(B),requestAnimationFrame(()=>{k.focus(),k.setSelectionRange(o+Y.length,o+Y.length)})},r=g!==t.prompt||N!==(t.description||""),i=g.split(`
`).length;return e.jsx(Pt,{open:!0,onClose:x,children:e.jsxs(At,{className:"!max-w-5xl !max-h-[95vh] !p-0 flex flex-col bg-[var(--gm-surface-primary)] border-[var(--gm-border-primary)]",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-[var(--gm-border-primary)] flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-[var(--gm-accent-primary)]"}),e.jsx("h2",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:t.name||"(unnamed)"}),e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",Ke[t.category]||"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] border-[var(--gm-border-primary)]"),children:t.category}),e.jsx("span",{className:"text-[9px] font-mono text-[var(--gm-text-tertiary)]",children:t.id})]}),e.jsx("input",{value:N,onChange:p=>w(p.target.value),placeholder:"Add a description...",className:"mt-1.5 w-full text-[11px] text-[var(--gm-text-secondary)] bg-transparent border-0 outline-none placeholder:text-[var(--gm-text-placeholder)]"})]}),e.jsx("button",{onClick:x,className:"p-1.5 rounded-lg hover:bg-[var(--gm-surface-hover)]",children:e.jsx(Ce,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})})]}),e.jsxs("div",{className:"px-6 pt-2 flex items-center gap-1 border-b border-[var(--gm-border-primary)] shrink-0",children:[["edit","preview"].map(p=>e.jsx("button",{onClick:()=>f(p),className:s("px-3 py-2 text-[11px] font-medium capitalize border-b-2 -mb-px transition-colors",S===p?"border-[var(--gm-accent-primary)] text-[var(--gm-accent-primary)]":"border-transparent text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:p==="edit"?"Editor":"Preview"},p)),e.jsxs("span",{className:"ml-auto text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[i," lines · ",g.length," chars"]})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden flex",children:S==="edit"?e.jsxs("div",{className:"flex flex-1 min-h-0",children:[e.jsx("div",{className:"flex-1 overflow-auto p-4",children:e.jsx("textarea",{ref:C,value:g,onChange:p=>P(p.target.value),className:"w-full h-full min-h-[400px] bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 font-mono text-xs text-[var(--gm-text-primary)] resize-none outline-none focus:border-[var(--gm-border-focus)] focus:shadow-[var(--shadow-focus)] leading-relaxed",spellCheck:!1})}),e.jsxs("div",{className:"w-56 border-l border-[var(--gm-border-primary)] overflow-y-auto p-3 shrink-0 bg-[var(--gm-bg-secondary)]",children:[e.jsx("div",{className:s(L,"mb-2"),children:"Variables"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mb-3",children:"Click to insert at cursor position"}),e.jsx("div",{className:"space-y-1",children:t.variables.map(p=>e.jsx("button",{onClick:()=>D(p),className:"w-full text-left px-2 py-1.5 rounded-lg text-[10px] font-mono bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] hover:bg-[var(--gm-accent-primary)]/10 border border-[var(--gm-border-primary)] transition-colors truncate",children:`{{${p}}}`},p))}),t.variables.length===0&&e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] italic",children:"No variables detected"}),e.jsx("div",{className:s(L,"mt-4 mb-2"),children:"Common Variables"}),e.jsx("div",{className:"space-y-1",children:["CONTENT","FILENAME","ONTOLOGY_CONTEXT","CONTACTS_INDEX","ORG_INDEX","PROJECT_INDEX"].filter(p=>!t.variables.includes(p)).map(p=>e.jsx("button",{onClick:()=>D(p),className:"w-full text-left px-2 py-1.5 rounded-lg text-[10px] font-mono bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)] hover:bg-[var(--gm-accent-primary)]/10 border border-[var(--gm-border-primary)] transition-colors truncate",children:`{{${p}}}`},p))})]})]}):e.jsx("div",{className:"flex-1 overflow-auto p-6",children:m?c.prompt?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:s(L),children:["Rendered Prompt (",m,")"]}),e.jsx("pre",{className:"text-[11px] font-mono text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 max-h-[60vh] overflow-auto",children:typeof c.prompt=="string"?c.prompt:typeof c.prompt=="object"&&c.prompt!==null?JSON.stringify(c.prompt,null,2):String(c.prompt)}),c.ontologyContext&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s(L,"mt-4"),children:"Ontology Context"}),e.jsx("pre",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)] whitespace-pre-wrap bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-3 max-h-40 overflow-auto",children:JSON.stringify(c.ontologyContext,null,2)})]})]}):e.jsx("div",{className:"text-xs text-[var(--gm-text-tertiary)] py-8 text-center",children:"Loading preview..."}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:s(L),children:"Current Template"}),e.jsx("pre",{className:"text-[11px] font-mono text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-4 max-h-[60vh] overflow-auto",children:g}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Live preview is available for: document, transcript, conversation, vision, email prompts."})]})})}),e.jsxs("div",{className:"px-6 py-3 border-t border-[var(--gm-border-primary)] flex items-center gap-3 shrink-0 bg-[var(--gm-bg-secondary)]",children:[e.jsx("input",{value:T,onChange:p=>j(p.target.value),placeholder:"Change reason (optional)...",className:s(U,"flex-1 py-1.5 text-xs")}),e.jsxs("button",{onClick:x,className:G,children:[e.jsx(Ce,{className:"w-3 h-3"})," Cancel"]}),e.jsxs("button",{onClick:()=>u(g,T,N),disabled:_||!r,className:V,children:[_?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(le,{className:"w-3 h-3"}),_?"Saving...":"Save Changes"]})]})]})})}function fa({promptKey:t,currentPrompt:x,onRestore:u}){const{data:_,isLoading:g}=St(t),[P,N]=R.useState(null),{data:w}=Ct(t,P),T=M(_),j=T.versions??[],f=M(w).version??{};return g?e.jsxs("div",{className:"px-5 pb-3 text-xs text-[var(--gm-text-tertiary)]",children:[e.jsx($,{className:"w-3 h-3 animate-spin inline mr-1"}),"Loading versions..."]}):j.length===0?e.jsx("div",{className:"px-5 pb-3 text-xs text-[var(--gm-text-tertiary)] italic",children:"No previous versions."}):e.jsxs("div",{className:"border-t border-[var(--gm-border-primary)] bg-[var(--gm-bg-secondary)]",children:[e.jsxs("div",{className:"px-5 pt-3 pb-2 flex items-center justify-between",children:[e.jsx("span",{className:L,children:"Version History"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:["Current: v",T.current_version??"?"," · ",j.length," previous"]})]}),e.jsx("div",{className:"px-5 pb-3 space-y-1",children:j.map(C=>{const m=C.version,h=P===m;return e.jsxs("div",{children:[e.jsxs("div",{className:s("flex items-center gap-3 text-xs py-1.5 px-2.5 rounded-lg transition-colors",h?"bg-[var(--gm-accent-primary)]/10":"hover:bg-[var(--gm-surface-hover)]"),children:[e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-[var(--gm-bg-tertiary)] text-[var(--gm-accent-primary)] font-mono font-bold tabular-nums",children:["v",m]}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)] tabular-nums text-[10px]",children:C.created_at?new Date(C.created_at).toLocaleString():"—"}),C.change_reason&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-secondary)] italic truncate max-w-[200px]",children:C.change_reason}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(h?null:m),className:"text-[10px] text-[var(--gm-accent-primary)] hover:underline font-medium",children:h?"Hide":"View"}),e.jsx("button",{onClick:()=>u(m),className:"text-[10px] text-amber-400 hover:underline font-medium",children:"Restore"})]})]}),h&&f.prompt_template&&e.jsx("div",{className:"mt-1 mb-2 mx-2",children:e.jsx("pre",{className:"text-[10px] font-mono text-[var(--gm-text-tertiary)] whitespace-pre-wrap bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg p-3 max-h-48 overflow-auto leading-relaxed",children:f.prompt_template})})]},C.id)})})]})}function wa(){const{data:t}=Lt(),x=Rt(),u=Et(),_=Mt(),g=_t(),P=t??{};return e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:L,children:"Knowledge Pipeline"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Embeddings: ",typeof P.embeddingsCount=="number"?P.embeddingsCount:"—"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:()=>x.mutate(void 0,{onSuccess:()=>n.success("Knowledge synthesis complete"),onError:N=>n.error(N.message)}),disabled:x.isPending,className:V,children:[x.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"}),"Synthesize"]}),e.jsxs("button",{onClick:()=>u.mutate(void 0,{onSuccess:()=>n.success("Embeddings generated"),onError:N=>n.error(N.message)}),disabled:u.isPending,className:V,children:[u.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Kt,{className:"w-3.5 h-3.5"}),"Generate Embeddings"]}),e.jsxs("button",{onClick:()=>g.mutate(void 0,{onSuccess:()=>n.success("Resynthesis complete"),onError:N=>n.error(N.message)}),disabled:g.isPending,className:G,children:[g.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ve,{className:"w-3.5 h-3.5"}),"Resynthesis"]}),e.jsxs("button",{onClick:()=>_.mutate(void 0,{onSuccess:()=>n.success("SOT regenerated"),onError:N=>n.error(N.message)}),disabled:_.isPending,className:G,children:[_.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Pe,{className:"w-3.5 h-3.5"}),"Regenerate SOT"]})]})]})}function Sa(){const{data:t,isLoading:x}=Js(),u=Ws(),{data:_}=Ys(),{data:g}=Zs(),P=Xs(),[N,w]=R.useState({}),T=R.useRef(!1),j=M(t),S=M(j.processing),f=_??{},C=g??[];R.useEffect(()=>{!T.current&&Object.keys(S).length>0&&(w({chunkSize:S.chunkSize??4e3,chunkOverlap:S.chunkOverlap??200,similarityThreshold:S.similarityThreshold??.9,pdfToImages:S.pdfToImages??!0,autoProcess:S.autoProcess??!0,temperature:S.temperature??.7}),T.current=!0)},[S]);const m=R.useCallback(()=>{u.mutate({key:"processing",value:N,category:"processing"},{onSuccess:()=>n.success("Processing settings saved"),onError:k=>n.error(k.message)})},[N,u]),h=()=>{P.mutate(void 0,{onSuccess:()=>n.success("Processing started"),onError:k=>n.error(k.message)})};if(x)return e.jsx(se,{});const c=f.status==="processing"||f.status==="running",D=Number(f.progress??0),r=f.currentFile||"",i=Number(f.totalFiles??0),p=Number(f.processedFiles??0);return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Document Processing",subtitle:"Pipeline status, controls, and configuration"}),e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:L,children:"Pipeline Status"}),e.jsxs("button",{onClick:h,disabled:P.isPending||c,className:V,children:[P.isPending||c?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"}),c?"Processing...":"Process All Pending"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:s(b,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx("div",{className:s("w-2 h-2 rounded-full",c?"bg-green-400 animate-pulse":f.status==="error"?"bg-red-400":"bg-[var(--gm-text-tertiary)]")}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Status"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] capitalize",children:f.status||"idle"})]}),e.jsxs("div",{className:s(b,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(qs,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Pending"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-accent-primary)]",children:C.length})]}),e.jsxs("div",{className:s(b,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(ze,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Progress"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:i>0?`${p}/${i}`:"—"})]}),e.jsxs("div",{className:s(b,"p-3.5"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(Ie,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-[10px] font-medium text-[var(--gm-text-tertiary)] uppercase",children:"Completion"})]}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] tabular-nums",children:D>0?`${Math.round(D)}%`:"—"})]})]}),c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full h-2 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)] transition-all duration-500 ease-out",style:{width:`${Math.max(D,2)}%`}})}),r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-3 h-3 animate-spin text-[var(--gm-accent-primary)]"}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] font-mono truncate",children:r})]})]}),f.errors&&Array.isArray(f.errors)&&f.errors.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:s(L,"text-red-400"),children:"Errors"}),f.errors.slice(0,5).map((k,o)=>e.jsx("div",{className:"text-[10px] text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg px-3 py-1.5 font-mono",children:k.file||k.message||JSON.stringify(k)},o))]})]}),e.jsx(wa,{}),C.length>0&&e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:L,children:"Pending Files"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[C.length," files waiting"]})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto",children:C.map((k,o)=>e.jsxs("div",{className:"px-5 py-2 flex items-center gap-3 border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx(Pe,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)] shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-[var(--gm-text-primary)] truncate",children:k.name||k.filename||k.file||"—"}),k.type&&e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:k.type})]}),k.size&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums shrink-0",children:[(Number(k.size)/1024).toFixed(1)," KB"]})]},o))})]}),e.jsxs("div",{className:s(b,"p-5 space-y-5"),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:L,children:"Chunking & Extraction"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Chunk Size (tokens)"}),e.jsx("input",{type:"number",value:N.chunkSize??"",onChange:k=>w(o=>({...o,chunkSize:Number(k.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Size of each text chunk for LLM processing"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Chunk Overlap (tokens)"}),e.jsx("input",{type:"number",value:N.chunkOverlap??"",onChange:k=>w(o=>({...o,chunkOverlap:Number(k.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Overlap between chunks to preserve context"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Similarity Threshold"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"1",value:N.similarityThreshold??"",onChange:k=>w(o=>({...o,similarityThreshold:Number(k.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Cosine similarity for dedup (0.0 – 1.0)"})]})]})]}),e.jsxs("div",{className:s(b,"p-5 space-y-5"),children:[e.jsx("h3",{className:L,children:"LLM & Generation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Temperature"}),e.jsx("input",{type:"number",step:"0.1",min:"0",max:"2",value:N.temperature??"",onChange:k=>w(o=>({...o,temperature:Number(k.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"LLM creativity (0 = deterministic, 1+ = creative)"})]}),e.jsx("div",{className:"flex flex-col justify-center",children:e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-medium",children:"PDF to Images"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Convert PDFs to images for vision model processing"})]}),e.jsx(Ne,{checked:!!N.pdfToImages,onChange:k=>w(o=>({...o,pdfToImages:k}))})]})})]})]}),e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsx("h3",{className:L,children:"Automation"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] font-medium",children:"Auto-Process on Upload"}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:"Automatically process documents when uploaded"})]}),e.jsx(Ne,{checked:!!N.autoProcess,onChange:k=>w(o=>({...o,autoProcess:k}))})]})]}),e.jsxs("button",{onClick:m,disabled:u.isPending,className:V,children:[u.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(le,{className:"w-3 h-3"})," Save Processing Settings"]})]})}function Ca(){const{data:t,isLoading:x}=et(),u=st(),{data:_}=tt(),{data:g}=at(),{data:P}=rt(),{data:N}=nt(),w=lt(),T=it(),j=ct(),S=ot(),[f,C]=R.useState({}),m=R.useRef(!1),[h,c]=R.useState("overview"),D=M(t),r=M(D.config),i=M(_).profiles??[],p=M(M(g).analysis),k=M(P).relationships??[],o=M(N).projects??[];R.useEffect(()=>{!m.current&&Object.keys(r).length>0&&(C({...r}),m.current=!0)},[r]);const O=R.useCallback(()=>{u.mutate(f,{onSuccess:()=>n.success("Configuration saved"),onError:l=>n.error(l.message)})},[f,u]),Y=()=>{w.mutate({forceReanalysis:!1},{onSuccess:()=>n.success("Team analysis completed"),onError:l=>n.error(l.message)})};if(x)return e.jsx(se,{});const B=Number(p.cohesion_score??0),A=p.tension_level||"—",E=p.alliances??[],a=p.tensions??[],y=[{key:"includePersonality",label:"Personality Analysis",desc:"Behavioral profiling and communication identity"},{key:"includeSentiment",label:"Sentiment Tracking",desc:"Emotional tone and sentiment trends"},{key:"includeCommunication",label:"Communication Patterns",desc:"Speaking style, directness, verbosity"},{key:"includeCollaboration",label:"Collaboration Metrics",desc:"Teamwork, alignment, and cooperation signals"}],I=i.reduce((l,z)=>{const J=z.confidence_level||"low";return l[J]=(l[J]||0)+1,l},{});return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Team Behavioral Analysis",subtitle:`${i.length} profiles · ${k.length} relationships · Cohesion ${B||"—"}%`}),e.jsx("div",{className:s(b,"p-1 flex gap-1"),children:["overview","config","projects"].map(l=>e.jsx("button",{onClick:()=>c(l),className:s("flex-1 px-3 py-2 text-[11px] font-medium rounded-lg capitalize transition-colors",h===l?"bg-[var(--gm-accent-primary)]/15 text-[var(--gm-accent-primary)]":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-secondary)]"),children:l==="overview"?"Overview & Analysis":l==="config"?"Configuration":"Projects"},l))}),h==="overview"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(b,"p-4 flex items-center gap-3 flex-wrap"),children:[e.jsxs("button",{onClick:Y,disabled:w.isPending,className:V,children:[w.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ue,{className:"w-3.5 h-3.5"}),w.isPending?"Analyzing...":"Run Team Analysis"]}),e.jsxs("button",{onClick:()=>j.mutate(void 0,{onSuccess:()=>n.success("Graph synced"),onError:l=>n.error(l.message)}),disabled:j.isPending,className:G,children:[j.isPending?e.jsx($,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ke,{className:"w-3.5 h-3.5"}),"Sync to Graph"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(Z,{label:"Profiles",value:i.length,color:"var(--gm-accent-primary)"}),e.jsx(Z,{label:"Relationships",value:k.length,color:"var(--gm-accent-primary)"}),e.jsx(Z,{label:"Cohesion",value:B>0?`${B}%`:"—",color:B>=70?"#22c55e":B>=40?"#f59e0b":"#ef4444"}),e.jsx(Z,{label:"Alliances",value:E.length,color:"#22c55e"}),e.jsx(Z,{label:"Tensions",value:a.length,color:"#ef4444"})]}),p.analysis_data&&e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Team Dynamics"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Tension Level"}),e.jsx("div",{className:s("text-sm font-bold capitalize",A==="high"?"text-red-400":A==="medium"?"text-amber-400":"text-green-400"),children:A})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Team Size"}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)]",children:p.team_size||"—"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase",children:"Communication"}),e.jsx("div",{className:"text-sm font-bold text-[var(--gm-text-primary)] truncate",children:p.dominant_communication_pattern||"—"})]})]})]}),i.length>0&&e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsx("h3",{className:L,children:"Behavioral Profiles"}),e.jsx("div",{className:"flex gap-1.5",children:Object.entries(I).map(([l,z])=>e.jsxs("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium border capitalize",l==="very_high"||l==="high"?"bg-green-500/10 border-green-500/30 text-green-400":l==="medium"?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:[z," ",l.replace("_"," ")]},l))})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Person","Style","Motivation","Risk","Influence","Confidence","Transcripts",""].map(l=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:l},l))})}),e.jsx("tbody",{children:i.map((l,z)=>{const J=M(l.contact),q=J.full_name||J.name||l.contact_id||"—";return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsxs("td",{className:"px-4 py-2.5",children:[e.jsx("div",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:q}),J.role&&e.jsx("div",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:J.role})]}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-secondary)] capitalize",children:l.communication_style||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-secondary)] capitalize",children:l.dominant_motivation||"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize",l.risk_tolerance==="high"?"bg-red-500/10 text-red-400":l.risk_tolerance==="medium"?"bg-amber-500/10 text-amber-400":"bg-green-500/10 text-green-400"),children:l.risk_tolerance||"—"})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-12 h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)]",style:{width:`${Number(l.influence_score??0)}%`}})}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-primary)] tabular-nums font-semibold",children:l.influence_score??0})]})}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize",l.confidence_level==="high"||l.confidence_level==="very_high"?"bg-green-500/10 text-green-400":l.confidence_level==="medium"?"bg-amber-500/10 text-amber-400":"bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]"),children:(l.confidence_level||"—").replace("_"," ")})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:l.transcript_count??0}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("button",{onClick:()=>T.mutate({personId:l.contact_id||l.id,forceReanalysis:!0},{onSuccess:()=>n.success(`Re-analyzed ${q}`),onError:ee=>n.error(ee.message)}),disabled:T.isPending,className:"text-[9px] text-[var(--gm-accent-primary)] hover:underline font-medium",children:"Re-analyze"})})]},z)})})]})})]}),k.length>0&&e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:L,children:"Behavioral Relationships"})}),e.jsx("div",{className:"overflow-x-auto max-h-64 overflow-y-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)] sticky top-0 bg-[var(--gm-surface-primary)]",children:["From","To","Type","Strength","Confidence"].map(l=>e.jsx("th",{className:s(F,"px-4 py-2 text-left"),children:l},l))})}),e.jsx("tbody",{children:k.map((l,z)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2 text-xs text-[var(--gm-text-primary)]",children:l.from_name||l.from_contact_id||"—"}),e.jsx("td",{className:"px-4 py-2 text-xs text-[var(--gm-text-primary)]",children:l.to_name||l.to_contact_id||"—"}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium capitalize border",l.relationship_type==="tension_with"||l.relationship_type==="competes_with"?"bg-red-500/10 border-red-500/30 text-red-400":l.relationship_type==="aligned_with"||l.relationship_type==="supports"||l.relationship_type==="mentors"?"bg-green-500/10 border-green-500/30 text-green-400":"bg-[var(--gm-bg-tertiary)] border-[var(--gm-border-primary)] text-[var(--gm-text-tertiary)]"),children:(l.relationship_type||"—").replace(/_/g," ")})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-10 h-1.5 rounded-full bg-[var(--gm-bg-tertiary)] overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-[var(--gm-accent-primary)]",style:{width:`${Math.round(Number(l.strength??0)*100)}%`}})}),e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] tabular-nums",children:[(Number(l.strength??0)*100).toFixed(0),"%"]})]})}),e.jsx("td",{className:"px-4 py-2 text-[10px] text-[var(--gm-text-tertiary)] capitalize",children:l.confidence||"—"})]},z))})]})})]}),i.length===0&&e.jsx(re,{msg:"No behavioral profiles yet. Run Team Analysis to start profiling."})]}),h==="config"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:s(b,"p-5 space-y-5"),children:[e.jsx("h3",{className:L,children:"Analysis Parameters"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Frequency"}),e.jsxs("select",{value:f.analysisFrequency||"weekly",onChange:l=>C(z=>({...z,analysisFrequency:l.target.value})),className:s(U,"w-full"),children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"How often to auto-run analysis"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Min Meetings"}),e.jsx("input",{type:"number",min:"1",value:f.minMeetingsForAnalysis??3,onChange:l=>C(z=>({...z,minMeetingsForAnalysis:Number(l.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Minimum transcripts before profiling"})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1.5"),children:"Sentiment Threshold"}),e.jsx("input",{type:"number",step:"0.1",min:"-1",max:"0",value:f.sentimentThreshold??-.3,onChange:l=>C(z=>({...z,sentimentThreshold:Number(l.target.value)})),className:s(U,"w-full")}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] mt-1",children:"Alert below this score (-1 to 0)"})]})]})]}),e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Analysis Modules"}),y.map(({key:l,label:z,desc:J})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:z}),e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:J})]}),e.jsx(Ne,{checked:f[l]!==!1,onChange:q=>C(ee=>({...ee,[l]:q}))})]},l))]}),e.jsxs("button",{onClick:O,disabled:u.isPending,className:V,children:[u.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(le,{className:"w-3 h-3"})," Save Configuration"]})]}),h==="projects"&&e.jsx("div",{className:"space-y-5",children:o.length>0?e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsx("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)]",children:e.jsx("h3",{className:L,children:"All Projects — Analysis Status"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["Project","Enabled","Last Analysis",""].map(l=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:l},l))})}),e.jsx("tbody",{children:o.map((l,z)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs font-medium text-[var(--gm-text-primary)]",children:l.name||l.id||"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[9px] px-2 py-0.5 rounded-full font-medium",l.isEnabled?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"),children:l.isEnabled?"Enabled":"Disabled"})}),e.jsx("td",{className:"px-4 py-2.5 text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:l.lastAnalysisAt?new Date(l.lastAnalysisAt).toLocaleString():"Never"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("button",{onClick:()=>S.mutate({projectId:l.id},{onSuccess:()=>n.success(`Analysis triggered for ${l.name}`),onError:J=>n.error(J.message)}),disabled:S.isPending,className:V,children:[S.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(ue,{className:"w-3 h-3"})," Analyze"]})})]},z))})]})})]}):e.jsx(re,{msg:"No projects found or admin endpoint not available."})})]})}function ka(){const{data:t,isLoading:x}=dt(),u=xt(),_=mt(),g=pt(),[P,N]=R.useState(""),[w,T]=R.useState(""),[j,S]=R.useState(!1),[f,C]=R.useState(""),[m,h]=R.useState(!1),c=R.useRef(null),D=M(t),r=!!D.enabled,i=!!D.hasSystemCredentials,p=D.rootFolderId??"",k=D.bootstrappedAt,o=D.pendingProjects??[],O=D.configuredProjects??[];R.useEffect(()=>{!x&&t&&N(p)},[x,t,p]);const Y=R.useCallback(E=>{const a=E.target.files?.[0];if(!a)return;C(a.name);const y=new FileReader;y.onload=I=>{const l=I.target?.result;try{JSON.parse(l),T(l),h(!0),n.success("Service account JSON loaded")}catch{n.error("Invalid JSON file")}},y.readAsText(a),c.current&&(c.current.value="")},[]),B=R.useCallback(()=>{const E={enabled:r,rootFolderId:P.trim()};w&&(E.serviceAccountJson=w),u.mutate(E,{onSuccess:()=>{n.success("Configuration saved to Supabase vault"),T(""),C(""),h(!1)},onError:a=>n.error(a.message)})},[r,P,w,u]);if(x)return e.jsx(se,{});const A=m||P!==p;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"Google Drive Integration",subtitle:"Credentials stored encrypted in Supabase vault — never in .env"}),e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] flex items-center gap-2",children:[e.jsx(Ut,{className:"w-4 h-4"})," Connection Status"]}),e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",i&&r?"bg-green-500/15 text-green-400":"bg-red-500/15 text-red-400"),children:i&&r?"Connected":i?"Disabled":"Not Configured"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Service Account"}),e.jsx("span",{className:s("font-medium",i?"text-green-400":"text-red-400"),children:i?"Uploaded (encrypted)":"Not uploaded"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Root Folder"}),e.jsx("span",{className:s("font-mono text-[11px]",p?"text-[var(--gm-text-primary)]":"text-red-400"),children:p||"Not set"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Integration"}),e.jsx("span",{className:s("font-medium",r?"text-green-400":"text-[var(--gm-text-tertiary)]"),children:r?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:"Last Bootstrap"}),e.jsx("span",{className:"text-[var(--gm-text-primary)] tabular-nums",children:k?new Date(k).toLocaleString():"Never"})]})]})]}),e.jsxs("div",{className:s(b,"p-5 space-y-5"),children:[e.jsx("h3",{className:s(L),children:"Configuration"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-[var(--gm-text-primary)] font-medium",children:"Enable Integration"}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5",children:"Activate Google Drive sync for all projects"})]}),e.jsx(Ne,{checked:r,onChange:E=>u.mutate({enabled:E,rootFolderId:P||p},{onSuccess:()=>n.success(E?"Integration enabled":"Integration disabled"),onError:a=>n.error(a.message)}),disabled:u.isPending})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] flex items-center gap-1.5",children:[e.jsx(Ee,{className:"w-3 h-3"})," Root Folder ID"]}),e.jsx("input",{type:"text",value:P,onChange:E=>{N(E.target.value),h(!0)},placeholder:"e.g. 1ABC2DEF3GHI4JKL5MNO6PQR...",className:s(U,"w-full font-mono text-[11px]")}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"The Google Drive folder ID where all project folders will be created. Find it in the Drive folder URL after /folders/."})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-medium text-[var(--gm-text-secondary)] flex items-center gap-1.5",children:[e.jsx(zt,{className:"w-3 h-3"})," Service Account JSON"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>c.current?.click(),className:G,children:[e.jsx(Gt,{className:"w-3 h-3"})," Upload JSON File"]}),e.jsx("input",{ref:c,type:"file",accept:".json,application/json",onChange:Y,className:"hidden"}),f&&e.jsxs("span",{className:"text-[10px] text-green-400 flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"})," ",f]}),!f&&i&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Credentials already stored (encrypted in Supabase vault)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:w,onChange:E=>{T(E.target.value),h(!0)},placeholder:"Or paste the service account JSON here...",rows:4,className:s(U,"w-full font-mono text-[10px] leading-relaxed resize-none",!j&&w?"text-transparent":"")}),w&&e.jsx("button",{onClick:()=>S(!j),className:"absolute top-2 right-2 p-1 rounded hover:bg-[var(--gm-bg-tertiary)] text-[var(--gm-text-tertiary)]",children:j?e.jsx(Bt,{className:"w-3 h-3"}):e.jsx(Fe,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Download from Google Cloud Console > IAM > Service Accounts > Keys. The JSON is encrypted at rest via pgcrypto."})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-[var(--gm-border-primary)]",children:[e.jsxs("button",{onClick:B,disabled:u.isPending||!A,className:V,children:[u.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(le,{className:"w-3 h-3"}),"Save Configuration"]}),A&&e.jsxs("span",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Unsaved changes"]})]})]}),e.jsxs("div",{className:s(b,"p-5 space-y-4"),children:[e.jsx("h3",{className:s(L),children:"Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>g.mutate(void 0,{onSuccess:E=>{const a=M(E);n.success(a.message||"Bootstrap complete")},onError:E=>n.error(E.message)}),disabled:g.isPending||!i||!r,className:V,children:[g.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(Ee,{className:"w-3 h-3"}),"Bootstrap All Projects"]}),e.jsxs("button",{onClick:()=>_.mutate(void 0,{onSuccess:()=>n.success("Sync started"),onError:E=>n.error(E.message)}),disabled:_.isPending||!i||!r,className:G,children:[_.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(xe,{className:"w-3 h-3"}),"Sync Now"]})]}),!i&&e.jsxs("p",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Upload service account credentials to enable actions"]}),i&&!r&&e.jsxs("p",{className:"text-[10px] text-amber-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," Enable the integration to use these actions"]})]}),O.length>0&&e.jsxs("div",{className:s(b,"p-5"),children:[e.jsxs("h3",{className:s(L,"mb-3"),children:["Configured Projects (",O.length,")"]}),e.jsx("div",{className:"space-y-0",children:O.map((E,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 text-xs border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)] font-medium",children:E.name}),e.jsx("span",{className:"text-[var(--gm-text-tertiary)] font-mono text-[10px]",children:E.folderId})]},a))})]}),o.length>0&&e.jsxs("div",{className:s(b,"p-5"),children:[e.jsxs("h3",{className:s(L,"mb-3"),children:["Pending Projects (",o.length,")"]}),e.jsx("div",{className:"space-y-0",children:o.map((E,a)=>e.jsxs("div",{className:"flex items-center justify-between py-2 text-xs border-b border-[var(--gm-border-primary)] last:border-0",children:[e.jsx("span",{className:"text-[var(--gm-text-primary)]",children:E.name}),e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-amber-500/15 text-amber-400",children:"Pending"})]},a))})]})]})}function Pa(){const{data:t}=ut(),{data:x}=ht(),{data:u,isLoading:_,refetch:g}=gt(),P=vt(),N=jt(),w=yt(),T=bt(),[j,S]=R.useState({}),f=R.useRef(!1),C=M(t),m=M(M(x).config),h=M(u).projects??[];return R.useEffect(()=>{!f.current&&Object.keys(m).length>0&&(S({...m}),f.current=!0)},[m]),_?e.jsx(se,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"Billing & Cost Control",subtitle:"Manage project balances, pricing, and cost limits"}),e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Exchange Rate (USD to EUR)"}),C.auto!=null&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-3 h-3 text-[var(--gm-accent-primary)]"}),e.jsx("span",{className:"text-xs text-[var(--gm-accent-primary)]",children:C.auto?"Automatic rate from API":"Manual rate"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-[var(--gm-accent-primary)]",children:"Current Rate: "}),e.jsx("span",{className:"text-lg font-bold text-[var(--gm-text-primary)] tabular-nums",children:String(C.currentRate??C.rate??"—")})]}),e.jsxs("div",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Source: ",String(C.source??"api")," · Updated: ",C.lastUpdated||C.updatedAt?new Date(C.lastUpdated||C.updatedAt).toLocaleString():"—"]}),!C.auto&&e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"Manual Rate"}),e.jsx("input",{type:"number",step:"0.0001",min:"0",defaultValue:Number(C.manualRate??C.currentRate??.92),onBlur:c=>w.mutate({auto:!1,manualRate:Number(c.target.value)},{onSuccess:()=>n.success("Manual rate saved"),onError:D=>n.error(D.message)}),className:s(U,"w-40")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>P.mutate(void 0,{onSuccess:()=>n.success("Rate refreshed"),onError:c=>n.error(c.message)}),disabled:P.isPending,className:G,children:[P.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(xe,{className:"w-3 h-3"})," Refresh Rate"]}),e.jsxs("button",{onClick:()=>w.mutate({auto:!(C.auto??!0)},{onSuccess:()=>n.success("Exchange rate mode updated"),onError:c=>n.error(c.message)}),disabled:w.isPending,className:G,children:["Switch to ",C.auto?"Manual":"Automatic"]})]})]}),e.jsxs("div",{className:s(b,"p-5 space-y-3"),children:[e.jsx("h3",{className:L,children:"Global Pricing Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"Fixed Markup (%)"}),e.jsx("input",{type:"number",value:j.fixed_markup_percent??0,onChange:c=>S(D=>({...D,fixed_markup_percent:Number(c.target.value)})),className:s(U,"w-full")})]}),e.jsxs("div",{children:[e.jsx("label",{className:s(F,"block mb-1"),children:"Period Type"}),e.jsxs("select",{value:j.period_type??"monthly",onChange:c=>S(D=>({...D,period_type:c.target.value})),className:s(U,"w-full"),children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"weekly",children:"Weekly"})]})]})]}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"Applied when no tier matches"}),e.jsxs("button",{onClick:()=>N.mutate(j,{onSuccess:()=>n.success("Global pricing saved"),onError:c=>n.error(c.message)}),disabled:N.isPending,className:V,children:[N.isPending?e.jsx($,{className:"w-3 h-3 animate-spin"}):e.jsx(le,{className:"w-3 h-3"})," Save Global Pricing"]})]}),e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsxs("div",{className:"px-5 py-3 border-b border-[var(--gm-border-primary)] flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)]",children:"Projects Billing"}),e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[h.length," projects · ",h.filter(c=>c.blocked).length," blocked · ",h.filter(c=>c.unlimited).length," unlimited"]})]}),e.jsxs("button",{onClick:()=>g(),className:G,children:[e.jsx(xe,{className:"w-3 h-3"})," Refresh"]})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["PROJECT","BALANCE","STATUS","KEY SOURCE","TOKENS (PERIOD)","COST (PERIOD)","ACTIONS"].map(c=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:c},c))})}),e.jsx("tbody",{children:h.map((c,D)=>{const r=c.key_sources??{},i=!!c.uses_own_keys,p=!!c.all_own_keys,k=Object.entries(r);return e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs font-semibold text-[var(--gm-text-primary)]",children:c.name||c.project_name||c.project_id}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-secondary)] tabular-nums",children:c.unlimited_balance?"∞ Unlimited":`${c.balance_eur??c.balance??0} €`}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-semibold",c.is_blocked?"bg-red-500/15 text-red-400":c.unlimited_balance?"bg-green-500/15 text-green-400":"bg-blue-500/15 text-blue-400"),children:c.is_blocked?"BLOCKED":c.unlimited_balance?"UNLIMITED":"ACTIVE"})}),e.jsxs("td",{className:"px-4 py-2.5",children:[k.length===0?e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No keys"}):p?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-purple-500/15 text-purple-400 font-semibold",title:"BYOK: billing skipped",children:"BYOK"}):i?e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-amber-500/15 text-amber-400 font-semibold",title:"Mixed: some own keys, some system keys",children:"MIXED"}):e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-blue-500/15 text-blue-400 font-semibold",title:"Using system keys: billing active",children:"SYSTEM"}),k.length>0&&e.jsx("div",{className:"mt-0.5 flex flex-wrap gap-1",children:k.map(([o,O])=>e.jsxs("span",{className:s("text-[9px] px-1 py-px rounded",O==="project"?"bg-purple-500/10 text-purple-300":"bg-blue-500/10 text-blue-300"),children:[o,":",O[0]?.toUpperCase()]},o))})]}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:c.tokens_this_period!=null?`${(Number(c.tokens_this_period)/1e3).toFixed(1)}K`:"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums",children:c.billable_cost_this_period!=null?`${Number(c.billable_cost_this_period).toFixed(2)} €`:"—"}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>T.mutate({projectId:c.project_id||c.id,action:"block",data:{blocked:!c.is_blocked}},{onSuccess:()=>{n.success(c.is_blocked?"Unblocked":"Blocked"),g()},onError:o=>n.error(o.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:c.is_blocked?"Unblock":"Block",children:e.jsx(Ae,{className:"w-3.5 h-3.5 text-amber-400"})}),e.jsx("button",{onClick:()=>T.mutate({projectId:c.project_id||c.id,action:"unlimited",data:{unlimited:!c.unlimited_balance}},{onSuccess:()=>{n.success(c.unlimited_balance?"Limited":"Set unlimited"),g()},onError:o=>n.error(o.message)}),className:"p-1 rounded hover:bg-[var(--gm-surface-hover)]",title:c.unlimited_balance?"Remove unlimited":"Set unlimited",children:e.jsx("span",{className:"text-[10px]",children:c.unlimited_balance?"∞":"$"})})]})})]},D)})})]}),h.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No projects found."})]})]})}function Aa(){const[t,x]=R.useState(""),[u,_]=R.useState(""),[g,P]=R.useState(1),N=50,{data:w,isLoading:T}=Nt({page:g,limit:N,search:t||void 0,filter:u||void 0}),{data:j}=ft(),S=M(w),f=S.logs??[],m=M(j).logs??[],h=R.useMemo(()=>{const r=[...f,...m];return r.sort((i,p)=>{const k=new Date(i.changed_at||i.timestamp||i.created_at||"1970-01-01").getTime()||0;return(new Date(p.changed_at||p.timestamp||p.created_at||"1970-01-01").getTime()||0)-k}),r},[f,m]),c=S.total??h.length;if(T)return e.jsx(se,{});const D=r=>r==="critical"||r==="error"?"bg-red-500/15 text-red-400":r==="warning"?"bg-amber-500/15 text-amber-400":"bg-blue-500/15 text-blue-400";return e.jsxs("div",{className:"space-y-5",children:[e.jsx(te,{title:"Audit Log"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(fe,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"}),e.jsx("input",{placeholder:"Search...",value:t,onChange:r=>{x(r.target.value),P(1)},className:s(U,"flex-1")})]}),e.jsxs("select",{value:u,onChange:r=>{_(r.target.value),P(1)},className:s(U,"w-28"),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"critical",children:"Critical"})]})]}),e.jsxs("div",{className:s(b,"overflow-hidden"),children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-[var(--gm-border-primary)]",children:["TIMESTAMP","USER","ACTION","DETAILS","SEVERITY","IP"].map(r=>e.jsx("th",{className:s(F,"px-4 py-2.5 text-left"),children:r},r))})}),e.jsx("tbody",{children:h.map((r,i)=>e.jsxs("tr",{className:"border-b border-[var(--gm-border-primary)] last:border-0 hover:bg-[var(--gm-surface-hover)]",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] tabular-nums whitespace-nowrap",children:r.changed_at||r.timestamp||r.created_at?new Date(r.changed_at||r.timestamp||r.created_at).toLocaleString():"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs font-medium text-[var(--gm-text-primary)]",children:r.changed_by_email||r.user||r.actor||"System"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-secondary)]",children:r.action||r.operation||r.event_type||"—"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] max-w-[200px] truncate",children:r.details||r.config_key||r.table_name||r.description||""}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:s("text-[10px] px-2 py-0.5 rounded-full font-medium",D(r.severity||r.level||"info")),children:r.severity||r.level||"info"})}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-[var(--gm-text-tertiary)] font-mono",children:r.ip||r.ip_address||""})]},i))})]}),h.length===0&&e.jsx("div",{className:"p-8 text-center text-sm text-[var(--gm-text-tertiary)]",children:"No audit log entries."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[c," entries"]}),c>N&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>P(r=>Math.max(1,r-1)),disabled:g<=1,className:G,children:"Previous"}),e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)] self-center",children:["Page ",g]}),e.jsx("button",{onClick:()=>P(r=>r+1),disabled:h.length<N,className:G,children:"Next"})]})]})]})}function Qa(){const[t,x]=R.useState("users");return e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-48 shrink-0 border-r border-[var(--gm-border-primary)] bg-[var(--gm-bg-primary)] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-4 border-b border-[var(--gm-border-primary)]",children:[e.jsx(De,{className:"w-4 h-4 text-[var(--gm-accent-primary)]",style:{filter:"drop-shadow(0 0 6px var(--gm-accent-primary))"}}),e.jsx("span",{className:"text-sm font-bold text-[var(--gm-accent-primary)]",children:"Admin"})]}),e.jsx("nav",{className:"py-2",children:oa.map(u=>{const _=u.icon,g=t===u.key;return e.jsxs("button",{onClick:()=>x(u.key),className:s("w-full flex items-center gap-2.5 px-4 py-2 text-xs transition-colors",g?"text-[var(--gm-accent-primary)] bg-[var(--gm-surface-hover)] font-semibold":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:bg-[var(--gm-surface-hover)]"),children:[e.jsx(_,{className:"w-3.5 h-3.5 shrink-0"}),e.jsx("span",{className:"flex-1 text-left",children:u.label}),g&&e.jsx(He,{className:"w-3 h-3 shrink-0"})]},u.key)})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx(da,{}),t==="users"&&e.jsx(xa,{}),t==="system"&&e.jsx(ma,{}),t==="llm-providers"&&e.jsx(ua,{}),t==="model-metadata"&&e.jsx(ha,{}),t==="llm-queue"&&e.jsx(ga,{}),t==="graph"&&e.jsx(ja,{}),t==="ontology"&&e.jsx(ya,{}),t==="prompts"&&e.jsx(ba,{}),t==="processing"&&e.jsx(Sa,{}),t==="team-analysis"&&e.jsx(Ca,{}),t==="google-drive"&&e.jsx(ka,{}),t==="billing"&&e.jsx(Pa,{}),t==="audit-log"&&e.jsx(Aa,{})]})]})}export{Qa as default};
//# sourceMappingURL=AdminPage-B1VaARcI.js.map
