import{c as We,r as p,j as e,P as fe,M as gt,T as he,a as n,eL as bt,N as C,O as y,a2 as q,eM as jt,af as vt,eN as yt,U as Ue,eO as Nt,eP as qe,eQ as Ke,eR as Ve,eS as ft,eT as wt,aj as me,ai as te,Z as He,a0 as kt,K as _t,v as St,an as Ct,C as Qe,ae as Tt,G as At,eU as Pt,eV as Dt,eW as Et,eX as Mt,eY as Rt,eZ as $t,e_ as Lt,e$ as Bt,f0 as It,aM as Ot,aL as zt,Y as Ye,ac as Ft,ad as Ee,a1 as Gt,ao as Wt}from"./main-fI1tvvj5.js";import{E as Ut}from"./ErrorState-BlfBI5b-.js";import{O as Xe}from"./OwnerBadge-Gz64yXXh.js";import{C as qt}from"./circle-x-ClEi8u6i.js";import{C as K}from"./circle-check-big-00qMcaeM.js";import{G as Kt}from"./grip-vertical-CAr9ayAL.js";import{S as Y}from"./sparkles-BVZ2_1k0.js";import{T as Vt,a as Ht}from"./thumbs-up-BTyYq8Ht.js";import{L as Qt}from"./list-checks-Cksw-JPh.js";import{P as se}from"./plus-B5uVkXEF.js";import{A as Yt}from"./arrow-right-CmWJZO0T.js";import{C as ge}from"./circle-B13voKcq.js";import{A as Xt}from"./arrow-left-BmkUHkl7.js";import{P as Zt}from"./pen-line-D1cINlNF.js";import{P as Jt}from"./play-BrIJzO2k.js";import{S as es}from"./square-rnMXwVfe.js";import{C as ts}from"./copy-D7s8Px_A.js";import{C as ss}from"./chart-column-CKQUCa41.js";import{L as as}from"./layout-grid-CLTTCfUk.js";const rs=[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]],ns=We("presentation",rs);const ls=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 8h7",key:"kbo1nt"}],["path",{d:"M8 12h6",key:"ikassy"}],["path",{d:"M11 16h5",key:"oq65wt"}]],is=We("square-chart-gantt",ls),cs={pending:"#64748b",in_progress:"#3b82f6",completed:"#22c55e",overdue:"#ef4444",cancelled:"#6b7280",planning:"#3b82f6",active:"#22c55e",done:"#22c55e"},Me=["#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981","#06b6d4","#f43f5e","#84cc16","#6366f1","#14b8a6"];function pe({title:s,data:o,colorMap:l}){const c=p.useMemo(()=>{const r=Object.entries(o).filter(([,d])=>d>0);return r.length===0?[]:r.map(([d,u],h)=>({label:d,value:u,color:l?.[d]||cs[d]||Me[h%Me.length]}))},[o,l]),x=p.useMemo(()=>Math.max(...c.map(r=>r.value),1),[c]),a=p.useMemo(()=>c.reduce((r,d)=>r+d.value,0),[c]);return c.length===0?e.jsx("div",{className:"text-xs text-[var(--gm-text-tertiary)] text-center py-4",children:"No data"}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",children:s}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[a," total"]})]}),e.jsx("div",{className:"space-y-2",children:c.map(r=>{const d=Math.round(r.value/x*100),u=Math.round(r.value/a*100);return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] capitalize truncate max-w-[60%]",children:r.label.replace(/_/g," ")}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] tabular-nums",children:[r.value," (",u,"%)"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-white/5 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${d}%`,backgroundColor:r.color}})})]},r.label)})})]})}function Re({dailyProgress:s,totalTasks:o,totalPoints:l,usePoints:c=!1}){const x=c?l:o,a=p.useMemo(()=>s?.length?s.map((v,S)=>({...v,remaining:c?v.remaining_points:v.remaining_tasks,idealRemaining:x-x/(s.length-1)*S})):[],[s,x,c]);if(a.length<2)return e.jsx("div",{className:"text-xs text-[var(--gm-text-tertiary)] text-center py-4",children:"Not enough data for burndown"});const r=Math.max(x,...a.map(v=>v.remaining)),d=160,u=100,h=v=>v/(a.length-1)*u,_=v=>d-v/(r||1)*d,N=a.map((v,S)=>`${S===0?"M":"L"}${h(S).toFixed(1)},${_(v.remaining).toFixed(1)}`).join(" "),i=a.map((v,S)=>`${S===0?"M":"L"}${h(S).toFixed(1)},${_(v.idealRemaining).toFixed(1)}`).join(" "),f=N+` L${u},${d} L0,${d} Z`,m=(()=>{const v=new Date().toISOString().slice(0,10),S=a.findIndex(B=>B.date>=v);return S>=0?S:a.length-1})(),j=p.useMemo(()=>{if(a.length<=7)return a.map(S=>S.date.slice(5));const v=Math.ceil(a.length/6);return a.map((S,B)=>B%v===0||B===a.length-1?S.date.slice(5):"")},[a]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-[0.1em]",children:["Burndown (",c?"Points":"Tasks",")"]}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[a[m]?.remaining??0," remaining of ",x]})]}),e.jsx("div",{className:"relative",style:{paddingBottom:"45%"},children:e.jsxs("svg",{viewBox:`-4 -4 ${u+8} ${d+24}`,className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none",children:[[0,.25,.5,.75,1].map(v=>e.jsx("line",{x1:"0",y1:_(r*v),x2:u,y2:_(r*v),stroke:"rgba(255,255,255,0.05)",strokeWidth:"0.3"},v)),e.jsx("path",{d:f,fill:"rgba(59,130,246,0.08)"}),e.jsx("path",{d:i,fill:"none",stroke:"rgba(255,255,255,0.15)",strokeWidth:"0.5",strokeDasharray:"2,2"}),e.jsx("path",{d:N,fill:"none",stroke:"#3b82f6",strokeWidth:"1",strokeLinejoin:"round"}),m<a.length&&e.jsx("line",{x1:h(m),y1:"0",x2:h(m),y2:d,stroke:"rgba(250,204,21,0.3)",strokeWidth:"0.5",strokeDasharray:"1.5,1.5"}),e.jsx("circle",{cx:h(m),cy:_(a[m]?.remaining??0),r:"2",fill:"#3b82f6"}),j.map((v,S)=>v?e.jsx("text",{x:h(S),y:d+10,textAnchor:"middle",className:"fill-[var(--gm-text-tertiary)]",fontSize:"3.5",children:v},S):null)]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 justify-center",children:[e.jsxs("span",{className:"flex items-center gap-1 text-[9px] text-[var(--gm-text-tertiary)]",children:[e.jsx("span",{className:"w-3 h-0.5 bg-blue-500 rounded"})," Actual"]}),e.jsxs("span",{className:"flex items-center gap-1 text-[9px] text-[var(--gm-text-tertiary)]",children:[e.jsx("span",{className:"w-3 h-0.5 bg-white/15 rounded border-dashed"})," Ideal"]})]})]})}function os({history:s}){const o=p.useMemo(()=>s?.length?s.slice(-8):[],[s]),l=p.useMemo(()=>o.length?Math.round(o.reduce((x,a)=>x+a.completed_points,0)/o.length):0,[o]),c=p.useMemo(()=>Math.max(...o.map(x=>Math.max(x.total_points,x.completed_points)),1),[o]);return o.length===0?e.jsx("div",{className:"text-xs text-[var(--gm-text-tertiary)] text-center py-4",children:"No velocity data yet"}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-[0.1em]",children:"Velocity"}),e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:["Avg: ",l," pts/sprint"]})]}),e.jsx("div",{className:"flex items-end gap-1.5",style:{height:100},children:o.map((x,a)=>{const r=x.total_points/c*100;return x.completed_points/c*100,e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-0.5 group relative",children:[e.jsx("div",{className:"w-full flex flex-col items-center justify-end",style:{height:80},children:e.jsxs("div",{className:"w-full rounded-t relative overflow-hidden",style:{height:`${r}%`,minHeight:2},children:[e.jsx("div",{className:"absolute inset-0 bg-white/5 rounded-t"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-blue-500/80 rounded-t transition-all",style:{height:`${x.total_points>0?x.completed_points/x.total_points*100:0}%`}})]})}),e.jsx("span",{className:"text-[8px] text-[var(--gm-text-tertiary)] truncate max-w-full text-center leading-tight",title:x.sprint_name,children:x.sprint_name.length>8?x.sprint_name.slice(0,7)+"…":x.sprint_name}),e.jsxs("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded px-1.5 py-0.5 text-[8px] text-[var(--gm-text-primary)] whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:[x.completed_points,"/",x.total_points," pts"]})]},a)})}),l>0&&e.jsxs("div",{className:"mt-2 h-px w-full relative",children:[e.jsx("div",{className:"absolute inset-x-0 border-t border-dashed border-yellow-500/30"}),e.jsx("span",{className:"absolute right-0 -top-2 text-[8px] text-yellow-400/60",children:"avg"})]})]})}const $e={low:{color:"text-green-400",bg:"bg-green-500/10",border:"border-green-500/30",icon:K,label:"Healthy"},medium:{color:"text-yellow-400",bg:"bg-yellow-500/10",border:"border-yellow-500/30",icon:he,label:"At Risk"},high:{color:"text-orange-400",bg:"bg-orange-500/10",border:"border-orange-500/30",icon:gt,label:"High Risk"},critical:{color:"text-red-400",bg:"bg-red-500/10",border:"border-red-500/30",icon:qt,label:"Critical"}},ds={completion_rate:"Completion",time_progress:"Time Elapsed",velocity_trend:"Velocity",overdue_ratio:"On-time",distribution_balance:"Balance"};function Le({score:s,size:o=64,strokeWidth:l=5,color:c}){const x=(o-l)/2,a=2*Math.PI*x,r=a-s/100*a;return e.jsxs("svg",{width:o,height:o,className:"transform -rotate-90",children:[e.jsx("circle",{cx:o/2,cy:o/2,r:x,fill:"none",stroke:"rgba(255,255,255,0.05)",strokeWidth:l}),e.jsx("circle",{cx:o/2,cy:o/2,r:x,fill:"none",stroke:c,strokeWidth:l,strokeDasharray:a,strokeDashoffset:r,strokeLinecap:"round",className:"transition-all duration-700 ease-out"})]})}function Be({health:s,isLoading:o,compact:l}){if(o)return e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(fe,{className:"w-5 h-5 text-[var(--gm-text-tertiary)] animate-pulse"})});if(!s)return null;const c=$e[s.risk_level]||$e.medium,x=c.icon,a=s.score>=75?"#22c55e":s.score>=50?"#eab308":s.score>=25?"#f97316":"#ef4444";return l?e.jsxs("div",{className:n("flex items-center gap-2 px-2.5 py-1.5 rounded-lg border",c.bg,c.border),children:[e.jsxs("div",{className:"relative w-8 h-8",children:[e.jsx(Le,{score:s.score,size:32,strokeWidth:3,color:a}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[9px] font-bold",style:{color:a},children:s.score})]}),e.jsxs("div",{children:[e.jsx("span",{className:n("text-[10px] font-medium",c.color),children:c.label}),s.alerts.length>0&&e.jsx("p",{className:"text-[9px] text-[var(--gm-text-tertiary)] truncate max-w-[140px]",children:s.alerts[0]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-[0.1em]",children:"Sprint Health"}),e.jsxs("div",{className:n("flex items-center gap-1 text-[10px] font-medium px-2 py-0.5 rounded-full border",c.bg,c.color,c.border),children:[e.jsx(x,{className:"w-3 h-3"})," ",c.label]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative w-16 h-16 shrink-0",children:[e.jsx(Le,{score:s.score,size:64,strokeWidth:5,color:a}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-lg font-bold",style:{color:a},children:s.score})]}),e.jsx("div",{className:"flex-1 space-y-1.5",children:Object.entries(s.factors).map(([r,d])=>{const h=r==="overdue_ratio"?100-d:d,_=h>=70?"#22c55e":h>=40?"#eab308":"#ef4444";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-[9px] mb-0.5",children:[e.jsx("span",{className:"text-[var(--gm-text-tertiary)]",children:ds[r]||r}),e.jsxs("span",{className:"text-[var(--gm-text-secondary)] tabular-nums",children:[h,"%"]})]}),e.jsx("div",{className:"h-1 rounded-full bg-white/5 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${h}%`,backgroundColor:_}})})]},r)})})]}),s.alerts.length>0&&e.jsx("div",{className:"space-y-1",children:s.alerts.map((r,d)=>e.jsxs("div",{className:"flex items-start gap-1.5 text-[10px] text-orange-400",children:[e.jsx(he,{className:"w-3 h-3 shrink-0 mt-0.5"}),e.jsx("span",{children:r})]},d))})]})}const xs=[{id:"pending",label:"To Do",color:"border-slate-500/30",dotColor:"bg-slate-400"},{id:"in_progress",label:"In Progress",color:"border-blue-500/30",dotColor:"bg-blue-400"},{id:"overdue",label:"Overdue",color:"border-red-500/30",dotColor:"bg-red-400"},{id:"completed",label:"Done",color:"border-green-500/30",dotColor:"bg-green-400"}];function ms({actions:s,onStatusChange:o}){const[l,c]=p.useState(null),[x,a]=p.useState(null),r=p.useCallback((i,f)=>{c(f),i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/plain",f),i.currentTarget.style.opacity="0.4"},[]),d=p.useCallback(i=>{i.currentTarget.style.opacity="1",c(null),a(null)},[]),u=p.useCallback((i,f)=>{i.preventDefault(),i.dataTransfer.dropEffect="move",a(f)},[]),h=p.useCallback(()=>{a(null)},[]),_=p.useCallback((i,f)=>{i.preventDefault();const m=i.dataTransfer.getData("text/plain");if(m){const j=s.find(v=>v.id===m);j&&j.status!==f&&o(m,f)}c(null),a(null)},[s,o]),N=i=>i==="high"?"bg-red-400":i==="medium"?"bg-yellow-400":"bg-slate-400";return e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-[0.1em] block mb-3",children:"Kanban Board"}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:xs.map(i=>{const f=s.filter(j=>j.status===i.id),m=x===i.id;return e.jsxs("div",{onDragOver:j=>u(j,i.id),onDragLeave:h,onDrop:j=>_(j,i.id),className:n("rounded-xl border bg-white/[0.02] min-h-[200px] transition-colors",i.color,m&&"border-blue-500/50 bg-blue-500/5"),children:[e.jsxs("div",{className:"px-3 py-2 border-b border-[var(--gm-border-primary)] flex items-center gap-2",children:[e.jsx("span",{className:n("w-2 h-2 rounded-full",i.dotColor)}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:i.label}),e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] ml-auto",children:f.length})]}),e.jsxs("div",{className:"p-2 space-y-1.5",children:[f.map(j=>e.jsx("div",{draggable:!0,onDragStart:v=>r(v,j.id),onDragEnd:d,className:n("bg-[var(--gm-surface-primary)] border border-[var(--gm-border-primary)] rounded-lg p-2.5 cursor-grab active:cursor-grabbing hover:border-blue-500/30 transition-colors group",l===j.id&&"opacity-40"),children:e.jsxs("div",{className:"flex items-start gap-1.5",children:[e.jsx(Kt,{className:"w-3 h-3 text-[var(--gm-text-tertiary)] opacity-0 group-hover:opacity-100 transition-opacity shrink-0 mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-[11px] font-medium text-[var(--gm-text-primary)] line-clamp-2 leading-tight",children:j.task||j.title||"(untitled)"}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5",children:[j.priority&&e.jsx("span",{className:n("w-1.5 h-1.5 rounded-full shrink-0",N(j.priority)),title:j.priority}),j.task_points!=null&&e.jsx("span",{className:"text-[8px] px-1 py-0.5 rounded bg-blue-500/10 text-blue-400 tabular-nums",children:j.task_points}),j.owner&&e.jsx(Xe,{name:j.owner,size:"sm"})]})]})]})},j.id)),f.length===0&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] text-center py-6",children:m?"Drop here":"No tasks"})]})]},i.id)})})]})}const ps=s=>s==="completed"?"#22c55e":s==="in_progress"?"#3b82f6":s==="overdue"?"#ef4444":"#64748b";function us({actions:s,sprintStart:o,sprintEnd:l}){const c=p.useMemo(()=>{const r=new Date(o).getTime(),d=new Date(l).getTime(),u=Math.max(1,d-r);return s.slice(0,20).map(h=>{const _=h.created_at?new Date(h.created_at).getTime():r,N=h.deadline?new Date(h.deadline).getTime():d,i=Math.max(0,Math.min(100,(_-r)/u*100)),f=Math.max(2,Math.min(100-i,(N-_)/u*100)),m=(h.depends_on?.length??0)>0;return{action:h,left:i,width:f,hasDeps:m}})},[s,o,l]),x=p.useMemo(()=>{const r=new Date(o).getTime(),d=new Date(l).getTime(),u=Date.now();return Math.max(0,Math.min(100,(u-r)/(d-r)*100))},[o,l]),a=p.useMemo(()=>{const r=new Date(o),u=(new Date(l).getTime()-r.getTime())/864e5,h=Math.max(1,Math.ceil(u/6)),_=[];for(let N=0;N<=u;N+=h){const i=new Date(r.getTime()+N*864e5);_.push({label:`${i.getMonth()+1}/${i.getDate()}`,pct:N/u*100})}return _},[o,l]);return c.length===0?e.jsx("div",{className:"text-xs text-[var(--gm-text-tertiary)] text-center py-4",children:"No tasks to display"}):e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-[0.1em] block mb-3",children:"Timeline"}),e.jsx("div",{className:"relative h-5 mb-1",children:a.map((r,d)=>e.jsx("span",{className:"absolute text-[8px] text-[var(--gm-text-tertiary)] -translate-x-1/2",style:{left:`${r.pct}%`},children:r.label},d))}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-yellow-500/30 z-10",style:{left:`${x}%`}}),e.jsx("div",{className:"space-y-1",children:c.map(({action:r,left:d,width:u,hasDeps:h})=>e.jsxs("div",{className:"flex items-center gap-2 group h-7",children:[e.jsxs("div",{className:"w-24 shrink-0 truncate text-[10px] text-[var(--gm-text-secondary)] pr-1",title:r.task||r.title,children:[(r.task||r.title||"").slice(0,18),(r.task||"").length>18?"…":""]}),e.jsxs("div",{className:"flex-1 relative h-full",children:[e.jsx("div",{className:"absolute inset-0 bg-white/[0.02] rounded"}),e.jsx("div",{className:n("absolute h-4 top-1.5 rounded-sm transition-all cursor-default",h&&"ring-1 ring-purple-500/40"),style:{left:`${d}%`,width:`${u}%`,backgroundColor:ps(r.status),opacity:r.status==="completed"?.6:.8},title:`${r.task||r.title} (${r.status})${r.owner?` — ${r.owner}`:""}`})]})]},r.id))})]}),e.jsx("div",{className:"flex items-center gap-3 mt-2 justify-center",children:[{label:"Pending",color:"#64748b"},{label:"In Progress",color:"#3b82f6"},{label:"Completed",color:"#22c55e"},{label:"Overdue",color:"#ef4444"}].map(r=>e.jsxs("span",{className:"flex items-center gap-1 text-[8px] text-[var(--gm-text-tertiary)]",children:[e.jsx("span",{className:"w-2 h-2 rounded-sm",style:{backgroundColor:r.color}})," ",r.label]},r.label))})]})}const oe="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)]",hs="bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-1.5 text-xs text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-blue-500/40 w-full";function ve({items:s,onAdd:o,onRemove:l,placeholder:c,color:x}){const[a,r]=p.useState(""),d=()=>{a.trim()&&(o(a.trim()),r(""))};return e.jsxs("div",{className:"space-y-1.5",children:[s.map((u,h)=>e.jsxs("div",{className:"flex items-start gap-2 group",children:[e.jsx("span",{className:n("w-1.5 h-1.5 rounded-full mt-1.5 shrink-0",x)}),e.jsx("span",{className:"text-xs text-[var(--gm-text-secondary)] flex-1",children:u}),e.jsx("button",{onClick:()=>l(h),className:"text-[var(--gm-text-tertiary)] hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(q,{className:"w-3 h-3"})})]},h)),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("input",{value:a,onChange:u=>r(u.target.value),onKeyDown:u=>u.key==="Enter"&&d(),className:hs,placeholder:c}),e.jsx("button",{onClick:d,className:"shrink-0 w-7 h-7 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center",children:e.jsx(se,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})})]})]})}function gs({sprintId:s}){const o=bt(),[l,c]=p.useState([]),[x,a]=p.useState([]),[r,d]=p.useState([]),[u,h]=p.useState(""),_=()=>{o.mutate({sprintId:s,went_well:l,went_wrong:x,action_items:r},{onSuccess:N=>{h(N?.ai_suggestions||""),y.success("Retrospective generated")},onError:N=>y.error(N.message)})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-[0.1em]",children:"Sprint Retrospective"}),e.jsxs("button",{onClick:_,disabled:o.isPending,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-purple-500/10 text-purple-400 hover:bg-purple-500/20 disabled:opacity-50",children:[o.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Y,{className:"w-3.5 h-3.5"}),"AI Insights"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:n(oe,"p-3"),children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(Vt,{className:"w-3.5 h-3.5 text-green-400"}),e.jsx("span",{className:"text-xs font-medium text-green-400",children:"What Went Well"})]}),e.jsx(ve,{items:l,onAdd:N=>c(i=>[...i,N]),onRemove:N=>c(i=>i.filter((f,m)=>m!==N)),placeholder:"Add positive...",color:"bg-green-400"})]}),e.jsxs("div",{className:n(oe,"p-3"),children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(Ht,{className:"w-3.5 h-3.5 text-red-400"}),e.jsx("span",{className:"text-xs font-medium text-red-400",children:"What Needs Improvement"})]}),e.jsx(ve,{items:x,onAdd:N=>a(i=>[...i,N]),onRemove:N=>a(i=>i.filter((f,m)=>m!==N)),placeholder:"Add improvement...",color:"bg-red-400"})]}),e.jsxs("div",{className:n(oe,"p-3"),children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(Qt,{className:"w-3.5 h-3.5 text-blue-400"}),e.jsx("span",{className:"text-xs font-medium text-blue-400",children:"Action Items"})]}),e.jsx(ve,{items:r,onAdd:N=>d(i=>[...i,N]),onRemove:N=>d(i=>i.filter((f,m)=>m!==N)),placeholder:"Add action item...",color:"bg-blue-400"})]})]}),u&&e.jsxs("div",{className:n(oe,"p-4"),children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Insights"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed",children:u})]})]})}const Ie="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)]";function bs({sprintId:s}){const o=jt(),[l,c]=p.useState(null),x=()=>{o.mutate(s,{onSuccess:a=>{c(a),y.success("Standup generated")},onError:a=>y.error(a.message)})};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-[0.1em]",children:"Daily Standup"}),e.jsxs("button",{onClick:x,disabled:o.isPending,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-purple-500/10 text-purple-400 hover:bg-purple-500/20 disabled:opacity-50",children:[o.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Y,{className:"w-3.5 h-3.5"}),"Generate Standup"]})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:l.date}),l.ai_summary&&e.jsxs("div",{className:n(Ie,"p-3"),children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Summary"}),e.jsx("p",{className:"mt-1 text-xs text-[var(--gm-text-secondary)] whitespace-pre-wrap",children:l.ai_summary})]}),e.jsx("div",{className:"space-y-2",children:(l.entries||[]).map((a,r)=>e.jsxs("div",{className:n(Ie,"p-3"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(vt,{className:"w-3.5 h-3.5 text-blue-400"}),e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:a.person})]}),e.jsxs("div",{className:"space-y-1.5 pl-5",children:[a.done.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] text-green-400 uppercase tracking-wider font-medium",children:"Done"}),a.done.map((d,u)=>e.jsxs("div",{className:"flex items-start gap-1.5 mt-0.5",children:[e.jsx(K,{className:"w-3 h-3 text-green-400 shrink-0 mt-0.5"}),e.jsx("span",{className:"text-[11px] text-[var(--gm-text-secondary)]",children:d})]},u))]}),a.doing.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] text-blue-400 uppercase tracking-wider font-medium",children:"Doing"}),a.doing.map((d,u)=>e.jsxs("div",{className:"flex items-start gap-1.5 mt-0.5",children:[e.jsx(Yt,{className:"w-3 h-3 text-blue-400 shrink-0 mt-0.5"}),e.jsx("span",{className:"text-[11px] text-[var(--gm-text-secondary)]",children:d})]},u))]}),a.blockers.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] text-red-400 uppercase tracking-wider font-medium",children:"Blockers"}),a.blockers.map((d,u)=>e.jsxs("div",{className:"flex items-start gap-1.5 mt-0.5",children:[e.jsx(he,{className:"w-3 h-3 text-red-400 shrink-0 mt-0.5"}),e.jsx("span",{className:"text-[11px] text-[var(--gm-text-secondary)]",children:d})]},u))]}),a.done.length===0&&a.doing.length===0&&a.blockers.length===0&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:"No updates"})]})]},r))})]}),!l&&!o.isPending&&e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)] text-center py-4",children:`Click "Generate Standup" to get today's team summary`})]})}const ye="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)]",Ne="bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-2.5 py-1.5 text-xs text-[var(--gm-text-primary)] focus:outline-none focus:ring-2 focus:ring-blue-500/40";function js({sprintId:s,actions:o}){const l=yt(),[c,x]=p.useState({}),[a,r]=p.useState(null),[d,u]=p.useState(""),[h,_]=p.useState(""),N=p.useMemo(()=>{const m=new Set;return o.forEach(j=>{j.owner?.trim()&&m.add(j.owner.trim())}),Object.keys(c).forEach(j=>m.add(j)),Array.from(m).sort()},[o,c]),i=()=>{!d.trim()||!h||(x(m=>({...m,[d.trim()]:Number(h)||0})),u(""),_(""))},f=()=>{if(Object.keys(c).length===0){y.error("Set capacity for at least one person");return}l.mutate({sprintId:s,capacities:c},{onSuccess:m=>{r(m),y.success("Capacity analysis complete")},onError:m=>y.error(m.message)})};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-[0.1em]",children:"Capacity Planning"}),e.jsxs("button",{onClick:f,disabled:l.isPending,className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-purple-500/10 text-purple-400 hover:bg-purple-500/20 disabled:opacity-50",children:[l.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Y,{className:"w-3.5 h-3.5"}),"Analyze Capacity"]})]}),e.jsxs("div",{className:n(ye,"p-3 space-y-2"),children:[e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:"Team Capacity (points per sprint)"}),N.map(m=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-3 h-3 text-[var(--gm-text-tertiary)]"}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] flex-1 truncate",children:m}),e.jsx("input",{type:"number",min:"0",value:c[m]??"",onChange:j=>x(v=>({...v,[m]:Number(j.target.value)||0})),placeholder:"pts",className:n(Ne,"w-16 text-center")}),c[m]!==void 0&&e.jsx("button",{onClick:()=>x(j=>{const v={...j};return delete v[m],v}),className:"text-[var(--gm-text-tertiary)] hover:text-red-400",children:e.jsx(q,{className:"w-3 h-3"})})]},m)),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsx("input",{value:d,onChange:m=>u(m.target.value),placeholder:"Name",className:n(Ne,"flex-1")}),e.jsx("input",{type:"number",min:"0",value:h,onChange:m=>_(m.target.value),placeholder:"pts",className:n(Ne,"w-16 text-center"),onKeyDown:m=>m.key==="Enter"&&i()}),e.jsx("button",{onClick:i,className:"w-7 h-7 rounded-lg bg-white/5 hover:bg-white/10 flex items-center justify-center",children:e.jsx(se,{className:"w-3.5 h-3.5 text-[var(--gm-text-tertiary)]"})})]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:a.capacity.map(m=>{const j=m.utilization,v=m.over_allocated?"#ef4444":j>80?"#f59e0b":"#22c55e",S=Math.min(100,j);return e.jsxs("div",{className:n(ye,"p-3"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:m.person}),e.jsxs("span",{className:"text-[10px] tabular-nums",style:{color:v},children:[m.assigned_points,"/",m.available_points," pts (",j,"%)"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-white/5 overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${S}%`,backgroundColor:v}})}),m.over_allocated&&e.jsxs("p",{className:"text-[9px] text-red-400 mt-1",children:["Over-allocated by ",m.assigned_points-m.available_points," points"]})]},m.person)})}),a.ai_recommendation&&e.jsxs("div",{className:n(ye,"p-4"),children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Recommendation"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed",children:a.ai_recommendation})]})]})]})}function vs({sprintId:s,taskDescription:o,onEstimate:l,className:c}){const x=Nt(),[a,r]=p.useState(null),d=()=>{if(!o.trim()){y.error("Task description needed");return}x.mutate({sprintId:s,task:o},{onSuccess:h=>{r(h),l?.(h.points),y.success(`Estimated: ${h.points} points (${h.confidence} confidence)`)},onError:h=>y.error(h.message)})},u=a?.confidence==="high"?"text-green-400":a?.confidence==="medium"?"text-yellow-400":"text-orange-400";return e.jsxs("div",{className:n("inline-flex items-center gap-2",c),children:[e.jsxs("button",{onClick:d,disabled:x.isPending,className:"inline-flex items-center gap-1 px-2 py-1 text-[10px] font-medium rounded-md bg-purple-500/10 text-purple-400 hover:bg-purple-500/20 disabled:opacity-50 transition-colors",title:"AI estimate story points",children:[x.isPending?e.jsx(C,{className:"w-3 h-3 animate-spin"}):e.jsx(Y,{className:"w-3 h-3"}),"Estimate"]}),a&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs font-bold text-blue-400 tabular-nums",children:[a.points," pts"]}),e.jsxs("span",{className:n("text-[9px]",u),children:["(",a.confidence,")"]}),a.reasoning&&e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] max-w-[200px] truncate",title:a.reasoning,children:a.reasoning})]})]})}const U="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)]",de="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg disabled:opacity-50 transition-colors",Oe=[{key:"sprint_report_style_corporate_classic",label:"Corporate Classic"},{key:"sprint_report_style_modern_minimal",label:"Modern Minimal"},{key:"sprint_report_style_startup_tech",label:"Startup Tech"},{key:"sprint_report_style_consultancy",label:"Consultancy"}];function ze(s,o){const l=new Blob([s],{type:"text/html"}),c=URL.createObjectURL(l),x=document.createElement("a");x.href=c,x.download=o,x.click(),URL.revokeObjectURL(c)}function ys({open:s,onClose:o,sprint:l}){const{data:c,isLoading:x}=qe(s?l.id:null),a=Ke(),r=Ve(),d=ft(),u=wt(),[h,_]=p.useState(""),[N,i]=p.useState(""),[f,m]=p.useState(!0),[j,v]=p.useState(!0),[S,B]=p.useState(Oe[0].key),E=c,O=E?.actions??[],G=E?.breakdown??{by_status:{},by_assignee:{}},W=E?.total_tasks??O.length,R=E?.completed_tasks??O.filter(g=>g.status==="completed").length,X=E?.total_task_points??0,Z=E?.completed_task_points??0,ae=W>0?Math.round(R/W*100):0,I=()=>{a.mutate(l.id,{onSuccess:g=>{_(g?.ai_analysis||g?.analysis||""),y.success("Analysis complete")},onError:g=>y.error(g.message)})},V=()=>{r.mutate(l.id,{onSuccess:g=>{i(g?.business_report||g?.summary||""),y.success("Business report ready")},onError:g=>y.error(g.message)})},M=()=>{d.mutate({sprintId:l.id,style:S,include_analysis:f,include_business:j},{onSuccess:g=>{g?.html&&(ze(g.html,`sprint-${l.name||l.id}-report.html`),y.success("Document downloaded"))},onError:g=>y.error(g.message)})},J=()=>{u.mutate({sprintId:l.id,include_analysis:f,include_business:j},{onSuccess:g=>{g?.html&&(ze(g.html,`sprint-${l.name||l.id}-presentation.html`),y.success("Presentation downloaded"))},onError:g=>y.error(g.message)})};return e.jsx(me,{children:s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50",onClick:o}),e.jsx(te.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[var(--gm-bg-elevated)] border border-[var(--gm-border-primary)] rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",style:{backgroundColor:"var(--gm-bg-elevated)",color:"var(--gm-text-primary)"},onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-[var(--gm-border-primary)] shrink-0",style:{background:"linear-gradient(to right, rgba(37,99,235,0.18), rgba(37,99,235,0.05))"},children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Sprint Report"}),e.jsx("p",{className:"text-xs text-slate-400",children:l.name})]}),e.jsx("button",{onClick:o,className:"w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center",children:e.jsx(q,{className:"w-4 h-4 text-slate-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-5",children:x?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-blue-400"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{label:"Total Tasks",value:W,sub:""},{label:"Completed",value:R,sub:`${ae}%`},{label:"Total Points",value:X,sub:""},{label:"Done Points",value:Z,sub:X>0?`${Math.round(Z/X*100)}%`:""}].map(g=>e.jsxs("div",{className:n(U,"p-3 text-center"),children:[e.jsx("p",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:g.value}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:g.label}),g.sub&&e.jsx("p",{className:"text-xs text-blue-400 mt-0.5",children:g.sub})]},g.label))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:n(U,"p-4"),children:e.jsx(pe,{title:"By Status",data:G.by_status})}),e.jsx("div",{className:n(U,"p-4"),children:e.jsx(pe,{title:"By Assignee",data:G.by_assignee})})]}),O.length>0&&e.jsxs("div",{className:n(U,"p-4"),children:[e.jsxs("span",{className:"text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",children:["Tasks (",O.length,")"]}),e.jsx("div",{className:"mt-2 space-y-1 max-h-48 overflow-y-auto",children:O.map(g=>{const ee=g.status==="completed";return e.jsxs("div",{className:"flex items-center gap-2 py-1 px-2 rounded hover:bg-white/5",children:[ee?e.jsx(K,{className:"w-3.5 h-3.5 text-green-400 shrink-0"}):e.jsx(ge,{className:"w-3.5 h-3.5 text-slate-500 shrink-0"}),e.jsx("span",{className:n("text-xs flex-1 truncate",ee?"line-through text-slate-500":"text-[var(--gm-text-primary)]"),children:g.task||g.title||"(untitled)"}),g.owner&&e.jsx("span",{className:"text-[10px] text-[var(--gm-text-tertiary)] truncate max-w-[100px]",children:g.owner}),e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] capitalize shrink-0",children:g.status})]},g.id)})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:I,disabled:a.isPending,className:n(de,"bg-purple-500/10 text-purple-400 hover:bg-purple-500/20"),children:[a.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(He,{className:"w-3.5 h-3.5"}),"AI Analysis"]}),e.jsxs("button",{onClick:V,disabled:r.isPending,className:n(de,"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20"),children:[r.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(kt,{className:"w-3.5 h-3.5"}),"Business Report"]})]}),h&&e.jsxs("div",{className:n(U,"p-4"),children:[e.jsx("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Analysis"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed",children:h})]}),N&&e.jsxs("div",{className:n(U,"p-4"),children:[e.jsx("span",{className:"text-[10px] font-bold text-emerald-400 uppercase tracking-[0.1em]",children:"Business Report"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed",children:N})]}),e.jsxs("div",{className:n(U,"p-4 space-y-3"),children:[e.jsx("span",{className:"text-[10px] font-bold text-[var(--gm-accent-primary)] uppercase tracking-[0.1em]",children:"Export"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--gm-text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:g=>m(g.target.checked),className:"rounded border-[var(--gm-border-primary)]"}),"Include AI Analysis"]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-[var(--gm-text-secondary)] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:g=>v(g.target.checked),className:"rounded border-[var(--gm-border-primary)]"}),"Include Business Report"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider block mb-1",children:"Document Style"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:Oe.map(g=>e.jsx("button",{onClick:()=>B(g.key),className:n("px-2.5 py-1 rounded-md text-[10px] font-medium border transition-colors",S===g.key?"bg-blue-600/20 text-blue-400 border-blue-500/30":"bg-white/5 text-[var(--gm-text-tertiary)] border-[var(--gm-border-primary)] hover:text-[var(--gm-text-primary)]"),children:g.label},g.key))})]}),e.jsxs("div",{className:"flex gap-2 pt-1",children:[e.jsxs("button",{onClick:M,disabled:d.isPending,className:n(de,"bg-blue-600 text-white hover:bg-blue-700"),children:[d.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(_t,{className:"w-3.5 h-3.5"}),"Download A4 Document"]}),e.jsxs("button",{onClick:J,disabled:u.isPending,className:n(de,"bg-orange-500/10 text-orange-400 hover:bg-orange-500/20"),children:[u.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ns,{className:"w-3.5 h-3.5"}),"Download Presentation"]})]})]})]})})]})})]})})}const T="rounded-xl border border-[var(--gm-border-primary)] bg-[var(--gm-surface-primary)] shadow-[var(--shadow-sm)]",Q="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors disabled:opacity-50",$="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-white/5 text-[var(--gm-text-primary)] hover:bg-white/10 border border-[var(--gm-border-primary)] transition-colors disabled:opacity-50",Fe="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors disabled:opacity-50",A="bg-[var(--gm-bg-tertiary)] border border-[var(--gm-border-primary)] rounded-lg px-3 py-2 text-sm text-[var(--gm-text-primary)] placeholder:text-[var(--gm-text-tertiary)] focus:outline-none focus:ring-2 focus:ring-blue-500/40",xe="text-[10px] font-bold text-blue-400 uppercase tracking-[0.1em]",ue={planning:{color:"text-slate-400",bg:"bg-slate-500/10",border:"border-slate-500/30",icon:ge},active:{color:"text-green-400",bg:"bg-green-500/10",border:"border-green-500/30",icon:Qe},completed:{color:"text-blue-400",bg:"bg-blue-500/10",border:"border-blue-500/30",icon:K}},Ge=s=>s==="completed"?"bg-green-400":s==="in_progress"?"bg-blue-400":s==="overdue"?"bg-red-400":"bg-slate-500";function Ze(s){return{id:s.id,name:s.name||"",start_date:s.start_date||s.startDate||"",end_date:s.end_date||s.endDate||"",context:s.context||"",goals:s.goals||[],status:s.status||"planning",analysis_start_date:s.analysis_start_date||"",analysis_end_date:s.analysis_end_date||"",project_id:s.project_id||"",created_at:s.created_at||"",updated_at:s.updated_at||""}}function Ns({onCreated:s}){const o=Wt(),[l,c]=p.useState({name:"",start_date:"",end_date:"",context:"",goals:"",analysis_start_date:"",analysis_end_date:""}),x=a=>{if(a.preventDefault(),!l.name||!l.start_date||!l.end_date){y.error("Name, start date and end date are required");return}o.mutate({name:l.name,start_date:l.start_date,end_date:l.end_date,context:l.context||void 0,goals:l.goals?l.goals.split(`
`).filter(r=>r.trim()):void 0,analysis_start_date:l.analysis_start_date||void 0,analysis_end_date:l.analysis_end_date||void 0},{onSuccess:()=>{y.success("Sprint created"),c({name:"",start_date:"",end_date:"",context:"",goals:"",analysis_start_date:"",analysis_end_date:""}),s()},onError:r=>y.error(r.message)})};return e.jsxs("form",{onSubmit:x,className:n(T,"p-5 space-y-4"),children:[e.jsx("h3",{className:xe,children:"New Sprint"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--gm-text-tertiary)] mb-1 uppercase tracking-wider",children:"Name *"}),e.jsx("input",{value:l.name,onChange:a=>c(r=>({...r,name:a.target.value})),className:n(A,"w-full"),placeholder:"Sprint 1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--gm-text-tertiary)] mb-1 uppercase tracking-wider",children:"Start Date *"}),e.jsx("input",{type:"date",value:l.start_date,onChange:a=>c(r=>({...r,start_date:a.target.value})),className:n(A,"w-full"),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--gm-text-tertiary)] mb-1 uppercase tracking-wider",children:"End Date *"}),e.jsx("input",{type:"date",value:l.end_date,onChange:a=>c(r=>({...r,end_date:a.target.value})),className:n(A,"w-full"),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--gm-text-tertiary)] mb-1 uppercase tracking-wider",children:"Context"}),e.jsx("input",{value:l.context,onChange:a=>c(r=>({...r,context:a.target.value})),className:n(A,"w-full"),placeholder:"Focus areas, constraints..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--gm-text-tertiary)] mb-1 uppercase tracking-wider",children:"Goals (one per line)"}),e.jsx("textarea",{value:l.goals,onChange:a=>c(r=>({...r,goals:a.target.value})),rows:3,className:n(A,"w-full resize-none"),placeholder:`Complete feature X
Fix bug Y`})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--gm-text-tertiary)] mb-1 uppercase tracking-wider",children:"Analysis Start Date"}),e.jsx("input",{type:"date",value:l.analysis_start_date,onChange:a=>c(r=>({...r,analysis_start_date:a.target.value})),className:n(A,"w-full")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-medium text-[var(--gm-text-tertiary)] mb-1 uppercase tracking-wider",children:"Analysis End Date"}),e.jsx("input",{type:"date",value:l.analysis_end_date,onChange:a=>c(r=>({...r,analysis_end_date:a.target.value})),className:n(A,"w-full")})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:o.isPending,className:Q,children:[o.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(se,{className:"w-3.5 h-3.5"}),"Create Sprint"]})})]})}const fs=[{id:"overview",label:"Overview",icon:ss},{id:"kanban",label:"Kanban",icon:as},{id:"timeline",label:"Timeline",icon:is},{id:"burndown",label:"Burndown",icon:fe},{id:"standup",label:"Standup",icon:Gt},{id:"capacity",label:"Capacity",icon:Ue},{id:"retro",label:"Retro",icon:Ye}];function ws({sprintId:s,onBack:o}){const l=At(),{data:c,isLoading:x}=Pt(s),{data:a,isLoading:r,error:d}=qe(s),{data:u,error:h}=Dt(s),{data:_,isLoading:N,error:i}=Et(s),f=Mt(),m=Rt(),j=Ke(),v=Ve(),S=$t(),B=Lt(),E=Bt(),O=It(),G=Ot(),W=zt(),[R,X]=p.useState("overview"),[Z,ae]=p.useState(!1),[I,V]=p.useState({task:"",owner:"",priority:"medium"}),[M,J]=p.useState(null),[g,ee]=p.useState(new Set),[re,we]=p.useState(new Set),[ke,Je]=p.useState(""),[_e,et]=p.useState(""),[ne,be]=p.useState(!1),[P,F]=p.useState({name:"",context:"",goals:"",start_date:"",end_date:"",analysis_start_date:"",analysis_end_date:""}),[tt,Se]=p.useState(!1),[st,Ce]=p.useState(!1),k=p.useMemo(()=>{const t=c?.sprint??c;return t?Ze(t):{id:s,name:"",start_date:"",end_date:"",status:"planning"}},[c,s]),H=a,z=H?.actions??[],Te=H?.breakdown??{by_status:{},by_assignee:{}},le=H?.total_tasks??z.length,Ae=H?.completed_tasks??z.filter(t=>t.status==="completed").length,at=p.useMemo(()=>{const t={};return z.forEach(b=>{const w=b.status||"pending";t[w]||(t[w]=[]),t[w].push(b)}),t},[z]),rt=p.useCallback(()=>{F({name:k.name,context:k.context||"",goals:(k.goals||[]).join(`
`),start_date:k.start_date?.slice(0,10)||"",end_date:k.end_date?.slice(0,10)||"",analysis_start_date:k.analysis_start_date?.slice(0,10)||"",analysis_end_date:k.analysis_end_date?.slice(0,10)||""}),be(!0)},[k]),nt=()=>{S.mutate({id:k.id,name:P.name,context:P.context||void 0,goals:P.goals?P.goals.split(`
`).filter(t=>t.trim()):[],start_date:P.start_date||void 0,end_date:P.end_date||void 0,analysis_start_date:P.analysis_start_date||void 0,analysis_end_date:P.analysis_end_date||void 0},{onSuccess:()=>{y.success("Sprint updated"),be(!1)},onError:t=>y.error(t.message)})},lt=()=>{B.mutate(k.id,{onSuccess:()=>{y.success("Sprint deleted"),o()},onError:t=>y.error(t.message)})},je=t=>{E.mutate({sprintId:k.id,status:t},{onSuccess:()=>y.success(`Sprint marked as ${t}`),onError:b=>y.error(b.message)})},it=()=>{f.mutate(s,{onSuccess:t=>{const b={proposed_new_tasks:t?.proposed_new_tasks??[],existing_action_ids:t?.existing_action_ids??[],existing_details:t?.existing_details??[]};J(b);const w=new Set;b.proposed_new_tasks.forEach((ce,ht)=>w.add(ht)),ee(w);const L=new Set(b.existing_action_ids);we(L),y.success(`Generated ${b.proposed_new_tasks.length} new tasks, found ${b.existing_action_ids.length} existing`)},onError:t=>y.error(t.message)})},ct=()=>{if(!M)return;const t=M.proposed_new_tasks.filter((w,L)=>g.has(L)),b=M.existing_action_ids.filter(w=>re.has(w));m.mutate({sprintId:s,new_tasks:t,existing_action_ids:b},{onSuccess:w=>{y.success(`Created ${w?.created??0} tasks, linked ${w?.linked??0} existing`),J(null)},onError:w=>y.error(w.message)})},ot=()=>{j.mutate(s,{onSuccess:t=>{Je(t?.ai_analysis||t?.analysis||""),y.success("Analysis complete")},onError:t=>y.error(t.message)})},dt=()=>{v.mutate(s,{onSuccess:t=>{et(t?.business_report||t?.summary||""),y.success("Business report ready")},onError:t=>y.error(t.message)})},xt=()=>{O.mutate({sprintId:k.id},{onSuccess:t=>{y.success(`Sprint cloned: ${t?.sprint?.name||"Copy"}${t?.tasks_cloned?` with ${t.tasks_cloned} tasks`:""}`)},onError:t=>y.error(t.message)})},mt=p.useCallback((t,b)=>{G.mutate({id:t,status:b},{onSuccess:()=>{l.invalidateQueries({queryKey:["sprint",s]}),l.invalidateQueries({queryKey:["sprintReport",s]}),y.success("Task status updated")},onError:()=>y.error("Failed to update status")})},[G,l,s]),Pe=()=>{I.task.trim()&&W.mutate({task:I.task.trim(),owner:I.owner.trim()||void 0,priority:I.priority,status:"pending",sprint_id:s},{onSuccess:()=>{l.invalidateQueries({queryKey:["sprint",s]}),l.invalidateQueries({queryKey:["sprintReport",s]}),y.success("Task added to sprint"),V({task:"",owner:"",priority:"medium"}),ae(!1)},onError:()=>y.error("Failed to add task")})},pt=p.useCallback(t=>{G.mutate({id:t,sprint_id:null},{onSuccess:()=>{l.invalidateQueries({queryKey:["sprint",s]}),l.invalidateQueries({queryKey:["sprintReport",s]}),y.success("Task removed from sprint")},onError:()=>y.error("Failed to remove task")})},[G,l,s]),D=u,De=_;if(x)return e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-blue-400"})});const ie=ue[k.status]||ue.planning,ut=ie.icon;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:o,className:"mt-1 w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center hover:bg-white/10 shrink-0",children:e.jsx(Xt,{className:"w-4 h-4 text-slate-400"})}),e.jsx("div",{className:"flex-1 min-w-0",children:ne?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{value:P.name,onChange:t=>F(b=>({...b,name:t.target.value})),className:n(A,"w-full text-lg font-bold")}),e.jsx("input",{value:P.context,onChange:t=>F(b=>({...b,context:t.target.value})),className:n(A,"w-full"),placeholder:"Context..."}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] uppercase",children:"Start Date"}),e.jsx("input",{type:"date",value:P.start_date,onChange:t=>F(b=>({...b,start_date:t.target.value})),className:n(A,"w-full")})]}),e.jsxs("label",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] uppercase",children:"End Date"}),e.jsx("input",{type:"date",value:P.end_date,onChange:t=>F(b=>({...b,end_date:t.target.value})),className:n(A,"w-full")})]}),e.jsxs("label",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] uppercase",children:"Analysis Start"}),e.jsx("input",{type:"date",value:P.analysis_start_date,onChange:t=>F(b=>({...b,analysis_start_date:t.target.value})),className:n(A,"w-full")})]}),e.jsxs("label",{className:"space-y-0.5",children:[e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] uppercase",children:"Analysis End"}),e.jsx("input",{type:"date",value:P.analysis_end_date,onChange:t=>F(b=>({...b,analysis_end_date:t.target.value})),className:n(A,"w-full")})]})]}),e.jsx("textarea",{value:P.goals,onChange:t=>F(b=>({...b,goals:t.target.value})),className:n(A,"w-full resize-none"),rows:2,placeholder:"Goals (one per line)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:nt,disabled:S.isPending,className:Q,children:[S.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(K,{className:"w-3.5 h-3.5"})," Save"]}),e.jsxs("button",{onClick:()=>be(!1),className:$,children:[e.jsx(q,{className:"w-3.5 h-3.5"})," Cancel"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg font-bold text-[var(--gm-text-primary)] truncate",children:k.name||"Sprint"}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)]",children:[k.start_date?new Date(k.start_date).toLocaleDateString():"?"," — ",k.end_date?new Date(k.end_date).toLocaleDateString():"?"]}),k.context&&e.jsxs("span",{className:"text-xs text-[var(--gm-text-tertiary)]",children:["· ",k.context]})]})]})}),!ne&&e.jsx("div",{className:"flex items-center gap-2 shrink-0",children:e.jsxs("span",{className:n("text-[10px] font-medium px-2.5 py-1 rounded-full border capitalize",ie.bg,ie.color,ie.border),children:[e.jsx(ut,{className:"w-3 h-3 inline mr-1"}),k.status]})})]}),!ne&&k.goals&&k.goals.length>0&&e.jsxs("div",{className:n(T,"p-4"),children:[e.jsx("h3",{className:xe,children:"Goals"}),e.jsx("ul",{className:"mt-2 space-y-1.5",children:k.goals.map((t,b)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-[var(--gm-text-secondary)]",children:[e.jsx(Ye,{className:"w-3.5 h-3.5 text-blue-400 mt-0.5 shrink-0"}),t]},b))})]}),!ne&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:rt,className:$,children:[e.jsx(Zt,{className:"w-3.5 h-3.5"})," Edit"]}),k.status==="planning"&&e.jsxs("button",{onClick:()=>je("active"),disabled:E.isPending,className:n($,"text-green-400 border-green-500/30"),children:[E.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Jt,{className:"w-3.5 h-3.5"})," Start Sprint"]}),k.status==="active"&&e.jsxs("button",{onClick:()=>je("completed"),disabled:E.isPending,className:n($,"text-blue-400 border-blue-500/30"),children:[E.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(es,{className:"w-3.5 h-3.5"})," Complete Sprint"]}),k.status==="completed"&&e.jsxs("button",{onClick:()=>je("planning"),disabled:E.isPending,className:$,children:[E.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ge,{className:"w-3.5 h-3.5"})," Reopen"]}),e.jsx("div",{className:"w-px h-6 bg-[var(--gm-border-primary)] self-center"}),e.jsxs("button",{onClick:it,disabled:f.isPending,className:Q,children:[f.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(He,{className:"w-3.5 h-3.5"})," Generate Tasks (AI)"]}),e.jsxs("button",{onClick:ot,disabled:j.isPending,className:n($,"text-purple-400 border-purple-500/30"),children:[j.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Y,{className:"w-3.5 h-3.5"})," AI Analysis"]}),e.jsxs("button",{onClick:dt,disabled:v.isPending,className:n($,"text-emerald-400 border-emerald-500/30"),children:[v.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Y,{className:"w-3.5 h-3.5"})," Business Report"]}),e.jsxs("button",{onClick:()=>Se(!0),className:$,children:[e.jsx(Ft,{className:"w-3.5 h-3.5"})," Full Report & Export"]}),e.jsxs("button",{onClick:xt,disabled:O.isPending,className:$,children:[O.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(ts,{className:"w-3.5 h-3.5"})," Clone"]}),e.jsx("div",{className:"flex-1"}),st?e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:lt,disabled:B.isPending,className:Fe,children:[B.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ee,{className:"w-3.5 h-3.5"})," Confirm Delete"]}),e.jsx("button",{onClick:()=>Ce(!1),className:$,children:e.jsx(q,{className:"w-3.5 h-3.5"})})]}):e.jsxs("button",{onClick:()=>Ce(!0),className:Fe,children:[e.jsx(Ee,{className:"w-3.5 h-3.5"})," Delete"]})]}),M&&e.jsxs("div",{className:n(T,"p-4 space-y-3"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:xe,children:"AI Generated Tasks"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:ct,disabled:m.isPending||g.size===0&&re.size===0,className:Q,children:[m.isPending?e.jsx(C,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(K,{className:"w-3.5 h-3.5"}),"Apply Selected (",g.size+re.size,")"]}),e.jsxs("button",{onClick:()=>J(null),className:$,children:[e.jsx(q,{className:"w-3.5 h-3.5"})," Dismiss"]})]})]}),M.proposed_new_tasks.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-1.5",children:["New Tasks (",M.proposed_new_tasks.length,")"]}),e.jsx("div",{className:"space-y-1.5",children:M.proposed_new_tasks.map((t,b)=>e.jsxs("label",{className:"flex items-start gap-2 p-2 rounded-lg bg-white/5 hover:bg-white/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g.has(b),onChange:w=>{ee(L=>{const ce=new Set(L);return w.target.checked?ce.add(b):ce.delete(b),ce})},className:"mt-0.5 rounded border-[var(--gm-border-primary)]"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--gm-text-primary)]",children:t.task}),t.description&&e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] mt-0.5 line-clamp-2",children:t.description})]}),t.size_estimate&&e.jsx("span",{className:"text-[9px] px-2 py-0.5 rounded-full bg-blue-500/10 text-blue-400 shrink-0",children:t.size_estimate}),t.priority&&e.jsx("span",{className:n("text-[9px] px-2 py-0.5 rounded-full shrink-0",t.priority==="high"||t.priority==="urgent"?"bg-red-500/10 text-red-400":t.priority==="medium"?"bg-yellow-500/10 text-yellow-400":"bg-white/5 text-slate-400"),children:t.priority})]},b))})]}),M.existing_details&&M.existing_details.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-1.5",children:["Existing Actions to Link (",M.existing_details.length,")"]}),e.jsx("div",{className:"space-y-1.5",children:M.existing_details.map(t=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-lg bg-white/5 hover:bg-white/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:re.has(t.id),onChange:b=>{we(w=>{const L=new Set(w);return b.target.checked?L.add(t.id):L.delete(t.id),L})},className:"rounded border-[var(--gm-border-primary)]"}),e.jsx("span",{className:"text-xs text-[var(--gm-text-primary)] flex-1 truncate",children:t.task}),e.jsx("span",{className:"text-[9px] text-[var(--gm-text-tertiary)] capitalize",children:t.status})]},t.id))})]})]}),ke&&e.jsxs("div",{className:n(T,"p-4"),children:[e.jsx("h3",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-[0.1em]",children:"AI Analysis"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed",children:ke})]}),_e&&e.jsxs("div",{className:n(T,"p-4"),children:[e.jsx("h3",{className:"text-[10px] font-bold text-emerald-400 uppercase tracking-[0.1em]",children:"Business Report"}),e.jsx("div",{className:"mt-2 text-xs text-[var(--gm-text-secondary)] whitespace-pre-wrap leading-relaxed",children:_e})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(Be,{health:De,isLoading:N,compact:!0}),D?.daily_progress&&e.jsxs("span",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[D.completed_tasks,"/",D.total_tasks," tasks · ",D.completed_points,"/",D.total_points," pts"]})]}),e.jsx("div",{className:"flex gap-1 bg-white/[0.02] rounded-xl p-1 border border-[var(--gm-border-primary)] overflow-x-auto",children:fs.map(t=>{const b=t.icon;return e.jsxs("button",{onClick:()=>X(t.id),className:n("flex items-center gap-1.5 px-3 py-2 rounded-lg text-xs font-medium transition-colors whitespace-nowrap",R===t.id?"bg-blue-600/15 text-blue-400":"text-[var(--gm-text-tertiary)] hover:text-[var(--gm-text-primary)] hover:bg-white/5"),children:[e.jsx(b,{className:"w-3.5 h-3.5"}),t.label]},t.id)})}),e.jsx(me,{mode:"wait",children:e.jsxs(te.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.15},children:[R==="overview"&&e.jsxs("div",{className:"space-y-5",children:[r&&e.jsxs("div",{className:"flex items-center justify-center py-6 gap-2",children:[e.jsx(C,{className:"w-4 h-4 animate-spin text-blue-400"}),e.jsx("span",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Loading report data..."})]}),(d||h||i)&&e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:[e.jsx(he,{className:"w-4 h-4 text-red-400 shrink-0"}),e.jsx("span",{className:"text-xs text-red-400",children:"Some report data failed to load. Partial data may be shown."})]}),le>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{label:"Total Tasks",value:le},{label:"Completed",value:Ae,sub:le>0?`${Math.round(Ae/le*100)}%`:""},{label:"Total Points",value:H?.total_task_points??0},{label:"Done Points",value:H?.completed_task_points??0}].map(t=>e.jsxs("div",{className:n(T,"p-3 text-center"),children:[e.jsx("p",{className:"text-2xl font-bold text-[var(--gm-text-primary)]",children:t.value}),e.jsx("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider",children:t.label}),t.sub&&e.jsx("p",{className:"text-xs text-blue-400 mt-0.5",children:t.sub})]},t.label))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:n(T,"p-4"),children:e.jsx(pe,{title:"By Status",data:Te.by_status})}),e.jsx("div",{className:n(T,"p-4"),children:e.jsx(pe,{title:"By Assignee",data:Te.by_assignee})})]})]}),e.jsx("div",{className:n(T,"p-4"),children:e.jsx(Be,{health:De,isLoading:N})}),e.jsxs("div",{className:n(T,"p-4"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:xe,children:["Sprint Tasks (",z.length,")"]}),e.jsxs("button",{onClick:()=>ae(!Z),className:$,children:[e.jsx(se,{className:"w-3 h-3"})," Add Task"]})]}),e.jsx(me,{children:Z&&e.jsx(te.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsxs("div",{className:"mt-3 space-y-2 p-3 rounded-lg bg-white/[0.02] border border-[var(--gm-border-primary)]",children:[e.jsx("input",{value:I.task,onChange:t=>V(b=>({...b,task:t.target.value})),className:n(A,"w-full"),placeholder:"Task description...",onKeyDown:t=>t.key==="Enter"&&Pe()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:I.owner,onChange:t=>V(b=>({...b,owner:t.target.value})),className:n(A,"flex-1"),placeholder:"Owner (optional)"}),e.jsxs("select",{value:I.priority,onChange:t=>V(b=>({...b,priority:t.target.value})),className:n(A,"w-28"),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]}),e.jsx("button",{onClick:Pe,disabled:!I.task.trim()||W.isPending,className:Q,children:W.isPending?e.jsx(C,{className:"w-3 h-3 animate-spin"}):"Add"})]})]})})})]}),z.length>0&&e.jsx("div",{className:n(T,"p-4"),children:e.jsx("div",{className:"mt-3 space-y-4",children:["in_progress","pending","overdue","completed"].map(t=>{const b=at[t];return!b||b.length===0?null:e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)] uppercase tracking-wider mb-1.5 flex items-center gap-1.5",children:[e.jsx("span",{className:n("w-2 h-2 rounded-full",Ge(t))}),t.replace("_"," ")," (",b.length,")"]}),e.jsx("div",{className:"space-y-1",children:b.map(w=>e.jsxs("div",{className:"group flex items-center gap-2 py-1.5 px-2 rounded-lg hover:bg-white/5",children:[e.jsx("span",{className:n("w-1.5 h-1.5 rounded-full shrink-0",Ge(w.status))}),e.jsx("span",{className:n("text-xs flex-1 truncate",w.status==="completed"?"line-through text-slate-500":"text-[var(--gm-text-primary)]"),children:w.task||w.title||"(untitled)"}),w.owner&&e.jsx(Xe,{name:w.owner,size:"sm"}),w.task_points!=null&&e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-blue-500/10 text-blue-400 tabular-nums",children:[w.task_points,"pt"]}),e.jsx(vs,{sprintId:s,taskDescription:w.task||w.title||""}),e.jsx("button",{onClick:L=>{L.stopPropagation(),pt(w.id)},className:"opacity-0 group-hover:opacity-100 p-0.5 rounded hover:bg-red-500/20 text-red-400 transition-all",title:"Remove from sprint",children:e.jsx(q,{className:"w-3 h-3"})})]},w.id))})]},t)})})})]}),R==="kanban"&&e.jsx("div",{className:n(T,"p-4"),children:e.jsx(ms,{actions:z,onStatusChange:mt})}),R==="timeline"&&e.jsx("div",{className:n(T,"p-4"),children:e.jsx(us,{actions:z,sprintStart:k.start_date,sprintEnd:k.end_date})}),R==="burndown"&&e.jsxs("div",{className:"space-y-4",children:[D?.daily_progress?e.jsx("div",{className:n(T,"p-4"),children:e.jsx(Re,{dailyProgress:D.daily_progress,totalTasks:D.total_tasks,totalPoints:D.total_points})}):e.jsxs("div",{className:n(T,"p-8 text-center"),children:[e.jsx(fe,{className:"w-8 h-8 mx-auto text-[var(--gm-text-tertiary)] mb-2"}),e.jsx("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:"Burndown data will appear as tasks are completed"})]}),D?.daily_progress&&e.jsx("div",{className:n(T,"p-4"),children:e.jsx(Re,{dailyProgress:D.daily_progress,totalTasks:D.total_tasks,totalPoints:D.total_points,usePoints:!0})}),D?.velocity_history?.length>0&&e.jsx("div",{className:n(T,"p-4"),children:e.jsx(os,{history:D.velocity_history})})]}),R==="standup"&&e.jsx(bs,{sprintId:s}),R==="capacity"&&e.jsx(js,{sprintId:s,actions:z}),R==="retro"&&e.jsx(gs,{sprintId:s})]},R)}),e.jsx(ys,{open:tt,onClose:()=>Se(!1),sprint:k})]})}function Ws(){const s=St(),{data:o,isLoading:l}=s,[c,x]=p.useState(null),[a,r]=p.useState(!1),d=p.useMemo(()=>(o?.sprints??(Array.isArray(o)?o:[])).map(f=>Ze(f)),[o]),u=d.filter(i=>i.status==="active"),h=d.filter(i=>i.status==="planning"),_=d.filter(i=>i.status==="completed");if(c)return e.jsx("div",{className:"p-6",children:e.jsx(ws,{sprintId:c,onBack:()=>x(null)})});const N=i=>{const f=ue[i.status]||ue.planning,m=f.icon;return e.jsxs(te.div,{layout:!0,className:n(T,"p-4 hover:border-blue-500/30 transition-colors cursor-pointer"),onClick:()=>x(i.id),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{className:n("w-4 h-4 shrink-0",f.color)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-[var(--gm-text-primary)] truncate",children:i.name||"Unnamed Sprint"}),e.jsxs("p",{className:"text-[10px] text-[var(--gm-text-tertiary)]",children:[i.start_date?new Date(i.start_date).toLocaleDateString():"?"," — ",i.end_date?new Date(i.end_date).toLocaleDateString():"?",i.context&&e.jsxs("span",{className:"ml-2",children:["· ",i.context.substring(0,50),i.context.length>50?"...":""]})]})]}),e.jsx("span",{className:n("text-[10px] font-medium px-2.5 py-1 rounded-full border capitalize",f.bg,f.color,f.border),children:i.status}),e.jsx(Tt,{className:"w-4 h-4 text-[var(--gm-text-tertiary)]"})]}),i.goals&&i.goals.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mt-2 ml-7",children:[i.goals.slice(0,3).map((j,v)=>e.jsx("span",{className:"text-[9px] px-2 py-0.5 rounded-full bg-white/5 text-[var(--gm-text-tertiary)]",children:j},v)),i.goals.length>3&&e.jsxs("span",{className:"text-[9px] text-[var(--gm-text-tertiary)]",children:["+",i.goals.length-3," more"]})]})]},i.id)};return e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-[var(--gm-text-primary)]",children:"Sprints"}),e.jsxs("p",{className:"text-xs text-[var(--gm-text-tertiary)]",children:[d.length," sprint",d.length!==1?"s":"",u.length>0&&e.jsxs("span",{className:"text-green-400 ml-2",children:["· ",u.length," active"]})]})]}),e.jsxs("button",{onClick:()=>r(!a),className:Q,children:[e.jsx(se,{className:"w-3.5 h-3.5"})," New Sprint"]})]}),e.jsx(me,{children:a&&e.jsx(te.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:e.jsx(Ns,{onCreated:()=>r(!1)})})}),s.error?e.jsx(Ut,{message:"Failed to load sprints.",onRetry:()=>s.refetch()}):l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-blue-400"})}):d.length===0?e.jsxs("div",{className:n(T,"p-12 text-center"),children:[e.jsx(Ct,{className:"w-10 h-10 mx-auto text-[var(--gm-text-tertiary)] mb-3"}),e.jsx("p",{className:"text-sm text-[var(--gm-text-tertiary)]",children:"No sprints yet. Create your first sprint to get started."})]}):e.jsxs("div",{className:"space-y-6",children:[u.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs font-bold text-green-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(Qe,{className:"w-3.5 h-3.5"})," Active (",u.length,")"]}),e.jsx("div",{className:"space-y-3",children:u.map(N)})]}),h.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-3.5 h-3.5"})," Planning (",h.length,")"]}),e.jsx("div",{className:"space-y-3",children:h.map(N)})]}),_.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs font-bold text-blue-400 uppercase tracking-wider mb-2 flex items-center gap-1.5",children:[e.jsx(K,{className:"w-3.5 h-3.5"})," Completed (",_.length,")"]}),e.jsx("div",{className:"space-y-3",children:_.map(N)})]})]})]})}export{Ws as default};
//# sourceMappingURL=SprintsPage-CYWFXNGI.js.map
