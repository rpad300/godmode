{"version":3,"mappings":"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","names":["showEmailPreviewModal","email","onClose","existing","extraction","hasExtraction","content","escapeHtml","r","formatRelativeTime","getSentimentEmoji","p","q","e","c","getInitials","tab","tabName","t","s","overlay","modal","handleEsc","sentiment","name","text","div","currentDirection","showNeedsResponse","createEmailsPanel","props","panel","createElement","directionFilter","on","loadEmails","needsResponseFilter","addBtn","createEmailComposer","showEmailComposer","__vitePreload","emails","emailsService","renderEmails","updateCount","container","createEmailCard","card","id","fullEmail","respondedBtn","toast","generateBtn","btn","draft","showEmailModal","directionIcon","needsResponse","getPreview","maxLength","cleaned","count","countEl"],"ignoreList":[],"sources":["../../frontend/src/components/modals/EmailPreviewModal.ts","../../frontend/src/pages/EmailsPage.ts"],"sourcesContent":["/**\r\n * Email Preview Modal - SOTA\r\n * Full email preview with AI extraction results, entities, analysis\r\n */\r\n\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nexport interface EmailData {\r\n  id: string;\r\n  subject: string;\r\n  from: { name: string; email: string };\r\n  to: Array<{ name: string; email: string }>;\r\n  cc?: Array<{ name: string; email: string }>;\r\n  body: string;\r\n  body_html?: string;\r\n  date: string;\r\n  attachments?: Array<{ name: string; size: number }>;\r\n  // AI extraction fields\r\n  extracted_entities?: ExtractionResult;\r\n  ai_summary?: string;\r\n  detected_intent?: string;\r\n  sentiment?: string;\r\n  requires_response?: boolean;\r\n  processed_at?: string;\r\n}\r\n\r\ninterface ExtractionResult {\r\n  summary?: string;\r\n  intent?: string;\r\n  sentiment?: string;\r\n  key_points?: string[];\r\n  action_items?: Array<{ task: string; owner?: string }>;\r\n  questions?: string[];\r\n  entities?: Array<{ type: string; name: string; confidence?: number }>;\r\n  contacts?: Array<{ name: string; email?: string; title?: string; organization?: string }>;\r\n}\r\n\r\nlet currentTab = 'content';\r\n\r\n/**\r\n * Show email preview modal\r\n */\r\nexport function showEmailPreviewModal(email: EmailData, onClose?: () => void): void {\r\n  const existing = document.querySelector('.email-preview-overlay');\r\n  if (existing) existing.remove();\r\n\r\n  const extraction = email.extracted_entities;\r\n  const hasExtraction = extraction && (\r\n    extraction.key_points?.length ||\r\n    extraction.action_items?.length ||\r\n    extraction.entities?.length\r\n  );\r\n\r\n  const content = document.createElement('div');\r\n  content.className = 'email-preview-modal';\r\n  content.innerHTML = `\r\n    <style>\r\n      .email-preview-modal {\r\n        display: flex;\r\n        flex-direction: column;\r\n        height: 80vh;\r\n        max-height: 800px;\r\n        width: 900px;\r\n        max-width: 95vw;\r\n      }\r\n      .email-preview-header {\r\n        display: flex;\r\n        align-items: flex-start;\r\n        gap: 16px;\r\n        padding: 20px 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n      }\r\n      .email-preview-icon {\r\n        width: 48px;\r\n        height: 48px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 24px;\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        border-radius: 12px;\r\n        flex-shrink: 0;\r\n      }\r\n      .email-preview-title {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        margin: 0 0 8px 0;\r\n        line-height: 1.3;\r\n      }\r\n      .email-preview-meta {\r\n        font-size: 13px;\r\n        color: var(--text-secondary);\r\n      }\r\n      .email-preview-meta-row {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-bottom: 4px;\r\n      }\r\n      .email-preview-meta-label {\r\n        color: var(--text-tertiary);\r\n        min-width: 40px;\r\n      }\r\n      .email-preview-badges {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-top: 8px;\r\n        flex-wrap: wrap;\r\n      }\r\n      .email-badge {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 4px;\r\n        padding: 4px 10px;\r\n        border-radius: 12px;\r\n        font-size: 12px;\r\n        font-weight: 500;\r\n      }\r\n      .email-badge.intent {\r\n        background: rgba(var(--primary-rgb), 0.1);\r\n        color: var(--primary);\r\n      }\r\n      .email-badge.sentiment-positive {\r\n        background: rgba(46, 160, 67, 0.1);\r\n        color: #2ea043;\r\n      }\r\n      .email-badge.sentiment-negative {\r\n        background: rgba(248, 81, 73, 0.1);\r\n        color: #f85149;\r\n      }\r\n      .email-badge.sentiment-neutral {\r\n        background: var(--bg-tertiary);\r\n        color: var(--text-secondary);\r\n      }\r\n      .email-badge.response-needed {\r\n        background: rgba(248, 81, 73, 0.1);\r\n        color: #f85149;\r\n      }\r\n      .email-preview-tabs {\r\n        display: flex;\r\n        gap: 4px;\r\n        padding: 0 24px;\r\n        border-bottom: 1px solid var(--border-color);\r\n        background: var(--bg-secondary);\r\n      }\r\n      .email-preview-tab {\r\n        padding: 12px 16px;\r\n        background: none;\r\n        border: none;\r\n        border-bottom: 2px solid transparent;\r\n        color: var(--text-secondary);\r\n        cursor: pointer;\r\n        font-size: 14px;\r\n        transition: all 0.15s ease;\r\n      }\r\n      .email-preview-tab:hover {\r\n        color: var(--text-primary);\r\n      }\r\n      .email-preview-tab.active {\r\n        color: var(--primary);\r\n        border-bottom-color: var(--primary);\r\n      }\r\n      .email-preview-tab-badge {\r\n        background: var(--bg-tertiary);\r\n        padding: 2px 8px;\r\n        border-radius: 10px;\r\n        font-size: 11px;\r\n        margin-left: 6px;\r\n      }\r\n      .email-preview-body {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 20px 24px;\r\n      }\r\n      .email-preview-section {\r\n        display: none;\r\n      }\r\n      .email-preview-section.active {\r\n        display: block;\r\n      }\r\n      .email-content-body {\r\n        background: var(--bg-secondary);\r\n        padding: 20px;\r\n        border-radius: 12px;\r\n        line-height: 1.7;\r\n      }\r\n      .extraction-card {\r\n        padding: 12px 16px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .extraction-type {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 4px;\r\n      }\r\n      .extraction-content {\r\n        color: var(--text-primary);\r\n      }\r\n      .extraction-meta {\r\n        font-size: 12px;\r\n        color: var(--text-tertiary);\r\n        margin-top: 4px;\r\n      }\r\n      .section-title {\r\n        font-size: 14px;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 12px;\r\n        text-transform: uppercase;\r\n      }\r\n      .empty-section {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: var(--text-tertiary);\r\n      }\r\n      .ai-summary-box {\r\n        padding: 16px;\r\n        background: linear-gradient(135deg, rgba(var(--primary-rgb), 0.05), transparent);\r\n        border-left: 3px solid var(--primary);\r\n        border-radius: 8px;\r\n        margin-bottom: 20px;\r\n      }\r\n      .ai-summary-label {\r\n        font-size: 11px;\r\n        text-transform: uppercase;\r\n        color: var(--text-secondary);\r\n        margin-bottom: 8px;\r\n      }\r\n      .key-points-list {\r\n        list-style: none;\r\n        padding: 0;\r\n        margin: 0;\r\n      }\r\n      .key-points-list li {\r\n        padding: 8px 0;\r\n        border-bottom: 1px solid var(--border-color);\r\n        display: flex;\r\n        gap: 8px;\r\n      }\r\n      .key-points-list li:last-child {\r\n        border-bottom: none;\r\n      }\r\n      .key-points-list li::before {\r\n        content: \"‚Ä¢\";\r\n        color: var(--primary);\r\n      }\r\n      .contact-card {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 12px;\r\n        padding: 12px;\r\n        background: var(--bg-secondary);\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n      }\r\n      .contact-avatar {\r\n        width: 40px;\r\n        height: 40px;\r\n        border-radius: 50%;\r\n        background: var(--bg-tertiary);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-weight: 600;\r\n        color: var(--text-secondary);\r\n      }\r\n      .contact-info {\r\n        flex: 1;\r\n      }\r\n      .contact-name {\r\n        font-weight: 600;\r\n      }\r\n      .contact-details {\r\n        font-size: 12px;\r\n        color: var(--text-secondary);\r\n      }\r\n    </style>\r\n    \r\n    <div class=\"email-preview-header\">\r\n      <div class=\"email-preview-icon\">üìß</div>\r\n      <div class=\"email-preview-header-fill\">\r\n        <h2 class=\"email-preview-title\">${escapeHtml(email.subject || 'No Subject')}</h2>\r\n        <div class=\"email-preview-meta\">\r\n          <div class=\"email-preview-meta-row\">\r\n            <span class=\"email-preview-meta-label\">From:</span>\r\n            <span><strong>${escapeHtml(email.from?.name || '')}</strong> &lt;${escapeHtml(email.from?.email || '')}&gt;</span>\r\n          </div>\r\n          <div class=\"email-preview-meta-row\">\r\n            <span class=\"email-preview-meta-label\">To:</span>\r\n            <span>${(email.to || []).map(r => escapeHtml(r.name || r.email)).join(', ')}</span>\r\n          </div>\r\n          <div class=\"email-preview-meta-row\">\r\n            <span class=\"email-preview-meta-label\">Date:</span>\r\n            <span>${formatRelativeTime(email.date)}</span>\r\n          </div>\r\n        </div>\r\n        <div class=\"email-preview-badges\">\r\n          ${extraction?.intent ? `<span class=\"email-badge intent\">üìã ${escapeHtml(extraction.intent)}</span>` : ''}\r\n          ${extraction?.sentiment ? `<span class=\"email-badge sentiment-${extraction.sentiment}\">${getSentimentEmoji(extraction.sentiment)} ${escapeHtml(extraction.sentiment)}</span>` : ''}\r\n          ${email.requires_response ? `<span class=\"email-badge response-needed\">‚ö†Ô∏è Response Needed</span>` : ''}\r\n        </div>\r\n      </div>\r\n      <button class=\"btn btn-sm email-preview-close-btn\">√ó</button>\r\n    </div>\r\n    \r\n    <div class=\"email-preview-tabs\">\r\n      <button class=\"email-preview-tab active\" data-tab=\"content\">Content</button>\r\n      <button class=\"email-preview-tab ${!hasExtraction ? 'hidden' : ''}\" data-tab=\"analysis\">\r\n        Analysis\r\n      </button>\r\n      <button class=\"email-preview-tab ${!extraction?.entities?.length ? 'hidden' : ''}\" data-tab=\"entities\">\r\n        Entities\r\n        <span class=\"email-preview-tab-badge\">${extraction?.entities?.length || 0}</span>\r\n      </button>\r\n      <button class=\"email-preview-tab ${!extraction?.contacts?.length ? 'hidden' : ''}\" data-tab=\"contacts\">\r\n        Contacts\r\n        <span class=\"email-preview-tab-badge\">${extraction?.contacts?.length || 0}</span>\r\n      </button>\r\n    </div>\r\n    \r\n    <div class=\"email-preview-body\">\r\n      <div class=\"email-preview-section active\" data-section=\"content\">\r\n        ${extraction?.summary || email.ai_summary ? `\r\n          <div class=\"ai-summary-box\">\r\n            <div class=\"ai-summary-label\">ü§ñ AI Summary</div>\r\n            <div>${escapeHtml(extraction?.summary || email.ai_summary || '')}</div>\r\n          </div>\r\n        ` : ''}\r\n        <div class=\"email-content-body\">\r\n          ${email.body_html || escapeHtml(email.body || '').replace(/\\n/g, '<br>')}\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"email-preview-section\" data-section=\"analysis\">\r\n        ${extraction?.key_points?.length ? `\r\n          <div class=\"section-title\">Key Points</div>\r\n          <ul class=\"key-points-list\">\r\n            ${extraction.key_points.map(p => `<li>${escapeHtml(p)}</li>`).join('')}\r\n          </ul>\r\n        ` : ''}\r\n        \r\n        ${extraction?.action_items?.length ? `\r\n          <div class=\"section-title section-title-mt\">Action Items</div>\r\n          ${extraction.action_items.map(a => `\r\n            <div class=\"extraction-card\">\r\n              <div class=\"extraction-content\">‚òê ${escapeHtml(a.task)}</div>\r\n              ${a.owner ? `<div class=\"extraction-meta\">Owner: ${escapeHtml(a.owner)}</div>` : ''}\r\n            </div>\r\n          `).join('')}\r\n        ` : ''}\r\n        \r\n        ${extraction?.questions?.length ? `\r\n          <div class=\"section-title section-title-mt\">Questions</div>\r\n          ${extraction.questions.map(q => `\r\n            <div class=\"extraction-card\">\r\n              <div class=\"extraction-content\">‚ùì ${escapeHtml(q)}</div>\r\n            </div>\r\n          `).join('')}\r\n        ` : ''}\r\n        \r\n        ${!extraction?.key_points?.length && !extraction?.action_items?.length && !extraction?.questions?.length ? `\r\n          <div class=\"empty-section\">No analysis available</div>\r\n        ` : ''}\r\n      </div>\r\n      \r\n      <div class=\"email-preview-section\" data-section=\"entities\">\r\n        ${extraction?.entities?.length ? extraction.entities.map(e => `\r\n          <div class=\"extraction-card\">\r\n            <div class=\"extraction-type\">${escapeHtml(e.type)}</div>\r\n            <div class=\"extraction-content\">${escapeHtml(e.name)}</div>\r\n            ${e.confidence ? `<div class=\"extraction-meta\">Confidence: ${Math.round(e.confidence * 100)}%</div>` : ''}\r\n          </div>\r\n        `).join('') : '<div class=\"empty-section\">No entities extracted</div>'}\r\n      </div>\r\n      \r\n      <div class=\"email-preview-section\" data-section=\"contacts\">\r\n        ${extraction?.contacts?.length ? extraction.contacts.map(c => `\r\n          <div class=\"contact-card\">\r\n            <div class=\"contact-avatar\">${getInitials(c.name)}</div>\r\n            <div class=\"contact-info\">\r\n              <div class=\"contact-name\">${escapeHtml(c.name)}</div>\r\n              <div class=\"contact-details\">\r\n                ${c.title ? escapeHtml(c.title) + (c.organization ? ' at ' : '') : ''}\r\n                ${c.organization ? escapeHtml(c.organization) : ''}\r\n                ${c.email ? `<br>${escapeHtml(c.email)}` : ''}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        `).join('') : '<div class=\"empty-section\">No contacts extracted</div>'}\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Tab switching\r\n  content.querySelectorAll('.email-preview-tab').forEach(tab => {\r\n    tab.addEventListener('click', () => {\r\n      const tabName = (tab as HTMLElement).dataset.tab;\r\n      content.querySelectorAll('.email-preview-tab').forEach(t => t.classList.remove('active'));\r\n      tab.classList.add('active');\r\n      content.querySelectorAll('.email-preview-section').forEach(s => s.classList.remove('active'));\r\n      content.querySelector(`[data-section=\"${tabName}\"]`)?.classList.add('active');\r\n    });\r\n  });\r\n\r\n  // Close button\r\n  content.querySelector('.close-btn')?.addEventListener('click', () => {\r\n    overlay.remove();\r\n    onClose?.();\r\n  });\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'modal-overlay overlay-preview email-preview-overlay';\r\n\r\n  const modal = document.createElement('div');\r\n  modal.className = 'modal-preview-box';\r\n  modal.appendChild(content);\r\n  overlay.appendChild(modal);\r\n\r\n  // Close on backdrop click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      overlay.remove();\r\n      onClose?.();\r\n    }\r\n  });\r\n\r\n  // Close on escape\r\n  const handleEsc = (e: KeyboardEvent) => {\r\n    if (e.key === 'Escape') {\r\n      overlay.remove();\r\n      onClose?.();\r\n      document.removeEventListener('keydown', handleEsc);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', handleEsc);\r\n\r\n  document.body.appendChild(overlay);\r\n}\r\n\r\nfunction getSentimentEmoji(sentiment: string): string {\r\n  switch (sentiment?.toLowerCase()) {\r\n    case 'positive': return 'üòä';\r\n    case 'negative': return 'üòü';\r\n    default: return 'üòê';\r\n  }\r\n}\r\n\r\nfunction getInitials(name: string): string {\r\n  return name\r\n    .split(' ')\r\n    .map(p => p[0])\r\n    .slice(0, 2)\r\n    .join('')\r\n    .toUpperCase();\r\n}\r\n\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default showEmailPreviewModal;\r\n","/**\r\n * Emails Panel Component\r\n * Email list with filters and management\r\n */\r\n\r\nimport { createElement, on } from '@lib/dom';\r\nimport { emailsService, Email } from '@services/emails';\r\nimport { showEmailModal } from '@components/modals/EmailModal';\r\nimport { showEmailPreviewModal } from '@components/modals/EmailPreviewModal';\r\nimport { toast } from '@services/toast';\r\nimport { formatRelativeTime } from '@lib/format';\r\n\r\nexport interface EmailsPanelProps {\r\n  onEmailClick?: (email: Email) => void;\r\n}\r\n\r\ntype DirectionFilter = 'all' | 'inbound' | 'outbound' | 'internal';\r\nlet currentDirection: DirectionFilter = 'all';\r\nlet showNeedsResponse = false;\r\n\r\n/**\r\n * Create emails panel\r\n */\r\nexport function createEmailsPanel(props: EmailsPanelProps = {}): HTMLElement {\r\n  const panel = createElement('div', { className: 'emails-panel' });\r\n\r\n  panel.innerHTML = `\r\n    <div class=\"panel-header\">\r\n      <div class=\"panel-title\">\r\n        <h2>Emails</h2>\r\n        <span class=\"panel-count\" id=\"emails-count\">0</span>\r\n      </div>\r\n      <div class=\"panel-actions\">\r\n        <select id=\"direction-filter\" class=\"filter-select\">\r\n          <option value=\"all\">All</option>\r\n          <option value=\"inbound\">Inbound</option>\r\n          <option value=\"outbound\">Outbound</option>\r\n          <option value=\"internal\">Internal</option>\r\n        </select>\r\n        <label class=\"checkbox-label\">\r\n          <input type=\"checkbox\" id=\"needs-response-filter\"> Needs Response\r\n        </label>\r\n        <button class=\"btn btn-primary btn-sm\" id=\"add-email-btn\">+ Add Email</button>\r\n      </div>\r\n    </div>\r\n    <div class=\"panel-content\" id=\"emails-content\">\r\n      <div class=\"loading\">Loading emails...</div>\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  const directionFilter = panel.querySelector('#direction-filter') as HTMLSelectElement;\r\n  on(directionFilter, 'change', () => {\r\n    currentDirection = directionFilter.value as DirectionFilter;\r\n    loadEmails(panel, props);\r\n  });\r\n\r\n  const needsResponseFilter = panel.querySelector('#needs-response-filter') as HTMLInputElement;\r\n  on(needsResponseFilter, 'change', () => {\r\n    showNeedsResponse = needsResponseFilter.checked;\r\n    loadEmails(panel, props);\r\n  });\r\n\r\n  const addBtn = panel.querySelector('#add-email-btn');\r\n  if (addBtn) {\r\n    on(addBtn as HTMLElement, 'click', async () => {\r\n      const { createEmailComposer, showEmailComposer } = await import('@components/EmailComposer');\r\n      showEmailComposer({\r\n        onSave: () => loadEmails(panel, props),\r\n      });\r\n    });\r\n  }\r\n\r\n  // Initial load\r\n  loadEmails(panel, props);\r\n\r\n  return panel;\r\n}\r\n\r\n/**\r\n * Load emails\r\n */\r\nasync function loadEmails(panel: HTMLElement, props: EmailsPanelProps): Promise<void> {\r\n  const content = panel.querySelector('#emails-content') as HTMLElement;\r\n  content.innerHTML = '<div class=\"loading\">Loading...</div>';\r\n\r\n  try {\r\n    let emails: Email[];\r\n\r\n    if (showNeedsResponse) {\r\n      emails = await emailsService.getNeedingResponse();\r\n    } else {\r\n      const result = await emailsService.getAll({\r\n        direction: currentDirection === 'all' ? undefined : currentDirection,\r\n      });\r\n      emails = result.emails;\r\n    }\r\n\r\n    renderEmails(content, emails, props);\r\n    updateCount(panel, emails.length);\r\n  } catch {\r\n    content.innerHTML = '<div class=\"error\">Failed to load emails</div>';\r\n  }\r\n}\r\n\r\n/**\r\n * Render emails\r\n */\r\nfunction renderEmails(container: HTMLElement, emails: Email[], props: EmailsPanelProps): void {\r\n  if (emails.length === 0) {\r\n    container.innerHTML = `\r\n      <div class=\"empty-state\">\r\n        <p>No emails found</p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = `\r\n    <div class=\"emails-list\">\r\n      ${emails.map(email => createEmailCard(email)).join('')}\r\n    </div>\r\n  `;\r\n\r\n  // Bind events\r\n  container.querySelectorAll('.email-card').forEach(card => {\r\n    on(card as HTMLElement, 'click', async (e) => {\r\n      if ((e.target as HTMLElement).closest('.email-actions')) return;\r\n\r\n      const id = card.getAttribute('data-id');\r\n      const email = emails.find(e => String(e.id) === id);\r\n      if (email) {\r\n        // Fetch full email data with extraction results\r\n        try {\r\n          const fullEmail = await emailsService.getById(id!);\r\n          showEmailPreviewModal(fullEmail as any);\r\n        } catch {\r\n          // Fallback to basic modal\r\n          showEmailPreviewModal(email as any);\r\n        }\r\n\r\n        if (props.onEmailClick) {\r\n          props.onEmailClick(email);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Mark responded\r\n    const respondedBtn = card.querySelector('.mark-responded-btn');\r\n    if (respondedBtn) {\r\n      on(respondedBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        try {\r\n          await emailsService.markResponded(id);\r\n          toast.success('Marked as responded');\r\n          loadEmails(container.closest('.emails-panel') as HTMLElement, props);\r\n        } catch {\r\n          toast.error('Failed to update email');\r\n        }\r\n      });\r\n    }\r\n\r\n    // Generate response\r\n    const generateBtn = card.querySelector('.generate-response-btn');\r\n    if (generateBtn) {\r\n      on(generateBtn as HTMLElement, 'click', async (e) => {\r\n        e.stopPropagation();\r\n        const id = card.getAttribute('data-id');\r\n        if (!id) return;\r\n\r\n        const btn = generateBtn as HTMLButtonElement;\r\n        btn.disabled = true;\r\n        btn.textContent = 'Generating...';\r\n\r\n        try {\r\n          const suggestions = await emailsService.generateResponse(id);\r\n          const draft = suggestions[0]?.response || '';\r\n          toast.success('Response generated');\r\n\r\n          // Show the generated draft\r\n          const email = emails.find(e => String(e.id) === id);\r\n          if (email) {\r\n            email.draft_response = draft;\r\n            // Open email modal with draft\r\n            showEmailModal({ mode: 'view', email: email as unknown as Parameters<typeof showEmailModal>[0]['email'] });\r\n          }\r\n        } catch {\r\n          toast.error('Failed to generate response');\r\n        } finally {\r\n          btn.disabled = false;\r\n          btn.textContent = 'AI Response';\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Create email card HTML\r\n */\r\nfunction createEmailCard(email: Email): string {\r\n  const directionIcon = email.direction === 'inbound' ? 'üì•' : email.direction === 'outbound' ? 'üì§' : 'üîÑ';\r\n  const needsResponse = email.requires_response && !email.response_sent;\r\n\r\n  return `\r\n    <div class=\"email-card ${needsResponse ? 'needs-response' : ''}\" data-id=\"${email.id}\">\r\n      <div class=\"email-direction\">${directionIcon}</div>\r\n      <div class=\"email-info\">\r\n        <div class=\"email-header\">\r\n          <span class=\"email-from\">${escapeHtml(email.from_name || email.from_email || email.from || '')}</span>\r\n          <span class=\"email-date\">${formatRelativeTime(email.created_at || email.date || new Date().toISOString())}</span>\r\n        </div>\r\n        <div class=\"email-subject\">${escapeHtml(email.subject || '(No subject)')}</div>\r\n        <div class=\"email-preview\">${escapeHtml(getPreview(email.body_text || ''))}</div>\r\n      </div>\r\n      <div class=\"email-badges\">\r\n        ${needsResponse ? '<span class=\"needs-response-badge\">Needs Response</span>' : ''}\r\n        ${email.response_drafted ? '<span class=\"draft-badge\">Draft Ready</span>' : ''}\r\n        ${email.response_sent ? '<span class=\"responded-badge\">Responded</span>' : ''}\r\n        ${email.ai_summary ? '<span class=\"ai-badge\">AI Analyzed</span>' : ''}\r\n      </div>\r\n      <div class=\"email-actions\">\r\n        ${needsResponse ? `\r\n          <button class=\"btn btn-sm generate-response-btn\">AI Response</button>\r\n          <button class=\"btn btn-sm mark-responded-btn\">Mark Responded</button>\r\n        ` : ''}\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Get preview text\r\n */\r\nfunction getPreview(text: string, maxLength = 100): string {\r\n  const cleaned = text.replace(/\\s+/g, ' ').trim();\r\n  return cleaned.length > maxLength ? cleaned.slice(0, maxLength) + '...' : cleaned;\r\n}\r\n\r\n/**\r\n * Update count\r\n */\r\nfunction updateCount(panel: HTMLElement, count: number): void {\r\n  const countEl = panel.querySelector('#emails-count');\r\n  if (countEl) countEl.textContent = String(count);\r\n}\r\n\r\n/**\r\n * Escape HTML\r\n */\r\nfunction escapeHtml(text: string): string {\r\n  const div = document.createElement('div');\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\nexport default createEmailsPanel;\r\n"],"file":"EmailsPage-C6wqr4Gh.js"}