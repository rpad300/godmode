{"version":3,"file":"AdminPage-DvsUAI95.js","sources":["../../frontend/src/pages/AdminPage.ts"],"sourcesContent":["/**\n * AdminPanel Component\n * Platform administration for superadmin users\n * Includes: LLM Config, Graph, Prompts, Processing, Audit Log\n */\n\nimport { createElement, on } from '@lib/dom';\nimport { http } from '@services/api';\nimport { toast } from '@services/toast';\nimport { appStore } from '@stores/app';\nimport {\n  billingService,\n  type ProjectBillingOverview,\n  type PricingConfig,\n  type PricingTier,\n  type ExchangeRateConfig,\n  formatEur,\n  formatTokens\n} from '@services/billing';\n\n// Types\ninterface SystemConfig {\n  id?: string;\n  key: string;\n  value: unknown;\n  category: string;\n  description?: string;\n}\n\ninterface LLMProvider {\n  id: string;\n  name: string;\n  enabled: boolean;\n  models: string[];\n  status?: 'healthy' | 'degraded' | 'offline';\n}\n\ninterface AuditLogEntry {\n  id: string;\n  table_name: string;\n  operation: string;\n  old_values?: Record<string, unknown>;\n  new_values?: Record<string, unknown>;\n  changed_by_email?: string;\n  changed_at: string;\n}\n\ninterface SystemPrompt {\n  id: string;\n  key: string;\n  name: string;\n  description: string;\n  category: string;\n  prompt_template: string;\n  uses_ontology: boolean;\n}\n\n// Ontology state (for Admin Ontology tab)\ninterface OntologyEntityType {\n  name: string;\n  properties?: string[];\n  searchable?: string[];\n  required?: string[];\n  sharedEntity?: boolean;\n}\ninterface OntologyRelationType {\n  name: string;\n  sourceType?: string;\n  targetType?: string;\n}\nlet ontologyEntities: OntologyEntityType[] = [];\nlet ontologyRelations: OntologyRelationType[] = [];\nlet ontologyLoaded = false;\nlet ontologyLoading = false;\n\n// Graph overview state (for Graph section)\ninterface GraphListItem {\n  graphName: string;\n  projectId?: string | null;\n  projectName?: string | null;\n}\nlet graphList: GraphListItem[] = [];\nlet graphStatus: { enabled?: boolean; graphName?: string; stats?: { nodes?: number; relationships?: number } } | null = null;\nlet graphOverviewLoaded = false;\nlet graphOverviewLoading = false;\nlet graphPasswordSet = false; // Track if GRAPH_PASSWORD secret exists\n\n// State\nlet currentSection = 'llm';\nlet systemConfig: Record<string, SystemConfig[]> = {};\nlet providers: LLMProvider[] = [];\nlet auditLogs: AuditLogEntry[] = [];\nlet systemPrompts: SystemPrompt[] = [];\nlet isLoading = false;\n\n// Team Analysis settings state (per-project, loaded on demand)\ninterface TeamAnalysisSettings {\n  enabled: boolean;\n  access: 'admin_only' | 'all';\n}\n\ninterface GoogleDriveState {\n  enabled: boolean;\n  rootFolderId: string;\n  hasSystemCredentials: boolean;\n  bootstrappedAt: string | null;\n}\nlet teamAnalysisSettings: TeamAnalysisSettings = { enabled: true, access: 'admin_only' };\nlet teamAnalysisLoaded = false;\nlet teamAnalysisLoading = false;\n\n// Billing state\nlet billingProjects: ProjectBillingOverview[] = [];\nlet globalPricingConfig: PricingConfig | null = null;\nlet globalPricingTiers: PricingTier[] = [];\nlet exchangeRateConfig: ExchangeRateConfig | null = null;\nlet billingLoaded = false;\nlet billingLoading = false;\n\n// Google Drive state\ninterface GoogleDriveState {\n  enabled: boolean;\n  rootFolderId: string;\n  hasSystemCredentials: boolean;\n  bootstrappedAt: string | null;\n}\nlet googleDriveState: GoogleDriveState | null = null;\nlet googleDriveLoading = false;\nlet googleDriveLoaded = false;\n\n/**\n * Load system configuration\n */\nasync function loadSystemConfig(): Promise<void> {\n  try {\n    const response = await http.get<{\n      llm_pertask?: { text?: { provider: string; model: string }; vision?: { provider: string; model: string }; embeddings?: { provider: string; model: string } };\n      prompts?: Record<string, unknown>;\n      processing?: Record<string, unknown>;\n      graph?: Record<string, unknown>;\n    }>('/api/system/config');\n\n    // Convert to internal format grouped by category\n    systemConfig = {};\n\n    // LLM per-task configs\n    if (response.data?.llm_pertask) {\n      systemConfig['llm'] = [];\n      const perTask = response.data.llm_pertask;\n      if (perTask.text) {\n        systemConfig['llm'].push({ key: 'text_provider', value: perTask.text, category: 'llm' });\n      }\n      if (perTask.vision) {\n        systemConfig['llm'].push({ key: 'vision_provider', value: perTask.vision, category: 'llm' });\n      }\n      if (perTask.embeddings) {\n        systemConfig['llm'].push({ key: 'embeddings_provider', value: perTask.embeddings, category: 'llm' });\n      }\n    }\n\n    // Processing config\n    if (response.data?.processing) {\n      systemConfig['processing'] = [{ key: 'processing', value: response.data.processing, category: 'processing' }];\n    }\n\n    // Graph config\n    if (response.data?.graph) {\n      systemConfig['graph'] = [{ key: 'graph', value: response.data.graph, category: 'graph' }];\n    }\n\n    console.log('[AdminPanel] Loaded system config:', systemConfig);\n  } catch (error) {\n    console.warn('Failed to load system config:', error);\n    systemConfig = {};\n  }\n}\n\n/**\n * Load secrets to check if graph password is set\n */\nasync function loadSecrets(): Promise<void> {\n  try {\n    const response = await http.get<{ secrets: Array<{ name: string; masked_value?: string }> }>('/api/secrets');\n    const secrets = response.data?.secrets || [];\n    graphPasswordSet = secrets.some(s => s.name === 'GRAPH_PASSWORD');\n    console.log('[AdminPanel] Graph password set:', graphPasswordSet);\n  } catch (error) {\n    console.warn('Failed to load secrets:', error);\n    graphPasswordSet = false;\n  }\n}\n\n/** Fallback provider list when API fails (no hardcoded models; models loaded via API per provider) */\nconst DEFAULT_PROVIDER_IDS: Array<{ id: string; name: string }> = [\n  { id: 'openai', name: 'OpenAI' },\n  { id: 'anthropic', name: 'Anthropic (Claude)' },\n  { id: 'google', name: 'Google AI (Gemini)' },\n  { id: 'xai', name: 'xAI (Grok)' },\n  { id: 'deepseek', name: 'DeepSeek' },\n  { id: 'kimi', name: 'Kimi (Moonshot)' },\n  { id: 'minimax', name: 'MiniMax' },\n  { id: 'ollama', name: 'Ollama (Local)' },\n];\n\n/**\n * Load LLM providers from API (central source of truth). Normalizes response to LLMProvider shape.\n */\nasync function loadProviders(): Promise<void> {\n  const defaultProviders: LLMProvider[] = DEFAULT_PROVIDER_IDS.map(p => ({\n    id: p.id,\n    name: p.name,\n    enabled: false,\n    models: [],\n  }));\n\n  try {\n    const response = await http.get<{ providers: Array<{ id: string; name?: string; label?: string; enabled?: boolean; models?: string[] }> }>('/api/llm/providers');\n    const apiProviders = response.data?.providers;\n    if (Array.isArray(apiProviders) && apiProviders.length > 0) {\n      providers = apiProviders.map(p => ({\n        id: p.id,\n        name: p.name ?? p.label ?? p.id,\n        enabled: p.enabled ?? false,\n        models: Array.isArray(p.models) ? p.models : [],\n      }));\n    } else {\n      providers = defaultProviders;\n    }\n  } catch (error) {\n    console.warn('Failed to load providers, using defaults:', error);\n    providers = defaultProviders;\n  }\n}\n\n/**\n * Load audit logs\n */\nasync function loadAuditLogs(): Promise<void> {\n  try {\n    const response = await http.get<{ logs: AuditLogEntry[] }>('/api/system/audit?limit=50');\n    auditLogs = Array.isArray(response.data?.logs) ? response.data.logs : [];\n  } catch (error) {\n    console.warn('Failed to load audit logs:', error);\n    auditLogs = [];\n  }\n}\n\n/**\n * Load system prompts\n */\nasync function loadSystemPrompts(): Promise<void> {\n  try {\n    const response = await http.get<{ prompts: SystemPrompt[] }>('/api/system/prompts');\n    systemPrompts = Array.isArray(response.data?.prompts) ? response.data.prompts : [];\n  } catch (error) {\n    console.warn('Failed to load system prompts:', error);\n    // Use default prompts structure\n    systemPrompts = [\n      { id: '1', key: 'document', name: 'Document Extraction', description: 'Extract information from PDFs and text files', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '2', key: 'transcript', name: 'Transcript Extraction', description: 'Extract information from meeting transcripts', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '3', key: 'vision', name: 'Vision/Image Extraction', description: 'Extract information from images and diagrams', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '4', key: 'conversation', name: 'Conversation Extraction', description: 'Extract information from chat conversations', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '5', key: 'email', name: 'Email Extraction', description: 'Extract information from emails', category: 'extraction', prompt_template: '', uses_ontology: true },\n      { id: '6', key: 'summary', name: 'Content Summary', description: 'Generate concise summaries', category: 'analysis', prompt_template: '', uses_ontology: false },\n    ];\n  }\n}\n\n/**\n * Load ontology data (entities and relations) for Admin Ontology tab\n */\nasync function loadOntologyData(): Promise<void> {\n  ontologyLoading = true;\n  try {\n    const [entitiesRes, relationsRes] = await Promise.all([\n      http.get<{ ok: boolean; entityTypes?: OntologyEntityType[] }>('/api/ontology/entities'),\n      http.get<{ ok: boolean; relationTypes?: OntologyRelationType[] }>('/api/ontology/relations'),\n    ]);\n    ontologyEntities = entitiesRes.data?.entityTypes ?? [];\n    ontologyRelations = relationsRes.data?.relationTypes ?? [];\n    ontologyLoaded = true;\n  } catch (error) {\n    console.warn('Failed to load ontology:', error);\n    ontologyEntities = [];\n    ontologyRelations = [];\n  } finally {\n    ontologyLoading = false;\n  }\n}\n\n/**\n * Load graph overview (list + status) for Graph section\n */\nasync function loadGraphOverview(): Promise<void> {\n  graphOverviewLoading = true;\n  try {\n    const [listRes, statusRes] = await Promise.all([\n      http.get<{ ok: boolean; graphs?: GraphListItem[]; error?: string }>('/api/graph/list'),\n      http.get<{ enabled?: boolean; graphName?: string; stats?: { nodes?: number; relationships?: number } }>('/api/graph/status').catch(() => ({ data: {} })),\n    ]);\n    graphList = listRes.data?.graphs ?? [];\n    if (listRes.data?.error) {\n      graphList = [];\n    }\n    graphStatus = statusRes.data ?? null;\n    graphOverviewLoaded = true;\n  } catch (error) {\n    console.warn('Failed to load graph overview:', error);\n    graphList = [];\n    graphStatus = null;\n  } finally {\n    graphOverviewLoading = false;\n  }\n}\n\n/**\n * Save a config value\n */\nasync function saveConfig(key: string, value: unknown, category: string): Promise<void> {\n  try {\n    await http.post('/api/system/config', { key, value, category });\n    toast.success('Configuration saved');\n    await loadSystemConfig();\n  } catch (error) {\n    toast.error('Failed to save configuration');\n  }\n}\n\n/**\n * Test provider connection\n */\nasync function testProvider(providerId: string): Promise<void> {\n  try {\n    const response = await http.post<{ ok: boolean; error?: { message: string }; models?: number }>(`/api/llm/test/${providerId}`);\n    if (response.data.ok) {\n      const models = response.data.models ? ` (${response.data.models} models)` : '';\n      toast.success(`${providerId} connection successful${models}`);\n    } else {\n      toast.error(response.data.error?.message || 'Connection failed');\n    }\n  } catch (error) {\n    toast.error('Connection test failed');\n  }\n}\n\n/**\n * Get config value by key\n */\nfunction getConfigValue(category: string, key: string, defaultValue: unknown = ''): unknown {\n  const configs = systemConfig[category] || [];\n\n  // For graph category, the config is stored as { key: 'graph', value: { enabled, graphName, provider } }\n  if (category === 'graph') {\n    const graphConfigEntry = configs.find(c => c.key === 'graph');\n    if (graphConfigEntry?.value && typeof graphConfigEntry.value === 'object') {\n      const graphValue = graphConfigEntry.value as Record<string, unknown>;\n      return graphValue[key] ?? defaultValue;\n    }\n  }\n\n  const config = configs.find(c => c.key === key);\n  return config?.value ?? defaultValue;\n}\n\n/**\n * Render section navigation\n */\nfunction renderNav(): string {\n  const sections = [\n    { id: 'llm', label: 'LLM Providers', icon: 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z' },\n    { id: 'models', label: 'Model Metadata', icon: 'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10' },\n    { id: 'queue', label: 'LLM Queue', icon: 'M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15' },\n    { id: 'graph', label: 'Graph', icon: 'M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4' },\n    { id: 'ontology', label: 'Ontology', icon: 'M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z' },\n    { id: 'prompts', label: 'Prompts', icon: 'M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z' },\n    { id: 'processing', label: 'Processing', icon: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z' },\n    { id: 'team-analysis', label: 'Team Analysis', icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z' },\n    { id: 'google-drive', label: 'Google Drive', icon: 'M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12' },\n    { id: 'billing', label: 'Billing', icon: 'M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z' },\n    { id: 'audit', label: 'Audit Log', icon: 'M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01' },\n  ];\n\n  return sections.map(s => `\n    <button class=\"admin-nav-btn ${currentSection === s.id ? 'active' : ''}\" data-section=\"${s.id}\">\n      <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"20\" height=\"20\">\n        <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"${s.icon}\"/>\n      </svg>\n      <span>${s.label}</span>\n    </button>\n  `).join('');\n}\n\n/**\n * Render LLM Providers section\n */\nfunction renderLLMSection(): string {\n  const taskTypes = ['text', 'vision', 'embeddings'];\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>LLM Provider Configuration</h3>\n        <p>Configure AI providers for different task types</p>\n      </div>\n\n      <!-- Provider Status -->\n      <div class=\"admin-card\">\n        <h4>Provider Health</h4>\n        <div class=\"provider-grid\">\n          ${providers.map(p => `\n            <div class=\"provider-card ${p.enabled ? 'enabled' : 'disabled'}\">\n              <div class=\"provider-header\">\n                <span class=\"provider-name\">${p.name}</span>\n                <span class=\"provider-status ${p.status || 'unknown'}\">${p.status || 'unknown'}</span>\n              </div>\n              <div class=\"provider-models\">${(p.models && p.models.length > 0) ? p.models.slice(0, 3).join(', ') : '‚Äî'}</div>\n              <div class=\"provider-actions\">\n                <button class=\"btn btn-sm btn-secondary\" data-test-provider=\"${p.id}\">Test</button>\n                <label class=\"toggle-switch\">\n                  <input type=\"checkbox\" ${p.enabled ? 'checked' : ''} data-toggle-provider=\"${p.id}\">\n                  <span class=\"slider\"></span>\n                </label>\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n\n      <!-- Task Configuration -->\n      <div class=\"admin-card\">\n        <h4>Task-Specific AI Configuration</h4>\n        <p class=\"text-muted\">Configure which provider and model to use for each AI task. These settings apply globally to the platform and are persisted in Supabase.</p>\n        \n        ${taskTypes.map(task => {\n    const taskConfig = getConfigValue('llm', task + '_provider', { provider: '', model: '' }) as { provider: string; model: string };\n    const icons: Record<string, string> = { text: 'üí¨', vision: 'üëÅÔ∏è', embeddings: 'üîó' };\n    const labels: Record<string, string> = { text: 'Text / Chat', vision: 'Vision / Images', embeddings: 'Embeddings' };\n    const descs: Record<string, string> = {\n      text: 'Document analysis, chat, briefings, Q&A, extraction',\n      vision: 'Image analysis, scanned documents, diagrams, charts',\n      embeddings: 'Semantic search, similarity matching, RAG'\n    };\n    const icon = icons[task] || '‚öôÔ∏è';\n    const label = labels[task] || task;\n    const desc = descs[task] || '';\n    const providerOpts = ['openai', 'anthropic', 'google', 'deepseek', 'grok', 'kimi', 'minimax', 'ollama'];\n    const providerNames: Record<string, string> = {\n      openai: 'OpenAI', anthropic: 'Anthropic (Claude)', google: 'Google AI (Gemini)',\n      deepseek: 'DeepSeek', grok: 'xAI (Grok)', kimi: 'Kimi (Moonshot)',\n      minimax: 'MiniMax', ollama: 'Ollama (Local)'\n    };\n\n    return '<div class=\"task-config-row admin-task-config-row\" data-task-row=\"' + task + '\">' +\n      '<div class=\"task-label admin-task-label\">' +\n      '<span class=\"admin-task-label-icon\">' + icon + '</span>' +\n      '<strong class=\"admin-task-label-strong\">' + label + '</strong>' +\n      '<span class=\"text-muted admin-task-desc\">' + desc + '</span>' +\n      '</div>' +\n      '<div class=\"task-selects admin-task-selects\">' +\n      '<div>' +\n      '<label class=\"admin-field-label\">Provider</label>' +\n      '<select class=\"form-select provider-select\" data-task=\"' + task + '\" data-field=\"provider\">' +\n      '<option value=\"\"' + (!taskConfig.provider ? ' selected' : '') + '>-- Select Provider --</option>' +\n      providerOpts.map(p => '<option value=\"' + p + '\"' + (taskConfig.provider === p ? ' selected' : '') + '>' + providerNames[p] + '</option>').join('') +\n      '</select>' +\n      '</div>' +\n      '<div>' +\n      '<label class=\"admin-field-label\">Model</label>' +\n      '<select class=\"form-select model-select\" data-task=\"' + task + '\" data-field=\"model\">' +\n      '<option value=\"\">-- Select Provider First --</option>' +\n      (taskConfig.model ? '<option value=\"' + taskConfig.model + '\" selected>' + taskConfig.model + '</option>' : '') +\n      '</select>' +\n      '<span class=\"model-loading hidden\" data-task=\"' + task + '\">Loading models...</span>' +\n      '</div>' +\n      '</div>' +\n      '<div class=\"model-status admin-model-status\" data-task=\"' + task + '\"></div>' +\n      '</div>';\n  }).join('')}\n        \n        <div class=\"admin-llm-save-row\">\n          <button class=\"btn btn-primary\" id=\"save-llm-config\">Save LLM Configuration</button>\n          <span class=\"text-muted admin-llm-warning\">‚ö†Ô∏è Changes apply immediately to all AI processing</span>\n        </div>\n      </div>\n\n      <!-- API Keys - LLM Providers -->\n      <div class=\"admin-card\">\n        <h4>LLM API Keys</h4>\n        <p class=\"text-muted\">System-level API keys (stored encrypted in Supabase)</p>\n        \n        <div class=\"api-keys-grid\" id=\"api-keys-container\">\n          <div class=\"form-group\" data-secret-name=\"OPENAI_API_KEY\">\n            <label>OpenAI <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"openai-key\" name=\"llm_key_openai_${Date.now()}\" placeholder=\"sk-proj-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn btn-sm btn-ghost\" data-toggle-visibility=\"openai-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"CLAUDE_API_KEY\">\n            <label>Anthropic (Claude) <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"anthropic-key\" name=\"llm_key_claude_${Date.now()}\" placeholder=\"sk-ant-api03-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn btn-sm btn-ghost\" data-toggle-visibility=\"anthropic-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"GOOGLE_API_KEY\">\n            <label>Google AI (Gemini) <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"google-key\" name=\"llm_key_google_${Date.now()}\" placeholder=\"AIza...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn btn-sm btn-ghost\" data-toggle-visibility=\"google-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"XAI_API_KEY\">\n            <label>xAI (Grok) <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"xai-key\" name=\"llm_key_xai_${Date.now()}\" placeholder=\"xai-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn btn-sm btn-ghost\" data-toggle-visibility=\"xai-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"DEEPSEEK_API_KEY\">\n            <label>DeepSeek <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"deepseek-key\" name=\"llm_key_deepseek_${Date.now()}\" placeholder=\"sk-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn btn-sm btn-ghost\" data-toggle-visibility=\"deepseek-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"KIMI_API_KEY\">\n            <label>Kimi (Moonshot) <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"kimi-key\" name=\"llm_key_kimi_${Date.now()}\" placeholder=\"sk-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn btn-sm btn-ghost\" data-toggle-visibility=\"kimi-key\">Show</button>\n            </div>\n          </div>\n          \n          <div class=\"form-group\" data-secret-name=\"MINIMAX_API_KEY\">\n            <label>MiniMax <span class=\"key-status admin-key-status\"></span></label>\n            <div class=\"input-group\">\n              <input type=\"text\" id=\"minimax-key\" name=\"llm_key_minimax_${Date.now()}\" placeholder=\"MINIMAX-...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n              <button class=\"btn btn-sm btn-ghost\" data-toggle-visibility=\"minimax-key\">Show</button>\n            </div>\n          </div>\n        </div>\n        \n        <div id=\"api-keys-loading\" class=\"admin-keys-loading\">Loading configured keys...</div>\n        <button class=\"btn btn-primary mt-4\" id=\"save-api-keys\">Save LLM API Keys</button>\n      </div>\n\n      <!-- Service API Keys -->\n      <div class=\"admin-card\">\n        <h4>Service API Keys</h4>\n        <p class=\"text-muted\">Keys for email, notifications and other services</p>\n        \n        <div class=\"form-group\" data-secret-name=\"RESEND_API_KEY\">\n          <label>Resend API Key (Email Service) <span class=\"key-status admin-key-status\"></span></label>\n          <div class=\"input-group\">\n            <input type=\"text\" id=\"resend-key\" name=\"service_key_resend_${Date.now()}\" placeholder=\"re_...\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n            <button class=\"btn btn-sm btn-ghost\" data-toggle-visibility=\"resend-key\">Show</button>\n          </div>\n        </div>\n        \n        <div class=\"form-group\" data-secret-name=\"BRAVE_API_KEY\">\n          <label>Brave Search API Key (Company analysis) <span class=\"key-status admin-key-status\"></span></label>\n          <div class=\"input-group\">\n            <input type=\"password\" id=\"brave-key\" name=\"service_key_brave_${Date.now()}\" placeholder=\"Optional ‚Äì for richer company reports\" class=\"form-input api-key-input\" autocomplete=\"off\" readonly onfocus=\"this.removeAttribute('readonly')\">\n            <button class=\"btn btn-sm btn-ghost\" data-toggle-visibility=\"brave-key\">Show</button>\n          </div>\n          <p class=\"text-muted text-sm\">Get key at <a href=\"https://api-dashboard.search.brave.com/documentation\" target=\"_blank\" rel=\"noopener\">Brave Search API</a>. Used to enrich company analysis with web search.</p>\n        </div>\n        \n        <button class=\"btn btn-primary mt-4\" id=\"save-service-keys\">Save Service Keys</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Graph section (Supabase Graph)\n */\nfunction renderGraphSection(): string {\n  const graphConfig = {\n    enabled: getConfigValue('graph', 'enabled', false) as boolean,\n    graphName: getConfigValue('graph', 'graphName', 'godmode') as string,\n  };\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Graph Database Configuration</h3>\n        <p>Supabase Graph for knowledge graph and GraphRAG</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <div class=\"form-group\">\n          <label class=\"toggle-label\">\n            <input type=\"checkbox\" id=\"graph-enabled\" ${graphConfig.enabled ? 'checked' : ''}>\n            <span>Enable Graph Database</span>\n          </label>\n        </div>\n\n        <div class=\"form-group admin-form-group-box\">\n          <p class=\"admin-form-group-p\">\n            <strong>Provider:</strong> Supabase Graph (PostgreSQL-based)\n          </p>\n          <p class=\"admin-form-group-p-sm\">\n            Uses your existing Supabase connection. No additional configuration needed.\n          </p>\n        </div>\n\n        <div class=\"form-group\">\n          <label>Graph Name</label>\n          <input type=\"text\" id=\"graph-name\" value=\"${graphConfig.graphName}\" class=\"form-input\" placeholder=\"godmode\">\n        </div>\n\n        <div class=\"btn-group mt-4\">\n          <button class=\"btn btn-primary\" id=\"save-graph-config\">Save Configuration</button>\n          <button class=\"btn btn-secondary\" id=\"test-graph-connection\">Test Connection</button>\n        </div>\n      </div>\n\n      <div class=\"admin-card\" id=\"graph-overview-card\">\n        <h4>Graph overview</h4>\n        <p class=\"text-muted\">Current graph status. Enable and save configuration above first.</p>\n        <div id=\"graph-overview-content\">\n          ${graphOverviewLoading ? '<p class=\"text-muted\">Loading...</p>' : !graphOverviewLoaded ? '<button class=\"btn btn-secondary\" id=\"load-graph-overview\">Load overview</button>' : (graphList.length === 0 && !graphStatus?.enabled ? '<p class=\"text-muted\">Graph not enabled or not connected. Enable and save configuration.</p><button class=\"btn-secondary mt-4\" id=\"refresh-graph-overview\">Refresh</button>' : `\n            ${graphStatus?.enabled && (graphStatus.stats != null || graphStatus.graphName) ? `\n              <div class=\"graph-status-row admin-graph-status-row\">\n                <strong>Current graph:</strong> ${graphStatus.graphName ?? '‚Äî'}\n                ${graphStatus.stats?.nodes !== undefined ? ` ¬∑ Nodes: ${graphStatus.stats.nodes}` : ''}\n                ${graphStatus.stats?.relationships !== undefined ? ` ¬∑ Edges: ${graphStatus.stats.relationships}` : ''}\n              </div>\n            ` : ''}\n            ${graphList.length > 0 ? `\n              <table class=\"admin-table admin-table-full\">\n                <thead><tr><th>Graph name</th><th>Project</th></tr></thead>\n                <tbody>\n                  ${graphList.map(g => `<tr><td><code>${g.graphName}</code></td><td>${g.projectName ?? '‚Äî'}</td></tr>`).join('')}\n                </tbody>\n              </table>\n            ` : ''}\n            <div class=\"btn-group mt-4\">\n              <button class=\"btn btn-secondary\" id=\"open-graph-tab\">Open in Graph tab</button>\n              <button class=\"btn btn-secondary\" id=\"refresh-graph-overview\">Refresh</button>\n            </div>\n          `)}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Ontology section\n */\nfunction renderOntologySection(): string {\n  if (ontologyLoading || !ontologyLoaded) {\n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Ontology</h3>\n        <p>Entity types and relation types used by extraction and GraphRAG</p>\n      </div>\n      <div class=\"admin-card\">\n        <p class=\"text-muted\">${ontologyLoading ? 'Loading ontology...' : 'Click Load to fetch entity and relation types from the API.'}</p>\n        ${!ontologyLoading ? '<button class=\"btn btn-primary\" id=\"load-ontology\">Load ontology</button>' : ''}\n      </div>\n    </div>\n    `;\n  }\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Ontology</h3>\n        <p>Entity types and relation types used by extraction and GraphRAG</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Entity types</h4>\n        <p class=\"text-muted\">Types of entities that can be extracted and stored in the graph.</p>\n        ${ontologyEntities.length === 0 ? '<p class=\"text-muted\">No entity types returned.</p>' : `\n          <ul class=\"ontology-list\">\n            ${ontologyEntities.map(e => `\n              <li><code>${e.name}</code>\n                ${e.sharedEntity ? ' <span class=\"badge badge-info\">shared</span>' : ''}\n                ${e.properties?.length ? ` ¬∑ properties: ${e.properties.join(', ')}` : ''}\n              </li>\n            `).join('')}\n          </ul>\n        `}\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Relation types</h4>\n        <p class=\"text-muted\">Allowed relationships between entity types.</p>\n        ${ontologyRelations.length === 0 ? '<p class=\"text-muted\">No relation types returned.</p>' : `\n          <ul class=\"ontology-list\">\n            ${ontologyRelations.map(r => `\n              <li><code>${r.name}</code>\n                ${(r as { sourceType?: string; targetType?: string }).sourceType ? ` (${(r as { sourceType?: string; targetType?: string }).sourceType} ‚Üí ${(r as { sourceType?: string; targetType?: string }).targetType})` : ''}\n              </li>\n            `).join('')}\n          </ul>\n        `}\n      </div>\n\n      <div class=\"btn-group mt-4\">\n        <button class=\"btn btn-secondary\" id=\"reload-ontology\">Reload ontology</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Prompts section\n */\nfunction renderPromptsSection(): string {\n  // Group prompts by category\n  const extractionPrompts = systemPrompts.filter(p => p.category === 'extraction');\n  const analysisPrompts = systemPrompts.filter(p => p.category === 'analysis');\n  const templatePrompts = systemPrompts.filter(p => p.category === 'template');\n  const sprintPrompts = systemPrompts.filter(p => p.category === 'sprint');\n  const reportPrompts = systemPrompts.filter(p => p.category === 'report');\n\n  const renderPromptCard = (p: SystemPrompt) => `\n    <div class=\"admin-card prompt-card\" data-prompt-id=\"${p.id}\">\n      <div class=\"prompt-header\">\n        <div>\n          <h4>${p.name}</h4>\n          <p class=\"text-muted\">${p.description}</p>\n        </div>\n        <div class=\"prompt-badges\">\n          ${p.uses_ontology ? '<span class=\"badge badge-info\">Ontology-Aware</span>' : ''}\n          <span class=\"badge badge-secondary\">${p.key}</span>\n        </div>\n      </div>\n      <textarea class=\"form-textarea prompt-editor\" data-prompt-key=\"${p.key}\" rows=\"12\" \n                placeholder=\"Enter prompt template...\n\nAvailable placeholders:\n{{CONTENT}} - The document/transcript content\n{{FILENAME}} - The file/document name\n{{TODAY}} - Current date\n{{ONTOLOGY_SECTION}} - Ontology context (if uses_ontology=true)\n{{ROLE_CONTEXT}} - User role context\n{{PROJECT_CONTEXT}} - Project context\">${p.prompt_template || ''}</textarea>\n      <div class=\"prompt-actions\">\n        <button class=\"btn btn-sm btn-secondary\" data-view-versions=\"${p.key}\">\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n            <polyline points=\"12,6 12,12 16,14\"/>\n          </svg>\n          Version History\n        </button>\n        <span class=\"prompt-status\" id=\"status-${p.key}\"></span>\n      </div>\n      <div class=\"version-history hidden\" id=\"versions-${p.key}\">\n        <div class=\"version-list\"></div>\n      </div>\n    </div>\n  `;\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>AI Prompts Configuration</h3>\n        <p>Customize ontology-aware prompts for AI extraction. All prompts support template variables.</p>\n      </div>\n\n      <div class=\"prompt-info admin-card\">\n        <h4>Template Variables</h4>\n        <div class=\"variables-grid\">\n          <code>{{CONTENT}}</code> <span>Document/transcript content</span>\n          <code>{{FILENAME}}</code> <span>File or document name</span>\n          <code>{{TODAY}}</code> <span>Current date (YYYY-MM-DD)</span>\n          <code>{{ONTOLOGY_SECTION}}</code> <span>Injected ontology context</span>\n          <code>{{ROLE_CONTEXT}}</code> <span>User role context line</span>\n          <code>{{PROJECT_CONTEXT}}</code> <span>Project context line</span>\n          <code>{{CONTENT_LENGTH}}</code> <span>Content length in characters</span>\n        </div>\n      </div>\n\n      <h4 class=\"section-subtitle\">Extraction Prompts</h4>\n      ${extractionPrompts.length > 0 ? extractionPrompts.map(renderPromptCard).join('') : '<p class=\"text-muted\">Run migration 031 to create default prompts</p>'}\n\n      ${analysisPrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Analysis Prompts</h4>\n        ${analysisPrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      ${templatePrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Template Sections</h4>\n        ${templatePrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      ${sprintPrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Sprint / Task prompts</h4>\n        <p class=\"text-muted\">Prompts for task description from rules, user stories, and dependencies. Used when adding tasks manually and in sprint flows.</p>\n        ${sprintPrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      ${reportPrompts.length > 0 ? `\n        <h4 class=\"section-subtitle\">Report prompts (Relat√≥rios)</h4>\n        <p class=\"text-muted\">Prompts for generating sprint reports as A4 document or PPT-style presentation. Placeholders: {{REPORT_DATA}}, {{STYLE_VARIANT}} (document only).</p>\n        ${reportPrompts.map(renderPromptCard).join('')}\n      ` : ''}\n\n      <div class=\"btn-group mt-4\">\n        <button class=\"btn-primary\" id=\"save-prompts\">Save All Prompts</button>\n        <button class=\"btn-secondary\" id=\"reload-prompts\">Reload from Database</button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Processing section\n */\nfunction renderProcessingSection(): string {\n  const processing = {\n    chunkSize: getConfigValue('processing', 'chunk_size', 1000) as number,\n    chunkOverlap: getConfigValue('processing', 'chunk_overlap', 200) as number,\n    maxTokens: getConfigValue('processing', 'max_tokens', 4096) as number,\n    temperature: getConfigValue('processing', 'temperature', 0.7) as number,\n    autoProcess: getConfigValue('processing', 'auto_process', true) as boolean,\n    parallelJobs: getConfigValue('processing', 'parallel_jobs', 3) as number,\n  };\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Document Processing Settings</h3>\n        <p>Configure how documents are processed and analyzed</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Chunking Settings</h4>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label>Chunk Size (tokens)</label>\n            <input type=\"number\" id=\"proc-chunk-size\" value=\"${processing.chunkSize}\" class=\"form-input\" min=\"100\" max=\"8000\">\n          </div>\n          <div class=\"form-group\">\n            <label>Chunk Overlap (tokens)</label>\n            <input type=\"number\" id=\"proc-chunk-overlap\" value=\"${processing.chunkOverlap}\" class=\"form-input\" min=\"0\" max=\"1000\">\n          </div>\n        </div>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Generation Settings</h4>\n        \n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label>Max Tokens</label>\n            <input type=\"number\" id=\"proc-max-tokens\" value=\"${processing.maxTokens}\" class=\"form-input\" min=\"256\" max=\"32000\">\n          </div>\n          <div class=\"form-group\">\n            <label>Temperature</label>\n            <input type=\"number\" id=\"proc-temperature\" value=\"${processing.temperature}\" class=\"form-input\" min=\"0\" max=\"2\" step=\"0.1\">\n          </div>\n        </div>\n      </div>\n\n      <div class=\"admin-card\">\n        <h4>Job Settings</h4>\n        \n        <div class=\"form-group\">\n          <label class=\"toggle-label\">\n            <input type=\"checkbox\" id=\"proc-auto-process\" ${processing.autoProcess ? 'checked' : ''}>\n            <span>Auto-process uploaded documents</span>\n          </label>\n        </div>\n        \n        <div class=\"form-group\">\n          <label>Parallel Jobs</label>\n          <input type=\"number\" id=\"proc-parallel-jobs\" value=\"${processing.parallelJobs}\" class=\"form-input\" min=\"1\" max=\"10\">\n        </div>\n      </div>\n\n      <button class=\"btn-primary\" id=\"save-processing\">Save Processing Settings</button>\n    </div>\n  `;\n}\n\n/**\n * Load Team Analysis settings for current project\n */\nasync function loadTeamAnalysisSettings(): Promise<void> {\n  const state = appStore.getState();\n  const projectId = state.currentProject?.id;\n\n  if (!projectId) {\n    teamAnalysisSettings = { enabled: true, access: 'admin_only' };\n    teamAnalysisLoaded = true;\n    return;\n  }\n\n  teamAnalysisLoading = true;\n\n  try {\n    const response = await http.get<{ ok: boolean; config: { enabled: boolean; access: string } }>('/api/team-analysis/config');\n    teamAnalysisSettings = {\n      enabled: response?.data?.config?.enabled ?? true,\n      access: (response?.data?.config?.access as 'admin_only' | 'all') ?? 'admin_only'\n    };\n    teamAnalysisLoaded = true;\n  } catch (error) {\n    console.error('[AdminPanel] Error loading team analysis settings:', error);\n    teamAnalysisSettings = { enabled: true, access: 'admin_only' };\n    teamAnalysisLoaded = true;\n  } finally {\n    teamAnalysisLoading = false;\n  }\n}\n\n/**\n * Save Team Analysis settings\n */\nasync function saveTeamAnalysisSettings(enabled: boolean, access: string): Promise<void> {\n  const state = appStore.getState();\n  const projectId = state.currentProject?.id;\n\n  if (!projectId) {\n    toast.error('No project selected');\n    return;\n  }\n\n  try {\n    await http.put('/api/team-analysis/config', {\n      enabled,\n      access\n    });\n\n    teamAnalysisSettings = { enabled, access: access as 'admin_only' | 'all' };\n    toast.success('Team Analysis settings saved');\n  } catch (error) {\n    console.error('[AdminPanel] Error saving team analysis settings:', error);\n    toast.error('Failed to save settings');\n  }\n}\n\n/**\n * Load Google Drive config (GET /api/system/google-drive)\n */\nasync function loadGoogleDriveState(): Promise<void> {\n  googleDriveLoading = true;\n  try {\n    const response = await http.get<GoogleDriveState>('/api/system/google-drive');\n    googleDriveState = {\n      enabled: response.data.enabled ?? false,\n      rootFolderId: response.data.rootFolderId ?? '',\n      hasSystemCredentials: response.data.hasSystemCredentials ?? false,\n      bootstrappedAt: response.data.bootstrappedAt ?? null\n    };\n    googleDriveLoaded = true;\n  } catch (error) {\n    console.error('[AdminPanel] Error loading Google Drive config:', error);\n    googleDriveState = { enabled: false, rootFolderId: '', hasSystemCredentials: false, bootstrappedAt: null };\n    googleDriveLoaded = true;\n  } finally {\n    googleDriveLoading = false;\n  }\n}\n\n/**\n * Render Google Drive section\n */\nfunction renderGoogleDriveSection(): string {\n  if (googleDriveLoading || !googleDriveLoaded) {\n    if (!googleDriveLoading && !googleDriveLoaded) loadGoogleDriveState();\n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Google Drive</h3>\n        <p>Store uploads and transcripts in Google Drive</p>\n      </div>\n      <div class=\"admin-card\">\n        <div class=\"admin-empty-state\"><div class=\"loading-spinner\"></div><p>Loading...</p></div>\n      </div>\n    </div>`;\n  }\n  const gd = googleDriveState!;\n  return `\n  <div class=\"admin-section\">\n    <div class=\"admin-section-header\">\n      <h3>Google Drive</h3>\n      <p>Store uploads and transcripts in Google Drive. Configure system account and root folder, then bootstrap projects.</p>\n    </div>\n    <div class=\"admin-card\">\n      <h4>Integration</h4>\n      <div class=\"form-group admin-form-group-box\">\n        <label class=\"admin-checkbox-label\">\n          <input type=\"checkbox\" id=\"google-drive-enabled\" ${gd.enabled ? 'checked' : ''}>\n          Enable Google Drive for uploads\n        </label>\n      </div>\n      <div class=\"form-group admin-form-group-box\">\n        <label class=\"admin-field-label-block\">Root Folder ID</label>\n        <input type=\"text\" id=\"google-drive-root-folder\" class=\"form-input\" placeholder=\"Google Drive folder ID\" value=\"${(gd.rootFolderId || '').replace(/\"/g, '&quot;')}\">\n        <p class=\"text-muted admin-field-hint\">Create a folder in Google Drive and paste its ID here. All project folders will be created under it.</p>\n      </div>\n      <div class=\"form-group admin-form-group-box\">\n        <label class=\"admin-field-label-block\">System Service Account JSON</label>\n        <textarea id=\"google-drive-service-json\" class=\"form-input\" rows=\"4\" placeholder=\"${gd.hasSystemCredentials ? 'Already configured. Paste new JSON to replace.' : 'Paste the full JSON key file content'}\"></textarea>\n        ${gd.hasSystemCredentials ? '<p class=\"text-muted\">Credentials are stored. Paste new JSON only to replace.</p>' : ''}\n      </div>\n      <button type=\"button\" class=\"btn-primary\" id=\"save-google-drive\">Save Google Drive config</button>\n    </div>\n    <div class=\"admin-card\">\n      <h4>Bootstrap projects</h4>\n      <p class=\"text-muted admin-mb-4\">Create folder structure (uploads, newtranscripts, archived, exports) for all projects under the root folder.</p>\n      <button type=\"button\" class=\"btn-secondary\" id=\"bootstrap-google-drive\">Bootstrap all projects</button>\n      ${gd.bootstrappedAt ? `<p class=\"text-muted admin-mt-2\">Last run: ${gd.bootstrappedAt}</p>` : ''}\n    </div>\n  </div>`;\n}\n\n/**\n * Render Team Analysis section\n */\nfunction renderTeamAnalysisSection(): string {\n  const state = appStore.getState();\n  const projectId = state.currentProject?.id;\n  const projectName = state.currentProject?.name || 'Unknown';\n\n  if (!projectId) {\n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Team Analysis Settings</h3>\n        <p>Configure access control for behavioral analysis features</p>\n      </div>\n      \n      <div class=\"admin-card\">\n        <div class=\"admin-empty-state\">\n          <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"48\" height=\"48\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"/>\n          </svg>\n          <p>Please select a project to configure Team Analysis settings.</p>\n        </div>\n      </div>\n    </div>\n    `;\n  }\n\n  if (teamAnalysisLoading || !teamAnalysisLoaded) {\n    // Trigger load and show loading state\n    if (!teamAnalysisLoading && !teamAnalysisLoaded) {\n      loadTeamAnalysisSettings();\n    }\n\n    return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Team Analysis Settings</h3>\n        <p>Configure access control for behavioral analysis features</p>\n      </div>\n      \n      <div class=\"admin-card\">\n        <div class=\"admin-empty-state\">\n          <div class=\"loading-spinner\"></div>\n          <p>Loading settings...</p>\n        </div>\n      </div>\n    </div>\n    `;\n  }\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Team Analysis Settings</h3>\n        <p>Configure access control for behavioral analysis features</p>\n      </div>\n\n      <!-- Current Project Info -->\n      <div class=\"admin-card\">\n        <h4>Current Project</h4>\n        <div class=\"admin-project-preview\">\n          <div class=\"admin-project-preview-icon\">${projectName.charAt(0).toUpperCase()}</div>\n          <div>\n            <div class=\"admin-project-name\">${projectName}</div>\n            <div class=\"admin-project-id\">ID: ${projectId}</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Feature Toggle -->\n      <div class=\"admin-card\">\n        <h4>Feature Status</h4>\n        <p class=\"text-muted admin-mb-4\">Enable or disable Team Analysis for this project</p>\n        \n        <div class=\"form-group\">\n          <label class=\"toggle-label admin-toggle-label\">\n            <input type=\"checkbox\" id=\"team-analysis-enabled\" ${teamAnalysisSettings.enabled ? 'checked' : ''} class=\"admin-checkbox\">\n            <div>\n              <span class=\"admin-toggle-title\">Enable Team Analysis</span>\n              <p class=\"admin-toggle-desc\">When enabled, users with access can analyze team member behavior from meeting transcripts</p>\n            </div>\n          </label>\n        </div>\n      </div>\n\n      <!-- Access Control -->\n      <div class=\"admin-card\">\n        <h4>Access Control</h4>\n        <p class=\"text-muted admin-mb-4\">Define who can access Team Analysis features</p>\n        \n        <div class=\"form-group\">\n          <label class=\"admin-field-label-block\">Access Level</label>\n          <select id=\"team-analysis-access\" class=\"form-input admin-select-max\">\n            <option value=\"admin_only\" ${teamAnalysisSettings.access === 'admin_only' ? 'selected' : ''}>Admins Only - Only project owner and admins can access</option>\n            <option value=\"all\" ${teamAnalysisSettings.access === 'all' ? 'selected' : ''}>All Members - All project members can access</option>\n          </select>\n          <p class=\"admin-field-hint\">\n            <strong>Admins Only:</strong> Restricts access to sensitive behavioral analysis to project owner and administrators.<br>\n            <strong>All Members:</strong> Allows all project collaborators to view and run team analysis.\n          </p>\n        </div>\n      </div>\n\n      <!-- Analysis Scope Info -->\n      <div class=\"admin-card\">\n        <h4>How It Works</h4>\n        <div class=\"admin-steps-grid\">\n          <div class=\"admin-step-row\">\n            <div class=\"admin-step-num\">1</div>\n            <div>\n              <div class=\"admin-step-title\">Contact-Based Analysis</div>\n              <div class=\"admin-step-desc\">Analysis is performed on contacts defined in the project. Contacts can have aliases to match different name variations in transcripts.</div>\n            </div>\n          </div>\n          <div class=\"admin-step-row\">\n            <div class=\"admin-step-num\">2</div>\n            <div>\n              <div class=\"admin-step-title\">Incremental Learning</div>\n              <div class=\"admin-step-desc\">Profiles are refined iteratively as more transcripts are processed, building evidence over time.</div>\n            </div>\n          </div>\n          <div class=\"admin-step-row\">\n            <div class=\"admin-step-num\">3</div>\n            <div>\n              <div class=\"admin-step-title\">Privacy Consideration</div>\n              <div class=\"admin-step-desc\">Behavioral analysis may contain sensitive insights. Configure access carefully.</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <button class=\"btn-primary admin-mt-2\" id=\"save-team-analysis\">Save Team Analysis Settings</button>\n    </div>\n  `;\n}\n\n/**\n * Render LLM Queue section\n */\nfunction renderQueueSection(): string {\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>LLM Processing Queue</h3>\n        <p>Monitor and control AI request processing - All requests are persisted in database</p>\n      </div>\n\n      <!-- Queue Status -->\n      <div class=\"admin-card\" id=\"queue-status-card\">\n        <div class=\"admin-card-header\">\n          <h4>Queue Status</h4>\n          <div class=\"admin-card-actions\">\n            <span id=\"db-status-badge\" class=\"badge admin-badge-sm\">DB: Checking...</span>\n            <button class=\"btn-sm\" id=\"refresh-queue-status\">‚Üª Refresh</button>\n          </div>\n        </div>\n        \n        <div id=\"queue-status-content\" class=\"admin-placeholder\">\n          Loading queue status...\n        </div>\n      </div>\n\n      <!-- Queue Controls -->\n      <div class=\"admin-card\">\n        <h4>Queue Controls</h4>\n        <p class=\"text-muted\">Control queue processing behavior</p>\n        \n        <div class=\"admin-actions-row\">\n          <button class=\"btn-primary\" id=\"queue-pause-btn\">‚è∏ Pause Queue</button>\n          <button class=\"btn-primary\" id=\"queue-resume-btn\">‚ñ∂ Resume Queue</button>\n          <button class=\"btn-secondary admin-btn-warning\" id=\"queue-clear-btn\">üóë Clear Queue</button>\n        </div>\n      </div>\n\n      <!-- Statistics -->\n      <div class=\"admin-card\">\n        <h4>Queue Statistics (Today)</h4>\n        <div id=\"queue-stats-content\" class=\"admin-stats-grid\">\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-primary\" id=\"stat-pending\">-</div>\n            <div class=\"admin-stat-label\">Pending</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-info\" id=\"stat-processing\">-</div>\n            <div class=\"admin-stat-label\">Processing</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-success\" id=\"stat-success\">-</div>\n            <div class=\"admin-stat-label\">Completed</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-error\" id=\"stat-failed\">-</div>\n            <div class=\"admin-stat-label\">Failed</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-warning\" id=\"stat-retry\">-</div>\n            <div class=\"admin-stat-label\">Retry Pending</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value\" id=\"stat-avg-time\">-</div>\n            <div class=\"admin-stat-label\">Avg Time (ms)</div>\n          </div>\n          <div class=\"stat-box admin-stat-box\">\n            <div class=\"admin-stat-value admin-stat-success\" id=\"stat-cost\">$-</div>\n            <div class=\"admin-stat-label\">Cost Today</div>\n          </div>\n        </div>\n      </div>\n\n      <!-- Queue Items -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Pending Items</h4>\n          <span id=\"pending-count\" class=\"text-muted\">0 items</span>\n        </div>\n        \n        <div id=\"queue-items-content\" class=\"admin-scroll-content admin-scroll-300\">\n          <div class=\"admin-placeholder\">\n            No items in queue\n          </div>\n        </div>\n      </div>\n\n      <!-- Failed Items (Retryable) -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Failed Items</h4>\n          <div class=\"admin-card-actions\">\n            <button class=\"btn-sm btn-primary\" id=\"retry-all-btn\">‚Üª Retry All</button>\n            <button class=\"btn-sm\" id=\"refresh-failed-btn\">‚Üª Refresh</button>\n          </div>\n        </div>\n        \n        <div id=\"failed-items-content\" class=\"admin-scroll-content admin-scroll-300\">\n          <div class=\"admin-placeholder\">\n            No failed items\n          </div>\n        </div>\n      </div>\n\n      <!-- Recent History -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Recent Processing History</h4>\n          <button class=\"btn-sm\" id=\"refresh-queue-history\">‚Üª Refresh</button>\n        </div>\n        \n        <div id=\"queue-history-content\" class=\"admin-scroll-content admin-scroll-400\">\n          <div class=\"admin-placeholder\">\n            Loading history...\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Load billing data\n */\nasync function loadBillingData(): Promise<void> {\n  // Guard is now in bindSectionEvents, so we just proceed with loading\n  // billingLoading is already set to true by caller\n  console.log('[AdminPanel] loadBillingData() starting...');\n\n  try {\n    // Load all data in parallel\n    console.log('[AdminPanel] Calling billing API...');\n    const [projects, config, tiersData, exchangeRate] = await Promise.all([\n      billingService.getAllProjectsBilling(),\n      billingService.getGlobalPricingConfig(),\n      billingService.getGlobalPricingTiers(),\n      billingService.getExchangeRateConfig()\n    ]);\n\n    console.log('[AdminPanel] API responses:', { projects, config, tiersData, exchangeRate });\n\n    billingProjects = projects;\n    globalPricingConfig = config;\n    globalPricingTiers = tiersData.tiers;\n    exchangeRateConfig = exchangeRate;\n    billingLoaded = true;\n\n    console.log('[AdminPanel] Loaded billing data:', {\n      projects: projects.length,\n      config: !!config,\n      tiers: tiersData.tiers.length,\n      exchangeRate: exchangeRate?.currentRate\n    });\n  } catch (error) {\n    console.error('[AdminPanel] Error loading billing data:', error);\n    toast.error('Failed to load billing data');\n  } finally {\n    billingLoading = false;\n  }\n}\n\n/**\n * Render Billing section\n */\nfunction renderBillingSection(): string {\n  // Show loading state\n  if (billingLoading && !billingLoaded) {\n    return `\n      <div class=\"admin-section\">\n        <div class=\"admin-section-header\">\n          <h3>Billing & Cost Control</h3>\n          <p>Manage project balances, pricing, and cost limits</p>\n        </div>\n        <div class=\"admin-card admin-loading-card\">\n          <div class=\"spinner\"></div>\n          <p class=\"admin-loading-p\">Loading billing data...</p>\n        </div>\n      </div>\n    `;\n  }\n\n  // Format tier display\n  const tiersDisplay = globalPricingTiers.length > 0\n    ? globalPricingTiers.map((tier, i) => {\n      const prevLimit = i > 0 ? globalPricingTiers[i - 1].token_limit : 0;\n      const fromStr = formatTokens(prevLimit || 0);\n      const toStr = tier.token_limit ? formatTokens(tier.token_limit) : '‚àû';\n      return `${tier.name || `Tier ${i + 1}`}: ${fromStr}-${toStr} tokens ‚Üí +${tier.markup_percent}%`;\n    }).join('<br>')\n    : 'No tiers configured (using fixed markup)';\n\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Billing & Cost Control</h3>\n        <p>Manage project balances, pricing, and cost limits</p>\n      </div>\n\n      <!-- Exchange Rate Configuration -->\n      <div class=\"admin-card\">\n        <h4 class=\"admin-h4-mb\">Exchange Rate (USD to EUR)</h4>\n        \n        <div class=\"admin-exchange-grid\">\n          <div>\n            <div class=\"form-group\">\n              <label class=\"admin-checkbox-label\">\n                <input type=\"checkbox\" id=\"exchange-rate-auto\" ${exchangeRateConfig?.auto !== false ? 'checked' : ''}>\n                <span>Automatic rate from API</span>\n              </label>\n              <small class=\"text-muted\">Fetches live USD/EUR rate daily</small>\n            </div>\n            \n            <div class=\"form-group ${exchangeRateConfig?.auto !== false ? 'hidden' : ''}\" id=\"manual-rate-group\">\n              <label>Manual Rate</label>\n              <input type=\"number\" id=\"exchange-rate-manual\" class=\"form-input\" \n                     value=\"${exchangeRateConfig?.manualRate ?? 0.92}\" min=\"0.01\" max=\"2\" step=\"0.001\">\n            </div>\n          </div>\n          \n          <div class=\"admin-rate-block\">\n            <div class=\"admin-rate-label\">Current Rate</div>\n            <div class=\"admin-rate-value\" id=\"current-rate-display\">\n              ${exchangeRateConfig?.currentRate?.toFixed(4) ?? '0.9200'}\n            </div>\n            <div class=\"admin-rate-meta\">\n              Source: <span id=\"rate-source\">${exchangeRateConfig?.source ?? 'default'}</span>\n              ${exchangeRateConfig?.lastUpdated ? `<br>Updated: ${new Date(exchangeRateConfig.lastUpdated).toLocaleString()}` : ''}\n            </div>\n            <button class=\"btn-sm btn-secondary admin-rate-refresh\" id=\"refresh-rate-btn\" ${exchangeRateConfig?.auto === false ? 'disabled' : ''}>\n              Refresh Rate\n            </button>\n          </div>\n        </div>\n        \n        <div class=\"admin-actions-end\">\n          <button class=\"btn-primary\" id=\"save-exchange-rate-btn\">Save Exchange Rate Settings</button>\n        </div>\n      </div>\n\n      <!-- Global Pricing Configuration -->\n      <div class=\"admin-card\">\n        <h4 class=\"admin-h4-mb\">Global Pricing Configuration</h4>\n        \n        <div class=\"admin-form-grid admin-form-grid-2\">\n          <div class=\"form-group\">\n            <label>Fixed Markup (%)</label>\n            <input type=\"number\" id=\"global-markup-percent\" class=\"form-input\" \n                   value=\"${globalPricingConfig?.fixed_markup_percent ?? 0}\" min=\"0\" max=\"500\" step=\"0.1\">\n            <small class=\"text-muted\">Applied when no tier matches</small>\n          </div>\n          \n          <div class=\"form-group\">\n            <label>Period Type</label>\n            <select id=\"global-period-type\" class=\"form-input\">\n              <option value=\"monthly\" ${globalPricingConfig?.period_type === 'monthly' ? 'selected' : ''}>Monthly</option>\n              <option value=\"weekly\" ${globalPricingConfig?.period_type === 'weekly' ? 'selected' : ''}>Weekly</option>\n            </select>\n            <small class=\"text-muted\">Tier reset period</small>\n          </div>\n        </div>\n        \n        <div class=\"admin-actions-end\">\n          <button class=\"btn-primary\" id=\"save-global-pricing-btn\">Save Global Pricing</button>\n        </div>\n      </div>\n      \n      <!-- Pricing Tiers -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <div>\n            <h4>Pricing Tiers (Volume Discount)</h4>\n            <p class=\"text-muted admin-subtitle\">\n              Lower markup as projects consume more tokens per period\n            </p>\n          </div>\n          <button class=\"btn-sm btn-primary\" id=\"add-tier-btn\">+ Add Tier</button>\n        </div>\n        \n        <div id=\"pricing-tiers-list\">\n          ${globalPricingTiers.length > 0 ? globalPricingTiers.map((tier, i) => `\n            <div class=\"tier-row admin-tier-row\" data-tier-index=\"${i}\">\n              <input type=\"text\" class=\"form-input tier-name\" placeholder=\"Tier Name\" value=\"${tier.name || `Tier ${i + 1}`}\">\n              <input type=\"number\" class=\"form-input tier-limit\" placeholder=\"Token Limit\" value=\"${tier.token_limit || ''}\" min=\"0\" ${tier.token_limit === null ? 'disabled' : ''}>\n              <div class=\"admin-tier-markup-wrap\">\n                <input type=\"number\" class=\"form-input tier-markup\" placeholder=\"Markup %\" value=\"${tier.markup_percent}\" min=\"0\" step=\"0.1\">\n                <span>%</span>\n              </div>\n              <div class=\"admin-tier-actions\">\n                <label class=\"admin-tier-unlimited-label\">\n                  <input type=\"checkbox\" class=\"tier-unlimited\" ${tier.token_limit === null ? 'checked' : ''}>\n                  Unlimited\n                </label>\n                <button class=\"btn-sm btn-danger remove-tier-btn\" data-index=\"${i}\">‚úï</button>\n              </div>\n            </div>\n          `).join('') : `\n            <div class=\"admin-placeholder\">\n              No tiers configured. Using fixed markup of ${globalPricingConfig?.fixed_markup_percent ?? 0}% for all usage.\n            </div>\n          `}\n        </div>\n        \n        ${globalPricingTiers.length > 0 ? `\n          <div class=\"admin-actions-end admin-mt-4\">\n            <button class=\"btn-primary\" id=\"save-tiers-btn\">Save Tiers</button>\n          </div>\n        ` : ''}\n      </div>\n\n      <!-- Projects Billing Overview -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <div>\n            <h4>Projects Billing</h4>\n            <p class=\"text-muted admin-subtitle\">\n              ${billingProjects.length} projects | \n              ${billingProjects.filter(p => p.is_blocked).length} blocked | \n              ${billingProjects.filter(p => p.unlimited_balance).length} unlimited\n            </p>\n          </div>\n          <button class=\"btn-sm\" id=\"refresh-billing-btn\">‚Üª Refresh</button>\n        </div>\n        \n        <div class=\"admin-table-wrap\">\n          <table class=\"data-table admin-data-table\">\n            <thead>\n              <tr>\n                <th class=\"admin-th-left\">Project</th>\n                <th class=\"admin-th-right\">Balance</th>\n                <th class=\"admin-th-center\">Status</th>\n                <th class=\"admin-th-right\">Tokens (Period)</th>\n                <th class=\"admin-th-right\">Cost (Period)</th>\n                <th class=\"admin-th-center\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${billingProjects.length > 0 ? billingProjects.map(p => `\n                <tr class=\"admin-tr\">\n                  <td class=\"admin-td admin-td-project\">\n                    <div class=\"admin-td-project-name\">${escapeHtml(p.project_name)}</div>\n                    ${p.current_tier_name ? `<small class=\"text-muted\">Tier: ${p.current_tier_name}</small>` : ''}\n                  </td>\n                  <td class=\"admin-td admin-td-right\">\n                    ${p.unlimited_balance\n      ? '<span class=\"admin-unlimited\">‚àû Unlimited</span>'\n      : formatEur(p.balance_eur)}\n                  </td>\n                  <td class=\"admin-td admin-td-center\">\n                    ${p.is_blocked\n      ? '<span class=\"badge badge-danger\">Blocked</span>'\n      : p.unlimited_balance\n        ? '<span class=\"badge badge-success\">Unlimited</span>'\n        : '<span class=\"badge badge-primary\">Active</span>'}\n                  </td>\n                  <td class=\"admin-td admin-td-right\">${formatTokens(p.tokens_this_period)}</td>\n                  <td class=\"admin-td admin-td-right\">${formatEur(p.billable_cost_this_period)}</td>\n                  <td class=\"admin-td admin-td-center\">\n                    <div class=\"admin-td-actions\">\n                      <button class=\"btn-sm add-balance-btn\" data-project-id=\"${p.project_id}\" data-project-name=\"${escapeHtml(p.project_name)}\" title=\"Add Balance\">üí∞</button>\n                      <button class=\"btn-sm toggle-unlimited-btn\" data-project-id=\"${p.project_id}\" data-unlimited=\"${p.unlimited_balance}\" title=\"${p.unlimited_balance ? 'Disable Unlimited' : 'Enable Unlimited'}\">\n                        ${p.unlimited_balance ? 'üîì' : 'üîí'}\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              `).join('') : `\n                <tr>\n                  <td colspan=\"6\" class=\"admin-placeholder\">\n                    No projects found\n                  </td>\n                </tr>\n              `}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Escape HTML for safe rendering\n */\nfunction escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Render Audit Log section\n */\nfunction renderAuditSection(): string {\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>Configuration Audit Log</h3>\n        <p>Track all configuration changes</p>\n      </div>\n\n      <div class=\"admin-card\">\n        <div class=\"audit-filters\">\n          <select id=\"audit-filter-table\" class=\"form-select\">\n            <option value=\"\">All Tables</option>\n            <option value=\"system_config\">System Config</option>\n            <option value=\"project_config\">Project Config</option>\n            <option value=\"secrets\">Secrets</option>\n          </select>\n          <button class=\"btn-secondary\" id=\"refresh-audit\">Refresh</button>\n        </div>\n\n        <div class=\"audit-log-list\">\n          ${auditLogs.length === 0 ? `\n            <div class=\"empty-state\">\n              <p>No audit logs found</p>\n            </div>\n          ` : auditLogs.map(log => `\n            <div class=\"audit-log-item\">\n              <div class=\"audit-log-header\">\n                <span class=\"audit-operation ${log.operation.toLowerCase()}\">${log.operation}</span>\n                <span class=\"audit-table\">${log.table_name}</span>\n                <span class=\"audit-time\">${new Date(log.changed_at).toLocaleString()}</span>\n              </div>\n              <div class=\"audit-log-details\">\n                <span class=\"audit-user\">${log.changed_by_email || 'System'}</span>\n                ${log.new_values ? `<pre class=\"audit-values\">${JSON.stringify(log.new_values, null, 2)}</pre>` : ''}\n              </div>\n            </div>\n          `).join('')}\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render Model Metadata section\n */\nfunction renderModelsSection(): string {\n  return `\n    <div class=\"admin-section\">\n      <div class=\"admin-section-header\">\n        <h3>LLM Model Metadata</h3>\n        <p>Manage model information, pricing, and capabilities from database</p>\n      </div>\n      \n      <!-- Sync Controls -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Sync Model Metadata</h4>\n          <button class=\"btn btn-primary\" id=\"sync-all-metadata-btn\">\n            ‚Üª Sync All Providers\n          </button>\n        </div>\n        <p class=\"admin-desc admin-mb-4\">\n          Fetch the latest model list from each configured provider API and update the database with current models and capabilities.\n          Pricing information is updated from known sources.\n        </p>\n        \n        <div id=\"metadata-sync-status\" class=\"admin-mb-4\">\n          <div class=\"admin-placeholder\">\n            Loading sync status...\n          </div>\n        </div>\n        \n        <div id=\"metadata-sync-result\" class=\"hidden\"></div>\n      </div>\n      \n      <!-- Provider Status -->\n      <div class=\"admin-card\">\n        <h4 class=\"admin-h4-mb\">Provider Model Count</h4>\n        <div id=\"provider-model-counts\">\n          <div class=\"admin-placeholder\">\n            Loading...\n          </div>\n        </div>\n      </div>\n      \n      <!-- Model Browser -->\n      <div class=\"admin-card\">\n        <div class=\"admin-card-header\">\n          <h4>Browse Models</h4>\n          <div class=\"admin-card-actions\">\n            <select id=\"browse-provider-select\" class=\"form-select admin-select-min\">\n              <option value=\"\">Select Provider</option>\n              <option value=\"openai\">OpenAI</option>\n              <option value=\"anthropic\">Anthropic</option>\n              <option value=\"google\">Google</option>\n              <option value=\"grok\">Grok (xAI)</option>\n              <option value=\"deepseek\">DeepSeek</option>\n            </select>\n            <button class=\"btn btn-secondary\" id=\"browse-models-btn\">Load Models</button>\n          </div>\n        </div>\n        \n        <div id=\"models-browser-content\">\n          <div class=\"admin-empty-state\">\n            Select a provider to browse available models\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Render current section content\n */\nfunction renderSectionContent(): string {\n  switch (currentSection) {\n    case 'llm':\n      return renderLLMSection();\n    case 'models':\n      return renderModelsSection();\n    case 'graph':\n      return renderGraphSection();\n    case 'ontology':\n      return renderOntologySection();\n    case 'queue':\n      return renderQueueSection();\n    case 'prompts':\n      return renderPromptsSection();\n    case 'processing':\n      return renderProcessingSection();\n    case 'team-analysis':\n      return renderTeamAnalysisSection();\n    case 'google-drive':\n      return renderGoogleDriveSection();\n    case 'billing':\n      return renderBillingSection();\n    case 'audit':\n      return renderAuditSection();\n    default:\n      return renderLLMSection();\n  }\n}\n\n/**\n * Bind section-specific events\n */\nfunction bindSectionEvents(container: HTMLElement): void {\n  // Nav buttons\n  container.querySelectorAll('.admin-nav-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const newSection = btn.getAttribute('data-section') || 'llm';\n      currentSection = newSection;\n\n      // Load Team Analysis settings when switching to that section\n      if (newSection === 'team-analysis') {\n        teamAnalysisLoaded = false;\n        teamAnalysisLoading = false;\n        renderAdminPanel(container);\n        await loadTeamAnalysisSettings();\n        renderAdminPanel(container);\n      } else if (newSection === 'google-drive') {\n        googleDriveLoaded = false;\n        renderAdminPanel(container);\n        await loadGoogleDriveState();\n        renderAdminPanel(container);\n      } else if (newSection === 'billing') {\n        // Load billing data\n        if (!billingLoaded && !billingLoading) {\n          billingLoading = true;        // Set loading flag BEFORE rendering\n          renderAdminPanel(container);  // Show loading state\n          await loadBillingData();      // Load data (guard removed, just loads)\n          renderAdminPanel(container);  // Re-render with data\n        } else {\n          renderAdminPanel(container);\n        }\n      } else {\n        renderAdminPanel(container);\n      }\n    });\n  });\n\n  // Toggle visibility buttons\n  container.querySelectorAll('[data-toggle-visibility]').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const inputId = btn.getAttribute('data-toggle-visibility');\n      if (inputId) {\n        const input = container.querySelector(`#${inputId}`) as HTMLInputElement;\n        if (input) {\n          input.type = input.type === 'password' ? 'text' : 'password';\n          (btn as HTMLElement).textContent = input.type === 'password' ? 'Show' : 'Hide';\n        }\n      }\n    });\n  });\n\n  // Test provider buttons\n  container.querySelectorAll('[data-test-provider]').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const providerId = btn.getAttribute('data-test-provider');\n      if (providerId) {\n        (btn as HTMLElement).textContent = 'Testing...';\n        await testProvider(providerId);\n        (btn as HTMLElement).textContent = 'Test';\n      }\n    });\n  });\n\n  // Cache for loaded models by provider\n  const modelsCache: Record<string, { textModels: string[]; visionModels: string[]; embeddingModels: string[] }> = {};\n\n  // Load models for a provider\n  async function loadModelsForProvider(providerId: string, taskType: string): Promise<void> {\n    const modelSelect = container.querySelector(`select.model-select[data-task=\"${taskType}\"]`) as HTMLSelectElement;\n    const loadingSpan = container.querySelector(`.model-loading[data-task=\"${taskType}\"]`) as HTMLElement;\n    const statusDiv = container.querySelector(`.model-status[data-task=\"${taskType}\"]`) as HTMLElement;\n\n    if (!modelSelect || !providerId) {\n      if (modelSelect) {\n        modelSelect.innerHTML = '<option value=\"\">-- Select Provider First --</option>';\n      }\n      return;\n    }\n\n    // Show loading state\n    if (loadingSpan) loadingSpan.classList.remove('hidden');\n    modelSelect.disabled = true;\n\n    try {\n      // Check cache first\n      if (!modelsCache[providerId]) {\n        const response = await http.get<{ textModels: Array<{ id: string; name?: string }>; visionModels: Array<{ id: string; name?: string }>; embeddingModels: Array<{ id: string; name?: string }> }>(`/api/llm/models?provider=${providerId}`);\n        modelsCache[providerId] = {\n          textModels: (response.data.textModels || []).map(m => m.id || m.name || '').filter(Boolean),\n          visionModels: (response.data.visionModels || []).map(m => m.id || m.name || '').filter(Boolean),\n          embeddingModels: (response.data.embeddingModels || []).map(m => m.id || m.name || '').filter(Boolean)\n        };\n      }\n\n      // Determine which models to show based on task type\n      let models: string[] = [];\n      if (taskType === 'text') models = modelsCache[providerId].textModels;\n      else if (taskType === 'vision') models = modelsCache[providerId].visionModels;\n      else if (taskType === 'embeddings') models = modelsCache[providerId].embeddingModels;\n\n      // Get current selected value\n      const currentValue = modelSelect.value;\n\n      // Populate dropdown\n      modelSelect.innerHTML = '<option value=\"\">-- Select Model --</option>' +\n        models.map(m => `<option value=\"${m}\"${m === currentValue ? ' selected' : ''}>${m}</option>`).join('');\n\n      // Update status\n      if (statusDiv) {\n        statusDiv.textContent = models.length > 0\n          ? `${models.length} model(s) available`\n          : 'No models found for this task type. Check provider configuration.';\n        statusDiv.classList.remove('admin-status-success', 'admin-status-warning', 'admin-status-error');\n        statusDiv.classList.add(models.length > 0 ? 'admin-status-success' : 'admin-status-warning');\n      }\n\n    } catch (error) {\n      console.error(`Failed to load models for ${providerId}:`, error);\n      modelSelect.innerHTML = '<option value=\"\">Error loading models</option>';\n      if (statusDiv) {\n        statusDiv.textContent = 'Failed to load models. Check API key configuration.';\n        statusDiv.classList.remove('admin-status-success', 'admin-status-warning');\n        statusDiv.classList.add('admin-status-error');\n      }\n    } finally {\n      if (loadingSpan) loadingSpan.classList.add('hidden');\n      modelSelect.disabled = false;\n    }\n  }\n\n  // Provider change handler - load models dynamically\n  container.querySelectorAll('select.provider-select').forEach(select => {\n    on(select as HTMLElement, 'change', async () => {\n      const task = select.getAttribute('data-task');\n      const provider = (select as HTMLSelectElement).value;\n      if (task) {\n        await loadModelsForProvider(provider, task);\n      }\n    });\n\n    // Initial load if provider is already selected\n    const task = select.getAttribute('data-task');\n    const provider = (select as HTMLSelectElement).value;\n    if (task && provider) {\n      loadModelsForProvider(provider, task);\n    }\n  });\n\n  // Save LLM config\n  const saveLLMBtn = container.querySelector('#save-llm-config');\n  if (saveLLMBtn) {\n    on(saveLLMBtn as HTMLElement, 'click', async () => {\n      const taskConfigs: Record<string, { provider: string; model: string }> = {};\n\n      container.querySelectorAll('select[data-task]').forEach(el => {\n        const task = el.getAttribute('data-task')!;\n        const field = el.getAttribute('data-field')!;\n\n        if (!taskConfigs[task]) {\n          taskConfigs[task] = { provider: '', model: '' };\n        }\n\n        taskConfigs[task][field as 'provider' | 'model'] = (el as HTMLSelectElement).value;\n      });\n\n      try {\n        for (const [task, config] of Object.entries(taskConfigs)) {\n          if (config.provider) {\n            await saveConfig(`${task}_provider`, config, 'llm');\n          }\n        }\n        toast.success('LLM configuration saved to Supabase');\n      } catch (error) {\n        toast.error('Failed to save LLM configuration');\n      }\n    });\n  }\n\n  // Load existing API keys status\n  async function loadApiKeysStatus(): Promise<void> {\n    const loadingEl = container.querySelector('#api-keys-loading') as HTMLElement;\n    try {\n      const response = await http.get<{ success: boolean; secrets: Array<{ name: string; masked_value: string; is_valid: boolean }> }>('/api/secrets');\n      if (response.data?.success && response.data.secrets) {\n        for (const secret of response.data.secrets) {\n          const formGroup = container.querySelector(`[data-secret-name=\"${secret.name}\"]`);\n          if (formGroup) {\n            const statusSpan = formGroup.querySelector('.key-status') as HTMLElement;\n            const input = formGroup.querySelector('input') as HTMLInputElement;\n            if (statusSpan) {\n              if (secret.masked_value) {\n                statusSpan.textContent = '‚úì Configured';\n                statusSpan.classList.add('admin-status-success');\n                if (input) {\n                  input.placeholder = secret.masked_value;\n                }\n              }\n            }\n          }\n        }\n      }\n    } catch (error) {\n      console.warn('Failed to load API keys status:', error);\n    } finally {\n      if (loadingEl) loadingEl.classList.add('hidden');\n    }\n  }\n\n  // Load API keys status on render\n  loadApiKeysStatus();\n\n  // Save LLM API keys\n  const saveKeysBtn = container.querySelector('#save-api-keys');\n  if (saveKeysBtn) {\n    on(saveKeysBtn as HTMLElement, 'click', async () => {\n      const keys = [\n        { id: 'openai-key', name: 'OPENAI_API_KEY' },\n        { id: 'anthropic-key', name: 'CLAUDE_API_KEY' },\n        { id: 'google-key', name: 'GOOGLE_API_KEY' },\n        { id: 'xai-key', name: 'XAI_API_KEY' },\n        { id: 'deepseek-key', name: 'DEEPSEEK_API_KEY' },\n        { id: 'kimi-key', name: 'KIMI_API_KEY' },\n        { id: 'minimax-key', name: 'MINIMAX_API_KEY' },\n      ];\n\n      try {\n        let savedCount = 0;\n        for (const key of keys) {\n          const value = (container.querySelector(`#${key.id}`) as HTMLInputElement)?.value;\n          if (value && value.trim()) {\n            await http.post('/api/secrets', { name: key.name, value: value.trim(), scope: 'system' });\n            savedCount++;\n          }\n        }\n        if (savedCount > 0) {\n          toast.success(`${savedCount} API key(s) saved securely`);\n        } else {\n          toast.info('No API keys to save');\n        }\n      } catch (error) {\n        toast.error('Failed to save API keys');\n      }\n    });\n  }\n\n  // Save service API keys\n  const saveServiceKeysBtn = container.querySelector('#save-service-keys');\n  if (saveServiceKeysBtn) {\n    on(saveServiceKeysBtn as HTMLElement, 'click', async () => {\n      const resendKey = (container.querySelector('#resend-key') as HTMLInputElement)?.value;\n      const braveKey = (container.querySelector('#brave-key') as HTMLInputElement)?.value;\n\n      try {\n        let saved = 0;\n        if (resendKey && resendKey.trim()) {\n          await http.post('/api/secrets', { name: 'RESEND_API_KEY', value: resendKey.trim(), scope: 'system' });\n          saved++;\n        }\n        if (braveKey && braveKey.trim()) {\n          await http.post('/api/secrets', { name: 'BRAVE_API_KEY', value: braveKey.trim(), scope: 'system' });\n          saved++;\n        }\n        if (saved > 0) {\n          toast.success('Service API key(s) saved securely');\n        } else {\n          toast.info('No service keys to save');\n        }\n      } catch (error: unknown) {\n        const msg = (error as { message?: string })?.message;\n        toast.error(msg && typeof msg === 'string' ? msg : 'Failed to save service keys');\n      }\n    });\n  }\n\n  // ============ Queue Section Handlers ============\n\n  // Load queue status\n  // Interface for queue data\n  interface QueueStatusData {\n    isProcessing: boolean;\n    isPaused: boolean;\n    queueLength: number;\n    currentRequest: { id: string; context: string; priority: string; startedAt: string } | null;\n    stats: { total: number; successful: number; failed: number; avgProcessingTime: number };\n    pendingItems: Array<{ id: string; context: string; priority: string; queuedAt: string }>;\n    database?: {\n      pendingCount: number;\n      processingCount: number;\n      retryPendingCount: number;\n      completedToday: number;\n      failedToday: number;\n      avgProcessingTimeMs: number;\n      totalCostTodayUsd: number;\n    };\n  }\n\n  async function loadQueueStatus(): Promise<void> {\n    const statusContent = container.querySelector('#queue-status-content');\n    const itemsContent = container.querySelector('#queue-items-content');\n    const pendingCount = container.querySelector('#pending-count');\n    const dbStatusBadge = container.querySelector('#db-status-badge');\n\n    try {\n      const response = await http.get<QueueStatusData>('/api/llm/queue/status');\n      const data = response.data;\n\n      // Update DB status badge\n      if (dbStatusBadge) {\n        if (data.database) {\n          dbStatusBadge.className = 'badge badge-success';\n          dbStatusBadge.textContent = 'DB: Connected';\n        } else {\n          dbStatusBadge.className = 'badge badge-warning';\n          dbStatusBadge.textContent = 'DB: Memory Only';\n        }\n      }\n\n      // Update status\n      if (statusContent) {\n        const statusColor = data.isPaused ? 'var(--warning)' : (data.isProcessing ? 'var(--success)' : 'var(--text-tertiary)');\n        const statusText = data.isPaused ? '‚è∏ PAUSED' : (data.isProcessing ? 'üîÑ PROCESSING' : '‚úì IDLE');\n\n        statusContent.innerHTML = `\n          <div class=\"admin-queue-status-grid\">\n            <div class=\"admin-queue-stat\">\n              <div class=\"admin-queue-stat-value\" style=\"--queue-stat-color: ${statusColor}\">${statusText}</div>\n              <div class=\"admin-queue-stat-label\">Queue Status</div>\n            </div>\n            <div class=\"admin-queue-stat\">\n              <div class=\"admin-queue-stat-value\">${data.queueLength}</div>\n              <div class=\"admin-queue-stat-label\">Items in Queue</div>\n            </div>\n            <div class=\"admin-queue-stat\">\n              <div class=\"admin-queue-stat-value admin-queue-stat-primary\">${data.isProcessing ? '1' : '0'}</div>\n              <div class=\"admin-queue-stat-label\">Processing Now</div>\n            </div>\n          </div>\n          ${data.currentRequest ? `\n            <div class=\"admin-queue-current-box\">\n              <strong>Currently Processing:</strong> ${data.currentRequest.context || 'Unknown'} \n              <span class=\"admin-queue-current-meta\">(Priority: ${data.currentRequest.priority})</span>\n              <span class=\"admin-queue-current-meta admin-queue-current-time\">Started: ${new Date(data.currentRequest.startedAt).toLocaleTimeString()}</span>\n            </div>\n          ` : ''}\n        `;\n      }\n\n      // Update pending items\n      if (itemsContent && pendingCount) {\n        const pendingLen = data.pendingItems?.length || 0;\n        pendingCount.textContent = `${pendingLen} items`;\n\n        if (pendingLen > 0) {\n          itemsContent.innerHTML = `\n            <table class=\"admin-queue-table admin-queue-table-sm\">\n              <thead>\n                <tr>\n                  <th class=\"admin-queue-th\">Context</th>\n                  <th class=\"admin-queue-th\">Priority</th>\n                  <th class=\"admin-queue-th\">Queued</th>\n                  <th class=\"admin-queue-th\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${data.pendingItems.map(item => `\n                  <tr>\n                    <td class=\"admin-queue-td\">${item.context || 'Unknown'}</td>\n                    <td class=\"admin-queue-td\"><span class=\"badge badge-${item.priority}\">${item.priority}</span></td>\n                    <td class=\"admin-queue-td\">${new Date(item.queuedAt).toLocaleTimeString()}</td>\n                    <td class=\"admin-queue-td\"><button class=\"btn-sm btn-danger\" data-cancel-item=\"${item.id}\">Cancel</button></td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          itemsContent.innerHTML = '<div class=\"admin-placeholder\">No items in queue</div>';\n        }\n      }\n\n      // Update stats\n      const db = data.database;\n      const statPending = container.querySelector('#stat-pending');\n      const statProcessing = container.querySelector('#stat-processing');\n      const statSuccess = container.querySelector('#stat-success');\n      const statFailed = container.querySelector('#stat-failed');\n      const statRetry = container.querySelector('#stat-retry');\n      const statAvgTime = container.querySelector('#stat-avg-time');\n      const statCost = container.querySelector('#stat-cost');\n\n      if (statPending) statPending.textContent = String(db?.pendingCount || data.queueLength || 0);\n      if (statProcessing) statProcessing.textContent = String(db?.processingCount || (data.isProcessing ? 1 : 0));\n      if (statSuccess) statSuccess.textContent = String(db?.completedToday || data.stats?.successful || 0);\n      if (statFailed) statFailed.textContent = String(db?.failedToday || data.stats?.failed || 0);\n      if (statRetry) statRetry.textContent = String(db?.retryPendingCount || 0);\n      if (statAvgTime) statAvgTime.textContent = String(Math.round(db?.avgProcessingTimeMs || data.stats?.avgProcessingTime || 0));\n      if (statCost) statCost.textContent = `$${(db?.totalCostTodayUsd || 0).toFixed(4)}`;\n\n    } catch (error) {\n      console.error('Failed to load queue status:', error);\n      if (statusContent) {\n        statusContent.innerHTML = '<div class=\"admin-error-msg\">Failed to load queue status</div>';\n      }\n    }\n  }\n\n  // Load queue history\n  async function loadQueueHistory(): Promise<void> {\n    const historyContent = container.querySelector('#queue-history-content');\n\n    try {\n      const response = await http.get<{\n        history: Array<{\n          id: string;\n          context: string;\n          priority: string;\n          status: string;\n          processingTime: number;\n          completedAt: string;\n          provider?: string;\n          model?: string;\n          inputTokens?: number;\n          outputTokens?: number;\n          estimatedCost?: number;\n          error?: string;\n        }>;\n      }>('/api/llm/queue/history?limit=50');\n\n      const history = response.data?.history || [];\n\n      if (historyContent) {\n        if (history.length > 0) {\n          historyContent.innerHTML = `\n            <table class=\"admin-queue-table\">\n              <thead>\n                <tr>\n                  <th class=\"admin-queue-th\">Context</th>\n                  <th class=\"admin-queue-th\">Provider/Model</th>\n                  <th class=\"admin-queue-th\">Status</th>\n                  <th class=\"admin-queue-th\">Tokens</th>\n                  <th class=\"admin-queue-th\">Time</th>\n                  <th class=\"admin-queue-th\">Completed</th>\n                  <th class=\"admin-queue-th\">Details</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${history.map(item => `\n                  <tr>\n                    <td class=\"admin-queue-td admin-queue-td-ellipsis\" title=\"${item.context || ''}\">${item.context || 'Unknown'}</td>\n                    <td class=\"admin-queue-td admin-queue-td-sm\">${item.provider || '-'}/${item.model || '-'}</td>\n                    <td class=\"admin-queue-td\">\n                      <span class=\"admin-queue-status-dot admin-queue-status-${item.status === 'completed' ? 'ok' : 'err'}\">${item.status === 'completed' ? '‚úì' : '‚úó'}</span>\n                      ${item.error ? `<span class=\"admin-queue-error-hint\" title=\"${item.error}\">Error</span>` : ''}\n                    </td>\n                    <td class=\"admin-queue-td admin-queue-td-sm\">${item.inputTokens || '-'}/${item.outputTokens || '-'}</td>\n                    <td class=\"admin-queue-td\">${item.processingTime || '-'}ms</td>\n                    <td class=\"admin-queue-td admin-queue-td-sm\">${item.completedAt ? new Date(item.completedAt).toLocaleString() : '-'}</td>\n                    <td class=\"admin-queue-td\"><button class=\"btn-sm\" data-view-request=\"${item.id}\">View</button></td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          historyContent.innerHTML = '<div class=\"admin-placeholder\">No processing history yet</div>';\n        }\n      }\n    } catch (error) {\n      console.error('Failed to load queue history:', error);\n      if (historyContent) {\n        historyContent.innerHTML = '<div class=\"admin-error-msg\">Failed to load history</div>';\n      }\n    }\n  }\n\n  // Show request details modal\n  async function showRequestDetails(requestId: string): Promise<void> {\n    try {\n      const response = await http.get<{\n        success: boolean;\n        request: {\n          id: string;\n          context: string;\n          request_type: string;\n          provider: string;\n          model: string;\n          status: string;\n          priority: string;\n          input_data: Record<string, unknown>;\n          output_data: Record<string, unknown> | null;\n          output_text: string | null;\n          input_tokens: number | null;\n          output_tokens: number | null;\n          total_tokens: number | null;\n          estimated_cost_usd: number | null;\n          processing_time_ms: number | null;\n          attempt_count: number;\n          max_attempts: number;\n          last_error: string | null;\n          error_details: Record<string, unknown> | null;\n          queued_at: string;\n          started_at: string | null;\n          completed_at: string | null;\n        };\n      }>(`/api/llm/queue/${requestId}`);\n\n      if (!response.data.success || !response.data.request) {\n        toast.error('Request not found');\n        return;\n      }\n\n      const req = response.data.request;\n\n      // Escape HTML in strings to prevent XSS and template breaking\n      const escapeHtml = (str: string | null | undefined): string => {\n        if (!str) return '';\n        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n      };\n\n      // Format JSON with syntax highlighting\n      const formatJsonHtml = (obj: unknown): string => {\n        const json = JSON.stringify(obj, null, 2);\n        return escapeHtml(json)\n          .replace(/\"([^\"]+)\":/g, '<span class=\"hl-json-key\">\"$1\"</span>:')\n          .replace(/: \"([^\"]*)\"/g, ': <span class=\"hl-json-string\">\"$1\"</span>')\n          .replace(/: (\\d+)/g, ': <span class=\"hl-json-num\">$1</span>')\n          .replace(/: (true|false|null)/g, ': <span class=\"hl-json-bool\">$1</span>');\n      };\n\n      // Format prompt text for readability\n      const formatPromptText = (text: string | null | undefined): string => {\n        if (!text) return '<span class=\"hl-prompt-empty\">(No content)</span>';\n        return escapeHtml(text)\n          .replace(/\\\\n/g, '\\n')\n          .replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>')\n          .replace(/^(#{1,3})\\s*(.+)$/gm, '<span class=\"hl-prompt-heading\">$2</span>')\n          .replace(/^[-‚Ä¢]\\s*(.+)$/gm, '  ‚Ä¢ $1')\n          .replace(/---+/g, '<hr class=\"hl-prompt-hr\">');\n      };\n\n      // Get status color and icon\n      const getStatusInfo = (status: string) => {\n        const statusMap: Record<string, { color: string; icon: string; bg: string }> = {\n          completed: { color: 'var(--success)', icon: '‚úì', bg: 'rgba(34, 197, 94, 0.1)' },\n          failed: { color: 'var(--error)', icon: '‚úó', bg: 'rgba(239, 68, 68, 0.1)' },\n          processing: { color: 'var(--warning)', icon: '‚ü≥', bg: 'rgba(234, 179, 8, 0.1)' },\n          pending: { color: 'var(--text-secondary)', icon: '‚óã', bg: 'var(--bg-tertiary)' },\n          retry_pending: { color: 'var(--warning)', icon: '‚Üª', bg: 'rgba(234, 179, 8, 0.1)' },\n          cancelled: { color: 'var(--text-tertiary)', icon: '‚äò', bg: 'var(--bg-tertiary)' }\n        };\n        return statusMap[status] || { color: 'var(--text-primary)', icon: '?', bg: 'var(--bg-secondary)' };\n      };\n\n      const statusInfo = getStatusInfo(req.status);\n      const inputData = (req.input_data || {}) as Record<string, unknown>;\n      const messages = inputData.messages as Array<{ content?: string }> | undefined;\n      const promptText = (inputData.prompt as string) || messages?.[0]?.content || '';\n\n      // Create modal - using unique ID to avoid duplicates\n      const existingModal = document.getElementById('llm-request-details-modal');\n      if (existingModal) {\n        existingModal.remove();\n      }\n\n      const modal = document.createElement('div');\n      modal.id = 'llm-request-details-modal';\n      modal.className = 'modal open';\n      modal.className = 'modal open admin-llm-modal-overlay';\n      modal.innerHTML = `\n        <div class=\"modal-content admin-llm-modal-content\">\n          <div class=\"modal-header\">\n            <div class=\"admin-llm-modal-header-inner\">\n              <span class=\"admin-llm-modal-icon\" style=\"--status-bg: ${statusInfo.bg}; --status-color: ${statusInfo.color}\">${statusInfo.icon}</span>\n              <div>\n                <h3 class=\"admin-llm-modal-title\">LLM Request Details</h3>\n                <span class=\"admin-llm-modal-id\">ID: ${req.id}</span>\n              </div>\n            </div>\n            <button class=\"modal-close\">&times;</button>\n          </div>\n          \n          <div class=\"modal-body admin-llm-modal-body\">\n            <div class=\"admin-llm-status-bar\">\n              <div class=\"admin-llm-status-item\">\n                <div class=\"admin-llm-status-label\">Context</div>\n                <div class=\"admin-llm-status-value admin-llm-status-accent\">${req.context || 'Unknown'}</div>\n              </div>\n              <div class=\"admin-llm-status-item\">\n                <div class=\"admin-llm-status-label\">Provider</div>\n                <div class=\"admin-llm-status-value\">${req.provider || '-'}</div>\n              </div>\n              <div class=\"admin-llm-status-item\">\n                <div class=\"admin-llm-status-label\">Model</div>\n                <div class=\"admin-llm-status-value admin-llm-status-mono\">${req.model || '-'}</div>\n              </div>\n              <div class=\"admin-llm-status-item\">\n                <div class=\"admin-llm-status-label\">Status</div>\n                <div class=\"admin-llm-status-badge\" style=\"--status-bg: ${statusInfo.bg}; --status-color: ${statusInfo.color}\">${statusInfo.icon} ${req.status}</div>\n              </div>\n            </div>\n            \n            <div class=\"admin-llm-metrics-grid\">\n              <div class=\"admin-llm-metric-box\">\n                <div class=\"admin-llm-metric-value\">${req.input_tokens?.toLocaleString() || '-'}</div>\n                <div class=\"admin-llm-metric-label\">Input Tokens</div>\n              </div>\n              <div class=\"admin-llm-metric-box\">\n                <div class=\"admin-llm-metric-value\">${req.output_tokens?.toLocaleString() || '-'}</div>\n                <div class=\"admin-llm-metric-label\">Output Tokens</div>\n              </div>\n              <div class=\"admin-llm-metric-box\">\n                <div class=\"admin-llm-metric-value\">${req.processing_time_ms ? `${(req.processing_time_ms / 1000).toFixed(1)}s` : '-'}</div>\n                <div class=\"admin-llm-metric-label\">Duration</div>\n              </div>\n              <div class=\"admin-llm-metric-box\">\n                <div class=\"admin-llm-metric-value admin-llm-metric-cost${req.estimated_cost_usd ? ' admin-llm-metric-has-cost' : ''}\">$${req.estimated_cost_usd?.toFixed(4) || '-'}</div>\n                <div class=\"admin-llm-metric-label\">Est. Cost</div>\n              </div>\n            </div>\n            \n            <div class=\"admin-llm-timeline\">\n              <div><strong class=\"admin-llm-timeline-label\">Queued:</strong> ${req.queued_at ? new Date(req.queued_at).toLocaleString() : '-'}</div>\n              <div><strong class=\"admin-llm-timeline-label\">Started:</strong> ${req.started_at ? new Date(req.started_at).toLocaleString() : '-'}</div>\n              <div><strong class=\"admin-llm-timeline-label\">Completed:</strong> ${req.completed_at ? new Date(req.completed_at).toLocaleString() : '-'}</div>\n            </div>\n            \n            ${req.last_error ? `\n              <div class=\"admin-llm-error-box\">\n                <div class=\"admin-llm-error-header\">\n                  <span class=\"admin-llm-error-icon\">‚ö†</span>\n                  <strong>Error</strong>\n                  <span class=\"admin-llm-error-attempt\">(Attempt ${req.attempt_count}/${req.max_attempts})</span>\n                </div>\n                <div class=\"admin-llm-error-body\">${escapeHtml(req.last_error)}</div>\n              </div>\n            ` : ''}\n            \n            <!-- Prompt / Input -->\n            <div class=\"admin-llm-section\">\n              <div class=\"admin-llm-section-header\">\n                <h4 class=\"admin-llm-section-title\"><span class=\"admin-llm-section-emoji\">üìù</span> Prompt / Input</h4>\n                <button class=\"btn btn-sm btn-secondary\" id=\"copy-input-btn\">Copy</button>\n              </div>\n              <div class=\"admin-llm-code-block\" id=\"input-display\">${formatPromptText(promptText as string)}</div>\n            </div>\n            \n            <!-- Output -->\n            <div class=\"admin-llm-section\">\n              <div class=\"admin-llm-section-header\">\n                <h4 class=\"admin-llm-section-title\"><span class=\"admin-llm-section-emoji\">ü§ñ</span> Response</h4>\n                <button class=\"btn btn-sm btn-secondary\" id=\"copy-output-btn\">Copy</button>\n              </div>\n              <div class=\"admin-llm-code-block admin-llm-code-block-tall\" id=\"output-display\">${formatPromptText(req.output_text)}</div>\n            </div>\n            \n            <!-- Raw Data Toggle -->\n            <details class=\"admin-llm-details\">\n              <summary class=\"admin-llm-details-summary\">\n                <span class=\"admin-llm-details-summary-inner\">üìã Raw Data (JSON)</span>\n              </summary>\n              <div class=\"admin-llm-details-content\">\n                <div class=\"admin-llm-json-block\">\n                  <div class=\"admin-llm-json-header\">\n                    <span class=\"admin-llm-json-label\">Input Data</span>\n                    <button class=\"btn btn-xs btn-secondary\" id=\"copy-input-json-btn\">Copy JSON</button>\n                  </div>\n                  <pre class=\"admin-llm-pre\">${formatJsonHtml(req.input_data)}</pre>\n                </div>\n                ${req.output_data ? `\n                  <div class=\"admin-llm-json-block\">\n                    <div class=\"admin-llm-json-header\">\n                      <span class=\"admin-llm-json-label\">Output Data</span>\n                      <button class=\"btn btn-xs btn-secondary\" id=\"copy-output-json-btn\">Copy JSON</button>\n                    </div>\n                    <pre class=\"admin-llm-pre\">${formatJsonHtml(req.output_data)}</pre>\n                  </div>\n                ` : ''}\n              </div>\n            </details>\n          </div>\n          \n          <div class=\"modal-footer\">\n            <button class=\"btn btn-secondary modal-close-btn\">Close</button>\n          </div>\n        </div>\n      `;\n\n      document.body.appendChild(modal);\n\n      // Close handlers\n      modal.querySelector('.modal-close')?.addEventListener('click', () => modal.remove());\n      modal.querySelector('.modal-close-btn')?.addEventListener('click', () => modal.remove());\n      modal.addEventListener('click', (e) => {\n        if (e.target === modal) modal.remove();\n      });\n\n      // ESC key to close\n      const handleEsc = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n          modal.remove();\n          document.removeEventListener('keydown', handleEsc);\n        }\n      };\n      document.addEventListener('keydown', handleEsc);\n\n      // Copy handlers\n      modal.querySelector('#copy-input-btn')?.addEventListener('click', () => {\n        const text = promptText || JSON.stringify(req.input_data, null, 2);\n        navigator.clipboard.writeText(text as string);\n        toast.success('Input copied to clipboard');\n      });\n      modal.querySelector('#copy-output-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(req.output_text || '');\n        toast.success('Response copied to clipboard');\n      });\n      modal.querySelector('#copy-input-json-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(JSON.stringify(req.input_data, null, 2));\n        toast.success('Input JSON copied to clipboard');\n      });\n      modal.querySelector('#copy-output-json-btn')?.addEventListener('click', () => {\n        navigator.clipboard.writeText(JSON.stringify(req.output_data, null, 2));\n        toast.success('Output JSON copied to clipboard');\n      });\n\n    } catch (error) {\n      console.error('Failed to load request details:', error);\n      toast.error('Failed to load request details');\n    }\n  }\n\n  // Load failed items\n  async function loadFailedItems(): Promise<void> {\n    const failedContent = container.querySelector('#failed-items-content');\n\n    try {\n      const response = await http.get<{\n        items: Array<{\n          id: string;\n          context: string;\n          priority: string;\n          provider?: string;\n          model?: string;\n          attemptCount: number;\n          maxAttempts: number;\n          canRetry: boolean;\n          error?: string;\n          completedAt?: string;\n        }>;\n      }>('/api/llm/queue/retryable?limit=20');\n\n      const items = response.data?.items || [];\n\n      if (failedContent) {\n        if (items.length > 0) {\n          failedContent.innerHTML = `\n            <table class=\"admin-queue-table\">\n              <thead>\n                <tr>\n                  <th class=\"admin-queue-th\">Context</th>\n                  <th class=\"admin-queue-th\">Provider</th>\n                  <th class=\"admin-queue-th\">Attempts</th>\n                  <th class=\"admin-queue-th\">Error</th>\n                  <th class=\"admin-queue-th\">Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${items.map(item => `\n                  <tr>\n                    <td class=\"admin-queue-td\">${item.context || 'Unknown'}</td>\n                    <td class=\"admin-queue-td admin-queue-td-sm\">${item.provider || '-'}</td>\n                    <td class=\"admin-queue-td\">${item.attemptCount}/${item.maxAttempts}</td>\n                    <td class=\"admin-queue-td admin-queue-td-ellipsis admin-queue-td-error\" title=\"${item.error || ''}\">${item.error || '-'}</td>\n                    <td class=\"admin-queue-td\">\n                      <button class=\"btn-sm btn-primary\" data-retry-item=\"${item.id}\" ${!item.canRetry ? 'disabled' : ''}>‚Üª Retry</button>\n                      <button class=\"btn-sm admin-ml-1\" data-retry-reset-item=\"${item.id}\">Reset & Retry</button>\n                    </td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          failedContent.innerHTML = '<div class=\"admin-placeholder\">No failed items</div>';\n        }\n      }\n    } catch (error) {\n      console.error('Failed to load failed items:', error);\n      if (failedContent) {\n        failedContent.innerHTML = '<div class=\"admin-error-msg\">Failed to load failed items</div>';\n      }\n    }\n  }\n\n  // Refresh queue status button\n  const refreshStatusBtn = container.querySelector('#refresh-queue-status');\n  if (refreshStatusBtn) {\n    on(refreshStatusBtn as HTMLElement, 'click', loadQueueStatus);\n  }\n\n  // Refresh history button\n  const refreshHistoryBtn = container.querySelector('#refresh-queue-history');\n  if (refreshHistoryBtn) {\n    on(refreshHistoryBtn as HTMLElement, 'click', loadQueueHistory);\n  }\n\n  // Refresh failed button\n  const refreshFailedBtn = container.querySelector('#refresh-failed-btn');\n  if (refreshFailedBtn) {\n    on(refreshFailedBtn as HTMLElement, 'click', loadFailedItems);\n  }\n\n  // Retry all failed items\n  const retryAllBtn = container.querySelector('#retry-all-btn');\n  if (retryAllBtn) {\n    on(retryAllBtn as HTMLElement, 'click', async () => {\n      try {\n        // Get all retryable items and retry them\n        const response = await http.get<{ items: Array<{ id: string; canRetry: boolean }> }>('/api/llm/queue/retryable?limit=50');\n        const items = (response.data?.items || []).filter(i => i.canRetry);\n\n        let successCount = 0;\n        for (const item of items) {\n          try {\n            await http.post(`/api/llm/queue/${item.id}/retry`, { resetAttempts: false });\n            successCount++;\n          } catch {\n            // Continue with others\n          }\n        }\n\n        toast.success(`Queued ${successCount} items for retry`);\n        loadQueueStatus();\n        loadFailedItems();\n      } catch (error) {\n        toast.error('Failed to retry items');\n      }\n    });\n  }\n\n  // Pause queue button\n  const pauseBtn = container.querySelector('#queue-pause-btn');\n  if (pauseBtn) {\n    on(pauseBtn as HTMLElement, 'click', async () => {\n      try {\n        await http.post('/api/llm/queue/pause');\n        toast.success('Queue paused');\n        loadQueueStatus();\n      } catch (error) {\n        toast.error('Failed to pause queue');\n      }\n    });\n  }\n\n  // Resume queue button\n  const resumeBtn = container.querySelector('#queue-resume-btn');\n  if (resumeBtn) {\n    on(resumeBtn as HTMLElement, 'click', async () => {\n      try {\n        await http.post('/api/llm/queue/resume');\n        toast.success('Queue resumed');\n        loadQueueStatus();\n      } catch (error) {\n        toast.error('Failed to resume queue');\n      }\n    });\n  }\n\n  // Clear queue button\n  const clearBtn = container.querySelector('#queue-clear-btn');\n  if (clearBtn) {\n    on(clearBtn as HTMLElement, 'click', async () => {\n      if (confirm('Are you sure you want to clear all pending items from the queue?')) {\n        try {\n          await http.post('/api/llm/queue/clear');\n          toast.success('Queue cleared');\n          loadQueueStatus();\n        } catch (error) {\n          toast.error('Failed to clear queue');\n        }\n      }\n    });\n  }\n\n  // Cancel individual item, retry handlers, and view details\n  container.addEventListener('click', async (e) => {\n    const target = e.target as HTMLElement;\n\n    // View request details - use closest to handle click on button or its content\n    const viewBtn = target.closest('[data-view-request]') as HTMLElement | null;\n    if (viewBtn) {\n      e.preventDefault();\n      e.stopPropagation();\n      const viewId = viewBtn.getAttribute('data-view-request');\n      if (viewId) {\n        showRequestDetails(viewId);\n      }\n      return;\n    }\n\n    // Cancel pending item\n    const cancelBtn = target.closest('[data-cancel-item]') as HTMLElement | null;\n    if (cancelBtn) {\n      const cancelId = cancelBtn.getAttribute('data-cancel-item');\n      if (cancelId) {\n        try {\n          await http.delete(`/api/llm/queue/${cancelId}`);\n          toast.success('Item cancelled');\n          loadQueueStatus();\n        } catch (error) {\n          toast.error('Failed to cancel item');\n        }\n        return;\n      }\n    }\n\n    // Retry failed item\n    const retryBtn = target.closest('[data-retry-item]') as HTMLElement | null;\n    if (retryBtn) {\n      const retryId = retryBtn.getAttribute('data-retry-item');\n      if (retryId) {\n        try {\n          await http.post(`/api/llm/queue/${retryId}/retry`, { resetAttempts: false });\n          toast.success('Item queued for retry');\n          loadQueueStatus();\n          loadFailedItems();\n        } catch (error) {\n          toast.error('Failed to retry item');\n        }\n        return;\n      }\n    }\n\n    // Retry with reset\n    const retryResetBtn = target.closest('[data-retry-reset-item]') as HTMLElement | null;\n    if (retryResetBtn) {\n      const retryResetId = retryResetBtn.getAttribute('data-retry-reset-item');\n      if (retryResetId) {\n        try {\n          await http.post(`/api/llm/queue/${retryResetId}/retry`, { resetAttempts: true });\n          toast.success('Item queued for retry (attempts reset)');\n          loadQueueStatus();\n          loadFailedItems();\n        } catch (error) {\n          toast.error('Failed to retry item');\n        }\n        return;\n      }\n    }\n  });\n\n  // ============ Models Section Handlers ============\n\n  // Load metadata sync status\n  async function loadMetadataSyncStatus(): Promise<void> {\n    const statusDiv = container.querySelector('#metadata-sync-status');\n    const countsDiv = container.querySelector('#provider-model-counts');\n\n    try {\n      const response = await http.get<{\n        success: boolean;\n        providers: Array<{\n          provider: string;\n          active_models: number;\n          text_models: number;\n          embedding_models: number;\n          vision_models: number;\n          last_synced: string | null;\n        }>;\n      }>('/api/llm/metadata/status');\n\n      const providers = response.data?.providers || [];\n\n      if (statusDiv) {\n        if (providers.length > 0) {\n          statusDiv.innerHTML = `\n            <table class=\"admin-queue-table admin-queue-table-sm\">\n              <thead>\n                <tr>\n                  <th class=\"admin-queue-th\">Provider</th>\n                  <th class=\"admin-queue-th\">Text</th>\n                  <th class=\"admin-queue-th\">Vision</th>\n                  <th class=\"admin-queue-th\">Embeddings</th>\n                  <th class=\"admin-queue-th\">Total</th>\n                  <th class=\"admin-queue-th\">Last Synced</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${providers.map(p => `\n                  <tr>\n                    <td class=\"admin-queue-td admin-queue-td-bold admin-queue-td-cap\">${p.provider}</td>\n                    <td class=\"admin-queue-td\">${p.text_models || 0}</td>\n                    <td class=\"admin-queue-td\">${p.vision_models || 0}</td>\n                    <td class=\"admin-queue-td\">${p.embedding_models || 0}</td>\n                    <td class=\"admin-queue-td admin-queue-td-bold\">${p.active_models || 0}</td>\n                    <td class=\"admin-queue-td admin-queue-td-sm admin-queue-td-muted\">${p.last_synced ? new Date(p.last_synced).toLocaleString() : 'Never'}</td>\n                  </tr>\n                `).join('')}\n              </tbody>\n            </table>\n          `;\n        } else {\n          statusDiv.innerHTML = '<div class=\"admin-placeholder\">No metadata found. Click \"Sync All Providers\" to fetch model data.</div>';\n        }\n      }\n\n      // Update counts display\n      if (countsDiv && providers.length > 0) {\n        const total = providers.reduce((sum, p) => sum + (p.active_models || 0), 0);\n        countsDiv.innerHTML = `\n          <div class=\"admin-provider-counts-grid\">\n            ${providers.map(p => `\n              <div class=\"admin-provider-count-card\">\n                <div class=\"admin-provider-count-value\">${p.active_models || 0}</div>\n                <div class=\"admin-provider-count-label\">${p.provider}</div>\n              </div>\n            `).join('')}\n            <div class=\"admin-provider-count-total\">\n              <div class=\"admin-provider-count-value\">${total}</div>\n              <div class=\"admin-provider-count-label\">Total Models</div>\n            </div>\n          </div>\n        `;\n      }\n    } catch (error) {\n      console.error('Failed to load metadata status:', error);\n      if (statusDiv) {\n        statusDiv.innerHTML = '<div class=\"admin-error-msg\">Failed to load metadata status</div>';\n      }\n    }\n  }\n\n  // Sync all metadata\n  const syncAllBtn = container.querySelector('#sync-all-metadata-btn');\n  if (syncAllBtn) {\n    on(syncAllBtn as HTMLElement, 'click', async () => {\n      const resultDiv = container.querySelector('#metadata-sync-result');\n      (syncAllBtn as HTMLButtonElement).disabled = true;\n      (syncAllBtn as HTMLButtonElement).textContent = 'Syncing...';\n\n      try {\n        const response = await http.post<{\n          success: boolean;\n          providers: Record<string, { status: string; models?: number; synced?: number; error?: string; reason?: string }>;\n          totalModels: number;\n          errors: Array<{ provider: string; error: string }>;\n        }>('/api/llm/metadata/sync', {});\n\n        if (resultDiv) {\n          (resultDiv as HTMLElement).classList.remove('hidden');\n          const providers = response.data?.providers || {};\n          const entries = Object.entries(providers);\n\n          resultDiv.innerHTML = `\n            <div class=\"admin-sync-result-box\">\n              <div class=\"admin-sync-result-title\">Sync Results</div>\n              <div class=\"admin-sync-result-chips\">\n                ${entries.map(([provider, result]) => `\n                  <div class=\"admin-sync-chip admin-sync-chip-${result.status}\">\n                    <span class=\"admin-sync-chip-provider\">${provider}</span>\n                    ${result.status === 'success' ? `<span class=\"admin-sync-chip-ok\"> ‚úì ${result.synced} models</span>` : ''}\n                    ${result.status === 'skipped' ? `<span class=\"admin-sync-chip-skip\"> - ${result.reason}</span>` : ''}\n                    ${result.status === 'error' ? `<span class=\"admin-sync-chip-err\"> ‚úó ${result.error}</span>` : ''}\n                  </div>\n                `).join('')}\n              </div>\n              <div class=\"admin-sync-result-total\">\n                Total: ${response.data?.totalModels || 0} models synced\n              </div>\n            </div>\n          `;\n        }\n\n        toast.success(`Synced ${response.data?.totalModels || 0} models`);\n        loadMetadataSyncStatus();\n\n      } catch (error) {\n        toast.error('Failed to sync metadata');\n        if (resultDiv) {\n          (resultDiv as HTMLElement).classList.remove('hidden');\n          resultDiv.innerHTML = '<div class=\"admin-error-msg\">Sync failed. Check console for details.</div>';\n        }\n      } finally {\n        (syncAllBtn as HTMLButtonElement).disabled = false;\n        (syncAllBtn as HTMLButtonElement).textContent = '‚Üª Sync All Providers';\n      }\n    });\n  }\n\n  // Browse models by provider\n  const browseModelsBtn = container.querySelector('#browse-models-btn');\n  if (browseModelsBtn) {\n    on(browseModelsBtn as HTMLElement, 'click', async () => {\n      const providerSelect = container.querySelector('#browse-provider-select') as HTMLSelectElement;\n      const contentDiv = container.querySelector('#models-browser-content');\n      const provider = providerSelect?.value;\n\n      if (!provider) {\n        toast.info('Please select a provider');\n        return;\n      }\n\n      if (contentDiv) {\n        contentDiv.innerHTML = '<div class=\"admin-placeholder\">Loading models...</div>';\n      }\n\n      try {\n        const response = await http.get<{\n          success: boolean;\n          textModels: Array<{ model_id: string; display_name: string; context_tokens: number; price_input: number; price_output: number }>;\n          visionModels: Array<{ model_id: string; display_name: string }>;\n          embeddingModels: Array<{ model_id: string; display_name: string }>;\n        }>(`/api/llm/metadata/${provider}`);\n\n        const { textModels = [], visionModels = [], embeddingModels = [] } = response.data || {};\n\n        if (contentDiv) {\n          if (textModels.length === 0 && embeddingModels.length === 0) {\n            contentDiv.innerHTML = '<div class=\"admin-empty-state\">No models found for this provider. Try syncing first.</div>';\n          } else {\n            contentDiv.innerHTML = `\n              <div class=\"admin-models-browser-grid\">\n                ${textModels.length > 0 ? `\n                  <div>\n                    <h5 class=\"admin-models-section-title\">Text Models (${textModels.length})</h5>\n                    <div class=\"admin-models-cards\">\n                      ${textModels.map(m => `\n                        <div class=\"admin-model-card\">\n                          <div class=\"admin-model-card-name\">${m.display_name || m.model_id}</div>\n                          <div class=\"admin-model-card-id\">${m.model_id}</div>\n                          <div class=\"admin-model-card-meta\">\n                            <span title=\"Context Window\">üìè ${m.context_tokens ? (m.context_tokens / 1000).toFixed(0) + 'K' : '-'}</span>\n                            <span title=\"Input Price\">üí∞ $${m.price_input?.toFixed(2) || '-'}/1M</span>\n                            <span title=\"Output Price\">üíµ $${m.price_output?.toFixed(2) || '-'}/1M</span>\n                          </div>\n                        </div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : ''}\n                ${embeddingModels.length > 0 ? `\n                  <div>\n                    <h5 class=\"admin-models-section-title\">Embedding Models (${embeddingModels.length})</h5>\n                    <div class=\"admin-models-chips\">\n                      ${embeddingModels.map(m => `\n                        <div class=\"admin-model-chip\">${m.display_name || m.model_id}</div>\n                      `).join('')}\n                    </div>\n                  </div>\n                ` : ''}\n              </div>\n            `;\n          }\n        }\n      } catch (error) {\n        if (contentDiv) {\n          contentDiv.innerHTML = '<div class=\"admin-error-msg\">Failed to load models</div>';\n        }\n      }\n    });\n  }\n\n  // Auto-load metadata status if on models section\n  if (currentSection === 'models') {\n    loadMetadataSyncStatus();\n  }\n\n  // Auto-load queue data if on queue section\n  if (currentSection === 'queue') {\n    loadQueueStatus();\n    loadQueueHistory();\n    loadFailedItems();\n  }\n\n  // Save graph config (Supabase Graph)\n  const saveGraphBtn = container.querySelector('#save-graph-config');\n  if (saveGraphBtn) {\n    on(saveGraphBtn as HTMLElement, 'click', async () => {\n      // Build the graph config object for Supabase Graph\n      const graphConfigValue = {\n        enabled: (container.querySelector('#graph-enabled') as HTMLInputElement)?.checked ?? true,\n        provider: 'supabase', // Always use Supabase graph\n        graphName: (container.querySelector('#graph-name') as HTMLInputElement)?.value || 'godmode',\n      };\n\n      try {\n        // Save as a single 'graph' key with the config object\n        await saveConfig('graph', graphConfigValue, 'graph');\n\n        toast.success('Graph configuration saved!');\n        console.log('[AdminPanel] Saved graph config:', graphConfigValue);\n      } catch (error) {\n        console.error('[AdminPanel] Error saving graph config:', error);\n        toast.error('Failed to save graph configuration');\n      }\n    });\n  }\n\n  // Test graph connection (Supabase Graph)\n  const testGraphBtn = container.querySelector('#test-graph-connection');\n  if (testGraphBtn) {\n    on(testGraphBtn as HTMLElement, 'click', async () => {\n      (testGraphBtn as HTMLElement).textContent = 'Testing...';\n      try {\n        // Supabase graph uses existing Supabase connection\n        const testConfig = {\n          provider: 'supabase',\n          graphName: (container.querySelector('#graph-name') as HTMLInputElement)?.value || 'godmode',\n        };\n\n        console.log('[AdminPanel] Testing Supabase graph connection');\n\n        const response = await http.post<{ success: boolean; ok?: boolean; message?: string; error?: string }>('/api/graph/test', testConfig);\n        if (response.data.success || response.data.ok) {\n          toast.success('Supabase graph connection successful!');\n        } else {\n          toast.error(response.data.message || response.data.error || 'Connection failed');\n        }\n      } catch (error) {\n        console.error('[AdminPanel] Graph test error:', error);\n        toast.error('Graph connection test failed');\n      }\n      (testGraphBtn as HTMLElement).textContent = 'Test Connection';\n    });\n  }\n\n  // Load graph overview\n  const loadGraphOverviewBtn = container.querySelector('#load-graph-overview');\n  if (loadGraphOverviewBtn) {\n    on(loadGraphOverviewBtn as HTMLElement, 'click', async () => {\n      await loadGraphOverview();\n      renderAdminPanel(container);\n    });\n  }\n  const refreshGraphOverviewBtn = container.querySelector('#refresh-graph-overview');\n  if (refreshGraphOverviewBtn) {\n    on(refreshGraphOverviewBtn as HTMLElement, 'click', async () => {\n      await loadGraphOverview();\n      renderAdminPanel(container);\n      toast.info('Graph overview refreshed');\n    });\n  }\n  const openGraphTabBtn = container.querySelector('#open-graph-tab');\n  if (openGraphTabBtn) {\n    on(openGraphTabBtn as HTMLElement, 'click', () => {\n      document.querySelector('.nav-item[data-tab=\"graph\"]')?.dispatchEvent(new MouseEvent('click', { bubbles: true }));\n    });\n  }\n\n  // Load ontology\n  const loadOntologyBtn = container.querySelector('#load-ontology');\n  if (loadOntologyBtn) {\n    on(loadOntologyBtn as HTMLElement, 'click', async () => {\n      await loadOntologyData();\n      renderAdminPanel(container);\n    });\n  }\n  const reloadOntologyBtn = container.querySelector('#reload-ontology');\n  if (reloadOntologyBtn) {\n    on(reloadOntologyBtn as HTMLElement, 'click', async () => {\n      ontologyLoaded = false;\n      await loadOntologyData();\n      renderAdminPanel(container);\n      toast.info('Ontology reloaded');\n    });\n  }\n\n  // Save prompts\n  const savePromptsBtn = container.querySelector('#save-prompts');\n  if (savePromptsBtn) {\n    on(savePromptsBtn as HTMLElement, 'click', async () => {\n      const promptElements = container.querySelectorAll('[data-prompt-key]');\n      let savedCount = 0;\n\n      for (const textarea of promptElements) {\n        const key = textarea.getAttribute('data-prompt-key')!;\n        const value = (textarea as HTMLTextAreaElement).value;\n\n        if (value && value.trim()) {\n          try {\n            await http.put(`/api/system/prompts/${key}`, { prompt_template: value.trim() });\n            savedCount++;\n\n            // Update status indicator\n            const statusEl = container.querySelector(`#status-${key}`);\n            if (statusEl) {\n              statusEl.textContent = '‚úì Saved';\n              statusEl.className = 'prompt-status saved';\n            }\n          } catch (error) {\n            console.warn(`Failed to save prompt ${key}:`, error);\n            const statusEl = container.querySelector(`#status-${key}`);\n            if (statusEl) {\n              statusEl.textContent = '‚úó Error';\n              statusEl.className = 'prompt-status error';\n            }\n          }\n        }\n      }\n\n      if (savedCount > 0) {\n        toast.success(`${savedCount} prompt(s) saved successfully`);\n      } else {\n        toast.info('No prompts to save');\n      }\n    });\n  }\n\n  // Reload prompts\n  const reloadPromptsBtn = container.querySelector('#reload-prompts');\n  if (reloadPromptsBtn) {\n    on(reloadPromptsBtn as HTMLElement, 'click', async () => {\n      await loadSystemPrompts();\n      renderAdminPanel(container);\n      toast.info('Prompts reloaded from database');\n    });\n  }\n\n  // View version history\n  container.querySelectorAll('[data-view-versions]').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const key = btn.getAttribute('data-view-versions')!;\n      const historyDiv = container.querySelector(`#versions-${key}`) as HTMLElement;\n      const listDiv = historyDiv?.querySelector('.version-list') as HTMLElement;\n\n      if (!historyDiv || !listDiv) return;\n\n      // Toggle visibility\n      if (!historyDiv.classList.contains('hidden')) {\n        historyDiv.classList.add('hidden');\n        return;\n      }\n\n      // Load versions\n      listDiv.innerHTML = '<p class=\"text-muted\">Loading versions...</p>';\n      historyDiv.classList.remove('hidden');\n\n      try {\n        const response = await http.get<{ current_version: number; versions: Array<{ id: string; version: number; created_at: string }> }>(`/api/system/prompts/${key}/versions`);\n        const versions = response.data?.versions || [];\n        const currentVersion = response.data?.current_version || 1;\n\n        if (versions.length === 0) {\n          listDiv.innerHTML = `\n            <p class=\"text-muted\">No previous versions. Current version: ${currentVersion}</p>\n            <p class=\"text-sm text-muted\">Versions are saved automatically when you edit a prompt.</p>\n          `;\n          return;\n        }\n\n        listDiv.innerHTML = `\n          <p class=\"text-sm\"><strong>Current version:</strong> ${currentVersion}</p>\n          <div class=\"version-items\">\n            ${versions.map(v => `\n              <div class=\"version-item\">\n                <div class=\"version-info\">\n                  <span class=\"version-number\">v${v.version}</span>\n                  <span class=\"version-date\">${new Date(v.created_at).toLocaleString()}</span>\n                </div>\n                <div class=\"version-actions\">\n                  <button class=\"btn-sm\" data-preview-version=\"${key}:${v.version}\">Preview</button>\n                  <button class=\"btn-sm btn-primary\" data-restore-version=\"${key}:${v.version}\">Restore</button>\n                </div>\n              </div>\n            `).join('')}\n          </div>\n        `;\n\n        // Bind restore buttons\n        listDiv.querySelectorAll('[data-restore-version]').forEach(restoreBtn => {\n          on(restoreBtn as HTMLElement, 'click', async () => {\n            const [promptKey, versionStr] = restoreBtn.getAttribute('data-restore-version')!.split(':');\n            const version = parseInt(versionStr, 10);\n\n            if (!confirm(`Restore prompt \"${promptKey}\" to version ${version}? The current version will be saved in history.`)) {\n              return;\n            }\n\n            try {\n              await http.post(`/api/system/prompts/${promptKey}/restore`, { version });\n              toast.success(`Restored to version ${version}`);\n              await loadSystemPrompts();\n              renderAdminPanel(container);\n            } catch (error) {\n              toast.error('Failed to restore version');\n            }\n          });\n        });\n\n        // Bind preview buttons\n        listDiv.querySelectorAll('[data-preview-version]').forEach(previewBtn => {\n          on(previewBtn as HTMLElement, 'click', async () => {\n            const [promptKey, versionStr] = previewBtn.getAttribute('data-preview-version')!.split(':');\n            const version = parseInt(versionStr, 10);\n\n            try {\n              const response = await http.get<{ version: { prompt_template: string } }>(`/api/system/prompts/${promptKey}/versions/${version}`);\n              const template = response.data?.version?.prompt_template || '';\n\n              // Show in a modal or alert for now\n              const previewModal = document.createElement('div');\n              previewModal.className = 'modal-overlay';\n              previewModal.innerHTML = `\n                <div class=\"modal-content admin-prompt-preview-modal\">\n                  <div class=\"modal-header\">\n                    <h3>Version ${version} Preview</h3>\n                    <button class=\"modal-close\">&times;</button>\n                  </div>\n                  <div class=\"modal-body\">\n                    <pre class=\"admin-prompt-preview-pre\">${template.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>\n                  </div>\n                </div>\n              `;\n              document.body.appendChild(previewModal);\n\n              previewModal.querySelector('.modal-close')?.addEventListener('click', () => {\n                previewModal.remove();\n              });\n              previewModal.addEventListener('click', (e) => {\n                if (e.target === previewModal) previewModal.remove();\n              });\n            } catch (error) {\n              toast.error('Failed to load version preview');\n            }\n          });\n        });\n\n      } catch (error) {\n        listDiv.innerHTML = '<p class=\"text-error\">Failed to load version history</p>';\n      }\n    });\n  });\n\n  // Save processing\n  const saveProcBtn = container.querySelector('#save-processing');\n  if (saveProcBtn) {\n    on(saveProcBtn as HTMLElement, 'click', async () => {\n      await saveConfig('chunk_size', parseInt((container.querySelector('#proc-chunk-size') as HTMLInputElement)?.value || '1000'), 'processing');\n      await saveConfig('chunk_overlap', parseInt((container.querySelector('#proc-chunk-overlap') as HTMLInputElement)?.value || '200'), 'processing');\n      await saveConfig('max_tokens', parseInt((container.querySelector('#proc-max-tokens') as HTMLInputElement)?.value || '4096'), 'processing');\n      await saveConfig('temperature', parseFloat((container.querySelector('#proc-temperature') as HTMLInputElement)?.value || '0.7'), 'processing');\n      await saveConfig('auto_process', (container.querySelector('#proc-auto-process') as HTMLInputElement)?.checked, 'processing');\n      await saveConfig('parallel_jobs', parseInt((container.querySelector('#proc-parallel-jobs') as HTMLInputElement)?.value || '3'), 'processing');\n    });\n  }\n\n  // Save Team Analysis settings\n  const saveTeamAnalysisBtn = container.querySelector('#save-team-analysis');\n  if (saveTeamAnalysisBtn) {\n    on(saveTeamAnalysisBtn as HTMLElement, 'click', async () => {\n      const enabled = (container.querySelector('#team-analysis-enabled') as HTMLInputElement)?.checked ?? true;\n      const access = (container.querySelector('#team-analysis-access') as HTMLSelectElement)?.value || 'admin_only';\n      await saveTeamAnalysisSettings(enabled, access);\n      renderAdminPanel(container);\n    });\n  }\n\n  // Google Drive: use delegation so buttons work when section is rendered later\n  on(container, 'click', async (e: Event) => {\n    const target = (e.target as HTMLElement).closest?.('[id]') as HTMLElement | null;\n    if (!target?.id) return;\n    if (target.id === 'save-google-drive') {\n      e.preventDefault();\n      const enabled = (container.querySelector('#google-drive-enabled') as HTMLInputElement)?.checked ?? false;\n      const rootFolderId = (container.querySelector('#google-drive-root-folder') as HTMLInputElement)?.value?.trim() ?? '';\n      const serviceJson = (container.querySelector('#google-drive-service-json') as HTMLTextAreaElement)?.value?.trim() ?? '';\n      try {\n        await http.post('/api/system/google-drive', { enabled, rootFolderId, serviceAccountJson: serviceJson || undefined });\n        toast.success('Google Drive config saved');\n        googleDriveLoaded = false;\n        await loadGoogleDriveState();\n        renderAdminPanel(container);\n      } catch (err: unknown) {\n        toast.error(err && typeof err === 'object' && 'message' in err ? String((err as { message: string }).message) : 'Failed to save');\n      }\n    } else if (target.id === 'bootstrap-google-drive') {\n      e.preventDefault();\n      const btn = container.querySelector('#bootstrap-google-drive') as HTMLButtonElement;\n      if (btn) { btn.disabled = true; btn.textContent = 'Running...'; }\n      try {\n        const res = await http.post<{ success: boolean; message?: string; projectsCount?: number }>('/api/system/google-drive/bootstrap-all');\n        toast.success(res.data?.message ?? `Bootstrap complete: ${res.data?.projectsCount ?? 0} projects`);\n        googleDriveLoaded = false;\n        await loadGoogleDriveState();\n        renderAdminPanel(container);\n      } catch (err: unknown) {\n        toast.error(err && typeof err === 'object' && 'message' in err ? String((err as { message: string }).message) : 'Bootstrap failed');\n      } finally {\n        if (btn) { btn.disabled = false; btn.textContent = 'Bootstrap all projects'; }\n      }\n    }\n  });\n\n  // =========================\n  // BILLING SECTION EVENTS\n  // =========================\n\n  // Exchange rate auto toggle\n  const exchangeRateAutoCheckbox = container.querySelector('#exchange-rate-auto');\n  if (exchangeRateAutoCheckbox) {\n    on(exchangeRateAutoCheckbox as HTMLElement, 'change', () => {\n      const isAuto = (exchangeRateAutoCheckbox as HTMLInputElement).checked;\n      const manualGroup = container.querySelector('#manual-rate-group') as HTMLElement;\n      const refreshBtn = container.querySelector('#refresh-rate-btn') as HTMLButtonElement;\n      if (manualGroup) {\n        manualGroup.classList.toggle('hidden', !!isAuto);\n      }\n      if (refreshBtn) {\n        refreshBtn.disabled = !isAuto;\n      }\n    });\n  }\n\n  // Refresh exchange rate button\n  const refreshRateBtn = container.querySelector('#refresh-rate-btn');\n  if (refreshRateBtn) {\n    on(refreshRateBtn as HTMLElement, 'click', async () => {\n      const btn = refreshRateBtn as HTMLButtonElement;\n      btn.disabled = true;\n      btn.textContent = 'Refreshing...';\n\n      try {\n        const result = await billingService.refreshExchangeRate();\n        if (result.success && result.rate) {\n          const rateDisplay = container.querySelector('#current-rate-display');\n          const sourceDisplay = container.querySelector('#rate-source');\n          if (rateDisplay) rateDisplay.textContent = result.rate.toFixed(4);\n          if (sourceDisplay) sourceDisplay.textContent = result.source || 'api';\n          toast.success(`Rate updated: ${result.rate.toFixed(4)}`);\n        } else {\n          toast.error(result.error || 'Failed to refresh rate');\n        }\n      } catch (e) {\n        toast.error('Failed to refresh rate');\n      } finally {\n        btn.disabled = false;\n        btn.textContent = 'Refresh Rate';\n      }\n    });\n  }\n\n  // Save exchange rate settings\n  const saveExchangeRateBtn = container.querySelector('#save-exchange-rate-btn');\n  if (saveExchangeRateBtn) {\n    on(saveExchangeRateBtn as HTMLElement, 'click', async () => {\n      const isAuto = (container.querySelector('#exchange-rate-auto') as HTMLInputElement)?.checked ?? true;\n      const manualRate = parseFloat((container.querySelector('#exchange-rate-manual') as HTMLInputElement)?.value || '0.92');\n\n      const result = await billingService.setExchangeRateMode(isAuto, manualRate);\n\n      if (result.success) {\n        toast.success('Exchange rate settings saved');\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to save');\n      }\n    });\n  }\n\n  // Save global pricing config\n  const saveGlobalPricingBtn = container.querySelector('#save-global-pricing-btn');\n  if (saveGlobalPricingBtn) {\n    on(saveGlobalPricingBtn as HTMLElement, 'click', async () => {\n      const fixedMarkup = parseFloat((container.querySelector('#global-markup-percent') as HTMLInputElement)?.value || '0');\n      const periodType = (container.querySelector('#global-period-type') as HTMLSelectElement)?.value || 'monthly';\n\n      const result = await billingService.setGlobalPricingConfig({\n        fixed_markup_percent: fixedMarkup,\n        period_type: periodType as 'monthly' | 'weekly'\n      });\n\n      if (result.success) {\n        toast.success('Global pricing saved');\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to save');\n      }\n    });\n  }\n\n  // Add tier button\n  const addTierBtn = container.querySelector('#add-tier-btn');\n  if (addTierBtn) {\n    on(addTierBtn as HTMLElement, 'click', () => {\n      // Add a new tier to the list\n      globalPricingTiers.push({\n        id: '',\n        pricing_config_id: globalPricingConfig?.id || '',\n        token_limit: 100000,\n        markup_percent: 20,\n        name: `Tier ${globalPricingTiers.length + 1}`,\n        tier_order: globalPricingTiers.length\n      });\n      renderAdminPanel(container);\n    });\n  }\n\n  // Remove tier buttons\n  container.querySelectorAll('.remove-tier-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', () => {\n      const index = parseInt(btn.getAttribute('data-index') || '0', 10);\n      globalPricingTiers.splice(index, 1);\n      renderAdminPanel(container);\n    });\n  });\n\n  // Tier unlimited checkboxes\n  container.querySelectorAll('.tier-unlimited').forEach(checkbox => {\n    on(checkbox as HTMLElement, 'change', () => {\n      const row = (checkbox as HTMLElement).closest('.tier-row') as HTMLElement;\n      const limitInput = row?.querySelector('.tier-limit') as HTMLInputElement;\n      if (limitInput) {\n        limitInput.disabled = (checkbox as HTMLInputElement).checked;\n        if ((checkbox as HTMLInputElement).checked) {\n          limitInput.value = '';\n        }\n      }\n    });\n  });\n\n  // Save tiers button\n  const saveTiersBtn = container.querySelector('#save-tiers-btn');\n  if (saveTiersBtn) {\n    on(saveTiersBtn as HTMLElement, 'click', async () => {\n      const tiers: Array<{ token_limit: number | null; markup_percent: number; name?: string }> = [];\n      container.querySelectorAll('.tier-row').forEach(row => {\n        const name = (row.querySelector('.tier-name') as HTMLInputElement)?.value || '';\n        const limitValue = (row.querySelector('.tier-limit') as HTMLInputElement)?.value;\n        const markup = parseFloat((row.querySelector('.tier-markup') as HTMLInputElement)?.value || '0');\n        const unlimited = (row.querySelector('.tier-unlimited') as HTMLInputElement)?.checked;\n\n        tiers.push({\n          token_limit: unlimited ? null : (limitValue ? parseInt(limitValue, 10) : null),\n          markup_percent: markup,\n          name: name || undefined\n        });\n      });\n\n      const result = await billingService.setGlobalPricingTiers(tiers);\n      if (result.success) {\n        toast.success('Pricing tiers saved');\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to save tiers');\n      }\n    });\n  }\n\n  // Refresh billing button\n  const refreshBillingBtn = container.querySelector('#refresh-billing-btn');\n  if (refreshBillingBtn) {\n    on(refreshBillingBtn as HTMLElement, 'click', async () => {\n      billingLoaded = false;\n      await loadBillingData();\n      renderAdminPanel(container);\n      toast.info('Billing data refreshed');\n    });\n  }\n\n  // Add balance buttons\n  container.querySelectorAll('.add-balance-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const projectId = btn.getAttribute('data-project-id');\n      const projectName = btn.getAttribute('data-project-name');\n      if (!projectId) return;\n\n      const amount = prompt(`Enter amount in EUR to add to \"${projectName}\":`);\n      if (!amount || isNaN(parseFloat(amount))) return;\n\n      const result = await billingService.creditProjectBalance(projectId, parseFloat(amount));\n      if (result.success) {\n        toast.success(`Added ‚Ç¨${parseFloat(amount).toFixed(2)} to ${projectName}. New balance: ‚Ç¨${result.new_balance?.toFixed(2)}`);\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to add balance');\n      }\n    });\n  });\n\n  // Toggle unlimited buttons\n  container.querySelectorAll('.toggle-unlimited-btn').forEach(btn => {\n    on(btn as HTMLElement, 'click', async () => {\n      const projectId = btn.getAttribute('data-project-id');\n      const isUnlimited = btn.getAttribute('data-unlimited') === 'true';\n      if (!projectId) return;\n\n      const action = isUnlimited ? 'disable unlimited mode' : 'enable unlimited mode';\n      if (!confirm(`Are you sure you want to ${action} for this project?`)) return;\n\n      const result = await billingService.setProjectUnlimited(projectId, !isUnlimited);\n      if (result.success) {\n        toast.success(`Unlimited mode ${isUnlimited ? 'disabled' : 'enabled'}`);\n        billingLoaded = false;\n        await loadBillingData();\n        renderAdminPanel(container);\n      } else {\n        toast.error(result.error || 'Failed to update');\n      }\n    });\n  });\n\n  // Refresh audit\n  const refreshAuditBtn = container.querySelector('#refresh-audit');\n  if (refreshAuditBtn) {\n    on(refreshAuditBtn as HTMLElement, 'click', async () => {\n      await loadAuditLogs();\n      renderAdminPanel(container);\n    });\n  }\n}\n\n/**\n * Render admin panel\n */\nfunction renderAdminPanel(container: HTMLElement): void {\n  container.innerHTML = `\n    <div class=\"admin-panel\">\n      <div class=\"admin-header\">\n        <div class=\"admin-header-content\">\n          <div class=\"admin-icon\">\n            <svg fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" width=\"32\" height=\"32\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/>\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/>\n            </svg>\n          </div>\n          <div class=\"admin-title\">\n            <h2>Platform Administration</h2>\n            <p>System configuration for superadmins</p>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"admin-body\">\n        <nav class=\"admin-nav\">\n          ${renderNav()}\n        </nav>\n\n        <main class=\"admin-content\">\n          ${isLoading ? '<div class=\"loading-spinner\">Loading...</div>' : renderSectionContent()}\n        </main>\n      </div>\n    </div>\n  `;\n\n  bindSectionEvents(container);\n}\n\n/**\n * Initialize and mount admin panel\n */\nexport async function initAdminPanel(container: HTMLElement): Promise<void> {\n  // Check if user is superadmin\n  const state = appStore.getState();\n  if (state.currentUser?.role !== 'superadmin') {\n    container.innerHTML = `\n      <div class=\"admin-panel\">\n        <div class=\"admin-header\">\n          <h2>Access Denied</h2>\n          <p>You need superadmin privileges to access this section.</p>\n        </div>\n      </div>\n    `;\n    return;\n  }\n\n  isLoading = true;\n  renderAdminPanel(container);\n\n  // Load data\n  await Promise.all([\n    loadSystemConfig(),\n    loadProviders(),\n    loadAuditLogs(),\n    loadSystemPrompts(),\n    loadSecrets(),\n  ]);\n\n  isLoading = false;\n  renderAdminPanel(container);\n}\n\nexport default initAdminPanel;\n"],"names":["ontologyEntities","ontologyRelations","ontologyLoaded","ontologyLoading","graphList","graphStatus","graphOverviewLoaded","graphOverviewLoading","graphPasswordSet","currentSection","systemConfig","providers","auditLogs","systemPrompts","isLoading","teamAnalysisSettings","teamAnalysisLoaded","teamAnalysisLoading","billingProjects","globalPricingConfig","globalPricingTiers","exchangeRateConfig","billingLoaded","billingLoading","googleDriveState","googleDriveLoading","googleDriveLoaded","loadSystemConfig","response","http","perTask","error","loadSecrets","s","DEFAULT_PROVIDER_IDS","loadProviders","defaultProviders","p","apiProviders","loadAuditLogs","loadSystemPrompts","loadOntologyData","entitiesRes","relationsRes","loadGraphOverview","listRes","statusRes","saveConfig","key","value","category","toast","testProvider","providerId","models","getConfigValue","defaultValue","configs","graphConfigEntry","c","renderNav","renderLLMSection","taskTypes","task","taskConfig","icons","labels","descs","icon","label","desc","providerOpts","providerNames","renderGraphSection","graphConfig","g","renderOntologySection","r","renderPromptsSection","extractionPrompts","analysisPrompts","templatePrompts","sprintPrompts","reportPrompts","renderPromptCard","renderProcessingSection","processing","loadTeamAnalysisSettings","appStore","saveTeamAnalysisSettings","enabled","access","loadGoogleDriveState","renderGoogleDriveSection","gd","renderTeamAnalysisSection","state","projectId","projectName","renderQueueSection","loadBillingData","projects","config","tiersData","exchangeRate","billingService","renderBillingSection","tier","i","prevLimit","fromStr","formatTokens","toStr","escapeHtml","formatEur","text","div","renderAuditSection","log","renderModelsSection","renderSectionContent","bindSectionEvents","container","btn","on","newSection","renderAdminPanel","inputId","input","modelsCache","loadModelsForProvider","taskType","modelSelect","loadingSpan","statusDiv","m","currentValue","select","provider","saveLLMBtn","taskConfigs","el","field","loadApiKeysStatus","loadingEl","secret","formGroup","statusSpan","saveKeysBtn","keys","savedCount","saveServiceKeysBtn","resendKey","braveKey","saved","msg","loadQueueStatus","statusContent","itemsContent","pendingCount","dbStatusBadge","data","statusColor","statusText","pendingLen","item","db","statPending","statProcessing","statSuccess","statFailed","statRetry","statAvgTime","statCost","loadQueueHistory","historyContent","history","showRequestDetails","requestId","req","str","formatJsonHtml","obj","json","formatPromptText","statusInfo","status","inputData","messages","promptText","existingModal","modal","e","handleEsc","loadFailedItems","failedContent","items","refreshStatusBtn","refreshHistoryBtn","refreshFailedBtn","retryAllBtn","successCount","pauseBtn","resumeBtn","clearBtn","target","viewBtn","viewId","cancelBtn","cancelId","retryBtn","retryId","retryResetBtn","retryResetId","loadMetadataSyncStatus","countsDiv","total","sum","syncAllBtn","resultDiv","entries","result","browseModelsBtn","providerSelect","contentDiv","textModels","visionModels","embeddingModels","saveGraphBtn","graphConfigValue","testGraphBtn","testConfig","loadGraphOverviewBtn","refreshGraphOverviewBtn","openGraphTabBtn","loadOntologyBtn","reloadOntologyBtn","savePromptsBtn","promptElements","textarea","statusEl","reloadPromptsBtn","historyDiv","listDiv","versions","currentVersion","v","restoreBtn","promptKey","versionStr","version","previewBtn","template","previewModal","saveProcBtn","saveTeamAnalysisBtn","rootFolderId","serviceJson","err","res","exchangeRateAutoCheckbox","isAuto","manualGroup","refreshBtn","refreshRateBtn","rateDisplay","sourceDisplay","saveExchangeRateBtn","manualRate","saveGlobalPricingBtn","fixedMarkup","periodType","addTierBtn","index","checkbox","limitInput","saveTiersBtn","tiers","row","name","limitValue","markup","unlimited","refreshBillingBtn","amount","isUnlimited","refreshAuditBtn","initAdminPanel"],"mappings":"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"}